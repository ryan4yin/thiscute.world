[{"categories":null,"content":" .animation-wrapper { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -100; } .particle, .particle:after { background: transparent; } .particle:after { position: absolute; content: \"\"; top: 2560px; } .particle-1 { -webkit-animation: animParticle 60s linear infinite; animation: animParticle 60s linear infinite; box-shadow: 0px 0px #fff, 1231px 1530px #fff, 336px 2471px #fff, 2385px 128px #fff, 2436px 1283px #fff, 549px 681px #fff, 1775px 1144px #fff, 238px 1396px #fff, 1330px 1558px #fff, 2060px 342px #fff, 1986px 1672px #fff, 1532px 702px #fff, 1313px 1459px #fff, 2406px 1616px #fff, 1529px 802px #fff, 1267px 680px #fff, 2258px 2109px #fff, 1325px 22px #fff, 1578px 1045px #fff, 945px 2256px #fff, 1400px 1441px #fff, 1652px 2152px #fff, 2513px 969px #fff, 2192px 1352px #fff, 793px 334px #fff, 1371px 1086px #fff, 2408px 1898px #fff, 475px 840px #fff, 539px 1108px #fff, 556px 1499px #fff, 643px 122px #fff, 2370px 1975px #fff, 1196px 1786px #fff, 308px 1834px #fff, 1957px 1569px #fff, 875px 339px #fff, 562px 412px #fff, 1187px 2258px #fff, 1406px 1824px #fff, 1172px 1792px #fff, 235px 1489px #fff, 2081px 878px #fff, 925px 176px #fff, 953px 1829px #fff, 38px 48px #fff, 1976px 1994px #fff, 1524px 1567px #fff, 1397px 1141px #fff, 2014px 1773px #fff, 1638px 1832px #fff, 1150px 465px #fff, 1212px 1854px #fff, 122px 20px #fff, 2493px 2361px #fff, 2221px 194px #fff, 480px 2020px #fff, 2340px 403px #fff, 1975px 2507px #fff, 1434px 142px #fff, 963px 871px #fff, 2379px 1765px #fff, 2346px 100px #fff, 1931px 1308px #fff, 527px 814px #fff, 549px 1732px #fff, 943px 886px #fff, 1592px 2277px #fff, 1339px 810px #fff, 871px 2016px #fff, 2121px 763px #fff, 1962px 1114px #fff, 2498px 550px #fff, 107px 586px #fff, 316px 1033px #fff, 2104px 2120px #fff, 1933px 1786px #fff, 1377px 2457px #fff, 2250px 1010px #fff, 1314px 2316px #fff, 1339px 947px #fff, 122px 1014px #fff, 558px 2354px #fff, 1250px 1790px #fff, 1185px 2144px #fff, 2432px 158px #fff, 1911px 2148px #fff, 1177px 804px #fff, 2504px 1254px #fff, 617px 1084px #fff, 1959px 1325px #fff, 2394px 2081px #fff, 395px 735px #fff, 221px 1891px #fff, 652px 2245px #fff, 1225px 1023px #fff, 1542px 2053px #fff, 876px 2178px #fff, 479px 1915px #fff, 2297px 1799px #fff, 2160px 387px #fff, 160px 358px #fff, 1122px 2164px #fff, 2056px 1402px #fff, 2133px 1470px #fff, 1508px 1865px #fff, 250px 2157px #fff, 715px 1452px #fff, 2095px 1539px #fff, 1860px 1450px #fff, 185px 2013px #fff, 1855px 1878px #fff, 690px 2520px #fff, 2250px 838px #fff, 1547px 1752px #fff, 1103px 615px #fff, 151px 262px #fff, 1630px 577px #fff, 769px 2448px #fff, 1938px 2347px #fff, 700px 1634px #fff, 2105px 2053px #fff, 1498px 49px #fff, 799px 512px #fff, 1278px 744px #fff, 2301px 364px #fff, 1059px 2066px #fff, 2116px 2424px #fff, 1884px 1046px #fff, 699px 1101px #fff, 62px 1893px #fff, 370px 161px #fff, 298px 1288px #fff, 1972px 2211px #fff, 1834px 2350px #fff, 1591px 1118px #fff, 1343px 1730px #fff, 706px 850px #fff, 317px 1171px #fff, 1395px 2529px #fff, 1040px 2523px #fff, 793px 2535px #fff, 2180px 142px #fff, 2016px 2511px #fff, 1032px 1204px #fff, 499px 625px #fff, 130px 2064px #fff, 1371px 758px #fff, 1045px 2018px #fff, 1954px 309px #fff, 1445px 2514px #fff, 839px 1523px #fff, 920px 238px #fff, 1421px 1105px #fff, 668px 1517px #fff, 2045px 2344px #fff, 2465px 1619px #fff, 403px 48px #fff, 1142px 1102px #fff, 2066px 1803px #fff, 658px 1744px #fff, 721px 2062px #fff, 2180px 827px #fff, 2310px 111px #fff, 935px 808px #fff, 1121px 1108px #fff, 1424px 1998px #fff, 821px 1317px #fff, 2425px 1354px #fff, 305px 1422px #fff, 169px 1559px #fff, 1850px 425px #fff, 719px 1507px #fff, 1650px 1803px #fff, 275px 402px #fff, 1038px 772px #fff, 404px 105px #fff, 78px 2119px #fff, 133px 110px #fff, 2559px 944px #fff, 688px 212px #fff, 869px 2266px #fff, 983px 840px #fff, 1914px 2154px #fff, 1376px 941px #fff, 2064px 739px #fff, 1979px 1255px #fff, 592px 1175px #fff, 283px 253px #fff, 696px 2501px #fff, 1561px 1505px #fff, 745px","date":"2022-02-07","objectID":"/statistics/:0:0","tags":null,"title":"æœ¬ç«™ç»Ÿè®¡æ•°æ®","uri":"/statistics/"},{"categories":null,"content":"ä¸€ã€å…¨ç«™ç»Ÿè®¡ äººå‡é˜…è¯»æ—¶é•¿ æ€»è®¿å®¢æ•° UV æ€»è®¿é—®é‡ PV æ€»é˜…è¯»æ—¶é•¿ 01m 40s 8440 18479 9 days, 205m 37s ","date":"2022-02-07","objectID":"/statistics/:1:0","tags":null,"title":"æœ¬ç«™ç»Ÿè®¡æ•°æ®","uri":"/statistics/"},{"categories":null,"content":"äºŒã€è¿‘ 30 å¤©é˜…è¯»æ’è¡Œ æŒ‰ã€Œäººå‡é˜…è¯»æ—¶é•¿ã€é™åºæ’åˆ— æ ‡é¢˜ äººå‡é˜…è¯»æ—¶é•¿ è®¿å®¢æ•° è®¿é—®é‡ 1 ä½¿ç”¨ Istio è¿›è¡Œ JWT èº«ä»½éªŒè¯ï¼ˆå……å½“ API ç½‘å…³ï¼‰ 03m 16s 17 26 2 TLS åè®®ã€TLS è¯ä¹¦ã€TLS è¯ä¹¦çš„é…ç½®æ–¹æ³•ã€TLS åŠ å¯†çš„ç ´è§£æ‰‹æ®µ 02m 49s 59 68 3 Linux ä¸­çš„è™šæ‹Ÿç½‘ç»œæ¥å£ 02m 42s 36 42 4 äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ 02m 08s 80 110 5 æˆ‘åœ¨åˆ›ä¸šå…¬å¸åšæŠ€æœ¯ä¸€å¹´å¤šçš„ä¸€ç‚¹ä½“ä¼š 02m 04s 5 9 6 Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ– 01m 54s 38 52 7 secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨ 01m 53s 109 158 8 Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹ 01m 39s 15 21 9 iptables åŠ docker å®¹å™¨ç½‘ç»œåˆ†æ 01m 33s 42 59 10 ä½¿ç”¨ tcpdump å’Œ Wireshark è¿›è¡Œè¿œç¨‹å®æ—¶æŠ“åŒ…åˆ†æ 01m 29s 43 59 11 2021 å¹´å¹´ç»ˆæ€»ç»“ 01m 27s 309 422 12 2020 å¹´å¹´ç»ˆæ€»ç»“ 01m 15s 15 18 13 WebSocketã€HTTP/2 ä¸ gRPC 01m 09s 21 26 14 SQL åŸºç¡€ç¬”è®°ï¼ˆä¸€ï¼‰ 01m 04s 8 11 15 SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šEngine ä¸ SQL è¡¨è¾¾å¼è¯­è¨€ 58s 2 3 16 Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ 56s 43 64 17 QEMU-KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨ 55s 111 130 18 JWT ç­¾åç®—æ³• HS256ã€RS256 åŠ ES256 åŠå¯†é’¥ç”Ÿæˆ 54s 46 53 19 éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤ 54s 36 53 20 å¿½è€Œå‡æœ« 54s 2 3 21 openSUSE ä½¿ç”¨æŒ‡å— 53s 7 11 22 å°‘æœ‰äººè¿¹çš„æ ¡å›­ 52s 7 8 23 Linux ç½‘ç»œå·¥å…·ä¸­çš„ç‘å£«å†›åˆ€ - socat \u0026 netcat 50s 31 36 24 åœ¨å›å£°ä¸­é‡å† 46s 3 3 25 ã€Œå°æ­Œè¡Œã€-æ™¯å¾·é•‡æ–‡è‰ºå¤å…´-2020å·¡æ¼”-æ·±åœ³ 45s 2 2 26 è„šè¸å®åœ°ï¼Œä»°æœ›æ˜Ÿç©º 42s 9 9 27 æˆ‘æ‚£ä¸Šäº†é˜…è¯»ç„¦è™‘ç—‡ 33s 6 8 28 å­¦è‹±è¯­å•Šå­¦è‹±è¯­ 29s 7 7 29 Manjaro ä½¿ç”¨æŒ‡å— 14s 4 4 30 åˆä¸€ä¸ªæœŸæœ« 12s 5 5 31 SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢ 10s 3 5 32 Kubernetes å¸¸è§é”™è¯¯ã€åŸå› åŠå¤„ç†æ–¹æ³• 08s 10 11 33 æ¬§å‡ é‡Œå¾—ç®—æ³•æ±‚æœ€å¤§å…¬çº¦æ•°(GCD)çš„æ•°å­¦åŸç† 06s 3 3 34 æ­¤å²¸å¼ƒè‰ï¼Œå½¼å²¸ç¹èŠ± 05s 10 10 ","date":"2022-02-07","objectID":"/statistics/:2:0","tags":null,"title":"æœ¬ç«™ç»Ÿè®¡æ•°æ®","uri":"/statistics/"},{"categories":["æŠ€æœ¯"],"content":" æœ¬æ–‡ç”±ä¸ªäººç¬”è®° ryan4yin/knowledge æ•´ç†è€Œæ¥ï¼Œä¸ä¿è¯æ­£ç¡® ","date":"2022-01-25","objectID":"/posts/kubernetes-deployemnt-using-kubeadm/:0:0","tags":["Kubernetes","äº‘åŸç”Ÿ"],"title":"éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤","uri":"/posts/kubernetes-deployemnt-using-kubeadm/"},{"categories":["æŠ€æœ¯"],"content":"æœ¬åœ° Kubernetes é›†ç¾¤å®‰è£…å·¥å…· äº‘ä¸Šçš„ Kubernetes é›†ç¾¤ï¼ŒåŸºæœ¬ä¸Šå„äº‘å‚å•†éƒ½æ”¯æŒä¸€é”®éƒ¨ç½²ã€‚è¿™é‡Œä¸»è¦å…³æ³¨æœ¬åœ°éƒ¨ç½²ï¼Œæˆ–è€…å«åšè£¸æœº(baremetal)éƒ¨ç½² æœ¬æ–‡ä»‹ç»çš„æ–¹æ³•é€‚åˆå¼€å‘æµ‹è¯•ä½¿ç”¨ï¼Œå®‰å…¨æ€§ã€ç¨³å®šæ€§ã€é•¿æœŸå¯ç”¨æ€§ç­‰æ–¹æ¡ˆéƒ½å¯èƒ½è¿˜æœ‰é—®é¢˜ã€‚ æœ¬æ–‡æœªè€ƒè™‘å›½å†…ç½‘ç»œç¯å¢ƒï¼Œå»ºè®®åœ¨è·¯ç”±å™¨ä¸Šæ•´ä¸ªç§‘å­¦ä»£ç†ï¼Œæˆ–è€…è‡ªè¡Œè°ƒæ•´æ–‡ä¸­çš„éƒ¨åˆ†å‘½ä»¤ã€‚ kubernetes æ˜¯ä¸€ä¸ªç»„ä»¶åŒ–çš„ç³»ç»Ÿï¼Œå®‰è£…è¿‡ç¨‹æœ‰å¾ˆå¤§çš„çµæ´»æ€§ï¼Œå¾ˆå¤šç»„ä»¶éƒ½æœ‰å¤šç§å®ç°ï¼Œè¿™äº›å®ç°å„æœ‰ç‰¹ç‚¹ï¼Œè®©åˆå­¦è€…çœ¼èŠ±ç¼­ä¹±ã€‚ è€Œä¸”è¦æŠŠè¿™äº›ç»„ä»¶ä¸€ä¸ªä¸ªå®‰è£…é…ç½®å¥½å¹¶ä¸”èƒ½ååŒå·¥ä½œï¼Œä¹Ÿæ˜¯å¾ˆä¸å®¹æ˜“çš„ã€‚ å› æ­¤ç¤¾åŒºå‡ºç°äº†å„ç§å„æ ·çš„å®‰è£…æ–¹æ¡ˆï¼Œä¸‹é¢ä»‹ç»ä¸‹å‡ ç§æ”¯æŒè£¸æœºï¼ˆBaremetalï¼‰éƒ¨ç½²çš„å·¥å…·ï¼š kubeadm: ç¤¾åŒºçš„é›†ç¾¤å®‰è£…å·¥å…·ï¼Œç›®å‰å·²ç»å¾ˆæˆç†Ÿäº†ã€‚ ä½¿ç”¨éš¾åº¦ï¼šç®€å• k3s: è½»é‡çº§ kubernetesï¼Œèµ„æºéœ€æ±‚å°ï¼Œéƒ¨ç½²éå¸¸ç®€å•ï¼Œé€‚åˆå¼€å‘æµ‹è¯•ç”¨æˆ–è€…è¾¹ç¼˜ç¯å¢ƒ æ”¯æŒ airgap ç¦»çº¿éƒ¨ç½² ä½¿ç”¨éš¾åº¦ï¼šè¶…çº§ç®€å• alibaba/sealer: æ”¯æŒå°†æ•´ä¸ª kubernetes æ‰“åŒ…æˆä¸€ä¸ªé•œåƒè¿›è¡Œäº¤ä»˜ï¼Œè€Œä¸”éƒ¨ç½²ä¹Ÿéå¸¸ç®€å•ã€‚ ä½¿ç”¨éš¾åº¦ï¼šè¶…çº§ç®€å• è¿™ä¸ªé¡¹ç›®ç›®å‰è¿˜åœ¨å‘å±•ä¸­ï¼Œä¸è¿‡è²Œä¼¼å·²ç»æœ‰å¾ˆå¤š toB çš„å…¬å¸åœ¨ä½¿ç”¨å®ƒè¿›è¡Œ k8s åº”ç”¨çš„äº¤ä»˜äº†ã€‚ kubespray: é€‚åˆè‡ªå»ºç”Ÿäº§çº§åˆ«çš„é›†ç¾¤ï¼Œæ˜¯ä¸€ä¸ªå¤§è€Œå…¨çš„ kubernetes å®‰è£…æ–¹æ¡ˆï¼Œè‡ªåŠ¨å®‰è£…å®¹å™¨è¿è¡Œæ—¶ã€k8sã€ç½‘ç»œæ’ä»¶ç­‰ç»„ä»¶ï¼Œè€Œä¸”å„ç»„ä»¶éƒ½æœ‰å¾ˆå¤šæ–¹æ¡ˆå¯é€‰ï¼Œä½†æ˜¯æ„Ÿè§‰æœ‰ç‚¹å¤æ‚ã€‚ ä½¿ç”¨éš¾åº¦ï¼šä¸­ç­‰ æ”¯æŒ airgap ç¦»çº¿éƒ¨ç½²ï¼Œä½†æ˜¯ä»¥å‰æˆ‘è¯•ç”¨è¿‡æ˜¯æœ‰å‘ï¼Œç°åœ¨ä¸çŸ¥é“å’‹æ ·äº† åº•å±‚ä½¿ç”¨äº† kubeadm éƒ¨ç½²é›†ç¾¤ ç¬”è€…ä¸ºäº†å­¦ä¹  Kubernetesï¼Œä¸‹é¢é‡‡ç”¨å®˜æ–¹çš„ kubeadm è¿›è¡Œéƒ¨ç½²ï¼ˆä¸è¦é—®ä¸ºå•¥ä¸äºŒè¿›åˆ¶éƒ¨ç½²ï¼Œé—®å°±æ˜¯æ‡’ï¼‰ï¼Œå®¹å™¨è¿è¡Œæ—¶ä½¿ç”¨ containerdï¼Œç½‘ç»œæ’ä»¶åˆ™ä½¿ç”¨ç›®å‰æœ€æ½®çš„åŸºäº eBPF çš„ Cilium. kubernetes å®˜æ–¹ä»‹ç»äº†ä¸¤ç§é«˜å¯ç”¨é›†ç¾¤çš„æ‹“æ‰‘ç»“æ„ï¼šã€ŒStacked etcd topologyã€å’Œã€ŒExternal etcd topologyã€ï¼Œç®€å•èµ·è§ï¼Œæœ¬æ–‡ä½¿ç”¨ç¬¬ä¸€ç§ã€Œå †å  Etcd æ‹“æ‰‘ã€ç»“æ„ï¼Œåˆ›å»ºä¸€ä¸ªä¸‰ master çš„é«˜å¯ç”¨é›†ç¾¤ã€‚ å‚è€ƒï¼š Kubernetes Docs - Installing kubeadm Kubernetes Docs - Creating Highly Available clusters with kubeadm ","date":"2022-01-25","objectID":"/posts/kubernetes-deployemnt-using-kubeadm/:1:0","tags":["Kubernetes","äº‘åŸç”Ÿ"],"title":"éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤","uri":"/posts/kubernetes-deployemnt-using-kubeadm/"},{"categories":["æŠ€æœ¯"],"content":"1. èŠ‚ç‚¹çš„ç¯å¢ƒå‡†å¤‡ é¦–å…ˆå‡†å¤‡ä¸‰å° Linux è™šæ‹Ÿæœºï¼Œç³»ç»ŸæŒ‰éœ€é€‰æ‹©ï¼Œç„¶åè°ƒæ•´è¿™ä¸‰å°æœºå™¨çš„è®¾ç½®ï¼š èŠ‚ç‚¹é…ç½®ï¼š masterï¼šä¸ä½äº 2c/3gï¼Œç¡¬ç›˜ 20G ä¸»èŠ‚ç‚¹æ€§èƒ½ä¹Ÿå—é›†ç¾¤ Pods ä¸ªæ•°çš„å½±å“ï¼Œä¸Šè¿°é…ç½®åº”è¯¥å¯ä»¥æ”¯æ’‘åˆ°æ¯ä¸ª Worker èŠ‚ç‚¹è·‘ 100 ä¸ª Pod. workerï¼šçœ‹éœ€æ±‚ï¼Œå»ºè®®ä¸ä½äº 2c/4gï¼Œç¡¬ç›˜ä¸å°äº 20Gï¼Œèµ„æºå……åˆ†çš„è¯å»ºè®® 40G. å¤„äºåŒä¸€ç½‘ç»œå†…å¹¶å¯äº’é€šï¼ˆé€šå¸¸æ˜¯åŒä¸€å±€åŸŸç½‘ï¼‰ å„ä¸»æœºçš„ hostname å’Œ mac/ip åœ°å€ä»¥åŠ /sys/class/dmi/id/product_uuidï¼Œéƒ½å¿…é¡»å”¯ä¸€ è¿™é‡Œæœ€å®¹æ˜“å‡ºé—®é¢˜çš„ï¼Œé€šå¸¸æ˜¯ hostname å†²çªï¼ å¿…é¡»å…³é—­ swapï¼Œkubelet æ‰èƒ½æ­£å¸¸å·¥ä½œï¼ æ–¹ä¾¿èµ·è§ï¼Œæˆ‘ç›´æ¥ä½¿ç”¨ ryan4yin/pulumi-libvirt è‡ªåŠ¨åˆ›å»ºäº†äº”ä¸ªè™šæ‹Ÿæœºï¼Œå¹¶è®¾ç½®å¥½äº† ip/hostname. æœ¬æ–‡ä½¿ç”¨äº† opensuse leap 15.3 çš„ KVM cloud image è¿›è¡Œå®‰è£…æµ‹è¯•ã€‚ ","date":"2022-01-25","objectID":"/posts/kubernetes-deployemnt-using-kubeadm/:2:0","tags":["Kubernetes","äº‘åŸç”Ÿ"],"title":"éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤","uri":"/posts/kubernetes-deployemnt-using-kubeadm/"},{"categories":["æŠ€æœ¯"],"content":"1.1 iptables è®¾ç½® ç›®å‰ kubernetes çš„å®¹å™¨ç½‘ç»œï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯ bridge æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼ä¸‹ï¼Œéœ€è¦ä½¿ iptables èƒ½å¤Ÿæ¥ç®¡ bridge ä¸Šçš„æµé‡ã€‚ é…ç½®å¦‚ä¸‹ï¼š sudo modprobe br_netfilter cat \u003c\u003cEOF | sudo tee /etc/modules-load.d/k8s.conf br_netfilter EOF cat \u003c\u003cEOF | sudo tee /etc/sysctl.d/k8s.conf net.bridge.bridge-nf-call-ip6tables = 1 net.bridge.bridge-nf-call-iptables = 1 EOF sudo sysctl --system ","date":"2022-01-25","objectID":"/posts/kubernetes-deployemnt-using-kubeadm/:2:1","tags":["Kubernetes","äº‘åŸç”Ÿ"],"title":"éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤","uri":"/posts/kubernetes-deployemnt-using-kubeadm/"},{"categories":["æŠ€æœ¯"],"content":"1.2 å¼€æ”¾èŠ‚ç‚¹ç«¯å£ å±€åŸŸç½‘ç¯å¢ƒçš„è¯ï¼Œå»ºè®®ç›´æ¥å…³é—­é˜²ç«å¢™ã€‚è¿™æ ·æ‰€æœ‰ç«¯å£éƒ½å¯ç”¨ï¼Œæ–¹ä¾¿å¿«æ·ã€‚ é€šå¸¸æˆ‘ä»¬çš„äº‘ä¸Šé›†ç¾¤ï¼Œä¹Ÿæ˜¯å…³é—­é˜²ç«å¢™çš„ï¼Œåªæ˜¯ä¼šé€šè¿‡äº‘æœåŠ¡æä¾›çš„ã€Œå®‰å…¨ç»„ã€æ¥é™åˆ¶å®¢æˆ·ç«¯ ip Control-plane èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ masterï¼Œéœ€è¦å¼€æ”¾å¦‚ä¸‹ç«¯å£ï¼š Protocol Direction Port Range Purpose Used By TCP Inbound 6443* Kubernetes API server All TCP Inbound 2379-2380 etcd server client API kube-apiserver, etcd TCP Inbound 10250 kubelet API Self, Control plane TCP Inbound 10251 kube-scheduler Self TCP Inbound 10252 kube-controller-manager Self Worker èŠ‚ç‚¹éœ€è¦å¼€å‘å¦‚ä¸‹ç«¯å£ï¼š Protocol Direction Port Range Purpose Used By TCP Inbound 10250 kubelet API Self, Control plane TCP Inbound 30000-32767 NodePort Servicesâ€  All å¦å¤–é€šå¸¸æˆ‘ä»¬æœ¬åœ°æµ‹è¯•çš„æ—¶å€™ï¼Œå¯èƒ½æ›´æƒ³ç›´æ¥åœ¨ 80 443 8080 ç­‰ç«¯å£ä¸Šä½¿ç”¨ NodePortï¼Œ å°±éœ€è¦ä¿®æ”¹ kube-apiserver çš„ --service-node-port-range å‚æ•°æ¥è‡ªå®šä¹‰ NodePort çš„ç«¯å£èŒƒå›´ï¼Œç›¸åº”çš„ Worker èŠ‚ç‚¹ä¹Ÿå¾—å¼€æ”¾è¿™äº›ç«¯å£ã€‚ ","date":"2022-01-25","objectID":"/posts/kubernetes-deployemnt-using-kubeadm/:2:2","tags":["Kubernetes","äº‘åŸç”Ÿ"],"title":"éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤","uri":"/posts/kubernetes-deployemnt-using-kubeadm/"},{"categories":["æŠ€æœ¯"],"content":"2. å®‰è£… containerd é¦–å…ˆæ˜¯ç¯å¢ƒé…ç½®ï¼š cat \u003c\u003cEOF | sudo tee /etc/modules-load.d/containerd.conf overlay br_netfilter nf_conntrack EOF sudo modprobe overlay sudo modprobe br_netfilter sudo modprobe nf_conntrack # Setup required sysctl params, these persist across reboots. cat \u003c\u003cEOF | sudo tee /etc/sysctl.d/99-kubernetes-cri.conf net.bridge.bridge-nf-call-iptables = 1 net.ipv4.ip_forward = 1 net.bridge.bridge-nf-call-ip6tables = 1 EOF # Apply sysctl params without reboot sudo sysctl --system å®‰è£… containerd+nerdctl: wget https://github.com/containerd/nerdctl/releases/download/v0.11.1/nerdctl-full-0.11.1-linux-amd64.tar.gz tar -axvf nerdctl-full-0.11.1-linux-amd64.tar.gz # è¿™é‡Œç®€å•èµ·è§ï¼Œrootless ç›¸å…³çš„ä¸œè¥¿ä¹Ÿä¸€èµ·è£…è¿›å»äº†ï¼Œæµ‹è¯•å˜›å°±æ— æ‰€è°“äº†... mv bin/* /usr/local/bin/ mv lib/systemd/system/containerd.service /usr/lib/systemd/system/ systemctl enable containerd systemctl start containerd nerdctl æ˜¯ä¸€ä¸ª containerd çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œä½†æ˜¯å®ƒçš„å®¹å™¨ã€é•œåƒä¸ Kubernetes çš„å®¹å™¨ã€é•œåƒæ˜¯å®Œå…¨éš”ç¦»çš„ï¼Œä¸èƒ½äº’é€šï¼ ç›®å‰åªèƒ½é€šè¿‡ crictl æ¥æŸ¥çœ‹ã€æ‹‰å– Kubernetes çš„å®¹å™¨ã€é•œåƒï¼Œä¸‹ä¸€èŠ‚ä¼šä»‹ç» crictl çš„å®‰è£…ã€‚ ","date":"2022-01-25","objectID":"/posts/kubernetes-deployemnt-using-kubeadm/:3:0","tags":["Kubernetes","äº‘åŸç”Ÿ"],"title":"éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤","uri":"/posts/kubernetes-deployemnt-using-kubeadm/"},{"categories":["æŠ€æœ¯"],"content":"3. å®‰è£… kubelet/kubeadm/kubectl # ä¸€äº›å…¨å±€éƒ½éœ€è¦ç”¨çš„å˜é‡ CNI_VERSION=\"v0.8.2\" CRICTL_VERSION=\"v1.17.0\" # kubernetes çš„ç‰ˆæœ¬å· # RELEASE=\"$(curl -sSL https://dl.k8s.io/release/stable.txt)\" RELEASE=\"1.22.1\" # kubelet é…ç½®æ–‡ä»¶çš„ç‰ˆæœ¬å· RELEASE_VERSION=\"v0.4.0\" # æ¶æ„ ARCH=\"amd64\" #ã€€å®‰è£…ç›®å½• DOWNLOAD_DIR=/usr/local/bin # CNI æ’ä»¶ sudo mkdir -p /opt/cni/bin curl -L \"https://github.com/containernetworking/plugins/releases/download/${CNI_VERSION}/cni-plugins-linux-${ARCH}-${CNI_VERSION}.tgz\" | sudo tar -C /opt/cni/bin -xz # crictl ç›¸å…³å·¥å…· curl -L \"https://github.com/kubernetes-sigs/cri-tools/releases/download/${CRICTL_VERSION}/crictl-${CRICTL_VERSION}-linux-${ARCH}.tar.gz\" | sudo tar -C $DOWNLOAD_DIR -xz # kubelet/kubeadm/kubectl cd $DOWNLOAD_DIR sudo curl -L --remote-name-all https://storage.googleapis.com/kubernetes-release/release/${RELEASE}/bin/linux/${ARCH}/{kubeadm,kubelet,kubectl} sudo chmod +x {kubeadm,kubelet,kubectl} # kubelet/kubeadm é…ç½® curl -sSL \"https://raw.githubusercontent.com/kubernetes/release/${RELEASE_VERSION}/cmd/kubepkg/templates/latest/deb/kubelet/lib/systemd/system/kubelet.service\" | sed \"s:/usr/bin:${DOWNLOAD_DIR}:g\" | sudo tee /etc/systemd/system/kubelet.service sudo mkdir -p /etc/systemd/system/kubelet.service.d curl -sSL \"https://raw.githubusercontent.com/kubernetes/release/${RELEASE_VERSION}/cmd/kubepkg/templates/latest/deb/kubeadm/10-kubeadm.conf\" | sed \"s:/usr/bin:${DOWNLOAD_DIR}:g\" | sudo tee /etc/systemd/system/kubelet.service.d/10-kubeadm.conf systemctl enable --now kubelet # éªŒè¯ kubelet å¯åŠ¨èµ·æ¥äº†ï¼Œä½†æ˜¯ç›®å‰è¿˜æ²¡æœ‰åˆå§‹åŒ–é…ç½®ï¼Œè¿‡ä¸€é˜µå°±ä¼šé‡å¯ä¸€æ¬¡ systemctl status kubelet è¯•ç”¨ crictl: export CONTAINER_RUNTIME_ENDPOINT='unix:///var/run/containerd/containerd.sock' # åˆ—å‡ºæ‰€æœ‰ podsï¼Œç°åœ¨åº”è¯¥å•¥ä¹Ÿæ²¡ crictl pods # åˆ—å‡ºæ‰€æœ‰é•œåƒ crictl images ","date":"2022-01-25","objectID":"/posts/kubernetes-deployemnt-using-kubeadm/:4:0","tags":["Kubernetes","äº‘åŸç”Ÿ"],"title":"éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤","uri":"/posts/kubernetes-deployemnt-using-kubeadm/"},{"categories":["æŠ€æœ¯"],"content":"4. ä¸º master çš„ kube-apiserver åˆ›å»ºè´Ÿè½½å‡è¡¡å®ç°é«˜å¯ç”¨ æ ¹æ® kubeadm å®˜æ–¹æ–‡æ¡£ Kubeadm Docs - High Availability Considerations ä»‹ç»ï¼Œè¦å®ç° kube-apiserver çš„é«˜å¯ç”¨ï¼Œç›®å‰æœ€çŸ¥åçš„è´Ÿè½½å‡è¡¡æ–¹å¼æ˜¯ keepalived+haproxyï¼Œå¦å¤–ä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨ kube-vip ç­‰æ›´ç®€å•çš„å·¥å…·ã€‚ ç®€å•èµ·è§ï¼Œæˆ‘ä»¬ç›´æ¥ç”¨ kube-vip å§ï¼Œå‚è€ƒäº† kube-vip çš„å®˜æ–¹æ–‡æ¡£ï¼šKube-vip as a Static Pod with Kubelet. P.S. æˆ‘ä¹Ÿè§è¿‡æœ‰çš„å®‰è£…å·¥å…·ä¼šç›´æ¥æŠ›å¼ƒ keepalivedï¼Œç›´æ¥åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè·‘ä¸€ä¸ª nginx åšè´Ÿè½½å‡è¡¡ï¼Œé…ç½®é‡Œå†™æ­»äº†æ‰€æœ‰ master çš„åœ°å€â€¦ é¦–å…ˆä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ç”Ÿæˆ kube-vip çš„é…ç½®æ–‡ä»¶ï¼Œä»¥ ARP ä¸ºä¾‹ï¼ˆç”Ÿäº§ç¯å¢ƒå»ºè®®æ¢æˆ BGPï¼‰ï¼š cat \u003c\u003cEOF | sudo tee add-kube-vip.sh # ä½ çš„è™šæ‹Ÿæœºç½‘å¡ï¼Œopensuse/centos ç­‰éƒ½æ˜¯ eth0ï¼Œä½†æ˜¯ ubuntu å¯èƒ½æ˜¯ ens3 export INTERFACE=eth0 # ç”¨äºå®ç°é«˜å¯ç”¨çš„ vipï¼Œéœ€è¦å’Œå‰é¢çš„ç½‘ç»œæ¥å£åœ¨åŒä¸€ç½‘æ®µå†…ï¼Œå¦åˆ™å°±æ— æ³•è·¯ç”±äº†ã€‚ export VIP=192.168.122.200 # ç”Ÿæˆ static-pod çš„é…ç½®æ–‡ä»¶ mkdir -p /etc/kubernetes/manifests nerdctl run --rm --network=host --entrypoint=/kube-vip ghcr.io/kube-vip/kube-vip:v0.3.8 \\ manifest pod \\ --interface $INTERFACE \\ --vip $VIP \\ --controlplane \\ --services \\ --arp \\ --leaderElection | tee /etc/kubernetes/manifests/kube-vip.yaml EOF bash add-kube-vip.sh ä¸‰ä¸ª master èŠ‚ç‚¹éƒ½éœ€è¦è·‘ä¸‹ä¸Šé¢çš„å‘½ä»¤ï¼ˆworker ä¸éœ€è¦ï¼‰ï¼Œåˆ›å»ºå¥½ kube-vip çš„ static-pod é…ç½®æ–‡ä»¶ã€‚ åœ¨å®Œæˆ kubeadm åˆå§‹åŒ–åï¼Œkubelet ä¼šè‡ªåŠ¨æŠŠå®ƒä»¬æ‹‰èµ·ä¸º static pod. ","date":"2022-01-25","objectID":"/posts/kubernetes-deployemnt-using-kubeadm/:5:0","tags":["Kubernetes","äº‘åŸç”Ÿ"],"title":"éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤","uri":"/posts/kubernetes-deployemnt-using-kubeadm/"},{"categories":["æŠ€æœ¯"],"content":"5. ä½¿ç”¨ kubeadm åˆ›å»ºé›†ç¾¤ å…¶å®éœ€è¦è¿è¡Œçš„å°±æ˜¯è¿™æ¡å‘½ä»¤ï¼š # æç®€é…ç½®ï¼š cat \u003c\u003cEOF | sudo tee kubeadm-config.yaml apiVersion: kubeadm.k8s.io/v1beta3 kind: InitConfiguration nodeRegistration: criSocket: \"/var/run/containerd/containerd.sock\" imagePullPolicy: IfNotPresent --- kind: ClusterConfiguration apiVersion: kubeadm.k8s.io/v1beta3 kubernetesVersion: v1.22.1 clusterName: kubernetes certificatesDir: /etc/kubernetes/pki imageRepository: k8s.gcr.io controlPlaneEndpoint: \"192.168.122.200:6443\" # å¡« apiserver çš„ vip åœ°å€ï¼Œæˆ–è€…æ•´ä¸ªåŸŸåä¹Ÿè¡Œï¼Œä½†æ˜¯å°±å¾—åŠ  /etc/hosts æˆ–è€…å†…ç½‘ DNS è§£æ networking: serviceSubnet: \"10.96.0.0/16\" podSubnet: \"10.244.0.0/16\" etcd: local: dataDir: /var/lib/etcd --- apiVersion: kubelet.config.k8s.io/v1beta1 kind: KubeletConfiguration cgroupDriver: systemd # è®© kubelet ä» certificates.k8s.io ç”³è¯·ç”±é›†ç¾¤ CA Root ç­¾åçš„ tls è¯ä¹¦ï¼Œè€Œéç›´æ¥ä½¿ç”¨è‡ªç­¾åè¯ä¹¦ # å¦‚æœä¸å¯ç”¨è¿™ä¸ªï¼Œ å®‰è£… metrics-server æ—¶å°±ä¼šé‡åˆ°è¯ä¹¦æŠ¥é”™ï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»ã€‚ serverTLSBootstrap: true EOF # æŸ¥çœ‹ kubeadm é»˜è®¤çš„å®Œæ•´é…ç½®ï¼Œä¾›å‚è€ƒ kubeadm config print init-defaults \u003e init.default.yaml # æ‰§è¡Œé›†ç¾¤çš„åˆå§‹åŒ–ï¼Œè¿™ä¼šç›´æ¥å°†å½“å‰èŠ‚ç‚¹åˆ›å»ºä¸º master # æˆåŠŸè¿è¡Œçš„å‰æï¼šå‰é¢è¯¥è£…çš„ä¸œè¥¿éƒ½è£…å¥½äº†ï¼Œè€Œä¸” kubelet å·²ç»åœ¨åå°è¿è¡Œäº† # `--upload-certs` ä¼šå°†ç”Ÿæˆçš„é›†ç¾¤è¯ä¹¦ä¸Šä¼ åˆ° kubeadm æœåŠ¡å™¨ï¼Œåœ¨ä¸¤å°æ—¶å†…åŠ å…¥é›†ç¾¤çš„ master èŠ‚ç‚¹ä¼šè‡ªåŠ¨æ‹‰è¯ä¹¦ï¼Œä¸»è¦æ˜¯æ–¹ä¾¿é›†ç¾¤åˆ›å»ºã€‚ kubeadm init --config kubeadm-config.yaml --upload-certs kubeadm åº”è¯¥ä¼šæŠ¥é”™ï¼Œæç¤ºä½ æœ‰äº›ä¾èµ–ä¸å­˜åœ¨ï¼Œä¸‹é¢å…ˆå®‰è£…å¥½ä¾èµ–é¡¹ã€‚ sudo zypper in -y socat ebtables conntrack-tools å†é‡æ–°è¿è¡Œå‰é¢çš„ kubeadm å‘½ä»¤ï¼Œåº”è¯¥å°±èƒ½æ­£å¸¸æ‰§è¡Œäº†ï¼Œå®ƒåšçš„æ“ä½œæœ‰ï¼š æ‹‰å–æ§åˆ¶é¢çš„å®¹å™¨é•œåƒ ç”Ÿæˆ ca æ ¹è¯ä¹¦ ä½¿ç”¨æ ¹è¯ä¹¦ä¸º etcd/apiserver ç­‰ä¸€ç¥¨å·¥å…·ç”Ÿæˆ tls è¯ä¹¦ ä¸ºæ§åˆ¶é¢çš„å„ä¸ªç»„ä»¶ç”Ÿæˆ kubeconfig é…ç½® ç”Ÿæˆ static pod é…ç½®ï¼Œkubelet ä¼šæ ¹æ®è¿™äº›é…ç½®è‡ªåŠ¨æ‹‰èµ· kube-proxy ä»¥åŠå…¶ä»–æ‰€æœ‰çš„ k8s master ç»„ä»¶ è¿è¡Œå®Œä¼šç»™å‡ºä¸‰éƒ¨åˆ†å‘½ä»¤ï¼š å°† kubeconfig æ”¾åˆ° $HOME/.kube/config ä¸‹ï¼Œkubectl éœ€è¦ä½¿ç”¨è¯¥é…ç½®æ–‡ä»¶è¿æ¥ kube-apiserver control-plane èŠ‚ç‚¹åŠ å…¥é›†ç¾¤çš„å‘½ä»¤: è¿™é‡Œç”±äºæˆ‘ä»¬æå‰æ·»åŠ äº† kube-vip çš„ static-pod é…ç½®ï¼Œè¿™é‡Œçš„ preflight-check ä¼šæŠ¥é”™ï¼Œéœ€è¦æ·»åŠ æ­¤å‚æ•°å¿½ç•¥è¯¥æŠ¥é”™ - --ignore-preflight-errors=DirAvailable--etc-kubernetes-manifests kubeadm join 192.168.122.200:6443 --token \u003ctoken\u003e \\ --discovery-token-ca-cert-hash sha256:\u003chash\u003e \\ --control-plane --certificate-key \u003ckey\u003e \\ --ignore-preflight-errors=DirAvailable--etc-kubernetes-manifests worker èŠ‚ç‚¹åŠ å…¥é›†ç¾¤çš„å‘½ä»¤: kubeadm join 192.168.122.200:6443 --token \u003ctoken\u003e \\ --discovery-token-ca-cert-hash sha256:\u003chash\u003e è·‘å®Œç¬¬ä¸€éƒ¨åˆ† kubeconfig çš„å¤„ç†å‘½ä»¤åï¼Œå°±å¯ä»¥ä½¿ç”¨ kubectl æŸ¥çœ‹é›†ç¾¤çŠ¶å†µäº†ï¼š k8s-master-0:~/kubeadm # kubectl get no NAME STATUS ROLES AGE VERSION k8s-master-0 NotReady control-plane,master 79s v1.22.1 k8s-master-0:~/kubeadm # kubectl get po --all-namespaces NAMESPACE NAME READY STATUS RESTARTS AGE kube-system coredns-78fcd69978-6tlnw 0/1 Pending 0 83s kube-system coredns-78fcd69978-hxtvs 0/1 Pending 0 83s kube-system etcd-k8s-master-0 1/1 Running 6 90s kube-system kube-apiserver-k8s-master-0 1/1 Running 4 90s kube-system kube-controller-manager-k8s-master-0 1/1 Running 4 90s kube-system kube-proxy-6w2bx 1/1 Running 0 83s kube-system kube-scheduler-k8s-master-0 1/1 Running 7 97s ç°åœ¨åœ¨å…¶ä»–èŠ‚ç‚¹è¿è¡Œå‰é¢æ‰“å°å‡ºçš„åŠ å…¥é›†ç¾¤çš„å‘½ä»¤ï¼Œå°±å¯ä»¥æ­å»ºå¥½ä¸€ä¸ªé«˜å¯ç”¨çš„é›†ç¾¤äº†ã€‚ æ‰€æœ‰èŠ‚ç‚¹éƒ½åŠ å…¥é›†ç¾¤åï¼Œé€šè¿‡ kubectl æŸ¥çœ‹ï¼Œåº”è¯¥æ˜¯ä¸‰ä¸ªæ§åˆ¶é¢ masterï¼Œä¸¤ä¸ª workerï¼š k8s-master-0:~/kubeadm # kubectl get node NAME STATUS ROLES AGE VERSION k8s-master-0 NotReady control-plane,master 26m v1.22.1 k8s-master-1 NotReady control-plane,master 7m2s v1.22.1 k8s-master-2 NotReady control-plane,master 2m10s v1.22.1 k8s-worker-0 NotReady \u003cnone\u003e 97s v1.22.1 k8s-worker-1 NotReady \u003cnone\u003e 86s v1.22.1 ç°åœ¨å®ƒä»¬éƒ½è¿˜å¤„äº NotReady çŠ¶æ€ï¼Œéœ€è¦ç­‰åˆ°æˆ‘ä»¬æŠŠç½‘ç»œæ’ä»¶å®‰è£…å¥½ï¼Œæ‰ä¼š Ready. ç°åœ¨å†çœ‹ä¸‹é›†ç¾¤çš„è¯ä¹¦ç­¾å‘çŠ¶æ€ï¼š â¯ kubectl get csr --sort-by='{.spec.username}' NAME AGE SIGNERNAME REQUESTOR REQUESTEDDURATION CONDITION csr-95hll 6m58s kubernetes.io/kube-apiserver-client-kubelet system:bootstrap:q8ivnz \u003cnone\u003e Approved,Issued csr-tklnr 7m5s kubernetes.io/kube-apiserver-client-kubelet system:bootstrap:q8ivnz \u003cnone\u003e Approved,Issued csr-w92jv 9m15s kubernetes.io/kube-apiserver-client-kubelet system:bootstrap:q8ivnz \u003cnone\u003e Approved,Issued csr-rv7sj 8m11s kubernetes.io/kube-apiserver-client-kubelet system:bootstrap:q8ivnz \u003cnone\u003e Approved,Issued csr-nxkgx 10m kubernetes.io/kube-apiserver-client-kubelet system:node:k8s-master-0 \u003cnone\u003e Approved,Issued csr-cd22c 10m kubernetes.io/kubelet-serving system:node:k8s-master-0 \u003cnone\u003e Pending csr-wjrnr 9m53s kubernetes.io/kubelet-serving system:node:k8s-master-0 \u003cnone\u003e Pending csr-sjq42 9m8s kubernetes.io/kubelet-serv","date":"2022-01-25","objectID":"/posts/kubernetes-deployemnt-using-kubeadm/:6:0","tags":["Kubernetes","äº‘åŸç”Ÿ"],"title":"éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤","uri":"/posts/kubernetes-deployemnt-using-kubeadm/"},{"categories":["æŠ€æœ¯"],"content":"5.1 å¸¸è§é—®é¢˜ 5.1.1 ä½¿ç”¨å›½å†…é•œåƒæº å¦‚æœä½ æ²¡æœ‰ç§‘å­¦ç¯å¢ƒï¼Œkubeadm é»˜è®¤çš„é•œåƒä»“åº“åœ¨å›½å†…æ˜¯æ‹‰ä¸äº†çš„ã€‚ å¦‚æœå¯¹å¯é æ€§è¦æ±‚é«˜ï¼Œæœ€å¥½æ˜¯è‡ªå»ºç§æœ‰é•œåƒä»“åº“ï¼ŒæŠŠé•œåƒæ¨é€åˆ°ç§æœ‰ä»“åº“ã€‚ å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤åˆ—å‡ºæ‰€æœ‰éœ€è¦ç”¨åˆ°çš„é•œåƒåœ°å€ï¼š â¯ kubeadm config images list --kubernetes-version v1.22.1 k8s.gcr.io/kube-apiserver:v1.22.1 k8s.gcr.io/kube-controller-manager:v1.22.1 k8s.gcr.io/kube-scheduler:v1.22.1 k8s.gcr.io/kube-proxy:v1.22.1 k8s.gcr.io/pause:3.5 k8s.gcr.io/etcd:3.5.0-0 k8s.gcr.io/coredns/coredns:v1.8.4 ä½¿ç”¨ skopeo ç­‰å·¥å…·æˆ–è„šæœ¬å°†ä¸Šè¿°é•œåƒæ‹·è´åˆ°ä½ çš„ç§æœ‰ä»“åº“ï¼Œæˆ–è€…å›¾æ–¹ä¾¿ï¼ˆæµ‹è¯•ç¯å¢ƒï¼‰ä¹Ÿå¯ä»¥è€ƒè™‘ç½‘ä¸Šæ‰¾æ‰¾åˆ«äººåŒæ­¥å¥½çš„é•œåƒåœ°å€ã€‚å°†é•œåƒåœ°å€æ·»åŠ åˆ° kubeadm-config.yaml ä¸­å†éƒ¨ç½²ã€‚ 5.1.2 é‡ç½®é›†ç¾¤é…ç½® åˆ›å»ºé›†ç¾¤çš„è¿‡ç¨‹ä¸­å‡ºç°ä»»ä½•é—®é¢˜ï¼Œéƒ½å¯ä»¥é€šè¿‡åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šè¿è¡Œ kubeadm reset æ¥è¿˜åŸé…ç½®ï¼Œç„¶åé‡æ–°èµ° kubeadm çš„é›†ç¾¤åˆ›å»ºæµç¨‹ã€‚ ä½†æ˜¯è¦æ³¨æ„å‡ ç‚¹ï¼š kubeadm reset ä¼šæ¸…é™¤åŒ…å« kube-vip é…ç½®åœ¨å†…çš„æ‰€æœ‰ static-pod é…ç½®æ–‡ä»¶ï¼Œæ‰€ä»¥ master èŠ‚ç‚¹éœ€è¦é‡æ–°è·‘ä¸‹å‰é¢ç»™çš„ kube-vip å‘½ä»¤ï¼Œç”Ÿæˆä¸‹ kube-vip é…ç½®ã€‚ kubeadm reset ä¸ä¼šé‡ç½®ç½‘ç»œæ¥å£çš„é…ç½®ï¼Œmaster èŠ‚ç‚¹éœ€è¦æ‰‹åŠ¨æ¸…ç†ä¸‹ kube-vip æ·»åŠ çš„ vip: ip addr del 192.168.122.200/32 dev eth0. å¦‚æœä½ åœ¨å®‰è£…äº†ç½‘ç»œæ’ä»¶ä¹‹åå¸Œæœ›é‡è£…é›†ç¾¤ï¼Œé¡ºåºå¦‚ä¸‹ï¼š é€šè¿‡ kubectl delete -f xxx.yaml/helm uninstall åˆ é™¤æ‰€æœ‰é™¤ç½‘ç»œä¹‹å¤–çš„å…¶ä»–åº”ç”¨é…ç½® åˆ é™¤ç½‘ç»œæ’ä»¶ å…ˆé‡å¯ä¸€éæ‰€æœ‰èŠ‚ç‚¹ï¼Œæˆ–è€…æ‰‹åŠ¨é‡ç½®æ‰€æœ‰èŠ‚ç‚¹çš„ç½‘ç»œé…ç½® å»ºè®®é‡å¯ï¼Œå› ä¸ºæˆ‘ä¸çŸ¥é“è¯¥æ€ä¹ˆæ‰‹åŠ¨é‡ç½®â€¦ è¯•äº† systemctl restart network å¹¶ä¸ä¼šæ¸…ç†æ‰€æœ‰è™šæ‹Ÿç½‘ç»œæ¥å£ã€‚ å¦‚æ­¤æ“ä½œåï¼Œå†é‡æ–°æ‰§è¡Œé›†ç¾¤å®‰è£…ï¼Œåº”è¯¥å°±æ²¡å•¥æ¯›ç—…äº†ã€‚ ","date":"2022-01-25","objectID":"/posts/kubernetes-deployemnt-using-kubeadm/:6:1","tags":["Kubernetes","äº‘åŸç”Ÿ"],"title":"éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤","uri":"/posts/kubernetes-deployemnt-using-kubeadm/"},{"categories":["æŠ€æœ¯"],"content":"6. éªŒè¯é›†ç¾¤çš„é«˜å¯ç”¨æ€§ è™½ç„¶ç½‘ç»œæ’ä»¶è¿˜æ²¡è£…å¯¼è‡´é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹éƒ½è¿˜æ²¡ readyï¼Œä½†æ˜¯æˆ‘ä»¬å·²ç»å¯ä»¥é€šè¿‡ kubectl å‘½ä»¤æ¥ç®€å•éªŒè¯é›†ç¾¤çš„é«˜å¯ç”¨æ€§äº†ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬å°†å‰é¢æ”¾ç½®åœ¨ k8s-master-0 çš„è®¤è¯æ–‡ä»¶ $HOME/.kube/config ä»¥åŠ kunbectl å®‰è£…åœ¨å¦ä¸€å°æœºå™¨ä¸Šï¼Œæ¯”å¦‚æˆ‘ç›´æ¥æ”¾æˆ‘çš„å®¿ä¸»æœºã€‚ ç„¶ååœ¨å®¿ä¸»æœºä¸Šè·‘ kubectl get node å‘½ä»¤éªŒè¯é›†ç¾¤çš„é«˜å¯ç”¨æ€§ï¼š ä¸‰ä¸ªä¸»èŠ‚ç‚¹éƒ½æ­£å¸¸è¿è¡Œæ—¶ï¼Œkubectl å‘½ä»¤ä¹Ÿæ­£å¸¸ pause æˆ–è€… stop å…¶ä¸­ä¸€ä¸ª masterï¼Œkubectl å‘½ä»¤ä»ç„¶èƒ½æ­£å¸¸è¿è¡Œ å† pause ç¬¬äºŒä¸ª masterï¼Œkubectl å‘½ä»¤åº”è¯¥å°±ä¼šå¡ä½ï¼Œå¹¶ä¸”è¶…æ—¶ï¼Œæ— æ³•ä½¿ç”¨äº† resume æ¢å¤åœæ‰çš„ä¸¤ä¸ª master ä¹‹ä¸€ï¼Œä¼šå‘ç° kubectl å‘½ä»¤åˆèƒ½æ­£å¸¸è¿è¡Œäº† åˆ°è¿™é‡Œ kubeadm çš„å·¥ä½œå°±å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥å†å®‰è£…ç½‘ç»œæ’ä»¶ï¼Œé›†ç¾¤å°±å¯ç”¨äº†ã€‚ ","date":"2022-01-25","objectID":"/posts/kubernetes-deployemnt-using-kubeadm/:7:0","tags":["Kubernetes","äº‘åŸç”Ÿ"],"title":"éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤","uri":"/posts/kubernetes-deployemnt-using-kubeadm/"},{"categories":["æŠ€æœ¯"],"content":"7. å®‰è£…ç½‘ç»œæ’ä»¶ ç¤¾åŒºæœ‰å¾ˆå¤šç§ç½‘ç»œæ’ä»¶å¯é€‰ï¼Œæ¯”è¾ƒçŸ¥åä¸”æ€§èƒ½ä¹Ÿä¸é”™çš„ï¼Œåº”è¯¥æ˜¯ Calico å’Œ Ciliumï¼Œå…¶ä¸­ Cilium ä¸»æ‰“åŸºäº eBPF çš„é«˜æ€§èƒ½ä¸é«˜å¯è§‚æµ‹æ€§ã€‚ ä¸‹é¢åˆ†åˆ«ä»‹ç»è¿™ä¸¤ä¸ªæ’ä»¶çš„å®‰è£…æ–¹æ³•ã€‚ï¼ˆæ³¨æ„åªèƒ½å®‰è£…å…¶ä¸­ä¸€ä¸ªç½‘ç»œæ’ä»¶ï¼Œä¸èƒ½é‡å¤å®‰è£…ã€‚ï¼‰ éœ€è¦æå‰åœ¨æœ¬æœºå®‰è£…å¥½ helmï¼Œæˆ‘è¿™é‡Œä½¿ç”¨å®¿ä¸»æœºï¼Œå› æ­¤åªéœ€è¦åœ¨å®¿ä¸»æœºå®‰è£…: # ä¸€è¡Œå‘½ä»¤å®‰è£…ï¼Œä¹Ÿå¯ä»¥è‡ªå·±æ‰‹åŠ¨ä¸‹è½½å®‰è£…åŒ…ï¼Œéƒ½è¡Œ curl https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3 | bash # æˆ–è€… opensuse ç›´æ¥ç”¨åŒ…ç®¡ç†å™¨å®‰è£… sudo zypper in helm ","date":"2022-01-25","objectID":"/posts/kubernetes-deployemnt-using-kubeadm/:8:0","tags":["Kubernetes","äº‘åŸç”Ÿ"],"title":"éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤","uri":"/posts/kubernetes-deployemnt-using-kubeadm/"},{"categories":["æŠ€æœ¯"],"content":"7.1 å®‰è£… Cilium å®˜æ–¹æ–‡æ¡£ï¼šhttps://docs.cilium.io/en/v1.10/gettingstarted/k8s-install-kubeadm/ cilium é€šè¿‡ eBPF æä¾›äº†é«˜æ€§èƒ½ä¸é«˜å¯è§‚æµ‹çš„ k8s é›†ç¾¤ç½‘ç»œï¼Œ å¦å¤– cilium è¿˜æä¾›äº†æ¯” kube-proxy æ›´é«˜æ•ˆçš„å®ç°ï¼Œå¯ä»¥å®Œå…¨æ›¿ä»£ kube-proxy. è¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯å…ˆä½¿ç”¨ kube-proxy æ¨¡å¼ï¼Œå…ˆç†Ÿæ‚‰ä¸‹ cilium çš„ä½¿ç”¨ï¼š helm repo add cilium https://helm.cilium.io/ helm search repo cilium/cilium -l | head helm install cilium cilium/cilium --version 1.10.4 --namespace kube-system å¯ä»¥é€šè¿‡ kubectl get pod -A æŸ¥çœ‹ cilium çš„å®‰è£…è¿›åº¦ï¼Œå½“æ‰€æœ‰ pod éƒ½ ready åï¼Œé›†ç¾¤å°± ready äº†~ cilium ä¹Ÿæä¾›äº†ä¸“ç”¨çš„å®¢æˆ·ç«¯ï¼š curl -L --remote-name-all https://github.com/cilium/cilium-cli/releases/latest/download/cilium-linux-amd64.tar.gz{,.sha256sum} sha256sum --check cilium-linux-amd64.tar.gz.sha256sum sudo tar xzvfC cilium-linux-amd64.tar.gz /usr/local/bin rm cilium-linux-amd64.tar.gz{,.sha256sum} ç„¶åä½¿ç”¨ cilium å®¢æˆ·ç«¯æ£€æŸ¥ç½‘ç»œæ’ä»¶çš„çŠ¶æ€ï¼š $ cilium status --wait /Â¯Â¯\\ /Â¯Â¯\\__/Â¯Â¯\\ Cilium: OK \\__/Â¯Â¯\\__/ Operator: OK /Â¯Â¯\\__/Â¯Â¯\\ Hubble: disabled \\__/Â¯Â¯\\__/ ClusterMesh: disabled \\__/ DaemonSet cilium Desired: 5, Ready: 5/5, Available: 5/5 Deployment cilium-operator Desired: 2, Ready: 2/2, Available: 2/2 Containers: cilium Running: 5 cilium-operator Running: 2 Cluster Pods: 2/2 managed by Cilium Image versions cilium quay.io/cilium/cilium:v1.10.4@sha256:7d354052ccf2a7445101d78cebd14444c7c40129ce7889f2f04b89374dbf8a1d: 5 cilium-operator quay.io/cilium/operator-generic:v1.10.4@sha256:c49a14e34634ff1a494c84b718641f27267fb3a0291ce3d74352b44f8a8d2f93: 2 cilium è¿˜æä¾›äº†å‘½ä»¤ï¼Œè‡ªåŠ¨åˆ›å»º pod è¿›è¡Œé›†ç¾¤ç½‘ç»œçš„è¿æ¥æ€§æµ‹è¯•ï¼š â¯ cilium connectivity test â„¹ï¸ Monitor aggregation detected, will skip some flow validation steps âœ¨ [kubernetes] Creating namespace for connectivity check... âœ¨ [kubernetes] Deploying echo-same-node service... âœ¨ [kubernetes] Deploying same-node deployment... âœ¨ [kubernetes] Deploying client deployment... âœ¨ [kubernetes] Deploying client2 deployment... âœ¨ [kubernetes] Deploying echo-other-node service... âœ¨ [kubernetes] Deploying other-node deployment... ... â„¹ï¸ Expose Relay locally with: cilium hubble enable cilium status --wait cilium hubble port-forward\u0026 ğŸƒ Running tests... ... --------------------------------------------------------------------------------------------------------------------- âœ… All 11 tests (134 actions) successful, 0 tests skipped, 0 scenarios skipped. é€šè¿‡ kubectl get po -A èƒ½è§‚å¯Ÿåˆ°ï¼Œè¿™ä¸ªæµ‹è¯•å‘½ä»¤ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª cilium-test åå­—ç©ºé—´ï¼Œå¹¶åœ¨å¯åŠ¨åˆ›å»ºè‹¥å¹² pod è¿›è¡Œè¯¦ç»†çš„æµ‹è¯•ã€‚ æ•´ä¸ªæµ‹è¯•æµç¨‹å¤§æ¦‚ä¼šæŒç»­ 5 åˆ†å¤šé’Ÿï¼Œæµ‹è¯•å®Œæˆåï¼Œç›¸å…³ Pod ä¸ä¼šè‡ªåŠ¨åˆ é™¤ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ‰‹åŠ¨åˆ é™¤ï¼š kubectl delete namespace cilium-test ","date":"2022-01-25","objectID":"/posts/kubernetes-deployemnt-using-kubeadm/:8:1","tags":["Kubernetes","äº‘åŸç”Ÿ"],"title":"éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤","uri":"/posts/kubernetes-deployemnt-using-kubeadm/"},{"categories":["æŠ€æœ¯"],"content":"7.2 å®‰è£… Calico å®˜æ–¹æ–‡æ¡£ï¼šhttps://docs.projectcalico.org/getting-started/kubernetes/self-managed-onprem/onpremises ä¹Ÿå°±ä¸¤ä¸‰è¡Œå‘½ä»¤ã€‚å®‰è£…ç¡®å®ç‰¹åˆ«ç®€å•ï¼Œæ‡’å¾—ä»‹ç»äº†ï¼Œçœ‹å®˜æ–¹æ–‡æ¡£å§ã€‚ ä½†æ˜¯å®é™…ä¸Š calico çš„ç»†èŠ‚è¿˜è›®å¤šçš„ï¼Œå»ºè®®é€šè¯»ä¸‹å®ƒçš„å®˜æ–¹æ–‡æ¡£ï¼Œäº†è§£ä¸‹ calico çš„æ¶æ„ã€‚ ","date":"2022-01-25","objectID":"/posts/kubernetes-deployemnt-using-kubeadm/:8:2","tags":["Kubernetes","äº‘åŸç”Ÿ"],"title":"éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤","uri":"/posts/kubernetes-deployemnt-using-kubeadm/"},{"categories":["æŠ€æœ¯"],"content":"8. æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ å®˜æ–¹çš„ dashboard ä¸ªäººæ„Ÿè§‰ä¸å¤ªå¥½ç”¨ï¼Œå»ºè®®ç›´æ¥åœ¨æœ¬åœ°è£…ä¸ª k9s ç”¨ï¼Œç‰¹åˆ«çˆ½ã€‚ sudo zypper in k9s ç„¶åå°±å¯ä»¥æ„‰å¿«åœ°ç©è€äº†ã€‚ ","date":"2022-01-25","objectID":"/posts/kubernetes-deployemnt-using-kubeadm/:9:0","tags":["Kubernetes","äº‘åŸç”Ÿ"],"title":"éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤","uri":"/posts/kubernetes-deployemnt-using-kubeadm/"},{"categories":["æŠ€æœ¯"],"content":"9. å®‰è£… metrics-server è¿™ä¸€æ­¥å¯èƒ½é‡åˆ°çš„é—®é¢˜ï¼šEnabling signed kubelet serving certificates å¦‚æœéœ€è¦ä½¿ç”¨ HPA ä»¥åŠç®€å•çš„é›†ç¾¤ç›‘æ§ï¼Œé‚£ä¹ˆ metrics-server æ˜¯å¿…é¡»å®‰è£…çš„ï¼Œç°åœ¨æˆ‘ä»¬å®‰è£…ä¸€ä¸‹å®ƒã€‚ é¦–å…ˆï¼Œè·‘ kubectl çš„ç›‘æ§å‘½ä»¤åº”è¯¥ä¼šæŠ¥é”™ï¼š â¯ kubectl top node error: Metrics API not available k9s é‡Œé¢åº”è¯¥ä¹Ÿçœ‹ä¸åˆ°ä»»ä½•ç›‘æ§æŒ‡æ ‡ã€‚ ç°åœ¨é€šè¿‡ helm å®‰è£…å®ƒï¼š helm repo add metrics-server https://kubernetes-sigs.github.io/metrics-server/ helm search repo metrics-server/metrics-server -l | head helm upgrade --install metrics-server metrics-server/metrics-server --version 3.5.0 --namespace kube-system metrics-server é»˜è®¤åªä¼šéƒ¨ç½²ä¸€ä¸ªå®ä¾‹ï¼Œå¦‚æœå¸Œæœ›é«˜å¯ç”¨ï¼Œè¯·å‚è€ƒå®˜æ–¹é…ç½®ï¼šmetrics-server - high-availability manifests ç­‰ metrics-server å¯åŠ¨å¥½åï¼Œå°±å¯ä»¥ä½¿ç”¨ kubectl top å‘½ä»¤å•¦ï¼š â¯ kubectl top node NAME CPU(cores) CPU% MEMORY(bytes) MEMORY% k8s-master-0 327m 16% 1465Mi 50% k8s-master-1 263m 13% 1279Mi 44% k8s-master-2 289m 14% 1282Mi 44% k8s-worker-0 62m 3% 518Mi 13% k8s-worker-1 115m 2% 659Mi 8% â¯ kubectl top pod No resources found in default namespace. â¯ kubectl top pod -A NAMESPACE NAME CPU(cores) MEMORY(bytes) kube-system cilium-45nw4 9m 135Mi kube-system cilium-5x7jf 6m 154Mi kube-system cilium-84sr2 7m 160Mi kube-system cilium-operator-78f45675-dp4b6 2m 30Mi kube-system cilium-operator-78f45675-fpm5g 1m 30Mi kube-system cilium-tkhl4 6m 141Mi kube-system cilium-zxbvm 5m 138Mi kube-system coredns-78fcd69978-dpxxk 3m 16Mi kube-system coredns-78fcd69978-ptd9p 1m 18Mi kube-system etcd-k8s-master-0 61m 88Mi kube-system etcd-k8s-master-1 50m 85Mi kube-system etcd-k8s-master-2 55m 83Mi kube-system kube-apiserver-k8s-master-0 98m 462Mi kube-system kube-apiserver-k8s-master-1 85m 468Mi kube-system kube-apiserver-k8s-master-2 85m 423Mi kube-system kube-controller-manager-k8s-master-0 22m 57Mi kube-system kube-controller-manager-k8s-master-1 2m 23Mi kube-system kube-controller-manager-k8s-master-2 2m 23Mi kube-system kube-proxy-j2s76 1m 24Mi kube-system kube-proxy-k6d6z 1m 18Mi kube-system kube-proxy-k85rx 1m 23Mi kube-system kube-proxy-pknsc 1m 20Mi kube-system kube-proxy-xsq4m 1m 15Mi kube-system kube-scheduler-k8s-master-0 3m 25Mi kube-system kube-scheduler-k8s-master-1 4m 21Mi kube-system kube-scheduler-k8s-master-2 5m 21Mi kube-system kube-vip-k8s-master-0 4m 17Mi kube-system kube-vip-k8s-master-1 2m 16Mi kube-system kube-vip-k8s-master-2 2m 17Mi kube-system metrics-server-559f85484-5b6xf 7m 27Mi ","date":"2022-01-25","objectID":"/posts/kubernetes-deployemnt-using-kubeadm/:10:0","tags":["Kubernetes","äº‘åŸç”Ÿ"],"title":"éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤","uri":"/posts/kubernetes-deployemnt-using-kubeadm/"},{"categories":["æŠ€æœ¯"],"content":"10. ä¸º etcd æ·»åŠ å®šæœŸå¤‡ä»½èƒ½åŠ› è¯·ç§»æ­¥ etcd çš„å¤‡ä»½ä¸æ¢å¤ ","date":"2022-01-25","objectID":"/posts/kubernetes-deployemnt-using-kubeadm/:11:0","tags":["Kubernetes","äº‘åŸç”Ÿ"],"title":"éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤","uri":"/posts/kubernetes-deployemnt-using-kubeadm/"},{"categories":["æŠ€æœ¯"],"content":"11. å®‰è£… Volume Provisioner åœ¨æˆ‘ä»¬å­¦ä¹ ä½¿ç”¨ Prometheus/MinIO/Tekton ç­‰æœ‰çŠ¶æ€åº”ç”¨æ—¶ï¼Œå®ƒä»¬é»˜è®¤æƒ…å†µä¸‹ä¼šé€šè¿‡ PVC å£°æ˜éœ€è¦çš„æ•°æ®å·ã€‚ ä¸ºäº†æ”¯æŒè¿™ä¸ªèƒ½åŠ›ï¼Œæˆ‘ä»¬éœ€è¦åœ¨é›†ç¾¤ä¸­éƒ¨ç½²ä¸€ä¸ª Volume Provisioner. å¯¹äºäº‘ä¸Šç¯å¢ƒï¼Œç›´æ¥æ¥å…¥äº‘æœåŠ¡å•†æä¾›çš„ Volume Provisioner å°± OK äº†ï¼Œæ–¹ä¾¿çœäº‹è€Œä¸”è¶³å¤Ÿå¯é ã€‚ è€Œå¯¹äº bare-metal ç¯å¢ƒï¼Œæ¯”è¾ƒæœ‰åçš„åº”è¯¥æ˜¯ rook-cephï¼Œä½†æ˜¯è¿™ä¸ªç©æ„éƒ¨ç½²å¤æ‚ï¼Œç»´æŠ¤éš¾åº¦åˆé«˜ï¼Œä¸é€‚åˆç”¨æ¥æµ‹è¯•å­¦ä¹ ï¼Œä¹Ÿä¸é€‚åˆç”Ÿäº§ç¯å¢ƒã€‚ å¯¹äºå¼€å‘ã€æµ‹è¯•ç¯å¢ƒï¼Œæˆ–è€…ä¸ªäººé›†ç¾¤ï¼Œå»ºè®®ä½¿ç”¨ï¼š local æ•°æ®å·ï¼Œé€‚åˆæ•°æ®å¯ä¸¢å¤±ï¼Œä¸”ä¸è¦æ±‚åˆ†å¸ƒå¼çš„åœºæ™¯ï¼Œå¦‚å¼€å‘æµ‹è¯•ç¯å¢ƒ https://github.com/kubernetes-sigs/sig-storage-local-static-provisioner https://github.com/rancher/local-path-provisioner NFS æ•°æ®å·ï¼Œé€‚åˆæ•°æ®å¯ä¸¢å¤±ï¼Œå¯¹æ€§èƒ½è¦æ±‚ä¸é«˜ï¼Œå¹¶ä¸”è¦æ±‚åˆ†å¸ƒå¼çš„åœºæ™¯ã€‚æ¯”å¦‚å¼€å‘æµ‹è¯•ç¯å¢ƒã€æˆ–è€…çº¿ä¸Šæ²¡å•¥å‹åŠ›çš„åº”ç”¨ https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner https://github.com/kubernetes-csi/csi-driver-nfs NFS æ•°æ®çš„å¯é æ€§ä¾èµ–äºå¤–éƒ¨ NFS æœåŠ¡å™¨ï¼Œä¼ä¸šé€šå¸¸ä½¿ç”¨ç¾¤æ™–ç­‰ NAS æ¥åš NFS æœåŠ¡å™¨ å¦‚æœå¤–éƒ¨ NFS æœåŠ¡å™¨å‡ºé—®é¢˜ï¼Œåº”ç”¨å°±ä¼šå´©ã€‚ ç›´æ¥ä½¿ç”¨äº‘ä¸Šçš„å¯¹è±¡å­˜å‚¨ï¼Œé€‚åˆå¸Œæœ›æ•°æ®ä¸ä¸¢å¤±ã€å¯¹æ€§èƒ½è¦æ±‚ä¸é«˜çš„åœºæ™¯ã€‚ ç›´æ¥ä½¿ç”¨ https://github.com/rclone/rclone mount æ¨¡å¼æ¥ä¿å­˜æ•°æ®ï¼Œæˆ–è€…ç›´æ¥åŒæ­¥æ–‡ä»¶å¤¹æ•°æ®åˆ°äº‘ç«¯ï¼ˆå¯èƒ½ä¼šæœ‰ä¸€å®šæ•°æ®ä¸¢å¤±ï¼‰ã€‚ ","date":"2022-01-25","objectID":"/posts/kubernetes-deployemnt-using-kubeadm/:12:0","tags":["Kubernetes","äº‘åŸç”Ÿ"],"title":"éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤","uri":"/posts/kubernetes-deployemnt-using-kubeadm/"},{"categories":["æŠ€æœ¯"],"content":" æœ¬æ–‡ç”±ä¸ªäººç¬”è®° ryan4yin/knowledge æ•´ç†è€Œæ¥ æœ¬æ–‡ä¸»è¦ä»‹ç»æˆ‘ä¸ªäººåœ¨ä½¿ç”¨ Kubernetes çš„è¿‡ç¨‹ä¸­ï¼Œæ€»ç»“å‡ºçš„ä¸€å¥—ã€ŒKubernetes é…ç½®ã€ï¼Œæ˜¯æˆ‘ä¸ªäººçš„ã€Œæœ€ä½³å®è·µã€ã€‚ å…¶ä¸­å¤§éƒ¨åˆ†å†…å®¹éƒ½ç»å†è¿‡çº¿ä¸Šç¯å¢ƒçš„è€ƒéªŒï¼Œä½†æ˜¯ä¹Ÿæœ‰å°‘éƒ¨åˆ†è¿˜åªåœ¨æˆ‘è„‘å­é‡Œæ¨¡æ‹Ÿè¿‡ï¼Œè¯·è°¨æ…å‚è€ƒã€‚ é˜…è¯»å‰çš„å‡ ä¸ªæ³¨æ„äº‹é¡¹ï¼š è¿™ä»½æ–‡æ¡£æ¯”è¾ƒé•¿ï¼Œå›Šæ‹¬äº†å¾ˆå¤šå†…å®¹ï¼Œå»ºè®®å½“æˆå‚è€ƒæ‰‹å†Œä½¿ç”¨ï¼Œå…ˆå‚ç…§ç›®å½•ç®€å•è¯»ä¸€è¯»ï¼Œæœ‰éœ€è¦å†ç»†è¯»ç›¸å…³å†…å®¹ã€‚ è¿™ä»½æ–‡æ¡£éœ€è¦ä¸€å®šçš„ Kubernetes åŸºç¡€æ‰èƒ½ç†è§£ï¼Œè€Œä¸”å¦‚æœæ²¡æœ‰è¿‡å®è·µç»éªŒçš„è¯ï¼Œçœ‹ä¸Šå»å¯èƒ½ä¼šæ¯”è¾ƒæ¯ç‡¥ã€‚ è€Œæœ‰è¿‡å®è·µç»éªŒçš„å¤§ä½¬ï¼Œå¯èƒ½ä¼šè·Ÿæˆ‘æœ‰ä¸åŒçš„è§è§£ï¼Œæ¬¢è¿å„è·¯å¤§ä½¬è¯„è®º~ æˆ‘ä¼šè§†æƒ…å†µä¸å®šæœŸæ›´æ–°è¿™ä»½æ–‡æ¡£ã€‚ ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:0:0","tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/"},{"categories":["æŠ€æœ¯"],"content":"é›¶ã€ç¤ºä¾‹ é¦–å…ˆï¼Œè¿™é‡Œç»™å‡ºä¸€äº›æœ¬æ–‡éµå®ˆçš„å‰æï¼Œè¿™äº›å‰æåªæ˜¯å¥‘åˆæˆ‘é‡åˆ°çš„åœºæ™¯ï¼Œå¯çµæ´»å˜é€šï¼š è¿™é‡Œåªè®¨è®ºæ— çŠ¶æ€æœåŠ¡ï¼Œæœ‰çŠ¶æ€æœåŠ¡ä¸åœ¨è®¨è®ºèŒƒå›´å†… æˆ‘ä»¬ä¸ä½¿ç”¨ Deployment çš„æ»šåŠ¨æ›´æ–°èƒ½åŠ›ï¼Œè€Œæ˜¯ä¸ºæ¯ä¸ªæœåŠ¡çš„æ¯ä¸ªç‰ˆæœ¬ï¼Œéƒ½åˆ›å»ºä¸åŒçš„ Deployment + HPA + PodDisruptionBudgetï¼Œè¿™æ˜¯ä¸ºäº†æ–¹ä¾¿åšé‡‘ä¸é›€/ç°åº¦å‘å¸ƒ æˆ‘ä»¬çš„æœåŠ¡å¯èƒ½ä¼šä½¿ç”¨ IngressController / Service Mesh æ¥è¿›è¡ŒæœåŠ¡çš„è´Ÿè½½å‡è¡¡ã€æµé‡åˆ‡åˆ† ä¸‹é¢å…ˆç»™å‡ºä¸€ä¸ª Deployment + HPA + PodDisruptionBudget çš„ demoï¼Œåé¢å†æ‹†å¼€è¯¦ç»†è¯´ä¸‹ï¼š apiVersion:apps/v1kind:Deploymentmetadata:name:my-app-v3namespace:prodlabels:app:my-appspec:replicas:3strategy:type:RollingUpdate# å› ä¸ºæœåŠ¡çš„æ¯ä¸ªç‰ˆæœ¬éƒ½ä½¿ç”¨å„è‡ªçš„ Deploymentï¼ŒæœåŠ¡æ›´æ–°æ—¶å…¶å®æ˜¯ç”¨ä¸ä¸Šè¿™é‡Œçš„æ»šåŠ¨æ›´æ–°ç­–ç•¥çš„# è¿™ä¸ªé…ç½®åº”è¯¥åªåœ¨ SRE æ‰‹åŠ¨ä¿®æ”¹ Deployment é…ç½®æ—¶æ‰ä¼šç”Ÿæ•ˆï¼ˆé€šå¸¸ä¸åº”è¯¥å‘ç”Ÿè¿™ç§äº‹ï¼‰rollingUpdate:maxSurge:10% # æ»šåŠ¨æ›´æ–°æ—¶ï¼Œæ¯æ¬¡æœ€å¤šæ›´æ–° 10% çš„ PodsmaxUnavailable:0# æ»šåŠ¨æ›´æ–°æ—¶ï¼Œä¸å…è®¸å‡ºç°ä¸å¯ç”¨çš„ Podsï¼Œä¹Ÿå°±æ˜¯è¯´å§‹ç»ˆè¦ç»´æŒ 3 ä¸ªå¯ç”¨å‰¯æœ¬selector:matchLabels:app:my-appversion:v3template:metadata:labels:app:my-appversion:v3spec:affinity:podAffinity:preferredDuringSchedulingIgnoredDuringExecution:# éå¼ºåˆ¶æ€§æ¡ä»¶- weight:100# weight ç”¨äºä¸ºèŠ‚ç‚¹è¯„åˆ†ï¼Œä¼šä¼˜å…ˆé€‰æ‹©è¯„åˆ†æœ€é«˜çš„èŠ‚ç‚¹ï¼ˆåªæœ‰ä¸€æ¡è§„åˆ™çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå€¼æ²¡å•¥æ„ä¹‰ï¼‰podAffinityTerm:labelSelector:matchExpressions:- key:appoperator:Invalues:- my-app- key:versionoperator:Invalues:- v3# pod å°½é‡ä½¿ç”¨åŒä¸€ç§èŠ‚ç‚¹ç±»å‹ï¼Œä¹Ÿå°±æ˜¯å°½é‡ä¿è¯èŠ‚ç‚¹çš„æ€§èƒ½ä¸€è‡´topologyKey:node.kubernetes.io/instance-typepodAntiAffinity:preferredDuringSchedulingIgnoredDuringExecution:# éå¼ºåˆ¶æ€§æ¡ä»¶- weight:100# weight ç”¨äºä¸ºèŠ‚ç‚¹è¯„åˆ†ï¼Œä¼šä¼˜å…ˆé€‰æ‹©è¯„åˆ†æœ€é«˜çš„èŠ‚ç‚¹ï¼ˆåªæœ‰ä¸€æ¡è§„åˆ™çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå€¼æ²¡å•¥æ„ä¹‰ï¼‰podAffinityTerm:labelSelector:matchExpressions:- key:appoperator:Invalues:- my-app- key:versionoperator:Invalues:- v3# å°† pod å°½é‡æ‰“æ•£åœ¨å¤šä¸ªå¯ç”¨åŒºtopologyKey:topology.kubernetes.io/zonerequiredDuringSchedulingIgnoredDuringExecution:# å¼ºåˆ¶æ€§è¦æ±‚ï¼ˆè¿™ä¸ªå»ºè®®æŒ‰éœ€æ·»åŠ ï¼‰# æ³¨æ„è¿™ä¸ªæ²¡æœ‰ weightsï¼Œå¿…é¡»æ»¡è¶³åˆ—è¡¨ä¸­çš„æ‰€æœ‰æ¡ä»¶- labelSelector:matchExpressions:- key:appoperator:Invalues:- my-app- key:versionoperator:Invalues:- v3# Pod å¿…é¡»è¿è¡Œåœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸ŠtopologyKey:kubernetes.io/hostnamesecurityContext:# runAsUser: 1000 # è®¾å®šç”¨æˆ·# runAsGroup: 1000 # è®¾å®šç”¨æˆ·ç»„runAsNonRoot:true# Pod å¿…é¡»ä»¥é root ç”¨æˆ·è¿è¡ŒseccompProfile:# security compute modetype:RuntimeDefaultnodeSelector:eks.amazonaws.com/nodegroup:common # ä½¿ç”¨ä¸“ç”¨èŠ‚ç‚¹ç»„ï¼Œå¦‚æœå¸Œæœ›ä½¿ç”¨å¤šä¸ªèŠ‚ç‚¹ç»„ï¼Œå¯æ”¹ç”¨èŠ‚ç‚¹äº²å’Œæ€§volumes:- name:tmp-diremptyDir:{}containers:- name:my-app-v3image:my-app:v3 # å»ºè®®ä½¿ç”¨ç§æœ‰é•œåƒä»“åº“ï¼Œè§„é¿ docker.io çš„é•œåƒæ‹‰å–é™åˆ¶imagePullPolicy:IfNotPresentvolumeMounts:- mountPath:/tmpname:tmp-dirlifecycle:preStop:exec:command:- /bin/sh- -c- \"while [ $(netstat -plunt | grep tcp | wc -l | xargs) -ne 0 ]; do sleep 1; done\"resources:# èµ„æºè¯·æ±‚ä¸é™åˆ¶# å¯¹äºæ ¸å¿ƒæœåŠ¡ï¼Œå»ºè®®è®¾ç½® requests = limitsï¼Œé¿å…èµ„æºç«äº‰requests:# HPA ä¼šä½¿ç”¨ requests è®¡ç®—èµ„æºåˆ©ç”¨ç‡# å»ºè®®å°† requests è®¾ä¸ºæœåŠ¡æ­£å¸¸çŠ¶æ€ä¸‹çš„ CPU ä½¿ç”¨ç‡ï¼ŒHPA çš„ç›®å‰æŒ‡æ ‡è®¾ä¸º 80%# æ‰€æœ‰å®¹å™¨çš„ requests æ€»é‡ä¸å»ºè®®ä¸º 2c/4G 4c/8G ç­‰å¸¸è§å€¼ï¼Œå› ä¸ºèŠ‚ç‚¹é€šå¸¸ä¹Ÿæ˜¯è¿™ä¸ªé…ç½®ï¼Œè¿™ä¼šå¯¼è‡´ Pod åªèƒ½è°ƒåº¦åˆ°æ›´å¤§çš„èŠ‚ç‚¹ä¸Šï¼Œé€‚å½“è°ƒå° requests ç­‰æ‰©å……å¯ç”¨çš„èŠ‚ç‚¹ç±»å‹ï¼Œä»è€Œæ‰©å……èŠ‚ç‚¹æ± ã€‚ cpu:1000mmemory:1Gilimits:# limits - requests ä¸ºå…è®¸è¶…å–çš„èµ„æºé‡ï¼Œå»ºè®®ä¸º requests çš„ 1 åˆ° 2 å€ï¼Œé…Œæƒ…é…ç½®ã€‚cpu:1000mmemory:1GisecurityContext:# å°†å®¹å™¨å±‚è®¾ä¸ºåªè¯»ï¼Œé˜²æ­¢å®¹å™¨æ–‡ä»¶è¢«ç¯¡æ”¹## å¦‚æœéœ€è¦å†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼Œå»ºè®®é¢å¤–æŒ‚è½½ emptyDir æ¥æä¾›å¯è¯»å†™çš„æ•°æ®å·readOnlyRootFilesystem:true# ç¦æ­¢ Pod åšä»»ä½•æƒé™æå‡allowPrivilegeEscalation:falsecapabilities:# drop ALL çš„æƒé™æ¯”è¾ƒä¸¥æ ¼ï¼Œå¯æŒ‰éœ€ä¿®æ”¹drop:- ALLstartupProbe:# è¦æ±‚ kubernetes 1.18+httpGet:path:/actuator/health # ç›´æ¥ä½¿ç”¨å¥åº·æ£€æŸ¥æ¥å£å³å¯port:8080periodSeconds:5timeoutSeconds:1failureThreshold:20# æœ€å¤šæä¾›ç»™æœåŠ¡ 5s * 20 çš„å¯åŠ¨æ—¶é—´successThreshold:1livenessProbe:httpGet:path:/actuator/health # spring çš„é€šç”¨å¥åº·æ£€æŸ¥è·¯å¾„port:8080periodSeconds:5timeoutSeconds:1failureThreshold:5successThreshold:1# Readiness probes are very important for a RollingUpdate to work properly,readinessProbe:httpGet:path:/actuator/health # ç®€å•èµ·è§å¯ç›´æ¥ä½¿ç”¨ livenessProbe ç›¸åŒçš„æ¥å£ï¼Œå½“ç„¶ä¹Ÿå¯é¢å¤–å®šä¹‰port:8080periodSeconds:5timeoutSeconds:1failureThreshold:5successThreshold:1---apiVersion:autoscaling/v2beta2kind:HorizontalPodAutoscalermetadata:labels:app:my-appname:my-app-v3namespace:prodspec:scaleTargetRef:apiVersion:apps/v1kind:Deploymentname:my-app-v3maxReplicas:50minReplicas:3metrics:- type:Resourceresource:name:cputarget:type:UtilizationaverageUtilization:70---apiVersion:policy/v1kind:PodDisruptionBudgetmetadata:name:my-app-v3namespace:prodlabels:app:my-appspec:minAvailable:75%selector:matchLabels:app:my-appversion:v3 ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:1:0","tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/"},{"categories":["æŠ€æœ¯"],"content":"ä¸€ã€ä¼˜é›…åœæ­¢ï¼ˆGracful Shutdownï¼‰ä¸ 502/504 æŠ¥é”™ å¦‚æœ Pod æ­£åœ¨å¤„ç†å¤§é‡è¯·æ±‚ï¼ˆæ¯”å¦‚ 1000 QPS+ï¼‰æ—¶ï¼Œå› ä¸ºèŠ‚ç‚¹æ•…éšœæˆ–ã€Œç«ä»·èŠ‚ç‚¹ã€è¢«å›æ”¶ç­‰åŸå› è¢«é‡æ–°è°ƒåº¦ï¼Œ ä½ å¯èƒ½ä¼šè§‚å¯Ÿåˆ°åœ¨å®¹å™¨è¢« terminate çš„ä¸€æ®µæ—¶é—´å†…å‡ºç°å°‘é‡ 502/504ã€‚ ä¸ºäº†ææ¸…æ¥šè¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦å…ˆç†è§£æ¸…æ¥š terminate ä¸€ä¸ª Pod çš„æµç¨‹ï¼š Pod çš„çŠ¶æ€è¢«è®¾ä¸ºã€ŒTerminatingã€ï¼Œï¼ˆå‡ ä¹ï¼‰åŒæ—¶è¯¥ Pod è¢«ä»æ‰€æœ‰å…³è”çš„ Service Endpoints ä¸­ç§»é™¤ preStop é’©å­è¢«æ‰§è¡Œï¼Œå®ƒå¯ä»¥æ˜¯ä¸€ä¸ªå‘½ä»¤ï¼Œæˆ–è€…ä¸€ä¸ªå¯¹ Pod ä¸­å®¹å™¨çš„ http è°ƒç”¨ å¦‚æœä½ çš„ç¨‹åºåœ¨æ”¶åˆ° SIGTERM ä¿¡å·æ—¶ï¼Œæ— æ³•ä¼˜é›…é€€å‡ºï¼Œå°±å¯ä»¥è€ƒè™‘ä½¿ç”¨ preStop å¦‚æœè®©ç¨‹åºæœ¬èº«æ”¯æŒä¼˜é›…é€€å‡ºæ¯”è¾ƒéº»çƒ¦çš„è¯ï¼Œç”¨ preStop å®ç°ä¼˜é›…é€€å‡ºæ˜¯ä¸€ä¸ªéå¸¸å¥½çš„æ–¹å¼ å°† SIGTERM å‘é€ç»™ Pod ä¸­çš„æ‰€æœ‰å®¹å™¨ ç»§ç»­ç­‰å¾…ï¼Œç›´åˆ°è¶…è¿‡ spec.terminationGracePeriodSeconds è®¾å®šå¥½çš„æ—¶é—´ï¼Œè¿™ä¸ªå€¼é»˜è®¤ä¸º 30s éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªä¼˜é›…é€€å‡ºçš„ç­‰å¾…è®¡æ—¶æ˜¯ä¸ preStop åŒæ­¥å¼€å§‹çš„ï¼è€Œä¸”å®ƒä¹Ÿä¸ä¼šç­‰å¾… preStop ç»“æŸï¼ å¦‚æœè¶…è¿‡äº† spec.terminationGracePeriodSeconds å®¹å™¨ä»ç„¶æ²¡æœ‰åœæ­¢ï¼Œk8s å°†ä¼šå‘é€ SIGKILL ä¿¡å·ç»™å®¹å™¨ è¿›ç¨‹å…¨éƒ¨ç»ˆæ­¢åï¼Œæ•´ä¸ª Pod å®Œå…¨è¢«æ¸…ç†æ‰ æ³¨æ„ï¼š1 å’Œ 2 ä¸¤ä¸ªå·¥ä½œæ˜¯å¼‚æ­¥å‘ç”Ÿçš„ï¼Œæ‰€ä»¥å¯èƒ½ä¼šå‡ºç°ã€ŒPod è¿˜åœ¨ Service Endpoints ä¸­ï¼Œä½†æ˜¯ preStop å·²ç»æ‰§è¡Œäº†ã€çš„æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘åˆ°è¿™ç§çŠ¶å†µçš„å‘ç”Ÿã€‚ äº†è§£äº†ä¸Šé¢çš„æµç¨‹åï¼Œæˆ‘ä»¬å°±èƒ½åˆ†æå‡ºä¸¤ç§é”™è¯¯ç å‡ºç°çš„åŸå› ï¼š 502ï¼šåº”ç”¨ç¨‹åºåœ¨æ”¶åˆ° SIGTERM ä¿¡å·åç›´æ¥ç»ˆæ­¢äº†è¿è¡Œï¼Œå¯¼è‡´éƒ¨åˆ†è¿˜æ²¡æœ‰è¢«å¤„ç†å®Œçš„è¯·æ±‚ç›´æ¥ä¸­æ–­ï¼Œä»£ç†å±‚è¿”å› 502 è¡¨ç¤ºè¿™ç§æƒ…å†µ 504ï¼šService Endpoints ç§»é™¤ä¸å¤ŸåŠæ—¶ï¼Œåœ¨ Pod å·²ç»è¢«ç»ˆæ­¢åï¼Œä»ç„¶æœ‰ä¸ªåˆ«è¯·æ±‚è¢«è·¯ç”±åˆ°äº†è¯¥ Podï¼Œå¾—ä¸åˆ°å“åº”å¯¼è‡´ 504 é€šå¸¸çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œåœ¨ Pod çš„ preStop æ­¥éª¤åŠ ä¸€ä¸ª 15s çš„ç­‰å¾…æ—¶é—´ã€‚ å…¶åŸç†æ˜¯ï¼šåœ¨ Pod å¤„ç† terminating çŠ¶æ€çš„æ—¶å€™ï¼Œå°±ä¼šè¢«ä» Service Endpoints ä¸­ç§»é™¤ï¼Œä¹Ÿå°±ä¸ä¼šå†æœ‰æ–°çš„è¯·æ±‚è¿‡æ¥äº†ã€‚ åœ¨ preStop ç­‰å¾… 15sï¼ŒåŸºæœ¬å°±èƒ½ä¿è¯æ‰€æœ‰çš„è¯·æ±‚éƒ½åœ¨å®¹å™¨æ­»æ‰ä¹‹å‰è¢«å¤„ç†å®Œæˆï¼ˆä¸€èˆ¬æ¥è¯´ï¼Œç»å¤§éƒ¨åˆ†è¯·æ±‚çš„å¤„ç†æ—¶é—´éƒ½åœ¨ 300ms ä»¥å†…å§ï¼‰ã€‚ ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹å¦‚ä¸‹ï¼Œå®ƒä½¿ Pod è¢«ç»ˆæ­¢æ—¶ï¼Œæ€»æ˜¯å…ˆç­‰å¾… 15sï¼Œå†å‘é€ SIGTERM ä¿¡å·ç»™å®¹å™¨ï¼š containers:- name:my-app# æ·»åŠ ä¸‹é¢è¿™éƒ¨åˆ†lifecycle:preStop:exec:command:- /bin/sleep- \"15\" æ›´å¥½çš„è§£å†³åŠæ³•ï¼Œæ˜¯ç›´æ¥ç­‰å¾…æ‰€æœ‰ tcp è¿æ¥éƒ½å…³é—­ï¼ˆéœ€è¦é•œåƒä¸­æœ‰ netstatï¼‰ï¼š containers:- name:my-app# æ·»åŠ ä¸‹é¢è¿™éƒ¨åˆ†lifecycle:preStop:exec:command:- /bin/sh- -c- \"while [ $(netstat -plunt | grep tcp | wc -l | xargs) -ne 0 ]; do sleep 1; done\" ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:2:0","tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/"},{"categories":["æŠ€æœ¯"],"content":"å¦‚æœæˆ‘çš„æœåŠ¡è¿˜ä½¿ç”¨äº† Sidecar ä»£ç†ç½‘ç»œè¯·æ±‚ï¼Œè¯¥æ€ä¹ˆå¤„ç†ï¼Ÿ ä»¥æœåŠ¡ç½‘æ ¼ Istio ä¸ºä¾‹ï¼Œåœ¨ Envoy ä»£ç†äº† Pod æµé‡çš„æƒ…å†µä¸‹ï¼Œ502/504 çš„é—®é¢˜ä¼šå˜å¾—æ›´å¤æ‚ä¸€ç‚¹â€”â€”è¿˜éœ€è¦è€ƒè™‘ Sidecar ä¸ä¸»å®¹å™¨çš„å…³é—­é¡ºåºï¼š å¦‚æœåœ¨ Envoy å·²å…³é—­åï¼Œæœ‰æ–°çš„è¯·æ±‚å†è¿›æ¥ï¼Œå°†ä¼šå¯¼è‡´ 504ï¼ˆæ²¡äººå“åº”è¿™ä¸ªè¯·æ±‚äº†ï¼‰ æ‰€ä»¥ Envoy æœ€å¥½åœ¨ Terminating è‡³å°‘ 3s åæ‰èƒ½å…³ï¼Œç¡®ä¿ Istio ç½‘æ ¼é…ç½®å·²å®Œå…¨æ›´æ–° å¦‚æœåœ¨ Envoy è¿˜æ²¡åœæ­¢æ—¶ï¼Œä¸»å®¹å™¨å…ˆå…³é—­ï¼Œç„¶ååˆæœ‰æ–°çš„è¯·æ±‚å†è¿›æ¥ï¼ŒEnvoy å°†å› ä¸ºæ— æ³•è¿æ¥åˆ° upstream å¯¼è‡´ 503 æ‰€ä»¥ä¸»å®¹å™¨ä¹Ÿæœ€å¥½åœ¨ Terminating è‡³å°‘ 3s åï¼Œæ‰èƒ½å…³é—­ã€‚ å¦‚æœä¸»å®¹å™¨å¤„ç†è¿˜æœªå¤„ç†å®Œé—ç•™è¯·æ±‚æ—¶ï¼ŒEnvoy æˆ–è€…ä¸»å®¹å™¨çš„å…¶ä¸­ä¸€ä¸ªåœæ­¢äº†ï¼Œä¼šå› ä¸º tcp è¿æ¥ç›´æ¥æ–­å¼€è¿æ¥å¯¼è‡´ 502 å› æ­¤ Envoy å¿…é¡»åœ¨ä¸»å®¹å™¨å¤„ç†å®Œé—ç•™è¯·æ±‚åï¼ˆå³æ²¡æœ‰ tcp è¿æ¥æ—¶ï¼‰ï¼Œæ‰èƒ½å…³é—­ æ‰€ä»¥æ€»ç»“ä¸‹ï¼šEnvoy åŠä¸»å®¹å™¨çš„ preStop éƒ½è‡³å°‘å¾—è®¾æˆ 3sï¼Œå¹¶ä¸”åœ¨ã€Œæ²¡æœ‰ tcp è¿æ¥ã€æ—¶ï¼Œæ‰èƒ½å…³é—­ï¼Œé¿å…å‡ºç° 502/503/504. ä¸»å®¹å™¨çš„ä¿®æ”¹æ–¹æ³•åœ¨å‰æ–‡ä¸­å·²ç»å†™è¿‡äº†ï¼Œä¸‹é¢ä»‹ç»ä¸‹ Envoy çš„ä¿®æ”¹æ–¹æ³•ã€‚ å’Œä¸»å®¹å™¨ä¸€æ ·ï¼ŒEnvoy ä¹Ÿèƒ½ç›´æ¥åŠ  preStopï¼Œä¿®æ”¹ istio-sidecar-injector è¿™ä¸ª configmapï¼Œåœ¨ sidecar é‡Œæ·»åŠ  preStop sleep å‘½ä»¤: containers:- name:istio-proxy# æ·»åŠ ä¸‹é¢è¿™éƒ¨åˆ†lifecycle:preStop:exec:command:- /bin/sh- -c- \"while [ $(netstat -plunt | grep tcp | grep -v envoy | wc -l | xargs) -ne 0 ]; do sleep 1; done\" ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:2:1","tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/"},{"categories":["æŠ€æœ¯"],"content":"å‚è€ƒ Kubernetes best practices: terminating with grace Graceful shutdown in Kubernetes is not always trivial ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:2:2","tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/"},{"categories":["æŠ€æœ¯"],"content":"äºŒã€æœåŠ¡çš„ä¼¸ç¼©é…ç½® - HPA Kubernetes å®˜æ–¹ä¸»è¦æ”¯æŒåŸºäº Pod CPU çš„ä¼¸ç¼©ï¼Œè¿™æ˜¯åº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ä¼¸ç¼©æŒ‡æ ‡ï¼Œéœ€è¦éƒ¨ç½² metrics-server æ‰å¯ä½¿ç”¨ã€‚ å…ˆå›é¡¾ä¸‹å‰é¢ç»™å‡ºçš„ï¼ŒåŸºäº Pod CPU ä½¿ç”¨ç‡è¿›è¡Œä¼¸ç¼©çš„ç¤ºä¾‹ï¼š apiVersion:autoscaling/v2beta2 # k8s 1.23+ æ­¤ API å·²ç» GAkind:HorizontalPodAutoscalermetadata:labels:app:my-appname:my-app-v3namespace:prodspec:scaleTargetRef:apiVersion:apps/v1kind:Deploymentname:my-app-v3maxReplicas:50minReplicas:3metrics:- type:Resourceresource:name:cputarget:type:UtilizationaverageUtilization:70 ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:3:0","tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/"},{"categories":["æŠ€æœ¯"],"content":"1. å½“å‰æŒ‡æ ‡å€¼çš„è®¡ç®—æ–¹å¼ æå‰æ€»ç»“ï¼šæ¯ä¸ª Pod çš„æŒ‡æ ‡æ˜¯å…¶ä¸­æ‰€æœ‰å®¹å™¨æŒ‡æ ‡ä¹‹å’Œï¼Œå¦‚æœè®¡ç®—ç™¾åˆ†æ¯”ï¼Œå°±å†é™¤ä»¥ Pod çš„ requests. HPA é»˜è®¤ä½¿ç”¨ Pod çš„å½“å‰æŒ‡æ ‡è¿›è¡Œè®¡ç®—ï¼Œä»¥ CPU ä½¿ç”¨ç‡ä¸ºä¾‹ï¼Œå…¶è®¡ç®—å…¬å¼ä¸ºï¼š ã€ŒPod çš„ CPU ä½¿ç”¨ç‡ã€= 100% * ã€Œæ‰€æœ‰ Container çš„ CPU ç”¨é‡ä¹‹å’Œã€/ã€Œæ‰€æœ‰ Container çš„ CPU requests ä¹‹å’Œã€ æ³¨æ„åˆ†æ¯æ˜¯æ€»çš„ requests é‡ï¼Œè€Œä¸æ˜¯ limits. 1.1 å­˜åœ¨çš„é—®é¢˜ä¸è§£å†³æ–¹æ³• åœ¨ Pod åªæœ‰ä¸€ä¸ªå®¹å™¨æ—¶è¿™æ²¡å•¥é—®é¢˜ï¼Œä½†æ˜¯å½“ Pod æ³¨å…¥äº† envoy ç­‰ sidecar æ—¶ï¼Œè¿™å°±ä¼šæœ‰é—®é¢˜äº†ã€‚ å› ä¸º Istio çš„ Sidecar requests é»˜è®¤ä¸º 100m ä¹Ÿå°±æ˜¯ 0.1 æ ¸ã€‚ åœ¨æœª tuning çš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡è´Ÿè½½ä¸€é«˜ï¼Œsidecar çš„å®é™…ç”¨é‡å¾ˆå®¹æ˜“å°±èƒ½æ¶¨åˆ° 0.2-0.4 æ ¸ã€‚ æŠŠè¿™ä¸¤ä¸ªå€¼ä»£å…¥å‰é¢çš„å…¬å¼ï¼Œä¼šå‘ç° å¯¹äº QPS è¾ƒé«˜çš„æœåŠ¡ï¼Œæ·»åŠ  Sidecar åï¼Œã€ŒPod çš„ CPU åˆ©ç”¨ç‡ã€å¯èƒ½ä¼šé«˜äºã€Œåº”ç”¨å®¹å™¨çš„ CPU åˆ©ç”¨ç‡ã€ï¼Œé€ æˆä¸å¿…è¦çš„æ‰©å®¹ã€‚ å³ä½¿æ”¹ç”¨ã€ŒPod çš„ CPU ç”¨é‡ã€è€Œéç™¾åˆ†æ¯”æ¥è¿›è¡Œæ‰©ç¼©å®¹ï¼Œä¹Ÿè§£å†³ä¸äº†è¿™ä¸ªé—®é¢˜ã€‚ è§£å†³æ–¹æ³•ï¼š æ–¹æ³•ä¸€ï¼šé’ˆå¯¹æ¯ä¸ªæœåŠ¡çš„ CPU ä½¿ç”¨æƒ…å†µï¼Œä¸ºæ¯ä¸ªæœåŠ¡çš„ sidecar è®¾ç½®ä¸åŒçš„ requests/limits. æ„Ÿè§‰è¿™ä¸ªæ–¹æ¡ˆå¤ªéº»çƒ¦äº† æ–¹æ³•äºŒï¼šä½¿ç”¨ KEDA ç­‰ç¬¬ä¸‰æ–¹ç»„ä»¶ï¼Œè·å–åˆ°åº”ç”¨ç¨‹åºçš„ CPU åˆ©ç”¨ç‡ï¼ˆæ’é™¤æ‰ Sidecarï¼‰ï¼Œä½¿ç”¨å®ƒè¿›è¡Œæ‰©ç¼©å®¹ æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ k8s 1.20 æä¾›çš„ alpha ç‰¹æ€§ï¼šContainer Resourse Metrics. ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:3:1","tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/"},{"categories":["æŠ€æœ¯"],"content":"2. HPA çš„æ‰©ç¼©å®¹ç®—æ³• HPA ä»€ä¹ˆæ—¶å€™ä¼šæ‰©å®¹ï¼Œè¿™ä¸€ç‚¹æ˜¯å¾ˆå¥½ç†è§£çš„ã€‚ä½†æ˜¯ HPA çš„ç¼©å®¹ç­–ç•¥ï¼Œä¼šæœ‰äº›è¿·æƒ‘ï¼Œä¸‹é¢ç®€å•åˆ†æä¸‹ã€‚ HPA çš„ã€Œç›®æ ‡æŒ‡æ ‡ã€å¯ä»¥ä½¿ç”¨ä¸¤ç§å½¢å¼ï¼šç»å¯¹åº¦é‡æŒ‡æ ‡å’Œèµ„æºåˆ©ç”¨ç‡ã€‚ ç»å¯¹åº¦é‡æŒ‡æ ‡ï¼šæ¯”å¦‚ CPUï¼Œå°±æ˜¯æŒ‡ CPU çš„ä½¿ç”¨é‡ èµ„æºåˆ©ç”¨ç‡ï¼ˆèµ„æºä½¿ç”¨é‡/èµ„æºè¯·æ±‚ * 100%ï¼‰ï¼šåœ¨ Pod è®¾ç½®äº†èµ„æºè¯·æ±‚æ—¶ï¼Œå¯ä»¥ä½¿ç”¨èµ„æºåˆ©ç”¨ç‡è¿›è¡Œ Pod ä¼¸ç¼© HPA çš„ã€Œå½“å‰æŒ‡æ ‡ã€æ˜¯ä¸€æ®µæ—¶é—´å†…æ‰€æœ‰ Pods çš„å¹³å‡å€¼ï¼Œä¸æ˜¯å³°å€¼ã€‚ HPA çš„æ‰©ç¼©å®¹ç®—æ³•ä¸ºï¼š æœŸæœ›å‰¯æœ¬æ•° = ceil[å½“å‰å‰¯æœ¬æ•° * ( å½“å‰æŒ‡æ ‡ / ç›®æ ‡æŒ‡æ ‡ )] ä»ä¸Šé¢çš„å‚æ•°å¯ä»¥çœ‹åˆ°ï¼š åªè¦ã€Œå½“å‰æŒ‡æ ‡ã€è¶…è¿‡äº†ç›®æ ‡æŒ‡æ ‡ï¼Œå°±ä¸€å®šä¼šå‘ç”Ÿæ‰©å®¹ã€‚ å½“å‰æŒ‡æ ‡ / ç›®æ ‡æŒ‡æ ‡è¦å°åˆ°ä¸€å®šçš„ç¨‹åº¦ï¼Œæ‰ä¼šè§¦å‘ç¼©å®¹ã€‚ æ¯”å¦‚åŒå‰¯æœ¬çš„æƒ…å†µä¸‹ï¼Œä¸Šè¿°æ¯”å€¼è¦å°äºç­‰äº 1/2ï¼Œæ‰ä¼šç¼©å®¹åˆ°å•å‰¯æœ¬ã€‚ ä¸‰å‰¯æœ¬çš„æƒ…å†µä¸‹ï¼Œä¸Šè¿°æ¯”å€¼çš„ä¸´ç•Œç‚¹æ˜¯ 2/3ã€‚ äº”å‰¯æœ¬æ—¶ä¸´ç•Œå€¼æ˜¯ 4/5ï¼Œ100å‰¯æœ¬æ—¶ä¸´ç•Œå€¼æ˜¯ 99/100ï¼Œä¾æ­¤ç±»æ¨ã€‚ å¦‚æœ å½“å‰æŒ‡æ ‡ / ç›®æ ‡æŒ‡æ ‡ ä» 1 é™åˆ° 0.5ï¼Œå‰¯æœ¬çš„æ•°é‡å°†ä¼šå‡åŠã€‚ï¼ˆè™½ç„¶è¯´å‰¯æœ¬æ•°è¶Šå¤šï¼Œå‘ç”Ÿè¿™ä¹ˆå¤§å˜åŒ–çš„å¯èƒ½æ€§å°±è¶Šå°ã€‚ï¼‰ å½“å‰å‰¯æœ¬æ•° / ç›®æ ‡æŒ‡æ ‡çš„å€¼è¶Šå¤§ï¼Œã€Œå½“å‰æŒ‡æ ‡ã€çš„æ³¢åŠ¨å¯¹ã€ŒæœŸæœ›å‰¯æœ¬æ•°ã€çš„å½±å“å°±è¶Šå¤§ã€‚ ä¸ºäº†é˜²æ­¢æ‰©ç¼©å®¹è¿‡äºæ•æ„Ÿï¼ŒHPA æœ‰å‡ ä¸ªç›¸å…³å‚æ•°ï¼š Hardcoded å‚æ•° HPA Loop å»¶æ—¶ï¼šé»˜è®¤ 15 ç§’ï¼Œæ¯ 15 ç§’é’Ÿè¿›è¡Œä¸€æ¬¡ HPA æ‰«æã€‚ ç¼©å®¹å†·å´æ—¶é—´ï¼šé»˜è®¤ 5 åˆ†é’Ÿã€‚ å¯¹äº K8s 1.18+ï¼ŒHPA é€šè¿‡ spec.behavior æä¾›äº†å¤šç§æ§åˆ¶æ‰©ç¼©å®¹è¡Œä¸ºçš„å‚æ•°ï¼Œåé¢ä¼šå…·ä½“ä»‹ç»ã€‚ ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:3:2","tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/"},{"categories":["æŠ€æœ¯"],"content":"3. HPA çš„æœŸæœ›å€¼è®¾æˆå¤šå°‘åˆé€‚ è¿™ä¸ªéœ€è¦é’ˆå¯¹æ¯ä¸ªæœåŠ¡çš„å…·ä½“æƒ…å†µï¼Œå…·ä½“åˆ†æã€‚ ä»¥æœ€å¸¸ç”¨çš„æŒ‰ CPU å€¼ä¼¸ç¼©ä¸ºä¾‹ï¼Œ æ ¸å¿ƒæœåŠ¡ requests/limits å€¼: å»ºè®®è®¾æˆç›¸ç­‰çš„ï¼Œä¿è¯æœåŠ¡è´¨é‡ç­‰çº§ä¸º Guaranteed éœ€è¦æ³¨æ„ CPU è·Ÿ Memory çš„ limits é™åˆ¶ç­–ç•¥æ˜¯ä¸åŒçš„ï¼ŒCPU æ˜¯çœŸæ­£åœ°é™åˆ¶äº†ä¸Šé™ï¼Œè€Œ Memory æ˜¯ç”¨è¶…äº†å°±å¹²æ‰å®¹å™¨ï¼ˆOOMKilledï¼‰ k8s ä¸€ç›´ä½¿ç”¨ cgroups v1 (cpu_shares/memory.limit_in_bytes)æ¥é™åˆ¶ cpu/memoryï¼Œä½†æ˜¯å¯¹äº Guaranteed çš„ Pods è€Œè¨€ï¼Œå†…å­˜å¹¶ä¸èƒ½å®Œå…¨é¢„ç•™ï¼Œèµ„æºç«äº‰æ€»æ˜¯æœ‰å¯èƒ½å‘ç”Ÿçš„ã€‚1.22 æœ‰ alpha ç‰¹æ€§æ”¹ç”¨ cgroups v2ï¼Œå¯ä»¥å…³æ³¨ä¸‹ã€‚ HPA: ä¸€èˆ¬æ¥è¯´ï¼ŒæœŸæœ›å€¼è®¾ä¸º 60% åˆ° 70% å¯èƒ½æ˜¯æ¯”è¾ƒåˆé€‚çš„ï¼Œæœ€å°å‰¯æœ¬æ•°å»ºè®®è®¾ä¸º 2 - 5. ï¼ˆä»…ä¾›å‚è€ƒï¼‰ PodDisruptionBudget: å»ºè®®æŒ‰æœåŠ¡çš„å¥å£®æ€§ä¸ HPA æœŸæœ›å€¼ï¼Œæ¥è®¾ç½® PDBï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»ï¼Œè¿™é‡Œå°±å…ˆç•¥è¿‡äº† éæ ¸å¿ƒæœåŠ¡ requests/limits å€¼: å»ºè®® requests è®¾ä¸º limits çš„ 0.6 - 0.9 å€ï¼ˆä»…ä¾›å‚è€ƒï¼‰ï¼Œå¯¹åº”çš„æœåŠ¡è´¨é‡ç­‰çº§ä¸º Burstable ä¹Ÿå°±æ˜¯è¶…å–äº†èµ„æºï¼Œè¿™æ ·åšä¸»è¦çš„è€ƒé‡ç‚¹æ˜¯ï¼Œå¾ˆå¤šéæ ¸å¿ƒæœåŠ¡è´Ÿè½½éƒ½å¾ˆä½ï¼Œæ ¹æœ¬è·‘ä¸åˆ° limits è¿™ä¹ˆé«˜ï¼Œé™ä½ requests å¯ä»¥æé«˜é›†ç¾¤èµ„æºåˆ©ç”¨ç‡ï¼Œä¹Ÿä¸ä¼šæŸå®³æœåŠ¡ç¨³å®šæ€§ã€‚ HPA: å› ä¸º requests é™ä½äº†ï¼Œè€Œ HPA æ˜¯ä»¥ requests ä¸º 100% è®¡ç®—ä½¿ç”¨ç‡çš„ï¼Œæˆ‘ä»¬å¯ä»¥æé«˜ HPA çš„æœŸæœ›å€¼ï¼ˆå¦‚æœä½¿ç”¨ç™¾åˆ†æ¯”ä¸ºæœŸæœ›å€¼çš„è¯ï¼‰ï¼Œæ¯”å¦‚ 80% ~ 90%ï¼Œæœ€å°å‰¯æœ¬æ•°å»ºè®®è®¾ä¸º 1 - 3. ï¼ˆä»…ä¾›å‚è€ƒï¼‰ PodDisruptionBudget: éæ ¸å¿ƒæœåŠ¡å˜›ï¼Œä¿è¯æœ€å°‘å‰¯æœ¬æ•°ä¸º 1 å°±è¡Œäº†ã€‚ ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:3:3","tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/"},{"categories":["æŠ€æœ¯"],"content":"4. HPA çš„å¸¸è§é—®é¢˜ 4.1. Pod æ‰©å®¹ - é¢„çƒ­é™·é˜± é¢„çƒ­ï¼šJava/C# è¿™ç±»è¿è¡Œåœ¨è™šæ‹Ÿæœºä¸Šçš„è¯­è¨€ï¼Œç¬¬ä¸€æ¬¡ä½¿ç”¨åˆ°æŸäº›åŠŸèƒ½æ—¶ï¼Œå¾€å¾€éœ€è¦åˆå§‹åŒ–ä¸€äº›èµ„æºï¼Œä¾‹å¦‚ã€ŒJIT å³æ—¶ç¼–è¯‘ã€ã€‚ å¦‚æœä»£ç é‡Œè¿˜åº”ç”¨äº†åŠ¨æ€ç±»åŠ è½½ä¹‹ç±»çš„åŠŸèƒ½ï¼Œå°±å¾ˆå¯èƒ½å¯¼è‡´å¾®æœåŠ¡æŸäº› API ç¬¬ä¸€æ¬¡è¢«è°ƒç”¨æ—¶ï¼Œå“åº”ç‰¹åˆ«æ…¢ï¼ˆè¦åŠ¨æ€ç¼–è¯‘ classï¼‰ã€‚ å› æ­¤ Pod åœ¨æä¾›æœåŠ¡å‰ï¼Œéœ€è¦æå‰ã€Œé¢„çƒ­ï¼ˆslow_startï¼‰ã€ä¸€æ¬¡è¿™äº›æ¥å£ï¼Œå°†éœ€è¦ç”¨åˆ°çš„èµ„æºæå‰åˆå§‹åŒ–å¥½ã€‚ åœ¨è´Ÿè½½å¾ˆé«˜çš„æƒ…å†µä¸‹ï¼ŒHPA ä¼šè‡ªåŠ¨æ‰©å®¹ã€‚ ä½†æ˜¯å¦‚æœæ‰©å®¹çš„ Pod éœ€è¦é¢„çƒ­ï¼Œå°±å¯èƒ½ä¼šé‡åˆ°ã€Œé¢„çƒ­é™·é˜±ã€ã€‚ åœ¨æœ‰å¤§é‡ç”¨æˆ·è®¿é—®çš„æ—¶å€™ï¼Œä¸è®ºä½¿ç”¨ä½•ç§è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œåªè¦è¯·æ±‚è¢«è½¬å‘åˆ°æ–°å»ºçš„ Pod ä¸Šï¼Œè¿™ä¸ªè¯·æ±‚å°±ä¼šã€Œå¡ä½ã€ã€‚ å¦‚æœè¯·æ±‚é€Ÿåº¦å¤ªå¿«ï¼ŒPod å¯åŠ¨çš„ç¬é—´ã€Œå¡ä½ã€çš„è¯·æ±‚å°±è¶Šå¤šï¼Œè¿™å°†ä¼šå¯¼è‡´æ–°å»º Pod å› ä¸ºå‹åŠ›è¿‡å¤§è€Œå®æ‰ã€‚ ç„¶å Pod ä¸€é‡å¯å°±è¢«å‹å®ï¼Œè¿›å…¥ CrashLoopBackoff å¾ªç¯ã€‚ å¦‚æœæ˜¯åœ¨ä½¿ç”¨å¤šçº¿ç¨‹åšè´Ÿè½½æµ‹è¯•æ—¶ï¼Œæ•ˆæœæ›´æ˜æ˜¾ï¼š50 ä¸ªçº¿ç¨‹åœ¨ä¸é—´æ–­åœ°è¯·æ±‚ï¼Œ åˆ«çš„ Pod å“åº”æ—¶é—´æ˜¯ã€Œæ¯«ç§’çº§ã€ï¼Œè€Œæ–°å»ºçš„ Pod çš„é¦–æ¬¡å“åº”æ˜¯ã€Œç§’çº§ã€ã€‚å‡ ä¹æ˜¯ä¸€ç¬é—´ï¼Œ50 ä¸ªçº¿ç¨‹å°±ä¼šå…¨éƒ¨é™·åœ¨æ–°å»ºçš„ Pod è¿™é‡Œã€‚ è€Œæ–°å»ºçš„ Pod åœ¨å¯åŠ¨çš„ç¬é—´å¯èƒ½ç‰¹åˆ«è„†å¼±ï¼Œç¬é—´çš„ 50 ä¸ªå¹¶å‘è¯·æ±‚å°±å¯ä»¥å°†å®ƒå‹å®ã€‚ ç„¶å Pod ä¸€é‡å¯å°±è¢«å‹å®ï¼Œè¿›å…¥ CrashLoopBackoff å¾ªç¯ã€‚ è§£å†³æ–¹æ³•ï¼š å¯ä»¥åœ¨ã€Œåº”ç”¨å±‚é¢ã€è§£å†³ï¼š åœ¨å¯åŠ¨æ¢é’ˆ API çš„åç«¯æ§åˆ¶å™¨é‡Œé¢ï¼Œä¾æ¬¡è°ƒç”¨æ‰€æœ‰éœ€è¦é¢„çƒ­çš„æ¥å£æˆ–è€…å…¶ä»–æ–¹å¼ï¼Œæå‰åˆå§‹åŒ–å¥½æ‰€æœ‰èµ„æºã€‚ å¯åŠ¨æ¢é’ˆçš„æ§åˆ¶å™¨ä¸­ï¼Œå¯ä»¥é€šè¿‡ localhost å›ç¯åœ°å€è°ƒç”¨å®ƒè‡ªèº«çš„æ¥å£ã€‚ ä½¿ç”¨ã€ŒAOT é¢„ç¼–è¯‘ã€æŠ€æœ¯ï¼šé¢„çƒ­ï¼Œé€šå¸¸éƒ½æ˜¯å› ä¸ºã€ŒJIT å³æ—¶ç¼–è¯‘ã€å¯¼è‡´çš„é—®é¢˜ï¼Œåœ¨éœ€è¦ç”¨åˆ°æ—¶å®ƒæ‰ç¼–è¯‘ã€‚è€Œ AOT æ˜¯é¢„å…ˆç¼–è¯‘ï¼Œåœ¨ä½¿ç”¨å‰å®Œæˆç¼–è¯‘ï¼Œå› æ­¤ AOT èƒ½è§£å†³é¢„çƒ­çš„é—®é¢˜ã€‚ ä¹Ÿå¯ä»¥åœ¨ã€ŒåŸºç¡€è®¾æ–½å±‚é¢ã€è§£å†³ï¼š åƒ AWS ALB TargetGroup ä»¥åŠå…¶ä»–äº‘æœåŠ¡å•†çš„ ALB æœåŠ¡ï¼Œé€šå¸¸éƒ½å¯ä»¥è®¾ç½® slow_start æ—¶é•¿ï¼Œå³å¯¹æ–°åŠ å…¥çš„å®ä¾‹ï¼Œä½¿ç”¨ä¸€å®šæ—¶é—´æ…¢æ…¢åœ°æŠŠæµé‡åˆ‡è¿‡å»ï¼Œæœ€ç»ˆè¾¾åˆ°é¢„æœŸçš„è´Ÿè½½å‡è¡¡çŠ¶æ€ã€‚è¿™ä¸ªå¯ä»¥è§£å†³æœåŠ¡é¢„çƒ­é—®é¢˜ã€‚ Envoy ä¹Ÿå·²ç»æ”¯æŒ slow_start æ¨¡å¼ï¼Œæ”¯æŒåœ¨ä¸€ä¸ªè®¾ç½®å¥½çš„æ—¶é—´çª—å£å†…ï¼ŒæŠŠæµé‡æ…¢æ…¢è´Ÿè½½åˆ°æ–°åŠ å…¥çš„å®ä¾‹ä¸Šï¼Œè¾¾æˆé¢„çƒ­æ•ˆæœã€‚ 4.2. HPA æ‰©ç¼©å®¹è¿‡äºæ•æ„Ÿï¼Œå¯¼è‡´ Pod æ•°é‡éœ‡è¡ é€šå¸¸æ¥è®²ï¼ŒEKS ä¸Šç»å¤§éƒ¨åˆ†è´Ÿè½½éƒ½åº”è¯¥é€‰æ‹©ä½¿ç”¨ CPU è¿›è¡Œæ‰©ç¼©å®¹ã€‚å› ä¸º CPU é€šå¸¸èƒ½å¾ˆå¥½çš„åæ˜ æœåŠ¡çš„è´Ÿè½½æƒ…å†µ ä½†æ˜¯æœ‰äº›æœåŠ¡ä¼šå­˜åœ¨å…¶ä»–å½±å“ CPU ä½¿ç”¨ç‡çš„å› ç´ ï¼Œå¯¼è‡´ä½¿ç”¨ CPU æ‰©ç¼©å®¹å˜å¾—ä¸é‚£ä¹ˆå¯é ï¼Œæ¯”å¦‚ï¼š æœ‰äº› Java æœåŠ¡å †å†…å­˜è®¾å¾—å¾ˆå¤§ï¼ŒGC pause ä¹Ÿè®¾å¾—æ¯”è¾ƒé•¿ï¼Œå› æ­¤å†…å­˜ GC ä¼šé€ æˆ CPU é—´æ­‡æ€§é£™å‡ï¼ŒCPU ç›‘æ§ä¼šæœ‰å¤§é‡çš„å°–å³°ã€‚ æœ‰äº›æœåŠ¡æœ‰å®šæ—¶ä»»åŠ¡ï¼Œå®šæ—¶ä»»åŠ¡ä¸€è¿è¡Œ CPU å°±æ¶¨ï¼Œä½†æ˜¯è¿™è·ŸæœåŠ¡çš„ QPS æ˜¯æ— å…³çš„ æœ‰äº›æœåŠ¡å¯èƒ½ä¸€è¿è¡Œ CPU å°±ä¼šç«‹å³å¤„äºä¸€ä¸ªé«˜ä½çŠ¶æ€ï¼Œå®ƒå¯èƒ½å¸Œæœ›ä½¿ç”¨åˆ«çš„ä¸šåŠ¡ä¾§æŒ‡æ ‡æ¥è¿›è¡Œæ‰©å®¹ï¼Œè€Œä¸æ˜¯ CPU. å› ä¸ºä¸Šè¿°é—®é¢˜å­˜åœ¨ï¼Œä½¿ç”¨ CPU æ‰©ç¼©å®¹ï¼Œå°±å¯èƒ½ä¼šé€ æˆæœåŠ¡é¢‘ç¹çš„æ‰©å®¹ç„¶åç¼©å®¹ï¼Œæˆ–è€…æ— é™æ‰©å®¹ã€‚ è€Œæœ‰äº›æœåŠ¡ï¼ˆå¦‚æˆ‘ä»¬çš„ã€Œæ¨èæœåŠ¡ã€ï¼‰ï¼Œå¯¹ã€Œæ‰©å®¹ã€å’Œã€Œç¼©å®¹ã€éƒ½æ˜¯æ¯”è¾ƒæ•æ„Ÿçš„ï¼Œæ¯æ¬¡æ‰©ç¼©éƒ½ä¼šé€ æˆæœåŠ¡å¯ç”¨ç‡æŠ–åŠ¨ã€‚ å¯¹è¿™ç±»æœåŠ¡è€Œè¨€ï¼ŒHPA æœ‰è¿™å‡ ç§è°ƒæ•´ç­–ç•¥ï¼š é€‰æ‹©ä½¿ç”¨ QPS ç­‰ç›¸å¯¹æ¯”è¾ƒå¹³æ»‘ï¼Œæ²¡æœ‰ GC è¿™ç±»å¹²æ‰°çš„æŒ‡æ ‡æ¥è¿›è¡Œæ‰©ç¼©å®¹ï¼Œè¿™éœ€è¦å€ŸåŠ© KEDA ç­‰ç¤¾åŒºç»„ä»¶ã€‚ å¯¹ kubernetes 1.18+ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ HPA çš„ behavior.scaleDown å’Œ behavior.scaleUp ä¸¤ä¸ªå‚æ•°ï¼Œæ§åˆ¶æ¯æ¬¡æ‰©ç¼©å®¹çš„æœ€å¤š pod æ•°é‡æˆ–è€…æ¯”ä¾‹ã€‚ ç¤ºä¾‹å¦‚ä¸‹ï¼š ---apiVersion:autoscaling/v2beta2kind:HorizontalPodAutoscalermetadata:name:podinfonamespace:defaultspec:scaleTargetRef:apiVersion:apps/v1kind:Deploymentname:podinfominReplicas:3maxReplicas:50metrics:- type:Resourceresource:name:cputarget:type:UtilizationaverageUtilization:50# æœŸæœ›çš„ CPU å¹³å‡å€¼behavior:scaleUp:stabilizationWindowSeconds:0# é»˜è®¤ä¸º 0ï¼Œåªä½¿ç”¨å½“å‰å€¼è¿›è¡Œæ‰©ç¼©å®¹policies:- periodSeconds:180# æ¯ 3 åˆ†é’Ÿæœ€å¤šæ‰©å®¹ 5% çš„ Podstype:Percentvalue:5- periodSeconds:60# æ¯åˆ†é’Ÿæœ€å¤šæ‰©å®¹ 1 ä¸ª Podï¼Œæ‰©çš„æ…¢ä¸€ç‚¹ä¸»è¦æ˜¯ä¸ºäº†ä¸€ä¸ªä¸ªåœ°é¢„çƒ­ï¼Œé¿å…ä¸€æ¬¡æ‰©å®¹å¤ªå¤šæœªé¢„çƒ­çš„ Pods å¯¼è‡´æœåŠ¡å¯ç”¨ç‡å‰§çƒˆæŠ–åŠ¨type:Podsvalue:1selectPolicy:Min # é€‰æ‹©æœ€å°çš„ç­–ç•¥# ä»¥ä¸‹çš„ä¸€åˆ‡é…ç½®ï¼Œéƒ½æ˜¯ä¸ºäº†æ›´å¹³æ»‘åœ°ç¼©å®¹scaleDown:stabilizationWindowSeconds:600# ä½¿ç”¨è¿‡å» 10 mins çš„æœ€å¤§ cpu å€¼è¿›è¡Œç¼©å®¹è®¡ç®—ï¼Œé¿å…è¿‡å¿«ç¼©å®¹policies:- type:Percent # æ¯ 3 mins æœ€å¤šç¼©å®¹ `ceil[å½“å‰å‰¯æœ¬æ•° * 5%]` ä¸ª podï¼ˆ20 ä¸ª pod ä»¥å†…ï¼Œä¸€æ¬¡åªç¼©å®¹ 1 ä¸ª podï¼‰value:5periodSeconds:180- type:Pods # æ¯ 1 mins æœ€å¤šç¼©å®¹ 1 ä¸ª podvalue:1periodSeconds:60selectPolicy:Min # ä¸Šé¢çš„ policies åˆ—è¡¨ï¼Œåªç”Ÿæ•ˆå…¶ä¸­æœ€å°çš„å€¼ä½œä¸ºç¼©å®¹é™åˆ¶ï¼ˆä¿è¯å¹³æ»‘ç¼©å®¹ï¼‰ è€Œå¯¹äºæ‰©å®¹ä¸å¤Ÿå¹³æ»‘è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥è€ƒè™‘æä¾›ç±»ä¼¼ AWS ALB TargetGroup slow_start çš„åŠŸèƒ½ï¼Œåœ¨æ‰©å®¹æ—¶ç¼“æ…¢å°†æµé‡åˆ‡åˆ°æ–° Pod ä¸Šï¼Œä»¥å®ç°é¢„çƒ­æœåŠ¡ï¼ˆJVM é¢„çƒ­ä»¥åŠæœ¬åœ°ç¼“å­˜é¢„çƒ­ï¼‰ï¼Œè¿™æ ·å°±èƒ½è¾¾åˆ°æ¯”è¾ƒå¥½çš„å¹³æ»‘æ‰©å®¹æ•ˆæœã€‚ ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:3:4","tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/"},{"categories":["æŠ€æœ¯"],"content":"5. HPA æ³¨æ„äº‹é¡¹ æ³¨æ„ kubectl 1.23 ä»¥ä¸‹çš„ç‰ˆæœ¬ï¼Œé»˜è®¤ä½¿ç”¨ hpa.v1.autoscaling æ¥æŸ¥è¯¢ HPA é…ç½®ï¼Œv2beta2 ç›¸å…³çš„å‚æ•°ä¼šè¢«ç¼–ç åˆ° metadata.annotations ä¸­ã€‚ æ¯”å¦‚ behavior å°±ä¼šè¢«ç¼–ç åˆ° autoscaling.alpha.kubernetes.io/behavior è¿™ä¸ª key æ‰€å¯¹åº”çš„å€¼ä¸­ã€‚ å› æ­¤å¦‚æœä½¿ç”¨äº† v2beta2 çš„ HPAï¼Œä¸€å®šè¦æ˜ç¡®æŒ‡å®šä½¿ç”¨ v2beta2 ç‰ˆæœ¬çš„ HPAï¼š kubectl get hpa.v2beta2.autoscaling å¦åˆ™ä¸å°å¿ƒåŠ¨åˆ° annotations ä¸­ç¼–ç çš„æŸäº›å‚æ•°ï¼Œå¯èƒ½ä¼šäº§ç”Ÿæ„æ–™ä¹‹å¤–çš„æ•ˆæœï¼Œç”šè‡³ç›´æ¥æŠŠæ§åˆ¶é¢æå´©â€¦ æ¯”å¦‚è¿™ä¸ª issue: Nil pointer dereference in KCM after v1 HPA patch request ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:3:5","tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/"},{"categories":["æŠ€æœ¯"],"content":"6. å‚è€ƒ Pod æ°´å¹³è‡ªåŠ¨ä¼¸ç¼© - Kubernetes Docs Horizontal Pod Autoscaleræ¼”ç»ƒ - Kubernetes Docs ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:3:6","tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/"},{"categories":["æŠ€æœ¯"],"content":"ä¸‰ã€èŠ‚ç‚¹ç»´æŠ¤ä¸Podå¹²æ‰°é¢„ç®— åœ¨æˆ‘ä»¬é€šè¿‡ kubectl drain å°†æŸä¸ªèŠ‚ç‚¹ä¸Šçš„å®¹å™¨é©±é€èµ°çš„æ—¶å€™ï¼Œ kubernetes ä¼šä¾æ® Pod çš„ã€ŒPodDistruptionBugetã€æ¥è¿›è¡Œ Pod çš„é©±é€ã€‚ å¦‚æœä¸è®¾ç½®ä»»ä½•æ˜ç¡®çš„ PodDistruptionBugetï¼ŒPod å°†ä¼šè¢«ç›´æ¥æ€æ­»ï¼Œç„¶ååœ¨åˆ«çš„èŠ‚ç‚¹é‡æ–°è°ƒåº¦ï¼Œè¿™å¯èƒ½å¯¼è‡´æœåŠ¡ä¸­æ–­ï¼ PDB æ˜¯ä¸€ä¸ªå•ç‹¬çš„ CR è‡ªå®šä¹‰èµ„æºï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š apiVersion:policy/v1beta1kind:PodDisruptionBudgetmetadata:name:podinfo-pdbspec:# å¦‚æœä¸æ»¡è¶³ PDBï¼ŒPod é©±é€å°†ä¼šå¤±è´¥ï¼minAvailable:1# æœ€å°‘ä¹Ÿè¦ç»´æŒä¸€ä¸ª Pod å¯ç”¨# maxUnavailable: 1 # æœ€å¤§ä¸å¯ç”¨çš„ Pod æ•°ï¼Œä¸ minAvailable ä¸èƒ½åŒæ—¶é…ç½®ï¼äºŒé€‰ä¸€selector:matchLabels:app:podinfo å¦‚æœåœ¨è¿›è¡ŒèŠ‚ç‚¹ç»´æŠ¤æ—¶(kubectl drain)ï¼ŒPod ä¸æ»¡è¶³ PDBï¼Œdrain å°†ä¼šå¤±è´¥ï¼Œç¤ºä¾‹ï¼š \u003e kubectl drain node-205 --ignore-daemonsets --delete-local-data node/node-205 cordoned WARNING: ignoring DaemonSet-managed Pods: kube-system/calico-node-nfhj7, kube-system/kube-proxy-94dz5 evicting pod default/podinfo-7c84d8c94d-h9brq evicting pod default/podinfo-7c84d8c94d-gw6qf error when evicting pod \"podinfo-7c84d8c94d-h9brq\" (will retry after 5s): Cannot evict pod as it would violate the pod's disruption budget. evicting pod default/podinfo-7c84d8c94d-h9brq error when evicting pod \"podinfo-7c84d8c94d-h9brq\" (will retry after 5s): Cannot evict pod as it would violate the pod's disruption budget. evicting pod default/podinfo-7c84d8c94d-h9brq error when evicting pod \"podinfo-7c84d8c94d-h9brq\" (will retry after 5s): Cannot evict pod as it would violate the pod's disruption budget. evicting pod default/podinfo-7c84d8c94d-h9brq pod/podinfo-7c84d8c94d-gw6qf evicted pod/podinfo-7c84d8c94d-h9brq evicted node/node-205 evicted ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œpodinfo ä¸€å…±æœ‰ä¸¤ä¸ªå‰¯æœ¬ï¼Œéƒ½è¿è¡Œåœ¨ node-205 ä¸Šé¢ã€‚æˆ‘ç»™å®ƒè®¾ç½®äº†å¹²æ‰°é¢„ç®— PDB minAvailable: 1ã€‚ ç„¶åä½¿ç”¨ kubectl drain é©±é€ Pod æ—¶ï¼Œå…¶ä¸­ä¸€ä¸ª Pod è¢«ç«‹å³é©±é€èµ°äº†ï¼Œè€Œå¦ä¸€ä¸ª Pod å¤§æ¦‚åœ¨ 15 ç§’å†…ä¸€ç›´é©±é€å¤±è´¥ã€‚ å› ä¸ºç¬¬ä¸€ä¸ª Pod è¿˜æ²¡æœ‰åœ¨æ–°çš„èŠ‚ç‚¹ä¸Šå¯åŠ¨å®Œæˆï¼Œå®ƒä¸æ»¡è¶³å¹²æ‰°é¢„ç®— PDB minAvailable: 1 è¿™ä¸ªæ¡ä»¶ã€‚ å¤§çº¦ 15 ç§’åï¼Œæœ€å…ˆè¢«é©±é€èµ°çš„ Pod åœ¨æ–°èŠ‚ç‚¹ä¸Šå¯åŠ¨å®Œæˆäº†ï¼Œå¦ä¸€ä¸ª Pod æ»¡è¶³äº† PDB æ‰€ä»¥ç»ˆäºä¹Ÿè¢«é©±é€äº†ã€‚è¿™æ‰å®Œæˆäº†ä¸€ä¸ªèŠ‚ç‚¹çš„ drain æ“ä½œã€‚ ClusterAutoscaler ç­‰é›†ç¾¤èŠ‚ç‚¹ä¼¸ç¼©ç»„ä»¶ï¼Œåœ¨ç¼©å®¹èŠ‚ç‚¹æ—¶ä¹Ÿä¼šè€ƒè™‘ PodDisruptionBudget. å¦‚æœä½ çš„é›†ç¾¤ä½¿ç”¨äº† ClusterAutoscaler ç­‰åŠ¨æ€æ‰©ç¼©å®¹èŠ‚ç‚¹çš„ç»„ä»¶ï¼Œå¼ºçƒˆå»ºè®®è®¾ç½®ä¸ºæ‰€æœ‰æœåŠ¡è®¾ç½® PodDisruptionBudget. åœ¨ PDB ä¸­ä½¿ç”¨ç™¾åˆ†æ¯”çš„æ³¨æ„äº‹é¡¹ åœ¨ä½¿ç”¨ç™¾åˆ†æ¯”æ—¶ï¼Œè®¡ç®—å‡ºçš„å®ä¾‹æ•°éƒ½ä¼šè¢«å‘ä¸Šå–æ•´ï¼Œè¿™ä¼šé€ æˆä¸¤ä¸ªç°è±¡ï¼š å¦‚æœä½¿ç”¨ minAvailableï¼Œå®ä¾‹æ•°è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå¯¼è‡´ ALLOWED DISRUPTIONS ä¸º 0ï¼Œæ‰€æœ‰å®ä¾‹éƒ½æ— æ³•è¢«é©±é€äº†ã€‚ å¦‚æœä½¿ç”¨ maxUnavailableï¼Œå› ä¸ºæ˜¯å‘ä¸Šå–æ•´ï¼ŒALLOWED DISRUPTIONS çš„å€¼ä¸€å®šä¸ä¼šä½äº 1ï¼Œè‡³å°‘æœ‰ 1 ä¸ªå®ä¾‹å¯ä»¥è¢«é©±é€ã€‚ å› æ­¤ä»ã€Œä¾¿äºé©±é€ã€çš„è§’åº¦çœ‹ï¼Œå¦‚æœä½ çš„æœåŠ¡è‡³å°‘æœ‰ 2-3 ä¸ªå®ä¾‹ï¼Œå»ºè®®åœ¨ PDB ä¸­ä½¿ç”¨ç™¾åˆ†æ¯”é…ç½® maxUnavailableï¼Œè€Œä¸æ˜¯ minAvailable. ç›¸å¯¹çš„ä»ã€Œç¡®ä¿æœåŠ¡ç¨³å®šæ€§ã€çš„è§’åº¦çœ‹ï¼Œæˆ‘ä»¬åˆ™åº”è¯¥ä½¿ç”¨ minAvailableï¼Œç¡®ä¿è‡³å°‘æœ‰ 1 ä¸ªå®ä¾‹å¯ç”¨ã€‚ ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:4:0","tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/"},{"categories":["æŠ€æœ¯"],"content":"æœ€ä½³å®è·µ Deployment + HPA + PodDisruptionBudget ä¸€èˆ¬è€Œè¨€ï¼Œä¸€ä¸ªæœåŠ¡çš„æ¯ä¸ªç‰ˆæœ¬ï¼Œéƒ½åº”è¯¥åŒ…å«å¦‚ä¸‹ä¸‰ä¸ªèµ„æºï¼š Deployment: ç®¡ç†æœåŠ¡è‡ªèº«çš„ Pods å˜› HPA: è´Ÿè´£ Pods çš„æ‰©ç¼©å®¹ï¼Œé€šå¸¸ä½¿ç”¨ CPU æŒ‡æ ‡è¿›è¡Œæ‰©ç¼©å®¹ PodDisruptionBudget(PDB): å»ºè®®æŒ‰ç…§ HPA çš„ç›®æ ‡å€¼ï¼Œæ¥è®¾ç½® PDB. æ¯”å¦‚ HPA CPU ç›®æ ‡å€¼ä¸º 60%ï¼Œå°±å¯ä»¥è€ƒè™‘è®¾ç½® PDB minAvailable=65%ï¼Œä¿è¯è‡³å°‘æœ‰ 65% çš„ Pod å¯ç”¨ã€‚è¿™æ ·ç†è®ºä¸Šæé™æƒ…å†µä¸‹ QPS å‡æ‘Šåˆ°å‰©ä¸‹ 65% çš„ Pods ä¸Šä¹Ÿä¸ä¼šé€ æˆé›ªå´©ï¼ˆè¿™é‡Œå‡è®¾ QPS å’Œ CPU æ˜¯å®Œå…¨çš„çº¿æ€§å…³ç³»ï¼‰ ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:4:1","tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/"},{"categories":["æŠ€æœ¯"],"content":"å››ã€èŠ‚ç‚¹äº²å’Œæ€§ä¸èŠ‚ç‚¹ç»„ æˆ‘ä»¬ä¸€ä¸ªé›†ç¾¤ï¼Œé€šå¸¸ä¼šä½¿ç”¨ä¸åŒçš„æ ‡ç­¾ä¸ºèŠ‚ç‚¹ç»„è¿›è¡Œåˆ†ç±»ï¼Œæ¯”å¦‚ kubernetes è‡ªåŠ¨ç”Ÿæˆçš„ä¸€äº›èŠ‚ç‚¹æ ‡ç­¾ï¼š kubernetes.io/os: é€šå¸¸éƒ½ç”¨ linux kubernetes.io/arch: amd64, arm64 topology.kubernetes.io/region å’Œ topology.kubernetes.io/zone: äº‘æœåŠ¡çš„åŒºåŸŸåŠå¯ç”¨åŒº æˆ‘ä»¬ä½¿ç”¨å¾—æ¯”è¾ƒå¤šçš„ï¼Œæ˜¯ã€ŒèŠ‚ç‚¹äº²å’Œæ€§ã€ä»¥åŠã€ŒPod åäº²å’Œæ€§ã€ï¼Œå¦å¤–ä¸¤ä¸ªç­–ç•¥è§†æƒ…å†µä½¿ç”¨ã€‚ ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:5:0","tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/"},{"categories":["æŠ€æœ¯"],"content":"1. èŠ‚ç‚¹äº²å’Œæ€§ å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ awsï¼Œé‚£ aws æœ‰ä¸€äº›è‡ªå®šä¹‰çš„èŠ‚ç‚¹æ ‡ç­¾ï¼š eks.amazonaws.com/nodegroup: aws eks èŠ‚ç‚¹ç»„çš„åç§°ï¼ŒåŒä¸€ä¸ªèŠ‚ç‚¹ç»„ä½¿ç”¨åŒæ ·çš„ aws ec2 å®ä¾‹æ¨¡æ¿ æ¯”å¦‚ arm64 èŠ‚ç‚¹ç»„ã€amd64/x64 èŠ‚ç‚¹ç»„ å†…å­˜æ¯”ä¾‹é«˜çš„èŠ‚ç‚¹ç»„å¦‚ m ç³»å®ä¾‹ï¼Œè®¡ç®—æ€§èƒ½é«˜çš„èŠ‚ç‚¹ç»„å¦‚ c ç³»åˆ— ç«ä»·å®ä¾‹èŠ‚ç‚¹ç»„ï¼šè¿™ä¸ªçœé’±å•Šï¼Œä½†æ˜¯åŠ¨æ€æ€§å¾ˆé«˜ï¼Œéšæ—¶å¯èƒ½è¢«å›æ”¶ æŒ‰é‡ä»˜è´¹èŠ‚ç‚¹ç»„ï¼šè¿™ç±»å®ä¾‹è´µï¼Œä½†æ˜¯ç¨³å®šã€‚ å‡è®¾ä½ å¸Œæœ›ä¼˜å…ˆé€‰æ‹©ç«ä»·å®ä¾‹è·‘ä½ çš„ Podï¼Œå¦‚æœç«ä»·å®ä¾‹æš‚æ—¶è·‘æ»¡äº†ï¼Œå°±é€‰æ‹©æŒ‰é‡ä»˜è´¹å®ä¾‹ã€‚ é‚£ nodeSelector å°±æ»¡è¶³ä¸äº†ä½ çš„éœ€æ±‚äº†ï¼Œä½ éœ€è¦ä½¿ç”¨ nodeAffinityï¼Œç¤ºä¾‹å¦‚ä¸‹: apiVersion:apps/v1kind:Deploymentmetadata:name:xxxnamespace:xxxspec:# ...template:# ...spec:affinity:nodeAffinity:# ä¼˜å…ˆé€‰æ‹© spot-group-c çš„èŠ‚ç‚¹preferredDuringSchedulingIgnoredDuringExecution:- preference:matchExpressions:- key:eks.amazonaws.com/nodegroupoperator:Invalues:- spot-group-cweight:80# weight ç”¨äºä¸ºèŠ‚ç‚¹è¯„åˆ†ï¼Œä¼šä¼˜å…ˆé€‰æ‹©è¯„åˆ†æœ€é«˜çš„èŠ‚ç‚¹- preference:matchExpressions:# ä¼˜å…ˆé€‰æ‹© aws c6i çš„æœºå™¨- key:node.kubernetes.io/instance-typeoperator:Invalues:- \"c6i.xlarge\"- \"c6i.2xlarge\"- \"c6i.4xlarge\"- \"c6i.8xlarge\"weight:70- preference:matchExpressions:# å…¶æ¬¡é€‰æ‹© aws c5 çš„æœºå™¨- key:node.kubernetes.io/instance-typeoperator:Invalues:- \"c5.xlarge\"- \"c5.2xlarge\"- \"c5.4xlarge\"- \"c5.9xlarge\"weight:60# å¦‚æœæ²¡ spot-group-c å¯ç”¨ï¼Œä¹Ÿå¯é€‰æ‹© ondemand-group-c çš„èŠ‚ç‚¹è·‘requiredDuringSchedulingIgnoredDuringExecution:nodeSelectorTerms:- matchExpressions:- key:eks.amazonaws.com/nodegroupoperator:Invalues:- spot-group-c- ondemand-group-ccontainers:# ... ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:5:1","tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/"},{"categories":["æŠ€æœ¯"],"content":"2. Pod åäº²å’Œæ€§ é€šå¸¸å»ºè®®ä¸ºæ¯ä¸ª Deployment çš„ template é…ç½® Pod åäº²å’Œæ€§ï¼ŒæŠŠ Pods æ‰“æ•£åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šï¼š apiVersion:apps/v1kind:Deploymentmetadata:name:xxxnamespace:xxxspec:# ...template:# ...spec:replicas:3affinity:podAntiAffinity:preferredDuringSchedulingIgnoredDuringExecution:# éå¼ºåˆ¶æ€§æ¡ä»¶- weight:100# weight ç”¨äºä¸ºèŠ‚ç‚¹è¯„åˆ†ï¼Œä¼šä¼˜å…ˆé€‰æ‹©è¯„åˆ†æœ€é«˜çš„èŠ‚ç‚¹podAffinityTerm:labelSelector:matchExpressions:- key:appoperator:Invalues:- xxx- key:versionoperator:Invalues:- v12# å°† pod å°½é‡æ‰“æ•£åœ¨å¤šä¸ªå¯ç”¨åŒºtopologyKey:topology.kubernetes.io/zonerequiredDuringSchedulingIgnoredDuringExecution:# å¼ºåˆ¶æ€§è¦æ±‚# æ³¨æ„è¿™ä¸ªæ²¡æœ‰ weightsï¼Œå¿…é¡»æ»¡è¶³åˆ—è¡¨ä¸­çš„æ‰€æœ‰æ¡ä»¶- labelSelector:matchExpressions:- key:appoperator:Invalues:- xxx- key:versionoperator:Invalues:- v12# Pod å¿…é¡»è¿è¡Œåœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸ŠtopologyKey:kubernetes.io/hostname ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:5:2","tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/"},{"categories":["æŠ€æœ¯"],"content":"äº”ã€Pod çš„å°±ç»ªæ¢é’ˆã€å­˜æ´»æ¢é’ˆä¸å¯åŠ¨æ¢é’ˆ Pod æä¾›å¦‚ä¸‹ä¸‰ç§æ¢é’ˆï¼Œå‡æ”¯æŒä½¿ç”¨ Commandã€HTTP APIã€TCP Socket è¿™ä¸‰ç§æ‰‹æ®µæ¥è¿›è¡ŒæœåŠ¡å¯ç”¨æ€§æ¢æµ‹ã€‚ startupProbe å¯åŠ¨æ¢é’ˆï¼ˆKubernetes v1.18 [beta]ï¼‰: æ­¤æ¢é’ˆé€šè¿‡åï¼Œã€Œå°±ç»ªæ¢é’ˆã€ä¸ã€Œå­˜æ´»æ¢é’ˆã€æ‰ä¼šè¿›è¡Œå­˜æ´»æ€§ä¸å°±ç»ªæ£€æŸ¥ ç”¨äºå¯¹æ…¢å¯åŠ¨å®¹å™¨è¿›è¡Œå­˜æ´»æ€§æ£€æµ‹ï¼Œé¿å…å®ƒä»¬åœ¨å¯åŠ¨è¿è¡Œä¹‹å‰å°±è¢«æ€æ‰ startupProbe æ˜¾ç„¶æ¯” livenessProbe çš„ initialDelaySeconds å‚æ•°æ›´çµæ´»ã€‚ åŒæ—¶å®ƒä¹Ÿèƒ½å»¶è¿Ÿ readinessProbe çš„ç”Ÿæ•ˆæ—¶é—´ï¼Œè¿™ä¸»è¦æ˜¯ä¸ºäº†é¿å…æ— æ„ä¹‰çš„æ¢æµ‹ã€‚å®¹å™¨éƒ½è¿˜æ²¡ startUpï¼Œæ˜¾ç„¶æ˜¯ä¸å¯èƒ½å°±ç»ªçš„ã€‚ ç¨‹åºå°†æœ€å¤šæœ‰ failureThreshold * periodSeconds çš„æ—¶é—´ç”¨äºå¯åŠ¨ï¼Œæ¯”å¦‚è®¾ç½® failureThreshold=20ã€periodSeconds=5ï¼Œç¨‹åºå¯åŠ¨æ—¶é—´æœ€é•¿å°±ä¸º 100sï¼Œå¦‚æœè¶…è¿‡ 100s ä»ç„¶æœªé€šè¿‡ã€Œå¯åŠ¨æ¢æµ‹ã€ï¼Œå®¹å™¨ä¼šè¢«æ€æ­»ã€‚ readinessProbe å°±ç»ªæ¢é’ˆ: å°±ç»ªæ¢é’ˆå¤±è´¥æ¬¡æ•°è¶…è¿‡ failureThreshold é™åˆ¶ï¼ˆé»˜è®¤ä¸‰æ¬¡ï¼‰ï¼ŒæœåŠ¡å°†è¢«æš‚æ—¶ä» Service çš„ Endpoints ä¸­è¸¢å‡ºï¼Œç›´åˆ°æœåŠ¡å†æ¬¡æ»¡è¶³ successThreshold. livenessProbe å­˜æ´»æ¢é’ˆ: æ£€æµ‹æœåŠ¡æ˜¯å¦å­˜æ´»ï¼Œå®ƒå¯ä»¥æ•æ‰åˆ°æ­»é”ç­‰æƒ…å†µï¼ŒåŠæ—¶æ€æ­»è¿™ç§å®¹å™¨ã€‚ å­˜æ´»æ¢é’ˆå¤±è´¥å¯èƒ½çš„åŸå› ï¼š æœåŠ¡å‘ç”Ÿæ­»é”ï¼Œå¯¹æ‰€æœ‰è¯·æ±‚å‡æ— å“åº” æœåŠ¡çº¿ç¨‹å…¨éƒ¨å¡åœ¨å¯¹å¤–éƒ¨ redis/mysql ç­‰å¤–éƒ¨ä¾èµ–çš„ç­‰å¾…ä¸­ï¼Œå¯¼è‡´è¯·æ±‚æ— å“åº” å­˜æ´»æ¢é’ˆå¤±è´¥æ¬¡æ•°è¶…è¿‡ failureThreshold é™åˆ¶ï¼ˆé»˜è®¤ä¸‰æ¬¡ï¼‰ï¼Œå®¹å™¨å°†è¢«æ€æ­»ï¼Œéšåæ ¹æ®é‡å¯ç­–ç•¥æ‰§è¡Œé‡å¯ã€‚ kubectl describe pod ä¼šæ˜¾ç¤ºé‡å¯åŸå› ä¸º State.Last State.Reason = Error, Exit Code=137ï¼ŒåŒæ—¶ Events ä¸­ä¼šæœ‰ Liveness probe failed: ... è¿™æ ·çš„æè¿°ã€‚ ä¸Šè¿°ä¸‰ç±»æ¢æµ‹å™¨çš„å‚æ•°éƒ½æ˜¯é€šç”¨çš„ï¼Œäº”ä¸ªæ—¶é—´ç›¸å…³çš„å‚æ•°åˆ—ä¸¾å¦‚ä¸‹ï¼š # ä¸‹é¢çš„å€¼å°±æ˜¯ k8s çš„é»˜è®¤å€¼initialDelaySeconds:0# é»˜è®¤æ²¡æœ‰ delay æ—¶é—´periodSeconds:10timeoutSeconds:1failureThreshold:3successThreshold:1 ç¤ºä¾‹ï¼š apiVersion:apps/v1kind:Deploymentmetadata:name:my-app-v3spec:# ...template:# ...spec:containers:- name:my-app-v3image:xxx.com/app/my-app:v3imagePullPolicy:IfNotPresent # ... çœç•¥è‹¥å¹²é…ç½®startupProbe:httpGet:path:/actuator/health # ç›´æ¥ä½¿ç”¨å¥åº·æ£€æŸ¥æ¥å£å³å¯port:8080periodSeconds:5timeoutSeconds:1failureThreshold:20# æœ€å¤šæä¾›ç»™æœåŠ¡ 5s * 20 çš„å¯åŠ¨æ—¶é—´successThreshold:1livenessProbe:httpGet:path:/actuator/health # spring çš„é€šç”¨å¥åº·æ£€æŸ¥è·¯å¾„port:8080periodSeconds:5timeoutSeconds:1failureThreshold:5successThreshold:1# Readiness probes are very important for a RollingUpdate to work properly,readinessProbe:httpGet:path:/actuator/health # ç®€å•èµ·è§å¯ç›´æ¥ä½¿ç”¨ livenessProbe ç›¸åŒçš„æ¥å£ï¼Œå½“ç„¶ä¹Ÿå¯é¢å¤–å®šä¹‰port:8080periodSeconds:5timeoutSeconds:1failureThreshold:5successThreshold:1 åœ¨ Kubernetes 1.18 ä¹‹å‰ï¼Œé€šç”¨çš„æ‰‹æ®µæ˜¯ä¸ºã€Œå°±ç»ªæ¢é’ˆã€æ·»åŠ è¾ƒé•¿çš„ initialDelaySeconds æ¥å®ç°ç±»ä¼¼ã€Œå¯åŠ¨æ¢é’ˆã€çš„åŠŸèƒ½åŠ¨ï¼Œé¿å…å®¹å™¨å› ä¸ºå¯åŠ¨å¤ªæ…¢ï¼Œå­˜æ´»æ¢é’ˆå¤±è´¥å¯¼è‡´å®¹å™¨è¢«é‡å¯ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š apiVersion:apps/v1kind:Deploymentmetadata:name:my-app-v3spec:# ...template:# ...spec:containers:- name:my-app-v3image:xxx.com/app/my-app:v3imagePullPolicy:IfNotPresent # ... çœç•¥è‹¥å¹²é…ç½®livenessProbe:httpGet:path:/actuator/health # spring çš„é€šç”¨å¥åº·æ£€æŸ¥è·¯å¾„port:8080initialDelaySeconds:120# å‰ä¸¤åˆ†é’Ÿï¼Œéƒ½å‡è®¾æœåŠ¡å¥åº·ï¼Œé¿å… livenessProbe å¤±è´¥å¯¼è‡´æœåŠ¡é‡å¯periodSeconds:5timeoutSeconds:1failureThreshold:5successThreshold:1# å®¹å™¨ä¸€å¯åŠ¨ï¼ŒReadiness probes å°±ä¼šä¸æ–­è¿›è¡Œæ£€æµ‹readinessProbe:httpGet:path:/actuator/healthport:8080initialDelaySeconds:3# readiness probe ä¸éœ€è¦è®¾å¤ªé•¿æ—¶é—´ï¼Œä½¿ Pod å°½å¿«åŠ å…¥åˆ° Endpoints.periodSeconds:5timeoutSeconds:1failureThreshold:5successThreshold:1 ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:6:0","tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/"},{"categories":["æŠ€æœ¯"],"content":"å…­ã€Pod å®‰å…¨ è¿™é‡Œåªä»‹ç» Pod ä¸­å®‰å…¨ç›¸å…³çš„å‚æ•°ï¼Œå…¶ä»–è¯¸å¦‚é›†ç¾¤å…¨å±€çš„å®‰å…¨ç­–ç•¥ï¼Œä¸åœ¨è¿™é‡Œè®¨è®ºã€‚ ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:7:0","tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/"},{"categories":["æŠ€æœ¯"],"content":"1. Pod SecurityContext é€šè¿‡è®¾ç½® Pod çš„ SecurityContextï¼Œå¯ä»¥ä¸ºæ¯ä¸ª Pod è®¾ç½®ç‰¹å®šçš„å®‰å…¨ç­–ç•¥ã€‚ SecurityContext æœ‰ä¸¤ç§ç±»å‹ï¼š spec.securityContext: è¿™æ˜¯ä¸€ä¸ª PodSecurityContext å¯¹è±¡ é¡¾åæ€ä¹‰ï¼Œå®ƒå¯¹ Pod ä¸­çš„æ‰€æœ‰ contaienrs éƒ½æœ‰æ•ˆã€‚ spec.containers[*].securityContext: è¿™æ˜¯ä¸€ä¸ª SecurityContext å¯¹è±¡ container ç§æœ‰çš„ SecurityContext è¿™ä¸¤ä¸ª SecurityContext çš„å‚æ•°åªæœ‰éƒ¨åˆ†é‡å ï¼Œé‡å çš„éƒ¨åˆ† spec.containers[*].securityContext ä¼˜å…ˆçº§æ›´é«˜ã€‚ æˆ‘ä»¬æ¯”è¾ƒå¸¸é‡åˆ°çš„ä¸€äº›æå‡æƒé™çš„å®‰å…¨ç­–ç•¥ï¼š ç‰¹æƒå®¹å™¨ï¼šspec.containers[*].securityContext.privileged æ·»åŠ ï¼ˆCapabilitiesï¼‰å¯é€‰çš„ç³»ç»Ÿçº§èƒ½åŠ›: spec.containers[*].securityContext.capabilities.add åªæœ‰ ntp åŒæ­¥æœåŠ¡ç­‰å°‘æ•°å®¹å™¨ï¼Œå¯ä»¥å¼€å¯è¿™é¡¹åŠŸèƒ½ã€‚è¯·æ³¨æ„è¿™éå¸¸å±é™©ã€‚ Sysctls: ç³»ç»Ÿå‚æ•°: spec.securityContext.sysctls æƒé™é™åˆ¶ç›¸å…³çš„å®‰å…¨ç­–ç•¥æœ‰ï¼ˆå¼ºçƒˆå»ºè®®åœ¨æ‰€æœ‰ Pod ä¸ŠæŒ‰éœ€é…ç½®å¦‚ä¸‹å®‰å…¨ç­–ç•¥ï¼ï¼‰ï¼š spec.volumes: æ‰€æœ‰çš„æ•°æ®å·éƒ½å¯ä»¥è®¾å®šè¯»å†™æƒé™ spec.securityContext.runAsNonRoot: true Pod å¿…é¡»ä»¥é root ç”¨æˆ·è¿è¡Œ spec.containers[*].securityContext.readOnlyRootFileSystem:true å°†å®¹å™¨å±‚è®¾ä¸ºåªè¯»ï¼Œé˜²æ­¢å®¹å™¨æ–‡ä»¶è¢«ç¯¡æ”¹ã€‚ å¦‚æœå¾®æœåŠ¡éœ€è¦è¯»å†™æ–‡ä»¶ï¼Œå»ºè®®é¢å¤–æŒ‚è½½ emptydir ç±»å‹çš„æ•°æ®å·ã€‚ spec.containers[*].securityContext.allowPrivilegeEscalation: false ä¸å…è®¸ Pod åšä»»ä½•æƒé™æå‡ï¼ spec.containers[*].securityContext.capabilities.drop: ç§»é™¤ï¼ˆCapabilitiesï¼‰å¯é€‰çš„ç³»ç»Ÿçº§èƒ½åŠ› è¿˜æœ‰å…¶ä»–è¯¸å¦‚æŒ‡å®šå®¹å™¨çš„è¿è¡Œç”¨æˆ·(user)/ç”¨æˆ·ç»„(group)ç­‰åŠŸèƒ½æœªåˆ—å‡ºï¼Œè¯·è‡ªè¡ŒæŸ¥é˜… Kubernetes ç›¸å…³æ–‡æ¡£ã€‚ ä¸€ä¸ªæ— çŠ¶æ€çš„å¾®æœåŠ¡ Pod é…ç½®ä¸¾ä¾‹ï¼š apiVersion:v1kind:Podmetadata:name:\u003cPod name\u003espec:containers:-â€Šname:\u003ccontainer name\u003eimage:\u003cimage\u003eimagePullPolicy:IfNotPresent # ......æ­¤å¤„çœç•¥ 500 å­—securityContext:readOnlyRootFilesystem:true# å°†å®¹å™¨å±‚è®¾ä¸ºåªè¯»ï¼Œé˜²æ­¢å®¹å™¨æ–‡ä»¶è¢«ç¯¡æ”¹ã€‚allowPrivilegeEscalation:false# ç¦æ­¢ Pod åšä»»ä½•æƒé™æå‡capabilities:drop:# ç¦æ­¢å®¹å™¨ä½¿ç”¨ raw å¥—æ¥å­—ï¼Œé€šå¸¸åªæœ‰ hacker æ‰ä¼šç”¨åˆ° raw å¥—æ¥å­—ã€‚# raw_socket å¯è‡ªå®šä¹‰ç½‘ç»œå±‚æ•°æ®ï¼Œé¿å¼€ tcp/udp åè®®æ ˆï¼Œç›´æ¥æ“ä½œåº•å±‚çš„ ip/icmp æ•°æ®åŒ…ã€‚å¯å®ç° ip ä¼ªè£…ã€è‡ªå®šä¹‰åè®®ç­‰åŠŸèƒ½ã€‚# å»æ‰ net_raw ä¼šå¯¼è‡´ tcpdump æ— æ³•ä½¿ç”¨ï¼Œæ— æ³•è¿›è¡Œå®¹å™¨å†…æŠ“åŒ…ã€‚éœ€è¦æŠ“åŒ…æ—¶å¯ä¸´æ—¶å»é™¤è¿™é¡¹é…ç½®- NET_RAW# æ›´å¥½çš„é€‰æ‹©ï¼šç›´æ¥ç¦ç”¨æ‰€æœ‰ capabilities# - ALLsecurityContext:# runAsUser: 1000 # è®¾å®šç”¨æˆ·# runAsGroup: 1000 # è®¾å®šç”¨æˆ·ç»„runAsNonRoot:true# Pod å¿…é¡»ä»¥é root ç”¨æˆ·è¿è¡ŒseccompProfile:# security compute modetype:RuntimeDefault ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:7:1","tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/"},{"categories":["æŠ€æœ¯"],"content":"2. seccomp: security compute mode seccomp å’Œ seccomp-bpf å…è®¸å¯¹ç³»ç»Ÿè°ƒç”¨è¿›è¡Œè¿‡æ»¤ï¼Œå¯ä»¥é˜²æ­¢ç”¨æˆ·çš„äºŒè¿›åˆ¶æ–‡å¯¹ä¸»æœºæ“ä½œç³»ç»Ÿä»¶æ‰§è¡Œé€šå¸¸æƒ…å†µä¸‹å¹¶ä¸éœ€è¦çš„å±é™©æ“ä½œã€‚å®ƒå’Œ Falco æœ‰äº›ç±»ä¼¼ï¼Œä¸è¿‡ Seccomp æ²¡æœ‰ä¸ºå®¹å™¨æä¾›ç‰¹åˆ«çš„æ”¯æŒã€‚ è§†é¢‘: Seccomp: What Can It Do For You? - Justin Cormack, Docker ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:7:2","tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/"},{"categories":["æŠ€æœ¯"],"content":"å…¶ä»–é—®é¢˜ ä¸åŒèŠ‚ç‚¹ç±»å‹çš„æ€§èƒ½æœ‰å·®è·ï¼Œå¯¼è‡´ QPS å‡è¡¡çš„æƒ…å†µä¸‹ï¼ŒCPU è´Ÿè½½ä¸å‡è¡¡ è§£å†³åŠæ³•ï¼ˆæœªéªŒè¯ï¼‰ï¼š å°½é‡ä½¿ç”¨æ€§èƒ½ç›¸åŒçš„å®ä¾‹ç±»å‹ï¼šé€šè¿‡ podAffinity åŠ nodeAffinity æ·»åŠ èŠ‚ç‚¹ç±»å‹çš„äº²å’Œæ€§ ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:8:0","tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/"},{"categories":["éšç¬”","æŠ€æœ¯"],"content":" æ›´æ–°ï¼š2022/1/22 ","date":"2022-01-03","objectID":"/posts/2021-summary/:0:0","tags":["æ€»ç»“"],"title":"2021 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2021-summary/"},{"categories":["éšç¬”","æŠ€æœ¯"],"content":"é—²è¨€ç¢è¯­ ä¸€æ™ƒä¸€å¹´åˆæ˜¯è¿‡å»äº†ï¼Œè¿™ä¸ªæ–°å¹´ï¼Œå…¨çƒç–«æƒ…å†åˆ›æ–°é«˜ï¼Œåœ£è¯èŠ‚åç¾å›½å•æ—¥æ–°å¢æ›´æ˜¯ç›´æ¥çªç ´ 50 ä¸‡ç›´é€¼ 60 ä¸‡å¤§å…³âŒ 100 ä¸‡âœ…ï¼Œå›½å†…ä¹Ÿæœ‰è¥¿å®‰ç®¡ç†ä¸åŠ›å¯¼è‡´æ°‘ä¼—å¿é¥¥æŒ¨é¥¿ã€‚ æ–°å† å·²ç»ä¸¤å¹´å¤šäº†å•Šã€‚ è¨€å½’æ­£ä¼ ï¼Œæˆ‘ä»Šå¹´å¹´åˆä» W å…¬å¸ç¦»èŒåï¼Œéå¸¸å¹¸è¿åœ°è¿›äº†ç°åœ¨çš„å…¬å¸â€”â€”å¤§å®‡æ— é™ï¼Œåœ¨èå…¥å¤§å®‡çš„è¿‡ç¨‹ä¸­ä¹Ÿæ˜¯äº”å‘³æ‚é™ˆã€‚ ä¸è¿‡æ€»ä½“ç»“æœè¿˜æ˜¯æŒºæ»¡æ„çš„ï¼Œç›®å‰å·¥ä½œå·²ç»æ­¥å…¥æ­£è½¨ï¼Œä¹Ÿå‘ç°äº†éå¸¸å¤šçš„æœºä¼šï¼Œå¤§å®‡çš„åŸºç¡€è®¾æ–½é¢†åŸŸä»ç„¶å¤§æœ‰å¯ä¸ºã€‚ ä¸€äº›é‡è¦äº‹æƒ…è¿˜æ˜¯æ²¡æ€ä¹ˆæƒ³é€šï¼Œä¸è¿‡æ¯•ç«Ÿé£å£ä¸Šçš„çŒªéƒ½èƒ½é£ï¼Œä»Šå¹´å°å°åŠªåŠ›äº†ä¸€æŠŠï¼Œå¤§éƒ¨åˆ†æ—¶é—´ä»ç„¶éšæ³¢é€æµï¼Œå´ä¹Ÿæ¸å…¥ä½³å¢ƒã€‚ ","date":"2022-01-03","objectID":"/posts/2021-summary/:1:0","tags":["æ€»ç»“"],"title":"2021 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2021-summary/"},{"categories":["éšç¬”","æŠ€æœ¯"],"content":"ç”Ÿæ´» 1 æœˆçš„æ—¶å€™ä»åšå®¢å›­è¿ç§»åˆ°è¿™ä¸ªç‹¬ç«‹åšå®¢ï¼Œè¿˜è®¤è¯†äº† @èŠå£«ï¼ŒèŠå£«å¸®æˆ‘è°ƒæ•´å¥½äº†åšå®¢ã€Œå‹é“¾ã€é¡µé¢çš„æ ·å¼ï¼Œè¶…çº§æ„Ÿè°¢~ 2 æœˆçš„æ—¶å€™ä» W å…¬å¸ç¦»èŒï¼Œç„¶åæ€ä¹ˆè¯´å‘¢ï¼Œç¬é—´æ„Ÿè§‰æµ·é˜”å¤©ç©ºï¼Œå¿ƒæ€ 180 åº¦è½¬å˜ï¼Œå¥½å¾—ä¸å¾—äº†ï¼Œä½†æ˜¯å…¶å®ä¹Ÿå¾ˆæ‹…å¿ƒè‡ªå·±å„æ–¹é¢çš„ä¸è¶³ã€‚æ€»ä¹‹å¿ƒé‡Œæœ‰å¥½å¤šçš„æƒ³æ³•ï¼Œè·Ÿ @æ˜¯æ ¼å­å•Šã€@èŠå£« ä»¥åŠå‰åŒäº‹èŠäº†å¥½å¤šï¼Œéå¸¸æ„Ÿè°¢è¿™å‡ ä½æœ‹å‹è·ŸåŒäº‹å¸®æˆ‘æ¢³ç†æ€è·¯ï¼Œç»™æˆ‘è‚¯å®šã€‚ä¹Ÿæ˜¯è¿™ä¸ªæ—¶é—´ç‚¹ï¼Œæˆ‘è¢« @èŠå£« æ‹‰è¿›äº†ä¸­æ–‡ twitter çš„åœˆå­ã€‚ è¿‡å¹´å“åº”å·å¬æ²¡å›å®¶ï¼ˆå…¶å®æ˜¯å«Œæ ¸é…¸æ£€æµ‹éº»çƒ¦ï¼Œå®¶é‡Œä¹Ÿå»ºè®®å…ˆåˆ«å›ï¼‰ï¼Œæ¯å¤©çˆ¬çˆ¬å±±çœ‹çœ‹é£æ™¯ï¼Œä¹°äº†ä¸ªåŠåºŠå»å…¬å›­åˆç¡ï¼Œç»ƒä¹ å£ç´ç«¹ç¬›ï¼Œå°±è¿™æ ·ç©äº†ä¸€ä¸ªæœˆã€‚ åˆ°äº† 3 æœˆä»½çš„æ—¶å€™æˆ‘å¼€å§‹æ‰¾å·¥ä½œï¼Œé¢äº†å‡ å®¶å…¬å¸åï¼Œéå¸¸å¹¸è¿åœ°è¿›å…¥äº†å¤§å®‡æ— é™ï¼Œæˆä¸ºäº†ä¸€å SRE èŒæ–°ã€‚åœ¨å¤§å®‡ä¸€å¹´çš„æ„Ÿå—ï¼Œå°±æ”¾åœ¨åé¢çš„ã€Œå·¥ä½œã€éƒ¨åˆ†å†™äº†ï¼Œè¿™é‡Œå…ˆç•¥è¿‡ã€‚ åŠ å…¥å¤§å®‡åï¼Œå…¨å¹´éƒ½æœ‰å®šæœŸçš„å›¢å»ºï¼Œè·Ÿ SRE å°ä¼™ä¼´å…¬æ¬¾åƒå–ï¼Œæˆ‘ 2021 å¹´ä¸‹é¦†å­æ¬¡æ•°ä¼°è®¡æ˜¯ä¸Šä¸€å¹´çš„ä¸ƒå…«å€ 3 æœˆåº•ï¼Œçœ‹äº†ç”µå½±â€”â€”ã€Šå¯»é¾™ä¼ è¯´ã€‹ï¼ˆ2021 å¹´çœ‹çš„å”¯ä¸€ä¸€éƒ¨ç”µå½±ï¼‰ï¼Œç‰‡å°¾æ›²è¶…å¥½å¬ã€‚ 4 æœˆä»½ï¼Œå„ç§å·§åˆä¸‹ï¼Œæ„å¤–å‘ç°åˆä¸­åŒå­¦ä½å¾—ç¦»æˆ‘ 1km ä¸åˆ°ï¼Œåœ¨ä»–å®¶åƒäº†é¡¿å®¶ä¹¡èœï¼Œè¿˜æœ‰æ¨æ¢…é…’ï¼Œå‘³é“éå¸¸æ£’ï¼è¿˜æœ‰å›ç”˜å¼ºçƒˆçš„åŸæ­¥é’é’±æŸ³èŒ¶ï¼Œè®©æˆ‘å¿µå¿µä¸å¿˜ã€‚ 8 æœˆä»½ï¼Œå ‚å¼Ÿæ¥æ·±åœ³æš‘æœŸå®ä¹ ï¼Œè·Ÿä¸¤ä¸ªå ‚å¼Ÿä¸€èµ·ç©¿è¶Šæ·±åœ³ä¸œè¥¿å†²æµ·å²¸çº¿ï¼Œé£æ™¯éå¸¸æ£’ï¼Œä¸è¿‡è·¯ä¸Šä¹Ÿæ˜¯åˆçƒ­åˆæ¸´ 10 æœˆä»½ åŠ å…¥äº†å¤§å®‡çš„å†²æµªå°åˆ†é˜Ÿï¼Œç¬¬ä¸€æ¬¡å†²æµªã€æµ·è¾¹çƒ§çƒ¤ ä¹°äº†åŒè½®æ»‘é‹ï¼Œå­¦ä¼šäº†å€’æ»‘ã€å‹æ­¥è½¬å‘ï¼Œå¤ä¹ äº†å¤§å­¦æ—¶å­¦è¿‡çš„è‹¥å¹²åŸºç¡€æŠ€å·§ 12 æœˆï¼Œä¹°äº†å°äº‘ç±³æ³‰å…ˆå‡€é¥®æœºåï¼Œæœ‰äº†éšæ—¶éšåœ°çš„çŸ¿ç‰©è´¨çƒ­æ°´ï¼Œå°±æƒ³èµ·äº† 4 æœˆä»½åœ¨åˆä¸­åŒå­¦å®¶å–è¿‡çš„é’é’±æŸ³ï¼Œç„¶åå°±å–èŒ¶ä¸Šç˜¾äº†ï¼Œä¸€æ¡Œå­çš„æ»‡çº¢ã€ç¥é—¨çº¢èŒ¶ã€å®‰å‰ç™½èŒ¶ã€é»„å±±æ¯›å³°ã€é’é’±æŸ³ã€è“èŒ¶ã€æ¢…å­èâ€¦ç›®å‰æ„Ÿè§‰æ»‡çº¢è·Ÿç¥é—¨çº¢èŒ¶æœ€å¥½å–ï¼Œå®‰å‰ç™½èŒ¶è·Ÿé»„å±±æ¯›å³°éƒ½éå¸¸æ¸…é¦™ï¼Œé’é’±æŸ³å›ç”˜æœ€å¼ºçƒˆï¼Œè“èŒ¶æ€ä¹ˆè¯´å‘¢å‘³é“æ„Ÿè§‰ä¸å¤ªå¥½ï¼ˆä¹Ÿå¯èƒ½æ˜¯æ³¡çš„æ‰‹æ³•ä¸å¯¹ï¼Ÿï¼‰ æˆ‘çš„äº‘ç±³å‡€é¥®æœº\" æˆ‘çš„äº‘ç±³å‡€é¥®æœº æ¡Œé¢ä¸Šçš„å„ç§èŒ¶å¶\" æ¡Œé¢ä¸Šçš„å„ç§èŒ¶å¶ 2022 å¹´ 1 æœˆï¼Œç¬¬ä¸€æ¬¡ä¹°åŠ¨æ¼«æ‰‹åŠï¼Œå¦†ç‚¹åæ„Ÿè§‰æˆ¿é—´éƒ½å¢è‰²ä¸å°‘~ æˆ‘çš„æˆ¿é—´-æŒ‚ç”»-æ‰‹åŠ\" æˆ‘çš„æˆ¿é—´-æŒ‚ç”»-æ‰‹åŠ ","date":"2022-01-03","objectID":"/posts/2021-summary/:2:0","tags":["æ€»ç»“"],"title":"2021 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2021-summary/"},{"categories":["éšç¬”","æŠ€æœ¯"],"content":"è¯»ä¹¦ å¹´åˆè¾èŒåæ¸¸å±±ç©æ°´ï¼Œå¿ƒæ€ç¨å¾®å®‰å®šäº†äº›ï¼Œçœ‹äº†å¤§åŠæœ¬ã€Šèµ°å‡ºè’é‡ã€‹ã€‚ 6 æœˆä»½ç¤¾åŒºç»„ç»‡æ‰“æ–°å† ç–«è‹—æ—¶ï¼Œåœ¨ç­‰å€™å®¤çœ‹äº†æœ¬ã€Šé’æ˜¥é©¿ç«™â€”â€”æ·±åœ³æ‰“å·¥å¦¹å†™çœŸã€‹ï¼Œè®²è¿°å…«ä¹åå¹´ä»£æ‰“å·¥å¦¹çš„ç”Ÿæ´»ã€‚å¾ˆçœŸå®ï¼Œæ„Ÿæƒ…å¾ˆç»†è…»ã€‚ å¹´æœ«äºŒçˆ·çˆ·å»ä¸–ï¼Œå‚åŠ å®Œè‘¬ç¤¼åï¼Œå¿ƒæ€æœ‰äº›å˜åŒ–ï¼Œçœ‹å®Œäº†å¤§ä¸€æ—¶ä¹°ä¸‹çš„ã€Šæœˆå®« Moon Palaceã€‹ï¼Œè®²è¿°ä¸»è§’çš„æ‚²å‰§äººç”Ÿã€‚ å…¶ä½™å¤§éƒ¨åˆ†ä¸šä½™æ—¶é—´ï¼Œæ— èŠï¼Œåˆä¸æƒ³å­¦ç‚¹ä¸œè¥¿ï¼Œä¹Ÿä¸æƒ³è¿åŠ¨ï¼Œäºæ˜¯çœ‹äº†éå¸¸å¤šçš„ç½‘ç»œå°è¯´æ‰“å‘æ—¶é—´ã€‚ ","date":"2022-01-03","objectID":"/posts/2021-summary/:3:0","tags":["æ€»ç»“"],"title":"2021 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2021-summary/"},{"categories":["éšç¬”","æŠ€æœ¯"],"content":"éŸ³ä¹ å¹´åˆè¾èŒåï¼Œç»ƒäº†ä¸€æ®µæ—¶é—´çš„ç«¹ç¬›è·Ÿè“è°ƒå£ç´ï¼Œä½†åæ¥æ‰¾åˆ°å·¥ä½œåå°±åŸºæœ¬æ²‰å¯‚äº†ã€‚ æ€»çš„æ¥è¯´è¿˜æ˜¯åŸåœ°è¸æ­¥å§ã€‚ ","date":"2022-01-03","objectID":"/posts/2021-summary/:4:0","tags":["æ€»ç»“"],"title":"2021 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2021-summary/"},{"categories":["éšç¬”","æŠ€æœ¯"],"content":"å·¥ä½œ - æˆ‘åœ¨å¤§å®‡æ— é™çš„è¿™ä¸€å¹´ 3 æœˆä»½åˆšè¿›å¤§å®‡çš„æˆ‘å……æ»¡å¥½å¥‡ï¼Œä½†ä¹Ÿå°å¿ƒè°¨æ…ï¼Œç”šè‡³æœ‰ç‚¹ä¸æ•¢ç›¸ä¿¡è‡ªå·±èƒ½è¿›åˆ°ä¸€å®¶è¿™ä¹ˆæ£’çš„å…¬å¸ï¼Œæ„Ÿè§‰è‡ªå·±è¿æ°”çˆ†æ£šã€‚ æ¯•ç«Ÿå¤§å®‡æ— è®ºæ˜¯åŒäº‹æ°´å¹³è¿˜æ˜¯å·¥ä½œæ°›å›´ï¼Œäº¦æˆ–æ˜¯ç”¨æˆ·ä½“é‡ï¼Œç›¸æ¯”æˆ‘ä¸Šå®¶å…¬å¸éƒ½æ˜¯è´¨çš„å·®åˆ«ã€‚ æˆ‘åœ¨å¤§å®‡çš„ç¬¬ä¸€ä¸ªå·¥ä½\" æˆ‘åœ¨å¤§å®‡çš„ç¬¬ä¸€ä¸ªå·¥ä½ ä¹‹åæ…¢æ…¢ç†Ÿæ‚‰å·¥ä½œçš„å†…å®¹ä¸æ–¹æ³•ï¼Œleader å°½åŠ›æŠŠæœ€åŒ¹é…æˆ‘å…´è¶£çš„å·¥ä½œå®‰æ’ç»™æˆ‘ï¼Œå¸®æˆ‘æ’ç–‘è§£éš¾ï¼ŒåŒæ—¶åˆç»™æˆ‘æå¤§çš„è‡ªä¸»æ€§ï¼ŒçœŸçš„æ˜¯æ£’æäº†ã€‚ ç„¶è€Œè‡ªä¸»æ€§é«˜å¸¦æ¥çš„ä¹Ÿæ˜¯æ›´é«˜çš„å·¥ä½œéš¾åº¦ï¼Œé‡åˆ°å›°éš¾æ—¶ä¹Ÿæ›¾æ‰‹å¿™è„šä¹±ã€è¿·èŒ«ã€ç”šè‡³è‡ªæˆ‘æ€€ç–‘ï¼Œå¾ˆæ‹…å¿ƒæ˜¯ä¸æ˜¯éš”å¤©å°±å¾—è·‘è·¯äº†â€¦ï¼ˆæ˜¯çš„æˆ‘æŠ—å‹èƒ½åŠ›æœ‰ç‚¹å¼±ï¼‰ ä½†å¥½åœ¨æˆ‘ç»ˆç©¶è¿˜æ˜¯èƒ½è°ƒèŠ‚å¥½å¿ƒæ€ï¼Œè´Ÿèµ·è´£ä»»ï¼Œä¸€æ­¥æ­¥æŠŠå·¥ä½œå®Œæˆã€‚ ä¸­é—´æœ‰å‡ æ¬¡å·¥ä½œæœ‰å»¶è¯¯æ—¶ï¼Œleader è¿˜é™ªæˆ‘åŠ ç­ï¼Œäº‹æƒ…å¹²å®Œååˆå¸¦æˆ‘å»åƒå¤§é¤çŠ’åŠ³è‡ªå·±ï¼ŒçœŸçš„è¶…çº§æ„Ÿè°¢ä»–çš„å¸®åŠ©ä¸æ”¯æŒã€‚ æ¢åº§ä½åçš„æ–°å·¥ä½ï¼Œè½åœ°çª—é£æ™¯å¾ˆæ£’\" æ¢åº§ä½åçš„æ–°å·¥ä½ï¼Œè½åœ°çª—é£æ™¯å¾ˆæ£’ è¿™æ ·ç»å†äº†å‡ ä¸ªé¡¹ç›®çš„æ´—ç¤¼åï¼Œç°åœ¨æˆ‘ç»ˆäºèƒ½è¯´è‡ªå·±æ˜¯è„šè¸å®åœ°äº†ï¼Œå¿ƒæ€ä»ã€Œæ˜å¤©æ˜¯ä¸æ˜¯å¾—ææ¡¶è·‘è·¯ã€è½¬å˜æˆäº†ã€Œå“‡è¿˜æœ‰è¿™ä¸ªå¯ä»¥æï¼Œé‚£ä¸ª ROI ä¹Ÿå¾ˆé«˜ï¼Œæœ‰å¥½å¤šæœ‰è¶£çš„äº‹å¯ä»¥åšå•Šã€ï¼Œæˆ‘ç»ˆäºèƒ½è¯´è‡ªå·±çœŸæ­£èå…¥äº†å¤§å®‡æ— é™è¿™å®¶å…¬å¸ï¼Œæˆä¸ºäº†å®ƒçš„ä¸€å‘˜ã€‚ å›çœ‹ä¸‹äº† 2020 å¹´çš„æ€»ç»“ä¸å±•æœ›ï¼Œä»Šå¹´å®é™…çš„è¿›æ­¥ï¼Œè·Ÿå»å¹´æœŸæœ›çš„å·®åˆ«å¾ˆå¤§ã€‚æœ€åˆçš„ç›®æ ‡å¤§æ¦‚åªå®ç°äº† 10%ï¼Œä½†æ˜¯æ¥è§¦åˆ°äº†è®¸å¤šæ„æ–™ä¹‹å¤–çš„ä¸œè¥¿ï¼Œæ€»ä½“è¿˜æ˜¯æ»¡æ„çš„ï¼š ç†Ÿæ‚‰äº†æ–°å…¬å¸çš„æ–‡åŒ–ä¸å·¥ä½œæ–¹å¼ï¼Œè¿™æ„Ÿè§‰æ˜¯ä¸ªå¾ˆå¤§çš„æ”¶è·ï¼Œæˆ‘çš„å·¥ä½œæ–¹å¼æœ‰äº†å¾ˆå¤§çš„æ”¹å–„ æ¥è§¦å¹¶ä¸”ç†Ÿæ‚‰äº†æ–°å…¬å¸çš„ AWS çº¿ä¸Šç¯å¢ƒ è´Ÿè´£ç»´æŠ¤çº¿ä¸Š Kubernetes ç®¡ç†å¹³å°ï¼Œç¬¬ä¸€æ¬¡æ¥è§¦åˆ°çš„çº¿ä¸Šé›†ç¾¤å³°å€¼ QPS å°±æœ‰å¥½å‡ ä¸‡ã€‚ä»ä¸€å¼€å§‹çš„å°å¿ƒç¿¼ç¿¼ï¼Œåˆ°ç°åœ¨ä¹Ÿè½¬å˜æˆäº†è€æ‰‹ï¼Œè¿™ç®—æ˜¯æ„ä¹‰é‡å¤§å§ ä½¿ç”¨ python å†™äº†å‡ ä¸ª Kubernetes ç®¡ç†å¹³å°çš„æœåŠ¡ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ç¬¬ä¸€æ¬¡å†™çº¿ä¸ŠæœåŠ¡ï¼Œå¾ˆæœ‰äº›æˆå°±æ„Ÿ ä¸‹åŠå¹´åœ¨ AWS æˆæœ¬çš„åˆ†æä¸ç®¡æ§ä¸ŠèŠ±äº†å¾ˆå¤šç²¾åŠ›ï¼Œä¹Ÿæœ‰äº†ä¸€äº›ä¸é”™çš„æˆæœï¼Œå—ç›ŠåŒªæµ… å­¦ä¼šäº† Nginx çš„ç®€å•ä½¿ç”¨ï¼Œåˆšå¥½å¤Ÿç”¨äºç»´æŠ¤å…¬å¸å…ˆæœ‰çš„ Nginx ä»£ç†é…ç½® ä¸»å¯¼å®Œæˆäº†ã€Œæ–°å»º K8s é›†ç¾¤ï¼Œå°†æœåŠ¡è¿ç§»åˆ°æ–°é›†ç¾¤ã€ã€‚è™½ç„¶å¹¶ä¸æ˜¯ä¸€ä»¶å¾ˆéš¾çš„äº‹ï¼Œä½†è¿™åº”è¯¥ç®—æ˜¯æˆ‘ 2021 å¹´æœ€å¤§çš„æˆå°±äº†ã€‚ å‡çº§è¿‡ç¨‹ä¸­ä¹Ÿæ˜¯é‡åˆ°äº†å„ç§é—®é¢˜ï¼Œç¬¬ä¸€æ¬¡å‡çº§è¿ç§»æ—¶æˆ‘å‡†å¤‡äº†å¥½ä¹…ï¼Œæ…Œçš„ä¸è¡Œï¼Œç»“æœå‡çº§æ—¶éƒ¨åˆ†æœåŠ¡è¿˜æ˜¯å‡ºäº†é—®é¢˜ï¼Œå½“æ—¶è„‘å­çœŸçš„æ˜¯ä¸ªæ‡µçš„ï¼Œè·Ÿ leader æåˆ°åŠå¤œ 1 ç‚¹å¤šåè¿˜æ˜¯æ²¡è§£å†³ï¼Œå›é€€åˆ°äº†æ—§é›†ç¾¤ï¼Œå‡çº§å¤±è´¥ã€‚ä¹‹åé€šè¿‡æµ‹è¯•ç¡®è®¤åˆ°æ˜¯æŸä¸ªæœåŠ¡æ‰©ç¼©å®¹éœ‡è¡å¯¼è‡´å¯ç”¨ç‡æ— æ³•æ¢å¤ï¼Œå°è¯•é€šè¿‡ HPA çš„ behavior æ¥æ§åˆ¶æ‰©ç¼©å®¹é€Ÿç‡ï¼Œåˆæ„å¤–è§¦å‘äº† K8s HPA çš„ bug æŠŠé›†ç¾¤æ§åˆ¶é¢æå´©äº†â€¦ å†ä¹‹åæŠŠé—®é¢˜éƒ½ç¡®è®¤äº†ï¼Œç¬¬äºŒæ¬¡å°è¯•å‡çº§ï¼Œåˆæ˜¯æœ‰ä¸ªåˆ«æœåŠ¡å¯ç”¨ç‡æŠ–åŠ¨ï¼Œè°ƒè¯•äº†å¥½å‡ å¤©ã€‚é‚£å‡ å¤©ç¥ç»ä¸€ç›´ç´§ç»·ï¼Œæ¯å¤©æ—©ä¸Šéƒ½æ˜¯è¢«æœåŠ¡å¯ç”¨ç‡çš„å‘Šè­¦åµé†’çš„ã€‚è·¨å¹´çš„é‚£å¤©æ™šä¸Šä¸šåŠ¡é‡ä¸Šæ¶¨ï¼Œæˆ‘å°±åœ¨è§‚å¯ŸæœåŠ¡å¯ç”¨ç‡çš„è¿‡ç¨‹ä¸­è·¨å¹´äº†ã€‚è¿™æ ·æ‰ç»ˆäºå®Œæˆäº† K8s é›†ç¾¤çš„å‡çº§ï¼ŒæœŸé—´å„ä½åŒäº‹ä¹Ÿæœ‰å‚ä¸å¸®å¿™åˆ†ææ’æŸ¥å„ç§é—®é¢˜ï¼Œéå¸¸æ„Ÿè°¢ä»–ä»¬ï¼Œè¿˜æœ‰åŠªåŠ›çš„æˆ‘è‡ªå·±ã€‚ éšä¾¿å†™äº†å‡ ä¸ª go çš„ demoï¼ŒåŸºæœ¬æ²¡å•¥è¿›æ­¥ å­¦äº†ä¸€ä¸ªæ˜ŸæœŸçš„ rust è¯­è¨€ï¼Œå¿«é€Ÿçœ‹å®Œäº† the bookï¼Œç”¨ rust é‡å†™äº†ä¸ª video2chars å­¦ä¹ äº† Linux å®¹å™¨çš„åº•å±‚åŸç†ï¼šcgroups/namespace æŠ€æœ¯ï¼Œå¹¶ä¸”ç”¨ go/rust å®ç°äº†ä¸ª demo å­¦ä¹ äº† Linux çš„å„ç§ç½‘ç»œæ¥å£ã€Iptables ç†Ÿæ‚‰äº† PromQL/Grafanaï¼Œç°åœ¨ä¹Ÿèƒ½æ‹·è´äº› PromQL æŸ¥å„ç§æ•°æ®äº† å¦‚æœè¦ç»™è‡ªå·±æ‰“åˆ†çš„è¯ï¼Œé‚£å°±æ˜¯ã€Œè‰¯å¥½ã€å§ã€‚å› ä¸ºå¹¶æ²¡æœ‰å¾ˆå¼ºçš„è¿›å–å¿ƒï¼Œæ‰€ä»¥å‡ºæ¥çš„ç»“æœä¹Ÿå¹¶ä¸èƒ½ç§°ä¹‹ä¸ºã€Œä¼˜ç§€ã€ã€‚ é¡ºä¾¿å…¬å¸çš„æ–°åŠå…¬åŒºçœŸçš„è¶…èµï¼Œè¯¦æƒ…è§æˆ‘çš„ twitterï¼š æ–°åŠå…¬åŒºçœŸå¥½å‘ï½ å€¼æ­¤è‰¯è¾°ç¾æ™¯ï¼Œå¥½æƒ³æ•´ä¸ªæ¦»æ¦»ç±³åå«ï¼Œååœ¨è§’è½çš„è½åœ°çª—è¾¹å·¥ä½œğŸ¤£ é‚£ç§ä½¿ç”¨å…¬å…±è®¾æ–½å·¥ï¼ˆmoï¼‰ä½œï¼ˆyuï¼‰çš„ä¹è¶£ï¼Œä»¥åŠå¹³å¸¸å·¥ä½è§ä¸åˆ°çš„æ™¯è‰²äº¤ç›¸è¾‰æ˜ ï¼Œæ˜¯ä¸å¤ªå¥½è¡¨è¿°çš„å¥‡å¦™ä½“éªŒ pic.twitter.com/FASffzw8N3 â€” ryan4yin | æ–¼æ¸…æ¨‚ (@ryan4yin) January 17, 2022 ","date":"2022-01-03","objectID":"/posts/2021-summary/:5:0","tags":["æ€»ç»“"],"title":"2021 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2021-summary/"},{"categories":["éšç¬”","æŠ€æœ¯"],"content":"æŠ€æœ¯æ–¹é¢çš„æ„Ÿå— Istio æœåŠ¡ç½‘æ ¼ï¼šä½“ä¼šåˆ°äº†å®ƒæœ‰ç‚¹é‡ï¼Œè€Œä¸”å®ƒçš„å‘å±•è·Ÿæˆ‘ä»¬çš„éœ€æ±‚ä¸ä¸€å®šåŒ¹é… Sidecar æ¨¡å¼çš„æˆæœ¬æ¯”è¾ƒé«˜ï¼Œåœ¨æœªè°ƒä¼˜çš„æƒ…å†µä¸‹ï¼Œå®ƒä¼šç»™æœåŠ¡å¸¦æ¥ 1/3 åˆ° 1/4 çš„æˆæœ¬æå‡ï¼Œä»¥åŠå»¶è¿Ÿä¸Šå‡ æ¯”å¦‚åˆ‡é‡æƒé‡å›ºå®šä¸º 100ï¼ˆæ–°ç‰ˆæœ¬å°†ä¼šæ”¾å®½é™åˆ¶ï¼‰ï¼Œä¸æ”¯æŒ pod çš„ warm upï¼ˆç¤¾åŒºå·²ç»æœ‰ PRï¼ŒæŒç»­è§‚æœ›å§ï¼‰ è€Œå®ƒé‡ç‚¹å‘å±•çš„è™šæ‹Ÿæœºæ”¯æŒæˆ‘ä»¬å´å®Œå…¨ä¸éœ€è¦ ä¸€ç›´åœ¨æ€è€ƒæ˜¯æŒç»­å¾€ Istio æŠ•å…¥ï¼Œè¿˜æ˜¯æ¢å…¶ä»–çš„æ–¹æ¡ˆ æœåŠ¡ç½‘æ ¼ä»ç„¶åœ¨å¿«é€Ÿå‘å±•ï¼Œæœªæ¥çš„è¶‹åŠ¿åº”è¯¥æ˜¯ eBPF + Envoy + WASM Cilium æ¨å‡ºçš„åŸºäº eBPF çš„ Service Mesh æ˜¯ä¸€ä¸ªæ–°è¶‹åŠ¿ï¼ˆå®ƒä½¿ç”¨é«˜çº§ç‰¹æ€§æ—¶ä¼šé€€åŒ–æˆ Per Node Proxy æ¨¡å¼ï¼‰ï¼Œæˆæœ¬ã€å»¶è¿Ÿæ–¹é¢éƒ½æœ‰æœ›åŠæ‰“ Sidecar æ¨¡å¼çš„å…¶ä»–æœåŠ¡ç½‘æ ¼ï¼Œæ˜¯ä»Šå¹´æœåŠ¡ç½‘æ ¼é¢†åŸŸçš„å¤§æ–°é—»ã€‚ æˆ‘ä»¬æ›¾å°è¯•ä½¿ç”¨ä¸­å¿ƒåŒ–ç½‘å…³æ¥æ›¿ä»£ Sidecar ä»¥é™ä½æˆæœ¬ã€‚ä½†æ˜¯è·¨åŒºæµé‡æˆæœ¬ã€HTTP/gRPC å¤šåè®®å…±å­˜ï¼Œè¿™äº›éƒ½æ˜¯æŒ‘æˆ˜ã€‚è€Œä¸”è¿™ä¹Ÿå¹¶ä¸æ˜¯ç¤¾åŒºçš„æœ€ä½³å®è·µï¼Œç°åœ¨æˆ‘è§‰å¾—ç»´æŒ Sidecar å…¶å®åè€Œèƒ½æå‡èµ„æºåˆ©ç”¨ç‡ï¼Œæˆ‘ä»¬çš„é›†ç¾¤èµ„æºåˆ©ç”¨ç‡ç›®å‰å¾ˆä½ã€‚å¦‚æœèƒ½æŠŠæ§å¥½ï¼Œè¿™éƒ¨åˆ†æˆæœ¬æˆ–è®¸æ˜¯å¯ä»¥æ¥å—çš„ã€‚ K8s é›†ç¾¤çš„æ—¥å¿—æ–¹é¢ï¼Œæˆ‘ä»¬ç›®å‰æ˜¯ä½¿ç”¨è‡ªç ”çš„åŸºäº gelf åè®®çš„ç³»ç»Ÿï¼Œä½†æ˜¯é—®é¢˜æŒºå¤šçš„ ä»æå‡ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€æ˜“ç”¨æ€§ç­‰è§’åº¦æ¥è¯´ï¼Œloki æ˜¯å€¼å¾—æ¢ç´¢ä¸‹çš„ K8s é›†ç¾¤ç®¡ç†æ–¹é¢ï¼Œè§‰å¾—é›†ç¾¤çš„å‡çº§è¿­ä»£ï¼Œå¯ä»¥åšå¾—æ›´è‡ªåŠ¨åŒ–ã€æ›´å¯é ã€‚æ˜å¹´å¯ä»¥åœ¨å¤šé›†ç¾¤ç®¡ç†è¿™ä¸ªæ–¹å‘ä¸Šå¤šæ¢ç´¢ä¸‹ã€‚ Pod æœåŠ¡è´¨é‡ï¼šå¯¹éæ ¸å¿ƒæœåŠ¡ï¼Œå¯ä»¥é€‚å½“è°ƒä½ requests çš„èµ„æºé‡ï¼Œè€Œä¸æ˜¯å®Œå…¨é¢„ç•™(Guaranteed)ï¼Œä»¥æå‡èµ„æºåˆ©ç”¨ç‡ã€‚ å®˜æ–¹çš„ HPA èƒ½åŠ›æ˜¯ä¸å¤Ÿç”¨çš„ï¼Œä¸šåŠ¡ä¾§å¯èƒ½ä¼šéœ€è¦åŸºäº QPS/Queue æˆ–è€…ä¸šåŠ¡ä¾§çš„å…¶ä»–å‚æ•°æ¥è¿›è¡Œæ‰©ç¼©å®¹ï¼Œéœ€è¦æŒç»­å…³æ³¨ KEDA è¿™ä¸ªé¡¹ç›®ã€‚ æˆæœ¬æ§åˆ¶æ–¹é¢ï¼Œä½“ä¼šåˆ°äº† ARM æ¶æ„ä»¥åŠ Spot ç«ä»·å®ä¾‹çš„å¥½å¤„ è·¨åŒºæµé‡æˆæœ¬æœ‰å¾ˆå¤§çš„æ½œåœ¨ä¼˜åŒ–ç©ºé—´ è·¨åŒºæµé‡æˆæœ¬æ˜¯åœ¨ä¸¤è¾¹éƒ½ä¼šæ”¶è´¹ï¼Œè€Œä¸”ä¸ä»…æ¶‰åŠ Kubernetes é›†ç¾¤å†…æœåŠ¡é—´çš„è°ƒç”¨ï¼Œè¿˜ä¼šæ¶‰åŠå¯¹ RDS/ES/ElastiCache/EC2 ç­‰å…¶ä»–èµ„æºçš„è°ƒç”¨ã€‚ ä»Šå¹´å„äº‘å‚å•†æ•…éšœé¢‘å‘ï¼Œæ²¡æœ‰è·¨ region çš„æœåŠ¡è¿ç§»å°±ä¼šå¾ˆéš¾å—ï¼Œéœ€è¦æŒç»­å…³æ³¨ä¸‹ karmada è¿™ç±»å¤šé›†ç¾¤ç®¡ç†æ–¹æ¡ˆã€‚ Google è´¦å·ç³»ç»Ÿå®•æœº Fastly CDN æ•…éšœ Facebook æ•…éšœ AWS æ›´æ˜¯å„ç§å¯ç”¨åŒºæ•…éšœï¼Œ12/7 çš„æ•…éšœå¯¼è‡´ AWS å¤§éƒ¨åˆ†æœåŠ¡éƒ½å´©äº†ã€‚å› æ­¤æˆ‘ä»¬ SRE ä»Šå¹´ç»å¸¸æ˜¯æ•‘å„ç§å¤§ç«å°ç«â€¦ Rust/Go/WASM è“¬å‹ƒå‘å±•ï¼Œæœªæ¥å¯æœŸã€‚ AI è½åœ°åˆ°å„ä¸ªé¢†åŸŸï¼Œå½±å“åˆ°äº†æˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨çš„è¯­éŸ³å¯¼èˆªã€æ­Œå£°åˆæˆã€è¯­éŸ³åˆæˆç­‰å¤šä¸ªé¢†åŸŸï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬ä¸ SRE å·¥ä½œç›¸å…³çš„åœºæ™¯ï¼šAIOps ","date":"2022-01-03","objectID":"/posts/2021-summary/:6:0","tags":["æ€»ç»“"],"title":"2021 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2021-summary/"},{"categories":["éšç¬”","æŠ€æœ¯"],"content":"2022 å¹´çš„å±•æœ› ","date":"2022-01-03","objectID":"/posts/2021-summary/:7:0","tags":["æ€»ç»“"],"title":"2021 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2021-summary/"},{"categories":["éšç¬”","æŠ€æœ¯"],"content":"æŠ€æœ¯ä¾§ ä»Šå¹´çš„å±•æœ›å†™å¾—æ›´èšç„¦ä¸€äº›ï¼Œäº‰å–èƒ½å®ç° 50%ï¼Œå°±æ˜¯å¾ˆå¤§çš„çªç ´äº†ã€‚ ç†Ÿç»ƒæŒæ¡ Go è¯­è¨€ï¼Œå¹¶åˆ†åˆ«ç”¨äºè‡³å°‘ä¸¤ä¸ªé¡¹ç›®ä¸­ æ‰“é“è¿˜éœ€è‡ªèº«ç¡¬ï¼Œç¼–ç èƒ½åŠ›æ˜¯åŸºç¡€ä¸­çš„åŸºç¡€ Kubernetes ç›¸å…³ ä»¥ kubebuilder ä¸ºä»£è¡¨çš„ k8s å¼€å‘ã€æ‹“å±•æŠ€æœ¯ é˜…è¯» k8s åŠç›¸å…³ç”Ÿæ€çš„æºç ï¼Œäº†è§£å…¶å®ç°é€»è¾‘ ç½‘ç»œæŠ€æœ¯ æœåŠ¡ç½‘æ ¼ Istio ä»£ç†å·¥å…· Envoy/APISIX ç½‘ç»œæ’ä»¶ Cilium + eBPF AWS K8s æˆæœ¬ä¸æœåŠ¡ç¨³å®šæ€§ä¼˜åŒ– èŠ‚çº¦è·¨å¯ç”¨åŒº/è·¨åŸŸçš„æµé‡æˆæœ¬ K8s æ–°ç‰¹æ€§ï¼šTopology Aware Hints Istio: Locality Load Balancing å®ä¾‹ç±»å‹ä¼˜åŒ–ï¼š ä½¿ç”¨æ›´åˆé€‚çš„å®ä¾‹ç±»å‹ ä½¿ç”¨ ARM æ¶æ„æœºå‹ï¼Œé™æœ¬å¢æ•ˆ æ¨å¹¿ gRPC åè®® æå‡æœ¬åœ°å¼€å‘æ•ˆç‡ï¼š nocalhost å¤šé›†ç¾¤çš„åº”ç”¨éƒ¨ç½²ã€å®¹ç¾ karmada æ¢ç´¢æ–°æŠ€æœ¯ä¸å¯èƒ½æ€§ï¼ˆä¼˜å…ˆçº§ä½ï¼‰ åŸºäº Kubernetes çš„æœåŠ¡å¹³å°ï¼Œæœªæ¥çš„å‘å±•æ–¹å‘ kubevela buildpack æ˜¯å¦åº”è¯¥æ¨è¿› gitops openkruise Serverless å¹³å°çš„è¿›å±• Knative OpenFunction æœºå™¨å­¦ä¹ ã€æ·±åº¦å­¦ä¹ æŠ€æœ¯ï¼šæƒ³å°è¯•ä¸‹å°† AI åº”ç”¨åœ¨éŸ³ä¹ã€è¯­éŸ³ã€SRE ç­‰æˆ‘æ„Ÿå…´è¶£çš„é¢†åŸŸï¼Œå³ä½¿æ˜¯è°ƒåŒ…ä¹Ÿè¡Œå•Šï¼Œæ€»ä¹‹æƒ³å‡ºç‚¹æˆæœâ€¦ å¯ä»¥é¢„æ–™åˆ°æ˜å¹´ SRE å›¢é˜Ÿæœ‰è¶…å¤šçš„æœºä¼šï¼Œè¿™å…¶ä¸­æˆ‘å…·ä½“èƒ½è´Ÿè´£å“ªäº›éƒ¨åˆ†ï¼Œåˆèƒ½åšå‡ºæ€æ ·çš„æˆæœï¼ŒçœŸçš„ç›¸å½“æœŸå¾…~ ","date":"2022-01-03","objectID":"/posts/2021-summary/:7:1","tags":["æ€»ç»“"],"title":"2021 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2021-summary/"},{"categories":["éšç¬”","æŠ€æœ¯"],"content":"ç”Ÿæ´»ä¾§ è¿åŠ¨ï¼š æŠŠè½®æ»‘ç»ƒå¥½ï¼Œå­¦ä¼šç‚¹èŠ±æ ·å§ï¼Œæ¯ä¸ªæœˆè‡³å°‘ä¸¤æ¬¡ã€‚ è¿›è¡Œä¸‰æ¬¡ä»¥ä¸Šçš„æ¬¡çŸ­é€”æ—…è¡Œï¼Œä¸œè¥¿å†²ç©¿è¶Šå¯ä»¥å†æ¥ä¸€æ¬¡ã€‚ éŸ³ä¹ï¼š å†ä¸€æ¬¡å­¦ä¹ ä¹ç†â€¦ midi é”®ç›˜ä¹°äº†ä¸€ç›´åƒç°ï¼Œå¤šå¤šç»ƒä¹ å§ ä¹°äº†ä¸ª Synthesizer V Stduio Pro + ã€Œé’æº¯ AIã€ï¼Œæ–°çš„ä¸€å¹´æƒ³å­¦ä¸‹è°ƒæ•™ï¼Œç¿»å”±äº›è‡ªå·±å–œæ¬¢çš„æ­Œã€‚ é˜…è¯»ï¼šæ¸…å•å¦‚ä¸‹ï¼Œä¸€ä¸ªæœˆè‡³å°‘è¯»å®Œå…¶ä¸­ä¸€æœ¬ã€‚ æ–‡å­¦ç±»ï¼š ã€Šäººé—´å¤±æ ¼ã€‹ï¼šä¹…ä»°å¤§åçš„ä¸€æœ¬ä¹¦ï¼Œæ›¾ç»æœ‰åŒå­¦åŠ›èï¼Œä½†æ˜¯ä¸€ç›´æ²¡çœ‹ã€‚ ã€Šç”Ÿå‘½æœ€åçš„è¯»ä¹¦ä¼šã€‹ï¼šæˆ–è®¸æ›¾ç»çœ‹è¿‡ï¼Œä½†æ˜¯ä¸€ç‚¹å°è±¡éƒ½æ²¡äº† ã€Šç™¾å¹´å­¤ç‹¬ã€‹ï¼šé«˜ä¸­çš„æ—¶å€™è¯»è¿‡ä¸€éï¼Œä½†æ˜¯éƒ½å¿˜å·®ä¸å¤šäº† ã€Šéœä¹±æ—¶æœŸçš„çˆ±æƒ…ã€‹ ã€Šè‹è²çš„ä¸–ç•Œã€‹ï¼šæ®è¯´æ˜¯å“²å­¦å¯è’™è¯»ç‰©ï¼Œæ›¾ç»çœ‹è¿‡ï¼Œä½†æ˜¯å¯¹å†…å®¹å®Œå…¨æ²¡å°è±¡äº†ã€‚ ã€Šä½ ä¸€ç”Ÿçš„æ•…äº‹ã€‹ï¼šæˆ‘ä¹Ÿæ›¾æ˜¯ä¸ªç§‘å¹»è¿· ã€Šæ²ˆä»æ–‡çš„ååŠç”Ÿã€‹ ã€Šæˆ‘ä¸åœ°å›ã€‹ ã€Šå°†é¥®èŒ¶ã€‹ ã€Šå¾å›½ä¸å¾æ°‘ - æ—è¯­å ‚ã€‹ ã€Šæˆ¿æ€çªçš„åˆæ‹ä¹å›­ã€‹ äººæ–‡ç¤¾ç§‘ ã€Šåœ¨ç”Ÿå‘½çš„å°½å¤´æ‹¥æŠ±ä½ -ä¸´ç»ˆå…³æ€€åŒ»ç”Ÿæ‰‹è®°ã€‹ï¼šä»Šå¹´æƒ³æ›´å¤šåœ°äº†è§£ä¸‹ã€Œæ­»äº¡ã€ ã€Šæ€æ ·å¾æœç¾ä¸½å°‘å¥³ã€‹ï¼šå“ˆå“ˆ ã€Šçˆ±çš„è‰ºæœ¯ã€‹ ã€Šç¤¾ä¼šå¿ƒç†å­¦ã€‹ ã€Šè¢«è®¨åŒçš„å‹‡æ°”ã€‹ ã€Šäººä½“ç®€å²ã€‹ ã€Šç§‘å­¦é©å‘½çš„ç»“æ„ã€‹ ã€Šé‚“å°å¹³æ—¶ä»£ã€‹ ã€Šè®ºä¸­å›½ã€‹ ã€Šåˆ˜æ“è¥¿æ–¹ç°ä»£æ€æƒ³è®²ä¹‰ã€‹ ã€Šæ—¶é—´çš„ç§©åºã€‹ ã€Šæç®€å®‡å®™å²ã€‹ ã€Šåœ†åœˆæ­£ä¹‰-ä½œä¸ºè‡ªç”±å‰æçš„ä¿¡å¿µã€‹ ã€Šäººç”Ÿè„šæœ¬ã€‹ æŠ€æœ¯ç±» ã€Šå¤æ‚ã€‹ ã€ŠSRE - Google è¿ç»´è§£å¯†ã€‹ ã€Šå‡¤å‡°é¡¹ç›®ï¼šä¸€ä¸ª IT è¿ç»´çš„ä¼ å¥‡æ•…äº‹ã€‹ ã€Šäººæœˆç¥è¯ã€‹ ã€Šç»©æ•ˆä½¿èƒ½ï¼šè¶…è¶Š OKRã€‹ ã€Šå¥ˆé£æ–‡åŒ–æ‰‹å†Œã€‹ ã€Šå¹•åäº§å“-æ‰“é€ çªç ´å¼æ€ç»´ã€‹ ã€Šæ·±å…¥ Linux å†…æ ¸æ¶æ„ã€‹ ã€ŠLinux/UNIX ç³»ç»Ÿç¼–ç¨‹æ‰‹å†Œã€‹ ã€Šé‡æ„ - æ”¹å–„æ—¢æœ‰ä»£ç çš„è®¾è®¡ã€‹ ã€Šç½‘ç»œæ˜¯æ€æ ·è¿æ¥çš„ã€‹ï¼šæ›¾ç»å­¦ä¹ è¿‡ã€Šè®¡ç®—æœºç½‘ç»œï¼šè‡ªé¡¶å‘ä¸‹æ–¹æ³•ã€‹ï¼Œä¸è¿‡åªå­¦åˆ°ç½‘ç»œå±‚ã€‚å°±ä»è¿™æœ¬ä¹¦å¼€å§‹é‡æ–°å­¦ä¹ å§ã€‚ ","date":"2022-01-03","objectID":"/posts/2021-summary/:7:2","tags":["æ€»ç»“"],"title":"2021 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2021-summary/"},{"categories":["éšç¬”","æŠ€æœ¯"],"content":"ç»“è¯­ 2021 å¹´åˆæœ‹å‹ä¸æˆ‘ç»™è‡ªå·±çš„æœŸè®¸æ˜¯ã€Œæ‹†ç ´ç‰ç¬¼é£å½©å‡¤ï¼Œé¡¿å¼€é‡‘é”èµ°è›Ÿé¾™ã€ï¼Œæ„Ÿè§‰ç¡®å®åº”éªŒäº†ã€‚ ä»Šå¹´æˆ‘å¸Œæœ›ä¸è®ºæ˜¯åœ¨ç”Ÿæ´»ä¸Šè¿˜æ˜¯åœ¨å·¥ä½œä¸Šï¼Œéƒ½èƒ½ã€Œæ›´ä¸Šä¸€å±‚æ¥¼ã€~ æ›´å¤šæœ‰è¶£çš„ã€æœ‰æ·±åº¦çš„ 2021 å¹´åº¦æ€»ç»“ï¼šhttps://github.com/saveweb/review-2021 ","date":"2022-01-03","objectID":"/posts/2021-summary/:8:0","tags":["æ€»ç»“"],"title":"2021 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2021-summary/"},{"categories":["éšç¬”"],"content":" ã€Œæ­¤å²¸å¼ƒè‰ï¼Œå½¼å²¸ç¹èŠ±ã€‚ã€å–è‡ªå‰æ°¸åŠ¨æœºä¸»å”±ã€Œæ²³æ´¥æ¨±/ç™½é‡‘ã€çš„ä¸ªäººç®€ä»‹ ä»Šå¤©æƒ³æ¨å‡ é¦–æ­Œ emmmm ","date":"2021-08-28","objectID":"/posts/weeds-on-this-side-flowers-on-the-other/:0:0","tags":["é—²è¨€ç¢è¯­","éŸ³ä¹"],"title":"æ­¤å²¸å¼ƒè‰ï¼Œå½¼å²¸ç¹èŠ±","uri":"/posts/weeds-on-this-side-flowers-on-the-other/"},{"categories":["æŠ€æœ¯"],"content":" æœ¬æ–‡ä»…é’ˆå¯¹ ipv4 ç½‘ç»œ æœ¬æ–‡å…ˆä»‹ç» iptables çš„åŸºæœ¬æ¦‚å¿µåŠå¸¸ç”¨å‘½ä»¤ï¼Œç„¶ååˆ†æ docker/podman æ˜¯å¦‚ä½•åˆ©ç”¨ iptables å’Œ Linux è™šæ‹Ÿç½‘ç»œæ¥å£å®ç°çš„å•æœºå®¹å™¨ç½‘ç»œã€‚ ä¸€ã€iptables iptables æä¾›äº†åŒ…è¿‡æ»¤ã€NAT ä»¥åŠå…¶ä»–çš„åŒ…å¤„ç†èƒ½åŠ›ï¼Œiptables åº”ç”¨æœ€å¤šçš„ä¸¤ä¸ªåœºæ™¯æ˜¯ firewall å’Œ NAT iptables åŠæ–°çš„ nftables éƒ½æ˜¯åŸºäº netfilter å¼€å‘çš„ï¼Œæ˜¯ netfilter çš„å­é¡¹ç›®ã€‚ ä½†æ˜¯ eBPF ç¤¾åŒºç›®å‰æ­£åœ¨å¼€å‘æ—¨åœ¨å–ä»£ netfilter çš„æ–°é¡¹ç›® bpfilterï¼Œä»–ä»¬çš„ç›®æ ‡ä¹‹ä¸€æ˜¯å…¼å®¹ iptables/nftables è§„åˆ™ï¼Œè®©æˆ‘ä»¬æ‹­ç›®ä»¥å¾…å§ã€‚ ","date":"2021-08-15","objectID":"/posts/iptables-and-container-networks/:0:0","tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨","iptables","conntrack"],"title":"iptables åŠ docker å®¹å™¨ç½‘ç»œåˆ†æ","uri":"/posts/iptables-and-container-networks/"},{"categories":["æŠ€æœ¯"],"content":"iptables åŸºç¡€æ¦‚å¿µ - å››è¡¨äº”é“¾ å®é™…ä¸Šè¿˜æœ‰å¼  SELinux ç›¸å…³çš„ security è¡¨ï¼ˆåº”è¯¥æ˜¯è¾ƒæ–°çš„å†…æ ¸æ–°å¢çš„ï¼Œä½†æ˜¯ä¸æ¸…æ¥šæ˜¯å“ªä¸ªç‰ˆæœ¬åŠ çš„ï¼‰ï¼Œä½†æ˜¯æˆ‘åŸºæœ¬æ²¡æ¥è§¦è¿‡ï¼Œå°±ç•¥è¿‡äº†ã€‚ è¯¦ç»†çš„è¯´æ˜å‚è§ iptablesè¯¦è§£ï¼ˆ1ï¼‰ï¼šiptablesæ¦‚å¿µ - æœ±åŒå°ï¼Œè¿™ç¯‡æ–‡ç« å†™å¾—éå¸¸æ£’ï¼æŠŠ iptables è®²æ¸…æ¥šäº†ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œiptables æä¾›äº†å››å¼ è¡¨ï¼ˆä¸è€ƒè™‘ security çš„è¯ï¼‰å’Œäº”æ¡é“¾ï¼Œæ•°æ®åœ¨è¿™å››è¡¨äº”é“¾ä¸­çš„å¤„ç†æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š åœ¨è¿™é‡Œçš„ä»‹ç»ä¸­ï¼Œå¯ä»¥å…ˆå¿½ç•¥æ‰å›¾ä¸­ link layer å±‚çš„é“¾è·¯ï¼Œå®ƒå±äº ebtables çš„èŒƒç•´ã€‚å¦å¤– conntrack ä¹Ÿæš‚æ—¶å¿½ç•¥ï¼Œåœ¨ä¸‹ä¸€å°èŠ‚ä¼šè¯¦ç»†ä»‹ç» conntrack çš„åŠŸèƒ½ã€‚ netfilter æ•°æ®åŒ…å¤„ç†æµç¨‹ï¼Œæ¥è‡ª wikipedia\" netfilter æ•°æ®åŒ…å¤„ç†æµç¨‹ï¼Œæ¥è‡ª wikipedia å¯¹ç…§ä¸Šå›¾ï¼Œå¯¹äºå‘é€åˆ°æŸä¸ªç”¨æˆ·å±‚ç¨‹åºçš„æ•°æ®è€Œè¨€ï¼Œæµé‡é¡ºåºå¦‚ä¸‹ï¼š é¦–å…ˆè¿›å…¥ PREROUTING é“¾ï¼Œä¾æ¬¡ç»è¿‡è¿™ä¸‰ä¸ªè¡¨ï¼š raw -\u003e mangle -\u003e nat ç„¶åè¿›å…¥ INPUT é“¾ï¼Œè¿™ä¸ªé“¾ä¸Šä¹Ÿæœ‰ä¸‰ä¸ªè¡¨ï¼Œå¤„ç†é¡ºåºæ˜¯ï¼šmangle -\u003e nat -\u003e filter è¿‡äº† INPUT é“¾åï¼Œæ•°æ®æ‰ä¼šè¿›å…¥å†…æ ¸åè®®æ ˆï¼Œæœ€ç»ˆåˆ°è¾¾ç”¨æˆ·å±‚ç¨‹åºã€‚ ç”¨æˆ·å±‚ç¨‹åºå‘å‡ºçš„æŠ¥æ–‡ï¼Œåˆ™ä¾æ¬¡ç»è¿‡è¿™å‡ ä¸ªè¡¨ï¼šOUTPUT -\u003e POSTROUTING ä»å›¾ä¸­ä¹Ÿå¾ˆå®¹æ˜“çœ‹å‡ºï¼Œå¦‚æœæ•°æ® dst ip ä¸æ˜¯æœ¬æœºä»»ä¸€æ¥å£çš„ ipï¼Œé‚£å®ƒé€šè¿‡çš„å‡ ä¸ªé“¾ä¾æ¬¡æ˜¯ï¼šPREROUTEING -\u003e FORWARD -\u003e POSTROUTING äº”é“¾çš„åŠŸèƒ½å’Œåç§°å®Œå…¨ä¸€è‡´ï¼Œåº”è¯¥å¾ˆå®¹æ˜“ç†è§£ã€‚ä¸‹é¢æŒ‰ä¼˜å…ˆçº§åˆ†åˆ«ä»‹ç»ä¸‹é“¾ä¸­çš„å››ä¸ªè¡¨ï¼š raw: å¯¹æ”¶åˆ°çš„æ•°æ®åŒ…åœ¨è¿æ¥è·Ÿè¸ªå‰è¿›è¡Œå¤„ç†ã€‚ä¸€èˆ¬ç”¨ä¸åˆ°ï¼Œå¯ä»¥å¿½ç•¥ ä¸€æ—¦ç”¨æˆ·ä½¿ç”¨äº† raw raw è¡¨å¤„ç†å®Œåï¼Œå°†è·³è¿‡ nat è¡¨å’Œ ip_conntrack å¤„ç†ï¼Œå³ä¸å†åšåœ°å€è½¬æ¢å’Œæ•°æ®åŒ…çš„é“¾æ¥è·Ÿè¸ªå¤„ç†äº† mangle: ç”¨äºä¿®æ”¹æŠ¥æ–‡ã€ç»™æŠ¥æ–‡æ‰“æ ‡ç­¾ nat: ä¸»è¦ç”¨äºåšç½‘ç»œåœ°å€è½¬æ¢ï¼ŒSNAT æˆ–è€… DNAT filter: ä¸»è¦ç”¨äºè¿‡æ»¤æ•°æ®åŒ… æ•°æ®åœ¨æŒ‰ä¼˜å…ˆçº§ç»è¿‡å››ä¸ªè¡¨çš„å¤„ç†æ—¶ï¼Œä¸€æ—¦åœ¨æŸä¸ªè¡¨ä¸­åŒ¹é…åˆ°ä¸€æ¡è§„åˆ™ A,ä¸‹ä¸€æ¡å¤„ç†è§„åˆ™å°±ç”±è§„åˆ™ A çš„ target å‚æ•°æŒ‡å®šï¼Œåç»­çš„æ‰€æœ‰è¡¨éƒ½ä¼šè¢«å¿½ç•¥ã€‚target æœ‰å¦‚ä¸‹å‡ ç§ç±»å‹ï¼š ACCEPT: ç›´æ¥å…è®¸æ•°æ®åŒ…é€šè¿‡ DROP: ç›´æ¥ä¸¢å¼ƒæ•°æ®åŒ…ï¼Œå¯¹ç¨‹åºè€Œè¨€å°±æ˜¯ 100% ä¸¢åŒ… REJECT: ä¸¢å¼ƒæ•°æ®åŒ…ï¼Œä½†æ˜¯ä¼šç»™ç¨‹åºè¿”å› RESETã€‚è¿™ä¸ªå¯¹ç¨‹åºæ›´å‹å¥½ï¼Œä½†æ˜¯å­˜åœ¨å®‰å…¨éšæ‚£ï¼Œé€šå¸¸ä¸ä½¿ç”¨ã€‚ MASQUERADE: ï¼ˆä¼ªè£…ï¼‰å°† src ip æ”¹å†™ä¸ºç½‘å¡ ipï¼Œå’Œ SNAT çš„åŒºåˆ«æ˜¯å®ƒä¼šè‡ªåŠ¨è¯»å–ç½‘å¡ ipã€‚è·¯ç”±è®¾å¤‡å¿…å¤‡ã€‚ SNAT/DNAT: é¡¾åæ€ä¹‰ï¼Œåšç½‘ç»œåœ°å€è½¬æ¢ REDIRECT: åœ¨æœ¬æœºåšç«¯å£æ˜ å°„ LOG: åœ¨/var/log/messagesæ–‡ä»¶ä¸­è®°å½•æ—¥å¿—ä¿¡æ¯ï¼Œç„¶åå°†æ•°æ®åŒ…ä¼ é€’ç»™ä¸‹ä¸€æ¡è§„åˆ™ï¼Œä¹Ÿå°±æ˜¯è¯´é™¤äº†è®°å½•ä»¥å¤–ä¸å¯¹æ•°æ®åŒ…åšä»»ä½•å…¶ä»–æ“ä½œï¼Œä»ç„¶è®©ä¸‹ä¸€æ¡è§„åˆ™å»åŒ¹é…ã€‚ åªæœ‰è¿™ä¸ª target ç‰¹æ®Šä¸€äº›ï¼ŒåŒ¹é…å®ƒçš„æ•°æ®ä»ç„¶å¯ä»¥åŒ¹é…åç»­è§„åˆ™ï¼Œä¸ä¼šç›´æ¥è·³è¿‡ã€‚ å…¶ä»–ç±»å‹ï¼Œå¯ä»¥ç”¨åˆ°çš„æ—¶å€™å†æŸ¥ ç†è§£äº†ä¸Šé¢è¿™å¼ å›¾ï¼Œä»¥åŠå››ä¸ªè¡¨çš„ç”¨é€”ï¼Œå°±å¾ˆå®¹æ˜“ç†è§£ iptables çš„å‘½ä»¤äº†ã€‚ ","date":"2021-08-15","objectID":"/posts/iptables-and-container-networks/:1:0","tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨","iptables","conntrack"],"title":"iptables åŠ docker å®¹å™¨ç½‘ç»œåˆ†æ","uri":"/posts/iptables-and-container-networks/"},{"categories":["æŠ€æœ¯"],"content":"å¸¸ç”¨å‘½ä»¤ æ³¨æ„: ä¸‹é¢æä¾›çš„ iptables å‘½ä»¤åšçš„ä¿®æ”¹æ˜¯æœªæŒä¹…åŒ–çš„ï¼Œé‡å¯å°±ä¼šä¸¢å¤±ï¼åœ¨ä¸‹ä¸€èŠ‚ä¼šç®€å•ä»‹ç»æŒä¹…åŒ–é…ç½®çš„æ–¹æ³•ã€‚ å‘½ä»¤æ ¼å¼ï¼š iptables [-t table] {-A|-C|-D} chain [-m matchname [per-match-options]] -j targetname [per-target-options] å…¶ä¸­ table é»˜è®¤ä¸º filter è¡¨ï¼Œå…¶ä¸­ç³»ç»Ÿç®¡ç†å‘˜å®é™…ä½¿ç”¨æœ€å¤šçš„æ˜¯ INPUT é“¾ï¼Œç”¨äºè®¾ç½®é˜²ç«å¢™ã€‚ ä»¥ä¸‹ç®€å•ä»‹ç»åœ¨ INPUT é“¾ä¸Šæ·»åŠ ã€ä¿®æ”¹è§„åˆ™ï¼Œæ¥è®¾ç½®é˜²ç«å¢™ï¼š # --add å…è®¸ 80 ç«¯å£é€šè¿‡ iptables -A INPUT -p tcp --dport 80 -j ACCEPT # --list-rules æŸ¥çœ‹æ‰€æœ‰è§„åˆ™ iptables -S # --list-rules æŸ¥çœ‹ INPUT è¡¨ä¸­çš„æ‰€æœ‰è§„åˆ™ iptables -S INPUT # æŸ¥çœ‹ iptables ä¸­çš„æ‰€æœ‰è§„åˆ™ï¼ˆæ¯” -L æ›´è¯¦ç»†ï¼‰ # ---delete é€šè¿‡ç¼–å·åˆ é™¤è§„åˆ™ iptables -D 1 # æˆ–è€…é€šè¿‡å®Œæ•´çš„è§„åˆ™å‚æ•°æ¥åˆ é™¤è§„åˆ™ iptables -D INPUT -p tcp --dport 80 -j ACCEPT # --replace é€šè¿‡ç¼–å·æ¥æ›¿æ¢è§„åˆ™å†…å®¹ iptables -R INPUT 1 -s 192.168.0.1 -j DROP # --insert åœ¨æŒ‡å®šçš„ä½ç½®æ’å…¥è§„åˆ™ï¼Œå¯ç±»æ¯”é“¾è¡¨çš„æ’å…¥ iptables -I INPUT 1 -p tcp --dport 80 -j ACCEPT # åœ¨åŒ¹é…æ¡ä»¶å‰é¢ä½¿ç”¨æ„Ÿå¹å·è¡¨ç¤ºå–å # å¦‚ä¸‹è§„åˆ™è¡¨ç¤ºæ¥å—æ‰€æœ‰æ¥è‡ª docker0ï¼Œä½†æ˜¯ç›®æ ‡æ¥å£ä¸æ˜¯ docker0 çš„æµé‡ iptables -A FORWARD -i docker0 ! -o docker0 -j ACCEPT # --policy è®¾ç½®æŸä¸ªé“¾çš„é»˜è®¤è§„åˆ™ # å¾ˆå¤šç³»ç»Ÿç®¡ç†å‘˜ä¼šä¹ æƒ¯å°†è¿æ¥å…¬ç½‘çš„æœåŠ¡å™¨ï¼Œé»˜è®¤è§„åˆ™è®¾ä¸º DROPï¼Œæå‡å®‰å…¨æ€§ï¼Œé¿å…é”™è¯¯åœ°å¼€æ”¾äº†ç«¯å£ã€‚ # ä½†æ˜¯ä¹Ÿè¦æ³¨æ„ï¼Œé»˜è®¤è§„åˆ™è®¾ä¸º DROP å‰ï¼Œä¸€å®šè¦å…ˆæŠŠå…è®¸ ssh ç«¯å£çš„è§„åˆ™åŠ ä¸Šï¼Œå¦åˆ™å°±å°´å°¬äº†ã€‚ iptables -P INPUT DROP # --flush æ¸…ç©º INPUT è¡¨ä¸Šçš„æ‰€æœ‰è§„åˆ™ iptables -F INPUT æœ¬æ–‡åç»­åˆ†ææ—¶ï¼Œå‡è®¾ç”¨æˆ·å·²ç»æ¸…æ¥š linux bridgeã€veth ç­‰è™šæ‹Ÿç½‘ç»œæ¥å£ç›¸å…³çŸ¥è¯†ã€‚ å¦‚æœä½ è¿˜ç¼ºå°‘è¿™äº›å‰ç½®çŸ¥è¯†ï¼Œè¯·å…ˆé˜…è¯»æ–‡ç«  Linux ä¸­çš„è™šæ‹Ÿç½‘ç»œæ¥å£ã€‚ ","date":"2021-08-15","objectID":"/posts/iptables-and-container-networks/:2:0","tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨","iptables","conntrack"],"title":"iptables åŠ docker å®¹å™¨ç½‘ç»œåˆ†æ","uri":"/posts/iptables-and-container-networks/"},{"categories":["æŠ€æœ¯"],"content":"conntrack è¿æ¥è·Ÿè¸ªä¸ NAT åœ¨è®² conntrack ä¹‹é—´ï¼Œæˆ‘ä»¬å†å›é¡¾ä¸‹å‰é¢ç»™å‡ºè¿‡çš„ netfilter æ•°æ®å¤„ç†æµç¨‹å›¾ï¼š netfilter æ•°æ®åŒ…å¤„ç†æµç¨‹ï¼Œæ¥è‡ª wikipedia\" netfilter æ•°æ®åŒ…å¤„ç†æµç¨‹ï¼Œæ¥è‡ª wikipedia ä¸Šä¸€èŠ‚ä¸­æˆ‘ä»¬å¿½ç•¥äº†å›¾ä¸­çš„ conntrackï¼Œå®ƒå°±æ˜¯æœ¬èŠ‚çš„ä¸»è§’â€”â€”netfilter çš„è¿æ¥è·Ÿè¸ªï¼ˆconnection trackingï¼‰æ¨¡å—ã€‚ netfilter/conntrack æ˜¯ iptables å®ç° SNAT/DNAT/MASQUERADE çš„å‰ææ¡ä»¶ï¼Œä¸Šé¢çš„æµç¨‹å›¾æ˜¾ç¤ºï¼Œ conntrack åœ¨ PREROUTEING å’Œ OUTPUT é“¾çš„ raw è¡¨ä¹‹åç”Ÿæ•ˆã€‚ ä¸‹é¢ä»¥ docker é»˜è®¤çš„ bridge ç½‘ç»œä¸ºä¾‹è¯¦ç»†ä»‹ç»ä¸‹ conntrack çš„åŠŸèƒ½ã€‚ é¦–å…ˆï¼Œè¿™æ˜¯æˆ‘åœ¨ã€ŒLinux çš„è™šæ‹Ÿç½‘ç»œæ¥å£ã€æ–‡ä¸­ç»™å‡ºè¿‡çš„ docker0 ç½‘ç»œæ¶æ„å›¾: +-----------------------------------------------+-----------------------------------+-----------------------------------+ | Host | Container A | Container B | | | | | | +---------------------------------------+ | +-------------------------+ | +-------------------------+ | | | Network Protocol Stack | | | Network Protocol Stack | | | Network Protocol Stack | | | +----+-------------+--------------------+ | +-----------+-------------+ | +------------+------------+ | | ^ ^ | ^ | ^ | |........|.............|........................|................|..................|.................|.................| | v v â†“ | v | v | | +----+----+ +-----+------+ | +-----+-------+ | +-----+-------+ | | | .31.101 | | 172.17.0.1 | +------+ | | 172.17.0.2 | | | 172.17.0.3 | | | +---------+ +-------------\u003c----\u003e+ veth | | +-------------+ | +-------------+ | | | eth0 | | docker0 | +--+---+ | | eth0(veth) | | | eth0(veth) | | | +----+----+ +-----+------+ ^ | +-----+-------+ | +-----+-------+ | | ^ ^ | | ^ | ^ | | | | +------------------------+ | | | | | v | | | | | | +--+---+ | | | | | | | veth | | | | | | | +--+---+ | | | | | | ^ | | | | | | +------------------------------------------------------------------------------+ | | | | | | | | | | | +-----------------------------------------------+-----------------------------------+-----------------------------------+ v Physical Network (192.168.31.0/24) docker ä¼šåœ¨ iptables ä¸­ä¸º docker0 ç½‘æ¡¥æ·»åŠ å¦‚ä¸‹è§„åˆ™ï¼š -t nat -A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE -t filter -P DROP -t filter -A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT è¿™å‡ è¡Œè§„åˆ™ä½¿ docker å®¹å™¨èƒ½æ­£å¸¸è®¿é—®å¤–éƒ¨ç½‘ç»œã€‚MASQUERADE åœ¨è¯·æ±‚å‡ºç½‘æ—¶ï¼Œä¼šè‡ªåŠ¨åš SNATï¼Œå°† src ip æ›¿æ¢æˆå‡ºå£ç½‘å¡çš„ ip. è¿™æ ·æ•°æ®åŒ…èƒ½æ­£å¸¸å‡ºç½‘ï¼Œè€Œä¸”å¯¹ç«¯è¿”å›çš„æ•°æ®åŒ…ç°åœ¨ä¹Ÿèƒ½æ­£å¸¸å›åˆ°å‡ºå£ç½‘å¡ã€‚ ç°åœ¨é—®é¢˜å°±æ¥äº†ï¼šå‡ºå£ç½‘å¡æ”¶åˆ°è¿”å›çš„æ•°æ®åŒ…åï¼Œè¿˜èƒ½å¦å°†æ•°æ®åŒ…è½¬å‘åˆ°æ•°æ®çš„åˆå§‹æ¥æºç«¯â€”â€”æŸä¸ª docker å®¹å™¨ï¼Ÿéš¾é“ docker è¿˜é¢å¤–æ·»åŠ äº†ä¸ MASQUERADE å¯¹åº”çš„ dst ip åå‘è½¬æ¢è§„åˆ™ï¼Ÿ å®é™…ä¸Šè¿™ä¸€æ­¥ä¾èµ–çš„æ˜¯æœ¬èŠ‚çš„ä¸»è§’â€”â€”iptables æä¾›çš„ conntrack è¿æ¥è·Ÿè¸ªåŠŸèƒ½ï¼ˆåœ¨ã€Œå‚è€ƒã€ä¸­æœ‰ä¸€ç¯‡æ–‡ç« è¯¦ç»†ä»‹ç»äº†æ­¤åŠŸèƒ½ï¼‰ã€‚ è¿æ¥è·Ÿè¸ªå¯¹ NAT çš„è´¡çŒ®æ˜¯ï¼šåœ¨åš NAT è½¬æ¢æ—¶ï¼Œæ— éœ€æ‰‹åŠ¨æ·»åŠ é¢å¤–çš„è§„åˆ™æ¥æ‰§è¡Œåå‘è½¬æ¢ä»¥å®ç°æ•°æ®çš„åŒå‘ä¼ è¾“ã€‚netfilter/conntrack ç³»ç»Ÿä¼šè®°å½• NAT çš„è¿æ¥çŠ¶æ€ï¼ŒNAT åœ°å€çš„åå‘è½¬æ¢æ˜¯æ ¹æ®è¿™ä¸ªçŠ¶æ€è‡ªåŠ¨å®Œæˆçš„ã€‚ æ¯”å¦‚ä¸Šå›¾ä¸­çš„ Container A é€šè¿‡ bridge ç½‘ç»œå‘ baidu.com å‘èµ·äº† N ä¸ªè¿æ¥ï¼Œè¿™æ—¶æ•°æ®çš„å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š é¦–å…ˆ Container A å‘å‡ºçš„æ•°æ®åŒ…è¢« MASQUERADE è§„åˆ™å¤„ç†ï¼Œå°† src ip æ›¿æ¢æˆ eth0 çš„ ipï¼Œç„¶åå‘é€åˆ°ç‰©ç†ç½‘ç»œ 192..168.31.0/24ã€‚ conntrack ç³»ç»Ÿè®°å½•æ­¤è¿æ¥è¢« NAT å¤„ç†å‰åçš„çŠ¶æ€ä¿¡æ¯ï¼Œå¹¶å°†å…¶çŠ¶æ€è®¾ç½®ä¸º NEWï¼Œè¡¨ç¤ºè¿™æ˜¯æ–°å‘èµ·çš„ä¸€ä¸ªè¿æ¥ å¯¹ç«¯ baidu.com è¿”å›æ•°æ®åŒ…åï¼Œä¼šé¦–å…ˆåˆ°è¾¾ eth0 ç½‘å¡ conntrack æŸ¥è¡¨ï¼Œå‘ç°è¿”å›æ•°æ®åŒ…çš„è¿æ¥å·²ç»è®°å½•åœ¨è¡¨ä¸­å¹¶ä¸”çŠ¶æ€ä¸º NEWï¼Œäºæ˜¯å®ƒå°†è¿æ¥çš„çŠ¶æ€ä¿®æ”¹ä¸º ESTABLISHEDï¼Œå¹¶ä¸”å°† dst_ip æ”¹ä¸º 172.17.0.2 ç„¶åå‘é€å‡ºå» æ³¨æ„ï¼Œè¿™ä¸ªå’Œ tcp çš„ ESTABLISHED æ²¡ä»»ä½•å…³ç³» ç»è¿‡è·¯ç”±åŒ¹é…ï¼Œæ•°æ®åŒ…ä¼šè¿›å…¥åˆ° docker0ï¼Œç„¶ååŒ¹é…ä¸Š iptables è§„åˆ™ï¼š-t filter -A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPTï¼Œæ•°æ®ç›´æ¥è¢«æ”¾è¡Œ æ•°æ®ç»è¿‡ veth åï¼Œæœ€ç»ˆè¿›å…¥åˆ° Container A ä¸­ï¼Œäº¤ç”±å®¹å™¨çš„å†…æ ¸åè®®æ ˆå¤„ç†ã€‚ æ•°æ®è¢« Container A çš„å†…æ ¸åè®®æ ˆå‘é€åˆ°ã€Œå‘èµ·è¿æ¥çš„åº”ç”¨ç¨‹åºã€ã€‚ ","date":"2021-08-15","objectID":"/posts/iptables-and-container-networks/:3:0","tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨","iptables","conntrack"],"title":"iptables åŠ docker å®¹å™¨ç½‘ç»œåˆ†æ","uri":"/posts/iptables-and-container-networks/"},{"categories":["æŠ€æœ¯"],"content":"å®é™…æµ‹è¯• conntrack ç°åœ¨æˆ‘ä»¬æ¥å®é™…æµ‹è¯•ä¸€ä¸‹ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯è¿™ä¹ˆå›äº‹ï¼š # ä½¿ç”¨ tcpdump åˆ†åˆ«åœ¨å‡ºå£ç½‘å¡ wlp4s0 ï¼ˆç›¸å½“äº eth0ï¼‰å’Œ dcoker0 ç½‘æ¡¥ä¸ŠæŠ“åŒ…ï¼Œåé¢ä¼šç”¨æ¥åˆ†æ â¯ sudo tcpdump -i wlp4s0 -n \u003e wlp4s0.dump # çª—å£ä¸€ï¼ŒæŠ“ wlp4s0 çš„åŒ… â¯ sudo tcpdump -i docker0 -n \u003e docker0.dump # çª—å£äºŒï¼ŒæŠ“ docker0 çš„åŒ… ç°åœ¨æ–°å»ºçª—å£ä¸‰ï¼Œå¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œé€šè¿‡ curl å‘½ä»¤ä½é€Ÿä¸‹è½½ä¸€ä¸ªè§†é¢‘æ–‡ä»¶ï¼š â¯ docker run --rm --name curl -it curlimages/curl \"https://media.w3.org/2010/05/sintel/trailer.mp4\" -o /tmp/video.mp4 --limit-rate 100k ç„¶åæ–°å»ºçª—å£å››ï¼Œåœ¨å®¿ä¸»æœºæŸ¥çœ‹ conntrack çŠ¶æ€ â¯ sudo zypper in conntrack-tools # è¿™ä¸ªè®°å¾—å…ˆæå‰å®‰è£…å¥½ â¯ sudo conntrack -L | grep 172.17 # curl é€šè¿‡ NAT ç½‘ç»œå‘èµ·äº†ä¸€ä¸ª dns æŸ¥è¯¢è¯·æ±‚ï¼ŒDNS æœåŠ¡å™¨æ˜¯ç½‘å…³ä¸Šçš„ 192.168.31.1 udp 17 22 src=172.17.0.4 dst=192.168.31.1 sport=59423 dport=53 src=192.168.31.1 dst=192.168.31.228 sport=53 dport=59423 [ASSURED] mark=0 use=1 # curl é€šè¿‡ NAT ç½‘ç»œå‘ media.w3.org å‘èµ·äº† tcp è¿æ¥ tcp 6 298 ESTABLISHED src=172.17.0.4 dst=198.18.5.130 sport=54636 dport=443 src=198.18.5.130 dst=192.168.31.228 sport=443 dport=54636 [ASSURED] mark=0 use=1 ç­‰ curl å‘½ä»¤è·‘ä¸ªåæ¥ç§’ï¼Œç„¶åå…³é—­æ‰€æœ‰çª—å£åŠåº”ç”¨ç¨‹åºï¼Œæ¥ä¸‹æ¥è¿›è¡Œæ•°æ®åˆ†æï¼š # å‰é¢æŸ¥åˆ°çš„ï¼Œæœ¬åœ°å‘èµ·è¯·æ±‚çš„ç«¯å£æ˜¯ 54636ï¼Œä¸‹é¢ä»¥æ­¤ä¸ºè¿‡æ»¤æ¡ä»¶æŸ¥è¯¢æ•°æ® # é¦–å…ˆæŸ¥è¯¢ wlp4s0/eth0 è¿›æ¥çš„æ•°æ®ï¼Œå¯ä»¥çœ‹åˆ°æœ¬æœºçš„ dst_ip ä¸º 192.168.31.228.54636 â¯ cat wlp4s0.dump | grep 54636 | head -n 15 18:28:28.349321 IP 192.168.31.228.54636 \u003e 198.18.5.130.443: Flags [S], seq 750859357, win 64240, options [mss 1460,sackOK,TS val 3365688110 ecr 0,nop,wscale 7], length 0 18:28:28.350757 IP 198.18.5.130.443 \u003e 192.168.31.228.54636: Flags [S.], seq 2381759932, ack 750859358, win 28960, options [mss 1460,sackOK,TS val 22099541 ecr 3365688110,nop,wscale 5], length 0 18:28:28.350814 IP 192.168.31.228.54636 \u003e 198.18.5.130.443: Flags [.], ack 1, win 502, options [nop,nop,TS val 3365688111 ecr 22099541], length 0 18:28:28.357345 IP 192.168.31.228.54636 \u003e 198.18.5.130.443: Flags [P.], seq 1:518, ack 1, win 502, options [nop,nop,TS val 3365688118 ecr 22099541], length 517 18:28:28.359253 IP 198.18.5.130.443 \u003e 192.168.31.228.54636: Flags [.], ack 518, win 939, options [nop,nop,TS val 22099542 ecr 3365688118], length 0 18:28:28.726544 IP 198.18.5.130.443 \u003e 192.168.31.228.54636: Flags [P.], seq 1:2622, ack 518, win 939, options [nop,nop,TS val 22099579 ecr 3365688118], length 2621 18:28:28.726616 IP 192.168.31.228.54636 \u003e 198.18.5.130.443: Flags [.], ack 2622, win 482, options [nop,nop,TS val 3365688487 ecr 22099579], length 0 18:28:28.727652 IP 192.168.31.228.54636 \u003e 198.18.5.130.443: Flags [P.], seq 518:598, ack 2622, win 501, options [nop,nop,TS val 3365688488 ecr 22099579], length 80 18:28:28.727803 IP 192.168.31.228.54636 \u003e 198.18.5.130.443: Flags [P.], seq 598:644, ack 2622, win 501, options [nop,nop,TS val 3365688488 ecr 22099579], length 46 18:28:28.727828 IP 192.168.31.228.54636 \u003e 198.18.5.130.443: Flags [P.], seq 644:693, ack 2622, win 501, options [nop,nop,TS val 3365688488 ecr 22099579], length 49 18:28:28.727850 IP 192.168.31.228.54636 \u003e 198.18.5.130.443: Flags [P.], seq 693:728, ack 2622, win 501, options [nop,nop,TS val 3365688488 ecr 22099579], length 35 18:28:28.727875 IP 192.168.31.228.54636 \u003e 198.18.5.130.443: Flags [P.], seq 728:812, ack 2622, win 501, options [nop,nop,TS val 3365688488 ecr 22099579], length 84 18:28:28.729241 IP 198.18.5.130.443 \u003e 192.168.31.228.54636: Flags [.], ack 598, win 939, options [nop,nop,TS val 22099579 ecr 3365688488], length 0 18:28:28.729245 IP 198.18.5.130.443 \u003e 192.168.31.228.54636: Flags [.], ack 644, win 939, options [nop,nop,TS val 22099579 ecr 3365688488], length 0 18:28:28.729247 IP 198.18.5.130.443 \u003e 192.168.31.228.54636: Flags [.], ack 693, win 939, options [nop,nop,TS val 22099579 ecr 3365688488], length 0 # ç„¶åå†æŸ¥è¯¢ docker0 ä¸Šçš„æ•°æ®ï¼Œèƒ½å‘ç°æœ¬åœ°çš„åœ°å€ä¸º 172.17.0.4.54636 â¯ cat docker0.dump | grep 54636 | head -n 20 18:28:28.349299 IP 172.17.0.4.54636 \u003e 198.18.5.130.443: Flags [S], seq 750859357, win 64240, options [mss 1460,sackOK,TS val 3365688110 ecr 0,nop,wscale 7], length 0 18:28:28.350780 IP 198.18.5.130.443 \u003e 172.17.0.4.54636: Flags [S.], seq 2381759932, ack 750859358, win 28960, options [mss 1460,sackOK,TS val 22099541 ecr 3365688110,nop,wscale 5], length 0 18:28:28.350812 IP 172.17.0.4.54636 \u003e 198.18.5.130.443: Flags [.], ","date":"2021-08-15","objectID":"/posts/iptables-and-container-networks/:3:1","tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨","iptables","conntrack"],"title":"iptables åŠ docker å®¹å™¨ç½‘ç»œåˆ†æ","uri":"/posts/iptables-and-container-networks/"},{"categories":["æŠ€æœ¯"],"content":"NAT å¦‚ä½•åˆ†é…ç«¯å£ï¼Ÿ ä¸Šä¸€èŠ‚æˆ‘ä»¬å®é™…æµ‹è¯•å‘ç°ï¼Œdocker å®¹å™¨çš„æµé‡åœ¨ç»è¿‡ iptables çš„ MASQUERADE è§„åˆ™å¤„ç†åï¼Œåªæœ‰ src ip è¢«ä¿®æ”¹äº†ï¼Œè€Œ port ä»ç„¶æ˜¯ä¸€è‡´çš„ã€‚ ä½†æ˜¯å¦‚æœ NAT ä¸ä¿®æ”¹è¿æ¥çš„ç«¯å£ï¼Œå®é™…ä¸Šæ˜¯ä¼šæœ‰é—®é¢˜çš„ã€‚å¦‚æœæœ‰ä¸¤ä¸ªå®¹å™¨åŒæ—¶å‘ ip: 198.18.5.130, port: 443 å‘èµ·è¯·æ±‚ï¼Œåˆæ°å¥½ä½¿ç”¨äº†åŒä¸€ä¸ª src portï¼Œåœ¨å®¿ä¸»æœºä¸Šå°±ä¼šå‡ºç°ç«¯å£å†²çªï¼ å› ä¸ºè¿™ä¸¤ä¸ªè¯·æ±‚è¢« SNAT æ—¶ï¼Œå¦‚æœåªä¿®æ”¹ src ipï¼Œé‚£å®ƒä»¬æ˜ å°„åˆ°çš„å°†æ˜¯ä¸»æœºä¸Šçš„åŒä¸€ä¸ªè¿æ¥ï¼ è¿™ä¸ªé—®é¢˜ NAT æ˜¯å¦‚ä½•è§£å†³çš„å‘¢ï¼Ÿæˆ‘æƒ³å¦‚æœé‡åˆ°è¿™ç§æƒ…å†µï¼ŒNAT åº”è¯¥ä¼šé€šè¿‡ä¸€å®šçš„è§„åˆ™é€‰ç”¨ä¸€ä¸ªä¸åŒçš„ç«¯å£ã€‚ æœ‰ç©ºå¯ä»¥ç¿»ä¸€æ³¢æºç çœ‹çœ‹è¿™ä¸ªï¼Œå¾…ç»­â€¦ ","date":"2021-08-15","objectID":"/posts/iptables-and-container-networks/:3:2","tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨","iptables","conntrack"],"title":"iptables åŠ docker å®¹å™¨ç½‘ç»œåˆ†æ","uri":"/posts/iptables-and-container-networks/"},{"categories":["æŠ€æœ¯"],"content":"å¦‚ä½•æŒä¹…åŒ– iptables é…ç½® é¦–å…ˆéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œcentos7/opensuse 15 éƒ½å·²ç»åˆ‡æ¢åˆ°äº† firewalld ä½œä¸ºé˜²ç«å¢™é…ç½®è½¯ä»¶ï¼Œ è€Œ ubuntu18.04 lts ä¹Ÿæ¢æˆäº† ufw æ¥é…ç½®é˜²ç«å¢™ã€‚ åŒ…æ‹¬ docker åº”è¯¥ä¹Ÿæ˜¯åœ¨å¯åŠ¨çš„æ—¶å€™åŠ¨æ€æ·»åŠ  iptables é…ç½®ã€‚ å¯¹äºä¸Šè¿°æ–°ç³»ç»Ÿï¼Œè¿˜æ˜¯å»ºè®®ç›´æ¥ä½¿ç”¨ firewalld/ufw é…ç½®é˜²ç«å¢™å§ï¼Œæˆ–è€…ç½‘ä¸Šæœä¸‹å…³é—­ ufw/firewalldã€å¯ç”¨ iptables æŒä¹…åŒ–çš„è§£å†³æ–¹æ¡ˆã€‚ æœ¬æ–‡ä¸»è¦ç›®çš„åœ¨äºç†è§£ docker å®¹å™¨ç½‘ç»œçš„åŸç†ï¼Œä»¥åŠä¸ºåé¢ç†è§£ kubernetes ç½‘ç»œæ’ä»¶ calico/flannel æ‰“å¥½åŸºç¡€ï¼Œå› æ­¤å°±ä¸å¤šä»‹ç»æŒä¹…åŒ–äº†ã€‚ ","date":"2021-08-15","objectID":"/posts/iptables-and-container-networks/:4:0","tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨","iptables","conntrack"],"title":"iptables åŠ docker å®¹å™¨ç½‘ç»œåˆ†æ","uri":"/posts/iptables-and-container-networks/"},{"categories":["æŠ€æœ¯"],"content":"å¦‚ä½•ä½¿ç”¨ iptables + bridge + veth å®ç°å®¹å™¨ç½‘ç»œ Docker/Podman é»˜è®¤ä½¿ç”¨çš„éƒ½æ˜¯ bridge ç½‘ç»œï¼Œå®ƒä»¬çš„åº•å±‚å®ç°å®Œå…¨ç±»ä¼¼ã€‚ä¸‹é¢ä»¥ docker ä¸ºä¾‹è¿›è¡Œåˆ†æï¼ˆPodman çš„åˆ†ææµç¨‹ä¹ŸåŸºæœ¬ä¸€æ ·ï¼‰ã€‚ ","date":"2021-08-15","objectID":"/posts/iptables-and-container-networks/:5:0","tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨","iptables","conntrack"],"title":"iptables åŠ docker å®¹å™¨ç½‘ç»œåˆ†æ","uri":"/posts/iptables-and-container-networks/"},{"categories":["æŠ€æœ¯"],"content":"é€šè¿‡ docker run è¿è¡Œå®¹å™¨ é¦–å…ˆï¼Œä½¿ç”¨ docker run è¿è¡Œå‡ ä¸ªå®¹å™¨ï¼Œæ£€æŸ¥ä¸‹ç½‘ç»œçŠ¶å†µï¼š # è¿è¡Œä¸€ä¸ª debian å®¹å™¨å’Œä¸€ä¸ª nginx â¯ docker run -dit --name debian --rm debian:buster sleep 1000000 â¯ docker run -dit --name nginx --rm nginx:1.19-alpine #ã€€æŸ¥çœ‹ç½‘ç»œæ¥å£ï¼Œæœ‰ä¸¤ä¸ª veth æ¥å£ï¼ˆè€Œä¸”éƒ½æ²¡è®¾ ip åœ°å€ï¼‰ï¼Œåˆ†åˆ«è¿æ¥åˆ°ä¸¤ä¸ªå®¹å™¨çš„ eth0ï¼ˆdcoker0 ç½‘ç»œæ¶æ„å›¾å‰é¢ç»™è¿‡äº†ï¼Œå¯ä»¥å¾€å‰é¢ç¿»ç¿»å¯¹ç…§ä¸‹ï¼‰ â¯ ip addr ls ... 5: docker0: \u003cBROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 qdisc noqueue state UP group default link/ether 02:42:42:c7:12:ba brd ff:ff:ff:ff:ff:ff inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0 valid_lft forever preferred_lft forever inet6 fe80::42:42ff:fec7:12ba/64 scope link valid_lft forever preferred_lft forever 100: veth16b37ea@if99: \u003cBROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 qdisc noqueue master docker0 state UP group default link/ether 42:af:34:ae:74:ae brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet6 fe80::40af:34ff:feae:74ae/64 scope link valid_lft forever preferred_lft forever 102: veth4b4dada@if101: \u003cBROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 qdisc noqueue master docker0 state UP group default link/ether 9e:f1:58:1a:cf:ae brd ff:ff:ff:ff:ff:ff link-netnsid 1 inet6 fe80::9cf1:58ff:fe1a:cfae/64 scope link valid_lft forever preferred_lft forever # ä¸¤ä¸ª veth æ¥å£éƒ½è¿æ¥åˆ°äº† docker0 ä¸Šé¢ï¼Œè¯´æ˜ä¸¤ä¸ªå®¹å™¨éƒ½ä½¿ç”¨äº† docker é»˜è®¤çš„ bridge ç½‘ç»œ â¯ sudo brctl show bridge name bridge id STP enabled interfaces docker0 8000.024242c712ba no veth16b37ea veth4b4dada # æŸ¥çœ‹è·¯ç”±è§„åˆ™ â¯ ip route ls default via 192.168.31.1 dev wlp4s0 proto dhcp metric 600 #ä¸‹åˆ—è·¯ç”±è§„åˆ™å°† `172.17.0.0/16` ç½‘æ®µçš„æ‰€æœ‰æµé‡è½¬å‘åˆ° docker0 172.17.0.0/16 dev docker0 proto kernel scope link src 172.17.0.1 linkdown 192.168.31.0/24 dev wlp4s0 proto kernel scope link src 192.168.31.228 metric 600 # æŸ¥çœ‹ã€€iptables è§„åˆ™ # NAT è¡¨ â¯ sudo iptables -t nat -S -P PREROUTING ACCEPT -P INPUT ACCEPT -P OUTPUT ACCEPT -P POSTROUTING ACCEPT -N DOCKER # æ‰€æœ‰ç›®çš„åœ°å€åœ¨æœ¬æœºçš„ï¼Œéƒ½å…ˆäº¤ç»™ DOCKER é“¾å¤„ç†ä¸€æ³¢ -A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER -A OUTPUT ! -d 127.0.0.0/8 -m addrtype --dst-type LOCAL -j DOCKER # ï¼ˆå®¹å™¨è®¿é—®å¤–éƒ¨ç½‘ç»œï¼‰æ‰€æœ‰å‡ºå£ä¸ä¸º docker0 çš„æµé‡ï¼Œéƒ½åšä¸‹ SNATï¼ŒæŠŠ src ip æ¢æˆå‡ºå£æ¥å£çš„ ip åœ°å€ -A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE -A DOCKER -i docker0 -j RETURN # filter è¡¨ â¯ sudo iptables -t filter -S -P INPUT ACCEPT -P FORWARD DROP -P OUTPUT ACCEPT -N DOCKER -N DOCKER-ISOLATION-STAGE-1 -N DOCKER-ISOLATION-STAGE-2 -N DOCKER-USER # æ‰€æœ‰æµé‡éƒ½å¿…é¡»å…ˆç»è¿‡å¦‚ä¸‹ä¸¤ä¸ªé“¾çš„å¤„ç†ï¼Œæ²¡é—®é¢˜æ‰èƒ½ç»§ç»­å¾€ä¸‹èµ° -A FORWARD -j DOCKER-ISOLATION-STAGE-1 -A FORWARD -j DOCKER-USER # ï¼ˆå®¹å™¨è®¿é—®å¤–éƒ¨ç½‘ç»œï¼‰å‡ºå»çš„æµé‡èµ°äº† MASQUERADEï¼Œå›æ¥çš„æµé‡ä¼šè¢« conntrack è¯†åˆ«å¹¶è½¬å‘å›æ¥ï¼Œè¿™é‡Œå…è®¸è¿”å›çš„æ•°æ®åŒ…é€šè¿‡ã€‚ # è¿™é‡Œç›´æ¥ ACCEPT è¢« conntrack è¯†åˆ«åˆ°çš„æµé‡ -A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT # å°†æ‰€æœ‰è®¿é—® docker0 çš„æµé‡éƒ½è½¬ç»™è‡ªå®šä¹‰é“¾ DOCKER å¤„ç† -A FORWARD -o docker0 -j DOCKER # å…è®¸æ‰€æœ‰æ¥è‡ª docker0 çš„æµé‡é€šè¿‡ï¼Œä¸è®ºä¸‹ä¸€è·³æ˜¯å¦æ˜¯ docker0 -A FORWARD -i docker0 ! -o docker0 -j ACCEPT -A FORWARD -i docker0 -o docker0 -j ACCEPT # ä¸‹é¢ä¸‰ä¸ªé“¾ç›®å‰å•¥è§„åˆ™ä¹Ÿæ²¡æœ‰ï¼Œå°±æ˜¯ç®€å•çš„ RETURNï¼Œäº¤ç»™åé¢çš„è¡¨ç»§ç»­å¤„ç† -A DOCKER-ISOLATION-STAGE-1 -j RETURN -A DOCKER-ISOLATION-STAGE-2 -j RETURN -A DOCKER-USER -j RETURN æ¥ä¸‹æ¥ä½¿ç”¨å¦‚ä¸‹ docker-compose é…ç½®å¯åŠ¨ä¸€ä¸ª caddyã€€å®¹å™¨ï¼Œæ·»åŠ è‡ªå®šä¹‰ network å’Œç«¯å£æ˜ å°„ï¼Œå¾…ä¼šå°±èƒ½éªŒè¯ docker æ˜¯å¦‚ä½•å®ç°è¿™ä¸¤ç§ç½‘ç»œçš„äº†ã€‚ docker-compose.yml å†…å®¹ï¼š version:\"3.3\"services:caddy:image:\"caddy:2.2.1-alpine\"container_name:\"caddy\"restart:alwayscommand:caddy file-server --browse --root /data/staticports:- \"8081:80\"volumes:- \"/home/ryan/Downloads:/data/static\"networks:- caddy-1networks:caddy-1: ç°åœ¨å…ˆç”¨ä¸Šé¢çš„é…ç½®å¯åŠ¨ caddy å®¹å™¨ï¼Œç„¶åå†æŸ¥çœ‹ç½‘ç»œçŠ¶å†µï¼š # å¯åŠ¨ caddy â¯ docker-compose up -d # æŸ¥ä¸‹ caddy å®¹å™¨çš„ ip \u003e docker inspect caddy | grep IPAddress ... \"IPAddress\": \"172.18.0.2\", # æŸ¥çœ‹ç½‘ç»œæ¥å£ï¼Œå¯ä»¥çœ‹åˆ°å¤šäº†ä¸€ä¸ªç½‘æ¡¥ï¼Œå®ƒå°±æ˜¯ä¸Šä¸€è¡Œå‘½ä»¤åˆ›å»ºçš„ caddy-1 ç½‘ç»œ # è¿˜å¤šäº†ä¸€ä¸ª vethï¼Œå®ƒè¿æ¥åˆ°äº† caddy å®¹å™¨çš„ eth0(veth) æ¥å£ â¯ ip addr ls ... 5: docker0: \u003cBROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 qdisc noqueue state UP group default link/ether 02:42:42:c7:12:ba brd ff:ff:ff:ff:ff:ff inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0 valid_lft forever preferred_lft forever inet6 fe80::42:42ff:fec7:12ba/64 scope link valid_lft forever preferred_lft forever 100: veth16b37ea@if99: \u003cBROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 qdisc noqueue master docker0 state UP group default link/ether 42:af:34:ae:74:ae brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet6 fe80::40af:34ff:feae:74ae/64 sc","date":"2021-08-15","objectID":"/posts/iptables-and-container-networks/:5:1","tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨","iptables","conntrack"],"title":"iptables åŠ docker å®¹å™¨ç½‘ç»œåˆ†æ","uri":"/posts/iptables-and-container-networks/"},{"categories":["æŠ€æœ¯"],"content":"Docker/Podman çš„ macvlan/ipvlan æ¨¡å¼ æ³¨æ„ï¼šmacvlan å’Œ wifi å¥½åƒä¸å…¼å®¹ï¼Œæµ‹è¯•æ—¶ä¸è¦ä½¿ç”¨æ— çº¿ç½‘ç»œçš„æ¥å£ï¼ æˆ‘åœ¨å‰é¢ä»‹ç» Linux è™šæ‹Ÿç½‘ç»œæ¥å£çš„æ–‡ç« ä¸­ï¼Œæœ‰ä»‹ç»è¿‡ macvlan å’Œ ipvlan ä¸¤ç§æ–°çš„è™šæ‹Ÿæ¥å£ã€‚ ç›®å‰ Podman/Docker éƒ½æ”¯æŒä½¿ç”¨ macvlan æ¥æ„å»ºå®¹å™¨ç½‘ç»œï¼Œè¿™ç§æ¨¡å¼ä¸‹åˆ›å»ºçš„å®¹å™¨ç›´è¿å¤–éƒ¨ç½‘ç»œï¼Œå®¹å™¨å¯ä»¥æ‹¥æœ‰ç‹¬ç«‹çš„å¤–éƒ¨ IPï¼Œä¸éœ€è¦ç«¯å£æ˜ å°„ï¼Œä¹Ÿä¸éœ€è¦å€ŸåŠ© iptables. è¿™å’Œè™šæ‹Ÿæœºçš„ Bridge æ¨¡å¼å°±å¾ˆç±»ä¼¼ï¼Œä¸»è¦é€‚ç”¨äºå¸Œæœ›å®¹å™¨æ‹¥æœ‰ç‹¬ç«‹å¤–éƒ¨ IP çš„æƒ…å†µã€‚ ä¸‹é¢è¯¦ç»†åˆ†æä¸‹ Docker çš„ macvlan ç½‘ç»œï¼ˆPodman åº”è¯¥ä¹Ÿå®Œå…¨ç±»ä¼¼ï¼‰ã€‚ # é¦–å…ˆåˆ›å»ºä¸€ä¸ª macvlan ç½‘ç»œ # subnet/gateway çš„å‚æ•°éœ€è¦å’Œç‰©ç†ç½‘ç»œä¸€è‡´ # é€šè¿‡ -o parent è®¾å®šçˆ¶æ¥å£ï¼Œæˆ‘æœ¬æœºçš„ä»¥å¤ªç½‘å£åç§°ä¸º eno1 $ docker network create -d macvlan \\ --subnet=192.168.31.0/24 \\ --gateway=192.168.31.1 \\ -o parent=eno1 \\ macnet0 # ç°åœ¨ä½¿ç”¨ macvlan å¯åŠ¨ä¸€ä¸ªå®¹å™¨è¯•è¯• # å»ºè®®å’Œæˆ‘ä¸€æ ·ï¼Œé€šè¿‡ --ip æ‰‹åŠ¨é…ç½®é™æ€ ip åœ°å€ï¼Œå½“ç„¶ä¸é…ä¹Ÿå¯ä»¥ï¼ŒDHCP ä¼šè‡ªåŠ¨åˆ†é… IP $ docker run --network macnet0 --ip=192.168.31.233 --rm -it buildpack-deps:buster-curl /bin/bash # åœ¨å®¹å™¨ä¸­æŸ¥çœ‹ç½‘ç»œæ¥å£çŠ¶å†µï¼Œèƒ½çœ‹åˆ° eth0 æ˜¯ä¸€ä¸ª macvlan æ¥å£ root@4319488cb5e7:/# ip -d addr ls 1: lo: \u003cLOOPBACK,UP,LOWER_UP\u003e mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 promiscuity 0 minmtu 0 maxmtu 0 numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever 8: eth0@if2: \u003cBROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 qdisc noqueue state UP group default link/ether 02:42:c0:a8:1f:e9 brd ff:ff:ff:ff:ff:ff link-netnsid 0 promiscuity 0 minmtu 68 maxmtu 9194 macvlan mode bridge numtxqueues 1 numrxqueues 1 gso_max_size 64000 gso_max_segs 64 inet 192.168.31.233/24 brd 192.168.31.255 scope global eth0 valid_lft forever preferred_lft forever # è·¯ç”±è¡¨ï¼Œé»˜è®¤ gateway è¢«è‡ªåŠ¨é…ç½®è¿›æ¥äº† root@4319488cb5e7:/# ip route ls default via 192.168.31.1 dev eth0 192.168.31.0/24 dev eth0 proto kernel scope link src 192.168.31.233 # å¯ä»¥æ­£å¸¸è®¿é—® baidu root@4319488cb5e7:/# curl baidu.com \u003chtml\u003e \u003cmeta http-equiv=\"refresh\" content=\"0;url=http://www.baidu.com/\"\u003e \u003c/html\u003e Docker æ”¯æŒçš„å¦ä¸€ç§ç½‘ç»œæ¨¡å¼æ˜¯ ipvlanï¼ˆipvlan å’Œ macvlan çš„åŒºåˆ«æˆ‘åœ¨å‰ä¸€ç¯‡æ–‡ç« ä¸­å·²ç»ä»‹ç»è¿‡ï¼Œä¸å†èµ˜è¨€ï¼‰ï¼Œåˆ›å»ºå‘½ä»¤å’Œ macvlan å‡ ä¹ä¸€æ ·ï¼š # é¦–å…ˆåˆ›å»ºä¸€ä¸ª macvlan ç½‘ç»œ # subnet/gateway çš„å‚æ•°éœ€è¦å’Œç‰©ç†ç½‘ç»œä¸€è‡´ # é€šè¿‡ -o parent è®¾å®šçˆ¶æ¥å£ï¼Œæˆ‘æœ¬æœºçš„ä»¥å¤ªç½‘å£åç§°ä¸º eno1 # ipvlan_mode é»˜è®¤ä¸º l2ï¼Œè¡¨ç¤ºå·¥ä½œåœ¨æ•°æ®é“¾è·¯å±‚ã€‚ $ docker network create -d ipvlan \\ --subnet=192.168.31.0/24 \\ --gateway=192.168.31.1 \\ -o parent=eno1 \\ -o ipvlan_mode=l2 \\ ipvnet0 # ç°åœ¨ä½¿ç”¨ macvlan å¯åŠ¨ä¸€ä¸ªå®¹å™¨è¯•è¯• # å»ºè®®å’Œæˆ‘ä¸€æ ·ï¼Œé€šè¿‡ --ip æ‰‹åŠ¨é…ç½®é™æ€ ip åœ°å€ï¼Œå½“ç„¶ä¸é…ä¹Ÿå¯ä»¥ï¼ŒDHCP ä¼šè‡ªåŠ¨åˆ†é… IP $ docker run --network ipvnet0 --ip=192.168.31.234 --rm -it buildpack-deps:buster-curl /bin/bash # åœ¨å®¹å™¨ä¸­æŸ¥çœ‹ç½‘ç»œæ¥å£çŠ¶å†µï¼Œèƒ½çœ‹åˆ° eth0 æ˜¯ä¸€ä¸ª ipvlan æ¥å£ root@d0764ebbbf42:/# ip -d addr ls 1: lo: \u003cLOOPBACK,UP,LOWER_UP\u003e mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 promiscuity 0 minmtu 0 maxmtu 0 numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever 12: eth0@if2: \u003cBROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 qdisc noqueue state UNKNOWN group default link/ether 38:f3:ab:a3:e6:71 brd ff:ff:ff:ff:ff:ff link-netnsid 0 promiscuity 0 minmtu 68 maxmtu 65535 ipvlan mode l2 bridge numtxqueues 1 numrxqueues 1 gso_max_size 64000 gso_max_segs 64 inet 192.168.31.234/24 brd 192.168.31.255 scope global eth0 valid_lft forever preferred_lft forever # è·¯ç”±è¡¨ï¼Œé»˜è®¤ gateway è¢«è‡ªåŠ¨é…ç½®è¿›æ¥äº† root@d0764ebbbf42:/# ip route ls default via 192.168.31.1 dev eth0 192.168.31.0/24 dev eth0 proto kernel scope link src 192.168.31.234 # å¯ä»¥æ­£å¸¸è®¿é—® baidu root@d0764ebbbf42:/# curl baidu.com \u003chtml\u003e \u003cmeta http-equiv=\"refresh\" content=\"0;url=http://www.baidu.com/\"\u003e \u003c/html\u003e ","date":"2021-08-15","objectID":"/posts/iptables-and-container-networks/:6:0","tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨","iptables","conntrack"],"title":"iptables åŠ docker å®¹å™¨ç½‘ç»œåˆ†æ","uri":"/posts/iptables-and-container-networks/"},{"categories":["æŠ€æœ¯"],"content":"Rootless å®¹å™¨çš„ç½‘ç»œå®ç° å¦‚æœå®¹å™¨è¿è¡Œæ—¶ä¹Ÿåœ¨ Rootless æ¨¡å¼ä¸‹è¿è¡Œï¼Œé‚£å®ƒå°±æ²¡æœ‰æƒé™åœ¨å®¿ä¸»æœºæ·»åŠ  bridge/veth ç­‰è™šæ‹Ÿç½‘ç»œæ¥å£ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å‰é¢æè¿°çš„å®¹å™¨ç½‘ç»œå°±æ— æ³•è®¾ç½®äº†ã€‚ é‚£ä¹ˆ podman/containerd(nerdctl) ç›®å‰æ˜¯å¦‚ä½•åœ¨ Rootless æ¨¡å¼ä¸‹æ„å»ºå®¹å™¨ç½‘ç»œçš„å‘¢ï¼Ÿ æŸ¥çœ‹æ–‡æ¡£ï¼Œå‘ç°å®ƒä»¬éƒ½ç”¨åˆ°äº† rootlesskit ç›¸å…³çš„ä¸œè¥¿ï¼Œè€Œ rootlesskit æä¾›äº† rootless ç½‘ç»œçš„å‡ ä¸ªå®ç°ï¼Œæ–‡æ¡£å‚è§ rootlesskit/docs/network.md å…¶ä¸­ç›®å‰æ¨èä½¿ç”¨ï¼Œè€Œä¸” podman/containerd(nerdctl) éƒ½é»˜è®¤ä½¿ç”¨çš„æ–¹æ¡ˆï¼Œæ˜¯ rootless-containers/slirp4netns ä»¥ containerd(nerdctl) ä¸ºä¾‹ï¼ŒæŒ‰å®˜æ–¹æ–‡æ¡£å®‰è£…å¥½åï¼Œéšä¾¿å¯åŠ¨å‡ ä¸ªå®¹å™¨ï¼Œç„¶ååœ¨å®¿ä¸»æœºæŸ¥ iptables/ip addr lsï¼Œä¼šå‘ç°å•¥ä¹Ÿæ²¡æœ‰ã€‚ è¿™æ˜¾ç„¶æ˜¯å› ä¸º rootless æ¨¡å¼ä¸‹ containerd æ”¹ä¸äº†å®¿ä¸»æœºçš„ iptables é…ç½®å’Œè™šæ‹Ÿç½‘ç»œæ¥å£ã€‚ä½†æ˜¯å¯ä»¥æŸ¥çœ‹åˆ°å®¿ä¸»æœº slirp4netns åœ¨åå°è¿è¡Œï¼š â¯ ps aux | grep tap ryan 11644 0.0 0.0 5288 3312 ? S 00:01 0:02 slirp4netns --mtu 65520 -r 3 --disable-host-loopback --enable-sandbox --enable-seccomp 11625 tap0 ä½†æ˜¯æˆ‘çœ‹åŠå¤©æ–‡æ¡£ï¼Œåªçœ‹åˆ°æ€ä¹ˆä½¿ç”¨ rootlesskit/slirp4netns åˆ›å»ºæ–°çš„åå­—ç©ºé—´ï¼Œæ²¡çœ‹åˆ°æœ‰ä»‹ç»å¦‚ä½•è¿›å…¥ä¸€ä¸ªå·²å­˜åœ¨çš„ slirp4netns åå­—ç©ºé—´â€¦ ä½¿ç”¨ nsenter -a -t 11644 ä¹Ÿä¸€ç›´æŠ¥é”™ï¼Œä»»ä½•ç¨‹åºéƒ½æ˜¯ no such binaryâ€¦ ä»¥åæœ‰ç©ºå†é‡æ–°ç ”ç©¶ä¸€æ³¢â€¦ æ€»ä¹‹èƒ½ç¡®å®šçš„æ˜¯ï¼Œå®ƒé€šè¿‡åœ¨è™šæ‹Ÿçš„åå­—ç©ºé—´ä¸­åˆ›å»ºäº†ä¸€ä¸ª tap è™šæ‹Ÿæ¥å£æ¥å®ç°å®¹å™¨ç½‘ç»œï¼Œæ€§èƒ½ç›¸æ¯”å‰é¢ä»‹ç»çš„ç½‘ç»œå¤šå°‘æ˜¯è¦å·®ä¸€ç‚¹çš„ã€‚ ","date":"2021-08-15","objectID":"/posts/iptables-and-container-networks/:7:0","tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨","iptables","conntrack"],"title":"iptables åŠ docker å®¹å™¨ç½‘ç»œåˆ†æ","uri":"/posts/iptables-and-container-networks/"},{"categories":["æŠ€æœ¯"],"content":"nftables å‰é¢ä»‹ç»äº† iptables ä»¥åŠå…¶åœ¨ docker å’Œé˜²ç«å¢™ä¸Šçš„åº”ç”¨ã€‚ä½†æ˜¯å®é™…ä¸Šç›®å‰å„å¤§ Linux å‘è¡Œç‰ˆéƒ½å·²ç»ä¸å»ºè®®ä½¿ç”¨ iptables äº†ï¼Œç”šè‡³æŠŠ iptables é‡å‘½åä¸ºäº† iptables-leagacy. ç›®å‰ opensuse/debian/opensuse éƒ½å·²ç»é¢„è£…äº†å¹¶ä¸”æ¨èä½¿ç”¨ nftablesï¼Œè€Œä¸” firewalld å·²ç»é»˜è®¤ä½¿ç”¨ nftables ä½œä¸ºå®ƒçš„åç«¯äº†ã€‚ æˆ‘åœ¨ opensuse tumbleweed ä¸Šå®æµ‹ï¼Œfirewalld æ·»åŠ çš„æ˜¯ nftables é…ç½®ï¼Œè€Œ docker ä»ç„¶åœ¨ç”¨æ—§çš„ iptablesï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ç°åœ¨çš„æœºå™¨ä¸Šæœ‰ä¸¤å¥— netfilter å·¥å…·å¹¶å­˜ï¼š # æŸ¥çœ‹ iptables æ•°æ® \u003e iptables -S -P INPUT ACCEPT -P FORWARD DROP -P OUTPUT ACCEPT -N DOCKER -N DOCKER-ISOLATION-STAGE-1 -N DOCKER-ISOLATION-STAGE-2 -N DOCKER-USER -A FORWARD -j DOCKER-ISOLATION-STAGE-1 -A FORWARD -o br-e3fbbb7a1b3a -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT -A FORWARD -o br-e3fbbb7a1b3a -j DOCKER ... # ç¡®è®¤ä¸‹æ˜¯å¦ä½¿ç”¨äº† nftables çš„å…¼å®¹å±‚ï¼Œç»“æœæç¤ºè¯·æˆ‘ä½¿ç”¨ iptables-legacy \u003e iptables-nft -S # Warning: iptables-legacy tables present, use iptables-legacy to see them -P INPUT ACCEPT -P FORWARD ACCEPT -P OUTPUT ACCEPT # æŸ¥çœ‹ nftables è§„åˆ™ï¼Œèƒ½çœ‹åˆ°ä¸‰å¼  firewalld ç”Ÿæˆçš„ table \u003e nft list ruleset table inet firewalld { ... } table ip firewalld { ... } table ip6 firewalld { ... } ä½†æ˜¯ç°åœ¨ kubernetes/docker éƒ½è¿˜æ˜¯ç”¨çš„ iptablesï¼Œnftables æˆ‘å­¦äº†ç”¨å¤„ä¸å¤§ï¼Œä»¥åæœ‰ç©ºå†è¡¥å……ã€‚ ","date":"2021-08-15","objectID":"/posts/iptables-and-container-networks/:8:0","tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨","iptables","conntrack"],"title":"iptables åŠ docker å®¹å™¨ç½‘ç»œåˆ†æ","uri":"/posts/iptables-and-container-networks/"},{"categories":["æŠ€æœ¯"],"content":"å‚è€ƒ iptablesè¯¦è§£ï¼ˆ1ï¼‰ï¼šiptablesæ¦‚å¿µ ç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNATï¼‰ä¹‹æŠ¥æ–‡è·Ÿè¸ª å®¹å™¨å®‰å…¨æ‹¾é— - Rootless Containeråˆæ¢ netfilter - wikipedia ","date":"2021-08-15","objectID":"/posts/iptables-and-container-networks/:9:0","tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨","iptables","conntrack"],"title":"iptables åŠ docker å®¹å™¨ç½‘ç»œåˆ†æ","uri":"/posts/iptables-and-container-networks/"},{"categories":["æŠ€æœ¯"],"content":" æœ¬æ–‡ç”¨åˆ°çš„å­—ç¬¦ç”»å·¥å…·ï¼švscode-asciiflow2 æ³¨æ„: æœ¬æ–‡ä¸­ä½¿ç”¨ ip å‘½ä»¤åˆ›å»ºæˆ–ä¿®æ”¹çš„ä»»ä½•ç½‘ç»œé…ç½®ï¼Œéƒ½æ˜¯æœªæŒä¹…åŒ–çš„ï¼Œä¸»æœºé‡å¯å³æ¶ˆå¤±ã€‚ Linux å…·æœ‰å¼ºå¤§çš„è™šæ‹Ÿç½‘ç»œèƒ½åŠ›ï¼Œè¿™ä¹Ÿæ˜¯ openstack ç½‘ç»œã€docker å®¹å™¨ç½‘ç»œä»¥åŠ kubernetes ç½‘ç»œç­‰è™šæ‹Ÿç½‘ç»œçš„åŸºç¡€ã€‚ è¿™é‡Œä»‹ç» Linux å¸¸ç”¨çš„è™šæ‹Ÿç½‘ç»œæ¥å£ç±»å‹ï¼šTUN/TAPã€bridgeã€vethã€ipvlan/macvlanã€vlan ä»¥åŠ vxlan/geneve. ","date":"2021-08-14","objectID":"/posts/linux-virtual-network-interfaces/:0:0","tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨"],"title":"Linux ä¸­çš„è™šæ‹Ÿç½‘ç»œæ¥å£","uri":"/posts/linux-virtual-network-interfaces/"},{"categories":["æŠ€æœ¯"],"content":"ä¸€ã€tun/tap è™šæ‹Ÿç½‘ç»œæ¥å£ tun/tap æ˜¯æ“ä½œç³»ç»Ÿå†…æ ¸ä¸­çš„è™šæ‹Ÿç½‘ç»œè®¾å¤‡ï¼Œä»–ä»¬ä¸ºç”¨æˆ·å±‚ç¨‹åºæä¾›æ•°æ®çš„æ¥æ”¶ä¸ä¼ è¾“ã€‚ æ™®é€šçš„ç‰©ç†ç½‘ç»œæ¥å£å¦‚ eth0ï¼Œå®ƒçš„ä¸¤ç«¯åˆ†åˆ«æ˜¯å†…æ ¸åè®®æ ˆå’Œå¤–é¢çš„ç‰©ç†ç½‘ç»œã€‚ è€Œå¯¹äº TUN/TAP è™šæ‹Ÿæ¥å£å¦‚ tun0ï¼Œå®ƒçš„ä¸€ç«¯ä¸€å®šæ˜¯è¿æ¥çš„ç”¨æˆ·å±‚ç¨‹åºï¼Œå¦ä¸€ç«¯åˆ™è§†é…ç½®æ–¹å¼çš„ä¸åŒè€Œå˜åŒ–ï¼Œå¯ä»¥ç›´è¿å†…æ ¸åè®®æ ˆï¼Œä¹Ÿå¯ä»¥æ˜¯æŸä¸ª bridgeï¼ˆåé¢ä¼šä»‹ç»ï¼‰ã€‚ Linux é€šè¿‡å†…æ ¸æ¨¡å— TUN æä¾› tun/tap åŠŸèƒ½ï¼Œè¯¥æ¨¡å—æä¾›äº†ä¸€ä¸ªè®¾å¤‡æ¥å£ /dev/net/tun ä¾›ç”¨æˆ·å±‚ç¨‹åºè¯»å†™ï¼Œç”¨æˆ·å±‚ç¨‹åºé€šè¿‡ /dev/net/tun è¯»å†™ä¸»æœºå†…æ ¸åè®®æ ˆçš„æ•°æ®ã€‚ \u003e modinfo tun filename: /lib/modules/5.13.6-1-default/kernel/drivers/net/tun.ko.xz alias: devname:net/tun alias: char-major-10-200 license: GPL author: (C) 1999-2004 Max Krasnyansky \u003cmaxk@qualcomm.com\u003e description: Universal TUN/TAP device driver ... \u003e ls /dev/net/tun /dev/net/tun ä¸€ä¸ª TUN è®¾å¤‡çš„ç¤ºä¾‹å›¾å¦‚ä¸‹ï¼š +----------------------------------------------------------------------+ | | | +--------------------+ +--------------------+ | | | User Application A | | User Application B +\u003c-----+ | | +------------+-------+ +-------+------------+ | | | | 1 | 5 | | |...............+......................+...................|...........| | â†“ â†“ | | | +----------+ +----------+ | | | | socket A | | socket B | | | | +-------+--+ +--+-------+ | | | | 2 | 6 | | |.................+.................+......................|...........| | â†“ â†“ | | | +------------------------+ +--------+-------+ | | | Network Protocol Stack | | /dev/net/tun | | | +--+-------------------+-+ +--------+-------+ | | | 7 | 3 ^ | |................+...................+.....................|...........| | â†“ â†“ | | | +----------------+ +----------------+ 4 | | | | eth0 | | tun0 | | | | +-------+--------+ +-----+----------+ | | | 10.32.0.11 | | 192.168.3.11 | | | | 8 +---------------------+ | | | | +----------------+-----------------------------------------------------+ â†“ Physical Network å› ä¸º TUN/TAP è®¾å¤‡çš„ä¸€ç«¯æ˜¯å†…æ ¸åè®®æ ˆï¼Œæ˜¾ç„¶æµå…¥ tun0 çš„æ•°æ®åŒ…æ˜¯å…ˆç»è¿‡æœ¬åœ°çš„è·¯ç”±è§„åˆ™åŒ¹é…çš„ã€‚ è·¯ç”±åŒ¹é…æˆåŠŸï¼Œæ•°æ®åŒ…è¢«å‘é€åˆ° tun0 åï¼Œtun0 å‘ç°å¦ä¸€ç«¯æ˜¯é€šè¿‡ /dev/net/tun è¿æ¥åˆ°åº”ç”¨ç¨‹åº Bï¼Œå°±ä¼šå°†æ•°æ®ä¸¢ç»™åº”ç”¨ç¨‹åº Bã€‚ åº”ç”¨ç¨‹åºå¯¹æ•°æ®åŒ…è¿›è¡Œå¤„ç†åï¼Œå¯èƒ½ä¼šæ„é€ æ–°çš„æ•°æ®åŒ…ï¼Œé€šè¿‡ç‰©ç†ç½‘å¡å‘é€å‡ºå»ã€‚æ¯”å¦‚å¸¸è§çš„ VPN ç¨‹åºå°±æ˜¯æŠŠåŸæ¥çš„æ•°æ®åŒ…å°è£…/åŠ å¯†ä¸€éï¼Œå†å‘é€ç»™ VPN æœåŠ¡å™¨ã€‚ ","date":"2021-08-14","objectID":"/posts/linux-virtual-network-interfaces/:1:0","tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨"],"title":"Linux ä¸­çš„è™šæ‹Ÿç½‘ç»œæ¥å£","uri":"/posts/linux-virtual-network-interfaces/"},{"categories":["æŠ€æœ¯"],"content":"C è¯­è¨€ç¼–ç¨‹æµ‹è¯• TUN è®¾å¤‡ ä¸ºäº†ä½¿ç”¨ tun/tap è®¾å¤‡ï¼Œç”¨æˆ·å±‚ç¨‹åºéœ€è¦é€šè¿‡ç³»ç»Ÿè°ƒç”¨æ‰“å¼€ /dev/net/tun è·å¾—ä¸€ä¸ªè¯»å†™è¯¥è®¾å¤‡çš„æ–‡ä»¶æè¿°ç¬¦(FD)ï¼Œå¹¶ä¸”è°ƒç”¨ ioctl() å‘å†…æ ¸æ³¨å†Œä¸€ä¸ª TUN æˆ– TAP ç±»å‹çš„è™šæ‹Ÿç½‘å¡(å®ä¾‹åŒ–ä¸€ä¸ª tun/tap è®¾å¤‡)ï¼Œå…¶åç§°å¯èƒ½æ˜¯ tun0/tap0 ç­‰ã€‚ æ­¤åï¼Œç”¨æˆ·ç¨‹åºå¯ä»¥é€šè¿‡è¯¥ TUN/TAP è™šæ‹Ÿç½‘å¡ä¸ä¸»æœºå†…æ ¸åè®®æ ˆï¼ˆæˆ–è€…å…¶ä»–ç½‘ç»œè®¾å¤‡ï¼‰äº¤äº’ã€‚å½“ç”¨æˆ·å±‚ç¨‹åºå…³é—­åï¼Œå…¶æ³¨å†Œçš„ TUN/TAP è™šæ‹Ÿç½‘å¡ä»¥åŠè‡ªåŠ¨ç”Ÿæˆçš„è·¯ç”±è¡¨ç›¸å…³æ¡ç›®éƒ½ä¼šè¢«å†…æ ¸é‡Šæ”¾ã€‚ å¯ä»¥æŠŠç”¨æˆ·å±‚ç¨‹åºçœ‹åšæ˜¯ç½‘ç»œä¸Šå¦ä¸€å°ä¸»æœºï¼Œä»–ä»¬é€šè¿‡ tun/tap è™šæ‹Ÿç½‘å¡ç›¸è¿ã€‚ ä¸€ä¸ªç®€å•çš„ C ç¨‹åºç¤ºä¾‹å¦‚ä¸‹ï¼Œå®ƒæ¯æ¬¡æ”¶åˆ°æ•°æ®åï¼Œéƒ½åªå•çº¯åœ°æ‰“å°ä¸€ä¸‹æ”¶åˆ°çš„å­—èŠ‚æ•°ï¼š #include \u003clinux/if.h\u003e#include \u003clinux/if_tun.h\u003e #include \u003csys/ioctl.h\u003e #include \u003cfcntl.h\u003e#include \u003cstring.h\u003e #include \u003cunistd.h\u003e#include\u003cstdlib.h\u003e#include\u003cstdio.h\u003e int tun_alloc(int flags) { struct ifreq ifr; int fd, err; char *clonedev = \"/dev/net/tun\"; // æ‰“å¼€ tun æ–‡ä»¶ï¼Œè·å¾— fd if ((fd = open(clonedev, O_RDWR)) \u003c 0) { return fd; } memset(\u0026ifr, 0, sizeof(ifr)); ifr.ifr_flags = flags; // å‘å†…æ ¸æ³¨å†Œä¸€ä¸ª TUN ç½‘å¡ï¼Œå¹¶ä¸å‰é¢æ‹¿åˆ°çš„ fd å…³è”èµ·æ¥ // ç¨‹åºå…³é—­æ—¶ï¼Œæ³¨å†Œçš„ tun ç½‘å¡åŠè‡ªåŠ¨ç”Ÿæˆçš„ç›¸å…³è·¯ç”±ç­–ç•¥ï¼Œä¼šè¢«è‡ªåŠ¨é‡Šæ”¾ if ((err = ioctl(fd, TUNSETIFF, (void *) \u0026ifr)) \u003c 0) { close(fd); return err; } printf(\"Open tun/tap device: %s for reading...\\n\", ifr.ifr_name); return fd; } int main() { int tun_fd, nread; char buffer[1500]; /* Flags: IFF_TUN - TUN device (no Ethernet headers) * IFF_TAP - TAP device * IFF_NO_PI - Do not provide packet information */ tun_fd = tun_alloc(IFF_TUN | IFF_NO_PI); if (tun_fd \u003c 0) { perror(\"Allocating interface\"); exit(1); } while (1) { nread = read(tun_fd, buffer, sizeof(buffer)); if (nread \u003c 0) { perror(\"Reading from interface\"); close(tun_fd); exit(1); } printf(\"Read %d bytes from tun/tap device\\n\", nread); } return 0; } æ¥ä¸‹æ¥å¼€å¯ä¸‰ä¸ªç»ˆç«¯çª—å£æ¥æµ‹è¯•ä¸Šè¿°ç¨‹åºï¼Œåˆ†åˆ«è¿è¡Œä¸Šé¢çš„ tun ç¨‹åºã€tcpdump å’Œ iproute2 æŒ‡ä»¤ã€‚ é¦–å…ˆé€šè¿‡ç¼–è¯‘è¿è¡Œä¸Šè¿° c ç¨‹åºï¼Œç¨‹åºä¼šé˜»å¡ä½ï¼Œç­‰å¾…æ•°æ®åˆ°è¾¾ï¼š # ç¼–è¯‘ï¼Œè¯·å¿½ç•¥éƒ¨åˆ† warning \u003e gcc mytun.c -o mytun # åˆ›å»ºå¹¶ç›‘å¬ tun è®¾å¤‡éœ€è¦ root æƒé™ \u003e sudo mytun Open tun/tap device: tun0 for reading... ç°åœ¨ä½¿ç”¨ iproute2 æŸ¥çœ‹ä¸‹é“¾è·¯å±‚è®¾å¤‡ï¼š # èƒ½å‘ç°æœ€åé¢æœ‰åˆ—å‡ºåä¸º tun0 çš„æ¥å£ï¼Œä½†æ˜¯çŠ¶æ€ä¸º down â¯ ip addr ls ...... 3: wlp4s0: \u003cBROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 qdisc noqueue state UP group default qlen 1000 link/ether c0:3c:59:36:a4:16 brd ff:ff:ff:ff:ff:ff inet 192.168.31.228/24 brd 192.168.31.255 scope global dynamic noprefixroute wlp4s0 valid_lft 41010sec preferred_lft 41010sec inet6 fe80::4ab0:130f:423b:5d37/64 scope link noprefixroute valid_lft forever preferred_lft forever 7: tun0: \u003cPOINTOPOINT,MULTICAST,NOARP\u003e mtu 1500 qdisc noop state DOWN group default qlen 500 link/none # ä¸º tun0 è®¾ç½® ip åœ°å€ï¼Œæ³¨æ„ä¸è¦å’Œå…¶ä»–æ¥å£åœ¨åŒä¸€ç½‘æ®µï¼Œä¼šå¯¼è‡´è·¯ç”±å†²çª \u003e sudo ip addr add 172.21.22.23/24 dev tun0 # å¯åŠ¨ tun0 è¿™ä¸ªæ¥å£ï¼Œè¿™ä¸€æ­¥ä¼šè‡ªåŠ¨å‘è·¯ç”±è¡¨ä¸­æ·»åŠ å°† 172.21.22.23/24 è·¯ç”±åˆ° tun0 çš„ç­–ç•¥ \u003e sudo ip link set tun0 up #ç¡®è®¤ä¸Šä¸€æ­¥æ·»åŠ çš„è·¯ç”±ç­–ç•¥æ˜¯å¦å­˜åœ¨ â¯ ip route ls default via 192.168.31.1 dev wlp4s0 proto dhcp metric 600 172.17.0.0/16 dev docker0 proto kernel scope link src 172.17.0.1 linkdown 172.21.22.0/24 dev tun0 proto kernel scope link src 172.21.22.23 192.168.31.0/24 dev wlp4s0 proto kernel scope link src 192.168.31.228 metric 600 # æ­¤æ—¶å†æŸ¥çœ‹æ¥å£ï¼Œå‘ç° tun0 çŠ¶æ€ä¸º unknown \u003e ip addr ls ...... 8: tun0: \u003cPOINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP\u003e mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 500 link/none inet 172.21.22.23/24 scope global tun0 valid_lft forever preferred_lft forever inet6 fe80::3d52:49b5:1cf3:38fd/64 scope link stable-privacy valid_lft forever preferred_lft forever # ä½¿ç”¨ tcpdump å°è¯•æŠ“ä¸‹ tun0 çš„æ•°æ®ï¼Œä¼šé˜»å¡åœ¨è¿™é‡Œï¼Œç­‰å¾…æ•°æ®åˆ°è¾¾ \u003e tcpdump -i tun0 ç°åœ¨å†å¯åŠ¨ç¬¬ä¸‰ä¸ªçª—å£å‘ç‚¹æ•°æ®ç»™ tun0ï¼ŒæŒç»­è§‚å¯Ÿå‰é¢ tcpdump å’Œ mytun çš„æ—¥å¿—: # ç›´æ¥ ping tun0 çš„åœ°å€ï¼Œè²Œä¼¼æœ‰é—®é¢˜ï¼Œæ•°æ®æ²¡è¿› mytun ç¨‹åºï¼Œè€Œä¸”è¿˜æœ‰å“åº” â¯ ping -c 4 172.21.22.23 PING 172.21.22.23 (172.21.22.23) 56(84) bytes of data. 64 bytes from 172.21.22.23: icmp_seq=1 ttl=64 time=0.167 ms 64 bytes from 172.21.22.23: icmp_seq=2 ttl=64 time=0.180 ms 64 bytes from 172.21.22.23: icmp_seq=3 ttl=64 time=0.126 ms 64 bytes from 172.21.22.23: icmp_seq=4 ttl=64 time=0.141 ms --- 172.21.22.23 ping statistics --- 4 packets transmitted, 4 received, 0% packet loss, time 3060ms rtt min/avg/max/mdev = 0.126/0.153/0.180/0.021 ms # ä½†æ˜¯ ping è¯¥ç½‘æ®µä¸‹çš„å…¶ä»–åœ°å€ï¼Œæµé‡å°±ä¼šè¢«è½¬å‘ç»™ mytun ç¨‹åºï¼Œå› ä¸º mytun å•¥æ•°æ®ä¹Ÿæ²¡å›ï¼Œè‡ªç„¶ä¸¢åŒ…ç‡ 100% # tcpdump å’Œ mytun éƒ½ä¼šæ‰“å°å‡ºç›¸å…³æ—¥å¿— â¯ ping -c 4 172.21.22.26 PING 172.21.22.26 (172.21.22.26) 56(84) bytes of data. --- 172.21.22.26 ping statistics --- 4 packets transmitted, 0 received, 100% packet loss, time 3055ms ä¸‹é¢ç»™å‡º mytun çš„è¾“å‡ºï¼š Read 84 bytes from tun/tap device Read 84 bytes fro","date":"2021-08-14","objectID":"/posts/linux-virtual-network-interfaces/:1:1","tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨"],"title":"Linux ä¸­çš„è™šæ‹Ÿç½‘ç»œæ¥å£","uri":"/posts/linux-virtual-network-interfaces/"},{"categories":["æŠ€æœ¯"],"content":"TUN ä¸ TAP çš„åŒºåˆ« TUN å’Œ TAP çš„åŒºåˆ«åœ¨äºå·¥ä½œçš„ç½‘ç»œå±‚æ¬¡ä¸åŒï¼Œç”¨æˆ·ç¨‹åºé€šè¿‡ TUN è®¾å¤‡åªèƒ½è¯»å†™ç½‘ç»œå±‚çš„ IP æ•°æ®åŒ…ï¼Œè€Œ TAP è®¾å¤‡åˆ™æ”¯æŒè¯»å†™é“¾è·¯å±‚çš„æ•°æ®åŒ…ï¼ˆé€šå¸¸æ˜¯ä»¥å¤ªç½‘æ•°æ®åŒ…ï¼Œå¸¦æœ‰ Ethernet headersï¼‰ã€‚ TUN ä¸ TAP çš„å…³ç³»ï¼Œå°±ç±»ä¼¼äº socket å’Œ raw socket. TUN/TAP åº”ç”¨æœ€å¤šçš„åœºæ™¯æ˜¯ VPN ä»£ç†ï¼Œæ¯”å¦‚: clash: ä¸€ä¸ªæ”¯æŒå„ç§è§„åˆ™çš„éš§é“ï¼Œä¹Ÿæ”¯æŒ TUN æ¨¡å¼ tun2socks: ä¸€ä¸ªå…¨å±€é€æ˜ä»£ç†ï¼Œå’Œ VPN çš„å·¥ä½œæ¨¡å¼ä¸€æ ·ï¼Œå®ƒé€šè¿‡åˆ›å»ºè™šæ‹Ÿç½‘å¡+ä¿®æ”¹è·¯ç”±è¡¨ï¼Œåœ¨ç¬¬ä¸‰å±‚ç½‘ç»œå±‚ä»£ç†ç³»ç»Ÿæµé‡ã€‚ ","date":"2021-08-14","objectID":"/posts/linux-virtual-network-interfaces/:1:2","tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨"],"title":"Linux ä¸­çš„è™šæ‹Ÿç½‘ç»œæ¥å£","uri":"/posts/linux-virtual-network-interfaces/"},{"categories":["æŠ€æœ¯"],"content":"äºŒã€veth veth æ¥å£æ€»æ˜¯æˆå¯¹å‡ºç°ï¼Œä¸€å¯¹ veth æ¥å£å°±ç±»ä¼¼ä¸€æ ¹ç½‘çº¿ï¼Œä»ä¸€ç«¯è¿›æ¥çš„æ•°æ®ä¼šä»å¦ä¸€ç«¯å‡ºå»ã€‚ åŒæ—¶ veth åˆæ˜¯ä¸€ä¸ªè™šæ‹Ÿç½‘ç»œæ¥å£ï¼Œå› æ­¤å®ƒå’Œ TUN/TAP æˆ–è€…å…¶ä»–ç‰©ç†ç½‘ç»œæ¥å£ä¸€æ ·ï¼Œä¹Ÿéƒ½èƒ½é…ç½® mac/ip åœ°å€ï¼ˆä½†æ˜¯å¹¶ä¸æ˜¯ä¸€å®šå¾—é… mac/ip åœ°å€ï¼‰ã€‚ å…¶ä¸»è¦ä½œç”¨å°±æ˜¯è¿æ¥ä¸åŒçš„ç½‘ç»œï¼Œæ¯”å¦‚åœ¨å®¹å™¨ç½‘ç»œä¸­ï¼Œç”¨äºå°†å®¹å™¨çš„ namespace ä¸ root namespace çš„ç½‘æ¡¥ br0 ç›¸è¿ã€‚ å®¹å™¨ç½‘ç»œä¸­ï¼Œå®¹å™¨ä¾§çš„ veth è‡ªèº«è®¾ç½®äº† ip/mac åœ°å€å¹¶è¢«é‡å‘½åä¸º eth0ï¼Œä½œä¸ºå®¹å™¨çš„ç½‘ç»œæ¥å£ä½¿ç”¨ï¼Œè€Œä¸»æœºä¾§çš„ veth åˆ™ç›´æ¥è¿æ¥åœ¨ docker0/br0 ä¸Šé¢ã€‚ ä½¿ç”¨ veth å®ç°å®¹å™¨ç½‘ç»œï¼Œéœ€è¦ç»“åˆä¸‹ä¸€å°èŠ‚ä»‹ç»çš„ bridgeï¼Œåœ¨ä¸‹ä¸€å°èŠ‚å°†ç»™å‡ºå®¹å™¨ç½‘ç»œç»“æ„å›¾ã€‚ ","date":"2021-08-14","objectID":"/posts/linux-virtual-network-interfaces/:2:0","tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨"],"title":"Linux ä¸­çš„è™šæ‹Ÿç½‘ç»œæ¥å£","uri":"/posts/linux-virtual-network-interfaces/"},{"categories":["æŠ€æœ¯"],"content":"ä¸‰ã€bridge Linux Bridge æ˜¯å·¥ä½œåœ¨é“¾è·¯å±‚çš„ç½‘ç»œäº¤æ¢æœºï¼Œç”± Linux å†…æ ¸æ¨¡å— brige æä¾›ï¼Œå®ƒè´Ÿè´£åœ¨æ‰€æœ‰è¿æ¥åˆ°å®ƒçš„æ¥å£ä¹‹é—´è½¬å‘é“¾è·¯å±‚æ•°æ®åŒ…ã€‚ æ·»åŠ åˆ° Bridge ä¸Šçš„è®¾å¤‡è¢«è®¾ç½®ä¸ºåªæ¥å—äºŒå±‚æ•°æ®å¸§å¹¶ä¸”è½¬å‘æ‰€æœ‰æ”¶åˆ°çš„æ•°æ®åŒ…åˆ° Bridge ä¸­ã€‚ åœ¨ Bridge ä¸­ä¼šè¿›è¡Œä¸€ä¸ªç±»ä¼¼ç‰©ç†äº¤æ¢æœºçš„æŸ¥MACç«¯å£æ˜ å°„è¡¨ã€è½¬å‘ã€æ›´æ–°MACç«¯å£æ˜ å°„è¡¨è¿™æ ·çš„å¤„ç†é€»è¾‘ï¼Œä»è€Œæ•°æ®åŒ…å¯ä»¥è¢«è½¬å‘åˆ°å¦ä¸€ä¸ªæ¥å£/ä¸¢å¼ƒ/å¹¿æ’­/å‘å¾€ä¸Šå±‚åè®®æ ˆï¼Œç”±æ­¤ Bridge å®ç°äº†æ•°æ®è½¬å‘çš„åŠŸèƒ½ã€‚ å¦‚æœä½¿ç”¨ tcpdump åœ¨ Bridge æ¥å£ä¸ŠæŠ“åŒ…ï¼Œå¯ä»¥æŠ“åˆ°ç½‘æ¡¥ä¸Šæ‰€æœ‰æ¥å£è¿›å‡ºçš„åŒ…ï¼Œå› ä¸ºè¿™äº›æ•°æ®åŒ…éƒ½è¦é€šè¿‡ç½‘æ¡¥è¿›è¡Œè½¬å‘ã€‚ ä¸ç‰©ç†äº¤æ¢æœºä¸åŒçš„æ˜¯ï¼ŒBridge æœ¬èº«å¯ä»¥è®¾ç½® IP åœ°å€ï¼Œå¯ä»¥è®¤ä¸ºå½“ä½¿ç”¨ brctl addbr br0 æ–°å»ºä¸€ä¸ª br0 ç½‘æ¡¥æ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨åˆ›å»ºäº†ä¸€ä¸ªåŒåçš„éšè— br0 ç½‘ç»œæ¥å£ã€‚br0 ä¸€æ—¦è®¾ç½® IP åœ°å€ï¼Œå°±æ„å‘³ç€è¿™ä¸ªéšè—çš„ br0 æ¥å£å¯ä»¥ä½œä¸ºè·¯ç”±æ¥å£è®¾å¤‡ï¼Œå‚ä¸ IP å±‚çš„è·¯ç”±é€‰æ‹©(å¯ä»¥ä½¿ç”¨ route -n æŸ¥çœ‹æœ€åä¸€åˆ— Iface)ã€‚å› æ­¤åªæœ‰å½“ br0 è®¾ç½® IP åœ°å€æ—¶ï¼ŒBridge æ‰æœ‰å¯èƒ½å°†æ•°æ®åŒ…å‘å¾€ä¸Šå±‚åè®®æ ˆã€‚ ä½†è¢«æ·»åŠ åˆ° Bridge ä¸Šçš„ç½‘å¡æ˜¯ä¸èƒ½é…ç½® IP åœ°å€çš„ï¼Œä»–ä»¬å·¥ä½œåœ¨æ•°æ®é“¾è·¯å±‚ï¼Œå¯¹è·¯ç”±ç³»ç»Ÿä¸å¯è§ã€‚ å®ƒå¸¸è¢«ç”¨äºåœ¨è™šæ‹Ÿæœºã€ä¸»æœºä¸Šä¸åŒçš„ namepsaces ä¹‹é—´è½¬å‘æ•°æ®ã€‚ ","date":"2021-08-14","objectID":"/posts/linux-virtual-network-interfaces/:3:0","tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨"],"title":"Linux ä¸­çš„è™šæ‹Ÿç½‘ç»œæ¥å£","uri":"/posts/linux-virtual-network-interfaces/"},{"categories":["æŠ€æœ¯"],"content":"è™šæ‹Ÿæœºåœºæ™¯ï¼ˆæ¡¥æ¥æ¨¡å¼ï¼‰ ä»¥ qemu-kvm ä¸ºä¾‹ï¼Œåœ¨è™šæ‹Ÿæœºçš„æ¡¥æ¥æ¨¡å¼ä¸‹ï¼Œqemu-kvm ä¼šä¸ºæ¯ä¸ªè™šæ‹Ÿæœºåˆ›å»ºä¸€ä¸ª tun/tap è™šæ‹Ÿç½‘å¡å¹¶è¿æ¥åˆ° br0 ç½‘æ¡¥ã€‚ è™šæ‹Ÿæœºå†…éƒ¨çš„ç½‘ç»œæ¥å£ eth0 æ˜¯ qemu-kvm è½¯ä»¶æ¨¡æ‹Ÿçš„ï¼Œå®é™…ä¸Šè™šæ‹Ÿæœºå†…ç½‘ç»œæ•°æ®çš„æ”¶å‘éƒ½ä¼šè¢« qemu-kvm è½¬æ¢æˆå¯¹ /dev/net/tun çš„è¯»å†™ã€‚ ä»¥å‘é€æ•°æ®ä¸ºä¾‹ï¼Œæ•´ä¸ªæµç¨‹å¦‚ä¸‹ï¼š è™šæ‹Ÿæœºå‘å‡ºå»çš„æ•°æ®åŒ…å…ˆåˆ°è¾¾ qemu-kvm ç¨‹åº æ•°æ®è¢«ç”¨æˆ·å±‚ç¨‹åº qemu-kvm å†™å…¥åˆ° /dev/net/tunï¼Œåˆ°è¾¾ tap è®¾å¤‡ tap è®¾å¤‡æŠŠæ•°æ®ä¼ é€åˆ° br0 ç½‘æ¡¥ br0 æŠŠæ•°æ®äº¤ç»™ eth0 å‘é€å‡ºå» æ•´ä¸ªæµç¨‹è·‘å®Œï¼Œæ•°æ®åŒ…éƒ½ä¸éœ€è¦ç»è¿‡å®¿ä¸»æœºçš„åè®®æ ˆï¼Œæ•ˆç‡é«˜ã€‚ +------------------------------------------------+-----------------------------------+-----------------------------------+ | Host | VirtualMachine1 | VirtualMachine2 | | | | | | +--------------------------------------+ | +-------------------------+ | +-------------------------+ | | | Network Protocol Stack | | | Network Protocol Stack | | | Network Protocol Stack | | | +--------------------------------------+ | +-------------------------+ | +-------------------------+ | | â†‘ | â†‘ | â†‘ | |.......................|........................|................|..................|.................|.................| | â†“ | â†“ | â†“ | | +--------+ | +-------+ | +-------+ | | | .3.101 | | | .3.102| | | .3.103| | | +------+ +--------+ +-------+ | +-------+ | +-------+ | | | eth0 |\u003c---\u003e| br0 |\u003c---\u003e|tun/tap| | | eth0 | | | eth0 | | | +------+ +--------+ +-------+ | +-------+ | +-------+ | | â†‘ â†‘ â†‘ +--------+ â†‘ | â†‘ | | | | +------|qemu-kvm|-----------+ | | | | | â†“ +--------+ | | | | | +-------+ | | | | | | |tun/tap| | | | | | | +-------+ | | | | | | â†‘ | +--------+ | | | | | +-------------------------------------|qemu-kvm|-------------|-----------------+ | | | | +--------+ | | | | | | | +---------|--------------------------------------+-----------------------------------+-----------------------------------+ â†“ Physical Network (192.168.3.0/24) ","date":"2021-08-14","objectID":"/posts/linux-virtual-network-interfaces/:3:1","tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨"],"title":"Linux ä¸­çš„è™šæ‹Ÿç½‘ç»œæ¥å£","uri":"/posts/linux-virtual-network-interfaces/"},{"categories":["æŠ€æœ¯"],"content":"è·¨ namespace é€šä¿¡åœºæ™¯ï¼ˆå®¹å™¨ç½‘ç»œï¼ŒNAT æ¨¡å¼ï¼‰ docker/podman æä¾›çš„ bridge ç½‘ç»œæ¨¡å¼ï¼Œå°±æ˜¯ä½¿ç”¨ veth+bridge+iptalbes å®ç°çš„ã€‚æˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« è¯¦ç»†ä»‹ç»ã€Œå®¹å™¨ç½‘ç»œã€ã€‚ ç”±äºå®¹å™¨è¿è¡Œåœ¨è‡ªå·±å•ç‹¬çš„ network namespace é‡Œé¢ï¼Œæ‰€ä»¥å’Œè™šæ‹Ÿæœºä¸€æ ·ï¼Œå®ƒä»¬ä¹Ÿéƒ½æœ‰è‡ªå·±å•ç‹¬çš„åè®®æ ˆã€‚ å®¹å™¨ç½‘ç»œçš„ç»“æ„å’Œè™šæ‹Ÿæœºå·®ä¸å¤šï¼Œä½†æ˜¯å®ƒæ”¹ç”¨äº† NAT ç½‘ç»œï¼Œå¹¶æŠŠ tun/tap æ¢æˆäº† vethï¼Œå¯¼è‡´ docker0 è¿‡æ¥çš„æ•°æ®ï¼Œè¦å…ˆç»è¿‡å®¿ä¸»æœºåè®®æ ˆï¼Œç„¶åæ‰è¿›å…¥ veth æ¥å£ã€‚ å¤šäº†ä¸€å±‚ NATï¼Œä»¥åŠå¤šèµ°äº†ä¸€å±‚å®¿ä¸»æœºåè®®æ ˆï¼Œéƒ½ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚ ç¤ºæ„å›¾å¦‚ä¸‹ï¼š +-----------------------------------------------+-----------------------------------+-----------------------------------+ | Host | Container 1 | Container 2 | | | | | | +---------------------------------------+ | +-------------------------+ | +-------------------------+ | | | Network Protocol Stack | | | Network Protocol Stack | | | Network Protocol Stack | | | +----+-------------+--------------------+ | +-----------+-------------+ | +------------+------------+ | | ^ ^ | ^ | ^ | |........|.............|........................|................|..................|.................|.................| | v v â†“ | v | v | | +----+----+ +-----+------+ | +-----+-------+ | +-----+-------+ | | | .31.101 | | 172.17.0.1 | +------+ | | 172.17.0.2 | | | 172.17.0.3 | | | +---------+ +-------------\u003c----\u003e+ veth | | +-------------+ | +-------------+ | | | eth0 | | docker0 | +--+---+ | | eth0(veth) | | | eth0(veth) | | | +----+----+ +-----+------+ ^ | +-----+-------+ | +-----+-------+ | | ^ ^ | | ^ | ^ | | | | +------------------------+ | | | | | v | | | | | | +--+---+ | | | | | | | veth | | | | | | | +--+---+ | | | | | | ^ | | | | | | +------------------------------------------------------------------------------+ | | | | | | | | | | | +-----------------------------------------------+-----------------------------------+-----------------------------------+ v Physical Network (192.168.31.0/24) æ¯åˆ›å»ºä¸€ä¸ªæ–°å®¹å™¨ï¼Œéƒ½ä¼šåœ¨å®¹å™¨çš„ namespace é‡Œæ–°å»ºä¸€ä¸ª veth æ¥å£å¹¶å‘½ä»¤ä¸º eth0ï¼ŒåŒæ—¶åœ¨ä¸» namespace åˆ›å»ºä¸€ä¸ª vethï¼Œå°†å®¹å™¨çš„ eth0 ä¸ docker0 è¿æ¥ã€‚ å¯ä»¥åœ¨å®¹å™¨ä¸­é€šè¿‡ iproute2 æŸ¥çœ‹åˆ°ï¼Œ eth0 çš„æ¥å£ç±»å‹ä¸º vethï¼š â¯ docker run -it --rm debian:buster bash root@5facbe4ddc1e:/# ip --details addr ls 1: lo: \u003cLOOPBACK,UP,LOWER_UP\u003e mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 promiscuity 0 minmtu 0 maxmtu 0 numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever 20: eth0@if21: \u003cBROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 qdisc noqueue state UP group default link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0 promiscuity 0 minmtu 68 maxmtu 65535 veth numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535 inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0 valid_lft forever preferred_lft forever åŒæ—¶åœ¨å®¿ä¸»æœºä¸­èƒ½çœ‹åˆ°å¯¹åº”çš„ veth è®¾å¤‡æ˜¯ç»‘å®šåˆ°äº† docker0 ç½‘æ¡¥çš„ï¼š â¯ sudo brctl show bridge name bridge id STP enabled interfaces docker0 8000.0242fce99ef5 no vethea4171a ","date":"2021-08-14","objectID":"/posts/linux-virtual-network-interfaces/:3:2","tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨"],"title":"Linux ä¸­çš„è™šæ‹Ÿç½‘ç»œæ¥å£","uri":"/posts/linux-virtual-network-interfaces/"},{"categories":["æŠ€æœ¯"],"content":"å››ã€macvlan ç›®å‰ docker/podman éƒ½æ”¯æŒåˆ›å»ºåŸºäº macvlan çš„ Linux å®¹å™¨ç½‘ç»œã€‚ æ³¨æ„ macvlan å’Œ WiFi å­˜åœ¨å…¼å®¹é—®é¢˜ï¼Œå¦‚æœä½¿ç”¨ç¬”è®°æœ¬æµ‹è¯•ï¼Œå¯èƒ½ä¼šé‡åˆ°éº»çƒ¦ã€‚ å‚è€ƒæ–‡æ¡£ï¼šlinux ç½‘ç»œè™šæ‹ŸåŒ–ï¼š macvlan macvlan æ˜¯æ¯”è¾ƒæ–°çš„ Linux ç‰¹æ€§ï¼Œéœ€è¦å†…æ ¸ç‰ˆæœ¬ \u003e= 3.9ï¼Œå®ƒè¢«ç”¨äºåœ¨ä¸»æœºçš„ç½‘ç»œæ¥å£ï¼ˆçˆ¶æ¥å£ï¼‰ä¸Šé…ç½®å¤šä¸ªè™šæ‹Ÿå­æ¥å£ï¼Œè¿™äº›å­æ¥å£éƒ½æ‹¥æœ‰å„è‡ªç‹¬ç«‹çš„ mac åœ°å€ï¼Œä¹Ÿå¯ä»¥é…ä¸Š ip åœ°å€è¿›è¡Œé€šè®¯ã€‚ macvlan ä¸‹çš„è™šæ‹Ÿæœºæˆ–è€…å®¹å™¨ç½‘ç»œå’Œä¸»æœºåœ¨åŒä¸€ä¸ªç½‘æ®µä¸­ï¼Œå…±äº«åŒä¸€ä¸ªå¹¿æ’­åŸŸã€‚macvlan å’Œ bridge æ¯”è¾ƒç›¸ä¼¼ï¼Œä½†å› ä¸ºå®ƒçœå»äº† bridge çš„å­˜åœ¨ï¼Œæ‰€ä»¥é…ç½®å’Œè°ƒè¯•èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œè€Œä¸”æ•ˆç‡ä¹Ÿç›¸å¯¹é«˜ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œmacvlan è‡ªèº«ä¹Ÿå®Œç¾æ”¯æŒ VLANã€‚ å¦‚æœå¸Œæœ›å®¹å™¨æˆ–è€…è™šæ‹Ÿæœºæ”¾åœ¨ä¸»æœºç›¸åŒçš„ç½‘ç»œä¸­ï¼Œäº«å—å·²ç»å­˜åœ¨ç½‘ç»œæ ˆçš„å„ç§ä¼˜åŠ¿ï¼Œå¯ä»¥è€ƒè™‘ macvlanã€‚ æˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« å¯¹ docker çš„ macvlan/ipvlan åšä¸ªåˆ†æï¼Œè¿™é‡Œå…ˆç•¥è¿‡äº†â€¦ ","date":"2021-08-14","objectID":"/posts/linux-virtual-network-interfaces/:4:0","tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨"],"title":"Linux ä¸­çš„è™šæ‹Ÿç½‘ç»œæ¥å£","uri":"/posts/linux-virtual-network-interfaces/"},{"categories":["æŠ€æœ¯"],"content":"äº”ã€ipvlan linux ç½‘ç»œè™šæ‹ŸåŒ–ï¼š ipvlan cilium 1.9 å·²ç»æä¾›äº†åŸºäº ipvlan çš„ç½‘ç»œï¼ˆbeta ç‰¹æ€§ï¼‰ï¼Œç”¨äºæ›¿æ¢ä¼ ç»Ÿçš„ veth+bridge å®¹å™¨ç½‘ç»œã€‚è¯¦è§ IPVLAN based Networking (beta) - Cilium 1.9 Docs ipvlan å’Œ macvlan çš„åŠŸèƒ½å¾ˆç±»ä¼¼ï¼Œä¹Ÿæ˜¯ç”¨äºåœ¨ä¸»æœºçš„ç½‘ç»œæ¥å£ï¼ˆçˆ¶æ¥å£ï¼‰ä¸Šé…ç½®å‡ºå¤šä¸ªè™šæ‹Ÿçš„å­æ¥å£ã€‚ä½†ä¸åŒçš„æ˜¯ï¼Œipvlan çš„å„å­æ¥å£æ²¡æœ‰ç‹¬ç«‹çš„ mac åœ°å€ï¼Œå®ƒä»¬å’Œä¸»æœºçš„çˆ¶æ¥å£å…±äº« mac åœ°å€ã€‚ å› ä¸º mac åœ°å€å…±äº«ï¼Œæ‰€ä»¥å¦‚æœä½¿ç”¨ DHCPï¼Œå°±è¦æ³¨æ„ä¸èƒ½ä½¿ç”¨ mac åœ°å€åš DHCPï¼Œéœ€è¦é¢å¤–é…ç½®å”¯ä¸€çš„ clientID. å¦‚æœä½ é‡åˆ°ä»¥ä¸‹çš„æƒ…å†µï¼Œè¯·è€ƒè™‘ä½¿ç”¨ ipvlanï¼š çˆ¶æ¥å£å¯¹ mac åœ°å€æ•°ç›®æœ‰é™åˆ¶ï¼Œæˆ–è€…åœ¨ mac åœ°å€è¿‡å¤šçš„æƒ…å†µä¸‹ä¼šé€ æˆä¸¥é‡çš„æ€§èƒ½æŸå¤± å·¥ä½œåœ¨ 802.11(wireless)æ— çº¿ç½‘ç»œä¸­ï¼ˆmacvlan æ— æ³•å’Œæ— çº¿ç½‘ç»œå…±åŒå·¥ä½œï¼‰ å¸Œæœ›æ­å»ºæ¯”è¾ƒå¤æ‚çš„ç½‘ç»œæ‹“æ‰‘ï¼ˆä¸æ˜¯ç®€å•çš„äºŒå±‚ç½‘ç»œå’Œ VLANï¼‰ï¼Œæ¯”å¦‚è¦å’Œ BGP ç½‘ç»œä¸€èµ·å·¥ä½œ åŸºäº ipvlan/macvlan çš„å®¹å™¨ç½‘ç»œï¼Œæ¯” veth+bridge+iptables çš„æ€§èƒ½è¦æ›´é«˜ã€‚ æˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« å¯¹ docker çš„ macvlan/ipvlan åšä¸ªåˆ†æï¼Œè¿™é‡Œå…ˆç•¥è¿‡äº†â€¦ ","date":"2021-08-14","objectID":"/posts/linux-virtual-network-interfaces/:5:0","tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨"],"title":"Linux ä¸­çš„è™šæ‹Ÿç½‘ç»œæ¥å£","uri":"/posts/linux-virtual-network-interfaces/"},{"categories":["æŠ€æœ¯"],"content":"å…­ã€vlan vlan å³è™šæ‹Ÿå±€åŸŸç½‘ï¼Œæ˜¯ä¸€ä¸ªé“¾è·¯å±‚çš„å¹¿æ’­åŸŸéš”ç¦»æŠ€æœ¯ï¼Œå¯ä»¥ç”¨äºåˆ‡åˆ†å±€åŸŸç½‘ï¼Œè§£å†³å¹¿æ’­æ³›æ»¥å’Œå®‰å…¨æ€§é—®é¢˜ã€‚è¢«éš”ç¦»çš„å¹¿æ’­åŸŸä¹‹é—´éœ€è¦ä¸Šå‡åˆ°ç¬¬ä¸‰å±‚æ‰èƒ½å®Œæˆé€šè®¯ã€‚ å¸¸ç”¨çš„ä¼ä¸šè·¯ç”±å™¨å¦‚ ER-X åŸºæœ¬éƒ½å¯ä»¥è®¾ç½® vlanï¼ŒLinux ä¹Ÿç›´æ¥æ”¯æŒäº† vlan. ä»¥å¤ªç½‘æ•°æ®åŒ…æœ‰ä¸€ä¸ªä¸“é—¨çš„å­—æ®µæä¾›ç»™ vlan ä½¿ç”¨ï¼Œvlan æ•°æ®åŒ…ä¼šåœ¨è¯¥ä½ç½®è®°å½•å®ƒçš„ VLAN IDï¼Œäº¤æ¢æœºé€šè¿‡è¯¥ ID æ¥åŒºåˆ†ä¸åŒçš„ VLANï¼Œåªå°†è¯¥ä»¥å¤ªç½‘æŠ¥æ–‡å¹¿æ’­åˆ°è¯¥ ID å¯¹åº”çš„ VLAN ä¸­ã€‚ ","date":"2021-08-14","objectID":"/posts/linux-virtual-network-interfaces/:6:0","tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨"],"title":"Linux ä¸­çš„è™šæ‹Ÿç½‘ç»œæ¥å£","uri":"/posts/linux-virtual-network-interfaces/"},{"categories":["æŠ€æœ¯"],"content":"ä¸ƒã€vxlan/geneve rfc8926 - Geneve: Generic Network Virtualization Encapsulation rfc7348 - Virtual eXtensible Local Area Network (VXLAN) linux ä¸Šå®ç° vxlan ç½‘ç»œ åœ¨ä»‹ç» vxlan å‰ï¼Œå…ˆè¯´æ˜ä¸‹ä¸¤ä¸ªåè¯çš„å«ä¹‰ï¼š underlay ç½‘ç»œï¼šå³ç‰©ç†ç½‘ç»œ overlay ç½‘ç»œï¼šæŒ‡åœ¨ç°æœ‰çš„ç‰©ç†ç½‘ç»œä¹‹ä¸Šæ„å»ºçš„è™šæ‹Ÿç½‘ç»œã€‚å…¶å®å°±æ˜¯ä¸€ç§éš§é“æŠ€æœ¯ï¼Œå°†åŸç”Ÿæ€çš„äºŒå±‚æ•°æ®å¸§æŠ¥æ–‡è¿›è¡Œå°è£…åé€šè¿‡éš§é“è¿›è¡Œä¼ è¾“ã€‚ vxlan ä¸ geneve éƒ½æ˜¯ overlay ç½‘ç»œåè®®ï¼Œå®ƒä¿©éƒ½æ˜¯ä½¿ç”¨ UDP åŒ…æ¥å°è£…é“¾è·¯å±‚çš„ä»¥å¤ªç½‘å¸§ã€‚ vxlan åœ¨ 2014 å¹´æ ‡å‡†åŒ–ï¼Œè€Œ geneve åœ¨ 2020 å¹´åº•æ‰é€šè¿‡è‰æ¡ˆé˜¶æ®µï¼Œç›®å‰å°šæœªå½¢æˆæœ€ç»ˆæ ‡å‡†ã€‚ä½†æ˜¯ç›®å‰ linux/cilium éƒ½å·²ç»æ”¯æŒäº† geneve. geneve ç›¸å¯¹ vxlan æœ€å¤§çš„å˜åŒ–ï¼Œæ˜¯å®ƒæ›´çµæ´»â€”â€”å®ƒçš„ header é•¿åº¦æ˜¯å¯å˜çš„ã€‚ ç›®å‰æ‰€æœ‰ overlay çš„è·¨ä¸»æœºå®¹å™¨ç½‘ç»œæ–¹æ¡ˆï¼Œå‡ ä¹éƒ½æ˜¯åŸºäº vxlan å®ç°çš„ï¼ˆä¾‹å¤–ï¼šcilium ä¹Ÿæ”¯æŒ geneveï¼‰ã€‚ æˆ‘ä»¬åœ¨å­¦ä¹ å•æœºçš„å®¹å™¨ç½‘ç»œæ—¶ï¼Œä¸éœ€è¦æ¥è§¦åˆ° vxlanï¼Œä½†æ˜¯åœ¨å­¦ä¹ è·¨ä¸»æœºå®¹å™¨ç½‘ç»œæ–¹æ¡ˆå¦‚ flannel/calico/cilium æ—¶ï¼Œé‚£ vxlan(overlay) åŠ BGP(underlay) å°±ä¸å¯é¿å…åœ°è¦æ¥è§¦äº†ã€‚ å…ˆä»‹ç»ä¸‹ vxlan çš„æ•°æ®åŒ…ç»“æ„ï¼š VXLAN æ ˆå¸§ç»“æ„\" VXLAN æ ˆå¸§ç»“æ„ åœ¨åˆ›å»º vxlan çš„ vtep è™šæ‹Ÿè®¾å¤‡æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨è®¾ç½®å›¾ä¸­çš„å¦‚ä¸‹å±æ€§ï¼š VXLAN ç›®æ ‡ç«¯å£ï¼šå³æ¥æ”¶æ–¹ vtep ä½¿ç”¨çš„ç«¯å£ï¼Œè¿™é‡Œ IANA å®šä¹‰çš„ç«¯å£æ˜¯ 4789ï¼Œä½†æ˜¯åªæœ‰ calico çš„ vxlan æ¨¡å¼é»˜è®¤ä½¿ç”¨è¯¥ç«¯å£ calicoï¼Œè€Œ cilium/flannel çš„é»˜è®¤ç«¯å£éƒ½æ˜¯ Linux é»˜è®¤çš„ 8472. VNID: æ¯ä¸ª VXLAN ç½‘ç»œæ¥å£éƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ªç‹¬ç«‹çš„ VNID ä¸€ä¸ªç‚¹å¯¹ç‚¹çš„ vxlan ç½‘ç»œæ¶æ„å›¾å¦‚ä¸‹: VXLAN ç‚¹å¯¹ç‚¹ç½‘ç»œæ¶æ„\" VXLAN ç‚¹å¯¹ç‚¹ç½‘ç»œæ¶æ„ å¯ä»¥çœ‹åˆ°æ¯å°è™šæ‹Ÿæœº VM éƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„ VNIDï¼Œç„¶åä¸¤å°ç‰©ç†æœºä¹‹é—´é€šè¿‡ VTEP è™šæ‹Ÿç½‘ç»œè®¾å¤‡å»ºç«‹äº† VXLAN éš§é“ï¼Œæ‰€æœ‰ VXLAN ç½‘ç»œä¸­çš„è™šæ‹Ÿæœºï¼Œéƒ½é€šè¿‡ VTEP æ¥äº’ç›¸é€šä¿¡ã€‚ æœ‰äº†ä¸Šé¢è¿™äº›çŸ¥è¯†ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤åœ¨ä¸¤å° Linux æœºå™¨é—´å»ºç«‹ä¸€ä¸ªç‚¹å¯¹ç‚¹çš„ VXLAN éš§é“ï¼š # åœ¨ä¸»æœº A ä¸Šåˆ›å»º VTEP è®¾å¤‡ vxlan0 # ä¸å¦ä¸€ä¸ª vtep æ¥å£ Bï¼ˆ192.168.8.101ï¼‰å»ºç«‹éš§é“ # å°† vxlan0 è‡ªèº«çš„ IP åœ°å€è®¾ä¸º 192.168.8.100 # ä½¿ç”¨çš„ VXLAN ç›®æ ‡ç«¯å£ä¸º 4789(IANA æ ‡å‡†) ip link add vxlan0 type vxlan \\ id 42 \\ dstport 4789 \\ remote 192.168.8.101 \\ local 192.168.8.100 \\ dev enp0s8 # ä¸ºæˆ‘ä»¬çš„ VXLAN ç½‘ç»œè®¾ç½®è™šæ‹Ÿç½‘æ®µï¼Œvxlan0 å°±æ˜¯é»˜è®¤ç½‘å…³ ip addr add 10.20.1.2/24 dev vxlan0 # å¯ç”¨æˆ‘ä»¬çš„ vxlan0 è®¾å¤‡ï¼Œè¿™ä¼šè‡ªåŠ¨ç”Ÿæˆè·¯ç”±è§„åˆ™ ip link set vxlan0 up # ç°åœ¨åœ¨ä¸»æœº B ä¸Šè¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼ŒåŒæ ·åˆ›å»ºä¸€ä¸ª VTEP è®¾å¤‡ vxlan0ï¼Œremote å’Œ local çš„ ip ä¸å‰é¢ç”¨çš„å‘½ä»¤åˆšå¥½ç›¸åã€‚ # æ³¨æ„ VNID å’Œ dstport å¿…é¡»å’Œå‰é¢å®Œå…¨ä¸€è‡´ ip link add vxlan0 type vxlan \\ id 42 \\ dstport 4789 \\ remote 192.168.8.100 \\ local 192.168.8.101 \\ dev enp0s8 # ä¸ºæˆ‘ä»¬çš„ VXLAN ç½‘ç»œè®¾ç½®è™šæ‹Ÿç½‘æ®µï¼Œvxlan0 å°±æ˜¯é»˜è®¤ç½‘å…³ ip addr add 10.20.1.3/24 dev vxlan0 ip link set vxlan0 up # åˆ°è¿™é‡Œï¼Œä¸¤å°æœºå™¨å°±å®Œæˆè¿æ¥ï¼Œå¯ä»¥é€šä¿¡äº†ã€‚å¯ä»¥åœ¨ä¸»æœº B ä¸Š ping 10.20.1.2 è¯•è¯•ï¼Œåº”è¯¥èƒ½æ”¶åˆ°ä¸»æœº A çš„å›åº”ã€‚ ping 10.20.1.2 ç‚¹å¯¹ç‚¹çš„ vxlan éš§é“å®é™…ç”¨å¤„ä¸å¤§ï¼Œå¦‚æœé›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½äº’ç›¸å»º vxlan éš§é“ï¼Œä»£ä»·å¤ªé«˜äº†ã€‚ ä¸€ç§æ›´å¥½çš„æ–¹å¼ï¼Œæ˜¯ä½¿ç”¨ ã€Œç»„æ’­æ¨¡å¼ã€çš„ vxlan éš§é“ï¼Œè¿™ç§æ¨¡å¼ä¸‹ä¸€ä¸ª vtep å¯ä»¥ä¸€æ¬¡ä¸ç»„å†…çš„æ‰€æœ‰ vtep å»ºç«‹éš§é“ã€‚ ç¤ºä¾‹å‘½ä»¤å¦‚ä¸‹ï¼ˆè¿™é‡Œç•¥è¿‡äº†å¦‚ä½•è®¾ç½®ç»„æ’­åœ°å€ 239.1.1.1 çš„ä¿¡æ¯ï¼‰ï¼š ip link add vxlan0 type vxlan \\ id 42 \\ dstport 4789 \\ group 239.1.1.1 \\ dev enp0s8 ip addr add 10.20.1.2/24 dev vxlan0 ip link set vxlan0 up å¯ä»¥çœ‹åˆ°ï¼Œåªéœ€è¦ç®€å•åœ°æŠŠ local_ip/remote_ip æ›¿æ¢æˆä¸€ä¸ªç»„æ’­åœ°å€å°±è¡Œã€‚ç»„æ’­åŠŸèƒ½ä¼šå°†æ”¶åˆ°çš„æ•°æ®åŒ…å‘é€ç»™ç»„é‡Œçš„æ‰€æœ‰ vtep æ¥å£ï¼Œä½†æ˜¯åªæœ‰ VNID èƒ½å¯¹ä¸Šçš„ vtep ä¼šå¤„ç†è¯¥æŠ¥æ–‡ï¼Œå…¶ä»– vtep ä¼šç›´æ¥ä¸¢å¼ƒæ•°æ®ã€‚ æ¥ä¸‹æ¥ï¼Œä¸ºäº†èƒ½è®©æ‰€æœ‰çš„è™šæ‹Ÿæœº/å®¹å™¨ï¼Œéƒ½é€šè¿‡ vtep é€šä¿¡ï¼Œæˆ‘ä»¬å†æ·»åŠ ä¸€ä¸ª bridge ç½‘ç»œï¼Œå……å½“ vtep ä¸å®¹å™¨é—´çš„äº¤æ¢æœºã€‚æ¶æ„å¦‚ä¸‹ï¼š VXLAN å¤šæ’­ç½‘ç»œæ¶æ„\" VXLAN å¤šæ’­ç½‘ç»œæ¶æ„ ä½¿ç”¨ ip å‘½ä»¤åˆ›å»ºç½‘æ¡¥ã€ç½‘ç»œåå­—ç©ºé—´ã€veth pairs ç»„æˆä¸Šå›¾ä¸­çš„å®¹å™¨ç½‘ç»œï¼š # åˆ›å»º br0 å¹¶å°† vxlan0 ç»‘å®šä¸Šå» ip link add br0 type bridge ip link set vxlan0 master bridge ip link set vxlan0 up ip link set br0 up # æ¨¡æ‹Ÿå°†å®¹å™¨åŠ å…¥åˆ°ç½‘æ¡¥ä¸­çš„æ“ä½œ ip netns add container1 ## åˆ›å»º veth pairï¼Œå¹¶æŠŠä¸€ç«¯åŠ åˆ°ç½‘æ¡¥ä¸Š ip link add veth0 type veth peer name veth1 ip link set dev veth0 master br0 ip link set dev veth0 up ## é…ç½®å®¹å™¨å†…éƒ¨çš„ç½‘ç»œå’Œ IP ip link set dev veth1 netns container1 ip netns exec container1 ip link set lo up ip netns exec container1 ip link set veth1 name eth0 ip netns exec container1 ip addr add 10.20.1.11/24 dev eth0 ip netns exec container1 ip link set eth0 up ç„¶ååœ¨å¦ä¸€å°æœºå™¨ä¸ŠåšåŒæ ·çš„æ“ä½œï¼Œå¹¶åˆ›å»ºæ–°å®¹å™¨ï¼Œä¸¤ä¸ªå®¹å™¨å°±èƒ½é€šè¿‡ vxlan é€šä¿¡å•¦~ ","date":"2021-08-14","objectID":"/posts/linux-virtual-network-interfaces/:7:0","tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨"],"title":"Linux ä¸­çš„è™šæ‹Ÿç½‘ç»œæ¥å£","uri":"/posts/linux-virtual-network-interfaces/"},{"categories":["æŠ€æœ¯"],"content":"æ¯”ç»„æ’­æ›´é«˜æ•ˆçš„ vxlan å®ç° ç»„æ’­æœ€å¤§çš„é—®é¢˜åœ¨äºï¼Œå› ä¸ºå®ƒä¸çŸ¥é“æ•°æ®çš„ç›®çš„åœ°ï¼Œæ‰€ä»¥æ¯ä¸ª vtep éƒ½å‘äº†ä¸€ä»½ã€‚å¦‚æœæ¯æ¬¡å‘æ•°æ®æ—¶ï¼Œå¦‚æœèƒ½å¤Ÿç²¾ç¡®åˆ°å¯¹åº”çš„ vtepï¼Œå°±èƒ½èŠ‚çº¦å¤§é‡èµ„æºã€‚ å¦ä¸€ä¸ªé—®é¢˜æ˜¯ ARP æŸ¥è¯¢ä¹Ÿä¼šè¢«ç»„æ’­ï¼Œè¦çŸ¥é“ vxlan æœ¬èº«å°±æ˜¯ä¸ª overlay ç½‘ç»œï¼ŒARP çš„æˆæœ¬ä¹Ÿå¾ˆé«˜ã€‚ ä¸Šè¿°é—®é¢˜éƒ½å¯ä»¥é€šè¿‡ä¸€ä¸ªä¸­å¿ƒåŒ–çš„æ³¨å†Œä¸­å¿ƒï¼ˆå¦‚ etcdï¼‰æ¥è§£å†³ï¼Œæ‰€æœ‰å®¹å™¨ã€ç½‘ç»œçš„æ³¨å†Œä¸å˜æ›´ï¼Œéƒ½å†™å…¥åˆ°è¿™ä¸ªæ³¨å†Œä¸­å¿ƒï¼Œç„¶åç”±ç¨‹åºè‡ªåŠ¨ç»´æŠ¤ vtep ä¹‹é—´çš„éš§é“ã€fdb è¡¨åŠ ARP è¡¨. ","date":"2021-08-14","objectID":"/posts/linux-virtual-network-interfaces/:7:1","tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨"],"title":"Linux ä¸­çš„è™šæ‹Ÿç½‘ç»œæ¥å£","uri":"/posts/linux-virtual-network-interfaces/"},{"categories":["æŠ€æœ¯"],"content":"å…«ã€è™šæ‹Ÿç½‘ç»œæ¥å£çš„é€Ÿç‡ Loopback å’Œæœ¬ç« è®²åˆ°çš„å…¶ä»–è™šæ‹Ÿç½‘ç»œæ¥å£ä¸€æ ·ï¼Œéƒ½æ˜¯ä¸€ç§è½¯ä»¶æ¨¡æ‹Ÿçš„ç½‘ç»œè®¾å¤‡ã€‚ ä»–ä»¬çš„é€Ÿç‡æ˜¯ä¸æ˜¯ä¹Ÿåƒç‰©ç†é“¾è·¯ä¸€æ ·ï¼Œå­˜åœ¨é“¾è·¯å±‚ï¼ˆæ¯”å¦‚ä»¥å¤ªç½‘ï¼‰çš„å¸¦å®½é™åˆ¶å‘¢ï¼Ÿ æ¯”å¦‚ç›®å‰å¾ˆå¤šè€æ—§çš„ç½‘ç»œè®¾å¤‡ï¼Œéƒ½æ˜¯åªæ”¯æŒåˆ°ç™¾å…†ä»¥å¤ªç½‘ï¼Œè¿™å°±å†³å®šäº†å®ƒçš„å¸¦å®½ä¸Šé™ã€‚ å³ä½¿æ˜¯è¾ƒæ–°çš„è®¾å¤‡ï¼Œç›®å‰åŸºæœ¬ä¹Ÿéƒ½åªæ”¯æŒåˆ°åƒå…†ï¼Œä¹Ÿå°±æ˜¯ 1GbE ä»¥å¤ªç½‘æ ‡å‡†ï¼Œé‚£æœ¬æ–‡æåˆ°çš„è™šæ‹Ÿç½‘ç»œæ¥å£å•çº¯åœ¨æœ¬æœºå†…éƒ¨é€šä¿¡ï¼Œæ˜¯å¦ä¹Ÿå­˜åœ¨è¿™æ ·çš„åˆ¶çº¦å‘¢ï¼Ÿæ˜¯å¦ä¹Ÿåªèƒ½è·‘åˆ° 1GbE? ä½¿ç”¨ ethtool æ£€æŸ¥ï¼š # docker å®¹å™¨çš„ veth æ¥å£é€Ÿç‡ \u003e ethtool vethe899841 | grep Speed Speed: 10000Mb/s # ç½‘æ¡¥çœ‹èµ·æ¥æ²¡æœ‰å›ºå®šçš„é€Ÿç‡ \u003e ethtool docker0 | grep Speed Speed: Unknown! # tun0 è®¾å¤‡çš„é»˜è®¤é€Ÿç‡è²Œä¼¼æ˜¯ 10Mb/s ? \u003e ethtool tun0 | grep Speed Speed: 10Mb/s # æ­¤å¤– ethtool æ— æ³•æ£€æŸ¥ lo ä»¥åŠ wifi çš„é€Ÿç‡ ","date":"2021-08-14","objectID":"/posts/linux-virtual-network-interfaces/:8:0","tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨"],"title":"Linux ä¸­çš„è™šæ‹Ÿç½‘ç»œæ¥å£","uri":"/posts/linux-virtual-network-interfaces/"},{"categories":["æŠ€æœ¯"],"content":"ç½‘ç»œæ€§èƒ½å®æµ‹ æ¥ä¸‹æ¥å®é™…æµ‹è¯•ä¸€ä¸‹ï¼Œå…ˆç»™å‡ºæœºå™¨å‚æ•°ï¼š â¯ cat /etc/os-release NAME=\"openSUSE Tumbleweed\" # VERSION=\"20210810\" ... â¯ uname -a Linux legion-book 5.13.8-1-default #1 SMP Thu Aug 5 08:56:22 UTC 2021 (967c6a8) x86_64 x86_64 x86_64 GNU/Linux â¯ lscpu Architecture: x86_64 CPU(s): 16 Model name: AMD Ryzen 7 5800H with Radeon Graphics ... # å†…å­˜ï¼Œå•ä½ MB â¯ free -m total used free shared buff/cache available Mem: 27929 4482 17324 249 6122 22797 Swap: 2048 0 2048 ä½¿ç”¨ iperf3 æµ‹è¯•ï¼š # å¯åŠ¨æœåŠ¡ç«¯ iperf3 -s ------------- # æ–°çª—å£å¯åŠ¨å®¢æˆ·ç«¯ï¼Œé€šè¿‡ loopback æ¥å£è®¿é—® iperf3-serverï¼Œå¤§æ¦‚ 49Gb/s â¯ iperf3 -c 127.0.0.1 Connecting to host 127.0.0.1, port 5201 [ 5] local 127.0.0.1 port 48656 connected to 127.0.0.1 port 5201 [ ID] Interval Transfer Bitrate Retr Cwnd [ 5] 0.00-1.00 sec 4.46 GBytes 38.3 Gbits/sec 0 1.62 MBytes [ 5] 1.00-2.00 sec 4.61 GBytes 39.6 Gbits/sec 0 1.62 MBytes [ 5] 2.00-3.00 sec 5.69 GBytes 48.9 Gbits/sec 0 1.62 MBytes [ 5] 3.00-4.00 sec 6.11 GBytes 52.5 Gbits/sec 0 1.62 MBytes [ 5] 4.00-5.00 sec 6.04 GBytes 51.9 Gbits/sec 0 1.62 MBytes [ 5] 5.00-6.00 sec 6.05 GBytes 52.0 Gbits/sec 0 1.62 MBytes [ 5] 6.00-7.00 sec 6.01 GBytes 51.6 Gbits/sec 0 1.62 MBytes [ 5] 7.00-8.00 sec 6.05 GBytes 52.0 Gbits/sec 0 1.62 MBytes [ 5] 8.00-9.00 sec 6.34 GBytes 54.5 Gbits/sec 0 1.62 MBytes [ 5] 9.00-10.00 sec 5.91 GBytes 50.8 Gbits/sec 0 1.62 MBytes - - - - - - - - - - - - - - - - - - - - - - - - - [ ID] Interval Transfer Bitrate Retr [ 5] 0.00-10.00 sec 57.3 GBytes 49.2 Gbits/sec 0 sender [ 5] 0.00-10.00 sec 57.3 GBytes 49.2 Gbits/sec receiver # å®¢æˆ·ç«¯é€šè¿‡ wlp4s0 wifi ç½‘å¡(192.168.31.228)è®¿é—® iperf3-serverï¼Œå®é™…è¿˜æ˜¯èµ°çš„æœ¬æœºï¼Œä½†æ˜¯é€Ÿåº¦è¦æ¯” loopback å¿«ä¸€ç‚¹ï¼Œå¯èƒ½æ˜¯é»˜è®¤è®¾ç½®çš„é—®é¢˜ â¯ iperf3 -c 192.168.31.228 Connecting to host 192.168.31.228, port 5201 [ 5] local 192.168.31.228 port 43430 connected to 192.168.31.228 port 5201 [ ID] Interval Transfer Bitrate Retr Cwnd [ 5] 0.00-1.00 sec 5.12 GBytes 43.9 Gbits/sec 0 1.25 MBytes [ 5] 1.00-2.00 sec 5.29 GBytes 45.5 Gbits/sec 0 1.25 MBytes [ 5] 2.00-3.00 sec 5.92 GBytes 50.9 Gbits/sec 0 1.25 MBytes [ 5] 3.00-4.00 sec 6.00 GBytes 51.5 Gbits/sec 0 1.25 MBytes [ 5] 4.00-5.00 sec 5.98 GBytes 51.4 Gbits/sec 0 1.25 MBytes [ 5] 5.00-6.00 sec 6.05 GBytes 52.0 Gbits/sec 0 1.25 MBytes [ 5] 6.00-7.00 sec 6.16 GBytes 52.9 Gbits/sec 0 1.25 MBytes [ 5] 7.00-8.00 sec 6.08 GBytes 52.2 Gbits/sec 0 1.25 MBytes [ 5] 8.00-9.00 sec 6.00 GBytes 51.6 Gbits/sec 0 1.25 MBytes [ 5] 9.00-10.00 sec 6.01 GBytes 51.6 Gbits/sec 0 1.25 MBytes - - - - - - - - - - - - - - - - - - - - - - - - - [ ID] Interval Transfer Bitrate Retr [ 5] 0.00-10.00 sec 58.6 GBytes 50.3 Gbits/sec 0 sender [ 5] 0.00-10.00 sec 58.6 GBytes 50.3 Gbits/sec receiver # ä»å®¹å™¨ä¸­è®¿é—®å®¿ä¸»æœºçš„ iperf3-serverï¼Œé€Ÿåº¦å‡ ä¹æ²¡åŒºåˆ« â¯ docker run -it --rm --name=iperf3-server networkstatic/iperf3 -c 192.168.31.228 Connecting to host 192.168.31.228, port 5201 [ 5] local 172.17.0.2 port 43436 connected to 192.168.31.228 port 5201 [ ID] Interval Transfer Bitrate Retr Cwnd [ 5] 0.00-1.00 sec 4.49 GBytes 38.5 Gbits/sec 0 403 KBytes [ 5] 1.00-2.00 sec 5.31 GBytes 45.6 Gbits/sec 0 544 KBytes [ 5] 2.00-3.00 sec 6.14 GBytes 52.8 Gbits/sec 0 544 KBytes [ 5] 3.00-4.00 sec 5.85 GBytes 50.3 Gbits/sec 0 544 KBytes [ 5] 4.00-5.00 sec 6.14 GBytes 52.7 Gbits/sec 0 544 KBytes [ 5] 5.00-6.00 sec 5.99 GBytes 51.5 Gbits/sec 0 544 KBytes [ 5] 6.00-7.00 sec 5.86 GBytes 50.4 Gbits/sec 0 544 KBytes [ 5] 7.00-8.00 sec 6.05 GBytes 52.0 Gbits/sec 0 544 KBytes [ 5] 8.00-9.00 sec 5.99 GBytes 51.5 Gbits/sec 0 544 KBytes [ 5] 9.00-10.00 sec 6.12 GBytes 52.5 Gbits/sec 0 544 KBytes - - - - - - - - - - - - - - - - - - - - - - - - - [ ID] Interval Transfer Bitrate Retr [ 5] 0.00-10.00 sec 58.0 GBytes 49.8 Gbits/sec 0 sender [ 5] 0.00-10.00 sec 58.0 GBytes 49.8 Gbits/sec receiver æŠŠ iperf3-server è·‘åœ¨å®¹å™¨é‡Œå†æµ‹ä¸€éï¼š # åœ¨å®¹å™¨ä¸­å¯åŠ¨ iperf3-serverï¼Œå¹¶æ˜ å°„åˆ°å®¿ä¸»æœºç«¯å£ 6201 \u003e docker run -it --rm --name=iperf3-server -p 6201:5201 networkstatic/iperf3 -s \u003e docker inspect --format \"{{ .NetworkSettings.IPAddress }}\" iperf3-server 172.17.0.2 ----------------------------- # æµ‹è¯•å®¹å™¨ä¹‹é—´äº’è®¿çš„é€Ÿåº¦ï¼Œip ä¸º iperf3-server çš„å®¹å™¨ ipï¼Œé€Ÿåº¦è¦æ…¢ä¸€äº›ã€‚ # æ¯•ç«Ÿè¿‡äº† veth -\u003e veth -\u003e docker0 -\u003e veth","date":"2021-08-14","objectID":"/posts/linux-virtual-network-interfaces/:8:1","tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨"],"title":"Linux ä¸­çš„è™šæ‹Ÿç½‘ç»œæ¥å£","uri":"/posts/linux-virtual-network-interfaces/"},{"categories":["æŠ€æœ¯"],"content":"å‚è€ƒ Linuxè™šæ‹Ÿç½‘ç»œè®¾å¤‡ä¹‹tun/tap Linuxè™šæ‹Ÿç½‘ç»œè®¾å¤‡ä¹‹veth äº‘è®¡ç®—åº•å±‚æŠ€æœ¯-è™šæ‹Ÿç½‘ç»œè®¾å¤‡(Bridge,VLAN) äº‘è®¡ç®—åº•å±‚æŠ€æœ¯-è™šæ‹Ÿç½‘ç»œè®¾å¤‡(tun/tap,veth) Universal TUN/TAP device driver - Kernel Docs Tun/Tap interface tutorial Linux Loopback performance with TCP_NODELAY enabled ","date":"2021-08-14","objectID":"/posts/linux-virtual-network-interfaces/:9:0","tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨"],"title":"Linux ä¸­çš„è™šæ‹Ÿç½‘ç»œæ¥å£","uri":"/posts/linux-virtual-network-interfaces/"},{"categories":["æŠ€æœ¯"],"content":" æ–‡ä¸­çš„å‘½ä»¤å‡åœ¨ macOS Big Sur å’Œ Opensuse Tumbleweed ä¸Šæµ‹è¯•é€šè¿‡ ","date":"2021-04-11","objectID":"/posts/socat-netcat/:0:0","tags":["ç½‘ç»œ","Linux","ç½‘ç»œè°ƒè¯•"],"title":"Linux ç½‘ç»œå·¥å…·ä¸­çš„ç‘å£«å†›åˆ€ - socat \u0026 netcat","uri":"/posts/socat-netcat/"},{"categories":["æŠ€æœ¯"],"content":"socat \u0026 netcat netcat(network cat) æ˜¯ä¸€ä¸ªå†å²æ‚ ä¹…çš„ç½‘ç»œå·¥å…·åŒ…ï¼Œè¢«ç§°ä½œ TCP/IP çš„ç‘å£«å†›åˆ€ï¼Œå„å¤§ Linux å‘è¡Œç‰ˆéƒ½æœ‰é»˜è®¤å®‰è£… openbsd ç‰ˆæœ¬çš„ netcatï¼Œå®ƒçš„å‘½ä»¤è¡Œåç§°ä¸º nc. è€Œ socat(socket cat)ï¼Œå®˜æ–¹æ–‡æ¡£æè¿°å®ƒæ˜¯ \"netcat++\" (extended design, new implementation)ï¼Œé¡¹ç›®æ¯”è¾ƒæ´»è·ƒï¼Œkubernetes-client(kubectl) åº•å±‚å°±æ˜¯ä½¿ç”¨çš„å®ƒåšå„ç§æµé‡è½¬å‘ã€‚ åœ¨ä¸æ–¹ä¾¿å®‰è£… socat çš„ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„ netcat. è€Œåœ¨å…¶ä»–ç¯å¢ƒï¼Œå¯ä»¥è€ƒè™‘ä¼˜å…ˆä½¿ç”¨ socat. ","date":"2021-04-11","objectID":"/posts/socat-netcat/:1:0","tags":["ç½‘ç»œ","Linux","ç½‘ç»œè°ƒè¯•"],"title":"Linux ç½‘ç»œå·¥å…·ä¸­çš„ç‘å£«å†›åˆ€ - socat \u0026 netcat","uri":"/posts/socat-netcat/"},{"categories":["æŠ€æœ¯"],"content":"ä¸€ã€ç®€ä»‹ socat çš„åŸºæœ¬å‘½ä»¤æ ¼å¼ï¼š socat [å‚æ•°] åœ°å€1 åœ°å€2 ç»™ socat æä¾›ä¸¤ä¸ªåœ°å€ï¼Œsocat å¹²çš„æ´»å°±æ˜¯æŠŠä¸¤ä¸ªåœ°å€çš„æµå¯¹æ¥èµ·æ¥ã€‚å·¦è¾¹åœ°å€çš„è¾“å‡ºä¼ ç»™å³è¾¹ï¼ŒåŒæ—¶åˆæŠŠå³è¾¹åœ°å€çš„è¾“å‡ºä¼ ç»™å·¦è¾¹ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªåŒå‘çš„æ•°æ®ç®¡é“ã€‚ å¬èµ·æ¥å¥½åƒæ²¡å•¥ç‰¹åˆ«çš„ï¼Œä½†æ˜¯å®é™…ä¸Šè®¡ç®—æœºç½‘ç»œå¹²çš„æ´»ä¹Ÿå°±æ˜¯æ•°æ®ä¼ è¾“è€Œå·²ï¼Œå´å½±å“äº†æ•´ä¸ªä¸–ç•Œï¼Œä¸å¯å°è§‘å®ƒçš„åŠŸèƒ½ã€‚ socat æ”¯æŒéå¸¸å¤šçš„åœ°å€ç±»å‹ï¼š-/stdioï¼ŒTCP, TCP-LISTEN, UDP, UDP-LISTEN, OPEN, EXEC, SOCKS, PROXY ç­‰ç­‰ï¼Œå¯ç”¨äºç«¯å£ç›‘å¬ã€é“¾æ¥ï¼Œæ–‡ä»¶å’Œè¿›ç¨‹è¯»å†™ï¼Œä»£ç†æ¡¥æ¥ç­‰ç­‰ã€‚ socat çš„åŠŸèƒ½å°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œå‘½ä»¤è¡Œå‚æ•°ä¹Ÿå¾ˆç®€æ´ï¼Œå”¯ä¸€éœ€è¦èŠ±ç‚¹ç²¾åŠ›å­¦ä¹ çš„å°±æ˜¯å®ƒå„ç§åœ°å€çš„å®šä¹‰å’Œæ­é…å†™æ³•ã€‚ è€Œ netcat å®šä¹‰è²Œä¼¼æ²¡è¿™ä¹ˆä¸¥è°¨ï¼Œå¯ä»¥ç®€å•çš„ç†è§£ä¸ºç½‘ç»œç‰ˆçš„ cat å‘½ä»¤ 2333 ","date":"2021-04-11","objectID":"/posts/socat-netcat/:2:0","tags":["ç½‘ç»œ","Linux","ç½‘ç»œè°ƒè¯•"],"title":"Linux ç½‘ç»œå·¥å…·ä¸­çš„ç‘å£«å†›åˆ€ - socat \u0026 netcat","uri":"/posts/socat-netcat/"},{"categories":["æŠ€æœ¯"],"content":"äºŒã€å®‰è£…æ–¹æ³• å„å‘è¡Œç‰ˆéƒ½è‡ªå¸¦ netcatï¼ŒåŒ…åé€šå¸¸ä¸º nc-openbsdï¼Œå› æ­¤è¿™é‡Œåªä»‹ç» socat çš„å®‰è£…æ–¹æ³•ï¼š # Debian/Ubuntu sudo apt install socat # CentOS/RedHat sudo yum install socat # macOS brew install socat å…¶ä»–å‘è¡Œç‰ˆåŸºæœ¬ä¹Ÿéƒ½å¯ä»¥ä½¿ç”¨åŒ…ç®¡ç†å™¨å®‰è£… socat ","date":"2021-04-11","objectID":"/posts/socat-netcat/:3:0","tags":["ç½‘ç»œ","Linux","ç½‘ç»œè°ƒè¯•"],"title":"Linux ç½‘ç»œå·¥å…·ä¸­çš„ç‘å£«å†›åˆ€ - socat \u0026 netcat","uri":"/posts/socat-netcat/"},{"categories":["æŠ€æœ¯"],"content":"ä¸‰ã€å¸¸ç”¨å‘½ä»¤ ","date":"2021-04-11","objectID":"/posts/socat-netcat/:4:0","tags":["ç½‘ç»œ","Linux","ç½‘ç»œè°ƒè¯•"],"title":"Linux ç½‘ç»œå·¥å…·ä¸­çš„ç‘å£«å†›åˆ€ - socat \u0026 netcat","uri":"/posts/socat-netcat/"},{"categories":["æŠ€æœ¯"],"content":"1. ç½‘ç»œè°ƒè¯• 1.1 æ£€æµ‹è¿œç¨‹ç«¯å£çš„å¯è¿æ¥æ€§ï¼ˆç¡®è®¤é˜²ç«å¢™æ²¡é—®é¢˜ï¼‰ ä»¥å‰ä½ å¯èƒ½å­¦è¿‡å¦‚ä½•ç”¨ telnet æ¥åšè¿™é¡¹æµ‹è¯•ï¼Œä¸è¿‡ç°åœ¨å¾ˆå¤šå‘è¡Œç‰ˆåŸºæœ¬éƒ½ä¸è‡ªå¸¦ telnet äº†ï¼Œè¿˜éœ€è¦é¢å¤–å®‰è£…ã€‚ telnet å·®ä¸å¤šå·²ç»å¿«å¯¿ç»ˆæ­£å¯äº†ï¼Œè¿˜æ˜¯å»ºè®®ä½¿ç”¨æ›´ä¸“ä¸šçš„ socat/netcat ä½¿ç”¨ socat/netcat æ£€æµ‹è¿œç¨‹ç«¯å£çš„å¯è¿æ¥æ€§ï¼š # -d[ddd] å¢åŠ æ—¥å¿—è¯¦ç»†ç¨‹åº¦ï¼Œ-dd Prints fatal, error, warning, and notice messages. socat -dd - TCP:192.168.1.252:3306 # -v æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ # -z ä¸å‘é€æ•°æ®ï¼Œæ•ˆæœä¸ºç«‹å³å…³é—­è¿æ¥ï¼Œå¿«é€Ÿå¾—å‡ºç»“æœ nc -vz 192.168.1.2 8080 # -vv æ˜¾ç¤ºæ›´è¯¦ç»†çš„å†…å®¹ # -w2 è¶…æ—¶æ—¶é—´è®¾ä¸º 2 ç§’ # ä½¿ç”¨ nc åšç®€å•çš„ç«¯å£æ‰«æ nc -vv -w2 -z 192.168.1.2 20-500 1.2 æµ‹è¯•æœ¬æœºç«¯å£æ˜¯å¦èƒ½æ­£å¸¸è¢«å¤–éƒ¨è®¿é—®ï¼ˆæ£€æµ‹é˜²ç«å¢™ã€è·¯ç”±ï¼‰ åœ¨æœ¬æœºç›‘å¬ä¸€ä¸ª TCP ç«¯å£ï¼Œæ¥æ”¶åˆ°çš„å†…å®¹ä¼ åˆ° stdoutï¼ŒåŒæ—¶å°† stdin çš„è¾“å…¥ä¼ ç»™å®¢æˆ·ç«¯ï¼š # æœåŠ¡ç«¯å¯åŠ¨å‘½ä»¤ï¼Œsocat/nc äºŒé€‰ä¸€ socat TCP-LISTEN:7000 - # -l --listening nc -l 7000 # å®¢æˆ·ç«¯è¿æ¥å‘½ä»¤ï¼Œsocat/nc äºŒé€‰ä¸€ socat TCP:192.168.31.123:7000 - nc 192.168.11.123 7000 UDP åè®®çš„æµ‹è¯•ä¹Ÿéå¸¸ç±»ä¼¼ï¼Œä½¿ç”¨ netcat çš„ç¤ºä¾‹å¦‚ä¸‹ï¼š # æœåŠ¡ç«¯ï¼Œåªç›‘å¬ ipv4 nc -u -l 8080 # å®¢æˆ·ç«¯ nc -u 192.168.31.123 8080 # å®¢æˆ·ç«¯æœ¬æœºæµ‹è¯•ï¼Œæ³¨æ„ localhost ä¼šè¢«ä¼˜å…ˆè§£æä¸º ipv6! è¿™ä¼šå¯¼è‡´æœåŠ¡ç«¯(ipv4)çš„ nc æ¥æ”¶ä¸åˆ°æ•°æ®ï¼ nc -u localhost 8080 ä½¿ç”¨ socat çš„ UDP æµ‹è¯•ç¤ºä¾‹å¦‚ä¸‹ï¼š socat UDP-LISTEN:7000 - socat UDP:192.168.31.123:7000 - 1.3 è°ƒè¯• TLS åè®® å‚è€ƒ socat å®˜æ–¹æ–‡æ¡£ï¼šSecuring Traffic Between two Socat Instances Using SSL æµ‹è¯•è¯ä¹¦åŠç§é’¥çš„ç”Ÿæˆå‚è§ TLS åè®®ã€TLS è¯ä¹¦ã€TLS è¯ä¹¦çš„é…ç½®æ–¹æ³•ã€TLS åŠ å¯†çš„ç ´è§£æ‰‹æ®µ æ¨¡æ‹Ÿä¸€ä¸ª mTLS æœåŠ¡å™¨ï¼Œç›‘å¬ 4433 ç«¯å£ï¼Œæ¥æ”¶åˆ°çš„æ•°æ®åŒæ ·è¾“å‡ºåˆ° stdoutï¼š # socat éœ€è¦ä½¿ç”¨åŒæ—¶åŒ…å«è¯ä¹¦å’Œç§é’¥çš„ pem æ–‡ä»¶ï¼Œç”Ÿæˆæ–¹æ³•å¦‚ä¸‹ cat server.key server.crt \u003e server.pem cat client.key client.crt \u003e client.pem # æœåŠ¡ç«¯å¯åŠ¨å‘½ä»¤ socat openssl-listen:4433,reuseaddr,cert=server.pem,cafile=client.crt - # å®¢æˆ·ç«¯è¿æ¥å‘½ä»¤ socat - openssl-connect:192.168.31.123:4433,cert=client.pem,cafile=server.crt # æˆ–è€…ä½¿ç”¨ curl è¿æ¥(æˆ‘ä»¬çŸ¥é“ ca.crt å’Œ server.crt éƒ½èƒ½è¢«ç”¨åš cacert/cafile) curl -v --cacert ca.crt --cert client.crt --key client.key --tls-max 1.2 https://192.168.31.123:4433 ä¸Šé¢çš„å‘½ä»¤ä½¿ç”¨äº† mTLS åŒå‘è®¤è¯çš„åè®®ï¼Œå¯é€šè¿‡è®¾å®š verify=0 æ¥å…³æ‰å®¢æˆ·ç«¯è®¤è¯ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š # socat éœ€è¦ä½¿ç”¨åŒæ—¶åŒ…å«è¯ä¹¦å’Œç§é’¥çš„ pem æ–‡ä»¶ï¼Œç”Ÿæˆæ–¹æ³•å¦‚ä¸‹ cat server.key server.crt \u003e server.pem # æœåŠ¡ç«¯å¯åŠ¨å‘½ä»¤ socat openssl-listen:4433,reuseaddr,cert=server.pem,verify=0 - # å®¢æˆ·ç«¯è¿æ¥å‘½ä»¤ï¼Œå¦‚æœ ip/åŸŸåä¸å—è¯ä¹¦ä¿æŠ¤ï¼Œå°±ä¹Ÿéœ€è¦æ·»åŠ  verify=0 socat - openssl-connect:192.168.31.123:4433,cafile=server.crt # æˆ–è€…ä½¿ç”¨ curl è¿æ¥ï¼Œè¯ä¹¦æ— æ•ˆè¯·æ·»åŠ  -k è·³è¿‡è¯ä¹¦éªŒè¯ curl -v --cacert server.crt https://192.168.31.123:4433 ","date":"2021-04-11","objectID":"/posts/socat-netcat/:4:1","tags":["ç½‘ç»œ","Linux","ç½‘ç»œè°ƒè¯•"],"title":"Linux ç½‘ç»œå·¥å…·ä¸­çš„ç‘å£«å†›åˆ€ - socat \u0026 netcat","uri":"/posts/socat-netcat/"},{"categories":["æŠ€æœ¯"],"content":"2. æ•°æ®ä¼ è¾“ é€šå¸¸ä¼ è¾“æ–‡ä»¶æ—¶ï¼Œæˆ‘éƒ½ä¹ æƒ¯ä½¿ç”¨ scp/ssh/rsyncï¼Œä½†æ˜¯ socat å…¶å®ä¹Ÿå¯ä»¥ä¼ è¾“æ–‡ä»¶ã€‚ ä»¥å°† demo.tar.gz ä»ä¸»æœº A å‘é€åˆ°ä¸»æœº B ä¸ºä¾‹ï¼Œ é¦–å…ˆåœ¨æ•°æ®å‘é€æ–¹ A æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š # -u è¡¨ç¤ºæ•°æ®åªä»å·¦è¾¹çš„åœ°å€å•å‘ä¼ è¾“ç»™å³è¾¹ï¼ˆsocat é»˜è®¤æ˜¯ä¸€ä¸ªåŒå‘ç®¡é“ï¼‰ # -U å’Œ -u ç›¸åï¼Œæ•°æ®åªä»å³è¾¹å•å‘ä¼ è¾“ç»™å·¦è¾¹ socat -u open:demo.tar.gz tcp-listen:2000,reuseaddr ç„¶ååœ¨æ•°æ®æ¥æ”¶æ–¹ B æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå°±èƒ½æŠŠæ–‡ä»¶æ¥æ”¶åˆ°ï¼š socat -u tcp:192.168.1.252:2000 open:demo.tar.gz,create # å¦‚æœè§‰å¾—å¤ªç¹çï¼Œä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡ stdout é‡å®šå‘ socat -u tcp:192.168.1.252:2000 - \u003e demo.tar.gz ä½¿ç”¨ netcat ä¹Ÿå¯ä»¥å®ç°æ•°æ®ä¼ è¾“ï¼š # å…ˆåœ¨æ¥æ”¶æ–¹å¯åŠ¨æœåŠ¡ç«¯ nc -l -p 8080 \u003e demo.tar.gz # å†åœ¨å‘é€æ–¹å¯åŠ¨å®¢æˆ·ç«¯å‘é€æ•°æ® nc 192.168.1.2 8080 \u003c demo.tar.gz ","date":"2021-04-11","objectID":"/posts/socat-netcat/:5:0","tags":["ç½‘ç»œ","Linux","ç½‘ç»œè°ƒè¯•"],"title":"Linux ç½‘ç»œå·¥å…·ä¸­çš„ç‘å£«å†›åˆ€ - socat \u0026 netcat","uri":"/posts/socat-netcat/"},{"categories":["æŠ€æœ¯"],"content":"3. æ‹…å½“ä¸´æ—¶çš„ web æœåŠ¡å™¨ ä½¿ç”¨ fork reuseaddr SYSTEM ä¸‰ä¸ªå‘½ä»¤ï¼Œå†ç”¨ systemd/supervisor ç®¡ç†ä¸€ä¸‹ï¼Œå°±å¯ä»¥ç”¨å‡ è¡Œå‘½ä»¤å®ç°ä¸€ä¸ªç®€å•çš„åå°æœåŠ¡å™¨ã€‚ ä¸‹é¢çš„å‘½ä»¤å°†ç›‘å¬ 8080 ç«¯å£ï¼Œå¹¶å°†æ•°æ®æµå’Œ web.py çš„ stdio è¿æ¥èµ·æ¥ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æµè§ˆå™¨è®¿é—® http://\u003cip\u003e:8080 æ¥æŸ¥çœ‹æ•ˆæœã€‚ socat TCP-LISTEN:8080,reuseaddr,fork SYSTEM:\"python3 web.py\" å‡è®¾ web.py çš„å†…å®¹ä¸ºï¼š print(\"hello world\") é‚£ curl localhost:8080 å°±åº”è¯¥ä¼šè¾“å‡º hello world ","date":"2021-04-11","objectID":"/posts/socat-netcat/:6:0","tags":["ç½‘ç»œ","Linux","ç½‘ç»œè°ƒè¯•"],"title":"Linux ç½‘ç»œå·¥å…·ä¸­çš„ç‘å£«å†›åˆ€ - socat \u0026 netcat","uri":"/posts/socat-netcat/"},{"categories":["æŠ€æœ¯"],"content":"4. ç«¯å£è½¬å‘ ç›‘å¬ 8080 ç«¯å£ï¼Œå»ºç«‹è¯¥ç«¯å£ä¸ baidu.com:80 ä¹‹é—´çš„åŒå‘ç®¡é“: socat TCP-LISTEN:8080,fork,reuseaddr TCP:baidu.com:80 æ‹¿ curl å‘½ä»¤æµ‹è¯•ä¸€ä¸‹ï¼Œåº”è¯¥èƒ½æ­£å¸¸è®¿é—®åˆ°ç™¾åº¦ï¼š # æ³¨æ„æŒ‡å®š Host curl -v -H 'Host: baidu.com' localhost:8080 ","date":"2021-04-11","objectID":"/posts/socat-netcat/:7:0","tags":["ç½‘ç»œ","Linux","ç½‘ç»œè°ƒè¯•"],"title":"Linux ç½‘ç»œå·¥å…·ä¸­çš„ç‘å£«å†›åˆ€ - socat \u0026 netcat","uri":"/posts/socat-netcat/"},{"categories":["æŠ€æœ¯"],"content":"å‚è€ƒ æ–°ç‰ˆç‘å£«å†›åˆ€ï¼šsocat - éŸ¦æ˜“ç¬‘ - çŸ¥ä¹ ç”¨å¥½ä½ çš„ç‘å£«å†›åˆ€/netcat - éŸ¦æ˜“ç¬‘ - çŸ¥ä¹ socat - Multipurpose relay ","date":"2021-04-11","objectID":"/posts/socat-netcat/:8:0","tags":["ç½‘ç»œ","Linux","ç½‘ç»œè°ƒè¯•"],"title":"Linux ç½‘ç»œå·¥å…·ä¸­çš„ç‘å£«å†›åˆ€ - socat \u0026 netcat","uri":"/posts/socat-netcat/"},{"categories":["éšç¬”"],"content":" 2022-02-09 æ›´æ–°ï¼š2022 å¹´å†å›çœ‹è¿™ç¯‡æ–‡ç« ï¼Œæ˜æ˜¾æ„Ÿè§‰åˆ°æˆ‘çš„è¿›æ­¥å¾ˆå¤§å¾ˆå¤§ï¼Œä¸è®ºæ˜¯å·¥ä½œæ–‡åŒ–ä¸ç¯å¢ƒã€è–ªèµ„ã€åƒå–ç©ä¹ã€è¿˜æ˜¯æ¥è§¦åˆ°çš„çº¿ä¸Šç¯å¢ƒè§„æ¨¡éƒ½æœ‰äº†è´¨çš„å˜åŒ–ï¼Œè¯¦æƒ…è§ 2021 å¹´æ€»ç»“ã€‚ ç›®å‰å¯¹è‡ªå·±çš„è®¤çŸ¥æ›´æ¸…æ™°äº†ï¼ŒæœŸå¾… 2022 å¹´æˆ‘èƒ½ã€Œæ›´ä¸Šä¸€å±‚æ¥¼ã€å“ˆå“ˆ~ 2021-09-04 æ›´æ–°ï¼šåœ¨æ–°å…¬å¸è®¤è¯†åˆ°äº†è‡ªå·±æŠ€æœ¯ã€æ–¹æ³•è®ºã€æ€ç»´æ¨¡å¼ç­‰å¤šæ–¹é¢çš„ä¸è¶³ã€‚ è¿™ç¯‡æ–‡ç« çš„éƒ¨åˆ†å†…å®¹è®©æˆ‘è§‰å¾—æœ‰ç‚¹ç¾è€»â€¦ä¸è¿‡å°±è¿™æ ·å§ï¼Œæ¯•ç«Ÿè¿™ç¡®å®æ˜¯æˆ‘å½“æ—¶çš„æ‰€æ€æ‰€æƒ³â€¦ ","date":"2021-02-06","objectID":"/posts/end-of-the-first-round/:0:0","tags":["æ€»ç»“","å¿ƒå¾—"],"title":"æˆ‘åœ¨åˆ›ä¸šå…¬å¸åšæŠ€æœ¯ä¸€å¹´å¤šçš„ä¸€ç‚¹ä½“ä¼š","uri":"/posts/end-of-the-first-round/"},{"categories":["éšç¬”"],"content":"äººæœ‰æ‚²æ¬¢ç¦»åˆï¼Œæœˆæœ‰é˜´æ™´åœ†ç¼º ä»Šå¹´å¹´åº•çš„æ—¶å€™ï¼Œè‡ªå·±å¿ƒæ€æ‘‡æ‘†ä¸å®šï¼Œè¿™å½±å“åˆ°äº†æˆ‘çš„å·¥ä½œï¼Œé¡ºåŠ¿å°±å‘å…¬å¸æå‡ºäº†ç¦»èŒã€‚ è¿™ä¸¤ä¸‰å¤©å’Œè€æ¿ã€æŠ€æœ¯ç»ç†ï¼Œè¿˜åŒ…æ‹¬å…¬å¸æ¯”è¾ƒå¼ºçš„åŒäº‹ä»¬ï¼Œéƒ½åšäº†ä¸€ç•ªæ²Ÿé€šã€‚ è¿™ä¸€æ˜¯å…¬å¸å¸Œæœ›æˆ‘èƒ½å¤Ÿè®¤åŒå…¬å¸çš„è·¯çº¿å’Œç†å¿µï¼Œè·Ÿç€ä¸€æ¡é“å¾€å‰èµ°ã€‚äºŒå‘¢æˆ‘ä¹Ÿå¾ˆæƒ³çŸ¥é“ï¼Œè€æ¿ã€æŠ€æœ¯ç»ç†ã€è¿˜æœ‰æŠ€æœ¯éª¨å¹²ä»¬ï¼Œä¸ºä»€ä¹ˆèƒ½è¿™ä¹ˆåšå®šä¸ç–‘ï¼Ÿä¸ºä»€ä¹ˆè¿™ä¹ˆæ‹¼ï¼Ÿ ç»“æœæ˜¯æˆ‘å’Œå…¬å¸éƒ½å‘ç°ï¼Œæˆ‘ä»¬ä¸æ˜¯ä¸€è·¯äººï¼Œè§‚å¿µå­˜åœ¨å†²çªã€‚å…¬å¸çš„æŠ€æœ¯éª¨å¹²ä»¬éƒ½æ˜¯åˆ›ä¸šæ€ç»´ï¼Œä»–ä»¬æˆ–è€…ä¹åœ¨å…¶ä¸­ï¼Œæˆ–è€…æ„¿æ„ä¸ºäº†è€æ¿æè¿°çš„æœªæ¥å¿ä¸€æ—¶ç—›è‹¦ã€‚ä»–ä»¬éƒ½æ„¿æ„ä¸ºäº†äº§å“ä»˜å‡ºæ›´å¤šã€‚ ä½†æ˜¯æˆ‘å‘ç°å¯¹å…¬å¸ï¼Œæˆ‘ä¸æ„¿æ„ä»˜å‡ºå¤ªå¤šã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä¸€ç›´å°±æ˜¯ä¸ªæ™®é€šä¸Šç­æ—çš„æƒ³æ³•ï¼Œé«˜ç‚¹å·¥èµ„ï¼Œå¤šç‚¹ä¸ªäººæ—¶é—´ï¼Œåšç€è‡ªå·±å–œæ¬¢çš„äº‹æƒ…ã€‚ äºæ˜¯æˆ‘ç«é€Ÿç¦»èŒã€‚å½“å¤©åŠå®Œäº¤æ¥ï¼Œç­¾å®Œç¦»èŒåè®®ï¼Œæ‹¿ç€ç¦»èŒåè®®å’Œç¦»èŒè¯æ˜ï¼Œå…‰é€Ÿæ’¤é€€ã€‚ è¿™æ˜¯æˆ‘æ¯•ä¸šåçš„ç¬¬ä¸€ä»½å·¥ä½œï¼Œ2019 å¹´ 6 æœˆåº•å…¥èŒï¼Œåœ¨å…¬å¸å‘†äº†ä¸€å¹´å¤šï¼Œå­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿ï¼Œç»ä¸ä»…ä»…åªæ˜¯æŠ€æœ¯ã€‚å› æ­¤æˆ‘è§‰å¾—è‡ªå·±æœ‰å¿…è¦åšä¸€ä¸ªæŠ€æœ¯ä»¥å¤–çš„æ€»ç»“ã€‚ ä»»ä½•ä¸€å®¶å…¬å¸éƒ½æœ‰å¥½æœ‰åï¼Œä½†æ˜¯æŒ‰ç…§æƒ¯ä¾‹ï¼Œè¿™ç¯‡æ–‡ç« ä¼šé¿è€Œä¸è°ˆå…¬å¸ä¸å¥½çš„ä¸œè¥¿ã€‚å…¬å¸çš„åç§°å‘¢ï¼Œè¿™é‡Œå°±ç”¨ W æ¥ä»£æ›¿å§ã€‚ å› ä¸ºæœ‰å‰è¾ˆåœ¨åšå®¢å›­è¯„è®ºé‡Œä¸º W å…¬å¸æ„Ÿåˆ°å¯æƒœï¼Œåœ¨å¼€å§‹æ­£é¢˜ä¹‹å‰ï¼Œè¿˜æ˜¯å…ˆè¯´ä¸‹ç¦»èŒåŸå› ã€‚ å…¶å®è¯´æ¥ä¹Ÿç®€å•ï¼ŒåŸºæœ¬éƒ½èƒ½çŒœåˆ°ï¼šå·¥èµ„è¶…ä½ã€ç”»é¥¼å……é¥¥ã€é¼“åŠ±æ— æ„ä¹‰åŠ ç­ã€æŠ€æœ¯èƒ½åŠ›åˆ°äº†ç“¶é¢ˆï¼Œä»¥åŠæŠ€æœ¯èƒ½åŠ›æå‡ä½¿æˆ‘ä¿¡å¿ƒè†¨èƒ€ã€‚ ","date":"2021-02-06","objectID":"/posts/end-of-the-first-round/:1:0","tags":["æ€»ç»“","å¿ƒå¾—"],"title":"æˆ‘åœ¨åˆ›ä¸šå…¬å¸åšæŠ€æœ¯ä¸€å¹´å¤šçš„ä¸€ç‚¹ä½“ä¼š","uri":"/posts/end-of-the-first-round/"},{"categories":["éšç¬”"],"content":"è‡ªæˆ‘è®¤è¯† æˆ‘åˆšè¿› W å…¬å¸æ—¶ï¼Œæ˜¯ä¸€ä¸ªåˆšæ¯•ä¸šçš„å°ç™½ï¼Œåªæ˜¯å…´è¶£ä½¿ç„¶å–œæ¬¢æŠ€æœ¯ã€‚å› ä¸ºä¸“ä¸šä¸åŒï¼Œå‘¨å›´ä¹Ÿæ¥è§¦ä¸åˆ°å¤šå°‘ææŠ€æœ¯çš„ï¼Œå°±æ¯”è¾ƒã€Œç‹¬ã€ã€‚ åœ¨ W å…¬å¸æˆ‘è·å¾—äº†å’Œä¸€ç¾¤æœ‰ä¸Šè¿›å¿ƒçš„äººä»¬äº’ç›¸åä½œçš„æœºä¼šï¼Œå¤§å®¶åœ¨ä¸€æ­¥ä¸€æ­¥å¾€å‰èµ°çš„æ„Ÿè§‰ï¼Œè®©æˆ‘åœ¨èŒæœŸé—´ä¸€ç›´éå¸¸å¿«ä¹ã€‚ æˆ‘ä»¬çš„æŠ€æœ¯ç»ç†ä¹Ÿç»™äº† DevOps å›¢é˜Ÿè¶³å¤Ÿçš„è‡ªç”±ï¼Œç”šè‡³æ˜¯é¼“åŠ±æˆ‘ä»¬å»æ¢ç´¢ã€å°è¯•æ–°æŠ€æœ¯ã€‚è¿™æ˜¯æˆ‘è¿™ä¸€å¹´å¤š DevOps è¿™ä¸ªæ–¹å‘è¿›æ­¥è¿™ä¹ˆå¿«çš„æœ€å¤§åŸå› ã€‚ ç„¶ååœ¨å’ŒæŠ€æœ¯ç»ç†ã€åŒäº‹ä»¬å¦è¯šæ²Ÿé€šçš„æ—¶å€™ï¼Œæˆ‘ä¹Ÿäº†è§£åˆ°äº†è‡ªå·±çš„èƒ½åŠ›ï¼Œä¸ä»…ä»…åœ¨æŠ€æœ¯ã€‚æˆ‘å¯¹å…¬å¸çš„ä»·å€¼ï¼Œä¹Ÿç»ä¸ä»…ä»…åœ¨æŠ€æœ¯ã€‚ è¿™æ˜¯æˆ‘ä»¥å‰ä»æ¥æ²¡æœ‰æƒ³è¿‡çš„ï¼Œæˆ‘å–œæ¬¢æŠ€æœ¯ï¼Œè€Œä¸”æ‰¾å·¥ä½œå‘ç°èŒä½è¦æ±‚ä¹Ÿéƒ½æ˜¯å†™çš„æŠ€æœ¯ï¼Œæˆ‘çœŸçš„å°±ä¸€ç›´ä»¥ä¸ºæŠ€æœ¯å°±æ˜¯ä¸€åˆ‡ã€‚ è¿™é‡Œæˆ‘å°¤å…¶è¦æ„Ÿè°¢æŠ€æœ¯ç»ç†ï¼Œæ˜¯ä»–å¸®æˆ‘æŠŠè‡ªå·±å¯¹å…¬å¸çš„ä»·å€¼å’Œä¸è¶³åˆ†æå¾—å¦‚æ­¤é€å½»ã€‚ ä¸‹é¢æ˜¯æˆ‘ç»“åˆç»ç†å’ŒåŒäº‹å¯¹æˆ‘çš„è¯„ä»·ï¼Œå¯¹æˆ‘ä¸ªäººèƒ½åŠ›åšä¸ªè¯„ä¼°ï¼ˆä¸‰äººè¡Œå¿…æœ‰æˆ‘å¸ˆï¼Œä»…ä¾›å‚è€ƒï¼‰ï¼š ç†è§£èƒ½åŠ›ã€æ´å¯Ÿèƒ½åŠ›ï¼šåœ¨å…¬å¸ï¼Œæˆ‘è¿™æ–¹é¢çš„èƒ½åŠ›æ˜¯æ‹”å°–çš„ã€‚å’Œäººäº¤æµï¼Œæˆ‘ç»å¸¸èƒ½å¾ˆå¿«åœ°æŠŠæ¡ä½æ ¸å¿ƒã€‚ è¡¨è¾¾èƒ½åŠ›ï¼šæˆ‘çš„è¡¨è¾¾èƒ½åŠ›ä¹Ÿæ˜¯å…¬å¸é‡Œæ‹”å°–çš„ã€‚åŒäº‹è·Ÿæˆ‘è®²ï¼Œå¬æˆ‘æè¿°ä¸€æ¡é±¼ï¼Œä»–èƒ½æ¸…æ™°åœ°çœ‹åˆ°é±¼çš„éª¨å¤´ã€‚ å…¶å®æˆ‘æ—¥å¸¸å†™åšå®¢æ—¶ï¼Œç»å¸¸è§‰å¾—è‡ªå·±è¡¨è¾¾åœ°ä¸å¤Ÿå¥½ï¼Œå¾ˆå¤šäººçš„æ–‡ç« å°±æ¯”æˆ‘å†™å¾—æ›´å¥½ã€‚ä¸åŒçš„è§’åº¦çœ‹åˆ°çš„ä¸œè¥¿çœŸçš„åŒºåˆ«å¾ˆå¤§ï¼Œæ„Ÿè°¢æˆ‘çš„åŒäº‹ä»¬ã€‚ æ¢ç´¢èƒ½åŠ›ï¼šæˆ‘æ—¥å¸¸å–œæ¬¢é€› githubï¼Œç¿» CNCF Landscapeï¼Œæˆ‘çš„å…´è¶£é©±åŠ¨ç€è‡ªå·±å»æ¢ç´¢å„ç§æ–°æŠ€æœ¯ï¼Œæ€è€ƒå®ƒä»¬çš„ä¼˜åŠ£ã€‚ ä½†æ˜¯æˆ‘çš„å¤§éƒ¨åˆ†åŒäº‹ä»¬éƒ½ä¸æ˜¯è¿™æ ·çš„ï¼Œå¾ˆå¤šåŒäº‹åªè¯»ä¸­æ–‡æ–‡æ¡£å’Œåšå®¢ï¼Œè‹±æ–‡ä¹Ÿå¿…é¡»ä¾èµ–ä¸æ€ä¹ˆé è°±çš„ç¿»è¯‘ã€‚ å¦å¤–ä»–ä»¬å·¥æœŸç´§ä¸šåŠ¡å¤šï¼Œä¹Ÿæ²¡æˆ‘ä»¬ DevOps è¿™è¾¹è¿™ä¹ˆå¤šçš„æ—¶é—´å»æ¢ç´¢è¯•ç”¨æ–°æŠ€æœ¯ã€‚ å› æ­¤ï¼Œæˆ‘çš„æ¢ç´¢èƒ½åŠ›è¦å¼ºäºå¤§å¤šæ•°åŒäº‹ã€‚ å…¨å±€æ€è€ƒèƒ½åŠ›: æ”¾çœ¼å…¨å±€ã€æ€è€ƒæœªæ¥ï¼Œåœ¨ä¼—å¤šé€‰æ‹©ä¸­èƒ½å¤Ÿå¹¶ä¸”æ•¢äºåšå‡ºå†³ç­–ã€‚æˆ‘ç›®å‰è¿˜å¾ˆç¼ºä¹è¿™æ ·çš„èƒ½åŠ›ã€‚ è¯´åˆ°åº•æˆ‘ç›®å‰è¿˜æ˜¯ä¸ªæ™®é€šäººçš„æ€è·¯ï¼Œæ²¡æœ‰æŠŠè‡ªå·±æ”¾åœ¨å†³ç­–è€…çš„ä½ç½®ä¸Šå»æ€è€ƒã€‚ å…¶æ¬¡å‘¢ï¼Œæˆ‘çš„çŸ¥è¯†é¢è¿˜å¤ªçª„ï¼Œå¯¼è‡´æˆ‘æ ¹æœ¬çœ‹ä¸æ¸…å¥½åï¼Œå¾ˆå¤šæ—¶å€™å°±æ— æ³•ç‹¬ç«‹åšå‡ºå†³ç­–ã€‚æˆ‘éœ€è¦æ‰©å¤§è‡ªå·±çš„çŸ¥è¯†é¢ã€‚ æŠ€æœ¯èƒ½åŠ›ï¼šæˆ‘çš„æŠ€æœ¯èƒ½åŠ›åœ¨å…¬å¸é‡Œèƒ½è¯„åˆ° 80 åˆ†å§ã€‚æˆ‘æŠ€æœ¯ä¸ç®—å¥½ï¼ŒåŸºç¡€è–„å¼±ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬ä¸€ä¸ªå°åˆ›ä¸šå…¬å¸å†…éƒ¨æ¯”è¾ƒï¼Œèƒ½åˆ° 80 åˆ†ã€‚ ç®¡ç†èƒ½åŠ›ï¼šDevOps å°±ä¸¤ä¸‰äººï¼Œå› ä¸ºæˆ‘å…·æœ‰ä¸Šé¢è¿™äº›èƒ½åŠ›ï¼ŒçŸ®ä¸ªå­é‡Œæ‹”é«˜çš„ï¼Œç†æ‰€å½“ç„¶åœ°æˆ‘æˆäº†é¢†å¤´çš„ã€‚ä½†æ˜¯æ€§æ ¼ä½¿ç„¶ï¼Œæˆ‘ç®¡ç†èƒ½åŠ›æ˜¯å…¬å¸æœ€å·®çš„â€¦ åˆ›ä¸šæ€ç»´ï¼šå…¬å¸æ˜¯åˆ›ä¸šå…¬å¸ï¼ŒæŠ€æœ¯éª¨å¹²ä»¬éƒ½æ˜¯åˆ›ä¸šæ€ç»´ã€‚ä½†æ˜¯è¯´å®è¯æˆ‘ä»æ¥æ²¡æƒ³è¿‡è¦å»åˆ›ä¸šï¼Œä¸æ„¿æ„æŠ•å…¥å¤ªå¤šã€‚è¿™ä¹Ÿæ˜¯æˆ‘ç¦»èŒçš„åŸå› ã€‚ å› æ­¤ï¼ŒæŠ€æœ¯ç»ç†è®¤ä¸ºï¼Œæˆ‘å¯èƒ½æ›´é€‚åˆå½“è®²å¸ˆå“ˆå“ˆã€‚ åœ¨å…¬å¸ä¹Ÿç¡®å®ç»™åŒäº‹ä»¬è®²è¿‡å‡ æ¬¡è¯¾ï¼Œèƒ½å¤Ÿçœ‹åˆ°åŒäº‹ä»¬é«˜å…´åœ°é¼“æŒï¼Œå‘Šè¯‰æˆ‘ã€Œè®²å¾—å¯ä»¥ã€ï¼Œæˆ‘å°±å¾ˆå¼€å¿ƒã€‚è¿™ç§å¿ƒæƒ…å°±å’Œæœ‰äººåœ¨æˆ‘åšå®¢é‡Œè¯„è®ºã€Œæ„Ÿè°¢ï¼Œå¾ˆæœ‰å¸®åŠ©ã€æ˜¯ä¸€æ ·çš„ã€‚ ","date":"2021-02-06","objectID":"/posts/end-of-the-first-round/:2:0","tags":["æ€»ç»“","å¿ƒå¾—"],"title":"æˆ‘åœ¨åˆ›ä¸šå…¬å¸åšæŠ€æœ¯ä¸€å¹´å¤šçš„ä¸€ç‚¹ä½“ä¼š","uri":"/posts/end-of-the-first-round/"},{"categories":["éšç¬”"],"content":"æˆ‘çš„æ”¶è· é¦–å…ˆæŠ€æœ¯å°±ä¸ç”¨è¯´äº†ï¼Œä»æˆ‘è¿™ä¸€å¹´å¤šçš„åšå®¢æ–‡ç« å°±èƒ½çœ‹åˆ°ï¼Œæˆ‘çš„æŠ€æœ¯è¿›æ­¥ç›¸å½“å¤§ã€‚ è¿˜æœ‰å°±æ˜¯æå‡äº†å¯¹è‡ªæˆ‘çš„è®¤è¯†ï¼Œè¿™ä¸€ç‚¹å‰é¢ä¹Ÿå·²ç»é˜è¿°è¿‡äº†ã€‚ é‚£å…¶ä»–æ–¹é¢æˆ‘æ”¶è·äº†å•¥å‘¢ï¼Ÿå¤§æ¦‚æœ‰ä¸‹é¢è¿™äº›ï¼š æˆ‘å‘ç°ï¼ŒæŠ€æœ¯ç»ç†å‡ åå¹´çš„æŠ€æœ¯ç»éªŒå’Œç”Ÿæ´»ç»å†ï¼Œèƒ½è®©ä»–ä¸äº†è§£çš„æŠ€æœ¯é¢†åŸŸä¸­ï¼Œä¹Ÿèƒ½å¿«é€Ÿæ‰¾å‡ºçœŸæ­£æœ‰ä»·å€¼çš„ä¸œè¥¿ã€‚â€”â€”ç»éªŒå’Œé˜…å†ç»™äº†ä»–å¼ºå¤§çš„æ´å¯Ÿèƒ½åŠ›ã€‚ æŠ€æœ¯äº§å“ä¸­æœ€æœ‰ä»·å€¼çš„ä¸œè¥¿ï¼Œä¹Ÿæœ€éš¾çœ‹é€çš„ä¸œè¥¿ï¼Œå¹¶ä¸æ˜¯æŠ€æœ¯æœ¬èº«ï¼Œè€Œæ˜¯ç†å¿µã€æŠ½è±¡ã€‚æ¯”å¦‚ DevOpsã€åŸºç¡€è®¾æ–½å³ä»£ç ã€äº‘è®¡ç®—ã€å¼€æºã€‚ è¿™å¾ˆéš¾ï¼Œä½†æ˜¯èƒ½é¢†å…ˆæ‰€æœ‰äººï¼Œæœ€å…ˆå‘ç°è¿™äº›å®è§‚æ¦‚å¿µçš„ä»·å€¼ï¼Œå¹¶æŠ¼æ³¨çš„äººï¼Œå°±èƒ½è·å¾—å·¨å¤§çš„å…ˆæ‰‹ä¼˜åŠ¿ã€‚ ä½†æ˜¯ã€Œä¸–äººå¤§éƒ½æ„šæ˜§ã€ï¼Œæˆ–è€…è¯´ã€Œå¤ªè¿‡èªæ˜ã€ï¼Œå¯¼è‡´è¿™ç±»åˆ›ä¸šå›¢é˜Ÿå¯èƒ½å’Œç¤¾ä¼šæ ¼æ ¼ä¸å…¥ã€‚ä¸è®ºæˆåŠŸå¤±è´¥ï¼Œè¿™ç±»æ°¸è¿œæ˜¯å°‘æ•°äººã€‚ ç†æ€§çš„æ²Ÿé€šæ˜¯å¥½çš„ï¼Œä½†æ˜¯æœ‰æ—¶å€™æƒ…ç»ªåŒ–çš„æ²Ÿé€šåè€Œæ›´æœ‰æ•ˆæœã€‚ æˆ‘ä»¬æŠ€æœ¯ç»ç†æ˜¯ä¸€ä¸ªè¶…çº§ç†æ€§çš„äººï¼Œä½†æ˜¯æˆ‘å’Œä»–æ²Ÿé€šï¼Œä»–çš„æƒ³æ³•å¹¶ä¸èƒ½å¾ˆå¥½çš„ä¼ è¾¾ç»™æˆ‘ã€‚åè€Œæƒ…ç»ªåŒ–çš„è€æ¿è·Ÿæˆ‘æ²Ÿé€šï¼Œæˆ‘æ›´èƒ½æ„ŸåŒèº«å—ã€‚ æˆ‘è®¤è¯†äº†å½¢å½¢è‰²è‰²çš„äººï¼Œå…¬å¸çš„åŒäº‹ã€é¢†å¯¼ï¼Œå¾ˆå¤šéƒ½æœ‰å€¼å¾—æˆ‘å­¦ä¹ çš„åœ°æ–¹ã€‚æœ‰äº›æ„Ÿæ‚Ÿ å¯ŒäºŒä»£ä¸åœ¨æ„é’±ï¼Œæ²¡æ™®é€šäººè¿™ä¹ˆæ–¤æ–¤è®¡è¾ƒï¼Œåªåœ¨æ„å…¬å¸æ°›å›´ï¼Œä»¥åŠè‡ªå·±èƒ½åšä»€ä¹ˆã€‚åè€Œæ›´æ„¿æ„ä»˜å‡ºæ›´å¤šï¼Œèƒ½å¤Ÿä¹åœ¨å…¶ä¸­ï¼Œä¹Ÿæ›´å®¹æ˜“æˆåŠŸã€‚åˆ›ä¸šå…¬å¸å¤§æ¦‚å¾ˆå–œæ¬¢è¿™ç±»äººã€‚ ä¸–ç•Œä¸Šå¤§éƒ¨åˆ†äººéƒ½æ˜¯æ™®é€šäººã€‚å¤§ä¼—è®¤åŒçš„è§‚ç‚¹ï¼Œä¸ä¸€å®šå°±æ˜¯æ­£ç¡®çš„è§‚ç‚¹ã€‚å¤§ä¼—è§‚ç‚¹çš„å˜åŒ–ä¹Ÿèƒ½ä½“ç°å‡ºç¤¾ä¼šçš„å˜è¿ã€‚ æ¯”å¦‚å½“å¹´å¤§è·ƒè¿›å…¨æ°‘çš„ç‹‚çƒ­ï¼Œå’Œç°åœ¨å…¬å¸å€¡å¯¼ 996ï¼Œç¤¾ä¼šèˆ†è®ºåˆ™ç§¯æåæŠ—ã€‚å…¬å¸å’Œæ°‘ä¼—ç«™åœ¨äº†å¯¹ç«‹é¢ã€‚ é™¤äº†ä¸Šé¢è¿™äº›è™šçš„ï¼Œè¿˜æœ‰æ›´å®åœ¨çš„ï¼š å¿«ä¹ï¼šç»ç†ä¸ºäººç›¸å½“å¥½ï¼ŒåŒäº‹ä¹‹é—´åˆä½œå¤§éƒ½ä¹Ÿå¾ˆæ„‰å¿«ï¼Œäººäº‹å°å§å§è¶…çº§ä¸“ä¸šï¼Œæ— å¾®ä¸è‡³åœ°ç…§é¡¾æˆ‘ä»¬ã€‚åœ¨èŒæœŸé—´æˆ‘æ”¶è·äº†ç›¸å½“å¤šçš„å¿«ä¹ã€‚ è‡ªä¿¡å¿ƒï¼šæˆ‘è¿›å…¬å¸ä¹‹å‰ï¼Œä½œä¸ºä¸€ä¸ªè·¨ä¸“ä¸šçš„å°ç™½ï¼Œéå¸¸æ²¡æœ‰åº•æ°”ï¼Œè€Œä¸”åœ¨å­¦æ ¡çš„æ—¶å€™æ•´ä¸ªäººéå¸¸é¢“åºŸã€‚ä½†æ˜¯åœ¨ W å…¬å¸ï¼Œæˆ‘å­¦åˆ°äº†æŠ€æœ¯ï¼Œå·¥ä½œä¹åœ¨å…¶ä¸­ï¼Œè¿˜æ”¶è·äº†åŒäº‹å’Œé¢†å¯¼çš„è‚¯å®šã€‚æˆ‘å»ºç«‹èµ·äº†è‡ªä¿¡å¿ƒã€‚ Money: è™½ç„¶ä¸å¤šï¼Œä½†æ˜¯æˆ‘å¥½æ­¹ä¹Ÿæ˜¯ä¸ªæœ‰äº›é—²é’±äº†çš„äººhhh ","date":"2021-02-06","objectID":"/posts/end-of-the-first-round/:3:0","tags":["æ€»ç»“","å¿ƒå¾—"],"title":"æˆ‘åœ¨åˆ›ä¸šå…¬å¸åšæŠ€æœ¯ä¸€å¹´å¤šçš„ä¸€ç‚¹ä½“ä¼š","uri":"/posts/end-of-the-first-round/"},{"categories":["éšç¬”"],"content":"æœªæ¥ æ¯•ä¸šåï¼Œç¬¬ä¸€ä»½å·¥ä½œå°±è¿™æ ·ç»“æŸäº†ã€‚æœ‰ç‚¹ä»“ä¿ƒï¼Œå› ä¸ºå¾ˆå‡ºä¹æ„æ–™ï¼Œä½†ç»†æƒ³ä¸‹æ¥ä¹Ÿæ˜¯æƒ…ç†ä¹‹ä¸­ã€‚ ä¸‹é¢å°±æ˜¯è¿‡å¹´äº†ï¼Œè¿‡å¹´å‘¢ï¼Œå°±ç…§ç€æ—¢æœ‰çš„è®¡åˆ’æ¥å§ï¼Œç»§ç»­æå‡ä¸‹æŠ€æœ¯èƒ½åŠ›ã€‚è‡³å°‘å¯¹ç›®å‰çš„æˆ‘è€Œè¨€ï¼ŒæŠ€æœ¯è¿˜æ˜¯æˆ‘çš„èƒ½åŠ›åŸºç¡€å’Œæ‰¾å·¥ä½œçš„æœ€å¤§ä¾ä»—ï¼Œå…¶ä»–èƒ½åŠ›ç›®å‰è¿˜æ˜¯åœ¨å›´ç»•æŠ€æœ¯æˆé•¿ã€‚ å¹´åå‡†å¤‡æ‰¾ä¸‹ä¸€ä»½å·¥ä½œã€‚è¿™ä¸€æ¬¡ï¼Œæˆ‘å¸Œæœ›èƒ½å¤šèµ°ä¸€èµ°ï¼Œçœ‹ä¸€çœ‹ï¼Œä¸ç€æ€¥åšå†³å®šã€‚ æˆ‘è§‰å¾—è‡ªå·±çš„çœ¼ç•Œè¿˜å¤ªç‹­çª„äº†ï¼Œæˆ‘å¯¹ä¸–ç•Œè¿˜å¾ˆç¼ºä¹äº†è§£ã€‚ä»¥è‡³äºå¾ˆå¤šä¸œè¥¿ï¼Œæˆ‘æ ¹æœ¬æ— æ³•ä½œå‡ºè¯„åˆ¤ã€‚ æ—¢ç„¶ç°åœ¨è·³å‡ºäº†ä¸€åº§æˆ‘çš„ã€Œå›´åŸã€ï¼Œè‡ªç„¶è¦å»å¤šçœ‹çœ‹ï¼Œå¤–é¢çš„ä¸–ç•Œæ˜¯ä¸ªå•¥æ ·å­ã€‚ æˆ–è®¸ä¹Ÿæ²¡ä»€ä¹ˆåŒºåˆ«ï¼Ÿé‚£ä¹Ÿå¾—çœ‹è¿‡æ‰èƒ½ä¸‹ç»“è®ºå•Šï¼ˆç¬‘ ","date":"2021-02-06","objectID":"/posts/end-of-the-first-round/:4:0","tags":["æ€»ç»“","å¿ƒå¾—"],"title":"æˆ‘åœ¨åˆ›ä¸šå…¬å¸åšæŠ€æœ¯ä¸€å¹´å¤šçš„ä¸€ç‚¹ä½“ä¼š","uri":"/posts/end-of-the-first-round/"},{"categories":["éšç¬”"],"content":"æ–‡æœ« æ–‡ç« çš„æœ€åï¼Œç¥å¤§å®¶ã€ä¹Ÿç¥æˆ‘è‡ªå·±åœ¨ 2021 å¹´é‡Œâ€”â€” æ‹†ç ´ç‰ç¬¼é£å½©å‡¤ï¼Œé¡¿å¼€é‡‘é”èµ°è›Ÿé¾™ã€‚ ","date":"2021-02-06","objectID":"/posts/end-of-the-first-round/:5:0","tags":["æ€»ç»“","å¿ƒå¾—"],"title":"æˆ‘åœ¨åˆ›ä¸šå…¬å¸åšæŠ€æœ¯ä¸€å¹´å¤šçš„ä¸€ç‚¹ä½“ä¼š","uri":"/posts/end-of-the-first-round/"},{"categories":null,"content":"ä¸€ã€æˆ‘çš„å­¦ä¹ æ¸…å• æ ¹æ®ä¸ªäººå…´è¶£ï¼Œä»¥åŠå·¥ä½œéœ€æ±‚åˆ’åˆ†ä¼˜å…ˆçº§ã€‚ ","date":"2021-02-01","objectID":"/now/:1:0","tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/"},{"categories":null,"content":"æœ€é«˜ä¼˜å…ˆçº§ æŠ€æœ¯ï¼š go web ç¼–ç¨‹: å®Œæˆ xhup-club-api-go è¿™ä¸ªé¡¹ç›® kubebuilder: ä½¿ç”¨ kubebuilder å®Œæˆä¸€ä¸ªå®ç”¨ operator. æœåŠ¡ç½‘æ ¼ å­¦ä¹ ä¸æµ‹è¯•å„ç§è´Ÿè½½å‡è¡¡ç­–ç•¥: éœ€è¦æŒç»­æ›´æ–°è¿™ä»½æ–‡æ¡£ ç ”ç©¶ istio çš„ gRPC æ”¯æŒ è€ƒè™‘å¦‚ä½•é€šè¿‡ istio envoyfilter å®ç° pod çš„ warm_up/slow_start ç ”ç©¶ istio çš„æŒ‡æ ‡ä¸ access_logï¼ˆæ·»åŠ  host/uri ç­‰è‡ªå®šä¹‰æŒ‡æ ‡ï¼‰ï¼Œä»¥æ”¯æŒ HTTP host/path çº§åˆ«çš„ç›‘æ§ä¸è¯·æ±‚åˆ†æèƒ½åŠ›ã€‚ è¯¦ç»†ç ”ç©¶ istio çš„é™æµé™å¹¶å‘èƒ½åŠ› ç”Ÿæ´»ï¼š å¨±ä¹+è¿åŠ¨ï¼š è½®æ»‘ï¼šå€’æ»‘åå‹æ­¥ éŸ³ä¹ï¼šSynthesizer V, ç»ƒä¹ é”®ç›˜ é˜…è¯»ï¼ˆä¸€äºŒæœˆä»½ï¼Œå°±è¯»è¿™ä¸¤æœ¬å§ï¼‰ï¼š ã€Šäººé—´å¤±æ ¼ã€‹ ã€Šç”Ÿå‘½æœ€åçš„è¯»ä¹¦ä¼šã€‹ ã€Šåœ¨ç”Ÿå‘½çš„å°½å¤´æ‹¥æŠ±ä½ -ä¸´ç»ˆå…³æ€€åŒ»ç”Ÿæ‰‹è®°ã€‹ ","date":"2021-02-01","objectID":"/now/:1:1","tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/"},{"categories":null,"content":"é«˜ä¼˜å…ˆçº§ æœåŠ¡ç½‘æ ¼ Cilium Service Mesh - ä½¿ç”¨ eBPF + per-node proxy å®ç° çš„æœåŠ¡ç½‘æ ¼ï¼Œå¾ˆæœ‰å‰æ™¯ã€‚ Zone Aware Load Balancing - å‡å°‘è·¨åŒºæµé‡ å¦‚ä½•è°ƒä¼˜æ•°æ®é¢ï¼Œé™ä½ CPU ä½¿ç”¨ç‡åŠå»¶è¿Ÿ æ—¥å¿—æ–¹æ¡ˆè°ƒç ”ï¼šgrafana loki é…ç½®ç®¡ç†ï¼šç ”ç©¶å¦‚ä½•ä½¿ç”¨ vault å®ç°è·¨é›†ç¾¤çš„åŠ¨æ€é…ç½®æ”¯æŒï¼Œå¦‚ä½•è½åœ°æ­¤é¡¹èƒ½åŠ› é˜…è¯»ï¼ˆä¸‰å››æœˆä»½çš„ä¹¦å•ï¼‰ï¼š ã€Šæˆ¿æ€çªçš„åˆæ‹ä¹å›­ã€‹ ã€Šåœ†åœˆæ­£ä¹‰-ä½œä¸ºè‡ªç”±å‰æçš„ä¿¡å¿µã€‹ ã€Šç½‘ç»œæ˜¯æ€æ ·è¿æ¥çš„ã€‹ k8s ç½‘ç»œæ’ä»¶ - Cilium Kubernetesï¼šé˜…è¯»æºç ï¼Œç†Ÿæ‚‰åº•å±‚ç»†èŠ‚ è®¡ç®—æœºç½‘ç»œï¼š BGP è·¯ç”±åè®® vxlan ","date":"2021-02-01","objectID":"/now/:1:2","tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/"},{"categories":null,"content":"ä¸­ä¼˜å…ˆçº§ rust è¯­è¨€ å®¹å™¨åº•å±‚åŸç† å®¹å™¨é•œåƒçš„æ–‡ä»¶ç³»ç»Ÿï¼šoverlayfs é•œåƒçš„ç»“æ„åˆ†æ é•œåƒçš„æ„å»ºæµç¨‹ å†™å‡ ä¸ªå°é¡¹ç›®ï¼ˆä½¿ç”¨ rust/goï¼‰ å®ç°ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨ https://viewsourcecode.org/snaptoken/kilo/ å®ç°ä¸€ä¸ªç®€å•çš„ Linux å®¹å™¨ https://blog.lizzie.io/linux-containers-in-500-loc.html ç½‘ç»œä»£ç†ï¼ˆä¸åˆ° 2000 è¡Œçš„ TUN åº“ï¼‰ https://github.com/songgao/water å®ç°ç®€å•çš„æ•°æ®åº“ï¼štinysql/tinykv ","date":"2021-02-01","objectID":"/now/:1:3","tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/"},{"categories":null,"content":"ä½ä¼˜å…ˆçº§ Openresty æŠ€æœ¯æ ˆï¼šï¼ˆæš‚æ—¶æ„Ÿè§‰å…´è¶£ä¸å¤§ï¼‰ é˜…è¯» Lua ç¨‹åºè®¾è®¡ é˜…è¯» APISIX æºç  + Openresty æ·±å…¥å­¦ä¹  Nginx åŠ epoll [è¿›é˜¶]æ•°æ®åº“ã€æ•°æ®ç»“æ„ä¸ç®—æ³• MIT 6.824ï¼šã€Šæ•°æ®å¯†é›†å‹åº”ç”¨ç³»ç»Ÿè®¾è®¡ã€‹raft redis åº•å±‚ mysql/postgresql åº•å±‚ è‹±è¯­è¯æ±‡é‡ å­¦ä¹ ç®€å•çš„ Parser åŸç†ï¼šã€Šç¼–ç¨‹è¯­è¨€å®ç°æ¨¡å¼ã€‹ ","date":"2021-02-01","objectID":"/now/:1:4","tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/"},{"categories":null,"content":"å…¶ä»–æ¯”è¾ƒæ„Ÿå…´è¶£çš„ä¸œè¥¿ å¾®ç§¯åˆ†ã€çº¿ä»£ã€æ¦‚ç‡è®ºã€æ•°å­¦ç‰©ç†æ–¹æ³• ä¿¡å·ä¸ç³»ç»Ÿã€æ•°å­—ä¿¡å·å¤„ç†ã€éŸ³è§†é¢‘å¤„ç† æœºå™¨å­¦ä¹ ã€æ·±åº¦å­¦ä¹  ã€Šå£°å­¦åŸºç¡€ã€‹ã€ã€Šç†è®ºå£°å­¦ã€‹ã€ã€Šç©ºé—´å£°å­¦ã€‹ï¼šè™½ç„¶å¤§å­¦å­¦çš„ä¸€å¡Œç³Šæ¶‚ï¼Œç°åœ¨å±…ç„¶åˆæœ‰äº›å…´è¶£æƒ³å­¦æ¥ç©ç©ï¼Œå†™äº›å£°å­¦ä»¿çœŸå·¥å…·è¯•è¯•ã€‚ è¯­éŸ³åˆæˆã€æ­Œå£°åˆæˆ å£°å­¦æ¨¡æ‹Ÿï¼šæ‰æ“å£°æ¨¡æ‹Ÿ ","date":"2021-02-01","objectID":"/now/:1:5","tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/"},{"categories":null,"content":"äºŒã€æˆ‘æƒ³è¯»çš„ä¹¦ Computer Systems: A Programmerâ€™s Perspective, 3/E (CS:APP3e) Designing Data-Intensive Applications The Linux Programming Interface Computer Networking: A Top-Down Approach, 7th Edition Systems Performance: Enterprise and the Cloud, 2nd Edition (2020) ","date":"2021-02-01","objectID":"/now/:2:0","tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/"},{"categories":null,"content":"ä¸‰ã€æ­¤æ—¶æ­¤åˆ»çš„æˆ‘ ä¸»è¦è®°å½•ä¸‹ä¸šä½™æ—¶é—´æˆ‘éƒ½åœ¨å¹²äº›å•¥ã€‚ ","date":"2021-02-01","objectID":"/now/:3:0","tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/"},{"categories":null,"content":"now ç›®å‰æƒ³åšçš„ï¼š go web ç¼–ç¨‹: å®Œæˆ xhup-club-api-go è¿™ä¸ªé¡¹ç›® kubebuilder: ä½¿ç”¨ kubebuilder å®Œæˆä¸€ä¸ªå®ç”¨ operator. ","date":"2021-02-01","objectID":"/now/:3:1","tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/"},{"categories":null,"content":"2022-02-07 è¿­ä»£ä¸ªäººåšå®¢ https://thiscute.worldï¼Œæ·»åŠ ã€Œé˜…è¯»æ’è¡Œã€é¡µï¼Œå®šæœŸä» Google Analytics åŒæ­¥æ•°æ®ã€‚ ","date":"2021-02-01","objectID":"/now/:3:2","tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/"},{"categories":null,"content":"2022-01-01 äº†è§£ APISIX/Nginx/Envoy ä¸­çš„å„ç§è´Ÿè½½å‡è¡¡ç®—æ³•ï¼ŒåŠå…¶é€‚ç”¨åœºæ™¯ã€å±€é™æ€§ã€‚ ","date":"2021-02-01","objectID":"/now/:3:3","tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/"},{"categories":null,"content":"2021-12-12 ç»ƒä¹ äºŒä¸ªåŠå°æ—¶ï¼Œå­¦ä¼šäº†å‹æ­¥è½¬å¼¯æŠ€æœ¯ æ— èŠï¼Œä½†æ˜¯åˆå•¥éƒ½ä¸æƒ³å¹²ï¼Œè€½äºç½‘ç»œå°è¯´â€¦ æ„Ÿè§‰æœ‰ç‚¹ç°å……äº†ï¼Œæ„Ÿè§‰éœ€è¦æ‰¾ä¸ªæ›´æ˜ç¡®çš„ã€èƒ½ç»™äººåŠ¨åŠ›çš„ç›®æ ‡ åšä¸ªä¸‰å¹´çš„èŒä¸šè§„åˆ’ä»¥åŠç”Ÿæ´»è§„åˆ’ï¼Ÿ ","date":"2021-02-01","objectID":"/now/:3:4","tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/"},{"categories":null,"content":"2021-11-21 è½®æ»‘ï¼šå¤ä¹ å‰åŒé±¼ã€å‰å‰ªã€å‰è›‡ï¼Œå°è¯•ä¾§å‹æ­¥ã€å€’æ»‘ ","date":"2021-02-01","objectID":"/now/:3:5","tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/"},{"categories":null,"content":"2021-11-08 - 2021-11-12 å°†ä¸Šæ¬¡ EKS å‡çº§è¿‡ç¨‹ä¸­ï¼Œæœ‰é—®é¢˜çš„æœåŠ¡è¿ç§»åˆ° 1.21 çš„ EKS é›†ç¾¤ï¼Œç›´æ¥åˆ‡çº¿ä¸Šæµé‡æµ‹è¯•ã€‚ å¤ç°äº†é—®é¢˜ï¼Œé€šè¿‡ JFR + pods æ•°é‡ç›‘æ§ï¼Œç¡®è®¤åˆ°æ˜¯æœåŠ¡é“¾è·¯ä¸Šçš„ä¸ªåˆ«æœåŠ¡é¢‘ç¹æ‰©ç¼©å®¹å¯¼è‡´çš„ï¼Œè¿™äº›æœåŠ¡æ¯”è¾ƒé‡ï¼Œå¯¹æ‰©ç¼©å®¹æ¯”è¾ƒæ•æ„Ÿã€‚ æµ‹è¯•åœ¨ HPA ä¸­æ·»åŠ  behavior é™ä½ç¼©å®¹é€Ÿç‡ï¼ŒåŒæ—¶æ·»åŠ ä¸Š PodDisruptionBudget ä»¥é¿å…èŠ‚ç‚¹å›æ”¶å¯¼è‡´å¤§é‡ Pod è¢«å›æ”¶ï¼Œç»æµ‹è¯•é—®é¢˜åŸºæœ¬è§£å†³ã€‚ é­é‡ AWS EKS æ‰˜ç®¡çš„æ§åˆ¶å¹³é¢æ•…éšœï¼Œcontroller-manager æŒ‚äº†ä¸€æ•´å¤©ã€‚ç°è±¡éå¸¸å¥‡æ€ªï¼Œåˆæ˜¯ç¬¬ä¸€æ¬¡é‡åˆ°ï¼Œå¯¼è‡´é•¿æ—¶é—´æœªæ’æŸ¥åˆ°é—®é¢˜ã€‚ ç¡®è®¤é—®é¢˜æ¥è‡ª HPA behavior çš„ Bug å‚¨å­˜äº etcd ä¸­çš„ object ä»…ä¼šæœ‰ä¸€ä¸ªç‰ˆæœ¬ï¼Œé€è¿‡ apiserver è¯»å–æ—¶ä¼šè½¬æ¢æˆè¯·æ±‚çš„ autoscaling API ç‰ˆæœ¬ã€‚ autoscaling/v2beta2 scaleUp åŠ scaleDown å¯¹è±¡ä¸èƒ½ä¸º nullï¼Œå¹¶åœ¨å…¶ Kubernetse ä»£ç å¯ä»¥æŸ¥çœ‹åˆ°ç›¸åº”çš„æ£€æŸ¥æœºåˆ¶ã€‚ å½“ä½¿ç”¨ autoscaling/v1 æ—¶ï¼Œv2beta2 ç‰ˆæœ¬ä¸­çš„ç›¸å…³å¯¹è±¡å­—æ®µå°†ä½œä¸º annotation ä¿ç•™ï¼Œapiserver ä¸ä¼šæ£€æŸ¥ ScaleUp/ScaleDown çš„ annotationæ˜¯å¦ä¸º non-nullï¼Œè€Œå¯¼è‡´ kube-controller-manager panic é—®é¢˜ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ v1 æˆ– v2beta2 åˆ›å»ºä¸€ä¸ª HPA å¯¹è±¡ï¼Œç„¶åä½¿ç”¨ v1 æˆ– v2beta2 è¯»å–ã€æ›´æ–°æˆ–åˆ é™¤è¯¥å¯¹è±¡ã€‚ etcd ä¸­å­˜å‚¨çš„å¯¹è±¡åªæœ‰ä¸€ä¸ªç‰ˆæœ¬ï¼Œæ¯å½“æ‚¨ä½¿ç”¨ v1 æˆ– v2beta2 è·å– HPA å¯¹è±¡æ—¶ï¼Œapiserver ä» etcd è¯»å–å®ƒï¼Œç„¶åå°†å…¶è½¬æ¢ä¸ºæ‚¨è¯·æ±‚çš„ç‰ˆæœ¬ã€‚ åœ¨ä½¿ç”¨ kubectl æ—¶ï¼Œå®¢æˆ·ç«¯å°†é»˜è®¤ä½¿ç”¨ v1(kubectl get hpa)ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»æ˜ç¡®è¯·æ±‚ v2beta2 æ‰èƒ½ä½¿ç”¨è¿™äº›åŠŸèƒ½(kubectl get hpa.v2beta2.autoscaling) å¦‚æœåœ¨æ›´æ–° v1 ç‰ˆæœ¬çš„ HPA æ—¶ï¼ˆkubectl é»˜è®¤ç”¨ v1ï¼‰ï¼Œæ‰‹åŠ¨ä¿®æ”¹äº† v2beta2 åŠŸèƒ½ç›¸å…³çš„ annotation å°† scaleUp/scaleDown è®¾ä¸º nullï¼Œä¼šå¯¼è‡´ controller-manager æŒ‚æ‰. ","date":"2021-02-01","objectID":"/now/:3:6","tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/"},{"categories":null,"content":"2021-10-23 è·Ÿå…¬å¸å†²æµªå°åˆ†é˜Ÿï¼Œç¬¬ä¸€æ¬¡ç©å†²æµªï¼Œæœ€ä½³æˆç»©æ˜¯åœ¨æ¿ä¸Šç«™äº†å¤§æ¦‚ 6sâ€¦ ","date":"2021-02-01","objectID":"/now/:3:7","tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/"},{"categories":null,"content":"2021-10/11 - 2021-10-19 å°† EKS é›†ç¾¤ä» 1.17 å‡çº§åˆ° 1.21ï¼ˆæ–°å»ºé›†ç¾¤åˆ‡é‡çš„æ–¹å¼ï¼‰ï¼Œä½†æ˜¯é‡åˆ°éƒ¨åˆ†æœåŠ¡è¿ç§»åå¯ç”¨ç‡æŠ–åŠ¨ã€‚ æœªå®šä½åˆ°åŸå› ï¼Œå‡çº§å¤±è´¥ï¼Œå›æ»šäº†æµé‡ã€‚ ","date":"2021-02-01","objectID":"/now/:3:8","tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/"},{"categories":null,"content":"2021-09-13 - 2021-09-17 å­¦ä¹ æå®¢æ—¶é—´ã€Š10Xç¨‹åºå‘˜å·¥ä½œæ³•ã€‹ ä»¥ç»ˆæ¨å§‹ è¯†åˆ«å…³é”®é—®é¢˜ ownership ","date":"2021-02-01","objectID":"/now/:3:9","tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/"},{"categories":null,"content":"2021-09-02 - 2021-09-11 EKS é›†ç¾¤å‡çº§ äº†è§£ EKS é›†ç¾¤çš„åŸåœ°å‡çº§çš„ç»†èŠ‚ è¾“å‡º EKS é›†ç¾¤åŸåœ°å‡çº§çš„æµ‹è¯•æ–¹æ¡ˆï¼Œä»¥åŠç”Ÿäº§ç¯å¢ƒçš„ EKS é›†ç¾¤å‡çº§æ–¹æ¡ˆ å­¦ä¹ ä½¿ç”¨ kubeadm+containerd éƒ¨ç½² k8s æµ‹è¯•é›†ç¾¤ æ¶‰åŠåˆ°çš„ç»„ä»¶ï¼šKuberntes æ§åˆ¶é¢ã€ç½‘ç»œæ’ä»¶ Ciliumã€kube-proxyã€corednsã€containerd ","date":"2021-02-01","objectID":"/now/:3:10","tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/"},{"categories":null,"content":"2021-08-31 - 2021-09-01 æ€è€ƒæˆ‘åœ¨å·¥ä½œä¸­é‡åˆ°çš„ä¸€äº›éæŠ€æœ¯é—®é¢˜ï¼Œå¯»æ‰¾è§£æ³• æ•ˆç‡ï¼šå¦‚ä½•åœ¨æ²¡äºº push çš„æƒ…å†µä¸‹ï¼ˆæ²¡æœ‰å¤–éƒ¨å‹åŠ›ï¼‰ï¼Œç»´æŒä½é«˜æ•ˆç‡çš„å·¥ä½œçŠ¶æ€ï¼ˆæ—©æ—©å¹²å®Œæ´»ä¸‹ç­å®ƒä¸é¦™ä¹ˆï¼Ÿï¼‰ã€‚ å»ºç«‹æœ‰æ•ˆçš„ã€Œè‡ªæ£€ã€ä¸ã€Œçº é”™ã€æœºåˆ¶ è‡ªæ£€ï¼š åˆ—å‡ºç›®å‰å·²çŸ¥çš„ã€Œå¼‚å¸¸ã€å’Œã€Œå¥åº·ã€ä¸¤ç±»å·¥ä½œçŠ¶æ€ï¼Œæ¯æ—¥åšä¸€ä¸ªå¯¹æ¯”ã€‚ æ¯æ—¥éƒ½åˆ—ä¸€ä¸‹è¯¦ç»†çš„å·¥ä½œè®¡åˆ’ï¼Œç²¾ç¡®åˆ°å°æ—¶ï¼ˆé¢„ç•™ 1 å°æ—¶ buffer åº”å¯¹ä¸´æ—¶éœ€æ±‚ï¼‰ã€‚ æ²Ÿé€šï¼šé‡åˆ°é—®é¢˜ï¼ˆå„ç§æ„ä¹‰ä¸Šçš„é—®é¢˜ï¼‰æ—¶ï¼ŒåŠæ—¶æ²Ÿé€šæ¸…æ¥šå†ç»§ç»­æ¨è¿›ï¼Œæ˜¯ä¸€ä»¶ ROI éå¸¸é«˜çš„äº‹ã€‚å¦åˆ™å‡ ä¹è‚¯å®šä¼šåœ¨åé¢çš„æŸä¸ªèŠ‚ç‚¹ï¼Œè¢«è¿™ä¸ªé—®é¢˜å‘ä¸€æŠŠã€‚ ç›®å‰çš„å…³é”®ç›®æ ‡æ˜¯å•¥ï¼Ÿå­˜åœ¨å“ªäº›å…³é”®é—®é¢˜ï¼ˆå®ç°å…³é”®ç›®æ ‡æœ€å¤§çš„é˜»ç¢ï¼‰ï¼Ÿæˆ‘æœ€è¿‘åšçš„ä¸»è¦å·¥ä½œï¼Œæ˜¯ä¸æ˜¯åœ¨ä¸ºå…³é”®ç›®æ ‡æœåŠ¡ï¼Ÿ å¦‚ä½•æŠŠå®‰æ’åˆ°æ‰‹ä¸Šçš„äº‹æƒ…åšå¥½ï¼Ÿ æ€è€ƒè¿™ä»¶äº‹æƒ…çœŸæ­£çš„ç›®æ ‡çš„ä»€ä¹ˆï¼Ÿ æ¯”å¦‚ä»»åŠ¡æ˜¯æ’æŸ¥ä¸‹æŸæœåŠ¡çŠ¶æ€ç æœ‰æ— é—®é¢˜ï¼ŒçœŸæ­£çš„ç›®çš„åº”è¯¥æ˜¯æƒ³çŸ¥é“æœåŠ¡æœ‰æ²¡æœ‰å¼‚å¸¸ è¾¾æˆçœŸæ­£çš„ç›®æ ‡ï¼Œéœ€è¦åšå“ªäº›äº‹ï¼Ÿ ä¸ä»…ä»…çŠ¶æ€ç éœ€è¦æ’æŸ¥ï¼Œè¿˜æœ‰æœåŠ¡è´Ÿè½½ã€å†…å­˜ã€å»¶è¿Ÿçš„åˆ†ä½å€¼ï¼Œæˆ–è®¸éƒ½å¯ä»¥çœ‹çœ‹ã€‚ è·Ÿéœ€æ±‚æ–¹æ²Ÿé€šï¼Œè¯¢é—®æ˜¯å¦çœŸæ­£éœ€è¦åšçš„ï¼Œæ˜¯å‰é¢åˆ†æå¾—å‡ºçš„äº‹æƒ…ã€‚ è¿™äº›é—®é¢˜éƒ½æ˜¯æœ‰è§£æ³•çš„ï¼Œå…³é”®æ˜¯æ€è·¯çš„è½¬æ¢ã€‚ ","date":"2021-02-01","objectID":"/now/:3:11","tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/"},{"categories":null,"content":"2021-08-28 =\u003e 2021-08-29 å®¹å™¨åº•å±‚åŸç†ï¼š linux namespace ä¸ cgroups linux è™šæ‹Ÿç½‘ç»œæ¥å£ macvlan/ipvlanã€vlanã€vxlan ","date":"2021-02-01","objectID":"/now/:3:12","tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/"},{"categories":null,"content":"2021-08-19 =\u003e 2021-08-23 é˜…è¯» rust è¯­è¨€çš„å®˜æ–¹æ–‡æ¡£ï¼šthe book è¾¹è¯»æ–‡æ¡£è¾¹åš rustlings çš„å°ä¹ é¢˜ ç›®å‰å®Œæˆäº†é™¤ macros ä¹‹å¤–çš„æ‰€æœ‰é¢˜ é‡åˆ°çš„æœ€éš¾çš„é¢˜ï¼šconversions/{try_from_into, from_str} ä½¿ç”¨ rust é‡å†™äº†ä¸€ç‰ˆ video2chars ","date":"2021-02-01","objectID":"/now/:3:13","tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/"},{"categories":null,"content":"2021-08-12 =\u003e 2021-08-16 Linux çš„è™šæ‹Ÿç½‘ç»œæ¥å£ Linux çš„ netfilter ç½‘ç»œå¤„ç†æ¡†æ¶ï¼Œä»¥åŠå…¶å­é¡¹ç›® iptables/conntrack ","date":"2021-02-01","objectID":"/now/:3:14","tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/"},{"categories":null,"content":"2021-03-11 =\u003e 2021-08-09 å­¦ä¹  nginx - openresty - apisix å·¥ä½œä¸­ï¼Œåœ¨è‡ªå·±è´Ÿè´£çš„é¢†åŸŸï¼Œå»ºç«‹èµ· ownership å­¦ä¹ æ–°å…¬å¸çš„å·¥ä½œæ¨¡å¼ï¼šOKR å·¥ä½œæ³• å­¦ä¹ æ–°å…¬å¸çš„æ€ç»´æ¨¡å¼ï¼ˆè¯†åˆ«å…³é”®é—®é¢˜ï¼‰ å¦‚ä½•ä»å…¬å¸çš„è§’åº¦å»æ€è€ƒé—®é¢˜ï¼Œæ‰¾åˆ°æˆ‘ä»¬ç›®å‰æœ€åº”è¯¥åšçš„äº‹æƒ… ä»ä»¥ä¸‹è§’åº¦å»è¯„ä»·ä¸€ä»¶äº‹æƒ…çš„é‡è¦æ€§ è¿™ä»¶äº‹æƒ…å¯¹æˆ‘ä»¬ç›®å‰çš„ç›®æ ‡æœ‰å¤šå¤§å¸®åŠ©ï¼Ÿ éœ€è¦æŠ•å…¥å¤šå°‘èµ„æºå’ŒäººåŠ›ï¼Ÿ åœ¨æ¨è¿›è¿‡ç¨‹ä¸­ï¼Œæœ‰å“ªäº›é˜¶æ®µæ€§æˆæœæˆ–è€… check pointï¼Ÿ ","date":"2021-02-01","objectID":"/now/:3:15","tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/"},{"categories":["æŠ€æœ¯"],"content":" æ³¨æ„ï¼šè¿™ç¯‡æ–‡ç« å¹¶ä¸æ˜¯ä¸€ç¯‡å…¥é—¨æ•™ç¨‹ï¼Œå­¦ä¹  Argo Workflows è¯·ç§»æ­¥å®˜æ–¹æ–‡æ¡£ Argo Documentation Argo Workflows æ˜¯ä¸€ä¸ªäº‘åŸç”Ÿå·¥ä½œæµå¼•æ“ï¼Œä¸“æ³¨äºç¼–æ’å¹¶è¡Œä»»åŠ¡ã€‚å®ƒçš„ç‰¹ç‚¹å¦‚ä¸‹ï¼š ä½¿ç”¨ Kubernetes è‡ªå®šä¹‰èµ„æº(CR)å®šä¹‰å·¥ä½œæµï¼Œå…¶ä¸­å·¥ä½œæµä¸­çš„æ¯ä¸ªæ­¥éª¤éƒ½æ˜¯ä¸€ä¸ªå®¹å™¨ã€‚ å°†å¤šæ­¥éª¤å·¥ä½œæµå»ºæ¨¡ä¸ºä¸€ç³»åˆ—ä»»åŠ¡ï¼Œæˆ–è€…ä½¿ç”¨æœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰æè¿°ä»»åŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚ å¯ä»¥åœ¨çŸ­æ—¶é—´å†…è½»æ¾è¿è¡Œç”¨äºæœºå™¨å­¦ä¹ æˆ–æ•°æ®å¤„ç†çš„è®¡ç®—å¯†é›†å‹ä½œä¸šã€‚ Argo Workflows å¯ä»¥çœ‹ä½œ Tekton çš„åŠ å¼ºç‰ˆï¼Œå› æ­¤æ˜¾ç„¶ä¹Ÿå¯ä»¥é€šè¿‡ Argo Workflows è¿è¡Œ CI/CD æµæ°´çº¿(Pipielines)ã€‚ é˜¿é‡Œäº‘æ˜¯ Argo Workflows çš„æ·±åº¦ä½¿ç”¨è€…å’Œè´¡çŒ®è€…ï¼Œå¦å¤– Kubeflow åº•å±‚çš„å·¥ä½œæµå¼•æ“ä¹Ÿæ˜¯ Argo Workflows. ","date":"2021-01-27","objectID":"/posts/expirence-of-argo-workflow/:0:0","tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/expirence-of-argo-workflow/"},{"categories":["æŠ€æœ¯"],"content":"ä¸€ã€Argo Workflows å¯¹æ¯” Jenkins æˆ‘ä»¬åœ¨åˆ‡æ¢åˆ° Argo Workflows ä¹‹å‰ï¼Œä½¿ç”¨çš„ CI/CD å·¥å…·æ˜¯ Jenkinsï¼Œä¸‹é¢å¯¹ Argo Workflows å’Œ Jenkins åšä¸€ä¸ªæ¯”è¾ƒè¯¦ç»†çš„å¯¹æ¯”ï¼Œ ä»¥äº†è§£ Argo Workflows çš„ä¼˜ç¼ºç‚¹ã€‚ ","date":"2021-01-27","objectID":"/posts/expirence-of-argo-workflow/:1:0","tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/expirence-of-argo-workflow/"},{"categories":["æŠ€æœ¯"],"content":"1. Workflow çš„å®šä¹‰ Workflow ä½¿ç”¨ kubernetes CR è¿›è¡Œå®šä¹‰ï¼Œå› æ­¤æ˜¾ç„¶æ˜¯ä¸€ä»½ yaml é…ç½®ã€‚ ä¸€ä¸ª Workflowï¼Œå°±æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨ Kubernetes ä¸Šçš„æµæ°´çº¿ï¼Œå¯¹åº” Jenkins çš„ä¸€æ¬¡ Build. è€Œ WorkflowTemplate åˆ™æ˜¯ä¸€ä¸ªå¯é‡ç”¨çš„ Workflow æ¨¡æ¿ï¼Œå¯¹åº” Jenkins çš„ä¸€ä¸ª Job. WorkflowTemplate çš„ yaml å®šä¹‰å’Œ Workflow å®Œå…¨ä¸€è‡´ï¼Œåªæœ‰ Kind ä¸åŒï¼ WorkflowTemplate å¯ä»¥è¢«å…¶ä»– Workflow å¼•ç”¨å¹¶è§¦å‘ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨ä¼ å‚ä»¥ç”Ÿæˆä¸€ä¸ª Workflow å·¥ä½œæµã€‚ ","date":"2021-01-27","objectID":"/posts/expirence-of-argo-workflow/:1:1","tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/expirence-of-argo-workflow/"},{"categories":["æŠ€æœ¯"],"content":"2. Workflow çš„ç¼–æ’ Argo Workflows ç›¸æ¯”å…¶ä»–æµæ°´çº¿é¡¹ç›®(Jenkins/Tekton/Drone/Gitlab-CI)è€Œè¨€ï¼Œæœ€å¤§çš„ç‰¹ç‚¹ï¼Œå°±æ˜¯å®ƒå¼ºå¤§çš„æµæ°´çº¿ç¼–æ’èƒ½åŠ›ã€‚ å…¶ä»–æµæ°´çº¿é¡¹ç›®ï¼Œå¯¹æµæ°´çº¿ä¹‹é—´çš„å…³è”æ€§è€ƒè™‘å¾—å¾ˆå°‘ï¼ŒåŸºæœ¬éƒ½å‡è®¾æµæ°´çº¿éƒ½æ˜¯äº’ç›¸ç‹¬ç«‹çš„ã€‚ è€Œ Argo Workflows åˆ™å‡è®¾ã€Œä»»åŠ¡ã€ä¹‹é—´æ˜¯æœ‰ä¾èµ–å…³ç³»çš„ï¼Œé’ˆå¯¹è¿™ä¸ªä¾èµ–å…³ç³»ï¼Œå®ƒæä¾›äº†ä¸¤ç§åè°ƒç¼–æ’ã€Œä»»åŠ¡ã€çš„æ–¹æ³•ï¼šSteps å’Œ DAG å†å€ŸåŠ© templateRef æˆ–è€… Workflow of Workflowsï¼Œå°±èƒ½å®ç° Workflows çš„ç¼–æ’äº†ã€‚ æˆ‘ä»¬ä¹‹æ‰€ä»¥é€‰æ‹© Argo Workflows è€Œä¸æ˜¯ Tektonï¼Œä¸»è¦å°±æ˜¯å› ä¸º Argo çš„æµæ°´çº¿ç¼–æ’èƒ½åŠ›æ¯” Tekton å¼ºå¤§å¾—å¤šã€‚ï¼ˆä¹Ÿè®¸æ˜¯å› ä¸ºæˆ‘ä»¬çš„åç«¯ä¸­å°ç»“æ„æ¯”è¾ƒç‰¹æ®Šï¼Œå¯¼è‡´æˆ‘ä»¬çš„ CI æµæ°´çº¿éœ€è¦å…·å¤‡å¤æ‚çš„ç¼–æ’èƒ½åŠ›ï¼‰ ä¸€ä¸ªå¤æ‚å·¥ä½œæµçš„ç¤ºä¾‹å¦‚ä¸‹ï¼š https://github.com/argoproj/argo/issues/1088#issuecomment-445884543\" https://github.com/argoproj/argo/issues/1088#issuecomment-445884543 ","date":"2021-01-27","objectID":"/posts/expirence-of-argo-workflow/:1:2","tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/expirence-of-argo-workflow/"},{"categories":["æŠ€æœ¯"],"content":"3. Workflow çš„å£°æ˜å¼é…ç½® Argo ä½¿ç”¨ Kubernetes è‡ªå®šä¹‰èµ„æº(CR)æ¥å®šä¹‰ Workflowï¼Œç†Ÿæ‚‰ Kubernetes Yaml çš„åŒå­¦ä¸Šæ‰‹åº”è¯¥éƒ½å¾ˆå¿«ã€‚ ä¸‹é¢å¯¹ Workflow å®šä¹‰æ–‡ä»¶å’Œ Jenkinsfile åšä¸ªå¯¹æ¯”ï¼š argo å®Œå…¨ä½¿ç”¨ yaml æ¥å®šä¹‰æµæ°´çº¿ï¼Œå­¦ä¹ æˆæœ¬æ¯” Jenkinsfile çš„ groovy ä½ã€‚å¯¹ç†Ÿæ‚‰ Kubernetes çš„åŒå­¦å°¤å…¶å¦‚æ­¤ã€‚ å°† jenkinsfile ç”¨ argo é‡å†™åï¼Œä»£ç é‡å‡ºç°äº†æ˜æ˜¾çš„è†¨èƒ€ã€‚ä¸€ä¸ª 20 è¡Œçš„ Jenkinsfileï¼Œç”¨ Argo é‡å†™å¯èƒ½å°±å˜æˆäº† 60 è¡Œã€‚ é…ç½®å‡ºç°äº†è†¨èƒ€æ˜¯ä¸ªé—®é¢˜ï¼Œä½†æ˜¯è€ƒè™‘åˆ°å®ƒçš„å¯è¯»æ€§è¿˜ç®—ä¸é”™ï¼Œ è€Œä¸” Argo çš„ Workflow ç¼–æ’åŠŸèƒ½ï¼Œèƒ½æ›¿ä»£æ‰æˆ‘ä»¬ç›®å‰ç»´æŠ¤çš„éƒ¨åˆ† Python æ„å»ºä»£ç ï¼Œä»¥åŠä¸€äº›å…¶ä»–ä¼˜ç‚¹ï¼Œé…ç½®è†¨èƒ€è¿™ä¸ªé—®é¢˜ä¹Ÿå°±å¯ä»¥æ¥å—äº†ã€‚ ","date":"2021-01-27","objectID":"/posts/expirence-of-argo-workflow/:1:3","tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/expirence-of-argo-workflow/"},{"categories":["æŠ€æœ¯"],"content":"4. Web UI Argo Workflows çš„ Web UI æ„Ÿè§‰è¿˜å¾ˆåŸå§‹ã€‚ç¡®å®è¯¥æ”¯æŒçš„åŠŸèƒ½éƒ½æœ‰ï¼Œä½†æ˜¯å®ƒè²Œä¼¼ä¸æ˜¯é¢å‘ã€Œç”¨æˆ·ã€çš„ï¼ŒåŠŸèƒ½æ¯”è¾ƒåº•å±‚ã€‚ å®ƒä¸åƒ Jenkins ä¸€æ ·ï¼Œæœ‰å¾ˆå‹å¥½çš„ä½¿ç”¨ç•Œé¢(è™½ç„¶è¯´ Jenkins çš„ UI ä¹Ÿå¾ˆæ˜¾è€â€¦) å¦å¤–å®ƒæ‰€æœ‰çš„ Workflow éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œæ²¡åŠæ³•ç›´è§‚åœ°æ‰¾åˆ°ä¸€ä¸ª WorkflowTemplate çš„æ‰€æœ‰æ„å»ºè®°å½•ï¼Œåªèƒ½é€šè¿‡ label/namespace è¿›è¡Œåˆ†ç±»ï¼Œé€šè¿‡ä»»åŠ¡åç§°è¿›è¡Œæœç´¢ã€‚ è€Œ Jenkins å¯ä»¥å¾ˆæ–¹ä¾¿åœ°çœ‹åˆ°åŒä¸€ä¸ª Job çš„æ‰€æœ‰æ„å»ºå†å²ã€‚ ","date":"2021-01-27","objectID":"/posts/expirence-of-argo-workflow/:1:4","tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/expirence-of-argo-workflow/"},{"categories":["æŠ€æœ¯"],"content":"5. Workflow çš„åˆ†ç±» ä¸ºä½•éœ€è¦å¯¹ Workflow åšç»†è‡´çš„åˆ†ç±» å¸¸è§çš„å¾®æœåŠ¡é¡¹ç›®ï¼Œå¾€å¾€ä¼šæ‹†åˆ†æˆä¼—å¤š Git ä»“åº“ï¼ˆå¾®æœåŠ¡ï¼‰è¿›è¡Œå¼€å‘ï¼Œä¼—å¤šçš„ Git ä»“åº“ä¼šä½¿æˆ‘ä»¬åˆ›å»ºä¼—å¤šçš„ CI/CD æµæ°´çº¿ã€‚ å¦‚æœæ²¡æœ‰ä»»ä½•çš„åˆ†ç±»ï¼Œè¿™ä¸€å¤§å †çš„æµæ°´çº¿å¦‚ä½•ç®¡ç†ï¼Œå°±æˆäº†ä¸€ä¸ªéš¾é¢˜ã€‚ æœ€æ˜¾è§çš„éœ€æ±‚ï¼šå‰ç«¯å’Œåç«¯çš„æµæ°´çº¿æœ€å¥½èƒ½åŒºåˆ†ä¸€ä¸‹ï¼Œå¾€ä¸‹ç»†åˆ†ï¼Œå‰ç«¯çš„ Web ç«¯å’Œå®¢æˆ·ç«¯æœ€å¥½ä¹Ÿèƒ½åŒºåˆ†ï¼Œåç«¯çš„ä¸šåŠ¡å±‚å’Œä¸­å°æœ€å¥½ä¹ŸåŒºåˆ†å¼€æ¥ã€‚ å¦å¤–æˆ‘ä»¬è¿˜å¸Œæœ›å°†è¿ç»´ã€è‡ªåŠ¨åŒ–æµ‹è¯•ç›¸å…³çš„ä»»åŠ¡ä¹Ÿé›†æˆåˆ°è¿™ä¸ªç³»ç»Ÿä¸­æ¥ï¼ˆç›®å‰æˆ‘ä»¬å°±æ˜¯ä½¿ç”¨ Jenkins å®Œæˆè¿ç»´ã€è‡ªåŠ¨åŒ–æµ‹è¯•ä»»åŠ¡çš„ï¼‰ï¼Œ å¦‚æœæ²¡æœ‰ä»»ä½•åˆ†ç±»ï¼Œè¿™ä¸€å¤§å †æµæ°´çº¿å°†æ··ä¹±æ— æ¯”ã€‚ Argo Workflows çš„åˆ†ç±»èƒ½åŠ› å½“ Workflow è¶Šæ¥è¶Šå¤šçš„æ—¶å€™ï¼Œå¦‚æœä¸åšåˆ†ç±»ï¼Œä¸€å † WorkflowTemplate å †åœ¨ä¸€èµ·å°±ä¼šæ˜¾å¾—ç‰¹åˆ«æ··ä¹±ã€‚ï¼ˆæ²¡é”™ï¼Œæˆ‘è§‰å¾— Drone å°±æœ‰è¿™ä¸ªé—®é¢˜â€¦ï¼‰ Argo æ˜¯å®Œå…¨åŸºäº Kubernetes çš„ï¼Œå› æ­¤ç›®å‰å®ƒä¹Ÿåªèƒ½é€šè¿‡ namespace/labels è¿›è¡Œåˆ†ç±»ã€‚ è¿™æ ·çš„åˆ†ç±»ç»“æ„å’Œ Jenkins çš„è§†å›¾-æ–‡ä»¶å¤¹ä½“ç³»å¤§ç›¸å¾„åº­ï¼Œç›®å‰æ„Ÿè§‰ä¸æ˜¯å¾ˆå¥½ç”¨ï¼ˆä¹Ÿå¯èƒ½çº¯ç²¹æ˜¯ Web UI çš„é”…ï¼‰ã€‚ ","date":"2021-01-27","objectID":"/posts/expirence-of-argo-workflow/:1:5","tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/expirence-of-argo-workflow/"},{"categories":["æŠ€æœ¯"],"content":"6. è§¦å‘æ„å»ºçš„æ–¹å¼ Argo Workflows çš„æµæ°´çº¿æœ‰å¤šç§è§¦å‘æ–¹å¼ï¼š æ‰‹åŠ¨è§¦å‘ï¼šæ‰‹åŠ¨æäº¤ä¸€ä¸ª Workflowï¼Œå°±èƒ½è§¦å‘ä¸€æ¬¡æ„å»ºã€‚å¯ä»¥é€šè¿‡ workflowTemplateRef ç›´æ¥å¼•ç”¨ä¸€ä¸ªç°æˆçš„æµæ°´çº¿æ¨¡æ¿ã€‚ å®šæ—¶è§¦å‘ï¼šCronWorkflow é€šè¿‡ Git ä»“åº“å˜æ›´è§¦å‘ï¼šå€ŸåŠ© argo-events å¯ä»¥å®ç°æ­¤åŠŸèƒ½ï¼Œè¯¦è§å…¶æ–‡æ¡£ã€‚ å¦å¤–ç›®å‰ä¹Ÿä¸æ¸…æ¥š WebHook çš„å¯é ç¨‹åº¦å¦‚ä½•ï¼Œä¼šä¸ä¼šå› ä¸ºå®•æœºã€æ–­ç½‘ç­‰æ•…éšœï¼Œå¯¼è‡´ Git ä»“åº“å˜æ›´äº†ï¼Œè€Œ Workflow å´æ²¡è§¦å‘ï¼Œè€Œä¸”è¿˜æ²¡æœ‰ä»»ä½•æ˜¾çœ¼çš„é”™è¯¯é€šçŸ¥ï¼Ÿå¦‚æœè¿™ä¸ªé”™è¯¯å°±è¿™æ ·è—èµ·æ¥äº†ï¼Œå°±å¯èƒ½ä¼šå¯¼è‡´å¾ˆä¸¥é‡çš„é—®é¢˜ï¼ ","date":"2021-01-27","objectID":"/posts/expirence-of-argo-workflow/:1:6","tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/expirence-of-argo-workflow/"},{"categories":["æŠ€æœ¯"],"content":"7. secrets ç®¡ç† Argo Workflows çš„æµæ°´çº¿ï¼Œå¯ä»¥ä» kubernetes secrets/configmap ä¸­è·å–ä¿¡æ¯ï¼Œå°†ä¿¡æ¯æ³¨å…¥åˆ°ç¯å¢ƒå˜é‡ä¸­ã€æˆ–è€…ä»¥æ–‡ä»¶å½¢å¼æŒ‚è½½åˆ° Pod ä¸­ã€‚ Git ç§é’¥ã€Harbor ä»“åº“å‡­æ®ã€CD éœ€è¦çš„ kubeconfigï¼Œéƒ½å¯ä»¥ç›´æ¥ä» secrets/configmap ä¸­è·å–åˆ°ã€‚ å¦å¤–å› ä¸º Vault å¾ˆæµè¡Œï¼Œä¹Ÿå¯ä»¥å°† secrets ä¿å­˜åœ¨ Vault ä¸­ï¼Œå†é€šè¿‡ vault agent å°†é…ç½®æ³¨å…¥è¿› Podã€‚ ","date":"2021-01-27","objectID":"/posts/expirence-of-argo-workflow/:1:7","tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/expirence-of-argo-workflow/"},{"categories":["æŠ€æœ¯"],"content":"8. Artifacts Argo æ”¯æŒæ¥å…¥å¯¹è±¡å­˜å‚¨ï¼Œåšå…¨å±€çš„ Artifact ä»“åº“ï¼Œæœ¬åœ°å¯ä»¥ä½¿ç”¨ MinIO. ä½¿ç”¨å¯¹è±¡å­˜å‚¨å­˜å‚¨ Artifactï¼Œæœ€å¤§çš„å¥½å¤„å°±æ˜¯å¯ä»¥åœ¨ Pod ä¹‹é—´éšæ„ä¼ æ•°æ®ï¼ŒPod å¯ä»¥å®Œå…¨åˆ†å¸ƒå¼åœ°è¿è¡Œåœ¨ Kubernetes é›†ç¾¤çš„ä»»ä½•èŠ‚ç‚¹ä¸Šã€‚ å¦å¤–ä¹Ÿå¯ä»¥è€ƒè™‘å€ŸåŠ© Artifact ä»“åº“å®ç°è·¨æµæ°´çº¿çš„ç¼“å­˜å¤ç”¨ï¼ˆæœªæµ‹è¯•ï¼‰ï¼Œæå‡æ„å»ºé€Ÿåº¦ã€‚ ","date":"2021-01-27","objectID":"/posts/expirence-of-argo-workflow/:1:8","tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/expirence-of-argo-workflow/"},{"categories":["æŠ€æœ¯"],"content":"9. å®¹å™¨é•œåƒçš„æ„å»º å€ŸåŠ© Buildkit ç­‰å®¹å™¨é•œåƒæ„å»ºå·¥å…·ï¼Œå¯ä»¥å®ç°å®¹å™¨é•œåƒçš„åˆ†å¸ƒå¼æ„å»ºã€‚ Buildkit å¯¹æ„å»ºç¼“å­˜çš„æ”¯æŒä¹Ÿå¾ˆå¥½ï¼Œå¯ä»¥ç›´æ¥å°†ç¼“å­˜å­˜å‚¨åœ¨å®¹å™¨é•œåƒä»“åº“ä¸­ã€‚ ä¸å»ºè®®ä½¿ç”¨ Google çš„ Kanikoï¼Œå®ƒå¯¹ç¼“å­˜å¤ç”¨çš„æ”¯æŒä¸å’‹åœ°ï¼Œç¤¾åŒºä¹Ÿä¸æ´»è·ƒã€‚ ","date":"2021-01-27","objectID":"/posts/expirence-of-argo-workflow/:1:9","tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/expirence-of-argo-workflow/"},{"categories":["æŠ€æœ¯"],"content":"10. å®¢æˆ·ç«¯/SDK Argo æœ‰æä¾›ä¸€ä¸ªå‘½ä»¤è¡Œå®¢æˆ·ç«¯ï¼Œä¹Ÿæœ‰ HTTP API å¯ä¾›ä½¿ç”¨ã€‚ å¦‚ä¸‹é¡¹ç›®å€¼å¾—è¯•ç”¨ï¼š argo-client-python: Argo Workflows çš„ Python å®¢æˆ·ç«¯ è¯´å®è¯ï¼Œæ„Ÿè§‰å’Œ kubernetes-client/python ä¸€æ ·éš¾ç”¨ï¼Œæ¯•ç«Ÿéƒ½æ˜¯ openapi-generator ç”Ÿæˆå‡ºæ¥çš„â€¦ argo-python-dsl: ä½¿ç”¨ Python DSL ç¼–å†™ Argo Workflows æ„Ÿè§‰ä½¿ç”¨éš¾åº¦æ¯” yaml é«˜ï¼Œä¹Ÿä¸å¤ªå¥½ç”¨ã€‚ couler: ä¸º Argo/Tekton/Airflow æä¾›ç»Ÿä¸€çš„æ„å»ºä¸ç®¡ç†æ¥å£ ç†å¿µå€’æ˜¯å¾ˆå¥½ï¼Œå¾…ç ”ç©¶ æ„Ÿè§‰ couler æŒºä¸é”™çš„ï¼Œå¯ä»¥ç›´æ¥ç”¨ Python å†™ WorkflowTemplateï¼Œè¿™æ ·å°±ä¸€æ­¥åˆ°ä½ï¼Œæ‰€æœ‰ CI/CD ä»£ç å…¨éƒ¨æ˜¯ Python äº†ã€‚ æ­¤å¤–ï¼Œå› ä¸º Argo Workflows æ˜¯ kubernetes è‡ªå®šä¹‰èµ„æº CRï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ helm/kustomize æ¥åš workflow çš„ç”Ÿæˆã€‚ ç›®å‰æˆ‘ä»¬ä¸€äº›æ­¥éª¤éå¸¸å¤šï¼Œä½†æ˜¯é‡å¤åº¦ä¹Ÿå¾ˆé«˜çš„ Argo æµæ°´çº¿é…ç½®ï¼Œå°±æ˜¯ä½¿ç”¨ helm ç”Ÿæˆçš„â€”â€”å…³é”®æ•°æ®æŠ½å–åˆ° values.yaml ä¸­ï¼Œä½¿ç”¨ helm æ¨¡æ¿ + range å¾ªç¯æ¥ç”Ÿæˆ workflow é…ç½®ã€‚ ","date":"2021-01-27","objectID":"/posts/expirence-of-argo-workflow/:1:10","tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/expirence-of-argo-workflow/"},{"categories":["æŠ€æœ¯"],"content":"äºŒã€å®‰è£… Argo Workflows å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttps://argoproj.github.io/argo-workflows/installation/ å®‰è£…ä¸€ä¸ªé›†ç¾¤ç‰ˆ(cluster wide)çš„ Argo Workflowsï¼Œä½¿ç”¨ MinIO åš artifacts å­˜å‚¨ï¼š kubectl apply -f https://raw.githubusercontent.com/argoproj/argo/stable/manifests/install.yaml éƒ¨ç½² MinIO: helm repo add minio https://helm.min.io/ # official minio Helm charts # æŸ¥çœ‹å†å²ç‰ˆæœ¬ helm search repo minio/minio -l | head # ä¸‹è½½å¹¶è§£å‹ chart helm pull minio/minio --untar --version 8.0.9 # ç¼–å†™ custom-values.yamlï¼Œç„¶åéƒ¨ç½² minio kubectl create namespace minio helm install minio ./minio -n argo -f custom-values.yaml minio éƒ¨ç½²å¥½åï¼Œå®ƒä¼šå°†é»˜è®¤çš„ accesskey å’Œ secretkey ä¿å­˜åœ¨åä¸º minio çš„ secret ä¸­ã€‚ æˆ‘ä»¬éœ€è¦ä¿®æ”¹ argo çš„é…ç½®ï¼Œå°† minio ä½œä¸ºå®ƒçš„é»˜è®¤ artifact ä»“åº“ã€‚ åœ¨ configmap workflow-controller-configmap çš„ data ä¸­æ·»åŠ å¦‚ä¸‹å­—æ®µï¼š artifactRepository: | # æ˜¯å¦å°† main å®¹å™¨çš„æ—¥å¿—ä¿å­˜ä¸º artifactï¼Œè¿™æ · pod è¢«åˆ é™¤åï¼Œä»ç„¶å¯ä»¥åœ¨ artifact ä¸­æ‰¾åˆ°æ—¥å¿— archiveLogs: true s3: bucket: argo-bucket # bucket åç§°ï¼Œè¿™ä¸ª bucket éœ€è¦å…ˆæ‰‹åŠ¨åˆ›å»ºå¥½ï¼ endpoint: minio:9000 # minio åœ°å€ insecure: true # ä» minio è¿™ä¸ª secret ä¸­è·å– key/secret accessKeySecret: name: minio key: accesskey secretKeySecret: name: minio key: secretkey ç°åœ¨è¿˜å·®æœ€åä¸€æ­¥ï¼šæ‰‹åŠ¨è¿›å…¥ minio çš„ Web UIï¼Œåˆ›å»ºå¥½ argo-bucket è¿™ä¸ª bucket. ç›´æ¥è®¿é—® minio çš„ 9000 ç«¯å£ï¼ˆéœ€è¦ä½¿ç”¨ nodeport/ingress ç­‰æ–¹å¼æš´éœ²æ­¤ç«¯å£ï¼‰å°±èƒ½è¿›å…¥ Web UIï¼Œä½¿ç”¨å‰é¢æåˆ°çš„ secret minio ä¸­çš„ key/secret ç™»å½•ï¼Œå°±èƒ½åˆ›å»º bucket. ","date":"2021-01-27","objectID":"/posts/expirence-of-argo-workflow/:2:0","tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/expirence-of-argo-workflow/"},{"categories":["æŠ€æœ¯"],"content":"ServiceAccount é…ç½® https://argoproj.github.io/argo-workflows/service-accounts/ Argo Workflows ä¾èµ–äº ServiceAccount è¿›è¡ŒéªŒè¯ä¸æˆæƒï¼Œè€Œä¸”é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä½¿ç”¨æ‰€åœ¨ namespace çš„ default ServiceAccount è¿è¡Œ workflow. å¯ default è¿™ä¸ª ServiceAccount é»˜è®¤æ ¹æœ¬æ²¡æœ‰ä»»ä½•æƒé™ï¼æ‰€ä»¥ Argo çš„ artifacts, outputs, access to secrets ç­‰åŠŸèƒ½å…¨éƒ½ä¼šå› ä¸ºæƒé™ä¸è¶³è€Œæ— æ³•ä½¿ç”¨ï¼ ä¸ºæ­¤ï¼ŒArgo çš„å®˜æ–¹æ–‡æ¡£æä¾›äº†ä¸¤ä¸ªè§£å†³æ–¹æ³•ã€‚ æ–¹æ³•ä¸€ï¼Œç›´æ¥ç»™ default ç»‘å®š cluster-admin ClusterRoleï¼Œç»™å®ƒé›†ç¾¤ç®¡ç†å‘˜çš„æƒé™ï¼Œåªè¦ä¸€è¡Œå‘½ä»¤ï¼ˆä½†æ˜¯æ˜¾ç„¶å®‰å…¨æ€§å ªå¿§ï¼‰ï¼š kubectl create rolebinding default-admin --clusterrole=admin --serviceaccount=\u003cnamespace\u003e:default -n \u003cnamespace\u003e æ–¹æ³•äºŒï¼Œå®˜æ–¹ç»™å‡ºäº†Argo Workflows éœ€è¦çš„æœ€å°æƒé™çš„ Role å®šä¹‰ï¼Œæ–¹ä¾¿èµ·è§æˆ‘å°†å®ƒæ”¹æˆä¸€ä¸ª ClusterRole: apiVersion:rbac.authorization.k8s.io/v1kind:ClusterRolemetadata:name:argo-workflow-rolerules:# pod get/watch is used to identify the container IDs of the current pod# pod patch is used to annotate the step's outputs back to controller (e.g. artifact location)- apiGroups:- \"\"resources:- podsverbs:- get- watch- patch# logs get/watch are used to get the pods logs for script outputs, and for log archival- apiGroups:- \"\"resources:- pods/logverbs:- get- watch åˆ›å»ºå¥½ä¸Šé¢è¿™ä¸ªæœ€å°çš„ ClusterRoleï¼Œç„¶åä¸ºæ¯ä¸ªåå­—ç©ºé—´ï¼Œè·‘ä¸€ä¸‹å¦‚ä¸‹å‘½ä»¤ï¼Œç»™ default è´¦å·ç»‘å®šè¿™ä¸ª clusterrole: kubectl create rolebinding default-argo-workflow --clusterrole=argo-workflow-role --serviceaccount=\u003cnamespace\u003e:default -n \u003cnamespace\u003e è¿™æ ·å°±èƒ½ç»™ default è´¦å·æä¾›æœ€å°çš„ workflow è¿è¡Œæƒé™ã€‚ æˆ–è€…å¦‚æœä½ å¸Œæœ›ä½¿ç”¨åˆ«çš„ ServiceAccount æ¥è¿è¡Œ workflowï¼Œä¹Ÿå¯ä»¥è‡ªè¡Œåˆ›å»º ServiceAccountï¼Œç„¶åå†èµ°ä¸Šé¢æ–¹æ³•äºŒçš„æµç¨‹ï¼Œä½†æ˜¯æœ€åï¼Œè¦è®°å¾—åœ¨ workflow çš„ spec.serviceAccountName ä¸­è®¾å®šå¥½ ServiceAccount åç§°ã€‚ ","date":"2021-01-27","objectID":"/posts/expirence-of-argo-workflow/:2:1","tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/expirence-of-argo-workflow/"},{"categories":["æŠ€æœ¯"],"content":"Workflow Executors https://argoproj.github.io/argo-workflows/workflow-executors/ Workflow Executor æ˜¯ç¬¦åˆç‰¹å®šæ¥å£çš„ä¸€ä¸ªè¿›ç¨‹(Process)ï¼ŒArgo å¯ä»¥é€šè¿‡å®ƒæ‰§è¡Œä¸€äº›åŠ¨ä½œï¼Œå¦‚ç›‘æ§ Pod æ—¥å¿—ã€æ”¶é›† Artifactsã€ç®¡ç†å®¹å™¨ç”Ÿå‘½å‘¨æœŸç­‰ç­‰â€¦ Workflow Executor æœ‰å¤šç§å®ç°ï¼Œå¯ä»¥é€šè¿‡å‰é¢æåˆ°çš„ configmap workflow-controller-configmap æ¥é€‰æ‹©ã€‚ å¯é€‰é¡¹å¦‚ä¸‹ï¼š docker(é»˜è®¤): ç›®å‰ä½¿ç”¨èŒƒå›´æœ€å¹¿ï¼Œä½†æ˜¯å®‰å…¨æ€§æœ€å·®ã€‚å®ƒè¦æ±‚ä¸€å®šè¦æŒ‚è½½è®¿é—® docker.sockï¼Œå› æ­¤ä¸€å®šè¦ root æƒé™ï¼ kubelet: åº”ç”¨éå¸¸å°‘ï¼Œç›®å‰åŠŸèƒ½ä¹Ÿæœ‰äº›æ¬ ç¼ºï¼Œç›®å‰ä¹Ÿå¿…é¡»æä¾› root æƒé™ Kubernetes API (k8sapi): ç›´æ¥é€šè¿‡è°ƒç”¨ k8sapi å®ç°æ—¥å¿—ç›‘æ§ã€Artifacts æ‰‹æœºç­‰åŠŸèƒ½ï¼Œéå¸¸å®‰å…¨ï¼Œä½†æ˜¯æ€§èƒ½æ¬ ä½³ã€‚ Process Namespace Sharing (pns): å®‰å…¨æ€§æ¯” k8sapi å·®ä¸€ç‚¹ï¼Œå› ä¸º Process å¯¹å…¶ä»–æ‰€æœ‰å®¹å™¨éƒ½å¯è§äº†ã€‚ä½†æ˜¯ç›¸å¯¹çš„æ€§èƒ½å¥½å¾ˆå¤šã€‚ åœ¨ docker è¢« kubernetes æŠ›å¼ƒçš„å½“ä¸‹ï¼Œå¦‚æœä½ å·²ç»æ”¹ç”¨ containerd åšä¸º kubernetes è¿è¡Œæ—¶ï¼Œé‚£ argo å°†ä¼šæ— æ³•å·¥ä½œï¼Œå› ä¸ºå®ƒé»˜è®¤ä½¿ç”¨ docker ä½œä¸ºè¿è¡Œæ—¶ï¼ æˆ‘ä»¬å»ºè®®å°† workflow executore æ”¹ä¸º pnsï¼Œå…¼é¡¾å®‰å…¨æ€§ä¸æ€§èƒ½ï¼Œworkflow-controller-configmap æŒ‰ç…§å¦‚ä¸‹æ–¹å¼ä¿®æ”¹ï¼š apiVersion:v1kind:ConfigMapmetadata:name:workflow-controller-configmapdata:config:|# ...çœç•¥è‹¥å¹²é…ç½®... # Specifies the container runtime interface to use (default: docker) # must be one of: docker, kubelet, k8sapi, pns containerRuntimeExecutor: pns # ... ","date":"2021-01-27","objectID":"/posts/expirence-of-argo-workflow/:2:2","tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/expirence-of-argo-workflow/"},{"categories":["æŠ€æœ¯"],"content":"ä¸‰ã€ä½¿ç”¨ Argo Workflows åš CI å·¥å…· å®˜æ–¹çš„ Reference è¿˜ç®—è¯¦ç»†ï¼Œä¹Ÿæœ‰æä¾›éå¸¸å¤šçš„ examples ä¾›æˆ‘ä»¬å‚è€ƒï¼Œè¿™é‡Œæä¾›æˆ‘ä»¬å‡ ä¸ªå¸¸ç”¨çš„ workflow å®šä¹‰ã€‚ ä½¿ç”¨ buildkit æ„å»ºé•œåƒï¼šhttps://github.com/argoproj/argo-workflows/blob/master/examples/buildkit-template.yaml buildkit æ”¯æŒç¼“å­˜ï¼Œå¯ä»¥åœ¨è¿™ä¸ª example çš„åŸºç¡€ä¸Šè‡ªå®šä¹‰å‚æ•° æ³¨æ„ä½¿ç”¨ PVC æ¥è·¨ step å…±äº«å­˜å‚¨ç©ºé—´è¿™ç§æ‰‹æ®µï¼Œé€Ÿåº¦ä¼šæ¯”é€šè¿‡ artifacts é«˜å¾ˆå¤šã€‚ ","date":"2021-01-27","objectID":"/posts/expirence-of-argo-workflow/:3:0","tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/expirence-of-argo-workflow/"},{"categories":["æŠ€æœ¯"],"content":"å››ã€å¸¸è§é—®é¢˜ ","date":"2021-01-27","objectID":"/posts/expirence-of-argo-workflow/:4:0","tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/expirence-of-argo-workflow/"},{"categories":["æŠ€æœ¯"],"content":"1. workflow é»˜è®¤ä½¿ç”¨ root è´¦å·ï¼Ÿ workflow çš„æµç¨‹é»˜è®¤ä½¿ç”¨ root è´¦å·ï¼Œå¦‚æœä½ çš„é•œåƒé»˜è®¤ä½¿ç”¨é root è´¦å·ï¼Œè€Œä¸”è¦ä¿®æ”¹æ–‡ä»¶ï¼Œå°±å¾ˆå¯èƒ½é‡åˆ° Permission Denined çš„é—®é¢˜ã€‚ è§£å†³æ–¹æ³•ï¼šé€šè¿‡ Pod Security Context æ‰‹åŠ¨è®¾å®šå®¹å™¨çš„ user/group: Workflow Pod Security Context å®‰å…¨èµ·è§ï¼Œæˆ‘å»ºè®®æ‰€æœ‰çš„ workflow éƒ½æ‰‹åŠ¨è®¾å®š securityContextï¼Œç¤ºä¾‹ï¼š apiVersion:argoproj.io/v1alpha1kind:WorkflowTemplatemetadata:name:xxxspec:securityContext:runAsNonRoot:truerunAsUser:1000 æˆ–è€…ä¹Ÿå¯ä»¥é€šè¿‡ workflow-controller-configmap çš„ workflowDefaults è®¾å®šé»˜è®¤çš„ workflow é…ç½®ã€‚ ","date":"2021-01-27","objectID":"/posts/expirence-of-argo-workflow/:4:1","tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/expirence-of-argo-workflow/"},{"categories":["æŠ€æœ¯"],"content":"2. å¦‚ä½•ä» hashicorp vault ä¸­è¯»å– secrets? å‚è€ƒ Support to get secrets from Vault hashicorp vault ç›®å‰å¯ä»¥è¯´æ˜¯äº‘åŸç”Ÿé¢†åŸŸæœ€å—æ¬¢è¿çš„ secrets ç®¡ç†å·¥å…·ã€‚ æˆ‘ä»¬åœ¨ç”Ÿäº§ç¯å¢ƒç”¨å®ƒåšä¸ºåˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒï¼ŒåŒæ—¶åœ¨æœ¬åœ° CI/CD ä¸­ï¼Œä¹Ÿä½¿ç”¨å®ƒå­˜å‚¨ç›¸å…³çš„æ•æ„Ÿä¿¡æ¯ã€‚ ç°åœ¨è¿ç§»åˆ° argoï¼Œæˆ‘ä»¬å½“ç„¶å¸Œæœ›èƒ½å¤Ÿæœ‰ä¸€ä¸ªå¥½çš„æ–¹æ³•ä» vault ä¸­è¯»å–é…ç½®ã€‚ ç›®å‰æœ€æ¨èçš„æ–¹æ³•ï¼Œæ˜¯ä½¿ç”¨ vault çš„ vault-agentï¼Œå°† secrets ä»¥æ–‡ä»¶çš„å½¢å¼æ³¨å…¥åˆ° pod ä¸­ã€‚ é€šè¿‡ valut-policy - vault-role - k8s-serviceaccount ä¸€ç³»åˆ—è®¤è¯æˆæƒé…ç½®ï¼Œå¯ä»¥åˆ¶å®šéå¸¸ç»†ç²’åº¦çš„ secrets æƒé™è§„åˆ™ï¼Œè€Œä¸”é…ç½®ä¿¡æ¯é˜…åå³ç„šï¼Œå®‰å…¨æ€§å¾ˆé«˜ã€‚ ","date":"2021-01-27","objectID":"/posts/expirence-of-argo-workflow/:4:2","tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/expirence-of-argo-workflow/"},{"categories":["æŠ€æœ¯"],"content":"3. å¦‚ä½•åœ¨å¤šä¸ªåå­—ç©ºé—´ä¸­ä½¿ç”¨åŒä¸€ä¸ª secrets? ä½¿ç”¨ Namespace å¯¹ workflow è¿›è¡Œåˆ†ç±»æ—¶ï¼Œé‡åˆ°çš„ä¸€ä¸ªå¸¸è§é—®é¢˜å°±æ˜¯ï¼Œå¦‚ä½•åœ¨å¤šä¸ªåå­—ç©ºé—´ä½¿ç”¨ private-git-creds/docker-config/minio/vault ç­‰ workflow å¿…è¦çš„ secrets. å¸¸è§çš„æ–¹æ³•æ˜¯æŠŠ secrets åœ¨æ‰€æœ‰åå­—ç©ºé—´ create ä¸€æ¬¡ã€‚ ä½†æ˜¯ä¹Ÿæœ‰æ›´æ–¹ä¾¿çš„ secrets åŒæ­¥å·¥å…·ï¼š æ¯”å¦‚ï¼Œä½¿ç”¨ kyverno è¿›è¡Œ secrets åŒæ­¥çš„é…ç½®ï¼š apiVersion:kyverno.io/v1kind:ClusterPolicymetadata:name:sync-secretsspec:background:falserules:# å°† secret vault ä» argo Namespace åŒæ­¥åˆ°å…¶ä»–æ‰€æœ‰ Namespace- name:sync-vault-secretmatch:resources:kinds:- Namespacegenerate:kind:Secretname:regcrednamespace:\"{{request.object.metadata.name}}\"synchronize:trueclone:namespace:argoname:vault# å¯ä»¥é…ç½®å¤šä¸ª rulesï¼Œæ¯ä¸ª rules åŒæ­¥ä¸€ä¸ª secret ä¸Šé¢æä¾›çš„ kyverno é…ç½®ï¼Œä¼šå®æ—¶åœ°ç›‘æ§æ‰€æœ‰ Namespace å˜æ›´ï¼Œä¸€ä½†æœ‰æ–° Namespace è¢«åˆ›å»ºï¼Œå®ƒå°±ä¼šç«‹å³å°† vault secret åŒæ­¥åˆ°è¯¥ Namespace. æˆ–è€…ï¼Œä½¿ç”¨ä¸“é—¨çš„ secrets/configmap å¤åˆ¶å·¥å…·ï¼škubernetes-replicator ","date":"2021-01-27","objectID":"/posts/expirence-of-argo-workflow/:4:3","tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/expirence-of-argo-workflow/"},{"categories":["æŠ€æœ¯"],"content":"4. Argo å¯¹ CR èµ„æºçš„éªŒè¯ä¸å¤Ÿä¸¥è°¨ï¼Œå†™é”™äº† key éƒ½ä¸æŠ¥é”™ å¾…ç ”ç©¶ ","date":"2021-01-27","objectID":"/posts/expirence-of-argo-workflow/:4:4","tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/expirence-of-argo-workflow/"},{"categories":["æŠ€æœ¯"],"content":"5. å¦‚ä½•å½’æ¡£å†å²æ•°æ®ï¼Ÿ Argo ç”¨çš„æ—¶é—´é•¿äº†ï¼Œè·‘è¿‡çš„ Workflows/Pods å…¨éƒ½ä¿å­˜åœ¨ Kubernetes/Argo Server ä¸­ï¼Œå¯¼è‡´ Argo è¶Šç”¨è¶Šæ…¢ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒArgo æä¾›äº†ä¸€äº›é…ç½®æ¥é™åˆ¶ Workflows å’Œ Pods çš„æ•°é‡ï¼Œè¯¦è§ï¼šLimit The Total Number Of Workflows And Pods è¿™äº›é™åˆ¶éƒ½æ˜¯ Workflow çš„å‚æ•°ï¼Œå¦‚æœå¸Œæœ›è®¾ç½®ä¸€ä¸ªå…¨å±€é»˜è®¤çš„é™åˆ¶ï¼Œå¯ä»¥æŒ‰ç…§å¦‚ä¸‹ç¤ºä¾‹ä¿®æ”¹ argo çš„ workflow-controller-configmap è¿™ä¸ª configmap: apiVersion:v1kind:ConfigMapmetadata:name:workflow-controller-configmapdata:config:|# Default values that will apply to all Workflows from this controller, unless overridden on the Workflow-level # See more: docs/default-workflow-specs.md workflowDefaults: spec: # must complete in 8h (28,800 seconds) activeDeadlineSeconds: 28800 # keep workflows for 1d (86,400 seconds) ttlStrategy: secondsAfterCompletion: 86400 # secondsAfterSuccess: 5 # secondsAfterFailure: 500 # delete all pods as soon as they complete podGC: # å¯é€‰é¡¹ï¼š\"OnPodCompletion\", \"OnPodSuccess\", \"OnWorkflowCompletion\", \"OnWorkflowSuccess\" strategy: OnPodCompletion ","date":"2021-01-27","objectID":"/posts/expirence-of-argo-workflow/:4:5","tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/expirence-of-argo-workflow/"},{"categories":["æŠ€æœ¯"],"content":"6. Argo çš„å…¶ä»–è¿›é˜¶é…ç½® Argo Workflows çš„é…ç½®ï¼Œéƒ½ä¿å­˜åœ¨ workflow-controller-configmap è¿™ä¸ª configmap ä¸­ï¼Œæˆ‘ä»¬å‰é¢å·²ç»æ¥è§¦åˆ°äº†å®ƒçš„éƒ¨åˆ†å†…å®¹ã€‚ è¿™é‡Œç»™å‡ºæ­¤é…ç½®æ–‡ä»¶çš„å®Œæ•´ examples: https://github.com/argoproj/argo-workflows/blob/master/docs/workflow-controller-configmap.yaml å…¶ä¸­ä¸€äº›å¯èƒ½éœ€è¦è‡ªå®šä¹‰çš„å‚æ•°å¦‚ä¸‹ï¼š parallelism: workflow çš„æœ€å¤§å¹¶è¡Œæ•°é‡ persistence: å°†å®Œæˆçš„ workflows ä¿å­˜åˆ° postgresql/mysql ä¸­ï¼Œè¿™æ ·å³ä½¿ k8s ä¸­çš„ workflow è¢«åˆ é™¤äº†ï¼Œè¿˜èƒ½æŸ¥çœ‹ workflow è®°å½• ä¹Ÿæ”¯æŒé…ç½®è¿‡æœŸæ—¶é—´ sso: å¯ç”¨å•ç‚¹ç™»å½• ","date":"2021-01-27","objectID":"/posts/expirence-of-argo-workflow/:4:6","tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/expirence-of-argo-workflow/"},{"categories":["æŠ€æœ¯"],"content":"7. æ˜¯å¦åº”è¯¥å°½é‡ä½¿ç”¨ CI/CD å·¥å…·æä¾›çš„åŠŸèƒ½ï¼Ÿ æˆ‘ä»åŒäº‹ä»¥åŠç½‘ç»œä¸Šï¼Œäº†è§£åˆ°éƒ¨åˆ† DevOps äººå‘˜ä¸»å¼ å°½é‡è‡ªå·±ä½¿ç”¨ Python/Go æ¥å®ç° CI/CD æµæ°´çº¿ï¼ŒCI/CD å·¥å…·æä¾›çš„åŠŸèƒ½èƒ½ä¸ä½¿ç”¨å°±ä¸è¦ä½¿ç”¨ã€‚ å› æ­¤æœ‰æ­¤ä¸€é—®ã€‚ä¸‹é¢åšä¸‹è¯¦ç»†çš„åˆ†æï¼š å°½é‡ä½¿ç”¨ CI/CD å·¥å…·æä¾›çš„æ’ä»¶/åŠŸèƒ½ï¼Œå¥½å¤„æ˜¯ä¸éœ€è¦è‡ªå·±å»å®ç°ï¼Œå¯ä»¥é™ä½ç»´æŠ¤æˆæœ¬ã€‚ ä½†æ˜¯ç›¸å¯¹çš„è¿ç»´äººå‘˜å°±éœ€è¦æ·±å…¥å­¦ä¹ è¿™ä¸ª CI/CD å·¥å…·çš„ä½¿ç”¨ï¼Œå¦å¤–è¿˜ä¼šå’Œ CI/CD å·¥å…·ç»‘å®šï¼Œä¼šå¢åŠ è¿ç§»éš¾åº¦ã€‚ è€Œå°½é‡è‡ªå·±ç”¨ Python ç­‰ä»£ç å»å®ç°æµæ°´çº¿ï¼Œè®© CI/CD å·¥å…·åªè´Ÿè´£è°ƒåº¦ä¸è¿è¡Œè¿™äº› Python ä»£ç ï¼Œ é‚£ CI/CD å°±å¯ä»¥å¾ˆæ–¹ä¾¿åœ°éšä¾¿æ¢ï¼Œè¿ç»´äººå‘˜ä¹Ÿä¸éœ€è¦å»æ·±å…¥å­¦ä¹  CI/CD å·¥å…·çš„ä½¿ç”¨ã€‚ ç¼ºç‚¹æ˜¯å¯èƒ½ä¼šå¢åŠ  CI/CD ä»£ç çš„å¤æ‚æ€§ã€‚ æˆ‘è§‚å¯Ÿåˆ° argo/drone çš„ä¸€äº› examplesï¼Œå‘ç°å®ƒä»¬çš„ç‰¹å¾æ˜¯ï¼š æ‰€æœ‰ CI/CD ç›¸å…³çš„é€»è¾‘ï¼Œå…¨éƒ½å®ç°åœ¨æµæ°´çº¿ä¸­ï¼Œä¸éœ€è¦å…¶ä»–æ„å»ºä»£ç  æ¯ä¸€ä¸ª step éƒ½ä½¿ç”¨ä¸“ç”¨é•œåƒï¼šgolang/nodejs/python æ¯”å¦‚å…ˆä½¿ç”¨ golang é•œåƒè¿›è¡Œæµ‹è¯•ã€æ„å»ºï¼Œå†ä½¿ç”¨ kaniko å°†æ‰“åŒ…æˆå®¹å™¨é•œåƒ é‚£æ˜¯å¦åº”è¯¥å°½é‡ä½¿ç”¨ CI/CD å·¥å…·æä¾›çš„åŠŸèƒ½å‘¢ï¼Ÿ å…¶å®è¿™å°±æ˜¯æœ‰å¤šç§æ–¹æ³•å®ç°åŒä¸€ä»¶äº‹ï¼Œè¯¥ç”¨å“ªç§æ–¹æ³•çš„é—®é¢˜ã€‚è¿™ä¸ªé—®é¢˜åœ¨å„ä¸ªé¢†åŸŸéƒ½å¾ˆå¸¸è§ã€‚ ä»¥æˆ‘ç›®å‰çš„ç»éªŒæ¥çœ‹ï¼Œéœ€è¦å…·ä½“é—®é¢˜å…·ä½“åˆ†æï¼Œä»¥ Argo Workflows ä¸ºä¾‹ï¼š æµæ°´çº¿æœ¬èº«éå¸¸ç®€å•ï¼Œé‚£å®Œå…¨å¯ä»¥ç›´æ¥ä½¿ç”¨ argo æ¥å®ç°ï¼Œæ²¡å¿…è¦è‡ªå·±å†æä¸ª python è„šæœ¬ ç®€å•çš„æµæ°´çº¿ï¼Œè¿ç§»èµ·æ¥å¾€å¾€ä¹Ÿéå¸¸ç®€å•ã€‚æ²¡å¿…è¦ä¸ºäº†å¯è¿ç§»æ€§ï¼Œéè¦ç”¨ argo å»è°ƒç”¨ python è„šæœ¬ã€‚ æµæ°´çº¿çš„æ­¥éª¤ä¹‹é—´åŒ…å«å¾ˆå¤šé€»è¾‘åˆ¤æ–­/æ•°æ®ä¼ é€’ï¼Œé‚£å¾ˆå¯èƒ½æ˜¯ä½ çš„æµæ°´çº¿è®¾è®¡æœ‰é—®é¢˜ï¼ æµæ°´çº¿çš„æ­¥éª¤ä¹‹é—´ä¼ é€’çš„æ•°æ®åº”è¯¥å°½å¯èƒ½å°‘ï¼å¤æ‚çš„é€»è¾‘åˆ¤æ–­åº”è¯¥å°½é‡å°è£…åœ¨å…¶ä¸­ä¸€ä¸ªæ­¥éª¤ä¸­ï¼ è¿™ç§æƒ…å†µä¸‹ï¼Œå°±åº”è¯¥ä½¿ç”¨ python è„šæœ¬æ¥å°è£…å¤æ‚çš„é€»è¾‘ï¼Œè€Œä¸åº”è¯¥å°†è¿™äº›é€»è¾‘æš´éœ²åˆ° Argo Workflows ä¸­ï¼ æˆ‘éœ€è¦æ‰¹é‡è¿è¡Œå¾ˆå¤šçš„æµæ°´çº¿ï¼Œè€Œä¸”å®ƒä»¬ä¹‹é—´è¿˜æœ‰å¤æ‚çš„ä¾èµ–å…³ç³»ï¼šé‚£æ˜¾ç„¶åº”è¯¥åˆ©ç”¨ä¸Š argo wrokflow çš„é«˜çº§ç‰¹æ€§ã€‚ argo çš„ dag/steps å’Œ workflow of workflows è¿™ä¸¤ä¸ªåŠŸèƒ½ç»“åˆï¼Œå¯ä»¥ç®€å•åœ°å®ç°ä¸Šè¿°åŠŸèƒ½ã€‚ ","date":"2021-01-27","objectID":"/posts/expirence-of-argo-workflow/:4:7","tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/expirence-of-argo-workflow/"},{"categories":["æŠ€æœ¯"],"content":"8. å¦‚ä½•æå‡ Argo Workflows çš„åˆ›å»ºå’Œé”€æ¯é€Ÿåº¦ï¼Ÿ æˆ‘ä»¬å‘ç° workflow çš„ podï¼Œåˆ›å»ºå’Œé”€æ¯æ¶ˆè€—äº†å¤§é‡æ—¶é—´ï¼Œå°¤å…¶æ˜¯é”€æ¯ã€‚ è¿™å¯¼è‡´æˆ‘ä»¬å•ä¸ªæµæ°´çº¿åœ¨ argo ä¸Šè·‘ï¼Œè¿˜æ²¡åœ¨ jenkins ä¸Šè·‘æ›´å¿«ã€‚ ","date":"2021-01-27","objectID":"/posts/expirence-of-argo-workflow/:5:0","tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/expirence-of-argo-workflow/"},{"categories":["æŠ€æœ¯"],"content":"ä½¿ç”¨ä½“éªŒ ç›®å‰å·²ç»ä½¿ç”¨ Argo Workflows ä¸€ä¸ªæœˆå¤šäº†ï¼Œæ€»çš„æ¥è¯´ï¼Œæœ€éš¾ç”¨çš„å°±æ˜¯ Web UIã€‚ å…¶ä»–çš„éƒ½æ˜¯å°é—®é¢˜ï¼Œåªæœ‰ Web UI æ˜¯çœŸçš„è¶…éš¾ç”¨ï¼Œæ„Ÿè§‰æ ¹æœ¬å°±æ²¡æœ‰å¥½å¥½åšè¿‡è®¾è®¡â€¦ æ€¥éœ€ä¸€ä¸ªç¬¬ä¸‰æ–¹ Web UIâ€¦ ","date":"2021-01-27","objectID":"/posts/expirence-of-argo-workflow/:6:0","tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/expirence-of-argo-workflow/"},{"categories":["æŠ€æœ¯"],"content":"ç”»å¤– - å¦‚ä½•å¤„ç†å…¶ä»– Kubernetes èµ„æºä¹‹é—´çš„ä¾èµ–å…³ç³» Argo ç›¸æ¯”å…¶ä»– CI å·¥å…·ï¼Œæœ€å¤§çš„ç‰¹ç‚¹ï¼Œæ˜¯å®ƒå‡è®¾ã€Œä»»åŠ¡ã€ä¹‹é—´æ˜¯æœ‰ä¾èµ–å…³ç³»çš„ï¼Œå› æ­¤å®ƒæä¾›äº†å¤šç§åè°ƒç¼–æ’ã€Œä»»åŠ¡ã€çš„æ–¹æ³•ã€‚ ä½†æ˜¯è²Œä¼¼ Argo CD å¹¶æ²¡æœ‰ç»§æ‰¿è¿™ä¸ªç†å¿µï¼ŒArgo CD éƒ¨ç½²æ—¶ï¼Œå¹¶ä¸èƒ½åœ¨ kubernetes èµ„æºä¹‹é—´ï¼Œé€šè¿‡ DAG ç­‰æ–¹æ³•å®šä¹‰ä¾èµ–å…³ç³»ã€‚ å¾®æœåŠ¡ä¹‹é—´å­˜åœ¨ä¾èµ–å…³ç³»ï¼Œå¸Œæœ›èƒ½æŒ‰ä¾èµ–å…³ç³»è¿›è¡Œéƒ¨ç½²ï¼Œè€Œ ArgoCD/FluxCD éƒ¨ç½² kubernetes yaml æ—¶éƒ½æ˜¯ä¸è€ƒè™‘ä»»ä½•ä¾èµ–å…³ç³»çš„ã€‚è¿™é‡Œå°±å­˜åœ¨ä¸€äº›çŸ›ç›¾ã€‚ è§£å†³è¿™ä¸ªçŸ›ç›¾çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œæˆ‘æŸ¥é˜…äº†å¾ˆå¤šèµ„æ–™ï¼Œä¹Ÿè‡ªå·±åšäº†ä¸€äº›æ€è€ƒï¼Œå¾—åˆ°çš„æœ€ä½³å®è·µæ¥è‡ªè§£å†³æœåŠ¡ä¾èµ– - é˜¿é‡Œäº‘ ACK å®¹å™¨æœåŠ¡ï¼Œå®ƒç»™å‡ºäº†ä¸¤ç§æ–¹æ¡ˆï¼š åº”ç”¨ç«¯æœåŠ¡ä¾èµ–æ£€æŸ¥: å³åœ¨å¾®æœåŠ¡çš„å…¥å£æ·»åŠ ä¾èµ–æ£€æŸ¥é€»è¾‘ï¼Œç¡®ä¿æ‰€æœ‰ä¾èµ–çš„å¾®æœåŠ¡/æ•°æ®åº“éƒ½å¯è®¿é—®äº†ï¼Œå°±ç»­æ¢é’ˆæ‰èƒ½è¿”å› 200. å¦‚æœè¶…æ—¶å°±ç›´æ¥ Crash ç‹¬ç«‹çš„æœåŠ¡ä¾èµ–æ£€æŸ¥é€»è¾‘: éƒ¨åˆ†é—ç•™ä»£ç ä½¿ç”¨æ–¹æ³•ä¸€æ”¹é€ èµ·æ¥æˆ–è®¸ä¼šå¾ˆå›°éš¾ï¼Œè¿™æ—¶å¯ä»¥è€ƒè™‘ä½¿ç”¨ pod initContainer æˆ–è€…å®¹å™¨çš„å¯åŠ¨è„šæœ¬ä¸­ï¼ŒåŠ å…¥ä¾èµ–æ£€æŸ¥é€»è¾‘ã€‚ ä½†æ˜¯è¿™ä¸¤ä¸ªæ–¹æ¡ˆä¹Ÿè¿˜æ˜¯å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œåœ¨è¯´æ˜é—®é¢˜å‰ï¼Œæˆ‘å…ˆè¯´æ˜ä¸€ä¸‹æˆ‘ä»¬ã€ŒæŒ‰åºéƒ¨ç½²ã€çš„åº”ç”¨åœºæ™¯ã€‚ æˆ‘ä»¬æ˜¯ä¸€ä¸ªå¾ˆå°çš„å›¢é˜Ÿï¼Œåç«¯åš RPC æ¥å£å‡çº§æ—¶ï¼Œé€šå¸¸æ˜¯ç›´æ¥åœ¨å¼€å‘ç¯å¢ƒåšå…¨é‡å‡çº§+æµ‹è¯•ã€‚ å› æ­¤è¿ç»´è¿™è¾¹ä¹Ÿæ˜¯ï¼Œæ¯æ¬¡éƒ½æ˜¯åšå…¨é‡å‡çº§ã€‚ å› ä¸ºæ²¡æœ‰åè®®åå•†æœºåˆ¶ï¼Œæ–°çš„å¾®æœåŠ¡çš„ã€ŒRPC æœåŠ¡ç«¯ã€å°†å…¼å®¹ v1 v2 æ–°æ—§ä¸¤ç§åè®®ï¼Œè€Œæ–°çš„ã€ŒRPC å®¢æˆ·ç«¯ã€å°†ç›´æ¥ä½¿ç”¨ v2 åè®®å»è¯·æ±‚å…¶ä»–å¾®æœåŠ¡ã€‚ è¿™å°±å¯¼è‡´æˆ‘ä»¬å¿…é¡»å…ˆå‡çº§ã€ŒRPC æœåŠ¡ç«¯ã€ï¼Œç„¶åæ‰èƒ½å‡çº§ã€ŒRPC å®¢æˆ·ç«¯ã€ã€‚ ä¸ºæ­¤ï¼Œåœ¨è¿›è¡Œå¾®æœåŠ¡çš„å…¨é‡å‡çº§æ—¶ï¼Œå°±éœ€è¦æ²¿ç€ RPC è°ƒç”¨é“¾è·¯æŒ‰åºå‡çº§ï¼Œè¿™é‡Œå°±æ¶‰åŠåˆ°äº† Kubernetes èµ„æºä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚ æˆ‘ç›®å‰è·çŸ¥çš„å…³é”®é—®é¢˜åœ¨äºï¼šæˆ‘ä»¬ä½¿ç”¨çš„å¹¶ä¸æ˜¯çœŸæ­£çš„å¾®æœåŠ¡å¼€å‘æ¨¡å¼ï¼Œè€Œæ˜¯åœ¨æŠŠæ•´ä¸ªå¾®æœåŠ¡ç³»ç»Ÿå½“æˆä¸€ä¸ªã€Œå•ä½“æœåŠ¡ã€åœ¨çœ‹å¾…ï¼Œæ‰€ä»¥å¼•ç”³å‡ºäº†è¿™æ ·çš„ä¾èµ–å…³é”®çš„é—®é¢˜ã€‚ æˆ‘è¿›å…¥çš„æ–°å…¬å¸å®Œå…¨æ²¡æœ‰è¿™æ ·çš„é—®é¢˜ï¼Œæ‰€æœ‰çš„æœåŠ¡ä¹‹é—´åœ¨ CI/CD è¿™ä¸ªé˜¶æ®µéƒ½æ˜¯è§£è€¦çš„ï¼ŒCI/CD ä¸éœ€è¦è€ƒè™‘æœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œä¹Ÿæ²¡æœ‰è‡ªåŠ¨æŒ‰ç…§ä¾èµ–å…³ç³»è¿›è¡Œå¾®æœåŠ¡æ‰¹é‡å‘å¸ƒçš„åŠŸèƒ½ï¼Œè¿™äº›éƒ½ç”±å¼€å‘äººå‘˜è‡ªè¡Œç»´æŠ¤ã€‚ æˆ–è®¸è¿™æ‰æ˜¯æ­£ç¡®çš„ä½¿ç”¨å§¿åŠ¿ï¼Œå¦‚æœåŠ¨ä¸åŠ¨å°±è¦æ‰¹é‡æ›´æ–°ä¸€å¤§æ‰¹æœåŠ¡ï¼Œé‚£å¾®æœåŠ¡ä½“ç³»çš„è®¾è®¡ã€æ‹†åˆ†è‚¯å®šæ˜¯æœ‰é—®é¢˜äº†ï¼Œç”Ÿäº§ç¯å¢ƒä¹Ÿä¸ä¼šå…è®¸è¿™ä¹ˆè½»ç‡çš„æ›´æ–°ã€‚ å‰é¢è®²äº†ï¼Œé˜¿é‡Œäº‘æä¾›çš„ã€Œåº”ç”¨ç«¯æœåŠ¡ä¾èµ–æ£€æŸ¥ã€å’Œã€Œç‹¬ç«‹çš„æœåŠ¡ä¾èµ–æ£€æŸ¥é€»è¾‘ã€æ˜¯æœ€ä½³å®è·µã€‚å®ƒä»¬çš„ä¼˜ç‚¹æœ‰ï¼š ç®€åŒ–éƒ¨ç½²é€»è¾‘ï¼Œæ¯æ¬¡ç›´æ¥åšå…¨é‡éƒ¨ç½²å°± OKã€‚ æå‡éƒ¨ç½²é€Ÿåº¦ï¼Œå…·ä½“ä½“ç°åœ¨ï¼šGitOps éƒ¨ç½²æµç¨‹åªéœ€è¦èµ°ä¸€æ¬¡ï¼ˆæŒ‰åºéƒ¨ç½²è¦å¾ˆå¤šæ¬¡ï¼‰ã€æ‰€æœ‰é•œåƒéƒ½æå‰æ‹‰å–å¥½äº†ã€æ‰€æœ‰ Pod ä¹Ÿéƒ½æå‰å¯åŠ¨äº†ã€‚ ä½†æ˜¯è¿™é‡Œæœ‰ä¸ªé—®é¢˜æ˜¯ã€Œç°åº¦å‘å¸ƒã€æˆ–è€…ã€Œæ»šåŠ¨æ›´æ–°ã€ï¼Œè¿™ä¸¤ç§æƒ…å†µä¸‹éƒ½å­˜åœ¨æ–°æ—§ç‰ˆæœ¬å…±å­˜çš„é—®é¢˜ã€‚ å¦‚æœå‡ºç°äº† RPC æ¥å£å‡çº§ï¼Œé‚£å°±å¿…é¡»å…ˆå®Œæˆã€ŒRPC æœåŠ¡ç«¯ã€çš„ã€Œç°åº¦å‘å¸ƒã€æˆ–è€…ã€Œæ»šåŠ¨æ›´æ–°ã€ï¼Œå†å»æ›´æ–°ã€ŒRPC å®¢æˆ·ç«¯ã€ã€‚ å¦åˆ™å¦‚æœç›´æ¥å¯¹æ‰€æœ‰å¾®æœåŠ¡åšç°åº¦æ›´æ–°ï¼Œåªä¾é ã€ŒæœåŠ¡ä¾èµ–æ£€æŸ¥ã€ï¼Œå°±ä¼šå‡ºç°è¿™æ ·çš„é—®é¢˜â€”â€”ã€ŒRPC æœåŠ¡ç«¯ã€å¤„äºã€Œè–›å®šè°”ã€çŠ¶æ€ï¼Œä½ è°ƒç”¨åˆ°çš„æœåŠ¡ç«¯ç‰ˆæœ¬æ˜¯æ–°è¿˜æ˜¯æ—§ï¼Œå–å†³äºè´Ÿè½½å‡è¡¡çš„ç­–ç•¥å’Œæ¦‚ç‡ã€‚ **å› æ­¤åœ¨åš RPC æ¥å£çš„å…¨é‡å‡çº§æ—¶ï¼Œåªä¾é ã€ŒæœåŠ¡ä¾èµ–æ£€æŸ¥ã€æ˜¯è¡Œä¸é€šçš„ã€‚**æˆ‘ç›®å‰æƒ³åˆ°çš„æ–¹æ¡ˆï¼Œæœ‰å¦‚ä¸‹å‡ ç§ï¼š æˆ‘ä»¬å½“å‰çš„ä½¿ç”¨æ–¹æ¡ˆï¼šç›´æ¥åœ¨ yaml éƒ¨ç½²è¿™ä¸€æ­¥å®ç°æŒ‰åºéƒ¨ç½²ï¼Œæ¯æ¬¡éƒ¨ç½²åå°±è½®è¯¢ kube-apiserverï¼Œç¡®è®¤å…¨éƒ¨ç°åº¦å®Œæˆï¼Œå†è¿›è¡Œä¸‹ä¸€é˜¶æ®µçš„ yaml éƒ¨ç½²ã€‚ è®©åç«¯åŠ ä¸ªå‚æ•°æ¥æ§åˆ¶å®¢æˆ·ç«¯ä½¿ç”¨çš„ RPC åè®®ç‰ˆæœ¬ï¼Œæˆ–è€…æä¸€ä¸ªåè®®åå•†ã€‚è¿™æ ·å°±ä¸éœ€è¦æ§åˆ¶å¾®æœåŠ¡å‘å¸ƒé¡ºåºäº†ã€‚ ç¤¾åŒºå¾ˆå¤šæœ‰çŠ¶æ€åº”ç”¨çš„éƒ¨ç½²éƒ½æ¶‰åŠåˆ°éƒ¨ç½²é¡ºåºç­‰å¤æ‚æ“ä½œï¼Œç›®å‰æµè¡Œçš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨ Operator+CRD æ¥å®ç°è¿™ç±»åº”ç”¨çš„éƒ¨ç½²ã€‚Operator ä¼šè‡ªè¡Œå¤„ç†å¥½å„ä¸ªç»„ä»¶çš„éƒ¨ç½²é¡ºåºã€‚ ","date":"2021-01-27","objectID":"/posts/expirence-of-argo-workflow/:7:0","tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/expirence-of-argo-workflow/"},{"categories":["æŠ€æœ¯"],"content":"å‚è€ƒæ–‡æ¡£ ArgoåŠ å…¥CNCFå­µåŒ–å™¨ï¼Œä¸€æ–‡è§£æKubernetesåŸç”Ÿå·¥ä½œæµ è§†é¢‘: How to Multiply the Power of Argo Projects By Using Them Together - Hong Wang ","date":"2021-01-27","objectID":"/posts/expirence-of-argo-workflow/:8:0","tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/expirence-of-argo-workflow/"},{"categories":["æŠ€æœ¯"],"content":"Vault æ˜¯ hashicorp æ¨å‡ºçš„ secrets ç®¡ç†ã€åŠ å¯†å³æœåŠ¡ä¸æƒé™ç®¡ç†å·¥å…·ã€‚å®ƒçš„åŠŸèƒ½ç®€ä»‹å¦‚ä¸‹ï¼š secrets ç®¡ç†ï¼šæ”¯æŒä¿å­˜å„ç§è‡ªå®šä¹‰ä¿¡æ¯ã€è‡ªåŠ¨ç”Ÿæˆå„ç±»å¯†é’¥ï¼Œvault è‡ªåŠ¨ç”Ÿæˆçš„å¯†é’¥è¿˜èƒ½è‡ªåŠ¨è½®è½¬(rotate) è®¤è¯æ–¹å¼ï¼šæ”¯æŒæ¥å…¥å„å¤§äº‘å‚å•†çš„è´¦å·ä½“ç³»ï¼ˆæ¯”å¦‚é˜¿é‡Œäº‘RAMå­è´¦å·ä½“ç³»ï¼‰æˆ–è€… LDAP ç­‰è¿›è¡Œèº«ä»½éªŒè¯ï¼Œä¸éœ€è¦åˆ›å»ºé¢å¤–çš„è´¦å·ä½“ç³»ã€‚ æƒé™ç®¡ç†ï¼šé€šè¿‡ policyï¼Œå¯ä»¥è®¾å®šéå¸¸ç»†è‡´çš„ ACL æƒé™ã€‚ å¯†é’¥å¼•æ“ï¼šä¹Ÿæ”¯æŒæ¥ç®¡å„å¤§äº‘å‚å•†çš„è´¦å·ä½“ç³»ï¼ˆæ¯”å¦‚é˜¿é‡Œäº‘RAMå­è´¦å·ä½“ç³»ï¼‰ï¼Œå®ç° API Key çš„è‡ªåŠ¨è½®è½¬ã€‚ æ”¯æŒæ¥å…¥ kubernetes rbac æƒé™ä½“ç³»ï¼Œé€šè¿‡ serviceaccount+role ä¸ºæ¯ä¸ª Pod å•ç‹¬é…ç½®æƒé™ã€‚ æ”¯æŒé€šè¿‡ sidecar/init-container å°† secrets æ³¨å…¥åˆ° pod ä¸­ï¼Œæˆ–è€…é€šè¿‡ k8s operator å°† vault æ•°æ®åŒæ­¥åˆ° k8s secrets ä¸­ åœ¨ä½¿ç”¨ Vault ä¹‹å‰ï¼Œæˆ‘ä»¬æ˜¯ä»¥æºç¨‹å¼€æºçš„ Apollo ä½œä¸ºå¾®æœåŠ¡çš„åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒã€‚ Apollo åœ¨å›½å†…éå¸¸æµè¡Œã€‚å®ƒåŠŸèƒ½å¼ºå¤§ï¼Œæ”¯æŒé…ç½®çš„ç»§æ‰¿ï¼Œä¹Ÿæœ‰æä¾› HTTP API æ–¹ä¾¿è‡ªåŠ¨åŒ–ã€‚ ç¼ºç‚¹æ˜¯æƒé™ç®¡ç†å’Œ secrets ç®¡ç†æ¯”è¾ƒå¼±ï¼Œä¹Ÿä¸æ”¯æŒä¿¡æ¯åŠ å¯†ï¼Œä¸é€‚åˆç›´æ¥å­˜å‚¨æ•æ„Ÿä¿¡æ¯ã€‚å› æ­¤æˆ‘ä»¬ç°åœ¨åˆ‡æ¢åˆ°äº† Vault. ç›®å‰æˆ‘ä»¬æœ¬åœ°çš„ CI/CD æµæ°´çº¿å’Œäº‘ä¸Šçš„å¾®æœåŠ¡ä½“ç³»ï¼Œéƒ½æ˜¯ä½¿ç”¨çš„ Vault åš secrets ç®¡ç†. ","date":"2021-01-24","objectID":"/posts/expirence-of-vault/:0:0","tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/expirence-of-vault/"},{"categories":["æŠ€æœ¯"],"content":"ä¸€ã€Vault åŸºç¡€æ¦‚å¿µ ã€ŒåŸºæœ¬æ¦‚å¿µã€è¿™ä¸€èŠ‚ï¼ŒåŸºæœ¬éƒ½ç¿»è¯‘è‡ªå®˜æ–¹æ–‡æ¡£: https://www.vaultproject.io/docs/internals/architecture é¦–å…ˆçœ‹ä¸€ä¸‹ Vault çš„æ¶æ„å›¾ï¼š vault layers\" vault layers å¯ä»¥çœ‹åˆ°ï¼Œå‡ ä¹æ‰€æœ‰çš„ Vault ç»„ä»¶éƒ½è¢«ç»Ÿç§°ä¸ºã€Œå±éšœ(Barrier)ã€ï¼Œ Vault å¯ä»¥ç®€å•åœ°è¢«åˆ’åˆ†ä¸º Storage Backendã€Barrier å’Œ HTTP/S API ä¸‰ä¸ªéƒ¨åˆ†ã€‚ ç±»æ¯”é“¶è¡Œé‡‘åº“ï¼Œã€Œå±éšœã€å°±æ˜¯ Vault(é‡‘åº“) å‘¨å›´çš„ã€Œé’¢é“ã€å’Œã€Œæ··å‡åœŸã€ï¼ŒStorage Backend å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„æ‰€æœ‰æ•°æ®æµåŠ¨éƒ½éœ€è¦ç»è¿‡å®ƒã€‚ ã€Œå±éšœã€ç¡®ä¿åªæœ‰åŠ å¯†æ•°æ®ä¼šè¢«å†™å…¥ Storage Backendï¼ŒåŠ å¯†æ•°æ®åœ¨ç»è¿‡ã€Œå±éšœã€è¢«è¯»å‡ºçš„è¿‡ç¨‹ä¸­è¢«éªŒè¯ä¸è§£å¯†ã€‚ å’Œé“¶è¡Œé‡‘åº“çš„å¤§é—¨éå¸¸ç±»ä¼¼ï¼ŒBarrier ä¹Ÿå¿…é¡»å…ˆè§£å°ï¼Œæ‰èƒ½è§£å¯† Storage Backend ä¸­çš„æ•°æ®ã€‚ ","date":"2021-01-24","objectID":"/posts/expirence-of-vault/:1:0","tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/expirence-of-vault/"},{"categories":["æŠ€æœ¯"],"content":"1. æ•°æ®å­˜å‚¨åŠåŠ å¯†è§£å¯† Storage Backend(åç«¯å­˜å‚¨): Vault è‡ªèº«ä¸å­˜å‚¨æ•°æ®ï¼Œå› æ­¤éœ€è¦ä¸ºå®ƒé…ç½®ä¸€ä¸ªã€ŒStorage Backendã€ã€‚ ã€ŒStorage Backendã€æ˜¯ä¸å—ä¿¡ä»»çš„ï¼Œåªç”¨äºå­˜å‚¨åŠ å¯†æ•°æ®ã€‚ Initialization(åˆå§‹åŒ–): Vault åœ¨é¦–æ¬¡å¯åŠ¨æ—¶éœ€è¦åˆå§‹åŒ–ï¼Œè¿™ä¸€æ­¥ç”Ÿæˆä¸€ä¸ªã€ŒåŠ å¯†å¯†é’¥(Encryption Key)ã€ç”¨äºåŠ å¯†æ•°æ®ï¼ŒåŠ å¯†å®Œæˆçš„æ•°æ®æ‰èƒ½è¢«ä¿å­˜åˆ° Storage Backend. Unseal(è§£å°): Vault å¯åŠ¨åï¼Œå› ä¸ºä¸çŸ¥é“ã€ŒåŠ å¯†å¯†é’¥ã€ï¼Œå®ƒä¼šè¿›å…¥ã€Œå°å°(Sealed)ã€çŠ¶æ€ï¼Œåœ¨ã€Œè§£å°(Unseal)ã€å‰æ— æ³•è¿›è¡Œä»»ä½•æ“ä½œã€‚ ã€ŒåŠ å¯†å¯†é’¥ã€è¢«ã€Œmaster keyã€ä¿æŠ¤ï¼Œæˆ‘ä»¬å¿…é¡»æä¾›ã€Œmaster keyã€æ‰èƒ½å®Œæˆ Unseal æ“ä½œã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒVault ä½¿ç”¨æ²™ç±³å°”å¯†é’¥å…±äº«ç®—æ³• å°†ã€Œmaster keyã€åˆ†å‰²æˆäº”ä¸ªã€ŒKey Shares(åˆ†äº«å¯†é’¥)ã€ï¼Œå¿…é¡»è¦æä¾›å…¶ä¸­ä»»æ„ä¸‰ä¸ªã€ŒKey Sharesã€æ‰èƒ½é‡å»ºå‡ºã€Œmaster keyã€ä»è€Œå®Œæˆ Unseal. vault-shamir-secret-sharing\" vault-shamir-secret-sharing ã€ŒKey Sharesã€çš„æ•°é‡ï¼Œä»¥åŠé‡å»ºã€Œmaster keyã€æœ€å°‘éœ€è¦çš„ key shares æ•°é‡ï¼Œéƒ½æ˜¯å¯ä»¥è°ƒæ•´çš„ã€‚ æ²™ç±³å°”å¯†é’¥å…±äº«ç®—æ³•ä¹Ÿå¯ä»¥å…³é—­ï¼Œè¿™æ · master key å°†è¢«ç›´æ¥ç”¨äº Unseal. ","date":"2021-01-24","objectID":"/posts/expirence-of-vault/:1:1","tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/expirence-of-vault/"},{"categories":["æŠ€æœ¯"],"content":"2. è®¤è¯ç³»ç»ŸåŠæƒé™ç³»ç»Ÿ åœ¨è§£å°å®Œæˆåï¼ŒVault å°±å¯ä»¥å¼€å§‹å¤„ç†è¯·æ±‚äº†ã€‚ HTTP è¯·æ±‚è¿›å…¥åçš„æ•´ä¸ªå¤„ç†æµç¨‹éƒ½ç”± vault core ç®¡ç†ï¼Œcore ä¼šå¼ºåˆ¶è¿›è¡Œ ACL æ£€æŸ¥ï¼Œå¹¶ç¡®ä¿å®¡è®¡æ—¥å¿—(audit logging)å®Œæˆè®°å½•ã€‚ å®¢æˆ·ç«¯é¦–æ¬¡è¿æ¥ vault æ—¶ï¼Œéœ€è¦å…ˆå®Œæˆèº«ä»½è®¤è¯ï¼Œvault çš„ã€Œauth methodsã€æ¨¡å—æœ‰å¾ˆå¤šèº«ä»½è®¤è¯æ–¹æ³•å¯é€‰ï¼š ç”¨æˆ·å‹å¥½çš„è®¤è¯æ–¹æ³•ï¼Œé€‚åˆç®¡ç†å‘˜ä½¿ç”¨ï¼šusername/passwordã€äº‘æœåŠ¡å•†ã€ldap åœ¨åˆ›å»º user çš„æ—¶å€™ï¼Œéœ€è¦ä¸º user ç»‘å®š policyï¼Œç»™äºˆåˆé€‚çš„æƒé™ã€‚ åº”ç”¨å‹å¥½çš„æ–¹æ³•ï¼Œé€‚åˆåº”ç”¨ç¨‹åºä½¿ç”¨ï¼špublic/private keysã€tokensã€kubernetesã€jwt èº«ä»½éªŒè¯è¯·æ±‚æµç» Core å¹¶è¿›å…¥ auth methodsï¼Œauth methods ç¡®å®šè¯·æ±‚æ˜¯å¦æœ‰æ•ˆå¹¶è¿”å›ã€Œå…³è”ç­–ç•¥(policies)ã€çš„åˆ—è¡¨ã€‚ ACL Policies ç”± policy store è´Ÿè´£ç®¡ç†ä¸å­˜å‚¨ï¼Œç”± core è¿›è¡Œ ACL æ£€æŸ¥ã€‚ ACL çš„é»˜è®¤è¡Œä¸ºæ˜¯æ‹’ç»ï¼Œè¿™æ„å‘³ç€é™¤éæ˜ç¡®é…ç½® Policy å…è®¸æŸé¡¹æ“ä½œï¼Œå¦åˆ™è¯¥æ“ä½œå°†è¢«æ‹’ç»ã€‚ åœ¨é€šè¿‡ auth methods å®Œæˆäº†èº«ä»½è®¤è¯ï¼Œå¹¶ä¸”è¿”å›çš„ã€Œå…³è”ç­–ç•¥ã€ä¹Ÿæ²¡æ¯›ç—…ä¹‹åï¼Œã€Œtoken storeã€å°†ä¼šç”Ÿæˆå¹¶ç®¡ç†ä¸€ä¸ªæ–°çš„ tokenï¼Œ è¿™ä¸ª token ä¼šè¢«è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œç”¨äºè¿›è¡Œåç»­è¯·æ±‚ã€‚ ç±»ä¼¼ web ç½‘ç«™çš„ cookieï¼Œtoken ä¹Ÿéƒ½å­˜åœ¨ä¸€ä¸ª lease ç§ŸæœŸæˆ–è€…è¯´æœ‰æ•ˆæœŸï¼Œè¿™åŠ å¼ºäº†å®‰å…¨æ€§ã€‚ token å…³è”äº†ç›¸å…³çš„ç­–ç•¥ policiesï¼Œè¿™äº›ç­–ç•¥å°†è¢«ç”¨äºéªŒè¯è¯·æ±‚çš„æƒé™ã€‚ è¯·æ±‚ç»è¿‡éªŒè¯åï¼Œå°†è¢«è·¯ç”±åˆ° secret engineã€‚å¦‚æœ secret engine è¿”å›äº†ä¸€ä¸ª secretï¼ˆç”± vault è‡ªåŠ¨ç”Ÿæˆçš„ secretï¼‰ï¼Œ Core ä¼šå°†å…¶æ³¨å†Œåˆ° expiration managerï¼Œå¹¶ç»™å®ƒé™„åŠ ä¸€ä¸ª lease IDã€‚lease ID è¢«å®¢æˆ·ç«¯ç”¨äºæ›´æ–°(renew)æˆ–åŠé”€(revoke)å®ƒå¾—åˆ°çš„ secret. å¦‚æœå®¢æˆ·ç«¯å…è®¸ç§Ÿçº¦(lease)åˆ°æœŸï¼Œexpiration manager å°†è‡ªåŠ¨åŠé”€è¿™ä¸ª secret. Core è´Ÿè´£å¤„ç†å®¡æ ¸ä»£ç†(audit broker)çš„è¯·æ±‚åŠå“åº”æ—¥å¿—ï¼Œå°†è¯·æ±‚å‘é€åˆ°æ‰€æœ‰å·²é…ç½®çš„å®¡æ ¸è®¾å¤‡(audit devices)ã€‚ ","date":"2021-01-24","objectID":"/posts/expirence-of-vault/:1:2","tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/expirence-of-vault/"},{"categories":["æŠ€æœ¯"],"content":"3. Secret Engine Secret Engine æ˜¯ä¿å­˜ã€ç”Ÿæˆæˆ–è€…åŠ å¯†æ•°æ®çš„ç»„ä»¶ï¼Œå®ƒéå¸¸çµæ´»ã€‚ æœ‰çš„ Secret Engines åªæ˜¯å•çº¯åœ°å­˜å‚¨ä¸è¯»å–æ•°æ®ï¼Œæ¯”å¦‚ kv å°±å¯ä»¥çœ‹ä½œä¸€ä¸ªåŠ å¯†çš„ Redisã€‚ è€Œå…¶ä»–çš„ Secret Engines åˆ™è¿æ¥åˆ°å…¶ä»–çš„æœåŠ¡å¹¶æŒ‰éœ€ç”ŸæˆåŠ¨æ€å‡­è¯ã€‚ è¿˜æœ‰äº› Secret Engines æä¾›ã€ŒåŠ å¯†å³æœåŠ¡(encryption as a service)ã€çš„èƒ½åŠ›ï¼Œå¦‚ transitã€è¯ä¹¦ç®¡ç†ç­‰ã€‚ å¸¸ç”¨çš„ engine ä¸¾ä¾‹ï¼š AliCloud Secrets Engine: åŸºäº RAM ç­–ç•¥åŠ¨æ€ç”Ÿæˆ AliCloud Access Tokenï¼Œæˆ–åŸºäº RAM è§’è‰²åŠ¨æ€ç”Ÿæˆ AliCloud STS å‡­æ® Access Token ä¼šè‡ªåŠ¨æ›´æ–°(Renew)ï¼Œè€Œ STS å‡­æ®æ˜¯ä¸´æ—¶ä½¿ç”¨çš„ï¼Œè¿‡æœŸåå°±å¤±æ•ˆäº†ã€‚ kv: é”®å€¼å­˜å‚¨ï¼Œå¯ç”¨äºå­˜å‚¨ä¸€äº›é™æ€çš„é…ç½®ã€‚å®ƒä¸€å®šç¨‹åº¦ä¸Šèƒ½æ›¿ä»£æ‰æºç¨‹çš„ Apollo é…ç½®ä¸­å¿ƒã€‚ Transit Secrets Engine: æä¾›åŠ å¯†å³æœåŠ¡çš„åŠŸèƒ½ï¼Œå®ƒåªè´Ÿè´£åŠ å¯†å’Œè§£å¯†ï¼Œä¸è´Ÿè´£å­˜å‚¨ã€‚ä¸»è¦åº”ç”¨åœºæ™¯æ˜¯å¸® app åŠ è§£å¯†æ•°æ®ï¼Œä½†æ˜¯æ•°æ®ä»æ—§å­˜å‚¨åœ¨ MySQL ç­‰æ•°æ®åº“ä¸­ã€‚ ","date":"2021-01-24","objectID":"/posts/expirence-of-vault/:1:3","tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/expirence-of-vault/"},{"categories":["æŠ€æœ¯"],"content":"äºŒã€éƒ¨ç½² Vault å®˜æ–¹å»ºè®®é€šè¿‡ Helm éƒ¨ç½² vaultï¼Œå¤§æ¦‚æµç¨‹ï¼š ä½¿ç”¨ helm/docker éƒ¨ç½²è¿è¡Œ vault. åˆå§‹åŒ–/è§£å° vault: vault å®‰å…¨æªæ–½ï¼Œæ¯æ¬¡é‡å¯å¿…é¡»è§£å°(å¯è®¾ç½®è‡ªåŠ¨è§£å°). ","date":"2021-01-24","objectID":"/posts/expirence-of-vault/:2:0","tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/expirence-of-vault/"},{"categories":["æŠ€æœ¯"],"content":"0. å¦‚ä½•é€‰æ‹©å­˜å‚¨åç«¯ï¼Ÿ é¦–å…ˆï¼Œæˆ‘ä»¬è‚¯å®šéœ€è¦ HAï¼Œè‡³å°‘è¦ä¿ç•™èƒ½å‡çº§åˆ° HA çš„èƒ½åŠ›ï¼Œæ‰€ä»¥ä¸å»ºè®®é€‰æ‹©ä¸æ”¯æŒ HA çš„åç«¯ã€‚ è€Œå…·ä½“çš„é€‰æ‹©ï¼Œå°±å› å›¢é˜Ÿç»éªŒè€Œå¼‚äº†ï¼Œäººä»¬å¾€å¾€å€¾å‘äºä½¿ç”¨è‡ªå·±ç†Ÿæ‚‰çš„ã€çŸ¥æ ¹çŸ¥åº•çš„åç«¯ï¼Œæˆ–è€…é€‰ç”¨äº‘æœåŠ¡ã€‚ æ¯”å¦‚æˆ‘ä»¬å¯¹ MySQL/PostgreSQL æ¯”è¾ƒç†Ÿæ‚‰ï¼Œè€Œä¸”ä½¿ç”¨äº‘æœåŠ¡æä¾›çš„æ•°æ®åº“ä¸éœ€è¦è€ƒè™‘å¤ªå¤šçš„ç»´æŠ¤é—®é¢˜ï¼ŒMySQL ä½œä¸ºä¸€ä¸ªé€šç”¨åè®®ä¹Ÿä¸ä¼šè¢«äº‘å‚å•†ç»‘æ¶ï¼Œé‚£æˆ‘ä»¬å°±å€¾å‘äºä½¿ç”¨ MySQL/PostgreSQL. è€Œå¦‚æœä½ ä»¬æ˜¯æœ¬åœ°è‡ªå»ºï¼Œé‚£ä½ å¯èƒ½æ›´å€¾å‘äºä½¿ç”¨ Etcd/Consul/Raft åšåç«¯å­˜å‚¨ã€‚ ","date":"2021-01-24","objectID":"/posts/expirence-of-vault/:2:1","tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/expirence-of-vault/"},{"categories":["æŠ€æœ¯"],"content":"1. docker-compose éƒ¨ç½²ï¼ˆé HAï¼‰ æ¨èç”¨äºæœ¬åœ°å¼€å‘æµ‹è¯•ç¯å¢ƒï¼Œæˆ–è€…å…¶ä»–ä¸éœ€è¦é«˜å¯ç”¨çš„ç¯å¢ƒã€‚ docker-compose.yml ç¤ºä¾‹å¦‚ä¸‹ï¼š version:'3.3'services:vault:# æ–‡æ¡£ï¼šhttps://hub.docker.com/_/vaultimage:vault:1.6.0container_name:vaultports:# rootless å®¹å™¨ï¼Œå†…éƒ¨ä¸èƒ½ä½¿ç”¨æ ‡å‡†ç«¯å£ 443- \"443:8200\"restart:alwaysvolumes:# å®¡è®¡æ—¥å¿—å­˜å‚¨ç›®å½•ï¼Œé»˜è®¤ä¸å†™å®¡è®¡æ—¥å¿—ï¼Œå¯ç”¨ `file` audit backend æ—¶å¿…é¡»æä¾›ä¸€ä¸ªæ­¤æ–‡ä»¶å¤¹ä¸‹çš„è·¯å¾„- ./logs:/vault/logs# å½“ä½¿ç”¨ file data storage æ’ä»¶æ—¶ï¼Œæ•°æ®è¢«å­˜å‚¨åœ¨è¿™é‡Œã€‚é»˜è®¤ä¸å¾€è¿™å†™ä»»ä½•æ•°æ®ã€‚- ./file:/vault/file# é…ç½®ç›®å½•ï¼Œvault é»˜è®¤ `/valut/config/` ä¸­æ‰€æœ‰ä»¥ .hcl/.json ç»“å°¾çš„æ–‡ä»¶# config.hcl æ–‡ä»¶å†…å®¹ï¼Œå‚è€ƒ cutom-vaules.yaml- ./config.hcl:/vault/config/config.hcl# TLS è¯ä¹¦- ./certs:/certs# vault éœ€è¦é”å®šå†…å­˜ä»¥é˜²æ­¢æ•æ„Ÿå€¼ä¿¡æ¯è¢«äº¤æ¢(swapped)åˆ°ç£ç›˜ä¸­# ä¸ºæ­¤éœ€è¦æ·»åŠ å¦‚ä¸‹èƒ½åŠ›cap_add:- IPC_LOCK# å¿…é¡»æ‰‹åŠ¨è®¾ç½® entrypointï¼Œå¦åˆ™ vault å°†ä»¥ development æ¨¡å¼è¿è¡Œentrypoint:vault server -config /vault/config/config.hcl config.hcl å†…å®¹å¦‚ä¸‹ï¼š ui = true // ä½¿ç”¨æ–‡ä»¶åšæ•°æ®å­˜å‚¨ï¼ˆå•èŠ‚ç‚¹ï¼‰ storage \"file\" { path = \"/vault/file\" } listener \"tcp\" { address = \"[::]:8200\" tls_disable = false tls_cert_file = \"/certs/server.crt\" tls_key_file = \"/certs/server.key\" } å°†å¦‚ä¸Šä¸¤ä»½é…ç½®ä¿å­˜åœ¨åŒä¸€éæ–‡ä»¶å¤¹å†…ï¼ŒåŒæ—¶åœ¨ ./certs ä¸­æä¾› TLS è¯ä¹¦ server.crt å’Œç§é’¥ server.keyã€‚ ç„¶å docker-compose up -d å°±èƒ½å¯åŠ¨è¿è¡Œä¸€ä¸ª vault å®ä¾‹ã€‚ ","date":"2021-01-24","objectID":"/posts/expirence-of-vault/:2:2","tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/expirence-of-vault/"},{"categories":["æŠ€æœ¯"],"content":"2. é€šè¿‡ helm éƒ¨ç½²é«˜å¯ç”¨çš„ vault æ¨èç”¨äºç”Ÿäº§ç¯å¢ƒ é€šè¿‡ helm éƒ¨ç½²ï¼š # æ·»åŠ  valut ä»“åº“ helm repo add hashicorp https://helm.releases.hashicorp.com # æŸ¥çœ‹ vault ç‰ˆæœ¬å· helm search repo hashicorp/vault -l | head # ä¸‹è½½æŸä¸ªç‰ˆæœ¬å·çš„ vault helm pull hashicorp/vault --version 0.11.0 --untar å‚ç…§ä¸‹è½½ä¸‹æ¥çš„ ./vault/values.yaml ç¼–å†™ custom-values.yamlï¼Œ éƒ¨ç½²ä¸€ä¸ªä»¥ mysql ä¸ºåç«¯å­˜å‚¨çš„ HA vaultï¼Œé…ç½®ç¤ºä¾‹å¦‚ä¸‹: é…ç½®å†…å®¹è™½ç„¶å¤šï¼Œä½†æ˜¯å¤§éƒ½æ˜¯ç›´æ¥æ‹·è´è‡ª ./vault/values.yamlï¼Œæ”¹åŠ¨å¾ˆå°‘ã€‚ æµ‹è¯• Vault æ—¶å¯ä»¥å¿½ç•¥æ‰å…¶ä¸­å¤§å¤šæ•°çš„é…ç½®é¡¹ã€‚ global:# enabled is the master enabled switch. Setting this to true or false# will enable or disable all the components within this chart by default.enabled:true# TLS for end-to-end encrypted transporttlsDisable:falseinjector:# True if you want to enable vault agent injection.enabled:truereplicas:1# If true, will enable a node exporter metrics endpoint at /metrics.metrics:enabled:false# Mount Path of the Vault Kubernetes Auth Method.authPath:\"auth/kubernetes\"certs:# secretName is the name of the secret that has the TLS certificate and# private key to serve the injector webhook. If this is null, then the# injector will default to its automatic management mode that will assign# a service account to the injector to generate its own certificates.secretName:null# caBundle is a base64-encoded PEM-encoded certificate bundle for the# CA that signed the TLS certificate that the webhook serves. This must# be set if secretName is non-null.caBundle:\"\"# certName and keyName are the names of the files within the secret for# the TLS cert and private key, respectively. These have reasonable# defaults but can be customized if necessary.certName:tls.crtkeyName:tls.keyserver:# Resource requests, limits, etc. for the server cluster placement. This# should map directly to the value of the resources field for a PodSpec.# By default no direct resource request is made.# Enables a headless service to be used by the Vault Statefulsetservice:enabled:true# Port on which Vault server is listeningport:8200# Target port to which the service should be mapped totargetPort:8200# This configures the Vault Statefulset to create a PVC for audit# logs. Once Vault is deployed, initialized and unseal, Vault must# be configured to use this for audit logs. This will be mounted to# /vault/audit# See https://www.vaultproject.io/docs/audit/index.html to know moreauditStorage:enabled:false# Run Vault in \"HA\" mode. There are no storage requirements unless audit log# persistence is required. In HA mode Vault will configure itself to use Consul# for its storage backend. The default configuration provided will work the Consul# Helm project by default. It is possible to manually configure Vault to use a# different HA backend.ha:enabled:truereplicas:3# Set the api_addr configuration for Vault HA# See https://www.vaultproject.io/docs/configuration#api_addr# If set to null, this will be set to the Pod IP AddressapiAddr:null# config is a raw string of default configuration when using a Stateful# deployment. Default is to use a Consul for its HA storage backend.# This should be HCL.# Note: Configuration files are stored in ConfigMaps so sensitive data # such as passwords should be either mounted through extraSecretEnvironmentVars# or through a Kube secret. For more information see: # https://www.vaultproject.io/docs/platform/k8s/helm/run#protecting-sensitive-vault-configurationsconfig:|ui = true listener \"tcp\" { address = \"[::]:8200\" cluster_address = \"[::]:8201\" # æ³¨æ„ï¼Œè¿™ä¸ªå€¼è¦å’Œ helm çš„å‚æ•° global.tlsDisable ä¸€è‡´ tls_disable = false tls_cert_file = \"/etc/certs/vault.crt\" tls_key_file = \"/etc/certs/vault.key\" } # storage \"postgresql\" { # connection_url = \"postgres://username:password@\u003chost\u003e:5432/vault?sslmode=disable\" # ha_enabled = true # } service_registration \"kubernetes\" {} # Example configuration for using auto-unseal, using AWS KMS. # the cluster must have a service account that is authorized to access AWS KMS, throught an IAM Role. # seal \"awskms\" { # region = \"us-east-1\" # kms_key_id = \"\u003csome-key-id\u003e\" # é»˜è®¤æƒ…å†µä¸‹æ’ä»¶ä¼šä½¿ç”¨ awskms çš„å…¬ç½‘ enpointï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‚æ•°ï¼Œæ”¹ç”¨è‡ªè¡Œåˆ›å»ºçš„ vpc å†…ç½‘ endpoint # endpoint = \"https:/","date":"2021-01-24","objectID":"/posts/expirence-of-vault/:2:3","tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/expirence-of-vault/"},{"categories":["æŠ€æœ¯"],"content":"3. åˆå§‹åŒ–å¹¶è§£å° vault å®˜æ–¹æ–‡æ¡£ï¼šInitialize and unseal Vault - Vault on Kubernetes Deployment Guide é€šè¿‡ helm éƒ¨ç½² vaultï¼Œé»˜è®¤ä¼šéƒ¨ç½²ä¸€ä¸ªä¸‰å‰¯æœ¬çš„ StatefulSetï¼Œä½†æ˜¯è¿™ä¸‰ä¸ªå‰¯æœ¬éƒ½ä¼šå¤„äº NotReady çŠ¶æ€ï¼ˆdocker æ–¹å¼éƒ¨ç½²çš„ä¹Ÿä¸€æ ·ï¼‰ã€‚ æ¥ä¸‹æ¥è¿˜éœ€è¦æ‰‹åŠ¨åˆå§‹åŒ–å¹¶è§£å° vaultï¼Œæ‰èƒ½ Ready: ç¬¬ä¸€æ­¥ï¼šä»ä¸‰ä¸ªå‰¯æœ¬ä¸­éšä¾¿é€‰æ‹©ä¸€ä¸ªï¼Œè¿è¡Œ vault çš„åˆå§‹åŒ–å‘½ä»¤ï¼škubectl exec -ti vault-0 -- vault operator init åˆå§‹åŒ–æ“ä½œä¼šè¿”å› 5 ä¸ª unseal keysï¼Œä»¥åŠä¸€ä¸ª Initial Root Tokenï¼Œè¿™äº›æ•°æ®éå¸¸æ•æ„Ÿéå¸¸é‡è¦ï¼Œä¸€å®šè¦ä¿å­˜åˆ°å®‰å…¨çš„åœ°æ–¹ï¼ ç¬¬äºŒæ­¥ï¼šåœ¨æ¯ä¸ªå‰¯æœ¬ä¸Šï¼Œä½¿ç”¨ä»»æ„ä¸‰ä¸ª unseal keys è¿›è¡Œè§£å°æ“ä½œã€‚ ä¸€å…±æœ‰ä¸‰ä¸ªå‰¯æœ¬ï¼Œä¹Ÿå°±æ˜¯è¯´è¦è§£å° 3*3 æ¬¡ï¼Œæ‰èƒ½å®Œæˆ vault çš„å®Œæ•´è§£å°ï¼ # æ¯ä¸ªå®ä¾‹éƒ½éœ€è¦è§£å°ä¸‰æ¬¡ï¼ ## Unseal the first vault server until it reaches the key threshold $ kubectl exec -ti vault-0 -- vault operator unseal # ... Unseal Key 1 $ kubectl exec -ti vault-0 -- vault operator unseal # ... Unseal Key 2 $ kubectl exec -ti vault-0 -- vault operator unseal # ... Unseal Key 3 è¿™æ ·å°±å®Œæˆäº†éƒ¨ç½²ï¼Œä½†æ˜¯è¦æ³¨æ„ï¼Œvault å®ä¾‹æ¯æ¬¡é‡å¯åï¼Œéƒ½éœ€è¦é‡æ–°è§£å°ï¼ä¹Ÿå°±æ˜¯é‡æ–°è¿›è¡Œç¬¬äºŒæ­¥æ“ä½œï¼ ","date":"2021-01-24","objectID":"/posts/expirence-of-vault/:2:4","tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/expirence-of-vault/"},{"categories":["æŠ€æœ¯"],"content":"4. åˆå§‹åŒ–å¹¶è®¾ç½®è‡ªåŠ¨è§£å° åœ¨æœªè®¾ç½® auto unseal çš„æƒ…å†µä¸‹ï¼Œvault æ¯æ¬¡é‡å¯éƒ½è¦æ‰‹åŠ¨è§£å°æ‰€æœ‰ vault å®ä¾‹ï¼Œå®åœ¨æ˜¯å¾ˆéº»çƒ¦ï¼Œåœ¨äº‘ä¸Šè‡ªåŠ¨æ‰©ç¼©å®¹çš„æƒ…å†µä¸‹ï¼Œvault å®ä¾‹ä¼šè¢«è‡ªåŠ¨è°ƒåº¦ï¼Œè¿™ç§æƒ…å†µå°±æ›´éº»çƒ¦äº†ã€‚ ä¸ºäº†ç®€åŒ–è¿™ä¸ªæµç¨‹ï¼Œå¯ä»¥è€ƒè™‘é…ç½® auto unseal è®© vault è‡ªåŠ¨è§£å°ã€‚ è‡ªåŠ¨è§£å°ç›®å‰æœ‰ä¸¤ç§æ–¹æ³•ï¼š ä½¿ç”¨é˜¿é‡Œäº‘/AWS/Azure ç­‰äº‘æœåŠ¡æä¾›çš„å¯†é’¥åº“æ¥ç®¡ç† encryption key AWS: awskms Seal å¦‚æœæ˜¯ k8s é›†ç¾¤ï¼Œvault ä½¿ç”¨çš„ ServiceAccount éœ€è¦æœ‰æƒé™ä½¿ç”¨ AWS KMSï¼Œå®ƒå¯æ›¿ä»£æ‰ config.hcl ä¸­çš„ access_key/secret_key ä¸¤ä¸ªå±æ€§ é˜¿é‡Œäº‘ï¼šalicloudkms Seal å¦‚æœä½ ä¸æƒ³ç”¨äº‘æœåŠ¡ï¼Œé‚£å¯ä»¥è€ƒè™‘ autounseal-transitï¼Œè¿™ç§æ–¹æ³•ä½¿ç”¨å¦ä¸€ä¸ª vault å®ä¾‹æä¾›çš„ transit å¼•æ“æ¥å®ç° auto-unseal. ç®€å•ç²—æš´ï¼šç›´æ¥å†™ä¸ª crontab æˆ–è€…åœ¨ CI å¹³å°ä¸ŠåŠ ä¸ªå®šæ—¶ä»»åŠ¡å»æ‰§è¡Œè§£å°å‘½ä»¤ï¼Œä»¥å®ç°è‡ªåŠ¨è§£å°ã€‚ä¸è¿‡è¿™æ ·å®‰å…¨æ€§å°±ä¸å¥½è¯´äº†ã€‚ ä»¥ä½¿ç”¨ awskms ä¸ºä¾‹ï¼Œé¦–å…ˆåˆ›å»º aws IAM çš„ policy å†…å®¹å¦‚ä¸‹: { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Sid\": \"VaultKMSUnseal\", \"Effect\": \"Allow\", \"Action\": [ \"kms:Decrypt\", \"kms:Encrypt\", \"kms:DescribeKey\" ], \"Resource\": \"*\" } ] } ç„¶ååˆ›å»º IAM Role ç»‘å®šä¸Šé¢çš„ policyï¼Œå¹¶ä¸º vault çš„ k8s serviceaccount åˆ›å»ºä¸€ä¸ª IAM Roleï¼Œç»‘å®šä¸Šè¿™ä¸ª policy. è¿™æ · vault ä½¿ç”¨çš„ serviceaccount è‡ªèº«å°±æ‹¥æœ‰äº†è®¿é—® awskms çš„æƒé™ï¼Œä¹Ÿå°±ä¸éœ€è¦é¢å¤–é€šè¿‡ access_key/secret_key æ¥è®¿é—® awskms. å…³äº IAM Role å’Œ k8s serviceaccount å¦‚ä½•ç»‘å®šï¼Œå‚è§å®˜æ–¹æ–‡æ¡£ï¼šIAM roles for EKS service accounts å®Œäº‹åå†ä¿®æ”¹å¥½å‰é¢æä¾›çš„ helm é…ç½®ï¼Œéƒ¨ç½²å®ƒï¼Œæœ€åä½¿ç”¨å¦‚ä¸‹å‘½ä»¤åˆå§‹åŒ–ä¸€ä¸‹ï¼š # åˆå§‹åŒ–å‘½ä»¤å’Œæ™®é€šæ¨¡å¼å¹¶æ— ä¸åŒ kubectl exec -ti vault-0 -- vault operator init # ä¼šæ‰“å°å‡ºä¸€ä¸ª root tokenï¼Œä»¥åŠäº”ä¸ª Recovery Keyï¼ˆè€Œä¸æ˜¯ Unseal Keyï¼‰ # Recover Key ä¸å†ç”¨äºè§£å°ï¼Œä½†æ˜¯é‡æ–°ç”Ÿæˆ root token ç­‰æ“ä½œä»ç„¶ä¼šéœ€è¦ç”¨åˆ°å®ƒ. ç„¶åå°±å¤§åŠŸå‘Šæˆäº†ï¼Œå¯ä»¥å°è¯•ä¸‹åˆ é™¤ vault çš„ podï¼Œæ–°å»ºçš„ Pod åº”è¯¥ä¼šè‡ªåŠ¨è§£å°ã€‚ ","date":"2021-01-24","objectID":"/posts/expirence-of-vault/:2:5","tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/expirence-of-vault/"},{"categories":["æŠ€æœ¯"],"content":"ä¸‰ã€Vault è‡ªèº«çš„é…ç½®ç®¡ç† Vault æœ¬èº«æ˜¯ä¸€ä¸ªå¤æ‚çš„ secrets å·¥å…·ï¼Œå®ƒæä¾›äº† Web UI å’Œ CLI ç”¨äºæ‰‹åŠ¨ç®¡ç†ä¸æŸ¥çœ‹ Vault çš„å†…å®¹ã€‚ ä½†æ˜¯ä½œä¸ºä¸€å DevOpsï¼Œæˆ‘ä»¬å½“ç„¶æ›´å–œæ¬¢è‡ªåŠ¨åŒ–çš„æ–¹æ³•ï¼Œè¿™æœ‰ä¸¤ç§é€‰æ‹©: ä½¿ç”¨ vault çš„ sdk: python-hvac ä½¿ç”¨ terraform-provider-vault æˆ–è€… pulumi-vault å®ç° vault é…ç½®çš„è‡ªåŠ¨åŒ–ç®¡ç†ã€‚ Web UI é€‚åˆæ‰‹å·¥æ“ä½œï¼Œè€Œ sdk/terraform-provider-vault åˆ™é€‚åˆç”¨äºè‡ªåŠ¨åŒ–ç®¡ç† vault. æˆ‘ä»¬çš„æµ‹è¯•ç¯å¢ƒå°±æ˜¯ä½¿ç”¨ pulumi-vault å®Œæˆçš„è‡ªåŠ¨åŒ–é…ç½® vault policy å’Œ kubernetes roleï¼Œç„¶åè‡ªåŠ¨åŒ–æ³¨å…¥æ‰€æœ‰æµ‹è¯•ç”¨çš„ secrets. ","date":"2021-01-24","objectID":"/posts/expirence-of-vault/:3:0","tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/expirence-of-vault/"},{"categories":["æŠ€æœ¯"],"content":"1. ä½¿ç”¨ pulumi è‡ªåŠ¨åŒ–é…ç½® vault ä½¿ç”¨ pulumi ç®¡ç† vault é…ç½®çš„ä¼˜åŠ¿æ˜¯å¾ˆå¤§çš„ï¼Œå› ä¸ºäº‘ä¸Šèµ„æºçš„æ•æ„Ÿä¿¡æ¯ï¼ˆæ•°æ®åº“è´¦å·å¯†ç ã€èµ„æº IDã€RAMå­è´¦å·ï¼‰éƒ½æ˜¯ pulumi åˆ›å»ºçš„ã€‚ å†ç»“åˆä½¿ç”¨ pulumi_valutï¼Œå°±èƒ½å®ç°æ•æ„Ÿä¿¡æ¯è‡ªåŠ¨ç”Ÿæˆåï¼Œç«‹å³ä¿å­˜åˆ° vault ä¸­ï¼Œå®ç°å®Œå…¨è‡ªåŠ¨åŒ–ã€‚ åç»­å¾®æœåŠ¡å°±å¯ä»¥é€šè¿‡ kubernetes è®¤è¯ï¼Œç›´æ¥ä» vault è¯»å–æ•æ„Ÿä¿¡æ¯ã€‚ æˆ–è€…æ˜¯å†™å…¥åˆ°æœ¬åœ°çš„ vault ä¸­ç•™åšå¤‡ä»½ï¼Œåœ¨éœ€è¦çš„æ—¶å€™ï¼Œç®¡ç†å‘˜èƒ½ç™»å…¥è¿›å»æŸ¥çœ‹ç›¸å…³æ•æ„Ÿä¿¡æ¯ã€‚ 1.1 Token çš„ç”Ÿæˆ pulumi_vault æœ¬èº«æŒºç®€å•çš„ï¼Œå£°æ˜å¼çš„é…ç½®å˜›ï¼Œç›´æ¥ç”¨å°±æ˜¯äº†ã€‚ ä½†æ˜¯å®ƒä¸€å®šè¦æ±‚æä¾› VAULT_TOKEN ä½œä¸ºèº«ä»½è®¤è¯çš„å‡­è¯ï¼ˆå®æµ‹ userpass/approle éƒ½ä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œä¼šæŠ¥é”™ no vault token foundï¼‰ï¼Œè€Œä¸” pulumi è¿˜ä¼šå…ˆç”Ÿæˆä¸´æ—¶ç”¨çš„ child tokenï¼Œç„¶åç”¨è¿™ä¸ª child token è¿›è¡Œåç»­çš„æ“ä½œã€‚ é¦–å…ˆå®‰å…¨èµ·è§ï¼Œè‚¯å®šä¸åº”è¯¥ç›´æ¥æä¾› root tokenï¼root token åº”è¯¥å°å­˜ï¼Œé™¤äº†ç´§æ€¥æƒ…å†µä¸åº”è¯¥å¯ç”¨ã€‚ é‚£ä¹ˆåº”è¯¥å¦‚ä½•ç”Ÿæˆä¸€ä¸ªæƒé™æœ‰é™çš„ token ç»™ vault ä½¿ç”¨å‘¢ï¼Ÿ æˆ‘çš„æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ª userpass è´¦å·ï¼Œé€šè¿‡ policy ç»™äºˆå®ƒæœ‰é™çš„æƒé™ã€‚ ç„¶åå…ˆæ‰‹åŠ¨(æˆ–è€…è‡ªåŠ¨)ç™»å½•è·å–åˆ° tokenï¼Œå†å°† token æä¾›ç»™ pulumi_vault ä½¿ç”¨ã€‚ è¿™é‡Œé¢æœ‰ä¸ªå‘ï¼Œå°±æ˜¯å¿…é¡»ç»™ userpass è´¦å·åˆ›å»º child token çš„æƒé™ï¼š path \"local/*\" { capabilities = [\"read\", \"list\"] } // å…è®¸åˆ›å»º child token path \"auth/token/create\" { capabilities = [\"create\", \"read\", \"update\", \"delete\", \"list\"] } ä¸ç»™è¿™ä¸ªæƒé™ï¼Œpulumi_vault å°±ä¼šä¸€ç›´æŠ¥é”™ã€‚ã€‚ ç„¶åè¿˜å¾—ç»™å®ƒã€Œè‡ªåŠ¨åŒ–é…ç½®ã€éœ€è¦çš„æƒé™ï¼Œæ¯”å¦‚è‡ªåŠ¨åˆ›å»º/æ›´æ–° policy/secrets/kubernetes ç­‰ç­‰ï¼Œç¤ºä¾‹å¦‚ä¸‹: # To list policies - Step 3 path \"sys/policy\" { capabilities = [\"read\"] }# Create and manage ACL policies broadly across Vault path \"sys/policy/*\" { capabilities = [\"create\", \"read\", \"update\", \"delete\", \"list\", \"sudo\"] }# List, create, update, and delete key/value secrets path \"secret/*\" { capabilities = [\"create\", \"read\", \"update\", \"delete\", \"list\", \"sudo\"] } path \"auth/kubernetes/role/*\" { capabilities = [\"create\", \"read\", \"update\", \"list\"] } ","date":"2021-01-24","objectID":"/posts/expirence-of-vault/:3:1","tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/expirence-of-vault/"},{"categories":["æŠ€æœ¯"],"content":"å››ã€åœ¨ Kubernetes ä¸­ä½¿ç”¨ vault æ³¨å…¥ secrets vault-k8s-auth-workflow\" vault-k8s-auth-workflow å‰é¢æåˆ°è¿‡ vault æ”¯æŒé€šè¿‡ Kubernetes çš„ ServiceAccount ä¸ºæ¯ä¸ª Pod å•ç‹¬åˆ†é…æƒé™ã€‚ åº”ç”¨ç¨‹åºæœ‰ä¸¤ç§æ–¹å¼å»è¯»å– vault ä¸­çš„é…ç½®ï¼š å€ŸåŠ© Vault Sidecarï¼Œå°† secrets ä»¥æ–‡ä»¶çš„å½¢å¼è‡ªåŠ¨æ³¨å…¥åˆ° Pod ä¸­ï¼Œæ¯”å¦‚ /vault/secrets/config.json vault sidecar åœ¨å¸¸é©»æ¨¡å¼ä¸‹æ¯ 15 ç§’æ›´æ–°ä¸€æ¬¡é…ç½®ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨ watchdog å®æ—¶ç›‘æ§ secrets æ–‡ä»¶çš„å˜æ›´ã€‚ åº”ç”¨ç¨‹åºè‡ªå·±ä½¿ç”¨ SDK ç›´æ¥è®¿é—® vault api è·å– secrets ä¸Šè¿°ä¸¤ç§æ–¹å¼ï¼Œéƒ½å¯ä»¥å€ŸåŠ© Kubernetes ServiceAccount è¿›è¡Œèº«ä»½éªŒè¯å’Œæƒé™åˆ†é…ã€‚ ä¸‹é¢ä»¥ Sidecar æ¨¡å¼ä¸ºä¾‹ï¼Œä»‹ç»å¦‚ä½•å°† secrets ä»¥æ–‡ä»¶å½¢å¼æ³¨å…¥åˆ° Pod ä¸­ã€‚ ","date":"2021-01-24","objectID":"/posts/expirence-of-vault/:4:0","tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/expirence-of-vault/"},{"categories":["æŠ€æœ¯"],"content":"1. éƒ¨ç½²å¹¶é…ç½® vault agent é¦–å…ˆå¯ç”¨ Vault çš„ Kubernetes èº«ä»½éªŒè¯: # é…ç½®èº«ä»½è®¤è¯éœ€è¦åœ¨ vault pod ä¸­æ‰§è¡Œï¼Œå¯åŠ¨ vault-0 çš„äº¤äº’å¼ä¼šè¯ kubectl exec -n vault -it vault-0 -- /bin/sh export VAULT_TOKEN='\u003cyour-root-token\u003e' export VAULT_ADDR='http://localhost:8200' # å¯ç”¨ Kubernetes èº«ä»½éªŒè¯ vault auth enable kubernetes # kube-apiserver API é…ç½®ï¼Œvault éœ€è¦é€šè¿‡ kube-apiserver å®Œæˆå¯¹ serviceAccount çš„èº«ä»½éªŒè¯ vault write auth/kubernetes/config \\ token_reviewer_jwt=\"$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\" \\ kubernetes_host=\"https://$KUBERNETES_PORT_443_TCP_ADDR:443\" \\ kubernetes_ca_cert=@/var/run/secrets/kubernetes.io/serviceaccount/ca.crt 1.1 ä½¿ç”¨é›†ç¾¤å¤–éƒ¨çš„ valut å®ä¾‹ å¦‚æœä½ æ²¡è¿™ä¸ªéœ€æ±‚ï¼Œè¯·è·³è¿‡è¿™ä¸€èŠ‚ã€‚ è¯¦è§ Install the Vault Helm chart configured to address an external Vault kubernetes ä¹Ÿå¯ä»¥å’Œå¤–éƒ¨çš„ vault å®ä¾‹é›†æˆï¼Œé›†ç¾¤ä¸­åªéƒ¨ç½² vault-agent. è¿™é€‚ç”¨äºå¤šä¸ª kubernetes é›†ç¾¤ä»¥åŠå…¶ä»– APP å…±ç”¨ä¸€ä¸ª vault å®ä¾‹çš„æƒ…å†µï¼Œæ¯”å¦‚æˆ‘ä»¬æœ¬åœ°çš„å¤šä¸ªå¼€å‘æµ‹è¯•é›†ç¾¤ï¼Œå°±éƒ½å…±ç”¨ç€åŒä¸€ä¸ª vault å®ä¾‹ï¼Œæ–¹ä¾¿ç»Ÿä¸€ç®¡ç†åº”ç”¨çš„ secrets. é¦–å…ˆï¼Œä½¿ç”¨ helm chart éƒ¨ç½² vault-agentï¼Œæ¥å…¥å¤–éƒ¨çš„ vault å®ä¾‹ã€‚ä½¿ç”¨çš„ custom-values.yaml ç¤ºä¾‹å¦‚ä¸‹ï¼š global:# enabled is the master enabled switch. Setting this to true or false# will enable or disable all the components within this chart by default.enabled:true# TLS for end-to-end encrypted transporttlsDisable:falseinjector:# True if you want to enable vault agent injection.enabled:truereplicas:1# If multiple replicas are specified, by default a leader-elector side-car# will be created so that only one injector attempts to create TLS certificates.leaderElector:enabled:trueimage:repository:\"gcr.io/google_containers/leader-elector\"tag:\"0.4\"ttl:60s# If true, will enable a node exporter metrics endpoint at /metrics.metrics:enabled:false# External vault server address for the injector to use. Setting this will# disable deployment of a vault server along with the injector.# TODO è¿™é‡Œçš„ https ca.crt è¦æ€ä¹ˆè®¾ç½®ï¼ŸmTLS åˆè¯¥å¦‚ä½•é…ç½®ï¼ŸexternalVaultAddr:\"https://\u003cexternal-vault-url\u003e\"# Mount Path of the Vault Kubernetes Auth Method.authPath:\"auth/kubernetes\"certs:# secretName is the name of the secret that has the TLS certificate and# private key to serve the injector webhook. If this is null, then the# injector will default to its automatic management mode that will assign# a service account to the injector to generate its own certificates.secretName:null# caBundle is a base64-encoded PEM-encoded certificate bundle for the# CA that signed the TLS certificate that the webhook serves. This must# be set if secretName is non-null.caBundle:\"\"# certName and keyName are the names of the files within the secret for# the TLS cert and private key, respectively. These have reasonable# defaults but can be customized if necessary.certName:tls.crtkeyName:tls.key éƒ¨ç½²å‘½ä»¤å’Œ é€šè¿‡ helm éƒ¨ç½² vault ä¸€è‡´ï¼Œåªè¦æ›´æ¢ custom-values.yaml å°±è¡Œã€‚ vault-agent éƒ¨ç½²å®Œæˆåï¼Œç¬¬äºŒæ­¥æ˜¯ä¸º vault åˆ›å»º serviceAccountã€secret å’Œ ClusterRoleBindingï¼Œä»¥å…è®¸ vault å®¡æŸ¥ kubernetes çš„ token, å®Œæˆå¯¹ pod çš„èº«ä»½éªŒè¯. yaml é…ç½®å¦‚ä¸‹ï¼š ---apiVersion:v1kind:ServiceAccountmetadata:name:vault-authnamespace:vault---apiVersion:v1kind:Secretmetadata:name:vault-authnamespace:vaultannotations:kubernetes.io/service-account.name:vault-authtype:kubernetes.io/service-account-token---apiVersion:rbac.authorization.k8s.io/v1beta1kind:ClusterRoleBindingmetadata:name:role-tokenreview-bindingroleRef:apiGroup:rbac.authorization.k8s.iokind:ClusterRolename:system:auth-delegatorsubjects:- kind:ServiceAccountname:vault-authnamespace:vault ç°åœ¨åœ¨ vault å®ä¾‹è¿™è¾¹ï¼Œå¯ç”¨ kubernetes èº«ä»½éªŒè¯ï¼Œåœ¨ vault å®ä¾‹å†…ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š vault å®ä¾‹å†…æ˜¾ç„¶æ²¡æœ‰ kubectl å’Œ kubeconfigï¼Œç®€ä¾¿èµ·è§ï¼Œä¸‹åˆ—çš„ vault å‘½ä»¤ä¹Ÿå¯ä»¥é€šè¿‡ Web UI å®Œæˆã€‚ export VAULT_TOKEN='\u003cyour-root-token\u003e' export VAULT_ADDR='http://localhost:8200' # å¯ç”¨ Kubernetes èº«ä»½éªŒè¯ vault auth enable kubernetes # kube-apiserver API é…ç½®ï¼Œvault éœ€è¦é€šè¿‡ kube-apiserver å®Œæˆå¯¹ serviceAccount çš„èº«ä»½éªŒè¯ # TOKEN_REVIEW_JWT: å°±æ˜¯æˆ‘ä»¬å‰é¢åˆ›å»ºçš„ secret `vault-auth` TOKEN_REVIEW_JWT=$(kubectl -n vault get secret vault-auth -o go-template='{{ .data.token }}' | base64 --decode) # kube-apiserver çš„ ca è¯ä¹¦ KUBE_CA_CERT=$(kubectl -n vault config view --raw --minify --flatten -o jsonpath='{.clusters[].cluster.certificate-authority-data}' | base64 --decode) # kube-apiserver çš„ url KUBE_HOST=$(kubectl config view --raw --minify","date":"2021-01-24","objectID":"/posts/expirence-of-vault/:4:1","tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/expirence-of-vault/"},{"categories":["æŠ€æœ¯"],"content":"2. å…³è” k8s rbac æƒé™ç³»ç»Ÿå’Œ vault æ¥ä¸‹æ¥éœ€è¦åšçš„äº‹ï¼š é€šè¿‡ vault policy å®šä¹‰å¥½æ¯ä¸ª roleï¼ˆå¾®æœåŠ¡ï¼‰èƒ½è®¿é—®å“ªäº›èµ„æºã€‚ ä¸ºæ¯ä¸ªå¾®æœåŠ¡ç”Ÿæˆä¸€ä¸ª roleï¼Œè¿™ä¸ª role éœ€è¦ç»‘å®šå¯¹åº”çš„ vault policy åŠ kubernetes serviceaccount è¿™ä¸ª role æ˜¯ vault çš„ kubernetes æ’ä»¶è‡ªèº«çš„å±æ€§ï¼Œå®ƒå’Œ kubernetes role æ²¡æœ‰åŠæ¯›é’±å…³ç³»ã€‚ åˆ›å»ºä¸€ä¸ª ServiceAccountï¼Œå¹¶ä½¿ç”¨è¿™ä¸ª ä½¿ç”¨è¿™ä¸ª ServiceAccount éƒ¨ç½²å¾®æœåŠ¡ å…¶ä¸­ç¬¬ä¸€æ­¥å’Œç¬¬äºŒæ­¥éƒ½å¯ä»¥é€šè¿‡ vault api è‡ªåŠ¨åŒ–å®Œæˆ. ç¬¬ä¸‰æ­¥å¯ä»¥é€šè¿‡ kubectl éƒ¨ç½²æ—¶å®Œæˆã€‚ æ–¹ä¾¿èµ·è§ï¼Œvault policy / role / k8s serviceaccount è¿™ä¸‰ä¸ªé…ç½®ï¼Œéƒ½å»ºè®®å’Œå¾®æœåŠ¡ä½¿ç”¨ç›¸åŒçš„åç§°ã€‚ ä¸Šè¿°é…ç½®ä¸­ï¼Œrole èµ·åˆ°ä¸€ä¸ªæ‰¿ä¸Šå¯ä¸‹çš„ä½œç”¨ï¼Œå®ƒå…³è”äº† k8s serviceaccount å’Œ vault policy ä¸¤ä¸ªé…ç½®ã€‚ æ¯”å¦‚åˆ›å»ºä¸€ä¸ªåä¸º my-app-policy çš„ vault policyï¼Œå†…å®¹ä¸º: # å…è®¸è¯»å–æ•°æ® path \"my-app/data/*\" { capabilities = [\"read\", \"list\"] } // å…è®¸åˆ—å‡º myapp ä¸­çš„æ‰€æœ‰æ•°æ®(kv v2) path \"myapp/metadata/*\" { capabilities = [\"read\", \"list\"] } ç„¶ååœ¨ vault çš„ kuberntes æ’ä»¶é…ç½®ä¸­ï¼Œåˆ›å»º role my-app-roleï¼Œé…ç½®å¦‚ä¸‹: å…³è” k8s default åå­—ç©ºé—´ä¸­çš„ serviceaccount my-app-accountï¼Œå¹¶åˆ›å»ºå¥½è¿™ä¸ª serviceaccount. å…³è” vault token policyï¼Œè¿™å°±æ˜¯å‰é¢åˆ›å»ºçš„ my-app-policy è®¾ç½® token periodï¼ˆæœ‰æ•ˆæœŸï¼‰ è¿™ä¹‹åï¼Œæ¯ä¸ªå¾®æœåŠ¡å°±èƒ½é€šè¿‡ serviceaccount ä» vault ä¸­è¯»å– my-app ä¸­çš„æ‰€æœ‰ä¿¡æ¯äº†ã€‚ ","date":"2021-01-24","objectID":"/posts/expirence-of-vault/:4:2","tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/expirence-of-vault/"},{"categories":["æŠ€æœ¯"],"content":"3. éƒ¨ç½² Pod å‚è€ƒæ–‡æ¡£ï¼šhttps://www.vaultproject.io/docs/platform/k8s/injector ä¸‹ä¸€æ­¥å°±æ˜¯å°†é…ç½®æ³¨å…¥åˆ°å¾®æœåŠ¡å®¹å™¨ä¸­ï¼Œè¿™éœ€è¦ä½¿ç”¨åˆ° Agent Sidecar Injectorã€‚ vault é€šè¿‡ sidecar å®ç°é…ç½®çš„è‡ªåŠ¨æ³¨å…¥ä¸åŠ¨æ€æ›´æ–°ã€‚ å…·ä½“è€Œè¨€å°±æ˜¯åœ¨ Pod ä¸ŠåŠ ä¸Šä¸€å † Agent Sidecar Injector çš„æ³¨è§£ï¼Œå¦‚æœé…ç½®æ¯”è¾ƒå¤šï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ configmap ä¿å­˜ï¼Œåœ¨æ³¨è§£ä¸­å¼•ç”¨ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ vault-inject-agent æœ‰ä¸¤ç§è¿è¡Œæ¨¡å¼ï¼š init æ¨¡å¼: ä»…åœ¨ Pod å¯åŠ¨å‰åˆå§‹åŒ–ä¸€æ¬¡ï¼Œè·‘å®Œå°±é€€å‡ºï¼ˆCompletedï¼‰ å¸¸é©»æ¨¡å¼: å®¹å™¨ä¸é€€å‡ºï¼ŒæŒç»­ç›‘æ§ vault çš„é…ç½®æ›´æ–°ï¼Œç»´æŒ Pod é…ç½®å’Œ vualt é…ç½®çš„åŒæ­¥ã€‚ ç¤ºä¾‹ï¼š apiVersion:apps/v1kind:Deploymentmetadata:labels:app:my-appname:my-appnamespace:defaultspec:minReadySeconds:3progressDeadlineSeconds:60revisionHistoryLimit:3selector:matchLabels:app:my-appstrategy:rollingUpdate:maxUnavailable:1type:RollingUpdatetemplate:metadata:annotations:vault.hashicorp.com/agent-init-first:'true'# æ˜¯å¦ä½¿ç”¨ initContainer æå‰åˆå§‹åŒ–é…ç½®æ–‡ä»¶vault.hashicorp.com/agent-inject:'true'vault.hashicorp.com/secret-volume-path:vaultvault.hashicorp.com/role:\"my-app-role\"# vault kubernetes æ’ä»¶çš„ role åç§°vault.hashicorp.com/agent-inject-template-config.json:|# æ¸²æŸ“æ¨¡æ¿çš„è¯­æ³•åœ¨åé¢ä»‹ç»vault.hashicorp.com/agent-limits-cpu:250mvault.hashicorp.com/agent-requests-cpu:100m# åŒ…å« vault é…ç½®çš„ configmapï¼Œå¯ä»¥åšæ›´ç²¾ç»†çš„æ§åˆ¶# vault.hashicorp.com/agent-configmap: my-app-vault-configlabels:app:my-appspec:containers:- image:registry.svc.local/xx/my-app:latestimagePullPolicy:IfNotPresent# æ­¤å¤„çœç•¥è‹¥å¹²é…ç½®...serviceAccountName:my-app-account å¸¸è§é”™è¯¯ï¼š vault-agent(sidecar) æŠ¥é”™: namespace not authorized auth/kubernetes/config ä¸­çš„ role æ²¡æœ‰ç»‘å®š Pod çš„ namespace vault-agent(sidecar) æŠ¥é”™: permission denied æ£€æŸ¥ vault å®ä¾‹çš„æ—¥å¿—ï¼Œåº”è¯¥æœ‰å¯¹åº”çš„é”™è¯¯æ—¥å¿—ï¼Œå¾ˆå¯èƒ½æ˜¯ auth/kubernetes/config æ²¡é…å¯¹ï¼Œvault æ— æ³•éªŒè¯ kube-apiserver çš„ tls è¯ä¹¦ï¼Œæˆ–è€…ä½¿ç”¨çš„ kubernetes token æ²¡æœ‰æƒé™ã€‚ vault-agent(sidecar) æŠ¥é”™: service account not authorized auth/kubernetes/config ä¸­çš„ role æ²¡æœ‰ç»‘å®š Pod ä½¿ç”¨çš„ serviceAccount ","date":"2021-01-24","objectID":"/posts/expirence-of-vault/:4:3","tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/expirence-of-vault/"},{"categories":["æŠ€æœ¯"],"content":"4. vault agent é…ç½® vault-agent çš„é…ç½®ï¼Œéœ€è¦æ³¨æ„çš„æœ‰ï¼š å¦‚æœä½¿ç”¨ configmap æä¾›å®Œæ•´çš„ config.hcl é…ç½®ï¼Œæ³¨æ„ agent-init vautl-agent çš„ template è¯´æ˜ï¼š ç›®å‰æ¥è¯´æœ€æµè¡Œçš„é…ç½®æ–‡ä»¶æ ¼å¼åº”è¯¥æ˜¯ json/yamlï¼Œä»¥ json ä¸ºä¾‹ï¼Œ å¯¹æ¯ä¸ªå¾®æœåŠ¡çš„ kv æ•°æ®ï¼Œå¯ä»¥è€ƒè™‘å°†å®ƒæ‰€æœ‰çš„ä¸ªæ€§åŒ–é…ç½®éƒ½ä¿å­˜åœ¨ \u003cengine-name\u003e/\u003cservice-name\u003e/ ä¸‹é¢ï¼Œç„¶åä½¿ç”¨å¦‚ä¸‹ template æ³¨å…¥é…ç½®ï¼š { {{ range secrets \"\u003cengine-name\u003e/metadata/\u003cservice-name\u003e/\" }} \"{{ printf \"%s\" . }}\": {{ with secret (printf \"\u003cengine-name\u003e/\u003cservice-name\u003e/%s\" .) }} {{ .Data.data | toJSONPretty }}, {{ end }} {{ end }} } template çš„è¯¦ç»†è¯­æ³•å‚è§: https://github.com/hashicorp/consul-template#secret æ³¨æ„ï¼šv2 ç‰ˆæœ¬çš„ kv secretsï¼Œå®ƒçš„ list æ¥å£æœ‰å˜æ›´ï¼Œå› æ­¤åœ¨éå† v2 kv secrets æ—¶ï¼Œ å¿…é¡»è¦å†™æˆ range secrets \"\u003cengine-name\u003e/metadata/\u003cservice-name\u003e/\"ï¼Œä¹Ÿå°±æ˜¯ä¸­é—´è¦æ’å…¥ metadataï¼Œè€Œä¸” policy ä¸­å¿…é¡»å¼€æ”¾ \u003cengine-name\u003e/metadata/\u003cservice-name\u003e/ çš„ read/list æƒé™ï¼ å®˜æ–¹æ–‡æ¡£å®Œå…¨æ²¡æåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘é€šè¿‡ wireshark æŠ“åŒ…è°ƒè¯•ï¼Œå¯¹ç…§å®˜æ–¹çš„ KV Secrets Engine - Version 2 (API) æ‰ææ˜ç™½è¿™ä¸ªã€‚ è¿™æ ·ç”Ÿæˆå‡ºæ¥çš„å†…å®¹å°†æ˜¯ json æ ¼å¼ï¼Œä¸è¿‡æœ‰ä¸ªä¸å…¼å®¹çš„åœ°æ–¹ï¼šæœ€åä¸€ä¸ª secrets çš„æœ«å°¾æœ‰é€—å· , æ¸²æŸ“å‡ºçš„æ•ˆæœç¤ºä¾‹ï¼š { \"secret-a\": { \"a\": \"b\", \"c\": \"d\" }, \"secret-b\": { \"v\": \"g\", \"r\": \"c\" }, } å› ä¸ºå­˜åœ¨å°¾éƒ¨é€—å·(trailing comma)ï¼Œç›´æ¥ä½¿ç”¨ json æ ‡å‡†åº“è§£æå®ƒä¼šæŠ¥é”™ã€‚ é‚£è¯¥å¦‚ä½•å»è§£æå®ƒå‘¢ï¼Ÿæˆ‘åœ¨ä¸‡èƒ½çš„ stackoverflow ä¸Šæ‰¾åˆ°äº†è§£å†³æ–¹æ¡ˆï¼šyaml å®Œå…¨å…¼å®¹ json è¯­æ³•ï¼Œå¹¶ä¸”æ”¯æŒå°¾éƒ¨é€—å·ï¼ ä»¥ python ä¸ºä¾‹ï¼Œç›´æ¥ yaml.safe_load() å°±èƒ½å®Œç¾è§£æ vault ç”Ÿæˆå‡ºçš„ json å†…å®¹ã€‚ ","date":"2021-01-24","objectID":"/posts/expirence-of-vault/:4:4","tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/expirence-of-vault/"},{"categories":["æŠ€æœ¯"],"content":"5. æ‹“å±•ï¼šåœ¨ kubernetes ä¸­ä½¿ç”¨ vault çš„å…¶ä»–å§¿åŠ¿ é™¤äº†ä½¿ç”¨å®˜æ–¹æä¾›çš„ sidecar æ¨¡å¼è¿›è¡Œ secrets æ³¨å…¥ï¼Œç¤¾åŒºä¹Ÿæä¾›äº†ä¸€äº›åˆ«çš„æ–¹æ¡ˆï¼Œå¯ä»¥å‚è€ƒï¼š hashicorp/vault-csi-provider: å®˜æ–¹çš„ Beta é¡¹ç›®ï¼Œé€šè¿‡ Secrets Store CSI é©±åŠ¨å°† vault secrets ä»¥æ•°æ®å·çš„å½¢å¼æŒ‚è½½åˆ° pod ä¸­ kubernetes-external-secrets: æä¾› CRD å®šä¹‰ï¼Œæ ¹æ®å®šä¹‰å°† secret ä» vault ä¸­åŒæ­¥åˆ° kubernetes secrets å®˜æ–¹çš„ sidecar/init-container æ¨¡å¼ä»ç„¶æ˜¯æœ€æ¨èä½¿ç”¨çš„ã€‚ ","date":"2021-01-24","objectID":"/posts/expirence-of-vault/:4:5","tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/expirence-of-vault/"},{"categories":["æŠ€æœ¯"],"content":"äº”ã€ä½¿ç”¨ vault å®ç° AWS IAM Credentials çš„è‡ªåŠ¨è½®è½¬ å¾…ç»­ã€‚ã€‚ã€‚ ","date":"2021-01-24","objectID":"/posts/expirence-of-vault/:5:0","tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/expirence-of-vault/"},{"categories":["æŠ€æœ¯"],"content":" ä¸ªäººç¬”è®°ï¼Œå¹¶éæ•™ç¨‹ï¼åªé€‚åˆå½“æˆå‚è€ƒæ‰‹å†Œï¼ŒæŒ‰ç›®å½•é€‰è¯»ã€‚ å¦‚æœå¸Œæœ›æ·±å…¥å­¦ä¹ ï¼Œå»ºè®®é˜…è¯» Practical Cryptography for Developers ","date":"2021-01-17","objectID":"/posts/about-tls-cert/:0:0","tags":["HTTPS","TLS","OpenSSL","åŠ å¯†","ç ´è§£"],"title":"TLS åè®®ã€TLS è¯ä¹¦ã€TLS è¯ä¹¦çš„é…ç½®æ–¹æ³•ã€TLS åŠ å¯†çš„ç ´è§£æ‰‹æ®µ","uri":"/posts/about-tls-cert/"},{"categories":["æŠ€æœ¯"],"content":"æ›´æ–°è®°å½• è¡¥å…… TLS åè®®çš„è¯¦ç»†æµç¨‹ å®Œæˆ TLS è¯ä¹¦çš„è¯¦ç»†ä»‹ç» ","date":"2021-01-17","objectID":"/posts/about-tls-cert/:1:0","tags":["HTTPS","TLS","OpenSSL","åŠ å¯†","ç ´è§£"],"title":"TLS åè®®ã€TLS è¯ä¹¦ã€TLS è¯ä¹¦çš„é…ç½®æ–¹æ³•ã€TLS åŠ å¯†çš„ç ´è§£æ‰‹æ®µ","uri":"/posts/about-tls-cert/"},{"categories":["æŠ€æœ¯"],"content":"ä¸€ã€TLS åè®® æˆ‘ä»¬éœ€è¦åŠ å¯†ç½‘ç»œæ•°æ®ä»¥å®ç°å®‰å…¨é€šä¿¡ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªç°å®çš„é—®é¢˜ï¼š éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼ˆRSA/ECC ç­‰ï¼‰å¯ä»¥æ–¹ä¾¿åœ°å¯¹æ•°æ®è¿›è¡Œç­¾å/éªŒè¯ï¼Œä½†æ˜¯è®¡ç®—é€Ÿåº¦æ…¢ã€‚ å¯¹ç§°åŠ å¯†ç®—æ³•ï¼ˆChaCha20/AES ç­‰ï¼‰è®¡ç®—é€Ÿåº¦å¿«ï¼Œå¼ºåº¦é«˜ï¼Œä½†æ˜¯æ— æ³•å®‰å…¨åœ°ç”Ÿæˆä¸ä¿ç®¡å¯†é’¥ã€‚ TLS åè®®å·§å¦™åœ°è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼šå®ƒåœ¨æ¡æ‰‹é˜¶æ®µä½¿ç”¨ã€Œéå¯¹ç§°ç®—æ³•ã€éªŒè¯æœåŠ¡ç«¯ï¼Œå¹¶ä½¿ç”¨ ECDHE å¯†é’¥äº¤æ¢ç®—æ³•ï¼ˆElliptic Curve Diffie-Hellman key exchangeï¼‰å®‰å…¨åœ°ç”Ÿæˆä¸€ä¸ªä¸´æ—¶çš„å¯¹ç§°å¯†é’¥ï¼Œç„¶åä½¿ç”¨ã€Œå¯¹ç§°ç®—æ³•ã€è¿›è¡ŒåŠ å¯†é€šä¿¡ã€‚ åœ¨åç»­çš„æ¯æ¬¡æ•°æ®äº¤æ¢è¿‡ç¨‹ä¸­ï¼ŒTLS åè®®éƒ½ä¼šä½¿ç”¨ ECDHE ç®—æ³•ç”Ÿæˆæ–°çš„å¯¹ç§°å¯†é’¥ï¼Œå†ä½¿ç”¨æ–°å¯†é’¥åŠ å¯†è§£å¯†æ•°æ®ã€‚ perfect-forward-secrecy-diagram\" perfect-forward-secrecy-diagram TLS åè®®é€šè¿‡ä¸Šè¿°çš„æµç¨‹ï¼Œæä¾›äº†ã€Œå®Œç¾å‰å‘ä¿å¯†ï¼ˆPerfect Forward Secrecyï¼‰ã€ç‰¹æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒèƒ½å¤Ÿä¿æŠ¤è¿‡å»è¿›è¡Œçš„é€šè®¯ä¸å—å¯†é’¥åœ¨æœªæ¥æš´éœ²çš„å¨èƒã€‚ å³ä½¿æ”»å‡»è€…ç ´è§£å‡ºäº†ä¸€ä¸ªã€Œå¯¹ç§°å¯†é’¥ã€ï¼Œä¹Ÿåªèƒ½è·å–åˆ°ä¸€æ¬¡äº‹åŠ¡ä¸­çš„æ•°æ®ï¼Œé»‘å®¢å¿…é¡»ç ´è§£å‡ºæ•´ä¸ª TLS è¿æ¥ä¸­æ‰€æœ‰äº‹åŠ¡çš„å¯¹ç§°å¯†é’¥ï¼Œæ‰èƒ½å¾—åˆ°å®Œæ•´çš„æ•°æ®ã€‚ æ—©æœŸçš„ tls1.1/tls1.2 ä½¿ç”¨çš„ä¸å°‘ç®—æ³•ï¼Œéƒ½ä¸æ˜¯å‰å‘å®‰å…¨çš„ï¼Œä»å®‰å…¨è§’åº¦ä¸Šè®²å»ºè®®ä½¿ç”¨ tls1.3ï¼Œæˆ–è€… tls1.2 + å‰å‘å®‰å…¨çš„ç®—æ³•ã€‚ æœ¬æ–‡ä¸»è¦ä»‹ç» TLS åè®®çš„ä½¿ç”¨ã€TLS è¯ä¹¦çš„ç”Ÿæˆï¼Œä¸æ¶‰åŠå…·ä½“ç®—æ³•å®ç°åŠåè®®ç»†èŠ‚ã€‚ æ¥ä¸‹æ¥è®²ä¸‹è¯ä¹¦ï¼ŒTLS åè®®é€šè¿‡ä¸¤ä¸ªè¯ä¹¦æ¥å®ç°æœåŠ¡ç«¯èº«ä»½éªŒè¯ï¼Œä»¥åŠå¯¹ç§°å¯†é’¥çš„å®‰å…¨ç”Ÿæˆï¼š CA è¯ä¹¦ï¼šæµè§ˆå™¨/æ“ä½œç³»ç»Ÿè‡ªå¸¦ï¼Œç”¨äºéªŒè¯æœåŠ¡ç«¯ TLS è¯ä¹¦çš„ç­¾åã€‚ä¿è¯æœåŠ¡ç«¯è¯ä¹¦å¯ä¿¡ã€‚ TLS è¯ä¹¦ï¼ˆæœåŠ¡ç«¯è¯ä¹¦ï¼‰ï¼šæµè§ˆå™¨éªŒè¯äº†æœåŠ¡ç«¯ TLS è¯ä¹¦å¯ä¿¡åï¼Œå°†ä½¿ç”¨è¿™ä¸ª TLS è¯ä¹¦ä¸æœåŠ¡ç«¯è¿›è¡Œåè®®/ç®—æ³•åå•†ï¼Œä»¥å®‰å…¨åœ°ç”Ÿæˆä¸€ä¸ªå¯¹ç§°å¯†é’¥ã€‚ CA è¯ä¹¦å’Œ TLS è¯ä¹¦ï¼Œéƒ½åªåœ¨ TLS æ¡æ‰‹é˜¶æ®µæœ‰ç”¨åˆ°ï¼Œä¹‹åçš„é€šä¿¡å°±ä¸å®ƒä»¬æ— å…³äº†ã€‚ ","date":"2021-01-17","objectID":"/posts/about-tls-cert/:2:0","tags":["HTTPS","TLS","OpenSSL","åŠ å¯†","ç ´è§£"],"title":"TLS åè®®ã€TLS è¯ä¹¦ã€TLS è¯ä¹¦çš„é…ç½®æ–¹æ³•ã€TLS åŠ å¯†çš„ç ´è§£æ‰‹æ®µ","uri":"/posts/about-tls-cert/"},{"categories":["æŠ€æœ¯"],"content":"äºŒã€TLS è¯ä¹¦ä»‹ç» ","date":"2021-01-17","objectID":"/posts/about-tls-cert/:3:0","tags":["HTTPS","TLS","OpenSSL","åŠ å¯†","ç ´è§£"],"title":"TLS åè®®ã€TLS è¯ä¹¦ã€TLS è¯ä¹¦çš„é…ç½®æ–¹æ³•ã€TLS åŠ å¯†çš„ç ´è§£æ‰‹æ®µ","uri":"/posts/about-tls-cert/"},{"categories":["æŠ€æœ¯"],"content":"1. è¯ä¹¦æ˜¯ä»€ä¹ˆï¼Ÿ è¯ä¹¦æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œç›®å‰ä¸»æµçš„è¯ä¹¦è§„èŒƒä¸º X.509ï¼Œç”± RFC5280 å®šä¹‰ã€‚ ç®€å•çš„è¯´ï¼Œè¯ä¹¦å…¶å®å°±æ˜¯éå¯¹ç§°åŠ å¯†ä¸­çš„å…¬é’¥ï¼ŒåŠ ä¸Šä¸€äº›åˆ«çš„ä¿¡æ¯ç»„æˆçš„ä¸€ä¸ªæ–‡ä»¶ã€‚ æ¯”å¦‚ CA è¯ä¹¦ï¼Œå°±æ˜¯ã€ŒCA å…¬é’¥ + CA æœºæ„ç›¸å…³ä¿¡æ¯ã€æ„æˆçš„ä¸€ä¸ªæ–‡ä»¶ã€‚ è€Œ TLS è¯ä¹¦ï¼Œåˆ™ä¸»è¦åŒ…å«ã€Œå…¬é’¥ + ç”³è¯·è€…ä¿¡æ¯(ä½ ) + é¢å‘è€…(CA)çš„ä¿¡æ¯ + ç­¾å(ä½¿ç”¨ CA ç§é’¥åŠ å¯†çš„è¯ä¹¦ Hash)ã€ï¼Œä»¥åŠä¸€äº›å…¶ä»–ç›¸å…³ä¿¡æ¯ã€‚ å› ä¸º TLS è¯ä¹¦çš„ç­¾åæ˜¯ä½¿ç”¨ CA è¯ä¹¦ç”Ÿæˆçš„ï¼Œå› æ­¤ä½¿ç”¨ CA è¯ä¹¦çš„å…¬é’¥å°±èƒ½éªŒè¯ TLS è¯ä¹¦ç­¾åçš„æ­£ç¡®æ€§ï¼Œä¹Ÿå°±èƒ½åˆ¤æ–­è¯¥è¯ä¹¦æ˜¯å¦å¯ä¿¡ã€‚ ç°å®ä¸­çš„ CA è¯ä¹¦å®é™…ä¸Šè¿˜è¦å¤æ‚äº›ï¼Œé€šå¸¸è¯ä¹¦é¢å‘æœºæ„çš„æƒå¨è¯ä¹¦çš„ç§é’¥æ˜¯å—åˆ°ä¸¥æ ¼ä¿æŠ¤çš„ï¼Œæ ¹è¯ä¹¦ä¼šç­¾å‘è®¸å¤šä¸­é—´è¯ä¹¦ï¼Œå½¢æˆä¸€ä¸ª CA è¯ä¹¦é“¾ã€‚TLS è¯ä¹¦ ç”± CA è¯ä¹¦é“¾æœ€æœ«ç«¯çš„è¯ä¹¦å¯¹ TLS è¯ä¹¦è¿›è¡Œç­¾åã€‚ å¦å¤–è¿˜æœ‰å¤æ‚çš„è¯ä¹¦åŠé”€æœºåˆ¶ï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†ä»‹ç»äº†ã€‚ ä½ å¯ä»¥å°è¯•ä½¿ç”¨æµè§ˆå™¨æŸ¥çœ‹ Google çš„è¯ä¹¦è¯¦æƒ…ï¼Œæˆ‘ä½¿ç”¨ Firefox æŸ¥çœ‹åˆ°çš„å†…å®¹å¦‚ä¸‹ï¼š cert-content\" cert-content ","date":"2021-01-17","objectID":"/posts/about-tls-cert/:3:1","tags":["HTTPS","TLS","OpenSSL","åŠ å¯†","ç ´è§£"],"title":"TLS åè®®ã€TLS è¯ä¹¦ã€TLS è¯ä¹¦çš„é…ç½®æ–¹æ³•ã€TLS åŠ å¯†çš„ç ´è§£æ‰‹æ®µ","uri":"/posts/about-tls-cert/"},{"categories":["æŠ€æœ¯"],"content":"2. TLS è¯ä¹¦æ”¯æŒä¿æŠ¤çš„åŸŸåç±»å‹ TLS è¯ä¹¦æ”¯æŒé…ç½®å¤šä¸ªåŸŸåï¼Œå¹¶ä¸”æ”¯æŒæ‰€è°“çš„é€šé…ç¬¦ï¼ˆæ³›ï¼‰åŸŸåã€‚ ä½†æ˜¯é€šé…ç¬¦åŸŸåè¯ä¹¦çš„åŒ¹é…è§„åˆ™ï¼Œå’Œ DNS è§£æä¸­çš„åŒ¹é…è§„åˆ™å¹¶ä¸ä¸€è‡´ï¼ æ ¹æ®è¯ä¹¦é€‰å‹å’Œè´­ä¹° - é˜¿é‡Œäº‘æ–‡æ¡£ çš„è§£é‡Šï¼Œé€šé…ç¬¦è¯ä¹¦åªæ”¯æŒåŒçº§åŒ¹é…ï¼Œè¯¦ç»†è¯´æ˜å¦‚ä¸‹ï¼š ä¸€çº§é€šé…ç¬¦åŸŸåï¼šå¯ä¿æŠ¤è¯¥é€šé…ç¬¦åŸŸåï¼ˆä¸»åŸŸåï¼‰è‡ªèº«å’Œè¯¥åŸŸåæ‰€æœ‰çš„ä¸€çº§å­åŸŸåã€‚ ä¾‹å¦‚ï¼šä¸€çº§é€šé…ç¬¦åŸŸå *.aliyun.com å¯ä»¥ç”¨äºä¿æŠ¤ aliyun.comã€www.aliyun.com ä»¥åŠå…¶ä»–æ‰€æœ‰ä¸€çº§å­åŸŸåã€‚ ä½†æ˜¯ä¸èƒ½ç”¨äºä¿æŠ¤ä»»ä½•äºŒçº§å­åŸŸåï¼Œå¦‚ xx.aa.aliyun.com äºŒçº§æˆ–äºŒçº§ä»¥ä¸Šé€šé…ç¬¦åŸŸåï¼šåªèƒ½ä¿æŠ¤è¯¥åŸŸååŒçº§çš„æ‰€æœ‰é€šé…åŸŸåï¼Œä¸æ”¯æŒä¿æŠ¤è¯¥é€šé…ç¬¦åŸŸåæœ¬èº«ã€‚ ä¾‹å¦‚ï¼š*.a.aliyun.com åªæ”¯æŒä¿æŠ¤å®ƒçš„æ‰€æœ‰åŒçº§åŸŸåï¼Œä¸èƒ½ç”¨äºä¿æŠ¤ä¸‰çº§å­åŸŸåã€‚ è¦æƒ³ä¿æŠ¤å¤šä¸ªäºŒä¸‰çº§å­åŸŸï¼Œåªèƒ½åœ¨ç”Ÿæˆ TLS è¯ä¹¦æ—¶ï¼Œæ·»åŠ å¤šä¸ªé€šé…ç¬¦åŸŸåã€‚ å› æ­¤è®¾è®¡åŸŸåè§„åˆ™æ—¶ï¼Œè¦è€ƒè™‘åˆ°è¿™ç‚¹ï¼Œå°½é‡ä¸è¦ä½¿ç”¨å±‚çº§å¤ªæ·±çš„åŸŸåï¼æœ‰äº›ä¿¡æ¯å¯ä»¥é€šè¿‡ - æ¥æ‹¼æ¥ä»¥å‡å°‘åŸŸåå±‚çº§ï¼Œæ¯”å¦‚é˜¿é‡Œäº‘çš„ oss åŸŸåï¼š å…¬ç½‘ï¼šoss-cn-shenzhen.aliyuncs.com å†…ç½‘ï¼šoss-cn-shenzhen-internal.aliyuncs.com ","date":"2021-01-17","objectID":"/posts/about-tls-cert/:3:2","tags":["HTTPS","TLS","OpenSSL","åŠ å¯†","ç ´è§£"],"title":"TLS åè®®ã€TLS è¯ä¹¦ã€TLS è¯ä¹¦çš„é…ç½®æ–¹æ³•ã€TLS åŠ å¯†çš„ç ´è§£æ‰‹æ®µ","uri":"/posts/about-tls-cert/"},{"categories":["æŠ€æœ¯"],"content":"ä¸‰ã€TLS è¯ä¹¦çš„ç”Ÿæˆ OpenSSL æ˜¯ç›®å‰ä½¿ç”¨æœ€å¹¿æ³›çš„ç½‘ç»œåŠ å¯†ç®—æ³•åº“ï¼Œè¿™é‡Œä»¥å®ƒä¸ºä¾‹ä»‹ç»è¯ä¹¦çš„ç”Ÿæˆã€‚ å¦å¤–ä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨ cfssl. å…ˆå›é¡¾ä¸‹ï¼Œå‰é¢è®²äº† TLS åè®®æ¡æ‰‹éœ€è¦ä½¿ç”¨åˆ°ä¸¤ä¸ªè¯ä¹¦ï¼š TLS è¯ä¹¦ï¼ˆæœåŠ¡ç«¯è¯ä¹¦ï¼‰ï¼šè¿™ä¸ªæ˜¯æœåŠ¡ç«¯éœ€è¦é…ç½®çš„æ•°æ®åŠ å¯†è¯ä¹¦ã€‚ æœåŠ¡ç«¯éœ€è¦æŒæœ‰è¿™ä¸ª TLS è¯ä¹¦æœ¬èº«ï¼Œä»¥åŠè¯ä¹¦çš„ç§é’¥ã€‚ æ¡æ‰‹æ—¶æœåŠ¡ç«¯éœ€è¦å°† TLS è¯ä¹¦å‘é€ç»™å®¢æˆ·ç«¯ã€‚ CA è¯ä¹¦ï¼šè¿™æ˜¯å—ä¿¡çš„æ ¹è¯ä¹¦ï¼Œå®¢æˆ·ç«¯å¯ç”¨äºéªŒè¯æ‰€æœ‰ä½¿ç”¨å®ƒè¿›è¡Œç­¾åçš„ TLS è¯ä¹¦ã€‚ CA è¯ä¹¦çš„ç§é’¥ç”±æƒå¨æœºæ„æŒæœ‰ï¼Œå®¢æˆ·ç«¯ï¼ˆæ¯”å¦‚æµè§ˆå™¨ï¼‰åˆ™ä¿æœ‰ CA è¯ä¹¦è‡ªèº«ã€‚ åœ¨ TLS è¿æ¥çš„å»ºç«‹é˜¶æ®µï¼Œå®¢æˆ·ç«¯ï¼ˆå¦‚æµè§ˆå™¨ï¼‰ä¼šä½¿ç”¨ CA è¯ä¹¦çš„å…¬é’¥å¯¹æœåŠ¡ç«¯çš„è¯ä¹¦ç­¾åè¿›è¡ŒéªŒè¯ï¼ŒéªŒè¯æˆåŠŸåˆ™è¯´æ˜è¯¥è¯ä¹¦æ˜¯å—ä¿¡ä»»çš„ã€‚ ","date":"2021-01-17","objectID":"/posts/about-tls-cert/:4:0","tags":["HTTPS","TLS","OpenSSL","åŠ å¯†","ç ´è§£"],"title":"TLS åè®®ã€TLS è¯ä¹¦ã€TLS è¯ä¹¦çš„é…ç½®æ–¹æ³•ã€TLS åŠ å¯†çš„ç ´è§£æ‰‹æ®µ","uri":"/posts/about-tls-cert/"},{"categories":["æŠ€æœ¯"],"content":"1. TLS è¯ä¹¦çš„ç±»å‹ æŒ‰ç…§è¯ä¹¦çš„ç”Ÿæˆæ–¹å¼è¿›è¡Œåˆ†ç±»ï¼Œè¯ä¹¦æœ‰ä¸‰ç§ç±»å‹ï¼š ç”±æƒå¨ CA æœºæ„ç­¾åçš„ TLS è¯ä¹¦ï¼šè¿™ç±»è¯ä¹¦ä¼šè¢«æµè§ˆå™¨ã€å°ç¨‹åºç­‰ç¬¬ä¸‰æ–¹åº”ç”¨/æœåŠ¡å•†ä¿¡ä»»ã€‚ç”³è¯·è¯ä¹¦æ—¶éœ€è¦éªŒè¯ä½ çš„æ‰€æœ‰æƒï¼Œä¹Ÿå°±ä½¿è¯ä¹¦æ— æ³•ä¼ªé€ ã€‚ å¦‚æœä½ çš„ API éœ€è¦æä¾›ç»™ç¬¬ä¸‰æ–¹åº”ç”¨/æœåŠ¡å•†/æµè§ˆå™¨è®¿é—®ï¼Œé‚£å°±å¿…é¡»å‘æƒå¨ CA æœºæ„ç”³è¯·æ­¤ç±»è¯ä¹¦ã€‚ æœ¬åœ°ç­¾åè¯ä¹¦ - tls_locally_signed_certï¼šå³ç”±æœ¬åœ° CA è¯ä¹¦ç­¾åçš„ TLS è¯ä¹¦ æœ¬åœ° CA è¯ä¹¦ï¼Œå°±æ˜¯è‡ªå·±ä½¿ç”¨ openssl ç­‰å·¥å…·ç”Ÿæˆçš„ CA è¯ä¹¦ã€‚ è¿™ç±»è¯ä¹¦ä¸ä¼šè¢«æµè§ˆå™¨/å°ç¨‹åºç­‰ç¬¬ä¸‰æ–¹åº”ç”¨/æœåŠ¡å•†ä¿¡ä»»ï¼Œè¯ä¹¦å°±å¯ä»¥è¢«ä¼ªé€ ã€‚ è¿™ç±»è¯ä¹¦çš„ç¼ºç‚¹æ˜¯æ— æ³•ä¸ç¬¬ä¸‰æ–¹åº”ç”¨/æœåŠ¡å•†å»ºç«‹å®‰å…¨çš„è¿æ¥ã€‚ å¦‚æœå®¢æˆ·ç«¯æ˜¯å®Œå…¨å¯æ§çš„ï¼ˆæ¯”å¦‚æ˜¯è‡ªå®¶çš„ APPï¼‰ï¼Œé‚£å¯ä»¥è‡ªè¡ŒéªŒè¯è¯ä¹¦çš„å¯é æ€§ï¼ˆå…¬é’¥é”å®šã€åŒå‘ TLS éªŒè¯ï¼‰ã€‚è¿™ç§åœºæ™¯ä¸‹ä½¿ç”¨æ­¤ç±»è¯ä¹¦æ˜¯å®‰å…¨å¯é çš„ã€‚å¯ä»¥ä¸ä½¿ç”¨æƒå¨CAæœºæ„é¢å‘çš„è¯ä¹¦ã€‚ è‡ªç­¾åè¯ä¹¦ - tls_self_signed_cert: å’Œ tls_locally_signed_cert ç±»ä¼¼ï¼Œä½†ä½¿ç”¨ TLS è¯ä¹¦è‡ªå·±å……å½“ CA è¯ä¹¦ï¼ˆæˆ‘ç­¾æˆ‘è‡ªå·±ï¼‰ï¼Œç”Ÿæˆå‡ºçš„è¯ä¹¦å°±å«è‡ªç­¾åè¯ä¹¦ã€‚ æ³¨æ„:æ›´å¹¿ä¹‰åœ°è®²ï¼Œè‡ªç­¾åè¯ä¹¦ï¼Œå°±æ˜¯ã€Œå¹¶éç”±æƒå¨ CA æœºæ„ç­¾åçš„ TLS è¯ä¹¦ã€ï¼Œä¹Ÿå°±æ˜¯åŒæ—¶æŒ‡ä»£äº† tls_self_signed_cert å’Œ tls_locally_signed_certã€‚è¿™ä¹Ÿæ˜¯ã€Œè‡ªç­¾åè¯ä¹¦ã€åº”ç”¨æœ€å¹¿æ³›çš„ä¸€ç§å«ä¹‰ã€‚ æ€»çš„æ¥è¯´ï¼Œæƒå¨CAæœºæ„é¢å‘çš„è¯ä¹¦ï¼Œå¯ä»¥è¢«ç¬¬ä¸‰æ–¹çš„åº”ç”¨ä¿¡ä»»ï¼Œä½†æ˜¯è‡ªå·±ç”Ÿæˆçš„ä¸è¡Œã€‚ è€Œè¶Šè´µçš„æƒå¨è¯ä¹¦ï¼Œå®‰å…¨æ€§ä¸å¯ä¿¡åº¦å°±è¶Šé«˜ï¼Œæˆ–è€…å¯ä»¥ä¿æŠ¤æ›´å¤šçš„åŸŸåã€‚ åœ¨å®¢æˆ·ç«¯å¯æ§çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ã€Œæœ¬åœ°ç­¾åè¯ä¹¦ã€ï¼ˆæ–¹ä¾¿ã€çœé’±ï¼‰ï¼Œå°†è¿™ä¸ªè¯ä¹¦é¢„å…ˆåŸ‹å…¥å®¢æˆ·ç«¯ä¸­ç”¨äºéªŒè¯ã€‚ è€Œã€Œè‡ªç­¾åè¯ä¹¦ã€ä¸»è¦æ˜¯æ–¹ä¾¿ï¼Œèƒ½ä¸ç”¨è¿˜æ˜¯å°½é‡ä¸è¦ä½¿ç”¨ã€‚ ","date":"2021-01-17","objectID":"/posts/about-tls-cert/:4:1","tags":["HTTPS","TLS","OpenSSL","åŠ å¯†","ç ´è§£"],"title":"TLS åè®®ã€TLS è¯ä¹¦ã€TLS è¯ä¹¦çš„é…ç½®æ–¹æ³•ã€TLS åŠ å¯†çš„ç ´è§£æ‰‹æ®µ","uri":"/posts/about-tls-cert/"},{"categories":["æŠ€æœ¯"],"content":"2. å‘æƒå¨CAæœºæ„ç”³è¯·ã€Œå—ä¿¡ TLS è¯ä¹¦ã€ å…è´¹çš„ TLS è¯ä¹¦æœ‰ä¸¤ç§æ–¹å¼è·å–ï¼š éƒ¨åˆ† TLS æä¾›å•†æœ‰æä¾›å…è´¹è¯ä¹¦çš„ç”³è¯·ï¼Œæœ‰æ•ˆæœŸä¸ºä¸€å¹´ï¼Œä½†æ˜¯ä¸æ”¯æŒæ³›åŸŸåã€‚ ç”³è¯· Letâ€™s Encrypt å…è´¹è¯ä¹¦ å¾ˆå¤šä»£ç†å·¥å…·éƒ½æœ‰æä¾› Letâ€™s Encrypt è¯ä¹¦çš„ Auto Renewalï¼Œæ¯”å¦‚: Traefik Caddy docker-letsencrypt-nginx-proxy-companion ç½‘ä¸Šä¹Ÿæœ‰ä¸€äº› certbot æ’ä»¶ï¼Œå¯ä»¥é€šè¿‡ DNS æä¾›å•†çš„ API è¿›è¡Œ Letâ€™s Encrypt è¯ä¹¦çš„ Auto Renewalï¼Œæ¯”å¦‚ï¼š certbot-dns-aliyun terraform ä¹Ÿæœ‰ç›¸å…³ provider: terraform-provider-acme æ”¶è´¹è¯ä¹¦å¯ä»¥åœ¨å„ TLS æä¾›å•†å¤„è´­ä¹°ï¼Œæ¯”å¦‚å›½å†…çš„é˜¿é‡Œäº‘è…¾è®¯äº‘ç­‰ã€‚ å®Œæ•´çš„è¯ä¹¦ç”³è¯·æµç¨‹å¦‚ä¸‹ï¼š è¯ä¹¦ç”³è¯·æµç¨‹\" è¯ä¹¦ç”³è¯·æµç¨‹ ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·ï¼Œå›¾ä¸­çš„ç”³è¯·äºº(Applicant)è‡ªè¡Œå¤„ç†çš„éƒ¨åˆ†ï¼Œç›®å‰å¾ˆå¤šè¯ä¹¦ç”³è¯·ç½‘ç«™ä¹Ÿå¯ä»¥è‡ªåŠ¨å¤„ç†ï¼Œç”¨æˆ·åªéœ€è¦æä¾›ç›¸å…³ä¿¡æ¯å³å¯ã€‚ ","date":"2021-01-17","objectID":"/posts/about-tls-cert/:4:2","tags":["HTTPS","TLS","OpenSSL","åŠ å¯†","ç ´è§£"],"title":"TLS åè®®ã€TLS è¯ä¹¦ã€TLS è¯ä¹¦çš„é…ç½®æ–¹æ³•ã€TLS åŠ å¯†çš„ç ´è§£æ‰‹æ®µ","uri":"/posts/about-tls-cert/"},{"categories":["æŠ€æœ¯"],"content":"3. ç”Ÿæˆã€Œæœ¬åœ°ç­¾åè¯ä¹¦ã€æˆ–è€…ã€Œè‡ªç­¾åè¯ä¹¦ã€ é™¤äº†è¢«ç¬¬ä¸‰æ–¹ä¿¡ä»»çš„ã€Œå—ä¿¡ TLS è¯ä¹¦ã€ï¼Œåœ¨å†…ç½‘ç¯å¢ƒï¼Œæˆ‘ä»¬éœ€è¦ä¹Ÿä½¿ç”¨ TLS è¯ä¹¦ä¿éšœé€šä¿¡å®‰å…¨ï¼Œè¿™æ—¶æˆ‘ä»¬å¯èƒ½ä¼šé€‰æ‹©è‡ªå·±ç”Ÿæˆè¯ä¹¦ï¼Œè€Œä¸æ˜¯å‘æƒå¨æœºæ„ç”³è¯·è¯ä¹¦ã€‚ å¯èƒ½çš„åŸå› å¦‚ä¸‹ï¼š è¦å‘æƒå¨æœºæ„ç”³è¯·è¯ä¹¦ï¼Œé‚£æ˜¯è¦ç»™é’±çš„ã€‚è€Œåœ¨å†…ç½‘ç¯å¢ƒä¸‹ï¼Œå¹¶æ— å¿…è¦ä½¿ç”¨æƒå¨è¯ä¹¦ã€‚ å†…ç½‘ç¯å¢ƒä½¿ç”¨çš„å¯èƒ½æ˜¯éå…¬ç½‘åŸŸåï¼ˆxxx.local/xxx.lan/xxx.srv ç­‰ï¼‰ï¼Œæƒå¨æœºæ„ä¸ç­¾å‘è¿™ç§åŸŸåçš„è¯ä¹¦ã€‚ï¼ˆå› ä¸ºæ²¡æœ‰äººå”¯ä¸€åœ°æ‹¥æœ‰è¿™ä¸ªåŸŸåï¼‰ å‰é¢ä»‹ç»è¿‡ï¼Œè‡ªå·±ç”Ÿæˆçš„è¯ä¹¦æœ‰ä¸¤ç§æ–¹ç±»å‹ï¼š æœ¬åœ°ç­¾åè¯ä¹¦ï¼šç”Ÿæˆä¸¤ä¸ªç‹¬ç«‹çš„å¯†é’¥å¯¹ï¼Œä¸€ä¸ªç”¨äº CA è¯ä¹¦ï¼Œå¦ä¸€ä¸ªç”¨äº TLS è¯ä¹¦ã€‚ä½¿ç”¨ CA è¯ä¹¦å¯¹ TLS è¯ä¹¦è¿›è¡Œç­¾åã€‚ è‡ªç­¾åè¯ä¹¦ï¼ˆæˆ‘ç­¾æˆ‘è‡ªå·±ï¼‰ï¼šTLS è¯ä¹¦å’Œ CA è¯ä¹¦éƒ½ä½¿ç”¨åŒä¸€ä¸ªå¯†é’¥å¯¹ï¼Œä½¿ç”¨ TLS è¯ä¹¦å¯¹å®ƒè‡ªå·±è¿›è¡Œç­¾åã€‚ æµ‹è¯•å‘ç°è¿™ç§æ–¹å¼å¾—åˆ°çš„è¯ä¹¦è²Œä¼¼ä¸åŒ…å« SAN å±æ€§ï¼å› æ­¤ä¸æ”¯æŒå¤šåŸŸåã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œç›´æ¥ç”Ÿæˆä¸€ä¸ªæ³›åŸŸåçš„ã€Œè‡ªç­¾åè¯ä¹¦ã€å°±å¤Ÿäº†ï¼Œä½†æ˜¯å®ƒä¸æ–¹ä¾¿æ‹“å±•â€”â€”å®¢æˆ·ç«¯å¯¹æ¯ä¸ªã€Œè‡ªç­¾åè¯ä¹¦ã€ï¼Œéƒ½éœ€è¦å•ç‹¬æ·»åŠ ä¸€æ¬¡ä¿¡ä»»ã€‚ è€Œã€Œæœ¬åœ°ç­¾åè¯ä¹¦ã€å°±æ²¡è¿™ä¸ªé—®é¢˜ï¼Œone ca.crt rules them all. æ€»çš„æ¥è¯´ï¼Œä½¿ç”¨ã€Œè‡ªç­¾åè¯ä¹¦ã€ä¸æ–¹ä¾¿è¿›è¡Œæ‹“å±•ï¼Œæœªæ¥å¯èƒ½ä¼šé‡åˆ°éº»çƒ¦ã€‚å› æ­¤å»ºè®®ä½¿ç”¨ã€Œæœ¬åœ°ç­¾åè¯ä¹¦ã€ã€‚ å¦å¤–ä»‹ç»ä¸‹è¿™é‡Œæ¶‰åŠåˆ°çš„å‡ ç§æ–‡ä»¶ç±»å‹ï¼š xxx.key: å°±æ˜¯ä¸€ä¸ªç§é’¥ï¼Œä¸€èˆ¬æ˜¯ä¸€ä¸ª RSA ç§é’¥ï¼Œé•¿åº¦é€šå¸¸æŒ‡å®šä¸º 2048 ä½ã€‚ CA è¯ä¹¦å’Œ TLS è¯ä¹¦çš„ç§é’¥éƒ½æ˜¯é€šè¿‡è¿™ç§æ–¹å¼ç”Ÿæˆçš„ã€‚ xxx.csr: å³ Certificate Sign Requestï¼Œè¯ä¹¦ç­¾åè¯·æ±‚ã€‚ä½¿ç”¨ openssl ç­‰å·¥å…·ï¼Œé€šè¿‡ TLS å¯†é’¥+TLS è¯ä¹¦çš„ç›¸å…³ä¿¡æ¯ï¼Œå¯ç”Ÿæˆå‡ºä¸€ä¸ª CSR æ–‡ä»¶ã€‚ åŸŸåï¼ˆCommon Name, CNï¼‰å°±æ˜¯åœ¨è¿™é‡ŒæŒ‡å®šçš„ï¼Œå¯ä»¥ä½¿ç”¨æ³›åŸŸåã€‚ ç”¨æˆ·å°† csr æ–‡ä»¶å‘é€ç»™ CA æœºæ„ï¼Œè¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ã€‚ xxx.crt: è¿™å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„ TLS è¯ä¹¦ï¼ŒCA è¯ä¹¦å’ŒæœåŠ¡ç«¯ TLS è¯ä¹¦éƒ½æ˜¯è¿™ä¸ªæ ¼å¼ã€‚ ä½¿ç”¨ CA è¯ä¹¦ã€CA å¯†é’¥å¯¹ csr æ–‡ä»¶è¿›è¡Œç­¾åï¼Œå°±èƒ½å¾—åˆ°æœ€ç»ˆçš„æœåŠ¡ç«¯ TLS è¯ä¹¦â€”â€”ä¸€ä¸ª crt æ–‡ä»¶ã€‚ ç”Ÿæˆä¸€ä¸ªã€Œè‡ªç­¾åè¯ä¹¦ã€æˆ–è€…ã€Œæœ¬åœ°ç­¾åè¯ä¹¦ã€ï¼ˆRSA256 ç®—æ³•ï¼‰ï¼Œæœ‰ä¸¤ä¸ªæ­¥éª¤ï¼š ç¼–å†™è¯ä¹¦ç­¾åè¯·æ±‚çš„é…ç½®æ–‡ä»¶ csr.conf: [ req ] default_bits = 2048 prompt = no default_md = sha256 req_extensions = req_ext distinguished_name = dn [ dn ] C = CN # Contountry ST = \u003cstate\u003e L = \u003ccity\u003e O = \u003corganization\u003e OU = \u003corganization unit\u003e CN = *.svc.local # æ³›åŸŸåï¼Œè¿™ä¸ªå­—æ®µå·²ç»è¢« chrome/apple å¼ƒç”¨äº†ã€‚ [ alt_names ] # å¤‡ç”¨åç§°ï¼Œchrome/apple ç›®å‰åªä¿¡ä»»è¿™é‡Œé¢çš„åŸŸåã€‚ DNS.1 = *.svc.local # ä¸€çº§æ³›åŸŸå DNS.2 = *.aaa.svc.local # äºŒçº§æ³›åŸŸå DNS.3 = *.bbb.svc.local # äºŒçº§æ³›åŸŸå [ req_ext ] subjectAltName = @alt_names [ v3_ext ] subjectAltName=@alt_names # Chrome è¦æ±‚å¿…é¡»è¦æœ‰ subjectAltName(SAN) authorityKeyIdentifier=keyid,issuer:always basicConstraints=CA:FALSE keyUsage=keyEncipherment,dataEncipherment,digitalSignature extendedKeyUsage=serverAuth,clientAuth æ­¤æ–‡ä»¶çš„è¯¦ç»†æ–‡æ¡£ï¼šOpenSSL file formats and conventions ç”Ÿæˆè¯ä¹¦ï¼š # 1. ç”Ÿæˆ 2048 ä½ çš„ RSA å¯†é’¥ openssl genrsa -out server.key 2048 # 2. é€šè¿‡ç¬¬ä¸€æ­¥ç¼–å†™çš„é…ç½®æ–‡ä»¶ï¼Œç”Ÿæˆè¯ä¹¦ç­¾åè¯·æ±‚ï¼ˆå…¬é’¥+ç”³è¯·è€…ä¿¡æ¯ï¼‰ openssl req -new -key server.key -out server.csr -config csr.conf # 3. ç”Ÿæˆæœ€ç»ˆçš„è¯ä¹¦ï¼Œè¿™é‡ŒæŒ‡å®šè¯ä¹¦æœ‰æ•ˆæœŸ 3650 å¤© ## 3.1 æ–¹æ³•ä¸€ï¼ˆè‡ªç­¾åï¼‰ï¼šä½¿ç”¨ server.key è¿›è¡Œè‡ªç­¾åã€‚è¿™ç§æ–¹å¼å¾—åˆ°çš„è¯ä¹¦ä¸åŒ…å« SANï¼ä¸æ”¯æŒå¤šåŸŸåï¼ openssl req -x509 -sha256 -days 3650 -key server.key -in server.csr -out server.crt ## 3.2 æ–¹æ³•äºŒï¼ˆæœ¬åœ°ç­¾åï¼‰ï¼šç”Ÿæˆ ca è¯ä¹¦ï¼Œå¹¶ä¸”ä½¿ç”¨ CA è¯ä¹¦ã€CA å¯†é’¥å¯¹ `csr` æ–‡ä»¶è¿›è¡Œç­¾å ### 3.2.1 ca ç§é’¥ openssl genrsa -out ca.key 2048 ### 3.2.2 ca è¯ä¹¦ï¼Œca è¯ä¹¦çš„æœ‰æ•ˆæœŸå°½é‡è®¾é•¿ä¸€ç‚¹ï¼Œå› ä¸ºä¸æ–¹ä¾¿æ›´æ–°æ¢ä»£ã€‚ openssl req -x509 -new -nodes -key ca.key -subj \"/CN=MyLocalRootCA\" -days 10000 -out ca.crt ### 3.2.3 ç­¾åï¼Œå¾—åˆ°æœ€ç»ˆçš„ TLS è¯ä¹¦ï¼Œå®ƒåŒ…å«å››éƒ¨åˆ†å†…å®¹ï¼šå…¬é’¥+ç”³è¯·è€…ä¿¡æ¯ + é¢å‘è€…(CA)çš„ä¿¡æ¯+ç­¾å(ä½¿ç”¨ CA ç§é’¥åŠ å¯†) openssl x509 -req -in server.csr -CA ca.crt -CAkey ca.key \\ -CAcreateserial -out server.crt -days 3650 \\ -extensions v3_ext -extfile csr.conf ä¸Šè¿°æµç¨‹ç”Ÿæˆä¸€ä¸ª x509 è¯ä¹¦é“¾ï¼Œè¯¦ç»†çš„å‚æ•°è¯´æ˜ï¼Œå‚è§ RFC5280 - Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile ","date":"2021-01-17","objectID":"/posts/about-tls-cert/:4:3","tags":["HTTPS","TLS","OpenSSL","åŠ å¯†","ç ´è§£"],"title":"TLS åè®®ã€TLS è¯ä¹¦ã€TLS è¯ä¹¦çš„é…ç½®æ–¹æ³•ã€TLS åŠ å¯†çš„ç ´è§£æ‰‹æ®µ","uri":"/posts/about-tls-cert/"},{"categories":["æŠ€æœ¯"],"content":"4. å…³äºè¯ä¹¦å¯¿å‘½ å¯¹äºå…¬å¼€æœåŠ¡ï¼ŒæœåŠ¡ç«¯è¯ä¹¦çš„æœ‰æ•ˆæœŸä¸è¦è¶…è¿‡ 825 å¤©ï¼ˆ27 ä¸ªæœˆï¼‰ï¼è€Œ 2020 å¹´ 11 æœˆèµ·ï¼Œæ–°ç”³è¯·çš„æœåŠ¡ç«¯è¯ä¹¦æœ‰æ•ˆæœŸç¼©çŸ­åˆ°äº† 398 å¤©ï¼ˆ13 ä¸ªæœˆï¼‰ã€‚ç›®å‰ Apple/Mozilla/Chrome éƒ½å‘è¡¨äº†ç›¸åº”å£°æ˜ï¼Œè¯ä¹¦æœ‰æ•ˆæœŸè¶…è¿‡ä¸Šè¿°é™åˆ¶çš„ï¼Œå°†è¢«æµè§ˆå™¨/Appleè®¾å¤‡ç¦æ­¢ä½¿ç”¨ã€‚ å¯¹äºå…¶ä»–ç”¨é€”çš„è¯ä¹¦ï¼Œå¦‚æœæ›´æ¢èµ·æ¥å¾ˆéº»çƒ¦ï¼Œå¯ä»¥è€ƒè™‘æ”¾å®½æ¡ä»¶ã€‚ æ¯”å¦‚ kubernetes é›†ç¾¤çš„åŠ å¯†è¯ä¹¦ï¼Œå¯ä»¥è€ƒè™‘æœ‰æ•ˆæœŸè®¾é•¿ä¸€äº›ï¼Œæ¯”å¦‚ 10 å¹´ã€‚ æ®äº‘åŸç”Ÿå®‰å…¨ç ´å±€ï½œå¦‚ä½•ç®¡ç†å‘¨æœŸè¶Šæ¥è¶ŠçŸ­çš„æ•°å­—è¯ä¹¦ï¼Ÿæ‰€è¿°ï¼Œå¤§é‡çŸ¥åä¼ä¸šå¦‚ ç‰¹æ–¯æ‹‰/å¾®è½¯/é¢†è‹±/çˆ±ç«‹ä¿¡ éƒ½æ›¾å› æœªåŠæ—¶æ›´æ¢ TLS è¯ä¹¦å¯¼è‡´æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ã€‚ å› æ­¤ TLS è¯ä¹¦æœ€å¥½æ˜¯è®¾ç½®è‡ªåŠ¨è½®è½¬ï¼äººå·¥ç»´æŠ¤ä¸å¯é ï¼ ç›®å‰å¾ˆå¤š Web æœåŠ¡å™¨/ä»£ç†ï¼Œéƒ½æ”¯æŒè‡ªåŠ¨è½®è½¬ Letâ€™s Encrypt è¯ä¹¦ã€‚ å¦å¤– Vault ç­‰å®‰å…¨å·¥å…·ï¼Œä¹Ÿæ”¯æŒè‡ªåŠ¨è½®è½¬ç§æœ‰è¯ä¹¦ã€‚ ","date":"2021-01-17","objectID":"/posts/about-tls-cert/:4:4","tags":["HTTPS","TLS","OpenSSL","åŠ å¯†","ç ´è§£"],"title":"TLS åè®®ã€TLS è¯ä¹¦ã€TLS è¯ä¹¦çš„é…ç½®æ–¹æ³•ã€TLS åŠ å¯†çš„ç ´è§£æ‰‹æ®µ","uri":"/posts/about-tls-cert/"},{"categories":["æŠ€æœ¯"],"content":"5. æ‹“å±•1ï¼šåŸºäº ECC ç®—æ³•çš„ TLS è¯ä¹¦ Letâ€™s Encrypt ç›®å‰ä¹Ÿå·²ç»æ”¯æŒäº† ECC è¯ä¹¦ã€‚ ECC(Elliptic Curve Cryptography) ç®—æ³•è¢«è®¤ä¸ºæ˜¯æ¯” RSA æ›´ä¼˜ç§€çš„ç®—æ³•ã€‚ä¸ RSA ç®—æ³•ç›¸æ¯”ï¼ŒECC ç®—æ³•ä½¿ç”¨æ›´å°çš„å¯†é’¥å¤§å°ï¼Œä½†å¯æä¾›åŒæ ·çš„å®‰å…¨æ€§ï¼Œè¿™ä½¿è®¡ç®—æ›´å¿«ï¼Œé™ä½äº†èƒ½è€—ï¼Œå¹¶èŠ‚çœäº†å†…å­˜å’Œå¸¦å®½ã€‚ å¯¹äº RSA å¯†é’¥ï¼Œå¯ä»¥æä¾›ä¸åŒçš„å¯†é’¥å¤§å°ï¼ˆå¯†é’¥å¤§å°è¶Šå¤§ï¼ŒåŠ å¯†æ•ˆæœè¶Šå¥½ï¼‰ã€‚ è€Œå¯¹äº ECC å¯†é’¥ï¼Œæ‚¨åº”é€‰æ‹©è¦ç”¨å“ªç§æ›²çº¿ç”Ÿæˆå¯†é’¥å¯¹ã€‚å„ä¸ªç»„ç»‡ï¼ˆANSI X9.62ã€NISTã€SECGï¼‰å‘½åäº†å¤šç§æ›²çº¿ï¼Œå¯é€šè¿‡å¦‚ä¸‹å‘½åæŸ¥çœ‹ openssl æ”¯æŒçš„æ‰€æœ‰æ¤­åœ†æ›²çº¿åç§°ï¼š openssl ecparam -list_curves ç”Ÿæˆä¸€ä¸ªè‡ªç­¾åçš„ ECC è¯ä¹¦çš„å‘½ä»¤ç¤ºä¾‹å¦‚ä¸‹ï¼š # ç”Ÿæˆ ec ç®—æ³•çš„ç§é’¥ï¼Œä½¿ç”¨ prime256v1 ç®—æ³•ï¼Œå¯†é’¥é•¿åº¦ 256 ä½ã€‚ï¼ˆå¼ºåº¦å¤§äº 2048 ä½çš„ RSA å¯†é’¥ï¼‰ openssl ecparam -genkey -name prime256v1 -out key.pem # ç”Ÿæˆè¯ä¹¦ç­¾åè¯·æ±‚ï¼Œéœ€è¦è¾“å…¥åŸŸå(Common Name, CN)ç­‰ç›¸å…³ä¿¡æ¯ openssl req -new -sha256 -key key.pem -out csr.csr -config csr.conf # ç”Ÿæˆæœ€ç»ˆçš„è¯ä¹¦ï¼Œè¿™é‡ŒæŒ‡å®šè¯ä¹¦æœ‰æ•ˆæœŸ 10 å¹´ ## æ–¹æ³•ä¸€ï¼šè‡ªç­¾åè¯ä¹¦ openssl req -x509 -sha256 -days 3650 -key key.pem -in csr.csr -out certificate.pem ## æ–¹æ³•äºŒï¼šä½¿ç”¨ ca è¿›è¡Œç­¾åï¼Œæ–¹æ³•å‚è€ƒå‰é¢ ","date":"2021-01-17","objectID":"/posts/about-tls-cert/:4:5","tags":["HTTPS","TLS","OpenSSL","åŠ å¯†","ç ´è§£"],"title":"TLS åè®®ã€TLS è¯ä¹¦ã€TLS è¯ä¹¦çš„é…ç½®æ–¹æ³•ã€TLS åŠ å¯†çš„ç ´è§£æ‰‹æ®µ","uri":"/posts/about-tls-cert/"},{"categories":["æŠ€æœ¯"],"content":"6. æ‹“å±•2ï¼šä½¿ç”¨ OpenSSL ç”Ÿæˆ SSH/JWT å¯†é’¥å¯¹ RSA/ECC è¿™ä¸¤ç±»éå¯¹ç§°åŠ å¯†ç®—æ³•è¢«å¹¿æ³›çš„åº”ç”¨åœ¨å„ç±»åŠ å¯†é€šè®¯ä¸­ã€‚ SSH/JWT éƒ½æ”¯æŒ RSA-SHA256 åŠ ECDSA-SHA256 ç­‰åŸºäº RSA/ECDSA çš„ç­¾å/åŠ å¯†ç®—æ³•ï¼Œå› æ­¤ä½¿ç”¨ OpenSSL ç”Ÿæˆçš„å¯†é’¥å¯¹ï¼Œä¹Ÿåº”è¯¥èƒ½ç”¨äº SSH åè®®åŠ å¯†ã€JWT ç­¾åç­‰åœºæ™¯ã€‚ ç›®å‰æœ‰ä¸¤ç§åŸºäº ECC å’Œ DSA çš„æ¤­åœ†æ›²çº¿ç­¾åç®—æ³•ï¼šECDSA å’Œ EdDSA(ed25519)ï¼Œå…¶ä¸­ ECDSA çš„æ–‡æ¡£åœ¨æ›²çº¿é€‰æ‹©æ–¹é¢è¯­ç„‰ä¸è¯¦ï¼Œè¢«è®¤ä¸ºå¯èƒ½å­˜åœ¨å®‰å…¨éšæ‚£ï¼ˆæ”¿æ²»å’ŒæŠ€æœ¯ä¸¤æ–¹é¢å¸¦æ¥çš„ï¼‰ã€‚ æ—¢ç„¶ SSH/TLS/JWT ä½¿ç”¨çš„æ˜¯ç›¸åŒçš„å¯†é’¥å¯¹ï¼Œé‚£ç†æ‰€å½“ç„¶åœ°ï¼ŒSSH/JWT å¯†é’¥å¯¹åº”è¯¥ä¹Ÿå¯ä»¥é€šè¿‡ OpenSSL ç”Ÿæˆå‡ºæ¥ã€‚ ç”Ÿæˆ RSA å¯†é’¥å¯¹çš„å‘½ä»¤å¦‚ä¸‹ï¼š # 1. ç”Ÿæˆ 2048 ä½ï¼ˆä¸æ˜¯ 256 ä½ï¼‰çš„ RSA å¯†é’¥ openssl genrsa -out rsa-private-key.pem 2048 # 2. é€šè¿‡å¯†é’¥ç”Ÿæˆå…¬é’¥ï¼ŒJWT ä½¿ç”¨æ­¤å…¬é’¥éªŒè¯ç­¾å openssl rsa -in rsa-private-key.pem -pubout -out rsa-public-key.pem # 3. SSH ä½¿ç”¨ä¸“ç”¨çš„å…¬é’¥æ ¼å¼ï¼Œéœ€è¦ä½¿ç”¨ ssh-keygen è½¬æ¢ä¸‹æ ¼å¼ ssh-keygen -i -mPKCS8 -f rsa-public-key.pem -y \u003e rsa-public.pub ç”Ÿæˆ ECC å¯†é’¥å¯¹çš„å‘½ä»¤å¦‚ä¸‹ï¼š # 1. ç”Ÿæˆ ec ç®—æ³•çš„ç§é’¥ï¼Œä½¿ç”¨ prime256v1 ç®—æ³•ï¼Œå¯†é’¥é•¿åº¦ 256 ä½ã€‚ï¼ˆå¼ºåº¦å¤§äº 2048 ä½çš„ RSA å¯†é’¥ï¼‰ openssl ecparam -genkey -name prime256v1 -out ecc-private-key.pem # 2. é€šè¿‡å¯†é’¥ç”Ÿæˆå…¬é’¥ openssl ec -in ecc-private-key.pem -pubout -out ecc-public-key.pem # 3. SSH ä½¿ç”¨ä¸“ç”¨çš„å…¬é’¥æ ¼å¼ï¼Œéœ€è¦ä½¿ç”¨ ssh-keygen è½¬æ¢ä¸‹æ ¼å¼ ssh-keygen -i -mPKCS8 -f ecc-public-key.pem -y \u003e ecc-public.pub JWT ç­¾ååŠéªŒè¯åªéœ€è¦ä½¿ç”¨æ ‡å‡†çš„ç§é’¥-å…¬é’¥å¯¹ï¼Œå³ ecc-private-key.pem/ecc-public-key.pem. è€Œ SSH éœ€è¦ä½¿ç”¨ä¸“ç”¨çš„å…¬é’¥æ ¼å¼ï¼Œå› æ­¤å®ƒçš„ä½¿ç”¨çš„å¯†é’¥å¯¹åº”è¯¥æ˜¯ ecc-private-key.pem/ecc-public.pub æ³¨ï¼šSSH ç›®å‰æ¨èä½¿ç”¨ ed25519 ç®—æ³•ï¼Œè€Œ JWT ç›®å‰æ¨èä½¿ç”¨ ECDSA ç®—æ³•ã€‚ 6.1 åŠ å¯†ä¸ç­¾å åŠ å¯†ä¸è§£å¯†ï¼šå…¬é’¥ç”¨äºå¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œç§é’¥ç”¨äºå¯¹æ•°æ®è¿›è¡Œè§£å¯† ç­¾åä¸éªŒè¯ï¼šç§é’¥ç”¨äºå¯¹æ•°æ®è¿›è¡Œç­¾åï¼Œå…¬é’¥ç”¨äºå¯¹ç­¾åè¿›è¡ŒéªŒè¯ åŠ å¯†ä¸ç­¾åçš„å…¬ç§é’¥ï¼Œç”¨é€”åˆšå¥½ç›¸åï¼ ","date":"2021-01-17","objectID":"/posts/about-tls-cert/:4:6","tags":["HTTPS","TLS","OpenSSL","åŠ å¯†","ç ´è§£"],"title":"TLS åè®®ã€TLS è¯ä¹¦ã€TLS è¯ä¹¦çš„é…ç½®æ–¹æ³•ã€TLS åŠ å¯†çš„ç ´è§£æ‰‹æ®µ","uri":"/posts/about-tls-cert/"},{"categories":["æŠ€æœ¯"],"content":"å››ã€æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯çš„è¯ä¹¦é…ç½® ","date":"2021-01-17","objectID":"/posts/about-tls-cert/:5:0","tags":["HTTPS","TLS","OpenSSL","åŠ å¯†","ç ´è§£"],"title":"TLS åè®®ã€TLS è¯ä¹¦ã€TLS è¯ä¹¦çš„é…ç½®æ–¹æ³•ã€TLS åŠ å¯†çš„ç ´è§£æ‰‹æ®µ","uri":"/posts/about-tls-cert/"},{"categories":["æŠ€æœ¯"],"content":"1. æœåŠ¡ç«¯çš„ TLS è¯ä¹¦é…ç½® è¦æ”¯æŒ HTTPS åè®®ï¼ŒæœåŠ¡ç«¯éœ€è¦ä¸¤ä¸ªæ–‡ä»¶ï¼š TLS è¯ä¹¦ç§é’¥(RSA ç§é’¥æˆ– EC ç§é’¥)ï¼šserver.key TLS è¯ä¹¦ï¼ˆåŒ…å«å…¬é’¥ï¼‰ï¼šserver.crt ä¸€èˆ¬å¦‚ Nginx ç­‰æœåŠ¡ç«¯åº”ç”¨ï¼Œéƒ½å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶æŒ‡å®šè¿™ä¸¤ä¸ªæ–‡ä»¶çš„ä½ç½®ã€‚ä¿®æ”¹é…ç½®åé‡æ–°å¯åŠ¨ï¼Œå°±æœ‰ TLS äº†ï¼Œå¯ä»¥é€šè¿‡ https åè®®è®¿é—®æµ‹è¯•ã€‚ 1.1 å®Œç¾å‰å‘ä¿å¯† æ—§ç‰ˆæœ¬çš„ TLS åè®®å¹¶ä¸ä¸€å®šèƒ½ä¿è¯å‰å‘ä¿å¯†ï¼Œä¸ºäº†ä¿è¯å‰å‘å®‰å…¨ï¼Œéœ€è¦åœ¨æœåŠ¡ç«¯é…ç½®ä¸­è¿›è¡Œä¸€å®šè®¾ç½®ã€‚ å…·ä½“çš„è®¾ç½®æ–¹æ³•å‚è§ ssl-config - mozillaï¼Œè¯¥ç½‘ç«™æä¾›ä¸‰ä¸ªå®‰å…¨ç­‰çº§çš„é…ç½®ï¼š ã€ŒIntermediateã€ï¼šæŸ¥çœ‹ç”Ÿæˆå‡ºçš„ ssl-cipher å±æ€§ï¼Œå‘ç°å®ƒåªæ”¯æŒ ECDHE/DHE å¼€å¤´çš„ç®—æ³•ã€‚å› æ­¤å®ƒä¿è¯å‰å‘ä¿å¯†ã€‚ å¯¹äºéœ€è¦é€šè¿‡æµè§ˆå™¨è®¿é—®çš„ APIï¼Œæ¨èé€‰æ‹©è¿™ä¸ªç­‰çº§ã€‚ ã€ŒMordernã€ï¼šåªæ”¯æŒ TLSv1.3ï¼Œè¯¥åè®®åºŸå¼ƒæ‰äº†è¿‡å¾€æ‰€æœ‰ä¸å®‰å…¨çš„ç®—æ³•ï¼Œä¿è¯å‰å‘ä¿å¯†ï¼Œå®‰å…¨æ€§æé«˜ï¼Œæ€§èƒ½ä¹Ÿæ›´å¥½ã€‚ å¯¹äºä¸éœ€è¦é€šè¿‡æµè§ˆå™¨ç­‰æ—§ç»ˆç«¯è®¿é—®çš„ APIï¼Œè¯·ç›´æ¥é€‰æ‹©è¿™ä¸ªç­‰çº§ã€‚ ã€ŒOldã€ï¼šé™¤éä½ çš„ç”¨æˆ·ä½¿ç”¨éå¸¸è€çš„ç»ˆç«¯è¿›è¡Œè®¿é—®ï¼Œå¦åˆ™è¯·ä¸è¦è€ƒè™‘è¿™ä¸ªé€‰é¡¹ï¼ å¦å¤–é˜¿é‡Œäº‘è´Ÿè½½å‡è¡¡å™¨é…ç½®å‰å‘ä¿å¯†çš„æ–¹æ³•å‚è§ï¼šç®¡ç†TLSå®‰å…¨ç­–ç•¥ - è´Ÿè½½å‡è¡¡ - é˜¿é‡Œäº‘æ–‡æ¡£ ","date":"2021-01-17","objectID":"/posts/about-tls-cert/:5:1","tags":["HTTPS","TLS","OpenSSL","åŠ å¯†","ç ´è§£"],"title":"TLS åè®®ã€TLS è¯ä¹¦ã€TLS è¯ä¹¦çš„é…ç½®æ–¹æ³•ã€TLS åŠ å¯†çš„ç ´è§£æ‰‹æ®µ","uri":"/posts/about-tls-cert/"},{"categories":["æŠ€æœ¯"],"content":"2. å®¢æˆ·ç«¯çš„ TLS è¯ä¹¦é…ç½®ï¼ˆé’ˆå¯¹æœ¬åœ°ç­¾åçš„è¯ä¹¦ï¼‰ å¦‚æœä½ åœ¨è¯ä¹¦ä¸æ˜¯æƒå¨ CA æœºæ„é¢å‘çš„ï¼ˆæ¯”å¦‚æ˜¯ä¸€ä¸ªè‡ªç­¾åè¯ä¹¦ï¼‰ï¼Œé‚£å°±éœ€è¦åœ¨å®¢æˆ·ç«¯å°†è¿™ä¸ª TLS è¯ä¹¦æ·»åŠ åˆ°å—ä¿¡è¯ä¹¦åˆ—è¡¨ä¸­ã€‚ è¿™ä¸ªæ­¥éª¤å¯ä»¥åœ¨ OS å±‚é¢è¿›è¡Œâ€”â€”æ·»åŠ åˆ° OS çš„é»˜è®¤è¯ä¹¦åˆ—è¡¨ä¸­ï¼Œä¹Ÿå¯ä»¥åœ¨ä»£ç å±‚é¢å®Œæˆâ€”â€”æŒ‡å®šä½¿ç”¨æŸä¸ªè¯ä¹¦è¿›è¡Œ TLS éªŒè¯ã€‚ Linux: ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å®‰è£…è¯ä¹¦ sudo cp ca.crt /usr/local/share/ca-certificates/server.crt sudo update-ca-certificates Windows: é€šè¿‡è¯ä¹¦ç®¡ç†å™¨ certmgr.msc å°†è¯ä¹¦å®‰è£…åˆ° å—ä¿¡ä»»çš„æ ¹è¯ä¹¦é¢å‘æœºæ„ï¼ŒChrome çš„å°é”å°±èƒ½å˜ç»¿äº†ã€‚ ç¼–ç¨‹ï¼šä½¿ç”¨ HTTPS å®¢æˆ·ç«¯çš„ api æŒ‡å®šä½¿ç”¨çš„ TLS è¯ä¹¦ Docker-Client: å‚è§ Use self-signed certificates - Docker Docs 2.1 è¯ä¹¦é”å®š(Certifacte Pining)æŠ€æœ¯ å³ä½¿ä½¿ç”¨äº† TLS åè®®å¯¹æµé‡è¿›è¡ŒåŠ å¯†ï¼Œå¹¶ä¸”ä¿è¯äº†å‰å‘ä¿å¯†ï¼Œä¹Ÿæ— æ³•ä¿è¯æµé‡ä¸è¢«ä»£ç†ï¼ è¿™æ˜¯å› ä¸ºå®¢æˆ·ç«¯å¤§å¤šæ˜¯ç›´æ¥ä¾é äº†æ“ä½œç³»ç»Ÿå†…ç½®çš„è¯ä¹¦é“¾è¿›è¡Œ TLS è¯ä¹¦éªŒè¯ï¼Œè€Œ Fiddler ç­‰ä»£ç†å·¥å…·å¯ä»¥å°†è‡ªå·±çš„ TLS è¯ä¹¦æ·»åŠ åˆ°è¯¥è¯ä¹¦é“¾ä¸­ã€‚ ä¸ºäº†é˜²æ­¢æµé‡è¢« Fiddler ç­‰å·¥å…·ä½¿ç”¨ä¸Šè¿°æ–¹å¼ç›‘å¬æµé‡ï¼Œå‡ºç°äº†ã€Œè¯ä¹¦é”å®šã€æŠ€æœ¯ã€‚ æ–¹æ³•æ˜¯åœ¨å®¢æˆ·ç«¯ä¸­ç¡¬ç¼–ç è¯ä¹¦çš„æŒ‡çº¹ï¼ˆHashå€¼ï¼Œæˆ–è€…ç›´æ¥ä¿å­˜æ•´ä¸ªè¯ä¹¦çš„å†…å®¹ä¹Ÿè¡Œï¼‰ï¼Œåœ¨å»ºç«‹ TLS è¿æ¥å‰ï¼Œå…ˆè®¡ç®—ä½¿ç”¨çš„è¯ä¹¦çš„æŒ‡çº¹æ˜¯å¦åŒ¹é…ï¼Œå¦åˆ™å°±ä¸­æ–­è¿æ¥ã€‚ è¿™ç§é”å®šæ–¹å¼éœ€è¦ä»¥ä¸‹å‡ ä¸ªå‰ææ‰èƒ½ç¡®ä¿æµé‡ä¸è¢«ç›‘å¬ï¼š å®¢æˆ·ç«¯ä¸­ç¡¬ç¼–ç çš„è¯ä¹¦æŒ‡çº¹ä¸ä¼šè¢«ç¯¡æ”¹ã€‚ æŒ‡çº¹éªŒè¯ä¸èƒ½è¢«ç»•è¿‡ã€‚ ç›®å‰æœ‰å…¬å¼€æŠ€æœ¯ï¼ˆXPosed+JustTrustMeï¼‰èƒ½ç ´è§£ Android ä¸Šå¸¸è§çš„ HTTPS è¯·æ±‚åº“ï¼Œç›´æ¥ç»•è¿‡è¯ä¹¦æ£€æŸ¥ã€‚ é’ˆå¯¹ä¸Šè¿°é—®é¢˜ï¼Œå¯ä»¥è€ƒè™‘åŠ å¤§ç»•è¿‡çš„éš¾åº¦ã€‚æˆ–è€… App æ£€æµ‹è‡ªå·±æ˜¯å¦è¿è¡Œåœ¨ Xposed ç­‰è™šæ‹Ÿç¯å¢ƒä¸‹ã€‚ ç”¨äº TLS åè®®çš„è¯ä¹¦ä¸ä¼šé¢‘ç¹æ›´æ¢ã€‚ï¼ˆå¦‚æœæ›´æ¢äº†ï¼ŒæŒ‡çº¹å°±å¯¹ä¸ä¸Šäº†ã€‚ï¼‰ è€Œå¯¹äºç¬¬ä¸‰æ–¹çš„ APIï¼Œå› ä¸ºæˆ‘ä»¬ä¸çŸ¥é“å®ƒä»¬ä¼šä¸ä¼šæ›´æ¢ TLS è¯ä¹¦ï¼Œå°±ä¸èƒ½ç›´æ¥å°†è¯ä¹¦æŒ‡çº¹ç¡¬ç¼–ç åœ¨å®¢æˆ·ç«¯ä¸­ã€‚ è¿™æ—¶å¯ä»¥è€ƒè™‘ä»æœåŠ¡ç«¯è·å–è¿™äº› API çš„è¯ä¹¦æŒ‡çº¹ï¼ˆé™„å¸¦ç§é’¥ç­¾åç”¨äºé˜²ä¼ªé€ ï¼‰ã€‚ ä¸ºäº†å®ç°è¯ä¹¦çš„è½®è½¬(rotation)ï¼Œå¯ä»¥åœ¨æ–°ç‰ˆæœ¬çš„å®¢æˆ·ç«¯ä¸­åŒ…å«å¤šä¸ªè¯ä¹¦æŒ‡çº¹ï¼Œè¿™æ ·èƒ½ä¿è¯åŒæ—¶æœ‰å¤šä¸ªå¯ä¿¡è¯ä¹¦ï¼Œè¾¾æˆè¯ä¹¦çš„è½®è½¬ã€‚ï¼ˆç±»æ¯” JWT çš„å…¬é’¥è½®è½¬æœºåˆ¶ï¼‰ è¯ä¹¦é”å®šæŠ€æœ¯å‡ ä¹ç­‰åŒäº SSH åè®®çš„ StrictHostKeyChecking é€‰é¡¹ï¼Œå®¢æˆ·ç«¯ä¼šéªŒè¯æœåŠ¡ç«¯çš„å…¬é’¥æŒ‡çº¹ï¼ˆkey fingerprintï¼‰ï¼ŒéªŒè¯ä¸é€šè¿‡åˆ™æ–­å¼€è¿æ¥ã€‚ 2.2 å…¬é’¥é”å®š(Public Key Pining) å‰é¢æåˆ°è¿‡ï¼ŒTLS è¯ä¹¦å…¶å®å°±æ˜¯å…¬é’¥+ç”³è¯·è€…(ä½ )å’Œé¢å‘è€…(CA)çš„ä¿¡æ¯+ç­¾å(ä½¿ç”¨ CA ç§é’¥åŠ å¯†)ï¼Œå› æ­¤æˆ‘ä»¬ä¹Ÿå¯ä»¥è€ƒè™‘åªé”å®šå…¶ä¸­çš„å…¬é’¥ã€‚ ã€Œå…¬é’¥é”å®šã€æ¯”ã€Œè¯ä¹¦é”å®šã€æ›´çµæ´»ï¼Œè¿™æ ·è¯ä¹¦æœ¬èº«å…¶å®å°±å¯ä»¥ç›´æ¥è½®è½¬äº†ï¼ˆè¯ä¹¦æœ‰è¿‡æœŸæ—¶é—´ï¼‰ï¼Œè€Œä¸éœ€è¦ä¸€ä¸ªæ—§è¯ä¹¦å’Œæ–°è¯ä¹¦å…±å­˜çš„ä¸­é—´æ—¶æœŸã€‚ å¦‚æœä¸è€ƒè™‘å®ç°éš¾åº¦çš„è¯ï¼Œã€Œå…¬é’¥é”å®šã€æ˜¯æ›´æ¨èçš„æŠ€æœ¯ã€‚ ","date":"2021-01-17","objectID":"/posts/about-tls-cert/:5:2","tags":["HTTPS","TLS","OpenSSL","åŠ å¯†","ç ´è§£"],"title":"TLS åè®®ã€TLS è¯ä¹¦ã€TLS è¯ä¹¦çš„é…ç½®æ–¹æ³•ã€TLS åŠ å¯†çš„ç ´è§£æ‰‹æ®µ","uri":"/posts/about-tls-cert/"},{"categories":["æŠ€æœ¯"],"content":"äº”ã€TLS åŒå‘è®¤è¯(Mutual TLS authentication, mTLS) TLS åè®®ï¼ˆtls1.0+ï¼ŒRFC: TLS1.2 - RFC5246ï¼‰ä¸­ï¼Œå®šä¹‰äº†æœåŠ¡ç«¯è¯·æ±‚éªŒè¯å®¢æˆ·ç«¯è¯ä¹¦çš„æ–¹æ³•ã€‚è¿™ ä¸ªæ–¹æ³•æ˜¯å¯é€‰çš„ã€‚å¦‚æœä½¿ç”¨ä¸Šè¿™ä¸ªæ–¹æ³•ï¼Œé‚£å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å°±ä¼šåœ¨ TLS åè®®çš„æ¡æ‰‹é˜¶æ®µè¿›è¡Œäº’ç›¸è®¤è¯ã€‚è¿™ç§éªŒè¯æ–¹å¼è¢«ç§°ä¸ºåŒå‘ TLS è®¤è¯(mTLS, mutual TLS)ã€‚ ä¼ ç»Ÿçš„ã€ŒTLS å•å‘è®¤è¯ã€æŠ€æœ¯ï¼Œåªåœ¨å®¢æˆ·ç«¯å»éªŒè¯æœåŠ¡ç«¯æ˜¯å¦å¯ä¿¡ã€‚ è€Œã€ŒTLS åŒå‘è®¤è¯ï¼ˆmTLSï¼‰ã€ï¼Œåˆ™æ·»åŠ äº†æœåŠ¡ç«¯éªŒè¯å®¢æˆ·ç«¯æ˜¯å¦å¯ä¿¡çš„æ­¥éª¤ï¼ˆç¬¬ä¸‰æ­¥ï¼‰ï¼š å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚ ã€ŒéªŒè¯æœåŠ¡ç«¯æ˜¯å¦å¯ä¿¡ã€ï¼šæœåŠ¡ç«¯å°†è‡ªå·±çš„ TLS è¯ä¹¦å‘é€ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯é€šè¿‡è‡ªå·±çš„ CA è¯ä¹¦é“¾éªŒè¯è¿™ä¸ªæœåŠ¡ç«¯è¯ä¹¦ã€‚ ã€ŒéªŒè¯å®¢æˆ·ç«¯æ˜¯å¦å¯ä¿¡ã€ï¼šå®¢æˆ·ç«¯å°†è‡ªå·±çš„ TLS è¯ä¹¦å‘é€ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯ä½¿ç”¨å®ƒçš„ CA è¯ä¹¦é“¾éªŒè¯è¯¥å®¢æˆ·ç«¯è¯ä¹¦ã€‚ åå•†å¯¹ç§°åŠ å¯†ç®—æ³•åŠå¯†é’¥ ä½¿ç”¨å¯¹ç§°åŠ å¯†è¿›è¡Œåç»­é€šä¿¡ã€‚ å› ä¸ºç›¸æ¯”ä¼ ç»Ÿçš„ TLSï¼ŒmTLS åªæ˜¯æ·»åŠ äº†ã€ŒéªŒè¯å®¢æˆ·ç«¯ã€è¿™æ ·ä¸€ä¸ªæ­¥éª¤ï¼Œæ‰€ä»¥è¿™é¡¹æŠ€æœ¯ä¹Ÿè¢«ç§°ä¸ºã€ŒClient Autheticationã€. mTLS éœ€è¦ç”¨åˆ°ä¸¤å¥— TLS è¯ä¹¦ï¼š æœåŠ¡ç«¯è¯ä¹¦ï¼šè¿™ä¸ªè¯ä¹¦ç­¾åå·²ç»ä»‹ç»è¿‡äº†ã€‚ å®¢æˆ·ç«¯è¯ä¹¦ï¼šå®¢æˆ·ç«¯è¯ä¹¦è²Œä¼¼å¯¹è¯ä¹¦ä¿¡æ¯ï¼ˆå¦‚ CN/SAN åŸŸåï¼‰æ²¡æœ‰ä»»ä½•è¦æ±‚ï¼Œåªè¦è¯ä¹¦èƒ½é€šè¿‡ CA ç­¾åéªŒè¯å°±è¡Œã€‚ ä½¿ç”¨ openssl ç”Ÿæˆ TLS å®¢æˆ·ç«¯è¯ä¹¦ï¼ˆca å’Œ csr.conf å¯ä»¥ç›´æ¥ä½¿ç”¨å‰é¢ç”ŸæˆæœåŠ¡ç«¯è¯ä¹¦ç”¨åˆ°çš„ï¼Œä¹Ÿå¯ä»¥å¦å¤–ç”Ÿæˆï¼‰ï¼š # 1. ç”Ÿæˆ 2048 ä½ çš„ RSA å¯†é’¥ openssl genrsa -out client.key 2048 # 2. é€šè¿‡ç¬¬ä¸€æ­¥ç¼–å†™çš„é…ç½®æ–‡ä»¶ï¼Œç”Ÿæˆè¯ä¹¦ç­¾åè¯·æ±‚ openssl req -new -key client.key -out client.csr -config csr.conf # 3. ç”Ÿæˆæœ€ç»ˆçš„è¯ä¹¦ï¼Œè¿™é‡ŒæŒ‡å®šè¯ä¹¦æœ‰æ•ˆæœŸ 3650 å¤© ### ä½¿ç”¨å‰é¢ç”Ÿæˆçš„ ca è¯ä¹¦å¯¹å®¢æˆ·ç«¯è¯ä¹¦è¿›è¡Œç­¾åï¼ˆå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å…±ç”¨ ca è¯ä¹¦ï¼‰ openssl x509 -req -in client.csr -CA ca.crt -CAkey ca.key \\ -CAcreateserial -out client.crt -days 3650 \\ -extensions v3_ext -extfile csr.conf mTLS çš„åº”ç”¨åœºæ™¯ä¸»è¦åœ¨ã€Œé›¶ä¿¡ä»»ç½‘ç»œæ¶æ„ã€ï¼Œæˆ–è€…å«ã€Œæ— è¾¹ç•Œç½‘ç»œã€ä¸­ã€‚ æ¯”å¦‚å¾®æœåŠ¡ä¹‹é—´çš„äº’ç›¸è®¿é—®ï¼Œå°±å¯ä»¥ä½¿ç”¨ mTLSã€‚ è¿™æ ·å°±èƒ½ä¿è¯æ¯ä¸ª RPC è°ƒç”¨çš„å®¢æˆ·ç«¯ï¼Œéƒ½æ˜¯å…¶ä»–å¾®æœåŠ¡ï¼ˆæˆ–è€…åˆ«çš„å¯ä¿¡æ–¹ï¼‰ï¼Œé˜²æ­¢é»‘å®¢å…¥ä¾µåä¸ºæ‰€æ¬²ä¸ºã€‚ ç›®å‰æŸ¥åˆ°å¦‚ä¸‹å‡ ä¸ªWebæœåŠ¡å™¨/ä»£ç†æ”¯æŒ mTLS: Traefik: Docs - Client Authentication (mTLS) Nginx: Using NGINX Reverse Proxy for client certificate authentication ä¸»è¦å‚æ•°æ˜¯ä¸¤ä¸ªï¼šssl_client_certificate /etc/nginx/client-ca.pem å’Œ ssl_verify_client on ","date":"2021-01-17","objectID":"/posts/about-tls-cert/:6:0","tags":["HTTPS","TLS","OpenSSL","åŠ å¯†","ç ´è§£"],"title":"TLS åè®®ã€TLS è¯ä¹¦ã€TLS è¯ä¹¦çš„é…ç½®æ–¹æ³•ã€TLS åŠ å¯†çš„ç ´è§£æ‰‹æ®µ","uri":"/posts/about-tls-cert/"},{"categories":["æŠ€æœ¯"],"content":"mTLS çš„å®‰å…¨æ€§ å¦‚æœå°† mTLS ç”¨åœ¨ App å®‰å…¨ä¸Šï¼Œå­˜åœ¨çš„é£é™©æ˜¯ï¼š å®¢æˆ·ç«¯ä¸­éšè—çš„è¯ä¹¦æ˜¯å¦å¯ä»¥è¢«æå–å‡ºæ¥ï¼Œæˆ–è€…é»‘å®¢èƒ½å¦ Hook è¿› App ä¸­ï¼Œç›´æ¥ä½¿ç”¨è¯ä¹¦å‘é€ä¿¡æ¯ã€‚ å¦‚æœå®¢æˆ·ç«¯ç§é’¥è®¾ç½®äº†ã€Œå¯†ç ï¼ˆpassphraseï¼‰ã€ï¼Œé‚£è¿™ä¸ªå¯†ç æ˜¯å¦èƒ½å¾ˆå®¹æ˜“è¢«é€†å‘å‡ºæ¥ï¼Ÿ mTLS å’Œã€Œå…¬é’¥é”å®š/è¯ä¹¦é”å®šã€å¯¹æ¯”ï¼š å…¬é’¥é”å®š/è¯ä¹¦é”å®šï¼šåªåœ¨å®¢æˆ·ç«¯è¿›è¡ŒéªŒè¯ã€‚ ä½†æ˜¯åœ¨æœåŠ¡ç«¯æ²¡æœ‰è¿›è¡ŒéªŒè¯ã€‚è¿™æ ·å°±æ— æ³•é‰´åˆ«å¹¶æ‹’ç»ç¬¬ä¸‰æ–¹åº”ç”¨ï¼ˆçˆ¬è™«ï¼‰çš„è¯·æ±‚ã€‚ åŠ å¼ºå®‰å…¨çš„æ–¹æ³•ï¼Œæ˜¯é€šè¿‡æŸç§ç®—æ³•ç”ŸæˆåŠ¨æ€çš„ç­¾åã€‚çˆ¬è™«ç”Ÿæˆä¸å‡ºæ¥è¿™ä¸ªç­¾åï¼Œè¯·æ±‚å°±è¢«æ‹’ç»ã€‚ mTLS: æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯éƒ½è¦éªŒè¯å¯¹æ–¹ã€‚ ä¿è¯åŒè¾¹å¯ä¿¡ï¼Œåœ¨å®¢æˆ·ç«¯è¯ä¹¦ä¸è¢«ç ´è§£çš„æƒ…å†µä¸‹ï¼Œå°±èƒ½ Ban æ‰æ‰€æœ‰çš„çˆ¬è™«æˆ–ä»£ç†æŠ€æœ¯ã€‚ ","date":"2021-01-17","objectID":"/posts/about-tls-cert/:6:1","tags":["HTTPS","TLS","OpenSSL","åŠ å¯†","ç ´è§£"],"title":"TLS åè®®ã€TLS è¯ä¹¦ã€TLS è¯ä¹¦çš„é…ç½®æ–¹æ³•ã€TLS åŠ å¯†çš„ç ´è§£æ‰‹æ®µ","uri":"/posts/about-tls-cert/"},{"categories":["æŠ€æœ¯"],"content":"å…­ TLS åè®®çš„ç ´è§£æ‰‹æ®µ ","date":"2021-01-17","objectID":"/posts/about-tls-cert/:7:0","tags":["HTTPS","TLS","OpenSSL","åŠ å¯†","ç ´è§£"],"title":"TLS åè®®ã€TLS è¯ä¹¦ã€TLS è¯ä¹¦çš„é…ç½®æ–¹æ³•ã€TLS åŠ å¯†çš„ç ´è§£æ‰‹æ®µ","uri":"/posts/about-tls-cert/"},{"categories":["æŠ€æœ¯"],"content":"1. å®¢æˆ·ç«¯é€†å‘/ç ´è§£æ‰‹æ®µæ€»ç»“ è¦è·å–ä¸€ä¸ªåº”ç”¨çš„æ•°æ®ï¼Œæœ‰ä¸¤ä¸ªæ–¹å‘ï¼š æœåŠ¡ç«¯å…¥ä¾µï¼šç°ä»£åº”ç”¨çš„æœåŠ¡ç«¯çªç ´éš¾åº¦é€šå¸¸éƒ½æ¯”è¾ƒå®¢æˆ·ç«¯é«˜ï¼Œæ³¨å…¥ç­‰æ¼æ´åº•å±‚æ¡†æ¶å°±æœ‰å¤„ç†ã€‚ å®¢æˆ·ç«¯é€†å‘+çˆ¬è™«ï¼šå®¢æˆ·ç«¯æ˜¯ç¦»ç”¨æˆ·æœ€è¿‘çš„åœ°æ–¹ï¼Œä¹Ÿæ˜¯æœ€å®¹æ˜“è¢«çªç ´çš„åœ°æ–¹ã€‚ mTLS å¸¸è§çš„ç ´è§£æ‰‹æ®µï¼Œæ˜¯æ‰¾åˆ°è€ç‰ˆæœ¬çš„å®‰è£…åŒ…ï¼Œå‘ç°å¾ˆå®¹æ˜“å°±èƒ½æå–å‡ºå®¢æˆ·ç«¯è¯ä¹¦ã€‚ã€‚ å¾…ç»­ ","date":"2021-01-17","objectID":"/posts/about-tls-cert/:7:1","tags":["HTTPS","TLS","OpenSSL","åŠ å¯†","ç ´è§£"],"title":"TLS åè®®ã€TLS è¯ä¹¦ã€TLS è¯ä¹¦çš„é…ç½®æ–¹æ³•ã€TLS åŠ å¯†çš„ç ´è§£æ‰‹æ®µ","uri":"/posts/about-tls-cert/"},{"categories":["æŠ€æœ¯"],"content":"ä¸ƒã€é€šè¿‡ OpenSSL å¯¹ TLS è¯ä¹¦è¿›è¡Œ CURDï¼ˆå¢åˆ æŸ¥æ”¹ï¼‰ ","date":"2021-01-17","objectID":"/posts/about-tls-cert/:8:0","tags":["HTTPS","TLS","OpenSSL","åŠ å¯†","ç ´è§£"],"title":"TLS åè®®ã€TLS è¯ä¹¦ã€TLS è¯ä¹¦çš„é…ç½®æ–¹æ³•ã€TLS åŠ å¯†çš„ç ´è§£æ‰‹æ®µ","uri":"/posts/about-tls-cert/"},{"categories":["æŠ€æœ¯"],"content":"1. æŸ¥è¯¢ä¸éªŒè¯ # æŸ¥çœ‹è¯ä¹¦(crt)ä¿¡æ¯ openssl x509 -noout -text -in server.crt # æŸ¥çœ‹è¯ä¹¦è¯·æ±‚(csr)ä¿¡æ¯ openssl req -noout -text -in server.csr # æŸ¥çœ‹ RSA ç§é’¥(key)ä¿¡æ¯ openssl rsa -noout -text -in server.key # éªŒè¯è¯ä¹¦æ˜¯å¦å¯ä¿¡ ## 1. ä½¿ç”¨ç³»ç»Ÿçš„è¯ä¹¦é“¾è¿›è¡ŒéªŒè¯ã€‚å› ä¸ºæ˜¯è‡ªç­¾åè¯ä¹¦ï¼Œä¼šéªŒè¯å¤±è´¥ openssl verify server.crt ## 2. ä½¿ç”¨ ca.crt è¿›è¡ŒéªŒè¯ã€‚éªŒè¯æˆåŠŸã€‚ openssl verify -CAfile ca.crt server.crt ","date":"2021-01-17","objectID":"/posts/about-tls-cert/:8:1","tags":["HTTPS","TLS","OpenSSL","åŠ å¯†","ç ´è§£"],"title":"TLS åè®®ã€TLS è¯ä¹¦ã€TLS è¯ä¹¦çš„é…ç½®æ–¹æ³•ã€TLS åŠ å¯†çš„ç ´è§£æ‰‹æ®µ","uri":"/posts/about-tls-cert/"},{"categories":["æŠ€æœ¯"],"content":"2. è¯ä¹¦æ ¼å¼è½¬æ¢ openssl æ¨¡å¼ä½¿ç”¨ PEM æ ¼å¼çš„è¯ä¹¦ï¼Œè¿™ä¸ªè¯ä¹¦æ ¼å¼å°†è¯ä¹¦ç¼–ç ä¸º base64 æ ¼å¼è¿›è¡Œä¿å­˜ã€‚ å¦å¤–ä¸€ç±»ä½¿ç”¨å¹¿æ³›çš„è¯ä¹¦ï¼Œæ˜¯ PKCS#12ã€PKCS#8ï¼Œä»¥åŠ Windows ä¸Šå¸¸ç”¨çš„ DER æ ¼å¼ã€‚ # pem æ ¼å¼è½¬ pkcs12ï¼Œå…¬é’¥å’Œç§é’¥éƒ½æ”¾é‡Œé¢ openssl pkcs12 -export -in client.crt -inkey client.key -out client.p12 # æŒ‰æç¤ºè¾“å…¥ä¿æŠ¤å¯†ç  æˆ–è€… p12 è½¬ pem: openssl pkcs12 -in xxx.p12 -out xxx.crt -clcerts -nokeys openssl pkcs12 -in xxx.p12 -out xxx.key -nocerts -nodes å¾®ä¿¡/æ”¯ä»˜å®ç­‰æ”¯ä»˜ç›¸å…³çš„æ•°å­—è¯ä¹¦ï¼Œé€šå¸¸å°±ä½¿ç”¨ pkcs12 æ ¼å¼ï¼Œä½¿ç”¨å•†æˆ·å·åšåŠ å¯†å¯†ç ï¼Œç„¶åç¼–ç ä¸º base64 å†æä¾›ç»™ç”¨æˆ·ã€‚ ","date":"2021-01-17","objectID":"/posts/about-tls-cert/:8:2","tags":["HTTPS","TLS","OpenSSL","åŠ å¯†","ç ´è§£"],"title":"TLS åè®®ã€TLS è¯ä¹¦ã€TLS è¯ä¹¦çš„é…ç½®æ–¹æ³•ã€TLS åŠ å¯†çš„ç ´è§£æ‰‹æ®µ","uri":"/posts/about-tls-cert/"},{"categories":["æŠ€æœ¯"],"content":"å‚è€ƒ ","date":"2021-01-17","objectID":"/posts/about-tls-cert/:9:0","tags":["HTTPS","TLS","OpenSSL","åŠ å¯†","ç ´è§£"],"title":"TLS åè®®ã€TLS è¯ä¹¦ã€TLS è¯ä¹¦çš„é…ç½®æ–¹æ³•ã€TLS åŠ å¯†çš„ç ´è§£æ‰‹æ®µ","uri":"/posts/about-tls-cert/"},{"categories":["æŠ€æœ¯"],"content":"TLS åè®® HTTPS æ¸©æ•…çŸ¥æ–°ï¼ˆä¸‰ï¼‰ â€”â€” ç›´è§‚æ„Ÿå— TLS æ¡æ‰‹æµç¨‹(ä¸Š) HTTPS æ¸©æ•…çŸ¥æ–°ï¼ˆäº”ï¼‰ â€”â€” TLS ä¸­çš„å¯†é’¥è®¡ç®— ","date":"2021-01-17","objectID":"/posts/about-tls-cert/:9:1","tags":["HTTPS","TLS","OpenSSL","åŠ å¯†","ç ´è§£"],"title":"TLS åè®®ã€TLS è¯ä¹¦ã€TLS è¯ä¹¦çš„é…ç½®æ–¹æ³•ã€TLS åŠ å¯†çš„ç ´è§£æ‰‹æ®µ","uri":"/posts/about-tls-cert/"},{"categories":["æŠ€æœ¯"],"content":"TLS è¯ä¹¦ Certificates - Kubernetes Docs TLS/HTTPS è¯ä¹¦ç”Ÿæˆä¸éªŒè¯ ECCä½œä¸ºSSL/TLSè¯ä¹¦åŠ å¯†ç®—æ³•çš„ä¼˜åŠ¿ ECCè¯ä¹¦çš„ç”Ÿæˆå’ŒéªŒç­¾ å‰å‘ä¿å¯†(Forward Secrecy) - WikiPedia è¯ä¹¦é€‰å‹å’Œè´­ä¹° - é˜¿é‡Œäº‘æ–‡æ¡£ äº‘åŸç”Ÿå®‰å…¨ç ´å±€ï½œå¦‚ä½•ç®¡ç†å‘¨æœŸè¶Šæ¥è¶ŠçŸ­çš„æ•°å­—è¯ä¹¦ï¼Ÿ å¦å¤–ä¸¤ä¸ªå…³äº CN(Common Name) å’Œ SAN(Subject Altnative Name) çš„é—®ç­”ï¼š Can not get rid of net::ERR_CERT_COMMON_NAME_INVALID error in chrome with self-signed certificates SSL - How do Common Names (CN) and Subject Alternative Names (SAN) work together? å…³äºè¯ä¹¦é”å®š/å…¬é’¥é”å®šæŠ€æœ¯ï¼š Certificate and Public Key Pinning - OWASP Difference between certificate pinning and public key pinning åŠ å¯†/ç­¾åç®—æ³•ç›¸å…³ï¼š RSAç®—æ³•åŸç†ï¼ˆäºŒï¼‰ å…¶ä»–ï¼š OpenSSL ManPage openssl æŸ¥çœ‹è¯ä¹¦ ","date":"2021-01-17","objectID":"/posts/about-tls-cert/:9:2","tags":["HTTPS","TLS","OpenSSL","åŠ å¯†","ç ´è§£"],"title":"TLS åè®®ã€TLS è¯ä¹¦ã€TLS è¯ä¹¦çš„é…ç½®æ–¹æ³•ã€TLS åŠ å¯†çš„ç ´è§£æ‰‹æ®µ","uri":"/posts/about-tls-cert/"},{"categories":["æŠ€æœ¯"],"content":"QEMU/KVM è™šæ‹ŸåŒ– QEMU/KVM æ˜¯ç›®å‰æœ€æµè¡Œçš„è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œå®ƒåŸºäº Linux å†…æ ¸æä¾›çš„ kvm æ¨¡å—ï¼Œç»“æ„ç²¾ç®€ï¼Œæ€§èƒ½æŸå¤±å°ï¼Œè€Œä¸”å¼€æºå…è´¹ï¼ˆå¯¹æ¯”æ”¶è´¹çš„ vmwareï¼‰ï¼Œå› æ­¤æˆäº†å¤§éƒ¨åˆ†ä¼ä¸šçš„é¦–é€‰è™šæ‹ŸåŒ–æ–¹æ¡ˆã€‚ ç›®å‰å„å¤§äº‘å‚å•†çš„è™šæ‹ŸåŒ–æ–¹æ¡ˆï¼Œæ–°çš„æœåŠ¡å™¨å®ä¾‹åŸºæœ¬éƒ½æ˜¯ç”¨çš„ KVM æŠ€æœ¯ã€‚å³ä½¿æ˜¯èµ·æ­¥æœ€æ—©ï¼Œä¸€ç›´é‡åº¦ä½¿ç”¨ Xen çš„ AWSï¼Œä» EC2 C5 å¼€å§‹å°±æ”¹ç”¨äº†åŸºäº KVM å®šåˆ¶çš„ Nitro è™šæ‹ŸåŒ–æŠ€æœ¯ã€‚ ä½†æ˜¯ KVM ä½œä¸ºä¸€ä¸ªä¼ä¸šçº§çš„åº•å±‚è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œå´æ²¡æœ‰å¯¹æ¡Œé¢ä½¿ç”¨åšæ·±å…¥çš„ä¼˜åŒ–ï¼Œå› æ­¤å¦‚æœæƒ³æŠŠå®ƒå½“æˆæ¡Œé¢è™šæ‹ŸåŒ–è½¯ä»¶æ¥ä½¿ç”¨ï¼Œæ›¿ä»£æ‰ VirtualBox/VMwareï¼Œæœ‰ä¸€å®šéš¾åº¦ã€‚ æœ¬æ–‡æ˜¯æˆ‘ä¸ªäººå­¦ä¹  KVM çš„ä¸€ä¸ªæ€»ç»“æ€§æ–‡æ¡£ï¼Œå…¶ç›®æ ‡æ˜¯ä½¿ç”¨ KVM ä½œä¸ºæ¡Œé¢è™šæ‹ŸåŒ–è½¯ä»¶ã€‚ ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:1:0","tags":["è™šæ‹ŸåŒ–","KVM","libvirt","QEMU"],"title":"QEMU-KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/"},{"categories":["æŠ€æœ¯"],"content":"ä¸€ã€å®‰è£… QUEU/KVM QEMU/KVM ç¯å¢ƒéœ€è¦å®‰è£…å¾ˆå¤šçš„ç»„ä»¶ï¼Œå®ƒä»¬å„å¸å…¶èŒï¼š qemu: æ¨¡æ‹Ÿå„ç±»è¾“å…¥è¾“å‡ºè®¾å¤‡ï¼ˆç½‘å¡ã€ç£ç›˜ã€USBç«¯å£ç­‰ï¼‰ qemu åº•å±‚ä½¿ç”¨ kvm æ¨¡æ‹Ÿ CPU å’Œ RAMï¼Œæ¯”è½¯ä»¶æ¨¡æ‹Ÿçš„æ–¹å¼å¿«å¾ˆå¤šã€‚ libvirt: æä¾›ç®€å•ä¸”ç»Ÿä¸€çš„å·¥å…·å’Œ APIï¼Œç”¨äºç®¡ç†è™šæ‹Ÿæœºï¼Œå±è”½äº†åº•å±‚çš„å¤æ‚ç»“æ„ã€‚ï¼ˆæ”¯æŒ qemu-kvm/virtualbox/vmwareï¼‰ ovmf: ä¸ºè™šæ‹Ÿæœºå¯ç”¨ UEFI æ”¯æŒ virt-manager: ç”¨äºç®¡ç†è™šæ‹Ÿæœºçš„ GUI ç•Œé¢ï¼ˆå¯ä»¥ç®¡ç†è¿œç¨‹ kvm ä¸»æœºï¼‰ã€‚ virt-viewer: é€šè¿‡ GUI ç•Œé¢ç›´æ¥ä¸è™šæ‹Ÿæœºäº¤äº’ï¼ˆå¯ä»¥ç®¡ç†è¿œç¨‹ kvm ä¸»æœºï¼‰ã€‚ dnsmasq vde2 bridge-utils openbsd-netcat: ç½‘ç»œç›¸å…³ç»„ä»¶ï¼Œæä¾›äº†ä»¥å¤ªç½‘è™šæ‹ŸåŒ–ã€ç½‘ç»œæ¡¥æ¥ã€NATç½‘ç»œç­‰è™šæ‹Ÿç½‘ç»œåŠŸèƒ½ã€‚ dnsmasq æä¾›äº† NAT è™šæ‹Ÿç½‘ç»œçš„ DHCP åŠ DNS è§£æåŠŸèƒ½ã€‚ vde2: ä»¥å¤ªç½‘è™šæ‹ŸåŒ– bridge-utils: é¡¾åæ€ä¹‰ï¼Œæä¾›ç½‘ç»œæ¡¥æ¥ç›¸å…³çš„å·¥å…·ã€‚ openbsd-netcat: TCP/IP çš„ç‘å£«å†›åˆ€ï¼Œè¯¦è§ socat \u0026 netcatï¼Œè¿™é‡Œä¸æ¸…æ¥šæ˜¯å“ªä¸ªç½‘ç»œç»„ä»¶ä¼šç”¨åˆ°å®ƒã€‚ å®‰è£…å‘½ä»¤ï¼š # archlinux/manjaro sudo pacman -S qemu virt-manager virt-viewer dnsmasq vde2 bridge-utils openbsd-netcat # ubuntu,å‚è€ƒäº†å®˜æ–¹æ–‡æ¡£ï¼Œä½†æœªæµ‹è¯• sudo apt install qemu-kvm libvirt-daemon-system virt-manager virt-viewer virtinst bridge-utils # centos,å‚è€ƒäº†å®˜æ–¹æ–‡æ¡£ï¼Œä½†æœªæµ‹è¯• sudo yum groupinstall \"Virtualization Host\" sudo yum install virt-manager virt-viewer virt-install # opensuse # see: https://doc.opensuse.org/documentation/leap/virtualization/html/book-virt/cha-vt-installation.html sudo yast2 virtualization # enter to terminal ui, select kvm + kvm tools, and then install it. å®‰è£…å®Œæˆåï¼Œè¿˜ä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œéœ€è¦åšäº›é¢å¤–çš„å·¥ä½œã€‚è¯·ç»§ç»­å¾€ä¸‹èµ°ã€‚ ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:2:0","tags":["è™šæ‹ŸåŒ–","KVM","libvirt","QEMU"],"title":"QEMU-KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/"},{"categories":["æŠ€æœ¯"],"content":"1. libguestfs - è™šæ‹Ÿæœºç£ç›˜æ˜ åƒå¤„ç†å·¥å…· libguestfs æ˜¯ä¸€ä¸ªè™šæ‹Ÿæœºç£ç›˜æ˜ åƒå¤„ç†å·¥å…·ï¼Œå¯ç”¨äºç›´æ¥ä¿®æ”¹/æŸ¥çœ‹/è™šæ‹Ÿæœºæ˜ åƒã€è½¬æ¢æ˜ åƒæ ¼å¼ç­‰ã€‚ å®ƒæä¾›çš„å‘½ä»¤åˆ—è¡¨å¦‚ä¸‹ï¼š virt-df centos.img: æŸ¥çœ‹ç¡¬ç›˜ä½¿ç”¨æƒ…å†µ virt-ls centos.img /: åˆ—å‡ºç›®å½•æ–‡ä»¶ virt-copy-out -d domain /etc/passwd /tmpï¼šåœ¨è™šæ‹Ÿæ˜ åƒä¸­æ‰§è¡Œæ–‡ä»¶å¤åˆ¶ virt-list-filesystems /file/xx.imgï¼šæŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿä¿¡æ¯ virt-list-partitions /file/xx.imgï¼šæŸ¥çœ‹åˆ†åŒºä¿¡æ¯ guestmount -a /file/xx.qcow2(raw/qcow2éƒ½æ”¯æŒ) -m /dev/VolGroup/lv_root --rw /mntï¼šç›´æ¥å°†åˆ†åŒºæŒ‚è½½åˆ°å®¿ä¸»æœº guestfish: äº¤äº’å¼ shellï¼Œå¯è¿è¡Œä¸Šè¿°æ‰€æœ‰å‘½ä»¤ã€‚ virt-v2v: å°†å…¶ä»–æ ¼å¼çš„è™šæ‹Ÿæœº(æ¯”å¦‚ ova) è½¬æ¢æˆ kvm è™šæ‹Ÿæœºã€‚ virt-p2v: å°†ä¸€å°ç‰©ç†æœºè½¬æ¢æˆè™šæ‹Ÿæœºã€‚ å­¦ä¹ è¿‡ç¨‹ä¸­å¯èƒ½ä¼šä½¿ç”¨åˆ°ä¸Šè¿°å‘½ä»¤ï¼Œæå‰å®‰è£…å¥½æ€»ä¸ä¼šæœ‰é”™ï¼Œå®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼š # opensuse sudo zypper install libguestfs # archlinux/manjaroï¼Œç›®å‰ç¼ºå°‘ virt-v2v/virt-p2v ç»„ä»¶ sudo pacman -S libguestfs # ubuntu sudo apt install libguestfs-tools # centos sudo yum install libguestfs-tools ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:2:1","tags":["è™šæ‹ŸåŒ–","KVM","libvirt","QEMU"],"title":"QEMU-KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/"},{"categories":["æŠ€æœ¯"],"content":"2. å¯åŠ¨ QEMU/KVM é€šè¿‡ systemd å¯åŠ¨ libvirtd åå°æœåŠ¡ï¼š sudo systemctl enable libvirtd.service sudo systemctl start libvirtd.service ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:2:2","tags":["è™šæ‹ŸåŒ–","KVM","libvirt","QEMU"],"title":"QEMU-KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/"},{"categories":["æŠ€æœ¯"],"content":"3. è®©é root ç”¨æˆ·èƒ½æ­£å¸¸ä½¿ç”¨ kvm qumu/kvm è£…å¥½åï¼Œé»˜è®¤æƒ…å†µä¸‹éœ€è¦ root æƒé™æ‰èƒ½æ­£å¸¸ä½¿ç”¨å®ƒã€‚ ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œé¦–å…ˆç¼–è¾‘æ–‡ä»¶ /etc/libvirt/libvirtd.conf: unix_sock_group = \"libvirt\"ï¼Œå–æ¶ˆè¿™ä¸€è¡Œçš„æ³¨é‡Šï¼Œä½¿ libvirt ç”¨æˆ·ç»„èƒ½ä½¿ç”¨ unix å¥—æ¥å­—ã€‚ unix_sock_rw_perms = \"0770\"ï¼Œå–æ¶ˆè¿™ä¸€è¡Œçš„æ³¨é‡Šï¼Œä½¿ç”¨æˆ·èƒ½è¯»å†™ unix å¥—æ¥å­—ã€‚ ç„¶åæ–°å»º libvirt ç”¨æˆ·ç»„ï¼Œå°†å½“å‰ç”¨æˆ·åŠ å…¥è¯¥ç»„ï¼š newgrp libvirt sudo usermod -aG libvirt $USER æœ€åé‡å¯ libvirtd æœåŠ¡ï¼Œåº”è¯¥å°±èƒ½æ­£å¸¸ä½¿ç”¨äº†ï¼š sudo systemctl restart libvirtd.service ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:2:3","tags":["è™šæ‹ŸåŒ–","KVM","libvirt","QEMU"],"title":"QEMU-KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/"},{"categories":["æŠ€æœ¯"],"content":"3. å¯ç”¨åµŒå¥—è™šæ‹ŸåŒ– å¦‚æœä½ éœ€è¦åœ¨è™šæ‹Ÿæœºä¸­è¿è¡Œè™šæ‹Ÿæœºï¼ˆæ¯”å¦‚åœ¨è™šæ‹Ÿæœºé‡Œæµ‹è¯• katacontainers ç­‰å®‰å…¨å®¹å™¨æŠ€æœ¯ï¼‰ï¼Œé‚£å°±éœ€è¦å¯ç”¨å†…æ ¸æ¨¡å— kvm_intel å®ç°åµŒå¥—è™šæ‹ŸåŒ–ã€‚ # ä¸´æ—¶å¯ç”¨ kvm_intel åµŒå¥—è™šæ‹ŸåŒ– sudo modprobe -r kvm_intel sudo modprobe kvm_intel nested=1 # ä¿®æ”¹é…ç½®ï¼Œæ°¸ä¹…å¯ç”¨åµŒå¥—è™šæ‹ŸåŒ– echo \"options kvm-intel nested=1\" | sudo tee /etc/modprobe.d/kvm-intel.conf éªŒè¯åµŒå¥—è™šæ‹ŸåŒ–å·²ç»å¯ç”¨ï¼š $ cat /sys/module/kvm_intel/parameters/nested Y è‡³æ­¤ï¼ŒKVM çš„å®‰è£…å°±å¤§åŠŸå‘Šæˆå•¦ï¼Œç°åœ¨åº”è¯¥å¯ä»¥åœ¨ç³»ç»Ÿä¸­æ‰¾åˆ° virt-manager çš„å›¾æ ‡ï¼Œè¿›å»å°±å¯ä»¥ä½¿ç”¨äº†ã€‚ virt-manager çš„ä½¿ç”¨æ–¹æ³•å’Œ virtualbox/vmware workstation å¤§åŒå°å¼‚ï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†ä»‹ç»äº†ï¼Œè‡ªå·±æ‘¸ç´¢æ‘¸ç´¢åº”è¯¥å°±ä¼šäº†ã€‚ å¦‚ä¸‹å†…å®¹æ˜¯è¿›é˜¶ç¯‡ï¼Œä¸»è¦ä»‹ç»å¦‚ä½•é€šè¿‡å‘½ä»¤è¡Œæ¥ç®¡ç†è™šæ‹Ÿæœºç£ç›˜ï¼Œä»¥åŠ KVMã€‚ å¦‚æœä½ è¿˜æ˜¯ kvm æ–°æ‰‹ï¼Œå»ºè®®å…ˆé€šè¿‡å›¾å½¢ç•Œé¢ virt-manager ç†Ÿæ‚‰ç†Ÿæ‚‰ï¼Œå†å¾€ä¸‹ç»§ç»­è¯»ã€‚ ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:2:4","tags":["è™šæ‹ŸåŒ–","KVM","libvirt","QEMU"],"title":"QEMU-KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/"},{"categories":["æŠ€æœ¯"],"content":"äºŒã€è™šæ‹Ÿæœºç£ç›˜æ˜ åƒç®¡ç† è¿™éœ€è¦ç”¨åˆ°ä¸¤ä¸ªå·¥å…·ï¼š libguestfs: è™šæ‹Ÿæœºç£ç›˜æ˜ åƒç®¡ç†å·¥å…·ï¼Œå‰é¢ä»‹ç»è¿‡äº† qemu-img: qemu çš„ç£ç›˜æ˜ åƒç®¡ç†å·¥å…·ï¼Œç”¨äºåˆ›å»ºç£ç›˜ã€æ‰©ç¼©å®¹ç£ç›˜ã€ç”Ÿæˆç£ç›˜å¿«ç…§ã€æŸ¥çœ‹ç£ç›˜ä¿¡æ¯ã€è½¬æ¢ç£ç›˜æ ¼å¼ç­‰ç­‰ã€‚ # åˆ›å»ºç£ç›˜ qemu-img create -f qcow2 -o cluster_size=128K virt_disk.qcow2 20G # æ‰©å®¹ç£ç›˜ qemu-img resize ubuntu-server-cloudimg-amd64.img 30G # æŸ¥çœ‹ç£ç›˜ä¿¡æ¯ qemu-img info ubuntu-server-cloudimg-amd64.img # è½¬æ¢ç£ç›˜æ ¼å¼ qemu-img convert -f raw -O qcow2 vm01.img vm01.qcow2 # raw =\u003e qcow2 qemu-img convert -f qcow2 -O raw vm01.qcow2 vm01.img # qcow2 =\u003e raw ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:3:0","tags":["è™šæ‹ŸåŒ–","KVM","libvirt","QEMU"],"title":"QEMU-KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/"},{"categories":["æŠ€æœ¯"],"content":"1. å¯¼å…¥ vmware é•œåƒ ç›´æ¥ä» vmware ova æ–‡ä»¶å¯¼å…¥ kvmï¼Œè¿™ç§æ–¹å¼è½¬æ¢å¾—åˆ°çš„é•œåƒåº”è¯¥èƒ½ç›´æ¥ç”¨ï¼ˆç½‘å¡éœ€è¦é‡æ–°é…ç½®ï¼‰ï¼š virt-v2v -i ova centos7-test01.ova -o local -os /vmhost/centos7-01 -of qcow2 ä¹Ÿå¯ä»¥å…ˆä» ova ä¸­è§£å‹å‡º vmdk ç£ç›˜æ˜ åƒï¼Œå°† vmware çš„ vmdk æ–‡ä»¶è½¬æ¢æˆ qcow2 æ ¼å¼ï¼Œç„¶åå†å¯¼å…¥ kvmï¼ˆç½‘å¡éœ€è¦é‡æ–°é…ç½®ï¼‰ï¼š # è½¬æ¢æ˜ åƒæ ¼å¼ qemu-img convert -p -f vmdk -O qcow2 centos7-test01-disk1.vmdk centos7-test01.qcow2 # æŸ¥çœ‹è½¬æ¢åçš„æ˜ åƒä¿¡æ¯ qemu-img info centos7-test01.qcow2 ç›´æ¥è½¬æ¢ vmdk æ–‡ä»¶å¾—åˆ°çš„ qcow2 é•œåƒï¼Œå¯ä¼šæŠ¥é”™ï¼Œæ¯”å¦‚ã€Œç£ç›˜æ— æ³•æŒ‚è½½ã€ã€‚ æ ¹æ® Importing Virtual Machines and disk images - ProxmoxVE Docs æ–‡æ¡£æ‰€è¨€ï¼Œéœ€è¦åœ¨ç½‘ä¸Šä¸‹è½½å®‰è£… MergeIDE.zip ç»„ä»¶ï¼Œ å¦å¤–å¯åŠ¨è™šæ‹Ÿæœºå‰ï¼Œéœ€è¦å°†ç¡¬ç›˜ç±»å‹æ”¹ä¸º IDEï¼Œæ‰èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:3:1","tags":["è™šæ‹ŸåŒ–","KVM","libvirt","QEMU"],"title":"QEMU-KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/"},{"categories":["æŠ€æœ¯"],"content":"2. å¯¼å…¥ img é•œåƒ img é•œåƒæ–‡ä»¶ï¼Œå°±æ˜¯æ‰€è°“çš„ raw æ ¼å¼é•œåƒï¼Œä¹Ÿè¢«ç§°ä¸ºè£¸é•œåƒï¼ŒIO é€Ÿåº¦æ¯” qcow2 å¿«ï¼Œä½†æ˜¯ä½“ç§¯å¤§ï¼Œè€Œä¸”ä¸æ”¯æŒå¿«ç…§ç­‰é«˜çº§ç‰¹æ€§ã€‚ å¦‚æœä¸è¿½æ±‚ IO æ€§èƒ½çš„è¯ï¼Œå»ºè®®å°†å®ƒè½¬æ¢æˆ qcow2 å†ä½¿ç”¨ã€‚ qemu-img convert -f raw -O qcow2 vm01.img vm01.qcow2 ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:3:2","tags":["è™šæ‹ŸåŒ–","KVM","libvirt","QEMU"],"title":"QEMU-KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/"},{"categories":["æŠ€æœ¯"],"content":"ä¸‰ã€è™šæ‹Ÿæœºç®¡ç† è™šæ‹Ÿæœºç®¡ç†å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…· virsh/virt-installï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ GUI å·¥å…· virt-manager. GUI å¾ˆå‚»ç“œå¼ï¼Œå°±ä¸ä»‹ç»äº†ï¼Œè¿™é‡Œä¸»è¦ä»‹ç»å‘½ä»¤è¡Œå·¥å…· virsh/virt-install å…ˆä»‹ç»ä¸‹ libvirt ä¸­çš„å‡ ä¸ªæ¦‚å¿µï¼š Domain: æŒ‡ä»£è¿è¡Œåœ¨è™šæ‹Ÿæœºå™¨ä¸Šçš„æ“ä½œç³»ç»Ÿçš„å®ä¾‹ - ä¸€ä¸ªè™šæ‹Ÿæœºï¼Œæˆ–è€…ç”¨äºå¯åŠ¨è™šæ‹Ÿæœºçš„é…ç½®ã€‚ Guest OS: è¿è¡Œåœ¨ domain ä¸­çš„è™šæ‹Ÿæ“ä½œç³»ç»Ÿã€‚ å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä½ éƒ½å¯ä»¥æŠŠä¸‹é¢å‘½ä»¤ä¸­æ¶‰åŠåˆ°çš„ domain ç†è§£æˆè™šæ‹Ÿæœºã€‚ ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:4:0","tags":["è™šæ‹ŸåŒ–","KVM","libvirt","QEMU"],"title":"QEMU-KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/"},{"categories":["æŠ€æœ¯"],"content":"0. è®¾ç½®é»˜è®¤ URI virsh/virt-install/virt-viewer ç­‰ä¸€ç³»åˆ— libvirt å‘½ä»¤ï¼Œsudo virsh net-list â€“all é»˜è®¤æƒ…å†µä¸‹ä¼šä½¿ç”¨ qemu:///session ä½œä¸º URI å»è¿æ¥ QEMU/KVMï¼Œåªæœ‰ root è´¦å·æ‰ä¼šé»˜è®¤ä½¿ç”¨ qemu:///system. å¦ä¸€æ–¹é¢ virt-manager è¿™ä¸ª GUI å·¥å…·ï¼Œé»˜è®¤ä¹Ÿä¼šä½¿ç”¨ qemu:///system å»è¿æ¥ QEMU/KVMï¼ˆå’Œ root è´¦å·ä¸€è‡´ï¼‰ qemu:///system æ˜¯ç³»ç»Ÿå…¨å±€çš„ qemu ç¯å¢ƒï¼Œè€Œ qemu:///session çš„ç¯å¢ƒæ˜¯æŒ‰ç”¨æˆ·éš”ç¦»çš„ã€‚ å¦å¤– qemu:///session æ²¡æœ‰é»˜è®¤çš„ networkï¼Œåˆ›å»ºè™šæ‹Ÿæœºæ—¶ä¼šå‡ºæ¯›ç—…ã€‚ã€‚ã€‚ å› æ­¤ï¼Œä½ éœ€è¦å°†é»˜è®¤çš„ URI æ”¹ä¸º qemu:///systemï¼Œå¦åˆ™ç»å¯¹ä¼šè¢«å‘: echo 'export LIBVIRT_DEFAULT_URI=\"qemu:///system\"' \u003e\u003e ~/.bashrc ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:4:1","tags":["è™šæ‹ŸåŒ–","KVM","libvirt","QEMU"],"title":"QEMU-KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/"},{"categories":["æŠ€æœ¯"],"content":"1. è™šæ‹Ÿæœºç½‘ç»œ qemu-kvm å®‰è£…å®Œæˆåï¼Œqemu:///system ç¯å¢ƒä¸­é»˜è®¤ä¼šåˆ›å»ºä¸€ä¸ª default ç½‘ç»œï¼Œè€Œ qemu:///session ä¸æä¾›é»˜è®¤çš„ç½‘ç»œï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»ºã€‚ æˆ‘ä»¬é€šå¸¸ä½¿ç”¨ qemu:///system ç¯å¢ƒå°±å¥½ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•æŸ¥çœ‹å¹¶å¯åŠ¨ default ç½‘ç»œï¼Œè¿™æ ·åé¢åˆ›å»ºè™šæ‹Ÿæœºæ—¶æ‰æœ‰ç½‘ç»œå¯ç”¨ã€‚ # åˆ—å‡ºæ‰€æœ‰è™šæ‹Ÿæœºç½‘ç»œ $ sudo virsh net-list --all Name State Autostart Persistent ---------------------------------------------- default inactive no yes # å¯åŠ¨é»˜è®¤ç½‘ç»œ $ virsh net-start default Network default started # å°† default ç½‘ç»œè®¾ä¸ºè‡ªå¯åŠ¨ $ virsh net-autostart --network default Network default marked as autostarted # å†æ¬¡æ£€æŸ¥ç½‘ç»œçŠ¶å†µï¼Œå·²ç»æ˜¯ active äº† $ sudo virsh net-list --all Name State Autostart Persistent -------------------------------------------- default active yes yes ä¹Ÿå¯ä»¥åˆ›å»ºæ–°çš„è™šæ‹Ÿæœºç½‘ç»œï¼Œè¿™éœ€è¦æ‰‹åŠ¨ç¼–å†™ç½‘ç»œçš„ xml é…ç½®ï¼Œç„¶åé€šè¿‡ virsh net-define --file my-network.xml åˆ›å»ºï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†ä»‹ç»äº†ï¼Œå› ä¸ºæš‚æ—¶ç”¨ä¸åˆ°â€¦ ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:4:2","tags":["è™šæ‹ŸåŒ–","KVM","libvirt","QEMU"],"title":"QEMU-KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/"},{"categories":["æŠ€æœ¯"],"content":"2. åˆ›å»ºè™šæ‹Ÿæœº - virt-intall # ä½¿ç”¨ iso é•œåƒåˆ›å»ºå…¨æ–°çš„ proxmox è™šæ‹Ÿæœºï¼Œè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª 60G çš„ç£ç›˜ã€‚ virt-install --virt-type kvm \\ --name pve-1 \\ --vcpus 4 --memory 8096 \\ --disk size=60 \\ --network network=default,model=virtio \\ --os-type linux \\ --os-variant generic \\ --graphics vnc \\ --cdrom proxmox-ve_6.3-1.iso # ä½¿ç”¨å·²å­˜åœ¨çš„ opensuse cloud ç£ç›˜åˆ›å»ºè™šæ‹Ÿæœº virt-install --virt-type kvm \\ --name opensuse15-2 \\ --vcpus 2 --memory 2048 \\ --disk opensuse15.2-openstack.qcow2,device=disk,bus=virtio \\ --disk seed.iso,device=cdrom \\ --os-type linux \\ --os-variant opensuse15.2 \\ --network network=default,model=virtio \\ --graphics vnc \\ --import å…¶ä¸­çš„ --os-variant ç”¨äºè®¾å®š OS ç›¸å…³çš„ä¼˜åŒ–é…ç½®ï¼Œå®˜æ–¹æ–‡æ¡£å¼ºçƒˆæ¨èè®¾å®šï¼Œå…¶å¯é€‰å‚æ•°å¯ä»¥é€šè¿‡ osinfo-query os æŸ¥çœ‹ã€‚ ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:4:3","tags":["è™šæ‹ŸåŒ–","KVM","libvirt","QEMU"],"title":"QEMU-KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/"},{"categories":["æŠ€æœ¯"],"content":"3. è™šæ‹Ÿæœºç®¡ç† - virsh è™šæ‹Ÿæœºåˆ›å»ºå¥½åï¼Œå¯ä½¿ç”¨ virsh ç®¡ç†è™šæ‹Ÿæœºï¼š æŸ¥çœ‹è™šæ‹Ÿæœºåˆ—è¡¨ï¼š # æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„è™šæ‹Ÿæœº virsh list # æŸ¥çœ‹æ‰€æœ‰è™šæ‹Ÿæœºï¼ŒåŒ…æ‹¬ inactive çš„è™šæ‹Ÿæœº virsh list --all ä½¿ç”¨ virt-viewer ä»¥ vnc åè®®ç™»å…¥è™šæ‹Ÿæœºç»ˆç«¯ï¼š # ä½¿ç”¨è™šæ‹Ÿæœº ID è¿æ¥ virt-viewer 8 # ä½¿ç”¨è™šæ‹Ÿæœºåç§°è¿æ¥ï¼Œå¹¶ä¸”ç­‰å¾…è™šæ‹Ÿæœºå¯åŠ¨ virt-viewer --wait opensuse15 å¯åŠ¨ã€å…³é—­ã€æš‚åœ(ä¼‘çœ )ã€é‡å¯è™šæ‹Ÿæœºï¼š virsh start opensuse15 virsh suuspend opensuse15 virsh resume opensuse15 virsh reboot opensuse15 # ä¼˜é›…å…³æœº virsh shutdown opensuse15 # å¼ºåˆ¶å…³æœº virsh destroy opensuse15 # å¯ç”¨è‡ªåŠ¨å¼€æœº virsh autostart opensuse15 # ç¦ç”¨è‡ªåŠ¨å¼€æœº virsh autostart --disable opensuse15 è™šæ‹Ÿæœºå¿«ç…§ç®¡ç†ï¼š # åˆ—å‡ºä¸€ä¸ªè™šæ‹Ÿæœºçš„æ‰€æœ‰å¿«ç…§ virsh snapshot-list --domain opensuse15 # ç»™æŸä¸ªè™šæ‹Ÿæœºç”Ÿæˆä¸€ä¸ªæ–°å¿«ç…§ virsh snapshot-create \u003cdomain\u003e # ä½¿ç”¨å¿«ç…§å°†è™šæ‹Ÿæœºè¿˜åŸ virsh snapshot-restore \u003cdomain\u003e \u003csnapshotname\u003e # åˆ é™¤å¿«ç…§ virsh snapshot-delete \u003cdomain\u003e \u003csnapshotname\u003e åˆ é™¤è™šæ‹Ÿæœºï¼š virsh undefine opensuse15 è¿ç§»è™šæ‹Ÿæœºï¼š # ä½¿ç”¨é»˜è®¤å‚æ•°è¿›è¡Œç¦»çº¿è¿ç§»ï¼Œå°†å·²å…³æœºçš„æœåŠ¡å™¨è¿ç§»åˆ°å¦ä¸€ä¸ª qemu å®ä¾‹ virsh migrate 37 qemu+ssh://tux@jupiter.example.com/system # è¿˜æ”¯æŒåœ¨çº¿å®æ—¶è¿ç§»ï¼Œå¾…ç»­ cpu/å†…å­˜ä¿®æ”¹ï¼š # æ”¹æˆ 4 æ ¸ virsh setvcpus opensuse15 4 # æ”¹æˆ 4G virsh setmem opensuse15 4096 è™šæ‹Ÿæœºç›‘æ§ï¼š # å¾…ç»­ ä¿®æ”¹ç£ç›˜ã€ç½‘ç»œåŠå…¶ä»–è®¾å¤‡ï¼š # æ·»åŠ æ–°è®¾å¤‡ virsh attach-device virsh attach-disk virsh attach-interface # åˆ é™¤è®¾å¤‡ virsh detach-disk virsh detach-device virsh detach-interface ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:4:4","tags":["è™šæ‹ŸåŒ–","KVM","libvirt","QEMU"],"title":"QEMU-KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/"},{"categories":["æŠ€æœ¯"],"content":"å‚è€ƒ Virtualization Guide - OpenSUSE Complete Installation of KVM, QEMU and Virt Manager on Arch Linux and Manjaro virtualization-libvirt - ubuntu docs RedHat Docs - KVM ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:5:0","tags":["è™šæ‹ŸåŒ–","KVM","libvirt","QEMU"],"title":"QEMU-KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/"},{"categories":null,"content":"å…³äºæˆ‘ æœ‰å¾ˆå¤šçš„ç»æœ›ï¼Œä½†ä¹Ÿæœ‰ç¾çš„æ—¶åˆ»ï¼Œåªä¸è¿‡åœ¨ç¾çš„æ—¶åˆ»ï¼Œæ—¶é—´æ˜¯ä¸åŒäºä»¥å¾€çš„ã€‚ â”€â”€ã€ŠåˆºçŒ¬çš„ä¼˜é›…ã€‹ æ˜µç§°ï¼šä¸­æ–‡æ˜µç§°ã€Œæ–¼æ¸…æ¨‚ã€ã€ŒäºŒèŠ±ã€ï¼Œè‹±æ–‡ IDã€Œryan4yinã€ã€Œryan_yinã€ éŸ³ä¹ï¼š å–œæ¬¢å¬åæ‘‡ã€è“è‰ã€æ°‘è°£ã€å™¨ä¹ æœ‰åœ¨æ–­æ–­ç»­ç»­åœ°å­¦ä¹ ç«¹ç¬›è·Ÿå£ç´ï¼Œå¦å¤–ä¹Ÿæœ‰åœ¨å­¦ä¹ ä½¿ç”¨ Synthesizer V è·Ÿ Reaper å…¶ä»–çˆ±å¥½ï¼š è¿åŠ¨ï¼šå–œæ¬¢è½®æ»‘ä»¥åŠæ¸¸æ³³ï¼Œå“¦è¿˜æœ‰ VR æ¸¸æˆã€ŠBeat Saberã€‹ã€ŠPistol Whipã€‹ï¼Œä½†æ˜¯ç›®å‰éƒ½æ˜¯åŠåŠå­å“ˆå“ˆ~ èŒ¶ï¼š2021 å¹´åœ¨æœ‹å‹å®¶å–è¿‡ä¸€æ¬¡é’é’±æŸ³åå°±ä¸€ç›´å¿µå¿µä¸å¿˜ï¼Œå¹´åº•å°±å…¥å‘äº†å‡¤ç‰Œæ»‡çº¢ã€å¤©ä¹‹çº¢ç¥é—¨çº¢èŒ¶ã€æç™½å®‰å‰ç™½èŒ¶ï¼Œç›®å‰æ¯”è¾ƒå–œæ¬¢å–çº¢èŒ¶ã€‚ ä¹¦ç±ï¼šè¯»å¾—æœ€å¤šçš„æ­£ç»ä¹¦æ˜¯ IT æŠ€æœ¯ä¹¦ç±ï¼Œå¦å¤–ä¹Ÿå–œæ¬¢çœ‹ç§‘å¹»ï¼Œä»¥åŠæˆ’ä¸æ‰çš„ç½‘æ–‡/è½»å°è¯´ å½±è§†ï¼šçœ‹å¾—æœ€å¤šçš„æ˜¯åŠ¨æ¼«ï¼Œå¦å¤–å°±æ˜¯æ¬§ç¾ç§‘å¹»ç‰‡ã€æ¸©æƒ…ç‰‡ ä¸­æ–‡è¾“å…¥æ–¹æ¡ˆï¼šå°é¹¤éŸ³å½¢ ä¸“ä¸šï¼šå¤§å­¦å­¦çš„æ˜¯å£°å­¦ï¼Œæ²¡é”™å°±æ˜¯åˆä¸­ç‰©ç†è¯¾ä¸Šæ•²éŸ³å‰çš„é‚£ä¸ªå£°å­¦ã€‚æœ¬äººä¸“ä¸šçŸ¥è¯†æˆ˜äº”æ¸£ï¼Œå­¦ä½è¯éƒ½æ²¡æ‹¿åˆ°ï¼Œå°±ä¸å±•å¼€äº†hhh è‡ªç„¶è¯­è¨€ English: Good at reading technical articles, but weak in writing, listening and speaking ä¸­æ–‡ï¼šæ¯è¯­ï¼Œé«˜ä¸­è¯­æ–‡ä¸­ç­‰æ°´å‡†ã€‚å¸Œæœ›èƒ½å­¦ä¼šç”¨ä¸­æ–‡å†™å°è¯´ï¼Œå°±å…ˆä»çŸ­ç¯‡å¼€å§‹å§ ç¼–ç¨‹è¯­è¨€ Python: ç›®å‰çš„ä¸»åŠ›ï¼Œä¹Ÿæ˜¯æˆ‘æœ€ç†Ÿæ‚‰çš„è¯­è¨€ Go: å­¦ä¹ ä¸­ï¼Œäº‘åŸç”Ÿåœˆå­é‡Œæœ€æµè¡Œçš„è¯­è¨€ Rust: å­¦ä¹ ä¸­ï¼Œå¤§é‡å‡½æ•°å¼çš„è¯­æ³•ç³–ï¼Œè´´å¿ƒçš„ç¼–è¯‘å™¨æç¤ºï¼Œæ„Ÿè§‰å¾ˆå¥½ç”¨ C: å‹‰å¼ºèƒ½çœ‹æ‡‚ä»£ç ï¼Œè’åºŸæ¯”è¾ƒä¹…äº†ã€‚åœ¨å­¦ä¹  Nginx/Linux çš„è¿‡ç¨‹ä¸­æ…¢æ…¢è¡¥å§â€¦ æ›¾ç»ä½¿ç”¨è¿‡ä½†å·²ç»è’åºŸçš„è¯­è¨€ï¼šJava/Julia/Mathematica/Lua èŒä¸šï¼šSRE ç»´æŠ¤ä¸ä¼˜åŒ–å®¹å™¨è®¡ç®—å¹³å°åŠæµé‡é“¾è·¯ï¼Œåˆ†æä¸ç®¡æ§äº‘è®¡ç®—æˆæœ¬ï¼Œç¨³å®šé«˜æ•ˆåœ°æ”¯æ’‘å¿«é€Ÿæˆé•¿çš„ä¸šåŠ¡ å·¥å…·æˆ–æŠ€æœ¯ï¼šLinux/Kubernetes/Istio ","date":"2021-01-16","objectID":"/about/:1:0","tags":null,"title":"å…³äº","uri":"/about/"},{"categories":null,"content":"å…³äºæ­¤åšå®¢ â€œå¯¹æˆ‘æ¥è¯´ï¼Œåšå®¢é¦–å…ˆæ˜¯ä¸€ç§çŸ¥è¯†ç®¡ç†å·¥å…·ï¼Œå…¶æ¬¡æ‰æ˜¯ä¼ æ’­å·¥å…·ã€‚æˆ‘çš„æŠ€æœ¯æ–‡ç« ï¼Œä¸»è¦ç”¨æ¥æ•´ç†æˆ‘è¿˜ä¸æ‡‚çš„çŸ¥è¯†ã€‚æˆ‘åªå†™é‚£äº›æˆ‘è¿˜æ²¡æœ‰å®Œå…¨æŒæ¡çš„ä¸œè¥¿ï¼Œé‚£äº›æˆ‘ç²¾é€šçš„ä¸œè¥¿ï¼Œå¾€å¾€æ²¡æœ‰åŠ¨åŠ›å†™ã€‚ç‚«è€€ä»æ¥ä¸æ˜¯æˆ‘çš„åŠ¨æœºï¼Œå¥½å¥‡æ‰æ˜¯ã€‚\" â”€â”€é˜®ä¸€å³° ","date":"2021-01-16","objectID":"/about/:2:0","tags":null,"title":"å…³äº","uri":"/about/"},{"categories":null,"content":"åšå®¢å†…å®¹ 2020 å¹´åŠä¹‹å‰çš„æ–‡ç« ï¼Œéƒ½æ¬è¿è‡ªæˆ‘çš„åšå®¢å›­ https://www.cnblogs.com/kirito-c/ã€‚ 2021 å¹´å¼€å§‹çš„æ–‡ç« ï¼Œå¤§éƒ¨åˆ†æ˜¯æŠ€æœ¯å†…å®¹ï¼Œå®ƒä»¬å¤§éƒ½æ¥è‡ªæˆ‘çš„ä¸ªäººç¬”è®° ryan4yin/knowledgeï¼Œæˆ‘ä¼šä¸å®šæœŸä»è¿™ä¸ªç¬”è®°ä¸­æ‰¾äº›æœ‰æ„æ€çš„å†…å®¹ï¼Œæ•´ç†æ¶¦è‰²åï¼Œæ‹¿å‡ºæ¥å’Œå¤§å®¶åˆ†äº«ï¼ŒåŒæ—¶æŸ¥æ¼è¡¥ç¼ºã€‚ è€Œå¦ä¸€éƒ¨åˆ†ç”Ÿæ´»ç±»çš„éšç¬”ï¼Œåˆ™æ˜¯æˆ‘çš„é—²è¨€ç¢è¯­ã€‚ ","date":"2021-01-16","objectID":"/about/:2:1","tags":null,"title":"å…³äº","uri":"/about/"},{"categories":null,"content":"åšå®¢æ—¶é—´çº¿ åšå®¢æ—¶é—´çº¿ 2016-06-17ï¼šåœ¨åšå®¢å›­ - https://www.cnblogs.com/kirito-c/ 2021-01-16ï¼šå¼€è®¾ç‹¬ç«‹åšå®¢ https://ryan4yin.space/ 2022-02-07ï¼šåšå®¢ä¸»åŸŸååˆ‡æ¢ä¸º https://thiscute.world/ï¼Œå¦å¤–æ–°å¢å¤‡ç”¨åŸŸå https://writefor.fun åšå®¢å¿«ç…§ åšå®¢å›­å¿«ç…§\" åšå®¢å›­å¿«ç…§ æœ€å¼€å§‹æ˜¯ 2016 å¹´ 6 æœˆï¼Œæˆ‘å¼€å§‹åœ¨ã€Œåšå®¢å›­ã€ä¸Šå†™æ–‡ç« ï¼Œå†™çš„ç¬¬ä¸€ç¯‡æ–‡ç« æ˜¯ã€Œè´ªåƒè›‡â€”Câ€”åŸºäºeasyxå›¾å½¢åº“(ä¸Š)ï¼šåŸºæœ¬æ§åˆ¶å‡½æ•°å®ç° ç”»å›¾ç¨‹åºã€ï¼Œå‘å¸ƒåˆ°åšå®¢å›­é¦–é¡µåè·å¾—äº†ä¸€äº›é˜…è¯»é‡è·Ÿè¯„è®ºï¼Œæˆå°±æ„Ÿéå¸¸å¼ºçƒˆ~ ä¹‹åæœ‰ç”¨è¿‡ hexo+next-theme æ­ä¸ªäººåšå®¢ï¼Œä¹Ÿå†™äº†ä¸€äº›æ–‡ç« ã€‚ä½†æ˜¯æ²¡åš SEOï¼Œæ²¡å•¥æµé‡ï¼Œå®ƒçš„å­˜åœ¨è²Œä¼¼æ¯«æ— æ„ä¹‰ï¼Œå› æ­¤åŸŸååˆ°æœŸåå°±æ²¡ç»­ã€‚ æœ‰äººé˜…è¯»æˆ‘çš„æ–‡ç« ï¼Œä¸ºå®ƒç‚¹ä¸ªèµã€åˆ†äº«æˆ–è€…è¯„è®ºäº¤æµï¼Œæˆ‘æ‰èƒ½æ„Ÿå—åˆ°è‡ªå·±å†™çš„ä¸œè¥¿æ˜¯æœ‰æ„ä¹‰çš„ï¼Œå› æ­¤æˆ‘åˆå›åˆ°äº†ã€Œåšå®¢å›­ã€ã€‚ ã€Œåšå®¢å›­ã€çš„ SEO åšå¾—å¾ˆå¥½ï¼Œã€Œåšå®¢å›­é¦–é¡µã€ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å¼•æµé€”å¾„ï¼Œè¿™äº›ç»“åˆèµ·æ¥ï¼Œå°±èƒ½æ»¡è¶³æˆ‘çš„å°å°è™šè£å¿ƒã€‚ ç„¶åå‘¢ï¼Œåœ¨ 2020 å¹´ï¼Œæˆ‘é€šè¿‡ç‹¬ç«‹åšå®¢è®¤è¯†äº†éå¸¸å¤šçš„æŠ€æœ¯äººã€‚ å¤§å®¶çš„åšå®¢ï¼Œé€šè¿‡ä¸€æ¡æ¡å‹é“¾è¿æ¥åœ¨ä¸€èµ·ï¼Œæˆ‘è§‰å¾—è¿™éå¸¸æœ‰è¶£ã€‚åœ¨è¿™ä¸ªå‹é“¾ä¸²è”èµ·çš„ä¸–ç•Œä¸­æ¸¸è§ˆï¼Œæ¯æ¬¡æ€»èƒ½æœ‰äº›æ–°çš„æ”¶è·ã€‚ è€Œä¸”ä¸ªäººåšå®¢çš„ä¸»é¢˜æ›´ä¸°å¯Œå¤šå½©ï¼Œé€šè¿‡ github actions + github pages æ¥æ­åšå®¢ï¼Œä¹Ÿæ²¡å•¥æˆæœ¬ã€‚ äºæ˜¯å°±ä¹°äº†ä¸ªåå¹´æœ‰æ•ˆæœŸçš„åŸŸåï¼Œæ­äº†è¿™ä¸ªå°ç«™ã€‚ ","date":"2021-01-16","objectID":"/about/:2:2","tags":null,"title":"å…³äº","uri":"/about/"},{"categories":null,"content":"æ³¨æ„äº‹é¡¹ åšå®¢ä¸­çš„å†…å®¹è¯´åˆ°åº•ä¹Ÿåªæ˜¯æˆ‘ä¸€å®¶ä¹‹è¨€ï¼Œæˆ‘åªèƒ½å°½é‡å»å‡å°‘é”™æ¼ï¼Œæå‡æ–‡ç« å¯è¯»æ€§ï¼Œä½†ä¸èƒ½ä¿è¯å†…å®¹çš„æ­£ç¡®æ€§ï¼è¯·è¯»è€…è‡ªè¡Œç”„åˆ«ã€‚ ","date":"2021-01-16","objectID":"/about/:3:0","tags":null,"title":"å…³äº","uri":"/about/"},{"categories":null,"content":"ç”»å¤– äº’è”ç½‘æµ©å¦‚çƒŸæµ·ï¼Œè¿™ä¸ªå°ç«™åå®‰ä¸€éš…ï¼Œå¦‚æœå®ƒæœ‰å¹¸è¢«ä½ å‘ç°ï¼Œè€Œä¸”å…¶ä¸­æ–‡å­—å¯¹ä½ è¿˜æœ‰äº›å¸®åŠ©ï¼Œé‚£å¯çœŸæ˜¯å¤ªæ£’äº†ï¼æ„Ÿè°¢æœ‰ä½ ~ ","date":"2021-01-16","objectID":"/about/:4:0","tags":null,"title":"å…³äº","uri":"/about/"},{"categories":null,"content":" .animation-wrapper { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -100; } .particle, .particle:after { background: transparent; } .particle:after { position: absolute; content: \"\"; top: 2560px; } .particle-1 { -webkit-animation: animParticle 60s linear infinite; animation: animParticle 60s linear infinite; box-shadow: 0px 0px #fff, 1231px 1530px #fff, 336px 2471px #fff, 2385px 128px #fff, 2436px 1283px #fff, 549px 681px #fff, 1775px 1144px #fff, 238px 1396px #fff, 1330px 1558px #fff, 2060px 342px #fff, 1986px 1672px #fff, 1532px 702px #fff, 1313px 1459px #fff, 2406px 1616px #fff, 1529px 802px #fff, 1267px 680px #fff, 2258px 2109px #fff, 1325px 22px #fff, 1578px 1045px #fff, 945px 2256px #fff, 1400px 1441px #fff, 1652px 2152px #fff, 2513px 969px #fff, 2192px 1352px #fff, 793px 334px #fff, 1371px 1086px #fff, 2408px 1898px #fff, 475px 840px #fff, 539px 1108px #fff, 556px 1499px #fff, 643px 122px #fff, 2370px 1975px #fff, 1196px 1786px #fff, 308px 1834px #fff, 1957px 1569px #fff, 875px 339px #fff, 562px 412px #fff, 1187px 2258px #fff, 1406px 1824px #fff, 1172px 1792px #fff, 235px 1489px #fff, 2081px 878px #fff, 925px 176px #fff, 953px 1829px #fff, 38px 48px #fff, 1976px 1994px #fff, 1524px 1567px #fff, 1397px 1141px #fff, 2014px 1773px #fff, 1638px 1832px #fff, 1150px 465px #fff, 1212px 1854px #fff, 122px 20px #fff, 2493px 2361px #fff, 2221px 194px #fff, 480px 2020px #fff, 2340px 403px #fff, 1975px 2507px #fff, 1434px 142px #fff, 963px 871px #fff, 2379px 1765px #fff, 2346px 100px #fff, 1931px 1308px #fff, 527px 814px #fff, 549px 1732px #fff, 943px 886px #fff, 1592px 2277px #fff, 1339px 810px #fff, 871px 2016px #fff, 2121px 763px #fff, 1962px 1114px #fff, 2498px 550px #fff, 107px 586px #fff, 316px 1033px #fff, 2104px 2120px #fff, 1933px 1786px #fff, 1377px 2457px #fff, 2250px 1010px #fff, 1314px 2316px #fff, 1339px 947px #fff, 122px 1014px #fff, 558px 2354px #fff, 1250px 1790px #fff, 1185px 2144px #fff, 2432px 158px #fff, 1911px 2148px #fff, 1177px 804px #fff, 2504px 1254px #fff, 617px 1084px #fff, 1959px 1325px #fff, 2394px 2081px #fff, 395px 735px #fff, 221px 1891px #fff, 652px 2245px #fff, 1225px 1023px #fff, 1542px 2053px #fff, 876px 2178px #fff, 479px 1915px #fff, 2297px 1799px #fff, 2160px 387px #fff, 160px 358px #fff, 1122px 2164px #fff, 2056px 1402px #fff, 2133px 1470px #fff, 1508px 1865px #fff, 250px 2157px #fff, 715px 1452px #fff, 2095px 1539px #fff, 1860px 1450px #fff, 185px 2013px #fff, 1855px 1878px #fff, 690px 2520px #fff, 2250px 838px #fff, 1547px 1752px #fff, 1103px 615px #fff, 151px 262px #fff, 1630px 577px #fff, 769px 2448px #fff, 1938px 2347px #fff, 700px 1634px #fff, 2105px 2053px #fff, 1498px 49px #fff, 799px 512px #fff, 1278px 744px #fff, 2301px 364px #fff, 1059px 2066px #fff, 2116px 2424px #fff, 1884px 1046px #fff, 699px 1101px #fff, 62px 1893px #fff, 370px 161px #fff, 298px 1288px #fff, 1972px 2211px #fff, 1834px 2350px #fff, 1591px 1118px #fff, 1343px 1730px #fff, 706px 850px #fff, 317px 1171px #fff, 1395px 2529px #fff, 1040px 2523px #fff, 793px 2535px #fff, 2180px 142px #fff, 2016px 2511px #fff, 1032px 1204px #fff, 499px 625px #fff, 130px 2064px #fff, 1371px 758px #fff, 1045px 2018px #fff, 1954px 309px #fff, 1445px 2514px #fff, 839px 1523px #fff, 920px 238px #fff, 1421px 1105px #fff, 668px 1517px #fff, 2045px 2344px #fff, 2465px 1619px #fff, 403px 48px #fff, 1142px 1102px #fff, 2066px 1803px #fff, 658px 1744px #fff, 721px 2062px #fff, 2180px 827px #fff, 2310px 111px #fff, 935px 808px #fff, 1121px 1108px #fff, 1424px 1998px #fff, 821px 1317px #fff, 2425px 1354px #fff, 305px 1422px #fff, 169px 1559px #fff, 1850px 425px #fff, 719px 1507px #fff, 1650px 1803px #fff, 275px 402px #fff, 1038px 772px #fff, 404px 105px #fff, 78px 2119px #fff, 133px 110px #fff, 2559px 944px #fff, 688px 212px #fff, 869px 2266px #fff, 983px 840px #fff, 1914px 2154px #fff, 1376px 941px #fff, 2064px 739px #fff, 1979px 1255px #fff, 592px 1175px #fff, 283px 253px #fff, 696px 2501px #fff, 1561px 1505px #fff, 745px","date":"2021-01-16","objectID":"/friends/:0:0","tags":null,"title":"æˆ‘çš„å°ä¼™ä¼´ä»¬","uri":"/friends/"},{"categories":null,"content":"äº¤æ¢å‹é“¾ å¦‚æœä½ è§‰å¾—æˆ‘çš„åšå®¢æœ‰äº›æ„æ€ï¼Œè€Œä¸”ä¹Ÿæœ‰è‡ªå·±çš„ç‹¬ç«‹åšå®¢ï¼Œæ¬¢è¿ä¸æˆ‘äº¤æ¢å‹é“¾~ å¯é€šè¿‡ Issues æˆ–è€…è¯„è®ºåŒºæäº¤å‹é“¾ç”³è¯·ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š ç«™ç‚¹åç§°ï¼šRyan4Yin's Space ç«™ç‚¹åœ°å€ï¼šhttps://thiscute.world/ ä¸ªäººå½¢è±¡ï¼šhttps://www.gravatar.com/avatar/2362ce7bdf2845a92240cc2f6609e001?s=240 ç«™ç‚¹æè¿°ï¼šèµç¾å¿«ä¹~ // ä»¥ä¸‹ä¸ºæ ·ä¾‹å†…å®¹ï¼ŒæŒ‰ç…§æ ¼å¼å¯ä»¥éšæ„ä¿®æ”¹ var myFriends = [ [\"https://chee5e.space\", \"https://chee5e.space/images/avatar.jpg\", \"@èŠå£«éƒ¨è½æ ¼\", \"æœ‰æ€æƒ³ï¼Œä¹Ÿæœ‰å¿§ä¼¤å’Œç†æƒ³ï¼ŒèŠå£«å°±æ˜¯åŠ›é‡\"], [\"https://sanshiliuxiao.top/\", \"https://cdn.jsdelivr.net/gh/vensing/static@latest/avatar/sanshiliuxiao.jpg\", \"@ä¸‰åå…­å’²\", \"å¿«èµ°å§ï¼Œè¶é£åœæ­¢ä¹‹å‰\"], [\"https://rea.ink/\", \"https://rea.ink/head.png\", \"@å€¾ä¹¦\", \"æ¸…é£çš“æœˆï¼Œå…‰æ™¯å¸¸æ–° 0) { var rndNum = Math.floor(Math.random()*myFriends.length); var friendNode = document.createElement(\"li\"); var friend_link = document.createElement(\"a\"), friend_img = document.createElement(\"img\"), friend_name = document.createElement(\"h4\"), friend_about = document.createElement(\"p\") ; friend_link.target = \"_blank\"; friend_link.href = myFriends[rndNum][0]; friend_img.src=myFriends[rndNum][1]; friend_name.innerText = myFriends[rndNum][2]; friend_about.innerText = myFriends[rndNum][3]; friend_link.appendChild(friend_img); friend_link.appendChild(friend_name); friend_link.appendChild(friend_about); friendNode.appendChild(friend_link); targetList.appendChild(friendNode); myFriends.splice(rndNum, 1); } .linkpage ul { color: rgba(255,255,255,.15) } .linkpage ul:after { content: \" \"; clear: both; display: block } .linkpage li { float: left; width: 48%; position: relative; -webkit-transition: .3s ease-out; transition: .3s ease-out; border-radius: 5px; line-height: 1.3; height: 90px; display: block } .linkpage h3 { margin: 15px -25px; padding: 0 25px; border-left: 5px solid #51aded; background-color: #f7f7f7; font-size: 25px; line-height: 40px } .linkpage li:hover { background: rgba(230,244,250,.5); cursor: pointer } .linkpage li a { padding: 0 10px 0 90px } .linkpage li a img { width: 60px; height: 60px; border-radius: 50%; position: absolute; top: 15px; left: 15px; cursor: pointer; margin: auto; border: none } .linkpage li a h4 { color: #333; font-size: 18px; margin: 0 0 7px; padding-left: 90px } .linkpage li a h4:hover { color: #51aded } .linkpage li a h4, .linkpage li a p { cursor: pointer; white-space: nowrap; text-overflow: ellipsis; overflow: hidden; line-height: 1.4; margin: 0 !important; } .linkpage li a p { font-size: 12px; color: #999; padding-left: 90px } @media(max-width: 460px) { .linkpage li { width:97% } .linkpage ul { padding-left: 5px } } ","date":"2021-01-16","objectID":"/friends/:1:0","tags":null,"title":"æˆ‘çš„å°ä¼™ä¼´ä»¬","uri":"/friends/"},{"categories":["æŠ€æœ¯"],"content":"Pulumi æ˜¯ä¸€ä¸ªåŸºç¡€è®¾æ–½çš„è‡ªåŠ¨ç®¡ç†å·¥å…·ï¼Œä½¿ç”¨ Python/TypeScript/Go/Dotnet ç¼–å†™å¥½å£°æ˜å¼çš„èµ„æºé…ç½®ï¼Œå°±èƒ½å®ç°ä¸€é”®åˆ›å»º/ä¿®æ”¹/é”€æ¯å„ç±»èµ„æºï¼Œè¿™é‡Œçš„èµ„æºå¯ä»¥æ˜¯ï¼š AWS/é˜¿é‡Œäº‘ç­‰äº‘ä¸Šçš„è´Ÿè½½å‡è¡¡ã€äº‘æœåŠ¡å™¨ã€TLS è¯ä¹¦ã€DNSã€CDNã€OSSã€æ•°æ®åº“â€¦å‡ ä¹æ‰€æœ‰çš„äº‘ä¸Šèµ„æº æœ¬åœ°è‡ªå»ºçš„ vSphere/Kubernetes/ProxmoxVE/libvirt ç¯å¢ƒä¸­çš„è™šæ‹Ÿæœºã€å®¹å™¨ç­‰èµ„æº ç›¸æ¯”ç›´æ¥è°ƒç”¨ AWS/é˜¿é‡Œäº‘/Kubernetes çš„ APIï¼Œä½¿ç”¨ pulumi çš„å¥½å¤„æœ‰ï¼š å£°æ˜å¼é…ç½®ï¼šä½ åªéœ€è¦å£°æ˜ä½ çš„èµ„æºå±æ€§å°± OKï¼Œæ‰€æœ‰çš„çŠ¶æ€ç®¡ç†ã€å¼‚å¸¸å¤„ç†éƒ½ç”± pulumi å®Œæˆã€‚ ç»Ÿä¸€çš„é…ç½®æ–¹å¼ï¼šæä¾›ç»Ÿä¸€çš„é…ç½®æ–¹æ³•ï¼Œæ¥å£°æ˜å¼çš„é…ç½®æ‰€æœ‰ AWS/é˜¿é‡Œäº‘/Kubernetes èµ„æºã€‚ å£°æ˜å¼é…ç½®çš„å¯è¯»æ€§æ›´å¥½ï¼Œæ›´ä¾¿äºç»´æŠ¤ è¯•æƒ³ä¸€ä¸‹ï¼Œé€šè¿‡ä¼ ç»Ÿçš„æ‰‹æ®µå»ä»é›¶æ­å»ºä¸€ä¸ªäº‘ä¸Šæµ‹è¯•ç¯å¢ƒã€æˆ–è€…æœ¬åœ°å¼€å‘ç¯å¢ƒï¼Œéœ€è¦æ‰‹å·¥åšå¤šå°‘ç¹ççš„å·¥ä½œã€‚ è€Œä¾é  Pulumi è¿™ç±»ã€ŒåŸºç¡€è®¾æ–½å³ä»£ç ã€çš„å·¥å…·ï¼Œåªéœ€è¦ä¸€è¡Œå‘½ä»¤å°±èƒ½æ­å»ºå¥½ä¸€ä¸ªå¯å¤ç°çš„äº‘ä¸Šæµ‹è¯•ç¯å¢ƒæˆ–æœ¬åœ°å¼€å‘ç¯å¢ƒã€‚ æ¯”å¦‚æˆ‘ä»¬çš„é˜¿é‡Œäº‘æµ‹è¯•ç¯å¢ƒï¼ŒåŒ…æ‹¬ä¸¤ä¸ª kubernetes é›†ç¾¤ã€è´Ÿè½½å‡è¡¡ã€VPC ç½‘ç»œã€æ•°æ®åº“ã€äº‘ç›‘æ§å‘Šè­¦/æ—¥å¿—å‘Šè­¦ã€RAMè´¦å·æƒé™ä½“ç³»ç­‰ç­‰ï¼Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„ä½“ç³»ã€‚ äººå·¥å»é…ç½®è¿™ä¹ˆå¤šä¸œè¥¿ï¼Œæƒ³è¦å¤ç°æ˜¯å¾ˆå›°éš¾çš„ï¼Œéå¸¸ç¹çè€Œä¸”å®¹æ˜“å‡ºé”™ã€‚ ä½†æ˜¯ä½¿ç”¨ pulumiï¼Œåªéœ€è¦ä¸€è¡Œå‘½ä»¤ï¼Œå°±èƒ½åˆ›å»ºå¹¶é…ç½®å¥½è¿™äº”èŠ±å…«é—¨ä¸€å¤§å †çš„ç©æ„å„¿ã€‚ é”€æ¯æ•´ä¸ªæµ‹è¯•ç¯å¢ƒä¹Ÿåªéœ€è¦ä¸€è¡Œå‘½ä»¤ã€‚ å®é™…ä½¿ç”¨ä½“éªŒï¼šæˆ‘ä»¬ä½¿ç”¨ Pulumi è‡ªåŠ¨åŒ–äº†é˜¿é‡Œäº‘æµ‹è¯•ç¯å¢ƒæ­å»º 95%+ çš„æ“ä½œï¼Œè¿™ä¸ªæ¯”ä¾‹éšç€é˜¿é‡Œäº‘çš„ pulumi provider çš„å®Œå–„ï¼Œè¿˜å¯ä»¥è¿›ä¸€æ­¥æé«˜ï¼ ","date":"2021-01-08","objectID":"/posts/expirence-of-pulumi/:0:0","tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/expirence-of-pulumi/"},{"categories":["æŠ€æœ¯"],"content":"Pulumi vs Terraform æœ‰ä¸€ä¸ªã€ŒåŸºç¡€è®¾æ–½å³ä»£ç ã€çš„å·¥å…·æ¯” Pulumi æ›´æµè¡Œï¼Œå®ƒå°±æ˜¯ Terraform. å®é™…ä¸Šæˆ‘ä»¬ä¸€å¼€å§‹ä½¿ç”¨çš„ä¹Ÿæ˜¯ Terraformï¼Œä½†æ˜¯åæ¥ä½¿ç”¨ Pulumi å®Œå…¨é‡å†™äº†ä¸€éã€‚ ä¸»è¦åŸå› æ˜¯ï¼ŒPulumi è§£å†³äº† Terraform é…ç½®çš„ä¸€ä¸ªç—›ç‚¹ï¼šé…ç½®è¯­æ³•å¤ªè¿‡ç®€å•ï¼Œå¯¼è‡´é…ç½®ç¹çã€‚è€Œä¸”è¿˜è¦é¢å¤–å­¦ä¹ ä¸€é—¨ DSL - HCL Terraform è™½ç„¶åº”ç”¨å¹¿æ³›ï¼Œä½†æ˜¯å®ƒé»˜è®¤ä½¿ç”¨çš„ HCL è¯­è¨€å¤ªç®€å•ï¼Œè¡¨ç°åŠ›ä¸å¤Ÿå¼ºã€‚ è¿™å°±å¯¼è‡´åœ¨ä¸€äº›åœºæ™¯ä¸‹ä½¿ç”¨ Terraformï¼Œä¼šå‡ºç°å¤§é‡çš„é‡å¤é…ç½®ã€‚ ä¸€ä¸ªå…¸å‹çš„åœºæ™¯æ˜¯ã€Œæ‰¹é‡åˆ›å»ºèµ„æºï¼ŒåŠ¨æ€ç”Ÿæˆèµ„æºå‚æ•°ã€ã€‚æ¯”å¦‚æ‰¹é‡åˆ›å»ºä¸€æ‰¹åç§°ç±»ä¼¼çš„ ECS æœåŠ¡å™¨/VPCäº¤æ¢æœºã€‚å¦‚æœä½¿ç”¨ terraformï¼Œå°±ä¼šå‡ºç°å¤§é‡çš„é‡å¤é…ç½®ã€‚ æ”¹ç”¨ terraform æä¾›çš„ module èƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šå®ç°é…ç½®çš„å¤ç”¨ï¼Œä½†æ˜¯å®ƒè¿˜æ˜¯è§£å†³ä¸äº†é—®é¢˜ã€‚ è¦ä½¿ç”¨ moduleï¼Œä½ éœ€è¦ä»˜å‡ºæ—¶é—´å»å­¦ä¹  module çš„æ¦‚å¿µï¼Œä¸ºäº†æ‹¼æ¥å‚æ•°ï¼Œä½ è¿˜éœ€è¦å­¦ä¹  HCL çš„ä¸€äº›é«˜çº§ç”¨æ³•ã€‚ ä½†æ˜¯ä»˜å‡ºäº†è¿™ä¹ˆå¤šï¼Œæœ€åå†™å‡ºçš„ module è¿˜æ˜¯ä¸å¤Ÿçµæ´»â€”â€”å®ƒè¢« HCL å±€é™ä½äº†ã€‚ ä¸ºäº†å®ç°å¦‚æ­¤çš„å‚æ•°åŒ–åŠ¨æ€åŒ–ï¼Œæˆ‘ä»¬ä¸å¾—ä¸å¼•å…¥ Python ç­‰å…¶ä»–ç¼–ç¨‹è¯­è¨€ã€‚äºæ˜¯æ„å»ºæµç¨‹å°±å˜æˆäº†ï¼š å€ŸåŠ© Python ç­‰å…¶ä»–è¯­è¨€å…ˆç”Ÿæˆå‡º HCL é…ç½® é€šè¿‡ terraform å‘½ä»¤è¡Œè¿›è¡Œ plan ä¸ apply é€šè¿‡ Python ä»£ç è§£æ terraform.tfstatï¼Œè·å– apply ç»“æœï¼Œå†è¿›è¡Œè¿›ä¸€æ­¥æ“ä½œã€‚ è¿™æ˜¾ç„¶éå¸¸ç¹çï¼Œä¸»è¦å›°éš¾å°±åœ¨äº Python å’Œ Terraform ä¹‹é—´çš„äº¤äº’ã€‚ è¿›ä¸€æ­¥æ€è€ƒï¼Œæ—¢ç„¶å…¶ä»–ç¼–ç¨‹è¯­è¨€å¦‚ Python/Go çš„å¼•å…¥ä¸å¯é¿å…ï¼Œé‚£æ˜¯ä¸æ˜¯èƒ½ä½¿ç”¨å®ƒä»¬å½»åº•æ›¿ä»£æ‰ HCL å‘¢ï¼Ÿèƒ½ä¸èƒ½ç›´æ¥ä½¿ç”¨ Python/Go ç¼–å†™é…ç½®ï¼Ÿå¦‚æœ Terraform åŸç”Ÿå°±æ”¯æŒ Python/Go æ¥ç¼–å†™é…ç½®ï¼Œé‚£å°±ä¸å­˜åœ¨äº¤äº’é—®é¢˜äº†ã€‚ ç›¸æ¯”äºä½¿ç”¨é¢†åŸŸç‰¹å®šè¯­è¨€ HCLï¼Œä½¿ç”¨é€šç”¨ç¼–ç¨‹è¯­è¨€ç¼–å†™é…ç½®ï¼Œå¥½å¤„æœ‰ï¼š Python/Go/TypeScript ç­‰é€šç”¨çš„ç¼–ç¨‹è¯­è¨€ï¼Œèƒ½æ»¡è¶³ä½ çš„ä¸€åˆ‡éœ€æ±‚ã€‚ ä½œä¸ºä¸€ä¸ªå¼€å‘äººå‘˜/DevOpsï¼Œä½ åº”è¯¥å¯¹ Python/Go ç­‰è¯­è¨€ç›¸å½“ç†Ÿæ‚‰ï¼Œå¯ä»¥ç›´æ¥åˆ©ç”¨ä¸Šå·²æœ‰çš„ç»éªŒã€‚ æ›´æ–¹ä¾¿æµ‹è¯•ï¼šå¯ä»¥ä½¿ç”¨å„ç¼–ç¨‹è¯­è¨€ä¸­æµè¡Œçš„æµ‹è¯•æ¡†æ¶æ¥æµ‹è¯• pulumi é…ç½®ï¼ äºæ˜¯ Pulumi æ¨ªç©ºå‡ºä¸–ã€‚ å¦ä¸€ä¸ªå’Œ Pulumi åŠŸèƒ½ç±»ä¼¼çš„å·¥å…·ï¼Œæ˜¯åˆšå‡ºç‚‰æ²¡å¤šä¹…çš„ terraform-cdkï¼Œä½†æ˜¯ç›®å‰å®ƒè¿˜å¾ˆä¸æˆç†Ÿã€‚ ","date":"2021-01-08","objectID":"/posts/expirence-of-pulumi/:1:0","tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/expirence-of-pulumi/"},{"categories":["æŠ€æœ¯"],"content":"Pulumi ç‰¹ç‚¹ä»‹ç» åŸç”Ÿæ”¯æŒé€šè¿‡ Python/Go/TypeScript/Dotnet ç­‰è¯­è¨€ç¼–å†™é…ç½®ï¼Œä¹Ÿå°±å®Œå…¨è§£å†³äº†ä¸Šè¿°çš„ terraform å’Œ python çš„äº¤äº’é—®é¢˜ã€‚ pulumi æ˜¯ç›®å‰æœ€æµè¡Œçš„ çœŸ-IaaS å·¥å…·ï¼Œå¯¹å„è¯­è¨€çš„æ”¯æŒéƒ½å¾ˆæˆç†Ÿã€‚ å…¼å®¹ terraform çš„æ‰€æœ‰ providerï¼Œåªæ˜¯éœ€è¦è‡ªè¡Œä½¿ç”¨ pulumi-tf-provider-boilerplate é‡æ–°æ‰“åŒ…ï¼Œæœ‰äº›éº»çƒ¦ã€‚ pulumi å®˜æ–¹çš„ provider å‡ ä¹å…¨éƒ½æ˜¯å°è£…çš„ terraform providerï¼ŒåŒ…æ‹¬ aws/azure/alicloudï¼Œç›®å‰åªå‘ç° kubernetes æ˜¯åŸç”Ÿçš„ï¼ˆç‹¬è‹—å•Šï¼‰ã€‚ çŠ¶æ€ç®¡ç†å’Œ secrets ç®¡ç†æœ‰å¦‚ä¸‹å‡ ç§é€‰æ‹©ï¼š ä½¿ç”¨ app.pulumi.comï¼ˆé»˜è®¤ï¼‰:å…è´¹ç‰ˆæä¾› stack å†å²ç®¡ç†ï¼Œå¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„å†å²è®°å½•ã€‚å¦å¤–è¿˜æä¾›ä¸€ä¸ªèµ„æºå…³ç³»çš„å¯è§†åŒ–é¢æ¿ã€‚æ€»ä¹‹å¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯å¤šäººåˆä½œå°±éœ€è¦æ”¶è´¹ã€‚ æœ¬åœ°æ–‡ä»¶å­˜å‚¨ï¼špulumi login file:///app/data äº‘ç«¯å¯¹è±¡å­˜å‚¨ï¼Œæ”¯æŒ s3 ç­‰å¯¹è±¡å­˜å‚¨åè®®ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ AWS æˆ–è€…æœ¬åœ°çš„ MinIO æ¥åš Backend. pulumi login 's3://\u003cbucket-path\u003e?endpoint=my.minio.local:8080\u0026disableSSL=true\u0026s3ForcePathStyle=true' minio/aws çš„ creadential å¯ä»¥é€šè¿‡ AWS_ACCESS_KEY_ID å’Œ AWS_SECRET_ACCESS_KEY ä¸¤ä¸ªç¯å¢ƒå˜é‡è®¾ç½®ã€‚å¦å¤–å³ä½¿æ˜¯ä½¿ç”¨ MinIOï¼ŒAWS_REGION è¿™ä¸ªæ²¡å•¥ç”¨çš„ç¯å¢ƒå˜é‡ä¹Ÿå¿…é¡»è®¾ç½®ï¼å¦åˆ™ä¼šæŠ¥é”™ã€‚ gitlab 13 æ”¯æŒ Terraform HTTP State åè®®ï¼Œç­‰è¿™ä¸ª pr åˆå¹¶ï¼Œpulumi ä¹Ÿèƒ½ä»¥ gitlab ä¸º backend äº†ã€‚ ä½¿ç”¨ pulumi ä¼ä¸šç‰ˆï¼ˆè‡ªå»ºæœåŠ¡ï¼‰ï¼šæ¯” app.pulumi.com æä¾›æ›´å¤šçš„ç‰¹æ€§ï¼Œä½†æ˜¯æ˜¾ç„¶æ˜¯æ”¶è´¹çš„ã€‚ã€‚ æ€»ä¹‹ï¼Œéå¸¸é¦™ï¼Œå¼ºçƒˆæ¨èå„ä½ DevOps è¯•ç”¨ã€‚ ä»¥ä¸‹å†…å®¹æ˜¯æˆ‘å¯¹ pulumi çš„ä¸€äº›æ€è€ƒï¼Œä»¥åŠä½¿ç”¨ pulumi é‡åˆ°çš„å„ç§é—®é¢˜+è§£å†³æ–¹æ³•ï¼Œé€‚åˆå¯¹ pulumi æœ‰ä¸€å®šäº†è§£çš„åŒå­¦é˜…è¯»ã€‚ å¦‚æœä½ åˆšæ¥è§¦ Pulumi è€Œä¸”æœ‰å…´è¶£å­¦ä¹ ï¼Œå»ºè®®å…ˆç§»æ­¥ pulumi get started å…¥ä¸ªé—¨ï¼Œå†æ¥ç€çœ‹ä¸‹é¢çš„å†…å®¹ã€‚ ","date":"2021-01-08","objectID":"/posts/expirence-of-pulumi/:2:0","tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/expirence-of-pulumi/"},{"categories":["æŠ€æœ¯"],"content":"ä½¿ç”¨å»ºè®® å»ºè®®æŸ¥çœ‹å¯¹åº”çš„ terraform provider æ–‡æ¡£ï¼špulumi çš„ provider åŸºæœ¬éƒ½æ˜¯å°è£…çš„ terraform ç‰ˆæœ¬ï¼Œè€Œä¸”æ–‡æ¡£æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œæ¯”ï¼ˆç®€ï¼‰è¾ƒï¼ˆç›´ï¼‰éš¾ï¼ˆä¸€ï¼‰çœ‹ï¼ˆå¨ï¼‰æ‡‚ï¼ˆshiï¼‰ï¼Œexamples ä¹Ÿå°‘ã€‚ stack: pulumi å®˜æ–¹æä¾›äº†ä¸¤ç§ stack ç”¨æ³•ï¼šã€Œå•ä½“ã€å’Œã€Œå¾®-stackã€ å•ä½“: one stack rule them allï¼Œé€šè¿‡ stack å‚æ•°æ¥æ§åˆ¶æ­¥éª¤ã€‚stack ç”¨æ¥åŒºåˆ†ç¯å¢ƒ dev/pro ç­‰ã€‚ å¾®-stack: æ¯ä¸€ä¸ª stack æ˜¯ä¸€ä¸ªæ­¥éª¤ï¼Œæ‰€æœ‰ stack ç»„æˆä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®ã€‚ å®é™…ä½¿ç”¨ä¸­ï¼Œæˆ‘å‘ç°ã€Œå¾®-stackã€æ¨¡å¼éœ€è¦ä½¿ç”¨åˆ° pulumi çš„ inter-stack dependenciesï¼ŒæŠ¥ä¸€å †çš„é”™ï¼Œè€Œä¸”ä¸å¤Ÿçµæ´»ã€‚å› æ­¤ç›®å‰æ›´æ¨èã€Œå•ä½“ã€æ¨¡å¼ã€‚ æˆ‘ä»¬æœ€è¿‘ä½¿ç”¨ pulumi å®Œå…¨é‡å†™äº†ä»¥å‰ç”¨ terraform ç¼–å†™çš„äº‘ä¸Šé…ç½®ï¼Œç®€åŒ–äº†å¾ˆå¤šç¹ççš„é…ç½®ï¼Œä¹Ÿé™ä½äº†æˆ‘ä»¬ Python è¿ç»´ä»£ç å’Œ terraform ä¹‹é—´çš„äº¤äº’éš¾åº¦ã€‚ å¦å¤–æˆ‘ä»¬è¿˜å……åˆ†åˆ©ç”¨ä¸Šäº† Python çš„ç±»å‹æ£€æŸ¥å’Œè¯­æ³•æ£€æŸ¥ï¼Œå¾ˆå¤šé”™è¯¯ IDE éƒ½èƒ½ç›´æ¥ç»™å‡ºæç¤ºï¼Œå¼ºåŒ–äº†é…ç½®çš„ä¸€è‡´æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ ä¸è¿‡ç”±äºé˜¿é‡Œäº‘ provider æš‚æ—¶è¿˜ï¼š ä¸æ”¯æŒç®¡ç† ASM æœåŠ¡ç½‘æ ¼ã€DTS æ•°æ®ä¼ è¾“ç­‰èµ„æº OSS ç­‰äº§å“çš„éƒ¨åˆ†å‚æ•°ä¹Ÿæš‚æ—¶ä¸æ”¯æŒé…ç½®ï¼ˆæ¯”å¦‚ OSS ä¸æ”¯æŒé…ç½®å›¾ç‰‡æ ·å¼ã€ElasticSearch æš‚æ—¶ä¸æ”¯æŒè‡ªåŠ¨åˆ›å»º 7.x ç‰ˆæœ¬ï¼‰ ä¸æ”¯æŒåˆ›å»º ElasticSearch 7.x è¿™äº›é—®é¢˜ï¼Œå¯¼è‡´æˆ‘ä»¬ä»ç„¶æœ‰éƒ¨åˆ†é…ç½®éœ€è¦æ‰‹åŠ¨å¤„ç†ï¼Œå¦å¤–ä¸€äº›è€—æ—¶é•¿çš„èµ„æºï¼Œéœ€è¦å•ç‹¬å»åˆ›å»ºã€‚ å› æ­¤è¿˜ä¸èƒ½å®ç°å®Œå…¨çš„ã€Œä¸€é”®ã€ã€‚ ","date":"2021-01-08","objectID":"/posts/expirence-of-pulumi/:3:0","tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/expirence-of-pulumi/"},{"categories":["æŠ€æœ¯"],"content":"å¸¸è§é—®é¢˜ ","date":"2021-01-08","objectID":"/posts/expirence-of-pulumi/:4:0","tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/expirence-of-pulumi/"},{"categories":["æŠ€æœ¯"],"content":"1. Output çš„ç”¨æ³• pulumi é€šè¿‡èµ„æºä¹‹é—´çš„å±æ€§å¼•ç”¨ï¼ˆOutput[str]ï¼‰æ¥ç¡®å®šä¾èµ–å…³ç³»ï¼Œå¦‚æœä½ é€šè¿‡è‡ªå®šä¹‰çš„å±æ€§(str)è§£è€¦äº†èµ„æºä¾èµ–ï¼Œä¼šå¯¼è‡´èµ„æºåˆ›å»ºé¡ºåºé”™è¯¯è€Œåˆ›å»ºå¤±è´¥ã€‚ Output[str] æ˜¯ä¸€ä¸ªå¼‚æ­¥å±æ€§ï¼Œç±»ä¼¼ Futureï¼Œä¸èƒ½è¢«ç”¨åœ¨ pulumi å‚æ•°ä¹‹å¤–çš„åœ°æ–¹ï¼ Output[str] æä¾›ä¸¤ç§æ–¹æ³•èƒ½ç›´æ¥å¯¹ Output[str] è¿›è¡Œä¸€äº›æ“ä½œï¼š Output.concat(\"http://\", domain, \"/\", path): æ­¤æ–¹æ³•å°† str ä¸ Output[str] æ‹¼æ¥èµ·æ¥ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ Output[str] å¯¹è±¡ï¼Œå¯ç”¨åš pulumi å±æ€§ã€‚ domain.apply(lambda it: print(it)): Output[str] çš„ apply æ–¹æ³•æ¥æ”¶ä¸€ä¸ªå‡½æ•°ã€‚åœ¨å¼‚æ­¥è·å–åˆ°æ•°æ®åï¼Œpulumi ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼ŒæŠŠå…·ä½“çš„æ•°æ®ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚ å¦å¤– apply ä¹Ÿä¼šå°†ä¼ å…¥å‡½æ•°çš„è¿”å›å€¼åŒ…è£…æˆ Output ç±»å‹è¿”å›å‡ºæ¥ã€‚ å¯ç”¨äºï¼šåœ¨è·å–åˆ°æ•°æ®åï¼Œå°†æ•°æ®æ‰“å°å‡ºæ¥/å‘é€åˆ°é‚®ç®±/è°ƒç”¨æŸä¸ª API ä¸Šä¼ æ•°æ®ç­‰ç­‰ã€‚ Output.all(output1, output2, ...).apply(lambda it: print(it)) å¯ç”¨äºå°†å¤šä¸ª output å€¼ï¼Œæ‹¼æ¥æˆä¸€ä¸ª Output ç±»å‹ï¼Œå…¶å†…éƒ¨çš„ raw å€¼ä¸ºä¸€ä¸ª tuple å¯¹è±¡ (str1, str2, ...). å®˜æ–¹ä¸¾ä¾‹ï¼šconnection_string = Output.all(sql_server.name, database.name).apply(lambda args: f\"Server=tcp:{args[0]}.database.windows.net;initial catalog={args[1]}...\") ","date":"2021-01-08","objectID":"/posts/expirence-of-pulumi/:4:1","tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/expirence-of-pulumi/"},{"categories":["æŠ€æœ¯"],"content":"2. å¦‚ä½•ä½¿ç”¨å¤šä¸ªäº‘è´¦å·/å¤šä¸ª k8s é›†ç¾¤ï¼Ÿ é»˜è®¤æƒ…å†µä¸‹ pulumi ä½¿ç”¨é»˜è®¤çš„ providerï¼Œä½†æ˜¯ pulumi æ‰€æœ‰çš„èµ„æºéƒ½æœ‰ä¸€ä¸ªé¢å¤–çš„ opts å‚æ•°ï¼Œå¯ç”¨äºè®¾å®šå…¶ä»– providerã€‚ é€šè¿‡è¿™ä¸ª optsï¼Œæˆ‘ä»¬å¯ä»¥å®ç°åœ¨ä¸€ä¸ª pulumi é¡¹ç›®ä¸­ï¼Œä½¿ç”¨å¤šä¸ªäº‘è´¦å·ï¼Œæˆ–è€…ç®¡ç†å¤šä¸ª k8s é›†ç¾¤ã€‚ ç¤ºä¾‹ï¼š from pulumi import get_stack, ResourceOptions, StackReference from pulumi_alicloud import Provider, oss # è‡ªå®šä¹‰ providerï¼Œkey/secret é€šè¿‡å‚æ•°è®¾å®šï¼Œè€Œä¸æ˜¯ä»é»˜è®¤çš„ç¯å¢ƒå˜é‡è¯»å–ã€‚ # å¯ä»¥è‡ªå®šä¹‰å¾ˆå¤šä¸ª providers provider = pulumi_alicloud.Provider( \"custom-alicloud-provider\", region=\"cn-hangzhou\", access_key=\"xxx\", secret_key=\"jjj\", ) # é€šè¿‡ optsï¼Œè®© pulumi ä½¿ç”¨è‡ªå®šä¹‰çš„ providerï¼ˆæ›¿æ¢æ‰é»˜è®¤çš„ï¼‰ bucket = oss.Bucket(..., opts=ResourceOptions(provider=provider)) ","date":"2021-01-08","objectID":"/posts/expirence-of-pulumi/:4:2","tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/expirence-of-pulumi/"},{"categories":["æŠ€æœ¯"],"content":"3. inter-stack å±æ€§ä¼ é€’ è¿™ä¸œè¥¿è¿˜æ²¡æé€ï¼Œå¾…ç ”ç©¶ã€‚ å¤šä¸ª stack ä¹‹é—´è¦äº’ç›¸ä¼ é€’å‚æ•°ï¼Œéœ€è¦é€šè¿‡ pulumi.export å¯¼å‡ºå±æ€§ï¼Œé€šè¿‡ stack.require_xxx è·å–å±æ€§ã€‚ ä»å¦ä¸€ä¸ª stack è¯»å–å±æ€§çš„ç¤ºä¾‹ï¼š from pulumi import StackReference cfg = pulumi.Config() stack_name = pulumi.get_stack() # stack åç§° project = pulumi.get_project() infra = StackReference(f\"ryan4yin/{project}/{stack_name}\") # è¿™ä¸ªå±æ€§åœ¨ä¸Šä¸€ä¸ª stack ä¸­è¢« export å‡ºæ¥ vpc_id = infra.require(\"resources.vpc.id\") ","date":"2021-01-08","objectID":"/posts/expirence-of-pulumi/:4:3","tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/expirence-of-pulumi/"},{"categories":["æŠ€æœ¯"],"content":"4. pulumi up è¢«ä¸­æ–­ï¼Œæˆ–è€…å¯¹èµ„æºåšäº†æ‰‹åŠ¨ä¿®æ”¹ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ å¼ºè¡Œä¸­æ–­ pulumi upï¼Œä¼šå¯¼è‡´èµ„æºè¿›å…¥ pending çŠ¶æ€ï¼Œå¿…é¡»æ‰‹åŠ¨ä¿®å¤ã€‚ ä¿®å¤æ–¹æ³•ï¼špulumi stack exportï¼Œåˆ é™¤ pending èµ„æºï¼Œå† pulumi stack import æ‰‹åŠ¨åˆ é™¤äº†äº‘ä¸Šèµ„æºï¼Œæˆ–è€…ä¿®æ”¹äº†ä¸€äº›å¯¹èµ„æºç®¡ç†æ— å½±å“çš„å‚æ•°ï¼Œå¯¹ pulumi æ²¡æœ‰å½±å“ï¼Œå®ƒèƒ½æ­£ç¡®æ£€æµ‹åˆ°è¿™ç§æƒ…å†µã€‚ å¯ä»¥é€šè¿‡ pulumi refresh æ‰‹åŠ¨ä»äº‘ä¸Šæ‹‰å–æœ€æ–°çš„èµ„æºçŠ¶æ€ã€‚ æ‰‹åŠ¨æ›´æ”¹äº†èµ„æºä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼ˆæ¯”å¦‚ç»‘å®š EIP ä¹‹ç±»çš„ï¼‰ï¼Œå¾ˆå¯èƒ½å¯¼è‡´ pulumi æ— æ³•æ­£ç¡®ç®¡ç†èµ„æºä¹‹é—´çš„ä¾èµ–ã€‚ è¿™ç§æƒ…å†µå¿…é¡»å…ˆæ‰‹åŠ¨è¿˜åŸä¾èµ–å…³ç³»ï¼ˆæˆ–è€…æŠŠç›¸å…³èµ„æºå…¨éƒ¨æ‰‹åŠ¨åˆ é™¤æ‰ï¼‰ï¼Œç„¶åæ‰èƒ½ç»§ç»­ä½¿ç”¨ pulumiã€‚ ","date":"2021-01-08","objectID":"/posts/expirence-of-pulumi/:4:4","tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/expirence-of-pulumi/"},{"categories":["æŠ€æœ¯"],"content":"5. å¦‚ä½•æ‰‹åŠ¨å£°æ˜èµ„æºé—´çš„ä¾èµ–å…³ç³»ï¼Ÿ æœ‰æ—¶å€™å› ä¸ºä¸€äº›é—®é¢˜ï¼ˆæ¯”å¦‚ pulumi provider åŠŸèƒ½ç¼ºå¤±ï¼Œä½¿ç”¨äº† restful api å®ç°éƒ¨åˆ†åŠŸèƒ½ï¼‰ï¼Œpulumi å¯èƒ½æ— æ³•è¯†åˆ«åˆ°æŸäº›èµ„æºä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚ è¿™æ—¶å¯ä»¥ä¸ºèµ„æºæ·»åŠ  dependsOn å±æ€§ï¼Œè¿™ä¸ªå±æ€§èƒ½æ˜¾å¼åœ°å£°æ˜ä¾èµ–å…³ç³»ã€‚ ","date":"2021-01-08","objectID":"/posts/expirence-of-pulumi/:4:5","tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/expirence-of-pulumi/"},{"categories":["æŠ€æœ¯"],"content":"6. å¦‚ä½•å¯¼å…¥å·²ç»å­˜åœ¨çš„èµ„æºï¼Ÿ ç”±äºå†å²åŸå› ï¼Œæˆ‘ä»¬å¯èƒ½æœ‰éƒ¨åˆ†èµ„æºæ˜¯æ‰‹åŠ¨åˆ›å»ºæˆ–è€…ç”±å…¶ä»– IaC å·¥å…·ç®¡ç†çš„ï¼Œè¯¥å¦‚ä½•å°†å®ƒä»¬çº³å…¥ pulumi ç®¡è¾–å‘¢ï¼Ÿ å®˜æ–¹æœ‰æä¾›ä¸€ç¯‡ç›¸å…³æ–‡æ¡£ Importing Infrastructure. æ–‡æ¡£æœ‰æåˆ°ä¸‰ç§èµ„æºå¯¼å…¥çš„æ–¹æ³•ï¼š ä½¿ç”¨ pulumi import å‘½ä»¤ï¼Œè¿™ä¸ªå‘½ä»¤èƒ½å¯¼å…¥èµ„æºåŒæ—¶è‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„ä»£ç ã€‚ æ„Ÿè§‰è¿™ä¸ªå‘½ä»¤ä¹Ÿå¾ˆé€‚åˆç”¨æ¥åšèµ„æºçš„é…ç½®å¤‡ä»½ï¼Œä¸éœ€è¦å¯¹ç…§èµ„æºæ‰‹å†™ pulumi ä»£ç äº†ï¼Œå¥½è¯„ã€‚ æ‰¹é‡å¯¼å…¥èµ„æºï¼šæ–‡æ¡£çš„ Bulk Import Operations è¿™ä¸€èŠ‚ä»‹ç»äº†å¦‚ä½•é€šè¿‡ json åˆ—å‡ºèµ„æºæ¸…å•ï¼Œç„¶åä½¿ç”¨ pulumi import -f resources.json è‡ªåŠ¨ç”Ÿæˆæ‰€æœ‰å¯¼å…¥èµ„æºçš„ pulumi ä»£ç ã€‚ ","date":"2021-01-08","objectID":"/posts/expirence-of-pulumi/:4:6","tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/expirence-of-pulumi/"},{"categories":["æŠ€æœ¯"],"content":"5. pulumi-kubernetesï¼Ÿ pulumi-kubernetes æ˜¯ä¸€æ¡é¾™æœåŠ¡ï¼š åœ¨ yaml é…ç½®ç”Ÿæˆè¿™ä¸€æ­¥ï¼Œå®ƒèƒ½ç»“åˆ/æ›¿ä»£æ‰ helm/kustomizeï¼Œæˆ–è€…ä½ é«˜åº¦è‡ªå®šä¹‰çš„ Python è„šæœ¬ã€‚ åœ¨ yaml éƒ¨ç½²è¿™ä¸€æ­¥ï¼Œå®ƒèƒ½æ›¿ä»£æ‰ argo-cd è¿™ç±» gitops å·¥å…·ã€‚ å¼ºå¤§çš„çŠ¶æ€ç®¡ç†ï¼Œargo-cd ä¹Ÿæœ‰çŠ¶æ€ç®¡ç†ï¼Œå¯ä»¥å¯¹æ¯”çœ‹çœ‹ã€‚ ä¹Ÿå¯ä»¥ä»…é€šè¿‡ kubernetes_pulumi ç”Ÿæˆ yamlï¼Œå†é€šè¿‡ argo-cd éƒ¨ç½²ï¼Œè¿™æ · pulumi_kubernetes å°±ä»…ç”¨æ¥ç®€åŒ– yaml çš„ç¼–å†™ï¼Œä»ç„¶é€šè¿‡ gitops å·¥å…·/kubectl æ¥éƒ¨ç½²ã€‚ ä½¿ç”¨ pulumi-kubernetes å†™é…ç½®ï¼Œè¦è­¦æƒ•é€»è¾‘å’Œæ•°æ®çš„æ··åˆç¨‹åº¦ã€‚ å› ä¸º kubernetes çš„é…ç½®å¤æ‚åº¦æ¯”è¾ƒé«˜ï¼Œå¦‚æœåŠ¨æ€é…ç½®æ¯”è¾ƒå¤šï¼Œå¾ˆå®¹æ˜“å°±ä¼šå†™å‡ºéš¾ä»¥ç»´æŠ¤çš„ python ä»£ç æ¥ã€‚ æ¸²æŸ“ yaml çš„ç¤ºä¾‹ï¼š from pulumi import get_stack, ResourceOptions, StackReference from pulumi_kubernetes import Provider from pulumi_kubernetes.apps.v1 import Deployment, DeploymentSpecArgs from pulumi_kubernetes.core.v1 import ( ContainerArgs, ContainerPortArgs, EnvVarArgs, PodSpecArgs, PodTemplateSpecArgs, ResourceRequirementsArgs, Service, ServicePortArgs, ServiceSpecArgs, ) from pulumi_kubernetes.meta.v1 import LabelSelectorArgs, ObjectMetaArgs provider = Provider( \"render-yaml\", render_yaml_to_directory=\"rendered\", ) deployment = Deployment( \"redis\", spec=DeploymentSpecArgs(...), opts=ResourceOptions(provider=provider), ) å¦‚ç¤ºä¾‹æ‰€ç¤ºï¼Œpulumi-kubernetes çš„é…ç½®æ˜¯å®Œå…¨ç»“æ„åŒ–çš„ï¼Œæ¯” yaml/helm/kustomize è¦çµæ´»éå¸¸å¤šã€‚ æ€»ä¹‹å®ƒéå¸¸çµæ´»ï¼Œæ—¢å¯ä»¥å’Œ helm/kustomize ç»“åˆä½¿ç”¨ï¼Œæ›¿ä»£æ‰ argocd/kubectlã€‚ ä¹Ÿå¯ä»¥å’Œ argocd/kubectl ä½¿ç”¨ï¼Œæ›¿ä»£æ‰ helm/kustomizeã€‚ å…·ä½“æ€ä¹ˆä½¿ç”¨å¥½ï¼Ÿæˆ‘ä¹Ÿè¿˜åœ¨ç ”ç©¶ã€‚ ","date":"2021-01-08","objectID":"/posts/expirence-of-pulumi/:4:7","tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/expirence-of-pulumi/"},{"categories":["æŠ€æœ¯"],"content":"6. é˜¿é‡Œäº‘èµ„æº replace æŠ¥é”™ï¼Ÿ é˜¿é‡Œäº‘æœ‰éƒ¨åˆ†èµ„æºï¼Œåªèƒ½åˆ›å»ºåˆ é™¤ï¼Œä¸å…è®¸ä¿®æ”¹ï¼Œæ¯”å¦‚ã€Œèµ„æºç»„ã€ã€‚ å¯¹è¿™ç±»èµ„æºåšå˜æ›´æ—¶ï¼Œpulumi ä¼šç›´æ¥æŠ¥é”™ï¼šã€ŒResources aleardy existsã€ï¼Œ è¿™ç±»èµ„æºï¼Œé€šå¸¸éƒ½æœ‰ä¸€ä¸ªã€Œforceã€å‚æ•°ï¼ŒæŒ‡ç¤ºæ˜¯å¦å¼ºåˆ¶ä¿®æ”¹â€”â€”å³å…ˆåˆ é™¤å†é‡å»ºã€‚ ","date":"2021-01-08","objectID":"/posts/expirence-of-pulumi/:4:8","tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/expirence-of-pulumi/"},{"categories":["æŠ€æœ¯"],"content":"7. æœ‰äº›èµ„æºå±æ€§æ— æ³•ä½¿ç”¨ pulumi é…ç½®ï¼Ÿ è¿™å¾—çœ‹å„äº‘æœåŠ¡æä¾›å•†çš„æ”¯æŒæƒ…å†µã€‚ æ¯”å¦‚é˜¿é‡Œäº‘å¾ˆå¤šèµ„æºçš„å±æ€§ï¼Œpulumi éƒ½æ— æ³•å®Œå…¨é…ç½®ï¼Œå› ä¸º alicloud provider çš„åŠŸèƒ½è¿˜ä¸å¤Ÿå…¨é¢ã€‚ ç›®å‰æˆ‘ä»¬ç”Ÿäº§ç¯å¢ƒï¼Œå¤§æ¦‚ 95%+ çš„ä¸œè¥¿ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ pulumi å®ç°è‡ªåŠ¨åŒ–é…ç½®ã€‚ è€Œå…¶ä»– OSS çš„é«˜çº§å‚æ•°ã€æ–°å‡ºçš„ ASM æœåŠ¡ç½‘æ ¼ã€kubernetes çš„æˆæƒç®¡ç†ã€ElasticSearch7 ç­‰èµ„æºï¼Œè¿˜æ˜¯éœ€è¦æ‰‹åŠ¨é…ç½®ã€‚ è¿™ä¸ªæ²¡åŠæ³•ï¼Œåªèƒ½ç­‰é˜¿é‡Œäº‘æä¾›æ”¯æŒã€‚ ","date":"2021-01-08","objectID":"/posts/expirence-of-pulumi/:4:9","tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/expirence-of-pulumi/"},{"categories":["æŠ€æœ¯"],"content":"8. CI/CD ä¸­å¦‚ä½•ä½¿ pulumi å°†çŠ¶æ€ä¿å­˜åˆ°æ–‡ä»¶ï¼Ÿ CI/CD ä¸­æˆ‘ä»¬å¯èƒ½ä¼šå¸Œæœ› pulumi å°†çŠ¶æ€ä¿å­˜åˆ°æœ¬åœ°ï¼Œé¿å…è¿æ¥ pulumi ä¸­å¿ƒæœåŠ¡å™¨ã€‚ è¿™ä¸€æ–¹é¢èƒ½åŠ å¿«é€Ÿåº¦ï¼Œå¦ä¸€æ–¹é¢ä¸€äº›ä¸´æ—¶çŠ¶æ€æˆ‘ä»¬å¯èƒ½æ ¹æœ¬ä¸æƒ³å­˜å‚¨ï¼Œå¯ä»¥ç›´æ¥ä¸¢å¼ƒã€‚ æ–¹æ³•ï¼š # æŒ‡å®šçŠ¶æ€æ–‡ä»¶è·¯å¾„ pulumi login file://\u003cfile-path\u003e # ä¿å­˜åˆ°é»˜è®¤ä½ç½®: ~/.pulumi/credentials.json pulumi login --local # ä¿å­˜åˆ°è¿œç¨‹ S3 å­˜å‚¨ï¼ˆminio/ceph æˆ–è€…å„ç±»äº‘å¯¹è±¡å­˜å‚¨æœåŠ¡ï¼Œéƒ½å…¼å®¹ aws çš„ s3 åè®®ï¼‰ pulumi login s3://\u003cbucket-path\u003e ç™»å½•å®Œæˆåï¼Œå†è¿›è¡Œ pulumi up æ“ä½œï¼Œæ•°æ®å°±ä¼šç›´æ¥ä¿å­˜åˆ°ä½ è®¾å®šçš„è·¯å¾„ä¸‹ã€‚ ","date":"2021-01-08","objectID":"/posts/expirence-of-pulumi/:4:10","tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/expirence-of-pulumi/"},{"categories":["æŠ€æœ¯"],"content":"ç¼ºç‚¹ ","date":"2021-01-08","objectID":"/posts/expirence-of-pulumi/:5:0","tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/expirence-of-pulumi/"},{"categories":["æŠ€æœ¯"],"content":"1. æŠ¥é”™ä¿¡æ¯ä¸ç›´è§‚ pulumi å’Œ terraform éƒ½æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯å°è£…å±‚æ¬¡å¤ªé«˜äº†ã€‚ å°è£…çš„å±‚æ¬¡å¾ˆé«˜ï¼Œä¼˜ç‚¹æ˜¯æ–¹ä¾¿äº†æˆ‘ä»¬ä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨å¾ˆç»Ÿä¸€å¾ˆç®€æ´çš„å£°æ˜å¼è¯­æ³•ç¼–å†™é…ç½®ã€‚ è€Œç¼ºç‚¹ï¼Œåˆ™æ˜¯å‡ºäº† bugï¼ŒæŠ¥é”™ä¿¡æ¯å¾€å¾€ä¸å¤Ÿç›´è§‚ï¼Œå¯¼è‡´é—®é¢˜ä¸å¥½æ’æŸ¥ã€‚ ","date":"2021-01-08","objectID":"/posts/expirence-of-pulumi/:5:1","tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/expirence-of-pulumi/"},{"categories":["æŠ€æœ¯"],"content":"2. èµ„æºçŠ¶æ€è¢«ç ´åæ—¶ï¼Œä¿®å¤èµ·æ¥éå¸¸éº»çƒ¦ åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œéƒ½å¯èƒ½å‘ç”Ÿèµ„æºçŠ¶æ€è¢«ç ´åçš„é—®é¢˜ï¼š åœ¨åˆ›å»ºèµ„æº Aï¼Œå› ä¸ºå‚æ•°æ˜¯å·²çŸ¥çš„ï¼Œä½ ç›´æ¥ä½¿ç”¨äº†å¸¸é‡è€Œä¸æ˜¯ Outputã€‚è¿™ä¼šå¯¼è‡´ pulumi æ— æ³•è¯†åˆ«åˆ°ä¾èµ–å…³ç³»ï¼ä»è€Œåˆ›å»ºå¤±è´¥ï¼Œæˆ–è€…åˆ é™¤æ—¶èµ„æºçŠ¶æ€è¢«ç ´åï¼ æœ‰ä¸€ä¸ª pulumi stack ä¸€æ¬¡åœ¨ä¸‰å°ç‰©ç†æœºä¸Šåˆ›å»ºèµ„æºã€‚ä½ ç™½å¤©åˆ›å»ºèµ„æºæ™šä¸Šåˆ é™¤èµ„æºï¼Œä½†æ˜¯æŸä¸€å°ç‰©ç†æœºæ™šä¸Šä¼šå…³æœºã€‚è¿™å°†å¯¼è‡´ pulumi æ— æ³•æŸ¥è¯¢åˆ°è¿™å°ç‰©ç†æœºä¸Šçš„èµ„æºçŠ¶æ€ï¼Œè¿™ä¸ª pulumi stack åœ¨æ™šä¸Šå°±æ— æ³•ä½¿ç”¨ï¼Œå®ƒä¼šä¸€ç›´æŠ¥é”™ï¼ ","date":"2021-01-08","objectID":"/posts/expirence-of-pulumi/:5:2","tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/expirence-of-pulumi/"},{"categories":["æŠ€æœ¯"],"content":"å¸¸ç”¨ Provider pulumi-alicloud: ç®¡ç†é˜¿é‡Œäº‘èµ„æº pulumi-vault: æˆ‘è¿™è¾¹ç”¨å®ƒæ¥å¿«é€Ÿåˆå§‹åŒ– vaultï¼Œåˆ›å»ºä¸ç®¡ç† vault çš„æ‰€æœ‰é…ç½®ã€‚ ","date":"2021-01-08","objectID":"/posts/expirence-of-pulumi/:6:0","tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/expirence-of-pulumi/"},{"categories":["æŠ€æœ¯"],"content":"æˆ‘åˆ›å»ºç»´æŠ¤çš„ Provider ç”±äº Pulumi ç”Ÿæ€è¿˜æ¯”è¾ƒå°ï¼Œæœ‰äº› provider åªæœ‰ terraform æ‰æœ‰ã€‚ æˆ‘ä¸ºäº†é€ (æ–¹)ç¦(ä¾¿)å¤§(è‡ª)ä¼—(å·±)ï¼Œåˆ›å»ºå¹¶ç»´æŠ¤äº†ä¸¤ä¸ªæœ¬åœ°è™šæ‹Ÿæœºç›¸å…³çš„ Providers: ryan4yin/pulumi-proxmox: ç›®å‰åªç”¨æ¥è‡ªåŠ¨åˆ›å»º PVE è™šæ‹Ÿæœº å¯ä»¥è€ƒè™‘ç»“åˆ kubespray/kubeadm å¿«é€Ÿåˆ›å»º k8s é›†ç¾¤ ryan4yin/pulumi-libvirt: å¿«é€Ÿåˆ›å»º kvm è™šæ‹Ÿæœº å¯ä»¥è€ƒè™‘ç»“åˆ kubespray/kubeadm å¿«é€Ÿåˆ›å»º k8s é›†ç¾¤ ","date":"2021-01-08","objectID":"/posts/expirence-of-pulumi/:7:0","tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/expirence-of-pulumi/"},{"categories":["æŠ€æœ¯"],"content":"openSUSE æ˜¯ä¸€ä¸ªåŸºäº RPM çš„å‘è¡Œç‰ˆï¼Œè¿™å’Œ RHEL/CentOS ä¸€è‡´ã€‚ ä½†æ˜¯å®ƒçš„å®˜æ–¹åŒ…ç®¡ç†å™¨æ˜¯ä¸“æœ‰çš„ zypperï¼ŒæŒºå¥½ç”¨çš„ï¼Œè½¯ä»¶ä¹Ÿå¾ˆæ–°ã€‚ æˆ‘æœ€è¿‘ä» Manjaro åˆ‡æ¢åˆ°äº† openSUSEï¼Œå‘ç° KDE æ¡Œé¢ç¡®å®æ¯” Manjaro æ›´ä¸æ»‘ï¼Œè€Œä¸”ç¤¾åŒºæº OBS ä½“éªŒä¸‹æ¥æ¯” AUR æ›´èˆ’æœã€‚ å°¤å…¶æ˜¯å®¹å™¨/Kubernetes æ–¹é¢ï¼Œæºé‡Œé¢çš„ä¸œè¥¿æ¯” AUR æ›´ä¸°å¯Œï¼Œè€Œä¸”æ˜¯å®˜æ–¹ç»´æŠ¤çš„ã€‚ æœ¬æ–‡ç®—æ˜¯å¯¹è¿ç§»æµç¨‹åšçš„ä¸€ä¸ªæ€»ç»“ã€‚ æœ¬æ–‡ä»¥ openSUSE Tumbleweed ä¸ºåŸºç¡€ç¼–å†™ï¼Œè¿™æ˜¯ä¸€ä¸ªå’Œ Manjaro/Arch ä¸€æ ·çš„æ»šåŠ¨å‘è¡Œç‰ˆï¼Œè½¯ä»¶æºéƒ½å¾ˆæ–°ã€‚ openSUSE ç¤¾åŒºçš„å¤§éƒ¨åˆ†ç”¨æˆ·éƒ½æ˜¯ä½¿ç”¨çš„ Tumbleweed. å®ƒçš„ç¡¬ä»¶å…¼å®¹æ€§ä¹Ÿè¦æ¯” openSUSE Leapï¼ˆç¨³å®šç‰ˆï¼‰å¥½â€”â€”å®æµ‹å°ç±³æ¸¸æˆæœ¬å®‰è£… Leapï¼Œä¼‘çœ å Touchpad ä¼šå¤±çµã€‚ ","date":"2021-01-04","objectID":"/posts/opensuse-instruction/:0:0","tags":["openSUSE","Linux"],"title":"openSUSE ä½¿ç”¨æŒ‡å—","uri":"/posts/opensuse-instruction/"},{"categories":["æŠ€æœ¯"],"content":"ä¸€ã€zypper çš„åŸºç¡€å‘½ä»¤ zypper çš„æºåœ¨å›½å†…æ¯”è¾ƒæ…¢ï¼Œä½†å®é™…ä¸Šä¸‹è½½çš„æ—¶å€™ï¼Œzypper ä¼šæ™ºèƒ½é€‰æ‹©æœ€å¿«çš„é•œåƒæºä¸‹è½½è½¯ä»¶åŒ…ï¼Œæ¯”å¦‚å›½å†…çš„æ¸…åæºç­‰ã€‚ ä½†æ˜¯æˆ‘å‘ç°å®˜æ–¹çš„æºç´¢å¼•æ›´æ–°å¤ªæ…¢ï¼Œç”šè‡³ç»å¸¸å¤±è´¥ã€‚å› æ­¤æ²¡åŠæ³•ï¼Œè¿˜æ˜¯å¾—æ‰‹åŠ¨è®¾ç½®é•œåƒæºï¼š # ç¦ç”¨åŸæœ‰çš„å®˜æ–¹è½¯ä»¶æº sudo zypper mr --disable repo-oss repo-non-oss repo-update repo-update-non-oss repo-debug # æ·»åŠ åŒ—å¤–é•œåƒæº sudo zypper ar -fcg https://mirrors.bfsu.edu.cn/opensuse/tumbleweed/repo/oss/ bfsu-oss sudo zypper ar -fcg https://mirrors.bfsu.edu.cn/opensuse/tumbleweed/repo/non-oss/ bfsu-non-oss ç„¶åå°±æ˜¯ zypper çš„å¸¸ç”¨å‘½ä»¤ï¼š sudo zypper refresh # refresh all repos sudo zypper update # update all softwares sudo zypper search --installed-only \u003cpackage-name\u003e # æŸ¥æ‰¾æœ¬åœ°å®‰è£…çš„ç¨‹åº sudo zypper search \u003cpackage-name\u003e # æŸ¥æ‰¾æœ¬åœ°å’Œè½¯ä»¶æºä¸­çš„ç¨‹åº sudo zypper install \u003cpackage-name\u003e # å®‰è£…ç¨‹åº sudo zypper remove --clean-deps \u003cpackage-name\u003e # å¸è½½ç¨‹åºï¼Œæ³¨æ„æ·»åŠ  --clean-deps æˆ–è€… -uï¼Œå¦åˆ™ä¸ä¼šå¸è½½ä¾èµ–é¡¹ï¼ sudo zypper clean # æ¸…ç†æœ¬åœ°çš„åŒ…ç¼“å­˜ ","date":"2021-01-04","objectID":"/posts/opensuse-instruction/:1:0","tags":["openSUSE","Linux"],"title":"openSUSE ä½¿ç”¨æŒ‡å—","uri":"/posts/opensuse-instruction/"},{"categories":["æŠ€æœ¯"],"content":"Install Softwares è¿™é‡Œéœ€è¦ç”¨åˆ° OBS(Open Build Service, ç±»ä¼¼ arch çš„ AURï¼Œä½†æ˜¯æ˜¯é¢„ç¼–è¯‘çš„åŒ…)ï¼Œå› ä¸º OBS ä¸œè¥¿å¤ªå¤šäº†ï¼Œå› æ­¤ä¸å­˜åœ¨å®Œæ•´çš„å›½å†…é•œåƒï¼Œå¹³å‡é€Ÿåº¦å¤§æ¦‚ 300kb/sã€‚ å»ºè®®æœ‰æ¡ä»¶å¯ä»¥åœ¨è·¯ç”±å™¨ä¸ŠåŠ æ™ºèƒ½ä»£ç†æé€Ÿã€‚ å®‰è£…éœ€è¦ç”¨åˆ°çš„å„ç±»è½¯ä»¶: # å¯ç”¨ Packman ä»“åº“ï¼Œä½¿ç”¨åŒ—äº¤é•œåƒæº sudo zypper ar -cfp 90 'https://mirror.bjtu.edu.cn/packman/suse/openSUSE_Tumbleweed/' packman-bjtu # install video player and web browser sudo zypper install mpv ffmpeg-4 chromium firefox # install screenshot and other utils # å®‰è£…å¥½åå¯ä»¥é…ä¸ªæˆªå›¾å¿«æ·é”® alt+a =\u003e `flameshot gui` sudo zypper install flameshot peek nomacs # install git clang/make/cmake sudo zypper install git gcc clang make cmake # install wireshark sudo zypper install wireshark sudo gpasswd --add $USER wireshark # å°†ä½ æ·»åŠ åˆ° wireshark ç”¨æˆ·ç»„ä¸­ ","date":"2021-01-04","objectID":"/posts/opensuse-instruction/:2:0","tags":["openSUSE","Linux"],"title":"openSUSE ä½¿ç”¨æŒ‡å—","uri":"/posts/opensuse-instruction/"},{"categories":["æŠ€æœ¯"],"content":"IDE + ç¼–ç¨‹è¯­è¨€ # install vscode: https://en.openSUSE.org/Visual_Studio_Code sudo rpm --import https://packages.microsoft.com/keys/microsoft.asc sudo zypper addrepo https://packages.microsoft.com/yumrepos/vscode vscode sudo zypper refresh sudo zypper install code # å®‰è£… dotnet 5: https://docs.microsoft.com/en-us/dotnet/core/install/linux-openSUSE#openSUSE-15- sudo rpm --import https://packages.microsoft.com/keys/microsoft.asc sudo zypper addrepo https://packages.microsoft.com/openSUSE/15/prod/ microsoft-prod sudo zypper refresh sudo zypper install dotnet-sdk-5.0 # å®‰è£…æ–°ç‰ˆæœ¬çš„ goï¼ˆæºä¸­çš„ç‰ˆæœ¬æ¯”è¾ƒä½ï¼Œæ›´å»ºè®®ä» go å®˜ç½‘ä¸‹è½½å®‰è£…ï¼‰ sudo zypper install go é€šè¿‡ tarball/script å®‰è£…ï¼š # rustupï¼Œrust ç¯å¢ƒç®¡ç†å™¨ curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh # jetbrains toolbox appï¼Œç”¨äºå®‰è£…å’Œç®¡ç† pycharm/idea/goland/android studio ç­‰ IDE # å‚è§ï¼šhttps://www.jetbrains.com/toolbox-app/ # ä¸ä½¿ç”¨ç³»ç»Ÿ pythonï¼Œæ”¹ç”¨ miniconda è£… python3.8 # å‚è€ƒï¼šhttps://github.com/ContinuumIO/docker-images/blob/master/miniconda3/debian/Dockerfile wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh -O /tmp/miniconda.sh sudo /bin/bash /tmp/miniconda.sh -b -p /opt/conda rm /tmp/miniconda.sh sudo /opt/conda/bin/conda clean -tipsy sudo ln -s /opt/conda/etc/profile.d/conda.sh /etc/profile.d/conda.sh echo \". /opt/conda/etc/profile.d/conda.sh\" \u003e\u003e ~/.bashrc echo \"conda activate base\" \u003e\u003e ~/.bashrc # miniconda çš„ entrypoint é»˜è®¤å®‰è£…åœ¨å¦‚ä¸‹ç›®å½•ï¼Œæ·»åŠ åˆ° PATH ä¸­ echo \"export PATH=\\$PATH:\\$HOME/.local/bin\" \u003e\u003e ~/.bashrc æ¥ä¸‹æ¥å®‰è£… VSCode æ’ä»¶ï¼Œä¸‹åˆ—æ˜¯æˆ‘çš„æ’ä»¶åˆ—è¡¨ï¼š è¯­è¨€ï¼š python/go/rust/c#/julia/flutter xml/yaml/toml vscode proto3 ansible/terraform markdown all in one + Markdown Preview Enhanced ç¾åŒ–ï¼š community material theme vscode icons glasslt-vsc docker/kubernetes IntelliJ IDEA Keybindings gitlens prettier utils comment translate path intellisense svg visual studio intellicode antlr4 remote ssh + remote containers rest client vscode databases ","date":"2021-01-04","objectID":"/posts/opensuse-instruction/:2:1","tags":["openSUSE","Linux"],"title":"openSUSE ä½¿ç”¨æŒ‡å—","uri":"/posts/opensuse-instruction/"},{"categories":["æŠ€æœ¯"],"content":"å®¹å™¨ + Kubernetes # æ—¶é«¦çš„æ–°å®¹å™¨å¥—è£…: https://documentation.suse.com/sles/15-SP2/html/SLES-all/cha-podman-overview.html sudo zypper in podman kompose skopeo buildah katacontainers # å®‰è£… kubernetes ç›¸å…³å·¥å…·ï¼Œtumbleweed å®˜æ–¹ä»“åº“çš„åŒ…éƒ½éå¸¸æ–°ï¼å¾ˆèˆ’æœ sudo zypper in helm k9s kubernetes-client # æœ¬åœ°æµ‹è¯•ç›®å‰è¿˜æ˜¯ docker-compose æœ€æ–¹ä¾¿ï¼Œdocker ä»æœ‰å¿…è¦å®‰è£… sudo zypper in docker sudo gpasswd --add $USER docker sudo systemctl enable docker sudo systemctl start docker # ç®€å•èµ·è§ï¼Œç›´æ¥ç”¨ pip å®‰è£… docker-compose å’Œ podman-compose sudo pip install docker-compose podman-compose ","date":"2021-01-04","objectID":"/posts/opensuse-instruction/:2:2","tags":["openSUSE","Linux"],"title":"openSUSE ä½¿ç”¨æŒ‡å—","uri":"/posts/opensuse-instruction/"},{"categories":["æŠ€æœ¯"],"content":"åŠå…¬ã€éŸ³ä¹ã€èŠå¤© # æ·»åŠ  openSUSE_zh æºï¼šhttps://build.opensuse.org/project/show/home:opensuse_zh sudo zypper addrepo 'https://download.opensuse.org/repositories/home:/opensuse_zh/openSUSE_Tumbleweed' openSUSE_zh sudo zypper refresh sudo zypper install wps-office netease-cloud-music # linux qq: https://im.qq.com/linuxqq/download.html # è™½ç„¶ç®€é™‹ä½†ä¹Ÿå¤Ÿç”¨ï¼Œå‘é€æ–‡ä»¶æ¯” KDE Connect è¦æ–¹ä¾¿ä¸€äº›ã€‚ sudo rpm -ivh linux_qq.rpm ","date":"2021-01-04","objectID":"/posts/opensuse-instruction/:2:3","tags":["openSUSE","Linux"],"title":"openSUSE ä½¿ç”¨æŒ‡å—","uri":"/posts/opensuse-instruction/"},{"categories":["æŠ€æœ¯"],"content":"å®‰è£…è¾“å…¥æ³• æˆ‘ç”¨çš„è¾“å…¥æ³•æ˜¯å°é¹¤éŸ³å½¢ï¼Œé¦–å…ˆå®‰è£… fcitx-rime: # æ·»åŠ  m17n obs æºï¼šhttps://build.openSUSE.org/repositories/M17N sudo zypper addrepo 'https://download.opensuse.org/repositories/M17N/openSUSE_Tumbleweed' m17n sudo zypper refresh sudo zypper install fcitx5 fcitx5-configtool fcitx5-qt5 fcitx5-rime ç„¶åï¼Œä» http://flypy.ys168.com/ ä¸‹è½½æœ€æ–°çš„é¼ é¡»ç®¡ï¼ˆMacOSï¼‰é…ç½®æ–‡ä»¶ï¼Œå°†è§£å‹å¾—åˆ°çš„ rime æ–‡ä»¶å¤¹æ‹·è´åˆ° ~/.local/share/fcitx5/ ä¸‹ï¼š mv rime ~/.local/share/fcitx5/ ç°åœ¨é‡å¯ç³»ç»Ÿï¼Œåœ¨ fcitx5 é…ç½®é‡Œé¢æ·»åŠ  rimeã€Œä¸­å·éŸµã€ï¼Œå°±å¯ä»¥æ­£å¸¸ä½¿ç”¨å°é¹¤éŸ³å½¢äº†ã€‚ ","date":"2021-01-04","objectID":"/posts/opensuse-instruction/:2:4","tags":["openSUSE","Linux"],"title":"openSUSE ä½¿ç”¨æŒ‡å—","uri":"/posts/opensuse-instruction/"},{"categories":["æŠ€æœ¯"],"content":"QEMU/KVM ä¸å¾—ä¸è¯´ï¼ŒopenSUSE å®‰è£… KVM çœŸçš„è¶…æ–¹ä¾¿ï¼Œçº¯ GUI æ“ä½œï¼š # see: https://doc.openSUSE.org/documentation/leap/virtualization/html/book-virt/cha-vt-installation.html sudo yast2 virtualization # enter to terminal ui, select kvm + kvm tools, and then install it. KVM çš„è¯¦ç»†æ–‡æ¡£å‚è§ KVM/README.md ","date":"2021-01-04","objectID":"/posts/opensuse-instruction/:2:5","tags":["openSUSE","Linux"],"title":"openSUSE ä½¿ç”¨æŒ‡å—","uri":"/posts/opensuse-instruction/"},{"categories":["æŠ€æœ¯"],"content":"KDE Connect KDE Connect æ˜¯ä¸€ä¸ª PC æ‰‹æœºååŒå·¥å…·ï¼Œå¯ä»¥åœ¨ç”µè„‘å’Œæ‰‹æœºä¹‹é—´å…±äº«å‰ªåˆ‡ç‰ˆã€è¿œç¨‹è¾“å…¥ã€å‘é€æ–‡ä»¶ã€å…±äº«æ–‡ä»¶å¤¹ã€é€šçŸ¥åŒæ­¥ç­‰ç­‰ã€‚ æ€»è€Œè¨€ä¹‹éå¸¸å¥½ç”¨ï¼Œåªè¦æ‰‹æœºå’Œ PC å¤„äºåŒä¸€ä¸ªå±€åŸŸç½‘å°±è¡Œï¼Œä¸éœ€è¦ä»€ä¹ˆæ•°æ®çº¿ã€‚ å¦‚æœå®‰è£…ç³»ç»Ÿæ—¶é€‰æ‹©äº†æ‰“å¼€é˜²ç«å¢™ï¼ŒKDE Connect æ˜¯è¿ä¸ä¸Šçš„ï¼Œéœ€è¦æ‰‹åŠ¨å¼€æ”¾ç«¯å£å·ï¼š # see: https://userbase.kde.org/KDEConnect#firewalld # è¿˜å¯ä»¥ä½¿ç”¨ --add-source=xx.xx.xx.xx/xx è®¾ç½® ip ç™½åå• sudo firewall-cmd --zone=public --permanent --add-port=1714-1764/tcp sudo firewall-cmd --zone=public --permanent --add-port=1714-1764/udp sudo systemctl restart firewalld.service ç„¶åæ‰‹æœºï¼ˆAndroidï¼‰å®‰è£…å¥½ KDE Connectï¼Œå°±èƒ½å¼€å§‹äº«å—äº†ã€‚ ç›®å‰å­˜åœ¨çš„ Bug: Android 10 ç¦æ­¢äº†åå°åº”ç”¨è¯»å–å‰ªåˆ‡ç‰ˆï¼Œè¿™å¯¼è‡´ KDE Connect åªèƒ½ä» PC åŒæ­¥åˆ°æ‰‹æœºï¼Œè€Œæ— æ³•åå‘åŒæ­¥ã€‚ å¦‚æœä½ æœ‰ ROOT æƒé™ï¼Œå¯ä»¥å‚è€ƒ Fix clipboard permission on Android 10 çš„æ–¹æ³•ï¼Œå®‰è£… ClipboardWhitelist æ¥æ‰“å¼€æƒé™ã€‚ å¦åˆ™ï¼Œè²Œä¼¼å°±åªèƒ½ä½¿ç”¨æ‰‹æœºç«¯çš„ã€Œè¿œç¨‹è¾“å…¥ã€æ¨¡å—æ¥æ‰‹åŠ¨ä¼ è¾“æ–‡æœ¬äº†ã€‚ ","date":"2021-01-04","objectID":"/posts/opensuse-instruction/:2:6","tags":["openSUSE","Linux"],"title":"openSUSE ä½¿ç”¨æŒ‡å—","uri":"/posts/opensuse-instruction/"},{"categories":["æŠ€æœ¯"],"content":"Qv2ray ä»£ç† Qv2ray æ˜¯æˆ‘ç”¨è¿‡çš„æ¯”è¾ƒå¥½ç”¨çš„ GUI ä»£ç†å·¥å…·ï¼Œé€šè¿‡æ’ä»¶å¯æ”¯æŒå¸¸è§çš„æ‰€æœ‰ä»£ç†åè®®ã€‚ # see: https://build.openSUSE.org/repositories/home:zzndb sudo zypper addrepo 'https://download.opensuse.org/repositories/home:/zzndb/openSUSE_Tumbleweed' qv2ray sudo zypper refresh sudo zypper install Qv2ray QvPlugin-Trojan QvPlugin-SS ","date":"2021-01-04","objectID":"/posts/opensuse-instruction/:2:7","tags":["openSUSE","Linux"],"title":"openSUSE ä½¿ç”¨æŒ‡å—","uri":"/posts/opensuse-instruction/"},{"categories":["æŠ€æœ¯"],"content":"VPN è¿æ¥ä¸é˜²ç«å¢™ é˜²ç«å¢™é»˜è®¤ä¼šç¦ç”¨ pptp ç­‰ vpn åè®®çš„ç«¯å£ï¼Œéœ€è¦æ‰‹åŠ¨æ‰“å¼€. å…è®¸ä½¿ç”¨ PPTP åè®®ï¼š # å…è®¸ gre æ•°æ®åŒ…æµå…¥ç½‘ç»œ sudo firewall-cmd --permanent --zone=public --direct --add-rule ipv4 filter INPUT 0 -p gre -j ACCEPT sudo firewall-cmd --permanent --zone=public --direct --add-rule ipv6 filter INPUT 0 -p gre -j ACCEPT # masquerade: è‡ªåŠ¨ä½¿ç”¨ interface åœ°å€ä¼ªè£…æ‰€æœ‰æµé‡ï¼ˆå°†ä¸»æœºå½“ä½œè·¯ç”±å™¨ä½¿ç”¨ï¼Œvpn æ˜¯è™šæ‹Ÿç½‘ç»œï¼Œéœ€è¦è¿™ä¸ªåŠŸèƒ½ï¼‰ sudo firewall-cmd --permanent --zone=public --add-masquerade # pptp å®¢æˆ·ç«¯ä½¿ç”¨å›ºå®šç«¯å£ 1723/tcp é€šä¿¡ firewall-cmd --add-port=1723/tcp --permanent sudo firewall-cmd --reload å…è®¸ä½¿ç”¨ wireguard åè®®ï¼Œæ­¤åè®®åªä½¿ç”¨ tcp åè®®ï¼Œè€Œä¸”å¯ä»¥ç«¯å£å·å¯ä»¥è‡ªå®šä¹‰ã€‚ä¸è¿‡ wireguard è‡ªèº«çš„é…ç½®æ–‡ä»¶ /etc/wireguard/xxx.conf å°±èƒ½é…ç½® iptables å‚æ•°æ”¾è¡Œç›¸å…³ç«¯å£ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚ ","date":"2021-01-04","objectID":"/posts/opensuse-instruction/:2:8","tags":["openSUSE","Linux"],"title":"openSUSE ä½¿ç”¨æŒ‡å—","uri":"/posts/opensuse-instruction/"},{"categories":["æŠ€æœ¯"],"content":"å…¶ä»–è®¾ç½® ä» Windows å¸¦è¿‡æ¥çš„ä¹ æƒ¯æ˜¯å•å‡»é€‰ä¸­æ–‡ä»¶ï¼ŒåŒå‡»æ‰æ‰“å¼€ï¼Œè¿™ä¸ªå¯ä»¥åœ¨ã€Œç³»ç»Ÿè®¾ç½®ã€-ã€Œå·¥ä½œç©ºé—´è¡Œä¸ºã€-ã€Œå¸¸è§„è¡Œä¸ºã€-ã€Œç‚¹å‡»è¡Œä¸ºã€ä¸­ä¿®æ”¹ã€‚ ","date":"2021-01-04","objectID":"/posts/opensuse-instruction/:3:0","tags":["openSUSE","Linux"],"title":"openSUSE ä½¿ç”¨æŒ‡å—","uri":"/posts/opensuse-instruction/"},{"categories":["éšç¬”","æŠ€æœ¯"],"content":"é—²è¨€ç¢è¯­ ä¸€æ™ƒä¸€å¹´åˆè¿‡å»äº†ï¼Œä»Šå¹´å¯çœŸæ˜¯é­”å¹»çš„ä¸€å¹´ï¼Œå£ç½©å¸¦äº†ä¸€å¹´æ²¡èƒ½æ‘˜ä¸‹æ¥ï¼Œç¾å›½ç–«æƒ…æ„ŸæŸ“äººæ•° 1500 ä¸‡ã€‚ ä¸Šé¢è¿™æ®µè¯è¦æ˜¯è®©å»å¹´çš„æˆ‘çœ‹åˆ°äº†ï¼Œæ²¡å‡†éƒ½ä»¥ä¸ºä»Šå¹´çœŸçš„ç”ŸåŒ–å±æœºäº†hhhâ€¦ è¨€å½’æ­£ä¼ ï¼Œä»å»å¹´ 6 æœˆåº•å…¥èŒï¼Œåˆ°ç°åœ¨æœ‰ä¸€å¹´åŠäº†ï¼Œè¿™ä¸€å¹´åŠå­¦åˆ°çš„ä¸œè¥¿çœŸçš„éå¸¸å¤šï¼Œå®Œå…¨é‡å¡‘äº†æˆ‘çš„æŠ€æœ¯æ ˆã€‚ç°åœ¨æˆ‘çš„æ•´ä¸ªæŠ€æœ¯æ ˆï¼ŒåŸºæœ¬éƒ½æ˜¯å›´ç»•ç€äº‘åŸç”Ÿè¿™ä¸€å—å‘å±•äº†ã€‚ ","date":"2020-12-12","objectID":"/posts/2020-summary/:1:0","tags":["æ€»ç»“"],"title":"2020 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2020-summary/"},{"categories":["éšç¬”","æŠ€æœ¯"],"content":"æ´»åŠ¨ ä»Šå¹´ä¹Ÿå‚åŠ äº†å‡ ä¸ªæŠ€æœ¯æ²™é¾™ï¼Œæœ‰äº›æ”¶è·ï¼Œä½†æ˜¯æ²¡å»å¹´é‚£ä¹ˆæ–°å¥‡äº†ï¼Œä¸»è¦æ˜¯å¾ˆå¤šä¸œè¥¿è‡ªå·±å·²ç»æ‡‚äº†hhhã€‚å¤§æ¦‚æœ‰è¿™ä¹ˆå‡ ä¸ªæ´»åŠ¨ï¼š 2019 å¹´è…¾è®¯è“é²¸ç¬¬5å±Šè¿ç»´æŠ€æœ¯æ²™é¾™ï¼šåœ¨æ·±åœ³è…¾è®¯å¤§å¦å‚åŠ çš„ï¼Œç‚¹å¿ƒå’Œå’–å•¡å¾ˆæ£’ï¼Œè®²çš„ä¸œè¥¿é‡Œï¼Œè…¾è®¯è‡ªå·±åˆ†äº«çš„ã€Œç ”å‘è¿ç»´ä¸€ä½“åŒ–å¹³å°ã€æ¯”è¾ƒæœ‰æ”¶è·ï¼Œæˆ‘æ”¶è—äº†é‚£ä¸€ä»½ PPT Rancher - ä¼ä¸šäº‘åŸç”Ÿçš„æ¢ç´¢ä¸è½åœ°ï¼šå»å¹´å‚åŠ  Rancher çš„æ²™é¾™è§‰å¾—å¾ˆé«˜å¤§ä¸Šï¼Œå› ä¸ºè‡ªå·±å¾ˆå¤šä¸œè¥¿éƒ½ä¸æ‡‚ã€‚ä½†æ˜¯ä»Šå¹´æ¥å¬ï¼Œæ˜æ˜¾å°±æ„Ÿè§‰ä»–ä»¬è®²çš„å¾ˆåŸºç¡€ï¼Œå¯¹æˆ‘æ²¡ä»€ä¹ˆä»·å€¼äº†ã€‚ä¹Ÿä¾§é¢è¯´æ˜æˆ‘ç¡®å®è¿›æ­¥äº†éå¸¸å¤šå“ˆå“ˆã€‚ 2020 PyconChina æ·±åœ³åœºï¼šé¢ï¼Œä¹Ÿè§‰å¾—æ²¡ä»€ä¹ˆå¹²è´§ï¼Œå¥½å‡ ä¸ªéƒ½æ˜¯åœ¨æ¨é”€è‡ªå®¶çš„äº§å“ï¼ˆAzure AI å¹³å°å’Œä¸€ä¸ª Django å†™çš„ä½ä»£ç å¹³å°ï¼‰ï¼Œæœ‰ä¸ªè®² Nix åŒ…ç®¡ç†çš„å¤§ä½¬ä½†æ˜¯æ²¡è®²å¥½ï¼Œåé¢æˆ‘ä»¬å°±ç›´æ¥æºœäº†â€¦ å¦å¤–å°±æ˜¯ï¼Œä»Šå¹´å¿ƒè¡€æ¥æ½®ä¹°äº†å››å¼  Live House çš„æ¼”å‡ºç¥¨ï¼Œä½“éªŒä¸‹æ¥è§‰å¾—é’±èŠ±å¾—å¾ˆå€¼ï¼Œç»™æˆ‘å……å€¼äº†ä¸å°‘æ­£èƒ½é‡ã€‚ æ™¯å¾·é•‡æ–‡è‰ºå¤å…´ã€Šå°æ­Œè¡Œã€‹ï¼šè¿™æ˜¯æˆ‘è¶…çº§å–œæ¬¢çš„ä¸€ä¸ªä¹é˜Ÿï¼Œæ¼”å‡ºæ•ˆæœè¶…æ£’ï¼å¬åˆ°äº†å®Œæ•´çš„æ•…äº‹ï¼Œè€Œä¸”è§åˆ°äº†ä¹ä¸‰å§‘å¨˜æœ¬äººï¼Œå¤ªé«˜å…´äº†ï¼ å¾æµ·ä¿ - æ¸¸ç¦»ç‰‡åˆ»ï¼šè¿™ä½æ­Œæ‰‹æˆ‘ä¹‹å‰å…¶å®æ²¡æ¥è§¦è¿‡ï¼Œä½†æ˜¯å¬äº†ä¸‹å¥¹çš„ã€Šç©ºã€‹å‘ç°å¾ˆä¸é”™å¾ˆå¸…æ°”ï¼Œå°±ä¹°äº†ã€‚ä½†æ˜¯æ•´åœºä¸‹æ¥æ„Ÿè§‰ä¿ä¿çŠ¶æ€ä¸ä½³ï¼Œæœ‰ç‚¹å”±ä¸åŠ¨çš„æ„Ÿè§‰ã€‚ä¸­åœºé—®æ­Œè¿·ä»¬æœ‰æ²¡æœ‰å¸¦é‡æ ¼é…’ï¼Œæœ«äº†åˆé—®æ·±åœ³ç°åœ¨èƒ½æ¸¸æ³³ä¹ˆå“ˆå“ˆï¼Œæ˜¯ä¸ªå¾ˆéšæ€§çš„æ­Œæ‰‹ã€‚åé¢å¯èƒ½è¿˜çœŸæ¸¸æ³³å»äº†ã€‚ å¤å°è™ - é€å¹´ï¼šè¿™æ˜¯ä¸ªæ°‘è°£æ­Œæ‰‹ï¼Œä»¥å‰ä¸Šå¤§å­¦çš„æ—¶å€™å¬è¿‡ï¼Œåªæœ‰å‰ä»–å’Œäººå£°ï¼Œå…¶å®æ˜¯æœ‰äº›ä¼¤æ„Ÿçš„æ­Œã€‚å› ä¸ºæˆ‘æœ€è¿‘çŠ¶æ€å¾ˆå¥½ï¼Œæˆ‘å»ä¹‹å‰è¿˜æ‹…å¿ƒæ°›å›´ä¸é€‚åˆæˆ‘ã€‚ç„¶åå¤å°è™è¯´å¼€å¿ƒæœ€é‡è¦ï¼Œå¸¦äº†ä¸ªä¹é˜Ÿæ¥ä¼´å¥ï¼Œæ¶å­é¼“å°±æ˜¯çµé­‚ï¼Œæ•´ä¸ªæ¼”å‡ºéƒ½å› é¼“ç‚¹è€Œæ¬¢å¿«äº†èµ·æ¥ã€‚æ•ˆæœä¹Ÿéå¸¸æ£’ï¼ æ—¶å…‰èƒ¶å›Šä¹é˜Ÿï¼šè¿™ä¹Ÿæ˜¯ä¸€ä¸ªå›½é£åæ‘‡ä¹é˜Ÿï¼Œåœ¨ä¸€ä¸ªæ·±åœ³ç¦ç”°ä¸€ä¸ªå°é…’å§ã€Œçº¢ç³–ç½ä¸Šæ­¥åº—ã€æ¼”å‡ºçš„ï¼Œæ¯”è¾ƒç®€é™‹ï¼Œäººä¹Ÿä¸å¤šï¼Œå°±å››äº”åäººçš„æ ·å­ï¼ˆå‡ºä¹æ„æ–™ï¼‰ã€‚ä½†æ˜¯æ¼”å‡ºæ•ˆæœå¾ˆæ£’ï¼Œã€Šæ—…é€”ã€‹ã€Šå¿†é•¿å®‰ã€‹ã€Šç£çŸ³ã€‹éƒ½éå¸¸å¥½å¬ã€‚å°¤å…¶æ˜¯åœ¨è¿™æ ·çš„åœºåˆå”±ã€Šæˆ‘ä¸çŸ¥é“ä½ çš„åå­—ã€‹ï¼ŒæŒºæœ‰æ„Ÿè§¦çš„ã€‚ ","date":"2020-12-12","objectID":"/posts/2020-summary/:2:0","tags":["æ€»ç»“"],"title":"2020 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2020-summary/"},{"categories":["éšç¬”","æŠ€æœ¯"],"content":"æŠ€æœ¯èƒ½åŠ›æ€»ç»“ ä»Šå¹´æˆ‘çš„å·¥ä½œé‡ç‚¹æœ‰è¿™ä¹ˆå‡ ä¸ªï¼š é‡æ„åŠç»´æŠ¤ CI/CD ä»£ç ï¼Œè®©å®ƒèƒ½åœ¨å¤šä¸ªäº§å“çº¿ä¸Šå¤ç”¨ äº‘ä¸Šç¯å¢ƒç®¡ç†ï¼šä»Šå¹´ç†Ÿæ‚‰äº†é˜¿é‡Œäº‘è¿™ä¸€å¥—ä¸œè¥¿ï¼Œå¹¶ä¸”ç”¨ä¸Šäº†è‡ªåŠ¨åŒ–å·¥å…·å¯¹äº‘ä¸Šç¯å¢ƒè¿›è¡Œç®¡ç†ã€‚ ä¸€å¼€å§‹æ˜¯ä½¿ç”¨ terraformï¼Œä½†æ˜¯ terraform çš„ hcl è¯­æ³•ä¸å¤Ÿçµæ´»ï¼Œæœ€è¿‘åˆ‡æ¢åˆ°äº† pulumi+pythonï¼Œä¸å¾—ä¸è¯´çœŸé¦™ã€‚ç›®å‰äº‘ä¸Šçš„èµ„æºåŠé…ç½® 95% éƒ½å®Œå…¨ç”¨ pulumi ç®¡ç†äº†ï¼ˆè¿˜å‰©å¤§æ¦‚ 5% å› ä¸ºå„ç§åŸå› ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®ï¼‰ã€‚ kubernetesäº‘åŸç”Ÿ: ä»Šå¹´æˆ‘åœ¨è¿™ä¸ªé¢†åŸŸçš„è¿›æ­¥æœ€å¤§ï¼Œç†Ÿæ‚‰äº† k8s/istio/flagger/vault/prometheus/helm/traefik ç­‰ç­‰ã€‚ä¸è¿‡ç›®å‰è¿™é‡Œé¢å¤§éƒ¨åˆ†å·¥å…·è¿˜åœç•™åœ¨ã€Œä¼šç”¨ã€çš„çŠ¶æ€ã€‚ æœåŠ¡å™¨è™šæ‹ŸåŒ–ç³»ç»Ÿä» vSphere åˆ‡æ¢åˆ° PVE VMware çš„ vCenter åƒçš„èµ„æºå¤ªå¤šï¼Œè€Œä¸”è¿˜ä¸èƒ½è‡ªåŠ¨æ‰©ç¼©å®¹ç¡¬ç›˜ï¼ŒPython SDK ä¹Ÿè¶…éš¾ç”¨ã€‚å› æ­¤æˆ‘åœ¨å…¬å¸å°è¯•ä½¿ç”¨ PVE æ›¿æ¢ vSphere è¿™ä¸€å¥—ï¼Œæ•ˆæœå¾ˆä¸é”™ã€‚ PVE+pulumi/terraform+cloudinit èƒ½å®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²è™šæ‹Ÿæœºï¼Œè‡ªåŠ¨é…ç½®ç½‘ç»œã€è´¦å·åŠSSHå¯†é’¥ã€è‡ªåŠ¨æ‰©ç¼©å®¹ç¡¬ç›˜ï¼Œéå¸¸æ–¹ä¾¿ï¼ è€Œä¸” PVE ä¸æ”¶è´¹ï¼Œå»ä¸­å¿ƒåŒ–ï¼Œä¸€å¥—ç”¨ä¸‹æ¥èˆ’æœå¤ªå¤šäº†ã€‚åªæ˜¯ pve+cloud-init é—¨æ§›ç¨å¾®é«˜ä¸€ç‚¹ï¼Œéœ€è¦ä¸€å®šæ—¶é—´å»ç†Ÿæ‚‰ã€‚ CI/CD ç³»ç»Ÿï¼šåŸºäº Jenkins çš„ CI/CD åœ¨æˆ‘å¸å„ç§æ°´åœŸä¸æœï¼Œå°æ¯›ç—…ä¸æ–­ã€‚Jenkins æœ¬èº«å°±å­˜åœ¨å•ç‚¹æ•…éšœï¼Œä¸é€‚åˆäº‘åŸç”Ÿï¼ŒåŠ ä¸Š Jenkinsfile æœ‰å­¦ä¹ æˆæœ¬ï¼Œè€Œä¸”ä¸æ–¹ä¾¿å¤ç”¨ï¼Œæˆ‘å°±æƒ³æŠŠ Jenkins æ¢æ‰ã€‚æˆ‘åœ¨è¿™ä¸€å¹´é‡Œè°ƒç ”äº†å¤§é‡çš„å¼€æº CI/CD å·¥å…·ï¼Œéƒ½å„æœ‰ä¸è¶³ã€‚ä¸»è¦è¿˜æ˜¯å› ä¸ºæˆ‘ä»¬å½“ä¸‹çš„ Jenkins æ‰¿è½½äº†å¤ªå¤šçš„åŠŸèƒ½ï¼Œå·²ç»æ˜¯ä¸€ä¸ªCI/CDã€è‡ªåŠ¨åŒ–æµ‹è¯•ã€è‡ªåŠ¨åŒ–è¿ç»´å¹³å°äº†ï¼Œå¦ä¸€æ–¹é¢å…¬å¸åç«¯çš„æµæ°´çº¿è¿˜å­˜åœ¨ä¾èµ–å…³ç³»ï¼Œéœ€è¦è¿›è¡Œå¤æ‚çš„ç¼–æ’ã€‚ ç›®å‰æˆ‘å°±æ‰¾åˆ° Argo Workflows çš„åŠŸèƒ½å¾ˆç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚ï¼Œç›®å‰æ­£åœ¨å°è¯•è¿ç§»ä¸€éƒ¨åˆ†åŠŸèƒ½åˆ° Argo Workflows è¯•ç”¨ã€‚ å› ä¸º argo çš„ UI å’Œ jenkins å·®åˆ«è¿‡å¤§ï¼Œæš‚å®šä»ä»¥ jenkins ä¸ºå‰ç«¯ï¼Œé€šè¿‡ python å°†ä»»åŠ¡åˆ†æ´¾ç»™ argo è¿è¡Œã€‚è¿™æ · argo å¯¹ä½¿ç”¨è€…è€Œè¨€æ˜¯éšå½¢çš„ï¼Œç”¨æˆ·ä½“éªŒåŸºæœ¬ä¸Šæ²¡åŒºåˆ«ã€‚ æ‚äº‹ï¼šä¿®æ°´ç”µã€ä¿®æœåŠ¡å™¨ã€ç»„è£…åŠå…¬ç”µè„‘ã€æ¬æœºæˆ¿â€¦ ","date":"2020-12-12","objectID":"/posts/2020-summary/:3:0","tags":["æ€»ç»“"],"title":"2020 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2020-summary/"},{"categories":["éšç¬”","æŠ€æœ¯"],"content":"ä»Šå¹´åœ¨æŠ€æœ¯æ–¹é¢çš„æ„Ÿå— Podman/Skopeo/Buildah/Kaniko ç­‰æŠ€æœ¯è¿›ä¸€æ­¥å‘å±•ï¼Œæ­£åœ¨é€æ¸èš•é£Ÿ Docker çš„åœ°ç›˜. kubernetes å·²ç»å¼ƒç”¨ docker-shimï¼Œç›´æ¥å¯¹æ¥ containerdï¼Œä¸‹ä¸€æ­¥åº”è¯¥æ˜¯å½»åº•åˆ‡æ¢åˆ° CRI-Oã€‚ Istio 1.5 åˆå¹¶ä¸ºå•ä½“æ¶æ„æ•ˆæœå¾ˆæ˜æ˜¾ï¼Œå„å¾®ä¿¡å…¬ä¼—å·ä¸‰å¤©ä¸¤å¤´å°±è®²æœåŠ¡ç½‘æ ¼ï¼ŒæœåŠ¡ç½‘æ ¼æ˜¯æ¯‹åº¸ç½®ç–‘çš„æœªæ¥ é˜¿é‡Œäº‘çš„ OAM è¿›ä¸€æ­¥å‘å±•ï¼Œç›®å‰é˜¿é‡ŒåŸºäº OAM ç ”å‘çš„ Kubevela è‡´åŠ›äºå°è£… Kubernetes çš„åŠŸèƒ½ï¼Œè®©å°ç™½ä¹Ÿèƒ½ç”¨ä¸Š Kubernetesã€‚è€Œè¿™åŒæ—¶è¿˜èƒ½ä¿ç•™ k8s å®Œæ•´çš„èƒ½åŠ›ï¼Œå€¼å¾—æœŸå¾…ã€‚ äº‘ä¸Šå®‰å…¨è¶Šæ¥è¶Šå¼•èµ·é‡è§†äº†ï¼Œç›®å‰ CNCF ç¤¾åŒºä¸Šå®¹å™¨å®‰å…¨ç›¸å…³çš„é¡¹ç›®åœ¨å¿«é€Ÿå‘å±•ã€‚åŒ…æ‹¬é•œåƒå®‰å…¨/å®‰å…¨å®¹å™¨(kata containers)ç­‰ã€‚ ä½¿ç”¨ Kubernetes æ¥ç®¡ç†æ•°æ®åº“å·²ç»æ˜¯å¤§è¶‹åŠ¿ï¼Œæ¯•ç«Ÿæˆæœ¬ä¼˜åŠ¿å¤ªæ˜æ˜¾äº†ã€‚ å¾ˆå¤šå…¬å¸å·²ç»åœ¨ä½¿ç”¨ docker è¿è¡Œæ•°æ®åº“ï¼Œæ¯•ç«Ÿæ€§èƒ½æ²¡å•¥æŸå¤±ï¼Œå°±èƒ½æ–¹ä¾¿å¾ˆå¤šã€‚ä½†æ˜¯ä»ç„¶æ‰‹åŠ¨æ­å»ºé›†ç¾¤ï¼Œä¹Ÿä¸ä½¿ç”¨åˆ†å¸ƒå¼å­˜å‚¨ã€‚ ç›®å‰å¥½åƒåªæœ‰å¤§å‚å¦‚é˜¿é‡Œäº¬ä¸œæ‰æœ‰è¿™ä¸ªå®åŠ›ï¼Œä½¿ç”¨ kubernetes å’Œåˆ†å¸ƒå¼å­˜å‚¨æ¥è·‘æ•°æ®åº“ã€‚å®¹å™¨åŒ–çš„åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿç»´æŠ¤(å¦‚ ceph)ï¼Œå…¶ä¸­çš„éš¾ç‚¹æˆ‘ç›®å‰è¿˜ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œä¸è¿‡æ— å¤–ä¹æ€§èƒ½ã€ç¨³å®šæ€§ã€æ•…éšœæ¢å¤è¿™äº›ã€‚ ","date":"2020-12-12","objectID":"/posts/2020-summary/:4:0","tags":["æ€»ç»“"],"title":"2020 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2020-summary/"},{"categories":["éšç¬”","æŠ€æœ¯"],"content":"æ˜å¹´çš„å±•æœ› Go è¯­è¨€å¿…é¡»å­¦èµ·æ¥ï¼Œä»Šå¹´å…¥é—¨äº†ä¸¤éè¯­æ³•ï¼Œä½†æ˜¯æ²¡å†™è¿‡å•¥ä¸œè¥¿ï¼Œåˆå¿˜å·®ä¸å¤šäº†ã€‚ è¦è¿›ä¸€æ­¥ç†Ÿæ‚‰ k8s/istio/flagger/vault/prometheus/helm/traefik/caddy è¿™äº›å·¥å…·ï¼Œä¼šç”¨è¿˜ä¸å¤Ÿï¼Œè¦æ·±å…¥åº•å±‚ã€‚ æ·±å…¥å­¦ä¹ è®¡ç®—æœºç½‘ç»œ + Linux ç½‘ç»œ + Kubernetes ç½‘ç»œï¼è¿™éå¸¸é‡è¦ã€‚ å­¦ä¹  Podman/Docker çš„åº•å±‚åŸç†ï¼Œå­¦ä¹  katacontainers ç­‰å®‰å…¨å®¹å™¨æŠ€æœ¯ã€‚ ä¸º kubevela/dapr/knative ç­‰äº‘åŸç”Ÿé¡¹ç›®åšä¸€äº›è´¡çŒ®ï¼Œè¦å‚ä¸åˆ°å¼€æºä¸­å»ã€‚ æŒæ¡ Argo Workflows/tektonï¼Œå°† CI/CD æ¬åˆ° k8s ä¸Šå»ã€‚ å­¦ä¹ è®¾è®¡æ¨¡å¼ æœ‰æœºä¼šçš„è¯ï¼Œç†Ÿæ‚‰ä¸‹åˆ†å¸ƒå¼å­˜å‚¨ã€åˆ†å¸ƒå¼æ•°æ®åº“ã€‚è¿™æ–¹é¢æˆ‘ç›®å‰è¿˜ç›¸å½“æ¬ ç¼ºã€‚ å­¦ä¹  KVM è™šæ‹ŸåŒ– å¦‚æœå­¦ï¼ˆxianï¼‰æœ‰ï¼ˆdeï¼‰ä½™ï¼ˆdanï¼‰åŠ›ï¼ˆtengï¼‰çš„è¯ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘ææä¸‹é¢è¿™å‡ ä¸ªï¼š rust è¯­è¨€ï¼šrust é€šè¿‡ owner+lifetime å®ç°å†…å­˜çš„æ™ºèƒ½ç®¡ç†ï¼Œæ€§èƒ½å¾ˆé«˜ï¼Œè€Œä¸”ç¼–è¯‘å™¨æç¤ºéå¸¸å‹å¥½ï¼Œå€¼å¾—ä¸€å­¦ã€‚ æœºå™¨å­¦ä¹ /æ·±åº¦å­¦ä¹ : è¿™ä¸ªé¢†åŸŸå¯æ˜¯å½“ä¸‹çš„å¤§çƒ­é—¨ï¼Œå¯ä»¥ç”¨ python/julia ç©ä¸€ç©ï¼Œé¡ºä¾¿è¡¥ä¸€è¡¥å¾®ç§¯åˆ†çº¿ä»£æ¦‚ç‡è®ºã€‚ã€‚ ã€Šç¼–ç¨‹è¯­è¨€å®ç°æ¨¡å¼ã€‹ï¼šå—¯ï¼Œå¸Œæœ›èƒ½è‡ªå·±é€ è½®å­ï¼Œå†™äº›ç®€å•çš„ parserã€‚ elixir: ruby è¯­æ³•+ erlang å¹¶å‘æ¨¡å‹(actor), å¦‚æœæœ‰æ—¶é—´çš„è¯ï¼Œä¹Ÿå¯ä»¥ç©ç©ï¼Œäº†è§£ä¸‹åŸç”Ÿåˆ†å¸ƒå¼çš„å‡½æ•°å¼è¯­è¨€çš„ç‰¹ç‚¹ã€‚ å›çœ‹äº†ä¸‹å»å¹´çš„æ€»ç»“ï¼Œå‘ç°æˆ‘ go/c# éƒ½æ²¡å­¦å¤šå°‘ï¼Œè®¾è®¡æ¨¡å¼ä¹Ÿæ²¡åŠ¨ï¼Œpython è¿˜åœ¨åŸåœ°è¸æ­¥hhhâ€¦ å»å¹´çš„å±•æœ›å¾ˆå¤šéƒ½æ²¡å®ç°ã€‚ ä¸è¿‡äº‘åŸç”Ÿè¿™ä¸€å—å€’æ˜¯è¿›æ­¥å¾ˆå¿«ï¼Œæ€»ä½“å¾ˆæ»¡æ„ä»Šå¹´çš„æˆæœå“ˆå“ˆ~ æ˜å¹´åŠ æ²¹ï¼ ","date":"2020-12-12","objectID":"/posts/2020-summary/:5:0","tags":["æ€»ç»“"],"title":"2020 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2020-summary/"},{"categories":["éŸ³ä¹"],"content":"å‰è¨€ 2020 å¹´ 11 æœˆ 28 æ—¥ï¼Œæˆ‘ç¬¬ä¸€æ¬¡å‚åŠ  Live Houseï¼Œæ¼”å‡ºä¹é˜Ÿæ˜¯ã€Œæ™¯å¾·é•‡æ–‡è‰ºå¤å…´ã€ã€‚ ã€Œæ™¯å¾·é•‡æ–‡è‰ºå¤å…´ã€æ˜¯æˆ‘å¾ˆå–œæ¬¢çš„ä¸€æ”¯åæ‘‡ä¹é˜Ÿï¼Œæˆ‘å–œæ¬¢ä¸Šè¿™æ”¯ä¹é˜Ÿï¼Œè¿˜å¾—ä»æˆ‘çš„æ˜µç§°ã€Œæ–¼æ¸…æ¨‚ã€è¯´èµ·ã€‚ 17 å¹´çš„æ—¶å€™ï¼Œå¬äº†è®¸å¤šåæ‘‡ï¼Œç½‘æ˜“äº‘å°±ç»™æˆ‘æ¨èã€Œæ™¯å¾·é•‡æ–‡è‰ºå¤å…´ã€çš„æ­Œï¼Œå¦‚æ­¤ç»“ç¼˜ã€‚ å…¶ä¸­æœ‰ä¸€é¦–æ­Œæ˜¯ã€Œæ»¡ä¸–ã€ï¼Œåæ‘‡å˜›ï¼Œæ­Œè¯åªæœ‰å››å¥ï¼š æœˆä¸‹çµé¸ŸåŸ èŠ±é¦™æ— å¤„å¯» å†çœ‹ç ´åœŸäºº ä¸€æ»¡åˆä¸€ä¸– å¬è¿™é¦–æ­Œçš„æ—¶å€™ï¼Œæˆ‘æƒ³èµ·çœ‹è¿‡éŸ©å¯’çš„ã€Šé•¿å®‰ä¹±ã€‹ï¼Œé‡Œé¢å¥³ä¸»åå«ã€Œå–œä¹ã€ï¼Œè¿™åå­—é‡Œå¯„æ‰˜ç€å®¶äººå¯¹å¥¹çš„æœŸè®¸â€”â€”å¹³å®‰å–œä¹ã€‚ æˆ‘å¿ƒé‡Œä¹Ÿå‡èµ·ä¸€ä¸ªä¸å¯èƒ½å®ç°çš„æ„¿æœ›ï¼š å¸Œå†€èƒ½äºè¿™å°˜ä¸–ä¹‹ä¸­ï¼Œäº«å¾—åŠä¸–æ¸…é—²ï¼Œä¸€ç”Ÿå–œä¹ è¿™æ„¿æœ›å·²ç„¶ä¸å¯èƒ½å®ç°ï¼Œè¿‡å¾€çš„å²æœˆé‡Œï¼Œæˆ‘æœ‰è¿‡å¤ªå¤šè‹¦æ¼ï¼Œåšè¿‡äº†å¤ªå¤šé”™äº‹ï¼›å¯é‡è§çš„æœªæ¥ï¼Œä¹Ÿè¿˜æ²¡åˆ°æ¸…é—²äº«ä¹çš„æ—¶å€™ã€‚ é‚£è‡³å°‘æŠŠæ˜µç§°æ”¹æˆã€Œæ–¼æ¸…æ¨‚ã€ï¼Œæé†’ç€è‡ªå·±ï¼Œä½ æœ‰è¿‡è¿™æ ·ä¸€ä¸ªæ„¿æœ›ã€‚ ","date":"2020-11-28","objectID":"/posts/jingdezhen-renaissance-band-2020-shenzhen/:1:0","tags":["æ™¯å¾·é•‡æ–‡è‰ºå¤å…´","åæ‘‡"],"title":"ã€Œå°æ­Œè¡Œã€-æ™¯å¾·é•‡æ–‡è‰ºå¤å…´-2020å·¡æ¼”-æ·±åœ³","uri":"/posts/jingdezhen-renaissance-band-2020-shenzhen/"},{"categories":["éŸ³ä¹"],"content":"æ¼”å‡º æ¼”å‡ºçš„å†…å®¹æ˜¯ã€Šå°æ­Œè¡Œã€‹è¿™å¼ ä¸“è¾‘ï¼Œä¹é˜Ÿé€šè¿‡ä¸€ä¸ªè‡ªåˆ›çš„ç¥è¯æ•…äº‹ï¼Œå°†æ•´å¼ ä¸“è¾‘ä¸²æˆäº†ä¸€ä¸ªç±»ä¼¼éŸ³ä¹å‰§çš„å½¢å¼ï¼Œè¿›è¡Œæ¼”å‡ºï¼Œæ•ˆæœå¾ˆæ£’ï¼ æˆ‘ç”¨æ‰‹æœºå½•ä¸‹äº†å‡ ä¹å…¨ç¨‹ï¼Œå› ä¸ºç¬¬ä¸€æ¬¡å‚åŠ  Live Houseï¼Œåˆæ˜¯è‡ªå·±è¿™ä¹ˆå–œæ¬¢çš„ä¹é˜Ÿï¼Œæƒ³è¦å½•ä¸‹æ¥ï¼Œç•™åšçºªå¿µã€‚ è§†é¢‘å·²ç»ä¸Šä¼ åˆ°äº† Bilibili: å½•åˆ°æœ€åæ‰‹æœºæ²¡ç”µäº†ï¼Œä¸ºäº†ç•™ç‚¹ç”µé‡åˆ·å…¬äº¤è½¦å¡å’Œé—¨ç¦å¡ï¼Œæœ€åä¸€é¦–ã€Šæ°´ç å¤´ã€‹æ²¡æœ‰å½•å®Œã€‚ï¼ˆåˆ°å®¶æ—¶çœŸçš„å·®ç‚¹åˆ·ä¸äº†é—¨ç¦hhhï¼‰ å¥½äº†ï¼Œä¸‹é¢æ˜¯æ¼”å‡ºçš„ç…§ç‰‡é›†é”¦ï¼š Live House å…¥å£çš„å®£ä¼ æµ·æŠ¥\" Live House å…¥å£çš„å®£ä¼ æµ·æŠ¥ è€æ‘é•¿1\" è€æ‘é•¿1 è€æ‘é•¿2\" è€æ‘é•¿2 è€æ‘é•¿3\" è€æ‘é•¿3 æ‹‰å°æç´çš„å°å“¥å“¥\" æ‹‰å°æç´çš„å°å“¥å“¥ ä¹ä¸‰èˆè¹ˆ\" ä¹ä¸‰èˆè¹ˆ å°æç´ä¼´å¥\" å°æç´ä¼´å¥ ä¹ä¸‰æ˜¯æœå»·å‘½å®˜\" ä¹ä¸‰æ˜¯æœå»·å‘½å®˜ é˜¿å¼¥é™€ä½›\" é˜¿å¼¥é™€ä½› å”±\" å”± å”±\" å”± å”±\" å”± å”±\" å”± å”±\" å”± ä¹ä¸‰æœ€æ¼‚äº®çš„ä¸€ç¬é—´\" ä¹ä¸‰æœ€æ¼‚äº®çš„ä¸€ç¬é—´ ä¹ä¸‰è¶…å¸…æ°”\" ä¹ä¸‰è¶…å¸…æ°” ç»“æŸï¼š Live House åå°\" Live House åå° ç»“æŸé èº¬\" ç»“æŸé èº¬ å¤§åˆç…§\" å¤§åˆç…§ ç­¾å”®ï¼š ç­¾å”®\" ç­¾å”® ","date":"2020-11-28","objectID":"/posts/jingdezhen-renaissance-band-2020-shenzhen/:2:0","tags":["æ™¯å¾·é•‡æ–‡è‰ºå¤å…´","åæ‘‡"],"title":"ã€Œå°æ­Œè¡Œã€-æ™¯å¾·é•‡æ–‡è‰ºå¤å…´-2020å·¡æ¼”-æ·±åœ³","uri":"/posts/jingdezhen-renaissance-band-2020-shenzhen/"},{"categories":["æŠ€æœ¯"],"content":"æŠ“åŒ…åˆ†æ æŠ“åŒ…åˆ†æå·¥å…·ä¸»è¦æœ‰ä¸¤ç§ï¼š http/https ç½‘ç»œä»£ç†å·¥å…·ï¼šmitmproxy/fiddler éƒ½å±äºè¿™ä¸€ç±»ï¼Œç”¨äºåˆ†æ http éå¸¸æ–¹ä¾¿ã€‚ä½†æ˜¯åªæ”¯æŒ http/httpsï¼Œæœ‰å±€é™æ€§ã€‚ tcp/udp/icmp ç­‰ç½‘ç»œå—…æ¢å·¥å…·ï¼štcpdump/tshark éƒ½å±äºè¿™ä¸€ç±»ï¼Œç½‘ç»œæ•…éšœåˆ†æç­‰åœºæ™¯å¸¸ç”¨ã€‚ è¿™é‡Œä¸»è¦ä»‹ç»å¦‚ä½•ä½¿ç”¨ tcpdump + wireshark è¿›è¡Œè¿œç¨‹å®æ—¶æŠ“åŒ…åˆ†æã€‚ è€Œ mitmproxy æŠ“åŒ…å’Œ wireshark æœ¬åœ°æŠ“åŒ…éƒ½ç›¸å½“ç®€å•ï¼Œå°±ä¸ä»‹ç»äº†ã€‚ P.S. tshark æ˜¯ wireshark çš„å‘½ä»¤è¡Œç‰ˆæœ¬ï¼Œç”¨æ³• tcpdump éå¸¸ç›¸ä¼¼ã€‚ ","date":"2020-05-28","objectID":"/posts/tcpdump-and-wireshark/:0:0","tags":["ç½‘ç»œ","Wireshark","tcpdump","æŠ“åŒ…åˆ†æ"],"title":"ä½¿ç”¨ tcpdump å’Œ Wireshark è¿›è¡Œè¿œç¨‹å®æ—¶æŠ“åŒ…åˆ†æ","uri":"/posts/tcpdump-and-wireshark/"},{"categories":["æŠ€æœ¯"],"content":"ä¸€ã€wireshark çš„åŸºæœ¬ç”¨æ³• WireShark çš„ UI ç•Œé¢å¦‚ä½•ä½¿ç”¨ï¼Œç½‘ä¸Šèƒ½æœå¾—åˆ°å„ç§ç±»å‹çš„ wireshark æ¼”ç¤ºï¼Œå¤šçœ‹å‡ ç¯‡åšå®¢å°±ä¼šäº†ã€‚ æœç´¢ [xxx åè®® wireshark æŠ“åŒ…åˆ†æ] å°±èƒ½æ‰¾åˆ°å„ç§å„æ ·çš„æ¼”ç¤ºï¼Œæ¯”å¦‚ ã€ŒgRPC åè®® wireshark æŠ“åŒ…åˆ†æã€ ã€ŒWebSocket åè®® wireshark æŠ“åŒ…åˆ†æã€ ã€ŒTCP åè®® wireshark æŠ“åŒ…åˆ†æã€ ç­‰ç­‰ ä¸»è¦éœ€è¦ä»‹ç»çš„ï¼Œåº”è¯¥æ˜¯ wireshark çš„æ•°æ®åŒ…è¿‡æ»¤å™¨ã€‚ wireshark ä¸­æœ‰ä¸¤ç§åŒ…è¿‡æ»¤å™¨ï¼š æ•è·è¿‡æ»¤å™¨ï¼šåœ¨æŠ“åŒ…çš„æ—¶å€™ä½¿ç”¨å®ƒå¯¹æ•°æ®åŒ…è¿›è¡Œè¿‡æ»¤ã€‚ æ˜¾ç¤ºè¿‡æ»¤å™¨ï¼šå¯¹æŠ“åˆ°çš„æ‰€æœ‰æ•°æ®åŒ…è¿›è¡Œè¿‡æ»¤ã€‚ æ˜¾ç¤ºè¿‡æ»¤å™¨æ˜¯æœ€æœ‰ç”¨çš„ï¼Œä¸‹é¢ç®€è¦ä»‹ç»ä¸‹æ˜¾ç¤ºè¿‡æ»¤å™¨çš„è¯­æ³•ã€‚ å¯ä»¥ç›´æ¥é€šè¿‡ã€Œåè®®åç§°ã€è¿›è¡Œè¿‡æ»¤ï¼š # åªçœ‹ tcp æµé‡ tcp # åªçœ‹ http æµé‡ http # ä½¿ç”¨æ„Ÿå¹å·ï¼ˆæˆ– notï¼‰è¿›è¡Œåå‘è¿‡æ»¤ !arp # è¿‡æ»¤æ‰æ‰€æœ‰ arp æ•°æ®åŒ… ä¹Ÿå¯ä»¥é€šè¿‡ã€Œåè®®åç§°.åè®®å±æ€§ã€å’Œã€Œæ¯”è¾ƒæ“ä½œç¬¦ï¼ˆæ¯”å¦‚ ==ï¼‰ã€è¿›è¡Œæ›´ç²¾ç¡®çš„è¿‡æ»¤ï¼š # é€šè¿‡ ip çš„æºåœ°å€ src æˆ– dst è¿›è¡Œè¿‡æ»¤ ip.src==192.168.1.33 # é€šè¿‡ IP åœ°å€ï¼ˆip.addrï¼‰è¿›è¡Œè¿‡æ»¤ï¼ˆåŒ¹é… ip.src æˆ– ip.dstï¼‰ ip.addr==192.168.0.5 # ä¸Šä¸€æ¡è¿‡æ»¤è¡¨è¾¾å¼ç­‰ä»·äºï¼š ip.src==192.168.0.5 or ip.dst==192.168.0.5 # é€šè¿‡ tcp ç«¯å£å·è¿›è¡Œè¿‡æ»¤ tcp.port==80 tcp.port\u003e4000 # é€šè¿‡ http çš„ host å±æ€§è¿›è¡Œè¿‡æ»¤ http.host != \"xxx.baidu.com\" # é€šè¿‡ http.referer å±æ€§è¿›è¡Œè¿‡æ»¤ http.referer == \"xxx.baidu.com\" # å¤šä¸ªè¿‡æ»¤å™¨ä¹‹é—´ç”¨ andã€or è¿›è¡Œç»„åˆ http.host != \"xxx.baidu.com\" and http.referer == \"xxx.baidu.com\" ","date":"2020-05-28","objectID":"/posts/tcpdump-and-wireshark/:1:0","tags":["ç½‘ç»œ","Wireshark","tcpdump","æŠ“åŒ…åˆ†æ"],"title":"ä½¿ç”¨ tcpdump å’Œ Wireshark è¿›è¡Œè¿œç¨‹å®æ—¶æŠ“åŒ…åˆ†æ","uri":"/posts/tcpdump-and-wireshark/"},{"categories":["æŠ€æœ¯"],"content":"äºŒã€tcpdump + ssh + wireshark è¿œç¨‹å®æ—¶æŠ“åŒ… åœ¨è¿›è¡Œè¿œç¨‹ç½‘ç»œæŠ“åŒ…åˆ†ææ—¶ï¼Œæˆ‘ä»¬é€šå¸¸çš„åšæ³•æ˜¯ï¼š ä½¿ç”¨ tcpdump åœ¨è¿œç¨‹ä¸»æœºä¸ŠæŠ“åŒ…ï¼Œä¿å­˜ä¸º pcap æ–‡ä»¶ã€‚ å°† pcap æ–‡ä»¶æ‹·è´åˆ°æœ¬åœ°ï¼Œä½¿ç”¨ wireshark å¯¹å…¶è¿›è¡Œåˆ†æã€‚ ä½†æ˜¯è¿™æ ·åšæ²¡æœ‰æ—¶æ•ˆæ€§ï¼Œè€Œä¸”æ•°æ®æ‹·è´æ¥å»ä¹Ÿæ¯”è¾ƒéº»çƒ¦ã€‚ è€ƒè™‘ä½¿ç”¨æµçš„æ–¹å¼ï¼Œåœ¨è¿œç¨‹ä¸»æœºä¸Šä½¿ç”¨ tcpdump æŠ“åŒ…ï¼Œæœ¬åœ°ä½¿ç”¨ wireshark è¿›è¡Œå®æ—¶åˆ†æã€‚ ä½¿ç”¨ ssh åè®®è¿›è¡Œæµå¼ä¼ è¾“çš„ç¤ºä¾‹å¦‚ä¸‹ï¼š # eth0 æ›´æ¢æˆä½ çš„æœºå™¨ interface åç§°ï¼Œè™šæ‹Ÿæœºå¯èƒ½æ˜¯ ens33 ssh root@some.host \"tcpdump -i eth0 -l -w -\" | wireshark -k -i - åœ¨ä¸æ–¹ä¾¿ä½¿ç”¨ ssh åè®®çš„æƒ…å†µä¸‹ï¼ˆæ¯”å¦‚å®¹å™¨æŠ“åŒ…ã€Android æŠ“åŒ…ï¼‰ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ nc(netcat) è¿›è¡Œæ•°æ®æµçš„è½¬å‘ï¼š # 1. è¿œç¨‹ä¸»æœºæŠ“åŒ…ï¼šå°†æ•°æ®æµé€šè¿‡ 11111 ç«¯å£æš´éœ²å‡ºå» tcpdump -i wlan0 -s0 -w - | nc -l -p 11111 # 2. æœ¬åœ°ä¸»æœºä»è¿œç¨‹ä¸»æœºçš„ 11111 ç«¯å£è¯»å–æ•°æ®ï¼Œæä¾›ç»™ wireshark nc \u003cremote-host\u003e 11111 | wireshark -k -S -i - å¦‚æœæ˜¯æŠ“å– Android æ‰‹æœºçš„æ•°æ®ï¼Œæ–¹ä¾¿èµ·è§ï¼Œå¯ä»¥é€šè¿‡ adb å¤šè¿›è¡Œä¸€æ¬¡æ•°æ®è½¬å‘ï¼š # æ–¹æ¡ˆä¸€ï¼šroot æ‰‹æœºåï¼Œå°† arm ç‰ˆçš„ tcpdump æ‹·è´åˆ°æ‰‹æœºå†…è¿›è¡ŒæŠ“åŒ… # 1. åœ¨ adb shell é‡Œä½¿ç”¨ tcpdump æŠ“ WiFi çš„æ•°æ®åŒ…ï¼Œè½¬å‘åˆ° 11111 ç«¯å£ ## éœ€è¦å…ˆè·å–åˆ° root æƒé™ï¼Œå°† tcpdump æ‹·è´åˆ° /system/bin/ ç›®å½•ä¸‹ tcpdump -i wlan0 -s0 -w - | nc -l -p 11111 # 2. åœ¨æœ¬æœºä½¿ç”¨ adb forward å°†æ‰‹æœºçš„ 11111 ç«¯å£ç»‘å®šåˆ°æœ¬æœº(PC)çš„ 11111 ç«¯å£ adb forward tcp:11111 tcp:11111 # 3. ç›´æ¥ä»æœ¬æœº(PC)çš„ 11111 ç«¯å£è¯»å–æ•°æ®ï¼Œæä¾›ç»™ wireshark nc localhost 11111 | wireshark -k -S -i - ## é€šè¿‡æ•°æ®è½¬å‘ï¼Œæœ¬æœº 11111 ç«¯å£çš„æ•°æ®ï¼Œå°±æ˜¯å®‰å“æ‰‹æœºå†… tcmpdump çš„ stdout å†…å®¹ã€‚ # æ–¹æ¡ˆäºŒï¼š # å¦‚æœæ‰‹æœºä¸æ–¹ä¾¿ rootï¼Œæ¨è PC å¼€å¯ WiFi çƒ­ç‚¹ï¼Œæ‰‹æœºè¿ä¸Šè¿™ä¸ªçƒ­ç‚¹è®¿é—®ç½‘ç»œã€‚ # è¿™æ ·æ‰‹æœºçš„æ•°æ®å°±ä¸€å®šä¼šèµ° PCï¼Œç›´æ¥åœ¨ PC ä¸Šé€šè¿‡ wireshark æŠ“åŒ…å°±è¡Œã€‚ # å¦‚æœä½ åªéœ€è¦ç®€å•åœ°æŠ“ http/https åŒ…ï¼Œè¯·ä½¿ç”¨ fiddler/mitmproxy å¦‚æœéœ€è¦å¯¹ Kubernetes é›†ç¾¤ä¸­çš„å®¹å™¨è¿›è¡ŒæŠ“åŒ…ï¼Œæ¨èç›´æ¥ä½¿ç”¨ ksniff! ","date":"2020-05-28","objectID":"/posts/tcpdump-and-wireshark/:2:0","tags":["ç½‘ç»œ","Wireshark","tcpdump","æŠ“åŒ…åˆ†æ"],"title":"ä½¿ç”¨ tcpdump å’Œ Wireshark è¿›è¡Œè¿œç¨‹å®æ—¶æŠ“åŒ…åˆ†æ","uri":"/posts/tcpdump-and-wireshark/"},{"categories":["æŠ€æœ¯"],"content":"Windows ç³»ç»Ÿ å¦å¤–å¦‚æœä½ æœ¬æœºæ˜¯ Windows ç³»ç»Ÿï¼Œè¦åˆ† shell è®¨è®ºï¼š cmd: å¯ä»¥ç›´æ¥ä½¿ç”¨ä¸Šè¿°å‘½ä»¤ã€‚ powershell: **PowerShell ç®¡é“å¯¹ native commands çš„æ”¯æŒä¸æ˜¯å¾ˆå¥½ï¼Œç®¡é“ä¸¤è¾¹çš„å‘½ä»¤è²Œä¼¼æ˜¯ä¸²è¡Œæ‰§è¡Œçš„ï¼Œè¿™ä¼šå¯¼è‡´ wireshark æ— æ³•å¯åŠ¨ï¼**ç›®å‰æ²¡æœ‰æ‰¾åˆ°å¥½çš„è§£å†³æ–¹æ³•ã€‚ã€‚ å¦å¤–å¦‚æœä½ ä½¿ç”¨ wslï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤ä½¿ wsl è°ƒç”¨ windows ä¸­çš„ wireshark è¿›è¡ŒæŠ“åŒ…åˆ†æï¼š # æ·»åŠ è½¯é“¾æ¥ sudo ln -s \"$(which wireshark.exe)\" /usr/local/bin/wireshark æ·»åŠ äº†ä¸Šè¿°è½¯é“¾æ¥åï¼Œå°±å¯ä»¥æ­£å¸¸åœ°åœ¨ wsl ä¸­ä½¿ç”¨å‰é¢ä»‹ç»çš„æ‰€æœ‰æŠ“åŒ…æŒ‡ä»¤äº†ï¼ˆåŒ…æ‹¬ ksniffï¼‰ã€‚ å®ƒèƒ½æ­£å¸¸è°ƒç”¨ windows ä¸­çš„ wiresharkï¼Œæ•°æ®æµä¹Ÿèƒ½æ­£å¸¸åœ°é€šè¿‡ shell ç®¡é“ä¼ è¾“ã€‚ ","date":"2020-05-28","objectID":"/posts/tcpdump-and-wireshark/:2:1","tags":["ç½‘ç»œ","Wireshark","tcpdump","æŠ“åŒ…åˆ†æ"],"title":"ä½¿ç”¨ tcpdump å’Œ Wireshark è¿›è¡Œè¿œç¨‹å®æ—¶æŠ“åŒ…åˆ†æ","uri":"/posts/tcpdump-and-wireshark/"},{"categories":["æŠ€æœ¯"],"content":"2. termshark: ç›´æ¥é€šè¿‡å‘½ä»¤è¡Œ UI è¿›è¡Œå®æ—¶æŠ“åŒ…åˆ†æ æœ‰çš„æ—¶å€™ï¼Œè¿œç¨‹å®æ—¶æŠ“åŒ…å› ä¸ºæŸäº›åŸå› æ— æ³•å®ç°ï¼Œè€ŒæŠŠ pcap æ•°æ®æ‹·è´åˆ°æœ¬åœ°åˆ†æåˆæ¯”è¾ƒéº»çƒ¦ã€‚ è¿™æ—¶ä½ å¯ä»¥è€ƒè™‘ç›´æ¥ä½¿ç”¨å‘½ä»¤è¡Œç‰ˆæœ¬çš„ wireshark UI: termsharkï¼Œç›´æ¥åœ¨å‘½ä»¤è¡Œè¿›è¡Œå®æ—¶çš„æŠ“åŒ…åˆ†æã€‚ kubectl-debug é»˜è®¤çš„è°ƒè¯•é•œåƒä¸­ï¼Œå°±è‡ªå¸¦ termshark. ","date":"2020-05-28","objectID":"/posts/tcpdump-and-wireshark/:3:0","tags":["ç½‘ç»œ","Wireshark","tcpdump","æŠ“åŒ…åˆ†æ"],"title":"ä½¿ç”¨ tcpdump å’Œ Wireshark è¿›è¡Œè¿œç¨‹å®æ—¶æŠ“åŒ…åˆ†æ","uri":"/posts/tcpdump-and-wireshark/"},{"categories":["æŠ€æœ¯"],"content":"å‚è€ƒ WireSharkä½¿ç”¨æ•™ç¨‹ Tracing network traffic using tcpdump and tshark Android remote sniffing using Tcpdump, nc and Wireshark èŠèŠtcpdumpä¸WiresharkæŠ“åŒ…åˆ†æ ","date":"2020-05-28","objectID":"/posts/tcpdump-and-wireshark/:4:0","tags":["ç½‘ç»œ","Wireshark","tcpdump","æŠ“åŒ…åˆ†æ"],"title":"ä½¿ç”¨ tcpdump å’Œ Wireshark è¿›è¡Œè¿œç¨‹å®æ—¶æŠ“åŒ…åˆ†æ","uri":"/posts/tcpdump-and-wireshark/"},{"categories":["æŠ€æœ¯"],"content":" æœ¬æ–‡åŸºäº Istio1.5 ç¼–å†™æµ‹è¯• Istio æ”¯æŒä½¿ç”¨ JWT å¯¹ç»ˆç«¯ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ï¼ˆIstio End User Authenticationï¼‰ï¼Œæ”¯æŒå¤šç§ JWT ç­¾åç®—æ³•ã€‚ ç›®å‰ä¸»æµçš„ JWT ç®—æ³•æ˜¯ RS256/ES256ã€‚ï¼ˆè¯·å¿½ç•¥ HS256ï¼Œè¯¥ç®—æ³•ä¸é€‚åˆåˆ†å¸ƒå¼ JWT éªŒè¯ï¼‰ è¿™é‡Œä»¥ RSA256 ç®—æ³•ä¸ºä¾‹è¿›è¡Œä»‹ç»ï¼ŒES256 çš„é…ç½®æ–¹å¼ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚ ","date":"2020-04-06","objectID":"/posts/use-istio-for-jwt-auth/:0:0","tags":["Kubernetes","Istio","æœåŠ¡ç½‘æ ¼"],"title":"ä½¿ç”¨ Istio è¿›è¡Œ JWT èº«ä»½éªŒè¯ï¼ˆå……å½“ API ç½‘å…³ï¼‰","uri":"/posts/use-istio-for-jwt-auth/"},{"categories":["æŠ€æœ¯"],"content":"1. ä»‹ç» JWK ä¸ JWKS Istio è¦æ±‚æä¾› JWKS æ ¼å¼çš„ä¿¡æ¯ï¼Œç”¨äº JWT ç­¾åéªŒè¯ã€‚å› æ­¤è¿™é‡Œå¾—å…ˆä»‹ç»ä¸€ä¸‹ JWK å’Œ JWKS. JWKS ï¼Œä¹Ÿå°±æ˜¯ JWK Setï¼Œjson ç»“æ„å¦‚ä¸‹ï¼š { \"keys\": [ \u003cjwk-1\u003e, \u003cjwk-2\u003e, ... ]} JWKS æè¿°ä¸€ç»„ JWK å¯†é’¥ã€‚å®ƒèƒ½åŒæ—¶æè¿°å¤šä¸ªå¯ç”¨çš„å…¬é’¥ï¼Œåº”ç”¨åœºæ™¯ä¹‹ä¸€æ˜¯å¯†é’¥çš„ Rotate. è€Œ JWKï¼Œå…¨ç§°æ˜¯ Json Web Keyï¼Œå®ƒæè¿°äº†ä¸€ä¸ªåŠ å¯†å¯†é’¥ï¼ˆå…¬é’¥æˆ–ç§é’¥ï¼‰çš„å„é¡¹å±æ€§ï¼ŒåŒ…æ‹¬å¯†é’¥çš„å€¼ã€‚ Istio ä½¿ç”¨ JWK æè¿°éªŒè¯ JWT ç­¾åæ‰€éœ€è¦çš„ä¿¡æ¯ã€‚åœ¨ä½¿ç”¨ RSA ç­¾åç®—æ³•æ—¶ï¼ŒJWK æè¿°çš„åº”è¯¥æ˜¯ç”¨äºéªŒè¯çš„ RSA å…¬é’¥ã€‚ ä¸€ä¸ª RSA å…¬é’¥çš„ JWK æè¿°å¦‚ä¸‹ï¼š { \"alg\": \"RS256\", # ç®—æ³•ã€Œå¯é€‰å‚æ•°ã€ \"kty\": \"RSA\", # å¯†é’¥ç±»å‹ \"use\": \"sig\", # è¢«ç”¨äºç­¾åã€Œå¯é€‰å‚æ•°ã€ \"kid\": \"NjVBRjY5MDlCMUIwNzU4RTA2QzZFMDQ4QzQ2MDAyQjVDNjk1RTM2Qg\", # key çš„å”¯ä¸€ id \"n\": \"yeNlzlub94YgerT030codqEztjfU_S6X4DbDA_iVKkjAWtYfPHDzz_sPCT1Axz6isZdf3lHpq_gYX4Sz-cbe4rjmigxUxr-FgKHQy3HeCdK6hNq9ASQvMK9LBOpXDNn7mei6RZWom4wo3CMvvsY1w8tjtfLb-yQwJPltHxShZq5-ihC9irpLI9xEBTgG12q5lGIFPhTl_7inA1PFK97LuSLnTJzW0bj096v_TMDg7pOWm_zHtF53qbVsI0e3v5nmdKXdFf9BjIARRfVrbxVxiZHjU6zL6jY5QJdh1QCmENoejj_ytspMmGW7yMRxzUqgxcAqOBpVm0b-_mW3HoBdjQ\", \"e\": \"AQAB\" } RSA æ˜¯åŸºäºå¤§æ•°åˆ†è§£çš„åŠ å¯†/ç­¾åç®—æ³•ï¼Œä¸Šè¿°å‚æ•°ä¸­ï¼Œe æ˜¯å…¬é’¥çš„æ¨¡æ•°(modulus)ï¼Œn æ˜¯å…¬é’¥çš„æŒ‡æ•°(exponent)ï¼Œä¸¤ä¸ªå‚æ•°éƒ½æ˜¯ base64 å­—ç¬¦ä¸²ã€‚ JWK ä¸­ RSA å…¬é’¥çš„å…·ä½“å®šä¹‰å‚è§ RSA Keys - JSON Web Algorithms (JWA) ","date":"2020-04-06","objectID":"/posts/use-istio-for-jwt-auth/:0:1","tags":["Kubernetes","Istio","æœåŠ¡ç½‘æ ¼"],"title":"ä½¿ç”¨ Istio è¿›è¡Œ JWT èº«ä»½éªŒè¯ï¼ˆå……å½“ API ç½‘å…³ï¼‰","uri":"/posts/use-istio-for-jwt-auth/"},{"categories":["æŠ€æœ¯"],"content":"2. JWK çš„ç”Ÿæˆ è¦ç”Ÿæˆ JWK å…¬é’¥ï¼Œéœ€è¦å…ˆç”Ÿæˆç§é’¥ï¼Œç”Ÿæˆæ–¹æ³•å‚è§ JWT ç­¾åç®—æ³• HS256ã€RS256 åŠ ES256 åŠå¯†é’¥ç”Ÿæˆã€‚ å…¬é’¥ä¸éœ€è¦ç”¨ä¸Šè¿°æ–¹æ³•ç”Ÿæˆï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦çš„æ˜¯ JWK æ ¼å¼çš„å…¬é’¥ã€‚åé¢ä¼šé€šè¿‡ python ç”Ÿæˆå‡º JWK å…¬é’¥ã€‚ ä¸Šé¢çš„å‘½ä»¤ä¼šå°†ç”Ÿæˆå‡ºçš„ RSA ç§é’¥å†™å…¥ key.pem ä¸­ï¼ŒæŸ¥çœ‹ä¸€ä¸‹ç§é’¥å†…å®¹ã€‚ ryan@RYAN-MI-DESKTOP:~/istio$ cat key.pem -----BEGIN RSA PRIVATE KEY----- MIIEpAIBAAKCAQEAt1cKkQqPh8iOv5BhKh7Rx6A2+1ldpO/jczML/0GBKu4X+lHr Y8YbJrt29jyAXlWM8vHC7tXsqgUG+WziRD0D8nhnh10XC14SeH+3mVuBqph+TqhX TWsh9gtAIbeUHJjEI4I79QK4/wquPHHIGZBQDQQnuMh6vAS3VaUYJdEIoKvUBnAy Y35kJZgyJSbrxLsEExL2zujUD/OY+/In2bq/3rFtDGNlgHyC7Gu2zXSXvfOA4O5m 9BBXOc7eEqj7PoOKNaTxLN3YcuRtgR6NIXL4KLb6oyvIzoeiprt4+9q7sc3Dnkc5 EV9kwWlEW2DHzhP6VYca0WXIIXc53U1AM3ewxwIDAQABAoIBABIKhaaqJF+XM7zU B0uuxrPfJynqrFVbqcUfQ9H1bzF7Rm7CeuhRiUBxeA5Y+8TMpFcPxT/dWzGL1xja RxWx715/zKg8V9Uth6HF55o2r/bKlLtGw3iBz1C34LKwrul1eu+HlEDS6MNoGKco BynE0qvFOedsCu/Pgv7xhQPLow60Ty1uM0AhbcPgi6yJ5ksRB1XjtEnW0t+c8yQS nU3mU8k230SdMhf4Ifud/5TPLjmXdFpyPi9uYiVdJ5oWsmMWEvekXoBnHWDDF/eT VkVMiTBorT4qn+Ax1VjHL2VOMO5ZbXEcpbIc3Uer7eZAaDQ0NPZK37IkIn9TiZ21 cqzgbCkCgYEA5enHZbD5JgfwSNWCaiNrcBhYjpCtvfbT82yGW+J4/Qe/H+bY/hmJ RRTKf0kVPdRwZzq7GphVMWIuezbOk0aFGhk/SzIveW8QpLY0FV/5xFnGNjV9AuNc xrmgVshUsyQvr1TFkbdkC6yuvNgQfXfnbEoaPsXYEMCii2zqdF5lWGUCgYEAzCR2 6g8vEQx0hdRS5d0zD2/9IRYNzfP5oK0+F3KHH2OuwlmQVIo7IhCiUgqserXNBDef hj+GNcU8O/yXLomAXG7VG/cLWRrpY8d9bcRMrwb0/SkNr0yNrkqHiWQ/PvR+2MLk viWFZTTp8YizPA+8pSC/oFd1jkZF0UhKVAREM7sCgYB5+mfxyczFopyW58ADM7uC g0goixXCnTuiAEfgY+0wwXVjJYSme0HaxscQdOOyJA1ml0BBQeShCKgEcvVyKY3g ZNixunR5hrVbzdcgKAVJaR/CDuq+J4ZHYKByqmJVkLND4EPZpWSM1Rb31eIZzw2W 5FG8UBbr/GfAdQ6GorY+CQKBgQCzWQHkBmz6VG/2t6AQ9LIMSP4hWEfOfh78q9dW MDdIO4JomtkzfLIQ7n49B8WalShGITwUbLDTgrG1neeQahsMmg6+X99nbD5JfBTV H9WjG8CWvb+ZF++NhUroSNtLyu+6LhdaeopkbQVvPwMArG62wDu6ebv8v/5MrG8o uwrUSwKBgQCxV43ZqTRnEuDlF7jMN+2JZWhpbrucTG5INoMPOC0ZVatePszZjYm8 LrmqQZHer2nqtFpyslwgKMWgmVLJTH7sVf0hS9po0+iSYY/r8e/c85UdUreb0xyT x8whrOnMMODCAqu4W/Rx1Lgf2vXIx0pZmlt8Df9i2AVg/ePR6jO3Nw== -----END RSA PRIVATE KEY----- æ¥ä¸‹æ¥é€šè¿‡ Python ç¼–ç¨‹ç”Ÿæˆ RSA Public Key å’Œ JWKï¼ˆjwk å…¶å®å°±æ˜¯å…¬é’¥çš„å¦ä¸€ä¸ªè¡¨è¿°å½¢å¼è€Œå·²ï¼‰: # éœ€è¦å…ˆå®‰è£…ä¾èµ–: pip install jwcrypto from jwcrypto.jwk import JWK from pathlib import Path private_key = Path(\"key.pem\").read_bytes() jwk = JWK.from_pem(private_key) # å¯¼å‡ºå…¬é’¥ RSA Public Key public_key = jwk.public().export_to_pem() print(public_key) print(\"=\"*30) # å¯¼å‡º JWK jwk_bytes = jwk.public().export() print(jwk_bytes) Istio éœ€è¦ JWK è¿›è¡Œ JWT éªŒè¯ï¼Œè€Œæˆ‘ä»¬æ‰‹åŠ¨éªŒè¯ JWT æ—¶ä¸€èˆ¬éœ€è¦ç”¨åˆ° Public Key. æ–¹ä¾¿èµ·è§ï¼Œä¸Šè¿°ä»£ç æŠŠè¿™ä¸¤ä¸ªéƒ½æ‰“å°äº†å‡ºæ¥ã€‚å†…å®¹å¦‚ä¸‹ï¼š # Public Key å†…å®¹ï¼Œä¸åŒ…å«è¿™è¡Œæ³¨é‡Š -----BEGIN PUBLIC KEY----- MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAt1cKkQqPh8iOv5BhKh7R x6A2+1ldpO/jczML/0GBKu4X+lHrY8YbJrt29jyAXlWM8vHC7tXsqgUG+WziRD0D 8nhnh10XC14SeH+3mVuBqph+TqhXTWsh9gtAIbeUHJjEI4I79QK4/wquPHHIGZBQ DQQnuMh6vAS3VaUYJdEIoKvUBnAyY35kJZgyJSbrxLsEExL2zujUD/OY+/In2bq/ 3rFtDGNlgHyC7Gu2zXSXvfOA4O5m9BBXOc7eEqj7PoOKNaTxLN3YcuRtgR6NIXL4 KLb6oyvIzoeiprt4+9q7sc3Dnkc5EV9kwWlEW2DHzhP6VYca0WXIIXc53U1AM3ew xwIDAQAB -----END PUBLIC KEY----- # jwk å†…å®¹ { 'e': 'AQAB', 'kid': 'oyYwZSLCLVVPHdVp0jXIcLNpGn6dMCumlY-6wSenmFo', 'kty': 'RSA', 'n': 't1cKkQqPh8iOv5BhKh7Rx6A2-1ldpO_jczML_0GBKu4X-lHrY8YbJrt29jyAXlWM8vHC7tXsqgUG-WziRD0D8nhnh10XC14SeH-3mVuBqph-TqhXTWsh9gtAIbeUHJjEI4I79QK4_wquPHHIGZBQDQQnuMh6vAS3VaUYJdEIoKvUBnAyY35kJZgyJSbrxLsEExL2zujUD_OY-_In2bq_3rFtDGNlgHyC7Gu2zXSXvfOA4O5m9BBXOc7eEqj7PoOKNaTxLN3YcuRtgR6NIXL4KLb6oyvIzoeiprt4-9q7sc3Dnkc5EV9kwWlEW2DHzhP6VYca0WXIIXc53U1AM3ewxw' } ","date":"2020-04-06","objectID":"/posts/use-istio-for-jwt-auth/:0:2","tags":["Kubernetes","Istio","æœåŠ¡ç½‘æ ¼"],"title":"ä½¿ç”¨ Istio è¿›è¡Œ JWT èº«ä»½éªŒè¯ï¼ˆå……å½“ API ç½‘å…³ï¼‰","uri":"/posts/use-istio-for-jwt-auth/"},{"categories":["æŠ€æœ¯"],"content":"4. æµ‹è¯•å¯†é’¥å¯ç”¨æ€§ æ¥ä¸‹æ¥åœ¨ jwt.io ä¸­å¡«å…¥æµ‹è¯•ç”¨çš„å…¬é’¥ç§é’¥ï¼Œè¿˜æœ‰ Header/Payloadã€‚ä¸€æ˜¯æµ‹è¯•å…¬ç§é’¥çš„å¯ç”¨æ€§ï¼ŒäºŒæ˜¯ç”Ÿæˆå‡º JWT ä¾›åç»­æµ‹è¯• Istio JWT éªŒè¯åŠŸèƒ½çš„å¯ç”¨æ€§ã€‚ å¯ä»¥çœ‹åˆ°å·¦ä¸‹è§’æ˜¾ç¤ºã€ŒSignature Verifiedã€ï¼ŒæˆåŠŸåœ°ç”Ÿæˆå‡ºäº† JWTã€‚åç»­å¯ä»¥ä½¿ç”¨è¿™ä¸ª JWT è®¿é—® Istio ç½‘å…³ï¼Œæµ‹è¯• Istio JWT éªŒè¯åŠŸèƒ½ã€‚ ","date":"2020-04-06","objectID":"/posts/use-istio-for-jwt-auth/:0:3","tags":["Kubernetes","Istio","æœåŠ¡ç½‘æ ¼"],"title":"ä½¿ç”¨ Istio è¿›è¡Œ JWT èº«ä»½éªŒè¯ï¼ˆå……å½“ API ç½‘å…³ï¼‰","uri":"/posts/use-istio-for-jwt-auth/"},{"categories":["æŠ€æœ¯"],"content":"5. å¯ç”¨ Istio çš„èº«ä»½éªŒè¯ ç¼–å†™ istio é…ç½®ï¼š apiVersion:\"security.istio.io/v1beta1\"kind:\"RequestAuthentication\"metadata:name:\"jwt-example\"namespace:istio-system # istio-system åå­—ç©ºé—´ä¸­çš„é…ç½®ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šåº”ç”¨åˆ°æ‰€æœ‰åå­—ç©ºé—´spec:selector:matchLabels:istio:ingressgatewayjwtRules:# issuer å³ç­¾å‘è€…ï¼Œéœ€è¦å’Œ JWT payload ä¸­çš„ iss å±æ€§å®Œå…¨ä¸€è‡´ã€‚- issuer:\"testing@secure.istio.io\"jwks:|{ \"keys\": [ { \"e\": \"AQAB\", \"kid\": \"oyYwZSLCLVVPHdVp0jXIcLNpGn6dMCumlY-6wSenmFo\", # kid éœ€è¦ä¸ jwt header ä¸­çš„ kid å®Œå…¨ä¸€è‡´ã€‚ \"kty\": \"RSA\", \"n\": \"t1cKkQqPh8iOv5BhKh7Rx6A2-1ldpO_jczML_0GBKu4X-lHrY8YbJrt29jyAXlWM8vHC7tXsqgUG-WziRD0D8nhnh10XC14SeH-3mVuBqph-TqhXTWsh9gtAIbeUHJjEI4I79QK4_wquPHHIGZBQDQQnuMh6vAS3VaUYJdEIoKvUBnAyY35kJZgyJSbrxLsEExL2zujUD_OY-_In2bq_3rFtDGNlgHyC7Gu2zXSXvfOA4O5m9BBXOc7eEqj7PoOKNaTxLN3YcuRtgR6NIXL4KLb6oyvIzoeiprt4-9q7sc3Dnkc5EV9kwWlEW2DHzhP6VYca0WXIIXc53U1AM3ewxw\" } ] } # jwks æˆ– jwksUri äºŒé€‰å…¶ä¸€ # jwksUri: \"http://nginx.test.local/istio/jwks.json\" ç°åœ¨ kubectl apply ä¸€ä¸‹ï¼ŒJWT éªŒè¯å°±æ·»åŠ åˆ°å…¨å±€äº†ã€‚ å¯ä»¥çœ‹åˆ° jwtRules æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œå› æ­¤å¯ä»¥ä¸ºæ¯ä¸ª issuers é…ç½®ä¸åŒçš„ jwtRule. å¯¹åŒä¸€ä¸ª issuersï¼ˆjwt ç­¾å‘è€…ï¼‰ï¼Œå¯ä»¥é€šè¿‡ jwks è®¾ç½®å¤šä¸ªå…¬é’¥ï¼Œä»¥å®ç°JWTç­¾åå¯†é’¥çš„è½®è½¬ã€‚ JWT çš„éªŒè¯è§„åˆ™æ˜¯ï¼š JWT çš„ payload ä¸­æœ‰ issuer å±æ€§ï¼Œé¦–å…ˆé€šè¿‡ issuer åŒ¹é…åˆ°å¯¹åº”çš„ istio ä¸­é…ç½®çš„ jwksã€‚ JWT çš„ header ä¸­æœ‰ kid å±æ€§ï¼Œç¬¬äºŒæ­¥åœ¨ jwks çš„å…¬é’¥åˆ—è¡¨ä¸­ï¼Œä¸­æ‰¾åˆ° kid ç›¸åŒçš„å…¬é’¥ã€‚ ä½¿ç”¨æ‰¾åˆ°çš„å…¬é’¥è¿›è¡Œ JWT ç­¾åéªŒè¯ã€‚ ","date":"2020-04-06","objectID":"/posts/use-istio-for-jwt-auth/:0:4","tags":["Kubernetes","Istio","æœåŠ¡ç½‘æ ¼"],"title":"ä½¿ç”¨ Istio è¿›è¡Œ JWT èº«ä»½éªŒè¯ï¼ˆå……å½“ API ç½‘å…³ï¼‰","uri":"/posts/use-istio-for-jwt-auth/"},{"categories":["æŠ€æœ¯"],"content":"6. å¯ç”¨ Payload è½¬å‘/Authorization è½¬å‘ é»˜è®¤æƒ…å†µä¸‹ï¼ŒIstio åœ¨å®Œæˆäº†èº«ä»½éªŒè¯ä¹‹åï¼Œä¼šå»æ‰ Authorization è¯·æ±‚å¤´å†è¿›è¡Œè½¬å‘ã€‚ è¿™å°†å¯¼è‡´æˆ‘ä»¬çš„åç«¯æœåŠ¡è·å–ä¸åˆ°å¯¹åº”çš„ Payloadï¼Œæ— æ³•åˆ¤æ–­ End User çš„èº«ä»½ã€‚ å› æ­¤æˆ‘ä»¬éœ€è¦å¯ç”¨ Istio çš„ Authorization è¯·æ±‚å¤´çš„è½¬å‘åŠŸèƒ½ï¼Œåœ¨å‰è¿°çš„ RequestAuthentication yaml é…ç½®ä¸­æ·»åŠ ä¸€ä¸ªå‚æ•°å°±è¡Œï¼š apiVersion:\"security.istio.io/v1beta1\"kind:\"RequestAuthentication\"metadata:name:\"jwt-example\"namespace:istio-systemspec:selector:matchLabels:istio:ingressgatewayjwtRules:- issuer:\"testing@secure.istio.io\"jwks:|{ \"keys\": [ { \"e\": \"AQAB\", \"kid\": \"oyYwZSLCLVVPHdVp0jXIcLNpGn6dMCumlY-6wSenmFo\", \"kty\": \"RSA\", \"n\": \"t1cKkQqPh8iOv5BhKh7Rx6A2-1ldpO_jczML_0GBKu4X-lHrY8YbJrt29jyAXlWM8vHC7tXsqgUG-WziRD0D8nhnh10XC14SeH-3mVuBqph-TqhXTWsh9gtAIbeUHJjEI4I79QK4_wquPHHIGZBQDQQnuMh6vAS3VaUYJdEIoKvUBnAyY35kJZgyJSbrxLsEExL2zujUD_OY-_In2bq_3rFtDGNlgHyC7Gu2zXSXvfOA4O5m9BBXOc7eEqj7PoOKNaTxLN3YcuRtgR6NIXL4KLb6oyvIzoeiprt4-9q7sc3Dnkc5EV9kwWlEW2DHzhP6VYca0WXIIXc53U1AM3ewxw\" } ] }# ===================== æ·»åŠ å¦‚ä¸‹å‚æ•°===========================forwardOriginalToken:true# è½¬å‘ Authorization è¯·æ±‚å¤´ åŠ äº†è½¬å‘åï¼Œæµç¨‹å›¾å¦‚ä¸‹ï¼ˆéœ€è¦ mermaid æ¸²æŸ“ï¼‰ï¼š ","date":"2020-04-06","objectID":"/posts/use-istio-for-jwt-auth/:0:5","tags":["Kubernetes","Istio","æœåŠ¡ç½‘æ ¼"],"title":"ä½¿ç”¨ Istio è¿›è¡Œ JWT èº«ä»½éªŒè¯ï¼ˆå……å½“ API ç½‘å…³ï¼‰","uri":"/posts/use-istio-for-jwt-auth/"},{"categories":["æŠ€æœ¯"],"content":"å…¶ä»–é—®é¢˜ ","date":"2020-04-06","objectID":"/posts/use-istio-for-jwt-auth/:1:0","tags":["Kubernetes","Istio","æœåŠ¡ç½‘æ ¼"],"title":"ä½¿ç”¨ Istio è¿›è¡Œ JWT èº«ä»½éªŒè¯ï¼ˆå……å½“ API ç½‘å…³ï¼‰","uri":"/posts/use-istio-for-jwt-auth/"},{"categories":["æŠ€æœ¯"],"content":"1. AuthorizationPolicy Istio çš„ JWT éªŒè¯è§„åˆ™ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šç›´æ¥å¿½ç•¥ä¸å¸¦ Authorization è¯·æ±‚å¤´çš„æµé‡ï¼Œå› æ­¤è¿™ç±»æµé‡èƒ½ç›´æ¥è¿›å…¥ç½‘æ ¼å†…éƒ¨ã€‚å¦‚æœéœ€è¦ç¦æ­¢ä¸å¸¦ Authorization å¤´çš„æµé‡ï¼Œéœ€è¦é¢å¤–é…ç½® AuthorizationPolicy ç­–ç•¥ã€‚ RequestsAuthentication éªŒè¯å¤±è´¥çš„è¯·æ±‚ï¼ŒIstio ä¼šè¿”å› 401 çŠ¶æ€ç ã€‚ AuthorizationPolicy éªŒè¯å¤±è´¥çš„è¯·æ±‚ï¼ŒIstio ä¼šè¿”å› 403 çŠ¶æ€ç ã€‚ è¿™ä¼šå¯¼è‡´åœ¨ä½¿ç”¨ AuthorizationPolicy ç¦æ­¢äº†ä¸å¸¦ Authorization å¤´çš„æµé‡åï¼Œè¿™ç±»è¯·æ±‚ä¼šç›´æ¥è¢«è¿”å› 403ã€‚ã€‚ã€‚åœ¨ä½¿ç”¨ RESTful API æ—¶ï¼Œè¿™ç§æƒ…å†µå¯èƒ½ä¼šé€ æˆä¸€å®šçš„é—®é¢˜ã€‚ ","date":"2020-04-06","objectID":"/posts/use-istio-for-jwt-auth/:1:1","tags":["Kubernetes","Istio","æœåŠ¡ç½‘æ ¼"],"title":"ä½¿ç”¨ Istio è¿›è¡Œ JWT èº«ä»½éªŒè¯ï¼ˆå……å½“ API ç½‘å…³ï¼‰","uri":"/posts/use-istio-for-jwt-auth/"},{"categories":["æŠ€æœ¯"],"content":"2. Response Headers RequestsAuthentication ä¸æ”¯æŒè‡ªå®šä¹‰å“åº”å¤´ä¿¡æ¯ï¼Œè¿™å¯¼è‡´å¯¹äºå‰åç«¯åˆ†ç¦»çš„ Web API è€Œè¨€ï¼Œ ä¸€æ—¦ JWT å¤±æ•ˆï¼ŒIstio ä¼šç›´æ¥å°† 401 è¿”å›ç»™å‰ç«¯ Web é¡µé¢ã€‚ å› ä¸ºå“åº”å¤´ä¸­ä¸åŒ…å« Access-Crontrol-Allow-Originï¼Œå“åº”å°†è¢«æµè§ˆå™¨æ‹¦æˆªï¼ è¿™å¯èƒ½éœ€è¦é€šè¿‡ EnvoyFilter è‡ªå®šä¹‰å“åº”å¤´ï¼Œæ·»åŠ è·¨åŸŸä¿¡æ¯ã€‚ ","date":"2020-04-06","objectID":"/posts/use-istio-for-jwt-auth/:1:2","tags":["Kubernetes","Istio","æœåŠ¡ç½‘æ ¼"],"title":"ä½¿ç”¨ Istio è¿›è¡Œ JWT èº«ä»½éªŒè¯ï¼ˆå……å½“ API ç½‘å…³ï¼‰","uri":"/posts/use-istio-for-jwt-auth/"},{"categories":["æŠ€æœ¯"],"content":"å‚è€ƒ JSON Web Key Set Properties - Auth0 JWK - RFC7517 Sample JWT and JWKS data for demo - Istio Security End User Authentication - Istio JWTRule - Istio jwt.io - åŠ¨æ€ç”Ÿæˆ jwt ","date":"2020-04-06","objectID":"/posts/use-istio-for-jwt-auth/:2:0","tags":["Kubernetes","Istio","æœåŠ¡ç½‘æ ¼"],"title":"ä½¿ç”¨ Istio è¿›è¡Œ JWT èº«ä»½éªŒè¯ï¼ˆå……å½“ API ç½‘å…³ï¼‰","uri":"/posts/use-istio-for-jwt-auth/"},{"categories":["æŠ€æœ¯"],"content":" ä¸ªäººç¬”è®°ï¼Œè§‚ç‚¹ä¸ä¸€å®šæ­£ç¡®. é€‚åˆå¯¹ Kubernetes æœ‰ä¸€å®šäº†è§£çš„åŒå­¦ã€‚ ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:0:0","tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/"},{"categories":["æŠ€æœ¯"],"content":"å‰è¨€ æœ€è¿‘ä¸€ç›´åœ¨å­¦ä¹  Kubernetesï¼Œä½†æ˜¯æ‰‹å¤´æ²¡æœ‰ä¸ªè‡ªæœ‰åŸŸåï¼Œè¦æµ‹è¯• ingress å°±æ¯”è¾ƒéº»çƒ¦ï¼Œæ¯æ¬¡éƒ½æ˜¯æ‰‹åŠ¨æ”¹ hosts æ–‡ä»¶ã€‚ã€‚ ä»Šå¤©çªç„¶æƒ³åˆ°â€”â€”K8s å†…éƒ¨å°±æ˜¯ç”¨ DNS åšçš„æœåŠ¡å‘ç°ï¼Œæˆ‘ä¸ºå•¥ä¸è‡ªå·±å¼„ä¸€ä¸ª DNS æœåŠ¡å™¨å‘¢ï¼Ÿç„¶åæ‰€æœ‰èŠ‚ç‚¹çš„ DNS éƒ½é…æˆå®ƒï¼Œè¿™æ ·æœ‰éœ€è¦æ—¶ç›´æ¥æ”¹è¿™ä¸ª DNS æœåŠ¡å™¨çš„é…ç½®å°±è¡Œï¼Œ ä¸€åŠ³æ°¸é€¸ã€‚ æˆ‘é¦–å…ˆæƒ³åˆ°çš„æ˜¯ ç¾¤æ™–/Windows Server è‡ªå¸¦çš„é‚£ç§è‡ªå¸¦å›¾å½¢åŒ–ç•Œé¢çš„ DNS æœåŠ¡å™¨ï¼Œä½†æ˜¯è¿™ä¿©éƒ½æ˜¯å¹³å°ç‰¹å®šçš„ã€‚ ç½‘ä¸Šæœä¸€åœˆæ²¡æ‰¾åˆ°ç±»ä¼¼å¸¦ UI çš„ DNS å·¥å…·ï¼Œæœåˆ°çš„ powerdns/bind ç›¸æ¯” coredns ä¹Ÿæ²¡çœ‹å‡ºå•¥ä¼˜åŠ¿æ¥ï¼Œæ‰€ä»¥å†³å®šå°±ç”¨ CoreDNSï¼Œåˆšå¥½ç†Ÿæ‚‰ä¸€ä¸‹å®ƒçš„å…·ä½“ä½¿ç”¨ã€‚ ä¸è¿‡è®² CoreDNS å‰ï¼Œæˆ‘ä»¬è¿˜æ˜¯å…ˆæ¥ç†Ÿæ‚‰ä¸€ä¸‹ DNS çš„åŸºç¡€æ¦‚å¿µå§ã€‚ ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:1:0","tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/"},{"categories":["æŠ€æœ¯"],"content":"ä¸€ã€DNS æ˜¯ä¸ªå•¥ï¼Ÿ æ²¡æœ‰å†™å¾—å¾ˆæ¸…æ¥šï¼Œä¸é€‚åˆåˆå­¦ã€‚å»ºè®®å…ˆé€šè¿‡åˆ«çš„èµ„æ–™ç†Ÿæ‚‰ä¸‹ DNS åŸºç¡€ã€‚ DNSï¼Œå³åŸŸåç³»ç»Ÿï¼ˆDomain Name Systemï¼‰ï¼Œæ˜¯ä¸€é¡¹è´Ÿè´£å°†ä¸€ä¸ª human readable çš„æ‰€è°“åŸŸåï¼Œè½¬æ¢æˆä¸€ä¸ª ip åœ°å€çš„åè®®ã€‚ è€ŒåŸŸåçš„å¥½å¤„ï¼Œæœ‰å¦‚ä¸‹å‡ é¡¹ï¼š åŸŸåå¯¹äººç±»æ›´å‹å¥½ï¼Œå¯è¯»çš„å­—ç¬¦ä¸²æ¯”ä¸€ä¸² ip æ•°å­—å¯å¥½è®°å¤šäº†ã€‚ ä¸€ä¸ªåŸŸåå¯ä»¥å¯¹åº”å¤šä¸ª ipï¼Œå¯å®ç°æ‰€è°“çš„è´Ÿè½½å‡è¡¡ã€‚ å¤šä¸ªåŸŸåå¯ä»¥å¯¹åº”åŒä¸€ä¸ª ipï¼Œä»¥ä¸åŒçš„åŸŸåè®¿é—®è¯¥ ipï¼Œèƒ½è®¿é—®ä¸åŒçš„åº”ç”¨ã€‚ï¼ˆé€šè¿‡ nginx åšä»£ç†å®ç°ï¼‰ DNS åè®®æ˜¯ä¸€ä¸ªåŸºäº UDP çš„åº”ç”¨å±‚åè®®ï¼Œå®ƒé»˜è®¤ä½¿ç”¨ 53 ç«¯å£è¿›è¡Œé€šä¿¡ã€‚ åº”ç”¨ç¨‹åºé€šå¸¸å°† DNS è§£æå§”æ´¾ç»™æ“ä½œç³»ç»Ÿçš„ DNS Resolver æ¥æ‰§è¡Œï¼Œç¨‹åºå‘˜å¯¹å®ƒå‡ ä¹æ— æ„ŸçŸ¥ã€‚ DNS è™½ç„¶è¯´ä¸€èˆ¬åªç”¨æ¥æŸ¥ä¸ª ip åœ°å€ï¼Œä½†æ˜¯å®ƒæä¾›çš„è®°å½•ç±»å‹è¿˜è›®å¤šçš„ï¼Œä¸»è¦æœ‰å¦‚ä¸‹å‡ ç§ï¼š A è®°å½•ï¼šå®ƒè®°å½•åŸŸåä¸ IPv4 åœ°å€çš„å¯¹åº”å…³ç³»ã€‚ç›®å‰ç”¨çš„æœ€å¤šçš„ DNS è®°å½•å°±æ˜¯è¿™ä¸ªã€‚ AAAA è®°å½•ï¼šå®ƒå¯¹åº”çš„æ˜¯ IPv6ï¼Œå¯ä»¥ç†è§£æˆæ–°ä¸€ä»£çš„ A è®°å½•ã€‚ä»¥åä¼šç”¨çš„è¶Šæ¥è¶Šå¤šçš„ã€‚ NS è®°å½•ï¼šè®°å½• DNS åŸŸå¯¹åº”çš„æƒå¨æœåŠ¡å™¨åŸŸåï¼Œæƒå¨æœåŠ¡å™¨åŸŸåå¿…é¡»è¦æœ‰å¯¹åº”çš„ A è®°å½•ã€‚ é€šè¿‡è¿™ä¸ªè®°å½•ï¼Œå¯ä»¥å°†å­åŸŸåçš„è§£æåˆ†é…ç»™åˆ«çš„ DNS æœåŠ¡å™¨ã€‚ CNAME è®°å½•: è®°å½•åŸŸåä¸å¦ä¸€ä¸ªåŸŸåçš„å¯¹åº”å…³ç³»ï¼Œç”¨äºç»™åŸŸåèµ·åˆ«åã€‚è¿™ä¸ªç”¨å¾—ä¹ŸæŒºå¤šçš„ã€‚ MX è®°å½•ï¼šè®°å½•åŸŸåå¯¹åº”çš„é‚®ä»¶æœåŠ¡å™¨åŸŸåï¼Œé‚®ä»¶æœåŠ¡å™¨çš„åŸŸåå¿…é¡»è¦æœ‰å¯¹åº”çš„ A è®°å½•ã€‚ SRV è®°å½•ï¼šSRV è®°å½•ç”¨äºæä¾›æœåŠ¡å‘ç°ï¼Œçœ‹åå­—ä¹Ÿèƒ½çŸ¥é“å®ƒå’Œ SERVICE æœ‰å…³ã€‚ SRV è®°å½•çš„å†…å®¹æœ‰å›ºå®šæ ¼å¼ï¼šä¼˜å…ˆçº§ æƒé‡ ç«¯å£ ç›®æ ‡åœ°å€ï¼Œä¾‹å¦‚ 0 5 5060 sipserver.example.com ä¸»è¦ç”¨äºä¼ä¸šåŸŸæ§(AD)ã€å¾®æœåŠ¡å‘ç°ï¼ˆKubernetesï¼‰ ä¸Šè¿°çš„æ‰€æœ‰ DNS è®°å½•ï¼Œéƒ½æ˜¯å±äºå°†åŸŸåè§£æä¸º IP åœ°å€ï¼Œæˆ–è€…å¦ä¸€ä¸ªåŸŸåï¼Œè¿™è¢«ç§°åš** DNS æ­£å‘è§£æ**ã€‚ é™¤äº†è¿™ä¸ªæ­£å‘è§£æå¤–ï¼Œè¿˜æœ‰ä¸ªéå¸¸å†·é—¨çš„åå‘è§£æï¼ŒåŸºæœ¬ä¸Šåªåœ¨è®¾ç½®é‚®ä»¶æœåŠ¡å™¨æ—¶æ‰ä¼šç”¨åˆ°ã€‚ï¼ˆKubernetes å¯èƒ½ä¹Ÿæœ‰ç”¨åˆ°ï¼‰ åå‘è§£æä¸»è¦çš„è®°å½•ç±»å‹æ˜¯ï¼šPTR è®°å½•ï¼Œå®ƒæä¾›å°† IP åœ°å€åå‘è§£æä¸ºåŸŸåçš„åŠŸèƒ½ã€‚ è€Œä¸”å› ä¸ºåŸŸåæ˜¯ä»å³å¾€å·¦è¯»çš„ï¼ˆæœ€å³ä¾§æ˜¯æ ¹, www.baidu.com.ï¼‰ï¼Œè€Œ IP çš„ç½‘æ®µï¼ˆå¦‚ 192.168.0.0/16ï¼‰åˆšå¥½ç›¸åï¼Œæ˜¯å·¦è¾¹ä¼˜å…ˆã€‚ å› æ­¤ PTR è®°å½•çš„â€œåŸŸåâ€å¿…é¡»å°† IP åœ°å€åç€å†™ï¼Œæœ«å°¾å†åŠ ä¸Š .in-addr.arpa. è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªåå‘è§£æçš„åŸŸåã€‚ï¼ˆipv6 ä½¿ç”¨ ip6.arpa.ï¼‰ æ‹¿ baidu.com çš„é‚®ä»¶æœåŠ¡å™¨æµ‹è¯•ä¸€ä¸‹ï¼š PTR è®°å½•æŸ¥è¯¢\" PTR è®°å½•æŸ¥è¯¢ å…¶ä»–è¿˜æœ‰äº› TXTã€CAA ç­‰å¥‡å¥‡æ€ªæ€ªçš„è®°å½•ï¼Œå°±ç”¨åˆ°çš„æ—¶å€™è‡ªå·±å†æŸ¥äº†ã€‚ ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:2:0","tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/"},{"categories":["æŠ€æœ¯"],"content":"äºŒã€åŸŸåçš„åˆ†å±‚ç»“æ„ å›½é™…åŸŸåç³»ç»Ÿè¢«åˆ†æˆå››å±‚ï¼š æ ¹åŸŸï¼ˆRoot Zoneï¼‰ï¼šæ‰€æœ‰åŸŸåçš„æ ¹ã€‚ æ ¹åŸŸåæœåŠ¡å™¨è´Ÿè´£è§£æé¡¶çº§åŸŸåï¼Œç»™å‡ºé¡¶çº§åŸŸåçš„ DNS æœåŠ¡å™¨åœ°å€ã€‚ å…¨ä¸–ç•Œä»…æœ‰åä¸‰ç»„æ ¹åŸŸåæœåŠ¡å™¨ï¼Œè¿™äº›æœåŠ¡å™¨çš„ ip åœ°å€åŸºæœ¬ä¸ä¼šå˜åŠ¨ã€‚ å®ƒçš„åŸŸåæ˜¯ â€œ\"ï¼Œç©ºå­—ç¬¦ä¸²ã€‚è€Œå®ƒçš„**å…¨é™å®šåŸŸåï¼ˆFQDNï¼‰**æ˜¯ .ï¼Œå› ä¸º FQDN æ€»æ˜¯ä»¥ . ç»“å°¾ã€‚ï¼ˆFQDN åœ¨åé¢è§£é‡Šï¼Œå¯æš‚æ—¶å¿½ç•¥ï¼‰ é¡¶çº§åŸŸï¼ˆTop Level Domains, TLDï¼‰ï¼š.com .cn ç­‰å›½é™…ã€å›½å®¶çº§çš„åŸŸå é¡¶çº§åŸŸåæœåŠ¡å™¨è´Ÿè´£è§£ææ¬¡çº§åŸŸåï¼Œç»™å‡ºæ¬¡çº§åŸŸåçš„ DNS æœåŠ¡å™¨åœ°å€ã€‚ æ¯ä¸ªé¡¶çº§åŸŸåéƒ½å¯¹åº”å„è‡ªçš„æœåŠ¡å™¨ï¼Œå®ƒä»¬ä¹‹é—´æ˜¯å®Œå…¨ç‹¬ç«‹çš„ã€‚.cn çš„åŸŸåè§£æä»…ç”± .cn é¡¶çº§åŸŸåæœåŠ¡å™¨æä¾›ã€‚ ç›®å‰å›½é™… DNS ç³»ç»Ÿä¸­å·²æœ‰ä¸Šåƒä¸ª TLDï¼ŒåŒ…æ‹¬ä¸­æ–‡ã€Œ.æˆ‘çˆ±ä½ ã€ç”šè‡³è—æ–‡åŸŸåï¼Œè¯¦ç»†åˆ—è¡¨å‚è§ IANA TLD æ•°æ®åº“ é™¤äº†å›½é™…å¯ç”¨çš„ TLDï¼Œè¿˜æœ‰ä¸€ç±»ç±»ä¼¼ã€Œå†…ç½‘ IP åœ°å€ã€çš„â€œç§æœ‰ TLDâ€ï¼Œæœ€å¸¸è§çš„æ¯”å¦‚ xxx.local xxx.lanï¼Œè¢«å¹¿æ³›ç”¨åœ¨é›†ç¾¤é€šä¿¡ä¸­ã€‚åé¢è¯¦ç»†ä»‹ç» æ¬¡çº§åŸŸï¼ˆSecond Level Domainsï¼‰ï¼šè¿™ä¸ªæ‰æ˜¯ä¸ªäºº/ä¼ä¸šèƒ½å¤Ÿä¹°åˆ°çš„åŸŸåï¼Œæ¯”å¦‚ baidu.com æ¯ä¸ªæ¬¡çº§åŸŸåéƒ½æœ‰ä¸€åˆ°å¤šä¸ªæƒå¨ DNS æœåŠ¡å™¨ï¼Œè¿™äº› DNS æœåŠ¡å™¨ä¼šä»¥ NS è®°å½•çš„å½¢å¼ä¿å­˜åœ¨å¯¹åº”çš„é¡¶çº§åŸŸåï¼ˆTLDï¼‰æœåŠ¡å™¨ä¸­ã€‚ æƒå¨åŸŸåæœåŠ¡å™¨åˆ™è´Ÿè´£ç»™å‡ºæœ€ç»ˆçš„è§£æç»“æœï¼šip åœ°å€(A è®°å½• )ï¼Œå¦ä¸€ä¸ªåŸŸåï¼ˆCNAME è®°å½•ï¼‰ã€å¦ä¸€ä¸ª DNS æœåŠ¡å™¨ï¼ˆNS è®°å½•ï¼‰ç­‰ã€‚ å­åŸŸï¼ˆSub Domiansï¼‰ï¼š*.baidu.com ç»Ÿç»Ÿéƒ½æ˜¯ baidu.com çš„å­åŸŸã€‚ æ¯ä¸€ä¸ªå­åŸŸéƒ½å¯ä»¥æœ‰è‡ªå·±ç‹¬ç«‹çš„æƒå¨ DNS æœåŠ¡å™¨ï¼Œè¿™é€šè¿‡åœ¨å­åŸŸä¸­æ·»åŠ  NS è®°å½•å®ç°ã€‚ æ™®é€šç”¨æˆ·é€šå¸¸æ˜¯é€šè¿‡åŸŸåæä¾›å•†å¦‚é˜¿é‡Œäº‘è´­ä¹°çš„æ¬¡çº§åŸŸåï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä»¥ rea.ink ä¸ºä¾‹ä»‹ç»åŸŸåçš„è´­ä¹°åˆ°å¯ç”¨çš„æ•´ä¸ªæµç¨‹ã€‚ åŸŸåçš„è´­ä¹°ä¸ä½¿ç”¨æµç¨‹ï¼š ä½ åœ¨æŸåŸŸåæä¾›å•†å¤„è´­ä¹°äº†ä¸€ä¸ªåŸŸå rea.ink åŸŸåæä¾›å•†å‘ .ink å¯¹åº”çš„é¡¶çº§åŸŸåæœåŠ¡å™¨ä¸­æ’å…¥ä¸€æ¡ä»¥ä¸Šçš„ NS è®°å½•ï¼ŒæŒ‡å‘å®ƒè‡ªå·±çš„æ¬¡çº§ DNS æœåŠ¡å™¨ï¼Œå¦‚ dns25.hichina.com. é˜¿é‡Œäº‘ä¼šå‘ TLD ä¸­æ’å…¥å‡ æ¡ NS è®°å½•ï¼ŒæŒ‡å‘é˜¿é‡Œäº‘çš„æ¬¡çº§ DNS æœåŠ¡å™¨ï¼ˆå¦‚ vip1.alidns.comï¼‰ã€‚ ä½ åœ¨è¯¥åŸŸåæä¾›å•†çš„ DNS ç®¡ç†ç•Œé¢ä¸­æ·»åŠ  A è®°å½•ï¼Œå€¼ä¸ºä½ çš„æœåŠ¡å™¨ IPã€‚ OK ç°åœ¨ ping ä¸€ä¸‹ rea.inkï¼Œå°±ä¼šå‘ç°å®ƒå·²ç»è§£æåˆ°ä½ è‡ªå·±çš„æœåŠ¡å™¨äº†ã€‚ ä¸Šè¿°æµç¨‹ä¸­å¿½ç•¥äº†æˆ‘å¤§å¤©æœçš„ç‰¹æ®Šå›½æƒ…â€”â€”å¤‡æ¡ˆï¼Œå‹¿ä»‹æ„ã€‚ ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:3:0","tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/"},{"categories":["æŠ€æœ¯"],"content":"ä¸‰ã€DNS é€’å½’è§£æå™¨ï¼šåœ¨æµè§ˆå™¨ä¸­è¾“å…¥åŸŸååå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ ä¸‹é¢çš„å›¾ç‰‡æ‹·è´è‡ª Amazon Aws æ–‡æ¡£ï¼Œå®ƒå±•ç¤ºäº†åœ¨ä¸è€ƒè™‘ä»»ä½• DNS ç¼“å­˜çš„æƒ…å†µä¸‹ï¼Œä¸€æ¬¡ Web è¯·æ±‚çš„ç»è¿‡ï¼Œè¯¦ç»†æç»˜äº† DNS è§£æçš„éƒ¨åˆ†ã€‚ DNS è§£ææµç¨‹\" DNS è§£ææµç¨‹ å…¶ä¸­çš„ç¬¬ 3 4 5 æ­¥æŒ‰é¡ºåºå‘å‰é¢è®²è¿‡çš„æ ¹åŸŸåæœåŠ¡å™¨ã€é¡¶çº§åŸŸåæœåŠ¡å™¨ã€æƒå¨åŸŸåæœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œä»¥è·å¾—ä¸‹ä¸€ä¸ª DNS æœåŠ¡å™¨çš„ä¿¡æ¯ã€‚è¿™å¾ˆæ¸…æ™°ã€‚ å›¾ä¸­å½“å‰è¿˜æ²¡ä»‹ç»çš„éƒ¨åˆ†ï¼Œæ˜¯ç´«è‰²çš„ DNS Resolver(åŸŸåè§£æå™¨)ï¼Œä¹Ÿå« Recursive DNS resolverï¼ˆDNS é€’å½’è§£æå™¨ï¼‰ã€‚ å®ƒæœ¬èº«åªè´Ÿè´£é€’å½’åœ°è¯·æ±‚ 3 4 5 æ­¥ä¸­çš„ä¸Šæ¸¸æœåŠ¡å™¨ï¼Œç„¶åæŠŠè·å–çš„æœ€ç»ˆç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼ŒåŒæ—¶å°†è®°å½•ç¼“å­˜åˆ°æœ¬åœ°ä»¥åŠ å¿«è§£æé€Ÿåº¦ã€‚ è¿™ä¸ª DNS è§£æå™¨ï¼Œå…¶å®å°±æ˜¯æ‰€è°“çš„å…¬å…± DNS æœåŠ¡å™¨ï¼šGoogle çš„ 8.8.8.8ï¼Œå›½å†…è‘—åçš„ 114.114.114.114ã€‚ è¿™äº›å…¬å…± DNS ç”¨æˆ·é‡å¤§ï¼Œç¼“å­˜äº†å¤§é‡çš„ DNS è®°å½•ï¼Œæœ‰æ•ˆåœ°é™ä½äº†ä¸Šæ¸¸ DNS æœåŠ¡å™¨çš„å‹åŠ›ï¼Œä¹ŸåŠ å¿«äº†ç½‘ç»œä¸Šçš„ DNS æŸ¥è¯¢é€Ÿåº¦ã€‚ æ¥ä¸‹æ¥ä½¿ç”¨ dig +trace baidu.com å¤ç°ä¸€ä¸‹ä¸Šè¿°çš„æŸ¥è¯¢æµç¨‹ï¼ˆè¿™ç§æƒ…å†µä¸‹ dig è‡ªå·±å°±æ˜¯ä¸€ä¸ª DNS é€’å½’è§£æå™¨ï¼‰ï¼š dig +trace baidu.com\" dig +trace baidu.com å¦å¤–å‰é¢æœ‰è®²è¿‡ DNS çš„åå‘è§£æï¼Œä¹Ÿæ˜¯åŒæ ·çš„å±‚çº§ç»“æ„ï¼Œæ˜¯ä»æ ¹æœåŠ¡å™¨å¼€å§‹å¾€ä¸‹æŸ¥è¯¢çš„ï¼Œä¸‹é¢æ‹¿ baidu çš„ä¸€ä¸ªé‚®ä»¶æœåŠ¡å™¨è¿›è¡Œæµ‹è¯•ï¼š åå‘è§£æ\" åå‘è§£æ dig å·¥å…·æœªæ¥å¯èƒ½ä¼šè¢« drill å–ä»£ã€‚ ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:4:0","tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/"},{"categories":["æŠ€æœ¯"],"content":"DNS æ³›è§£æé€šé…ç¬¦ * DNS è®°å½•å…è®¸ä½¿ç”¨é€šé…ç¬¦ *ï¼Œå¹¶ä¸”è¯¥é€šé…ç¬¦å¯åŒ¹é…ä»»æ„çº§æ•°çš„å­åŸŸï¼ï¼ï¼æ¯”å¦‚ *.example.com å°±å¯ä»¥åŒ¹é…æ‰€æœ‰çš„ä¸€äºŒä¸‰å››çº§åŸŸåç­‰ç­‰ï¼Œä½†æ˜¯æ— æ³•åŒ¹é… example.com æœ¬èº«ï¼ ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:4:1","tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/"},{"categories":["æŠ€æœ¯"],"content":"TTLï¼ˆTime To Liveï¼‰ ä¸Šé¢è®²äº†å…¬å…± DNS æœåŠ¡å™¨é€šè¿‡ç¼“å­˜æŠ€æœ¯ï¼Œé™ä½äº†ä¸Šæ¸¸ DNS æœåŠ¡å™¨çš„å‹åŠ›ï¼Œä¹ŸåŠ å¿«äº†ç½‘ç»œä¸Šçš„ DNS æŸ¥è¯¢é€Ÿåº¦ã€‚ å¯ç¼“å­˜æ€»å¾—æœ‰ä¸ªè¿‡æœŸæ—¶é—´å§ï¼ä¸ºäº†ç²¾ç¡®åœ°æ§åˆ¶ DNS è®°å½•çš„è¿‡æœŸæ—¶é—´ï¼Œæ¯æ¡ DNS è®°å½•éƒ½è¦æ±‚è®¾ç½®ä¸€ä¸ªæ—¶é—´å±æ€§â€”â€”TTLï¼Œå•ä½ä¸ºç§’ã€‚è¿™ä¸ªæ—¶é—´å¯ä»¥è‡ªå®šä¹‰ã€‚ ä»»ä½•ä¸€æ¡ DNS ç¼“å­˜ï¼Œåœ¨è¶…è¿‡è¿‡æœŸæ—¶é—´åéƒ½å¿…é¡»ä¸¢å¼ƒï¼ å¦å¤–åœ¨æ²¡è¶…æ—¶çš„æ—¶å€™ï¼ŒDNS ç¼“å­˜ä¹Ÿå¯ä»¥è¢«ä¸»åŠ¨æˆ–è€…è¢«åŠ¨åœ°åˆ·æ–°ã€‚ ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:4:2","tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/"},{"categories":["æŠ€æœ¯"],"content":"å››ã€æœ¬åœ° DNS æœåŠ¡å™¨ä¸ç§æœ‰ DNS åŸŸ è¿™ç±»æœåŠ¡å™¨åªåœ¨å½“å‰å±€åŸŸç½‘å†…æœ‰æ•ˆï¼Œæ˜¯ä¸€ä¸ªç§æœ‰çš„ DNS æœåŠ¡å™¨ï¼Œä¼ä¸šå¸¸ç”¨ã€‚ä¸€èˆ¬é€šè¿‡ DHCP æˆ–è€…æ‰‹åŠ¨é…ç½®çš„æ–¹å¼ï¼Œä½¿å†…ç½‘çš„æœåŠ¡å™¨éƒ½é»˜è®¤ä½¿ç”¨å±€åŸŸç½‘ DNS æœåŠ¡å™¨è¿›è¡Œè§£æã€‚è¯¥æœåŠ¡å™¨å¯ä»¥åªè§£æè‡ªå·±çš„ç§æœ‰ DNS åŸŸï¼Œè€Œå°†å…¶ä»– DNS åŸŸçš„è§£æ forward åˆ°å…¬ç½‘ DNS è§£æå™¨å»ã€‚ è¿™ä¸ªç§æœ‰ DNS åŸŸï¼Œä¼šè¦†ç›–æ‰å…¬ç½‘çš„åŒååŸŸ(å¦‚æœå…¬ç½‘ä¸Šæœ‰è¿™ä¸ªåŸŸçš„è¯)ã€‚ ç§æœ‰ dns åŸŸä¹Ÿå¯ä½¿ç”¨å…¬ç½‘ä¸å­˜åœ¨çš„ TLDï¼Œæ¯”å¦‚ xxx.local xxx.lan ç­‰ã€‚vmware vcenter å°±é»˜è®¤ä½¿ç”¨ vsphere.local ä½œä¸ºå®ƒçš„ sso (å•ç‚¹ç™»å½•)ç³»ç»Ÿçš„åŸŸåã€‚kubernetes é»˜è®¤ä½¿ç”¨ svc.cluster.local ä½œä¸ºé›†ç¾¤å†…éƒ¨åŸŸåã€‚ ç§æœ‰ DNS åŸŸçš„é€‰æ‹©ï¼Œå‚è§ DNS ç§æœ‰åŸŸçš„é€‰æ‹©ï¼šinternal.xxx.com xxx.local è¿˜æ˜¯ xxx.zoneï¼Ÿ å±€åŸŸç½‘ DNS æœåŠ¡å™¨çš„è§„æ¨¡ä¸å±‚çº§ï¼Œè§†å±€åŸŸç½‘çš„å¤§å°è€Œå®šã€‚ä¸€èˆ¬å°å…¬å¸ä¸€ä¸ªå°±è¡Œï¼Œè¦å®¹ç¾è®¾ä¸‰ä¸ªå‰¯æœ¬ä¹Ÿå¤Ÿäº†ã€‚ ä»¥ CoreDNS ä¸ºä¾‹ï¼Œå±€åŸŸç½‘ DNS æœåŠ¡å™¨ä¹Ÿå¯ä»¥è¢«è®¾ç½®æˆä¸€ä¸ª DNS Resolverï¼Œå¯ä»¥è®¾ç½®åªè½¬å‘ç‰¹å®šåŸŸåçš„ DNS è§£æã€‚è¿™å«å°†æŸä¸ªåŸŸè®¾ä¸ºã€Œè½¬å‘åŒºåŸŸã€ã€‚ ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:5:0","tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/"},{"categories":["æŠ€æœ¯"],"content":"äº”ã€æ“ä½œç³»ç»Ÿçš„ DNS è§£æå™¨ åº”ç”¨ç¨‹åºå®é™…ä¸Šéƒ½æ˜¯è°ƒç”¨çš„æ“ä½œç³»ç»Ÿçš„ DNS Resolver è¿›è¡ŒåŸŸåè§£æçš„ã€‚åœ¨ Linux ä¸­ DNS Resolver ç”± glibc/musl æä¾›ï¼Œé…ç½®æ–‡ä»¶ä¸º /etc/resolv.confã€‚ æ¯”å¦‚ Python çš„ DNS è§£æï¼Œå°±æ¥è‡ªäºæ ‡å‡†åº“çš„ socket åŒ…ï¼Œè¿™ä¸ªåŒ…åªæ˜¯å¯¹åº•å±‚ c è¯­è¨€åº“çš„ä¸€ä¸ªç®€å•å°è£…ã€‚ åŸºæœ¬ä¸Šåªæœ‰ä¸“é—¨ç”¨äºç½‘ç»œè¯Šæ–­çš„ DNS å·¥å…·åŒ…ï¼Œæ‰ä¼šè‡ªå·±å®ç° DNS åè®®ã€‚ ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:6:0","tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/"},{"categories":["æŠ€æœ¯"],"content":"1. hosts æ–‡ä»¶ æ“ä½œç³»ç»Ÿä¸­è¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šæ–‡ä»¶ï¼šLinux ä¸­çš„ /etc/hosts å’Œ Windows ä¸­çš„ C:\\Windows\\System32\\drivers\\etc\\hosts ç³»ç»Ÿä¸­çš„ DNS resolver ä¼šé¦–å…ˆæŸ¥çœ‹è¿™ä¸ª hosts æ–‡ä»¶ä¸­æœ‰æ²¡æœ‰è¯¥åŸŸåçš„è®°å½•ï¼Œå¦‚æœæœ‰å°±ç›´æ¥è¿”å›äº†ã€‚æ²¡æ‰¾åˆ°æ‰ä¼šå»æŸ¥æ‰¾æœ¬åœ° DNS ç¼“å­˜ã€åˆ«çš„ DNS æœåŠ¡å™¨ã€‚ åªæœ‰éƒ¨åˆ†ä¸“é—¨ç”¨äºç½‘ç»œè¯Šæ–­çš„åº”ç”¨ç¨‹åºï¼ˆe.g. digï¼‰ä¸ä¼šä¾èµ– OS çš„ DNS è§£æå™¨ï¼Œå› æ­¤è¿™ä¸ª hosts ä¼šå¤±æ•ˆã€‚hosts å¯¹äºç»å¤§éƒ¨åˆ†ç¨‹åºéƒ½æœ‰æ•ˆã€‚ ç§»åŠ¨è®¾å¤‡ä¸Š hosts å¯èƒ½ä¼šå¤±æ•ˆï¼Œéƒ¨åˆ† app ä¼šç»•è¿‡ç³»ç»Ÿï¼Œä½¿ç”¨æ–°å…´çš„ HTTPDNS åè®®è¿›è¡Œ DNS è§£æã€‚ ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:6:1","tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/"},{"categories":["æŠ€æœ¯"],"content":"2. HTTPDNS ä¼ ç»Ÿçš„ DNS åè®®å› ä¸ºä½¿ç”¨äº†æ˜æ–‡çš„ UDP åè®®ï¼Œå¾ˆå®¹æ˜“è¢«åŠ«æŒã€‚é¡ºåº”ç§»åŠ¨äº’è”ç½‘çš„å…´èµ·ï¼Œç›®å‰ä¸€ç§æ–°å‹çš„ DNS åè®®â€”â€”HTTPDNS åº”ç”¨è¶Šæ¥è¶Šå¹¿æ³›ï¼Œå›½å†…çš„é˜¿é‡Œäº‘è…¾è®¯äº‘éƒ½æä¾›äº†è¿™é¡¹åŠŸèƒ½ã€‚ HTTPDNS é€šè¿‡ HTTP åè®®ç›´æ¥å‘æƒå¨ DNS æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œç»•è¿‡äº†ä¸€å †ä¸­é—´çš„ DNS é€’å½’è§£æå™¨ã€‚å¥½å¤„æœ‰äºŒï¼š æƒå¨ DNS æœåŠ¡å™¨èƒ½ç›´æ¥è·å–åˆ°å®¢æˆ·ç«¯çš„çœŸå® IPï¼ˆè€Œä¸æ˜¯æŸä¸ªä¸­é—´ DNS é€’å½’è§£æå™¨çš„ IPï¼‰ï¼Œèƒ½å®ç°å°±è¿‘è°ƒåº¦ã€‚ å› ä¸ºæ˜¯ç›´æ¥ä¸æƒå¨ DNS æœåŠ¡å™¨è¿æ¥ï¼Œé¿å…äº† DNS ç¼“å­˜æ±¡æŸ“çš„é—®é¢˜ã€‚ HTTPDNS åè®®éœ€è¦ç¨‹åºè‡ªå·±å¼•å…¥ SDKï¼Œæˆ–è€…ç›´æ¥è¯·æ±‚ HTTP APIã€‚ ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:6:2","tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/"},{"categories":["æŠ€æœ¯"],"content":"3. é»˜è®¤ DNS æœåŠ¡å™¨ æ“ä½œç³»ç»Ÿçš„ DNS è§£æå™¨é€šå¸¸ä¼šå…è®¸æˆ‘ä»¬é…ç½®å¤šä¸ªä¸Šæ¸¸ Name Serversï¼Œæ¯”å¦‚ Linux å°±æ˜¯é€šè¿‡ /etc/resolv.conf é…ç½® DNS æœåŠ¡å™¨çš„ã€‚ $ cat /etc/resolv.conf nameserver 8.8.8.8 nameserver 8.8.4.4 search lan ä¸è¿‡ç°åœ¨è¿™ä¸ªæ–‡ä»¶åŸºæœ¬ä¸ä¼šæ‰‹åŠ¨ä¿®æ”¹äº†ï¼Œå„ Linux å‘è¡Œç‰ˆéƒ½æ¨å‡ºäº†è‡ªå·±çš„ç½‘ç»œé…ç½®å·¥å…·ï¼Œç”±è¿™äº›å·¥å…·è‡ªåŠ¨ç”Ÿæˆ Linux çš„å„ç§ç½‘ç»œé…ç½®ï¼Œæ›´æ–¹ä¾¿ã€‚ æ¯”å¦‚ Ubuntu å°±æ¨èä½¿ç”¨ netplan å·¥å…·è¿›è¡Œç½‘ç»œè®¾ç½®ã€‚ Kubernetes å°±æ˜¯é€šè¿‡ä½¿ç”¨å®¹å™¨å·æ˜ å°„çš„åŠŸèƒ½ï¼Œä¿®æ”¹ /etc/resolv.confï¼Œä½¿é›†ç¾¤çš„æ‰€æœ‰å®¹å™¨éƒ½ä½¿ç”¨é›†ç¾¤ DNS æœåŠ¡å™¨ï¼ˆCoreDNSï¼‰è¿›è¡Œ DNS è§£æã€‚ é€šè¿‡é‡å¤ä½¿ç”¨ nameserver å­—æ®µï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ª DNS æœåŠ¡å™¨ï¼ˆLinux æœ€å¤šä¸‰ä¸ªï¼‰ã€‚DNS æŸ¥è¯¢ä¼šæŒ‰é…ç½®ä¸­çš„é¡ºåºé€‰ç”¨ DNS æœåŠ¡å™¨ã€‚ **ä»…åœ¨é å‰çš„ DNS æœåŠ¡å™¨æ²¡æœ‰å“åº”ï¼ˆtimeoutï¼‰æ—¶ï¼Œæ‰ä¼šä½¿ç”¨åç»­çš„ DNS æœåŠ¡å™¨ï¼æ‰€ä»¥æŒ‡å®šçš„æœåŠ¡å™¨ä¸­çš„ DNS è®°å½•æœ€å¥½å®Œå…¨ä¸€è‡´ï¼ï¼ï¼**ä¸è¦æŠŠç¬¬ä¸€ä¸ªé…å†…ç½‘ DNSï¼Œç¬¬äºŒä¸ªé…å¤–ç½‘ï¼ï¼ï¼ ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:6:3","tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/"},{"categories":["æŠ€æœ¯"],"content":"4. DNS æœç´¢åŸŸ ä¸Šä¸€å°èŠ‚ç»™å‡ºçš„ /etc/resolv.conf æ–‡ä»¶å†…å®¹çš„æœ«å°¾ï¼Œæœ‰è¿™æ ·ä¸€è¡Œ: search lanï¼Œå®ƒæŒ‡å®šçš„ï¼Œæ˜¯æ‰€è°“çš„ DNS æœç´¢åŸŸã€‚ è®²åˆ° DNS æœç´¢åŸŸï¼Œå°±ä¸å¾—ä¸æåˆ°ä¸€ä¸ªåè¯ï¼šå…¨é™å®šåŸŸåï¼ˆFull Qulified Domain Name, FQDNï¼‰ï¼Œå³ä¸€ä¸ªåŸŸåçš„å®Œæ•´åç§°ï¼Œwww.baidu.comã€‚ ä¸€ä¸ªæ™®é€šçš„åŸŸåï¼Œæœ‰ä¸‹åˆ—å››ç§å¯èƒ½ï¼š www.baidu.com.: æœ«å°¾çš„ . è¡¨ç¤ºæ ¹åŸŸï¼Œè¯´æ˜ www.baidu.com æ˜¯ä¸€ä¸ª FQDNï¼Œå› æ­¤ä¸ä¼šä½¿ç”¨æœç´¢åŸŸï¼ www.baidu.com: æœ«å°¾æ²¡ .ï¼Œä½†æ˜¯åŸŸååŒ…å«ä¸æ­¢ä¸€ä¸ª .ã€‚é¦–å…ˆå½“ä½œ FQDN è¿›è¡ŒæŸ¥è¯¢ï¼Œæ²¡æŸ¥æ‰¾å†æŒ‰é¡ºåºåœ¨å„æœç´¢åŸŸä¸­æŸ¥è¯¢ã€‚ /etc/resolv.conf çš„ options å‚æ•°ä¸­ï¼Œå¯ä»¥æŒ‡å®šåŸŸåä¸­åŒ…å« . çš„ä¸´ç•Œä¸ªæ•°ï¼Œé»˜è®¤æ˜¯ 1. local: ä¸åŒ…å« .ï¼Œè¢«å½“ä½œ host åç§°ï¼Œé FQDNã€‚é¦–å…ˆåœ¨ /etc/hosts ä¸­æŸ¥æ‰¾ï¼Œæ²¡æ‰¾åˆ°çš„è¯ï¼Œå†æŒ‰é¡ºåºåœ¨å„æœç´¢åŸŸä¸­æŸ¥æ‰¾ã€‚ ä¸Šè¿°æœç´¢é¡ºåºå¯ä»¥é€šè¿‡ host -v \u003cdomain-name\u003e è¿›è¡Œæµ‹è¯•ï¼Œè¯¥å‘½ä»¤ä¼šè¾“å‡ºå®ƒå°è¯•è¿‡çš„æ‰€æœ‰ FQDNã€‚ ä¿®æ”¹ /etc/resolv.conf ä¸­çš„ search å±æ€§å¹¶æµ‹è¯•ï¼Œç„¶åæŸ¥çœ‹è¾“å‡ºã€‚ å°±å¦‚ä¸Šé¢è¯´ä¾‹ä¸¾çš„ï¼Œåœ¨æ²¡æœ‰ DNS æœç´¢åŸŸ è¿™ä¸ªä¸œè¥¿çš„æ¡ä»¶ä¸‹ï¼Œæˆ‘ä»¬è®¿é—®ä»»ä½•åŸŸåï¼Œéƒ½å¿…é¡»è¾“å…¥ä¸€ä¸ªå…¨é™å®šåŸŸå FQDNã€‚ æœ‰äº†æœç´¢åŸŸæˆ‘ä»¬å°±å¯ä»¥ç¨å¾®å·ç‚¹æ‡’ï¼Œçœç•¥æ‰åŸŸåçš„ä¸€éƒ¨åˆ†åç¼€ï¼Œè®© DNS Resolver è‡ªå·±å»åœ¨å„æœç´¢åŸŸä¸­æœç´¢ã€‚ åœ¨ Kubernetes ä¸­å°±ä½¿ç”¨åˆ°äº†æœç´¢åŸŸï¼Œk8s ä¸­é»˜è®¤çš„åŸŸå FQDN æ˜¯ service.namespace.svc.cluster.localï¼Œ ä½†æ˜¯å¯¹äº default namespace ä¸­çš„ serviceï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡ service åç§°æŸ¥è¯¢åˆ°å®ƒçš„ IPã€‚ å¯¹äºå…¶ä»–åå­—ç©ºé—´ä¸­çš„ serviceï¼Œä¹Ÿå¯ä»¥é€šè¿‡ service.namespace æŸ¥è¯¢åˆ°å®ƒä»¬çš„ IPï¼Œä¸éœ€è¦ç»™å‡º FQDNã€‚ Kubernetes ä¸­ /etc/resolv.conf çš„ç¤ºä¾‹å¦‚ä¸‹ï¼š nameserver 10.43.0.10 search default.svc.cluster.local svc.cluster.local cluster.local options ndots:5 å¯ä»¥çœ‹åˆ° k8s è®¾ç½®äº†ä¸€ç³»åˆ—çš„æœç´¢åŸŸï¼Œå¹¶ä¸”å°† . çš„ä¸´ç•Œå€¼è®¾ä¸ºäº† 5ã€‚ ä¹Ÿå°±æ˜¯å°‘äº 5 ä¸ª dots çš„åŸŸåï¼Œéƒ½é¦–å…ˆå½“ä½œé FQDN çœ‹å¾…ï¼Œä¼˜å…ˆåœ¨æœç´¢åŸŸé‡Œé¢æŸ¥æ‰¾ã€‚ è¯¥é…ç½®æ–‡ä»¶çš„è¯¦ç»†æè¿°å‚è§ manpage - resolv.confï¼Œæˆ–è€…åœ¨ Linux ä¸­ä½¿ç”¨ man resolv.conf å‘½ä»¤æŸ¥çœ‹ã€‚ ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:6:4","tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/"},{"categories":["æŠ€æœ¯"],"content":"å…­ã€DNS è¯Šæ–­çš„å‘½ä»¤è¡Œå·¥å…· dig +trace baidu.com # è¯Šæ–­ dns çš„ä¸»è¦å·¥å…·ï¼Œéå¸¸å¼ºå¤§ host -a baidu.com # host åŸºæœ¬å°±æ˜¯ dig çš„å¼±åŒ–ç‰ˆï¼Œä¸è¿‡ host æœ‰ä¸ªæœ‰ç‚¹å°±æ˜¯èƒ½æ‰“å°å‡ºå®ƒæµ‹è¯•è¿‡çš„æ‰€æœ‰ FQDN nslookup baidu.com # å’Œ host æ²¡å•¥å¤§å·®åˆ«ï¼Œå¤šä¸ªäº¤äº’å¼æŸ¥è¯¢ä¸è¿‡ä¸€èˆ¬ç”¨ä¸åˆ° whois baidu.com # æŸ¥è¯¢åŸŸåæ³¨å†Œä¿¡æ¯ï¼Œå†…ç½‘è¯Šæ–­ç”¨ä¸åˆ° è¯¦ç»†çš„ä½¿ç”¨è¯· man dig ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:7:0","tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/"},{"categories":["æŠ€æœ¯"],"content":"ä¸ƒã€CoreDNS çš„ä½¿ç”¨ ä¸»æµçš„æœ¬åœ° DNS æœåŠ¡å™¨ä¸­ï¼Œæä¾› UI ç•Œé¢çš„æœ‰ Windows DNS Server å’Œç¾¤æ™– DNS Serverï¼Œå¾ˆæ–¹ä¾¿ï¼Œä¸è¿‡è¿™ä¸¤ä¸ªéƒ½æ˜¯æ“ä½œç³»ç»Ÿç»‘å®šçš„ã€‚ å¼€æºçš„ DNS æœåŠ¡å™¨é‡Œè¾¹å„¿ï¼ŒBIND å¥½åƒæ˜¯æœ€æœ‰åçš„ï¼Œå„å¤§ Linux å‘è¡Œç‰ˆè‡ªå¸¦çš„ dig/host/nslookupï¼Œæœ€åˆéƒ½æ˜¯ Bind æä¾›çš„å‘½ä»¤è¡Œå·¥å…·ã€‚ ä¸è¿‡ä¸ºäº†ä¸€ä¸¾ä¸¤å¾—ï¼ˆDNS+K8sï¼‰ï¼Œå’±è¿˜æ˜¯ç›´æ¥å­¦ä¹  CoreDNS çš„ä½¿ç”¨ã€‚ CoreDNS æœ€å¤§çš„ç‰¹ç‚¹æ˜¯çµæ´»ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°ç»™å®ƒç¼–å†™æ’ä»¶ä»¥æä¾›æ–°åŠŸèƒ½ã€‚åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œç›¸æ¯”ä¼ ç»Ÿ DNS æœåŠ¡å™¨ï¼Œå®ƒéå¸¸â€œç°ä»£åŒ–â€ã€‚åœ¨ K8s ä¸­å®ƒè¢«ç”¨äºæä¾›æœåŠ¡å‘ç°åŠŸèƒ½ã€‚ æ¥ä¸‹æ¥ä»¥ CoreDNS ä¸ºä¾‹ï¼Œè®²è¿°å¦‚ä½•é…ç½®ä¸€ä¸ª DNS æœåŠ¡å™¨ï¼Œæ·»åŠ ç§æœ‰çš„ DNS è®°å½•ï¼Œå¹¶è®¾ç½®è½¬å‘è§„åˆ™ä»¥è§£æå…¬ç½‘åŸŸåã€‚ ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:8:0","tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/"},{"categories":["æŠ€æœ¯"],"content":"1. é…ç½®æ–‡ä»¶ï¼šCorefile CoreDNS å› ä¸ºæ˜¯ Go è¯­è¨€å†™çš„ï¼Œç¼–è¯‘ç»“æœæ˜¯å•ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå®ƒé»˜è®¤ä»¥å½“å‰æ–‡ä»¶å¤¹ä¸‹çš„ Corefile ä¸ºé…ç½®æ–‡ä»¶ã€‚ä»¥ kubernetes ä¸­çš„ Corefile ä¸ºä¾‹ï¼š .:53 { errors # å¯ç”¨é”™è¯¯æ—¥å¿— health # å¯ç”¨å¥åº·æ£€æŸ¥ api ready # å¯ç”¨ readiness å°±ç»ª api # å¯ç”¨ kubernetes é›†ç¾¤æ”¯æŒï¼Œè¯¦è§ https://coredns.io/plugins/kubernetes/ # æ­¤æ’ä»¶åªå¤„ç† cluster.local åŸŸï¼Œä»¥åŠ PTR è§£æ kubernetes cluster.local in-addr.arpa ip6.arpa { pods insecure upstream # fallthrough in-addr.arpa ip6.arpa # å‘ä¸‹ä¼ é€’ DNS åå‘æŸ¥è¯¢ ttl 30 # è¿‡æœŸæ—¶é—´ } prometheus :9153 # å¯ç”¨ prometheus metrics æ”¯æŒ forward . 114.114.114.114 19.29.29.29 # å°†éé›†ç¾¤åŸŸåçš„ DNS è¯·æ±‚ï¼Œè½¬å‘ç»™å…¬ç½‘ DNS æœåŠ¡å™¨ã€‚ cache 30 # å¯ç”¨å‰ç«¯ç¼“å­˜ï¼Œç¼“å­˜çš„ TTL è®¾ä¸º 30 loop # æ£€æµ‹å¹¶åœæ­¢æ­»å¾ªç¯è§£æ reload # æ”¯æŒåŠ¨æ€æ›´æ–° Corefile # éšæœºåŒ– A/AAAA/MX è®°å½•çš„é¡ºåºä»¥å®ç°è´Ÿè½½å‡è¡¡ã€‚ # å› ä¸º DNS resolver é€šå¸¸ä½¿ç”¨ç¬¬ä¸€æ¡è®°å½•ï¼Œè€Œç¬¬ä¸€æ¡è®°å½•æ˜¯éšæœºçš„ã€‚è¿™æ ·å®¢æˆ·ç«¯çš„è¯·æ±‚å°±èƒ½è¢«éšæœºåˆ†é…åˆ°å¤šä¸ªåç«¯ã€‚ loadbalance } Corefile é¦–å…ˆå®šä¹‰ DNS åŸŸï¼ŒåŸŸåçš„ä»£ç å—å†…å®šä¹‰éœ€è¦ä½¿ç”¨çš„å„ç§æ’ä»¶ã€‚**æ³¨æ„è¿™é‡Œçš„æ’ä»¶é¡ºåºæ˜¯æ²¡æœ‰ä»»ä½•æ„ä¹‰çš„ï¼**æ’ä»¶çš„è°ƒç”¨é“¾æ˜¯åœ¨ CoreDNS ç¼–è¯‘æ—¶å°±å®šä¹‰å¥½çš„ï¼Œä¸èƒ½åœ¨è¿è¡Œæ—¶æ›´æ”¹ã€‚ é€šè¿‡ä¸Šè¿°é…ç½®å¯åŠ¨çš„ CoreDNS æ˜¯æ— çŠ¶æ€çš„ï¼Œå®ƒä»¥ Kubernetes ApiServer ä¸ºæ•°æ®æºï¼ŒCoreDNS æœ¬èº«åªç›¸å½“äºä¸€ä¸ªæŸ¥è¯¢å™¨/ç¼“å­˜ï¼Œå› æ­¤å®ƒå¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ‰©ç¼©å®¹ã€‚ ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:8:1","tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/"},{"categories":["æŠ€æœ¯"],"content":"2. å°† CoreDNS è®¾ç½®æˆä¸€ä¸ªç§æœ‰ DNS æœåŠ¡å™¨ ç°åœ¨æ¸…æ¥šäº† Corefile çš„ç»“æ„ï¼Œè®©æˆ‘ä»¬æ¥è®¾è®¡ä¸€ä¸ªé€šè¿‡æ–‡ä»¶é…ç½® DNS æ¡ç›®çš„ Corefile é…ç½®ï¼š # å®šä¹‰å¯å¤ç”¨ Block (common) { log errors cache loop # æ£€æµ‹å¹¶åœæ­¢æ­»å¾ªç¯è§£æ } # æœ¬åœ°å¼€å‘ç¯å¢ƒçš„ DNS è§£æ dev-env.local:53 { import common # å¯¼å…¥ Block file dev-env.local { # ä»æ–‡ä»¶ `dev-env.local` ä¸­è¯»å– DNS æ•°æ® reload 30s # æ¯ 30s æ£€æŸ¥ä¸€æ¬¡é…ç½®çš„ Serialï¼Œè‹¥è¯¥å€¼æœ‰å˜æ›´åˆ™é‡è½½æ•´ä¸ª Zone çš„é…ç½®ã€‚ } } # æœ¬åœ°æµ‹è¯•ç¯å¢ƒ test-env.local:53 { import common file test-env.local { reload 30s } } # å…¶ä»– .:53 { forward . 114.114.114.114 # è§£æå…¬ç½‘åŸŸå log errors cache } ä¸Šé¢çš„ Corefile å®šä¹‰äº†ä¸¤ä¸ªæœ¬åœ°åŸŸå dev-env.local å’Œ test-env.localï¼Œå®ƒä»¬çš„ DNS æ•°æ®åˆ†åˆ«ä¿å­˜åœ¨ file æŒ‡å®šçš„æ–‡ä»¶ä¸­ã€‚ è¿™ä¸ª file æŒ‡å®šçš„æ–‡ä»¶å’Œ bind9 ä¸€æ ·ï¼Œéƒ½æ˜¯ä½¿ç”¨åœ¨ rfc1035 ä¸­å®šä¹‰çš„ Master File æ ¼å¼ï¼Œdig å‘½ä»¤è¾“å‡ºçš„å°±æ˜¯è¿™ç§æ ¼å¼çš„å†…å®¹ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š ;; èˆ‡æ•´å€‹é ˜åŸŸç›¸é—œæ€§è¼ƒé«˜çš„è¨­å®šåŒ…æ‹¬ NS, A, MX, SOA ç­‰æ¨™èªŒçš„è¨­å®šè™•ï¼ $TTL 30 @ IN SOA dev-env.local. devops.dev-env.local. ( 20200202 ; SERIALï¼Œæ¯æ¬¡ä¿®æ”¹æ­¤æ–‡ä»¶ï¼Œéƒ½åº”è¯¥åŒæ­¥ä¿®æ”¹è¿™ä¸ªâ€œç‰ˆæœ¬å·â€ï¼Œå¯å°†å®ƒè®¾ä¸ºä¿®æ”¹æ—¶é—´ã€‚ 7200 ; REFRESH 600 ; RETRY 3600000 ; EXPIRE 60) ; MINIMUM @ IN NS dns1.dev-env.local. ; DNS ä¼ºæœå™¨åç¨± dns1.dev-env.local. IN A 192.168.23.2 ; DNS ä¼ºæœå™¨ IP redis.dev-env.local. IN A 192.168.23.21 mysql.dev-env.local. IN A 192.168.23.22 elasticsearch.dev-env.local. IN A 192.168.23.23 ftp IN A 192.168.23.25 ; é€™æ˜¯ç°¡åŒ–çš„å¯«æ³•ï¼ è¯¦ç»†çš„æ ¼å¼è¯´æ˜å‚è§ é³¥å“¥çš„ Linux ç§æˆ¿èœ - DNS æ­£è§£è³‡æ–™åº«æª”æ¡ˆçš„è¨­å®š test-env.local ä¹Ÿæ˜¯ä¸€æ ·çš„æ ¼å¼ï¼Œæ ¹æ®ä¸Šé¢çš„æ¨¡æ¿ä¿®æ”¹å°±è¡Œã€‚è¿™ä¸¤ä¸ªé…ç½®æ–‡ä»¶å’Œ Corefile æ”¾åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹ï¼š root@test-ubuntu:~/dns-server# tree . â”œâ”€â”€ coredns # coredns binary â”œâ”€â”€ Corefile â”œâ”€â”€ dev-env.local â””â”€â”€ test-env.local ç„¶åé€šè¿‡ ./coredns å¯åŠ¨ corednsã€‚é€šè¿‡ dig æ£€éªŒï¼š DNS æµ‹è¯•\" DNS æµ‹è¯• å¯ä»¥çœ‹åˆ° ftp.dev-env.local å·²ç»è¢«æˆåŠŸè§£æäº†ã€‚ ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:8:2","tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/"},{"categories":["æŠ€æœ¯"],"content":"3. å¯é€‰æ’ä»¶ï¼ˆExternal Pluginsï¼‰ CoreDNS æä¾›çš„é¢„ç¼–è¯‘ç‰ˆæœ¬ï¼Œä¸åŒ…å« External Plugins ä¸­åˆ—å‡ºçš„éƒ¨åˆ†ï¼Œå¦‚æœä½ éœ€è¦ï¼Œå¯ä»¥è‡ªè¡Œä¿®æ”¹ plugin.cfgï¼Œç„¶åæ‰‹åŠ¨ç¼–è¯‘ã€‚ ä¸å¾—ä¸è¯´ Go è¯­è¨€çš„ç¼–è¯‘ï¼Œæ¯” C è¯­è¨€æ˜¯æ–¹ä¾¿å¤ªå¤šäº†ã€‚è‡ªåŠ¨æ‹‰å–ä¾èµ–ï¼Œä¸€è¡Œå‘½ä»¤ç¼–è¯‘ï¼åªè¦é…å¥½ GOPROXYï¼Œå¯ç”¨å¯é€‰æ’ä»¶å…¶å®ç›¸å½“ç®€å•ã€‚ ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:8:3","tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/"},{"categories":["æŠ€æœ¯"],"content":"4. è®¾ç½® DNS é›†ç¾¤ å•å° DNS æœåŠ¡å™¨çš„æ€§èƒ½æ˜¯æœ‰é™çš„ï¼Œè€Œä¸”å­˜åœ¨å•ç‚¹æ•…éšœé—®é¢˜ã€‚å› æ­¤åœ¨è¦æ±‚é«˜å¯ç”¨æˆ–è€…é«˜æ€§èƒ½çš„æƒ…å†µä¸‹ï¼Œå°±éœ€è¦è®¾ç½® DNS é›†ç¾¤ã€‚ è™½ç„¶è¯´ CoreDNS æœ¬èº«ä¹Ÿæ”¯æŒå„ç§ DNS Zone ä¼ è¾“ï¼Œä¸»ä» DNS æœåŠ¡å™¨ç­‰åŠŸèƒ½ï¼Œä¸è¿‡æˆ‘æƒ³æœ€ç®€å•çš„ï¼Œå¯èƒ½è¿˜æ˜¯ç›´æ¥ç”¨ K8sã€‚ ç›´æ¥ç”¨ ConfigMap å­˜é…ç½®ï¼Œé€šè¿‡ Deployment æ‰©å®¹å°±è¡Œï¼Œå¤šæ–¹ä¾¿ã€‚ è¦ä¿®æ”¹èµ·æ¥æ›´æ–¹ä¾¿ï¼Œè¿˜å¯ä»¥å¯ç”¨å¯é€‰æ’ä»¶ï¼šredisï¼Œç›´æ¥æŠŠé…ç½®ä»¥ json çš„å½¢å¼å­˜åœ¨ redis é‡Œï¼Œé€šè¿‡ redis-desktop-manager è¿›è¡ŒæŸ¥çœ‹ä¸ä¿®æ”¹ã€‚ ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:8:4","tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/"},{"categories":["æŠ€æœ¯"],"content":"å‚è€ƒ DNS åŸç†å…¥é—¨ What Is DNS? | How DNS Works - Cloudflare What is DNS? - Amazon AWS é¸Ÿå“¥çš„ Linux ç§æˆ¿èœâ€”â€”ä¸»æ©Ÿåç¨±æ§åˆ¶è€…ï¼š DNS ä¼ºæœå™¨ CoreDNS - Manual Kubernetes - DNS for Services and Pods Kubernetes - Customizing DNS Service ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:9:0","tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/"},{"categories":["æŠ€æœ¯"],"content":"ç­¾åç®—æ³• ä»‹ç»å…·ä½“çš„ JWT ç­¾åç®—æ³•å‰ï¼Œå…ˆè§£é‡Šä¸€ä¸‹ç­¾åã€æ‘˜è¦/æŒ‡çº¹ã€åŠ å¯†è¿™å‡ ä¸ªåè¯çš„å«ä¹‰ï¼š æ•°å­—ç­¾å(Digital Signature):å°±å’Œæˆ‘ä»¬æ—¥å¸¸åŠç†å„ç§æ‰‹ç»­æ—¶éœ€è¦åœ¨æ–‡ä»¶ä¸Šç­¾ä¸Šè‡ªå·±çš„åå­—ä¸€æ ·ï¼Œæ•°å­—ç­¾åçš„ä¸»è¦ç”¨é€”ä¹Ÿæ˜¯é˜²æ­¢ä¼ªé€ ç­¾åã€‚ æ•°å­—æ‘˜è¦(digest)/æ•°å­—æŒ‡çº¹(fingerprint): æŒ‡çš„éƒ½æ˜¯æ•°æ®çš„ Hash å€¼ã€‚ åŠ å¯†ç®—æ³•ï¼šè¿™ä¸ªåº”è¯¥ä¸éœ€è¦è§£é‡Šï¼Œå°±æ˜¯å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ã€‚ã€‚ æ•°å­—ç­¾åçš„å…·ä½“å®ç°ï¼Œé€šå¸¸æ˜¯å…ˆå¯¹æ•°æ®è¿›è¡Œä¸€æ¬¡ Hash æ‘˜è¦(SHA1/SHA256/SHA512 ç­‰)ï¼Œç„¶åå†ä½¿ç”¨éå¯¹ç§°åŠ å¯†ç®—æ³•(RSA/ECDSA ç­‰)çš„ç§é’¥å¯¹è¿™ä¸ªæ‘˜è¦è¿›è¡ŒåŠ å¯†ï¼Œè¿™æ ·å¾—åˆ°çš„ç»“æœå°±æ˜¯åŸå§‹æ•°æ®çš„ä¸€ä¸ªç­¾åã€‚ ç”¨æˆ·åœ¨éªŒè¯æ•°æ®æ—¶ï¼Œåªéœ€è¦ä½¿ç”¨å…¬é’¥è§£å¯†å‡º Hash æ‘˜è¦ï¼Œç„¶åè‡ªå·±å†å¯¹æ•°æ®è¿›è¡Œä¸€æ¬¡åŒæ ·çš„æ‘˜è¦ï¼Œå¯¹æ¯”ä¸¤ä¸ªæ‘˜è¦æ˜¯å¦ç›¸åŒå³å¯ã€‚ æ³¨æ„ï¼šç­¾åç®—æ³•æ˜¯ä½¿ç”¨ç§é’¥åŠ å¯†ï¼Œç¡®ä¿å¾—åˆ°çš„ç­¾åæ— æ³•è¢«ä¼ªé€ ï¼ŒåŒæ—¶æ‰€æœ‰äººéƒ½å¯ä»¥ä½¿ç”¨å…¬é’¥è§£å¯†æ¥éªŒè¯ç­¾åã€‚è¿™å’Œæ­£å¸¸çš„æ•°æ®åŠ å¯†ç®—æ³•æ˜¯ç›¸åçš„ã€‚ å› ä¸ºæ•°å­—ç­¾åå¤šäº†éå¯¹ç§°åŠ å¯†è¿™ä¸€æ­¥ï¼Œå°±èƒ½ä¿è¯åªæœ‰æ‹¥æœ‰ç§é’¥çš„äººæ‰èƒ½ç”Ÿæˆå‡ºæ­£ç¡®çš„æ•°å­—ç­¾åï¼Œè¾¾åˆ°äº†é˜²æ­¢ä¼ªé€ ç­¾åçš„ç›®çš„ã€‚ è€Œæ•°å­—æ‘˜è¦ï¼ˆHashï¼‰åˆ™è°éƒ½å¯ä»¥è®¡ç®—å‡ºæ¥ï¼Œé€šå¸¸ç”±å¯ä¿¡æ–¹å…¬å¸ƒæ•°æ®çš„ Hash å€¼ï¼Œç”¨æˆ·ä¸‹è½½æ•°æ®åï¼Œå¯é€šè¿‡ Hash å€¼å¯¹æ¯”æ¥åˆ¤æ–­æ•°æ®æ˜¯å¦æŸåï¼Œæˆ–è€…è¢«äººè°ƒåŒ…ã€‚ é‡ç‚¹åœ¨äºï¼ŒHash æ‘˜è¦å¿…é¡»ç”±å¯ä¿¡æ–¹å…¬å¸ƒå‡ºæ¥ï¼Œå¦åˆ™ä¸èƒ½ä¿è¯å®‰å…¨æ€§ã€‚è€Œæ•°å­—ç­¾åå¯ä»¥éšæ•°æ®ä¸€èµ·æä¾›ï¼Œä¸éœ€è¦æ‹…å¿ƒè¢«ä¼ªé€ ã€‚ JWT æ˜¯ç­¾åå’Œæ•°æ®ä¸€èµ·æä¾›çš„ï¼Œå› æ­¤å¿…é¡»ä½¿ç”¨ç­¾åæ‰èƒ½ä¿è¯å®‰å…¨æ€§ã€‚ P.S. åœ¨ Android/IOS å¼€å‘ä¸­ï¼Œç»å¸¸ä¼šé‡åˆ°å„ç±» API æˆ–è€… APP å•†åº—è¦æ±‚æä¾› APP çš„ç­¾åï¼Œè¿˜æŒ‡æ˜éœ€è¦çš„æ˜¯ MD5/SHA1 å€¼ã€‚ è¿™ä¸ªåœ°æ–¹éœ€è¦å¡«çš„ MD5/SHA1 å€¼ï¼Œå®é™…ä¸Šåªæ˜¯ä½ ã€Œç­¾åè¯ä¹¦(=å…¬é’¥+è¯ä¹¦æ‹¥æœ‰è€…ä¿¡æ¯)ã€çš„ã€Œæ•°å­—æŒ‡çº¹/æ‘˜è¦ã€ï¼Œå’Œ JWT çš„ç­¾åä¸æ˜¯ä¸€å›äº‹ã€‚ å‰è¨€ JWT è§„èŒƒçš„è¯¦ç»†è¯´æ˜è¯·è§ã€Œå‚è€ƒã€éƒ¨åˆ†çš„é“¾æ¥ã€‚è¿™é‡Œä¸»è¦è¯´æ˜ä¸€ä¸‹ JWT æœ€å¸¸è§çš„å‡ ç§ç­¾åç®—æ³•(JWA)ï¼šHS256(HMAC-SHA256) ã€RS256(RSA-SHA256) è¿˜æœ‰ ES256(ECDSA-SHA256)ã€‚ è¿™ä¸‰ç§ç®—æ³•éƒ½æ˜¯ä¸€ç§æ¶ˆæ¯ç­¾åç®—æ³•ï¼Œå¾—åˆ°çš„éƒ½åªæ˜¯ä¸€æ®µæ— æ³•è¿˜åŸçš„ç­¾åã€‚åŒºåˆ«åœ¨äºæ¶ˆæ¯ç­¾åä¸ç­¾åéªŒè¯éœ€è¦çš„ ã€Œkeyã€ä¸åŒã€‚ HS256 ä½¿ç”¨åŒä¸€ä¸ªã€Œsecret_keyã€è¿›è¡Œç­¾åä¸éªŒè¯ï¼ˆå¯¹ç§°åŠ å¯†ï¼‰ã€‚ä¸€æ—¦ secret_key æ³„æ¼ï¼Œå°±æ¯«æ— å®‰å…¨æ€§å¯è¨€äº†ã€‚ å› æ­¤ HS256 åªé€‚åˆé›†ä¸­å¼è®¤è¯ï¼Œç­¾åå’ŒéªŒè¯éƒ½å¿…é¡»ç”±å¯ä¿¡æ–¹è¿›è¡Œã€‚ ä¼ ç»Ÿçš„å•ä½“åº”ç”¨å¹¿æ³›ä½¿ç”¨è¿™ç§ç®—æ³•ï¼Œä½†æ˜¯è¯·ä¸è¦åœ¨ä»»ä½•åˆ†å¸ƒå¼çš„æ¶æ„ä¸­ä½¿ç”¨å®ƒï¼ RS256 æ˜¯ä½¿ç”¨ RSA ç§é’¥è¿›è¡Œç­¾åï¼Œä½¿ç”¨ RSA å…¬é’¥è¿›è¡ŒéªŒè¯ã€‚å…¬é’¥å³ä½¿æ³„æ¼ä¹Ÿæ¯«æ— å½±å“ï¼Œåªè¦ç¡®ä¿ç§é’¥å®‰å…¨å°±è¡Œã€‚ RS256 å¯ä»¥å°†éªŒè¯å§”æ‰˜ç»™å…¶ä»–åº”ç”¨ï¼Œåªè¦å°†å…¬é’¥ç»™ä»–ä»¬å°±è¡Œã€‚ ES256 å’Œ RS256 ä¸€æ ·ï¼Œéƒ½ä½¿ç”¨ç§é’¥ç­¾åï¼Œå…¬é’¥éªŒè¯ã€‚ç®—æ³•é€Ÿåº¦ä¸Šå·®è·ä¹Ÿä¸å¤§ï¼Œä½†æ˜¯å®ƒçš„ç­¾åé•¿åº¦ç›¸å¯¹çŸ­å¾ˆå¤šï¼ˆçœæµé‡ï¼‰ï¼Œå¹¶ä¸”ç®—æ³•å¼ºåº¦å’Œ RS256 å·®ä¸å¤šã€‚ å¯¹äºå•ä½“åº”ç”¨è€Œè¨€ï¼ŒHS256 å’Œ RS256 çš„å®‰å…¨æ€§æ²¡æœ‰å¤šå¤§å·®åˆ«ã€‚ è€Œå¯¹äºéœ€è¦è¿›è¡Œå¤šæ–¹éªŒè¯çš„å¾®æœåŠ¡æ¶æ„è€Œè¨€ï¼Œæ˜¾ç„¶åªæœ‰ RS256/ES256 æ‰èƒ½æä¾›è¶³å¤Ÿçš„å®‰å…¨æ€§ã€‚ åœ¨ä½¿ç”¨ RS256 æ—¶ï¼Œåªæœ‰ã€Œèº«ä»½è®¤è¯çš„å¾®æœåŠ¡(auth)ã€éœ€è¦ç”¨ RSA ç§é’¥ç”Ÿæˆ JWTï¼Œå…¶ä»–å¾®æœåŠ¡ä½¿ç”¨å…¬å¼€çš„å…¬é’¥å³å¯è¿›è¡Œç­¾åéªŒè¯ï¼Œç§é’¥å¾—åˆ°äº†æ›´å¥½çš„ä¿æŠ¤ã€‚ æ›´è¿›ä¸€æ­¥ï¼Œã€ŒJWT ç”Ÿæˆã€å’Œã€ŒJWT å…¬é’¥åˆ†å‘ã€éƒ½å¯ä»¥ç›´æ¥å§”æ‰˜ç»™ç¬¬ä¸‰æ–¹çš„é€šç”¨å·¥å…·ï¼Œæ¯”å¦‚ hydraã€‚ ç”šè‡³ã€ŒJWT éªŒè¯ã€ä¹Ÿå¯ä»¥å§”æ‰˜ç»™ã€ŒAPI ç½‘å…³ã€æ¥å¤„ç†ï¼Œåº”ç”¨è‡ªèº«å¯ä»¥æŠŠè®¤è¯é‰´æƒå®Œå…¨å§”æ‰˜ç»™å¤–éƒ¨çš„å¹³å°ï¼Œè€Œåº”ç”¨è‡ªèº«åªéœ€è¦ä¸“æ³¨äºä¸šåŠ¡ã€‚è¿™ä¹Ÿæ˜¯ç›®å‰çš„å‘å±•è¶‹åŠ¿ã€‚ RFC 7518 - JSON Web Algorithms (JWA) ä¸­ç»™å‡ºçš„ JWT ç®—æ³•åˆ—è¡¨å¦‚ä¸‹ï¼š +--------------+-------------------------------+--------------------+ | \"alg\" Param | Digital Signature or MAC | Implementation | | Value | Algorithm | Requirements | +--------------+-------------------------------+--------------------+ | HS256 | HMAC using SHA-256 | Required | | HS384 | HMAC using SHA-384 | Optional | | HS512 | HMAC using SHA-512 | Optional | | RS256 | RSASSA-PKCS1-v1_5 using | Recommended | | | SHA-256 | | | RS384 | RSASSA-PKCS1-v1_5 using | Optional | | | SHA-384 | | | RS512 | RSASSA-PKCS1-v1_5 using | Optional | | | SHA-512 | | | ES256 | ECDSA using P-256 and SHA-256 | Recommended+ | | ES384 | ECDSA using P-384 and SHA-384 | Optional | | ES512 | ECDSA using P-521 and SHA-512 | Optional | | PS256 | RSASSA-PSS using SHA-256 and | Optional | | | MGF1 with SHA-256 | | | PS384 | RSASSA-PSS using SHA-384 and | Optional | | | MGF1 with SHA-384 | | | PS512 | RSASSA-PSS using SHA-512 and | Optional | | | MGF1 with SHA-512 | | | none | No digital signature or MAC | Optional | | | performed | | +--------------+-------------------------------+--------------------+ The use of \"+\" in the Implementation Requirements column indicates that the requirement strength is likely to be increased in a future version of the specification. ç›®å‰åº”è¯¥æ‰€æœ‰ jwt ç›¸å…³çš„åº“éƒ½æ”¯æŒ HS256/RS256/ES256 è¿™ä¸‰ç§ç®—æ³•ã€‚ ES256 ä½¿ç”¨ ECDSA è¿›è¡Œç­¾åï¼Œå®ƒçš„å®‰å…¨æ€§å’Œè¿ç®—é€Ÿåº¦ç›®å‰å’Œ RS256 å·®è·ä¸å¤§ï¼Œä½†æ˜¯æ‹¥æœ‰æ›´çŸ­çš„ç­¾åé•¿åº¦ã€‚ å¯¹äºéœ€è¦é¢‘ç¹å‘é€çš„ JWT è€Œè¨€ï¼Œæ›´çŸ­çš„é•¿åº¦é•¿æœŸä¸‹æ¥å¯ä»¥èŠ‚çº¦å¤§é‡æµé‡ã€‚ å› æ­¤æ›´æ¨èä½¿ç”¨ ES256 ç®—æ³•ã€‚ ","date":"2020-03-03","objectID":"/posts/jwt-algorithm-key-generation/:0:0","tags":["JWT","ç®—æ³•","OpenSSL"],"title":"JWT ç­¾åç®—æ³• HS256ã€RS256 åŠ ES256 åŠå¯†é’¥ç”Ÿæˆ","uri":"/posts/jwt-algorithm-key-generation/"},{"categories":["æŠ€æœ¯"],"content":"ä½¿ç”¨ OpenSSL ç”Ÿæˆ RSA/ECC å…¬ç§é’¥ RS256 ä½¿ç”¨ RSA ç®—æ³•è¿›è¡Œç­¾åï¼Œå¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤ç”Ÿæˆ RSA å¯†é’¥ï¼š # 1. ç”Ÿæˆ 2048 ä½ï¼ˆä¸æ˜¯ 256 ä½ï¼‰çš„ RSA å¯†é’¥ openssl genrsa -out rsa-private-key.pem 2048 # 2. é€šè¿‡å¯†é’¥ç”Ÿæˆå…¬é’¥ openssl rsa -in rsa-private-key.pem -pubout -out rsa-public-key.pem ES256 ä½¿ç”¨ ECDSA ç®—æ³•è¿›è¡Œç­¾åï¼Œè¯¥ç®—æ³•ä½¿ç”¨ ECC å¯†é’¥ï¼Œç”Ÿæˆå‘½ä»¤å¦‚ä¸‹ï¼š # 1. ç”Ÿæˆ ec ç®—æ³•çš„ç§é’¥ï¼Œä½¿ç”¨ prime256v1 ç®—æ³•ï¼Œå¯†é’¥é•¿åº¦ 256 ä½ã€‚ï¼ˆå¼ºåº¦å¤§äº 2048 ä½çš„ RSA å¯†é’¥ï¼‰ openssl ecparam -genkey -name prime256v1 -out ecc-private-key.pem # 2. é€šè¿‡å¯†é’¥ç”Ÿæˆå…¬é’¥ openssl ec -in ecc-private-key.pem -pubout -out ecc-public-key.pem å¯†é’¥çš„ä½¿ç”¨åº”è¯¥å°±ä¸éœ€è¦ä»‹ç»äº†ï¼Œå„ç±»è¯­è¨€éƒ½æœ‰å¯¹åº” JWT åº“å¤„ç†è¿™äº›ï¼Œè¯·è‡ªè¡ŒæŸ¥çœ‹æ–‡æ¡£ã€‚ å¦‚æœæ˜¯è°ƒè¯•/å­¦ä¹  JWTï¼Œéœ€è¦æ‰‹åŠ¨ç­¾åä¸éªŒè¯çš„è¯ï¼Œæ¨èä½¿ç”¨ jwt å·¥å…·ç½‘ç«™ - jwt.io ","date":"2020-03-03","objectID":"/posts/jwt-algorithm-key-generation/:1:0","tags":["JWT","ç®—æ³•","OpenSSL"],"title":"JWT ç­¾åç®—æ³• HS256ã€RS256 åŠ ES256 åŠå¯†é’¥ç”Ÿæˆ","uri":"/posts/jwt-algorithm-key-generation/"},{"categories":["æŠ€æœ¯"],"content":"å‚è€ƒ RFC 7518 - JSON Web Algorithms (JWA) ä»€ä¹ˆæ˜¯ JWT â€“ JSON WEB TOKEN jwt å·¥å…·ç½‘ç«™ - jwt.io JWT ç®—æ³•æ¯”è¾ƒ ","date":"2020-03-03","objectID":"/posts/jwt-algorithm-key-generation/:2:0","tags":["JWT","ç®—æ³•","OpenSSL"],"title":"JWT ç­¾åç®—æ³• HS256ã€RS256 åŠ ES256 åŠå¯†é’¥ç”Ÿæˆ","uri":"/posts/jwt-algorithm-key-generation/"},{"categories":["éšç¬”","æŠ€æœ¯"],"content":" è¿Ÿåˆ°çš„å¹´ç»ˆæ€»ç»“ ","date":"2020-01-31","objectID":"/posts/2019-summary/:0:0","tags":["æ€»ç»“"],"title":"2019 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2019-summary/"},{"categories":["éšç¬”","æŠ€æœ¯"],"content":"é—²è¨€ç¢è¯­ æˆ‘æ˜¯ä»Šå¹´å…­æœˆåº•åˆ°çš„æ·±åœ³ï¼Œè¿æ°”å¾ˆå¥½ï¼Œç¬¬ä¸€é¢å°±é¢ä¸Šäº†ç°åœ¨æ‰€åœ¨çš„å…¬å¸ï¼Œä»¥ä¸‹å°±å«å®ƒ W å…¬å¸å§ã€‚ å…¬å¸çš„æŠ€æœ¯æ ˆä¹Ÿå¾ˆé€‚åˆæˆ‘ï¼Œåœ¨å…¥èŒåˆ°ç°åœ¨çš„è¿™åŠå¹´é‡Œï¼Œæˆ‘å­¦åˆ°äº†ä¸å°‘çŸ¥è¯†ã€‚ ä½†æ˜¯è¿æ°”ä¹Ÿå·®ï¼Œåªæœ‰è¿™ä¹ˆä¸€å®¶å…¬å¸çº¦äº†æˆ‘é¢è¯•ï¼ŒæŠ•çš„å…¶ä»–ç®€å†éƒ½çŸ³æ²‰å¤§æµ·â€¦ æ€»ä¹‹ï¼Œä»Šå¹´å°è¯•å‚åŠ è¿‡ä¸¤æ¬¡æŠ€æœ¯åˆ†äº«ï¼ŒRancher çš„æŠ€æœ¯æ²™é¾™ï¼Œå‰å‡ å¤©åˆå»å¬äº† OSChina çš„æºåˆ›ä¼šã€‚ ","date":"2020-01-31","objectID":"/posts/2019-summary/:1:0","tags":["æ€»ç»“"],"title":"2019 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2019-summary/"},{"categories":["éšç¬”","æŠ€æœ¯"],"content":"æŠ€æœ¯èƒ½åŠ›æ€»ç»“ æˆ‘å…¥èŒååšçš„æ˜¯è¿ç»´å¼€å‘ï¼Œä¸»è¦è´Ÿè´£é€šè¿‡ Jenkins Pipeline + Python è¿›è¡Œè‡ªåŠ¨åŒ–çš„æµ‹è¯•ã€æ„å»ºå’Œéƒ¨ç½²ï¼š æµ‹è¯•ï¼šæŒ‡ UI æµ‹è¯•ã€API æµ‹è¯•ã€å‹åŠ›æµ‹è¯•ã€‚å•å…ƒæµ‹è¯•ç®—åœ¨æ„å»ºæµç¨‹ä¸­ã€‚ æ„å»ºï¼šæ›´æ–°ä¾èµ–-\u003eå•å…ƒæµ‹è¯•-\u003eæ„å»º Library æˆ–é•œåƒ å…¬å¸çš„å†…éƒ¨ä»£ç ä½¿ç”¨åˆ†å±‚ç»“æ„ï¼Œåº•å±‚å°è£…äº†å„ç§ç¬¬ä¸‰æ–¹åŒ…ï¼Œå¹¶å®ç°äº†ä¸€äº›é€šç”¨çš„åŠŸèƒ½ï¼Œå½¢æˆäº†æ‰€è°“çš„ä¸­å°ã€‚ç›®å‰æ˜¯é€šè¿‡æ‰¹é‡ä»»åŠ¡é€çº§è‡ªä¸‹å‘ä¸Šæ„å»ºã€‚ éƒ¨ç½²ï¼šæ‰«æé•œåƒä»“åº“ä¸­å„é•œåƒï¼Œç”Ÿæˆæœ€æ–°çš„ k8s éƒ¨ç½²æ–‡ä»¶ï¼Œç„¶åè¿›è¡Œéƒ¨ç½²ã€‚ æ‰€ä»¥è¿™åŠå¹´ä¸­ï¼Œæˆ‘å·®ä¸å¤šç†Ÿæ‚‰äº†è‡ªåŠ¨åŒ–è¿ç»´çš„å·¥ä½œã€‚ä¸»è¦åŒ…æ‹¬ Jenkins Pipeline çš„ç¼–å†™ï¼Œæˆ‘ä»¬åŸºæœ¬éƒ½æ˜¯ä½¿ç”¨ Jenkins è°ƒç”¨ Python ä»£ç æ¥è¿›è¡Œå…·ä½“çš„æ„å»ºã€‚ å…¬å¸çš„æ„å»ºæœ‰å¾ˆå¤šè‡ªå·±ç‰¹æ®Šçš„éœ€æ±‚ï¼ŒJenkins è‡ªå¸¦çš„æ’ä»¶æ— æ³•æ»¡è¶³ã€‚ ç†Ÿæ‚‰äº† Python çš„ subprocess åº“ï¼Œä¸ºäº†è¿œç¨‹è°ƒç”¨ï¼Œåˆç†Ÿæ‚‰äº† fabricï¼ˆå½“ä½œ library ç”¨ï¼‰ã€‚ åšå‹æµ‹æ—¶ï¼Œç†Ÿæ‚‰äº† locust å› ä¸ºåŸºæœ¬éƒ½æ˜¯é€šè¿‡å‘½ä»¤è¡Œè¿›è¡Œæµ‹è¯•ã€æ„å»ºï¼Œæˆ‘ç°åœ¨æ¯”å‰åç«¯ç»„è¿˜ç†Ÿæ‚‰ csharp/flutter/golang çš„ cliâ€¦ å­¦ä¼šäº† Dockerfile è¯­æ³•ã€‚æˆ‘ä»¬çš„åç«¯å…¨éƒ¨éƒ½æ˜¯ä»¥å®¹å™¨æ–¹å¼éƒ¨ç½²çš„ï¼Œè¿™ä¸ªæ˜¯åŸºæœ¬æŠ€èƒ½ã€‚ ç†Ÿæ‚‰å¹¶ä¸”ç”¨ä¸Šäº† Kubernetes. è¿™ä¸œè¥¿åŸºæœ¬ä¸Šå°±æ˜¯æœªæ¥äº†ï¼Œä¹Ÿå°†æ˜¯æˆ‘çš„ä¸»æ”»æ–¹å‘ã€‚ ä½†æ˜¯ï¼Œä¹Ÿå­˜åœ¨ä¸€äº›é—®é¢˜ï¼š å¯¹ Linux/ç½‘ç»œ/vSphere ä¸å¤Ÿäº†è§£ï¼Œå¯¼è‡´æ¯æ¬¡å¤„ç†è¿™ç±»é—®é¢˜åªä¼šæ’é™¤æ³•ã€‚ å¯¹ç›‘æ§/æ—¥å¿—/å‘Šè­¦ä¸å¤Ÿäº†è§£ï¼Œç›‘æ§é¢æ¿ä¸€å †å‚æ•°å´çœ‹ä¸å‡ºé—®é¢˜ï¼Œæ—¥å¿—ä¸çŸ¥é“æ€ä¹ˆç”¨ kibana è¿›è¡Œæœç´¢ï¼Œå‘Šè­¦è¿˜æ²¡é…è¿‡ã€‚ã€‚ è§£å†³é—®é¢˜çš„èƒ½åŠ›è¿˜æœ‰å¾…æå‡ï¼Œè€ƒè™‘æ€»æ˜¯ä¸å¤Ÿå…¨é¢ï¼Œè€æ˜¯å‡ºé—®é¢˜ã€‚ï¼ˆä¸èƒ½è®©äººæ”¾å¿ƒï¼‰ æ€»æ˜¯æƒ³å¾—å¤ªå¤šï¼Œæ‹–æ…¢äº†è§£å†³é—®é¢˜çš„é€Ÿåº¦ã€‚ï¼ˆè¿™å€’ä¹Ÿä¸èƒ½å®Œå…¨ç®—æ˜¯ç¼ºç‚¹ã€‚ï¼‰ ","date":"2020-01-31","objectID":"/posts/2019-summary/:2:0","tags":["æ€»ç»“"],"title":"2019 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2019-summary/"},{"categories":["éšç¬”","æŠ€æœ¯"],"content":"ä»Šå¹´åœ¨æŠ€æœ¯ä¸Šçš„æ„Ÿå— Kubernetes å’Œäº‘åŸç”Ÿæ­£åœ¨å¸­å·æ•´ä¸ªäº’è”ç½‘/ç‰©è”ç½‘è¡Œä¸šã€‚ Kubernetes ç›®å‰ä¸»è¦ç”¨äº Stateless åº”ç”¨ï¼Œé‚£åç«¯çš„ æ•°æ®åº“/ç¼“å­˜/æ¶ˆæ¯æœåŠ¡ è¦å¦‚ä½•åšåˆ†å¸ƒå¼å‘¢ï¼Ÿè¿™ä¹Ÿæ˜¯å¤§å®¶å…³æ³¨çš„é‡ç‚¹ã€‚ åˆ†å¸ƒå¼ã€å¾®æœåŠ¡æ¨¡å¼ä¸‹çš„ç›‘æ§(prometheus)ã€æ—¥å¿—åˆ†æ(elk)ã€å®‰å…¨ã€é“¾è·¯è¿½è¸ª(jaeger)ï¼Œæ˜¯è¿ç»´å…³æ³¨çš„é‡ç‚¹ã€‚ æœåŠ¡ç½‘æ ¼æ­£åœ¨èµ°å‘æˆç†Ÿï¼ŒIstio å¾ˆå€¼å¾—å­¦ä¹ å’Œè¯•ç”¨ã€‚ å¼€æºçš„åˆ†å¸ƒå¼æ•°æ®åº“/äº‘æ•°æ®åº“æˆä¸ºè¶Šæ¥è¶Šå¤šä¼ä¸šçš„é€‰æ‹©ï¼Œå¼€æºçš„ TiDBï¼ˆHTAPï¼‰å’Œé˜¿é‡Œäº‘çš„ PolarDBï¼ˆè®¡ç®—å­˜å‚¨åˆ†ç¦»ï¼‰éƒ½åº”è¯¥äº†è§£äº†è§£ã€‚ Transaction Processing: é¢å‘äº¤æ˜“ï¼Œæ•°æ®çš„å˜åŠ¨(å¢åˆ æ”¹)å¤šï¼Œæ¶‰åŠçš„æ•°æ®é‡å’Œè®¡ç®—é‡(æŸ¥)å°‘ï¼Œå®æ—¶æ€§è¦æ±‚é«˜ã€‚ Analytical Processingï¼šé¢å‘åˆ†æï¼Œæ•°æ®çš„å˜åŠ¨å°‘ï¼Œä½†æ¶‰åŠçš„æ•°æ®é‡å’Œè®¡ç®—é‡å¾ˆå¤šï¼ HTAPï¼ˆHybrid transaction/analytical processingï¼‰ï¼šæ··åˆå‹æ•°æ®åº“ï¼Œå¯åŒæ—¶è¢«ç”¨äºä¸Šè¿°ä¸¤ç§åœºæ™¯ã€‚ Knative/Jenkins-X è¿™ç±» Serverless çš„ CI/CD ä¹Ÿæ­£åœ¨å¿«é€Ÿå‘å±•ï¼Œéœ€è¦æ·±å…¥è°ƒç ”ã€‚ ","date":"2020-01-31","objectID":"/posts/2019-summary/:3:0","tags":["æ€»ç»“"],"title":"2019 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2019-summary/"},{"categories":["éšç¬”","æŠ€æœ¯"],"content":"æ˜å¹´çš„å±•æœ› ä½œä¸ºä¸€åèŒæ–°è¿ç»´å¼€å‘ï¼Œæ˜å¹´æ˜¾ç„¶è¿˜è¦ç»§ç»­åœ¨è¿™æ¡è·¯ä¸Šç»§ç»­å‘å‰ã€‚ æˆ‘æ˜å¹´çš„ä»»åŠ¡ï¼Œç¬¬ä¸€ä»¶ï¼Œå°±æ˜¯ä¼˜åŒ–æ‰éƒ¨åˆ†è‡ªå·±ç›®å‰å­˜åœ¨çš„é—®é¢˜ï¼ˆå‰é¢æœ‰æåˆ°ï¼‰ï¼Œç¬¬äºŒå‘¢ï¼Œå°±æ˜¯ç´§è·ŸæŠ€æœ¯æ½®æµã€‚é‡ç‚¹æœ‰ä¸‹é¢å‡ é¡¹ï¼š å……å®è‡ªå·±ç½‘ç»œéƒ¨åˆ†æ¬ ç¼ºçš„çŸ¥è¯†ï¼Œå°¤å…¶æ˜¯ DNS è§£æ(CoreDNS)å’Œ NAT(iptables)è¿™ä¿©ç©æ„å„¿ã€‚ å­¦ä¹ æ•°æ®åº“ç»„ä»¶çš„ä½¿ç”¨å’Œæ€§èƒ½è°ƒä¼˜ï¼šMySQL/Redis/ElasticSearch/MongoDBï¼Œå¦å¤–ç†Ÿæ‚‰ PostgreSQL å’Œåˆ†å¸ƒå¼æ•°æ®åº“ TiDB/Vitess Kubernetes/Istio Kubernetes ä¸Šçš„ CI/CDï¼šKnative, Istio-GitOps ç›‘æ§å‘Šè­¦ï¼šPrometheus/Grafana æ€»ç»“ä¸€å¥—æ•…éšœæ’é™¤çš„æ–¹æ³•è®ºï¼šç½‘ç»œæ•…éšœã€CPU/RAM/Disk æ€§èƒ½å¼‚å¸¸ç­‰ã€åº”ç”¨æ•…éšœç­‰ã€‚ æœ€é‡è¦çš„ä»»åŠ¡ï¼Œæ˜¯ç»´æŠ¤å…¬å¸è¿™ä¸€å¥—å¾®æœåŠ¡åœ¨é˜¿é‡Œäº‘ä¸Šçš„æ­£å¸¸è¿è¡Œï¼Œç§¯ç´¯ç»éªŒã€‚ å…³æ³¨ CNCF è“å›¾ ä¸Šçš„å„é¡¹æ–°æŠ€æœ¯ã€‚ å¦å¤–å‘¢ï¼Œå°±æ˜¯å¼€å‘æ–¹é¢çš„ä»»åŠ¡ï¼š è®¾è®¡æ¨¡å¼åº”è¯¥è¦å­¦å­¦äº†ï¼ Python ä¸èƒ½æ­¢æ­¥äºæ­¤ï¼Œè¦åˆ¶å®šæºç å­¦ä¹ è®¡åˆ’ã€‚ å­¦ä¹  C# è¯­è¨€ï¼Œé˜…è¯»å…¬å¸çš„æºç ï¼Œç†Ÿæ‚‰ä¼ä¸šçº§çš„ä¸šåŠ¡ä»£ç ã€‚ å­¦ä¹  go è¯­è¨€ï¼Œç”¨äº DevOpsã€‚ï¼ˆå…¶å®è¿˜æƒ³å­¦ rustï¼Œä¸è¿‡æ˜å¹´å¯èƒ½æ²¡æ—¶é—´ï¼‰ è¦æŠŠ xhup é‚£ä¸ªé¡¹ç›®å®Œæˆï¼Œä¹Ÿä¸çŸ¥é“èƒ½ä¸èƒ½æŠ½å‡ºæ—¶é—´ã€‚ã€‚ ","date":"2020-01-31","objectID":"/posts/2019-summary/:4:0","tags":["æ€»ç»“"],"title":"2019 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2019-summary/"},{"categories":["æŠ€æœ¯"],"content":"Pod å¸¸è§é”™è¯¯ OOMKilled: Pod çš„å†…å­˜ä½¿ç”¨è¶…å‡ºäº† resources.limits ä¸­çš„é™åˆ¶ï¼Œè¢«å¼ºåˆ¶æ€æ­»ã€‚ SandboxChanged: Pod sandbox changed, it will be killed and re-created: å¾ˆå¯èƒ½æ˜¯ç”±äºå†…å­˜é™åˆ¶å¯¼è‡´å®¹å™¨è¢« OOMKilledï¼Œæˆ–è€…å…¶ä»–èµ„æºä¸è¶³ å¦‚æœæ˜¯ OOMï¼Œå®¹å™¨é€šå¸¸ä¼šè¢«é‡å¯ï¼Œkubectl describe èƒ½çœ‹åˆ°å®¹å™¨ä¸Šæ¬¡è¢«é‡å¯çš„åŸå›  State.Last State.Reason = OOMKilled, Exit Code=137. Pod ä¸æ–­è¢«é‡å¯ï¼Œkubectl describe æ˜¾ç¤ºé‡å¯åŸå›  State.Last State.Reason = Error, Exit Code=137ï¼Œ137 å¯¹åº” SIGKILL(kill -9) ä¿¡å·ï¼Œè¯´æ˜å®¹å™¨è¢«å¼ºåˆ¶é‡å¯ã€‚å¯èƒ½çš„åŸå› ï¼š æœ€æœ‰å¯èƒ½çš„åŸå› æ˜¯ï¼Œå­˜æ´»æ¢é’ˆï¼ˆlivenessProbeï¼‰æ£€æŸ¥å¤±è´¥ èŠ‚ç‚¹èµ„æºä¸è¶³ï¼Œå†…æ ¸å¼ºåˆ¶å…³é—­äº†è¿›ç¨‹ä»¥é‡Šæ”¾èµ„æºï¼Œè¿™ç§æƒ…å†µå¯ä»¥é€šè¿‡ journalctl -k æŸ¥çœ‹è¯¦ç»†çš„ç³»ç»Ÿæ—¥å¿—ã€‚ CrashLoopBackoff: Pod è¿›å…¥ å´©æºƒ-é‡å¯å¾ªç¯ï¼Œé‡å¯é—´éš”æ—¶é—´ä» 10 20 40 80 ä¸€ç›´ç¿»å€åˆ°ä¸Šé™ 300 ç§’ï¼Œç„¶åä»¥ 300 ç§’ä¸ºé—´éš”æ— é™é‡å¯ã€‚ Pod ä¸€ç›´ Pending: è¿™è¯´æ˜æ²¡æœ‰ä»»ä½•èŠ‚ç‚¹èƒ½æ»¡è¶³ Pod çš„è¦æ±‚ï¼Œå®¹å™¨æ— æ³•è¢«è°ƒåº¦ã€‚æ¯”å¦‚ç«¯å£è¢«åˆ«çš„å®¹å™¨ç”¨ hostPort å ç”¨ï¼ŒèŠ‚ç‚¹æœ‰æ±¡ç‚¹ç­‰ã€‚ FailedCreateSandBox: Failed create pod sandbox: rpc error: code = DeadlineExceeded desc = context deadline exceededï¼šå¾ˆå¯èƒ½æ˜¯ CNI ç½‘ç»œæ’ä»¶çš„é—®é¢˜ï¼ˆæ¯”å¦‚ ip åœ°å€æº¢å‡ºï¼‰ï¼Œ FailedSync: error determining status: rpc error: code = DeadlineExceeded desc = context deadline exceeded: å¸¸å’Œå‰ä¸¤ä¸ªé”™è¯¯å…ˆåå‡ºç°ï¼Œå¾ˆå¯èƒ½æ˜¯ CNI ç½‘ç»œæ’ä»¶çš„é—®é¢˜ã€‚ å¼€å‘é›†ç¾¤ï¼Œä¸€æ¬¡æ€§éƒ¨ç½²æ‰€æœ‰æœåŠ¡æ—¶ï¼Œå„ Pod äº’ç›¸äº‰æŠ¢èµ„æºï¼Œå¯¼è‡´ Pod ç”Ÿå­˜æ¢é’ˆå¤±è´¥ï¼Œä¸æ–­é‡å¯ï¼Œé‡å¯è¿›ä¸€æ­¥åŠ é‡èµ„æºä½¿ç”¨ã€‚æ¶æ€§å¾ªç¯ã€‚ éœ€è¦ç»™æ¯ä¸ª Pod åŠ ä¸Š resources.requestsï¼Œè¿™æ ·èµ„æºä¸è¶³æ—¶ï¼Œåç»­ Pod ä¼šåœæ­¢è°ƒåº¦ï¼Œç›´åˆ°èµ„æºæ¢å¤æ­£å¸¸ã€‚ Pod å‡ºç°å¤§é‡çš„ Failed è®°å½•ï¼ŒDeployment ä¸€ç›´é‡å¤å»ºç«‹ Pod: é€šè¿‡ kubectl describe/edit pod \u003cpod-name\u003e æŸ¥çœ‹ pod Events å’Œ Statusï¼Œä¸€èˆ¬ä¼šçœ‹åˆ°å¤±è´¥ä¿¡æ¯ï¼Œå¦‚èŠ‚ç‚¹å¼‚å¸¸å¯¼è‡´ Pod è¢«é©±é€ã€‚ Kubernetes é—®é¢˜æ’æŸ¥ï¼šPod çŠ¶æ€ä¸€ç›´ Terminating åˆ›å»ºäº† Deployment åï¼Œå´æ²¡æœ‰è‡ªåŠ¨åˆ›å»º Pod: ç¼ºå°‘æŸäº›åˆ›å»º Pod å¿…è¦çš„ä¸œè¥¿ï¼Œæ¯”å¦‚è®¾å®šçš„ ServiceAccount ä¸å­˜åœ¨ã€‚ Pod è¿è¡Œå¤±è´¥ï¼ŒçŠ¶æ€ä¸º MatchNodeSelector: å¯¹ä¸»èŠ‚ç‚¹è¿›è¡Œå…³æœºã€è¿ç§»ç­‰æ“ä½œï¼Œå¯¼è‡´ä¸»è°ƒåº¦å™¨ä¸‹çº¿æ—¶ï¼Œä¼šåœ¨ä¸€æ®µæ—¶é—´å†…å¯¼è‡´ Pod è°ƒåº¦å¤±è´¥ï¼Œè°ƒåº¦å¤±è´¥ä¼šæŠ¥è¿™ä¸ªé”™ã€‚ Pod ä»ç„¶å­˜åœ¨ï¼Œä½†æ˜¯ Service çš„ Endpoints å´ä¸ºç©ºï¼Œæ‰¾ä¸åˆ°å¯¹åº”çš„ Pod IPs: é‡åˆ°è¿‡ä¸€æ¬¡ï¼Œæ˜¯å› ä¸ºæ—¶é—´è·³å˜ï¼ˆä»æœªæ¥çš„æ—¶é—´æ”¹å›äº†å½“å‰æ—¶é—´ï¼‰å¯¼è‡´çš„é—®é¢˜ã€‚ ","date":"2019-11-24","objectID":"/posts/kubernetes-common-errors-and-solutions/:1:0","tags":["Kubernetes"],"title":"Kubernetes å¸¸è§é”™è¯¯ã€åŸå› åŠå¤„ç†æ–¹æ³•","uri":"/posts/kubernetes-common-errors-and-solutions/"},{"categories":["æŠ€æœ¯"],"content":"æ§åˆ¶é¢æ•…éšœå¯èƒ½ä¼šå¯¼è‡´å„ç±»å¥‡æ€ªçš„å¼‚å¸¸ç°è±¡ å¯¹äºç”Ÿäº§ç¯å¢ƒçš„é›†ç¾¤ï¼Œå› ä¸ºæœ‰é«˜å¯ç”¨ï¼Œé€šå¸¸æˆ‘ä»¬æ¯”è¾ƒå°‘é‡åˆ°æ§åˆ¶é¢æ•…éšœé—®é¢˜ã€‚ä½†æ˜¯ä¸€æ—¦æ§åˆ¶é¢å‘ç”Ÿæ•…éšœï¼Œå°±å¯èƒ½ä¼šå¯¼è‡´å„ç±»å¥‡æ€ªçš„å¼‚å¸¸ç°è±¡ã€‚ å¦‚æœèƒ½åœ¨æ’æŸ¥é—®é¢˜æ—¶ï¼ŒæŠŠæ§åˆ¶é¢å¼‚å¸¸è€ƒè™‘è¿›æ¥ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°±èƒ½èŠ‚çº¦å¤§é‡çš„æ’æŸ¥æ—¶é—´ï¼Œå¿«é€Ÿå®šä½åˆ°é—®é¢˜ã€‚ å…¶ä¸­æ¯”è¾ƒéšæ™¦çš„å°±æ˜¯ controller-manager æ•…éšœå¯¼è‡´çš„å¼‚å¸¸ï¼š èŠ‚ç‚¹çš„æœåŠ¡å™¨å·²ç»è¢«ç»ˆæ­¢ï¼Œä½†æ˜¯ Kuberntes é‡Œè¿˜æ˜¾ç¤º node ä¸º Ready çŠ¶æ€ï¼Œä¸ä¼šæ›´æ–°ä¸º NotReady. è¢«åˆ é™¤çš„ Pods å¯èƒ½ä¼šå¡åœ¨ Terminating çŠ¶æ€ï¼Œåªæœ‰å¼ºåˆ¶åˆ é™¤æ‰èƒ½åˆ é™¤æ‰å®ƒä»¬ã€‚å¹¶ä¸”ç¡®è®¤ Pod æ²¡æœ‰ metadata.finalizers å±æ€§ HPA çš„åŠ¨æ€ä¼¸ç¼©åŠŸèƒ½å¤±æ•ˆ â€¦ å¦‚æœè¿™äº›ç°è±¡åŒæ—¶å‘ç”Ÿï¼Œå°±è¦æ€€ç–‘æ˜¯å¦æ˜¯ kube-controller-manager å‡ºé—®é¢˜äº†. å…¶ä»–æ§åˆ¶é¢å¼‚å¸¸çš„è¯¦ç»†åˆ†æï¼Œå‚è§ kubernetes æ§åˆ¶é¢æ•…éšœç°è±¡åŠåˆ†æ ","date":"2019-11-24","objectID":"/posts/kubernetes-common-errors-and-solutions/:1:1","tags":["Kubernetes"],"title":"Kubernetes å¸¸è§é”™è¯¯ã€åŸå› åŠå¤„ç†æ–¹æ³•","uri":"/posts/kubernetes-common-errors-and-solutions/"},{"categories":["æŠ€æœ¯"],"content":"Pod æ— æ³•åˆ é™¤ å¯èƒ½æ˜¯æŸäº›èµ„æºæ— æ³•è¢«GCï¼Œè¿™ä¼šå¯¼è‡´å®¹å™¨å·²ç» Exited äº†ï¼Œä½†æ˜¯ Pod ä¸€ç›´å¤„äº Terminating çŠ¶æ€ã€‚ è¿™ä¸ªé—®é¢˜åœ¨ç½‘ä¸Šèƒ½æœåˆ°å¾ˆå¤šæ¡ˆä¾‹,ä½†å¤§éƒ½åªæ˜¯æä¾›äº†å¦‚ä¸‹çš„å¼ºåˆ¶æ¸…ç†å‘½ä»¤ï¼Œæœªåˆ†æå…·ä½“åŸå› ï¼š kubectl delete pods \u003cpod\u003e --grace-period=0 --force æœ€è¿‘æ‰¾åˆ°å‡ ç¯‡è¯¦ç»†çš„åŸå› åˆ†ææ–‡ç« ï¼Œå€¼å¾—ä¸€çœ‹ï¼š è…¾è®¯äº‘åŸç”Ÿ -ã€Pod TerminatingåŸå› è¿½è¸ªç³»åˆ—ã€‘ä¹‹ containerd ä¸­è¢«æ¼æ‰çš„ runc é”™è¯¯ä¿¡æ¯ è…¾è®¯äº‘åŸç”Ÿ -ã€Pod TerminatingåŸå› è¿½è¸ªç³»åˆ—ä¹‹äºŒã€‘execè¿æ¥æœªå…³é—­å¯¼è‡´çš„äº‹ä»¶é˜»å¡ è…¾è®¯äº‘åŸç”Ÿ -ã€Pod TerminatingåŸå› è¿½è¸ªç³»åˆ—ä¹‹ä¸‰ã€‘è®©dockeräº‹ä»¶å¤„ç†ç½¢å·¥çš„cancelçŠ¶æ€ç  Pod terminating - é—®é¢˜æ’æŸ¥ - KaKu Li å¤§è‡´æ€»ç»“ä¸€ä¸‹ï¼Œä¸»è¦åŸå› æ¥è‡ª docker 18.06 ä»¥åŠ kubernetes çš„ docker-shim è¿è¡Œæ—¶çš„åº•å±‚é€»è¾‘ï¼Œå·²ç»åœ¨æ–°ç‰ˆæœ¬è¢«ä¿®å¤äº†ã€‚ ","date":"2019-11-24","objectID":"/posts/kubernetes-common-errors-and-solutions/:1:2","tags":["Kubernetes"],"title":"Kubernetes å¸¸è§é”™è¯¯ã€åŸå› åŠå¤„ç†æ–¹æ³•","uri":"/posts/kubernetes-common-errors-and-solutions/"},{"categories":["æŠ€æœ¯"],"content":"initContainers ä¸æ–­ restartï¼Œä½†æ˜¯ Containers å´éƒ½æ˜¾ç¤ºå·² ready Kubernetes åº”è¯¥ç¡®ä¿æ‰€æœ‰ initContainers éƒ½ Completedï¼Œç„¶åæ‰èƒ½å¯åŠ¨ Containers. ä½†æ˜¯æˆ‘ä»¬å‘ç°æœ‰ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œæ‰€æœ‰åŒ…å« initContainers çš„ Podï¼ŒçŠ¶æ€å…¨éƒ½æ˜¯ Init:CrashLoopBackOff æˆ–è€… Init:Error. è€Œä¸”è¿›ä¸€æ­¥ kubectl describe po æŸ¥çœ‹ç»†èŠ‚ï¼Œå‘ç° initContainer çš„çŠ¶æ€ä¸º: ... State: Waiting Reason: CrashLoopBackOff Last State: Terminated Reason: Error Exit Code: 2 Started: Tue, 03 Aug 2021 06:02:42 +0000 Finished: Tue, 03 Aug 2021 06:02:42 +0000 Ready: False Restart Count: 67 ... è€Œ Containers çš„çŠ¶æ€å±…ç„¶æ˜¯ ready: ... Host Port: 0/TCP State: Running Started: Tue, 03 Aug 2021 00:35:30 +0000 Ready: True Restart Count: 0 ... initContainers è¿˜æœªè¿è¡ŒæˆåŠŸï¼Œè€Œ Containers å´ Ready äº†ï¼Œéå¸¸ç–‘æƒ‘ã€‚ ä»”ç»†æƒ³äº†ä¸‹ï¼Œæ—©ä¸Šå› ä¸ºç£ç›˜ä½™é‡å‘Šè­¦ï¼Œæœ‰æ‰‹åŠ¨è¿è¡Œè¿‡ docker system prune å‘½ä»¤ï¼Œé‚£ä¹ˆé—®é¢˜å¯èƒ½å°±æ˜¯è¿™æ¡å‘½ä»¤æ¸…ç†æ‰äº†å·²ç» exited çš„ initContainers å®¹å™¨ï¼Œå¯¼è‡´ k8s æ•…éšœï¼Œä¸æ–­å°è¯•é‡å¯è¯¥å®¹å™¨ã€‚ ç½‘ä¸Šä¸€æœç¡®å®æœ‰ç›¸å…³çš„ä¿¡æ¯ï¼š https://stackoverflow.com/questions/62333064/cant-delete-exited-init-container https://github.com/kubernetes/kubernetes/issues/62362 ç»“è®ºï¼šä½¿ç”¨å¤–éƒ¨çš„åƒåœ¾æ¸…ç†å‘½ä»¤å¯èƒ½å¯¼è‡´ k8s è¡Œä¸ºå¼‚å¸¸ã€‚ ","date":"2019-11-24","objectID":"/posts/kubernetes-common-errors-and-solutions/:1:3","tags":["Kubernetes"],"title":"Kubernetes å¸¸è§é”™è¯¯ã€åŸå› åŠå¤„ç†æ–¹æ³•","uri":"/posts/kubernetes-common-errors-and-solutions/"},{"categories":["æŠ€æœ¯"],"content":"èŠ‚ç‚¹å¸¸è§é”™è¯¯ DiskPressureï¼šèŠ‚ç‚¹çš„å¯ç”¨ç©ºé—´ä¸è¶³ã€‚ï¼ˆé€šè¿‡df -h æŸ¥çœ‹ï¼Œä¿è¯å¯ç”¨ç©ºé—´ä¸å°äº 15%ï¼‰ The node was low on resource: ephemeral-storage: åŒä¸Šï¼ŒèŠ‚ç‚¹çš„å­˜å‚¨ç©ºé—´ä¸å¤Ÿäº†ã€‚ èŠ‚ç‚¹å­˜å‚¨å‘Šè­¦å¯èƒ½çš„åŸå› ï¼š kubelet çš„èµ„æº GC è®¾ç½®æœ‰é—®é¢˜ï¼Œé—ç•™çš„é•œåƒç­‰èµ„æºæœªåŠæ—¶ GC å¯¼è‡´å‘Šè­¦ å­˜åœ¨è¿è¡Œçš„ pod ä½¿ç”¨äº†å¤§é‡å­˜å‚¨ç©ºé—´ï¼Œåœ¨èŠ‚ç‚¹ä¸Šé€šè¿‡ docker ps -a --size | grep G å¯ä»¥æŸ¥çœ‹åˆ° å¦‚æœä½¿ç”¨çš„æ˜¯ EKSï¼Œå¹¶ä¸”ç£ç›˜å‘Šè­¦çš„æŒ‚è½½ç‚¹ä¸º /var/lib/kubelet/plugins/kubernetes.io/aws-ebs/mounts/aws/us-east-1b/vol-xxxxx æ˜¾ç„¶æ˜¯ EBS å­˜å‚¨å·å¿«æ»¡äº†å¯¼è‡´çš„ å¯é€šè¿‡ kubectl get pv -A -o yaml | grep -C 30 vol-xxxxx æ¥å®šä½åˆ°å…·ä½“çš„å­˜å‚¨å· ","date":"2019-11-24","objectID":"/posts/kubernetes-common-errors-and-solutions/:2:0","tags":["Kubernetes"],"title":"Kubernetes å¸¸è§é”™è¯¯ã€åŸå› åŠå¤„ç†æ–¹æ³•","uri":"/posts/kubernetes-common-errors-and-solutions/"},{"categories":["æŠ€æœ¯"],"content":"ç½‘ç»œå¸¸è§é”™è¯¯ ","date":"2019-11-24","objectID":"/posts/kubernetes-common-errors-and-solutions/:3:0","tags":["Kubernetes"],"title":"Kubernetes å¸¸è§é”™è¯¯ã€åŸå› åŠå¤„ç†æ–¹æ³•","uri":"/posts/kubernetes-common-errors-and-solutions/"},{"categories":["æŠ€æœ¯"],"content":"1. Ingress/Istio Gateway è¿”å›å€¼ 404ï¼šä¸å­˜åœ¨è¯¥ Service/Istio Gatewayï¼Œæˆ–è€…æ˜¯æœåŠ¡è‡ªèº«è¿”å› 404 500ï¼šå¤§æ¦‚ç‡æ˜¯æœåŠ¡è‡ªèº«çš„é”™è¯¯å¯¼è‡´ 500ï¼Œå°æ¦‚ç‡æ˜¯ä»£ç†ï¼ˆSidecar/Ingress ç­‰ï¼‰çš„é”™è¯¯ 503ï¼šæœåŠ¡ä¸å¯ç”¨ï¼Œæœ‰å¦‚ä¸‹å‡ ç§å¯èƒ½çš„åŸå› ï¼š Service å¯¹åº”çš„ Pods ä¸å­˜åœ¨ï¼Œendpoints ä¸ºç©º Service å¯¹åº”çš„ Pods å…¨éƒ¨éƒ½ NotReadyï¼Œå¯¼è‡´ endpoints ä¸ºç©º ä¹Ÿæœ‰å¯èƒ½æ˜¯æœåŠ¡è‡ªèº«å‡ºé”™è¿”å›çš„ 503 å¦‚æœä½ ä½¿ç”¨äº† envoy sidecarï¼Œ 503 å¯èƒ½çš„åŸå› å°±å¤šäº†ã€‚åŸºæœ¬ä¸Š sidecar ä¸ä¸»å®¹å™¨é€šä¿¡è¿‡ç¨‹ä¸­çš„ä»»ä½•é—®é¢˜éƒ½ä¼šä½¿ envoy è¿”å› 503ï¼Œä½¿å®¢æˆ·ç«¯é‡è¯•ã€‚ è¯¦è§ Istioï¼š503ã€UC å’Œ TCP 502ï¼šBad Gatewayï¼Œé€šå¸¸æ˜¯ç”±äºä¸Šæ¸¸æœªè¿”å›æ­£ç¡®çš„å“åº”å¯¼è‡´çš„ï¼Œå¯èƒ½çš„æ ¹æœ¬åŸå› ï¼š åº”ç”¨ç¨‹åºæœªæ­£ç¡®å¤„ç† SIGTERM ä¿¡å·ï¼Œåœ¨è¯·æ±‚æœªå¤„ç†å®Œæ¯•æ—¶ç›´æ¥ç»ˆæ­¢äº†è¿›ç¨‹ã€‚è¯¦è§ ä¼˜é›…åœæ­¢ï¼ˆGracful Shutdownï¼‰ä¸ 502/504 æŠ¥é”™ - K8s æœ€ä½³å®è·µ ç½‘ç»œæ’ä»¶ bug 504ï¼šç½‘å…³è¯·æ±‚ upstream è¶…æ—¶ï¼Œä¸»è¦æœ‰ä¸¤ç§å¯èƒ½ è€ƒè™‘æ˜¯ä¸æ˜¯ Ingress Controller çš„ IP åˆ—è¡¨æœªæ›´æ–°ï¼Œå°†è¯·æ±‚ä»£ç†åˆ°äº†ä¸å­˜åœ¨çš„ ipï¼Œå¯¼è‡´å¾—ä¸åˆ°å“åº” Service Endpoints ç§»é™¤ä¸å¤ŸåŠæ—¶ï¼Œåœ¨ Pod å·²ç»è¢«ç»ˆæ­¢åï¼Œä»ç„¶æœ‰ä¸ªåˆ«è¯·æ±‚è¢«è·¯ç”±åˆ°äº†è¯¥ Podï¼Œå¾—ä¸åˆ°å“åº”å¯¼è‡´ 504ã€‚è¯¦è§ ä¼˜é›…åœæ­¢ï¼ˆGracful Shutdownï¼‰ä¸ 502/504 æŠ¥é”™ - K8s æœ€ä½³å®è·µ Pod å“åº”å¤ªæ…¢ï¼Œä»£ç é—®é¢˜ å†æ€»ç»“ä¸€ä¸‹å¸¸è§çš„å‡ ç§é”™è¯¯ï¼š æœªè®¾ç½®ä¼˜é›…åœæ­¢ï¼Œå¯¼è‡´ Pod è¢«é‡æ–°ç»ˆæ­¢æ—¶ï¼Œæœ‰æ¦‚ç‡å‡ºç° 502/504 æœåŠ¡çš„æ‰€æœ‰ Pods çš„çŠ¶æ€åœ¨ã€Œå°±ç»ªã€å’Œã€Œæœªå°±ç»ªã€ä¹‹é—´æ‘†åŠ¨ï¼Œå¯¼è‡´é—´æ­‡æ€§åœ°å‡ºç°å¤§é‡ 503 é”™è¯¯ æœåŠ¡è¿”å› 5xx é”™è¯¯å¯¼è‡´å®¢æˆ·ç«¯ä¸æ–­é‡è¯•ï¼Œè¯·æ±‚æµé‡è¢«æ”¾å¤§ï¼Œå¯¼è‡´æœåŠ¡ä¸€ç›´èµ·ä¸æ¥ è§£å†³åŠæ³•ï¼šé™æµã€ç†”æ–­ï¼ˆç½‘å…³å±‚ç›´æ¥è¿”å›å›ºå®šçš„ç›¸åº”å†…å®¹ï¼‰ Ingress ç›¸å…³ç½‘ç»œé—®é¢˜çš„æ’æŸ¥æµç¨‹ï¼š Which ingress controller? Timeout between client and ingress controller, or between ingress controller and backend service/pod? HTTP/504 generated by the ingress controller, proven by logs from the ingress controller? If you port-forward to skip the internet between client and ingress controller, does the timeout still happen? ","date":"2019-11-24","objectID":"/posts/kubernetes-common-errors-and-solutions/:3:1","tags":["Kubernetes"],"title":"Kubernetes å¸¸è§é”™è¯¯ã€åŸå› åŠå¤„ç†æ–¹æ³•","uri":"/posts/kubernetes-common-errors-and-solutions/"},{"categories":["æŠ€æœ¯"],"content":"2. ä¸Šäº† istio sidecar åï¼Œåº”ç”¨ç¨‹åºå¶å°”ï¼ˆé—´éš”å‡ å¤©åŠä¸ªæœˆï¼‰ä¼š redis è¿æ¥ç›¸å…³çš„é”™è¯¯ è€ƒè™‘æ˜¯å¦å’Œ tcp é•¿æ—¶é—´ä½¿ç”¨æœ‰å…³ï¼Œæ¯”å¦‚è¿æ¥é•¿æ—¶é—´ç©ºé—²çš„è¯ï¼Œå¯èƒ½ä¼šè¢« istio sidecar æ–­å¼€ã€‚ å¦‚æœç¨‹åºè‡ªèº«çš„é‡è¿æœºåˆ¶æœ‰é—®é¢˜ï¼Œå°±ä¼šå¯¼è‡´è¿™ç§ç°è±¡ã€‚ ç¡®è®¤æ–¹æ³•ï¼š æ£€æŸ¥ istio çš„ idleTimeout æ—¶é•¿ï¼ˆé»˜è®¤ 1hï¼‰ åˆ›å»ºä¸‰äº”ä¸ªæ²¡æµé‡çš„ Pod æ”¾ç½® 1hï¼ˆä¸ istio idleTimeout æ—¶é•¿ä¸€è‡´ï¼‰ï¼Œçœ‹çœ‹æ˜¯å¦ä¼šå‡†æ—¶å¼€å§‹æŠ¥ redis çš„é”™ã€‚ å¯¹ç…§ç»„ï¼šåˆ›å»ºä¸‰äº”ä¸ªåŒæ ·æ²¡æµé‡çš„ Podï¼Œä½†æ˜¯ä¸æ³¨å…¥ istio sidecarï¼Œåº”è¯¥ä¸€ç›´å¾ˆæ­£å¸¸ è¿™æ ·å°±èƒ½ç¡®è®¤é—®é¢˜ï¼Œåç»­å¤„ç†ï¼š æŠ“åŒ…è§‚å¯Ÿç¨‹åºåœ¨å‡ºé”™åçš„ tcp å±‚è¡Œä¸º æŸ¥é˜… redis sdk çš„ç›¸å…³ issueã€ä»£ç ï¼Œé€šè¿‡å‡çº§ SDK åº”è¯¥èƒ½è§£å†³é—®é¢˜ã€‚ ","date":"2019-11-24","objectID":"/posts/kubernetes-common-errors-and-solutions/:3:2","tags":["Kubernetes"],"title":"Kubernetes å¸¸è§é”™è¯¯ã€åŸå› åŠå¤„ç†æ–¹æ³•","uri":"/posts/kubernetes-common-errors-and-solutions/"},{"categories":["æŠ€æœ¯"],"content":"åå­—ç©ºé—´å¸¸è§é”™è¯¯ ","date":"2019-11-24","objectID":"/posts/kubernetes-common-errors-and-solutions/:4:0","tags":["Kubernetes"],"title":"Kubernetes å¸¸è§é”™è¯¯ã€åŸå› åŠå¤„ç†æ–¹æ³•","uri":"/posts/kubernetes-common-errors-and-solutions/"},{"categories":["æŠ€æœ¯"],"content":"åå­—ç©ºé—´æ— æ³•åˆ é™¤ è¿™é€šå¸¸æ˜¯æŸäº›èµ„æºå¦‚ CR(custom resources)/å­˜å‚¨ç­‰èµ„æºæ— æ³•é‡Šæ”¾å¯¼è‡´çš„ã€‚ æ¯”å¦‚å¸¸è§çš„ monitoring åå­—ç©ºé—´æ— æ³•åˆ é™¤ï¼Œåº”è¯¥å°±æ˜¯ CR æ— æ³• GC å¯¼è‡´çš„ã€‚ å¯æ‰‹åŠ¨åˆ é™¤ namespace é…ç½®ä¸­çš„ææ„å™¨ï¼ˆspec.finalizerï¼Œåœ¨åå­—ç©ºé—´ç”Ÿå‘½å‘¨æœŸç»“æŸå‰ä¼šç”Ÿæˆçš„é…ç½®é¡¹ï¼‰ï¼Œè¿™æ ·åå­—ç©ºé—´å°±ä¼šç›´æ¥è·³è¿‡ GC æ­¥éª¤ï¼š # ç¼–è¾‘åå­—ç©ºé—´çš„é…ç½® kubectl edit namespace \u003cns-name\u003e # å°† spec.finalizers æ”¹æˆç©ºåˆ—è¡¨ [] å¦‚æœä¸Šè¿°æ–¹æ³•ä¹Ÿæ— æ³•åˆ é™¤åå­—ç©ºé—´ï¼Œä¹Ÿæ‰¾ä¸åˆ°å…·ä½“çš„é—®é¢˜ï¼Œå°±åªèƒ½ç›´æ¥ä» etcd ä¸­åˆ é™¤æ‰å®ƒäº†(æœ‰é£é™©ï¼Œè°¨æ…æ“ä½œï¼)ã€‚æ–¹æ³•å¦‚ä¸‹ï¼š # ç™»å½•åˆ° etcd å®¹å™¨ä¸­ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š export ETCDCTL_API=3 cd /etc/kubernetes/pki/etcd/ # åˆ—å‡ºæ‰€æœ‰åå­—ç©ºé—´ etcdctl --cacert ca.crt --cert peer.crt --key peer.key get /registry/namespaces --prefix --keys-only # ï¼ˆè°¨æ…æ“ä½œï¼ï¼ï¼ï¼‰å¼ºåˆ¶åˆ é™¤åå­—ç©ºé—´ `monitoring`ã€‚è¿™å¯èƒ½å¯¼è‡´ç›¸å…³èµ„æºæ— æ³•è¢« GCï¼ etcdctl --cacert ca.crt --cert peer.crt --key peer.key del /registry/namespaces/monitoring ","date":"2019-11-24","objectID":"/posts/kubernetes-common-errors-and-solutions/:4:1","tags":["Kubernetes"],"title":"Kubernetes å¸¸è§é”™è¯¯ã€åŸå› åŠå¤„ç†æ–¹æ³•","uri":"/posts/kubernetes-common-errors-and-solutions/"},{"categories":["æŠ€æœ¯"],"content":"kubectl/istioctl ç­‰å®¢æˆ·ç«¯å·¥å…·å¼‚å¸¸ socat not found: kubectl ä½¿ç”¨ socat è¿›è¡Œç«¯å£è½¬å‘ï¼Œé›†ç¾¤çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œä»¥åŠæœ¬æœºéƒ½å¿…é¡»å®‰è£…æœ‰ socat å·¥å…·ã€‚ ","date":"2019-11-24","objectID":"/posts/kubernetes-common-errors-and-solutions/:5:0","tags":["Kubernetes"],"title":"Kubernetes å¸¸è§é”™è¯¯ã€åŸå› åŠå¤„ç†æ–¹æ³•","uri":"/posts/kubernetes-common-errors-and-solutions/"},{"categories":["æŠ€æœ¯"],"content":"æ‰¹é‡æ¸…ç† Evicted è®°å½• æœ‰æ—¶å€™ Pod å› ä¸ºèŠ‚ç‚¹é€‰æ‹©å™¨çš„é—®é¢˜ï¼Œè¢«ä¸æ–­è°ƒåº¦åˆ°æœ‰é—®é¢˜çš„ Node ä¸Šï¼Œå°±ä¼šä¸æ–­è¢« Evictedï¼Œå¯¼è‡´å‡ºç°å¤§é‡çš„ Evicted Podsã€‚ æ’æŸ¥å®Œé—®é¢˜åï¼Œéœ€è¦æ‰‹åŠ¨æ¸…ç†æ‰è¿™äº› Evicted Pods. æ‰¹é‡åˆ é™¤ Evicted è®°å½•: kubectl get pods | grep Evicted | awk '{print $1}' | xargs kubectl delete pod ","date":"2019-11-24","objectID":"/posts/kubernetes-common-errors-and-solutions/:6:0","tags":["Kubernetes"],"title":"Kubernetes å¸¸è§é”™è¯¯ã€åŸå› åŠå¤„ç†æ–¹æ³•","uri":"/posts/kubernetes-common-errors-and-solutions/"},{"categories":["æŠ€æœ¯"],"content":"å®¹å™¨é•œåƒGCã€Podé©±é€ä»¥åŠèŠ‚ç‚¹å‹åŠ› èŠ‚ç‚¹å‹åŠ› DiskPressure ä¼šå¯¼è‡´ Pod è¢«é©±é€ï¼Œä¹Ÿä¼šè§¦å‘å®¹å™¨é•œåƒçš„ GCã€‚ æ ¹æ®å®˜æ–¹æ–‡æ¡£ é…ç½®èµ„æºä¸è¶³æ—¶çš„å¤„ç†æ–¹å¼ï¼ŒKubelet æä¾›å¦‚ä¸‹ç”¨äºé…ç½®å®¹å™¨ GC åŠ Evicetion çš„é˜ˆå€¼ï¼š --eviction-hard å’Œ eviction-soft: å¯¹åº”æ—§å‚æ•° --image-gc-high-thresholdï¼Œè¿™ä¸¤ä¸ªå‚æ•°é…ç½®é•œåƒ GC åŠé©±é€çš„è§¦å‘é˜ˆå€¼ã€‚ç£ç›˜ä½¿ç”¨ç‡çš„é˜ˆå€¼é»˜è®¤ä¸º 85% åŒºåˆ«åœ¨äº eviction-hard æ˜¯ç«‹å³é©±é€ï¼Œè€Œ eviction-soft åœ¨è¶…è¿‡ eviction-soft-grace-period ä¹‹åæ‰é©±é€ã€‚ --eviction-minimum-reclaim: å¯¹åº”æ—§å‚æ•° --image-gc-low-thresholdã€‚è¿™æ˜¯è¿›è¡Œèµ„æºå›æ”¶ï¼ˆé•œåƒGCã€Podé©±é€ç­‰ï¼‰åæœŸæœ›è¾¾åˆ°çš„ç£ç›˜ä½¿ç”¨ç‡ç™¾åˆ†æ¯”ã€‚ç£ç›˜ä½¿ç”¨ç‡çš„é˜ˆå€¼é»˜è®¤å€¼ä¸º 80%ã€‚ é—®ï¼šèƒ½å¦ä¸º ImageGC è®¾ç½®ä¸€ä¸ªæ¯” DiskPressure æ›´ä½çš„é˜ˆå€¼ï¼Ÿå› ä¸ºæˆ‘ä»¬å¸Œæœ›èƒ½è‡ªåŠ¨è¿›è¡Œé•œåƒ GCï¼Œä½†æ˜¯ä¸æƒ³ç«‹å³è§¦å‘ Pod é©±é€ã€‚ ç­”ï¼šè¿™åº”è¯¥å¯ä»¥é€šè¿‡è®¾ç½® eviction-soft å’Œé•¿ä¸€ç‚¹çš„ eviction-soft-grace-period æ¥å®ç°ã€‚ å¦å¤– --eviction-minimum-reclaim ä¹Ÿå¯ä»¥è®¾å°ä¸€ç‚¹ï¼Œæ¸…ç†å¾—æ›´å¹²å‡€ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š --eviction-soft=memory.available\u003c1Gi,nodefs.available\u003c2Gi,imagefs.available\u003c200Gi --eviction-soft-grace-period=3m --eviction-minimum-reclaim=memory.available=0Mi,nodefs.available=1Gi,imagefs.available=2Gi ","date":"2019-11-24","objectID":"/posts/kubernetes-common-errors-and-solutions/:7:0","tags":["Kubernetes"],"title":"Kubernetes å¸¸è§é”™è¯¯ã€åŸå› åŠå¤„ç†æ–¹æ³•","uri":"/posts/kubernetes-common-errors-and-solutions/"},{"categories":["æŠ€æœ¯"],"content":"å…¶ä»–é—®é¢˜ ","date":"2019-11-24","objectID":"/posts/kubernetes-common-errors-and-solutions/:8:0","tags":["Kubernetes"],"title":"Kubernetes å¸¸è§é”™è¯¯ã€åŸå› åŠå¤„ç†æ–¹æ³•","uri":"/posts/kubernetes-common-errors-and-solutions/"},{"categories":["æŠ€æœ¯"],"content":"éš”å¤© Istio ç­‰å·¥å…·çš„ sidecar è‡ªåŠ¨æ³¨å…¥è«åå…¶å¦™å¤±æ•ˆäº† å¦‚æœæœåŠ¡å™¨æ™šä¸Šä¼šå…³æœºï¼Œå¯èƒ½å¯¼è‡´ç¬¬äºŒå¤©ç½‘ç»œæ’ä»¶å‡ºé—®é¢˜ï¼Œå¯¼è‡´ sidecar æ³¨å…¥å™¨æ— æ³•è§‚å¯Ÿåˆ° pod çš„åˆ›å»ºï¼Œä¹Ÿå°±æ— æ³•å®Œæˆ sidecar æ³¨å…¥ã€‚ ","date":"2019-11-24","objectID":"/posts/kubernetes-common-errors-and-solutions/:9:0","tags":["Kubernetes"],"title":"Kubernetes å¸¸è§é”™è¯¯ã€åŸå› åŠå¤„ç†æ–¹æ³•","uri":"/posts/kubernetes-common-errors-and-solutions/"},{"categories":["æŠ€æœ¯"],"content":"å¦‚ä½•é‡æ–°è¿è¡Œä¸€ä¸ª Jobï¼Ÿ æˆ‘ä»¬æœ‰ä¸€ä¸ª Job å› ä¸ºå¤–éƒ¨åŸå› è¿è¡Œå¤±è´¥äº†ï¼Œä¿®å¤å¥½åå°±éœ€è¦é‡æ–°è¿è¡Œå®ƒã€‚ æ–¹æ³•æ˜¯ï¼šåˆ é™¤æ—§çš„ Jobï¼Œå†ä½¿ç”¨åŒä¸€ä»½é…ç½®é‡å»º Job. å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ fluxcd è¿™ç±» GitOps å·¥å…·ï¼Œå°±åªéœ€è¦æ‰‹å·¥åˆ é™¤æ—§ Podï¼Œfluxcd ä¼šå®šæ—¶è‡ªåŠ¨ apply æ‰€æœ‰é…ç½®ï¼Œè¿™å°±å®Œæˆäº† Job çš„é‡å»ºã€‚ ","date":"2019-11-24","objectID":"/posts/kubernetes-common-errors-and-solutions/:9:1","tags":["Kubernetes"],"title":"Kubernetes å¸¸è§é”™è¯¯ã€åŸå› åŠå¤„ç†æ–¹æ³•","uri":"/posts/kubernetes-common-errors-and-solutions/"},{"categories":["æŠ€æœ¯"],"content":"å‚è€ƒ Kubernetesç®¡ç†ç»éªŒ 504 Gateway Timeout when accessing workload via ingress Kubernetes Failure Stories Istioï¼š503ã€UC å’Œ TCP ","date":"2019-11-24","objectID":"/posts/kubernetes-common-errors-and-solutions/:10:0","tags":["Kubernetes"],"title":"Kubernetes å¸¸è§é”™è¯¯ã€åŸå› åŠå¤„ç†æ–¹æ³•","uri":"/posts/kubernetes-common-errors-and-solutions/"},{"categories":["æŠ€æœ¯"],"content":"Manjaro æ˜¯ä¸€ä¸ªåŸºäº Arch Linux çš„ Linux æ»šåŠ¨å‘è¡Œç‰ˆï¼Œç”¨ç€æŒºèˆ’æœçš„ã€‚ æœ€å¤§çš„ç‰¹ç‚¹ï¼Œæ˜¯åŒ…ä»“åº“å¾ˆä¸°å¯Œï¼Œè€Œä¸”éƒ½å¾ˆæ–°ã€‚ä»£ä»·æ˜¯å¶å°”ä¼šå‡ºäº›å°æ¯›ç—…ã€‚ 2021-09-22 æ›´æ–°ï¼šä»Šå¤©è¢«ç¾¤å‹ç§‘æ™®ï¼Œå¯èƒ½æˆ‘ä¸‹é¢åˆ—ä¸¾çš„å‡ ä¸ªæ»šæŒ‚äº‹ä»¶ï¼Œå¯èƒ½éƒ½å’Œæˆ‘ä½¿ç”¨äº† archlinuxcn è¿™ä¸ªæºæœ‰å…³ï¼Œè¿™ç¡®å®æœ‰å¯èƒ½ã€‚ æˆ‘ä¸€å¹´å¤šçš„ä½¿ç”¨ä¸­ï¼Œé‡åˆ°è¿‡ qv2-ray åŠ¨æ€é“¾æ¥åº“ç‚¸æ‰çš„é—®é¢˜ï¼Œæ²¡ä¸“é—¨å»æ‰¾ä¿®å¤æ–¹æ³•ï¼Œå¥½åƒæ˜¯ç­‰äº†ä¸€ä¸¤ä¸ªæœˆï¼Œå‡çº§äº†ä¸¤ä¸ªå¤§ç‰ˆæœ¬æ‰æ¢å¤ã€‚ å¦ä¸€ä¸ªå°±æ˜¯ VSCode - Incorrect locale â€˜en-USâ€™ used everywhere è¿˜é‡åˆ°è¿‡ libguestfs çš„ä¸€ä¸ªé—®é¢˜ï¼švrit-v2v/virt-p2v ä¸¤ä¸ªå·¥å…·è¢«æ‹†åˆ†å‡ºå»ï¼Œå¯¼è‡´ manjaro åªèƒ½é€šè¿‡æºç å®‰è£…è¿™ä¿©è´§ã€‚è¿™è²Œä¼¼ç›®å‰ä»æ—§æ²¡æœ‰è§£å†³ã€‚ æ€»çš„æ¥è¯´ä½“éªŒå¾ˆä¸é”™ï¼Œèƒ½å¾ˆåŠæ—¶åœ°ç”¨ä¸Šå„ç§æ–°ç‰ˆæœ¬çš„è½¯ä»¶ã€‚ ","date":"2019-07-13","objectID":"/posts/manjaro-instruction/:0:0","tags":["Manjaro","Linux","Arch Linux"],"title":"Manjaro ä½¿ç”¨æŒ‡å—","uri":"/posts/manjaro-instruction/"},{"categories":["æŠ€æœ¯"],"content":"ä¸€ã€pacman/yay çš„åŸºç¡€å‘½ä»¤ Manjaro è£…å¥½åï¼Œéœ€è¦è¿è¡Œçš„ç¬¬ä¸€æ¡å‘½ä»¤ï¼š sudo pacman -Syy ## å¼ºåˆ¶æ›´æ–° package ç›®å½• sudo pacman-mirrors --interactive --country China # åˆ—å‡ºæ‰€æœ‰å›½å†…çš„é•œåƒæºï¼Œå¹¶æä¾›äº¤äº’å¼çš„ç•Œé¢æ‰‹åŠ¨é€‰æ‹©é•œåƒæº sudo pacman -Syyu # å¼ºåˆ¶æ›´æ–° package ç›®å½•ï¼Œå¹¶å°è¯•æ›´æ–°å·²å®‰è£…çš„æ‰€æœ‰ packages. sudo pacman -S yay # å®‰è£… yay pacman æ˜¯ arch/manjaro çš„å®˜æ–¹åŒ…ç®¡ç†å™¨ï¼Œè€Œåˆšåˆšå®‰è£…çš„ yayï¼Œåˆ™æ˜¯ä¸€ä¸ªèƒ½æŸ¥è¯¢ arch linux çš„ aur ä»“åº“çš„ç¬¬ä¸‰æ–¹åŒ…ç®¡ç†å™¨ï¼Œéå¸¸æµè¡Œã€‚ pacman çš„å¸¸ç”¨å‘½ä»¤è¯­æ³•ï¼š pacman -S package_name # å®‰è£…è½¯ä»¶ pacman -S extra/package_name # å®‰è£…ä¸åŒä»“åº“ä¸­çš„ç‰ˆæœ¬ pacman -Syu # å‡çº§æ•´ä¸ªç³»ç»Ÿï¼Œyæ˜¯æ›´æ–°æ•°æ®åº“ï¼Œyyæ˜¯å¼ºåˆ¶æ›´æ–°ï¼Œuæ˜¯å‡çº§è½¯ä»¶ pacman -Ss string # åœ¨åŒ…æ•°æ®åº“ä¸­æŸ¥è¯¢è½¯ä»¶ pacman -Si package_name # æ˜¾ç¤ºè½¯ä»¶çš„è¯¦ç»†ä¿¡æ¯ pacman -Sc # æ¸…é™¤è½¯ä»¶ç¼“å­˜ï¼Œå³/var/cache/pacman/pkgç›®å½•ä¸‹çš„æ–‡ä»¶ pacman -R package_name # åˆ é™¤å•ä¸ªè½¯ä»¶ pacman -Rs package_name # åˆ é™¤æŒ‡å®šè½¯ä»¶åŠå…¶æ²¡æœ‰è¢«å…¶ä»–å·²å®‰è£…è½¯ä»¶ä½¿ç”¨çš„ä¾èµ–å…³ç³» pacman -Qs string # æŸ¥è¯¢å·²å®‰è£…çš„è½¯ä»¶åŒ… pacman -Qi package_name # æŸ¥è¯¢æœ¬åœ°å®‰è£…åŒ…çš„è¯¦ç»†ä¿¡æ¯ pacman -Ql package_name # è·å–å·²å®‰è£…è½¯ä»¶æ‰€åŒ…å«çš„æ–‡ä»¶çš„åˆ—è¡¨ pacman -U package.tar.zx # ä»æœ¬åœ°æ–‡ä»¶å®‰è£… pactree package_name # æ˜¾ç¤ºè½¯ä»¶çš„ä¾èµ–æ ‘ yay çš„ç”¨æ³•å’Œ pacman å®Œå…¨ç±»ä¼¼ï¼Œä¸Šè¿°æ‰€æœ‰ pacman xxx å‘½ä»¤ï¼Œå‡å¯æ›¿æ¢æˆ yay xxx æ‰§è¡Œã€‚ æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€æ¡ yay å‘½ä»¤å€¼å¾—è®°ä¸€ä¸‹ï¼š yay -c # å¸è½½æ‰€æœ‰æ— ç”¨çš„ä¾èµ–ã€‚ç±»æ¯” apt-get autoremove ","date":"2019-07-13","objectID":"/posts/manjaro-instruction/:1:0","tags":["Manjaro","Linux","Arch Linux"],"title":"Manjaro ä½¿ç”¨æŒ‡å—","uri":"/posts/manjaro-instruction/"},{"categories":["æŠ€æœ¯"],"content":"å¸¸ç”¨è½¯ä»¶ä¸é…ç½® ","date":"2019-07-13","objectID":"/posts/manjaro-instruction/:2:0","tags":["Manjaro","Linux","Arch Linux"],"title":"Manjaro ä½¿ç”¨æŒ‡å—","uri":"/posts/manjaro-instruction/"},{"categories":["æŠ€æœ¯"],"content":"1. æ·»åŠ  archlinux ä¸­æ–‡ç¤¾åŒºä»“åº“ Arch Linux ä¸­æ–‡ç¤¾åŒºä»“åº“ æ˜¯ç”± Arch Linux ä¸­æ–‡ç¤¾åŒºé©±åŠ¨çš„éå®˜æ–¹ç”¨æˆ·ä»“åº“ï¼ŒåŒ…å«ä¸€äº›é¢å¤–çš„è½¯ä»¶åŒ…ä»¥åŠå·²æœ‰è½¯ä»¶çš„ git ç‰ˆæœ¬ç­‰å˜ç§ã€‚éƒ¨åˆ†è½¯ä»¶åŒ…çš„æ‰“åŒ…è„šæœ¬æ¥æºäº AURã€‚ ä¸€äº›å›½å†…è½¯ä»¶ï¼Œå¦‚æœç›´æ¥ä» aur å®‰è£…ï¼Œé‚£å°±ä¼šæœ‰ä¸€ä¸ªç¼–è¯‘è¿‡ç¨‹ï¼Œæœ‰ç‚¹æ…¢ã€‚è€Œ archlinuxcn æœ‰å·²ç»ç¼–è¯‘å¥½çš„åŒ…ï¼Œå¯ä»¥ç›´æ¥å®‰è£…ã€‚æ›´æ–°é€Ÿåº¦ä¹Ÿå¾ˆå¿«ï¼Œæ¨èä½¿ç”¨ã€‚ é…ç½®æ–¹æ³•è§ Arch Linux Chinese Community Repositoryã€‚ ","date":"2019-07-13","objectID":"/posts/manjaro-instruction/:2:1","tags":["Manjaro","Linux","Arch Linux"],"title":"Manjaro ä½¿ç”¨æŒ‡å—","uri":"/posts/manjaro-instruction/"},{"categories":["æŠ€æœ¯"],"content":"2. å®‰è£…å¸¸ç”¨è½¯ä»¶ sudo pacman -S google-chrome firefox # æµè§ˆå™¨ sudo pacman -S netease-cloud-music # ç½‘æ˜“äº‘éŸ³ä¹ sudo pacman -S noto-fonts-cjk wqy-bitmapfont wqy-microhei wqy-zenhei # ä¸­æ–‡å­—ä½“ï¼šæ€æºç³»åˆ—ã€æ–‡æ³‰ç³»åˆ— sudo pacman -S wps-office ttf-wps-fonts sudo pacman -S vim # å‘½ä»¤è¡Œç¼–è¾‘å™¨ sudo pacman -S git # ç‰ˆæœ¬ç®¡ç†å·¥å…· sudo pacman -S clang make cmake gdb # ç¼–è¯‘è°ƒè¯•ç¯å¢ƒ sudo pacman -S visual-studio-code-bin # ä»£ç ç¼–è¾‘å™¨ sudo pacman -S wireshark-qt mitmproxy # æŠ“åŒ…å·¥å…· sudo pacman -S docker # docker å®¹å™¨ å…¶ä¸­ docker å’Œ wireshark éœ€è¦é¢å¤–é…ç½®ï¼Œå¦åˆ™ä¼šè¦æ±‚ç®¡ç†å‘˜æƒé™ï¼š sudo groupadd wireshark sudo gpasswd --add $USER wireshark # å°†ä½ æ·»åŠ åˆ° wireshark ç”¨æˆ·ç»„ä¸­ sudo groupadd docker sudo gpasswd --add $USER docker # åŒä¸Š ","date":"2019-07-13","objectID":"/posts/manjaro-instruction/:2:2","tags":["Manjaro","Linux","Arch Linux"],"title":"Manjaro ä½¿ç”¨æŒ‡å—","uri":"/posts/manjaro-instruction/"},{"categories":["æŠ€æœ¯"],"content":"3. ä¸­æ–‡è¾“å…¥æ³• æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼šä¸­å·éŸµï¼ˆrimeï¼‰å’Œæœç‹—æ‹¼éŸ³ï¼ˆsogoupinyinï¼‰ã€‚ ç®€å•çœäº‹ç”¨æœç‹—ï¼Œè¦ç”¨ç‰¹æ®Šçš„è¾“å…¥æ–¹æ¡ˆï¼ˆäº”ç¬”ã€éŸ³å½¢ã€äºŒç¬”ç­‰ç­‰ï¼‰å°±åªæœ‰ rime å¯é€‰äº†ã€‚ 3.1 fcitx5-rime é…ç½®å°é¹¤éŸ³å½¢ é¦–å…ˆå®‰è£… fcitx5-rime, æ³¨æ„è¿™äº›ç»„ä»¶ä¸€ä¸ªéƒ½ä¸èƒ½çœç•¥ï¼š sudo pacman -S fcitx5 fcitx5-chinese-addons fcitx5-gtk fcitx5-qt kcm-fcitx5 fcitx5-rime ç¬¬äºŒæ­¥æ˜¯ä¿®æ”¹ç¯å¢ƒå˜é‡ï¼Œå°† fcitx5-rime è®¾ä¸ºé»˜è®¤è¾“å…¥æ³•å¹¶è‡ªåŠ¨å¯åŠ¨ã€‚ æ·»åŠ  ~/.pam_environment æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š INPUT_METHOD DEFAULT=fcitx5 GTK_IM_MODULE DEFAULT=fcitx5 QT_IM_MODULE DEFAULT=fcitx5 XMODIFIERS DEFAULT=@im=fcitx5 pam-env æ¨¡å—ä¼šåœ¨æ‰€æœ‰ç™»å½•ä¼šè¯ä¸­è¯»å–ä¸Šé¢çš„é…ç½®æ–‡ä»¶ï¼ŒåŒ…æ‹¬ X11 ä¼šè¯å’Œ Wayland ä¼šè¯ã€‚ æ·»åŠ è‡ªåŠ¨å¯åŠ¨ï¼š # ~/.xprofile æ˜¯ x11 GUI çš„ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶ echo 'fcitx5 \u0026' \u003e\u003e ~/.xprofile ç„¶åï¼Œä» http://flypy.ys168.com/ ä¸‹è½½æœ€æ–°çš„é¼ é¡»ç®¡ï¼ˆMacOSï¼‰é…ç½®æ–‡ä»¶ï¼Œå°†è§£å‹å¾—åˆ°çš„ rime æ–‡ä»¶å¤¹æ‹·è´åˆ° ~/.local/share/fcitx5/ ä¸‹ï¼š mv rime ~/.local/share/fcitx5/ ç°åœ¨é‡å¯ç³»ç»Ÿï¼Œåœ¨ fcitx5 é…ç½®é‡Œé¢æ·»åŠ  rimeï¼Œå°±å¯ä»¥æ­£å¸¸ä½¿ç”¨å°é¹¤éŸ³å½¢äº†ã€‚ ","date":"2019-07-13","objectID":"/posts/manjaro-instruction/:2:3","tags":["Manjaro","Linux","Arch Linux"],"title":"Manjaro ä½¿ç”¨æŒ‡å—","uri":"/posts/manjaro-instruction/"},{"categories":["æŠ€æœ¯"],"content":"å‘ ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä¹Ÿé‡åˆ°äº†ä¸€äº›å‘ï¼š å®‰è£…è½¯ä»¶åŒ…æ—¶ï¼Œæ— æ³•åœ¨çº¿å®‰è£…æ—§ç‰ˆæœ¬ï¼é™¤éä½ æœ¬åœ°æœ‰æ—§ç‰ˆæœ¬çš„å®‰è£…åŒ…æ²¡æ¸…é™¤ï¼Œæ‰å¯ä»¥é€šè¿‡ç¼“å­˜å®‰è£…æ—§ç‰ˆæœ¬ã€‚ è¿™ç§é—®é¢˜æ²¡é‡åˆ°æ—¶å¥½è¯´ï¼Œä½†æœ‰æ—¶å€™æ–°ç‰ˆæœ¬æœ‰é—®é¢˜ï¼Œæ—§å®‰è£…åŒ…ä¹Ÿæ¸…ç†æ‰äº†æ— æ³•å›é€€ï¼Œå°±éå¸¸éº»çƒ¦ã€‚ è€Œä¸”å°±ç®—ä½ å›é€€äº†ç‰ˆæœ¬ï¼Œä¸€å‡çº§å®ƒå°±åˆæ›´æ–°äº†ã€‚ã€‚ ","date":"2019-07-13","objectID":"/posts/manjaro-instruction/:3:0","tags":["Manjaro","Linux","Arch Linux"],"title":"Manjaro ä½¿ç”¨æŒ‡å—","uri":"/posts/manjaro-instruction/"},{"categories":["æŠ€æœ¯"],"content":"å½»åº•åˆ é™¤ Manjaro åŠå…¶å¼•å¯¼é¡¹ æœ€è¿‘(2021-01)åˆ‡æ¢åˆ°äº† OpenSUSEï¼Œä½“éªŒå¾ˆå¥½ï¼Œäºæ˜¯å†³å®šåˆ é™¤æ‰ Manjaroã€‚ ä¸€ç•ªæ“ä½œï¼Œæ€»ç»“å‡ºçš„åˆ é™¤æµç¨‹å¦‚ä¸‹ï¼ˆä»¥ä¸‹å‘½ä»¤å‡éœ€è¦ root æƒé™ï¼‰ï¼š # 1. åˆ é™¤ EFI å¼•å¯¼é¡¹ ## æŸ¥çœ‹ efi çš„æ‰€æœ‰å¯åŠ¨é¡¹ï¼Œæ‰¾åˆ° Manjaro çš„ç¼–å· efibootmgr ## åˆ é™¤æ‰ Manjaro å¯åŠ¨é¡¹ sudo efibootmgr --delete-bootnum -b 2 # 2. åˆ é™¤ manjaro çš„ bootloader ## æˆ‘ä½¿ç”¨äº† manjaro é»˜è®¤çš„å®‰è£…ç­–ç•¥ï¼Œbootloader è¢«å®‰è£…åœ¨äº†å’Œ windows ç›¸åŒçš„ EFI åˆ†åŒºä¸‹ ## é¦–å…ˆé€šè¿‡ opnsuse çš„åˆ†åŒºå·¥å…·ï¼Œæ‰¾åˆ° EFI åˆ†åŒºçš„è®¾å¤‡å·ï¼Œç„¶åæŒ‚è½½å®ƒ mkdir efi mount /dev/nvme0n1p1 efi # åˆ é™¤ Manjaro bootloader rm -r EFI/Manjaro # 3. é‡å»º grub2 å¼•å¯¼é¡¹ grub2-mkconfig \u003e /boot/grub2/grub.cfg # 4. æœ€åï¼Œé€šè¿‡åˆ†åŒºå·¥å…·åˆ é™¤ Manjaro çš„æ‰€æœ‰åˆ†åŒºï¼Œæˆ‘æ˜¯ SSDï¼Œåªæœ‰ä¸€ä¸ªåˆ†åŒº # 5. é‡å¯ç³»ç»Ÿï¼Œæ‰€æœ‰ä¸œè¥¿å°±å…¨åˆ é™¤å¹²å‡€äº†ã€‚ ","date":"2019-07-13","objectID":"/posts/manjaro-instruction/:4:0","tags":["Manjaro","Linux","Arch Linux"],"title":"Manjaro ä½¿ç”¨æŒ‡å—","uri":"/posts/manjaro-instruction/"},{"categories":["æŠ€æœ¯"],"content":"å‚è€ƒ Arch Linux Wiki - ä¸­æ–‡ AUR ä»“åº“ Arch Linux ä¸­æ–‡ç¤¾åŒºä»“åº“ yay - Yet another Yogurt - An AUR Helper written in Go å®‰è£…Manjaroä¹‹åçš„é…ç½® Arch Linux Wiki - Fcitx5 ","date":"2019-07-13","objectID":"/posts/manjaro-instruction/:5:0","tags":["Manjaro","Linux","Arch Linux"],"title":"Manjaro ä½¿ç”¨æŒ‡å—","uri":"/posts/manjaro-instruction/"},{"categories":["æŠ€æœ¯"],"content":" ä¸ªäººç¬”è®°ï¼Œä¸ä¿è¯æ­£ç¡®ã€‚ ","date":"2019-05-21","objectID":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/:0:0","tags":["SQLAlchemy","Python","ORM","åç«¯"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰ï¼šORM ä¸­çš„å…³ç³»æ„å»º","uri":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/"},{"categories":["æŠ€æœ¯"],"content":"å…³ç³»æ„å»ºï¼šForeignKey ä¸ relationship å…³ç³»æ„å»ºçš„é‡ç‚¹ï¼Œåœ¨äºææ¸…æ¥šè¿™ä¸¤ä¸ªå‡½æ•°çš„ç”¨æ³•ã€‚ForeignKey çš„ç”¨æ³•å·²ç»åœ¨ SQLè¡¨è¾¾å¼è¯­è¨€ - è¡¨å®šä¹‰ä¸­çš„çº¦æŸ è®²è¿‡äº†ã€‚ä¸»è¦æ˜¯ ondelete å’Œ onupdate ä¸¤ä¸ªå‚æ•°çš„ç”¨æ³•ã€‚ ","date":"2019-05-21","objectID":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/:1:0","tags":["SQLAlchemy","Python","ORM","åç«¯"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰ï¼šORM ä¸­çš„å…³ç³»æ„å»º","uri":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/"},{"categories":["æŠ€æœ¯"],"content":"relationship relationship å‡½æ•°åœ¨ ORM ä¸­ç”¨äºæ„å»ºè¡¨ä¹‹é—´çš„å…³è”å…³ç³»ã€‚ä¸ ForeignKey ä¸åŒçš„æ˜¯ï¼Œå®ƒå®šä¹‰çš„å…³ç³»ä¸å±äºè¡¨å®šä¹‰ï¼Œè€Œæ˜¯åŠ¨æ€è®¡ç®—çš„ã€‚ ç”¨å®ƒå®šä¹‰å‡ºæ¥çš„å±æ€§ï¼Œç›¸å½“äº SQL ä¸­çš„è§†å›¾ã€‚ è¿™ä¸ªå‡½æ•°æœ‰ç‚¹éš¾ç”¨ï¼Œä¸€æ˜¯å› ä¸ºå®ƒçš„æœ‰å‡ ä¸ªå‚æ•°ä¸å¤ªå¥½ç†è§£ï¼ŒäºŒæ˜¯å› ä¸ºå®ƒçš„å‚æ•°éå¸¸ä¸°å¯Œï¼Œè®©äººæœ›è€Œå´æ­¥ã€‚ä¸‹é¢é€šè¿‡ä¸€å¯¹å¤šã€å¤šå¯¹ä¸€ã€å¤šå¯¹å¤šå‡ ä¸ªåœºæ™¯ä¸‹ relationship çš„ä½¿ç”¨ï¼Œæ¥ä¸€æ­¥æ­¥ç†Ÿæ‚‰å®ƒçš„ç”¨æ³•ã€‚ é¦–å…ˆåˆå§‹åŒ–ï¼š from sqlalchemy import Table, Column, Integer, ForeignKey from sqlalchemy.orm import relationship from sqlalchemy.ext.declarative import declarative_base Base = declarative_base() ","date":"2019-05-21","objectID":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/:2:0","tags":["SQLAlchemy","Python","ORM","åç«¯"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰ï¼šORM ä¸­çš„å…³ç³»æ„å»º","uri":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/"},{"categories":["æŠ€æœ¯"],"content":"ä¸€å¯¹å¤š class Parent(Base): __tablename__ = 'parent' id = Column(Integer, primary_key=True) # å› ä¸º Child ä¸­æœ‰ Parent çš„ ForeignKeyï¼Œè¿™è¾¹çš„å£°æ˜ä¸éœ€è¦å†é¢å¤–æŒ‡å®šä»€ä¹ˆã€‚ children = relationship(\"Child\") # children çš„é›†åˆï¼Œç›¸å½“äºä¸€ä¸ªè§†å›¾ã€‚ class Child(Base): __tablename__ = 'child' id = Column(Integer, primary_key=True) parent_id = Column(Integer, ForeignKey('parent.id')) ä¸€ä¸ª Parent å¯ä»¥æœ‰å¤šä¸ª Childrenï¼Œé€šè¿‡ relationshipï¼Œæˆ‘ä»¬å°±èƒ½ç›´æ¥é€šè¿‡ parent.children å¾—åˆ°ç»“æœï¼Œå…å»ç¹ççš„ query è¯­å¥ã€‚ åå‘å¼•ç”¨ 1. backref ä¸ back_populates é‚£å¦‚æœæˆ‘ä»¬éœ€è¦å¾—çŸ¥ child çš„ parent å¯¹è±¡å‘¢ï¼Ÿèƒ½ä¸èƒ½ç›´æ¥è®¿é—® child.parentï¼Ÿ ä¸ºäº†å®ç°è¿™ä¸ªåŠŸèƒ½ï¼ŒSQLAlchemy æä¾›äº† backref å’Œ back_populates ä¸¤ä¸ªå‚æ•°ã€‚ ä¸¤ä¸ªå‚æ•°çš„æ•ˆæœå®Œå…¨ä¸€è‡´ï¼ŒåŒºåˆ«åœ¨äºï¼Œbackref åªéœ€è¦åœ¨ Parent ç±»ä¸­å£°æ˜ childrenï¼ŒChild.parent ä¼šè¢«åŠ¨æ€åˆ›å»ºã€‚ è€Œ back_populates å¿…é¡»åœ¨ä¸¤ä¸ªç±»ä¸­æ˜¾å¼åœ°ä½¿ç”¨ back_populatesï¼Œæ›´æ˜¾ç¹çã€‚ï¼ˆä½†æ˜¯ä¹Ÿæ›´æ¸…æ™°ï¼Ÿï¼‰ å…ˆçœ‹ backref ç‰ˆï¼š class Parent(Base): __tablename__ = 'parent' id = Column(Integer, primary_key=True) children = relationship(\"Child\", backref=\"parent\") # backref è¡¨ç¤ºï¼Œåœ¨ Child ç±»ä¸­åŠ¨æ€åˆ›å»º parent å±æ€§ï¼ŒæŒ‡å‘å½“å‰ç±»ã€‚ # Child ç±»ä¸éœ€è¦ä¿®æ”¹ å†çœ‹ back_populates ç‰ˆï¼š class Parent(Base): __tablename__ = 'parent' id = Column(Integer, primary_key=True) children = relationship(\"Child\", back_populates=\"parent\") # back_populates class Child(Base): __tablename__ = 'child' id = Column(Integer, primary_key=True) parent_id = Column(Integer, ForeignKey('parent.id')) # è¿™è¾¹ä¹Ÿå¿…é¡»å£°æ˜ï¼Œä¸èƒ½çœç•¥ï¼ parent = relationship(\"Parent\", back_populates=\"children\") # parent ä¸æ˜¯é›†åˆï¼Œæ˜¯å±æ€§ï¼ NOTEï¼šå£°æ˜çš„ä¸¤ä¸ª relationship ä¸éœ€è¦å¤šä½™çš„è¯´æ˜ï¼ŒSQLAlchemy èƒ½è‡ªåŠ¨è¯†åˆ«åˆ° parent.children æ˜¯ collectionï¼Œchild.parent æ˜¯ attribute. 2. åå‘å¼•ç”¨çš„å‚æ•°ï¼šsqlalchemy.orm.backref(name, **kwargs) ä½¿ç”¨ back_populates æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°åœ¨ä¸¤ä¸ª relationship å‡½æ•°ä¸­æŒ‡å®šå„ç§å‚æ•°ï¼š class Parent(Base): __tablename__ = 'parent' id = Column(Integer, primary_key=True) children = relationship(\"Child\", back_populates=\"parent\", lazy='dynamic') # æŒ‡å®š lazy çš„å€¼ class Child(Base): __tablename__ = 'child' id = Column(Integer, primary_key=True) parent_id = Column(Integer, ForeignKey('parent.id')) parent = relationship(\"Parent\", back_populates=\"children\", lazy='dynamic') # æŒ‡å®š lazy çš„å€¼ ä½†æ˜¯å¦‚æœä½¿ç”¨ backrefï¼Œå› ä¸ºæˆ‘ä»¬åªæœ‰ä¸€ä¸ª relationship å‡½æ•°ï¼ŒChild.parent æ˜¯è¢«éšå¼åˆ›å»ºçš„ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•æŒ‡å®šè¿™ä¸ªå±æ€§çš„å‚æ•°å‘¢ï¼Ÿ ç­”æ¡ˆå°±æ˜¯ backref() å‡½æ•°ï¼Œä½¿ç”¨å®ƒæ›¿ä»£ backref å‚æ•°çš„å€¼ï¼š from sqlalchemy.orm import backref class Parent(Base): __tablename__ = 'parent' id = Column(Integer, primary_key=True) children = relationship(\"Child\", backref=backref(\"parent\", lazy='dynamic')) # ä½¿ç”¨ backref() å‡½æ•°ï¼ŒæŒ‡å®š Child.parent å±æ€§çš„å‚æ•° # Child ç±»ä¸éœ€è¦ä¿®æ”¹ backref() çš„å‚æ•°ä¼šè¢«ä¼ é€’ç»™ relationship()ï¼Œå› æ­¤å®ƒä¿©çš„å‚æ•°ä¹Ÿå®Œå…¨ä¸€è‡´ã€‚ ","date":"2019-05-21","objectID":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/:2:1","tags":["SQLAlchemy","Python","ORM","åç«¯"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰ï¼šORM ä¸­çš„å…³ç³»æ„å»º","uri":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/"},{"categories":["æŠ€æœ¯"],"content":"å¤šå¯¹ä¸€ A many-to-one is similar to a one-to-many relationship. The difference is that this relationship is looked at from the â€œmanyâ€ side. ","date":"2019-05-21","objectID":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/:2:2","tags":["SQLAlchemy","Python","ORM","åç«¯"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰ï¼šORM ä¸­çš„å…³ç³»æ„å»º","uri":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/"},{"categories":["æŠ€æœ¯"],"content":"ä¸€å¯¹ä¸€ class Parent(Base): __tablename__ = 'parent' id = Column(Integer, primary_key=True) child = relationship(\"Child\", uselist=False, # ä¸ä½¿ç”¨ collectionï¼è¿™æ˜¯å…³é”® back_populates=\"parent\") class Child(Base): __tablename__ = 'child' id = Column(Integer, primary_key=True) parent_id = Column(Integer, ForeignKey('parent.id')) # åŒ…å« ForeignKey çš„ç±»ï¼Œæ­¤å±æ€§é»˜è®¤ä¸º attributeï¼Œå› æ­¤ä¸éœ€è¦ uselist=False parent = relationship(\"Parent\", back_populates=\"child\") ","date":"2019-05-21","objectID":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/:2:3","tags":["SQLAlchemy","Python","ORM","åç«¯"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰ï¼šORM ä¸­çš„å…³ç³»æ„å»º","uri":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/"},{"categories":["æŠ€æœ¯"],"content":"å¤šå¯¹å¤š # å¤šå¯¹å¤šï¼Œå¿…é¡»è¦ä½¿ç”¨ä¸€ä¸ªå…³è”è¡¨ï¼ association_table = Table('association', Base.metadata, Column('left_id', Integer, ForeignKey('left.id')), # çº¦å®šä¿—æˆçš„è§„çŸ©ï¼Œå·¦è¾¹æ˜¯ parent Column('right_id', Integer, ForeignKey('right.id')) # å³è¾¹æ˜¯ child ) class Parent(Base): __tablename__ = 'left' id = Column(Integer, primary_key=True) children = relationship(\"Child\", secondary=association_table) # ä¸“ç”¨å‚æ•° secondaryï¼Œç”¨äºæŒ‡å®šä½¿ç”¨çš„å…³è”è¡¨ class Child(Base): __tablename__ = 'right' id = Column(Integer, primary_key=True) è¦æ·»åŠ åå‘å¼•ç”¨æ—¶ï¼ŒåŒæ ·å¯ä»¥ä½¿ç”¨ backref æˆ– back_populates. user2user å¦‚æœå¤šå¯¹å¤šå…³ç³»ä¸­çš„ä¸¤è¾¹éƒ½æ˜¯ userï¼Œå³éƒ½æ˜¯åŒä¸€ä¸ªè¡¨æ—¶ï¼Œè¯¥æ€ä¹ˆå£°æ˜ï¼Ÿ ä¾‹å¦‚ç”¨æˆ·çš„ã€Œå…³æ³¨ã€ä¸ã€Œç²‰ä¸ã€ï¼Œä½ æ˜¯ userï¼Œä½ çš„ç²‰ä¸æ˜¯ userï¼Œä½ å…³æ³¨çš„è´¦å·ä¹Ÿæ˜¯ userã€‚ è¿™ä¸ªæ—¶å€™ï¼Œå…³è”è¡¨ association_table çš„ä¸¤ä¸ªé”®éƒ½æ˜¯ userï¼ŒSQLAlchemy æ— æ³•åŒºåˆ†ä¸»æ¬¡ï¼Œéœ€è¦æ‰‹åŠ¨æŒ‡å®šï¼Œä¸ºæ­¤éœ€è¦ä½¿ç”¨ primaryjoin å’Œ secondaryjoin ä¸¤ä¸ªå‚æ•°ã€‚ # å…³è”è¡¨ï¼Œå·¦ä¾§çš„ user æ­£åœ¨å…³æ³¨å³ä¾§çš„ user followers = db.Table('followers', db.Column('follower_id', db.Integer, db.ForeignKey('user.id')), # å·¦ä¾§ db.Column('followed_id', db.Integer, db.ForeignKey('user.id')) # å³ä¾§ï¼Œè¢«å…³æ³¨çš„ user ) class User(UserMixin, db.Model): id = db.Column(db.Integer, primary_key=True) username = db.Column(db.String(64), index=True, unique=True, nullable=False) email = db.Column(db.String(120), index=True, unique=True, nullable=False) password_hash = db.Column(db.String(128), nullable=False) # æˆ‘å…³æ³¨çš„ users followed = db.relationship( 'User', secondary=followers, # æŒ‡å®šå¤šå¯¹å¤šå…³è”è¡¨ primaryjoin=(followers.c.follower_id == id), # å·¦ä¾§ï¼Œç”¨äºè·å–ã€Œæˆ‘å…³æ³¨çš„ usersã€çš„ join æ¡ä»¶ secondaryjoin=(followers.c.followed_id == id), # å³ä¾§ï¼Œç”¨äºè·å–ã€Œæˆ‘çš„ç²‰ä¸ã€çš„ join æ¡ä»¶ lazy='dynamic', # å»¶è¿Ÿæ±‚å€¼ï¼Œè¿™æ ·æ‰èƒ½ç”¨ filter_by ç­‰è¿‡æ»¤å‡½æ•° backref=db.backref('followers', lazy='dynamic')) # followers ä¹Ÿè¦å»¶è¿Ÿæ±‚å€¼ è¿™é‡Œæ¯”è¾ƒç»•çš„ï¼Œå°±æ˜¯å®¹æ˜“ææ·· primaryjoin å’Œ secondaryjoin ä¸¤ä¸ªå‚æ•°ã€‚ primaryjoinï¼šï¼ˆå¤šå¯¹å¤šä¸­ï¼‰ç”¨äºä»å­å¯¹è±¡æŸ¥è¯¢å…¶çˆ¶å¯¹è±¡çš„ conditionï¼ˆchild.parentsï¼‰ï¼Œé»˜è®¤åªè€ƒè™‘å¤–é”®ã€‚ secondaryjoinï¼šï¼ˆå¤šå¯¹å¤šä¸­ï¼‰ç”¨äºä»çˆ¶å¯¹è±¡æŸ¥è¯¢å…¶æ‰€æœ‰å­å¯¹è±¡çš„ conditionï¼ˆparent.childrenï¼‰ï¼ŒåŒæ ·çš„ï¼Œé»˜è®¤æƒ…å†µä¸‹åªè€ƒè™‘å¤–é”®ã€‚ ","date":"2019-05-21","objectID":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/:2:4","tags":["SQLAlchemy","Python","ORM","åç«¯"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰ï¼šORM ä¸­çš„å…³ç³»æ„å»º","uri":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/"},{"categories":["æŠ€æœ¯"],"content":"ORM å±‚ çš„ â€œdeleteâ€ cascade vs. FOREIGN KEY å±‚çš„ â€œON DELETEâ€ cascade ä¹‹å‰æœ‰è®²è¿‡ Table å®šä¹‰ä¸­çš„çº§è”æ“ä½œï¼šON DELETE å’Œ ON UPDATEï¼Œå¯ä»¥é€šè¿‡ ForeignKey çš„å‚æ•°æŒ‡å®šä¸º CASCADE. å¯ SQLAlchemy è¿˜æœ‰ä¸€ä¸ª relationship ç”Ÿæˆ SQL è¯­å¥æ—¶çš„é…ç½®å‚æ•° cascadeï¼Œå¦å¤– passive_deletes ä¹Ÿå¯ä»¥æŒ‡å®šä¸º cascadeã€‚ æœ‰è¿™ä¹ˆå¤šçš„ cascadeï¼Œæˆ‘çœŸçš„æ˜¯å¾ˆæ‡µã€‚è¿™ä¸‰ä¸ª cascade åˆ°åº•æœ‰ä½•å·®åˆ«å‘¢ï¼Ÿ å¤–é”®çº¦æŸä¸­çš„ ON DELETE å’Œ ON UPDATEï¼Œä¸ ORM å±‚çš„ CASCADE åœ¨åŠŸèƒ½ä¸Šï¼Œç¡®å®æœ‰å¾ˆå¤šé‡å çš„åœ°æ–¹ã€‚ ä½†æ˜¯ä¹Ÿæœ‰å¾ˆå¤šä¸åŒï¼š æ•°æ®åº“å±‚é¢çš„ ON DELETE çº§è”èƒ½é«˜æ•ˆåœ°å¤„ç† many-to-one çš„å…³è”ï¼›æˆ‘ä»¬åœ¨ many æ–¹å®šä¹‰å¤–é”®ï¼Œä¹Ÿåœ¨è¿™é‡Œæ·»åŠ  ON DELETE çº¦æŸã€‚è€Œåœ¨ ORM å±‚ï¼Œå°±åˆšå¥½ç›¸åã€‚SQLAlchemy åœ¨ one æ–¹å¤„ç† many æ–¹çš„åˆ é™¤æ“ä½œï¼Œè¿™æ„å‘³ç€å®ƒæ›´é€‚åˆå¤„ç† one-to-many çš„å…³è”ã€‚ æ•°æ®åº“å±‚é¢ä¸Šï¼Œä¸å¸¦ ON DELETE çš„å¤–é”®å¸¸ç”¨äºé˜²æ­¢çˆ¶æ•°æ®è¢«åˆ é™¤ï¼Œè€Œå¯¼è‡´å­æ•°æ®æˆä¸ºæ— æ³•è¢«ç´¢å¼•åˆ°çš„åƒåœ¾æ•°æ®ã€‚å¦‚æœè¦åœ¨ä¸€ä¸ª one-to-many æ˜ å°„ä¸Šå®ç°è¿™ä¸ªè¡Œä¸ºï¼ŒSQLAlchemy å°†å¤–é”®è®¾ç½®ä¸º NULL çš„é»˜è®¤è¡Œä¸ºå¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼ä¹‹ä¸€æ•è·ï¼š æœ€ç®€å•ä¹Ÿæœ€å¸¸ç”¨çš„æ–¹æ³•ï¼Œå½“ç„¶æ˜¯å°†å¤–é”®å®šä¹‰ä¸º NOT NULL. å°è¯•å°†è¯¥åˆ—è®¾ä¸º NULL ä¼šè§¦å‘ NOT NULL constraint exception. å¦ä¸€ç§æ›´ç‰¹æ®Šçš„æ–¹æ³•ï¼Œæ˜¯å°† passive_deletes æ ‡å¿—è®¾ç½®ä¸ºå­— all. è¿™ä¼šå®Œå…¨ç¦ç”¨ SQLAlchemy å°†å¤–é”®åˆ—è®¾ç½®ä¸º NULL çš„è¡Œä¸ºï¼Œå¹¶ä¸” DELETE çˆ¶æ•°æ®è€Œä¸ä¼šå¯¹å­æ•°æ®äº§ç”Ÿä»»ä½•å½±å“ã€‚è¿™æ ·æ‰èƒ½è§¦å‘æ•°æ®åº“å±‚é¢çš„ ON DELETE çº¦æŸï¼Œæˆ–è€…å…¶ä»–çš„è§¦å‘å™¨ã€‚ æ•°æ®åº“å±‚é¢çš„ ON DELETE çº§è” æ¯” ORM å±‚é¢çš„çº§è”æ›´é«˜æ•ˆã€‚æ•°æ®åº“å¯ä»¥åŒæ—¶åœ¨å¤šä¸ª relationship ä¸­é“¾æ¥ä¸€ç³»åˆ—çº§è”æ“ä½œã€‚ SQLAlchemy ä¸éœ€è¦è¿™ä¹ˆå¤æ‚ï¼Œå› ä¸ºæˆ‘ä»¬é€šè¿‡å°† passive_deletes é€‰é¡¹ä¸æ­£ç¡®é…ç½®çš„å¤–é”®çº¦æŸç»“åˆä½¿ç”¨ï¼Œæä¾›ä¸æ•°æ®åº“çš„ ON DELETE åŠŸèƒ½çš„å¹³æ»‘é›†æˆã€‚ ","date":"2019-05-21","objectID":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/:3:0","tags":["SQLAlchemy","Python","ORM","åç«¯"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰ï¼šORM ä¸­çš„å…³ç³»æ„å»º","uri":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/"},{"categories":["æŠ€æœ¯"],"content":"æ–¹æ³•ä¸€ï¼šORM å±‚çš„ cascade å®ç° relationship çš„ cascade å‚æ•°å†³å®šäº†ä¿®æ”¹çˆ¶è¡¨æ—¶ï¼Œä»€ä¹ˆæ—¶å€™å­è¡¨è¦è¿›è¡Œçº§è”æ“ä½œã€‚å®ƒçš„å¯é€‰é¡¹æœ‰ï¼ˆstrï¼Œé€‰é¡¹ä¹‹é—´ç”¨é€—å·åˆ†éš”ï¼‰ï¼š save-updateï¼šé»˜è®¤é€‰é¡¹ä¹‹ä¸€ã€‚åœ¨ addï¼ˆå¯¹åº” SQL çš„ insert æˆ– updateï¼‰ä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œä¼š add æ‰€æœ‰å®ƒç›¸å…³è”çš„å¯¹è±¡ã€‚ mergeï¼šé»˜è®¤é€‰é¡¹ä¹‹ä¸€ã€‚åœ¨ mergeï¼ˆç›¸å½“å­—å…¸çš„updateæ“ä½œï¼Œæœ‰å°±æ›¿æ¢æ‰ï¼Œæ²¡æœ‰å°±åˆå¹¶ï¼‰ä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œä¼š merge æ‰€æœ‰å’Œå®ƒç›¸å…³è”çš„å¯¹è±¡ã€‚ expunge ï¼šç§»é™¤æ“ä½œçš„æ—¶å€™ï¼Œä¼šå°†ç›¸å…³è”çš„å¯¹è±¡ä¹Ÿè¿›è¡Œç§»é™¤ã€‚è¿™ä¸ªæ“ä½œåªæ˜¯ä»sessionä¸­ç§»é™¤ï¼Œå¹¶ä¸ä¼šçœŸæ­£çš„ä»æ•°æ®åº“ä¸­åˆ é™¤ã€‚ deleteï¼šåˆ é™¤çˆ¶è¡¨æ•°æ®æ—¶ï¼ŒåŒæ—¶åˆ é™¤ä¸å®ƒå…³è”çš„æ•°æ®ã€‚ delete-orphanï¼šå½“å­å¯¹è±¡ä¸çˆ¶å¯¹è±¡è§£é™¤å…³ç³»æ—¶ï¼Œåˆ é™¤æ‰æ­¤å­å¯¹è±¡ï¼ˆå­¤å„¿ï¼‰ã€‚ï¼ˆå…¶å®è¿˜æ˜¯æ²¡æ‡‚ã€‚ã€‚ï¼‰ refresh-expireï¼šä¸å¸¸ç”¨ã€‚ allï¼šè¡¨ç¤ºé€‰ä¸­é™¤ delete-orphan ä¹‹å¤–çš„æ‰€æœ‰é€‰é¡¹ã€‚ï¼ˆå› æ­¤ all, delete-orphan å¾ˆå¸¸ç”¨ï¼Œå®ƒæ‰æ˜¯çœŸæ­£çš„ allï¼‰ é»˜è®¤å±æ€§æ˜¯ â€œsave-update, mergeâ€. è¿™åªæ˜¯ç®€ç•¥çš„è¯´æ˜ï¼Œä¸Šè¿°å‡ ä¸ªå‚æ•°çš„è¯¦ç»†æ–‡æ¡£è§ SQLAlchemy - Cascades ","date":"2019-05-21","objectID":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/:3:1","tags":["SQLAlchemy","Python","ORM","åç«¯"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰ï¼šORM ä¸­çš„å…³ç³»æ„å»º","uri":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/"},{"categories":["æŠ€æœ¯"],"content":"æ–¹æ³•äºŒï¼šæ•°æ®åº“å±‚çš„ cascade å®ç° å°† ForeignKey çš„ ondelete å’Œ onupdate å‚æ•°æŒ‡å®šä¸º CASCADEï¼Œå®ç°æ•°æ®åº“å±‚é¢çš„çº§è”ã€‚ ä¸º relationship æ·»åŠ å…³é”®å­—å‚æ•° passive_deletes=\"all\"ï¼Œè¿™æ ·å°±å®Œå…¨ç¦ç”¨ SQLAlchemy å°†å¤–é”®åˆ—è®¾ç½®ä¸º NULL çš„è¡Œä¸ºï¼Œå¹¶ä¸” DELETE çˆ¶æ•°æ®ä¸ä¼šå¯¹å­æ•°æ®äº§ç”Ÿä»»ä½•å½±å“ã€‚ è¿™æ · DELETE æ“ä½œæ—¶ï¼Œå°±ä¼šè§¦å‘æ•°æ®åº“çš„ ON DELETE çº¦æŸï¼Œä»è€Œçº§è”åˆ é™¤å­æ•°æ®ã€‚ ","date":"2019-05-21","objectID":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/:3:2","tags":["SQLAlchemy","Python","ORM","åç«¯"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰ï¼šORM ä¸­çš„å…³ç³»æ„å»º","uri":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/"},{"categories":["æŠ€æœ¯"],"content":"å‚è€ƒ SQLAlchemy - Relationship Configuration SQLAlchemy - Cascades SQLAlchemy ä¸­çš„ backref å’Œ back_populates The Flask Mega-Tutorial Part VIII: Followers hackersandslackers/sqlalchemy-tutorial ","date":"2019-05-21","objectID":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/:4:0","tags":["SQLAlchemy","Python","ORM","åç«¯"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰ï¼šORM ä¸­çš„å…³ç³»æ„å»º","uri":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/"},{"categories":["æŠ€æœ¯"],"content":"ç…§ä¾‹å…ˆçœ‹å±‚æ¬¡å›¾ SQLAlchemy å±‚æ¬¡ç»“æ„\" SQLAlchemy å±‚æ¬¡ç»“æ„ ","date":"2019-02-11","objectID":"/posts/sqlalchemy-notes-2-orm-basics/:0:0","tags":["SQLAlchemy","Python","ORM","åç«¯"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šORM åŸºç¡€","uri":"/posts/sqlalchemy-notes-2-orm-basics/"},{"categories":["æŠ€æœ¯"],"content":"ä¸€ã€å£°æ˜æ˜ å°„å…³ç³» ä½¿ç”¨ ORM æ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å®šä¹‰è¦æ“ä½œçš„è¡¨ï¼ˆé€šè¿‡ Tableï¼‰ï¼Œç„¶åå†å®šä¹‰è¯¥è¡¨å¯¹åº”çš„ Python classï¼Œå¹¶å£°æ˜ä¸¤è€…ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼ˆé€šè¿‡ Mapperï¼‰ã€‚ æ–¹ä¾¿èµ·è§ï¼ŒSQLAlchemy æä¾›äº† Declarative ç³»ç»Ÿæ¥ä¸€æ¬¡å®Œæˆä¸Šè¿°ä¸‰ä¸ªæ­¥éª¤ï¼ŒDeclarative ç³»ç»Ÿæä¾› base classï¼Œè¿™ä¸ª base class ä¼šä¸ºç»§æ‰¿äº†å®ƒçš„ Python classï¼ˆå¯ç§°ä½œ modelï¼‰åˆ›å»º Tableï¼Œå¹¶ç»´æŠ¤ä¸¤è€…çš„æ˜ å°„å…³ç³»ã€‚ from sqlalchemy.ext.declarative import declarative_base from SQLAlchemy import Column, Integer, String Base = declarative_base() # æ‹¿åˆ° Base ç±» class User(Base): id = Column(Integer, primary_key=True) username = Column(String(32), nullable=False, index=True) # æ·»åŠ  index æå‡æœç´¢æ•ˆç‡ fullname = Column(String(64)) password = Column(String(32)) # çœŸå®æƒ…å†µä¸‹ä¸€èˆ¬åªå­˜ hash def __repr__(self): return f\"\u003cUser {self.username}\u003e\" è¿™æ ·å°±å£°æ˜å¥½äº†ä¸€ä¸ªå¯¹è±¡-å…³ç³»æ˜ å°„ï¼Œä¸Šä¸€ç¯‡æ–‡ç« è¯´è¿‡æ‰€æœ‰çš„ Table éƒ½åœ¨æŸä¸ª MetaData ä¸­ï¼Œå¯ä»¥é€šè¿‡ Base.metadata è·å–å®ƒã€‚ Base.metadata.create_all(engine) # é€šè¿‡ metadata åˆ›å»ºè¡¨ï¼ˆæˆ–è€…è¯´ç”Ÿæˆæ¨¡å¼ schemaï¼‰ engine çš„åˆ›å»ºè¯·è§ä¸Šç¯‡æ–‡æ¡£ SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šEngine ä¸ SQL è¡¨è¾¾å¼è¯­è¨€ çº¦æŸæ¡ä»¶ å¯å‚è€ƒ SQL åŸºç¡€ç¬”è®°ï¼ˆä¸‰ï¼‰ï¼šçº¦æŸ ä¸ SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šEngine ä¸ SQL è¡¨è¾¾å¼è¯­è¨€ - è¡¨å®šä¹‰ä¸­çš„çº¦æŸ ä½¿ç”¨ ORM æ¥å®šä¹‰çº¦æŸæ¡ä»¶ï¼Œä¸ç›´æ¥ä½¿ç”¨ SQL è¡¨è¾¾å¼è¯­è¨€å®šä¹‰å¾ˆç±»ä¼¼ï¼Œä¹Ÿæœ‰ä¸¤ç§æ–¹æ³•ï¼š ç›´æ¥å°†çº¦æŸæ¡ä»¶ä½œä¸º Columnã€ForeignKey çš„å‚æ•°ä¼ å…¥ã€‚è¿™ç§æ–¹å¼æœ€ç®€æ´ï¼Œä¹Ÿæœ€å¸¸ç”¨ã€‚ ä½¿ç”¨ UniqueConstraintã€CheckConstraint ç­‰ç±»æ„é€ çº¦æŸï¼Œç„¶åæ”¾å…¥ __table_args__ å±æ€§ä¸­ã€‚ä¸¾ä¾‹ï¼š class User(Base): id = Column(Integer, primary_key=True) username = Column(String(32), nullable=False, index=True) # æ·»åŠ  index æå‡æœç´¢æ•ˆç‡ fullname = Column(String(64)) password = Column(String(32)) # çœŸå®æƒ…å†µä¸‹ä¸€èˆ¬åªå­˜ hash # é¡¾åæ€ä¹‰ï¼Œè¿™æ˜¯ `Table` ç±»çš„å‚æ•°çš„åºåˆ—ã€‚é‡Œé¢çš„çº¦æŸæ¡ä»¶ä¼šè¢«ç”¨äºæ„å»º __table__ __table_args__ = (UniqueConstraint('username', name='c_user'),) # username çš„å”¯ä¸€æ€§çº¦æŸ def __repr__(self): return f\"\u003cUser {self.username}\u003e\" ","date":"2019-02-11","objectID":"/posts/sqlalchemy-notes-2-orm-basics/:0:1","tags":["SQLAlchemy","Python","ORM","åç«¯"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šORM åŸºç¡€","uri":"/posts/sqlalchemy-notes-2-orm-basics/"},{"categories":["æŠ€æœ¯"],"content":"äºŒã€è·å– session ä¸Šä¸€èŠ‚è®² engine æ—¶ï¼Œæˆ‘ä»¬æ˜¯é€šè¿‡ connection æ¥ä¸æ•°æ®åº“äº¤äº’ï¼Œè€Œåœ¨ ORM ä¸­æˆ‘ä»¬ä½¿ç”¨ Session è®¿é—®æ•°æ®åº“ã€‚ from sqlalchemy.orm import sessionmaker Session = sessionmaker(bind=engine) # è·å– session ","date":"2019-02-11","objectID":"/posts/sqlalchemy-notes-2-orm-basics/:0:2","tags":["SQLAlchemy","Python","ORM","åç«¯"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šORM åŸºç¡€","uri":"/posts/sqlalchemy-notes-2-orm-basics/"},{"categories":["æŠ€æœ¯"],"content":"ä¸‰ã€å¢åˆ æ”¹æŸ¥ ç›´æ¥ä½¿ç”¨ SQL è¡¨è¾¾å¼è¯­è¨€æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ insert()ã€select()ã€update()ã€delete() å››ä¸ªå‡½æ•°æ„é€  SQLï¼Œä½¿ç”¨ where() æ·»åŠ æ¡ä»¶ï¼Œä½¿ç”¨ model.join(another_model) è¿›è¡Œ join æ“ä½œã€‚ è€Œä½¿ç”¨ ORM æ—¶ï¼Œæ•°æ®åº“æ“ä½œä¸å†ä¸ SQL ç›´æ¥å¯¹åº”ã€‚æˆ‘ä»¬ç°åœ¨æ˜¯é€šè¿‡æ“ä½œ Python å¯¹è±¡æ¥æ“ä½œæ•°æ®åº“äº†ã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬é€šè¿‡ db.session.add()ã€db.session.delete() è¿›è¡Œæ·»åŠ ä¸åˆ é™¤ï¼Œä½¿ç”¨ db.session.query(Model) è¿›è¡ŒæŸ¥è¯¢ï¼Œé€šè¿‡ filter å’Œ filter_by æ·»åŠ è¿‡æ»¤æ¡ä»¶ã€‚ è€Œä¿®æ”¹ï¼Œåˆ™æ˜¯å…ˆæŸ¥è¯¢å‡ºå¯¹åº”çš„ row å¯¹è±¡ï¼Œç›´æ¥ä¿®æ”¹è¿™ä¸ªå¯¹è±¡ï¼Œç„¶å commit å°±è¡Œã€‚ å¢æ·»ï¼š ed_user = User(name='ed', fullname='Ed Jones', password='edspassword') # ç”¨æ„é€ å™¨æ„é€ å¯¹è±¡ session.add(ed_user) # æ·»åŠ ï¼Œæ­¤å¤–è¿˜æœ‰æ‰¹é‡æ·»åŠ  add_all([user1, user2...]) session.commit() # å¿…é¡»æ‰‹åŠ¨ commit ä¿®æ”¹ï¼š ed_user = session.query(User).filter_by(name='ed').first() # å…ˆè·å–åˆ° User å¯¹è±¡ ed_user.password = 'f8s7ccs' # æ”¹äº†å¯†ç  session.commit() # æäº¤ # æ‰¹é‡ä¿®æ”¹ session.query(User).filter(User.home=='shanghai') \\ .update({User.login_num:0}) # å°†æ‰€æœ‰ä¸Šæµ·çš„ç”¨æˆ·çš„ login_num è®¾ä¸º 0 session.commit() åˆ é™¤ï¼š ed_user = session.query(User).filter_by(name='ed').first() # å…ˆè·å–åˆ° User å¯¹è±¡ session.delete(ed_user) # ç›´æ¥åˆ é™¤ï¼ˆsession çŸ¥é“ ed_user å±äºå“ªä¸ªè¡¨ï¼‰ session.commit() # æäº¤ # æ‰¹é‡åˆ é™¤ session.query(User).filter(User.home=='shanghai') \\ .delete() # åˆ é™¤æ‰€æœ‰ä¸Šæµ·çš„ç”¨æˆ· session.commit() åŒæ ·çš„ï¼Œä¹Ÿå¯ä»¥åœ¨å¤–é¢æ£€æŸ¥å¼‚å¸¸ï¼Œç„¶åè°ƒç”¨ session.rollback() å®ç°å¤±è´¥å›æ»šã€‚ ","date":"2019-02-11","objectID":"/posts/sqlalchemy-notes-2-orm-basics/:0:3","tags":["SQLAlchemy","Python","ORM","åç«¯"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šORM åŸºç¡€","uri":"/posts/sqlalchemy-notes-2-orm-basics/"},{"categories":["æŠ€æœ¯"],"content":"å››ã€è¿›é˜¶æŸ¥è¯¢ filter_byï¼šä½¿ç”¨å…³é”®å­—å‚æ•°è¿›è¡Œè¿‡æ»¤ï¼Œå‰é¢çš„æ¼”ç¤ºä¸­å·²ç»ç”¨è¿‡å¤šæ¬¡äº†ã€‚ filterï¼šå®ƒå¯¹åº” SQL è¡¨è¾¾å¼è¯­è¨€ä¸­çš„ whereï¼Œæ”¯æŒå„ç§å¤æ‚çš„ SQL è¯­æ³•ã€‚ group_by: é€šè¿‡æŒ‡å®š column åˆ†ç»„ distinct(): å»é‡ join(): å…³è” query.filter(User.name == 'ed') # è¿™ä¸ªç­‰åŒäº filter_byï¼Œä½†æ˜¯æ›´ç¹ç query.filter(User.name != 'ed') # ä¸ç­‰äºï¼Œè¿™ä¸ªå°±æ˜¯ filter_by æ— æ³•åšåˆ°çš„äº† query.filter(User.name.like('%ed%')) # SQL like çš„ like è¯­æ³• query.filter(User.name.in_(['ed', 'wendy', 'jack'])) # åŒ…å« # æŸ¥è¯¢è¿˜å¯ä»¥åµŒå¥— query.filter(User.name.in_( session.query(User.name).filter(User.name.like('%ed%')) )) query.filter(~User.name.in_(['ed', 'wendy', 'jack'])) # ä¸åŒ…å« query.filter(User.name == None) # NULL å¯¹åº” Python çš„ None from sqlalchemy import or_, and_, in_ query.filter(or_(User.name == 'ed', User.name == 'wendy')) # OR è¯­æ³• query.group_by(User.name) # åˆ†ç»„ query.distinct() # å»é‡ from sqlalchemy import func # SQL å‡½æ•°åŒ… session.query(func.count(User.name)).filter_by(xxx=xxx) # ä½¿ç”¨ count å‡½æ•° # join å…³è” # é»˜è®¤ä½¿ç”¨å†…è”ï¼ˆinnerï¼‰ï¼Œå³åªå–ä¸¤è¡¨çš„äº¤é›† session.query(User, Address).filter(User.id==Address.user_id) # æ–¹æ³•ä¸€ session.query(User).join(Address).\\ # æ–¹æ³•äºŒ filter(Address.email_address=='jack@google.com') # å¤–è” outer joinï¼Œå°†å¦ä¸€è¡¨çš„åˆ—è”ç»“åˆ°ä¸»è¡¨ï¼Œæ²¡æœ‰çš„è¡Œä¸º NULL session.query(User).outerjoin(User.addresses) \\ .filter(Address.email_address=='jack@google.com') æ‰§è¡ŒæŸ¥è¯¢ï¼Œè·å–æ•°æ® æŸ¥è¯¢è¿”å› query å¯¹è±¡ï¼Œä½† SQL è¿˜æ²¡æœ‰è¢«æ‰§è¡Œï¼Œç›´åˆ°ä½ è°ƒç”¨ä¸‹åˆ—å‡ ä¸ªæ–¹æ³•ï¼š # æ„é€  query å¯¹è±¡ query = session.query(User).filter(User.name.like('%ed')).order_by(User.id) # 1. all è¿”å›æ‰€æœ‰ç»“æœçš„åˆ—è¡¨ res_list = query.all() # 2. first å…ˆåœ¨ SQL ä¸­åŠ å…¥é™åˆ¶ `limit 1`ï¼Œç„¶åæ‰§è¡Œã€‚ res = query.first() # 3. one æ‰§è¡Œ sql å¹¶è·å–æ‰€æœ‰ç»“æœ # å¦‚æœç»“æœä¸æ­¢ä¸€è¡Œï¼ŒæŠ›å‡º MultipleResultsFound Errorï¼ï¼ï¼ # å¦‚æœç»“æœä¸ºç©ºï¼ŒæŠ›å‡º NoResultFound Error ï¼ï¼ï¼ res = query.one() 4. one_or_none å·®åˆ«åœ¨äºç»“æœä¸ºç©ºï¼Œå®ƒä¸æŠ›å‡ºå¼‚å¸¸ï¼Œè€Œæ˜¯è¿”å› None res = query.one_or_none() ","date":"2019-02-11","objectID":"/posts/sqlalchemy-notes-2-orm-basics/:0:4","tags":["SQLAlchemy","Python","ORM","åç«¯"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šORM åŸºç¡€","uri":"/posts/sqlalchemy-notes-2-orm-basics/"},{"categories":["æŠ€æœ¯"],"content":"å‚è€ƒ SQLAlchemy å¯¹è±¡å…³ç³»å…¥é—¨ SQLAlchemy ORM çš„å…³è”æ˜ å°„å®šä¹‰ï¼šä¸€å¯¹å¤šã€å¤šå¯¹å¤š hackersandslackers/sqlalchemy-tutorial ","date":"2019-02-11","objectID":"/posts/sqlalchemy-notes-2-orm-basics/:0:5","tags":["SQLAlchemy","Python","ORM","åç«¯"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šORM åŸºç¡€","uri":"/posts/sqlalchemy-notes-2-orm-basics/"},{"categories":["æŠ€æœ¯"],"content":"ä¸€ã€WebSocket WebSocket æ˜¯ä¸€ä¸ªåŒå‘é€šä¿¡åè®®ï¼Œå®ƒåœ¨æ¡æ‰‹é˜¶æ®µé‡‡ç”¨ HTTP/1.1 åè®®ï¼ˆæš‚æ—¶ä¸æ”¯æŒ HTTP/2ï¼‰ã€‚ æ¡æ‰‹è¿‡ç¨‹å¦‚ä¸‹ï¼š é¦–å…ˆå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘èµ·ä¸€ä¸ªç‰¹æ®Šçš„ HTTP è¯·æ±‚ï¼Œå…¶æ¶ˆæ¯å¤´å¦‚ä¸‹ï¼š GET /chat HTTP/1.1 // è¯·æ±‚è¡Œ Host: server.example.com Upgrade: websocket // required Connection: Upgrade // required Sec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ== // requiredï¼Œä¸€ä¸ª 16bits ç¼–ç å¾—åˆ°çš„ base64 ä¸² Origin: http://example.com // ç”¨äºé˜²æ­¢æœªè®¤è¯çš„è·¨åŸŸè„šæœ¬ä½¿ç”¨æµè§ˆå™¨ websocket api ä¸æœåŠ¡ç«¯è¿›è¡Œé€šä¿¡ Sec-WebSocket-Protocol: chat, superchat // optional, å­åè®®åå•†å­—æ®µ Sec-WebSocket-Version: 13 å¦‚æœæœåŠ¡ç«¯æ”¯æŒè¯¥ç‰ˆæœ¬çš„ WebSocketï¼Œä¼šè¿”å› 101 å“åº”ï¼Œå“åº”æ ‡å¤´å¦‚ä¸‹ï¼š HTTP/1.1 101 Switching Protocols // çŠ¶æ€è¡Œ Upgrade: websocket // required Connection: Upgrade // required Sec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK+xOo= // requiredï¼ŒåŠ å¯†åçš„ Sec-WebSocket-Key Sec-WebSocket-Protocol: chat // è¡¨æ˜é€‰æ‹©çš„å­åè®® æ¡æ‰‹å®Œæˆåï¼Œæ¥ä¸‹æ¥çš„ TCP æ•°æ®åŒ…å°±éƒ½æ˜¯ WebSocket åè®®çš„å¸§äº†ã€‚ å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œçš„æ¡æ‰‹ä¸æ˜¯ TCP çš„æ¡æ‰‹ï¼Œè€Œæ˜¯åœ¨ TCP è¿æ¥å†…éƒ¨ï¼Œä» HTTP/1.1 upgrade åˆ° WebSocket çš„æ¡æ‰‹ã€‚ WebSocket æä¾›ä¸¤ç§åè®®ï¼šä¸åŠ å¯†çš„ ws:// å’Œ åŠ å¯†çš„ wss://. å› ä¸ºæ˜¯ç”¨ HTTP æ¡æ‰‹ï¼Œå®ƒå’Œ HTTP ä½¿ç”¨åŒæ ·çš„ç«¯å£ï¼šws æ˜¯ 80ï¼ˆHTTPï¼‰ï¼Œwss æ˜¯ 443ï¼ˆHTTPSï¼‰ åœ¨ Python ç¼–ç¨‹ä¸­ï¼Œå¯ä½¿ç”¨ websockets å®ç°çš„å¼‚æ­¥ WebSocket å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ã€‚æ­¤å¤– aiohttp ä¹Ÿæä¾›äº† WebSocket æ”¯æŒã€‚ Noteï¼šå¦‚æœä½ æœç´¢ Flask çš„ WebScoket æ’ä»¶ï¼Œå¾—åˆ°çš„ç¬¬ä¸€ä¸ªç»“æœå¾ˆå¯èƒ½æ˜¯ Flask-SocketIOã€‚ä½†æ˜¯ Flask-ScoektIO ä½¿ç”¨çš„æ˜¯å®ƒç‹¬æœ‰çš„ SocketIO åè®®ï¼Œå¹¶ä¸æ˜¯æ ‡å‡†çš„ WebSocketã€‚åªæ˜¯å®ƒåˆšå¥½æä¾›ä¸ WebSocket ç›¸åŒçš„åŠŸèƒ½è€Œå·²ã€‚ SocketIO çš„ä¼˜åŠ¿åœ¨äºåªè¦ Web ç«¯ä½¿ç”¨äº† SocketIO.jsï¼Œå°±èƒ½æ”¯æŒè¯¥åè®®ã€‚è€Œçº¯ WS åè®®ï¼Œåªæœ‰è¾ƒæ–°çš„æµè§ˆå™¨æ‰æ”¯æŒã€‚å¯¹äºå®¢æˆ·ç«¯é Web çš„æƒ…å†µï¼Œæ›´å¥½çš„é€‰æ‹©å¯èƒ½æ˜¯ä½¿ç”¨ Flask-Socketsã€‚ ","date":"2019-02-11","objectID":"/posts/websocket-http2-and-grpc/:1:0","tags":["WebSocket","gRPC","HTTP/2"],"title":"WebSocketã€HTTP/2 ä¸ gRPC","uri":"/posts/websocket-http2-and-grpc/"},{"categories":["æŠ€æœ¯"],"content":"JS API // WebSocket API var socket = new WebSocket('ws://websocket.example.com'); // Show a connected message when the WebSocket is opened. socket.onopen = function(event) { console.log('WebSocket is connected.'); }; // Handle messages sent by the server. socket.onmessage = function(event) { var message = event.data; console.log(message); }; // Handle any error that occurs. socket.onerror = function(error) { console.log('WebSocket Error: ' + error); }; ","date":"2019-02-11","objectID":"/posts/websocket-http2-and-grpc/:1:1","tags":["WebSocket","gRPC","HTTP/2"],"title":"WebSocketã€HTTP/2 ä¸ gRPC","uri":"/posts/websocket-http2-and-grpc/"},{"categories":["æŠ€æœ¯"],"content":"äºŒã€HTTP/2 HTTP/2 äº 2015 å¹´æ ‡å‡†åŒ–ï¼Œä¸»è¦ç›®çš„æ˜¯ä¼˜åŒ–æ€§èƒ½ã€‚å…¶ç‰¹æ€§å¦‚ä¸‹ï¼š äºŒè¿›åˆ¶åè®®ï¼šHTTP/2 çš„æ¶ˆæ¯å¤´ä½¿ç”¨äºŒè¿›åˆ¶æ ¼å¼ï¼Œè€Œéæ–‡æœ¬æ ¼å¼ã€‚å¹¶ä¸”ä½¿ç”¨ä¸“é—¨è®¾è®¡çš„ HPack ç®—æ³•å‹ç¼©ã€‚ å¤šè·¯å¤ç”¨ï¼ˆMultiplexingï¼‰ï¼šå°±æ˜¯è¯´ HTTP/2 å¯ä»¥é‡å¤ä½¿ç”¨åŒä¸€ä¸ª TCP è¿æ¥ï¼Œå¹¶ä¸”è¿æ¥æ˜¯å¤šè·¯çš„ï¼Œå¤šä¸ªè¯·æ±‚æˆ–å“åº”å¯ä»¥åŒæ—¶ä¼ è¾“ã€‚ å¯¹æ¯”ä¹‹ä¸‹ï¼ŒHTTP/1.1 çš„é•¿è¿æ¥ä¹Ÿèƒ½å¤ç”¨ TCP è¿æ¥ï¼Œä½†æ˜¯åªèƒ½ä¸²è¡Œï¼Œä¸èƒ½â€œå¤šè·¯â€ã€‚ æœåŠ¡å™¨æ¨é€ï¼šæœåŠ¡ç«¯èƒ½å¤Ÿç›´æ¥æŠŠèµ„æºæ¨é€ç»™å®¢æˆ·ç«¯ï¼Œå½“å®¢æˆ·ç«¯éœ€è¦è¿™äº›æ–‡ä»¶çš„æ—¶å€™ï¼Œå®ƒå·²ç»åœ¨å®¢æˆ·ç«¯äº†ã€‚ï¼ˆè¯¥æ¨é€å¯¹ Web App æ˜¯éšè—çš„ï¼Œç”±æµè§ˆå™¨å¤„ç†ï¼‰ HTTP/2 å…è®¸å–æ¶ˆæŸä¸ªæ­£åœ¨ä¼ è¾“çš„æ•°æ®æµï¼ˆé€šè¿‡å‘é€ RST_STREAM å¸§ï¼‰ï¼Œè€Œä¸å…³é—­ TCP è¿æ¥ã€‚ è¿™æ­£æ˜¯äºŒè¿›åˆ¶åè®®çš„å¥½å¤„ä¹‹ä¸€ï¼Œå¯ä»¥å®šä¹‰å¤šç§åŠŸèƒ½çš„æ•°æ®å¸§ã€‚ å®ƒå…è®¸æœåŠ¡ç«¯å°†èµ„æºæ¨é€åˆ°å®¢æˆ·ç«¯ç¼“å­˜ï¼Œæˆ‘ä»¬è®¿é—®æ·˜å®ç­‰ç½‘ç«™æ—¶ï¼Œç»å¸¸ä¼šå‘ç°å¾ˆå¤šè¯·æ±‚çš„è¯·æ±‚å¤´éƒ¨åˆ†ä¼šæç¤ºâ€œprovisional headers are shownâ€ï¼Œè¿™é€šå¸¸å°±æ˜¯ç›´æ¥ä»ç¼“å­˜åŠ è½½äº†èµ„æºï¼Œå› æ­¤è¯·æ±‚æ ¹æœ¬æ²¡æœ‰è¢«å‘é€ã€‚è§‚å¯Ÿ Chrome Network çš„ Size åˆ—ï¼Œè¿™ç§è¯·æ±‚çš„è¯¥å­—æ®µä¸€èˆ¬éƒ½æ˜¯ from disk cache æˆ–è€… from memroy cache. Chrome å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼æŸ¥çœ‹è¯·æ±‚ä½¿ç”¨çš„åè®®ï¼š 2019-02-10: ä½¿ç”¨ Chrome æŸ¥çœ‹ï¼Œç›®å‰ä¸»æµç½‘ç«™åŸºæœ¬éƒ½å·²ç»éƒ¨åˆ†ä½¿ç”¨äº† HTTP/2ï¼ŒçŸ¥ä¹ã€bilibiliã€GIthub ä½¿ç”¨äº† wss åè®®ï¼Œä¹Ÿæœ‰å¾ˆå¤šç½‘ç«™ä½¿ç”¨äº† SSEï¼ˆæ ¼å¼å¦‚ data:image/png;base64,\u003cbase64 string\u003eï¼‰ è€Œä¸”å¾ˆå¤šç½‘ç«™éƒ½æœ‰ä½¿ç”¨ HTTP/2 + QUICï¼Œè¯¥åè®®çš„æ–°åç§°æ˜¯ HTTP/3ï¼Œå®ƒæ˜¯åŸºäº UDP çš„ HTTP åè®®ã€‚ ","date":"2019-02-11","objectID":"/posts/websocket-http2-and-grpc/:2:0","tags":["WebSocket","gRPC","HTTP/2"],"title":"WebSocketã€HTTP/2 ä¸ gRPC","uri":"/posts/websocket-http2-and-grpc/"},{"categories":["æŠ€æœ¯"],"content":"SSE æœåŠ¡ç«¯æ¨é€äº‹ä»¶ï¼Œæ˜¯é€šè¿‡ HTTP é•¿è¿æ¥è¿›è¡Œä¿¡æ¯æ¨é€çš„ä¸€ä¸ªåŠŸèƒ½ã€‚ å®ƒé¦–å…ˆç”±æµè§ˆå™¨å‘æœåŠ¡ç«¯å»ºç«‹ä¸€ä¸ª HTTP é•¿è¿æ¥ï¼Œç„¶åæœåŠ¡ç«¯ä¸æ–­åœ°é€šè¿‡è¿™ä¸ªé•¿è¿æ¥å°†æ¶ˆæ¯æ¨é€ç»™æµè§ˆå™¨ã€‚JS API å¦‚ä¸‹ï¼š // create SSE connection var source = new EventSource('/dates'); // è¿æ¥å»ºç«‹æ—¶ï¼Œè¿™äº› API å’Œ WebSocket çš„å¾ˆç›¸ä¼¼ source.onopen = function(event) { // handle open event }; // æ”¶åˆ°æ¶ˆæ¯æ—¶ï¼ˆå®ƒåªæ•è·æœªå‘½å eventï¼‰ source.onmessage = function(event) { var data = event.data; // å‘é€è¿‡æ¥çš„å®é™…æ•°æ®ï¼ˆstringï¼‰ var origin = event.origin; // æœåŠ¡å™¨ç«¯URLçš„åŸŸåéƒ¨åˆ†ï¼Œå³åè®®ã€åŸŸåå’Œç«¯å£ã€‚ var lastEventId = event.lastEventId; // æ•°æ®çš„ç¼–å·ï¼Œç”±æœåŠ¡å™¨ç«¯å‘é€ã€‚å¦‚æœæ²¡æœ‰ç¼–å·ï¼Œè¿™ä¸ªå±æ€§ä¸ºç©ºã€‚ // handle message }; source.onerror = function(event) { // handle error event }; ","date":"2019-02-11","objectID":"/posts/websocket-http2-and-grpc/:2:1","tags":["WebSocket","gRPC","HTTP/2"],"title":"WebSocketã€HTTP/2 ä¸ gRPC","uri":"/posts/websocket-http2-and-grpc/"},{"categories":["æŠ€æœ¯"],"content":"å…·ä½“çš„å®ç° åœ¨æ”¶åˆ°å®¢æˆ·ç«¯çš„ SSE è¯·æ±‚ï¼ˆHTTP åè®®ï¼‰æ—¶ï¼ŒæœåŠ¡ç«¯è¿”å›çš„å“åº”é¦–éƒ¨å¦‚ä¸‹ï¼š Content-Type: text/event-stream Cache-Control: no-cache Connection: keep-alive è€Œ body éƒ¨åˆ†ï¼ŒSSE å®šä¹‰äº†å››ç§ä¿¡æ¯ï¼š dataï¼šæ•°æ®æ  eventï¼šè‡ªå®šä¹‰æ•°æ®ç±»å‹ id ï¼šæ•°æ® id retryï¼šæœ€å¤§é—´éš”æ—¶é—´ï¼Œè¶…æ—¶åˆ™é‡æ–°è¿æ¥ body ä¸¾ä¾‹è¯´æ˜ï¼š : è¿™ç§æ ¼å¼çš„æ¶ˆæ¯æ˜¯æ³¨é‡Šï¼Œä¼šè¢«å¿½ç•¥\\n\\n : é€šå¸¸æœåŠ¡å™¨æ¯éš”ä¸€æ®µæ—¶é—´å°±ä¼šå‘é€ä¸€ä¸ªæ³¨é‡Šï¼Œé˜²æ­¢è¶…æ—¶ retry\\n\\n : ä¸‹é¢è¿™ä¸ªæ˜¯ä¸€ä¸ªå•è¡Œæ•°æ®\\n\\n data: some text\\n\\n : ä¸‹é¢è¿™ä¸ªæ˜¯å¤šè¡Œæ•°æ®ï¼Œåœ¨å®¢æˆ·ç«¯ä¼šé‡ç»„æˆä¸€ä¸ª data\\n\\n data: {\\n data: \"foo\": \"bar\",\\n data: \"baz\", 555\\n data: }\\n\\n : è¿™æ˜¯ä¸€ä¸ªå‘½å eventï¼Œåªä¼šè¢«äº‹ä»¶åä¸ä¹‹ç›¸åŒçš„ listener æ•è·\\n\\n event: foo\\n data: a foo event\\n\\n : æœªå‘½åäº‹ä»¶ï¼Œä¼šè¢« onmessage æ•è·\\n\\n data: an unnamed event\\n\\n event: bar\\n data: a bar event\\n\\n : è¿™ä¸ª id å¯¹åº” event.lastEventId\\n\\n id: msg1\\n data: message\\n\\n ","date":"2019-02-11","objectID":"/posts/websocket-http2-and-grpc/:2:2","tags":["WebSocket","gRPC","HTTP/2"],"title":"WebSocketã€HTTP/2 ä¸ gRPC","uri":"/posts/websocket-http2-and-grpc/"},{"categories":["æŠ€æœ¯"],"content":"WebSocketã€HTTP/2 ä¸ SSE çš„æ¯”è¾ƒ åŠ å¯†ä¸å¦ï¼š WebSocket æ”¯æŒæ˜æ–‡é€šä¿¡ ws:// å’ŒåŠ å¯† wss://ï¼Œ è€Œ HTTP/2 åè®®è™½ç„¶æ²¡æœ‰è§„å®šå¿…é¡»åŠ å¯†ï¼Œä½†æ˜¯ä¸»æµæµè§ˆå™¨éƒ½åªæ”¯æŒ HTTP/2 over TLS. SSE æ˜¯ä½¿ç”¨çš„ HTTP åè®®é€šä¿¡ï¼Œæ”¯æŒ http/https æ¶ˆæ¯æ¨é€ï¼š WebSocketæ˜¯å…¨åŒå·¥é€šé“ï¼Œå¯ä»¥åŒå‘é€šä¿¡ã€‚è€Œä¸”æ¶ˆæ¯æ˜¯ç›´æ¥æ¨é€ç»™ Web App. SSE åªèƒ½å•å‘ä¸²è¡Œåœ°ä»æœåŠ¡ç«¯å°†æ•°æ®æ¨é€ç»™ Web App. HTTP/2 è™½ç„¶ä¹Ÿæ”¯æŒ Server Pushï¼Œä½†æ˜¯æœåŠ¡å™¨åªèƒ½ä¸»åŠ¨å°†èµ„æºæ¨é€åˆ°å®¢æˆ·ç«¯ç¼“å­˜ï¼å¹¶ä¸å…è®¸å°†æ•°æ®æ¨é€åˆ°å®¢æˆ·ç«¯é‡Œè·‘çš„ Web App æœ¬èº«ã€‚æœåŠ¡å™¨æ¨é€åªèƒ½ç”±æµè§ˆå™¨å¤„ç†ï¼Œä¸ä¼šåœ¨åº”ç”¨ç¨‹åºä»£ç ä¸­å¼¹å‡ºæœåŠ¡å™¨æ•°æ®ï¼Œè¿™æ„å‘³ç€åº”ç”¨ç¨‹åºæ²¡æœ‰ API æ¥è·å–è¿™äº›äº‹ä»¶çš„é€šçŸ¥ã€‚ ä¸ºäº†æ¥è¿‘å®æ—¶åœ°å°†æ•°æ®æ¨é€ç»™ Web Appï¼Œ HTTP/2 å¯ä»¥ç»“åˆ SSEï¼ˆServer-Sent Eventï¼‰ä½¿ç”¨ã€‚ WebSocket åœ¨éœ€è¦æ¥è¿‘å®æ—¶åŒå‘é€šä¿¡çš„é¢†åŸŸï¼Œå¾ˆæœ‰ç”¨æ­¦ä¹‹åœ°ã€‚è€Œ HTTP/2 + SSE é€‚åˆç”¨äºå±•ç¤ºå®æ—¶æ•°æ®ã€‚ å¦å¤–åœ¨å®¢æˆ·ç«¯éæµè§ˆå™¨çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ä¸åŠ å¯†çš„ HTTP/2 ä¹Ÿæ˜¯å¯èƒ½çš„ã€‚ ","date":"2019-02-11","objectID":"/posts/websocket-http2-and-grpc/:2:3","tags":["WebSocket","gRPC","HTTP/2"],"title":"WebSocketã€HTTP/2 ä¸ gRPC","uri":"/posts/websocket-http2-and-grpc/"},{"categories":["æŠ€æœ¯"],"content":"requests æŸ¥çœ‹ HTTP åè®®ç‰ˆæœ¬å· å¯ä»¥é€šè¿‡ resp.raw.version å¾—åˆ°å“åº”çš„ HTTP ç‰ˆæœ¬å·ï¼š \u003e\u003e\u003e import requests \u003e\u003e\u003e resp = requests.get(\"https://zhihu.com\") \u003e\u003e\u003e resp.raw.version 11 ä½†æ˜¯ requests é»˜è®¤ä½¿ç”¨ HTTP/1.1ï¼Œå¹¶ä¸”ä¸æ”¯æŒ HTTP/2.ï¼ˆä¸è¿‡è¿™ä¹Ÿä¸æ˜¯ä»€ä¹ˆå¤§é—®é¢˜ï¼ŒHTTP/2 åªæ˜¯åšäº†æ€§èƒ½ä¼˜åŒ–ï¼Œç”¨ HTTP/1.1 ä¹Ÿå°±æ˜¯æ…¢ä¸€ç‚¹è€Œå·²ã€‚ï¼‰ ","date":"2019-02-11","objectID":"/posts/websocket-http2-and-grpc/:2:4","tags":["WebSocket","gRPC","HTTP/2"],"title":"WebSocketã€HTTP/2 ä¸ gRPC","uri":"/posts/websocket-http2-and-grpc/"},{"categories":["æŠ€æœ¯"],"content":"ä¸‰ã€gRPC åè®® gRPC æ˜¯ä¸€ä¸ªè¿œç¨‹è¿‡ç¨‹è°ƒç”¨æ¡†æ¶ï¼Œé»˜è®¤ä½¿ç”¨ protobuf3 è¿›è¡Œæ•°æ®çš„é«˜æ•ˆåºåˆ—åŒ–ä¸ service å®šä¹‰ï¼Œä½¿ç”¨ HTTP/2 è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚ è¿™é‡Œè®¨è®ºçš„æ˜¯ gRPC over HTTP/2 åè®®ã€‚ ç›®å‰ gRPC ä¸»è¦è¢«ç”¨åœ¨å¾®æœåŠ¡é€šä¿¡ä¸­ï¼Œä½†æ˜¯å› ä¸ºå…¶ä¼˜è¶Šçš„æ€§èƒ½ï¼Œå®ƒä¹Ÿå¾ˆå¥‘åˆæ¸¸æˆã€loT ç­‰éœ€è¦é«˜æ€§èƒ½ä½å»¶è¿Ÿçš„åœºæ™¯ã€‚ å…¶å®å…‰ä»åè®®å…ˆè¿›ç¨‹åº¦ä¸Šè®²ï¼ŒgRPC åŸºæœ¬å…¨é¢è¶…è¶Š REST: ä½¿ç”¨äºŒè¿›åˆ¶è¿›è¡Œæ•°æ®åºåˆ—åŒ–ï¼Œæ¯” json æ›´èŠ‚çº¦æµé‡ã€åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ä¹Ÿæ›´å¿«ã€‚ protobuf3 è¦æ±‚ api è¢«å®Œå…¨æ¸…æ™°çš„å®šä¹‰å¥½ï¼Œè€Œ REST api åªèƒ½é ç¨‹åºå‘˜è‡ªè§‰å®šä¹‰ã€‚ gRPC å®˜æ–¹å°±æ”¯æŒä» api å®šä¹‰ç”Ÿæˆä»£ç ï¼Œè€Œ REST api éœ€è¦å€ŸåŠ© openapi-codegen ç­‰ç¬¬ä¸‰æ–¹å·¥å…·ã€‚ æ”¯æŒ 4 ç§é€šä¿¡æ¨¡å¼ï¼šä¸€å¯¹ä¸€(unary)ã€å®¢æˆ·ç«¯æµã€æœåŠ¡ç«¯æµã€åŒç«¯æµã€‚æ›´çµæ´» åªæ˜¯ç›®å‰ gRPC å¯¹ broswer çš„æ”¯æŒä»ç„¶ä¸æ˜¯å¾ˆå¥½ï¼Œå¦‚æœä½ éœ€è¦é€šè¿‡æµè§ˆå™¨è®¿é—® apiï¼Œé‚£ gRPC å¯èƒ½ä¸æ˜¯ä½ çš„èœã€‚ å¦‚æœä½ çš„äº§å“åªæ‰“ç®—é¢å‘ App ç­‰å¯æ§çš„å®¢æˆ·ç«¯ï¼Œå¯ä»¥è€ƒè™‘ä¸Š gRPCã€‚ å¯¹åŒæ—¶éœ€è¦ä¸ºæµè§ˆå™¨å’Œ APP æä¾›æœåŠ¡åº”ç”¨è€Œè¨€ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘ APP ä½¿ç”¨ gRPC åè®®ï¼Œè€Œæµè§ˆå™¨ä½¿ç”¨ API ç½‘å…³æä¾›çš„ HTTP æ¥å£ï¼Œåœ¨ API ç½‘å…³ä¸Šè¿›è¡Œ HTTP - gRPC åè®®è½¬æ¢ã€‚ ","date":"2019-02-11","objectID":"/posts/websocket-http2-and-grpc/:3:0","tags":["WebSocket","gRPC","HTTP/2"],"title":"WebSocketã€HTTP/2 ä¸ gRPC","uri":"/posts/websocket-http2-and-grpc/"},{"categories":["æŠ€æœ¯"],"content":"gRPC over HTTP/2 å®šä¹‰ è¯¦ç»†çš„å®šä¹‰å‚è§å®˜æ–¹æ–‡æ¡£ gRPC over HTTP/2. è¿™é‡Œæ˜¯ç®€è¦è¯´æ˜å‡ ç‚¹ï¼š gRPC å®Œå…¨éšè—äº† HTTP/2 æœ¬èº«çš„ methodã€headersã€path ç­‰è¯­ä¹‰ï¼Œè¿™äº›ä¿¡æ¯å¯¹ç”¨æˆ·è€Œè¨€å®Œå…¨ä¸å¯è§äº†ã€‚ è¯·æ±‚ç»Ÿä¸€ä½¿ç”¨ POSTï¼Œå“åº”çŠ¶æ€ç»Ÿä¸€ä¸º 200ã€‚åªè¦å“åº”æ˜¯æ ‡å‡†çš„ gRPC æ ¼å¼ï¼Œå“åº”ä¸­çš„ HTTP çŠ¶æ€ç å°†è¢«å®Œå…¨å¿½ç•¥ã€‚ gRPC å®šä¹‰äº†è‡ªå·±çš„ status çŠ¶æ€ç ã€æ ¼å¼å›ºå®šçš„ pathã€è¿˜æœ‰å®ƒè‡ªå·±çš„ headersã€‚ ","date":"2019-02-11","objectID":"/posts/websocket-http2-and-grpc/:3:1","tags":["WebSocket","gRPC","HTTP/2"],"title":"WebSocketã€HTTP/2 ä¸ gRPC","uri":"/posts/websocket-http2-and-grpc/"},{"categories":["æŠ€æœ¯"],"content":"å‚è€ƒ æ·±å…¥æ¢ç´¢ WebSockets å’Œ HTTP/2 HTTP/2 ç‰¹æ€§ä¸æŠ“åŒ…åˆ†æ SSEï¼šæœåŠ¡å™¨å‘é€äº‹ä»¶,ä½¿ç”¨é•¿é“¾æ¥è¿›è¡Œé€šè®¯ Using server-sent events - MDN Can I Use HTTP/2 on Browsers Python 3.x how to get http version (using requests library) WebSocket æ˜¯ä»€ä¹ˆåŸç†ï¼Ÿ åŸç”Ÿæ¨¡å—æ‰“é€ ä¸€ä¸ªç®€å•çš„ WebSocket æœåŠ¡å™¨ Google Cloud - API design: Understanding gRPC, OpenAPI and REST and when to use them ","date":"2019-02-11","objectID":"/posts/websocket-http2-and-grpc/:4:0","tags":["WebSocket","gRPC","HTTP/2"],"title":"WebSocketã€HTTP/2 ä¸ gRPC","uri":"/posts/websocket-http2-and-grpc/"},{"categories":["æŠ€æœ¯"],"content":"ä¸ç®¡æ˜¯åšçˆ¬è™«è¿˜æ˜¯å†™ Web Appï¼ŒChrome å’Œ Firefox çš„ DevTools éƒ½æ˜¯è¶…å¸¸ç”¨çš„ï¼Œä½†æ˜¯ç»å¸¸å‘ç°åˆ«äººçš„æˆªå›¾æœ‰ä»€ä¹ˆå­—æ®µæˆ‘æ‰¾ä¸åˆ°ï¼Œåˆ«äººçš„ä»€ä¹ˆåŠŸèƒ½æˆ‘çš„ Chrome æ²¡æœ‰ï¼Œä»”ç»†ä¸€æœç´¢æ‰çŸ¥é“ï¼ŒåŸæ¥æ˜¯æˆ‘ä¸ä¼šç”¨ã€‚ã€‚ Ctrl + Shift + Iï¼šæ‰“å¼€ DevTools Ctrl + Shift + Jï¼šæ‰“å¼€æ§åˆ¶å° ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:0","tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/"},{"categories":["æŠ€æœ¯"],"content":"æœç´¢ Ctrl + Fï¼šåœ¨å½“å‰ä½ç½®æœç´¢å…³é”®å­— åœ¨ç½‘é¡µç•Œé¢ç”¨è¿™ä¸ªå¿«æ·é”®ï¼Œå°±æ˜¯é¡µå†…æœç´¢ åœ¨ Network çš„ Response é¡µé¢ï¼Œå°±æ˜¯åœ¨ Response ä¸­æœç´¢ Ctrl + Shift + Fï¼šå…¨æ–‡æœç´¢ï¼Œåœ¨å½“å‰ Web App çš„æ‰€æœ‰æ–‡ä»¶ä¸­æœç´¢ã€‚ **çˆ¬è™«å¿…å¤‡ï¼ï¼ï¼**è¦å¯»æ‰¾ä¸€äº›ç‰¹æ®Šå­—ç¬¦ä¸²çš„æ¥æºï¼Œç”¨å®ƒæœç´¢å±¡è¯•ä¸çˆ½ã€‚ ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:1","tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/"},{"categories":["æŠ€æœ¯"],"content":"Command åœ¨ DevTools é‡ŒæŒ‰å¿«æ·é”® Ctrl + Shift + P å°±èƒ½æ‰“å¼€ Command è¾“å…¥æ¡†ï¼Œå®ƒå’Œ vscode/sublime çš„ Command ä¸€æ ·ï¼Œç”¨å¥½äº†ç‰¹åˆ«æ–¹ä¾¿ã€‚ ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:2","tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/"},{"categories":["æŠ€æœ¯"],"content":"Network 1. å±æ€§åˆ— Chrome å¯ä»¥å³é”®å±æ€§åˆ—åæ¥å¢å‡å±æ€§åˆ—ï¼ŒFirefox-Dev ä¹Ÿæ˜¯ä¸€æ ·ï¼š 2. copy åœ¨ Chrome ä¸­å³é”®æŸä¸ªè¯·æ±‚ï¼Œé€‰ä¸­ copyï¼Œä¼šç»™å‡ºå‡ ä¸ª optionsï¼š è€Œ Firefox-Dev çš„æ›´å¼ºä¸€ç‚¹ï¼Œå¯ä»¥å¤åˆ¶æ¶ˆæ¯å¤´ï¼ˆè¯·æ±‚å¤´å’Œå“åº”å¤´ï¼‰ï¼š 3. response çš„ pretty print Chrome çš„ Response é¡µé¢å·¦ä¸‹è§’ï¼Œæœ‰{}æŒ‰é’®ï¼Œå¯ä»¥ beautify å“åº”ã€‚ è€Œ Firefox-Dev åªåœ¨ Debugger é¡µé¢æä¾›è¯¥æŒ‰é’®ï¼ŒResponse ä¸­ä¸æ”¯æŒã€‚ Firefox å“åº”çš„ preview å’Œ payload æ˜¯æ”¾åœ¨ Response é¡µé¢ä¸‹ã€‚è€Œ Chrome æ˜¯åˆ†æˆäº†ä¸¤ä¸ªæ ‡ç­¾é¡µ 4. å¯¼å‡º HAR å³é”®ä»»æ„ä¸€ä¸ªè¯·æ±‚ï¼Œé€‰æ‹© save all as HARï¼Œå°±å¯ä»¥å¯¼å‡º HAR æ–‡ä»¶ã€‚ï¼ˆChrome æœ‰ with contentï¼Œå¯¼å‡ºçš„ HAR æ–‡ä»¶ä¼šå«æœ‰æ‰€æœ‰è¯·æ±‚ä¸å“åº”çš„ bodyï¼‰ è¯¥æ–‡ä»¶å¯ç”¨äºå­˜å‚¨å½“å‰ç›‘å¬åˆ°çš„æ‰€æœ‰æµè§ˆå™¨è¯·æ±‚ä¿¡æ¯ã€‚åœ¨ä»¥åéœ€è¦åˆ†æè¿™äº›è¯·æ±‚æ—¶ï¼Œå°† HAR æ–‡ä»¶æ‹–åˆ° Network é¡µé¢å³å¯æ¢å¤æ‰€æœ‰è¯·æ±‚ã€‚ 5. Raw Headersï¼ˆåŸå§‹æ¶ˆæ¯å¤´ï¼‰ Chrome åªæ”¯æŒæŸ¥çœ‹ HTTP/1.x çš„ Raw Headersï¼Œå¯¹è¿™ç§è¯·æ±‚ï¼Œä¼šç»™å‡º view source é€‰é¡¹ã€‚ Chrome ä¸èƒ½æŸ¥çœ‹ HTTP/2 çš„ Raw Headersã€‚ è€Œ Firefox åˆ™æ”¯æŒæŸ¥çœ‹ HTTP/2 çš„ Raw Headersã€‚ï¼ˆæ˜¯æ¢å¤åçš„ï¼ŒHTTP/2 çš„åŸå§‹æ¶ˆæ¯å¤´æ˜¯äºŒè¿›åˆ¶å‹ç¼©å½¢å¼ï¼‰ å®ƒè¿˜æä¾› Edit and Resend è¯·æ±‚çš„åŠŸèƒ½ï¼Œè¿™ç‚¹è¦ç»™ä¸ªèµï½ 6. å®¡æŸ¥ WebSocketï¼ˆChrome onlyï¼‰ åœ¨ NetWork ä¸­ç‚¹å‡»å¯¹åº”çš„ WebScoket è¯·æ±‚ï¼Œåœ¨å³ä¾§é€‰æ‹© Frames æ ‡ç­¾ï¼Œå°±å¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„æ¶ˆæ¯äº† 7. è·¨é¡µé¢åŠ è½½æ—¶ï¼Œä¿ç•™ç½‘ç»œè¯·æ±‚è®°å½• å½“é¡µé¢é‡è½½æˆ–è€…é¡µé¢è·³è½¬æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒNetworké¢æ¿ä¸‹çš„ç½‘ç»œè¯·æ±‚è®°å½•è¡¨ä¹Ÿæ˜¯åˆ·æ–°çš„ã€‚å¦‚æœæƒ³ä¿ç•™ä¹‹å‰é¡µé¢çš„ç½‘ç»œè¯·æ±‚æ•°æ®ï¼Œå¯ä»¥å‹¾é€‰Preserve log. å¸¸ç”¨çš„ä¸€ä¸ªåº”ç”¨åœºæ™¯ï¼šç™»å½•/æ³¨å†Œæ—¶ä¼šè°ƒç”¨ç™»å½•/æ³¨å†ŒAPIï¼Œå¼€å‘è€…æƒ³æŸ¥çœ‹è¿™ä¸ªæ¥å£è¿”å›çš„æƒ…å†µï¼Œä½†æ˜¯ç™»å½•/æ³¨å†ŒæˆåŠŸåä¸€èˆ¬ä¼šè·³è½¬åˆ°æ–°çš„é¡µé¢ï¼Œå¯¼è‡´äº†Networké¢æ¿çš„è¯·æ±‚è®°å½•è¢«åˆ·æ–°ä»è€Œçœ‹ä¸åˆ°ç™»å½•/æ³¨å†Œæ¥å£è¿”å›çš„æƒ…å†µã€‚æ­¤æ—¶å‹¾é€‰ä¸ŠPreserve logï¼Œæ— è®ºè·³è½¬åˆ°é‚£ä¸ªé¡µé¢ï¼Œéƒ½èƒ½åœ¨Networkç½‘ç»œè¯·æ±‚è®°å½•è¡¨ä¸­æŸ¥çœ‹åˆ°ä¹‹å‰æ¥å£è¿”å›çš„æƒ…å†µã€‚ ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:3","tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/"},{"categories":["æŠ€æœ¯"],"content":"JavaScript æ§åˆ¶å° å¯ä»¥é€šè¿‡ $x(\u003cxpath\u003e, \u003cDOM-element\u003e)ï¼Œç”¨ xpath æŸ¥è¯¢ DOM å…ƒç´ ã€‚ é€šè¿‡æ§åˆ¶å°å·¦ä¸Šæ–¹çš„é€‰å•ï¼Œå¯ä»¥åˆ‡æ¢ JS çš„ç¯å¢ƒï¼Œå®ƒé»˜è®¤æ˜¯å½“å‰é¡µé¢ï¼ˆtopï¼‰ã€‚ ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:4","tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/"},{"categories":["æŠ€æœ¯"],"content":"Elements é¡µé¢ï¼ˆFirefox-Dev æ˜¯ Inspector é¡µé¢ï¼‰ 1. DOM å…ƒç´ æ–­ç‚¹ï¼ˆChrome onlyï¼‰ åœ¨ Elements é¡µé¢ï¼Œå³é”®ä¸€ä¸ªå…ƒç´ ï¼Œæœ‰ä¸€ä¸ª Break on é€‰é¡¹ï¼Œå¯ä»¥æ§åˆ¶åœ¨ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶ Break. - subtree modification: å­èŠ‚ç‚¹è¢«ä¿®æ”¹ - attribute modificationï¼šå½“å‰èŠ‚ç‚¹çš„å±æ€§è¢«ä¿®æ”¹ã€‚ï¼ˆinline style è¢«ä¿®æ”¹ä¹Ÿä¼šè§¦å‘æ­¤äº‹ä»¶ï¼‰ - node removalï¼šèŠ‚ç‚¹è¢«ç§»é™¤ 2. æ£€ç´¢å…ƒç´ ä¸Šæ³¨å†Œçš„äº‹ä»¶ï¼ˆChrome onlyï¼‰ åœ¨ Elements é¡µé¢é€‰ä¸­ä¸€ä¸ªå…ƒç´ ï¼ˆæˆ–è€…ç›´æ¥å³é”®æ£€æŸ¥è¯¥å…ƒç´ ï¼‰ï¼Œç„¶ååœ¨å³ä¾§çª—å£ï¼Œé€‰æ‹© Event Listeners æ ‡ç­¾ï¼Œå°±å¯ä»¥çœ‹åˆ°è¯¥å…ƒç´ ä¸Šæ³¨å†Œçš„æ‰€æœ‰äº‹ä»¶ã€‚ 3. é¢œè‰²é€‰æ‹©å™¨ é€‰ä¸­ä»»ä¸€å…ƒç´ ï¼Œåœ¨å³ä¾§é€‰æ‹© Styles é€‰å•ï¼Œä¼šæ˜¾ç¤ºå½“å‰å…ƒç´ çš„ css å±æ€§ã€‚ å…¶ä¸­æ‰€æœ‰çš„é¢œè‰²å°æ–¹å—éƒ½æ˜¯å¯ä»¥ç‚¹å‡»çš„ï¼Œç‚¹å‡»é¢œè‰²æ–¹å—å å¯ä»¥å°†é¢œè‰²å±æ€§è½¬æ¢æˆå¤šä¸ªæ ¼å¼ï¼ˆChrome onlyï¼‰ é»˜è®¤æ ¼å¼ï¼š#207981 RGBæ ¼å¼ï¼šrgb(32, 121, 129) HSLæ ¼å¼ï¼šhsl(185, 60%, 32%) æä¾› color pickerï¼Œå¯ç”¨äºåœ¨ç½‘é¡µä»»æ„ä½ç½®å–è‰²ã€‚ï¼ˆFirefox-Dev ä¹Ÿæœ‰ï¼‰ æä¾›å¤åˆ¶æŒ‰é”®ï¼Œç›´æ¥å°†è¯¥é¢œè‰²å½“å‰æ ¼å¼çš„è¡¨è¾¾å¤åˆ¶åˆ°å‰ªåˆ‡æ¿ ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:5","tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/"},{"categories":["æŠ€æœ¯"],"content":"å…ƒç´ å®¡æŸ¥ Ctrl + Shift + C æˆ–è€…ç‚¹å‡» DevTools æœ€å·¦ä¸Šè§’çš„å°ç®­å¤´æŒ‰é’®ï¼Œå°±èƒ½è¿›å…¥å…ƒç´ å®¡æŸ¥æ¨¡å¼ã€‚ è¯¥æ¨¡å¼ä¸‹ä¼šè‡ªåŠ¨å®¡æŸ¥é¼ æ ‡æ‰€æŒ‡çš„å…ƒç´ ï¼ŒElements é¡µé¢ä¹Ÿä¼šè‡ªåŠ¨å®šä½åˆ°è¯¥å…ƒç´ ã€‚ ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:6","tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/"},{"categories":["æŠ€æœ¯"],"content":"Sources é¡µé¢ï¼ˆFirefox-Dev æ˜¯ Debuuger é¡µé¢ï¼‰ Sources å³ä¾§çš„ Debugger æ”¯æŒå„ç§æ–­ç‚¹è°ƒè¯•ã€‚ æ¡ä»¶æ–­ç‚¹ Sources ä¸­ï¼Œåœ¨ä»»æ„ JS ä»£ç çš„è¡Œå·ä¸Šå•å‡»é¼ æ ‡å·¦é”®ï¼Œå°±èƒ½åœ¨è¯¥è¡Œè®¾ç½®ä¸€ä¸ªæ™®é€šæ–­ç‚¹ï¼ˆåœ¨ Response ä¸­å¯ä¸è¡Œï¼‰ã€‚åœ¨è¡Œå·ä¸Šå³é”®ï¼Œèƒ½ç›´æ¥è®¾ç½®æ¡ä»¶æ–­ç‚¹ã€‚ XHR æ–­ç‚¹ï¼šåœ¨å³ä¾§ Debugger ä¸­ï¼Œå¯ä»¥æ·»åŠ  XHR æ–­ç‚¹ã€‚ å¦‚æœæ¡ä»¶ç•™ç©ºï¼Œä¸€æ—¦æœ‰ XHR å‘èµ·ï¼Œå°±ä¼šæ— æ¡ä»¶è¿›å…¥è°ƒè¯•ã€‚ æ¡ä»¶æ˜¯ â€œBreak When URL Contaions â€ Watch Expressionsï¼šè¡¨è¾¾å¼å®¡æŸ¥ åŒå‡»é€‰ä¸­ JS ä»£ç ä¸­çš„ä»»æ„å˜é‡ï¼Œç„¶åå³é”®å®ƒï¼Œå¯ä»¥å°†è¯¥å˜é‡æ·»åŠ åˆ° Watch ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥éšæ—¶è§‚å¯Ÿå®ƒçš„å€¼ã€‚ ä¹Ÿå¯ä»¥åœ¨å³ä¾§ Watch ä¸­æ‰‹åŠ¨è¾“å…¥ JS è¡¨è¾¾å¼ã€‚ DOM å…ƒç´ æ–­ç‚¹ï¼ˆChrome onlyï¼‰ï¼šåœ¨ Elements éƒ¨åˆ†è®²è¿‡äº†ã€‚ Chrome çš„æ–­ç‚¹åŠŸèƒ½æ¯” Firefox-Dev çš„æ›´ä¸°å¯Œã€‚ ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:7","tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/"},{"categories":["æŠ€æœ¯"],"content":"Screenshot 1. For Chrome æ–¹æ³•ä¸€ï¼šåœ¨ DevTools ç•Œé¢ï¼ŒæŒ‰å¿«æ·é”® Ctrl + Shift + P æ‰“å¼€ Command çª—å£ï¼Œç„¶åè¾“å…¥ screenshotï¼Œåœ¨ä¸‹æ‹‰æ é‡Œé€‰æ‹©ä½ éœ€è¦çš„æˆªå›¾å‘½ä»¤å°±è¡Œã€‚ æ–¹æ³•äºŒï¼š å…ˆè¿› dev toolsï¼Œç‚¹å‡» å·¦ä¸Šè§’çš„è®¾å¤‡å›¾æ ‡ï¼ˆtoggle device toolbarï¼‰ï¼Œç„¶åé¡µé¢é¡¶éƒ¨å°±ä¼šå‡ºç°ä¸€ä¸ªå¯¼èˆªæ ï¼Œåœ¨è¿™é‡Œå¥½é€‰æ‹©è®¾å¤‡æˆ–è€…è‡ªå®šä¹‰å›¾åƒå°ºå¯¸ï¼Œç„¶åç‚¹å‡»è¯¥å¯¼èˆªæ å³ä¾§ï¼ˆä¸æ˜¯ dev tools å³ä¾§ï¼‰çš„ options å›¾æ ‡ï¼Œä¼šæœ‰ä¸¤ä¸ªé€‰é¡¹ï¼šâ€œæˆªå›¾ï¼ˆcapture screenshotï¼‰â€å’Œâ€œæˆªç½‘é¡µå…¨å›¾ï¼ˆcapture full size screenshotï¼‰â€ï¼Œå¦‚ä¸‹ï¼š 2. For Firefox åªæˆªæ˜¾ç¤ºå‡ºæ¥çš„éƒ¨åˆ†ï¼šå’Œ Chrome ä¸€æ ·ç‚¹å‡»è®¾å¤‡å›¾æ ‡ï¼Œç„¶ååœ¨é¡µé¢ä¸Šé¢çš„ toolbar å°±æœ‰æˆªå›¾æŒ‰é’® æˆªç½‘é¡µå…¨å›¾ï¼šåœ¨ DevTools å³è¾¹çš„ options ä¸­è¿›å…¥ Settingsï¼Œå‹¾é€‰ take a screenshot of the entire pageï¼ŒDevTools å³ä¸Šè§’å°±ä¼šå‡ºç°æˆªå›¾æŒ‰é’®äº†ã€‚ ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:8","tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/"},{"categories":["æŠ€æœ¯"],"content":"å…¶ä»– 1. Fake Geolocationï¼ˆChrome onlyï¼‰ åœ¨ Chrome ä¸­è¿›å…¥ DevToolsï¼Œç‚¹å‡»å³ä¸Šè§’çš„ options æŒ‰é’®ï¼Œé€‰æ‹© More tools -\u003e Sensorsï¼Œåœ¨ Geolocation å¤„é€‰æ‹© Custom locationï¼Œå°±å¯ä»¥ä¿®æ”¹åœ°ç†ä½ç½®äº†ã€‚ 2. è‡ªå®šä¹‰è¯·æ±‚å¤´ For Chrome å’Œ ä¸Šä¸€å°èŠ‚ä¸€æ ·ï¼Œå…ˆè¿› More toolsï¼Œé€‰æ‹© Network conditionsï¼Œå–æ¶ˆå‹¾é€‰ Select atuomaticallyï¼Œå°±å¯ä»¥ä¿®æ”¹è¯·æ±‚å¤´äº†ã€‚ ä¸Šé¢çš„æ¼”ç¤ºä¸­ï¼Œä½¿ç”¨ python-requests/2.21.0 åš user agentï¼ŒçŸ¥ä¹è¿”å› 404. For Firefox æ‰“å¼€è®¾å¤‡æ¨¡æ‹Ÿï¼Œåœ¨ toolbar çš„å³ä¸Šè§’å‹¾é€‰ show user agentï¼Œç„¶åå°±å¯ä»¥åœ¨ toolbar ä¿®æ”¹ user agent äº†ï¼š ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:9","tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/"},{"categories":["æŠ€æœ¯"],"content":"3. Request Blockingï¼ˆChrome onlyï¼‰ åœ¨ Network çš„ä»»æ„è¯·æ±‚ä¸Šå³é”®ï¼Œèœå•ä¸­å°±æœ‰ Block request URLï¼ˆé˜»å¡è¯¥ URLï¼‰å’Œ Block request domainï¼ˆé˜»å¡è¯·æ±‚æ‰€åœ¨çš„æ•´ä¸ªåŸŸï¼‰ ç„¶åå°±å¯ä»¥åœ¨ More tools -\u003e Request blocking ä¸­çœ‹åˆ°ä½ è®¾ç½®çš„é˜»å¡æ¡ä»¶ã€‚ ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:10","tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/"},{"categories":["æŠ€æœ¯"],"content":"å‚è€ƒ ä½ ä¸çŸ¥é“çš„ Chrome è°ƒè¯•æŠ€å·§ Chrome Dev Tools ä¸­æ–‡æ‰‹å†Œ Firefox Quantumï¼šå¼€å‘è€…ç‰ˆæœ¬ How to Capture Screenshots in Google Chrome without using Extensions Chrome DevTools - Network ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:11","tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/"},{"categories":["æŠ€æœ¯"],"content":" ä¸ªäººç¬”è®°ï¼Œå¦‚æœ‰é”™è¯¯çƒ¦è¯·æŒ‡æ­£ã€‚ SQLAlchemy æ˜¯ä¸€ä¸ªç”¨ Python å®ç°çš„ ORM ï¼ˆObject Relational Mappingï¼‰æ¡†æ¶ï¼Œå®ƒç”±å¤šä¸ªç»„ä»¶æ„æˆï¼Œè¿™äº›ç»„ä»¶å¯ä»¥å•ç‹¬ä½¿ç”¨ï¼Œä¹Ÿèƒ½ç‹¬ç«‹ä½¿ç”¨ã€‚å®ƒçš„ç»„ä»¶å±‚æ¬¡ç»“æ„å¦‚ä¸‹ï¼š SQLAlchemy å±‚æ¬¡ç»“æ„\" SQLAlchemy å±‚æ¬¡ç»“æ„ å…¶ä¸­æœ€å¸¸ç”¨çš„ç»„ä»¶ï¼Œåº”è¯¥æ˜¯ ORM å’Œ SQL è¡¨è¾¾å¼è¯­è¨€ï¼Œè¿™ä¸¤è€…æ—¢å¯ä»¥ç‹¬ç«‹ä½¿ç”¨ï¼Œä¹Ÿèƒ½ç»“åˆä½¿ç”¨ã€‚ ORM çš„å¥½å¤„åœ¨äºå®ƒ è‡ªåŠ¨å¤„ç†äº†æ•°æ®åº“å’Œ Python å¯¹è±¡ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œå±è”½äº†ä¸¤å¥—ç³»ç»Ÿä¹‹é—´çš„å·®å¼‚ã€‚ç¨‹åºå‘˜ä¸éœ€è¦å†ç¼–å†™å¤æ‚çš„ SQL è¯­å¥ï¼Œç›´æ¥æ“ä½œ Python å¯¹è±¡å°±è¡Œã€‚ å±è”½äº†å„æ•°æ®åº“ä¹‹é—´çš„å·®å¼‚ï¼Œæ›´æ¢åº•å±‚æ•°æ®åº“ä¸éœ€è¦ä¿®æ”¹ SQL è¯­å¥ï¼Œæ”¹ä¸‹é…ç½®å°±è¡Œã€‚ ä½¿æ•°æ®åº“ç»“æ„æ–‡æ¡£åŒ–ï¼Œmodels å®šä¹‰å¾ˆæ¸…æ™°åœ°æè¿°äº†æ•°æ®åº“çš„ç»“æ„ã€‚ é¿å…äº†ä¸è§„èŒƒã€å†—ä½™ã€é£æ ¼ä¸ç»Ÿä¸€çš„ SQL è¯­å¥ï¼Œå¯ä»¥é¿å…å¾ˆå¤šäººä¸º Bugï¼Œä¹Ÿæ–¹ä¾¿ç»´æŠ¤ã€‚ ä½†æ˜¯ ORM éœ€è¦æ¶ˆè€—é¢å¤–çš„æ€§èƒ½æ¥å¤„ç†å¯¹è±¡å…³ç³»æ˜ å°„ï¼Œæ­¤å¤–ç”¨ ORM åšå¤šè¡¨å…³è”æŸ¥è¯¢æˆ–å¤æ‚ SQL æŸ¥è¯¢æ—¶ï¼Œæ•ˆç‡ä½ä¸‹ã€‚å› æ­¤å®ƒé€‚ç”¨äºåœºæ™¯ä¸å¤ªå¤æ‚ï¼Œæ€§èƒ½è¦æ±‚ä¸å¤ªè‹›åˆ»çš„åœºæ™¯ã€‚ éƒ½è¯´ ORM å­¦ä¹ æˆæœ¬é«˜ï¼Œæˆ‘è‡ªå·±ä¹Ÿæ›´å€¾å‘äºç›´æ¥ä½¿ç”¨ SQL è¯­å¥ï¼ˆæ¯•ç«Ÿæ›´ç†Ÿæ‚‰ï¼‰ï¼Œå› æ­¤è¿™ä¸€ç¯‡ç¬”è®°ä¸æ¶‰åŠ ORM éƒ¨åˆ†ï¼Œåªè®°å½• SQLAlchemy çš„ Engine ä¸ SQL è¡¨è¾¾å¼è¯­è¨€ã€‚ ","date":"2019-01-21","objectID":"/posts/sqlalchemy-notes-1-engine-and-sql-expression-language/:0:0","tags":["SQLAlchemy","Python","ORM","åç«¯"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šEngine ä¸ SQL è¡¨è¾¾å¼è¯­è¨€","uri":"/posts/sqlalchemy-notes-1-engine-and-sql-expression-language/"},{"categories":["æŠ€æœ¯"],"content":"ä¸€ã€ç›´æ¥ä½¿ç”¨ Engine å’Œ Connections ç¬¬ä¸€æ­¥æ˜¯åˆ›å»ºæ•°æ®åº“å¼•æ“å®ä¾‹ï¼š from sqlalchemy import create_engine engine = create_engine('sqlite:///:memory:', echo=True, # echo=True è¡¨ç¤ºæ‰“å°å‡ºè‡ªåŠ¨ç”Ÿæˆçš„ SQL è¯­å¥ï¼ˆé€šè¿‡ loggingï¼‰ pool_size=5, # è¿æ¥æ± å®¹é‡ï¼Œé»˜è®¤ä¸º 5ï¼Œç”Ÿäº§ç¯å¢ƒä¸‹å¤ªå°ï¼Œéœ€è¦ä¿®æ”¹ã€‚ # ä¸‹é¢æ˜¯ connection å›æ”¶çš„æ—¶é—´é™åˆ¶ï¼Œé»˜è®¤ -1 ä¸å›æ”¶ pool_recycle=7200) # è¶…è¿‡ 2 å°æ—¶å°±é‡æ–°è¿æ¥ï¼ˆMySQL é»˜è®¤çš„è¿æ¥æœ€å¤§é—²ç½®æ—¶é—´ä¸º 8 å°æ—¶ï¼‰ create_engine æ¥å—çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ•°æ®åº“ URIï¼Œæ ¼å¼ä¸º dialect+driver://username:password@host:port/databaseï¼Œdialect æ˜¯å…·ä½“çš„æ•°æ®åº“åç§°ï¼Œdriver æ˜¯é©±åŠ¨åç§°ã€‚key-value æ˜¯å¯é€‰çš„å‚æ•°ã€‚ä¸¾ä¾‹ï¼š # PostgreSQL postgresql+psycopg2://scott:tiger@localhost/dbtest # MySQL + PyMySQLï¼ˆæˆ–è€…ç”¨æ›´å¿«çš„ mysqlclientï¼‰ mysql+pymysql://scott:tiger@localhost/dbtest # sqlite å†…å­˜æ•°æ®åº“ # æ³¨æ„ sqlite è¦ç”¨ä¸‰ä¸ªæ–œæ ï¼Œè¡¨ç¤ºä¸å­˜åœ¨ hostnameï¼Œsqlite://\u003cnohostname\u003e/\u003cpath\u003e sqlite:///:memory: # sqlite æ–‡ä»¶æ•°æ®åº“ # å››ä¸ªæ–œæ æ˜¯å› ä¸ºæ–‡ä»¶çš„ç»å¯¹è·¯å¾„ä»¥ / å¼€å¤´ï¼š/home/ryan/Codes/Python/dbtest.db sqlite:////home/ryan/Codes/Python/dbtest.db # SQL Server + pyodbc # é¦–é€‰åŸºäº dsn çš„è¿æ¥ï¼Œdsn çš„é…ç½®è¯·æœç´¢hhh mssql+pyodbc://scott:tiger@some_dsn å¦‚æœä½ çš„å¯†ç ä¸­å«æœ‰ â€˜@â€™ ç­‰ç‰¹æ®Šå­—ç¬¦ï¼Œå°±ä¸èƒ½ç›´æ¥æ”¾å…¥ URI ä¸­ï¼Œå¿…é¡»ä½¿ç”¨ urllib.parse.quote_plus ç¼–ç ï¼Œç„¶åå†æ’å…¥ URI. å¼•æ“åˆ›å»ºåï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥è·å– connectionï¼Œç„¶åæ‰§è¡Œ SQL è¯­å¥äº†ã€‚è¿™ç§ç”¨æ³•ç›¸å½“äºæŠŠ SQLAlchemy å½“æˆå¸¦ log çš„æ•°æ®åº“è¿æ¥æ± ä½¿ç”¨ï¼š with engine.connect() as conn: res = conn.execute(\"select username from users\") # æ— å‚ç›´æ¥ä½¿ç”¨ # ä½¿ç”¨é—®å·ä½œå ä½ç¬¦ï¼Œå‰ææ˜¯ä¸‹å±‚çš„ DBAPI æ”¯æŒã€‚æ›´å¥½çš„æ–¹å¼æ˜¯ä½¿ç”¨ text()ï¼Œè¿™ä¸ªåé¢è¯´ conn.execute(\"INSERT INTO table (id, value) VALUES (?, ?)\", 1, \"v1\") # å‚æ•°ä¸éœ€è¦åŒ…è£…æˆå…ƒç»„ # æŸ¥è¯¢è¿”å›çš„æ˜¯ ResultProxy å¯¹è±¡ï¼Œæœ‰å’Œ dbapi ç›¸åŒçš„ fetchone()ã€fetchall()ã€first() ç­‰æ–¹æ³•ï¼Œè¿˜æœ‰ä¸€äº›æ‹“å±•æ–¹æ³• for row in result: print(\"username:\", row['username']) ä½†æ˜¯è¦æ³¨æ„çš„æ˜¯ï¼Œconnection çš„ execute æ˜¯è‡ªåŠ¨æäº¤çš„ï¼ˆautocommitï¼‰ï¼Œè¿™å°±åƒåœ¨ shell é‡Œæ‰“å¼€ä¸€ä¸ªæ•°æ®åº“å®¢æˆ·ç«¯ä¸€æ ·ï¼Œåˆ†å·ç»“å°¾çš„ SQL ä¼šè¢«è‡ªåŠ¨æäº¤ã€‚ åªæœ‰åœ¨ BEGIN TRANSACTION å†…éƒ¨ï¼ŒAUTOCOMMIT ä¼šè¢«ä¸´æ—¶è®¾ç½®ä¸º FALSEï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹æ³•å¼€å§‹ä¸€ä¸ªå†…éƒ¨äº‹åŠ¡ï¼š def transaction_a(connection): trans = connection.begin() # å¼€å¯ä¸€ä¸ª transaction try: # do sthings trans.commit() # è¿™é‡Œéœ€è¦æ‰‹åŠ¨æäº¤ except: trans.rollback() # å‡ºç°å¼‚å¸¸åˆ™ rollback raise # do other things with engine.connect() as conn: transaction_a(conn) ","date":"2019-01-21","objectID":"/posts/sqlalchemy-notes-1-engine-and-sql-expression-language/:1:0","tags":["SQLAlchemy","Python","ORM","åç«¯"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šEngine ä¸ SQL è¡¨è¾¾å¼è¯­è¨€","uri":"/posts/sqlalchemy-notes-1-engine-and-sql-expression-language/"},{"categories":["æŠ€æœ¯"],"content":"1. ä½¿ç”¨ text() æ„å»º SQL ç›¸æ¯”ç›´æ¥ä½¿ç”¨ stringï¼Œtext() çš„ä¼˜åŠ¿åœ¨äºå®ƒï¼š æä¾›äº†ç»Ÿä¸€çš„å‚æ•°ç»‘å®šè¯­æ³•ï¼Œä¸å…·ä½“çš„ DBAPI æ— å…³ã€‚ # 1. å‚æ•°ç»‘å®šè¯­æ³• from sqlalchemy import text result = connection.execute( # ä½¿ç”¨ :key åšå ä½ç¬¦ text('select * from table where id \u003c :id and typeName=:type'), {'id': 2,'type':'USER_TABLE'}) # ç”¨ dict ä¼ å‚æ•°ï¼Œæ›´æ˜“è¯» # 2. å‚æ•°ç±»å‹æŒ‡å®š from sqlalchemy import DateTime date_param=datetime.today()+timedelta(days=-1*10) sql=\"delete from caw_job_alarm_log where alarm_time \u003c :alarm_time_param\" # bindparams æ˜¯ bindparam çš„åˆ—è¡¨ï¼Œbindparam åˆ™æä¾›å‚æ•°çš„ä¸€äº›é¢å¤–ä¿¡æ¯ï¼ˆç±»å‹ã€å€¼ã€é™åˆ¶ç­‰ï¼‰ t=text(sql, bindparams=[bindparam('alarm_time_param', type_=DateTime, required=True)]) connection.execute(t, {\"alarm_time_param\": date_param}) å¯ä»¥å¾ˆæ–¹ä¾¿åœ°è½¬æ¢ Result ä¸­åˆ—çš„ç±»å‹ stmt = text(\"SELECT * FROM table\", # ä½¿ç”¨ typemap æŒ‡å®šå°† id åˆ—æ˜ å°„ä¸º Integer ç±»å‹ï¼Œname æ˜ å°„ä¸º String ç±»å‹ typemap={'id': Integer, 'name': String}, ) result = connection.execute(stmt) # å¯¹å¤šä¸ªæŸ¥è¯¢ç»“æœï¼Œå¯ä»¥ç”¨ for obj in result éå† # ä¹Ÿå¯ç”¨ fetchone() åªè·å–ä¸€ä¸ª ","date":"2019-01-21","objectID":"/posts/sqlalchemy-notes-1-engine-and-sql-expression-language/:1:1","tags":["SQLAlchemy","Python","ORM","åç«¯"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šEngine ä¸ SQL è¡¨è¾¾å¼è¯­è¨€","uri":"/posts/sqlalchemy-notes-1-engine-and-sql-expression-language/"},{"categories":["æŠ€æœ¯"],"content":"äºŒã€SQL è¡¨è¾¾å¼è¯­è¨€ å¤æ‚çš„ SQL æŸ¥è¯¢å¯ä»¥ç›´æ¥ç”¨ raw sql å†™ï¼Œè€Œå¢åˆ æ”¹ä¸€èˆ¬éƒ½æ˜¯å•è¡¨æ“ä½œï¼Œç”¨ SQL è¡¨è¾¾å¼è¯­è¨€æœ€æ–¹ä¾¿ã€‚ SQLAlchemy è¡¨è¾¾å¼è¯­è¨€æ˜¯ä¸€ä¸ªä½¿ç”¨ Python ç»“æ„è¡¨ç¤ºå…³ç³»æ•°æ®åº“ç»“æ„å’Œè¡¨è¾¾å¼çš„ç³»ç»Ÿã€‚ ","date":"2019-01-21","objectID":"/posts/sqlalchemy-notes-1-engine-and-sql-expression-language/:2:0","tags":["SQLAlchemy","Python","ORM","åç«¯"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šEngine ä¸ SQL è¡¨è¾¾å¼è¯­è¨€","uri":"/posts/sqlalchemy-notes-1-engine-and-sql-expression-language/"},{"categories":["æŠ€æœ¯"],"content":"1. å®šä¹‰å¹¶åˆ›å»ºè¡¨ SQL è¡¨è¾¾å¼è¯­è¨€ä½¿ç”¨ Table æ¥å®šä¹‰è¡¨ï¼Œè€Œè¡¨çš„åˆ—åˆ™ç”¨ Column å®šä¹‰ã€‚Column æ€»æ˜¯å…³è”åˆ°ä¸€ä¸ª Table å¯¹è±¡ä¸Šã€‚ ä¸€ç»„ Table å¯¹è±¡ä»¥åŠå®ƒä»¬çš„å­å¯¹è±¡çš„é›†åˆå°±è¢«ç§°ä½œã€Œæ•°æ®åº“å…ƒæ•°æ®ï¼ˆdatabase metadataï¼‰ã€ã€‚metadata å°±åƒä½ çš„ç½‘é¡µåˆ†ç±»æ”¶è—å¤¹ï¼Œç›¸å…³çš„ Table æ”¾åœ¨ä¸€ä¸ª metadata ä¸­ã€‚ ä¸‹é¢æ˜¯åˆ›å»ºå…ƒæ•°æ®ï¼ˆä¸€ç»„ç›¸å…³è”çš„è¡¨ï¼‰çš„ä¾‹å­ï¼Œï¼š from sqlalchemy import Table, Column, Integer, String, MetaData, ForeignKey metadata = MetaData() # å…ˆåˆ›å»ºå…ƒæ•°æ®ï¼ˆæ”¶è—å¤¹ï¼‰ users = Table('user', metadata, # åˆ›å»º user è¡¨ï¼Œå¹¶æ”¾åˆ° metadata ä¸­ Column('id', Integer, primary_key=True), Column('name', String), Column('fullname', String) ) addresses = Table('address', metadata, Column('id', Integer, primary_key=True), Column('user_id', None, ForeignKey('user.id')), # å¤–é”®çº¦æŸï¼Œå¼•ç”¨ user è¡¨çš„ id åˆ— Column('email_address', String, nullable=False) ) metadata.create_all(engine) # ä½¿ç”¨ engine åˆ›å»º metadata å†…çš„æ‰€æœ‰ Tablesï¼ˆä¼šæ£€æµ‹è¡¨æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œæ‰€ä»¥å¯ä»¥é‡å¤è°ƒç”¨ï¼‰ è¡¨å®šä¹‰ä¸­çš„çº¦æŸ åº”è¯¥ç»™æ‰€æœ‰çš„çº¦æŸå‘½åï¼Œå³ä¸º name å‚æ•°æŒ‡å®šä¸€ä¸ªä¸å†²çªçš„åˆ—åã€‚è¯¦è§ The Importance of Naming Constraints è¡¨è¿˜æœ‰ä¸€ä¸ªå±æ€§ï¼šçº¦æŸæ¡ä»¶ã€‚ä¸‹é¢ä¸€ä¸€è¿›è¡Œè¯´æ˜ã€‚ å¤–é”®çº¦æŸï¼šç”¨äºåœ¨åˆ é™¤æˆ–æ›´æ–°æŸä¸ªå€¼æˆ–è¡Œæ—¶ï¼Œå¯¹ä¸»é”®/å¤–é”®å…³ç³»ä¸­ä¸€ç»„æ•°æ®åˆ—å¼ºåˆ¶è¿›è¡Œçš„æ“ä½œé™åˆ¶ã€‚ ç”¨æ³•ä¸€ï¼šColumn('user_id', None, ForeignKey('user.id'))ï¼Œç›´æ¥åœ¨ Column ä¸­æŒ‡å®šã€‚è¿™ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„æ–¹æ³• ç”¨æ³•äºŒï¼šé€šè¿‡ ForeignKeyConstraint(columns, refcolumns) æ„å»ºçº¦æŸï¼Œä½œä¸ºå‚æ•°ä¼ ç»™ Table. item = Table('item', metadata, # å•†å“ table Column('id', Integer, primary_key=True), Column('name', String(60), nullable=False), Column('invoice_id', Integer, nullable=False), # å‘ç¥¨ idï¼Œæ˜¯å¤–é”® Column('ref_num', Integer, nullable=False), ForeignKeyConstraint(['invoice_id', 'ref_num'], # å½“å‰è¡¨ä¸­çš„å¤–é”®åç§° ['invoice.id', 'invoice.ref_num']) # è¢«å¼•ç”¨çš„å¤–é”®åç§°çš„åºåˆ—ï¼ˆè¢«å¼•ç”¨çš„è¡¨ï¼‰ ) on delete ä¸ on updateï¼šå¤–é”®çº¦æŸçš„ä¸¤ä¸ªçº¦æŸæ¡ä»¶ï¼Œé€šè¿‡ ForeignKey() æˆ– ForeignKeyConstraint() çš„å…³é”®å­—å‚æ•° ondelete/onupdate ä¼ å…¥ã€‚ å¯é€‰å€¼æœ‰ï¼š é»˜è®¤è¡Œä¸º NO ACTIONï¼šä»€ä¹ˆéƒ½ä¸åšï¼Œç›´æ¥æŠ¥é”™ã€‚ CASCADEï¼šåˆ é™¤/æ›´æ–° çˆ¶è¡¨æ•°æ®æ—¶ï¼Œä»è¡¨æ•°æ®ä¼šåŒæ—¶è¢« åˆ é™¤/æ›´æ–°ã€‚ï¼ˆæ— æŠ¥é”™ï¼‰ RESTRICTï¼šä¸å…è®¸ç›´æ¥ åˆ é™¤/æ›´æ–° çˆ¶è¡¨æ•°æ®ï¼Œç›´æ¥æŠ¥é”™ã€‚ï¼ˆå’Œé»˜è®¤è¡Œä¸ºåŸºæœ¬ä¸€è‡´ï¼‰ SET NULL or SET DEFAULTï¼šåˆ é™¤/æ›´æ–° çˆ¶è¡¨æ•°æ®æ—¶ï¼Œå°†å¯¹åº”çš„ä»è¡¨æ•°æ®é‡ç½®ä¸º NULL æˆ–è€…é»˜è®¤å€¼ã€‚ å”¯ä¸€æ€§çº¦æŸï¼šUniqueConstraint('col2', 'col3', name='uix_1')ï¼Œä½œä¸ºå‚æ•°ä¼ ç»™ Table. CHECK çº¦æŸï¼šCheckConstraint('col2 \u003e col3 + 5', name='check1')ï¼Œ ä½œä¸ºå‚æ•°ä¼ ç»™ Table. ä¸»é”®çº¦æŸï¼šä¸è§£é‡Š æ–¹æ³•ä¸€ï¼šé€šè¿‡ Column('id', Integer, primary_key=True) æŒ‡å®šä¸»é”®ã€‚ï¼ˆå‚æ•° primary_key å¯åœ¨å¤šä¸ª Column ä¸Šä½¿ç”¨ï¼‰ æ–¹æ³•äºŒï¼šä½¿ç”¨ PrimaryKeyConstraint from sqlalchemy import PrimaryKeyConstraint my_table = Table('mytable', metadata, Column('id', Integer), Column('version_id', Integer), Column('data', String(50)), PrimaryKeyConstraint('id', 'version_id', name='mytable_pk') ) ","date":"2019-01-21","objectID":"/posts/sqlalchemy-notes-1-engine-and-sql-expression-language/:2:1","tags":["SQLAlchemy","Python","ORM","åç«¯"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šEngine ä¸ SQL è¡¨è¾¾å¼è¯­è¨€","uri":"/posts/sqlalchemy-notes-1-engine-and-sql-expression-language/"},{"categories":["æŠ€æœ¯"],"content":"2. å¢åˆ æ”¹æŸ¥è¯­å¥ å¢: # æ–¹æ³•ä¸€ï¼Œä½¿ç”¨ values ä¼ å‚ ins = users.insert().values(name=\"Jack\", fullname=\"Jack Jones\") # å¯ä»¥é€šè¿‡ str(ins) æŸ¥çœ‹è‡ªåŠ¨ç”Ÿæˆçš„ sql connection.execute(ins) # æ–¹æ³•äºŒï¼Œå‚æ•°ä¼ é€’ç»™ execute() conn.execute(users.insert(), id=2, name='wendy', fullname='Wendy Williams') # æ–¹æ³•ä¸‰ï¼Œæ‰¹é‡ INSERTï¼Œç›¸å½“äº executemany conn.execute(addresses.insert(), [ # æ’å…¥åˆ° addresses è¡¨ {'user_id': 1, 'email_address': 'jack@yahoo.com'}, # ä¼ å…¥ dict åˆ—è¡¨ {'user_id': 1, 'email_address': 'jack@msn.com'}, {'user_id': 2, 'email_address': 'www@www.org'}, {'user_id': 2, 'email_address': 'wendy@aol.com'} ]) # æ­¤å¤–ï¼Œé€šè¿‡ä½¿ç”¨ bindparamï¼ŒINSERT è¿˜å¯ä»¥æ‰§è¡Œæ›´å¤æ‚çš„æ“ä½œ stmt = users.insert() \\ .values(name=bindparam('_name') + \" .. name\") # string æ‹¼æ¥ conn.execute(stmt, [ {'id':4, '_name':'name1'}, {'id':5, '_name':'name2'}, {'id':6, '_name':'name3'}, ]) åˆ ï¼š _table.delete() \\ .where(_table.c.f1==value1) \\ .where(_table.c.f2==value2) # where æŒ‡å®šæ¡ä»¶ æ”¹ï¼š # ä¸¾ä¾‹ stmt = users.update() \\ .where(users.c.name == 'jack') \\ .values(name='tom') conn.execute(stmt) # æ‰¹é‡æ›´æ–° stmt = users.update() \\ .where(users.c.name == bindparam('oldname')) \\ .values(name=bindparam('newname')) conn.execute(stmt, [ {'oldname':'jack', 'newname':'ed'}, {'oldname':'wendy', 'newname':'mary'}, {'oldname':'jim', 'newname':'jake'}, ]) å¯ä»¥çœ‹åˆ°ï¼Œæ‰€æœ‰çš„æ¡ä»¶éƒ½æ˜¯é€šè¿‡ where æŒ‡å®šçš„ï¼Œå®ƒå’Œåé¢ ORM çš„ filter æ¥å—çš„å‚æ•°æ˜¯ä¸€æ ·çš„ã€‚ï¼ˆè¯¦ç»†çš„ä¼šåœ¨ç¬¬äºŒç¯‡æ–‡ç« é‡Œè®²ï¼‰ æŸ¥ from sqlalchemy.sql import select # 1. å­—æ®µé€‰æ‹© s1 = select([users]) # ç›¸å½“äº select * from users s2 = select([users.c.name, users.c.fullname]) # è¿™ä¸ªå°±æ˜¯åª select ä¸€éƒ¨åˆ† # 2. æ·»åŠ è¿‡æ»¤æ¡ä»¶ s3 = select([users]) \\ .where(users.c.id == addresses.c.user_id) res = conn.execute(s1) # å¯ç”¨ for row in res éå†ç»“æœé›†ï¼Œä¹Ÿå¯ç”¨ fetchone() åªè·å–ä¸€è¡Œ æŸ¥è¯¢è¿”å›çš„æ˜¯ ResultProxy å¯¹è±¡ï¼Œè¿™æ˜¯ SQLAlchemy å¯¹ Python DB-API çš„ cursor çš„ä¸€ä¸ªå°è£…ç±»ï¼Œè¦ä»ä¸­è·å–ç»“æœè¡Œï¼Œä¸»è¦æœ‰ä¸‹åˆ—å‡ ä¸ªæ–¹æ³•ï¼š row1 = result.fetchone() # å¯¹åº” cursor.fetchone() row2 = result.fetchall() # å¯¹åº” cursor.fetchall() row3 = result.fetchmany(size=3) # å¯¹åº” cursor.fetchmany(size=3) row4 = result.first() # è·å–ä¸€è¡Œï¼Œç„¶åç«‹å³è°ƒç”¨ result çš„ close() æ–¹æ³• col = row[mytable.c.mycol] # è·å– mycol è¿™ä¸€åˆ— result.rowcount # ç»“æœé›†çš„è¡Œæ•° åŒæ—¶ï¼Œresult ä¹Ÿå®ç°äº† next protocolï¼Œå› æ­¤å¯ä»¥ç›´æ¥ç”¨ for å¾ªç¯éå† ","date":"2019-01-21","objectID":"/posts/sqlalchemy-notes-1-engine-and-sql-expression-language/:2:2","tags":["SQLAlchemy","Python","ORM","åç«¯"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šEngine ä¸ SQL è¡¨è¾¾å¼è¯­è¨€","uri":"/posts/sqlalchemy-notes-1-engine-and-sql-expression-language/"},{"categories":["æŠ€æœ¯"],"content":"where è¿›é˜¶ é€šè¿‡ä½¿ç”¨ or_ã€and_ã€in_ model.join ç­‰æ–¹æ³•ï¼Œwhere å¯ä»¥æ„å»ºæ›´å¤æ‚çš„ SQL è¯­å¥ã€‚ from sqlalchemy.sql import and_, or_, not_ s = select([(users.c.fullname + \", \" + addresses.c.email_address). label('title')]).\\ where(users.c.id == addresses.c.user_id).\\ where(users.c.name.between('m', 'z')).\\ where( or_( addresses.c.email_address.like('%@aol.com'), addresses.c.email_address.like('%@msn.com') ) ) ","date":"2019-01-21","objectID":"/posts/sqlalchemy-notes-1-engine-and-sql-expression-language/:2:3","tags":["SQLAlchemy","Python","ORM","åç«¯"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šEngine ä¸ SQL è¡¨è¾¾å¼è¯­è¨€","uri":"/posts/sqlalchemy-notes-1-engine-and-sql-expression-language/"},{"categories":["æŠ€æœ¯"],"content":"é“¾æ¥ ä½¿ç”¨ Engines å’Œ Connections SQL è¡¨è¾¾å¼è¯­è¨€å…¥é—¨ SQLAlchemy - å®šä¹‰çº¦æŸ SQLAlchemyä¸ªäººå­¦ä¹ ç¬”è®°å®Œæ•´æ±‡æ€» hackersandslackers/sqlalchemy-tutorial ","date":"2019-01-21","objectID":"/posts/sqlalchemy-notes-1-engine-and-sql-expression-language/:3:0","tags":["SQLAlchemy","Python","ORM","åç«¯"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šEngine ä¸ SQL è¡¨è¾¾å¼è¯­è¨€","uri":"/posts/sqlalchemy-notes-1-engine-and-sql-expression-language/"},{"categories":["æŠ€æœ¯"],"content":" ä¸ªäººç¬”è®°ä¸ä¿è¯æ­£ç¡®ã€‚ æ•°æ®ç±»å‹æ˜¯é™åˆ¶æˆ‘ä»¬å¯ä»¥åœ¨è¡¨é‡Œå­˜å‚¨ä»€ä¹ˆæ•°æ®çš„ä¸€ç§æ–¹æ³•ã€‚ä¸è¿‡ï¼Œå¯¹äºè®¸å¤šåº”ç”¨æ¥è¯´ï¼Œ è¿™ç§é™åˆ¶å®åœ¨æ˜¯å¤ªç²—ç³™äº†ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªåŒ…å«äº§å“ä»·æ ¼çš„å­—æ®µåº”è¯¥åªæ¥å—æ­£æ•°ã€‚ ä½†æ˜¯æ²¡æœ‰å“ªç§æ ‡å‡†æ•°æ®ç±»å‹åªæ¥å—æ­£æ•°ã€‚ å¦å¤–ä¸€ä¸ªé—®é¢˜æ˜¯ä½ å¯èƒ½éœ€è¦æ ¹æ®å…¶å®ƒå­—æ®µæˆ–è€…å…¶å®ƒè¡Œçš„æ•°æ®æ¥çº¦æŸå­—æ®µæ•°æ®ã€‚æ¯”å¦‚ï¼Œ åœ¨ä¸€ä¸ªåŒ…å«äº§å“ä¿¡æ¯çš„è¡¨ä¸­ï¼Œæ¯ä¸ªäº§å“ç¼–å·éƒ½åº”è¯¥åªæœ‰ä¸€è¡Œã€‚ å¯¹äºè¿™äº›é—®é¢˜ï¼ŒSQL å…è®¸ä½ åœ¨å­—æ®µå’Œè¡¨ä¸Šå®šä¹‰çº¦æŸã€‚çº¦æŸå…è®¸ä½ å¯¹æ•°æ®æ–½åŠ ä»»æ„æ§åˆ¶ã€‚ å¦‚æœç”¨æˆ·ä¼å›¾åœ¨å­—æ®µé‡Œå­˜å‚¨è¿åçº¦æŸçš„æ•°æ®ï¼Œé‚£ä¹ˆå°±ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚ è¿™ç§æƒ…å†µåŒæ—¶ä¹Ÿé€‚ç”¨äºæ•°å€¼æ¥è‡ªé»˜è®¤å€¼çš„æƒ…å†µã€‚ ","date":"2019-01-20","objectID":"/posts/sql-basics-3-restrict/:0:0","tags":["SQL","æ•°æ®åº“"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸‰ï¼‰çº¦æŸ","uri":"/posts/sql-basics-3-restrict/"},{"categories":["æŠ€æœ¯"],"content":"1. å¤–é”® FOREIGN KEY å¤–é”®çº¦æŸå£°æ˜ä¸€ä¸ªå­—æ®µ(æˆ–è€…ä¸€ç»„å­—æ®µ)çš„æ•°å€¼å¿…é¡»åŒ¹é…å¦å¤–ä¸€ä¸ªè¡¨ä¸­å‡ºç°çš„æ•°å€¼ã€‚ åˆ›å»ºå¤–é”®çº¦æŸçš„å‰ææ˜¯ï¼Œè¯¥å¤–é”®æ‰€åœ¨çš„è¡¨å·²ç»å­˜åœ¨ï¼Œå¹¶ä¸”å¤–é”®å¿…é¡»æ˜¯ UNIQUE çš„ã€‚ï¼ˆä¸»é”®é»˜è®¤ UNIQUE ä¸” NOT NULLï¼‰ CREATETABLE\u003cè¡¨å\u003e(\u003cå­—æ®µå\u003e\u003cç±»å‹\u003ePRIMARYKEY,\u003cå­—æ®µå\u003e\u003cç±»å‹\u003eREFERENCES\u003cå¤–é”®æ‰€åœ¨çš„è¡¨å\u003e(\u003cå­—æ®µå\u003e),-- è¿™åˆ›å»ºäº†ä¸€ä¸ªå¤–é”® ...); è¿˜æœ‰å¦ä¸€ç§è¯­æ³•ï¼Œå®ƒæ”¯æŒä»¥å¤šä¸ªå­—æ®µä¸ºå¤–é”®ï¼ˆå­—æ®µçº¦æŸä¹Ÿå¯ä»¥å†™æˆè¡¨çº¦æŸï¼Œä¹Ÿå°±æ˜¯æ”¾åœ¨ä¸€ä¸ªç‹¬ç«‹çš„è¡Œä¸­ã€‚è€Œåè¿‡æ¥å¾ˆå¯èƒ½ä¸è¡Œï¼‰ï¼š CREATE TABLE \u003cè¡¨å\u003e ( \u003cå­—æ®µå1\u003e \u003cç±»å‹\u003e PRIMARY KEY, \u003cå­—æ®µå2\u003e \u003cç±»å‹\u003e \u003cå­—æ®µå3\u003e \u003cç±»å‹\u003e ... FOREIGN KEY (\u003cå­—æ®µå2\u003e, \u003cå­—æ®µå3\u003e) REFERENCES \u003cå¤–é”®æ‰€åœ¨çš„è¡¨å\u003e (\u003cå­—æ®µå4\u003e, \u003cå­—æ®µå5\u003e) ); ä¸€ä¸ªè¡¨ä¹Ÿå¯ä»¥åŒ…å«å¤šä¸ªå¤–é”®çº¦æŸã€‚è¿™ä¸ªç‰¹æ€§ç”¨äºå®ç°è¡¨ä¹‹é—´çš„å¤šå¯¹å¤šå…³ç³»ã€‚ æ¯”å¦‚ä½ æœ‰å…³äºäº§å“å’Œè®¢å•çš„è¡¨ï¼Œä½†ç°åœ¨ä½ æƒ³å…è®¸ä¸€ä¸ªè®¢å•å¯ä»¥åŒ…å«å¤šç§äº§å“ (ä¸Šé¢é‚£ä¸ªç»“æ„æ˜¯ä¸å…è®¸è¿™ä¹ˆåšçš„)ï¼Œä½ å¯ä»¥ä½¿ç”¨è¿™æ ·çš„ç»“æ„ï¼š CREATETABLEproducts(product_nointegerPRIMARYKEY,nametext,pricenumeric);CREATETABLEorders(order_idintegerPRIMARYKEY,shipping_addresstext,...);CREATETABLEorder_items(product_nointegerREFERENCESproducts,order_idintegerREFERENCESorders,quantityinteger,PRIMARYKEY(product_no,order_id)); å¤–é”®èƒ½é€šè¿‡ ALTER è¯­å¥æ·»åŠ æˆ–åˆ é™¤ ","date":"2019-01-20","objectID":"/posts/sql-basics-3-restrict/:0:1","tags":["SQL","æ•°æ®åº“"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸‰ï¼‰çº¦æŸ","uri":"/posts/sql-basics-3-restrict/"},{"categories":["æŠ€æœ¯"],"content":"2. çº§è”æ“ä½œ ON DELETE ä¸ ON UPDATE ä¸Šé¢è¯´è¿‡ï¼šå¤–é”®çº¦æŸå£°æ˜ä¸€ä¸ªå­—æ®µ(æˆ–è€…ä¸€ç»„å­—æ®µ)çš„æ•°å€¼å¿…é¡»åŒ¹é…å¦å¤–ä¸€ä¸ªè¡¨ä¸­å‡ºç°çš„æ•°å€¼ã€‚ ä½†æ˜¯ä»¥ 1. ä¸­æœ€åä¸€ä¸ª sql ä¸ºä¾‹ï¼Œå¦‚æœä¸€ä¸ªè®¢å•ï¼ˆorderï¼‰åœ¨åˆ›å»ºä¹‹åï¼Œè¯¥è®¢å•åŒ…å«çš„æŸä¸ªäº§å“ï¼ˆproductï¼‰è¢«åˆ é™¤äº†ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ è¿™ä¸ªä¾‹å­ä¸­ï¼Œè®¢å•åŒ…å«çš„äº§å“é€šè¿‡å¤–é”®è¢«è®°å½•åœ¨ order_items è¡¨ä¸­ã€‚ç°åœ¨å¦‚æœä½ è¦åˆ é™¤ product ä¸­æŸä¸ªè¢« order_items å¼•ç”¨äº†çš„è¡Œï¼Œé»˜è®¤æƒ…å†µä¸º NO ACTIONï¼Œå°±æ˜¯ç›´æ¥æŠ¥é”™ã€‚ è¿™ä¸ªè¡Œä¸ºä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®šï¼š CREATETABLEproducts(product_nointegerPRIMARYKEY,nametext,pricenumeric);CREATETABLEorders(order_idintegerPRIMARYKEY,shipping_addresstext,...);CREATETABLEorder_items(product_nointegerREFERENCESproductsONDELETERESTRICT,-- é™åˆ¶ï¼Œä¹Ÿå°±æ˜¯ç¦æ­¢åˆ é™¤è¢«å®ƒå¼•ç”¨çš„è¡Œ order_idintegerREFERENCESordersONDELETECASCADE,-- çº§è”ï¼Œåœ¨åˆ é™¤è¢«å®ƒå¼•ç”¨çš„è¡Œçš„æ—¶å€™ï¼Œè¿™ä¸€è¡Œæœ¬èº«ä¹Ÿä¼šè¢«è‡ªåŠ¨åˆ é™¤æ‰ quantityinteger,PRIMARYKEY(product_no,order_id)); é™¤äº† RESTRICT å’Œ CASCADE å¤–ï¼Œåœ¨å¤–é”®ä¸Šçš„åŠ¨ä½œè¿˜æœ‰ä¸¤ä¸ªé€‰é¡¹ï¼šSET NULL å’Œ SET DEFAULTï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯åœ¨è¢«å¼•ç”¨çš„è¡Œåˆ é™¤åå°†å¤–é”®è®¾ç½®ä¸º NULL æˆ–é»˜è®¤å€¼ã€‚ ON UPDATE ä¸ ON DELETE çš„åŠ¨ä½œæ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯ CASCADE è¡¨ç¤ºåŒæ­¥æ›´æ–°ã€‚ ","date":"2019-01-20","objectID":"/posts/sql-basics-3-restrict/:0:2","tags":["SQL","æ•°æ®åº“"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸‰ï¼‰çº¦æŸ","uri":"/posts/sql-basics-3-restrict/"},{"categories":["æŠ€æœ¯"],"content":"3. CHECK çº¦æŸ CREATETABLEproducts(product_nointeger,nametext,pricenumericCHECK(price\u003e0)); ä½ è¿˜å¯ä»¥ç»™è¿™ä¸ªçº¦æŸå–ä¸€ä¸ªç‹¬ç«‹çš„åå­—ã€‚è¿™æ ·å°±å¯ä»¥ä»¤é”™è¯¯æ¶ˆæ¯æ›´æ¸…æ™°ï¼Œ å¹¶ä¸”åœ¨ä½ éœ€è¦ä¿®æ”¹å®ƒçš„æ—¶å€™å¼•ç”¨è¿™ä¸ªåå­—ã€‚è¯­æ³•æ˜¯ï¼š CREATETABLEproducts(product_nointeger,nametext,pricenumericCONSTRAINTpositive_priceCHECK(price\u003e0)); ç¨å¾®å¤æ‚ä¸€ç‚¹çš„ä¾‹å­ï¼š CREATETABLEproducts(product_nointeger,nametext,pricenumericCHECK(price\u003e0),discounted_pricenumeric,CHECK(discounted_price\u003e0ANDprice\u003ediscounted_price)); åŒæ ·çš„ï¼Œå¯ä»¥ä¸º CHECK å‘½åï¼Œä»¤é”™è¯¯ä¿¡æ¯æ›´æ¸…æ™°ï¼š CREATETABLEproducts(product_nointeger,nametext,pricenumeric,CHECK(price\u003e0),discounted_pricenumeric,CHECK(discounted_price\u003e0),CONSTRAINTvalid_discountCHECK(price\u003ediscounted_price)); è¦æ³¨æ„çš„æ˜¯ï¼Œå½“çº¦æŸè¡¨è¾¾å¼è®¡ç®—ç»“æœä¸ºçœŸæˆ– NULL çš„æ—¶å€™ï¼Œæ£€æŸ¥çº¦æŸä¼šè¢«è®¤ä¸ºæ˜¯æ»¡è¶³æ¡ä»¶çš„ã€‚ å› ä¸ºå¤§å¤šæ•°è¡¨è¾¾å¼åœ¨å«æœ‰ NULL æ“ä½œæ•°çš„æ—¶å€™ç»“æœéƒ½æ˜¯ NULL ï¼Œæ‰€ä»¥è¿™äº›çº¦æŸä¸èƒ½é˜»æ­¢å­—æ®µå€¼ä¸º NULL ã€‚è¦æ’é™¤æ‰ NULLï¼Œåªèƒ½ä½¿ç”¨ NOT NULL çº¦æŸã€‚ï¼ˆæ‰€ä»¥å°±è¯´ NULL æ˜¯ä¸‡æ¶ä¹‹æºhhhï¼‰ ","date":"2019-01-20","objectID":"/posts/sql-basics-3-restrict/:0:3","tags":["SQL","æ•°æ®åº“"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸‰ï¼‰çº¦æŸ","uri":"/posts/sql-basics-3-restrict/"},{"categories":["æŠ€æœ¯"],"content":"å‚è€ƒ çº¦æŸ ","date":"2019-01-20","objectID":"/posts/sql-basics-3-restrict/:0:4","tags":["SQL","æ•°æ®åº“"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸‰ï¼‰çº¦æŸ","uri":"/posts/sql-basics-3-restrict/"},{"categories":["éšç¬”"],"content":" é«˜ä¸­è€ƒè™‘å¿—å‘çš„æ—¶å€™ï¼Œæˆ‘æœ€å¼€å§‹æƒ³é€‰æ‹©ç”µå­ä¿¡æ¯å·¥ç¨‹ï¼Œå› ä¸ºå°æ—¶å€™å°±å–œæ¬¢æ‘†å¼„å„ç§ç”µå­å™¨ä»¶ï¼Œè¿™ä¸ªæ–¹å‘ç¡¬ä»¶è½¯ä»¶éƒ½èƒ½ç©ï¼Œå°±æ„Ÿè§‰å¾ˆæœ‰è¶£ï¼Œåªæ˜¯æ‹…å¿ƒè‡ªå·±é«˜ä¸‰å¤ªæ”¾æµªå½¢éª¸è€ƒä¸ä¸Šã€‚ å¶ç„¶æƒ³èµ·åœ¨å­¦æ ¡é˜…è§ˆå®¤è¯»æ‚å¿—æ—¶ï¼Œæ›¾è¢«ç§‘å¹»ä¸–ç•Œ2013å¹´12æœŸé‡Œæ²–æ°æ­¦å½¦çš„ã€Šåœ¨å›å£°ä¸­é‡å†ã€‹ç»™æ‰“åŠ¨â€”â€”ç”¨è€³æœµâ€œçœ‹è§â€ä¸–ç•Œå®åœ¨æ˜¯å¤ªå¥‡å¦™äº†ï¼Œæˆ‘å½“æ—¶ç—´ç—´åœ°å¹»æƒ³äº†å¥½å‡ å¤©ã€‚ è¿™æ ·æˆ‘å¼€å§‹è€ƒè™‘é€‰æ‹©å£°å­¦ã€‚ æˆ‘ä»åŒæ¡Œæ¨èçš„ã€Šåˆ€å‰‘ç¥åŸŸã€‹å¼€å§‹æ¥è§¦æ—¥æœ¬çš„ ACG æ–‡åŒ–ï¼Œåæ¥æ¥è§¦åˆ°åˆéŸ³æœªæ¥å’Œæ´›å¤©ä¾ï¼Œå°±å¯¹æ­Œå£°åˆæˆ(singing synthesis)äº§ç”Ÿäº†å¾ˆå¤§çš„å…´è¶£ï¼Œä»”ç»†ä¸€æƒ³å‘ç°è¿™ä¹Ÿåº”è¯¥æ˜¯å£°å­¦çš„èŒƒç•´ï¼Œè¿™ä½¿æˆ‘åšå®šäº†æˆ‘é€‰æ‹©å£°å­¦çš„æƒ³æ³•ã€‚ ä»é‚£æ—¶åˆ°ç°åœ¨çš„å„ç§ç ´äº‹ï¼Œå®åœ¨ä¸æƒ³å¤šè¯´ï¼Œå°±ç•¥è¿‡ä¸æäº†ã€‚æ€»ä¹‹æˆ‘é€‰æ‹©äº†å£°å­¦ï¼Œç„¶åå¹²å¾—å¾ˆå¤±è´¥ã€‚ã€‚ã€‚ ä¸ºå•¥æƒ³å†™è¿™ç¯‡æ–‡ç« å‘¢ï¼Ÿ è¯è¿˜å¾—ä»å»å¹´åä¸€æœˆä»½è¯´èµ·ï¼Œå½“æ—¶è¦å­¦ Matlabï¼Œå°±åœ¨ bilibili ä¸Šæ‰¾äº†ä¸ªæ•™ç¨‹ï¼šè‡ªåˆ¶åˆæˆå™¨æ¼”å¥é¸Ÿä¹‹è¯—ï¼Œè®²ç”¨ Matlab åšå‰ä»–éŸ³åˆæˆï¼Œè®²å¾—ç‰¹åˆ«æ£’ï¼Œæˆ‘è·Ÿç€åšå‡ºäº† guitar-synthesizer è¿™ä¸ªå°ç©æ„å„¿ã€‚ ç„¶åä»Šå¤©å‘ç°é‚£ä¸ªæ•™ç¨‹çš„ä½œè€…å°±æ˜¯åšæ­Œå£°åˆæˆçš„ï¼Œè€Œä¸”ä» 2011 å¹´ 13 å²å¼€å§‹ï¼Œå› ä¸ºæƒ³è®©åˆéŸ³å”±ä¸­æ–‡ï¼Œå°±å¼€å§‹å†™ä»£ç ï¼Œä¸€å†™å°±å†™åˆ°ç°åœ¨ï¼Œä»åˆä¸­å†™åˆ°ç•™å­¦ç¾å›½å¸¸æ˜¥è—¤ï¼Œä»ç®€å•çš„æ—¶åŸŸæ‹¼æ¥åˆ°ç°åœ¨çš„æ·±åº¦ç¥ç»ç½‘ç»œã€éšé©¬å°”å¯å¤«æ¨¡å‹ã€‚ä»–åœ¨ä¸Šä¸ªæš‘å‡åˆ°é›…é©¬å“ˆï¼ˆvocaloid çš„åˆ¶ä½œå…¬å¸ï¼‰å®ä¹ ï¼Œå¹¶æ¨å‡ºäº†è‡ªå·±ç¬¬äº”æ¬¡é‡åˆ¶çš„æ­Œå£°åˆæˆå¼•æ“ Synthesizer Vã€‚ è¿™ä¸€ç³»åˆ—çš„äº‹è¿¹ï¼Œä¸ƒå¹´äº”æ¬¡é‡åˆ¶ï¼Œä»åˆä¸­ç”Ÿåˆ°ç°åœ¨åŒä¿®è®¡ç®—æœºç§‘å­¦å’Œæ•°å­¦ï¼Œç®€ç›´è®©äººå¹ä¸ºè§‚æ­¢ã€‚ è¿™ä½ä½œè€…çš„åå­—å«åä¾ƒå¦‚ï¼ˆKanru Huaï¼‰ï¼Œç½‘ç»œå¸¸ç”¨æ˜µç§° sleepwalkingï¼Œä»–çš„ä¸ªäººç½‘ç«™ Kanru Huaâ€™s Website - About Me. é€šè¿‡ä»–çš„åšå®¢ï¼Œæˆ‘äº†è§£åˆ°æ­Œå£°åˆæˆéœ€è¦ä¸¤ä¸ªæ–¹å‘çš„çŸ¥è¯†ï¼šä¿¡å·å¤„ç†å’Œæœºå™¨å­¦ä¹ ã€‚ äºæ˜¯æˆ‘æƒ³èµ·äº†æˆ‘çš„åˆå¿ƒã€‚ æˆ‘å°çš„æ—¶å€™ç‰¹åˆ«å–œæ¬¢æ‹†å„ç§ç”µå­è®¾å¤‡ï¼Œæ›¾ç»ç”¨æ‰‹æœºç”µæ± å’Œåæ‰‹ç”µåšè¿‡æ‰‹ç”µç­’ï¼Œå†åŠ ä¸Šä¸ªæ‰‹æœºæŒ¯åŠ¨å™¨ç”¨æ¥å“äººï¼Œè¿˜å–œæ¬¢åœ¨å®¶åšå„ç§å®éªŒã€‚ å¯æ•´ä¸ªå¤§å­¦ï¼Œæˆ‘çš„å„ç§æ‰‹å·¥è¯¾å®éªŒè¯¾å¼„å¾—ä¸€å¡Œç³Šæ¶‚ï¼Œå«åº•çš„å­˜åœ¨ã€‚è¿™æ ·è¯´æ¥ï¼Œå¦‚æœå½“åˆé€‰äº†ç”µå­ä¿¡æ¯å·¥ç¨‹ï¼Œå¯èƒ½ä¼šæ··å¾—æ›´å·®ã€‚ ä¿¡å·å¤„ç†å­¦å¾—ä¸€å›¢ç³Ÿï¼Œä¸€ç›´æƒ³åŠªåŠ›å¯åœ¨è¿™æ–¹é¢æ€»æ˜¯åŠé€”è€ŒåºŸã€‚ è¯´åˆ°åº•è¿˜æ˜¯è‡ªæ§åŠ›å¤ªå·®ï¼Œä¸ºä½•æˆ‘å°±ä¸èƒ½æŒ‰éƒ¨å°±ç­ä¸€å›å‘¢ï¼Ÿåˆ°åº•æ˜¯æ€ä¹ˆæçš„ä¼šå…»æˆè¿™æ ·çš„æ€§æ ¼ï¼Œè¿™æ ·çš„æ—¶å€™ä¼šå¾ˆæ¨è‡ªå·±çªå›Šçš„æ€§æ ¼ã€‚ å¦‚æœæˆ‘ä¹Ÿèƒ½åƒå®¤å‹ä¸€æ ·æŒ‰éƒ¨å°±ç­çš„å®Œæˆå­¦ä¸šï¼Œåªåœ¨ç©ºé—²æ—¶é—´åšè‡ªå·±çš„äº‹â€¦å¯æƒœæ²¡æœ‰å¦‚æœã€‚ ç»å¸¸ä¼šå‘Šè¯‰è‡ªå·±åšè¿‡çš„äº‹å·²ç»ä¸å¯é€†è½¬äº†ï¼Œä¸éœ€è¦åæ‚”ï¼Œæ‰€ä»¥ä¹Ÿä¸ä¼šåæ‚”ã€‚å¤§æ¦‚æ½œæ„è¯†é‡Œè¿˜æ˜¯ä¼šæœ‰æ€¨å¿µï¼Œæ‰€ä»¥æ‰ä¼šåœ¨è¿™æ ·çš„æ—¶åˆ»çˆ†å‘å‡ºæ»¡æ»¡çš„æ¶æ„ã€‚ åªæ˜¯åæ‚”å´ä¸åšå‡ºæ”¹å˜æ˜¯æ²¡æœ‰ç”¨çš„ï¼Œä½†æˆ‘å®Œå…¨ä¸ç›¸ä¿¡è‡ªå·±èƒ½æ”¹æ‰è¿™æ ·çš„æ€§æ ¼ï¼Œè‡ªæš´è‡ªå¼ƒã€‚çºµæ¬²ä¸€æ—¶çˆ½ï¼Œä¸€ç›´çºµæ¬²ä¸€ç›´çˆ½hhhâ€¦ è¯´è™½è¿™æ ·è¯´ï¼Œè¿˜æ˜¯æƒ³ç»§ç»­æŒ£æ‰ä¸‹å»ï¼Œä¿¡å·å¤„ç†å°±åƒä¸€é“æ§›ï¼Œä¸è·¨è¿‡å»æˆ‘æ— æ³•é¢å¯¹è‡ªå·±ã€‚ â€œå¸Œæœ›æ˜å¹´å¹´åº•çš„æ€»ç»“ä¸­ï¼Œæˆ‘ä¸è¦å†è¿™ä¹ˆä¸§â€ï¼Œè¿™æ ·å¤§å£°è¯´å‡ºæ¥çš„è¯ï¼Œè¨€å°±èƒ½â€œçµâ€å§ï¼Ÿæˆ‘è®°å¾—æˆ‘è¿æ°”ä¸€ç›´æŒºå¥½çš„ï¼ˆåˆçªå›Šåˆ°è¦é è¿æ°”ã€‚ã€‚ï¼‰ æ›´æ–°ï¼š ä»Šå¤©äºŒä¹¦ä»‹ç»ç»™æˆ‘ä¸€ç¯‡æ–‡ç« æˆ‘çš„ç¼–ç¨‹ç»å†ï¼Œä½œè€…å’Œæˆ‘ä¸€æ ·â€œä¸èƒ½å…¼é¡¾å…´è¶£ä¸å­¦ä¸šâ€ï¼Œå¤§ä¸€ç»“æŸå°±é€€å­¦äº†ï¼Œç°åœ¨åœ¨é˜¿é‡Œå·´å·´å·¥ä½œã€‚ ä»–åšå®¢çš„è§‚ç‚¹å¾ˆä¸­è‚¯ï¼š æˆ‘å®¶äººéƒ½æ˜¯å¾ˆä¼ ç»Ÿçš„ä¸€ä»£ï¼Œä¸ç†è§£æˆ‘å­¦ä¹ ç¼–ç¨‹æœ€ç»ˆèƒ½åšå‡ºä»€ä¹ˆï¼Œä»–ä»¬ä¸»å¼ å…ˆå®Œæˆå­¦ä¸šï¼Œå†åšè¿™ä»¶äº‹ã€‚ä½†æ˜¯æˆ‘å¾ˆæ¸…æ¥šæˆ‘è‡ªå·±çš„æ™ºå•†ï¼Œä¸è¶³ä»¥å¤šçº¿ç¨‹å¤„ç†ä¸åŒçš„å¤§é¢†åŸŸï¼Œæ‰€ä»¥æˆ‘é¡¶ç€å‹åŠ›ï¼ŒåŠªåŠ›åœ°åšå‡ºæ¥ä»–ä»¬èƒ½çœ‹å‡ºæ¥çš„ã€Œæˆç»©ã€ï¼Œæ‰èƒ½æ¢æ¥ä»–ä»¬çš„ç†è§£ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ é€šè¿‡ä½ çš„ç†æ€§åˆ†æï¼ŒåšæŒè®¤ä¸ºæŸä»¶äº‹æƒ…æ˜¯å¯¹çš„ï¼Œå°±åŠªåŠ›çš„å»åšï¼Œä¸è¦æ”¾å¼ƒäº†ä»¥åçœ‹åˆ°å¦ä¸€ä¸ªäººåšäº†ä½ æ›¾ç»æƒ³åšçš„ä¸œè¥¿ç„¶åæ„Ÿæ…¨å½“åˆåº”è¯¥æ€ä¹ˆæ ·æ€ä¹ˆæ ·ã€‚ â€“æˆ‘çš„ç¼–ç¨‹ç»å† åªæœ‰åœ¨å·²ç»æ‹¥æœ‰è§£å†³é—®é¢˜çš„èƒ½åŠ›çš„æ—¶å€™ï¼Œæ‰æœ‰èµ„æ ¼è€ƒè™‘é€€å­¦è¿™ä»¶äº‹ã€‚ â€“ä½ æ ¹æœ¬ç”¨ä¸ç€é€€å­¦ æˆ‘ä»”ç»†æƒ³äº†æƒ³ï¼Œæˆ‘ä¸éœ€è¦å¤ªåœ¨æ„è‡ªå·±â€œä¸èƒ½å…¼é¡¾â€ã€â€œè‡ªæ§åŠ›å¤ªå¼±â€ã€‚å¦‚æœçœŸè€ƒè™‘æ¸…æ¥šäº†å¾—å¤±ï¼Œæˆ‘åªéœ€è¦â€œæ‹¥æœ‰è§£å†³é—®é¢˜çš„èƒ½åŠ›â€ï¼Œç„¶åå»åšæˆ‘æƒ³åšçš„å°±è¡Œäº†ã€‚ æˆ‘è‡ªæ§åŠ›å¾ˆå¼±ï¼Œè€Œä¸”è¿™ä¹ˆå¤šå¹´äº†ä¸€ç›´æ”¹ä¸äº†ï¼Œå³ä½¿å†å»¶æœŸä¸€å¹´ï¼Œä¹Ÿæœ‰å¯èƒ½è¿˜æ˜¯æ‹¿ä¸åˆ°æ¯•ä¸šè¯ï¼ŒæŠ˜ç£¨è‡ªå·±è€Œå·²ã€‚ è€Œä¸Šç­çš„è¯ï¼Œå°±æš‘å‡å®ä¹ çš„ç»éªŒæ¥çœ‹ï¼Œå·¥ä½œéƒ½æœ‰è¿›åº¦æ¡å‚¬ç€ï¼Œåè€Œæ´»çš„æ›´æœ‰æœæ°”ã€‚ ","date":"2019-01-08","objectID":"/posts/relive-in-the-echo/:0:0","tags":["é—²è¨€ç¢è¯­","åˆå¿ƒ","æ­Œå£°åˆæˆ"],"title":"åœ¨å›å£°ä¸­é‡å†","uri":"/posts/relive-in-the-echo/"},{"categories":["æŠ€æœ¯"],"content":" æœ¬ç¬”è®°æ•´ç†è‡ªã€ŠSQL åŸºç¡€æ•™ç¨‹ã€‹ã€ã€ŠMySQL å¿…çŸ¥å¿…ä¼šã€‹å’Œç½‘ä¸Šèµ„æ–™ã€‚ä¸ªäººç¬”è®°ä¸ä¿è¯æ­£ç¡®ã€‚ ","date":"2018-06-17","objectID":"/posts/sql-basics-2-queries/:0:0","tags":["SQL","æ•°æ®åº“"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢","uri":"/posts/sql-basics-2-queries/"},{"categories":["æŠ€æœ¯"],"content":"ä¸€ã€å¤æ‚æŸ¥è¯¢ ","date":"2018-06-17","objectID":"/posts/sql-basics-2-queries/:1:0","tags":["SQL","æ•°æ®åº“"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢","uri":"/posts/sql-basics-2-queries/"},{"categories":["æŠ€æœ¯"],"content":"è§†å›¾ å°† SELECT æŸ¥è¯¢åŒ…è£…æˆä¸€ä¸ªè™šæ‹Ÿè¡¨ï¼Œè¯¥è™šæ‹Ÿè¡¨å°±è¢«ç§°ä¸ºè§†å›¾ã€‚ï¼ˆå› ä¸ºåªæ˜¯ä¸€ä¸ªåŒ…è£…ï¼Œå› æ­¤è§†å›¾çš„æ•°æ®ä¹Ÿä¼šéšç€åŸè¡¨çš„æ›´æ–°è€Œæ›´æ–°ï¼‰ ç”¨é€”ï¼š ç®€åŒ–å¤æ‚çš„SQLæŸ¥è¯¢ï¼Œç”¨å®ƒæ›¿æ¢å­æŸ¥è¯¢ï¼Œèƒ½é™ä½æŸ¥è¯¢çš„åµŒå¥—æ·±åº¦ã€‚ SELECT æŸ¥è¯¢çš„é‡ç”¨ï¼Œå‡å°‘é‡å¤æŸ¥è¯¢ã€‚ â€¦ åˆ›å»ºè§†å›¾ï¼š CREATEVIEW\u003cè§†å›¾åç§°\u003e(\u003cè§†å›¾åˆ—å1\u003e,\u003cè§†å›¾åˆ—å2\u003e...)AS\u003cSELECTè¯­å¥\u003e; å…¶ä¸­ SELECT çš„ç»“æœåˆ—å’Œè§†å›¾åˆ—åä¸€ä¸€å¯¹åº”ã€‚ 3. è§†å›¾çš„é™åˆ¶ 1. è§†å›¾çš„ SELECT å­å¥ï¼Œä¸èƒ½åŒ…å« ORDER BY å­å¥ã€‚å› ä¸ºè§†å›¾ä¹Ÿæ˜¯è¡¨ï¼Œè€Œè¡¨æ˜¯é›†åˆï¼Œå®ƒæ²¡æœ‰é¡ºåºã€‚ï¼ˆä¹Ÿæœ‰äº›DBæ”¯æŒè¯¥ç”¨æ³•ï¼Œä½†ä¸é€šç”¨ï¼‰ 1. è§†å›¾çš„æ›´æ–°ï¼šåªåœ¨å¾ˆæœ‰é™çš„æ¡ä»¶ä¸‹ï¼Œæ‰èƒ½åœ¨è§†å›¾ä¸Šä½¿ç”¨ INSERT/DELETE/UPDATE è¿™æ ·çš„å˜æ›´æ•°æ®çš„è¯­å¥ã€‚ï¼ˆè§†å›¾åº”è¯¥åªç”¨äºæ£€ç´¢ï¼Œèƒ½ä¸æ›´æ–°å°±ä¸è¦æ›´æ–°å®ƒï¼‰ 4. åˆ é™¤è§†å›¾ï¼šDROP VIEW \u003cè§†å›¾åç§°\u003e; ","date":"2018-06-17","objectID":"/posts/sql-basics-2-queries/:1:1","tags":["SQL","æ•°æ®åº“"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢","uri":"/posts/sql-basics-2-queries/"},{"categories":["æŠ€æœ¯"],"content":"å­æŸ¥è¯¢ å­æŸ¥è¯¢ï¼Œå…¶å®å°±æ˜¯ä¸€æ¬¡æ€§çš„è§†å›¾: SELECT...FROM(SELECT...-- è¿™å°±æ˜¯ä¸€ä¸ªå­æŸ¥è¯¢ï¼šåµŒå¥—çš„ select è¯­å¥ )AS\u003cåˆ«å\u003e... ä¸Šé¢çš„æŸ¥è¯¢çš„ FROM å­å¥ä¸­ï¼Œç»™å¦ä¸€ SELECT å­å¥å®šä¹‰äº†ä¸€ä¸ªåˆ«åï¼Œå¹¶å°†å®ƒä½œä¸ºäº†æŸ¥è¯¢å¯¹è±¡ã€‚è¿™å°±æ˜¯ä¸€ä¸ªå­æŸ¥è¯¢ã€‚ å­æŸ¥è¯¢ä¸ä»…èƒ½ç”¨äº FROMï¼Œè¿˜èƒ½ç”¨åœ¨ WHERE å­å¥ç­‰å¾ˆå¤šåœ°æ–¹ã€‚ å…³è”å­æŸ¥è¯¢ å³ç”¨åˆ°äº†å¤–éƒ¨æ•°æ®çš„å­æŸ¥è¯¢è¯­å¥ï¼š SELECT...FROMproductASp1WHERE(SELECT...FROMduckASp2WHEREp1.price\u003ep2.price-- è¿™é‡Œï¼Œå†…éƒ¨å­æŸ¥è¯¢è®¿é—®äº†å¤–éƒ¨æŸ¥è¯¢çš„è¡¨p1ï¼Œå› æ­¤æ˜¯ä¸€ä¸ªå…³è”å­æŸ¥è¯¢ã€‚ ); ","date":"2018-06-17","objectID":"/posts/sql-basics-2-queries/:1:2","tags":["SQL","æ•°æ®åº“"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢","uri":"/posts/sql-basics-2-queries/"},{"categories":["æŠ€æœ¯"],"content":"äºŒã€å‡½æ•°ã€è°“è¯ã€CASE è¡¨è¾¾å¼ ","date":"2018-06-17","objectID":"/posts/sql-basics-2-queries/:2:0","tags":["SQL","æ•°æ®åº“"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢","uri":"/posts/sql-basics-2-queries/"},{"categories":["æŠ€æœ¯"],"content":"å‡½æ•° ç»™å‡ºçš„é“¾æ¥éƒ½æ˜¯ MySQL çš„ ç®—æœ¯å‡½æ•° åŠ å‡ä¹˜é™¤ï¼š+ - * / ABS ç»å¯¹å€¼ MOD æ±‚ä½™ ROUND å››èˆäº”å…¥ å­—ç¬¦ä¸²å‡½æ•° CONCAT(str1,str2,â€¦) æ‹¼æ¥ LENGTH(str) å­—ç¬¦ä¸²çš„ bytes é•¿åº¦ CHAR_LENGTH(str) LOWER/UPPER å¤§å°å†™è½¬æ¢ REPLACE(str,from_str,to_str) æ›¿æ¢ SUBSTRING(str FROM pos FOR len) æˆªå– æ—¶é—´å’Œæ—¥æœŸå‡½æ•° CURRENT_DATE å½“å‰æ—¥æœŸ CURRENT_TIME å½“å‰æ—¶é—´ CURRENT_TIMESTAMP å½“å‰çš„æ—¥æœŸå’Œæ—¶é—´ EXTRACT(unit FROM date) æˆªå–æ—¥æœŸå…ƒç´ ï¼Œunit å¯ä¸º YEAR MONTH HOUR ç­‰ç­‰ è½¬æ¢å‡½æ•° CAST(expr AS type) å°† expr çš„ç»“æœè½¬æ¢æˆ type ç±»å‹ COALESCE(value,â€¦) ä»å·¦å¾€å³æ‰«æï¼Œè¿”å›ç¬¬ä¸€ä¸ªé NULL çš„å€¼ã€‚å¸¸ç”¨äºå°† NULL è½¬æ¢ä¸ºå…¶ä»–å€¼ã€‚eg. COALESCE(sth, 1) å¦‚æœ sth ä¸º NULL å°±ä¼šè¿”å›1. èšåˆå‡½æ•°ï¼šåŸºæœ¬å°±äº”ä¸ªï¼Œå·²ç»å­¦è¿‡äº†ã€‚ ","date":"2018-06-17","objectID":"/posts/sql-basics-2-queries/:2:1","tags":["SQL","æ•°æ®åº“"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢","uri":"/posts/sql-basics-2-queries/"},{"categories":["æŠ€æœ¯"],"content":"è°“è¯ å³è¿”å›å¸ƒå°”å€¼çš„è¡¨è¾¾å¼ LIKEè°“è¯â€”â€”ç®€å•å­—ç¬¦ä¸²åŒ¹é…ï¼ˆæ…¢ï¼‰ åŒ¹é…æ•´ä¸ªåˆ— %ï¼šä»»æ„å­—ç¬¦å‡ºç°ä»»æ„æ¬¡ _ï¼šåŒ¹é…ä»»æ„ä¸€ä¸ªå­—ç¬¦ ä¸¾ä¾‹ï¼š SELECTnameFROMlistWHEREnameLIKE'%Ryan%';-- åŒ¹é…ä»»æ„åŒ…å« 'Ryan' çš„å­—ç¬¦ä¸² REGEXPè°“è¯â€”â€”æ­£åˆ™å­—ç¬¦ä¸²åŒ¹é… MySQL åªå®ç°äº†é€šç”¨æ­£åˆ™çš„ä¸€ä¸ªå­é›†ï¼Œè€Œä¸”æ˜¯searchæ¨¡å¼ã€‚ï¼ˆématchï¼‰ å…¶ä»– BETWEENï¼šèŒƒå›´åŒ¹é…ï¼Œeg. BETWEEN 1 AND 10 IS NULLã€IS NOT NULL INã€NOT INï¼šæ˜¯å¦åœ¨æŸé›†åˆå†… EXISTSã€NOT EXISTSï¼ˆæ¯”è¾ƒéš¾çš„ä¸€ä¸ªï¼Œå…¥é—¨é˜¶æ®µä¸è¦æ±‚ï¼‰ï¼šè¯¥è°“è¯æ¯”è¾ƒç‰¹æ®Šï¼Œåªéœ€è¦å³ä¾§ä¸€ä¸ªå‚æ•°ï¼Œ**è€Œä¸”è¯¥å‚æ•°ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯ä¸€ä¸ªå…³è”å­æŸ¥è¯¢ã€‚**è€Œä¸”è¯¥å­æŸ¥è¯¢çš„SELECTå­å¥çš„å‚æ•°åŸºæœ¬å¯ä»¥éšæ„ï¼Œé€šå¸¸ä½¿ç”¨SELECT *. å¯¹äºå­æŸ¥è¯¢æœ‰è¿”å›å€¼çš„åˆ—ï¼Œå®ƒè¿”å›Trueï¼Œå¦åˆ™è¿”å›False. ä½†è¦æ³¨æ„ä¸º NULL æ—¶è¿”å› UNKNOW.ï¼ˆè€Œ WHERE åªè®¤ Trueï¼‰ ","date":"2018-06-17","objectID":"/posts/sql-basics-2-queries/:2:2","tags":["SQL","æ•°æ®åº“"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢","uri":"/posts/sql-basics-2-queries/"},{"categories":["æŠ€æœ¯"],"content":"CASE è¡¨è¾¾å¼ if - else if - else å½¢å¼ï¼š CASEWHEN\u003cæ±‚å€¼è¡¨è¾¾å¼\u003eTHEN\u003cè¡¨è¾¾å¼\u003eWHEN\u003cæ±‚å€¼è¡¨è¾¾å¼\u003eTHEN\u003cè¡¨è¾¾å¼\u003eWHEN\u003cæ±‚å€¼è¡¨è¾¾å¼\u003eTHEN\u003cè¡¨è¾¾å¼\u003e...ELSE\u003cè¡¨è¾¾å¼\u003eEND switch æ¨¡å¼ï¼ˆä½†ä¸éœ€è¦breakï¼‰ CASE\u003cè¡¨è¾¾å¼\u003eWHEN\u003cè¡¨è¾¾å¼\u003eTHEN\u003cè¡¨è¾¾å¼\u003eWHEN\u003cè¡¨è¾¾å¼\u003eTHEN\u003cè¡¨è¾¾å¼\u003e...ELSE\u003cè¡¨è¾¾å¼\u003eEND è¿™æ˜¯å¯¹ CASE åçš„å…ƒç´ åšswitchæ¯”è¾ƒã€‚ ","date":"2018-06-17","objectID":"/posts/sql-basics-2-queries/:2:3","tags":["SQL","æ•°æ®åº“"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢","uri":"/posts/sql-basics-2-queries/"},{"categories":["æŠ€æœ¯"],"content":"ä¸‰ã€é›†åˆè¿ç®— ","date":"2018-06-17","objectID":"/posts/sql-basics-2-queries/:3:0","tags":["SQL","æ•°æ®åº“"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢","uri":"/posts/sql-basics-2-queries/"},{"categories":["æŠ€æœ¯"],"content":"æ³¨æ„äº‹é¡¹ ä½œä¸ºè¿ç®—å¯¹è±¡çš„ç»“æœé›†ï¼Œåˆ—å­—æ®µå¿…é¡»ä¸€ä¸€å¯¹åº”ï¼Œè€Œä¸”å¯¹åº”åˆ—çš„ç±»å‹å¿…é¡»ç›¸åŒã€‚ ","date":"2018-06-17","objectID":"/posts/sql-basics-2-queries/:3:1","tags":["SQL","æ•°æ®åº“"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢","uri":"/posts/sql-basics-2-queries/"},{"categories":["æŠ€æœ¯"],"content":"ç»“æœé›†çš„äº¤å¹¶å·® \u003cæŸ¥è¯¢1\u003e UNION \u003cæŸ¥è¯¢2\u003eï¼šå¯¹ä¸¤ä¸ªç»“æœé›†æ±‚å¹¶ UNION ALLï¼šæ·»åŠ  ALL èƒ½ä½¿ç»“æœé›†åŒ…å«é‡å¤è¡Œã€‚ \u003cæŸ¥è¯¢1\u003e INTERSECT \u003cæŸ¥è¯¢2\u003eï¼šä¸¤ç»“æœé›†çš„äº¤é›† \u003cæŸ¥è¯¢1\u003e EXCEPT \u003cæŸ¥è¯¢2\u003eï¼šä¸¤ç»“æœé›†çš„å·®é›† ","date":"2018-06-17","objectID":"/posts/sql-basics-2-queries/:3:2","tags":["SQL","æ•°æ®åº“"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢","uri":"/posts/sql-basics-2-queries/"},{"categories":["æŠ€æœ¯"],"content":"ä»¥åˆ—ä¸ºå•ä½ï¼Œå¯¹è¡¨è¿›è¡Œè”ç»“(JOIN) æœ€å¼ºå¤§çš„åŠŸèƒ½ä¹‹ä¸€ äº¤å¹¶å·®æ˜¯ä»¥è¡Œä¸ºå•ä½çš„æ“ä½œï¼Œæ˜¯ç«–å‘çš„è¿ç®—ã€‚è€Œè”ç»“æ˜¯ä»¥åˆ—ä¸ºå•ä½çš„æ“ä½œï¼Œæ˜¯æ¨ªå‘çš„æ‹¼æ¥ã€‚ å†…è”(INNER JOIN) å†…è”ç»“æœåªåŒ…å«ä¸¤è¡¨çš„äº¤é›† è¯­æ³•ï¼š SELECT...FROM(productINNERJOINshopONproduct.p_id=shop.p_id)WHEREfilter_condition; ä½¿ç”¨ è·Ÿåœ¨ INNER JOIN å­å¥åçš„ ON å­å¥æŒ‡å®šè”ç»“æ¡ä»¶ã€‚ï¼ˆè¿™é‡Œæˆ‘ç‰¹æ„ç”¨äº†æ‹¬å·ï¼Œè¡¨ç¤º JOIN å’Œ ON ä¸¤ä¸ªå­å¥æ˜¯é…å¥—çš„ï¼‰ ä¹Ÿæœ‰å¦ä¸€ä¸ªå¾ˆå¸¸ç”¨çš„è¯­æ³•ï¼ˆä½†æ˜¯ç°åœ¨å·²ç»ä¸æ¨èä½¿ç”¨ï¼‰ï¼š SELECT...FROMproduct,shopWHEREproduct.p_id=shop.p_idANDfilter_condition; å¯¹äº shop è¡¨ä¸­æœ‰å¤šè¡Œå¯¹åº”åŒä¸€ä¸ª product çš„æƒ…å†µï¼ˆæœ‰å¤šäººè´­ä¹°äº†åŒä¸€æ¬¾å•†å“ï¼‰ï¼Œç»“æœä¸­è¯¥ product ä¼šè¢«å¤åˆ¶ç»™ shop ä¸­çš„å¤šä¸ªè´­ä¹°è®°å½•ã€‚ï¼ˆä¹Ÿå°±æ˜¯è¯´è¯¥ product ä¼šå˜æˆå¤šè¡Œï¼‰ INNER å¯ä»¥çœç•¥ï¼Œä¹Ÿå°±æ˜¯è¯´åªå†™ JOINï¼Œå°±é»˜è®¤æ˜¯ INNER JOIN å¤–è”(OUTER JOIN) **å¤–è”ä»¥æŸè¡¨ä¸ºä¸»è¡¨ï¼Œå°†å¦ä¸€è¡¨çš„åˆ—è”ç»“åˆ°è¯¥è¡¨ã€‚**å¦ä¸€è¡¨æ²¡æœ‰å€¼çš„åˆ—ï¼Œå°±ç”¨ NULL ä»£æ›¿ã€‚ä½¿ç”¨LEFT æˆ– RIGHTæŒ‡å®šä¸»è¡¨ã€‚ï¼ˆä¸¤ä¸ªå…³é”®å­—éƒ½èƒ½å®ç°åŒæ ·çš„æ•ˆæœï¼Œä¸è¿‡ç”¨ LEFT çš„å¤šä¸€äº›ï¼‰ è¯­æ³•ï¼š SELECT...FROMproductLEFTOUTERJOINshopONproduct.p_id=shop.p_id; è¿™å’Œå†…è”å¾ˆç›¸ä¼¼ï¼Œå·®åˆ«åªæ˜¯è”ç»“å…³é”®è¯æ”¹æˆäº†LEFT OUTER JOINã€‚è¿™è¡¨ç¤ºä»¥å·¦è¾¹çš„è¡¨ä¸ºä¸»è¡¨ï¼ŒæŠŠå³è¾¹çš„è¡¨çš„å†…å®¹è”ç»“ä¸Šå»ã€‚å› æ­¤å·¦è¡¨çš„æ‰€æœ‰åˆ—éƒ½ä¼šå‡ºç°åœ¨ç»“æœé›†ä¸­ã€‚ å¤šè¡¨è”æŸ¥ä¸¾ä¾‹ï¼š -- ç™»å½•å¼‚å¸¸çš„è´¦å·åŠå¯†ç  selectdistinctbatches.identity_numberas'ç™»å½•å¤±è´¥è´¦å·',accounts.passwordfrom((batchesleftouterjointasksonbatches.id=tasks.batch_id)-- æ‰¹æ¬¡è¡¨è”ç»“å…·ä½“çš„ä»»åŠ¡è¡¨ leftouterjoin`status`ontasks.id=status.task_id)-- å†è”ç»“ä¸ŠçŠ¶æ€è¡¨ leftouterjoinaccountsonbatches.identity_number=accounts.identity_number-- å†è”ç»“ä¸Šè´¦å·è¡¨ where`status`.step_type='check_login'-- åªæå– \"check_login\" æ­¥éª¤çš„è®°å½• andstatus.status!='info'-- çŠ¶æ€ä¸ä¸º infoï¼Œè¯´æ˜ç™»å½•å¼‚å¸¸ æ­¤å¤–è¿˜æœ‰ FULL OUTER JOIN è¡¨ç¤ºè¿”å›å·¦å³ä¸¤è¡¨çš„æ‰€æœ‰è¡Œï¼æ‰€æœ‰æ²¡æœ‰åŒ¹é…çš„è¡Œéƒ½ç»™å‡º NULL P.S. å…¶ä¸­çš„å…³é”®å­— OUTER é€šå¸¸å¯çœç•¥ã€‚ä½†æ˜¯ LEFTã€RIGHTã€FULL ä¸å¯ä»¥çœç•¥ã€‚ ","date":"2018-06-17","objectID":"/posts/sql-basics-2-queries/:3:3","tags":["SQL","æ•°æ®åº“"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢","uri":"/posts/sql-basics-2-queries/"},{"categories":["æŠ€æœ¯"],"content":"ç”»å¤–ï¼šå­—æ®µå¼•ç”¨ç¬¦å· å¦‚æœæ•°æ®åº“çš„å­—æ®µå/æ•°æ®åº“å/è¡¨åå¯èƒ½å’Œæ•°æ®åº“å…³é”®å­—é‡å¤ï¼Œå°±éœ€è¦ç”¨å¼•ç”¨ç¬¦å·å°†ä»–ä»¬å¼•ç”¨èµ·æ¥ï¼Œæ¶ˆé™¤æ­§ä¹‰ã€‚ MySQL ä¸­ç»å¸¸ç”¨åå¼•å·å¹²è¿™ä¸ªäº‹ã€‚ è€Œ SQL Server åˆ™ä½¿ç”¨æ–¹æ‹¬å·ã€‚ æ ‡å‡† SQL ä½¿ç”¨åŒå¼•å·ã€‚åœ¨çœ‹åˆ°è¿™äº›ç¬¦å·æ—¶è¦çŸ¥é“è¿™äº›å·®åˆ«ã€‚ ","date":"2018-06-17","objectID":"/posts/sql-basics-2-queries/:4:0","tags":["SQL","æ•°æ®åº“"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢","uri":"/posts/sql-basics-2-queries/"},{"categories":["æŠ€æœ¯"],"content":"æŸ¥è¯¢è¯­å¥åˆ†æ MySQL Explainè¯¦è§£ ","date":"2018-06-17","objectID":"/posts/sql-basics-2-queries/:5:0","tags":["SQL","æ•°æ®åº“"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢","uri":"/posts/sql-basics-2-queries/"},{"categories":["æŠ€æœ¯"],"content":"å¸¸è§é—®é¢˜ ","date":"2018-06-17","objectID":"/posts/sql-basics-2-queries/:6:0","tags":["SQL","æ•°æ®åº“"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢","uri":"/posts/sql-basics-2-queries/"},{"categories":["æŠ€æœ¯"],"content":"éšå¼ç±»å‹è½¬æ¢ åœ¨MySQLä¸­ï¼Œå½“æ“ä½œç¬¦ä¸ä¸åŒç±»å‹çš„æ“ä½œæ•°ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œä¼šå‘ç”Ÿç±»å‹è½¬æ¢ä»¥ä½¿æ“ä½œæ•°å…¼å®¹ã€‚åˆ™ä¼šå‘ç”Ÿéšå¼ç±»å‹è½¬æ¢ã€‚ éšå¼ç±»å‹è½¬æ¢ä¼šå¯¼è‡´æŸ¥è¯¢ä¸ä¼šèµ°ç´¢å¼•ï¼ï¼ï¼å¯èƒ½ä¼šä¸¥é‡æ‹–ç´¯æ€§èƒ½ã€‚å¦å¤–è¿˜å¯èƒ½ä¼šå¯¼è‡´å„ç§å¥‡æ€ªçš„é—®é¢˜ã€‚ è¯¦è§ MYSQLéšå¼ç±»å‹è½¬æ¢ å®Œã€‚ï¼ˆæ¥ä¸‹æ¥å°±æ˜¯ç”¨ Python/Java è¿æ¥ MySQL äº†ï¼‰ ","date":"2018-06-17","objectID":"/posts/sql-basics-2-queries/:6:1","tags":["SQL","æ•°æ®åº“"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢","uri":"/posts/sql-basics-2-queries/"},{"categories":["æŠ€æœ¯"],"content":" æœ¬ç¬”è®°æ•´ç†è‡ªã€ŠSQL åŸºç¡€æ•™ç¨‹ã€‹ã€ã€ŠMySQL å¿…çŸ¥å¿…ä¼šã€‹å’Œç½‘ä¸Šèµ„æ–™ã€‚ä¸ªäººç¬”è®°ä¸ä¿è¯æ­£ç¡®ã€‚ ","date":"2018-06-15","objectID":"/posts/sql-basics-1/:0:0","tags":["SQL","æ•°æ®åº“"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸€ï¼‰","uri":"/posts/sql-basics-1/"},{"categories":["æŠ€æœ¯"],"content":"ä¸€ã€åŸºç¡€ SQLï¼Œå³ç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€ï¼Œæ˜¯ä¸ºè®¿é—®ä¸æ“ä½œå…³ç³»æ•°æ®åº“ä¸­çš„æ•°æ®è€Œè®¾è®¡çš„è¯­è¨€ã€‚ å…³ç³»æ•°æ®åº“ä»¥è¡Œ(row)ä¸ºå•ä½è¯»å†™æ•°æ® SQL æ ¹æ®åŠŸèƒ½çš„ä¸åŒï¼Œå¯åˆ†ä¸ºä¸‰ç±»ï¼ˆå…¶ä¸­DMLç”¨å¾—æœ€å¤šï¼Œå¢åˆ æŸ¥æ”¹å˜›ï¼‰ DDL(Data Definition Language, æ•°æ®å®šä¹‰è¯­è¨€): CREATE/DROP/ALTER DML(Data Manipulation Language, æ•°æ®æ“ä½œè¯­è¨€): SELECT/INSERT/UPDATE/DELETE DCL(Data Control Language, æ•°æ®æ§åˆ¶è¯­è¨€): COMMIT/ROLLBACK/GRANT/REVOKE SQL è¯­å¥è¦ä»¥åˆ†å·ç»“å°¾ã€‚æ¢è¡Œåœ¨ SQL ä¸­ä¸è¡¨ç¤ºç»“æŸï¼Œè€Œç­‰åŒäºç©ºæ ¼ã€‚ SQL ä¸åŒºåˆ†**å…³é”®å­—(Keyword)**çš„å¤§å°å†™ï¼Œä½†æ˜¯æè¿°ç¬¦å°±ä¸ä¸€å®šäº†ã€‚ è¿™é‡Œæœ‰ä¸ªå‘ï¼šMySQL ä¸­ï¼Œæ•°æ®åº“å’Œè¡¨å…¶å®å°±æ˜¯æ•°æ®ç›®å½•ä¸‹çš„ç›®å½•å’Œæ–‡ä»¶ï¼Œå› è€Œï¼Œæ“ä½œç³»ç»Ÿçš„æ•æ„Ÿæ€§å†³å®šæ•°æ®åº“åå’Œè¡¨å æ˜¯å¦å¤§å°å†™æ•æ„Ÿã€‚è¿™å°±æ„å‘³ç€æ•°æ®åº“åå’Œè¡¨ååœ¨ Windows ä¸­æ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„ï¼Œè€Œåœ¨å¤§å¤šæ•°ç±»å‹çš„ Unix/Linux ç³»ç»Ÿä¸­æ˜¯å¤§å°å†™æ•æ„Ÿçš„ã€‚ï¼ˆæ³¨æ„ä»…æŒ‡æ•°æ®åº“åå’Œè¡¨åï¼‰å¯é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶çš„lower_case_table_nameså±æ€§æ¥ç»Ÿä¸€è¿™ä¸€è¡Œä¸ºã€‚ è€Œå­—æ®µåã€å­—æ®µå†…å®¹éƒ½æ˜¯å†…éƒ¨æ•°æ®ï¼Œæ˜¯æ“ä½œç³»ç»Ÿæ— å…³çš„ã€‚å®ƒä»¬çš„å¤§å°å†™æ•æ„Ÿæ€§ï¼Œç”± MySQL çš„çš„æ ¡å¯¹ï¼ˆCOLLATEï¼‰è§„åˆ™æ¥æ§åˆ¶ã€‚è¯¥è§„åˆ™ä½“ç°åœ¨ MySQL çš„ æ ¡å¯¹å­—ç¬¦é›†ï¼ˆCOLLATIONï¼‰çš„åç¼€ä¸Šï¼šæ¯”å¦‚ utf8å­—ç¬¦é›†ï¼Œutf8_general_ciè¡¨ç¤ºä¸åŒºåˆ†å¤§å°å†™ï¼Œè¿™ä¸ªæ˜¯ utf8 å­—ç¬¦é›†é»˜è®¤çš„æ ¡å¯¹è§„åˆ™ï¼›utf8_general_cs è¡¨ç¤ºåŒºåˆ†å¤§å°å†™ï¼Œutf8_bin è¡¨ç¤ºäºŒè¿›åˆ¶æ¯”è¾ƒï¼ŒåŒæ ·ä¹ŸåŒºåˆ†å¤§å°å†™ ã€‚ SQL ä¸­çš„å­—ç¬¦ä¸²å’Œæ—¥æœŸéœ€è¦ç”¨å•å¼•å·å¼•ç”¨èµ·æ¥ï¼Œæ—¥æœŸæœ‰ç‰¹å®šæ ¼å¼å¹´-æœˆ-æ—¥ ä¿®æ”¹å­—ç¬¦é›†ï¼šset names \u003cå­—ç¬¦é›†å\u003e è®°ä½åœ¨ MySQL ä¸­ï¼Œutf-8mb4 æ‰æ˜¯å®Œå…¨çš„ utf-8å­—ç¬¦é›†ã€‚ ","date":"2018-06-15","objectID":"/posts/sql-basics-1/:1:0","tags":["SQL","æ•°æ®åº“"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸€ï¼‰","uri":"/posts/sql-basics-1/"},{"categories":["æŠ€æœ¯"],"content":"äºŒã€DDL ","date":"2018-06-15","objectID":"/posts/sql-basics-1/:2:0","tags":["SQL","æ•°æ®åº“"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸€ï¼‰","uri":"/posts/sql-basics-1/"},{"categories":["æŠ€æœ¯"],"content":"1. æ•°æ®åº“çš„åˆ›å»ºå’Œåˆ é™¤ åˆ›å»ºæ•°æ®åº“ CREATEDATABASE\u003cæ•°æ®åº“åç§°\u003e; DROPDATABASE\u003cæ•°æ®åº“åç§°\u003e; ","date":"2018-06-15","objectID":"/posts/sql-basics-1/:2:1","tags":["SQL","æ•°æ®åº“"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸€ï¼‰","uri":"/posts/sql-basics-1/"},{"categories":["æŠ€æœ¯"],"content":"2. åˆ›å»ºè¡¨ï¼š å…³ç³»è¡¨çš„è®¾è®¡ å…³ç³»è¡¨çš„è®¾è®¡ï¼Œè¦ç¡®ä¿æŠŠä¿¡æ¯åˆ†è§£æˆå¤šä¸ªè¡¨ï¼Œä¸€ç±»ä¿¡æ¯ä¸€ä¸ªè¡¨ï¼Œå„è¡¨é€šè¿‡æŸäº›å¸¸ç”¨çš„ï¼ŒåŸºæœ¬ä¸ä¼šæ”¹å˜çš„å€¼ï¼ˆå³å…³ç³»è¡¨è®¾è®¡ä¸­çš„å…³ç³»ï¼Œä¹Ÿå¸¸ç§°ä¸ºå¤–é”®ï¼‰äº’ç›¸å…³è”ã€‚å°½é‡ä¸è¦æœ‰å†—ä½™æ•°æ®ã€‚ è¯­å¥ï¼š CREATETABLE\u003cè¡¨å\u003e(\u003cåˆ—å1\u003e\u003cæ•°æ®ç±»å‹\u003e\u003cè¯¥åˆ—æ‰€éœ€çº¦æŸ\u003e,\u003cåˆ—å2\u003e\u003cæ•°æ®ç±»å‹\u003e\u003cè¯¥åˆ—æ‰€éœ€çº¦æŸ\u003e,\u003cåˆ—å3\u003e\u003cæ•°æ®ç±»å‹\u003e\u003cè¯¥åˆ—æ‰€éœ€çº¦æŸ\u003e,...\u003cè¯¥è¡¨çš„çº¦æŸ1\u003e,\u003cè¯¥è¡¨çš„çº¦æŸ2\u003e...); ä¸¾ä¾‹ï¼š CREATETABLE`persons`(`id`INTUNSIGNEDNOTNULLAUTO_INCREMENT,`name`CHAR(20)NOTNULL,PRIMARYKEY(`id`))ENGINE=InnoDBDEFAULTCHARSET=utf8mb4; åé¢çš„æ˜¯è®¾ç½®å¼•æ“å’Œé»˜è®¤å­—ç¬¦é›†ã€‚å·¥ä½œä¸Šï¼Œè¡¨çš„è®¾è®¡ä¸€å®šè¦æ·±æ€ç†Ÿè™‘ï¼Œå› ä¸ºæ”¹èµ·æ¥å¾ˆå›°éš¾ã€‚ å­—æ®µç±»å‹ï¼ˆMySQLï¼‰ æœ‰å››ç±»æ•°æ®ç±»å‹ï¼šå­—ç¬¦ä¸²ã€æ•°å­—ã€æ—¥æœŸã€äºŒè¿›åˆ¶ã€‚å®ƒä»¬åˆæ ¹æ®æ•°æ®é•¿åº¦çš„åŒºåˆ«ï¼Œä¸‹åˆ†ä¸ºå¤šä¸ªç±»å‹ã€‚ å­—ç¬¦ä¸²ï¼š æ•°å­— æ—¥æœŸ äºŒè¿›åˆ¶ çº¦æŸ SQL çº¦æŸæ˜¯é™¤äº†æ•°æ®ç±»å‹ä¹‹å¤–ï¼Œå¯¹åˆ—ä¸­æ•°æ®è¿½åŠ çš„é™å®šæ¡ä»¶ã€‚ ç±»å‹çº¦æŸï¼šNOT NULLã€AUTO_INCREMENTã€UNSIGNEDï¼ˆè¿™ä¸ªåª MySQL æ”¯æŒï¼‰ é»˜è®¤å€¼ï¼šDEFAULTï¼Œä¸¾ä¾‹ \u003cåˆ—å3\u003e VARCHAR(32) NOT NULL DEFAULT \"los angeles\" è¡¨çº¦æŸï¼šPRIMARY KEY ä¸»é”®çº¦æŸï¼ˆä¸»é”®é»˜è®¤ UNIQUE ä¸” NOT NULLï¼‰ æ­¤å¤–è¿˜æœ‰ FOREIGN KEY å’Œ CHECK ä¸¤ä¸ªçº¦æŸè¯­å¥ï¼Œåœ¨è¿›é˜¶ç¬”è®°ä¸­ä»‹ç»ã€‚ P.S. å­—æ®µçº¦æŸä¹Ÿå¯ä»¥å†™æˆè¡¨çº¦æŸï¼ˆæ¯”å¦‚ä¸»é”®çº¦æŸï¼‰ï¼Œè€Œåè¿‡æ¥å¾ˆå¯èƒ½ä¸è¡Œã€‚ ","date":"2018-06-15","objectID":"/posts/sql-basics-1/:2:2","tags":["SQL","æ•°æ®åº“"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸€ï¼‰","uri":"/posts/sql-basics-1/"},{"categories":["æŠ€æœ¯"],"content":"3. åˆ é™¤è¡¨å’Œæ›´æ–°è¡¨å®šä¹‰ åˆ é™¤è¡¨ï¼ˆå±é™©æ“ä½œï¼‰ åˆ é™¤æ•´ä¸ªè¡¨ï¼š DROPTABLE\u003cè¡¨å\u003e; - åªæ¸…ç©ºè¡¨å†…æ•°æ®ï¼Œä½†ç•™ä¸‹è¡¨ï¼š TRUNCATE\u003cè¡¨å\u003e;-- éæ ‡å‡†SQLè¯­å¥ï¼Œä½†æ˜¯å¤§éƒ¨åˆ†DBéƒ½æ”¯æŒã€‚ï¼ˆå¯èƒ½ä¸èƒ½ROLLBACKï¼‰ æ›´æ–°è¡¨å®šä¹‰ï¼ˆéº»çƒ¦çš„æ“ä½œï¼‰ æ‰€ä»¥æ‰€åˆ›å»ºè¡¨å‰è¦ä»”ç»†æƒ³å¥½æ ¼å¼äº†ï¼Œæ›´æ–°è¡¨å®šä¹‰æ˜¯ä¸å¾—å·²æ‰èƒ½ä¸ºä¹‹ã€‚ æ·»åŠ åˆ—å®šä¹‰ï¼š ALTERTABLE\u003cè¡¨å\u003eADDCOLUMN\u003cåˆ—å\u003e\u003cæ•°æ®ç±»å‹\u003e\u003cè¯¥åˆ—çš„çº¦æŸ\u003e; åˆ é™¤åˆ—å®šä¹‰ï¼š ALTERTABLE\u003cè¡¨å\u003eDROPCOLUMN\u003cåˆ—å\u003e; ","date":"2018-06-15","objectID":"/posts/sql-basics-1/:2:3","tags":["SQL","æ•°æ®åº“"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸€ï¼‰","uri":"/posts/sql-basics-1/"},{"categories":["æŠ€æœ¯"],"content":"ä¸‰ã€DML ä¸‡æ¶ä¹‹æº NULL ","date":"2018-06-15","objectID":"/posts/sql-basics-1/:3:0","tags":["SQL","æ•°æ®åº“"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸€ï¼‰","uri":"/posts/sql-basics-1/"},{"categories":["æŠ€æœ¯"],"content":"1. æŸ¥è¯¢ï¼ˆé‡ç‚¹ï¼‰ åŸºæœ¬è¯­å¥ï¼š SELECT \u003cå­—æ®µ1\u003e AS \u003cåˆ«å1\u003e, \u003cå­—æ®µ2\u003e AS \u003cåˆ«å2\u003e, ... FROM \u003cè¡¨å\u003e WHERE \u003cè¿‡æ»¤æ¡ä»¶\u003e; å¯ç”¨ DISTINCT ä¿®é¥°åˆ—åï¼Œä½¿æŸ¥è¯¢ç»“æœæ— é‡ã€‚ä¾‹ï¼šSELECT DISTINCT \u003cåˆ—å\u003e FROM \u003cè¡¨å\u003e è¿‡æ»¤æ¡ä»¶å¯ä½¿ç”¨æ¯”è¾ƒè¿ç®—(\u003c\u003eã€=ç­‰)å’Œé€»è¾‘è¿ç®—(AND OR NOT). è¿‡æ»¤æ¡ä»¶ä¸­ï¼Œæ¯”è¾ƒè¿ç®—ä¼šæ°¸è¿œå¿½ç•¥ NULL å€¼ï¼Œå¦‚æœéœ€è¦å¯¹ NULL å€¼åšæ“ä½œï¼Œéœ€è¦ä½¿ç”¨ IS NULL æˆ– IS NOT NULLï¼ˆè¯´å¿½ç•¥ä¹Ÿè®¸ä¸å¤ªå‡†ç¡®ï¼ŒNULL æ—¢ä¸ä¸ºçœŸä¹Ÿä¸ä¸ºå‡ï¼Œåæ­£å°‘ç”¨NULLã€‚ã€‚ï¼‰ åŒ…å«NULLçš„å››åˆ™è¿ç®—ï¼Œå¾—åˆ°çš„ç»“æœæ€»ä¸ºNULL ","date":"2018-06-15","objectID":"/posts/sql-basics-1/:3:1","tags":["SQL","æ•°æ®åº“"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸€ï¼‰","uri":"/posts/sql-basics-1/"},{"categories":["æŠ€æœ¯"],"content":"2. èšåˆä¸æ’åºï¼ˆé‡ç‚¹ï¼‰ èšåˆå‡½æ•° å³å¯¹åˆ—è¿›è¡Œç»Ÿè®¡åˆ†æçš„å‡½æ•°ï¼Œä¸»è¦æœ‰äº”ä¸ªï¼š COUNTï¼šè®¡ç®—åˆ—çš„è¡Œæ•°ã€‚ï¼ˆåªæœ‰COUNT(*)ä¼šè®¡ç®—NULLè¡Œï¼‰ SUMï¼šæ±‚è¯¥åˆ—ä¹‹å’Œã€‚ AVGï¼šæ±‚è¯¥åˆ—çš„å¹³å‡å€¼ã€‚ MAX/MINï¼šæ±‚è¯¥åˆ—çš„ æœ€å¤§/æœ€å° å€¼ NOTEï¼š èšåˆå‡½æ•°è®¡ç®—æ—¶ä¼šæ’é™¤æ‰€æœ‰NULLè¡Œã€‚åªæœ‰COUNT(*)ä¾‹å¤–ï¼ŒNULLè¡Œä¹Ÿä¼šè¢«å®ƒè®¡æ•°ã€‚ MAX/MIN å‡ ä¹é€‚ç”¨äºæ‰€æœ‰æ•°æ®ç±»å‹çš„åˆ—ï¼ˆå¯¹éæ•°å€¼å‹ï¼Œä»¥å…¶äºŒè¿›åˆ¶å€¼æ¥æ’åºï¼‰ï¼Œè€ŒSUM/AVGåªèƒ½ç”¨äºæ•°å€¼ç±»å‹çš„åˆ—ã€‚ èšåˆå‡½æ•°æ“ä½œçš„åˆ—ï¼Œä¹Ÿèƒ½ç”¨DISTINCTä¿®é¥°ã€‚ä¾‹ï¼šSELECT COUNT(DISTINCT \u003cåˆ—å\u003e) FROM \u003cè¡¨å\u003e èšåˆå‡½æ•°åªèƒ½ç”¨äºSELECTå­å¥å’Œè¿˜æ²¡è®²çš„HAVINGå­å¥ï¼ˆä»¥åŠ ORDER BY å­å¥ï¼‰ä¸­ã€‚ åˆ†ç»„(GROUP BY) åˆ†ç»„ä»¥èšåˆé”®ä¸ºåˆ†ç±»æ ‡å‡†ï¼Œå°†æ•°æ®åˆ†ä¸ºå¤šä¸ªé€»è¾‘ç»„ï¼Œä»è€Œèƒ½åˆ†åˆ«å¯¹æ¯ä¸ªç»„è¿›è¡Œèšåˆè¿ç®—ã€‚ï¼ˆåˆ†ç»„æ˜¯ä¸ºäº†åˆ†ç±»èšåˆï¼‰ è‹¥å‡ºç°äº† GROUP BY å­å¥ï¼ŒæŸ¥è¯¢ç»“æœä¸€å®šæ˜¯æ¯ä¸€ç»„ä¸€è¡Œã€‚ GROUP BY ä¼šå°† NULL ä½œä¸ºä¸€ç»„ç‰¹å®šæ•°æ®ï¼Œæ˜¾ç¤ºä¸ºç©ºã€‚ èšåˆå¯¹SELECTå­å¥çš„é™åˆ¶ é¦–å…ˆè¦ç†è§£çš„æ˜¯ï¼š èšåˆå‡½æ•°çš„æ“ä½œå¯¹è±¡ä¸ºæŸä¸€åˆ—ï¼Œè€Œäº§ç”Ÿçš„ç»“æœåªæœ‰ä¸€ä¸ªå€¼ã€‚ GROUP BY çš„æ“ä½œå¯¹è±¡ä¸ºä¸€åˆ—æˆ–è€…å¤šåˆ—ï¼Œäº§ç”Ÿçš„ç»“æœå‘¢ï¼Œæ˜¯æ¯ä¸€ç»„ä¸€ä¸ªå€¼ã€‚ å› æ­¤ä¸ºäº†é¿å…æ­§ä¹‰ï¼Œåªè¦ä½¿ç”¨äº†èšåˆå‡½æ•°æˆ– GROUP BY äºŒè€…ä¹‹ä¸€ï¼ŒSELECT å­å¥å°±åªèƒ½åŒ…å«ï¼š å¸¸æ•° å…¶ä»–èšåˆå‡½æ•°ï¼ˆè¯¥èšåˆå‡½æ•°çš„æ“ä½œå¯¹è±¡å¯ä»¥ä¸ºå…¶ä»–åˆ—ï¼‰ å¦‚æœä½¿ç”¨äº† GROUP BY å­å¥ï¼Œè¿˜èƒ½åŒ…æ‹¬è¯¥å­å¥æ‰€æŒ‡å®šçš„åˆ—åã€‚ï¼ˆä¹Ÿå°±æ˜¯èšåˆé”®ï¼‰ä½†æ˜¯ç»ä¸èƒ½åŒ…å«å…¶ä»–çš„åˆ—åï¼Œå› ä¸ºè¿™ä¼šæœ‰æ­§ä¹‰ã€‚ æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ç”± SQL çš„æ‰§è¡Œé¡ºåºå¼•èµ·çš„ã€‚åº”è¯¥èƒ½å¾ˆå®¹æ˜“çŒœåˆ°ï¼ŒSELECT è¯­å¥çš„æ‰§è¡Œé¡ºåºå’Œä¹¦å†™é¡ºåºæ˜¯ä¸ä¸€è‡´çš„ã€‚ æŸ¥è¯¢åº”è¯¥æ˜¯ä»è¡¨å¼€å§‹ï¼Œæ‰€ä»¥ FROM è¯­å¥ä¸€å®šå…ˆæ‰§è¡Œã€‚ç„¶ååº”è¯¥è¦è¿‡æ»¤(WHERE)ï¼Œå†æ˜¯åˆ†ç»„(GROUP BY)ï¼Œæœ€åæ‰æ˜¯ SELECT è¯­å¥ã€‚ï¼ˆå°±å·²ç»å­¦åˆ°çš„å­å¥è€Œè¨€ï¼Œé¡ºåºæ˜¯è¿™æ ·ï¼‰ å› æ­¤æŒ‰ç†è¯´ï¼ŒSELECT è¯­å¥ å®šä¹‰çš„åˆ«åï¼Œæ˜¯ä¸èƒ½åœ¨ GROUP BY é‡Œä½¿ç”¨çš„ã€‚ï¼ˆä¹Ÿæœ‰äº›DBæ”¯æŒè¯¥ç”¨æ³•ï¼Œä½†ä¸é€šç”¨ï¼‰ å¯¹èšåˆç»“æœè¿›è¡Œè¿‡æ»¤(HAVING) ä»åˆšåˆšè¯´è¿‡çš„SQLæ‰§è¡Œé¡ºåºå¯è§ï¼ŒWHEREè¦æ¯”GROUP BYå…ˆæ‰§è¡Œï¼Œå› æ­¤å¦‚æœæƒ³è¿‡æ»¤åˆ†ç»„åçš„ç»“æœï¼Œä¸èƒ½ç”¨å®ƒã€‚è€Œåº”è¯¥ä½¿ç”¨ HAVING å­å¥ã€‚ HAVING å­å¥å’Œ WHERE å­å¥éƒ½æ˜¯ç”¨æ¥è¿‡æ»¤çš„ï¼Œä½†æ˜¯æ‰§è¡Œé¡ºåºçš„ä¸åŒä¹Ÿå°±å†³å®šäº†å®ƒä»¬çš„ç”¨é€”ä¸åŒã€‚ NOTEï¼š æœ‰æ—¶å€™ï¼Œä¼šå‘ç°æŸä¸ªè¿‡æ»¤æ¡ä»¶ï¼Œä¸è®ºæ˜¯å…ˆæ‰§è¡Œï¼ˆå°±æ˜¯å†™åœ¨WHEREå­å¥ä¸­ï¼‰è¿˜æ˜¯åæ‰§è¡Œï¼ˆå†™åœ¨HAVINGä¸­ï¼‰éƒ½æ²¡é—®é¢˜ï¼Œè¿™æ—¶å€™åº”è¯¥å°†å®ƒå†™åœ¨WHEREå­å¥ä¸­ï¼Œè¿™æ ·GROUP BYæ“ä½œçš„æ•°æ®ä¼šæ›´å°‘ï¼Œå¤„ç†æ›´å¿«ã€‚ HAVING å­å¥çš„å…ƒç´ ï¼Œä¹Ÿå­˜åœ¨å’Œ SELECT å­å¥åŒæ ·çš„é™åˆ¶ã€‚ä¸èƒ½ä½¿ç”¨èšåˆé”®ä»¥å¤–çš„åˆ—åã€‚ æ’åº(ORDER BY) ORDER BY å­å¥åœ¨ SELECT å­å¥ä¹‹åæ‰§è¡Œï¼Œå› æ­¤å®ƒèƒ½ä½¿ç”¨ SELECT å­å¥ä¸­å®šä¹‰çš„åˆ«åã€‚ï¼ˆè€Œ GROUP BY ä¹‹å‰å·²ç»è¯´è¿‡ä¸èƒ½ç”¨åˆ«åäº†ï¼‰ æ ¼å¼ï¼š SELECT\u003cå­—æ®µ1\u003eAS\u003cåˆ«å1\u003e,\u003cå­—æ®µ2\u003eAS\u003cåˆ«å2\u003e,...FROM\u003cè¡¨å\u003eWHERE\u003cè¿‡æ»¤æ¡ä»¶1\u003eGROUPBY\u003cåˆ—å1\u003e,\u003cåˆ—å2\u003e...HAVING\u003cè¿‡æ»¤æ¡ä»¶2\u003eORDERBY\u003cåˆ—å/åˆ«å1\u003e,\u003cåˆ—å/åˆ«å2\u003e...; å¤šæ’åºé”®/åˆ—ï¼šæŒ‡å®šå¤šæ’åºé”®æ—¶çš„æ’åºè§„åˆ™ä¸ºï¼šä¼˜å…ˆä½¿ç”¨å·¦ä¾§çš„åˆ—ï¼Œå¦‚æœè¯¥åˆ—å­˜åœ¨ç›¸åŒå€¼ï¼Œå†æ¥ç€å‚è€ƒå³ä¾§çš„é”®ï¼Œä¾æ­¤ç±»æ¨ã€‚ï¼ˆå¦‚æœå·¦ä¾§é”®å€¼ä¸åŒï¼Œå³ä¾§çš„é”®å°±ä¸ä¼šè¢«ä½¿ç”¨äº†ï¼‰ NULL å€¼çš„é¡ºåºï¼šæ’åºé”®ä¸­å‡ºç°äº† NULL å€¼æ—¶ï¼Œè¿™ç±»å€¼ä¼šåœ¨ç»“æœçš„å¼€å¤´æˆ–ç»“å°¾æ±‡æ€»ï¼Œç©¶ç«Ÿæ˜¯æ’åœ¨å¼€å¤´è¿˜æ˜¯ç»“å°¾ï¼Œå¹¶æ²¡æœ‰ç‰¹æ®Šè§„å®šã€‚ ORDER BY å­å¥åªå½±å“ç»“æœçš„å…ˆåé¡ºåºï¼Œå› æ­¤æ’åºé”®å¯ä»¥æ˜¯ç»“æœé›†ä»¥å¤–çš„ä¸œè¥¿ï¼Œæ¯”å¦‚å…¶ä»–çš„åˆ—ï¼Œæˆ–è€…ä½¿ç”¨äº† GROUP BY æ—¶ï¼Œè¿˜èƒ½ç”¨èšåˆå‡½æ•°ã€‚ ","date":"2018-06-15","objectID":"/posts/sql-basics-1/:3:2","tags":["SQL","æ•°æ®åº“"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸€ï¼‰","uri":"/posts/sql-basics-1/"},{"categories":["æŠ€æœ¯"],"content":"3. æ•°æ®çš„å¢ã€åˆ ã€æ”¹ æ’å…¥(INSERT INTO) ä¹Ÿç®—ç”¨çš„å¤šäº† è¯­æ³•ï¼š INSERTINTO\u003cè¡¨å\u003e(åˆ—å1,åˆ—å2...)VALUES(å€¼1,å€¼2...); æˆ–è€…ä¹Ÿå¯ä»¥ä½¿ç”¨ SELECT è¯­å¥æ¥æ›¿ä»£ VALUES å­å¥ï¼Œè¾¾åˆ°å°† SELECT åˆ°çš„ç»“æœé›†æ’å…¥æŸè¡¨çš„æ•ˆæœã€‚ï¼ˆä½†æ˜¯ä¸è¦ç”¨ORDER BYï¼Œå› ä¸ºç»“æœæ˜¯é›†ï¼Œæ²¡æœ‰é¡ºåºï¼Œæ’åºæ˜¯å¾’åŠ³æ— åŠŸçš„ï¼‰ æ’å…¥æ—¶ä¸»é”®ä¸èƒ½é‡å¤ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚ï¼ˆå› æ­¤å¦‚æœéœ€è¦åŒ…å«é‡å¤æ•°æ®ï¼Œä¸€èˆ¬éƒ½ä¼šå®šä¹‰ä¸€ä¸ªè‡ªå¢çš„idå­—æ®µï¼‰ åˆ é™¤(DELETE) æ¸…ç©ºè¡¨ï¼ˆå±é™©æ“ä½œï¼Œè€Œä¸”æ•ˆç‡ä¸å¦‚ TRUNCATEï¼‰ï¼š DELETEFROM\u003cè¡¨å\u003e; æ¡ä»¶åˆ é™¤ï¼š DELETEFROM\u003cè¡¨å\u003eWHERE\u003cæ¡ä»¶\u003e; å› æ­¤ä½¿ç”¨DELETEæ—¶ï¼Œä¸€å®šè¦è®°å¾—å¸¦WHEREï¼Œä¸ç„¶å°±å¥½ç©äº†ã€‚ã€‚ æ›´æ–°(UPDATE) UPDATE\u003cè¡¨å\u003eSET\u003cåˆ—å1\u003e=\u003cç®—æœ¯è¡¨è¾¾å¼1\u003e,\u003cåˆ—å2\u003e=\u003cè¡¨è¾¾å¼2\u003e,...WHERE\u003cæ¡ä»¶\u003e; åŒ DELETE ä¸€æ ·ï¼Œä¸å¸¦ WHERE å­å¥çš„ UPDATE æ˜¯å¾ˆå±é™©çš„ã€‚ ","date":"2018-06-15","objectID":"/posts/sql-basics-1/:3:3","tags":["SQL","æ•°æ®åº“"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸€ï¼‰","uri":"/posts/sql-basics-1/"},{"categories":["æŠ€æœ¯"],"content":"å››ã€DCL - äº‹åŠ¡å¤„ç†(MySQL) äº‹åŠ¡æ˜¯ä¸€ç³»åˆ—ä¸å¯åˆ†å‰²çš„æ•°æ®åº“æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸€ç³»åˆ—æ“ä½œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œã€‚å¦‚æœæ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿäº†é—®é¢˜ï¼ˆæ£€æŸ¥æ‰§è¡ŒçŠ¶æ€ï¼‰ï¼Œå¯ä»¥é€šè¿‡æ‰§è¡Œ ROLLBACK å›æ»šåˆ°è¯¥äº‹åŠ¡æ‰§è¡Œå‰çš„çŠ¶æ€ã€‚ï¼ˆæ³¨æ„å¹¶ä¸ä¼šè‡ªåŠ¨å›æ»šï¼‰ STARTTRANSACTION;-- do somthing COMMIT; START TRANSACTION: æ ‡è¯†äº‹åŠ¡çš„å¼€å§‹ COMMITï¼šæäº¤äº‹åŠ¡ã€‚ä¸€æ—¦æäº¤ï¼Œæ‰€æ‰§è¡Œè¿‡çš„æ“ä½œå°±å·²æˆå®šè®ºï¼Œæ¢å¤ä¸äº†äº†ã€‚ ROLLBACKï¼šäº‹åŠ¡å›æ»šï¼Œ**åªèƒ½å›æ»šæœª COMMIT çš„ DML æ“ä½œï¼**ä¹Ÿå°±æ˜¯è¯´åªèƒ½ç”¨åœ¨ START TRANSACTION å’Œ COMMIT ä¹‹é—´ï¼Œå¹¶ä¸”åªèƒ½å›æ»š INSERT/UPDATE/DELETEã€‚ï¼ˆå›æ»š SELECT æ²¡å•¥æ„ä¹‰ï¼‰ SAVEPOINT \u003cä¿ç•™ç‚¹\u003e å’Œ ROLLBACK TO \u003cä¿ç•™ç‚¹\u003eï¼šåŒæ ·åªèƒ½ç”¨åœ¨ START TRANSACTION å’Œ COMMIT ä¹‹é—´ï¼Œå…¶ä¼˜åŠ¿åœ¨äºï¼ŒROLLBACK TO å¯ä»¥æŒ‡å®šå›æ»šåˆ°æŸç‰¹å®šä¿ç•™ç‚¹ï¼Œæ›´çµæ´»ï¼Œè€Œ ROLLBACK åªèƒ½å›æ»šåˆ°äº‹åŠ¡å¼€å§‹å‰ã€‚ éœ€è¦æ³¨æ„çš„æœ‰ï¼š COMMIT å’Œ ROLLBACK è¯­å¥ä¹Ÿæ˜¯äº‹åŠ¡çš„ç»“æŸï¼Œå› æ­¤å¦‚æœæ‰§è¡Œäº† ROLLBACKï¼Œé‚£å®ƒä¸ COMMIT ä¹‹é—´çš„å†…å®¹ä¼šè¢«è·³è¿‡ã€‚ï¼ˆåœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œå®ƒç›¸å½“äºå¤§å¤šæ•° PL çš„ returnï¼‰ å¦‚æœäº‹åŠ¡æ‰§è¡Œå‡ºç°é—®é¢˜ï¼Œé—®é¢˜è¡Œåé¢çš„æ‰€æœ‰è¯­å¥éƒ½ä¸ä¼šè¢«æ‰§è¡Œï¼åŒ…æ‹¬ COMMIT å’Œ ROLLBACKï¼ å¦‚æœæƒ³ç”¨çº¯ SQL å®ç°äº‹åŠ¡åŸå­æ€§ï¼Œå¿…é¡»ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹æ£€æŸ¥æ‰§è¡ŒçŠ¶æ€ï¼ä¸¾ä¾‹å¦‚ä¸‹ï¼š CREATE PROCEDURE my_test() BEGIN DECLARE EXIT HANDLER FOR SQLEXCEPTION ROLLBACK -- æ£€æµ‹åˆ° SQLEXCEPTION åˆ™ rollbackï¼Œç„¶å exit START TRANSACTION INSERT INTO table_test VALUES(1, 'A') INSERT INTO table_test VALUES(1, 'B') -- è¿™é‡Œä¸»é”®å†²çªï¼Œä¼šè§¦å‘ SQLEXCEPTION COMMIT END CALL my_test() æˆ–è€…åœ¨ PL ä¸­é€šè¿‡å¼‚å¸¸å¤„ç†æ‰§è¡Œ ROLLBACKã€‚ï¼ˆäº‹åŠ¡è™½ç„¶ä¸­æ­¢äº†ï¼Œä½†å¹¶æœªç»“æŸï¼æ‰€ä»¥ä»ç„¶å¯ä»¥ ROLLBACK æˆ–è€… COMMITï¼‰ ","date":"2018-06-15","objectID":"/posts/sql-basics-1/:4:0","tags":["SQL","æ•°æ®åº“"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸€ï¼‰","uri":"/posts/sql-basics-1/"},{"categories":["æŠ€æœ¯"],"content":"æ•°æ®ä½•æ—¶è¢«æäº¤åˆ°æ•°æ®åº“ æ˜¾å¼æäº¤ï¼šåœ¨äº‹åŠ¡ä¸­ä½¿ç”¨ COMMIT æäº¤æ•°æ®æ“ä½œè¢«ç§°ä¸ºæ˜¾å¼æäº¤ éšå¼æäº¤ï¼šé DML æ“ä½œä¼šè¢«ç«‹å³æäº¤ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™äº›è¯­å¥æœ¬èº«å°±éšå«äº†æäº¤è¯­ä¹‰ è‡ªåŠ¨æäº¤ï¼š å¦‚æœ AUTOCOMMIT è¢«è®¾ç½®ä¸º ONï¼Œå½“å‰ session ä¸­çš„ DML è¯­å¥ä¼šåœ¨æ‰§è¡Œåè¢«è‡ªåŠ¨æäº¤ï¼ˆSTART TRANSACTION å†…éƒ¨çš„ DML é™¤å¤–ï¼Œåœ¨å®ƒå†…éƒ¨å¿…é¡»æ˜¾å¼ COMMITï¼‰ æ‰€æœ‰çš„ DML è¯­å¥éƒ½æ˜¯è¦æ˜¾å¼æäº¤çš„ï¼ŒMySQL session çš„ AUTOCOMMIT é»˜è®¤ä¸º ONï¼Œæ‰€ä»¥ DML ä¼šè¢«è‡ªåŠ¨æäº¤ã€‚ P.S. è®¸å¤šè¯­è¨€çš„æ•°æ®åº“ API ä¼šå®šä¹‰è‡ªå·±çš„äº‹åŠ¡æ“ä½œï¼Œä¸ä¸€å®šä¸è¿™é‡Œä¸€è‡´ã€‚ ","date":"2018-06-15","objectID":"/posts/sql-basics-1/:4:1","tags":["SQL","æ•°æ®åº“"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸€ï¼‰","uri":"/posts/sql-basics-1/"},{"categories":["éšç¬”"],"content":"å¯¹æˆ‘è€Œè¨€ï¼Œå­¦è‹±è¯­æ˜¯ä¸€ä»¶æŒºç—›è‹¦çš„äº‹ã€‚ä»åˆä¸­å¼€å§‹å­¦è‹±æ–‡ï¼Œå¯ä»æ¥ä¸è§‰å¾—å®ƒæœ‰è¶£ï¼Œä¸»åŠ¨æ€§ä¹Ÿå°±ä¸å¼ºã€‚ ç›´åˆ°æˆ‘å¼€å§‹å­¦è®¡ç®—æœºï¼Œæˆ‘å¼€å§‹è®¤è¯†åˆ°è‹±æ–‡æ˜¯ä¸å¯é¿å…çš„ã€‚äºæ˜¯å°è¯•äº†å¾ˆå¤šæ–¹æ³•ã€‚ æœ€æ™®éçš„æ–¹å¼ï¼šèƒŒå•è¯ï¼Œå¯æˆ‘ä»åˆä¸­èƒŒåˆ°ç°åœ¨ï¼ŒèƒŒå•è¯çš„è®¡åˆ’ä»æ²¡å“ªæ¬¡åšæŒè¶…è¿‡ä¸€ä¸ªæœˆçš„ã€‚ åæ¥å¬è¯´çœ‹è‹±æ–‡åŸç‰ˆä¹¦æœ‰æ•ˆï¼Œä¿¡å¿ƒæ»¡æ»¡ï¼Œç»“æœä¹Ÿæ˜¯çœ‹äº†ä¸€æ˜ŸæœŸ Harry Potterï¼Œç¨å¾®çœ‹äº†ç‚¹ Animal Farmï¼Œå°±æ²¡åç»­äº†ã€‚ åˆæƒ³ç»ƒå¬åŠ›ï¼Œå¼€å§‹å¬ ESLPodã€EnglishPodï¼Œä¹Ÿå°±å¬äº†ä¸€ä¸ªæœˆçš„æ—¶é—´ã€‚ã€‚ ç»ƒå£è¯­ï¼Œå¬å®Œäº†ã€Šèµ–ä¸–é›„ç¾è¯­éŸ³æ ‡ã€‹ï¼Œåˆçœ‹äº†ç‚¹ç¾å›½çš„å£è¯­çº æ­£è§†é¢‘ã€‚è¿™ä»¶äº‹å¹²å¾—å€’è¿˜ç®—å¯ä»¥ï¼Œå£è¯­çš„ç¡®æ ‡å‡†äº†ä¸å°‘ã€‚ä¸è¿‡ä¹Ÿå°±èŠ±äº†åå¤šå¤©ï¼Œå°±æ²¡ç„¶åäº†ã€‚ æˆ‘å­¦è®¡ç®—æœºçš„è¿‡ç¨‹ï¼Œå’Œæˆ‘çš„è‹±æ–‡å­¦ä¹ è¿‡ç¨‹ä¹Ÿæœ‰ä¸å°‘é‡åˆçš„åœ°æ–¹ã€‚ å°è±¡ä¸­ç¬¬ä¸€æ¬¡è¯»è‹±æ–‡èµ„æ–™ï¼Œæ˜¯æƒ³å­¦è®¡ç®—æœºå›¾å½¢å­¦ï¼Œè¢«çŸ¥ä¹ä¸Šçš„é«˜æ‰‹ä»¬æ¨èçœ‹ä¸€ä¸ªè‹±æ–‡æ•™ç¨‹ã€‚æ­»å—‘äº†ä¸‰å¤©ï¼ŒåšæŒä¸ä¸‹å»æ”¾å¼ƒäº†ã€‚ã€‚ ä¹‹åå¬äº†å­£ç´¢æ¸…å­¦é•¿çš„æ¨èï¼Œåˆè§çŸ¥ä¹ä¸Šä¹Ÿéƒ½è¯´ Python å¥½ï¼Œå°±å¼€å§‹å­¦ Pythonã€‚çœ‹äº† A Byte of Python, å°è±¡ä¸­èŠ±äº†ä¸€å¤©çœ‹å®Œçš„ï¼Œä½†æ˜¯æ²¡åœ¨è„‘å­é‡Œç•™ä¸‹å•¥å°è±¡ã€‚ åæ¥æ…¢æ…¢çš„å¼€å§‹ç†Ÿæ‚‰ Pythonï¼Œåœ¨å›¾ä¹¦é¦†å€Ÿäº† Head First Python è‹±æ–‡ç‰ˆï¼Œå¯èƒ½æ˜¯è¢«åšåº¦å“åˆ°äº†ï¼Œçœ‹äº†å‡ é¡µå°±ä¸äº†äº†ä¹‹äº†ã€‚ã€‚ å†åæ¥ç”¨ Githubï¼ŒPycharm IDEA ä¹Ÿæ˜¯è‹±æ–‡çš„ï¼ŒPython doc å’Œ Java doc ä¹Ÿå…¨æ˜¯è‹±æ–‡çš„ï¼Œæ ‡å‡†åº“é‡Œçš„æ³¨é‡Šæ˜¯è‹±æ–‡çš„ï¼ŒError ä¿¡æ¯æ˜¯è‹±æ–‡çš„â€¦â€¦ è™½ç„¶å­¦å•¥éƒ½åŠé€”è€ŒåºŸï¼Œä½†è‹±æ–‡æ°´å¹³çš„ç¡®æ˜¯æ…¢æ…¢åœ°æå‡ç€ã€‚ æ…¢æ…¢åœ°ï¼Œèƒ½å¤Ÿä¸æ€ä¹ˆåƒåŠ›åœ°çœ‹æ‡‚ Python æ ‡å‡†åº“äº†ï¼Œæœ‰é—®é¢˜ä¹Ÿå¯ä»¥çœ‹è‹±æ–‡åšå®¢è§£å†³äº†ã€‚ æœ€è¿‘çœ‹ä¸€ä¸ªåŠ¨æ¼«çœ‹å®Œä¸è¿‡ç˜¾ï¼Œè½¬å»çœ‹è¿™éƒ¨åŠ¨æ¼«çš„è½»å°è¯´ã€‚è½»å°è¯´ä¸­æ–‡ç¿»è¯‘çš„å¤ªå‘†æ¿ï¼Œå‘ç°å±…ç„¶æœ‰è‹±æ–‡çš„ï¼Œç›´æ¥å•ƒèµ·äº†è‹±æ–‡ã€‚ æ¢äº†å¥½å‡ éƒ¨å°è¯´ï¼Œç°åœ¨åœ¨çœ‹ Grimgar of Fantasy and Ashã€Tasogare-iro no Uta Tsukai(é»„æ˜è‰²ã®è© ä½¿ã„)ï¼Œè¿˜æ‰¾äº†ä¸ªè‹±æ–‡åŠ¨æ¼«ç½‘ç«™ï¼Œé¢‡æœ‰ä»¥åçœ‹åŠ¨æ¼«ä¹Ÿåªçœ‹è‹±æ–‡å­—å¹•çš„æ‰“ç®—ã€‚å¸Œæœ›èƒ½æŒç»­ä¸‹å»å§ã€‚ ä¸è¿‡ä¹Ÿæœ‰ç‚¹è‹¦æ¼ï¼Œå› ä¸ºæš‘å‡å°±è¦æ‰¾å·¥ä½œï¼Œç°åœ¨å´æ²‰è¿·çœ‹è‹±æ–‡å°è¯´ã€‚ã€‚æœ¬æ¥è¿™ä¸ªæœˆè¯¥å­¦ç®—æ³•çš„ï¼Œå¯åŠä¸ªæœˆéƒ½è¿‡äº†ï¼Œæˆ‘çš„è¿›åº¦å¤§æ¦‚æ‰è®¤çœŸçš„æ—¶å€™çš„äº”å¤©çš„æ ·å­ã€‚ã€‚çœŸä¸çŸ¥é“æœªæ¥ä¼šæ˜¯å•¥æ ·ã€‚ ","date":"2018-05-16","objectID":"/posts/learning-english/:0:0","tags":["è‹±è¯­","è¯­è¨€å­¦ä¹ "],"title":"å­¦è‹±è¯­å•Šå­¦è‹±è¯­","uri":"/posts/learning-english/"},{"categories":["ä¹¦è—‰","å½±è§†"],"content":"çœ‹å®Œäº†åŠ¨ç”»ï¼Œä¹Ÿçœ‹äº†ç‚¹å°è¯´ã€‚æœ€æ•¬ä½©ã€æœ€å–œæ¬¢ã€æœ€å‘å¾€çš„äººç‰©æ˜¯ç æ™¶ï¼Œä¹Ÿå°±æ˜¯ä¾›ç‹ã€‚èƒ½æ„Ÿè§‰å¾—åˆ°å¥¹æ˜¯æ‰€æœ‰è§’è‰²ä¸­ï¼Œæœ€è‡ªä¿¡ã€æ–¹å‘æœ€æ˜ç¡®çš„ï¼Œè€Œä¸”å¥¹æ€è€ƒä¸€ç›´æ¯”è¾ƒç†æ€§ã€‚èº«ä¸ºå¯Œå•†ä¹‹å¥³ï¼Œå¹´ä»…åäºŒï¼Œå´èƒ½æ‹¥æœ‰è¶…å‡ºæ‰€æœ‰å›½æ°‘çš„è§‰æ‚Ÿï¼Œâ€œæ—¢ç„¶å¤§äººä»¬æ²¡æœ‰å‹‡æ°”ï¼Œé‚£å°±ç”±æˆ‘å»å½“ç‹ï¼â€ï¼Œå¹¶æœ€ç»ˆç§°ç‹ï¼Œä¸å¾—ä¸æ•¬ä½©ã€‚å¥¹æœ‰å¥è®©äººéš¾ä»¥å¿˜å´çš„å°è¯ï¼Œâ€œæˆ‘ä¹‹æ‰€ä»¥èƒ½è¿‡ç€æ¯”åˆ«äººæ›´å¥½çš„ç”Ÿæ´»ï¼Œæ˜¯å› ä¸ºæˆ‘æ‹…è´Ÿäº†ç›¸æ¯”æ›´æ²‰é‡çš„è´£ä»»ã€‚å¦‚æœæ²¡èƒ½å®Œæˆç›¸åº”çš„ä½¿å‘½ï¼Œæˆ‘å°±ä¼šåƒå³°ç‹ä¸€æ ·è¢«ç æ‰è„‘è¢‹ã€‚è€Œç¥¥ç¼æ²¡æœ‰è®¤è¯†åˆ°è¿™ä¸€ç‚¹ï¼Œå¥¹ä¸æƒ³æ‹…è´Ÿè´£ä»»ï¼Œå´è§‰å¾—è‡ªå·±åº”è¯¥äº«å—è£åå¯Œè´µã€‚â€ å…¶æ¬¡å°±æ˜¯â€œä¸“èŒå¿ƒç†æ²»ç–—â€çš„ä¹ä¿Šå°è€é¼ äº†ï¼Œæˆ‘ç®€ç›´æœ‰ç‚¹æ€€ç–‘å­˜ä¸å­˜åœ¨è¿™æ ·å¯æ•¬çš„è€é¼ (åºŸè¯)ã€‚ä¹ä¿Šæˆç†Ÿå¾—ä¸é€‚åˆå½“ä¸»è§’ï¼Œå‡ ä¹æ— å¯æŒ‘å‰”ï¼Œå¤§æ¦‚ä¹Ÿå› æ­¤è€Œæˆä»½ä¸å¤šã€‚ è€ŒèŠ±äº†å¤§ç¯‡å¹…æå†™çš„åº†ä¸œå›½çš„æ™¯ç‹ï¼Œè¿˜æœ‰ä¸€è·¯èµ°æ¥çš„ç¥¥ç¼å’Œé“ƒã€æ›´å¤œè¿˜æœ‰æ³°éº’ï¼Œä»–ä»¬ä¸€åº¦è¿·å¤±æ‰äº†è‡ªæˆ‘ï¼Œè™½ç„¶ä½œä¸ºç»“æœçš„ä»–ä»¬å®ç°äº†è‡ªæˆ‘æ•‘èµï¼Œä½†æ˜¯è¿™ä¸ªè¿‡ç¨‹æˆ‘å–œæ¬¢ä¸èµ·æ¥ã€‚å¤§æ¦‚å› ä¸ºæˆ‘ä¹Ÿæ˜¯ä¸ªåæ¿€çš„äººå§â€¦â€¦ ç æ™¶é‡åˆ°äº†é¡½ä¸˜ï¼Œæ™¯ç‹å’Œç¥¥ç¼è¢«ä¹ä¿Šæ•‘èµï¼Œé“ƒä¹Ÿæœ‰è‡ªå·±çš„è´µäººï¼Œæ›´å¤œåœ¨æ–¡ç”±è¢«æ€æ—¶ç»ˆäºæ‰¿è®¤äº†è‡ªå·±çš„é”™è¯¯ï¼Œæ³°éº’ä¹Ÿæ˜¯è¢«éº’éºŸä»¬åˆåŠ›æ•‘å›æ¥çš„ã€‚ è°éƒ½ä¸å¯èƒ½åªæ´»åœ¨è‡ªå·±çš„ä¸–ç•Œï¼Œå°±èƒ½å¾—åˆ°æ•‘èµã€‚(è¿™æ ·å°±åˆå¾—åˆ°äº†ä¸€ä¸ªå’ŒåˆºçŒ¬çš„ä¼˜é›…ç±»ä¼¼çš„ç»“è®ºâ€¦) ","date":"2018-04-27","objectID":"/posts/the-twelve-kingdoms/:0:0","tags":["è¯»åæ„Ÿ","è§‚åæ„Ÿ","åŠ¨æ¼«"],"title":"ã€ŠåäºŒå›½è®°ã€‹","uri":"/posts/the-twelve-kingdoms/"},{"categories":["æŠ€æœ¯"],"content":"ä¸€ã€charAt ä¸ codePonitAt æˆ‘ä»¬çŸ¥é“ Java å†…éƒ¨ä½¿ç”¨çš„æ˜¯ utf-16 ä½œä¸ºå®ƒçš„ charã€String çš„å­—ç¬¦ç¼–ç æ–¹å¼ï¼Œè¿™é‡Œæˆ‘ä»¬å«å®ƒå†…éƒ¨å­—ç¬¦é›†ã€‚è€Œ utf-16 æ˜¯å˜é•¿ç¼–ç ï¼Œä¸€ä¸ªå­—ç¬¦çš„ç¼–ç è¢«ç§°ä¸ºä¸€ä¸ª code pointï¼Œå®ƒå¯èƒ½æ˜¯ 16 ä½ â€”â€” ä¸€ä¸ª code unitï¼Œä¹Ÿå¯èƒ½æ˜¯ 32 ä½ â€”â€” ä¸¤ä¸ª code unitã€‚ Java çš„ char ç±»å‹é•¿åº¦ä¸ºäºŒå­—èŠ‚ï¼Œå®ƒå¯¹åº”çš„æ˜¯ code unitã€‚æ¢å¥è¯è¯´ï¼Œä¸€ä¸ªå­—ç¬¦çš„ç¼–ç ï¼Œå¯èƒ½éœ€è¦ç”¨ä¸¤ä¸ª char æ¥å­˜å‚¨ã€‚ ä½œä¸ºä¸€ä¸ªè¾“å…¥æ³•çˆ±å¥½è€…ï¼Œæˆ‘å¶å°”ä¼šç¼–ç¨‹å¤„ç†ä¸€äº›ç”Ÿåƒ»å­—ã€‚å…¶ä¸­æœ‰äº›ç”Ÿåƒ»å­—å¤§æ¦‚æ˜¯åæ¥æ‰åŠ å…¥ unicode å­—ç¬¦é›†é‡Œçš„ï¼Œç›´æ¥ç”¨ charAt æ–¹æ³•è¯»å–å®ƒä»¬ï¼Œä¼šå¾—åˆ°ä¸€å †é—®å·ã€‚åŸå› å¾ˆæ¸…æ¥š â€”â€” å› ä¸ºè¿™äº›å­—ç¬¦ï¼ˆeg. â€œğ«–¯â€ï¼‰æ˜¯ç”¨ä¸¤ä¸ª code unitï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ª char è¡¨ç¤ºçš„ã€‚charAt æ‰¾ä¸åˆ°å¯¹åº”çš„ç¼–ç ï¼Œå°±ä¼šå°†è¿™äº› char è¾“å‡ºæˆã€Œ?ã€ã€‚ //ç¤ºä¾‹ public class Test { public static void main(String[] args){ String s = \"ğ«–¯\"; System.out.println(s.length()); //è¾“å‡ºï¼š2 System.out.println(s.charAt(0)); //è¾“å‡ºï¼š? System.out.println(s.charAt(1)); //è¾“å‡ºï¼š? } } å› æ­¤ï¼Œæ¶‰åŠåˆ°ä¸­æ–‡ï¼Œä¸€å®šè¦ä½¿ç”¨ String è€Œä¸æ˜¯ charï¼Œå¹¶ä¸”ä½¿ç”¨ codePoint ç›¸å…³æ–¹æ³•æ¥å¤„ç†å®ƒã€‚å¦åˆ™çš„è¯ï¼Œå¦‚æœç”¨æˆ·ä½¿ç”¨äº†ç”Ÿåƒ»å­—ï¼Œå¾ˆå¯èƒ½å°±ä¼šå¾—åˆ°ä¸æƒ³è¦çš„ç»“æœã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ codePoint éå†ä¸€ä¸ªå­—ç¬¦ä¸²çš„ç¤ºä¾‹ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒcodePoint æ˜¯ int ç±»å‹çš„ï¼ˆå› ä¸º char ä¸è¶³ä»¥ä¿å­˜ä¸€ä¸ª codepointï¼‰ï¼Œå› æ­¤éœ€è¦åšäº›é¢å¤–çš„è½¬æ¢ï¼š public class Test { public static void main(String[] args){ String s = \"èµµå­Ÿğ«–¯å­Ÿ\"; for (int i = 0; i \u003c s.codePointCount(0,s.length()); i++) { System.out.println( new String(Character.toChars(s.codePointAt(i)))); // è¿™é‡Œçš„è½¨è¿¹æ˜¯ï¼šç±»å‹ä¸º int çš„ codepoint -\u003e charæ•°ç»„ -\u003e String } } } /* ç»“æœï¼š èµµ å­Ÿ ğ«–¯ ? */ é—®é¢˜æ¥äº†ï¼Œã€Œğ«–¯ã€è¿™ä¸ªå­—æ˜¯æ­£å¸¸åœ°è¾“å‡ºäº†ï¼Œå¯æœ€åçš„ã€Œå­Ÿã€å´å˜æˆäº†é»‘äººé—®å·ã€‚ã€‚ åŸå› å°±åœ¨äº codepointAt(i) æ˜¯ä»¥ char åç§»é‡ç´¢å¼•çš„ã€‚ã€‚æ‰€ä»¥åªæ˜¯è¿™æ ·è¾“å‡ºä¹Ÿæ˜¯ä¸è¡Œçš„ã€‚ã€‚ æ­£ç¡®çš„éå†å§¿åŠ¿æ˜¯è¿™æ ·çš„ final int length = s.length(); for (int offset = 0; offset \u003c length; ) { final int codepoint = s.codePointAt(offset); System.out.println(new String(Character.toChars(codepoint))); offset += Character.charCount(codepoint); } è¿™ä¸ªä»£ç ä¿æŒäº†ä¸€ä¸ªå˜é‡offset, æ¥æŒ‡ç¤ºä¸‹ä¸€ä¸ª codepoint çš„åç§»é‡ã€‚æœ€åé‚£ä¸€å¥åœ¨å¤„ç†å®Œæ¯•åï¼Œæ›´æ–°è¿™ä¸ªåç§»é‡ è€Œ Java 8 æ·»åŠ äº† CharSequence#codePointsï¼Œ è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ª IntStreamï¼Œè¯¥æµåŒ…å«æ‰€æœ‰çš„ codepointã€‚å¯ä»¥ç›´æ¥é€šè¿‡ forEach æ–¹æ³•æ¥éå†ä»–ã€‚ string.codePoints().forEach( c -\u003e System.out.println(new String(Character.toChars(c))); ); æˆ–è€…ç”¨å¾ªç¯ for(int c : string.codePoints().toArray()){ System.out.println(new String(Character.toChars(c))); } ","date":"2018-03-11","objectID":"/posts/how-java-handles-chinese/:0:1","tags":["Java","å­—ç¬¦é›†","å­—ç¬¦ç¼–ç "],"title":"Java ä¸­æ–‡ç¼–ç åˆ†æ","uri":"/posts/how-java-handles-chinese/"},{"categories":["æŠ€æœ¯"],"content":"äºŒã€å†…éƒ¨å­—ç¬¦é›†ä¸è¾“å‡ºå­—ç¬¦é›†ï¼ˆå†…ç ä¸å¤–ç ï¼‰ ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†ä¸­æ–‡å­—ç¬¦åœ¨ java å†…éƒ¨å¯èƒ½ä¼šä¿å­˜æˆä¸¤ä¸ª charï¼Œå¯è¿˜æœ‰ä¸ªé—®é¢˜ï¼šå¦‚æœæˆ‘æŠŠä¸€ä¸ªå­—ç¬¦è¾“å‡ºåˆ°æŸä¸ªæµï¼Œå®ƒè¿˜ä¼šæ˜¯ä¸¤ä¸ª charï¼Œä¹Ÿå°±æ˜¯ 4 å­—èŠ‚ä¹ˆï¼Ÿ å›æƒ³ä¸€ä¸‹ï¼ŒJava io æœ‰å­—ç¬¦æµï¼Œå­—ç¬¦æµä½¿ç”¨ jvm é»˜è®¤çš„å­—ç¬¦é›†è¾“å‡ºï¼Œè€Œè‹¥è¦æŒ‡å®šå­—ç¬¦é›†ï¼Œå¯ä½¿ç”¨è½¬æ¢æµã€‚ å› æ­¤ï¼Œä¸€ä¸ªä¸­æ–‡å­—ç¬¦ï¼Œåœ¨å†…éƒ¨æ˜¯ä½¿ç”¨ utf-16 è¡¨ç¤ºï¼Œå¯è¾“å‡ºå°±ä¸ä¸€å®šäº†ã€‚ æ¥çœ‹ä¸ªç¤ºä¾‹ï¼š import java.io.UnsupportedEncodingException; public class Test { public static void main(String[] args) throws UnsupportedEncodingException { String s = \"ä¸­\"; //ğ«–¯ System.out.println(s + \": chars: \" + s.length()); System.out.println(s + \": utf-8 bytes:\" + s.getBytes(\"utf-8\").length); System.out.println(s + \": unicode bytes: \" + s.getBytes(\"unicode\").length); System.out.println(s + \": utf-16 bytes: \" + s.getBytes(\"utf-16\").length); } } è¾“å‡ºä¸ºï¼š ä¸­: chars: 1 // 2 bytes ä¸­: utf-8 bytes:3 ä¸­: unicode bytes: 4 ä¸­: utf-16 bytes: 4 ğ«–¯: chars: 2 // 4 bytes ğ«–¯: utf-8 bytes:4 ğ«–¯: unicode bytes: 6 ğ«–¯: utf-16 bytes: 6 ä¸€ä¸ªã€Œä¸­ã€å­—ï¼Œå†…éƒ¨å­˜å‚¨åªç”¨äº†ä¸€ä¸ª charï¼Œä¹Ÿå°±æ˜¯ 2 ä¸ªå­—èŠ‚ã€‚å¯è½¬æ¢æˆ utf-8 ç¼–ç åï¼Œå´ç”¨äº† 3 ä¸ªå­—èŠ‚ã€‚æ€ä¹ˆä¼šä¸ä¸€æ ·å‘¢ï¼Œæ˜¯ä¸æ˜¯ç¨‹åºå‡ºäº†é—®é¢˜ï¼Ÿ å½“ç„¶ä¸æ˜¯ç¨‹åºçš„é—®é¢˜ï¼Œè¿™æ˜¯å†…ç (utf-16)è½¬æ¢æˆå¤–ç (utf-8)ï¼Œå­—ç¬¦é›†å‘ç”Ÿäº†æ”¹å˜ï¼Œæ‰€ä½¿ç”¨çš„å­—èŠ‚æ•°è‡ªç„¶ä¹Ÿå¯èƒ½ä¼šæ”¹å˜ã€‚ï¼ˆå°¤å…¶è¿™ä¿©å­—ç¬¦é›†è¿˜éƒ½æ˜¯å˜é•¿ç¼–ç ï¼‰ ","date":"2018-03-11","objectID":"/posts/how-java-handles-chinese/:0:2","tags":["Java","å­—ç¬¦é›†","å­—ç¬¦ç¼–ç "],"title":"Java ä¸­æ–‡ç¼–ç åˆ†æ","uri":"/posts/how-java-handles-chinese/"},{"categories":["æŠ€æœ¯"],"content":"ä¸‰ã€utf-16ã€utf-16leã€utf-16beã€bom ä¸çŸ¥é“åœ¨åˆšåˆšçš„ç¤ºä¾‹ä¸­ï¼Œä½ æœ‰æ²¡æœ‰å‘ç°é—®é¢˜ï¼šåŒæ˜¯ utf-16ï¼Œä¸ºä½•ã€Œä¸­ã€å’Œã€Œğ«–¯ã€çš„ s.getBytes(\"utf-16\").length æ¯” s.length è¦å¤šä¸ª 2ï¼Ÿå¼€å¤´å°±è¯´äº† String ä¹Ÿæ˜¯ utf-16 ç¼–ç çš„ï¼Œè¿™ä¸¤ä¸ªæ•°åº”è¯¥ç›¸ç­‰æ‰å¯¹ä¸æ˜¯å—ï¼Ÿ åŸå› åœ¨äºï¼Œutf-16 ä»¥ 16 ä½ä¸ºå•ä½è¡¨ç¤ºæ•°æ®ï¼Œè€Œè®¡ç®—æœºæ˜¯ä»¥å­—èŠ‚ä¸ºåŸºæœ¬å•ä½æ¥å­˜å‚¨/è¯»å–æ•°æ®çš„ã€‚å› æ­¤ä¸€ä¸ª utf-16 çš„ code unit ä¼šè¢«å­˜å‚¨ä¸ºä¸¤ä¸ªå­—èŠ‚ï¼Œéœ€è¦æ˜ç¡®æŒ‡æ˜è¿™ä¸¤ä¸ªå­—èŠ‚çš„å…ˆåé¡ºåºï¼Œè®¡ç®—æœºæ‰èƒ½æ­£ç¡®åœ°æ‰¾å‡ºå®ƒå¯¹åº”çš„å­—ç¬¦ã€‚è€Œ utf-16 æœ¬èº«å¹¶æ²¡æœ‰æŒ‡å®šè¿™äº›ï¼Œæ‰€ä»¥å®ƒä¼šåœ¨å­—ç¬¦ä¸²å¼€å¤´æ’å…¥ä¸€ä¸ªä¸¤å­—èŠ‚çš„æ•°æ®ï¼Œæ¥å­˜å‚¨è¿™äº›ä¿¡æ¯ï¼ˆå¤§ç«¯è¿˜æ˜¯å°ç«¯ï¼‰ã€‚è¿™ä¸¤ä¸ªå­—èŠ‚è¢«ç§°ä¸ºBOMï¼ˆByte Order Markï¼‰ã€‚åˆšåˆšå‘ç°çš„å¤šå‡ºçš„ä¸¤å­—èŠ‚å°±æ˜¯è¿™ä¹ˆæ¥çš„ã€‚ å¦‚æœä½ æŒ‡å®šç¼–ç ä¸º utf-16le æˆ– utf-16beï¼Œå°±ä¸ä¼šæœ‰è¿™ä¸ª BOM çš„å­˜åœ¨äº†ã€‚è¿™æ—¶å°±éœ€è¦ä½ è‡ªå·±è®°ä½è¯¥æ–‡ä»¶çš„å¤§å°ç«¯ã€‚ã€‚ ","date":"2018-03-11","objectID":"/posts/how-java-handles-chinese/:0:3","tags":["Java","å­—ç¬¦é›†","å­—ç¬¦ç¼–ç "],"title":"Java ä¸­æ–‡ç¼–ç åˆ†æ","uri":"/posts/how-java-handles-chinese/"},{"categories":["æŠ€æœ¯"],"content":"å››ã€æ›´å¤šï¼šutf-8 unicode åœ¨ windows ä¸­ï¼Œutf-8 æ ¼å¼çš„æ–‡ä»¶ä¹Ÿå¯èƒ½ä¼šå¸¦æœ‰ BOMï¼Œä½† utf-8 çš„åŸºæœ¬å•ä½æœ¬æ¥å°±æ˜¯ä¸€ä¸ªå­—èŠ‚ï¼Œå› æ­¤å®ƒä¸éœ€è¦ BOM æ¥è¡¨ç¤º æ‰€è°“å¤§å°ç«¯ã€‚è¿™ä¸ª BOM ä¸€èˆ¬æ˜¯ç”¨æ¥è¡¨ç¤ºè¯¥æ–‡ä»¶æ˜¯ä¸€ä¸ª utf-8 æ–‡ä»¶ã€‚ä¸è¿‡ linux ç³»ç»Ÿåˆ™å¯¹è¿™ç§å¸¦ BOM çš„æ–‡ä»¶ä¸å¤ªå‹å¥½ã€‚ä¸èˆ¬ä¸å»ºè®®åŠ ã€‚ã€‚ï¼ˆè™½å¦‚æ­¤è¯´ï¼Œä¸Šé¢çš„æµ‹è¯•ä¸­ï¼Œutf-8 çš„æ•°æ®åº”è¯¥æ˜¯æ²¡åŠ  bom çš„ç»“æœï¼‰ unicodeå­—ç¬¦é›†UCSï¼ˆUnicode Character Setï¼‰ å°±æ˜¯ä¸€å¼ åŒ…å«å…¨ä¸–ç•Œæ‰€æœ‰æ–‡å­—çš„ä¸€ä¸ªç¼–ç è¡¨ï¼Œä½†æ˜¯ UCS å¤ªå å†…å­˜äº†ï¼Œæ‰€ä»¥å®é™…ä½¿ç”¨åŸºæœ¬éƒ½æ˜¯ä½¿ç”¨å®ƒçš„å…¶ä»–å˜ä½“ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒæŒ‡å®šå­—ç¬¦é›†æ—¶ä½¿ç”¨çš„ unicode åŸºæœ¬ç­‰åŒäº utf-16.ï¼ˆæ‰€ä»¥ä½ ä¼šå‘ç°ç¬¬äºŒèŠ‚æ¼”ç¤ºçš„å°ç¨‹åºé‡Œï¼Œutf-16 å’Œ unicode å¾—å‡ºçš„ç»“æœæ˜¯ä¸€æ ·çš„ã€‚ï¼‰ ","date":"2018-03-11","objectID":"/posts/how-java-handles-chinese/:0:4","tags":["Java","å­—ç¬¦é›†","å­—ç¬¦ç¼–ç "],"title":"Java ä¸­æ–‡ç¼–ç åˆ†æ","uri":"/posts/how-java-handles-chinese/"},{"categories":["æŠ€æœ¯"],"content":"å››ã€ä¸ Python3 å¯¹æ¯” python3 åœ¨å­—ç¬¦ä¸²è¡¨ç¤ºä¸Šï¼Œåšäº†å¤§åˆ€é˜”æ–§çš„æ”¹é©ï¼Œpython3 çš„ len(str) å¾—åˆ°çš„å°±æ˜¯ unicode å­—ç¬¦æ•°ï¼Œå› æ­¤ç¨‹åºå‘˜å®Œå…¨ä¸éœ€è¦å»è€ƒè™‘å­—ç¬¦çš„åº•å±‚è¡¨ç¤ºçš„é—®é¢˜ã€‚ï¼ˆå®é™…ä¸Šå…¶å†…éƒ¨è¡¨ç¤ºä¹Ÿå¯èƒ½éšç€æ›´æ–°è€Œå˜åŒ–ï¼‰å¸¦ BOM çš„ utf-8 ä¹Ÿå¯é€šè¿‡æŒ‡å®šå­—ç¬¦é›†ä¸º utf-8-sig è§£å†³ã€‚è‹¥éœ€è¦åšå­—ç¬¦é›†å±‚é¢å¤„ç†ï¼Œéœ€è¦ encode ä¸ºç‰¹å®šå­—ç¬¦é›†çš„ byte ç±»å‹ã€‚ Encoding pertains mostly to files and transfers. Once loaded into a Python string, text in memory has no notion of an â€œencoding,â€ and is simply a sequence of Unicode characters (a.k.a. code points) stored generically. â€“ Learning Python 5th P.S. Python2 å­˜åœ¨å’Œ Java ç›¸åŒçš„é—®é¢˜ ","date":"2018-03-11","objectID":"/posts/how-java-handles-chinese/:0:5","tags":["Java","å­—ç¬¦é›†","å­—ç¬¦ç¼–ç "],"title":"Java ä¸­æ–‡ç¼–ç åˆ†æ","uri":"/posts/how-java-handles-chinese/"},{"categories":["æŠ€æœ¯"],"content":"å‚è€ƒ java è¯­è¨€ä¸­çš„ä¸€ä¸ªå­—ç¬¦å å‡ ä¸ªå­—èŠ‚ï¼Ÿ - RednaxelaFX - çŸ¥ä¹ How can I iterate through the unicode codepoints of a Java String? å½»åº•ææ‡‚å­—ç¬¦ç¼–ç (unicode,mbcs,utf-8,utf-16,utf-32,big endian,little endianâ€¦) Java_å­—ç¬¦ç¼–ç  æœ¬æ–‡å…è®¸è½¬è½½ï¼Œä½†è¦æ±‚é™„ä¸Šæºé“¾æ¥ï¼šJava ä¸­æ–‡ç¼–ç åˆ†æ ","date":"2018-03-11","objectID":"/posts/how-java-handles-chinese/:0:6","tags":["Java","å­—ç¬¦é›†","å­—ç¬¦ç¼–ç "],"title":"Java ä¸­æ–‡ç¼–ç åˆ†æ","uri":"/posts/how-java-handles-chinese/"},{"categories":["æŠ€æœ¯"],"content":" ä¸ªäººç¬”è®°ï¼Œä¸ä¿è¯æ­£ç¡®ã€‚ ","date":"2018-01-23","objectID":"/posts/process-thread-coroutines-concurrency-parallelism/:0:0","tags":["è¿›ç¨‹","çº¿ç¨‹","åç¨‹","å¹¶å‘","å¹¶è¡Œ","Coroutines","Concurrency"],"title":"è¿›ç¨‹çº¿ç¨‹åç¨‹ä¸å¹¶å‘å¹¶è¡Œ","uri":"/posts/process-thread-coroutines-concurrency-parallelism/"},{"categories":["æŠ€æœ¯"],"content":"ä¸€ã€è¿›ç¨‹ Processï¼šï¼ˆå¹¶è¡Œè¿ç®—ï¼Œåˆ†å¸ƒå¼ï¼‰ æ¯ä¸€ä¸ªè¿›ç¨‹ï¼Œéƒ½å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªå®Œæ•´çš„ Programï¼Œå®ƒæœ‰è‡ªå·±å®Œå…¨ç‹¬ç«‹çš„å†…å®¹ã€‚ä¸ä¸å…¶ä»–è¿›ç¨‹ç›´æ¥å…±äº«æ•°æ®ã€‚ï¼ˆä¸€ä¸ªå·¥ä½œ(job)å¯ä»¥ç”±å¤šä¸ª process å®Œæˆï¼Œä¾‹å¦‚ç”µè„‘ä¸Šçš„qq/360å°±ä¼šæœ‰å¥½å‡ ä¸ªè¿›ç¨‹ï¼Œè¿™ç§ç¨‹åºå¯èƒ½ä¼šæœ‰ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œå½“ä¸»è¿›ç¨‹æŒ‚æ‰ï¼Œå®ƒä¼šè‡ªåŠ¨é‡å¯ä¸»è¿›ç¨‹ã€‚ï¼‰ æ¯ä¸ªè¿›ç¨‹å¯ä»¥ç”±å¤šä¸ªçº¿ç¨‹ç»„æˆã€‚è¿›ç¨‹æŠ½è±¡ç”±æ“ä½œç³»ç»Ÿæä¾›ï¼ŒLinux æ˜¯ä½¿ç”¨ fork å‡½æ•°ï¼ŒWindows æ˜¯ç”¨ CreateProccessã€‚ ","date":"2018-01-23","objectID":"/posts/process-thread-coroutines-concurrency-parallelism/:0:1","tags":["è¿›ç¨‹","çº¿ç¨‹","åç¨‹","å¹¶å‘","å¹¶è¡Œ","Coroutines","Concurrency"],"title":"è¿›ç¨‹çº¿ç¨‹åç¨‹ä¸å¹¶å‘å¹¶è¡Œ","uri":"/posts/process-thread-coroutines-concurrency-parallelism/"},{"categories":["æŠ€æœ¯"],"content":"äºŒã€çº¿ç¨‹ Threadï¼šï¼ˆå¹¶å‘æ‰§è¡Œï¼‰ å±äºåŒä¸€ä¸ªè¿›ç¨‹çš„çº¿ç¨‹ä¹‹é—´ï¼Œæ˜¯å…±äº«ä¸€å¥—å·¥ä½œå†…å®¹çš„ã€‚è¿™ä½¿å¾—çº¿ç¨‹çš„åˆ›å»ºå’Œç§»é™¤å¼€é”€å¾ˆå°ï¼Œä½†åŒæ—¶ä¹Ÿä½¿ç¼–ç¨‹å˜å¾—å¤æ‚ã€‚ å…³äºçº¿ç¨‹ï¼Œåˆ†ç”¨æˆ·çº§çº¿ç¨‹å’Œå†…æ ¸çº§çº¿ç¨‹ã€‚ä¸åŒçš„è¯­è¨€ä¸­ï¼Œè¿™ä¸¤ç§çº¿ç¨‹çš„å¯¹åº”å…³ç³»ä¹Ÿä¸å°½ç›¸åŒã€‚ å¤šå¯¹ä¸€æ¨¡å‹ å°†å¤šä¸ªç”¨æˆ·çº§çº¿ç¨‹æ˜ å°„åˆ°ä¸€ä¸ªå†…æ ¸çº§çº¿ç¨‹ï¼Œçº¿ç¨‹ç®¡ç†åœ¨ç”¨æˆ·ç©ºé—´å®Œæˆï¼Œè¿™ç§æ¨¡å‹ä¸‹æ“ä½œç³»ç»Ÿå¹¶ä¸çŸ¥é“å¤šçº¿ç¨‹çš„å­˜åœ¨ã€‚Python å°±æ˜¯è¿™ç§æ¨¡å‹ã€‚ ä¼˜ç‚¹ï¼šçº¿ç¨‹ç®¡ç†æ˜¯åœ¨ç”¨æˆ·ç©ºé—´è¿›è¡Œçš„ï¼Œåˆ‡æ¢ä¸Šä¸‹æ–‡å¼€é”€æ¯”è¾ƒå°ï¼Œæ€§èƒ½è¾ƒé«˜ã€‚ ç¼ºç‚¹ï¼šå½“ä¸€ä¸ªçº¿ç¨‹åœ¨ä½¿ç”¨å†…æ ¸æœåŠ¡æ—¶è¢«é˜»å¡ï¼Œé‚£ä¹ˆæ•´ä¸ªè¿›ç¨‹éƒ½ä¼šè¢«é˜»å¡ï¼›å¤šä¸ªçº¿ç¨‹ä¸èƒ½å¹¶è¡Œåœ°è¿è¡Œåœ¨å¤šå¤„ç†æœºä¸Šã€‚ ä¸€å¯¹ä¸€æ¨¡å‹ å°†æ¯ä¸ªç”¨æˆ·çº§çº¿ç¨‹æ˜ å°„åˆ°ä¸€ä¸ªå†…æ ¸çº§çº¿ç¨‹ã€‚Javaçš„çº¿ç¨‹å°±å±äºè¿™ç§æ¨¡å‹ã€‚ ä¼˜ç‚¹ï¼šå½“ä¸€ä¸ªçº¿ç¨‹è¢«é˜»å¡åï¼Œå…è®¸å¦ä¸€ä¸ªçº¿ç¨‹ç»§ç»­æ‰§è¡Œï¼Œæ‰€ä»¥å¹¶å‘èƒ½åŠ›è¾ƒå¼ºï¼›èƒ½å¾ˆå¥½çš„åˆ©ç”¨åˆ°CPUçš„å¤šæ ¸å¿ƒã€‚ ç¼ºç‚¹ï¼šæ¯åˆ›å»ºä¸€ä¸ªç”¨æˆ·çº§çº¿ç¨‹éƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªå†…æ ¸çº§çº¿ç¨‹ä¸å…¶å¯¹åº”ï¼Œè¿™æ ·åˆ›å»ºçº¿ç¨‹çš„å¼€é”€æ¯”è¾ƒå¤§ï¼Œä¼šå½±å“åˆ°åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚å¹¶ä¸”åˆ‡æ¢çº¿ç¨‹è¦è¿›å‡ºå†…æ ¸ï¼Œä»£ä»·æ¯”è¾ƒå¤§ã€‚ å¤šå¯¹å¤šæ¨¡å‹ å°†nä¸ªç”¨æˆ·çº§çº¿ç¨‹æ˜ å°„åˆ°mä¸ªå†…æ ¸çº§çº¿ç¨‹ä¸Šï¼Œè¦æ±‚ m \u003c= nã€‚GOï¼ˆ1.5ä¹‹åï¼‰çš„åç¨‹å°±å±äºè¿™ç§çº¿ç¨‹æ¨¡å‹ã€‚ ç‰¹ç‚¹ï¼šæ—¢å…‹æœäº†å¤šå¯¹ä¸€æ¨¡å‹çš„å¹¶å‘åº¦ä¸é«˜çš„ç¼ºç‚¹ï¼Œåˆå…‹æœäº†ä¸€å¯¹ä¸€æ¨¡å‹çš„ä¸€ä¸ªç”¨æˆ·è¿›ç¨‹å ç”¨å¤ªå¤šå†…æ ¸çº§çº¿ç¨‹ï¼Œå¼€é”€å¤ªå¤§çš„ç¼ºç‚¹ã€‚åˆæ‹¥æœ‰å¤šå¯¹ä¸€æ¨¡å‹å’Œä¸€å¯¹ä¸€æ¨¡å‹å„è‡ªçš„ä¼˜ç‚¹ã€‚ ","date":"2018-01-23","objectID":"/posts/process-thread-coroutines-concurrency-parallelism/:0:2","tags":["è¿›ç¨‹","çº¿ç¨‹","åç¨‹","å¹¶å‘","å¹¶è¡Œ","Coroutines","Concurrency"],"title":"è¿›ç¨‹çº¿ç¨‹åç¨‹ä¸å¹¶å‘å¹¶è¡Œ","uri":"/posts/process-thread-coroutines-concurrency-parallelism/"},{"categories":["æŠ€æœ¯"],"content":"ä¸‰ã€åç¨‹ Coroutineï¼ˆå¹¶å‘æ‰§è¡Œï¼‰ å¦‚æœè¯´çº¿ç¨‹æ˜¯è½»é‡çº§çš„è¿›ç¨‹ï¼Œé‚£ä¹ˆåç¨‹å°±æ˜¯è½»é‡çº§çš„çº¿ç¨‹ã€‚çº¿ç¨‹è·‘åœ¨è¿›ç¨‹é‡Œï¼Œåç¨‹å°±è·‘åœ¨çº¿ç¨‹é‡Œã€‚ ä¼˜ç‚¹ï¼š åç¨‹æ˜¯è·‘åœ¨åŒä¸€ä¸ªçº¿ç¨‹é‡Œï¼Œå¹¶ä¸”æ˜¯ç”±ç¨‹åºæœ¬èº«æ¥è°ƒåº¦çš„ã€‚åç¨‹é—´çš„åˆ‡æ¢å°±æ˜¯å‡½æ•°çš„è°ƒç”¨ï¼Œå®Œå…¨æ²¡æœ‰çº¿ç¨‹åˆ‡æ¢é‚£ä¹ˆå¤§çš„å¼€é”€ã€‚ çº¿ç¨‹çš„æ•°é‡è¶Šå¤šï¼Œåç¨‹çš„ä¼˜åŠ¿è¶Šå¤§ å› ä¸ºåç¨‹æ˜¯ç¨‹åºè°ƒåº¦çš„ï¼Œå®ƒå®é™…ä¸Šæ˜¯ä¸²è¡Œè¿è¡Œçš„ï¼Œå› æ­¤ä¸éœ€è¦å¤æ‚çš„é”æœºåˆ¶æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚ åœ¨åç¨‹ä¸­æ§åˆ¶å…±äº«èµ„æºä¸åŠ é”ï¼Œåªéœ€è¦åˆ¤æ–­çŠ¶æ€å°±å¥½äº†ã€‚è¿™å…å»äº†é”æœºåˆ¶å¸¦æ¥çš„å¼€é”€ã€‚ å› ä¸ºåç¨‹è·‘åœ¨å•ä¸ªçº¿ç¨‹å†…ï¼Œæ‰€å ç”¨çš„ CPU èµ„æºæœ‰é™ï¼Œæ‰€ä»¥å¤šåç¨‹å¹¶ä¸èƒ½æå‡è®¡ç®—æ€§èƒ½ã€‚ä¸ä»…å¦‚æ­¤ï¼Œå› ä¸ºå¤šäº†ç¨‹åºæœ¬èº«çš„è°ƒåº¦å¼€é”€ï¼Œè®¡ç®—å¯†é›†å‹ç¨‹åºçš„æ€§èƒ½åè€Œä¼šä¸‹é™ã€‚ æ­¤å¤–ï¼Œåç¨‹ä»£ç ä¸­å†³ä¸èƒ½å‡ºç°é˜»å¡ï¼Œå¦åˆ™æ•´ä¸ªçº¿ç¨‹éƒ½ä¼šåœä¸‹æ¥ç­‰å¾…è¯¥æ“ä½œå®Œæˆï¼Œè¿™å°±éº»çƒ¦äº†ã€‚ åç¨‹é€‚åˆç”¨äº IO å¯†é›†å‹ä»»åŠ¡ï¼Œå¯ç”¨äºç®€åŒ–å¼‚æ­¥ IO çš„ callback hellã€‚ä¾‹å¦‚ Python çš„ asyncio å°±æ˜¯ç”¨åç¨‹å®ç°çš„ã€‚ ","date":"2018-01-23","objectID":"/posts/process-thread-coroutines-concurrency-parallelism/:0:3","tags":["è¿›ç¨‹","çº¿ç¨‹","åç¨‹","å¹¶å‘","å¹¶è¡Œ","Coroutines","Concurrency"],"title":"è¿›ç¨‹çº¿ç¨‹åç¨‹ä¸å¹¶å‘å¹¶è¡Œ","uri":"/posts/process-thread-coroutines-concurrency-parallelism/"},{"categories":["æŠ€æœ¯"],"content":"å¹¶å‘å¹¶è¡Œ ç”±æ­¤ï¼Œåˆå¼•å‡ºä¸¤ä¸ªåè¯ï¼š å¹¶å‘ï¼ˆConcurrentï¼‰ï¼šå¤šä¸ªä»»åŠ¡äº¤æ›¿è¿›è¡Œã€‚ å¹¶è¡Œï¼ˆParallelï¼‰ï¼šå¤šä¸ªä»»åŠ¡åŒæ—¶è¿›è¡Œã€‚ ä¸€å¼ å›¾è¯´æ˜ä¸¤è€…çš„å·®åˆ« Noteï¼šè¿›ç¨‹ å’Œ çº¿ç¨‹ éƒ½å¯èƒ½æ˜¯ å¹¶å‘ æˆ– å¹¶è¡Œ çš„ã€‚å…³é”®çœ‹ä½ ç¨‹åºçš„è¿è¡ŒçŠ¶æ€ã€‚å¤šæ ¸æ˜¯å¹¶è¡Œçš„å‰æã€‚å¹¶å‘åˆ™åªè¦æ±‚äº¤æ›¿æ‰§è¡Œï¼Œå› æ­¤å•æ ¸ä¹Ÿæ²¡é—®é¢˜ã€‚ ","date":"2018-01-23","objectID":"/posts/process-thread-coroutines-concurrency-parallelism/:0:4","tags":["è¿›ç¨‹","çº¿ç¨‹","åç¨‹","å¹¶å‘","å¹¶è¡Œ","Coroutines","Concurrency"],"title":"è¿›ç¨‹çº¿ç¨‹åç¨‹ä¸å¹¶å‘å¹¶è¡Œ","uri":"/posts/process-thread-coroutines-concurrency-parallelism/"},{"categories":["æŠ€æœ¯"],"content":"åŒæ­¥å¼‚æ­¥ åŒæ­¥ï¼šä¸åŒç¨‹åºå•å…ƒä¸ºäº†å®ŒæˆæŸä¸ªä»»åŠ¡ï¼Œåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­éœ€é æŸç§é€šä¿¡æ–¹å¼ä»¥åè°ƒä¸€è‡´ï¼Œç§°è¿™äº›ç¨‹åºå•å…ƒæ˜¯åŒæ­¥æ‰§è¡Œçš„ã€‚ å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œæ‰€æœ‰ä¿®æ”¹å…±äº«å˜é‡çš„è¡Œä¸ºï¼Œéƒ½å¿…é¡»åŠ é”ï¼Œä¿è¯é¡ºåºæ‰§è¡Œï¼Œä¿è¯åŒæ­¥ã€‚æˆ–è€…åŠ åŸå­é”ï¼Œä¿è¯è¯¥ä¿®æ”¹æ“ä½œæ˜¯åŸå­çš„ã€‚ åŒæ­¥æ„å‘³ç€æœ‰åº å¼‚æ­¥ï¼šä¸ºå®ŒæˆæŸä¸ªä»»åŠ¡ï¼Œä¸åŒç¨‹åºå•å…ƒä¹‹é—´è¿‡ç¨‹ä¸­æ— éœ€é€šä¿¡åè°ƒï¼Œä¹Ÿèƒ½å®Œæˆä»»åŠ¡çš„æ–¹å¼ã€‚ ä¸ç›¸å…³çš„ç¨‹åºå•å…ƒä¹‹é—´å¯ä»¥æ˜¯å¼‚æ­¥çš„ã€‚æ¯”å¦‚çˆ¬è™«ä¸‹è½½ç½‘é¡µ å¼‚æ­¥æ„å‘³ç€æ— åº è¿›ç¨‹ã€çº¿ç¨‹å’Œåç¨‹ ","date":"2018-01-23","objectID":"/posts/process-thread-coroutines-concurrency-parallelism/:0:5","tags":["è¿›ç¨‹","çº¿ç¨‹","åç¨‹","å¹¶å‘","å¹¶è¡Œ","Coroutines","Concurrency"],"title":"è¿›ç¨‹çº¿ç¨‹åç¨‹ä¸å¹¶å‘å¹¶è¡Œ","uri":"/posts/process-thread-coroutines-concurrency-parallelism/"},{"categories":["éšç¬”"],"content":" å•Šå•Šï¼Œè¿˜æœ‰åå¤©å°±å¯ä»¥æ‘†è„±è¿™ä¸ªåŸå¸‚ï¼Œå›åˆ°é‚£ä¸ªä»¤äººå®‰å¿ƒçš„å±±æ—é‡Œäº†ï¼Œä¸€è¾¹æœŸå¾…ç€ï¼Œä¸€è¾¹ç„¦èºç€ï¼Œæƒ³ç€ä¸ºä»€ä¹ˆå‰©ä¸‹çš„åå¤©è¿™ä¹ˆéš¾ç†¬è¿™æ ·çš„é—®é¢˜ã€‚ å¤ä¹ åˆæ˜¯ä¸€å¡Œç³Šæ¶‚ï¼Œæˆ‘ä¹Ÿå¤ªæ‡’äº†ç‚¹ã€‚ è¿™æ ·æ‡’æ•£çš„æˆ‘è¿˜åšç€ç å®Œå‡ åƒè¡Œä»£ç è¿™æ ·çš„æ˜¥ç§‹å¤§æ¢¦ï¼Œå¤ªä¸ç°å®äº†ã€‚æœ‰ç‚¹æƒ³è®¤å‘½äº†ã€‚ åŠå¤œä¸€ç‚¹å¤šï¼Œå¯å®¤ç©ºè°ƒè¿˜æ˜¯ä¸ä¹ æƒ¯ï¼Œè¿‡é“é˜³å°ä¸Šçš„å‡‰é£å€’æ˜¯å¾ˆèˆ’æœï¼Œè¿™åº§åŸå¸‚æ­¤åˆ»çš„é™è°§å€’ä¹Ÿæœ‰å‡ åˆ†éŸµå‘³ã€‚ ä¸è¿‡ä¸ç®¡æ€ä¹ˆè¯´ï¼Œå¥½æƒ³å›å®¶â€¦ ","date":"2017-06-27","objectID":"/posts/the-end-of-another-semester/:0:0","tags":[],"title":"åˆä¸€ä¸ªæœŸæœ«","uri":"/posts/the-end-of-another-semester/"},{"categories":["æ•°å­¦","æŠ€æœ¯"],"content":"å¾ˆæ—©å°±å­¦è¿‡æ¬§å‡ é‡Œå¾—ç®—æ³•ï¼Œä½†æ˜¯ä¸€ç›´ä¸çŸ¥é“å®ƒçš„åŸç†ã€‚å‡ ä¹æ¯æœ¬ç®—æ³•ä¹¦éƒ½ä¼šæåˆ°å®ƒï¼Œä½†æ˜¯è²Œä¼¼åªæœ‰æ•°å­¦ä¹¦ä¸Šæ‰ä¼šè§åˆ°å®ƒçš„åŸç†ã€‚ã€‚ã€‚ å‰æ®µæ—¶é—´ç²—ç²—çœ‹äº†ç‚¹æ•°è®ºï¼ˆã€Šä»€ä¹ˆæ˜¯æ•°å­¦ã€‹ï¼‰ï¼ŒæƒŠè®¶äºè¿™ä¸ªåŸç†çš„å¥‡å¦™ã€‚ç°åœ¨æŠŠå®ƒé€šä¿—åœ°å†™ä¸‹æ¥ï¼Œä»¥å…è‡ªå·±å¿˜è®°ã€‚ æ¬§å‡ é‡Œå¾—ç®—æ³•æ˜¯æ±‚ä¸¤ä¸ªæ•°çš„æœ€å¤§å…¬çº¦æ•°(Greatest Common Divisor (GCD))çš„ç®—æ³•ï¼Œæˆ‘ä»¬é¦–å…ˆå‡è®¾æœ‰ä¸¤ä¸ªæ•° $a$ å’Œ $b$ï¼Œå…¶ä¸­ $a$ æ˜¯ä¸å°äº $b$ çš„æ•°ï¼Œ è®° $a$ è¢« $b$ é™¤çš„ä½™æ•°ä¸º $r$ï¼Œé‚£ä¹ˆ $a$ å¯ä»¥å†™æˆè¿™æ ·çš„å½¢å¼ï¼š $$a = bq + r$$ å…¶ä¸­ $q$ æ˜¯æ•´æ•°ï¼ˆæˆ‘ä»¬ä¸éœ€è¦å»ç®¡ $q$ åˆ°åº•æ˜¯å¤šå°‘ï¼Œè¿™å’Œæˆ‘ä»¬çš„ç›®æ ‡æ— å…³ï¼‰ã€‚ ç°åœ¨å‡è®¾ $a$ å’Œ $b$ çš„ä¸€ä¸ªçº¦æ•°ä¸º $u$ï¼Œé‚£ä¹ˆ $a$ å’Œ $b$ éƒ½èƒ½è¢« $u$ æ•´é™¤ï¼Œå³ $$a = su$$ $$b = tu$$ $s$ å’Œ $t$ éƒ½æ˜¯æ•´æ•°ï¼ˆåŒæ ·çš„ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“å­˜åœ¨è¿™æ ·çš„æ•´æ•° $s$ å’Œ $t$ å°±è¡Œï¼‰ã€‚ è¿™æ ·å¯ä»¥å¾—å‡º $$r = a - bq = su - (tu)q = (s - tq)u$$ æ‰€ä»¥ $r$ ä¹Ÿèƒ½è¢« $u$ æ•´é™¤ï¼Œä¸€èˆ¬è§„å¾‹å¦‚ä¸‹ $a$ å’Œ $b$ çš„çº¦æ•°ä¹Ÿæ•´é™¤å®ƒä»¬çš„ä½™æ•° $r$ï¼Œæ‰€ä»¥ $a$ å’Œ $b$ çš„ä»»ä¸€çº¦æ•°åŒæ—¶ä¹Ÿæ˜¯ $b$ å’Œ $r$ çš„çº¦æ•°ã€‚ â€”â€” æ¡ä»¶ä¸€ åè¿‡æ¥å¯ä»¥å¾—å‡º $b$ å’Œ $r$ çš„ä»»ä¸€çº¦æ•°åŒæ—¶ä¹Ÿæ˜¯ $a$ å’Œ $b$ çš„çº¦æ•°ã€‚ â€”â€”æ¡ä»¶äºŒ è¿™æ˜¯å› ä¸ºå¯¹ $b$ å’Œ $r$ æ¯ä¸€ä¸ªçº¦æ•° $v$ï¼Œæœ‰ $$b = kv$$ $$r = cv$$ äºæ˜¯æœ‰ $$a = bq + r = (kv)q + cv = (kq + c)v$$ ç”±æ¡ä»¶ä¸€å’Œæ¡ä»¶äºŒå¯çŸ¥ $a$ å’Œ $b$ çš„çº¦æ•°çš„é›†åˆï¼Œå…¨ç­‰äº $b$ å’Œ $r$ çš„çº¦æ•°çš„é›†åˆã€‚ äºæ˜¯ $a$ å’Œ $b$ çš„æœ€å¤§å…¬çº¦æ•°ï¼Œå°±æ˜¯ $b$ å’Œ $r$ çš„æœ€å¤§å…¬çº¦æ•°ã€‚ æ¥ä¸‹æ¥ç”¨é€’æ¨æ³•ï¼Œ $a \\div b$ ä½™ $r$ï¼Œç°åœ¨è®¾ $b \\div r$ ä½™ $r_1$ $r \\div r_1$ ä½™ $r_2$ â€¦â€¦ $r_{n-3} \\div r_{n-2}$ ä½™ $r_{n-1}$ $r_{n-2} \\div r_{n-1}$ ä½™ $r_n=0$ å› ä¸º $a \\ge b$ï¼Œå¯ä»¥çœ‹å‡ºä½™æ•° $r_n$ ä¼šè¶Šæ¥è¶Šå°ï¼Œæœ€ç»ˆå˜æˆ $0$. å½“ $r_{n-1} \\neq 0$ ä¸” $r_n = 0$ æ—¶ï¼Œå¯çŸ¥ $r_{n-2}$ å¯è¢« $r_{n-1}$ æ•´é™¤ï¼ˆä½™æ•°ä¸º $0$ å˜›ï¼‰ æ­¤æ—¶ $r_{n-2}$ å’Œ $r_{n-1}$ çš„çº¦æ•°å°±åªæœ‰ï¼š$r_{n-1}$ å’Œ $r_{n-1}$ çš„å› æ•°ï¼Œæ‰€ä»¥ä»–ä»¬çš„æœ€å¤§å…¬çº¦æ•°å°±æ˜¯ $r_{n-1}$ï¼ æ‰€ä»¥ $r_{n-1}$ å°±æ˜¯ $a$ å’Œ $b$ çš„æœ€å¤§å…¬çº¦æ•°ã€‚ï¼ˆè‹¥ $r = 0$ï¼Œåˆ™ $b$ ä¸ºæœ€å¤§å…¬çº¦æ•°ï¼‰ è¿™ä¸ªé€’æ¨æ³•å†™æˆcè¯­è¨€å‡½æ•°æ˜¯è¿™æ ·çš„ï¼ˆæ¯”æ¨å¯¼æ›´ç®€æ´â€¦ï¼‰: unsigned int Gcd(unsigned int M,unsigned int N){ unsigned int Rem; while(N){ Rem = M % N; M = N; N = Rem; } return Rem; } å¯ä»¥å‘ç°è¿™é‡Œæ²¡æœ‰è¦æ±‚ M\u003e=Nï¼Œè¿™æ˜¯å› ä¸ºå¦‚æœé‚£æ ·ï¼Œå¾ªç¯ä¼šè‡ªåŠ¨äº¤æ¢å®ƒä»¬çš„å€¼ã€‚ P.S. æ­¤å¤–ï¼Œè¿˜æœ‰æœ€å°å…¬å€æ•°(Least Common Multiple (LCM))ç®—æ³•ï¼Œè¯¦è§ GCD and LCM calculator ","date":"2017-05-26","objectID":"/posts/mathematics-in-euclidean-gcd/:0:0","tags":["ç®—æ³•"],"title":"æ¬§å‡ é‡Œå¾—ç®—æ³•æ±‚æœ€å¤§å…¬çº¦æ•°(GCD)çš„æ•°å­¦åŸç†","uri":"/posts/mathematics-in-euclidean-gcd/"},{"categories":["éšç¬”"],"content":"ç”Ÿæ´»æ€»æ˜¯åœ¨ç»™ä½ å¸Œæœ›ä¹‹æ—¶ï¼Œå†åŸ‹ç‚¹ä¼ç¬”ã€‚æœ¬æ¥æˆ‘ä»¥ä¸ºè¿›äº†å¤§å­¦ï¼Œå°±æ˜¯ä¸€ä¸ªå…¨æ–°çš„ä¸–ç•Œäº†ï¼Œæˆ‘å¯ä»¥é‡æ–°å¼€å§‹ï¼Œåªè¦æˆ‘å¾ˆåŠªåŠ›å¾ˆåŠªåŠ›ï¼Œä¸€åˆ‡å›°éš¾éƒ½å°†ä¸å ªä¸€å‡»ã€‚ æ˜¾ç„¶é‚£ä¸ªæ—¶å€™ï¼Œæˆ‘è¿˜ä¸çŸ¥é“ï¼Œç°å®ä¸åŒäºæƒ³è±¡ã€‚ é«˜ä¸‰åœ¨é«˜å‹ä¸‹å…¨çº¿å´©æºƒï¼Œå› æ­¤å¯¹å¤§å­¦å¯„äºˆäº†è¿‡å¤šæœŸæœ›ã€‚ä½†è¿™æœŸæœ›åŒæ—¶ä¹Ÿå¸¦æ¥äº†æ›´å¤§çš„å‹åŠ›ã€‚ æˆ‘æ‚£ä¸Šäº†é˜…è¯»ç„¦è™‘ç—‡ã€‚ ä»è¿›å…¥å¤§å­¦çš„é‚£ä¸€åˆ»èµ·ï¼Œå°±å¼€å§‹ç–¯ç‹‚åœ°åˆ¶å®šé˜…è¯»è®¡åˆ’ï¼Œæ³¡å›¾ä¹¦é¦†ï¼Œçœ‹å„ç§å­¦ä¹ æ–¹æ³•ã€è¯»ä¹¦æ–¹æ³•ã€è®°å¿†æ–¹æ³•ã€é€Ÿè¯»æœ¯ä¹‹ç±»çš„ä¹¦ç±ï¼Œæ¨ä¸å¾—ä¸€ç›®åè¡Œã€‚ ä½†æ˜¯å¾ˆå¿«çš„ï¼Œæˆ‘å°±å‘ç°è‡ªå·±å‡ºäº†é—®é¢˜ï¼šæˆ‘å¤ªæƒ³æå‡è‡ªå·±äº†ï¼Œå› æ­¤ç¿»å¼€ä¹¦çš„ç¬¬ä¸€é¡µï¼Œå°±æœŸç›¼ç€ç¿»åˆ°æœ€åä¸€é¡µï¼Œè¯»ä¹¦çš„æ„‰æ‚¦ï¼Œè¢«å¯¹çœ‹å®Œä¸€æœ¬ä¹¦çš„æ¸´æœ›å†²æ·¡äº†ã€‚æ›´å¤šçš„æ—¶å€™ï¼Œæ„Ÿè§‰åˆ°çš„æ˜¯è¿˜æ²¡æŠŠè¿™æœ¬ä¹¦çœ‹å®Œçš„ç„¦è™‘ã€‚ è€Œä¸”å› ä¸ºé•¿æ—¶é—´å…¨ç¥è´¯æ³¨ï¼Œä¸€æœ¬ä¹¦çœ‹ä¸åˆ°ä¸€åŠï¼Œè€å¿ƒä¹Ÿæ¸æ¸å¤±å»ï¼Œäºæ˜¯ç¿»é¡µé€Ÿåº¦è¶Šæ¥è¶Šå¿«ï¼Œè¿™ä¸ªæ—¶å€™æ‰€è°“çš„â€œé˜…è¯»â€å·²ç»åå­˜å®äº¡äº†ã€‚ è¿™æ ·çš„é˜…è¯»çš„ç»“æœï¼Œåªæ˜¯åœ¨è¯»ä¹¦é‡ä¸Šå¾’ç„¶æ·»åŠ å‡ ä¸ªæ•°å­—ï¼Œäºè‡ªæˆ‘æå‡è€Œè¨€ï¼Œå´æ˜¯æ”¶æ•ˆç”šå¾®ã€‚æˆ‘å¾ˆæ˜ç™½è¿™ä¸€ç‚¹ï¼Œä½†æ˜¯æ˜ç™½å’Œä½œå‡ºæ”¹å˜ä¹‹é—´ï¼Œéš”ç€ä¸€é“é¸¿æ²Ÿï¼Œæˆ‘æ€ä¹ˆä¹Ÿè·¨ä¸è¿‡å»ã€‚æ˜æ˜çŸ¥é“æ¾å¼›æœ‰åº¦æ•ˆç‡ä¼šæ›´é«˜ï¼Œä½†æ˜¯å¿ƒç†ä¸Šçš„ç„¦è™‘è®©æˆ‘æ— æ³•è¯´æœè‡ªå·±æ”¾ä¸‹ä¹¦æœ¬å“ªæ€•ä¸€åˆ†é’Ÿï¼Œç›´åˆ°è‡ªå·±çš„è€å¿ƒæ¶ˆè€—æ®†å°½â€¦â€¦ ä¹°äº†ä¸€å¤§å †æ–‡å­¦ä¹¦æ”¾åœ¨æŸœå¤´ã€‚å¯ç¬‘çš„æ˜¯ï¼Œå¤§ä¸€æ•´æ•´ä¸€å¹´ï¼Œé™¤äº†éŸ©å¯’ï¼Œæˆ‘æ²¡çœ‹ä»»ä½•ä¸€æœ¬æ–‡å­¦ä¹¦è¶…è¿‡åŠå°æ—¶ã€‚â€œå¿«é€Ÿæµè§ˆâ€å®Œåå‡ æœ¬æ–¹æ³•ç±»ä¹¦ç±åï¼Œæˆ‘å¼€å§‹é˜…è¯»æŠ€æœ¯ä¹¦ç±ã€‚ä½†æ˜¯é™¤äº†éŸ©å¯’çš„ä¹¦å’Œå‡ æœ¬æŠ€æœ¯ä¹¦ç±ï¼Œé˜…è¯»è¿‡ç¨‹ä¸­çš„ç„¦è™‘æ„Ÿä»æœªè¿œç¦»æˆ‘ï¼Œè¿™ä¸ä»…é™ä½äº†æˆ‘çš„å­¦ä¹ æ•ˆç‡ï¼Œæ›´è®©æˆ‘çš„å€¦æ€ æœŸé•¿äº†æ•°å€(è¿‡åº¦æ¶ˆè€—ç²¾åŠ›)ã€‚å…¶ç»“æœæ˜¯ï¼Œå¾€å¾€ä¸€æœ¬åšä¸€ç‚¹çš„ä¹¦è¯»ä¸Šä¸¤ä¸‰å¤©ï¼Œå°±æœ‰åŠä¸ªæœˆä¼šåŒå€¦åˆ°ä¸æƒ³ç¢°å®ƒã€‚ æˆ‘èƒ½æ„Ÿè§‰åˆ°å¦‚æœæŒ‰ç€è®¡åˆ’è¯»ä¹¦ï¼Œæˆ‘çš„æˆæœç»ä¸ä¼šå·®åˆ°ç°åœ¨è¿™æ ·ã€‚ä¹Ÿæƒ³ç€æœ‰è®¡åˆ’æ€§ä¸€ç‚¹ï¼Œå¯æ˜¯ä¸€çœ‹QQï¼Œäººå®¶åˆä¸‰çš„å°ç”·å­©å·²ç»å­¦éäº†é«˜ä¸­æ•°å­¦ã€ç®—æ³•ã€åˆç­‰æ•°è®ºã€è‡ªç„¶æ•°å­¦â€¦â€¦ç½‘ä¸Šè®¤è¯†çš„åŒé¾„äººå·²ç»å¼€å§‹åšç¥ç»ç½‘ç»œäº†ï¼ŒçŸ¥ä¹ä¸Šä¸€å¤§ç¾¤è‡ªå­¦è€…ä¹Ÿåœ¨åŠªåŠ›æ”»å…‹python/c/ç®—æ³•ï¼Œæˆ‘å°±åœä¸ä¸‹æ¥ï¼Œç”šè‡³å¹³é™ä¸‹æ¥åšä¸ªè®¡åˆ’éƒ½è§‰å¾—æµªè´¹æ—¶é—´(å®é™…ä¸Šå¾ˆæ˜æ˜¾è¿™æ ·å¸¦ç€ç„¦è™‘é˜…è¯»æ‰æ˜¯æµªè´¹æ—¶é—´)ã€‚ è¿«åˆ‡çš„æƒ³è¦æˆä¸ºé‚£ä¸ªâ€œè‡ªå·±æƒ³è¦æˆä¸ºçš„äººâ€ï¼Œå› æ­¤è¿åŸºæœ¬çš„ç†æ€§éƒ½æ— æ³•ä¿æŒã€‚ æˆ‘æƒ³è¦çš„æ˜¯ä»å®¹ã€å¸¦ç€è„‘å­çš„é˜…è¯»ï¼Œè€Œä¸æ˜¯è¿™æ ·èµ°é©¬è§‚èŠ±ï¼Œç›²ç›®è¿½æ±‚é‡çš„é˜…è¯»ã€‚ æˆ‘åˆç„¦è™‘åœ°æ‰“å¼€çŸ¥ä¹ï¼Œä¸æ–­æœç´¢ï¼Œç„¶åå†™ä¸‹è¿™ç¯‡æ–‡ç« ã€‚ ","date":"2017-03-07","objectID":"/posts/reading-anxiety/:0:0","tags":[],"title":"æˆ‘æ‚£ä¸Šäº†é˜…è¯»ç„¦è™‘ç—‡","uri":"/posts/reading-anxiety/"},{"categories":["éšç¬”"],"content":" 2017å¹´2æœˆçš„18å·ï¼Œæ¸…æ™¨6ç‚¹ã€‚å¤©è¿˜åªæ˜¯æœ¦æœ¦äº®ï¼Œå½“ç©ºæŒ‚ç€åŠè¾¹å¼¯æœˆï¼Œä¸€é¢—ä¸çŸ¥åçš„æ˜Ÿæ˜Ÿ(å¤§çº¦æ˜¯å¤§è§’æ˜Ÿ)ç¼€åœ¨æœˆçš„æ—è¾¹ã€‚ è¿˜æ²¡å¼€å­¦ï¼Œå­¦æ ¡å‡ ä¹çœ‹ä¸åˆ°äººã€‚ å—é£Ÿå ‚çš„ä¸€æ¥¼å·²äº®èµ·äº†ç¯ï¼Œé¸Ÿå„¿ä»¬å¼€å§‹é¸£å«ä¸ªä¸åœï¼Œå¯ä»¥å¬å‡ºæœ‰å¥½å‡ ç§é¸Ÿå«å£°ã€‚ æ˜“æµ·ä»æ˜¯é£å¹³æµªé™ã€‚ æˆ‘èƒŒç€ä¹¦åŒ…ï¼Œæ‹–ç€çš®ç®±ï¼Œè€³è¾¹æœ€æ¸…æ™°çš„å£°éŸ³ä¾¿æ˜¯çš®ç®±è½®èƒä¸åœ°é¢çš„æ‘©æ“¦å£°ã€‚ æ‰‹æœºéšä¾¿æ”¾èµ·ä¸€é¦–æ­Œï¼Œæ°å¥½æ˜¯ã€Šé¥è¿œçš„æ­Œã€‹ã€‚è¿™é¦–æ­ŒçœŸæ˜¯åº”æ™¯å‘¢ï¼Œé€å»çš„æ—¶å…‰é¥è¿œå¾—æ— æ³•è§¦åŠï¼Œè‡ªå·±ä¹Ÿç¦»å®¶åƒé‡Œï¼Œæœªæ¥æ›´æ˜¯éš¾ä»¥æ‰æ‘¸ã€‚ æˆ‘è¿˜ä¼šè®°å¾—å—ï¼Ÿè®°å¾—è¿™ä¸ªæˆ‘å°è±¡ä¸­ï¼Œæœ€å®é™å®‰è¯¦çš„ï¼Œå®‰å¾½å»ºç­‘å¤§å­¦ã€‚ ","date":"2017-02-18","objectID":"/posts/quiet-and-peaceful-campus/:0:0","tags":[],"title":"å°‘æœ‰äººè¿¹çš„æ ¡å›­","uri":"/posts/quiet-and-peaceful-campus/"},{"categories":["éšç¬”"],"content":" ä¸Šä¸ªæš‘å‡ï¼Œåˆšåˆšä»ä½è°·çˆ¬å‡ºæ¥ï¼Œé‚£æ—¶å€™æ•´ä¸ªäººæ•£å‘ç€ä¸€è‚¡å­å‘ä¸Šçš„æ°”æ¯ï¼Œè±ªæƒ…ä¸‡ä¸ˆï¼Œç”šè‡³æ„ŸæŸ“äº†å‘¨å›´çš„äº²æœ‹å¥½å‹ã€‚é‚£ä¸ªæ—¶å€™ï¼Œæ»¡ä»¥ä¸ºä»¥åçš„æŒ«æŠ˜éƒ½ä¸èƒ½é˜»æŒ¡æˆ‘çš„è„šæ­¥ã€‚ å¯æ˜¯ï¼Œåˆ°åº•ä¸ºä»€ä¹ˆï¼Œç°åœ¨åˆå˜æˆäº†è¿™ä¸ªæ ·å­äº†å‘¢ï¼Ÿäººç”Ÿè¿™æ ·çš„ä¸œè¥¿ï¼Œæ€»æ˜¯å‡ºäººæ„æ–™ï¼Œä»¥è‡³äºæ€ä¹ˆä¹ŸçŒœä¸é€ã€‚ åäºŒæœˆåå››ï¼Œæˆ‘åº¦è¿‡äº†æˆ‘çš„åä¹å²ç”Ÿæ—¥ï¼Œç°åœ¨åº”è¯¥æ­£æ˜¯é‚£æ‰€è°“çš„é’æ˜¥å°†é€æœªé€ä¹‹æ—¶ã€‚è€Œæˆ‘çš„é’æ˜¥åº”è¯¥æœ€è¾‰ç…Œçš„æ—¶å€™ï¼Œæˆ‘åœ¨å¹²ä»€ä¹ˆå‘¢ï¼Ÿ æˆ‘åœ¨ç¿»å±±è¶Šå²­ã€‚ ä¸Šå±±æ—¶ä¸€è·¯åå·ï¼Œç´¯çš„è¦æ­»ä¸æ´»çš„ã€‚é™¡ç„¶é—´èŒç”Ÿé€€æ„ï¼Œå¿ƒå°±åœ¨ä¸æ–­æŒ£æ‰ã€‚å°±åœ¨å´æ„æˆ˜èƒœå£®å¿—ä¹‹æ—¶ï¼Œå¿½ç„¶é—´å¤©åœ°å¼€é˜”ï¼Œæ‰å‘è§‰è‡ªå·±å·²ç„¶ç«™åœ¨äº†å¤§å±±ä¹‹å·…ï¼Œäºæ˜¯ä¸€åˆ‡ç—›è‹¦å°½çš†è¿œå»ï¼Œå¿ƒä¹Ÿå˜å¾—å¦‚è¿™å¤©åœ°ä¸€èˆ¬å¼€é˜”ã€‚è¿™ä¸ªæ—¶å€™è‡ªç„¶è±ªæƒ…ä¸‡ä¸ˆï¼Œçœ‹å±±å±±ç¾ï¼Œçœ‹æ°´æ°´ç§€ã€‚æƒ³å½“ç„¶çš„å°±è§‰å¾—åé¢çš„å±±å²­æœ‰å†å¤šçš„é˜»ç¢ï¼Œä¹Ÿä¸èƒ½é˜»æŒ¡è¿™ä¸ªè§è¿‡å¦‚æ­¤ç¾æ™¯çš„ç™»å±±äººäº†ã€‚ å¯æ˜¯äº‹ä¸æ„¿è¿ï¼Œå±±å²­å°±åƒæ—¶é—´ä¸€æ ·çœ‹ä¸åˆ°è¾¹ï¼Œç¿»è¿‡äº†ä¸€åº§åˆæ˜¯ä¸€åº§ï¼Œè¿™åˆæ˜¯ä¸€ç§æ›´å¤§çš„ç—›è‹¦ã€‚è¿™ä¸ªç™»å±±äººèº«å¿ƒä¿±ç–²ï¼Œåªå¥½ä¸‡äº‹éšç¼˜ï¼Œç»§ç»­ä¸€è„šæ·±ï¼Œä¸€è„šæµ…çš„å¾€é‚£æ— å°½å±±å²­è¡Œå»ã€‚ æœ€è¿‘çœ‹äº†æ˜¯æè£•å’Œçš„ç”µå½±ã€Šæ¯”æµ·æ›´æ·±ã€‹ï¼Œâ€œæˆ‘çš„äººç”Ÿåˆ°åº•å‡ºäº†ä»€ä¹ˆå·®é”™ï¼Ÿâ€ è¿™æ ·ä¸€ä¸ªé—®å¥ï¼Œé“å‡ºäº†å¤šå°‘è¾›é…¸è‹¦è¾£â€¦â€¦æƒ³èµ·äº†ä»¥å‰å†™è¿‡ä¸€ç¯‡æ–‡ç« ï¼Œæ ‡é¢˜æ˜¯ã€Šå¯¹ä¸èµ·ï¼Œæˆ‘æ²¡æœ‰æˆä¸ºä½ æƒ³æˆä¸ºçš„é‚£ä¸ªäººã€‹ã€‚ ç†æƒ³ä¸ç°å®ä¹‹é—´ä»¿ä½›æ€»éš”ç€ä¸€é“é¸¿æ²Ÿã€‚ ç°åœ¨æ²¡æœ‰äº†ä¸‡ä¸ˆè±ªæƒ…ï¼Œä¸å†æ•¢è¯´â€œæœªæ¥å°†æ˜¯ä¸€ç‰‡å¦é€”â€ï¼›ä¹Ÿæ²¡æœ‰ç»æœ›åˆ°è¦å†™â€œæˆ‘çš„äººç”Ÿåˆ°åº•å‡ºäº†ä»€ä¹ˆå·®é”™ï¼Ÿâ€è¿™æ ·çš„å¥å­ï¼Œé‚£è¿˜æ˜¯ç”¨æˆ‘æœ€å–œæ¬¢çš„é‚£ä¸ªæ¨¡æ£±ä¸¤å¯çš„å››å­—è¯ä½œç»“å§ã€‚ ä¸”è¡Œä¸”å¯» ","date":"2017-02-06","objectID":"/posts/the-holiday-is-coming-to-an-end/:0:0","tags":[],"title":"å¿½è€Œå‡æœ«","uri":"/posts/the-holiday-is-coming-to-an-end/"}]