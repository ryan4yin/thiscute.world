[{"categories":["life"],"content":" å¦‚ä»Šå›åˆ°ä¹¡ä¸‹è€å®¶ï¼Œæˆ‘æŠŠäºŒæ¥¼å¤§å®¢å…å¸ƒç½®æˆäº†åŠå…¬å®¤ï¼Œç½®åŠäº†å¼ å¤§å·å‡é™æ¡Œï¼Œé…ä¸Šä¸¤å°å¤§æ˜¾ç¤ºå™¨ï¼Œå®½å¸¦ä¹Ÿå‡çº§åˆ°äº†åƒå…†ã€‚ ä»Šå¹´å¤§éƒ¨åˆ†æ—¶é—´ï¼Œæˆ‘å°±åœ¨è¿™é‡Œä¸Šç­ã€‚ ä¸Šç­ç´¯äº†ï¼Œä¸€æŠ¬å¤´ï¼Œè½åœ°çª—å¤–å°±æ˜¯ä¸€ç‰‡ç¨»ç”°ã€‚ç¦»å®¶ 50 ç±³æ˜¯æ‘æ´»åŠ¨å¹¿åœºï¼Œæˆ‘å¶å°”å»ç©ç©æ»‘æ¿ï¼›å¤©çƒ­äº†ï¼Œ æ¯å¤©ä¸­åˆå°±å»å±±é‡Œæ°´æ½­ç»ƒä¹ æ¸¸æ³³ï¼›ä¸‹åˆä¸‹ç­åï¼Œå¸¸æ²¿ç€è¿›å±±è·¯è·‘ä¸Šä¸€ä¸¤ä¸ªå°æ—¶ï¼Œæˆ–è€…éª‘è¡Œï¼›æ™šä¸Šï¼Œå°±åˆ·ç‚¹åŠ¨æ¼«ï¼Œæˆ–è€…ç ”ç©¶ç‚¹æŠ€æœ¯ã€‚æ¯éš”ä¸€ä¸¤ä¸ªæœˆï¼Œæˆ‘ä¼šå»ä¸€çº¿åŸå¸‚å‚åŠ äº›æ„Ÿå…´è¶£çš„æŠ€æœ¯ä¼šè®®ï¼Œæ„Ÿå—ä¸‹æ°›å›´ï¼Œæˆ–è€…å¹²è„†æ‰¾ä¸ªåœ°æ–¹æ—…æ¸¸ä¸Šç­ï¼Œé¡ºé“è”ç»œè”ç»œè€æœ‹å‹è€åŒå­¦ã€‚ ç°åœ¨è¿™æ ·çš„çŠ¶æ€ï¼Œå°±æ˜¯æˆ‘ç›®å‰ç†æƒ³ä¸­çš„ç”Ÿæ´»ã€‚ ","date":"2025-11-04","objectID":"/posts/job-and-life/:1:0","series":[],"tags":[],"title":"å¤§æ¢¦ä¸€åœº","uri":"/posts/job-and-life/#å¦‚ä»Š"},{"categories":["life"],"content":" è¿‡å»å¾ˆéš¾æƒ³è±¡ï¼Œå°±åœ¨å…­å¹´å‰ï¼Œæˆ‘æ›¾å¿ƒç°æ„å†·ï¼Œè§‰å¾—å‰é€”æ— æ¯”é»‘æš—ã€‚ é‚£æ—¶çš„æˆ‘å­¦ä¸šå½»åº•å¤±è´¥ï¼Œå­¤æ³¨ä¸€æ·åœ°å¥”åˆ°æ·±åœ³ï¼Œæƒ³æ‰¾ä¸€ä¸ªè¿›å…¥ IT è¡Œä¸šçš„æœºä¼šã€‚å¹¸è¿çš„æ˜¯ï¼Œæˆ‘å…¥èŒäº†ä¸€å®¶å°ä½œåŠå½“ã€Œå…¨å¹²å·¥ç¨‹å¸ˆã€ï¼ˆå•¥éƒ½å¾—å¹²ï¼‰ï¼Œåœ¨åŸä¸­æ‘ 10 å¹³ç±³çš„å•é—´é‡Œï¼Œç”¨ä¸¤å¹´é’æ˜¥æ¢æ¥äº†æŠ€æœ¯ç»éªŒå’Œä¸€ç‚¹è‡ªä¿¡å¿ƒã€‚æ¥ç€è·³æ§½ï¼ŒèŒä¸šç”Ÿæ¶¯æ‰ç®—æ­¥å…¥æ­£è½¨ã€‚åˆè¿‡äº†å››å¹´ï¼Œå› ä¸ºä¸€äº›äº‹æƒ…é€‰æ‹©äº†è¾èŒï¼ŒGap 3 ä¸ªæœˆåï¼Œæœºç¼˜å·§åˆä¸‹æ‰å…¥èŒäº†ç°åœ¨çš„å…¬å¸ï¼Œå¼€å§‹äº†å¦‚ä»Šçš„ç”Ÿæ´»ã€‚ è¿™å…¶ä¸­ç§ç§ï¼Œæˆ‘ä¹‹å‰åœ¨ã€Šæˆ‘çš„å››åˆ†ä¹‹ä¸€äººç”Ÿã€‹ ä¸­å·²è®²å¾—å¾ˆè¯¦ç»†ï¼Œåªæ˜¯è‡ªé‚£ä¹‹ååˆ°ç°åœ¨ï¼Œåˆæ˜¯ä¸¤å¹´è¿‡å»äº†ã€‚ ä¸Šå‘¨ä¸€å£æ°”æŠŠã€Šå‡¡äººä¿®ä»™ä¼ ã€‹åŠ¨ç”»åˆ·å®Œï¼Œçœ‹åˆ°ä¸»è§’éŸ©ç«‹ç»“ä¸¹æ—¶ï¼Œé‡Œé¢ä¸€å¥è¯„è¯­è®©æˆ‘æ„Ÿæ…¨ä¸‡åƒï¼š ä¼ªçµæ ¹ã€æ•£ä¿®ï¼Œèƒ½èµ°åˆ°ä»Šå¤©è¿™èˆ¬å¢ƒåœ°ï¼Œè¿˜çœŸæ˜¯ä¸å®¹æ˜“å•Šã€‚ æ˜¯å•Šï¼Œä¸å®¹æ˜“ã€‚å¹´å²æ¸æ·±ï¼Œç é¾„æ¸æ¶¨ï¼Œè–ªæ°´ä¹Ÿæ°´æ¶¨èˆ¹é«˜ï¼Œæˆ‘ç»ˆäºèµ°åˆ°äº†ä¸€ä¸ªèƒ½å–˜å£æ°”çš„é˜¶æ®µã€‚è™½ç„¶æˆ‘ç°åœ¨çš„è–ªèµ„å¯èƒ½åªæ˜¯å¾ˆå¤šäººçš„èµ·ç‚¹ï¼Œä½†çŸ¥è¶³å¸¸ä¹ï¼Œå¼€å¿ƒæ¯”å•¥éƒ½é‡è¦ã€‚åªè¦ä¸èƒŒä¸Šä¹°æˆ¿ã€ç»“å©šè¿™äº›é‡æ‹…ï¼Œå³ä½¿ä¸åˆ»æ„å»çœé’±ï¼Œåˆ° 35 å²æˆ‘ä¹Ÿåº”èƒ½æ”’ä¸‹ä¸€ç¬”å¯è§‚çš„è´¢å¯Œã€‚åˆ°æ—¶å€™ï¼Œå°±ç®— IT è¿™ç¢—é’æ˜¥é¥­çœŸæ²¡å¾—åƒäº†ï¼Œ åªè¦æ‰‹é‡Œæœ‰é’±ï¼Œä¸ç®¡æ¥ä¸‹æ¥å¹²å•¥ï¼Œåº•æ°”æ€»ä¼šè¶³å¾ˆå¤šã€‚ ","date":"2025-11-04","objectID":"/posts/job-and-life/:2:0","series":[],"tags":[],"title":"å¤§æ¢¦ä¸€åœº","uri":"/posts/job-and-life/#è¿‡å»"},{"categories":["life"],"content":" å› ç¼˜é™…ä¼šå½“ç„¶ï¼Œèƒ½ä»é‚£æ®µé»‘æš—é‡Œèµ°å‡ºæ¥ï¼Œå…‰é åŠªåŠ›æ˜¯ä¸å¤Ÿçš„ã€‚æ­£å¦‚ä¸€ä½é•¿è€…çš„åè¨€ï¼šã€Œä¸€ä¸ªäººçš„å‘½è¿å•Šï¼Œå½“ç„¶è¦é è‡ªæˆ‘å¥‹æ–—ï¼Œä½†ä¹Ÿè¦è€ƒè™‘åˆ°å†å²çš„è¡Œç¨‹ã€‚ã€ æˆ‘å¾ˆéš¾è¯´æ¸…è‡ªå·±æ˜¯å¦æœ‰ IT å¤©èµ‹ã€‚å¤§å­¦è‡ªå­¦ç¼–ç¨‹æ—¶ï¼Œç»å¸¸æ†‹å¥½ä¹…éƒ½å†™ä¸å‡ºå‡ è¡Œä»£ç ï¼Œæ— æ•°æ¬¡æƒ³è¿‡æ”¾å¼ƒçæŠ˜è…¾ï¼Œè€è€å®å®æŠŠå£°å­¦å­¦å¥½ç®—äº†ã€‚å³ä¾¿æ˜¯ç°åœ¨ï¼Œä»£ç èƒ½åŠ›ä¹Ÿç®—ä¸ä¸Šå¤šå¼ºã€‚ è¦è¯´æœ‰ä»€ä¹ˆæ¯”å¤©èµ‹æ›´é‡è¦ï¼Œå¯èƒ½è¿˜æ˜¯å…´è¶£å§ã€‚å› ä¸ºæ˜¯åœ¨åšç€è‡ªå·±çœŸæ­£å–œæ¬¢çš„ä¸œè¥¿ï¼Œæ‰€ä»¥ä¸è§‰å¾—è‹¦ä¸è§‰å¾—ç´¯ã€‚åœ¨å›°éš¾é¢å‰ï¼Œæˆ‘å¾€å¾€è¯‰è¯¸è¡ŒåŠ¨ï¼Œè€Œä¸æ˜¯æ€¨å¤©å°¤äººã€‚è¿˜æœ‰å°±æ˜¯ï¼Œæˆ‘å°½é‡è®©è‡ªå·±æ¯ä¸ªé”™éƒ½åªçŠ¯ä¸€æ¬¡ã€‚å¯èƒ½å°±æ˜¯è¿™äº›ä¸èµ·çœ¼çš„ä¹ æƒ¯è®©æˆ‘æ…¢æ…¢æ”’ä¸‹äº†ç°åœ¨è¿™ä»½ä¸é”™çš„ GitHub Profileã€æŒç»­æ›´æ–°çš„æŠ€æœ¯åšå®¢ï¼Œä»¥åŠåœ¨ X ä¸Šé åˆ†äº«è·å¾—çš„ä¸€ç‚¹çŸ¥ååº¦ã€‚ å½“è¿™äº›ä¸ªäººç§¯ç´¯ï¼Œæ°å¥½åˆé‡ä¸Šäº† IT è¡Œä¸šçš„æ—¶ä»£æµªæ½®ï¼Œå†åŠ ä¸Šä¸€ç‚¹ç‚¹è¿æ°”ä½œä¸ºå‚¬åŒ–å‰‚ï¼Œä¾¿äº§ç”Ÿäº†å¥‡å¦™çš„åŒ–å­¦ååº”ã€‚æ­£æ˜¯è¿™äº›å› ç´ å‡‘åœ¨ä¸€èµ·ï¼Œæ‰å¾—ä»¥è®©ä¸€ä¸ªæœ¬ç§‘ç»“ä¸šçš„å­¦æ¸£ï¼Œä¹Ÿèƒ½æ¬¡æ¬¡æ‰¾åˆ°æ»¡æ„çš„å·¥ä½œã€‚ ","date":"2025-11-04","objectID":"/posts/job-and-life/:3:0","series":[],"tags":[],"title":"å¤§æ¢¦ä¸€åœº","uri":"/posts/job-and-life/#å› ç¼˜é™…ä¼š"},{"categories":["life"],"content":" å›å½’å¹´è½»æ—¶ç”¨å¥åº·å’Œæ—¶é—´æ¢é’±ï¼Œå‹æ¦¨ç²¾åŠ›ï¼Œå¿½ç•¥å®¶äººï¼Œä¹Ÿå‹æŠ‘ç€å¿ƒåº•çš„å°å¿µæƒ³ã€‚è¿™ä¸¤å¹´ï¼Œæˆ‘å¼€å§‹å„ç§ã€Œæ‰¾è¡¥ã€ï¼šå¸¦çˆ¶æ¯å¦¹å¦¹çœ‹ç‰™æ´—ç‰™ï¼Œç”¨å¾’æ­¥ã€æ¸¸æ³³ã€éª‘è¡Œæ‰¾å›å¥åº·ï¼ŒæŠŠå¨æˆ¿ç”µå™¨å¡«æ»¡ï¼Œåˆ°å¤„æ—…æ¸¸ç»“äº¤æœ‹å‹ã€‚ 2025 å¹´å·²ç»ä¸´è¿‘å°¾å£°ï¼Œæˆ‘è¿™ä»½æ–°å·¥ä½œè¿˜æœ‰ä¹ä¹çš„å­¦ä¸šéƒ½é€æ¸ç¨³å®šäº†ä¸‹æ¥ï¼ŒQ3 åœ¨å·¥ä½œä¸Šåšå¾—è¿˜ä¸é”™ï¼Œé¢†å¯¼ç»™å‡ºäº†ã€ŒExceeds Expectationsã€çš„è¯„ä»·ï¼Œç®—æ˜¯ä¸ªå¾ˆä¸é”™çš„æ–°å¼€å§‹ã€‚ æ€»ä¹‹ï¼Œæˆ‘åˆå›åˆ°äº†æˆ‘å‡ºç”Ÿçš„åœ°æ–¹ã€‚å®‰å¾½å»ºç­‘å¤§å­¦é‚£æœ¦èƒ§çš„æ˜“æµ·ï¼Œå›¾ä¹¦é¦†é‡Œé™ªä¼´æˆ‘å››å¹´çš„ IT ä¹¦æ¶åŒºï¼Œé‚£å¼ å†™ç€æˆ‘æŒ‚æ‰åå¤šé—¨è¯¾çš„æˆç»©å•ï¼›æ·±åœ³æ‘©å¤©å¤§æ¥¼é‡Œçš„å·¥ä½ï¼Œæ—©æ™šé«˜å³°çš„åœ°é“å…¬äº¤ï¼Œä»¥åŠåŸä¸­æ‘é‚£ 20 å¹³çš„å•é—´â€¦â€¦ è¿™ä¸€åˆ‡ï¼Œéƒ½æ¸æ¸æˆäº†å›å¿†ï¼Œæœ‰æ—¶ç”šè‡³è§‰å¾—é‚£åªæ˜¯å¤§æ¢¦ä¸€åœºã€‚ æ¢¦é†’ï¼Œæˆ‘æ¸æ¸çå¼€åŒçœ¼ï¼Œæ‹‰å¼€çª—å¸˜ï¼Œæ‰“å¼€è½åœ°çª—ï¼Œè¿æ¥æ–°ä¸€å¤©ç©¿è¿‡ç¨»ç”°çš„é˜³å…‰ã€‚çœ‹æ¥ï¼Œåˆä¼šæ˜¯ä¸€ä¸ªé£å’Œæ—¥ä¸½çš„æ—¥å­å‘¢ã€‚ æœªæ¥åˆå¾…å¦‚ä½•å‘¢ï¼Ÿã€Œä¸”è¡Œä¸”å¯»ã€ã€‚ ","date":"2025-11-04","objectID":"/posts/job-and-life/:4:0","series":[],"tags":[],"title":"å¤§æ¢¦ä¸€åœº","uri":"/posts/job-and-life/#å›å½’"},{"categories":["tech"],"content":"æ·±å…¥æ¢è®¨ Linux æ¡Œé¢ç³»ç»Ÿçš„å…³æœºæµç¨‹ã€ä¼‘çœ å’ŒæŒ‚èµ·åŠŸèƒ½ï¼Œä»¥åŠç”µæºç®¡ç†çš„æ•…éšœæ’æŸ¥æ–¹æ³•","date":"2025-10-19","objectID":"/posts/linux-desktop-6-shutdown-troubleshooting/","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus","Power Management","Hibernate","Suspend"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå…­ï¼‰ - ç³»ç»Ÿå…³æœºä¸ç”µæºç®¡ç†","uri":"/posts/linux-desktop-6-shutdown-troubleshooting/"},{"categories":["tech"],"content":" AI åˆ›ä½œå£°æ˜ï¼šæœ¬ç³»åˆ—æ–‡ç« ç”±ç¬”è€…å€ŸåŠ© ChatGPT, Kimi K2, è±†åŒ…å’Œ Cursor ç­‰ AI å·¥å…·åˆ›ä½œï¼Œæœ‰å¾ˆå¤§ç¯‡å¹…çš„å†…å®¹å®Œå…¨ç”± AI åœ¨æˆ‘çš„æŒ‡å¯¼ä¸‹ç”Ÿæˆã€‚å¦‚æœ‰é”™è¯¯ï¼Œè¿˜è¯·æŒ‡æ­£ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-6-shutdown-troubleshooting/:0:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus","Power Management","Hibernate","Suspend"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå…­ï¼‰ - ç³»ç»Ÿå…³æœºä¸ç”µæºç®¡ç†","uri":"/posts/linux-desktop-6-shutdown-troubleshooting/#"},{"categories":["tech"],"content":" å‰è¨€ç³»ç»Ÿå…³æœºçœ‹ä¼¼ç®€å•ï¼Œä½†èƒŒåæ¶‰åŠäº†ç¹æ‚çš„èµ„æºæ¸…ç†å’ŒçŠ¶æ€ç®¡ç†è¿‡ç¨‹ã€‚å½“ä½ ç‚¹å‡»å…³æœºæŒ‰é’®ï¼Œç³»ç»Ÿå´å¡åœ¨é‚£é‡Œä¸åŠ¨ï¼Œæˆ–è€…å‡ºç°å„ç§å¥‡æ€ªçš„é”™è¯¯ä¿¡æ¯æ—¶ï¼Œç†è§£å…³æœºæµç¨‹å’Œæ•…éšœæ’æŸ¥æ–¹æ³•å°±æ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚ é™¤äº†å…³æœºï¼ŒLinux è¿˜æä¾›äº†ä¼‘çœ å’ŒæŒ‚èµ·ä¸¤ç§é‡è¦çš„ç”µæºç®¡ç†åŠŸèƒ½ï¼Œå®ƒä»¬å¯ä»¥è®©ç³»ç»Ÿå¿«é€Ÿè¿›å…¥ä½åŠŸè€—çŠ¶æ€ï¼ŒåŒæ—¶ä¿æŒå·¥ä½œçŠ¶æ€ï¼Œæ˜¯æ—¥å¸¸ä½¿ç”¨ä¸­éå¸¸å®ç”¨çš„åŠŸèƒ½ã€‚ ä½œä¸ºè¿™ä¸ªç³»åˆ—çš„æœ€åä¸€ç¯‡æ–‡ç« ï¼Œæœ¬æ–‡å°†æ¢è®¨ç³»ç»Ÿå…³æœºçš„å®Œæ•´æµç¨‹ï¼Œä»¥åŠä¼‘çœ å’ŒæŒ‚èµ·åŠŸèƒ½çš„é…ç½®ä¸æ•…éšœæ’æŸ¥ï¼Œä»ä¼˜é›…å…³é—­åˆ°å¼ºåˆ¶å…³æœºï¼Œä»æœåŠ¡åœæ­¢åˆ°èµ„æºæ¸…ç†ï¼Œä»ç”µæºç®¡ç†åˆ°çŠ¶æ€æ¢å¤ï¼Œå…¨é¢äº†è§£ç³»ç»Ÿçš„ç”µæºç®¡ç†æœºåˆ¶ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-6-shutdown-troubleshooting/:1:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus","Power Management","Hibernate","Suspend"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå…­ï¼‰ - ç³»ç»Ÿå…³æœºä¸ç”µæºç®¡ç†","uri":"/posts/linux-desktop-6-shutdown-troubleshooting/#å‰è¨€"},{"categories":["tech"],"content":" ç³»ç»Ÿå…³æœºæµç¨‹","date":"2025-10-19","objectID":"/posts/linux-desktop-6-shutdown-troubleshooting/:2:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus","Power Management","Hibernate","Suspend"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå…­ï¼‰ - ç³»ç»Ÿå…³æœºä¸ç”µæºç®¡ç†","uri":"/posts/linux-desktop-6-shutdown-troubleshooting/#ç³»ç»Ÿå…³æœºæµç¨‹"},{"categories":["tech"],"content":" 1.1 å…³æœºæµç¨‹æ¦‚è§ˆsystemd ç®¡ç†çš„å…³æœºè¿‡ç¨‹åˆ†ä¸ºå››ä¸ªä¸»è¦é˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µéƒ½æœ‰æ˜ç¡®çš„ç›®æ ‡å’Œé¡ºåºï¼Œç¡®ä¿æ•°æ®å®Œæ•´æ€§å’Œç³»ç»Ÿç¨³å®šæ€§ã€‚ å…³æœºé˜¶æ®µï¼š ç”¨æˆ·ä¼šè¯æ¸…ç†é˜¶æ®µï¼ˆçº¦ 1-5 ç§’ï¼‰ï¼š é€šçŸ¥æ‰€æœ‰ç”¨æˆ·ä¼šè¯å³å°†å…³æœº ä¼˜é›…å…³é—­ç”¨æˆ·åº”ç”¨ç¨‹åº å›æ”¶ç”¨æˆ·è®¾å¤‡æƒé™ ç³»ç»ŸæœåŠ¡åœæ­¢é˜¶æ®µï¼ˆçº¦ 2-10 ç§’ï¼‰ï¼š æŒ‰ä¾èµ–å…³ç³»é€†å‘åœæ­¢ç³»ç»ŸæœåŠ¡ å¸è½½æ–‡ä»¶ç³»ç»Ÿï¼ˆé™¤æ ¹æ–‡ä»¶ç³»ç»Ÿå¤–ï¼‰ ç½‘ç»œæœåŠ¡æ–­å¼€è¿æ¥ å†…æ ¸èµ„æºé‡Šæ”¾é˜¶æ®µï¼ˆçº¦ 1-3 ç§’ï¼‰ï¼š åŒæ­¥æ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿåˆ°ç£ç›˜ å¸è½½æ ¹æ–‡ä»¶ç³»ç»Ÿä¸ºåªè¯» ç»ˆæ­¢æ‰€æœ‰å‰©ä½™è¿›ç¨‹ ç¡¬ä»¶å…³æœºé˜¶æ®µï¼ˆçº¦ 1-2 ç§’ï¼‰ï¼š é€šè¿‡ ACPI å‘é€å…³æœºä¿¡å· å›ºä»¶æ¥ç®¡ç³»ç»Ÿæ§åˆ¶æƒ æ‰€æœ‰ç¡¬ä»¶è®¾å¤‡æ–­ç”µ ","date":"2025-10-19","objectID":"/posts/linux-desktop-6-shutdown-troubleshooting/:2:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus","Power Management","Hibernate","Suspend"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå…­ï¼‰ - ç³»ç»Ÿå…³æœºä¸ç”µæºç®¡ç†","uri":"/posts/linux-desktop-6-shutdown-troubleshooting/#11-å…³æœºæµç¨‹æ¦‚è§ˆ"},{"categories":["tech"],"content":" 1.2 ç”¨æˆ·ä¼šè¯æ¸…ç†å½“ç”¨æˆ·å‘èµ·å…³æœºæ—¶ï¼Œsystemd é¦–å…ˆå¤„ç†ç”¨æˆ·ä¼šè¯çš„æ¸…ç†å·¥ä½œï¼Œç¡®ä¿ç”¨æˆ·æ•°æ®å¾—åˆ°å¦¥å–„ä¿å­˜ã€‚ ä¼šè¯æ¸…ç†æµç¨‹ï¼š bash # systemd å‘é€å…³æœºä¿¡å· systemctl start shutdown.target # ç”¨æˆ·ä¼šè¯æ”¶åˆ°ç»ˆæ­¢ä¿¡å· loginctl terminate-session \u003csession_id\u003e # ç”¨æˆ·æœåŠ¡åœæ­¢ systemctl --user stop graphical-session.target å…³é”®æ“ä½œï¼š ä¼šè¯é€šçŸ¥ï¼šé€šè¿‡ D-Bus å‘æ¡Œé¢ç¯å¢ƒå‘é€å…³æœºä¿¡å· åº”ç”¨å…³é—­ï¼šç­‰å¾…åº”ç”¨ä¿å­˜æœªä¿å­˜çš„æ•°æ® æƒé™å›æ”¶ï¼šlogind å›æ”¶åˆ†é…ç»™ç”¨æˆ·çš„è®¾å¤‡è®¿é—®æƒé™ æœåŠ¡åœæ­¢ï¼šç”¨æˆ· systemd å®ä¾‹åœæ­¢æ‰€æœ‰ç”¨æˆ·æœåŠ¡ ç›‘æ§ç”¨æˆ·ä¼šè¯æ¸…ç†ï¼š bash # æŸ¥çœ‹ä¼šè¯çŠ¶æ€å˜åŒ– journalctl -b | grep -E \"(session|Session)\" # ç”¨æˆ·æœåŠ¡åœæ­¢æ—¥å¿— journalctl --user -b | grep -E \"(Stopping|Stopped)\" # è®¾å¤‡æƒé™å›æ”¶ journalctl -u systemd-logind -b | grep -i \"device\" ","date":"2025-10-19","objectID":"/posts/linux-desktop-6-shutdown-troubleshooting/:2:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus","Power Management","Hibernate","Suspend"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå…­ï¼‰ - ç³»ç»Ÿå…³æœºä¸ç”µæºç®¡ç†","uri":"/posts/linux-desktop-6-shutdown-troubleshooting/#12-ç”¨æˆ·ä¼šè¯æ¸…ç†"},{"categories":["tech"],"content":" 1.3 ç³»ç»ŸæœåŠ¡åœæ­¢ç”¨æˆ·ä¼šè¯æ¸…ç†å®Œæˆåï¼Œsystemd å¼€å§‹æŒ‰ä¾èµ–å…³ç³»çš„é€†å‘é¡ºåºåœæ­¢ç³»ç»ŸæœåŠ¡ã€‚ æœåŠ¡åœæ­¢é¡ºåºï¼š å›¾å½¢æœåŠ¡ï¼šåˆæˆå™¨ã€æ˜¾ç¤ºç®¡ç†å™¨ ç½‘ç»œæœåŠ¡ï¼šç½‘ç»œç®¡ç†å™¨ã€DNS è§£æå™¨ å­˜å‚¨æœåŠ¡ï¼šç£ç›˜ç®¡ç†ã€LVM åŸºç¡€æœåŠ¡ï¼šæ—¥å¿—ã€è®¾å¤‡ç®¡ç† å…³é”®æœåŠ¡å¤„ç†ï¼š bash # æŸ¥çœ‹å…³æœºæ—¶çš„æœåŠ¡åœæ­¢é¡ºåº systemd-analyze critical-chain shutdown.target # ç›‘æ§æœåŠ¡åœæ­¢çŠ¶æ€ watch -n 1 'systemctl list-units --state=deactivating' # æ£€æŸ¥æœåŠ¡åœæ­¢æ—¥å¿— journalctl -b -1 | grep -E \"(Stopping|Stopped)\" | tail -20 æ–‡ä»¶ç³»ç»Ÿå¸è½½ï¼š bash # æŸ¥çœ‹æŒ‚è½½ç‚¹å¸è½½æƒ…å†µ mount | grep -v \"on / type\" # æ–‡ä»¶ç³»ç»ŸåŒæ­¥çŠ¶æ€ sync echo 3 \u003e /proc/sys/vm/drop_caches # æ£€æŸ¥å¸è½½é”™è¯¯ journalctl -b -1 | grep -i \"unmount\\|busy\" ","date":"2025-10-19","objectID":"/posts/linux-desktop-6-shutdown-troubleshooting/:2:3","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus","Power Management","Hibernate","Suspend"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå…­ï¼‰ - ç³»ç»Ÿå…³æœºä¸ç”µæºç®¡ç†","uri":"/posts/linux-desktop-6-shutdown-troubleshooting/#13-ç³»ç»ŸæœåŠ¡åœæ­¢"},{"categories":["tech"],"content":" 1.4 å†…æ ¸èµ„æºé‡Šæ”¾å½“æ‰€æœ‰ç”¨æˆ·ç©ºé—´æœåŠ¡åœæ­¢åï¼Œsystemd æ‰§è¡Œæœ€ç»ˆçš„ç³»ç»Ÿæ¸…ç†ï¼š æ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼š è°ƒç”¨ sync() åŒæ­¥æ‰€æœ‰å·²æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿçš„æ•°æ®åˆ°ç£ç›˜ æŒ‰ç…§é€†å‘æŒ‚è½½é¡ºåºå¸è½½æ‰€æœ‰æŒ‚è½½ç‚¹ å¸è½½å¤–æ¥ç¡¬ç›˜åˆ†åŒºç­‰å¤–éƒ¨å­˜å‚¨è®¾å¤‡ è¿›ç¨‹ç®¡ç†ï¼š å‘æ‰€æœ‰å‰©ä½™è¿›ç¨‹å‘é€ SIGTERMï¼Œç»™å®ƒä»¬æœ€åæ¸…ç†æœºä¼š ç­‰å¾…è¶…æ—¶åï¼Œå¯¹é¡½å›ºè¿›ç¨‹å‘é€ SIGKILL å¼ºåˆ¶ç»ˆæ­¢ æ¸…ç†åƒµå°¸è¿›ç¨‹å’Œå­¤å„¿è¿›ç¨‹ Watchdog ç›‘æ§ï¼š systemd çš„çœ‹é—¨ç‹—æœºåˆ¶ç›‘æ§æœåŠ¡å…³é—­è¿›åº¦ å¦‚æœæœåŠ¡åœæ­¢è¶…è¿‡ TimeoutStopSecï¼Œå¼ºåˆ¶ç»ˆæ­¢æœåŠ¡ é˜²æ­¢ç³»ç»Ÿåœ¨å…³æœºè¿‡ç¨‹ä¸­æ— é™æŒ‚èµ· èµ„æºæ¸…ç†ï¼š GPU é©±åŠ¨é‡ç½®æ˜¾å¡çŠ¶æ€ï¼Œé‡Šæ”¾ VRAM ç½‘ç»œè®¾å¤‡å®Œå…¨æ–­ç”µ éŸ³é¢‘è®¾å¤‡ç¡¬ä»¶é‡ç½® ","date":"2025-10-19","objectID":"/posts/linux-desktop-6-shutdown-troubleshooting/:2:4","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus","Power Management","Hibernate","Suspend"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå…­ï¼‰ - ç³»ç»Ÿå…³æœºä¸ç”µæºç®¡ç†","uri":"/posts/linux-desktop-6-shutdown-troubleshooting/#14-å†…æ ¸èµ„æºé‡Šæ”¾"},{"categories":["tech"],"content":" 1.5 ç¡¬ä»¶å…³æœºå½“æ‰€æœ‰ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸èµ„æºå¤„ç†å®Œæ¯•åï¼Œç³»ç»Ÿè¿›å…¥ç¡¬ä»¶å…³æœºï¼š ACPI æ“ä½œï¼š systemd é€šè¿‡ ACPI å‘å›ºä»¶å‘å‡ºå…³æœºæŒ‡ä»¤ è¿›å…¥ ACPI S5 çŠ¶æ€ï¼Œå‘Šè¯‰å›ºä»¶å…³é—­ç”µæº å›ºä»¶æ¥ç®¡ï¼š BIOS/UEFI æ¥ç®¡ç³»ç»Ÿæ§åˆ¶æƒ æ‰§è¡Œç”µæºå…³æ–­ï¼Œæ‰€æœ‰è®¾å¤‡ï¼ˆCPUã€å†…å­˜ã€GPUã€å¤–éƒ¨è®¾å¤‡ï¼‰æ–­ç”µ å›ºä»¶æ‰§è¡Œæœ€åçš„æ¸…ç†å·¥ä½œ å¼ºåˆ¶å…³æœºä¿æŠ¤ï¼š å¦‚æœç³»ç»Ÿæœªèƒ½æ­£å¸¸å…³æœºï¼Œç¡¬ä»¶çœ‹é—¨ç‹—å¯èƒ½å¼ºåˆ¶åˆ‡æ–­ç”µæº ç”¨æˆ·é•¿æŒ‰ç”µæºé”®ä¹Ÿä¼šè§¦å‘å¼ºåˆ¶å…³æœº æ­¤æ—¶æœºå™¨å®Œå…¨æ–­ç”µï¼Œå…³æœºè¿‡ç¨‹ç»“æŸã€‚ä¸‹æ¬¡å¼€æœºå°†é‡æ–°å¼€å§‹å®Œæ•´çš„å¯åŠ¨å‘¨æœŸã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-6-shutdown-troubleshooting/:2:5","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus","Power Management","Hibernate","Suspend"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå…­ï¼‰ - ç³»ç»Ÿå…³æœºä¸ç”µæºç®¡ç†","uri":"/posts/linux-desktop-6-shutdown-troubleshooting/#15-ç¡¬ä»¶å…³æœº"},{"categories":["tech"],"content":" 1.6 å…³æœºæ•…éšœæ’æŸ¥å¸¸è§å…³æœºé—®é¢˜ä¸ä¼˜åŒ–ï¼š æœåŠ¡åœæ­¢è¶…æ—¶ï¼š bash # æŸ¥çœ‹è¶…æ—¶æœåŠ¡ journalctl -b -1 | grep -i \"timeout\" # æ£€æŸ¥ç‰¹å®šæœåŠ¡é…ç½® systemctl cat \u003cservice\u003e | grep Timeout æœåŠ¡åœæ­¢è¶…æ—¶ä¼˜åŒ–ï¼š TimeoutStopSec å‚æ•°æ§åˆ¶æœåŠ¡åœæ­¢çš„æœ€å¤§ç­‰å¾…æ—¶é—´ï¼Œé»˜è®¤å€¼ä¸º 90 ç§’ã€‚systemd åœ¨åœæ­¢æœåŠ¡æ—¶ä¼šç­‰å¾…æœåŠ¡è‡ªè¡Œé€€å‡ºï¼Œè¶…æ—¶åå¼ºåˆ¶ç»ˆæ­¢ã€‚å¯¹äºå¿«é€Ÿåœæ­¢çš„æœåŠ¡ï¼Œå¯ä»¥è®¾ç½®è¾ƒçŸ­çš„è¶…æ—¶æ—¶é—´ï¼ˆå¦‚ 10-30 ç§’ï¼‰ï¼Œ é…ç½®ç¤ºä¾‹ï¼šTimeoutStopSec=30s è®¾ç½® 30 ç§’è¶…æ—¶ã€‚ æœåŠ¡åœæ­¢ä¼˜åŒ–åŒ…æ‹¬ï¼šæœåŠ¡åº”è¯¥æ­£ç¡®å¤„ç† SIGTERM ä¿¡å·ï¼Œå®Œæˆå¿…è¦çš„æ¸…ç†å·¥ä½œï¼›é¿å…åœ¨åœæ­¢è¿‡ç¨‹ä¸­è¿›è¡Œè€—æ—¶çš„æ“ä½œï¼›ç¡®ä¿åŠæ—¶é‡Šæ”¾æ–‡ä»¶å¥æŸ„ã€ç½‘ç»œè¿æ¥ç­‰èµ„æºã€‚ æ–‡ä»¶ç³»ç»Ÿå¸è½½å¤±è´¥ï¼š bash # æŸ¥æ‰¾å ç”¨æ–‡ä»¶ç³»ç»Ÿçš„è¿›ç¨‹ lsof | grep \u003cmountpoint\u003e # æ£€æŸ¥æ–‡ä»¶ç³»ç»ŸçŠ¶æ€ fsck -n /dev/\u003cdevice\u003e æ–‡ä»¶ç³»ç»Ÿå¸è½½ä¼˜åŒ–ï¼š è¿›ç¨‹å ç”¨æ£€æŸ¥ä½¿ç”¨ lsof å‘½ä»¤æŸ¥æ‰¾ä»åœ¨ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿçš„è¿›ç¨‹ã€‚å¸¸è§åŸå› æ˜¯åº”ç”¨ç¨‹åºæœªæ­£ç¡®å…³é—­æ–‡ä»¶å¥æŸ„ï¼Œæˆ–è¿›ç¨‹ä»åœ¨è¿è¡Œã€‚è§£å†³æ–¹æ¡ˆæ˜¯å¼ºåˆ¶ç»ˆæ­¢å ç”¨è¿›ç¨‹ï¼Œæˆ–ç­‰å¾…è¿›ç¨‹è‡ªç„¶ç»“æŸã€‚ æ–‡ä»¶ç³»ç»ŸçŠ¶æ€æ£€æŸ¥åŒ…æ‹¬ï¼šä½¿ç”¨ fsck -n è¿›è¡Œåªè¯»æ£€æŸ¥ï¼Œä¸ä¿®å¤æ–‡ä»¶ç³»ç»Ÿï¼›æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿæ˜¯å¦æ­£ç¡®æŒ‚è½½ï¼Œæ˜¯å¦æœ‰é”™è¯¯æ ‡è®°ï¼›å®šæœŸè¿›è¡Œæ–‡ä»¶ç³»ç»Ÿæ£€æŸ¥ï¼ŒåŠæ—¶å‘ç°å’Œä¿®å¤é—®é¢˜ã€‚ è®¾å¤‡ç¹å¿™ï¼š bash # æ£€æŸ¥è®¾å¤‡å ç”¨ lsof | grep /dev/\u003cdevice\u003e # æŸ¥çœ‹å—è®¾å¤‡çŠ¶æ€ lsblk -f è®¾å¤‡å ç”¨ä¼˜åŒ–ï¼š è®¾å¤‡å ç”¨åˆ†ææ£€æŸ¥å“ªäº›è¿›ç¨‹ä»åœ¨ä½¿ç”¨è®¾å¤‡æ–‡ä»¶ã€‚å¸¸è§è®¾å¤‡åŒ…æ‹¬ USB è®¾å¤‡ã€å¤–éƒ¨å­˜å‚¨ã€ç½‘ç»œè®¾å¤‡ç­‰ã€‚è§£å†³æ–¹æ¡ˆæ˜¯ç¡®ä¿åº”ç”¨ç¨‹åºæ­£ç¡®å…³é—­è®¾å¤‡ï¼Œæˆ–å¼ºåˆ¶å¸è½½è®¾å¤‡ã€‚ å—è®¾å¤‡çŠ¶æ€æ£€æŸ¥åŒ…æ‹¬ï¼šä½¿ç”¨ lsblk æŸ¥çœ‹è®¾å¤‡æŒ‚è½½çŠ¶æ€å’Œæ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼›æ£€æŸ¥è®¾å¤‡æ˜¯å¦å¤„äºå¿™ç¢ŒçŠ¶æ€ï¼› åœ¨å…³æœºå‰ç¡®ä¿æ‰€æœ‰å¤–éƒ¨è®¾å¤‡å·²å®‰å…¨ç§»é™¤ã€‚ å¼ºåˆ¶å…³æœºå¤„ç†ä¸ä¼˜åŒ–ï¼š å½“æ­£å¸¸å…³æœºå¤±è´¥æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š bash # å®‰å…¨å¼ºåˆ¶å…³æœº systemctl poweroff -f # ç´§æ€¥å…³æœºï¼ˆç«‹å³æ‰§è¡Œï¼‰ systemctl poweroff -ff # å†…æ ¸å¼ºåˆ¶é‡å¯ echo b \u003e /proc/sysrq-trigger # å†…æ ¸å¼ºåˆ¶å…³æœº echo o \u003e /proc/sysrq-trigger å¼ºåˆ¶å…³æœºæ–¹æ³•ï¼š systemctl poweroff -f å¼ºåˆ¶å…³æœºï¼Œè·³è¿‡æŸäº›æ£€æŸ¥å’ŒæœåŠ¡åœæ­¢ã€‚å¼ºåˆ¶ç»ˆæ­¢æ‰€æœ‰è¿›ç¨‹ï¼Œç›´æ¥è¿›å…¥å…³æœºæµç¨‹ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œåº”è°¨æ…ä½¿ç”¨ï¼Œé€‚ç”¨äºç³»ç»Ÿå“åº”ç¼“æ…¢ä½†ä»æœ‰åŸºæœ¬åŠŸèƒ½æ—¶ã€‚ systemctl poweroff -ff ç´§æ€¥å…³æœºï¼Œç«‹å³æ‰§è¡Œï¼Œä¸ç­‰å¾…ä»»ä½•æ“ä½œå®Œæˆã€‚ç«‹å³ç»ˆæ­¢æ‰€æœ‰è¿›ç¨‹ï¼Œå¼ºåˆ¶å…³æœºï¼Œé«˜æ•°æ®ä¸¢å¤±é£é™©ï¼Œä»…åœ¨ç´§æ€¥æƒ…å†µä¸‹ä½¿ç”¨ï¼Œé€‚ç”¨äºç³»ç»Ÿå®Œå…¨æ— å“åº”ï¼Œéœ€è¦ç«‹å³å…³æœºã€‚ echo b \u003e /proc/sysrq-trigger å†…æ ¸çº§åˆ«çš„å¼ºåˆ¶é‡å¯ã€‚ç›´æ¥è°ƒç”¨å†…æ ¸é‡å¯åŠŸèƒ½ï¼Œç»•è¿‡ç”¨æˆ·ç©ºé—´ï¼Œå³ä½¿ç³»ç»Ÿå®Œå…¨æ— å“åº”ä¹Ÿèƒ½æ‰§è¡Œï¼Œé€‚ç”¨äºç³»ç»Ÿå®Œå…¨å¡æ­»ï¼Œæ— æ³•å“åº”ç”¨æˆ·å‘½ä»¤ã€‚ echo o \u003e /proc/sysrq-trigger å†…æ ¸çº§åˆ«çš„å¼ºåˆ¶å…³æœºã€‚ç›´æ¥è°ƒç”¨å†…æ ¸å…³æœºåŠŸèƒ½ï¼Œç«‹å³æ–­ç”µï¼Œæœ€é«˜æ•°æ®ä¸¢å¤±é£é™©ï¼Œé€‚ç”¨äºæç«¯ç´§æ€¥æƒ…å†µï¼Œéœ€è¦ç«‹å³æ–­ç”µã€‚ å…³æœºä¼˜åŒ–æœ€ä½³å®è·µï¼š é¢„é˜²æªæ–½ï¼šå®šæœŸæ£€æŸ¥æœåŠ¡é…ç½®ï¼Œç¡®ä¿æœåŠ¡èƒ½æ­£å¸¸åœæ­¢ï¼›ç›‘æ§æ–‡ä»¶ç³»ç»ŸçŠ¶æ€ï¼ŒåŠæ—¶å¤„ç†é—®é¢˜ï¼›é¿å…åœ¨å…³æœºå‰è¿›è¡Œå¤§é‡ I/O æ“ä½œã€‚ ä¼˜é›…å…³æœºï¼šä¼˜å…ˆä½¿ç”¨æ­£å¸¸çš„å…³æœºå‘½ä»¤ï¼›ç»™ç³»ç»Ÿè¶³å¤Ÿæ—¶é—´å®Œæˆæ¸…ç†å·¥ä½œï¼›é¿å…é¢‘ç¹ä½¿ç”¨å¼ºåˆ¶å…³æœºã€‚ æ•…éšœé¢„é˜²ï¼šå®šæœŸæ›´æ–°ç³»ç»Ÿå’Œé©±åŠ¨ï¼›ç›‘æ§ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µï¼›åŠæ—¶å¤„ç†ç³»ç»Ÿè­¦å‘Šå’Œé”™è¯¯ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-6-shutdown-troubleshooting/:2:6","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus","Power Management","Hibernate","Suspend"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå…­ï¼‰ - ç³»ç»Ÿå…³æœºä¸ç”µæºç®¡ç†","uri":"/posts/linux-desktop-6-shutdown-troubleshooting/#16-å…³æœºæ•…éšœæ’æŸ¥"},{"categories":["tech"],"content":" ç³»ç»Ÿä¼‘çœ ä¸æŒ‚èµ·é™¤äº†å…³æœºï¼ŒLinux è¿˜æä¾›äº†ä¸¤ç§é‡è¦çš„ç”µæºç®¡ç†åŠŸèƒ½ï¼šä¼‘çœ ï¼ˆHibernateï¼‰å’ŒæŒ‚èµ· ï¼ˆSuspendï¼‰ã€‚è¿™ä¸¤ç§åŠŸèƒ½å¯ä»¥è®©ç³»ç»Ÿå¿«é€Ÿè¿›å…¥ä½åŠŸè€—çŠ¶æ€ï¼ŒåŒæ—¶ä¿æŒå·¥ä½œçŠ¶æ€ï¼Œæ˜¯æ—¥å¸¸ä½¿ç”¨ä¸­éå¸¸å®ç”¨çš„åŠŸèƒ½ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-6-shutdown-troubleshooting/:3:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus","Power Management","Hibernate","Suspend"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå…­ï¼‰ - ç³»ç»Ÿå…³æœºä¸ç”µæºç®¡ç†","uri":"/posts/linux-desktop-6-shutdown-troubleshooting/#ç³»ç»Ÿä¼‘çœ ä¸æŒ‚èµ·"},{"categories":["tech"],"content":" 3.1 ä¼‘çœ ï¼ˆHibernateï¼‰åŠŸèƒ½ä¼‘çœ æ˜¯å°†ç³»ç»Ÿå†…å­˜ä¸­çš„æ‰€æœ‰æ•°æ®ä¿å­˜åˆ°ç£ç›˜ï¼ˆé€šå¸¸æ˜¯äº¤æ¢åˆ†åŒºæˆ–äº¤æ¢æ–‡ä»¶ï¼‰ï¼Œç„¶åå®Œå…¨å…³é—­ç”µæºã€‚å½“ç³»ç»Ÿä»ä¼‘çœ ä¸­æ¢å¤æ—¶ï¼Œä¼šä»ç£ç›˜è¯»å–ä¿å­˜çš„æ•°æ®ï¼Œæ¢å¤åˆ°ä¼‘çœ å‰çš„çŠ¶æ€ã€‚ ä¼‘çœ çš„å·¥ä½œåŸç†ï¼š å†…å­˜æ•°æ®ä¿å­˜ï¼šå°† RAM ä¸­çš„æ‰€æœ‰æ•°æ®å†™å…¥åˆ°äº¤æ¢åˆ†åŒºæˆ–ä¸“é—¨çš„ä¼‘çœ æ–‡ä»¶ ç³»ç»ŸçŠ¶æ€ä¿å­˜ï¼šä¿å­˜ CPU çŠ¶æ€ã€è®¾å¤‡çŠ¶æ€ã€ç½‘ç»œè¿æ¥ç­‰ å®Œå…¨æ–­ç”µï¼šç³»ç»Ÿå®Œå…¨å…³é—­ï¼Œæ‰€æœ‰ç¡¬ä»¶æ–­ç”µ å¿«é€Ÿæ¢å¤ï¼šå¼€æœºæ—¶ç›´æ¥ä»ç£ç›˜æ¢å¤å†…å­˜çŠ¶æ€ï¼Œè·³è¿‡æ­£å¸¸å¯åŠ¨è¿‡ç¨‹ ä¼‘çœ é…ç½®ï¼š bash # æ£€æŸ¥å½“å‰ä¼‘çœ é…ç½® cat /sys/power/state cat /sys/power/disk # æ£€æŸ¥äº¤æ¢åˆ†åŒºå¤§å°ï¼ˆéœ€è¦è¶³å¤Ÿå®¹çº³å†…å­˜æ•°æ®ï¼‰ swapon --show free -h # æ£€æŸ¥ä¼‘çœ æ–‡ä»¶ï¼ˆå¦‚æœä½¿ç”¨æ–‡ä»¶è€Œéäº¤æ¢åˆ†åŒºï¼‰ ls -lh /swapfile å¯ç”¨ä¼‘çœ åŠŸèƒ½ï¼š bash # æ–¹æ³•ä¸€ï¼šä½¿ç”¨äº¤æ¢åˆ†åŒº # 1. ç¡®ä¿æœ‰è¶³å¤Ÿå¤§çš„äº¤æ¢åˆ†åŒºï¼ˆå»ºè®®ä¸ºå†…å­˜å¤§å°çš„ 1.5-2 å€ï¼‰ sudo swapon --show # 2. è·å–äº¤æ¢åˆ†åŒºçš„ UUID sudo blkid | grep swap # 3. æ›´æ–° GRUB é…ç½® sudo nano /etc/default/grub # æ·»åŠ ï¼šGRUB_CMDLINE_LINUX_DEFAULT=\"resume=UUID=your-swap-uuid\" # 4. æ›´æ–° GRUB é…ç½® sudo update-grub # 5. é‡æ–°ç”Ÿæˆ initramfs sudo update-initramfs -u # æ–¹æ³•äºŒï¼šä½¿ç”¨äº¤æ¢æ–‡ä»¶ # 1. åˆ›å»ºäº¤æ¢æ–‡ä»¶ï¼ˆå¤§å°å»ºè®®ä¸ºå†…å­˜çš„ 1.5-2 å€ï¼‰ sudo fallocate -l 8G /swapfile sudo chmod 600 /swapfile sudo mkswap /swapfile sudo swapon /swapfile # 2. æ°¸ä¹…æŒ‚è½½äº¤æ¢æ–‡ä»¶ echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab # 3. é…ç½®ä¼‘çœ åˆ°äº¤æ¢æ–‡ä»¶ echo 'RESUME=UUID=$(findmnt -no UUID -T /swapfile)' | sudo tee /etc/initramfs-tools/conf.d/resume sudo update-initramfs -u ä¼‘çœ æ•…éšœæ’æŸ¥ï¼š bash # æ£€æŸ¥ä¼‘çœ æ”¯æŒ cat /sys/power/state | grep disk # æ£€æŸ¥ä¼‘çœ ç›®æ ‡ cat /sys/power/disk # æµ‹è¯•ä¼‘çœ åŠŸèƒ½ sudo systemctl hibernate # æŸ¥çœ‹ä¼‘çœ æ—¥å¿— journalctl -b | grep -i hibernate dmesg | grep -i hibernate # æ£€æŸ¥äº¤æ¢ç©ºé—´ä½¿ç”¨æƒ…å†µ swapon --show free -h å¸¸è§ä¼‘çœ é—®é¢˜ï¼š äº¤æ¢ç©ºé—´ä¸è¶³ï¼š é—®é¢˜ï¼šäº¤æ¢åˆ†åŒºæˆ–æ–‡ä»¶å¤ªå°ï¼Œæ— æ³•å®¹çº³å†…å­˜æ•°æ® è§£å†³ï¼šå¢åŠ äº¤æ¢ç©ºé—´å¤§å°ï¼Œå»ºè®®ä¸ºå†…å­˜çš„ 1.5-2 å€ ä¼‘çœ æ–‡ä»¶æŸåï¼š é—®é¢˜ï¼šä¼‘çœ æ–‡ä»¶æŸåå¯¼è‡´æ¢å¤å¤±è´¥ è§£å†³ï¼šåˆ é™¤æŸåçš„ä¼‘çœ æ–‡ä»¶ï¼Œé‡æ–°åˆ›å»º ç¡¬ä»¶ä¸æ”¯æŒï¼š é—®é¢˜ï¼šæŸäº›ç¡¬ä»¶ä¸æ”¯æŒä¼‘çœ åŠŸèƒ½ è§£å†³ï¼šæ£€æŸ¥ BIOS/UEFI è®¾ç½®ï¼Œæ›´æ–°å›ºä»¶ ","date":"2025-10-19","objectID":"/posts/linux-desktop-6-shutdown-troubleshooting/:3:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus","Power Management","Hibernate","Suspend"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå…­ï¼‰ - ç³»ç»Ÿå…³æœºä¸ç”µæºç®¡ç†","uri":"/posts/linux-desktop-6-shutdown-troubleshooting/#31-ä¼‘çœ hibernateåŠŸèƒ½"},{"categories":["tech"],"content":" 3.2 æŒ‚èµ·ï¼ˆSuspendï¼‰åŠŸèƒ½æŒ‚èµ·æ˜¯å°†ç³»ç»Ÿè¿›å…¥ä½åŠŸè€—çŠ¶æ€ï¼Œä¿æŒå†…å­˜ä¾›ç”µï¼ŒCPU å’Œå¤§éƒ¨åˆ†ç¡¬ä»¶æ–­ç”µã€‚ç³»ç»Ÿå¯ä»¥å¿«é€Ÿæ¢å¤åˆ°æŒ‚èµ·å‰çš„çŠ¶æ€ï¼Œä½†éœ€è¦æŒç»­ä¾›ç”µã€‚ æŒ‚èµ·çš„å·¥ä½œåŸç†ï¼š å†…å­˜ä¿æŒä¾›ç”µï¼šRAM ç»§ç»­ä¾›ç”µï¼Œä¿æŒæ•°æ®ä¸ä¸¢å¤± CPU è¿›å…¥ç¡çœ çŠ¶æ€ï¼šCPU è¿›å…¥æ·±åº¦ç¡çœ ï¼ŒåŠŸè€—æä½ å¤–è®¾æ–­ç”µï¼šç¡¬ç›˜ã€USB è®¾å¤‡ã€ç½‘ç»œè®¾å¤‡ç­‰æ–­ç”µ å¿«é€Ÿå”¤é†’ï¼šé€šè¿‡é”®ç›˜ã€é¼ æ ‡ã€ç½‘ç»œå”¤é†’ç­‰å¿«é€Ÿæ¢å¤ æŒ‚èµ·ç±»å‹ï¼š S1ï¼ˆPower On Suspendï¼‰ï¼šCPU åœæ­¢æ‰§è¡Œï¼Œä½†ä¿æŒä¾›ç”µ S2ï¼ˆCPU Offï¼‰ï¼šCPU æ–­ç”µï¼Œä½†ä¿æŒç¼“å­˜ S3ï¼ˆSuspend to RAMï¼‰ï¼šCPU å’Œç¼“å­˜æ–­ç”µï¼Œä»…å†…å­˜ä¾›ç”µ S4ï¼ˆSuspend to Diskï¼‰ï¼šç­‰åŒäºä¼‘çœ  æŒ‚èµ·é…ç½®ï¼š bash # æ£€æŸ¥æ”¯æŒçš„æŒ‚èµ·çŠ¶æ€ cat /sys/power/state # æ£€æŸ¥å½“å‰æŒ‚èµ·æ¨¡å¼ cat /sys/power/mem_sleep # è®¾ç½®æŒ‚èµ·æ¨¡å¼ï¼ˆdeep ä¸º S3ï¼Œs2idle ä¸º S2ï¼‰ echo deep | sudo tee /sys/power/mem_sleep # æ°¸ä¹…è®¾ç½®æŒ‚èµ·æ¨¡å¼ echo 'mem_sleep_default=deep' | sudo tee -a /etc/default/grub sudo update-grub æŒ‚èµ·æ•…éšœæ’æŸ¥ï¼š bash # æµ‹è¯•æŒ‚èµ·åŠŸèƒ½ sudo systemctl suspend # æŸ¥çœ‹æŒ‚èµ·æ—¥å¿— journalctl -b | grep -i suspend dmesg | grep -i suspend # æ£€æŸ¥æŒ‚èµ·ç›¸å…³æœåŠ¡ systemctl status systemd-suspend systemctl status systemd-hibernate # æ£€æŸ¥æŒ‚èµ·é’©å­è„šæœ¬ ls -la /usr/lib/systemd/system-sleep/ å¸¸è§æŒ‚èµ·é—®é¢˜ï¼š æŒ‚èµ·åæ— æ³•å”¤é†’ï¼š é—®é¢˜ï¼šç³»ç»ŸæŒ‚èµ·åæ— æ³•é€šè¿‡é”®ç›˜ã€é¼ æ ‡å”¤é†’ è§£å†³ï¼šæ£€æŸ¥ BIOS è®¾ç½®ï¼Œå¯ç”¨ USB å”¤é†’åŠŸèƒ½ æŒ‚èµ·åç³»ç»Ÿé‡å¯ï¼š é—®é¢˜ï¼šæŒ‚èµ·åç³»ç»Ÿè‡ªåŠ¨é‡å¯è€Œä¸æ˜¯æ¢å¤ è§£å†³ï¼šæ£€æŸ¥ç¡¬ä»¶å…¼å®¹æ€§ï¼Œæ›´æ–°é©±åŠ¨ æŒ‚èµ·åŠŸè€—è¿‡é«˜ï¼š é—®é¢˜ï¼šæŒ‚èµ·çŠ¶æ€ä¸‹åŠŸè€—ä»ç„¶å¾ˆé«˜ è§£å†³ï¼šæ£€æŸ¥å¤–è®¾ç”µæºç®¡ç†ï¼Œç¦ç”¨ä¸å¿…è¦çš„è®¾å¤‡ ","date":"2025-10-19","objectID":"/posts/linux-desktop-6-shutdown-troubleshooting/:3:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus","Power Management","Hibernate","Suspend"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå…­ï¼‰ - ç³»ç»Ÿå…³æœºä¸ç”µæºç®¡ç†","uri":"/posts/linux-desktop-6-shutdown-troubleshooting/#32-æŒ‚èµ·suspendåŠŸèƒ½"},{"categories":["tech"],"content":" 3.3 ç”µæºç®¡ç†æ¨¡å¼å¯¹æ¯” æ¨¡å¼ åŠŸè€— æ¢å¤æ—¶é—´ æ•°æ®ä¿æŒ é€‚ç”¨åœºæ™¯ å…³æœº 0W 30-60ç§’ ä¸ä¿æŒ é•¿æ—¶é—´ä¸ä½¿ç”¨ ä¼‘çœ  0W 10-30ç§’ å®Œå…¨ä¿æŒ é•¿æ—¶é—´ä¸ä½¿ç”¨ï¼Œéœ€è¦å¿«é€Ÿæ¢å¤ æŒ‚èµ· 1-5W 1-3ç§’ å®Œå…¨ä¿æŒ çŸ­æ—¶é—´ä¸ä½¿ç”¨ï¼Œéœ€è¦å¿«é€Ÿæ¢å¤ é€‰æ‹©å»ºè®®ï¼š çŸ­æ—¶é—´ç¦»å¼€ï¼ˆå‡ åˆ†é’Ÿåˆ°å‡ å°æ—¶ï¼‰ï¼šä½¿ç”¨æŒ‚èµ· é•¿æ—¶é—´ç¦»å¼€ï¼ˆå‡ å°æ—¶åˆ°å‡ å¤©ï¼‰ï¼šä½¿ç”¨ä¼‘çœ  é•¿æœŸä¸ä½¿ç”¨ï¼ˆå‡ å¤©ä»¥ä¸Šï¼‰ï¼šä½¿ç”¨å…³æœº æ··åˆä½¿ç”¨ç­–ç•¥ï¼š bash # è®¾ç½®è‡ªåŠ¨æŒ‚èµ·ï¼ˆå½“ç³»ç»Ÿç©ºé—²æ—¶ï¼‰ sudo systemctl enable systemd-suspend.timer # è®¾ç½®å®šæ—¶ä¼‘çœ ï¼ˆå¤œé—´è‡ªåŠ¨ä¼‘çœ ï¼‰ sudo systemctl edit systemd-hibernate.timer # æ·»åŠ ï¼š [Timer] OnCalendar=*-*-* 02:00:00 Persistent=true åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œå¤§å¤šæ•°ç”¨æˆ·é€šè¿‡æ¡Œé¢ç¯å¢ƒçš„è®¾ç½®ç•Œé¢æ¥é…ç½®ç”µæºç®¡ç†åŠŸèƒ½ã€‚GNOMEã€KDE Plasmaã€XFCE ç­‰æ¡Œé¢ç¯å¢ƒéƒ½æä¾›äº†å›¾å½¢åŒ–çš„ç”µæºç®¡ç†è®¾ç½®ï¼Œå¯ä»¥æ–¹ä¾¿åœ°é…ç½®è‡ªåŠ¨æŒ‚èµ·å’Œä¼‘çœ æ—¶é—´ã€‚ å¯¹äºä½¿ç”¨ Wayland åˆæˆå™¨ï¼ˆå¦‚ Swayã€Hyprlandï¼‰çš„ç”¨æˆ·ï¼Œé€šå¸¸ä½¿ç”¨ä¸“é—¨çš„ idle å®ˆæŠ¤è¿›ç¨‹æ¥ç®¡ç†ç”µæºçŠ¶æ€ã€‚swayidleã€hypridle ç­‰å·¥å…·å¯ä»¥é…ç½®ç³»ç»Ÿåœ¨ç©ºé—²æ—¶è‡ªåŠ¨é”å±ã€å…³é—­æ˜¾ç¤ºå™¨æˆ–è¿›å…¥æŒ‚èµ·çŠ¶æ€ã€‚ ç”µæºç®¡ç†ä¼˜åŒ–ï¼š bash # æ£€æŸ¥ç”µæºç®¡ç†é…ç½® cat /sys/power/pm_async cat /sys/power/pm_freeze_timeout # ä¼˜åŒ–æŒ‚èµ·å»¶è¿Ÿ echo 5000 | sudo tee /sys/power/pm_freeze_timeout # æ£€æŸ¥è®¾å¤‡ç”µæºç®¡ç† ls /sys/bus/usb/devices/*/power/ cat /sys/bus/usb/devices/*/power/control é€šè¿‡åˆç†é…ç½®å’Œä½¿ç”¨ä¼‘çœ ã€æŒ‚èµ·åŠŸèƒ½ï¼Œå¯ä»¥æ˜¾è‘—æé«˜ Linux æ¡Œé¢ç³»ç»Ÿçš„ä½¿ç”¨ä½“éªŒï¼Œæ—¢èŠ‚çœç”µåŠ›åˆä¿æŒå·¥ä½œçŠ¶æ€çš„è¿ç»­æ€§ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-6-shutdown-troubleshooting/:3:3","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus","Power Management","Hibernate","Suspend"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå…­ï¼‰ - ç³»ç»Ÿå…³æœºä¸ç”µæºç®¡ç†","uri":"/posts/linux-desktop-6-shutdown-troubleshooting/#33-ç”µæºç®¡ç†æ¨¡å¼å¯¹æ¯”"},{"categories":["tech"],"content":" å®æˆ˜æ¡ˆä¾‹ï¼šç»¼åˆæ•…éšœæ’æŸ¥åœ¨å®é™…ä½¿ç”¨ Linux æ¡Œé¢ç³»ç»Ÿæ—¶ï¼Œå¾€å¾€ä¼šé‡åˆ°å¤šå±‚æ¬¡ã€å¤šç»„ä»¶äº¤ç»‡çš„æ•…éšœã€‚é€šè¿‡ç³»ç»ŸåŒ–çš„æ’æŸ¥æ–¹æ³•ï¼Œå¯ä»¥å¿«é€Ÿå®šä½é—®é¢˜å¹¶åˆ¶å®šè§£å†³æ–¹æ¡ˆã€‚æœ¬ç« é€šè¿‡å‡ ä¸ªå…¸å‹æ¡ˆä¾‹ï¼Œè®²è§£å¦‚ä½•ç»¼åˆä½¿ç”¨æ—¥å¿—ã€è°ƒè¯•å·¥å…·å’Œç³»ç»Ÿå‘½ä»¤è¿›è¡Œæ•…éšœæ’æŸ¥ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-6-shutdown-troubleshooting/:4:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus","Power Management","Hibernate","Suspend"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå…­ï¼‰ - ç³»ç»Ÿå…³æœºä¸ç”µæºç®¡ç†","uri":"/posts/linux-desktop-6-shutdown-troubleshooting/#å®æˆ˜æ¡ˆä¾‹ç»¼åˆæ•…éšœæ’æŸ¥"},{"categories":["tech"],"content":" 2.1 æ¡ˆä¾‹ä¸€ï¼šæ¡Œé¢ç¯å¢ƒæ— æ³•å¯åŠ¨ç°è±¡ï¼šç”¨æˆ·ç™»å½•åï¼Œå±å¹•é—ªçƒåå›åˆ°ç™»å½•ç•Œé¢ï¼Œæ¡Œé¢æ— æ³•æ˜¾ç¤ºã€‚ æ’æŸ¥æ­¥éª¤ï¼š æ£€æŸ¥æ˜¾ç¤ºç®¡ç†å™¨çŠ¶æ€ï¼š bash systemctl status display-manager journalctl -u display-manager -b ç¡®è®¤ç”¨æˆ·ä¼šè¯ï¼š bash loginctl list-sessions loginctl show-session \u003csession_id\u003e æ£€æŸ¥åˆæˆå™¨æ—¥å¿—ï¼ˆWayland ç¤ºä¾‹ï¼‰ï¼š bash journalctl --user -u sway -f export WAYLAND_DEBUG=1 æ£€æŸ¥ GPU é©±åŠ¨çŠ¶æ€ï¼š bash lspci -k | grep -A 3 -i vga dmesg | grep -i drm å¸¸è§åŸå› ï¼š é©±åŠ¨ä¸åŒ¹é…æˆ–æœªåŠ è½½ åˆæˆå™¨å¯åŠ¨å¤±è´¥ ç”¨æˆ·ç¯å¢ƒå˜é‡è®¾ç½®é”™è¯¯ è§£å†³æ–¹æ³•ï¼š æ›´æ–°æˆ–åˆ‡æ¢ GPU é©±åŠ¨ ä½¿ç”¨é»˜è®¤é…ç½®å¯åŠ¨åˆæˆå™¨ æ£€æŸ¥ $XDG_RUNTIME_DIR å’Œ $WAYLAND_DISPLAY æ˜¯å¦æ­£ç¡® ","date":"2025-10-19","objectID":"/posts/linux-desktop-6-shutdown-troubleshooting/:4:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus","Power Management","Hibernate","Suspend"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå…­ï¼‰ - ç³»ç»Ÿå…³æœºä¸ç”µæºç®¡ç†","uri":"/posts/linux-desktop-6-shutdown-troubleshooting/#21-æ¡ˆä¾‹ä¸€æ¡Œé¢ç¯å¢ƒæ— æ³•å¯åŠ¨"},{"categories":["tech"],"content":" 2.2 æ¡ˆä¾‹äºŒï¼šåº”ç”¨ç¨‹åºå´©æºƒæˆ–æ— å“åº”ç°è±¡ï¼šæŸäº›åº”ç”¨ç¨‹åºå¯åŠ¨åç«‹å³å´©æºƒï¼Œæˆ–è¿è¡Œä¸­æ— å“åº”ã€‚ æ’æŸ¥æ­¥éª¤ï¼š æŸ¥çœ‹ç”¨æˆ·æœåŠ¡æ—¥å¿—ï¼š bash journalctl --user -b -u \u003capplication\u003e.service å¯ç”¨åº”ç”¨è°ƒè¯•ä¿¡æ¯ï¼š bash export GDK_DEBUG=all # GTK åº”ç”¨ export QT_LOGGING_RULES=\"qt.qpa.*=true\" # Qt åº”ç”¨ export WAYLAND_DEBUG=1 åˆ†ææ ¸å¿ƒè½¬å‚¨ï¼š bash coredumpctl list coredumpctl info \u003cpid\u003e coredumpctl debug \u003cpid\u003e æ£€æŸ¥ä¾èµ–åº“ç‰ˆæœ¬ï¼š bash ldd $(which \u003capplication\u003e) å¸¸è§åŸå› ï¼š ç¼ºå°‘æˆ–ç‰ˆæœ¬ä¸åŒ¹é…çš„åº“ Wayland/Xwayland æ”¯æŒä¸å®Œæ•´ GPU é©±åŠ¨å¼‚å¸¸ è§£å†³æ–¹æ³•ï¼š å®‰è£…æˆ–å‡çº§ä¾èµ–åº“ å¼ºåˆ¶åº”ç”¨ä½¿ç”¨ X11 æˆ– Wayland åç«¯ æ£€æŸ¥é©±åŠ¨æ›´æ–°æˆ–ä½¿ç”¨å›æ»šç‰ˆæœ¬ ","date":"2025-10-19","objectID":"/posts/linux-desktop-6-shutdown-troubleshooting/:4:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus","Power Management","Hibernate","Suspend"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå…­ï¼‰ - ç³»ç»Ÿå…³æœºä¸ç”µæºç®¡ç†","uri":"/posts/linux-desktop-6-shutdown-troubleshooting/#22-æ¡ˆä¾‹äºŒåº”ç”¨ç¨‹åºå´©æºƒæˆ–æ— å“åº”"},{"categories":["tech"],"content":" 2.3 æ¡ˆä¾‹ä¸‰ï¼šç³»ç»Ÿå…³æœºæˆ–é‡å¯å¼‚å¸¸ç°è±¡ï¼šç³»ç»Ÿå…³æœºå¡ä½ï¼ŒæœåŠ¡åœæ­¢è¶…æ—¶ï¼Œæœ€ç»ˆéœ€è¦å¼ºåˆ¶å…³æœºã€‚ æ’æŸ¥æ­¥éª¤ï¼š æŸ¥çœ‹å…³æœºæ—¥å¿—ï¼š bash journalctl -b -1 -e systemd-analyze blame shutdown.target æ£€æŸ¥æœåŠ¡åœæ­¢çŠ¶æ€ï¼š bash systemctl list-units --state=deactivating journalctl -b -1 | grep -E \"(Stopping|Stopped)\" æ–‡ä»¶ç³»ç»ŸçŠ¶æ€ï¼š bash mount | grep -v \"on / type\" lsof | grep \u003cmountpoint\u003e ç¡¬ä»¶è®¾å¤‡çŠ¶æ€ï¼š bash lsblk -f dmesg | grep -i \"error\\|fail\\|timeout\" å¸¸è§åŸå› ï¼š æŸäº›æœåŠ¡æˆ–è¿›ç¨‹æœªèƒ½åŠæ—¶åœæ­¢ æ–‡ä»¶ç³»ç»Ÿè¢«å ç”¨æˆ–æŸå è®¾å¤‡é©±åŠ¨å¼‚å¸¸å¯¼è‡´æ— æ³•å¸è½½ è§£å†³æ–¹æ³•ï¼š å¼ºåˆ¶åœæ­¢é¡½å›ºæœåŠ¡ï¼š bash systemctl stop \u003cservice\u003e -i æ£€æŸ¥å¹¶ä¿®å¤æ–‡ä»¶ç³»ç»Ÿï¼š bash fsck -n /dev/\u003cdevice\u003e ä¸´æ—¶ä½¿ç”¨å¼ºåˆ¶å…³æœºï¼š bash systemctl poweroff -ff ","date":"2025-10-19","objectID":"/posts/linux-desktop-6-shutdown-troubleshooting/:4:3","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus","Power Management","Hibernate","Suspend"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå…­ï¼‰ - ç³»ç»Ÿå…³æœºä¸ç”µæºç®¡ç†","uri":"/posts/linux-desktop-6-shutdown-troubleshooting/#23-æ¡ˆä¾‹ä¸‰ç³»ç»Ÿå…³æœºæˆ–é‡å¯å¼‚å¸¸"},{"categories":["tech"],"content":" 2.4 æ¡ˆä¾‹å››ï¼šç½‘ç»œå¼‚å¸¸å¯¼è‡´åº”ç”¨æ— æ³•è®¿é—®ç°è±¡ï¼šåº”ç”¨å¯åŠ¨æ­£å¸¸ï¼Œä½†æ— æ³•è¿æ¥ç½‘ç»œèµ„æºã€‚ æ’æŸ¥æ­¥éª¤ï¼š æ£€æŸ¥ç½‘ç»œæ¥å£å’ŒçŠ¶æ€ï¼š bash ip addr ip route nmcli device status æµ‹è¯• DNS å’Œè¿é€šæ€§ï¼š bash ping 8.8.8.8 dig www.example.com æŸ¥çœ‹ç½‘ç»œæœåŠ¡æ—¥å¿—ï¼š bash journalctl -u NetworkManager -b æ£€æŸ¥é˜²ç«å¢™å’Œæƒé™ï¼š bash sudo iptables -L -v -n sudo nft list ruleset å¸¸è§åŸå› ï¼š DHCP æˆ–é™æ€ IP é…ç½®é”™è¯¯ DNS é…ç½®å¼‚å¸¸ é˜²ç«å¢™é˜»å¡è®¿é—® è§£å†³æ–¹æ³•ï¼š ä¿®å¤ç½‘ç»œé…ç½® æ£€æŸ¥é˜²ç«å¢™è§„åˆ™ é‡å¯ç½‘ç»œæœåŠ¡ ","date":"2025-10-19","objectID":"/posts/linux-desktop-6-shutdown-troubleshooting/:4:4","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus","Power Management","Hibernate","Suspend"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå…­ï¼‰ - ç³»ç»Ÿå…³æœºä¸ç”µæºç®¡ç†","uri":"/posts/linux-desktop-6-shutdown-troubleshooting/#24-æ¡ˆä¾‹å››ç½‘ç»œå¼‚å¸¸å¯¼è‡´åº”ç”¨æ— æ³•è®¿é—®"},{"categories":["tech"],"content":" 2.5 ç»¼åˆæ’æŸ¥æ–¹æ³•é¢å¯¹å¤æ‚é—®é¢˜ï¼Œå•é ç»éªŒå¯èƒ½éš¾ä»¥å®šä½æ•…éšœï¼Œæ¨èéµå¾ªä»¥ä¸‹æ–¹æ³•ï¼š æ—¥å¿—ä¸ºå…ˆï¼šç³»ç»Ÿæ—¥å¿—ã€ç”¨æˆ·æœåŠ¡æ—¥å¿—ã€åº”ç”¨æ—¥å¿—æ˜¯æœ€ç›´æ¥çš„çº¿ç´¢ é€å±‚æ’æŸ¥ï¼šä»ç¡¬ä»¶ â†’ é©±åŠ¨ â†’ ç³»ç»ŸæœåŠ¡ â†’ ç”¨æˆ·ä¼šè¯ â†’ åº”ç”¨ æœ€å°å¤ç°ï¼šå…³é—­éå¿…è¦æœåŠ¡å’Œåº”ç”¨ï¼Œç®€åŒ–ç¯å¢ƒé‡ç°é—®é¢˜ å·¥å…·è¾…åŠ©ï¼šjournalctlã€straceã€coredumpctlã€lsofã€perf ç­‰ æ–‡æ¡£ä¸ç¤¾åŒºï¼šæŸ¥é˜…å®˜æ–¹æ–‡æ¡£å’Œç¤¾åŒºç»éªŒï¼Œå¿«é€Ÿå®šä½å¸¸è§æ•…éšœ é€šè¿‡ä¸Šè¿°æ–¹æ³•ï¼Œå¯ä»¥ç³»ç»ŸåŒ–åœ°åˆ†æå¹¶è§£å†³å¤§å¤šæ•° Linux æ¡Œé¢é—®é¢˜ï¼Œæé«˜ç³»ç»Ÿç¨³å®šæ€§å’Œç”¨æˆ·ä½“éªŒã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-6-shutdown-troubleshooting/:4:5","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus","Power Management","Hibernate","Suspend"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå…­ï¼‰ - ç³»ç»Ÿå…³æœºä¸ç”µæºç®¡ç†","uri":"/posts/linux-desktop-6-shutdown-troubleshooting/#25-ç»¼åˆæ’æŸ¥æ–¹æ³•"},{"categories":["tech"],"content":" æ€»ç»“è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†ã€ŠLinux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ã€‹ç³»åˆ—çš„å…¨éƒ¨å…­ç¯‡æ–‡ç« ã€‚é€šè¿‡è¿™ä¸ªç³»åˆ—ï¼Œæˆ‘ä»¬å…¨é¢äº†è§£äº† Linux æ¡Œé¢ç³»ç»Ÿçš„å„ä¸ªç»„ä»¶ï¼Œä»å¯åŠ¨å®‰å…¨åˆ°ç½‘ç»œé…ç½®ï¼Œä»å¤šåª’ä½“è¾“å…¥åˆ°ä¼šè¯ç®¡ç†ï¼Œä»ç³»ç»ŸæœåŠ¡åˆ°ç”µæºç®¡ç†ã€‚ Linux æ¡Œé¢ç³»ç»Ÿè™½ç„¶æœ‰æ—¶å€™ä¼šå‡ºå„ç§å¥‡æ€ªçš„é—®é¢˜ï¼Œä½†ç†è§£å…¶å·¥ä½œåŸç†åï¼Œå¤§éƒ¨åˆ†é—®é¢˜éƒ½èƒ½æ‰¾åˆ°è§£å†³æ€è·¯ã€‚å…³é”®æ˜¯è¦æœ‰è€å¿ƒï¼Œå¤šå®è·µï¼Œå¤šæ€»ç»“ã€‚ç‰¹åˆ«æ˜¯åœ¨ç”µæºç®¡ç†æ–¹é¢ï¼Œåˆç†ä½¿ç”¨å…³æœºã€ä¼‘çœ å’ŒæŒ‚èµ·åŠŸèƒ½ï¼Œå¯ä»¥æ˜¾è‘—æé«˜ç³»ç»Ÿçš„ä½¿ç”¨ä½“éªŒå’Œç”µåŠ›æ•ˆç‡ã€‚ è¿™ä¸ªç³»åˆ—åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œå¸Œæœ›è¿™äº›å†…å®¹èƒ½å¸®åŠ©ä½ åœ¨ Linux æ¡Œé¢çš„é“è·¯ä¸Šèµ°å¾—æ›´é¡ºç•…ä¸€äº›ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-6-shutdown-troubleshooting/:5:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus","Power Management","Hibernate","Suspend"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå…­ï¼‰ - ç³»ç»Ÿå…³æœºä¸ç”µæºç®¡ç†","uri":"/posts/linux-desktop-6-shutdown-troubleshooting/#æ€»ç»“"},{"categories":["tech"],"content":" ğŸ”— ç›¸å…³èµ„æº æŠ€æœ¯æ–‡æ¡£ï¼šsystemd å®˜æ–¹æ–‡æ¡£ã€Wayland åè®®è§„èŒƒ ç¤¾åŒºèµ„æºï¼šArch Wikiã€Gentoo Wiki ","date":"2025-10-19","objectID":"/posts/linux-desktop-6-shutdown-troubleshooting/:5:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus","Power Management","Hibernate","Suspend"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå…­ï¼‰ - ç³»ç»Ÿå…³æœºä¸ç”µæºç®¡ç†","uri":"/posts/linux-desktop-6-shutdown-troubleshooting/#-ç›¸å…³èµ„æº"},{"categories":["tech"],"content":"å…¨é¢è§£æ Linux æ¡Œé¢ç³»ç»Ÿçš„ç½‘ç»œé…ç½®ã€NetworkManagerã€DNS è§£æã€é˜²ç«å¢™è®¾ç½®å’Œç½‘ç»œæ•…éšœæ’æŸ¥æ–¹æ³•","date":"2025-10-19","objectID":"/posts/linux-desktop-5-network/","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Network","NetworkManager","DNS","Firewall"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäº”ï¼‰ - ç½‘ç»œ","uri":"/posts/linux-desktop-5-network/"},{"categories":["tech"],"content":" AI åˆ›ä½œå£°æ˜ï¼šæœ¬ç³»åˆ—æ–‡ç« ç”±ç¬”è€…å€ŸåŠ© ChatGPT, Kimi K2, è±†åŒ…å’Œ Cursor ç­‰ AI å·¥å…·åˆ›ä½œï¼Œæœ‰å¾ˆå¤§ç¯‡å¹…çš„å†…å®¹å®Œå…¨ç”± AI åœ¨æˆ‘çš„æŒ‡å¯¼ä¸‹ç”Ÿæˆã€‚å¦‚æœ‰é”™è¯¯ï¼Œè¿˜è¯·æŒ‡æ­£ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-5-network/:0:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Network","NetworkManager","DNS","Firewall"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäº”ï¼‰ - ç½‘ç»œ","uri":"/posts/linux-desktop-5-network/#"},{"categories":["tech"],"content":" å‰è¨€ç½‘ç»œè¿æ¥æ˜¯ç°ä»£æ¡Œé¢çš„åŸºç¡€åŠŸèƒ½ï¼Œæ¶‰åŠç¡¬ä»¶é©±åŠ¨ã€å›ºä»¶åŠ è½½ã€ç½‘ç»œç®¡ç†å’Œ DNS è§£æç­‰å¤šä¸ªç¯èŠ‚ã€‚ æœ¬æ–‡å°†ä»ç½‘å¡é©±åŠ¨å¼€å§‹ï¼Œç»è¿‡å†…æ ¸ç½‘ç»œæ ˆï¼Œåˆ°è¾¾åº”ç”¨å±‚ï¼Œäº†è§£ Linux ç½‘ç»œç³»ç»Ÿçš„å®Œæ•´æ¶æ„ï¼ŒåŒ…æ‹¬å¦‚ä½•é…ç½®ç½‘ç»œè¿æ¥ï¼Œå¦‚ä½•è®¾ç½®é˜²ç«å¢™è§„åˆ™ï¼Œä»¥åŠå¦‚ä½•è¯Šæ–­å„ç§ç½‘ç»œé—®é¢˜ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-5-network/:1:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Network","NetworkManager","DNS","Firewall"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäº”ï¼‰ - ç½‘ç»œ","uri":"/posts/linux-desktop-5-network/#å‰è¨€"},{"categories":["tech"],"content":" ç½‘ç»œè¿æ¥ä¸ç®¡ç†ç½‘ç»œè¿æ¥æ˜¯ç°ä»£æ¡Œé¢çš„åŸºç¡€åŠŸèƒ½ï¼Œæ¶‰åŠç¡¬ä»¶é©±åŠ¨ã€å›ºä»¶åŠ è½½ã€ç½‘ç»œç®¡ç†å’Œ DNS è§£æç­‰å¤šä¸ªç¯èŠ‚ã€‚ç½‘ç»œæ•…éšœæ˜¯æœ€å¸¸è§çš„æ¡Œé¢é—®é¢˜ä¹‹ä¸€ï¼Œç†è§£å…¶å·¥ä½œåŸç†æœ‰åŠ©äºå¿«é€Ÿå®šä½å’Œè§£å†³è¿æ¥é—®é¢˜ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-5-network/:2:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Network","NetworkManager","DNS","Firewall"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäº”ï¼‰ - ç½‘ç»œ","uri":"/posts/linux-desktop-5-network/#ç½‘ç»œè¿æ¥ä¸ç®¡ç†"},{"categories":["tech"],"content":" 1.1 ç½‘ç»œæ¶æ„æ¦‚è§ˆç°ä»£ Linux æ¡Œé¢å¤§å¤šä½¿ç”¨ systemd-networkd é…åˆ iwd è¿›è¡Œç½‘ç»œç®¡ç†ï¼Œå½¢æˆå®Œæ•´çš„ç½‘ç»œè§£å†³æ–¹æ¡ˆã€‚ è™½ç„¶ç›®å‰ä»æœ‰éƒ¨åˆ†ç³»ç»Ÿé»˜è®¤ä½¿ç”¨ NetworkManager ç®¡ç†ç½‘ç»œï¼Œç”¨ wpa_supplicant ç®¡ç† WiFi, ä½†è¿™å·²ç»ä¸å¤Ÿã€Œç°ä»£ã€äº†ï¼ˆé€ƒ ç½‘ç»œåè®®æ ˆï¼š ç¡¬ä»¶å±‚ï¼šç½‘å¡é©±åŠ¨å’Œå›ºä»¶ é“¾è·¯å±‚ï¼šMAC åœ°å€ç®¡ç†å’Œé“¾è·¯æ£€æµ‹ ç½‘ç»œå±‚ï¼šIP åœ°å€é…ç½®å’Œè·¯ç”±ç®¡ç† ä¼ è¾“å±‚ï¼šTCP / UDP è¿æ¥ç®¡ç† åº”ç”¨å±‚ï¼šDNS è§£æå’ŒæœåŠ¡å‘ç° ä¸»è¦ç»„ä»¶ï¼š systemd-networkdï¼šç½‘ç»œæ¥å£ç®¡ç†ï¼Œå¤„ç† DHCP å’Œé™æ€é…ç½® iwdï¼šæ— çº¿ç½‘ç»œç®¡ç†ï¼Œæ”¯æŒ WPA2 / WPA3 systemd-resolvedï¼šDNS è§£æå’Œç¼“å­˜ ","date":"2025-10-19","objectID":"/posts/linux-desktop-5-network/:2:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Network","NetworkManager","DNS","Firewall"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäº”ï¼‰ - ç½‘ç»œ","uri":"/posts/linux-desktop-5-network/#11-ç½‘ç»œæ¶æ„æ¦‚è§ˆ"},{"categories":["tech"],"content":" 1.2 ç½‘ç»œè¿æ¥æµç¨‹æœ‰çº¿ç½‘ç»œï¼š å†…æ ¸åŠ è½½ç½‘å¡é©±åŠ¨ æ£€æµ‹é“¾è·¯çŠ¶æ€ï¼ˆç½‘çº¿è¿æ¥ï¼‰ systemd-networkd é€šè¿‡ DHCP è·å– IP é…ç½® é…ç½®è·¯ç”±å’Œ DNS æ— çº¿ç½‘ç»œï¼š åŠ è½½æ— çº¿ç½‘å¡é©±åŠ¨å’Œå›ºä»¶ iwd æ‰«æå¯ç”¨ç½‘ç»œ é€‰æ‹©ç½‘ç»œå¹¶è¿›è¡Œè®¤è¯ï¼ˆWPA2 / WPA3ï¼‰ å»ºç«‹è¿æ¥åé€šè¿‡ DHCP è·å– IP ç½‘ç»œç®¡ç†å‘½ä»¤ï¼š bash # æŸ¥çœ‹æ¥å£çŠ¶æ€ ip link show ip addr show # æ— çº¿ç½‘ç»œç®¡ç†(iwd) iwctl station wlan0 scan iwctl station wlan0 connect \"SSID\" # ç½‘ç»œæœåŠ¡çŠ¶æ€ systemctl status systemd-networkd iwd # DNS è§£ææµ‹è¯• resolvectl query example.com resolvectl status ","date":"2025-10-19","objectID":"/posts/linux-desktop-5-network/:2:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Network","NetworkManager","DNS","Firewall"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäº”ï¼‰ - ç½‘ç»œ","uri":"/posts/linux-desktop-5-network/#12-ç½‘ç»œè¿æ¥æµç¨‹"},{"categories":["tech"],"content":" 1.3 IPv4 / IPv6 åŒæ ˆé…ç½®ç°ä»£ç½‘ç»œæ­£åœ¨å¾€ IPv6 è¿ç§»çš„è¿‡ç¨‹ä¸­ï¼Œç›®å‰ä»æœ‰è®¸å¤šç«™ç‚¹éƒ½åªæ”¯æŒ IPv6ï¼Œå› æ­¤ IPv4+IPv6 åŒæ ˆæˆä¸ºä¸€ä¸ªè¿‡æ¸¡æ–¹æ¡ˆï¼Œsystemd-networkd æä¾›å®Œæ•´çš„åŒæ ˆæ”¯æŒã€‚ åŒæ ˆç‰¹ç‚¹ï¼š IPv4ï¼šé€šè¿‡ DHCP è·å–é…ç½®ï¼Œ32 ä½åœ°å€ IPv6ï¼šé€šè¿‡ Router Advertisement è·å–ï¼Œ128 ä½åœ°å€ å¹¶è¡Œå·¥ä½œï¼šä¸¤ä¸ªåè®®æ ˆåŒæ—¶è¿è¡Œ IPv6 ä¼˜å…ˆï¼šé€šå¸¸æœ‰ IPv6 çš„ä¼šä¼˜å…ˆèµ° IPv6 ç½‘ç»œï¼Œæ²¡æœ‰æ‰èµ° IPv4. Linux ä¸­é€šè¿‡ glibc çš„ getaddrinfo() æ¥å®ç°è¯¥é€»è¾‘ï¼Œå¯é€šè¿‡ /etc/gai.conf è°ƒæ•´è¯¥å‡½æ•°çš„åœ°å€æ’åºç®—æ³•ã€‚å› ä¸º APP é€šå¸¸ç›´æ¥ä½¿ç”¨ç¬¬ä¸€æ¡è®°å½•å‘èµ·è¿æ¥ï¼Œæ‰€ä»¥ /etc/gai.conf é€šå¸¸èƒ½ç›´æ¥å†³å®šç³»ç»Ÿä¸­æ˜¯ IPv6 ä¼˜å…ˆè¿˜æ˜¯ IPv4 ä¼˜å…ˆã€‚ åŒæ ˆéªŒè¯ï¼š bash # æŸ¥çœ‹ IPv4 é…ç½® ip -4 addr show ip -4 route # æŸ¥çœ‹ IPv6 é…ç½® ip -6 addr show ping -6 2001:4860:4860::8888 # DNS åŒæ ˆæµ‹è¯• nslookup -type=A google.com nslookup -type=AAAA google.com ","date":"2025-10-19","objectID":"/posts/linux-desktop-5-network/:2:3","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Network","NetworkManager","DNS","Firewall"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäº”ï¼‰ - ç½‘ç»œ","uri":"/posts/linux-desktop-5-network/#13-ipv4--ipv6-åŒæ ˆé…ç½®"},{"categories":["tech"],"content":" 1.4 ç½‘ç»œæ•…éšœæ’æŸ¥è¿æ¥é—®é¢˜è¯Šæ–­æµç¨‹ï¼š ç¡¬ä»¶å±‚é¢ï¼š bash # æ£€æŸ¥æ¥å£å­˜åœ¨ ip link show # æŸ¥çœ‹é©±åŠ¨åŠ è½½ dmesg | grep -i firmware lspci | grep -i network é“¾è·¯å±‚é¢ï¼š bash # æœ‰çº¿ï¼šæ£€æŸ¥é“¾è·¯çŠ¶æ€ ethtool eth0 # æ— çº¿ï¼šæ‰«æç½‘ç»œ iw dev wlan0 scan | grep SSID ç½‘ç»œé…ç½®ï¼š bash # DHCP çŠ¶æ€ journalctl -u systemd-networkd # IP é…ç½®æ£€æŸ¥ ip addr show dev eth0 # è·¯ç”±è¡¨ ip route DNS è§£æï¼š bash # DNS é…ç½® resolvectl status cat /etc/resolv.conf # è§£ææµ‹è¯• dig @8.8.8.8 example.com nslookup example.com å¸¸è§é—®é¢˜ä¸è§£å†³ï¼š æ— æ³•è·å– IPï¼šæ£€æŸ¥ DHCP æœåŠ¡ã€ç½‘çº¿è¿æ¥ã€æ— çº¿å¯†ç  DNS è§£æå¤±è´¥ï¼šéªŒè¯ DNS æœåŠ¡å™¨é…ç½®ã€æ£€æŸ¥ systemd-resolved çŠ¶æ€ IPv6 æ— è¿æ¥ï¼šç¡®è®¤è·¯ç”±å™¨æ”¯æŒ IPv6ã€æ£€æŸ¥ IPv6AcceptRA é…ç½® è¿æ¥ä¸ç¨³å®šï¼šæŸ¥çœ‹ä¿¡å·å¼ºåº¦ã€æ£€æŸ¥é©±åŠ¨å…¼å®¹æ€§ ","date":"2025-10-19","objectID":"/posts/linux-desktop-5-network/:2:4","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Network","NetworkManager","DNS","Firewall"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäº”ï¼‰ - ç½‘ç»œ","uri":"/posts/linux-desktop-5-network/#14-ç½‘ç»œæ•…éšœæ’æŸ¥"},{"categories":["tech"],"content":" é˜²ç«å¢™ä¸ç½‘ç»œå®‰å…¨","date":"2025-10-19","objectID":"/posts/linux-desktop-5-network/:3:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Network","NetworkManager","DNS","Firewall"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäº”ï¼‰ - ç½‘ç»œ","uri":"/posts/linux-desktop-5-network/#é˜²ç«å¢™ä¸ç½‘ç»œå®‰å…¨"},{"categories":["tech"],"content":" 2.1 nftables é˜²ç«å¢™é…ç½®nftables æ˜¯ç°ä»£ Linux çš„é˜²ç«å¢™è§£å†³æ–¹æ¡ˆï¼Œå®ƒæä¾›æ¯” iptables æ›´ç®€æ´çš„è¯­æ³•å’Œæ›´å¥½çš„æ€§èƒ½ã€‚ åŸºæœ¬æ¦‚å¿µï¼š è¡¨ï¼ˆTableï¼‰ï¼šåŒ…å«é“¾å’Œè§„åˆ™çš„å®¹å™¨ é“¾ï¼ˆChainï¼‰ï¼šè§„åˆ™çš„æœ‰åºåˆ—è¡¨ è§„åˆ™ï¼ˆRuleï¼‰ï¼šåŒ¹é…æ¡ä»¶å’ŒåŠ¨ä½œ é›†åˆï¼ˆSetï¼‰ï¼šç”¨äºæ‰¹é‡åŒ¹é…çš„åœ°å€æˆ–ç«¯å£åˆ—è¡¨ nftables çš„å››è¡¨äº”é“¾ã€è§„åˆ™ç­‰æ¦‚å¿µè·Ÿ iptables æ˜¯å®Œå…¨ä¸€è‡´çš„ï¼Œè¿™ä¸€éƒ¨åˆ†å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰çš„æ–‡ç« iptables åŠ docker å®¹å™¨ç½‘ç»œåˆ†æ, è¿™é‡Œä¸å†èµ˜è¿°ã€‚ NixOS é…ç½®ç¤ºä¾‹ï¼š nix # configuration.nix networking.nftables = { enable = true; ruleset = '' # å®šä¹‰è¡¨ table inet filter { # å®šä¹‰é“¾ chain input { type filter hook input priority 0; policy drop; # å…è®¸å›ç¯æ¥å£ if lo accept # å…è®¸å·²å»ºç«‹çš„è¿æ¥ ct state established,related accept # å…è®¸ SSH tcp dport 22 accept # å…è®¸ HTTP/HTTPS tcp dport {80, 443} accept # å…è®¸ DNS udp dport 53 accept tcp dport 53 accept # å…è®¸ DHCP udp dport 67 accept udp dport 68 accept # å…è®¸ ICMP icmp type {echo-request, echo-reply, destination-unreachable} accept ip6 nexthdr icmpv6 icmpv6 type {echo-request, echo-reply, destination-unreachable} accept } chain forward { type filter hook forward priority 0; policy drop; } chain output { type filter hook output priority 0; policy accept; } } ''; }; å¸¸ç”¨ nftables å‘½ä»¤ï¼š bash # æŸ¥çœ‹å½“å‰è§„åˆ™ nft list ruleset # æŸ¥çœ‹ç‰¹å®šè¡¨ nft list table inet filter # ä¸´æ—¶æ·»åŠ è§„åˆ™ nft add rule inet filter input tcp dport 8080 accept # åˆ é™¤è§„åˆ™ nft delete rule inet filter input handle \u003chandle\u003e # æ¸…ç©ºè¡¨ nft flush table inet filter ","date":"2025-10-19","objectID":"/posts/linux-desktop-5-network/:3:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Network","NetworkManager","DNS","Firewall"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäº”ï¼‰ - ç½‘ç»œ","uri":"/posts/linux-desktop-5-network/#21-nftables-é˜²ç«å¢™é…ç½®"},{"categories":["tech"],"content":" 2.2 ç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNATï¼‰ç«¯å£è½¬å‘é…ç½®ï¼š nix networking.nftables.ruleset = '' table inet nat { chain prerouting { type nat hook prerouting priority 0; # ç«¯å£è½¬å‘ï¼šå°†å¤–éƒ¨ 8080 ç«¯å£è½¬å‘åˆ°å†…ç½‘ 192.168.1.100:80 tcp dport 8080 dnat to 192.168.1.100:80 } chain postrouting { type nat hook postrouting priority 100; # æºåœ°å€è½¬æ¢ï¼ˆSNATï¼‰ oifname \"eth0\" masquerade } } ''; ","date":"2025-10-19","objectID":"/posts/linux-desktop-5-network/:3:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Network","NetworkManager","DNS","Firewall"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäº”ï¼‰ - ç½‘ç»œ","uri":"/posts/linux-desktop-5-network/#22-ç½‘ç»œåœ°å€è½¬æ¢nat"},{"categories":["tech"],"content":" è™šæ‹Ÿç½‘ç»œæŠ€æœ¯","date":"2025-10-19","objectID":"/posts/linux-desktop-5-network/:4:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Network","NetworkManager","DNS","Firewall"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäº”ï¼‰ - ç½‘ç»œ","uri":"/posts/linux-desktop-5-network/#è™šæ‹Ÿç½‘ç»œæŠ€æœ¯"},{"categories":["tech"],"content":" 3.1 VPN è¿æ¥ç®¡ç†WireGuard é…ç½®ï¼š nix # configuration.nix networking.wireguard.interfaces = { wg0 = { ips = [ \"10.0.0.2/24\" ]; privateKeyFile = \"/etc/wireguard/private.key\"; peers = [ { publicKey = \"peer-public-key\"; allowedIPs = [ \"0.0.0.0/0\" ]; endpoint = \"vpn.example.com:51820\"; persistentKeepalive = 25; } ]; }; }; ","date":"2025-10-19","objectID":"/posts/linux-desktop-5-network/:4:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Network","NetworkManager","DNS","Firewall"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäº”ï¼‰ - ç½‘ç»œ","uri":"/posts/linux-desktop-5-network/#31-vpn-è¿æ¥ç®¡ç†"},{"categories":["tech"],"content":" 3.2 è™šæ‹Ÿç½‘ç»œæ¥å£TUN/TAP æ¥å£ï¼š bash # åˆ›å»º TUN æ¥å£ ip tuntap add dev tun0 mode tun ip addr add 10.0.0.1/24 dev tun0 ip link set tun0 up # åˆ›å»º TAP æ¥å£ ip tuntap add dev tap0 mode tap ip addr add 192.168.100.1/24 dev tap0 ip link set tap0 up æ¡¥æ¥ç½‘ç»œï¼š bash # åˆ›å»ºç½‘æ¡¥ ip link add name br0 type bridge ip link set dev br0 up # æ·»åŠ æ¥å£åˆ°ç½‘æ¡¥ ip link set dev eth1 master br0 ip link set dev tap0 master br0 # é…ç½®ç½‘æ¡¥ IP ip addr add 192.168.1.1/24 dev br0 ","date":"2025-10-19","objectID":"/posts/linux-desktop-5-network/:4:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Network","NetworkManager","DNS","Firewall"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäº”ï¼‰ - ç½‘ç»œ","uri":"/posts/linux-desktop-5-network/#32-è™šæ‹Ÿç½‘ç»œæ¥å£"},{"categories":["tech"],"content":" 3.3 å®¹å™¨ç½‘ç»œDocker ç½‘ç»œç®¡ç†ï¼š bash # æŸ¥çœ‹ç½‘ç»œ docker network ls # åˆ›å»ºè‡ªå®šä¹‰ç½‘ç»œ docker network create --driver bridge --subnet=172.20.0.0/16 mynetwork # è¿æ¥å®¹å™¨åˆ°ç½‘ç»œ docker network connect mynetwork container_name # æŸ¥çœ‹ç½‘ç»œè¯¦æƒ… docker network inspect mynetwork Podman ç½‘ç»œé…ç½®ï¼š bash # åˆ›å»ºç½‘ç»œ podman network create mynet # è¿è¡Œå®¹å™¨ podman run --network mynet -d nginx # æŸ¥çœ‹ç½‘ç»œ podman network ls ","date":"2025-10-19","objectID":"/posts/linux-desktop-5-network/:4:3","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Network","NetworkManager","DNS","Firewall"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäº”ï¼‰ - ç½‘ç»œ","uri":"/posts/linux-desktop-5-network/#33-å®¹å™¨ç½‘ç»œ"},{"categories":["tech"],"content":" ç½‘ç»œæ€§èƒ½ä¼˜åŒ–","date":"2025-10-19","objectID":"/posts/linux-desktop-5-network/:5:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Network","NetworkManager","DNS","Firewall"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäº”ï¼‰ - ç½‘ç»œ","uri":"/posts/linux-desktop-5-network/#ç½‘ç»œæ€§èƒ½ä¼˜åŒ–"},{"categories":["tech"],"content":" 4.1 ç½‘ç»œå‚æ•°è°ƒä¼˜å†…æ ¸ç½‘ç»œå‚æ•°ï¼š nix # configuration.nix boot.kernel.sysctl = { # TCP ç¼“å†²åŒºå¤§å° \"net.core.rmem_max\" = 134217728; \"net.core.wmem_max\" = 134217728; \"net.ipv4.tcp_rmem\" = \"4096 87380 134217728\"; \"net.ipv4.tcp_wmem\" = \"4096 65536 134217728\"; # TCP æ‹¥å¡æ§åˆ¶ \"net.ipv4.tcp_congestion_control\" = \"bbr\"; # è¿æ¥è·Ÿè¸ª \"net.netfilter.nf_conntrack_max\" = 1048576; \"net.netfilter.nf_conntrack_tcp_timeout_established\" = 3600; # ç½‘ç»œé˜Ÿåˆ— \"net.core.netdev_max_backlog\" = 5000; \"net.core.netdev_budget\" = 600; }; ç½‘ç»œå‚æ•°è°ƒä¼˜ï¼š TCP ç¼“å†²åŒºä¼˜åŒ–ï¼š net.core.rmem_max = 134217728 è®¾ç½® TCP æ¥æ”¶ç¼“å†²åŒºçš„æœ€å¤§å€¼ä¸º 128MBã€‚æ›´å¤§çš„æ¥æ”¶ç¼“å†²åŒºå¯ä»¥å¤„ç†çªå‘çš„é«˜æµé‡ï¼Œå‡å°‘ä¸¢åŒ…ï¼Œæé«˜ç½‘ç»œååé‡ï¼Œç‰¹åˆ«é€‚åˆé«˜å¸¦å®½ç½‘ç»œç¯å¢ƒï¼Œé€‚ç”¨äºé«˜å¸¦å®½ã€é«˜å»¶è¿Ÿç½‘ç»œï¼Œå¦‚å…‰çº¤ç½‘ç»œã€VPN è¿æ¥ã€‚ net.core.wmem_max = 134217728 è®¾ç½® TCP å‘é€ç¼“å†²åŒºçš„æœ€å¤§å€¼ä¸º 128MBã€‚æ›´å¤§çš„å‘é€ç¼“å†²åŒºå¯ä»¥ç¼“å­˜æ›´å¤šå¾…å‘é€æ•°æ®ï¼Œæé«˜å‘é€æ•ˆç‡ï¼Œå‡å°‘å‘é€é˜»å¡ï¼Œæé«˜ç½‘ç»œä¼ è¾“æ•ˆç‡ï¼Œé€‚ç”¨äºå¤§æ–‡ä»¶ä¼ è¾“ã€æµåª’ä½“ä¸Šä¼ ã€é«˜å¹¶å‘ç½‘ç»œåº”ç”¨ã€‚ net.ipv4.tcp_rmem = \"4096 87380 134217728\" è®¾ç½® TCP æ¥æ”¶ç¼“å†²åŒºçš„åˆå§‹å€¼ã€é»˜è®¤å€¼å’Œæœ€å¤§å€¼ã€‚å‚æ•°è¯´æ˜ï¼šåˆå§‹å€¼ 4KBï¼Œé»˜è®¤å€¼ 87KBï¼Œæœ€å¤§å€¼ 128MBã€‚åŠ¨æ€è°ƒæ•´æ¥æ”¶ç¼“å†²åŒºå¤§å°ï¼Œæ ¹æ®ç½‘ç»œæ¡ä»¶è‡ªåŠ¨ä¼˜åŒ–ï¼Œåœ¨ä½å»¶è¿Ÿå’Œé«˜ååé‡ä¹‹é—´è‡ªåŠ¨å¹³è¡¡ã€‚ net.ipv4.tcp_wmem = \"4096 65536 134217728\" è®¾ç½® TCP å‘é€ç¼“å†²åŒºçš„åˆå§‹å€¼ã€é»˜è®¤å€¼å’Œæœ€å¤§å€¼ã€‚å‚æ•°è¯´æ˜ï¼šåˆå§‹å€¼ 4KBï¼Œé»˜è®¤å€¼ 64KBï¼Œæœ€å¤§å€¼ 128MBã€‚åŠ¨æ€è°ƒæ•´å‘é€ç¼“å†²åŒºå¤§å°ï¼Œé€‚åº”ä¸åŒçš„ç½‘ç»œè´Ÿè½½ï¼Œåœ¨å†…å­˜ä½¿ç”¨å’Œç½‘ç»œæ€§èƒ½ä¹‹é—´æ‰¾åˆ°æœ€ä½³å¹³è¡¡ç‚¹ã€‚ TCP æ‹¥å¡æ§åˆ¶ä¼˜åŒ–ï¼š net.ipv4.tcp_congestion_control = \"bbr\" ä½¿ç”¨ BBRï¼ˆBottleneck Bandwidth and RTTï¼‰æ‹¥å¡æ§åˆ¶ç®—æ³•ã€‚BBR æ˜¯ Google å¼€å‘çš„ç°ä»£æ‹¥å¡æ§åˆ¶ç®—æ³•ï¼ŒåŸºäºå¸¦å®½å’Œå»¶è¿Ÿæµ‹é‡ï¼Œåœ¨é«˜å¸¦å®½ã€é«˜å»¶è¿Ÿç½‘ç»œç¯å¢ƒä¸‹æ€§èƒ½æ›´å¥½ï¼Œå‡å°‘å»¶è¿Ÿå’Œä¸¢åŒ…ï¼Œé€‚ç”¨äºç°ä»£ç½‘ç»œç¯å¢ƒï¼Œç‰¹åˆ«æ˜¯é«˜å¸¦å®½ç½‘ç»œå’Œé•¿è·ç¦»è¿æ¥ã€‚ è¿æ¥è·Ÿè¸ªä¼˜åŒ–ï¼š net.netfilter.nf_conntrack_max = 1048576 å¢åŠ è¿æ¥è·Ÿè¸ªè¡¨å¤§å°åˆ° 100 ä¸‡æ¡è®°å½•ã€‚æ”¯æŒæ›´å¤šå¹¶å‘ç½‘ç»œè¿æ¥ï¼Œé¿å…è¿æ¥è·Ÿè¸ªè¡¨æº¢å‡ºï¼Œæ”¯æŒé«˜å¹¶å‘ç½‘ç»œåº”ç”¨ï¼Œå¦‚ P2P ä¸‹è½½ã€å¤šç”¨æˆ·æœåŠ¡ï¼Œé€‚ç”¨äºæœåŠ¡å™¨ç¯å¢ƒã€é«˜å¹¶å‘ç½‘ç»œåº”ç”¨ã€‚ net.netfilter.nf_conntrack_tcp_timeout_established = 3600 è®¾ç½®å·²å»ºç«‹è¿æ¥çš„è¶…æ—¶æ—¶é—´ä¸º 1 å°æ—¶ã€‚å»¶é•¿è¿æ¥è·Ÿè¸ªæ—¶é—´ï¼Œå‡å°‘è¿æ¥é‡å»ºçš„é¢‘ç‡ï¼Œå‡å°‘è¿æ¥é‡å»ºå¼€é”€ï¼Œæé«˜é•¿è¿æ¥åº”ç”¨çš„æ€§èƒ½ï¼Œé€‚ç”¨äºé•¿è¿æ¥åº”ç”¨ï¼Œå¦‚æ•°æ®åº“è¿æ¥ã€WebSocket è¿æ¥ã€‚ ç½‘ç»œé˜Ÿåˆ—ä¼˜åŒ–ï¼š net.core.netdev_max_backlog = 5000 å¢åŠ ç½‘ç»œè®¾å¤‡æ¥æ”¶é˜Ÿåˆ—å¤§å°åˆ° 5000 ä¸ªæ•°æ®åŒ…ã€‚æ›´å¤§çš„æ¥æ”¶é˜Ÿåˆ—å¯ä»¥å¤„ç†çªå‘æµé‡ï¼Œå‡å°‘ä¸¢åŒ…ï¼Œæé«˜ç½‘ç»œå¤„ç†èƒ½åŠ›ï¼Œå‡å°‘å› é˜Ÿåˆ—æ»¡è€Œå¯¼è‡´çš„ä¸¢åŒ…ï¼Œé€‚ç”¨äºé«˜æµé‡ç½‘ç»œç¯å¢ƒï¼Œå¦‚æœåŠ¡å™¨ã€ç½‘ç»œè®¾å¤‡ã€‚ net.core.netdev_budget = 600 å¢åŠ æ¯æ¬¡ç½‘ç»œå¤„ç†çš„æ•°æ®åŒ…æ•°é‡åˆ° 600 ä¸ªã€‚æé«˜ç½‘ç»œå¤„ç†æ•ˆç‡ï¼Œå‡å°‘å¤„ç†å¼€é”€ï¼Œæé«˜ç½‘ç»œååé‡ï¼Œå‡å°‘ CPU ä½¿ç”¨ç‡ï¼Œé€‚ç”¨äºé«˜è´Ÿè½½ç½‘ç»œç¯å¢ƒï¼Œéœ€è¦ä¼˜åŒ–ç½‘ç»œå¤„ç†æ€§èƒ½ã€‚ ä¼˜åŒ–æ•ˆæœè¯„ä¼°ï¼šé€šè¿‡ç¼“å†²åŒºä¼˜åŒ–ï¼Œç½‘ç»œååé‡å¯æå‡ 20-50%ï¼›BBR æ‹¥å¡æ§åˆ¶ç®—æ³•å¯æ˜¾è‘—å‡å°‘ç½‘ç»œå»¶è¿Ÿï¼›è¿æ¥è·Ÿè¸ªä¼˜åŒ–æ”¯æŒæ›´å¤šå¹¶å‘è¿æ¥ï¼›é˜Ÿåˆ—ä¼˜åŒ–å‡å°‘ä¸¢åŒ…ï¼Œæé«˜ç½‘ç»œç¨³å®šæ€§ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-5-network/:5:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Network","NetworkManager","DNS","Firewall"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäº”ï¼‰ - ç½‘ç»œ","uri":"/posts/linux-desktop-5-network/#41-ç½‘ç»œå‚æ•°è°ƒä¼˜"},{"categories":["tech"],"content":" 4.2 ç½‘ç»œç›‘æ§ä¸åˆ†æç½‘ç»œæµé‡ç›‘æ§ï¼š bash # å®æ—¶æµé‡ç›‘æ§ iftop -i eth0 # ç½‘ç»œè¿æ¥ç›‘æ§ netstat -tuln ss -tuln # ç½‘ç»œç»Ÿè®¡ cat /proc/net/dev cat /proc/net/snmp # å¸¦å®½æµ‹è¯• iperf3 -s # æœåŠ¡å™¨ç«¯ iperf3 -c server_ip # å®¢æˆ·ç«¯ ç½‘ç»œå»¶è¿Ÿåˆ†æï¼š bash # ping æµ‹è¯• ping -c 10 8.8.8.8 # è·¯ç”±è·Ÿè¸ª traceroute 8.8.8.8 mtr 8.8.8.8 # ç½‘ç»œè´¨é‡æµ‹è¯• qperf server_ip tcp_bw tcp_lat ","date":"2025-10-19","objectID":"/posts/linux-desktop-5-network/:5:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Network","NetworkManager","DNS","Firewall"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäº”ï¼‰ - ç½‘ç»œ","uri":"/posts/linux-desktop-5-network/#42-ç½‘ç»œç›‘æ§ä¸åˆ†æ"},{"categories":["tech"],"content":" 4.3 ç½‘ç»œæ•…éšœè¯Šæ–­è¿æ¥é—®é¢˜æ’æŸ¥ï¼š bash # æ£€æŸ¥ç½‘ç»œæ¥å£çŠ¶æ€ ip link show ip addr show # æ£€æŸ¥è·¯ç”±è¡¨ ip route show ip route get 8.8.8.8 # æ£€æŸ¥ ARP è¡¨ ip neigh show # æ£€æŸ¥ç½‘ç»œç»Ÿè®¡ cat /proc/net/dev cat /proc/net/snmp DNS é—®é¢˜æ’æŸ¥ï¼š bash # æµ‹è¯• DNS è§£æ dig @8.8.8.8 example.com nslookup example.com # æ£€æŸ¥ DNS é…ç½® resolvectl status cat /etc/resolv.conf # æµ‹è¯• DNS æ€§èƒ½ dig @8.8.8.8 example.com +stats é˜²ç«å¢™é—®é¢˜æ’æŸ¥ï¼š bash # æ£€æŸ¥é˜²ç«å¢™è§„åˆ™ nft list ruleset iptables -L -v -n # æµ‹è¯•ç«¯å£è¿é€šæ€§ telnet server_ip port nc -zv server_ip port # æ£€æŸ¥è¿æ¥è·Ÿè¸ª cat /proc/net/nf_conntrack ","date":"2025-10-19","objectID":"/posts/linux-desktop-5-network/:5:3","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Network","NetworkManager","DNS","Firewall"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäº”ï¼‰ - ç½‘ç»œ","uri":"/posts/linux-desktop-5-network/#43-ç½‘ç»œæ•…éšœè¯Šæ–­"},{"categories":["tech"],"content":" é«˜çº§ç½‘ç»œé…ç½®","date":"2025-10-19","objectID":"/posts/linux-desktop-5-network/:6:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Network","NetworkManager","DNS","Firewall"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäº”ï¼‰ - ç½‘ç»œ","uri":"/posts/linux-desktop-5-network/#é«˜çº§ç½‘ç»œé…ç½®"},{"categories":["tech"],"content":" 5.1 å¤šç½‘å¡ç»‘å®šç½‘å¡ç»‘å®šé…ç½®ï¼š nix # configuration.nix networking.bonds = { bond0 = { interfaces = [ \"eth0\" \"eth1\" ]; driverOptions = { mode = \"802.3ad\"; lacp_rate = \"fast\"; xmit_hash_policy = \"layer3+4\"; }; }; }; networking.interfaces.bond0.ipv4.addresses = [{ address = \"192.168.1.100\"; prefixLength = 24; }]; ","date":"2025-10-19","objectID":"/posts/linux-desktop-5-network/:6:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Network","NetworkManager","DNS","Firewall"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäº”ï¼‰ - ç½‘ç»œ","uri":"/posts/linux-desktop-5-network/#51-å¤šç½‘å¡ç»‘å®š"},{"categories":["tech"],"content":" 5.2 VLAN é…ç½®VLAN ç½‘ç»œé…ç½®ï¼š nix # configuration.nix networking.vlans = { vlan100 = { id = 100; interface = \"eth0\"; }; vlan200 = { id = 200; interface = \"eth0\"; }; }; networking.interfaces.vlan100.ipv4.addresses = [{ address = \"192.168.100.1\"; prefixLength = 24; }]; networking.interfaces.vlan200.ipv4.addresses = [{ address = \"192.168.200.1\"; prefixLength = 24; }]; ","date":"2025-10-19","objectID":"/posts/linux-desktop-5-network/:6:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Network","NetworkManager","DNS","Firewall"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäº”ï¼‰ - ç½‘ç»œ","uri":"/posts/linux-desktop-5-network/#52-vlan-é…ç½®"},{"categories":["tech"],"content":" 5.3 ç½‘ç»œå‘½åç©ºé—´åˆ›å»ºç½‘ç»œå‘½åç©ºé—´ï¼š bash # åˆ›å»ºå‘½åç©ºé—´ ip netns add ns1 ip netns add ns2 # åˆ›å»º veth å¯¹ ip link add veth1 type veth peer name veth2 # å°†æ¥å£ç§»åˆ°å‘½åç©ºé—´ ip link set veth1 netns ns1 ip link set veth2 netns ns2 # é…ç½®å‘½åç©ºé—´å†…çš„ç½‘ç»œ ip netns exec ns1 ip addr add 10.0.1.1/24 dev veth1 ip netns exec ns1 ip link set veth1 up ip netns exec ns2 ip addr add 10.0.1.2/24 dev veth2 ip netns exec ns2 ip link set veth2 up # æµ‹è¯•è¿é€šæ€§ ip netns exec ns1 ping 10.0.1.2 ","date":"2025-10-19","objectID":"/posts/linux-desktop-5-network/:6:3","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Network","NetworkManager","DNS","Firewall"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäº”ï¼‰ - ç½‘ç»œ","uri":"/posts/linux-desktop-5-network/#53-ç½‘ç»œå‘½åç©ºé—´"},{"categories":["tech"],"content":" æ€»ç»“ç½‘ç»œæ˜¯è®¡ç®—æœºç§‘å­¦ä¸­æœ€å¤æ‚çš„æŠ€æœ¯ä¹‹ä¸€ï¼Œæ•°æ®åœ¨äº’è”ç½‘ä¸­çš„æµåŠ¨é€ å°±äº†ç°ä»£ä¿¡æ¯ç¤¾ä¼šï¼Œç°ä»£ AI çš„å‘å±•ä¹Ÿä¸ç°ä»£ç½‘ç»œä¸­äº§ç”Ÿçš„è¶…å¤§è§„æ¨¡æ•°æ®å¯†ä¸å¯åˆ†ã€‚ æœ¬æ–‡åªæ˜¯å¯¹ Linux ç½‘ç»œçš„ä¸€ä¸ªç®€å•ä»‹ç»ï¼Œä¸‹ä¸€ç¯‡æ–‡ç« æˆ‘ä»¬ä¼šèŠèŠç³»ç»Ÿå…³æœºå’Œæ•…éšœæ’æŸ¥ï¼Œçœ‹çœ‹ç³»ç»Ÿæ˜¯å¦‚ä½•ä¼˜é›…åœ°å…³æœºçš„ï¼Œä»¥åŠé‡åˆ°é—®é¢˜æ—¶è¯¥å¦‚ä½•å¤„ç†ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-5-network/:7:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Network","NetworkManager","DNS","Firewall"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäº”ï¼‰ - ç½‘ç»œ","uri":"/posts/linux-desktop-5-network/#æ€»ç»“"},{"categories":["tech"],"content":" å¿«é€Ÿå‚è€ƒ","date":"2025-10-19","objectID":"/posts/linux-desktop-5-network/:8:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Network","NetworkManager","DNS","Firewall"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäº”ï¼‰ - ç½‘ç»œ","uri":"/posts/linux-desktop-5-network/#å¿«é€Ÿå‚è€ƒ"},{"categories":["tech"],"content":" å¸¸ç”¨ç½‘ç»œç®¡ç†å‘½ä»¤ bash # ç½‘ç»œæ¥å£ç®¡ç† ip link show # æŸ¥çœ‹ç½‘ç»œæ¥å£ ip addr show # æŸ¥çœ‹ IP åœ°å€ ip route show # æŸ¥çœ‹è·¯ç”±è¡¨ ip neigh show # æŸ¥çœ‹ ARP è¡¨ # ç½‘ç»œè¿æ¥ç®¡ç† ss -tuln # æŸ¥çœ‹ç½‘ç»œè¿æ¥ netstat -tuln # ä¼ ç»Ÿç½‘ç»œè¿æ¥æŸ¥çœ‹ lsof -i # æŸ¥çœ‹ç«¯å£å ç”¨ # ç½‘ç»œæµ‹è¯• ping -c 4 8.8.8.8 # ping æµ‹è¯• traceroute 8.8.8.8 # è·¯ç”±è·Ÿè¸ª mtr 8.8.8.8 # ç½‘ç»œè´¨é‡æµ‹è¯• ","date":"2025-10-19","objectID":"/posts/linux-desktop-5-network/:8:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Network","NetworkManager","DNS","Firewall"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäº”ï¼‰ - ç½‘ç»œ","uri":"/posts/linux-desktop-5-network/#å¸¸ç”¨ç½‘ç»œç®¡ç†å‘½ä»¤"},{"categories":["tech"],"content":" å¸¸ç”¨é˜²ç«å¢™å‘½ä»¤ bash # nftables ç®¡ç† nft list ruleset # æŸ¥çœ‹æ‰€æœ‰è§„åˆ™ nft list table inet filter # æŸ¥çœ‹ç‰¹å®šè¡¨ nft add rule inet filter input tcp dport 8080 accept # æ·»åŠ è§„åˆ™ nft delete rule inet filter input handle \u003chandle\u003e # åˆ é™¤è§„åˆ™ # iptables ç®¡ç†ï¼ˆä¼ ç»Ÿï¼‰ iptables -L -v -n # æŸ¥çœ‹è§„åˆ™ iptables -A INPUT -p tcp --dport 22 -j ACCEPT # æ·»åŠ è§„åˆ™ iptables -D INPUT -p tcp --dport 22 -j ACCEPT # åˆ é™¤è§„åˆ™ ","date":"2025-10-19","objectID":"/posts/linux-desktop-5-network/:8:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Network","NetworkManager","DNS","Firewall"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäº”ï¼‰ - ç½‘ç»œ","uri":"/posts/linux-desktop-5-network/#å¸¸ç”¨é˜²ç«å¢™å‘½ä»¤"},{"categories":["tech"],"content":" å¸¸ç”¨ç½‘ç»œè¯Šæ–­å‘½ä»¤ bash # DNS è§£ææµ‹è¯• dig @8.8.8.8 example.com # DNS æŸ¥è¯¢ nslookup example.com # ä¼ ç»Ÿ DNS æŸ¥è¯¢ resolvectl query example.com # systemd-resolved æŸ¥è¯¢ # ç½‘ç»œç›‘æ§ iftop -i eth0 # å®æ—¶æµé‡ç›‘æ§ tcpdump -i eth0 # ç½‘ç»œåŒ…æ•è· wireshark # å›¾å½¢åŒ–ç½‘ç»œåˆ†æ # å¸¦å®½æµ‹è¯• iperf3 -s # å¯åŠ¨ iperf3 æœåŠ¡å™¨ iperf3 -c server_ip # å®¢æˆ·ç«¯æµ‹è¯• ","date":"2025-10-19","objectID":"/posts/linux-desktop-5-network/:8:3","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Network","NetworkManager","DNS","Firewall"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäº”ï¼‰ - ç½‘ç»œ","uri":"/posts/linux-desktop-5-network/#å¸¸ç”¨ç½‘ç»œè¯Šæ–­å‘½ä»¤"},{"categories":["tech"],"content":" é‡è¦é…ç½®æ–‡ä»¶ä½ç½® bash # ç½‘ç»œé…ç½® /etc/systemd/network/ # systemd-networkd é…ç½® /etc/nftables.conf # nftables é…ç½® /etc/resolv.conf # DNS é…ç½® # ç½‘ç»œæœåŠ¡ /etc/systemd/system/ # systemd æœåŠ¡é…ç½® /etc/wireguard/ # WireGuard é…ç½® /etc/openvpn/ # OpenVPN é…ç½® # ç½‘ç»œçŠ¶æ€ /proc/net/dev # ç½‘ç»œæ¥å£ç»Ÿè®¡ /proc/net/snmp # ç½‘ç»œåè®®ç»Ÿè®¡ /proc/net/nf_conntrack # è¿æ¥è·Ÿè¸ªè¡¨ ","date":"2025-10-19","objectID":"/posts/linux-desktop-5-network/:8:4","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Network","NetworkManager","DNS","Firewall"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäº”ï¼‰ - ç½‘ç»œ","uri":"/posts/linux-desktop-5-network/#é‡è¦é…ç½®æ–‡ä»¶ä½ç½®"},{"categories":["tech"],"content":"æ·±å…¥æ¢è®¨ Linux æ¡Œé¢ç³»ç»Ÿçš„å¤šåª’ä½“å¤„ç†ã€ä¸­æ–‡è¾“å…¥æ³•ã€éŸ³é¢‘è§†é¢‘æ¶æ„å’Œè¾“å…¥è®¾å¤‡ç®¡ç†ï¼Œè§£å†³å¸¸è§å¤šåª’ä½“é—®é¢˜","date":"2025-10-19","objectID":"/posts/linux-desktop-4-multimedia-input/","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Multimedia","Audio","Video","Input Method"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå››ï¼‰ - å¤šåª’ä½“å¤„ç†ä¸ä¸­æ–‡æ”¯æŒ","uri":"/posts/linux-desktop-4-multimedia-input/"},{"categories":["tech"],"content":" AI åˆ›ä½œå£°æ˜ï¼šæœ¬ç³»åˆ—æ–‡ç« ç”±ç¬”è€…å€ŸåŠ© ChatGPT, Kimi K2, è±†åŒ…å’Œ Cursor ç­‰ AI å·¥å…·åˆ›ä½œï¼Œæœ‰å¾ˆå¤§ç¯‡å¹…çš„å†…å®¹å®Œå…¨ç”± AI åœ¨æˆ‘çš„æŒ‡å¯¼ä¸‹ç”Ÿæˆã€‚å¦‚æœ‰é”™è¯¯ï¼Œè¿˜è¯·æŒ‡æ­£ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-4-multimedia-input/:0:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Multimedia","Audio","Video","Input Method"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå››ï¼‰ - å¤šåª’ä½“å¤„ç†ä¸ä¸­æ–‡æ”¯æŒ","uri":"/posts/linux-desktop-4-multimedia-input/#"},{"categories":["tech"],"content":" å‰è¨€Linux æ¡Œé¢ç³»ç»Ÿçš„å¤šåª’ä½“å¤„ç†å’Œä¸­æ–‡æ”¯æŒæ¶‰åŠå¤šä¸ªå­ç³»ç»Ÿã€‚éŸ³é¢‘å»¶è¿Ÿã€å­—ä½“æ¸²æŸ“è´¨é‡ã€è¾“å…¥æ³•å“åº”é€Ÿåº¦ç­‰é—®é¢˜çœ‹ä¼¼ç®€å•ï¼ŒèƒŒåå´æ¶‰åŠ PipeWireã€fontconfigã€fcitx5 ç­‰å¤šä¸ªç»„ä»¶çš„ååŒå·¥ä½œã€‚ æœ¬æ–‡å°†æ·±å…¥æ¢è®¨ Linux æ¡Œé¢ç³»ç»Ÿçš„å¤šåª’ä½“å¤„ç†èƒ½åŠ›ï¼Œäº†è§£ PipeWire å¦‚ä½•ç»Ÿä¸€ç®¡ç†éŸ³é¢‘å’Œè§†é¢‘ï¼Œfontconfig å¦‚ä½•ä¼˜åŒ–å­—ä½“æ˜¾ç¤ºï¼Œä»¥åŠ fcitx5 å¦‚ä½•æä¾›æµç•…çš„ä¸­æ–‡è¾“å…¥ä½“éªŒã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-4-multimedia-input/:1:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Multimedia","Audio","Video","Input Method"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå››ï¼‰ - å¤šåª’ä½“å¤„ç†ä¸ä¸­æ–‡æ”¯æŒ","uri":"/posts/linux-desktop-4-multimedia-input/#å‰è¨€"},{"categories":["tech"],"content":" å¤šåª’ä½“å¤„ç†ç°ä»£ Linux æ¡Œé¢ï¼ˆWaylandï¼‰ PipeWire ç»Ÿä¸€å¤„ç†éŸ³é¢‘å’Œè§†é¢‘ï¼Œå–ä»£äº†ä¼ ç»Ÿçš„ PulseAudio å’Œ JACKã€‚PipeWire æä¾›äº†æ›´ä½çš„å»¶è¿Ÿã€æ›´å¥½çš„ç¡¬ä»¶å…¼å®¹æ€§ï¼Œä»¥åŠç»Ÿä¸€çš„åª’ä½“å¤„ç†æ¡†æ¶ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-4-multimedia-input/:2:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Multimedia","Audio","Video","Input Method"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå››ï¼‰ - å¤šåª’ä½“å¤„ç†ä¸ä¸­æ–‡æ”¯æŒ","uri":"/posts/linux-desktop-4-multimedia-input/#å¤šåª’ä½“å¤„ç†"},{"categories":["tech"],"content":" 1.1 PipeWire æ¶æ„æ¦‚è§ˆ https://docs.pipewire.org/page_overview.html PipeWire ä½œä¸ºåª’ä½“æœåŠ¡å™¨çš„æ ¸å¿ƒï¼Œè¿æ¥åº”ç”¨ç¨‹åºå’Œç¡¬ä»¶è®¾å¤‡ï¼Œæä¾›éŸ³é¢‘æ··åˆã€è§†é¢‘å¤„ç†å’Œè·¯ç”±åŠŸèƒ½ã€‚å®ƒä»ä¸€å¼€å§‹å°±å®šä½ä¸º\"é€šç”¨å¤šåª’ä½“å¤„ç†æ¡†æ¶\"ï¼Œè€Œéä»…å±€é™äºéŸ³é¢‘ï¼Œè¿™ç§è®¾è®¡æºäºç°ä»£å¤šåª’ä½“åœºæ™¯ï¼ˆå¦‚è§†é¢‘ä¼šè®®ã€å±å¹•å…±äº«ã€ç›´æ’­ã€è·¨åº”ç”¨åª’ä½“åä½œç­‰ï¼‰å¯¹\"éŸ³é¢‘+è§†é¢‘\"ç»Ÿä¸€å¤„ç†çš„å¼ºéœ€æ±‚ã€‚Pipewire æ”¯æŒæ‰€æœ‰æ¥å…¥ PulseAudioï¼ŒJACKï¼ŒALSA å’Œ GStreamer çš„ç¨‹åºã€‚ æ ¸å¿ƒç»„ä»¶ï¼š pipewireï¼šæ ¸å¿ƒå®ˆæŠ¤è¿›ç¨‹ï¼Œç®¡ç†åª’ä½“æµå›¾ wireplumberï¼šä¼šè¯ç®¡ç†å™¨ï¼Œå¤„ç†è®¾å¤‡è¿æ¥å’Œè·¯ç”±ç­–ç•¥ pipewire-pulseï¼šPulseAudio å…¼å®¹å±‚ pipewire-jackï¼šJACK ä¸“ä¸šéŸ³é¢‘å…¼å®¹å±‚ pipewire-alsaï¼šALSA å…¼å®¹å±‚ æŠ€æœ¯ç‰¹ç‚¹ï¼š ç»Ÿä¸€æ¶æ„ï¼šåŒæ—¶å¤„ç†éŸ³é¢‘ã€è§†é¢‘ã€MIDI ä½å»¶è¿Ÿï¼šç›¸æ¯” PulseAudio æ˜¾è‘—é™ä½éŸ³é¢‘å»¶è¿Ÿ ç¡¬ä»¶å…¼å®¹ï¼šæ”¯æŒä¸“ä¸šéŸ³é¢‘è®¾å¤‡å’Œæ¶ˆè´¹çº§ç¡¬ä»¶ å®‰å…¨éš”ç¦»ï¼šé€šè¿‡æƒé™æ§åˆ¶ä¿æŠ¤åª’ä½“æ•°æ® NixOS é…ç½®ï¼š nix services.pipewire = { enable = true; alsa.enable = true; # ALSA å…¼å®¹ pulse.enable = true; # PulseAudio å…¼å®¹ jack.enable = true; # JACK å…¼å®¹ }; services.pipewire.wireplumber.enable = true; # ç¦ç”¨ PulseAudio é¿å…å†²çª hardware.pulseaudio.enable = false; é…ç½®æ–‡ä»¶è·¯å¾„ï¼š /etc/pipewire/pipewire.confï¼šä¸»é…ç½®æ–‡ä»¶ /etc/pipewire/pipewire-pulse.confï¼šPulseAudio å…¼å®¹é…ç½® /etc/wireplumber/ï¼šWirePlumber ä¼šè¯ç®¡ç†å™¨é…ç½® ","date":"2025-10-19","objectID":"/posts/linux-desktop-4-multimedia-input/:2:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Multimedia","Audio","Video","Input Method"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå››ï¼‰ - å¤šåª’ä½“å¤„ç†ä¸ä¸­æ–‡æ”¯æŒ","uri":"/posts/linux-desktop-4-multimedia-input/#11-pipewire-æ¶æ„æ¦‚è§ˆ"},{"categories":["tech"],"content":" 1.2 éŸ³é¢‘å¤„ç†æµç¨‹åº”ç”¨æ’­æ”¾éŸ³é¢‘çš„å…¸å‹æµç¨‹ï¼š API è¿æ¥ï¼šåº”ç”¨é€šè¿‡ ALSA / PulseAudio / JACK API è¿æ¥åˆ° PipeWire æµåˆ›å»ºï¼šåœ¨ PipeWire å›¾ä¸­åˆ›å»ºéŸ³é¢‘æµèŠ‚ç‚¹ è·¯ç”±å†³ç­–ï¼šWirePlumber æ ¹æ®ç­–ç•¥è·¯ç”±åˆ°è¾“å‡ºè®¾å¤‡ éŸ³é¢‘å¤„ç†ï¼šæ··åˆå¤šä¸ªåº”ç”¨æµï¼Œæ‰§è¡Œæ ¼å¼è½¬æ¢ã€éŸ³é‡è°ƒèŠ‚ã€è°ƒæ•´éŸ³é¢‘æ•ˆæœ ç¡¬ä»¶è¾“å‡ºï¼šé€šè¿‡ ALSA é©±åŠ¨å°† PCM æ•°æ®å‘é€ç»™å£°å¡ DACï¼Œæœ€ç»ˆè¾“å‡ºæ¨¡æ‹ŸéŸ³é¢‘è¾“å‡º éŸ³é¢‘èŠ‚ç‚¹ç®¡ç†ï¼š bash # æŸ¥çœ‹éŸ³é¢‘è®¾å¤‡ pw-cli list-objects | grep -E \"(Audio|Sink|Source)\" # å®æ—¶ç›‘æ§éŸ³é¢‘æµ pw-top # å›¾å½¢ç•Œé¢ç®¡ç† pavucontrol # æŸ¥çœ‹ ALSA è®¾å¤‡ aplay -l arecord -l éŸ³é¢‘è·¯ç”±æ§åˆ¶ï¼š bash # è®¾ç½®é»˜è®¤è¾“å‡ºè®¾å¤‡ pactl set-default-sink alsa_output.pci-0000_00_1f.3.analog-stereo # åº”ç”¨éŸ³é‡æ§åˆ¶ pactl list sink-inputs pactl set-sink-input-volume 123 50% # åˆ›å»ºè‡ªå®šä¹‰è¿æ¥ pw-cli create-link \u003csource-node\u003e \u003csink-node\u003e ","date":"2025-10-19","objectID":"/posts/linux-desktop-4-multimedia-input/:2:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Multimedia","Audio","Video","Input Method"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå››ï¼‰ - å¤šåª’ä½“å¤„ç†ä¸ä¸­æ–‡æ”¯æŒ","uri":"/posts/linux-desktop-4-multimedia-input/#12-éŸ³é¢‘å¤„ç†æµç¨‹"},{"categories":["tech"],"content":" 1.3 è§†é¢‘å¤„ç†ä¸å±å¹•å…±äº« 1.3.1 ä¸ºä»€ä¹ˆ PipeWire è¦æ”¯æŒè§†é¢‘æµå¤„ç†ï¼Ÿä¼ ç»Ÿ Linux ç³»ç»Ÿä¸­ï¼ŒéŸ³é¢‘å’Œè§†é¢‘å¤„ç†é•¿æœŸå¤„äº\"å„è‡ªä¸ºæˆ˜\"çš„çŠ¶æ€ï¼š éŸ³é¢‘ï¼šç”± PulseAudioï¼ˆæ¡Œé¢ï¼‰ã€JACKï¼ˆä¸“ä¸šï¼‰ç­‰ç³»ç»Ÿè´Ÿè´£ è§†é¢‘ï¼šä¾èµ– V4L2ï¼ˆæ‘„åƒå¤´æ•è·ï¼‰ã€X11/Waylandï¼ˆå±å¹•æˆªå›¾ï¼‰ã€GStreamerï¼ˆæµå¤„ç†ï¼‰ã€FFmpegï¼ˆç¼–è§£ç ï¼‰ç­‰åˆ†æ•£ç»„ä»¶ è¿™ç§ç¢ç‰‡åŒ–å¯¼è‡´äº†è¯¸å¤šé—®é¢˜ï¼š è·¨åº”ç”¨åŒæ­¥å›°éš¾ï¼šç›´æ’­æ—¶éº¦å…‹é£å£°éŸ³ä¸æ‘„åƒå¤´ç”»é¢å»¶è¿Ÿä¸ä¸€è‡´ æƒé™ç®¡ç†æ··ä¹±ï¼šæ²™ç›’åº”ç”¨å¦‚ Flatpak è®¿é—®æ‘„åƒå¤´/å±å¹•éœ€å•ç‹¬é€‚é… ç°ä»£åœºæ™¯æ”¯æŒä¸è¶³ï¼šWayland ä¸‹çš„å±å¹•å…±äº«ã€HDR è§†é¢‘æ¸²æŸ“ç¼ºä¹ç»Ÿä¸€æ”¯æŒ ç¡¬ä»¶åŠ é€Ÿå¤æ‚ï¼šGPU ç¼–è§£ç éœ€å„ç»„ä»¶å•ç‹¬å¯¹æ¥ï¼Œå…¼å®¹æ€§å·® PipeWire çš„è®¾è®¡åˆè¡·å°±æ˜¯æ‰“ç ´è¿™ç§å‰²è£‚ï¼šé€šè¿‡ä¸€å¥—ç»Ÿä¸€çš„æ¡†æ¶åŒæ—¶ç®¡ç†éŸ³é¢‘å’Œè§†é¢‘æµï¼Œè®©\"éŸ³é¢‘+ è§†é¢‘\"çš„åä½œï¼ˆå¦‚ä¼šè®®è½¯ä»¶åŒæ—¶æ•è·éº¦å…‹é£å’Œæ‘„åƒå¤´ã€ç›´æ’­å·¥å…·æ··åˆæ¸¸æˆç”»é¢ä¸è§£è¯´å£°éŸ³ï¼‰å˜å¾—ç®€å•é«˜æ•ˆã€‚å› æ­¤ï¼Œè§†é¢‘å¤„ç†æ˜¯å…¶\"ç»Ÿä¸€å¤šåª’ä½“ç®¡é“\"ç›®æ ‡çš„è‡ªç„¶å»¶ä¼¸ã€‚ 1.3.2 PipeWire è§†é¢‘å¤„ç†çš„æ ¸å¿ƒä¼˜åŠ¿PipeWire ä½œä¸ºç°ä»£ Linux æ¡Œé¢ç³»ç»Ÿçš„å¤šåª’ä½“æ¡†æ¶ï¼Œç›¸æ¯”ä¼ ç»Ÿæ–¹æ¡ˆå…·æœ‰ä»¥ä¸‹æ ¸å¿ƒä¼˜åŠ¿ï¼š ç»Ÿä¸€çš„\"ç®¡é“\"æ¨¡å‹ï¼š éŸ³é¢‘æµå’Œè§†é¢‘æµéƒ½è¢«æŠ½è±¡ä¸º\"èŠ‚ç‚¹\" é€šè¿‡ç»Ÿä¸€çš„\"èŠ‚ç‚¹-ç«¯å£-è¿æ¥\"æ¨¡å‹å®ç°è·¨åº”ç”¨çš„éŸ³è§†é¢‘æ··åˆ æ¡†æ¶å†…ç½®æ—¶é—´æˆ³åŒæ­¥æœºåˆ¶ï¼Œç¡®ä¿éŸ³è§†é¢‘æµå§‹ç»ˆä¿æŒæ—¶åºä¸€è‡´ï¼ˆå»¶è¿Ÿè¯¯å·®å¯æ§åˆ¶åœ¨æ¯«ç§’çº§ï¼‰ åŸç”Ÿé€‚é…ç°ä»£æ¡Œé¢åè®®ï¼š ä½œä¸º Wayland å®˜æ–¹æ¨èçš„å¤šåª’ä½“ä¸­é—´å±‚ é€šè¿‡ä¸ xdg-desktop-portal æ¡†æ¶ååŒå·¥ä½œï¼Œå®ç°æ ‡å‡†åŒ–çš„\"æˆæƒå¼\"å±å¹•å…±äº« æ”¯æŒ HDR è§†é¢‘å’Œé«˜åˆ†è¾¨ç‡æµä¼ è¾“ï¼Œæ€§èƒ½æŸè€—è¿œä½äºä¼ ç»Ÿ X11 æˆªå›¾ éµå¾ª Wayland å®‰å…¨éš”ç¦»åŸåˆ™ï¼Œæ‰€æœ‰è·¨åº”ç”¨èµ„æºè®¿é—®éƒ½é€šè¿‡ç”¨æˆ·æˆæƒçš„é—¨æˆ·æ¥å£ ç®€åŒ–æ²™ç›’åº”ç”¨æƒé™ï¼š é€šè¿‡ Polkit æƒé™ç³»ç»Ÿé›†ä¸­ç®¡ç†è®¾å¤‡è®¿é—® æ²™ç›’åº”ç”¨æ— éœ€ç›´æ¥æ“ä½œç¡¬ä»¶è®¾å¤‡ï¼Œåªéœ€é€šè¿‡ PipeWire API è¯·æ±‚æµæ•°æ® æ”¯æŒåŠ¨æ€æƒé™è°ƒæ•´ é«˜æ•ˆç¡¬ä»¶åŠ é€Ÿæ•´åˆï¼š å†…ç½®ç»Ÿä¸€çš„ç¡¬ä»¶åŠ é€ŸæŠ½è±¡å±‚ é€šè¿‡ GStreamer æˆ– FFmpeg åç«¯è‡ªåŠ¨é€‚é…åº•å±‚ç¡¬ä»¶åŠ é€Ÿæ¥å£ æ”¯æŒ\"é›¶æ‹·è´\"ä¼ è¾“ï¼ŒCPU å ç”¨ç‡å¯é™ä½ 50% ä»¥ä¸Š çµæ´»çš„åŠ¨æ€è·¯ç”±ï¼š å…è®¸å®æ—¶è°ƒæ•´è§†é¢‘æµè·¯å¾„ ç”¨æˆ·å¯é€šè¿‡å›¾å½¢å·¥å…·æ‹–æ‹½èŠ‚ç‚¹å®ç°æµçš„åŠ¨æ€åˆ‡æ¢ æ”¯æŒè‡ªåŠ¨æ•…éšœæ¢å¤å’Œæµçš„åŠ¨æ€è½¬æ¢ 1.3.3 Wayland å±å¹•å…±äº«ä¸ xdg-desktop-portalåœ¨ Wayland ç¯å¢ƒä¸­ï¼Œå±å¹•å…±äº«åŠŸèƒ½æ˜¯é€šè¿‡ xdg-desktop-portal å’Œ PipeWire ååŒå·¥ä½œå®ç°çš„ã€‚è¿™ä¸ X11 æœ‰å¾ˆå¤§çš„ä¸åŒï¼Œåè€…é€šè¿‡å…¶è‡ªèº«çš„æ‰©å±•ï¼ˆå¦‚ X11R6 çš„ XFIXES æ‰©å±•ï¼‰ç›´æ¥è®¿é—®å±å¹•å†…å®¹ã€‚ å·¥ä½œåŸç†ï¼š åœ¨ Wayland ä¸‹ï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºåªèƒ½è®¿é—®è‡ªå·±çš„çª—å£ã€é”®ç›˜é¼ æ ‡äº‹ä»¶ç­‰ï¼Œæ— æ³•éšæ„æˆªå±æˆ–è®¿é—®å…¨å±€èµ„æºã€‚å±å¹•å…±äº«çš„å®Œæ•´æµç¨‹æ˜¯ï¼š åº”ç”¨å‘èµ·è¯·æ±‚ï¼šè§†é¢‘ä¼šè®®è½¯ä»¶è°ƒç”¨ org.freedesktop.portal.ScreenCast æ¥å£ï¼Œè¯·æ±‚å±å¹•å…±äº« ç”¨æˆ·æˆæƒï¼šxdg-desktop-portal æ˜¾ç¤ºåŸç”Ÿå¯¹è¯æ¡†ï¼Œè¯·æ±‚ç”¨æˆ·ç¡®è®¤å…±äº«èŒƒå›´ï¼ˆæ•´ä¸ªå±å¹•/ç‰¹å®šçª—å£/åŒºåŸŸï¼‰ åˆæˆå™¨æä¾›æ•°æ®ï¼šè·å¾—æˆæƒåï¼Œxdg-desktop-portal é€šçŸ¥åˆæˆå™¨ï¼Œåˆæˆå™¨å°†ç›¸åº”çš„å±å¹•å†…å®¹é€šè¿‡ PipeWire æµè¿”å›ç»™ xdg-desktop-portal. PipeWire æµä¼ è¾“ï¼šxdg-desktop-portal å°†æµä¿¡æ¯è¿”å›ç»™åº”ç”¨ï¼Œåº”ç”¨ç¨‹åºé€šè¿‡ PipeWire æ¥æ”¶å±å¹•æ•°æ®è¿›è¡Œå¤„ç†å’Œä¼ è¾“ å¯ä»¥çœ‹åˆ°åº”ç”¨ç¨‹åºåªéœ€è¦å…ˆä¸ xdg-desktop-portal äº¤äº’è·å¾— PipeWire æµä¿¡æ¯ï¼Œç„¶åç›´æ¥è®¿é—® PipeWire, å…¨ç¨‹éƒ½ä¸ç›´æ¥ä¸åˆæˆå™¨äº¤äº’ã€‚ åè®®ä¼˜åŠ¿ï¼š å®‰å…¨æ€§ï¼šåŸºäº xdg-desktop-portal çš„æˆæƒæœºåˆ¶ï¼Œéœ€è¦ç”¨æˆ·æ˜ç¡®åŒæ„ éšç§ä¿æŠ¤ï¼šç”¨æˆ·å¯ä»¥ç²¾ç¡®æ§åˆ¶å…±äº«èŒƒå›´ï¼Œåªå…±äº«ç‰¹å®šçª—å£è€Œéæ•´ä¸ªå±å¹• æ€§èƒ½ï¼šç›´æ¥è®¿é—®åˆæˆå™¨ç¼“å†²åŒºï¼Œé¿å…é¢å¤–çš„å†…å­˜æ‹·è´ å…¼å®¹æ€§ï¼šæ”¯æŒå¤šæ˜¾ç¤ºå™¨ã€ä¸åŒåˆ†è¾¨ç‡å’Œåˆ·æ–°ç‡ æ ‡å‡†åŒ–ï¼šæ‰€æœ‰åº”ç”¨éƒ½ä½¿ç”¨ç›¸åŒçš„ portal æ¥å£ï¼Œç¡®ä¿è·¨æ¡Œé¢ç¯å¢ƒçš„ä¸€è‡´ä½“éªŒ é—¨æˆ·å®ç°è¦æ±‚ï¼š è¦ä½¿ç”¨ Wayland å±å¹•å…±äº«ï¼Œç³»ç»Ÿéœ€è¦å®‰è£… DE/WM æ‰€æ”¯æŒçš„ xdg-desktop-portal å®ç°ã€‚ ä¸»æµåº”ç”¨æ”¯æŒï¼šç›®å‰ä¸»æµçš„ OBSã€Discordã€Zoomã€Chrome/Chromium ç­‰åº”ç”¨éƒ½å·²ç»æ”¯æŒåŸºäº xdg-desktop-portal çš„ Wayland å±å¹•å…±äº«æœºåˆ¶ã€‚ 1.3.4 è§†é¢‘è®¾å¤‡ç®¡ç†æ‘„åƒå¤´è®¾å¤‡ç®¡ç†ï¼š bash # æŸ¥çœ‹ PipeWire è§†é¢‘è®¾å¤‡ pw-cli list-objects | grep -i video # æŸ¥çœ‹ V4L2 è®¾å¤‡ v4l2-ctl --list-devices # æ‘„åƒå¤´æ ¼å¼æŸ¥è¯¢ v4l2-ctl --device=/dev/video0 --list-formats # æ‘„åƒå¤´æƒé™æ£€æŸ¥ ls -l /dev/video* groups $USER # ç¡®è®¤åœ¨ video ç»„ # æµ‹è¯•æ‘„åƒå¤´ ffplay /dev/video0 å±å¹•å…±äº«ç¯å¢ƒé…ç½®ï¼š bash # Wayland ç¯å¢ƒæ£€æŸ¥ echo $WAYLAND_DISPLAY echo $XDG_SESSION_TYPE # è®¾ç½®æ¡Œé¢ç¯å¢ƒæ ‡è¯†ï¼ˆé‡è¦ï¼ï¼‰ export XDG_CURRENT_DESKTOP=sway # æˆ– gnome, kde, xfce ç­‰ # æ£€æŸ¥ PipeWire æœåŠ¡çŠ¶æ€ systemctl --user status pipewire-session-manager systemctl --user status pipewire # æ£€æŸ¥æ¡Œé¢é—¨æˆ·æœåŠ¡ systemctl --user status xdg-desktop-portal systemctl --user status xdg-desktop-portal-wlr # Sway/Hyprland # æˆ– systemctl --user status xdg-desktop-portal-gnome # GNOME 1.3.5 è§†é¢‘æµå¤„ç†é…ç½®PipeWire è§†é¢‘é…ç½®ï¼š NixOS ä¸­å¯é€šè¿‡ services.pipewire.extraConfig.pipewire.\"10-video\".\"context.properties\" æ¥å£°æ˜è¿™éƒ¨åˆ†é…ç½®ã€‚ bash # ç¼–è¾‘ PipeWire ä¸»é…ç½® vim ~/.config/pipewire/pipewire.conf # è§†é¢‘ç›¸å…³é…ç½®ç¤ºä¾‹ context.properties = { # è§†é¢‘ç¼“å†²åŒºé…ç½® default.video.rate = 30 default.video.size = \"1920x1080\" # ç¡¬ä»¶åŠ é€Ÿé…ç½® gstreamer.plugins = [ \"vaapi\" # Intel/AMD GPU ç¡¬ä»¶åŠ é€Ÿ \"nvenc\" # NVIDIA GPU ç¡¬ä»¶åŠ é€Ÿ ] } 1.3.6 è§†é¢‘å¤„ç†æ€§èƒ½ä¼˜åŒ–ç¡¬ä»¶åŠ é€Ÿé…ç½®ï¼š bash # æ£€æŸ¥ç¡¬ä»¶åŠ é€Ÿæ”¯æŒ vainfo # VA-API æ”¯æŒæ£€æŸ¥ nvidia-smi # NVIDIA GPU çŠ¶æ€ # ç¯å¢ƒå˜é‡è®¾ç½® export LIBVA_DRIVER_NAME=i965 # Intel GPU export LIBVA_DRIVER_NAME=radeonsi # AMD GPU export LIBVA_DRIVER_NAME=nvidia # NVIDIA GPU # GStreamer ç¡¬ä»¶åŠ é€Ÿæµ‹è¯• gst-launch-1.0 videotestsrc ! vaapih264enc ! mp4mux ! filesink location=test.mp4 è§†é¢‘ç¼–ç ä¼˜åŒ–ï¼š bash # FFmpeg ç¡¬ä»¶åŠ é€Ÿç¼–ç  ffmpeg -f v4l2 -i /dev/video0 -c:v h264_vaapi -b:v 2M output.mp4 # OBS ç¡¬ä»¶ç¼–ç é…ç½® # è®¾ç½® -\u003e è¾“å‡º -\u003e ç¼–ç å™¨é€‰æ‹© \"FFmpeg VAAPI\" æˆ– \"NVENC\" å†…å­˜å’Œ CPU ä¼˜åŒ–ï¼š bash # è°ƒæ•´è§†é¢‘ç¼“å†²åŒºå¤§å° vim ~/.config/pipewire/pipewire.conf context.properties = { # å‡å°‘è§†é¢‘ç¼“å†²åŒºå»¶è¿Ÿ default.video.quantum = 1/30 # 30fps default.video.min-quantum = 1/30 default.video.max-quantum = 1/15 # æœ€å¤§ 15fps å»¶è¿Ÿ } ","date":"2025-10-19","objectID":"/posts/linux-desktop-4-multimedia-input/:2:3","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Multimedia","Audio","Video","Input Method"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå››ï¼‰ - å¤šåª’ä½“å¤„ç†ä¸ä¸­æ–‡æ”¯æŒ","uri":"/posts/linux-desktop-4-multimedia-input/#13-è§†é¢‘å¤„ç†ä¸å±å¹•å…±äº«"},{"categories":["tech"],"content":" 1.3 è§†é¢‘å¤„ç†ä¸å±å¹•å…±äº« 1.3.1 ä¸ºä»€ä¹ˆ PipeWire è¦æ”¯æŒè§†é¢‘æµå¤„ç†ï¼Ÿä¼ ç»Ÿ Linux ç³»ç»Ÿä¸­ï¼ŒéŸ³é¢‘å’Œè§†é¢‘å¤„ç†é•¿æœŸå¤„äº\"å„è‡ªä¸ºæˆ˜\"çš„çŠ¶æ€ï¼š éŸ³é¢‘ï¼šç”± PulseAudioï¼ˆæ¡Œé¢ï¼‰ã€JACKï¼ˆä¸“ä¸šï¼‰ç­‰ç³»ç»Ÿè´Ÿè´£ è§†é¢‘ï¼šä¾èµ– V4L2ï¼ˆæ‘„åƒå¤´æ•è·ï¼‰ã€X11/Waylandï¼ˆå±å¹•æˆªå›¾ï¼‰ã€GStreamerï¼ˆæµå¤„ç†ï¼‰ã€FFmpegï¼ˆç¼–è§£ç ï¼‰ç­‰åˆ†æ•£ç»„ä»¶ è¿™ç§ç¢ç‰‡åŒ–å¯¼è‡´äº†è¯¸å¤šé—®é¢˜ï¼š è·¨åº”ç”¨åŒæ­¥å›°éš¾ï¼šç›´æ’­æ—¶éº¦å…‹é£å£°éŸ³ä¸æ‘„åƒå¤´ç”»é¢å»¶è¿Ÿä¸ä¸€è‡´ æƒé™ç®¡ç†æ··ä¹±ï¼šæ²™ç›’åº”ç”¨å¦‚ Flatpak è®¿é—®æ‘„åƒå¤´/å±å¹•éœ€å•ç‹¬é€‚é… ç°ä»£åœºæ™¯æ”¯æŒä¸è¶³ï¼šWayland ä¸‹çš„å±å¹•å…±äº«ã€HDR è§†é¢‘æ¸²æŸ“ç¼ºä¹ç»Ÿä¸€æ”¯æŒ ç¡¬ä»¶åŠ é€Ÿå¤æ‚ï¼šGPU ç¼–è§£ç éœ€å„ç»„ä»¶å•ç‹¬å¯¹æ¥ï¼Œå…¼å®¹æ€§å·® PipeWire çš„è®¾è®¡åˆè¡·å°±æ˜¯æ‰“ç ´è¿™ç§å‰²è£‚ï¼šé€šè¿‡ä¸€å¥—ç»Ÿä¸€çš„æ¡†æ¶åŒæ—¶ç®¡ç†éŸ³é¢‘å’Œè§†é¢‘æµï¼Œè®©\"éŸ³é¢‘+ è§†é¢‘\"çš„åä½œï¼ˆå¦‚ä¼šè®®è½¯ä»¶åŒæ—¶æ•è·éº¦å…‹é£å’Œæ‘„åƒå¤´ã€ç›´æ’­å·¥å…·æ··åˆæ¸¸æˆç”»é¢ä¸è§£è¯´å£°éŸ³ï¼‰å˜å¾—ç®€å•é«˜æ•ˆã€‚å› æ­¤ï¼Œè§†é¢‘å¤„ç†æ˜¯å…¶\"ç»Ÿä¸€å¤šåª’ä½“ç®¡é“\"ç›®æ ‡çš„è‡ªç„¶å»¶ä¼¸ã€‚ 1.3.2 PipeWire è§†é¢‘å¤„ç†çš„æ ¸å¿ƒä¼˜åŠ¿PipeWire ä½œä¸ºç°ä»£ Linux æ¡Œé¢ç³»ç»Ÿçš„å¤šåª’ä½“æ¡†æ¶ï¼Œç›¸æ¯”ä¼ ç»Ÿæ–¹æ¡ˆå…·æœ‰ä»¥ä¸‹æ ¸å¿ƒä¼˜åŠ¿ï¼š ç»Ÿä¸€çš„\"ç®¡é“\"æ¨¡å‹ï¼š éŸ³é¢‘æµå’Œè§†é¢‘æµéƒ½è¢«æŠ½è±¡ä¸º\"èŠ‚ç‚¹\" é€šè¿‡ç»Ÿä¸€çš„\"èŠ‚ç‚¹-ç«¯å£-è¿æ¥\"æ¨¡å‹å®ç°è·¨åº”ç”¨çš„éŸ³è§†é¢‘æ··åˆ æ¡†æ¶å†…ç½®æ—¶é—´æˆ³åŒæ­¥æœºåˆ¶ï¼Œç¡®ä¿éŸ³è§†é¢‘æµå§‹ç»ˆä¿æŒæ—¶åºä¸€è‡´ï¼ˆå»¶è¿Ÿè¯¯å·®å¯æ§åˆ¶åœ¨æ¯«ç§’çº§ï¼‰ åŸç”Ÿé€‚é…ç°ä»£æ¡Œé¢åè®®ï¼š ä½œä¸º Wayland å®˜æ–¹æ¨èçš„å¤šåª’ä½“ä¸­é—´å±‚ é€šè¿‡ä¸ xdg-desktop-portal æ¡†æ¶ååŒå·¥ä½œï¼Œå®ç°æ ‡å‡†åŒ–çš„\"æˆæƒå¼\"å±å¹•å…±äº« æ”¯æŒ HDR è§†é¢‘å’Œé«˜åˆ†è¾¨ç‡æµä¼ è¾“ï¼Œæ€§èƒ½æŸè€—è¿œä½äºä¼ ç»Ÿ X11 æˆªå›¾ éµå¾ª Wayland å®‰å…¨éš”ç¦»åŸåˆ™ï¼Œæ‰€æœ‰è·¨åº”ç”¨èµ„æºè®¿é—®éƒ½é€šè¿‡ç”¨æˆ·æˆæƒçš„é—¨æˆ·æ¥å£ ç®€åŒ–æ²™ç›’åº”ç”¨æƒé™ï¼š é€šè¿‡ Polkit æƒé™ç³»ç»Ÿé›†ä¸­ç®¡ç†è®¾å¤‡è®¿é—® æ²™ç›’åº”ç”¨æ— éœ€ç›´æ¥æ“ä½œç¡¬ä»¶è®¾å¤‡ï¼Œåªéœ€é€šè¿‡ PipeWire API è¯·æ±‚æµæ•°æ® æ”¯æŒåŠ¨æ€æƒé™è°ƒæ•´ é«˜æ•ˆç¡¬ä»¶åŠ é€Ÿæ•´åˆï¼š å†…ç½®ç»Ÿä¸€çš„ç¡¬ä»¶åŠ é€ŸæŠ½è±¡å±‚ é€šè¿‡ GStreamer æˆ– FFmpeg åç«¯è‡ªåŠ¨é€‚é…åº•å±‚ç¡¬ä»¶åŠ é€Ÿæ¥å£ æ”¯æŒ\"é›¶æ‹·è´\"ä¼ è¾“ï¼ŒCPU å ç”¨ç‡å¯é™ä½ 50% ä»¥ä¸Š çµæ´»çš„åŠ¨æ€è·¯ç”±ï¼š å…è®¸å®æ—¶è°ƒæ•´è§†é¢‘æµè·¯å¾„ ç”¨æˆ·å¯é€šè¿‡å›¾å½¢å·¥å…·æ‹–æ‹½èŠ‚ç‚¹å®ç°æµçš„åŠ¨æ€åˆ‡æ¢ æ”¯æŒè‡ªåŠ¨æ•…éšœæ¢å¤å’Œæµçš„åŠ¨æ€è½¬æ¢ 1.3.3 Wayland å±å¹•å…±äº«ä¸ xdg-desktop-portalåœ¨ Wayland ç¯å¢ƒä¸­ï¼Œå±å¹•å…±äº«åŠŸèƒ½æ˜¯é€šè¿‡ xdg-desktop-portal å’Œ PipeWire ååŒå·¥ä½œå®ç°çš„ã€‚è¿™ä¸ X11 æœ‰å¾ˆå¤§çš„ä¸åŒï¼Œåè€…é€šè¿‡å…¶è‡ªèº«çš„æ‰©å±•ï¼ˆå¦‚ X11R6 çš„ XFIXES æ‰©å±•ï¼‰ç›´æ¥è®¿é—®å±å¹•å†…å®¹ã€‚ å·¥ä½œåŸç†ï¼š åœ¨ Wayland ä¸‹ï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºåªèƒ½è®¿é—®è‡ªå·±çš„çª—å£ã€é”®ç›˜é¼ æ ‡äº‹ä»¶ç­‰ï¼Œæ— æ³•éšæ„æˆªå±æˆ–è®¿é—®å…¨å±€èµ„æºã€‚å±å¹•å…±äº«çš„å®Œæ•´æµç¨‹æ˜¯ï¼š åº”ç”¨å‘èµ·è¯·æ±‚ï¼šè§†é¢‘ä¼šè®®è½¯ä»¶è°ƒç”¨ org.freedesktop.portal.ScreenCast æ¥å£ï¼Œè¯·æ±‚å±å¹•å…±äº« ç”¨æˆ·æˆæƒï¼šxdg-desktop-portal æ˜¾ç¤ºåŸç”Ÿå¯¹è¯æ¡†ï¼Œè¯·æ±‚ç”¨æˆ·ç¡®è®¤å…±äº«èŒƒå›´ï¼ˆæ•´ä¸ªå±å¹•/ç‰¹å®šçª—å£/åŒºåŸŸï¼‰ åˆæˆå™¨æä¾›æ•°æ®ï¼šè·å¾—æˆæƒåï¼Œxdg-desktop-portal é€šçŸ¥åˆæˆå™¨ï¼Œåˆæˆå™¨å°†ç›¸åº”çš„å±å¹•å†…å®¹é€šè¿‡ PipeWire æµè¿”å›ç»™ xdg-desktop-portal. PipeWire æµä¼ è¾“ï¼šxdg-desktop-portal å°†æµä¿¡æ¯è¿”å›ç»™åº”ç”¨ï¼Œåº”ç”¨ç¨‹åºé€šè¿‡ PipeWire æ¥æ”¶å±å¹•æ•°æ®è¿›è¡Œå¤„ç†å’Œä¼ è¾“ å¯ä»¥çœ‹åˆ°åº”ç”¨ç¨‹åºåªéœ€è¦å…ˆä¸ xdg-desktop-portal äº¤äº’è·å¾— PipeWire æµä¿¡æ¯ï¼Œç„¶åç›´æ¥è®¿é—® PipeWire, å…¨ç¨‹éƒ½ä¸ç›´æ¥ä¸åˆæˆå™¨äº¤äº’ã€‚ åè®®ä¼˜åŠ¿ï¼š å®‰å…¨æ€§ï¼šåŸºäº xdg-desktop-portal çš„æˆæƒæœºåˆ¶ï¼Œéœ€è¦ç”¨æˆ·æ˜ç¡®åŒæ„ éšç§ä¿æŠ¤ï¼šç”¨æˆ·å¯ä»¥ç²¾ç¡®æ§åˆ¶å…±äº«èŒƒå›´ï¼Œåªå…±äº«ç‰¹å®šçª—å£è€Œéæ•´ä¸ªå±å¹• æ€§èƒ½ï¼šç›´æ¥è®¿é—®åˆæˆå™¨ç¼“å†²åŒºï¼Œé¿å…é¢å¤–çš„å†…å­˜æ‹·è´ å…¼å®¹æ€§ï¼šæ”¯æŒå¤šæ˜¾ç¤ºå™¨ã€ä¸åŒåˆ†è¾¨ç‡å’Œåˆ·æ–°ç‡ æ ‡å‡†åŒ–ï¼šæ‰€æœ‰åº”ç”¨éƒ½ä½¿ç”¨ç›¸åŒçš„ portal æ¥å£ï¼Œç¡®ä¿è·¨æ¡Œé¢ç¯å¢ƒçš„ä¸€è‡´ä½“éªŒ é—¨æˆ·å®ç°è¦æ±‚ï¼š è¦ä½¿ç”¨ Wayland å±å¹•å…±äº«ï¼Œç³»ç»Ÿéœ€è¦å®‰è£… DE/WM æ‰€æ”¯æŒçš„ xdg-desktop-portal å®ç°ã€‚ ä¸»æµåº”ç”¨æ”¯æŒï¼šç›®å‰ä¸»æµçš„ OBSã€Discordã€Zoomã€Chrome/Chromium ç­‰åº”ç”¨éƒ½å·²ç»æ”¯æŒåŸºäº xdg-desktop-portal çš„ Wayland å±å¹•å…±äº«æœºåˆ¶ã€‚ 1.3.4 è§†é¢‘è®¾å¤‡ç®¡ç†æ‘„åƒå¤´è®¾å¤‡ç®¡ç†ï¼š bash # æŸ¥çœ‹ PipeWire è§†é¢‘è®¾å¤‡ pw-cli list-objects | grep -i video # æŸ¥çœ‹ V4L2 è®¾å¤‡ v4l2-ctl --list-devices # æ‘„åƒå¤´æ ¼å¼æŸ¥è¯¢ v4l2-ctl --device=/dev/video0 --list-formats # æ‘„åƒå¤´æƒé™æ£€æŸ¥ ls -l /dev/video* groups $USER # ç¡®è®¤åœ¨ video ç»„ # æµ‹è¯•æ‘„åƒå¤´ ffplay /dev/video0 å±å¹•å…±äº«ç¯å¢ƒé…ç½®ï¼š bash # Wayland ç¯å¢ƒæ£€æŸ¥ echo $WAYLAND_DISPLAY echo $XDG_SESSION_TYPE # è®¾ç½®æ¡Œé¢ç¯å¢ƒæ ‡è¯†ï¼ˆé‡è¦ï¼ï¼‰ export XDG_CURRENT_DESKTOP=sway # æˆ– gnome, kde, xfce ç­‰ # æ£€æŸ¥ PipeWire æœåŠ¡çŠ¶æ€ systemctl --user status pipewire-session-manager systemctl --user status pipewire # æ£€æŸ¥æ¡Œé¢é—¨æˆ·æœåŠ¡ systemctl --user status xdg-desktop-portal systemctl --user status xdg-desktop-portal-wlr # Sway/Hyprland # æˆ– systemctl --user status xdg-desktop-portal-gnome # GNOME 1.3.5 è§†é¢‘æµå¤„ç†é…ç½®PipeWire è§†é¢‘é…ç½®ï¼š NixOS ä¸­å¯é€šè¿‡ services.pipewire.extraConfig.pipewire.\"10-video\".\"context.properties\" æ¥å£°æ˜è¿™éƒ¨åˆ†é…ç½®ã€‚ bash # ç¼–è¾‘ PipeWire ä¸»é…ç½® vim ~/.config/pipewire/pipewire.conf # è§†é¢‘ç›¸å…³é…ç½®ç¤ºä¾‹ context.properties = { # è§†é¢‘ç¼“å†²åŒºé…ç½® default.video.rate = 30 default.video.size = \"1920x1080\" # ç¡¬ä»¶åŠ é€Ÿé…ç½® gstreamer.plugins = [ \"vaapi\" # Intel/AMD GPU ç¡¬ä»¶åŠ é€Ÿ \"nvenc\" # NVIDIA GPU ç¡¬ä»¶åŠ é€Ÿ ] } 1.3.6 è§†é¢‘å¤„ç†æ€§èƒ½ä¼˜åŒ–ç¡¬ä»¶åŠ é€Ÿé…ç½®ï¼š bash # æ£€æŸ¥ç¡¬ä»¶åŠ é€Ÿæ”¯æŒ vainfo # VA-API æ”¯æŒæ£€æŸ¥ nvidia-smi # NVIDIA GPU çŠ¶æ€ # ç¯å¢ƒå˜é‡è®¾ç½® export LIBVA_DRIVER_NAME=i965 # Intel GPU export LIBVA_DRIVER_NAME=radeonsi # AMD GPU export LIBVA_DRIVER_NAME=nvidia # NVIDIA GPU # GStreamer ç¡¬ä»¶åŠ é€Ÿæµ‹è¯• gst-launch-1.0 videotestsrc ! vaapih264enc ! mp4mux ! filesink location=test.mp4 è§†é¢‘ç¼–ç ä¼˜åŒ–ï¼š bash # FFmpeg ç¡¬ä»¶åŠ é€Ÿç¼–ç  ffmpeg -f v4l2 -i /dev/video0 -c:v h264_vaapi -b:v 2M output.mp4 # OBS ç¡¬ä»¶ç¼–ç é…ç½® # è®¾ç½® -\u003e è¾“å‡º -\u003e ç¼–ç å™¨é€‰æ‹© \"FFmpeg VAAPI\" æˆ– \"NVENC\" å†…å­˜å’Œ CPU ä¼˜åŒ–ï¼š bash # è°ƒæ•´è§†é¢‘ç¼“å†²åŒºå¤§å° vim ~/.config/pipewire/pipewire.conf context.properties = { # å‡å°‘è§†é¢‘ç¼“å†²åŒºå»¶è¿Ÿ default.video.quantum = 1/30 # 30fps default.video.min-quantum = 1/30 default.video.max-quantum = 1/15 # æœ€å¤§ 15fps å»¶è¿Ÿ } ","date":"2025-10-19","objectID":"/posts/linux-desktop-4-multimedia-input/:2:3","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Multimedia","Audio","Video","Input Method"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå››ï¼‰ - å¤šåª’ä½“å¤„ç†ä¸ä¸­æ–‡æ”¯æŒ","uri":"/posts/linux-desktop-4-multimedia-input/#131-ä¸ºä»€ä¹ˆ-pipewire-è¦æ”¯æŒè§†é¢‘æµå¤„ç†"},{"categories":["tech"],"content":" 1.3 è§†é¢‘å¤„ç†ä¸å±å¹•å…±äº« 1.3.1 ä¸ºä»€ä¹ˆ PipeWire è¦æ”¯æŒè§†é¢‘æµå¤„ç†ï¼Ÿä¼ ç»Ÿ Linux ç³»ç»Ÿä¸­ï¼ŒéŸ³é¢‘å’Œè§†é¢‘å¤„ç†é•¿æœŸå¤„äº\"å„è‡ªä¸ºæˆ˜\"çš„çŠ¶æ€ï¼š éŸ³é¢‘ï¼šç”± PulseAudioï¼ˆæ¡Œé¢ï¼‰ã€JACKï¼ˆä¸“ä¸šï¼‰ç­‰ç³»ç»Ÿè´Ÿè´£ è§†é¢‘ï¼šä¾èµ– V4L2ï¼ˆæ‘„åƒå¤´æ•è·ï¼‰ã€X11/Waylandï¼ˆå±å¹•æˆªå›¾ï¼‰ã€GStreamerï¼ˆæµå¤„ç†ï¼‰ã€FFmpegï¼ˆç¼–è§£ç ï¼‰ç­‰åˆ†æ•£ç»„ä»¶ è¿™ç§ç¢ç‰‡åŒ–å¯¼è‡´äº†è¯¸å¤šé—®é¢˜ï¼š è·¨åº”ç”¨åŒæ­¥å›°éš¾ï¼šç›´æ’­æ—¶éº¦å…‹é£å£°éŸ³ä¸æ‘„åƒå¤´ç”»é¢å»¶è¿Ÿä¸ä¸€è‡´ æƒé™ç®¡ç†æ··ä¹±ï¼šæ²™ç›’åº”ç”¨å¦‚ Flatpak è®¿é—®æ‘„åƒå¤´/å±å¹•éœ€å•ç‹¬é€‚é… ç°ä»£åœºæ™¯æ”¯æŒä¸è¶³ï¼šWayland ä¸‹çš„å±å¹•å…±äº«ã€HDR è§†é¢‘æ¸²æŸ“ç¼ºä¹ç»Ÿä¸€æ”¯æŒ ç¡¬ä»¶åŠ é€Ÿå¤æ‚ï¼šGPU ç¼–è§£ç éœ€å„ç»„ä»¶å•ç‹¬å¯¹æ¥ï¼Œå…¼å®¹æ€§å·® PipeWire çš„è®¾è®¡åˆè¡·å°±æ˜¯æ‰“ç ´è¿™ç§å‰²è£‚ï¼šé€šè¿‡ä¸€å¥—ç»Ÿä¸€çš„æ¡†æ¶åŒæ—¶ç®¡ç†éŸ³é¢‘å’Œè§†é¢‘æµï¼Œè®©\"éŸ³é¢‘+ è§†é¢‘\"çš„åä½œï¼ˆå¦‚ä¼šè®®è½¯ä»¶åŒæ—¶æ•è·éº¦å…‹é£å’Œæ‘„åƒå¤´ã€ç›´æ’­å·¥å…·æ··åˆæ¸¸æˆç”»é¢ä¸è§£è¯´å£°éŸ³ï¼‰å˜å¾—ç®€å•é«˜æ•ˆã€‚å› æ­¤ï¼Œè§†é¢‘å¤„ç†æ˜¯å…¶\"ç»Ÿä¸€å¤šåª’ä½“ç®¡é“\"ç›®æ ‡çš„è‡ªç„¶å»¶ä¼¸ã€‚ 1.3.2 PipeWire è§†é¢‘å¤„ç†çš„æ ¸å¿ƒä¼˜åŠ¿PipeWire ä½œä¸ºç°ä»£ Linux æ¡Œé¢ç³»ç»Ÿçš„å¤šåª’ä½“æ¡†æ¶ï¼Œç›¸æ¯”ä¼ ç»Ÿæ–¹æ¡ˆå…·æœ‰ä»¥ä¸‹æ ¸å¿ƒä¼˜åŠ¿ï¼š ç»Ÿä¸€çš„\"ç®¡é“\"æ¨¡å‹ï¼š éŸ³é¢‘æµå’Œè§†é¢‘æµéƒ½è¢«æŠ½è±¡ä¸º\"èŠ‚ç‚¹\" é€šè¿‡ç»Ÿä¸€çš„\"èŠ‚ç‚¹-ç«¯å£-è¿æ¥\"æ¨¡å‹å®ç°è·¨åº”ç”¨çš„éŸ³è§†é¢‘æ··åˆ æ¡†æ¶å†…ç½®æ—¶é—´æˆ³åŒæ­¥æœºåˆ¶ï¼Œç¡®ä¿éŸ³è§†é¢‘æµå§‹ç»ˆä¿æŒæ—¶åºä¸€è‡´ï¼ˆå»¶è¿Ÿè¯¯å·®å¯æ§åˆ¶åœ¨æ¯«ç§’çº§ï¼‰ åŸç”Ÿé€‚é…ç°ä»£æ¡Œé¢åè®®ï¼š ä½œä¸º Wayland å®˜æ–¹æ¨èçš„å¤šåª’ä½“ä¸­é—´å±‚ é€šè¿‡ä¸ xdg-desktop-portal æ¡†æ¶ååŒå·¥ä½œï¼Œå®ç°æ ‡å‡†åŒ–çš„\"æˆæƒå¼\"å±å¹•å…±äº« æ”¯æŒ HDR è§†é¢‘å’Œé«˜åˆ†è¾¨ç‡æµä¼ è¾“ï¼Œæ€§èƒ½æŸè€—è¿œä½äºä¼ ç»Ÿ X11 æˆªå›¾ éµå¾ª Wayland å®‰å…¨éš”ç¦»åŸåˆ™ï¼Œæ‰€æœ‰è·¨åº”ç”¨èµ„æºè®¿é—®éƒ½é€šè¿‡ç”¨æˆ·æˆæƒçš„é—¨æˆ·æ¥å£ ç®€åŒ–æ²™ç›’åº”ç”¨æƒé™ï¼š é€šè¿‡ Polkit æƒé™ç³»ç»Ÿé›†ä¸­ç®¡ç†è®¾å¤‡è®¿é—® æ²™ç›’åº”ç”¨æ— éœ€ç›´æ¥æ“ä½œç¡¬ä»¶è®¾å¤‡ï¼Œåªéœ€é€šè¿‡ PipeWire API è¯·æ±‚æµæ•°æ® æ”¯æŒåŠ¨æ€æƒé™è°ƒæ•´ é«˜æ•ˆç¡¬ä»¶åŠ é€Ÿæ•´åˆï¼š å†…ç½®ç»Ÿä¸€çš„ç¡¬ä»¶åŠ é€ŸæŠ½è±¡å±‚ é€šè¿‡ GStreamer æˆ– FFmpeg åç«¯è‡ªåŠ¨é€‚é…åº•å±‚ç¡¬ä»¶åŠ é€Ÿæ¥å£ æ”¯æŒ\"é›¶æ‹·è´\"ä¼ è¾“ï¼ŒCPU å ç”¨ç‡å¯é™ä½ 50% ä»¥ä¸Š çµæ´»çš„åŠ¨æ€è·¯ç”±ï¼š å…è®¸å®æ—¶è°ƒæ•´è§†é¢‘æµè·¯å¾„ ç”¨æˆ·å¯é€šè¿‡å›¾å½¢å·¥å…·æ‹–æ‹½èŠ‚ç‚¹å®ç°æµçš„åŠ¨æ€åˆ‡æ¢ æ”¯æŒè‡ªåŠ¨æ•…éšœæ¢å¤å’Œæµçš„åŠ¨æ€è½¬æ¢ 1.3.3 Wayland å±å¹•å…±äº«ä¸ xdg-desktop-portalåœ¨ Wayland ç¯å¢ƒä¸­ï¼Œå±å¹•å…±äº«åŠŸèƒ½æ˜¯é€šè¿‡ xdg-desktop-portal å’Œ PipeWire ååŒå·¥ä½œå®ç°çš„ã€‚è¿™ä¸ X11 æœ‰å¾ˆå¤§çš„ä¸åŒï¼Œåè€…é€šè¿‡å…¶è‡ªèº«çš„æ‰©å±•ï¼ˆå¦‚ X11R6 çš„ XFIXES æ‰©å±•ï¼‰ç›´æ¥è®¿é—®å±å¹•å†…å®¹ã€‚ å·¥ä½œåŸç†ï¼š åœ¨ Wayland ä¸‹ï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºåªèƒ½è®¿é—®è‡ªå·±çš„çª—å£ã€é”®ç›˜é¼ æ ‡äº‹ä»¶ç­‰ï¼Œæ— æ³•éšæ„æˆªå±æˆ–è®¿é—®å…¨å±€èµ„æºã€‚å±å¹•å…±äº«çš„å®Œæ•´æµç¨‹æ˜¯ï¼š åº”ç”¨å‘èµ·è¯·æ±‚ï¼šè§†é¢‘ä¼šè®®è½¯ä»¶è°ƒç”¨ org.freedesktop.portal.ScreenCast æ¥å£ï¼Œè¯·æ±‚å±å¹•å…±äº« ç”¨æˆ·æˆæƒï¼šxdg-desktop-portal æ˜¾ç¤ºåŸç”Ÿå¯¹è¯æ¡†ï¼Œè¯·æ±‚ç”¨æˆ·ç¡®è®¤å…±äº«èŒƒå›´ï¼ˆæ•´ä¸ªå±å¹•/ç‰¹å®šçª—å£/åŒºåŸŸï¼‰ åˆæˆå™¨æä¾›æ•°æ®ï¼šè·å¾—æˆæƒåï¼Œxdg-desktop-portal é€šçŸ¥åˆæˆå™¨ï¼Œåˆæˆå™¨å°†ç›¸åº”çš„å±å¹•å†…å®¹é€šè¿‡ PipeWire æµè¿”å›ç»™ xdg-desktop-portal. PipeWire æµä¼ è¾“ï¼šxdg-desktop-portal å°†æµä¿¡æ¯è¿”å›ç»™åº”ç”¨ï¼Œåº”ç”¨ç¨‹åºé€šè¿‡ PipeWire æ¥æ”¶å±å¹•æ•°æ®è¿›è¡Œå¤„ç†å’Œä¼ è¾“ å¯ä»¥çœ‹åˆ°åº”ç”¨ç¨‹åºåªéœ€è¦å…ˆä¸ xdg-desktop-portal äº¤äº’è·å¾— PipeWire æµä¿¡æ¯ï¼Œç„¶åç›´æ¥è®¿é—® PipeWire, å…¨ç¨‹éƒ½ä¸ç›´æ¥ä¸åˆæˆå™¨äº¤äº’ã€‚ åè®®ä¼˜åŠ¿ï¼š å®‰å…¨æ€§ï¼šåŸºäº xdg-desktop-portal çš„æˆæƒæœºåˆ¶ï¼Œéœ€è¦ç”¨æˆ·æ˜ç¡®åŒæ„ éšç§ä¿æŠ¤ï¼šç”¨æˆ·å¯ä»¥ç²¾ç¡®æ§åˆ¶å…±äº«èŒƒå›´ï¼Œåªå…±äº«ç‰¹å®šçª—å£è€Œéæ•´ä¸ªå±å¹• æ€§èƒ½ï¼šç›´æ¥è®¿é—®åˆæˆå™¨ç¼“å†²åŒºï¼Œé¿å…é¢å¤–çš„å†…å­˜æ‹·è´ å…¼å®¹æ€§ï¼šæ”¯æŒå¤šæ˜¾ç¤ºå™¨ã€ä¸åŒåˆ†è¾¨ç‡å’Œåˆ·æ–°ç‡ æ ‡å‡†åŒ–ï¼šæ‰€æœ‰åº”ç”¨éƒ½ä½¿ç”¨ç›¸åŒçš„ portal æ¥å£ï¼Œç¡®ä¿è·¨æ¡Œé¢ç¯å¢ƒçš„ä¸€è‡´ä½“éªŒ é—¨æˆ·å®ç°è¦æ±‚ï¼š è¦ä½¿ç”¨ Wayland å±å¹•å…±äº«ï¼Œç³»ç»Ÿéœ€è¦å®‰è£… DE/WM æ‰€æ”¯æŒçš„ xdg-desktop-portal å®ç°ã€‚ ä¸»æµåº”ç”¨æ”¯æŒï¼šç›®å‰ä¸»æµçš„ OBSã€Discordã€Zoomã€Chrome/Chromium ç­‰åº”ç”¨éƒ½å·²ç»æ”¯æŒåŸºäº xdg-desktop-portal çš„ Wayland å±å¹•å…±äº«æœºåˆ¶ã€‚ 1.3.4 è§†é¢‘è®¾å¤‡ç®¡ç†æ‘„åƒå¤´è®¾å¤‡ç®¡ç†ï¼š bash # æŸ¥çœ‹ PipeWire è§†é¢‘è®¾å¤‡ pw-cli list-objects | grep -i video # æŸ¥çœ‹ V4L2 è®¾å¤‡ v4l2-ctl --list-devices # æ‘„åƒå¤´æ ¼å¼æŸ¥è¯¢ v4l2-ctl --device=/dev/video0 --list-formats # æ‘„åƒå¤´æƒé™æ£€æŸ¥ ls -l /dev/video* groups $USER # ç¡®è®¤åœ¨ video ç»„ # æµ‹è¯•æ‘„åƒå¤´ ffplay /dev/video0 å±å¹•å…±äº«ç¯å¢ƒé…ç½®ï¼š bash # Wayland ç¯å¢ƒæ£€æŸ¥ echo $WAYLAND_DISPLAY echo $XDG_SESSION_TYPE # è®¾ç½®æ¡Œé¢ç¯å¢ƒæ ‡è¯†ï¼ˆé‡è¦ï¼ï¼‰ export XDG_CURRENT_DESKTOP=sway # æˆ– gnome, kde, xfce ç­‰ # æ£€æŸ¥ PipeWire æœåŠ¡çŠ¶æ€ systemctl --user status pipewire-session-manager systemctl --user status pipewire # æ£€æŸ¥æ¡Œé¢é—¨æˆ·æœåŠ¡ systemctl --user status xdg-desktop-portal systemctl --user status xdg-desktop-portal-wlr # Sway/Hyprland # æˆ– systemctl --user status xdg-desktop-portal-gnome # GNOME 1.3.5 è§†é¢‘æµå¤„ç†é…ç½®PipeWire è§†é¢‘é…ç½®ï¼š NixOS ä¸­å¯é€šè¿‡ services.pipewire.extraConfig.pipewire.\"10-video\".\"context.properties\" æ¥å£°æ˜è¿™éƒ¨åˆ†é…ç½®ã€‚ bash # ç¼–è¾‘ PipeWire ä¸»é…ç½® vim ~/.config/pipewire/pipewire.conf # è§†é¢‘ç›¸å…³é…ç½®ç¤ºä¾‹ context.properties = { # è§†é¢‘ç¼“å†²åŒºé…ç½® default.video.rate = 30 default.video.size = \"1920x1080\" # ç¡¬ä»¶åŠ é€Ÿé…ç½® gstreamer.plugins = [ \"vaapi\" # Intel/AMD GPU ç¡¬ä»¶åŠ é€Ÿ \"nvenc\" # NVIDIA GPU ç¡¬ä»¶åŠ é€Ÿ ] } 1.3.6 è§†é¢‘å¤„ç†æ€§èƒ½ä¼˜åŒ–ç¡¬ä»¶åŠ é€Ÿé…ç½®ï¼š bash # æ£€æŸ¥ç¡¬ä»¶åŠ é€Ÿæ”¯æŒ vainfo # VA-API æ”¯æŒæ£€æŸ¥ nvidia-smi # NVIDIA GPU çŠ¶æ€ # ç¯å¢ƒå˜é‡è®¾ç½® export LIBVA_DRIVER_NAME=i965 # Intel GPU export LIBVA_DRIVER_NAME=radeonsi # AMD GPU export LIBVA_DRIVER_NAME=nvidia # NVIDIA GPU # GStreamer ç¡¬ä»¶åŠ é€Ÿæµ‹è¯• gst-launch-1.0 videotestsrc ! vaapih264enc ! mp4mux ! filesink location=test.mp4 è§†é¢‘ç¼–ç ä¼˜åŒ–ï¼š bash # FFmpeg ç¡¬ä»¶åŠ é€Ÿç¼–ç  ffmpeg -f v4l2 -i /dev/video0 -c:v h264_vaapi -b:v 2M output.mp4 # OBS ç¡¬ä»¶ç¼–ç é…ç½® # è®¾ç½® -\u003e è¾“å‡º -\u003e ç¼–ç å™¨é€‰æ‹© \"FFmpeg VAAPI\" æˆ– \"NVENC\" å†…å­˜å’Œ CPU ä¼˜åŒ–ï¼š bash # è°ƒæ•´è§†é¢‘ç¼“å†²åŒºå¤§å° vim ~/.config/pipewire/pipewire.conf context.properties = { # å‡å°‘è§†é¢‘ç¼“å†²åŒºå»¶è¿Ÿ default.video.quantum = 1/30 # 30fps default.video.min-quantum = 1/30 default.video.max-quantum = 1/15 # æœ€å¤§ 15fps å»¶è¿Ÿ } ","date":"2025-10-19","objectID":"/posts/linux-desktop-4-multimedia-input/:2:3","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Multimedia","Audio","Video","Input Method"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå››ï¼‰ - å¤šåª’ä½“å¤„ç†ä¸ä¸­æ–‡æ”¯æŒ","uri":"/posts/linux-desktop-4-multimedia-input/#132-pipewire-è§†é¢‘å¤„ç†çš„æ ¸å¿ƒä¼˜åŠ¿"},{"categories":["tech"],"content":" 1.3 è§†é¢‘å¤„ç†ä¸å±å¹•å…±äº« 1.3.1 ä¸ºä»€ä¹ˆ PipeWire è¦æ”¯æŒè§†é¢‘æµå¤„ç†ï¼Ÿä¼ ç»Ÿ Linux ç³»ç»Ÿä¸­ï¼ŒéŸ³é¢‘å’Œè§†é¢‘å¤„ç†é•¿æœŸå¤„äº\"å„è‡ªä¸ºæˆ˜\"çš„çŠ¶æ€ï¼š éŸ³é¢‘ï¼šç”± PulseAudioï¼ˆæ¡Œé¢ï¼‰ã€JACKï¼ˆä¸“ä¸šï¼‰ç­‰ç³»ç»Ÿè´Ÿè´£ è§†é¢‘ï¼šä¾èµ– V4L2ï¼ˆæ‘„åƒå¤´æ•è·ï¼‰ã€X11/Waylandï¼ˆå±å¹•æˆªå›¾ï¼‰ã€GStreamerï¼ˆæµå¤„ç†ï¼‰ã€FFmpegï¼ˆç¼–è§£ç ï¼‰ç­‰åˆ†æ•£ç»„ä»¶ è¿™ç§ç¢ç‰‡åŒ–å¯¼è‡´äº†è¯¸å¤šé—®é¢˜ï¼š è·¨åº”ç”¨åŒæ­¥å›°éš¾ï¼šç›´æ’­æ—¶éº¦å…‹é£å£°éŸ³ä¸æ‘„åƒå¤´ç”»é¢å»¶è¿Ÿä¸ä¸€è‡´ æƒé™ç®¡ç†æ··ä¹±ï¼šæ²™ç›’åº”ç”¨å¦‚ Flatpak è®¿é—®æ‘„åƒå¤´/å±å¹•éœ€å•ç‹¬é€‚é… ç°ä»£åœºæ™¯æ”¯æŒä¸è¶³ï¼šWayland ä¸‹çš„å±å¹•å…±äº«ã€HDR è§†é¢‘æ¸²æŸ“ç¼ºä¹ç»Ÿä¸€æ”¯æŒ ç¡¬ä»¶åŠ é€Ÿå¤æ‚ï¼šGPU ç¼–è§£ç éœ€å„ç»„ä»¶å•ç‹¬å¯¹æ¥ï¼Œå…¼å®¹æ€§å·® PipeWire çš„è®¾è®¡åˆè¡·å°±æ˜¯æ‰“ç ´è¿™ç§å‰²è£‚ï¼šé€šè¿‡ä¸€å¥—ç»Ÿä¸€çš„æ¡†æ¶åŒæ—¶ç®¡ç†éŸ³é¢‘å’Œè§†é¢‘æµï¼Œè®©\"éŸ³é¢‘+ è§†é¢‘\"çš„åä½œï¼ˆå¦‚ä¼šè®®è½¯ä»¶åŒæ—¶æ•è·éº¦å…‹é£å’Œæ‘„åƒå¤´ã€ç›´æ’­å·¥å…·æ··åˆæ¸¸æˆç”»é¢ä¸è§£è¯´å£°éŸ³ï¼‰å˜å¾—ç®€å•é«˜æ•ˆã€‚å› æ­¤ï¼Œè§†é¢‘å¤„ç†æ˜¯å…¶\"ç»Ÿä¸€å¤šåª’ä½“ç®¡é“\"ç›®æ ‡çš„è‡ªç„¶å»¶ä¼¸ã€‚ 1.3.2 PipeWire è§†é¢‘å¤„ç†çš„æ ¸å¿ƒä¼˜åŠ¿PipeWire ä½œä¸ºç°ä»£ Linux æ¡Œé¢ç³»ç»Ÿçš„å¤šåª’ä½“æ¡†æ¶ï¼Œç›¸æ¯”ä¼ ç»Ÿæ–¹æ¡ˆå…·æœ‰ä»¥ä¸‹æ ¸å¿ƒä¼˜åŠ¿ï¼š ç»Ÿä¸€çš„\"ç®¡é“\"æ¨¡å‹ï¼š éŸ³é¢‘æµå’Œè§†é¢‘æµéƒ½è¢«æŠ½è±¡ä¸º\"èŠ‚ç‚¹\" é€šè¿‡ç»Ÿä¸€çš„\"èŠ‚ç‚¹-ç«¯å£-è¿æ¥\"æ¨¡å‹å®ç°è·¨åº”ç”¨çš„éŸ³è§†é¢‘æ··åˆ æ¡†æ¶å†…ç½®æ—¶é—´æˆ³åŒæ­¥æœºåˆ¶ï¼Œç¡®ä¿éŸ³è§†é¢‘æµå§‹ç»ˆä¿æŒæ—¶åºä¸€è‡´ï¼ˆå»¶è¿Ÿè¯¯å·®å¯æ§åˆ¶åœ¨æ¯«ç§’çº§ï¼‰ åŸç”Ÿé€‚é…ç°ä»£æ¡Œé¢åè®®ï¼š ä½œä¸º Wayland å®˜æ–¹æ¨èçš„å¤šåª’ä½“ä¸­é—´å±‚ é€šè¿‡ä¸ xdg-desktop-portal æ¡†æ¶ååŒå·¥ä½œï¼Œå®ç°æ ‡å‡†åŒ–çš„\"æˆæƒå¼\"å±å¹•å…±äº« æ”¯æŒ HDR è§†é¢‘å’Œé«˜åˆ†è¾¨ç‡æµä¼ è¾“ï¼Œæ€§èƒ½æŸè€—è¿œä½äºä¼ ç»Ÿ X11 æˆªå›¾ éµå¾ª Wayland å®‰å…¨éš”ç¦»åŸåˆ™ï¼Œæ‰€æœ‰è·¨åº”ç”¨èµ„æºè®¿é—®éƒ½é€šè¿‡ç”¨æˆ·æˆæƒçš„é—¨æˆ·æ¥å£ ç®€åŒ–æ²™ç›’åº”ç”¨æƒé™ï¼š é€šè¿‡ Polkit æƒé™ç³»ç»Ÿé›†ä¸­ç®¡ç†è®¾å¤‡è®¿é—® æ²™ç›’åº”ç”¨æ— éœ€ç›´æ¥æ“ä½œç¡¬ä»¶è®¾å¤‡ï¼Œåªéœ€é€šè¿‡ PipeWire API è¯·æ±‚æµæ•°æ® æ”¯æŒåŠ¨æ€æƒé™è°ƒæ•´ é«˜æ•ˆç¡¬ä»¶åŠ é€Ÿæ•´åˆï¼š å†…ç½®ç»Ÿä¸€çš„ç¡¬ä»¶åŠ é€ŸæŠ½è±¡å±‚ é€šè¿‡ GStreamer æˆ– FFmpeg åç«¯è‡ªåŠ¨é€‚é…åº•å±‚ç¡¬ä»¶åŠ é€Ÿæ¥å£ æ”¯æŒ\"é›¶æ‹·è´\"ä¼ è¾“ï¼ŒCPU å ç”¨ç‡å¯é™ä½ 50% ä»¥ä¸Š çµæ´»çš„åŠ¨æ€è·¯ç”±ï¼š å…è®¸å®æ—¶è°ƒæ•´è§†é¢‘æµè·¯å¾„ ç”¨æˆ·å¯é€šè¿‡å›¾å½¢å·¥å…·æ‹–æ‹½èŠ‚ç‚¹å®ç°æµçš„åŠ¨æ€åˆ‡æ¢ æ”¯æŒè‡ªåŠ¨æ•…éšœæ¢å¤å’Œæµçš„åŠ¨æ€è½¬æ¢ 1.3.3 Wayland å±å¹•å…±äº«ä¸ xdg-desktop-portalåœ¨ Wayland ç¯å¢ƒä¸­ï¼Œå±å¹•å…±äº«åŠŸèƒ½æ˜¯é€šè¿‡ xdg-desktop-portal å’Œ PipeWire ååŒå·¥ä½œå®ç°çš„ã€‚è¿™ä¸ X11 æœ‰å¾ˆå¤§çš„ä¸åŒï¼Œåè€…é€šè¿‡å…¶è‡ªèº«çš„æ‰©å±•ï¼ˆå¦‚ X11R6 çš„ XFIXES æ‰©å±•ï¼‰ç›´æ¥è®¿é—®å±å¹•å†…å®¹ã€‚ å·¥ä½œåŸç†ï¼š åœ¨ Wayland ä¸‹ï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºåªèƒ½è®¿é—®è‡ªå·±çš„çª—å£ã€é”®ç›˜é¼ æ ‡äº‹ä»¶ç­‰ï¼Œæ— æ³•éšæ„æˆªå±æˆ–è®¿é—®å…¨å±€èµ„æºã€‚å±å¹•å…±äº«çš„å®Œæ•´æµç¨‹æ˜¯ï¼š åº”ç”¨å‘èµ·è¯·æ±‚ï¼šè§†é¢‘ä¼šè®®è½¯ä»¶è°ƒç”¨ org.freedesktop.portal.ScreenCast æ¥å£ï¼Œè¯·æ±‚å±å¹•å…±äº« ç”¨æˆ·æˆæƒï¼šxdg-desktop-portal æ˜¾ç¤ºåŸç”Ÿå¯¹è¯æ¡†ï¼Œè¯·æ±‚ç”¨æˆ·ç¡®è®¤å…±äº«èŒƒå›´ï¼ˆæ•´ä¸ªå±å¹•/ç‰¹å®šçª—å£/åŒºåŸŸï¼‰ åˆæˆå™¨æä¾›æ•°æ®ï¼šè·å¾—æˆæƒåï¼Œxdg-desktop-portal é€šçŸ¥åˆæˆå™¨ï¼Œåˆæˆå™¨å°†ç›¸åº”çš„å±å¹•å†…å®¹é€šè¿‡ PipeWire æµè¿”å›ç»™ xdg-desktop-portal. PipeWire æµä¼ è¾“ï¼šxdg-desktop-portal å°†æµä¿¡æ¯è¿”å›ç»™åº”ç”¨ï¼Œåº”ç”¨ç¨‹åºé€šè¿‡ PipeWire æ¥æ”¶å±å¹•æ•°æ®è¿›è¡Œå¤„ç†å’Œä¼ è¾“ å¯ä»¥çœ‹åˆ°åº”ç”¨ç¨‹åºåªéœ€è¦å…ˆä¸ xdg-desktop-portal äº¤äº’è·å¾— PipeWire æµä¿¡æ¯ï¼Œç„¶åç›´æ¥è®¿é—® PipeWire, å…¨ç¨‹éƒ½ä¸ç›´æ¥ä¸åˆæˆå™¨äº¤äº’ã€‚ åè®®ä¼˜åŠ¿ï¼š å®‰å…¨æ€§ï¼šåŸºäº xdg-desktop-portal çš„æˆæƒæœºåˆ¶ï¼Œéœ€è¦ç”¨æˆ·æ˜ç¡®åŒæ„ éšç§ä¿æŠ¤ï¼šç”¨æˆ·å¯ä»¥ç²¾ç¡®æ§åˆ¶å…±äº«èŒƒå›´ï¼Œåªå…±äº«ç‰¹å®šçª—å£è€Œéæ•´ä¸ªå±å¹• æ€§èƒ½ï¼šç›´æ¥è®¿é—®åˆæˆå™¨ç¼“å†²åŒºï¼Œé¿å…é¢å¤–çš„å†…å­˜æ‹·è´ å…¼å®¹æ€§ï¼šæ”¯æŒå¤šæ˜¾ç¤ºå™¨ã€ä¸åŒåˆ†è¾¨ç‡å’Œåˆ·æ–°ç‡ æ ‡å‡†åŒ–ï¼šæ‰€æœ‰åº”ç”¨éƒ½ä½¿ç”¨ç›¸åŒçš„ portal æ¥å£ï¼Œç¡®ä¿è·¨æ¡Œé¢ç¯å¢ƒçš„ä¸€è‡´ä½“éªŒ é—¨æˆ·å®ç°è¦æ±‚ï¼š è¦ä½¿ç”¨ Wayland å±å¹•å…±äº«ï¼Œç³»ç»Ÿéœ€è¦å®‰è£… DE/WM æ‰€æ”¯æŒçš„ xdg-desktop-portal å®ç°ã€‚ ä¸»æµåº”ç”¨æ”¯æŒï¼šç›®å‰ä¸»æµçš„ OBSã€Discordã€Zoomã€Chrome/Chromium ç­‰åº”ç”¨éƒ½å·²ç»æ”¯æŒåŸºäº xdg-desktop-portal çš„ Wayland å±å¹•å…±äº«æœºåˆ¶ã€‚ 1.3.4 è§†é¢‘è®¾å¤‡ç®¡ç†æ‘„åƒå¤´è®¾å¤‡ç®¡ç†ï¼š bash # æŸ¥çœ‹ PipeWire è§†é¢‘è®¾å¤‡ pw-cli list-objects | grep -i video # æŸ¥çœ‹ V4L2 è®¾å¤‡ v4l2-ctl --list-devices # æ‘„åƒå¤´æ ¼å¼æŸ¥è¯¢ v4l2-ctl --device=/dev/video0 --list-formats # æ‘„åƒå¤´æƒé™æ£€æŸ¥ ls -l /dev/video* groups $USER # ç¡®è®¤åœ¨ video ç»„ # æµ‹è¯•æ‘„åƒå¤´ ffplay /dev/video0 å±å¹•å…±äº«ç¯å¢ƒé…ç½®ï¼š bash # Wayland ç¯å¢ƒæ£€æŸ¥ echo $WAYLAND_DISPLAY echo $XDG_SESSION_TYPE # è®¾ç½®æ¡Œé¢ç¯å¢ƒæ ‡è¯†ï¼ˆé‡è¦ï¼ï¼‰ export XDG_CURRENT_DESKTOP=sway # æˆ– gnome, kde, xfce ç­‰ # æ£€æŸ¥ PipeWire æœåŠ¡çŠ¶æ€ systemctl --user status pipewire-session-manager systemctl --user status pipewire # æ£€æŸ¥æ¡Œé¢é—¨æˆ·æœåŠ¡ systemctl --user status xdg-desktop-portal systemctl --user status xdg-desktop-portal-wlr # Sway/Hyprland # æˆ– systemctl --user status xdg-desktop-portal-gnome # GNOME 1.3.5 è§†é¢‘æµå¤„ç†é…ç½®PipeWire è§†é¢‘é…ç½®ï¼š NixOS ä¸­å¯é€šè¿‡ services.pipewire.extraConfig.pipewire.\"10-video\".\"context.properties\" æ¥å£°æ˜è¿™éƒ¨åˆ†é…ç½®ã€‚ bash # ç¼–è¾‘ PipeWire ä¸»é…ç½® vim ~/.config/pipewire/pipewire.conf # è§†é¢‘ç›¸å…³é…ç½®ç¤ºä¾‹ context.properties = { # è§†é¢‘ç¼“å†²åŒºé…ç½® default.video.rate = 30 default.video.size = \"1920x1080\" # ç¡¬ä»¶åŠ é€Ÿé…ç½® gstreamer.plugins = [ \"vaapi\" # Intel/AMD GPU ç¡¬ä»¶åŠ é€Ÿ \"nvenc\" # NVIDIA GPU ç¡¬ä»¶åŠ é€Ÿ ] } 1.3.6 è§†é¢‘å¤„ç†æ€§èƒ½ä¼˜åŒ–ç¡¬ä»¶åŠ é€Ÿé…ç½®ï¼š bash # æ£€æŸ¥ç¡¬ä»¶åŠ é€Ÿæ”¯æŒ vainfo # VA-API æ”¯æŒæ£€æŸ¥ nvidia-smi # NVIDIA GPU çŠ¶æ€ # ç¯å¢ƒå˜é‡è®¾ç½® export LIBVA_DRIVER_NAME=i965 # Intel GPU export LIBVA_DRIVER_NAME=radeonsi # AMD GPU export LIBVA_DRIVER_NAME=nvidia # NVIDIA GPU # GStreamer ç¡¬ä»¶åŠ é€Ÿæµ‹è¯• gst-launch-1.0 videotestsrc ! vaapih264enc ! mp4mux ! filesink location=test.mp4 è§†é¢‘ç¼–ç ä¼˜åŒ–ï¼š bash # FFmpeg ç¡¬ä»¶åŠ é€Ÿç¼–ç  ffmpeg -f v4l2 -i /dev/video0 -c:v h264_vaapi -b:v 2M output.mp4 # OBS ç¡¬ä»¶ç¼–ç é…ç½® # è®¾ç½® -\u003e è¾“å‡º -\u003e ç¼–ç å™¨é€‰æ‹© \"FFmpeg VAAPI\" æˆ– \"NVENC\" å†…å­˜å’Œ CPU ä¼˜åŒ–ï¼š bash # è°ƒæ•´è§†é¢‘ç¼“å†²åŒºå¤§å° vim ~/.config/pipewire/pipewire.conf context.properties = { # å‡å°‘è§†é¢‘ç¼“å†²åŒºå»¶è¿Ÿ default.video.quantum = 1/30 # 30fps default.video.min-quantum = 1/30 default.video.max-quantum = 1/15 # æœ€å¤§ 15fps å»¶è¿Ÿ } ","date":"2025-10-19","objectID":"/posts/linux-desktop-4-multimedia-input/:2:3","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Multimedia","Audio","Video","Input Method"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå››ï¼‰ - å¤šåª’ä½“å¤„ç†ä¸ä¸­æ–‡æ”¯æŒ","uri":"/posts/linux-desktop-4-multimedia-input/#133-wayland-å±å¹•å…±äº«ä¸-xdg-desktop-portal"},{"categories":["tech"],"content":" 1.3 è§†é¢‘å¤„ç†ä¸å±å¹•å…±äº« 1.3.1 ä¸ºä»€ä¹ˆ PipeWire è¦æ”¯æŒè§†é¢‘æµå¤„ç†ï¼Ÿä¼ ç»Ÿ Linux ç³»ç»Ÿä¸­ï¼ŒéŸ³é¢‘å’Œè§†é¢‘å¤„ç†é•¿æœŸå¤„äº\"å„è‡ªä¸ºæˆ˜\"çš„çŠ¶æ€ï¼š éŸ³é¢‘ï¼šç”± PulseAudioï¼ˆæ¡Œé¢ï¼‰ã€JACKï¼ˆä¸“ä¸šï¼‰ç­‰ç³»ç»Ÿè´Ÿè´£ è§†é¢‘ï¼šä¾èµ– V4L2ï¼ˆæ‘„åƒå¤´æ•è·ï¼‰ã€X11/Waylandï¼ˆå±å¹•æˆªå›¾ï¼‰ã€GStreamerï¼ˆæµå¤„ç†ï¼‰ã€FFmpegï¼ˆç¼–è§£ç ï¼‰ç­‰åˆ†æ•£ç»„ä»¶ è¿™ç§ç¢ç‰‡åŒ–å¯¼è‡´äº†è¯¸å¤šé—®é¢˜ï¼š è·¨åº”ç”¨åŒæ­¥å›°éš¾ï¼šç›´æ’­æ—¶éº¦å…‹é£å£°éŸ³ä¸æ‘„åƒå¤´ç”»é¢å»¶è¿Ÿä¸ä¸€è‡´ æƒé™ç®¡ç†æ··ä¹±ï¼šæ²™ç›’åº”ç”¨å¦‚ Flatpak è®¿é—®æ‘„åƒå¤´/å±å¹•éœ€å•ç‹¬é€‚é… ç°ä»£åœºæ™¯æ”¯æŒä¸è¶³ï¼šWayland ä¸‹çš„å±å¹•å…±äº«ã€HDR è§†é¢‘æ¸²æŸ“ç¼ºä¹ç»Ÿä¸€æ”¯æŒ ç¡¬ä»¶åŠ é€Ÿå¤æ‚ï¼šGPU ç¼–è§£ç éœ€å„ç»„ä»¶å•ç‹¬å¯¹æ¥ï¼Œå…¼å®¹æ€§å·® PipeWire çš„è®¾è®¡åˆè¡·å°±æ˜¯æ‰“ç ´è¿™ç§å‰²è£‚ï¼šé€šè¿‡ä¸€å¥—ç»Ÿä¸€çš„æ¡†æ¶åŒæ—¶ç®¡ç†éŸ³é¢‘å’Œè§†é¢‘æµï¼Œè®©\"éŸ³é¢‘+ è§†é¢‘\"çš„åä½œï¼ˆå¦‚ä¼šè®®è½¯ä»¶åŒæ—¶æ•è·éº¦å…‹é£å’Œæ‘„åƒå¤´ã€ç›´æ’­å·¥å…·æ··åˆæ¸¸æˆç”»é¢ä¸è§£è¯´å£°éŸ³ï¼‰å˜å¾—ç®€å•é«˜æ•ˆã€‚å› æ­¤ï¼Œè§†é¢‘å¤„ç†æ˜¯å…¶\"ç»Ÿä¸€å¤šåª’ä½“ç®¡é“\"ç›®æ ‡çš„è‡ªç„¶å»¶ä¼¸ã€‚ 1.3.2 PipeWire è§†é¢‘å¤„ç†çš„æ ¸å¿ƒä¼˜åŠ¿PipeWire ä½œä¸ºç°ä»£ Linux æ¡Œé¢ç³»ç»Ÿçš„å¤šåª’ä½“æ¡†æ¶ï¼Œç›¸æ¯”ä¼ ç»Ÿæ–¹æ¡ˆå…·æœ‰ä»¥ä¸‹æ ¸å¿ƒä¼˜åŠ¿ï¼š ç»Ÿä¸€çš„\"ç®¡é“\"æ¨¡å‹ï¼š éŸ³é¢‘æµå’Œè§†é¢‘æµéƒ½è¢«æŠ½è±¡ä¸º\"èŠ‚ç‚¹\" é€šè¿‡ç»Ÿä¸€çš„\"èŠ‚ç‚¹-ç«¯å£-è¿æ¥\"æ¨¡å‹å®ç°è·¨åº”ç”¨çš„éŸ³è§†é¢‘æ··åˆ æ¡†æ¶å†…ç½®æ—¶é—´æˆ³åŒæ­¥æœºåˆ¶ï¼Œç¡®ä¿éŸ³è§†é¢‘æµå§‹ç»ˆä¿æŒæ—¶åºä¸€è‡´ï¼ˆå»¶è¿Ÿè¯¯å·®å¯æ§åˆ¶åœ¨æ¯«ç§’çº§ï¼‰ åŸç”Ÿé€‚é…ç°ä»£æ¡Œé¢åè®®ï¼š ä½œä¸º Wayland å®˜æ–¹æ¨èçš„å¤šåª’ä½“ä¸­é—´å±‚ é€šè¿‡ä¸ xdg-desktop-portal æ¡†æ¶ååŒå·¥ä½œï¼Œå®ç°æ ‡å‡†åŒ–çš„\"æˆæƒå¼\"å±å¹•å…±äº« æ”¯æŒ HDR è§†é¢‘å’Œé«˜åˆ†è¾¨ç‡æµä¼ è¾“ï¼Œæ€§èƒ½æŸè€—è¿œä½äºä¼ ç»Ÿ X11 æˆªå›¾ éµå¾ª Wayland å®‰å…¨éš”ç¦»åŸåˆ™ï¼Œæ‰€æœ‰è·¨åº”ç”¨èµ„æºè®¿é—®éƒ½é€šè¿‡ç”¨æˆ·æˆæƒçš„é—¨æˆ·æ¥å£ ç®€åŒ–æ²™ç›’åº”ç”¨æƒé™ï¼š é€šè¿‡ Polkit æƒé™ç³»ç»Ÿé›†ä¸­ç®¡ç†è®¾å¤‡è®¿é—® æ²™ç›’åº”ç”¨æ— éœ€ç›´æ¥æ“ä½œç¡¬ä»¶è®¾å¤‡ï¼Œåªéœ€é€šè¿‡ PipeWire API è¯·æ±‚æµæ•°æ® æ”¯æŒåŠ¨æ€æƒé™è°ƒæ•´ é«˜æ•ˆç¡¬ä»¶åŠ é€Ÿæ•´åˆï¼š å†…ç½®ç»Ÿä¸€çš„ç¡¬ä»¶åŠ é€ŸæŠ½è±¡å±‚ é€šè¿‡ GStreamer æˆ– FFmpeg åç«¯è‡ªåŠ¨é€‚é…åº•å±‚ç¡¬ä»¶åŠ é€Ÿæ¥å£ æ”¯æŒ\"é›¶æ‹·è´\"ä¼ è¾“ï¼ŒCPU å ç”¨ç‡å¯é™ä½ 50% ä»¥ä¸Š çµæ´»çš„åŠ¨æ€è·¯ç”±ï¼š å…è®¸å®æ—¶è°ƒæ•´è§†é¢‘æµè·¯å¾„ ç”¨æˆ·å¯é€šè¿‡å›¾å½¢å·¥å…·æ‹–æ‹½èŠ‚ç‚¹å®ç°æµçš„åŠ¨æ€åˆ‡æ¢ æ”¯æŒè‡ªåŠ¨æ•…éšœæ¢å¤å’Œæµçš„åŠ¨æ€è½¬æ¢ 1.3.3 Wayland å±å¹•å…±äº«ä¸ xdg-desktop-portalåœ¨ Wayland ç¯å¢ƒä¸­ï¼Œå±å¹•å…±äº«åŠŸèƒ½æ˜¯é€šè¿‡ xdg-desktop-portal å’Œ PipeWire ååŒå·¥ä½œå®ç°çš„ã€‚è¿™ä¸ X11 æœ‰å¾ˆå¤§çš„ä¸åŒï¼Œåè€…é€šè¿‡å…¶è‡ªèº«çš„æ‰©å±•ï¼ˆå¦‚ X11R6 çš„ XFIXES æ‰©å±•ï¼‰ç›´æ¥è®¿é—®å±å¹•å†…å®¹ã€‚ å·¥ä½œåŸç†ï¼š åœ¨ Wayland ä¸‹ï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºåªèƒ½è®¿é—®è‡ªå·±çš„çª—å£ã€é”®ç›˜é¼ æ ‡äº‹ä»¶ç­‰ï¼Œæ— æ³•éšæ„æˆªå±æˆ–è®¿é—®å…¨å±€èµ„æºã€‚å±å¹•å…±äº«çš„å®Œæ•´æµç¨‹æ˜¯ï¼š åº”ç”¨å‘èµ·è¯·æ±‚ï¼šè§†é¢‘ä¼šè®®è½¯ä»¶è°ƒç”¨ org.freedesktop.portal.ScreenCast æ¥å£ï¼Œè¯·æ±‚å±å¹•å…±äº« ç”¨æˆ·æˆæƒï¼šxdg-desktop-portal æ˜¾ç¤ºåŸç”Ÿå¯¹è¯æ¡†ï¼Œè¯·æ±‚ç”¨æˆ·ç¡®è®¤å…±äº«èŒƒå›´ï¼ˆæ•´ä¸ªå±å¹•/ç‰¹å®šçª—å£/åŒºåŸŸï¼‰ åˆæˆå™¨æä¾›æ•°æ®ï¼šè·å¾—æˆæƒåï¼Œxdg-desktop-portal é€šçŸ¥åˆæˆå™¨ï¼Œåˆæˆå™¨å°†ç›¸åº”çš„å±å¹•å†…å®¹é€šè¿‡ PipeWire æµè¿”å›ç»™ xdg-desktop-portal. PipeWire æµä¼ è¾“ï¼šxdg-desktop-portal å°†æµä¿¡æ¯è¿”å›ç»™åº”ç”¨ï¼Œåº”ç”¨ç¨‹åºé€šè¿‡ PipeWire æ¥æ”¶å±å¹•æ•°æ®è¿›è¡Œå¤„ç†å’Œä¼ è¾“ å¯ä»¥çœ‹åˆ°åº”ç”¨ç¨‹åºåªéœ€è¦å…ˆä¸ xdg-desktop-portal äº¤äº’è·å¾— PipeWire æµä¿¡æ¯ï¼Œç„¶åç›´æ¥è®¿é—® PipeWire, å…¨ç¨‹éƒ½ä¸ç›´æ¥ä¸åˆæˆå™¨äº¤äº’ã€‚ åè®®ä¼˜åŠ¿ï¼š å®‰å…¨æ€§ï¼šåŸºäº xdg-desktop-portal çš„æˆæƒæœºåˆ¶ï¼Œéœ€è¦ç”¨æˆ·æ˜ç¡®åŒæ„ éšç§ä¿æŠ¤ï¼šç”¨æˆ·å¯ä»¥ç²¾ç¡®æ§åˆ¶å…±äº«èŒƒå›´ï¼Œåªå…±äº«ç‰¹å®šçª—å£è€Œéæ•´ä¸ªå±å¹• æ€§èƒ½ï¼šç›´æ¥è®¿é—®åˆæˆå™¨ç¼“å†²åŒºï¼Œé¿å…é¢å¤–çš„å†…å­˜æ‹·è´ å…¼å®¹æ€§ï¼šæ”¯æŒå¤šæ˜¾ç¤ºå™¨ã€ä¸åŒåˆ†è¾¨ç‡å’Œåˆ·æ–°ç‡ æ ‡å‡†åŒ–ï¼šæ‰€æœ‰åº”ç”¨éƒ½ä½¿ç”¨ç›¸åŒçš„ portal æ¥å£ï¼Œç¡®ä¿è·¨æ¡Œé¢ç¯å¢ƒçš„ä¸€è‡´ä½“éªŒ é—¨æˆ·å®ç°è¦æ±‚ï¼š è¦ä½¿ç”¨ Wayland å±å¹•å…±äº«ï¼Œç³»ç»Ÿéœ€è¦å®‰è£… DE/WM æ‰€æ”¯æŒçš„ xdg-desktop-portal å®ç°ã€‚ ä¸»æµåº”ç”¨æ”¯æŒï¼šç›®å‰ä¸»æµçš„ OBSã€Discordã€Zoomã€Chrome/Chromium ç­‰åº”ç”¨éƒ½å·²ç»æ”¯æŒåŸºäº xdg-desktop-portal çš„ Wayland å±å¹•å…±äº«æœºåˆ¶ã€‚ 1.3.4 è§†é¢‘è®¾å¤‡ç®¡ç†æ‘„åƒå¤´è®¾å¤‡ç®¡ç†ï¼š bash # æŸ¥çœ‹ PipeWire è§†é¢‘è®¾å¤‡ pw-cli list-objects | grep -i video # æŸ¥çœ‹ V4L2 è®¾å¤‡ v4l2-ctl --list-devices # æ‘„åƒå¤´æ ¼å¼æŸ¥è¯¢ v4l2-ctl --device=/dev/video0 --list-formats # æ‘„åƒå¤´æƒé™æ£€æŸ¥ ls -l /dev/video* groups $USER # ç¡®è®¤åœ¨ video ç»„ # æµ‹è¯•æ‘„åƒå¤´ ffplay /dev/video0 å±å¹•å…±äº«ç¯å¢ƒé…ç½®ï¼š bash # Wayland ç¯å¢ƒæ£€æŸ¥ echo $WAYLAND_DISPLAY echo $XDG_SESSION_TYPE # è®¾ç½®æ¡Œé¢ç¯å¢ƒæ ‡è¯†ï¼ˆé‡è¦ï¼ï¼‰ export XDG_CURRENT_DESKTOP=sway # æˆ– gnome, kde, xfce ç­‰ # æ£€æŸ¥ PipeWire æœåŠ¡çŠ¶æ€ systemctl --user status pipewire-session-manager systemctl --user status pipewire # æ£€æŸ¥æ¡Œé¢é—¨æˆ·æœåŠ¡ systemctl --user status xdg-desktop-portal systemctl --user status xdg-desktop-portal-wlr # Sway/Hyprland # æˆ– systemctl --user status xdg-desktop-portal-gnome # GNOME 1.3.5 è§†é¢‘æµå¤„ç†é…ç½®PipeWire è§†é¢‘é…ç½®ï¼š NixOS ä¸­å¯é€šè¿‡ services.pipewire.extraConfig.pipewire.\"10-video\".\"context.properties\" æ¥å£°æ˜è¿™éƒ¨åˆ†é…ç½®ã€‚ bash # ç¼–è¾‘ PipeWire ä¸»é…ç½® vim ~/.config/pipewire/pipewire.conf # è§†é¢‘ç›¸å…³é…ç½®ç¤ºä¾‹ context.properties = { # è§†é¢‘ç¼“å†²åŒºé…ç½® default.video.rate = 30 default.video.size = \"1920x1080\" # ç¡¬ä»¶åŠ é€Ÿé…ç½® gstreamer.plugins = [ \"vaapi\" # Intel/AMD GPU ç¡¬ä»¶åŠ é€Ÿ \"nvenc\" # NVIDIA GPU ç¡¬ä»¶åŠ é€Ÿ ] } 1.3.6 è§†é¢‘å¤„ç†æ€§èƒ½ä¼˜åŒ–ç¡¬ä»¶åŠ é€Ÿé…ç½®ï¼š bash # æ£€æŸ¥ç¡¬ä»¶åŠ é€Ÿæ”¯æŒ vainfo # VA-API æ”¯æŒæ£€æŸ¥ nvidia-smi # NVIDIA GPU çŠ¶æ€ # ç¯å¢ƒå˜é‡è®¾ç½® export LIBVA_DRIVER_NAME=i965 # Intel GPU export LIBVA_DRIVER_NAME=radeonsi # AMD GPU export LIBVA_DRIVER_NAME=nvidia # NVIDIA GPU # GStreamer ç¡¬ä»¶åŠ é€Ÿæµ‹è¯• gst-launch-1.0 videotestsrc ! vaapih264enc ! mp4mux ! filesink location=test.mp4 è§†é¢‘ç¼–ç ä¼˜åŒ–ï¼š bash # FFmpeg ç¡¬ä»¶åŠ é€Ÿç¼–ç  ffmpeg -f v4l2 -i /dev/video0 -c:v h264_vaapi -b:v 2M output.mp4 # OBS ç¡¬ä»¶ç¼–ç é…ç½® # è®¾ç½® -\u003e è¾“å‡º -\u003e ç¼–ç å™¨é€‰æ‹© \"FFmpeg VAAPI\" æˆ– \"NVENC\" å†…å­˜å’Œ CPU ä¼˜åŒ–ï¼š bash # è°ƒæ•´è§†é¢‘ç¼“å†²åŒºå¤§å° vim ~/.config/pipewire/pipewire.conf context.properties = { # å‡å°‘è§†é¢‘ç¼“å†²åŒºå»¶è¿Ÿ default.video.quantum = 1/30 # 30fps default.video.min-quantum = 1/30 default.video.max-quantum = 1/15 # æœ€å¤§ 15fps å»¶è¿Ÿ } ","date":"2025-10-19","objectID":"/posts/linux-desktop-4-multimedia-input/:2:3","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Multimedia","Audio","Video","Input Method"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå››ï¼‰ - å¤šåª’ä½“å¤„ç†ä¸ä¸­æ–‡æ”¯æŒ","uri":"/posts/linux-desktop-4-multimedia-input/#134-è§†é¢‘è®¾å¤‡ç®¡ç†"},{"categories":["tech"],"content":" 1.3 è§†é¢‘å¤„ç†ä¸å±å¹•å…±äº« 1.3.1 ä¸ºä»€ä¹ˆ PipeWire è¦æ”¯æŒè§†é¢‘æµå¤„ç†ï¼Ÿä¼ ç»Ÿ Linux ç³»ç»Ÿä¸­ï¼ŒéŸ³é¢‘å’Œè§†é¢‘å¤„ç†é•¿æœŸå¤„äº\"å„è‡ªä¸ºæˆ˜\"çš„çŠ¶æ€ï¼š éŸ³é¢‘ï¼šç”± PulseAudioï¼ˆæ¡Œé¢ï¼‰ã€JACKï¼ˆä¸“ä¸šï¼‰ç­‰ç³»ç»Ÿè´Ÿè´£ è§†é¢‘ï¼šä¾èµ– V4L2ï¼ˆæ‘„åƒå¤´æ•è·ï¼‰ã€X11/Waylandï¼ˆå±å¹•æˆªå›¾ï¼‰ã€GStreamerï¼ˆæµå¤„ç†ï¼‰ã€FFmpegï¼ˆç¼–è§£ç ï¼‰ç­‰åˆ†æ•£ç»„ä»¶ è¿™ç§ç¢ç‰‡åŒ–å¯¼è‡´äº†è¯¸å¤šé—®é¢˜ï¼š è·¨åº”ç”¨åŒæ­¥å›°éš¾ï¼šç›´æ’­æ—¶éº¦å…‹é£å£°éŸ³ä¸æ‘„åƒå¤´ç”»é¢å»¶è¿Ÿä¸ä¸€è‡´ æƒé™ç®¡ç†æ··ä¹±ï¼šæ²™ç›’åº”ç”¨å¦‚ Flatpak è®¿é—®æ‘„åƒå¤´/å±å¹•éœ€å•ç‹¬é€‚é… ç°ä»£åœºæ™¯æ”¯æŒä¸è¶³ï¼šWayland ä¸‹çš„å±å¹•å…±äº«ã€HDR è§†é¢‘æ¸²æŸ“ç¼ºä¹ç»Ÿä¸€æ”¯æŒ ç¡¬ä»¶åŠ é€Ÿå¤æ‚ï¼šGPU ç¼–è§£ç éœ€å„ç»„ä»¶å•ç‹¬å¯¹æ¥ï¼Œå…¼å®¹æ€§å·® PipeWire çš„è®¾è®¡åˆè¡·å°±æ˜¯æ‰“ç ´è¿™ç§å‰²è£‚ï¼šé€šè¿‡ä¸€å¥—ç»Ÿä¸€çš„æ¡†æ¶åŒæ—¶ç®¡ç†éŸ³é¢‘å’Œè§†é¢‘æµï¼Œè®©\"éŸ³é¢‘+ è§†é¢‘\"çš„åä½œï¼ˆå¦‚ä¼šè®®è½¯ä»¶åŒæ—¶æ•è·éº¦å…‹é£å’Œæ‘„åƒå¤´ã€ç›´æ’­å·¥å…·æ··åˆæ¸¸æˆç”»é¢ä¸è§£è¯´å£°éŸ³ï¼‰å˜å¾—ç®€å•é«˜æ•ˆã€‚å› æ­¤ï¼Œè§†é¢‘å¤„ç†æ˜¯å…¶\"ç»Ÿä¸€å¤šåª’ä½“ç®¡é“\"ç›®æ ‡çš„è‡ªç„¶å»¶ä¼¸ã€‚ 1.3.2 PipeWire è§†é¢‘å¤„ç†çš„æ ¸å¿ƒä¼˜åŠ¿PipeWire ä½œä¸ºç°ä»£ Linux æ¡Œé¢ç³»ç»Ÿçš„å¤šåª’ä½“æ¡†æ¶ï¼Œç›¸æ¯”ä¼ ç»Ÿæ–¹æ¡ˆå…·æœ‰ä»¥ä¸‹æ ¸å¿ƒä¼˜åŠ¿ï¼š ç»Ÿä¸€çš„\"ç®¡é“\"æ¨¡å‹ï¼š éŸ³é¢‘æµå’Œè§†é¢‘æµéƒ½è¢«æŠ½è±¡ä¸º\"èŠ‚ç‚¹\" é€šè¿‡ç»Ÿä¸€çš„\"èŠ‚ç‚¹-ç«¯å£-è¿æ¥\"æ¨¡å‹å®ç°è·¨åº”ç”¨çš„éŸ³è§†é¢‘æ··åˆ æ¡†æ¶å†…ç½®æ—¶é—´æˆ³åŒæ­¥æœºåˆ¶ï¼Œç¡®ä¿éŸ³è§†é¢‘æµå§‹ç»ˆä¿æŒæ—¶åºä¸€è‡´ï¼ˆå»¶è¿Ÿè¯¯å·®å¯æ§åˆ¶åœ¨æ¯«ç§’çº§ï¼‰ åŸç”Ÿé€‚é…ç°ä»£æ¡Œé¢åè®®ï¼š ä½œä¸º Wayland å®˜æ–¹æ¨èçš„å¤šåª’ä½“ä¸­é—´å±‚ é€šè¿‡ä¸ xdg-desktop-portal æ¡†æ¶ååŒå·¥ä½œï¼Œå®ç°æ ‡å‡†åŒ–çš„\"æˆæƒå¼\"å±å¹•å…±äº« æ”¯æŒ HDR è§†é¢‘å’Œé«˜åˆ†è¾¨ç‡æµä¼ è¾“ï¼Œæ€§èƒ½æŸè€—è¿œä½äºä¼ ç»Ÿ X11 æˆªå›¾ éµå¾ª Wayland å®‰å…¨éš”ç¦»åŸåˆ™ï¼Œæ‰€æœ‰è·¨åº”ç”¨èµ„æºè®¿é—®éƒ½é€šè¿‡ç”¨æˆ·æˆæƒçš„é—¨æˆ·æ¥å£ ç®€åŒ–æ²™ç›’åº”ç”¨æƒé™ï¼š é€šè¿‡ Polkit æƒé™ç³»ç»Ÿé›†ä¸­ç®¡ç†è®¾å¤‡è®¿é—® æ²™ç›’åº”ç”¨æ— éœ€ç›´æ¥æ“ä½œç¡¬ä»¶è®¾å¤‡ï¼Œåªéœ€é€šè¿‡ PipeWire API è¯·æ±‚æµæ•°æ® æ”¯æŒåŠ¨æ€æƒé™è°ƒæ•´ é«˜æ•ˆç¡¬ä»¶åŠ é€Ÿæ•´åˆï¼š å†…ç½®ç»Ÿä¸€çš„ç¡¬ä»¶åŠ é€ŸæŠ½è±¡å±‚ é€šè¿‡ GStreamer æˆ– FFmpeg åç«¯è‡ªåŠ¨é€‚é…åº•å±‚ç¡¬ä»¶åŠ é€Ÿæ¥å£ æ”¯æŒ\"é›¶æ‹·è´\"ä¼ è¾“ï¼ŒCPU å ç”¨ç‡å¯é™ä½ 50% ä»¥ä¸Š çµæ´»çš„åŠ¨æ€è·¯ç”±ï¼š å…è®¸å®æ—¶è°ƒæ•´è§†é¢‘æµè·¯å¾„ ç”¨æˆ·å¯é€šè¿‡å›¾å½¢å·¥å…·æ‹–æ‹½èŠ‚ç‚¹å®ç°æµçš„åŠ¨æ€åˆ‡æ¢ æ”¯æŒè‡ªåŠ¨æ•…éšœæ¢å¤å’Œæµçš„åŠ¨æ€è½¬æ¢ 1.3.3 Wayland å±å¹•å…±äº«ä¸ xdg-desktop-portalåœ¨ Wayland ç¯å¢ƒä¸­ï¼Œå±å¹•å…±äº«åŠŸèƒ½æ˜¯é€šè¿‡ xdg-desktop-portal å’Œ PipeWire ååŒå·¥ä½œå®ç°çš„ã€‚è¿™ä¸ X11 æœ‰å¾ˆå¤§çš„ä¸åŒï¼Œåè€…é€šè¿‡å…¶è‡ªèº«çš„æ‰©å±•ï¼ˆå¦‚ X11R6 çš„ XFIXES æ‰©å±•ï¼‰ç›´æ¥è®¿é—®å±å¹•å†…å®¹ã€‚ å·¥ä½œåŸç†ï¼š åœ¨ Wayland ä¸‹ï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºåªèƒ½è®¿é—®è‡ªå·±çš„çª—å£ã€é”®ç›˜é¼ æ ‡äº‹ä»¶ç­‰ï¼Œæ— æ³•éšæ„æˆªå±æˆ–è®¿é—®å…¨å±€èµ„æºã€‚å±å¹•å…±äº«çš„å®Œæ•´æµç¨‹æ˜¯ï¼š åº”ç”¨å‘èµ·è¯·æ±‚ï¼šè§†é¢‘ä¼šè®®è½¯ä»¶è°ƒç”¨ org.freedesktop.portal.ScreenCast æ¥å£ï¼Œè¯·æ±‚å±å¹•å…±äº« ç”¨æˆ·æˆæƒï¼šxdg-desktop-portal æ˜¾ç¤ºåŸç”Ÿå¯¹è¯æ¡†ï¼Œè¯·æ±‚ç”¨æˆ·ç¡®è®¤å…±äº«èŒƒå›´ï¼ˆæ•´ä¸ªå±å¹•/ç‰¹å®šçª—å£/åŒºåŸŸï¼‰ åˆæˆå™¨æä¾›æ•°æ®ï¼šè·å¾—æˆæƒåï¼Œxdg-desktop-portal é€šçŸ¥åˆæˆå™¨ï¼Œåˆæˆå™¨å°†ç›¸åº”çš„å±å¹•å†…å®¹é€šè¿‡ PipeWire æµè¿”å›ç»™ xdg-desktop-portal. PipeWire æµä¼ è¾“ï¼šxdg-desktop-portal å°†æµä¿¡æ¯è¿”å›ç»™åº”ç”¨ï¼Œåº”ç”¨ç¨‹åºé€šè¿‡ PipeWire æ¥æ”¶å±å¹•æ•°æ®è¿›è¡Œå¤„ç†å’Œä¼ è¾“ å¯ä»¥çœ‹åˆ°åº”ç”¨ç¨‹åºåªéœ€è¦å…ˆä¸ xdg-desktop-portal äº¤äº’è·å¾— PipeWire æµä¿¡æ¯ï¼Œç„¶åç›´æ¥è®¿é—® PipeWire, å…¨ç¨‹éƒ½ä¸ç›´æ¥ä¸åˆæˆå™¨äº¤äº’ã€‚ åè®®ä¼˜åŠ¿ï¼š å®‰å…¨æ€§ï¼šåŸºäº xdg-desktop-portal çš„æˆæƒæœºåˆ¶ï¼Œéœ€è¦ç”¨æˆ·æ˜ç¡®åŒæ„ éšç§ä¿æŠ¤ï¼šç”¨æˆ·å¯ä»¥ç²¾ç¡®æ§åˆ¶å…±äº«èŒƒå›´ï¼Œåªå…±äº«ç‰¹å®šçª—å£è€Œéæ•´ä¸ªå±å¹• æ€§èƒ½ï¼šç›´æ¥è®¿é—®åˆæˆå™¨ç¼“å†²åŒºï¼Œé¿å…é¢å¤–çš„å†…å­˜æ‹·è´ å…¼å®¹æ€§ï¼šæ”¯æŒå¤šæ˜¾ç¤ºå™¨ã€ä¸åŒåˆ†è¾¨ç‡å’Œåˆ·æ–°ç‡ æ ‡å‡†åŒ–ï¼šæ‰€æœ‰åº”ç”¨éƒ½ä½¿ç”¨ç›¸åŒçš„ portal æ¥å£ï¼Œç¡®ä¿è·¨æ¡Œé¢ç¯å¢ƒçš„ä¸€è‡´ä½“éªŒ é—¨æˆ·å®ç°è¦æ±‚ï¼š è¦ä½¿ç”¨ Wayland å±å¹•å…±äº«ï¼Œç³»ç»Ÿéœ€è¦å®‰è£… DE/WM æ‰€æ”¯æŒçš„ xdg-desktop-portal å®ç°ã€‚ ä¸»æµåº”ç”¨æ”¯æŒï¼šç›®å‰ä¸»æµçš„ OBSã€Discordã€Zoomã€Chrome/Chromium ç­‰åº”ç”¨éƒ½å·²ç»æ”¯æŒåŸºäº xdg-desktop-portal çš„ Wayland å±å¹•å…±äº«æœºåˆ¶ã€‚ 1.3.4 è§†é¢‘è®¾å¤‡ç®¡ç†æ‘„åƒå¤´è®¾å¤‡ç®¡ç†ï¼š bash # æŸ¥çœ‹ PipeWire è§†é¢‘è®¾å¤‡ pw-cli list-objects | grep -i video # æŸ¥çœ‹ V4L2 è®¾å¤‡ v4l2-ctl --list-devices # æ‘„åƒå¤´æ ¼å¼æŸ¥è¯¢ v4l2-ctl --device=/dev/video0 --list-formats # æ‘„åƒå¤´æƒé™æ£€æŸ¥ ls -l /dev/video* groups $USER # ç¡®è®¤åœ¨ video ç»„ # æµ‹è¯•æ‘„åƒå¤´ ffplay /dev/video0 å±å¹•å…±äº«ç¯å¢ƒé…ç½®ï¼š bash # Wayland ç¯å¢ƒæ£€æŸ¥ echo $WAYLAND_DISPLAY echo $XDG_SESSION_TYPE # è®¾ç½®æ¡Œé¢ç¯å¢ƒæ ‡è¯†ï¼ˆé‡è¦ï¼ï¼‰ export XDG_CURRENT_DESKTOP=sway # æˆ– gnome, kde, xfce ç­‰ # æ£€æŸ¥ PipeWire æœåŠ¡çŠ¶æ€ systemctl --user status pipewire-session-manager systemctl --user status pipewire # æ£€æŸ¥æ¡Œé¢é—¨æˆ·æœåŠ¡ systemctl --user status xdg-desktop-portal systemctl --user status xdg-desktop-portal-wlr # Sway/Hyprland # æˆ– systemctl --user status xdg-desktop-portal-gnome # GNOME 1.3.5 è§†é¢‘æµå¤„ç†é…ç½®PipeWire è§†é¢‘é…ç½®ï¼š NixOS ä¸­å¯é€šè¿‡ services.pipewire.extraConfig.pipewire.\"10-video\".\"context.properties\" æ¥å£°æ˜è¿™éƒ¨åˆ†é…ç½®ã€‚ bash # ç¼–è¾‘ PipeWire ä¸»é…ç½® vim ~/.config/pipewire/pipewire.conf # è§†é¢‘ç›¸å…³é…ç½®ç¤ºä¾‹ context.properties = { # è§†é¢‘ç¼“å†²åŒºé…ç½® default.video.rate = 30 default.video.size = \"1920x1080\" # ç¡¬ä»¶åŠ é€Ÿé…ç½® gstreamer.plugins = [ \"vaapi\" # Intel/AMD GPU ç¡¬ä»¶åŠ é€Ÿ \"nvenc\" # NVIDIA GPU ç¡¬ä»¶åŠ é€Ÿ ] } 1.3.6 è§†é¢‘å¤„ç†æ€§èƒ½ä¼˜åŒ–ç¡¬ä»¶åŠ é€Ÿé…ç½®ï¼š bash # æ£€æŸ¥ç¡¬ä»¶åŠ é€Ÿæ”¯æŒ vainfo # VA-API æ”¯æŒæ£€æŸ¥ nvidia-smi # NVIDIA GPU çŠ¶æ€ # ç¯å¢ƒå˜é‡è®¾ç½® export LIBVA_DRIVER_NAME=i965 # Intel GPU export LIBVA_DRIVER_NAME=radeonsi # AMD GPU export LIBVA_DRIVER_NAME=nvidia # NVIDIA GPU # GStreamer ç¡¬ä»¶åŠ é€Ÿæµ‹è¯• gst-launch-1.0 videotestsrc ! vaapih264enc ! mp4mux ! filesink location=test.mp4 è§†é¢‘ç¼–ç ä¼˜åŒ–ï¼š bash # FFmpeg ç¡¬ä»¶åŠ é€Ÿç¼–ç  ffmpeg -f v4l2 -i /dev/video0 -c:v h264_vaapi -b:v 2M output.mp4 # OBS ç¡¬ä»¶ç¼–ç é…ç½® # è®¾ç½® -\u003e è¾“å‡º -\u003e ç¼–ç å™¨é€‰æ‹© \"FFmpeg VAAPI\" æˆ– \"NVENC\" å†…å­˜å’Œ CPU ä¼˜åŒ–ï¼š bash # è°ƒæ•´è§†é¢‘ç¼“å†²åŒºå¤§å° vim ~/.config/pipewire/pipewire.conf context.properties = { # å‡å°‘è§†é¢‘ç¼“å†²åŒºå»¶è¿Ÿ default.video.quantum = 1/30 # 30fps default.video.min-quantum = 1/30 default.video.max-quantum = 1/15 # æœ€å¤§ 15fps å»¶è¿Ÿ } ","date":"2025-10-19","objectID":"/posts/linux-desktop-4-multimedia-input/:2:3","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Multimedia","Audio","Video","Input Method"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå››ï¼‰ - å¤šåª’ä½“å¤„ç†ä¸ä¸­æ–‡æ”¯æŒ","uri":"/posts/linux-desktop-4-multimedia-input/#135-è§†é¢‘æµå¤„ç†é…ç½®"},{"categories":["tech"],"content":" 1.3 è§†é¢‘å¤„ç†ä¸å±å¹•å…±äº« 1.3.1 ä¸ºä»€ä¹ˆ PipeWire è¦æ”¯æŒè§†é¢‘æµå¤„ç†ï¼Ÿä¼ ç»Ÿ Linux ç³»ç»Ÿä¸­ï¼ŒéŸ³é¢‘å’Œè§†é¢‘å¤„ç†é•¿æœŸå¤„äº\"å„è‡ªä¸ºæˆ˜\"çš„çŠ¶æ€ï¼š éŸ³é¢‘ï¼šç”± PulseAudioï¼ˆæ¡Œé¢ï¼‰ã€JACKï¼ˆä¸“ä¸šï¼‰ç­‰ç³»ç»Ÿè´Ÿè´£ è§†é¢‘ï¼šä¾èµ– V4L2ï¼ˆæ‘„åƒå¤´æ•è·ï¼‰ã€X11/Waylandï¼ˆå±å¹•æˆªå›¾ï¼‰ã€GStreamerï¼ˆæµå¤„ç†ï¼‰ã€FFmpegï¼ˆç¼–è§£ç ï¼‰ç­‰åˆ†æ•£ç»„ä»¶ è¿™ç§ç¢ç‰‡åŒ–å¯¼è‡´äº†è¯¸å¤šé—®é¢˜ï¼š è·¨åº”ç”¨åŒæ­¥å›°éš¾ï¼šç›´æ’­æ—¶éº¦å…‹é£å£°éŸ³ä¸æ‘„åƒå¤´ç”»é¢å»¶è¿Ÿä¸ä¸€è‡´ æƒé™ç®¡ç†æ··ä¹±ï¼šæ²™ç›’åº”ç”¨å¦‚ Flatpak è®¿é—®æ‘„åƒå¤´/å±å¹•éœ€å•ç‹¬é€‚é… ç°ä»£åœºæ™¯æ”¯æŒä¸è¶³ï¼šWayland ä¸‹çš„å±å¹•å…±äº«ã€HDR è§†é¢‘æ¸²æŸ“ç¼ºä¹ç»Ÿä¸€æ”¯æŒ ç¡¬ä»¶åŠ é€Ÿå¤æ‚ï¼šGPU ç¼–è§£ç éœ€å„ç»„ä»¶å•ç‹¬å¯¹æ¥ï¼Œå…¼å®¹æ€§å·® PipeWire çš„è®¾è®¡åˆè¡·å°±æ˜¯æ‰“ç ´è¿™ç§å‰²è£‚ï¼šé€šè¿‡ä¸€å¥—ç»Ÿä¸€çš„æ¡†æ¶åŒæ—¶ç®¡ç†éŸ³é¢‘å’Œè§†é¢‘æµï¼Œè®©\"éŸ³é¢‘+ è§†é¢‘\"çš„åä½œï¼ˆå¦‚ä¼šè®®è½¯ä»¶åŒæ—¶æ•è·éº¦å…‹é£å’Œæ‘„åƒå¤´ã€ç›´æ’­å·¥å…·æ··åˆæ¸¸æˆç”»é¢ä¸è§£è¯´å£°éŸ³ï¼‰å˜å¾—ç®€å•é«˜æ•ˆã€‚å› æ­¤ï¼Œè§†é¢‘å¤„ç†æ˜¯å…¶\"ç»Ÿä¸€å¤šåª’ä½“ç®¡é“\"ç›®æ ‡çš„è‡ªç„¶å»¶ä¼¸ã€‚ 1.3.2 PipeWire è§†é¢‘å¤„ç†çš„æ ¸å¿ƒä¼˜åŠ¿PipeWire ä½œä¸ºç°ä»£ Linux æ¡Œé¢ç³»ç»Ÿçš„å¤šåª’ä½“æ¡†æ¶ï¼Œç›¸æ¯”ä¼ ç»Ÿæ–¹æ¡ˆå…·æœ‰ä»¥ä¸‹æ ¸å¿ƒä¼˜åŠ¿ï¼š ç»Ÿä¸€çš„\"ç®¡é“\"æ¨¡å‹ï¼š éŸ³é¢‘æµå’Œè§†é¢‘æµéƒ½è¢«æŠ½è±¡ä¸º\"èŠ‚ç‚¹\" é€šè¿‡ç»Ÿä¸€çš„\"èŠ‚ç‚¹-ç«¯å£-è¿æ¥\"æ¨¡å‹å®ç°è·¨åº”ç”¨çš„éŸ³è§†é¢‘æ··åˆ æ¡†æ¶å†…ç½®æ—¶é—´æˆ³åŒæ­¥æœºåˆ¶ï¼Œç¡®ä¿éŸ³è§†é¢‘æµå§‹ç»ˆä¿æŒæ—¶åºä¸€è‡´ï¼ˆå»¶è¿Ÿè¯¯å·®å¯æ§åˆ¶åœ¨æ¯«ç§’çº§ï¼‰ åŸç”Ÿé€‚é…ç°ä»£æ¡Œé¢åè®®ï¼š ä½œä¸º Wayland å®˜æ–¹æ¨èçš„å¤šåª’ä½“ä¸­é—´å±‚ é€šè¿‡ä¸ xdg-desktop-portal æ¡†æ¶ååŒå·¥ä½œï¼Œå®ç°æ ‡å‡†åŒ–çš„\"æˆæƒå¼\"å±å¹•å…±äº« æ”¯æŒ HDR è§†é¢‘å’Œé«˜åˆ†è¾¨ç‡æµä¼ è¾“ï¼Œæ€§èƒ½æŸè€—è¿œä½äºä¼ ç»Ÿ X11 æˆªå›¾ éµå¾ª Wayland å®‰å…¨éš”ç¦»åŸåˆ™ï¼Œæ‰€æœ‰è·¨åº”ç”¨èµ„æºè®¿é—®éƒ½é€šè¿‡ç”¨æˆ·æˆæƒçš„é—¨æˆ·æ¥å£ ç®€åŒ–æ²™ç›’åº”ç”¨æƒé™ï¼š é€šè¿‡ Polkit æƒé™ç³»ç»Ÿé›†ä¸­ç®¡ç†è®¾å¤‡è®¿é—® æ²™ç›’åº”ç”¨æ— éœ€ç›´æ¥æ“ä½œç¡¬ä»¶è®¾å¤‡ï¼Œåªéœ€é€šè¿‡ PipeWire API è¯·æ±‚æµæ•°æ® æ”¯æŒåŠ¨æ€æƒé™è°ƒæ•´ é«˜æ•ˆç¡¬ä»¶åŠ é€Ÿæ•´åˆï¼š å†…ç½®ç»Ÿä¸€çš„ç¡¬ä»¶åŠ é€ŸæŠ½è±¡å±‚ é€šè¿‡ GStreamer æˆ– FFmpeg åç«¯è‡ªåŠ¨é€‚é…åº•å±‚ç¡¬ä»¶åŠ é€Ÿæ¥å£ æ”¯æŒ\"é›¶æ‹·è´\"ä¼ è¾“ï¼ŒCPU å ç”¨ç‡å¯é™ä½ 50% ä»¥ä¸Š çµæ´»çš„åŠ¨æ€è·¯ç”±ï¼š å…è®¸å®æ—¶è°ƒæ•´è§†é¢‘æµè·¯å¾„ ç”¨æˆ·å¯é€šè¿‡å›¾å½¢å·¥å…·æ‹–æ‹½èŠ‚ç‚¹å®ç°æµçš„åŠ¨æ€åˆ‡æ¢ æ”¯æŒè‡ªåŠ¨æ•…éšœæ¢å¤å’Œæµçš„åŠ¨æ€è½¬æ¢ 1.3.3 Wayland å±å¹•å…±äº«ä¸ xdg-desktop-portalåœ¨ Wayland ç¯å¢ƒä¸­ï¼Œå±å¹•å…±äº«åŠŸèƒ½æ˜¯é€šè¿‡ xdg-desktop-portal å’Œ PipeWire ååŒå·¥ä½œå®ç°çš„ã€‚è¿™ä¸ X11 æœ‰å¾ˆå¤§çš„ä¸åŒï¼Œåè€…é€šè¿‡å…¶è‡ªèº«çš„æ‰©å±•ï¼ˆå¦‚ X11R6 çš„ XFIXES æ‰©å±•ï¼‰ç›´æ¥è®¿é—®å±å¹•å†…å®¹ã€‚ å·¥ä½œåŸç†ï¼š åœ¨ Wayland ä¸‹ï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºåªèƒ½è®¿é—®è‡ªå·±çš„çª—å£ã€é”®ç›˜é¼ æ ‡äº‹ä»¶ç­‰ï¼Œæ— æ³•éšæ„æˆªå±æˆ–è®¿é—®å…¨å±€èµ„æºã€‚å±å¹•å…±äº«çš„å®Œæ•´æµç¨‹æ˜¯ï¼š åº”ç”¨å‘èµ·è¯·æ±‚ï¼šè§†é¢‘ä¼šè®®è½¯ä»¶è°ƒç”¨ org.freedesktop.portal.ScreenCast æ¥å£ï¼Œè¯·æ±‚å±å¹•å…±äº« ç”¨æˆ·æˆæƒï¼šxdg-desktop-portal æ˜¾ç¤ºåŸç”Ÿå¯¹è¯æ¡†ï¼Œè¯·æ±‚ç”¨æˆ·ç¡®è®¤å…±äº«èŒƒå›´ï¼ˆæ•´ä¸ªå±å¹•/ç‰¹å®šçª—å£/åŒºåŸŸï¼‰ åˆæˆå™¨æä¾›æ•°æ®ï¼šè·å¾—æˆæƒåï¼Œxdg-desktop-portal é€šçŸ¥åˆæˆå™¨ï¼Œåˆæˆå™¨å°†ç›¸åº”çš„å±å¹•å†…å®¹é€šè¿‡ PipeWire æµè¿”å›ç»™ xdg-desktop-portal. PipeWire æµä¼ è¾“ï¼šxdg-desktop-portal å°†æµä¿¡æ¯è¿”å›ç»™åº”ç”¨ï¼Œåº”ç”¨ç¨‹åºé€šè¿‡ PipeWire æ¥æ”¶å±å¹•æ•°æ®è¿›è¡Œå¤„ç†å’Œä¼ è¾“ å¯ä»¥çœ‹åˆ°åº”ç”¨ç¨‹åºåªéœ€è¦å…ˆä¸ xdg-desktop-portal äº¤äº’è·å¾— PipeWire æµä¿¡æ¯ï¼Œç„¶åç›´æ¥è®¿é—® PipeWire, å…¨ç¨‹éƒ½ä¸ç›´æ¥ä¸åˆæˆå™¨äº¤äº’ã€‚ åè®®ä¼˜åŠ¿ï¼š å®‰å…¨æ€§ï¼šåŸºäº xdg-desktop-portal çš„æˆæƒæœºåˆ¶ï¼Œéœ€è¦ç”¨æˆ·æ˜ç¡®åŒæ„ éšç§ä¿æŠ¤ï¼šç”¨æˆ·å¯ä»¥ç²¾ç¡®æ§åˆ¶å…±äº«èŒƒå›´ï¼Œåªå…±äº«ç‰¹å®šçª—å£è€Œéæ•´ä¸ªå±å¹• æ€§èƒ½ï¼šç›´æ¥è®¿é—®åˆæˆå™¨ç¼“å†²åŒºï¼Œé¿å…é¢å¤–çš„å†…å­˜æ‹·è´ å…¼å®¹æ€§ï¼šæ”¯æŒå¤šæ˜¾ç¤ºå™¨ã€ä¸åŒåˆ†è¾¨ç‡å’Œåˆ·æ–°ç‡ æ ‡å‡†åŒ–ï¼šæ‰€æœ‰åº”ç”¨éƒ½ä½¿ç”¨ç›¸åŒçš„ portal æ¥å£ï¼Œç¡®ä¿è·¨æ¡Œé¢ç¯å¢ƒçš„ä¸€è‡´ä½“éªŒ é—¨æˆ·å®ç°è¦æ±‚ï¼š è¦ä½¿ç”¨ Wayland å±å¹•å…±äº«ï¼Œç³»ç»Ÿéœ€è¦å®‰è£… DE/WM æ‰€æ”¯æŒçš„ xdg-desktop-portal å®ç°ã€‚ ä¸»æµåº”ç”¨æ”¯æŒï¼šç›®å‰ä¸»æµçš„ OBSã€Discordã€Zoomã€Chrome/Chromium ç­‰åº”ç”¨éƒ½å·²ç»æ”¯æŒåŸºäº xdg-desktop-portal çš„ Wayland å±å¹•å…±äº«æœºåˆ¶ã€‚ 1.3.4 è§†é¢‘è®¾å¤‡ç®¡ç†æ‘„åƒå¤´è®¾å¤‡ç®¡ç†ï¼š bash # æŸ¥çœ‹ PipeWire è§†é¢‘è®¾å¤‡ pw-cli list-objects | grep -i video # æŸ¥çœ‹ V4L2 è®¾å¤‡ v4l2-ctl --list-devices # æ‘„åƒå¤´æ ¼å¼æŸ¥è¯¢ v4l2-ctl --device=/dev/video0 --list-formats # æ‘„åƒå¤´æƒé™æ£€æŸ¥ ls -l /dev/video* groups $USER # ç¡®è®¤åœ¨ video ç»„ # æµ‹è¯•æ‘„åƒå¤´ ffplay /dev/video0 å±å¹•å…±äº«ç¯å¢ƒé…ç½®ï¼š bash # Wayland ç¯å¢ƒæ£€æŸ¥ echo $WAYLAND_DISPLAY echo $XDG_SESSION_TYPE # è®¾ç½®æ¡Œé¢ç¯å¢ƒæ ‡è¯†ï¼ˆé‡è¦ï¼ï¼‰ export XDG_CURRENT_DESKTOP=sway # æˆ– gnome, kde, xfce ç­‰ # æ£€æŸ¥ PipeWire æœåŠ¡çŠ¶æ€ systemctl --user status pipewire-session-manager systemctl --user status pipewire # æ£€æŸ¥æ¡Œé¢é—¨æˆ·æœåŠ¡ systemctl --user status xdg-desktop-portal systemctl --user status xdg-desktop-portal-wlr # Sway/Hyprland # æˆ– systemctl --user status xdg-desktop-portal-gnome # GNOME 1.3.5 è§†é¢‘æµå¤„ç†é…ç½®PipeWire è§†é¢‘é…ç½®ï¼š NixOS ä¸­å¯é€šè¿‡ services.pipewire.extraConfig.pipewire.\"10-video\".\"context.properties\" æ¥å£°æ˜è¿™éƒ¨åˆ†é…ç½®ã€‚ bash # ç¼–è¾‘ PipeWire ä¸»é…ç½® vim ~/.config/pipewire/pipewire.conf # è§†é¢‘ç›¸å…³é…ç½®ç¤ºä¾‹ context.properties = { # è§†é¢‘ç¼“å†²åŒºé…ç½® default.video.rate = 30 default.video.size = \"1920x1080\" # ç¡¬ä»¶åŠ é€Ÿé…ç½® gstreamer.plugins = [ \"vaapi\" # Intel/AMD GPU ç¡¬ä»¶åŠ é€Ÿ \"nvenc\" # NVIDIA GPU ç¡¬ä»¶åŠ é€Ÿ ] } 1.3.6 è§†é¢‘å¤„ç†æ€§èƒ½ä¼˜åŒ–ç¡¬ä»¶åŠ é€Ÿé…ç½®ï¼š bash # æ£€æŸ¥ç¡¬ä»¶åŠ é€Ÿæ”¯æŒ vainfo # VA-API æ”¯æŒæ£€æŸ¥ nvidia-smi # NVIDIA GPU çŠ¶æ€ # ç¯å¢ƒå˜é‡è®¾ç½® export LIBVA_DRIVER_NAME=i965 # Intel GPU export LIBVA_DRIVER_NAME=radeonsi # AMD GPU export LIBVA_DRIVER_NAME=nvidia # NVIDIA GPU # GStreamer ç¡¬ä»¶åŠ é€Ÿæµ‹è¯• gst-launch-1.0 videotestsrc ! vaapih264enc ! mp4mux ! filesink location=test.mp4 è§†é¢‘ç¼–ç ä¼˜åŒ–ï¼š bash # FFmpeg ç¡¬ä»¶åŠ é€Ÿç¼–ç  ffmpeg -f v4l2 -i /dev/video0 -c:v h264_vaapi -b:v 2M output.mp4 # OBS ç¡¬ä»¶ç¼–ç é…ç½® # è®¾ç½® -\u003e è¾“å‡º -\u003e ç¼–ç å™¨é€‰æ‹© \"FFmpeg VAAPI\" æˆ– \"NVENC\" å†…å­˜å’Œ CPU ä¼˜åŒ–ï¼š bash # è°ƒæ•´è§†é¢‘ç¼“å†²åŒºå¤§å° vim ~/.config/pipewire/pipewire.conf context.properties = { # å‡å°‘è§†é¢‘ç¼“å†²åŒºå»¶è¿Ÿ default.video.quantum = 1/30 # 30fps default.video.min-quantum = 1/30 default.video.max-quantum = 1/15 # æœ€å¤§ 15fps å»¶è¿Ÿ } ","date":"2025-10-19","objectID":"/posts/linux-desktop-4-multimedia-input/:2:3","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Multimedia","Audio","Video","Input Method"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå››ï¼‰ - å¤šåª’ä½“å¤„ç†ä¸ä¸­æ–‡æ”¯æŒ","uri":"/posts/linux-desktop-4-multimedia-input/#136-è§†é¢‘å¤„ç†æ€§èƒ½ä¼˜åŒ–"},{"categories":["tech"],"content":" 1.4 æ•…éšœæ’æŸ¥å±å¹•å…±äº«é—®é¢˜ï¼š xdg-desktop-portal æœåŠ¡çŠ¶æ€ï¼šç¡®è®¤é—¨æˆ·æœåŠ¡æ­£å¸¸è¿è¡Œ é—¨æˆ·å®ç°å®‰è£…ï¼šæ£€æŸ¥æ˜¯å¦å®‰è£…äº†é€‚åˆçš„ portal å®ç° ç¯å¢ƒå˜é‡è®¾ç½®ï¼šæ­£ç¡®è®¾ç½® XDG_CURRENT_DESKTOP æƒé™é…ç½®ï¼šæ£€æŸ¥æ‘„åƒå¤´å’Œå±å¹•å½•åˆ¶æƒé™ åˆæˆå™¨æ”¯æŒï¼šç¡®è®¤åˆæˆå™¨æ”¯æŒç›¸åº”çš„ portal æ¥å£ åº”ç”¨å…¼å®¹æ€§ï¼šéƒ¨åˆ†åº”ç”¨éœ€è¦ç‰¹å®šç‰ˆæœ¬çš„ PipeWire å’Œ portal æ”¯æŒ éŸ³é¢‘è®¾å¤‡è¯†åˆ«é—®é¢˜ï¼š æ£€æŸ¥è®¾å¤‡å­˜åœ¨ï¼š bash aplay -l arecord -l éªŒè¯ PipeWire è¿è¡Œï¼š bash systemctl --user status pipewire wireplumber journalctl --user -u pipewire -f æƒé™æ£€æŸ¥ï¼š bash ls -l /dev/snd/ groups $USER # ç¡®è®¤åœ¨ audio ç»„ éŸ³é¢‘å»¶è¿Ÿä¼˜åŒ–ï¼š bash # ç¼–è¾‘ç”¨æˆ·é…ç½® vim ~/.config/pipewire/pipewire.conf # ä½å»¶è¿Ÿé…ç½®ç¤ºä¾‹ context.properties = { default.clock.rate = 48000 default.clock.quantum = 32 default.clock.min-quantum = 32 default.clock.max-quantum = 32 } PipeWire ä½å»¶è¿Ÿé…ç½®ï¼š default.clock.rate = 48000 è®¾ç½®éŸ³é¢‘é‡‡æ ·ç‡ä¸º 48kHzï¼Œå¹³è¡¡éŸ³è´¨å’Œæ€§èƒ½ã€‚48kHz æ˜¯ä¸“ä¸šéŸ³é¢‘çš„æ ‡å‡†é‡‡æ ·ç‡ï¼Œæä¾›è‰¯å¥½çš„éŸ³è´¨åŒæ—¶ä¿æŒåˆç†çš„è®¡ç®—å¼€é”€ã€‚ç›¸æ¯” 44.1kHz æä¾›æ›´å¥½çš„éŸ³è´¨ï¼Œç›¸æ¯” 96kHz å‡å°‘ CPU å’Œå†…å­˜ä½¿ç”¨ï¼Œé€‚ç”¨äºå¤§å¤šæ•°éŸ³é¢‘åº”ç”¨ï¼Œç‰¹åˆ«æ˜¯éœ€è¦ä½å»¶è¿Ÿçš„å®æ—¶éŸ³é¢‘å¤„ç†ã€‚ default.clock.quantum = 32 è®¾ç½®éŸ³é¢‘ç¼“å†²åŒºå¤§å°ä¸º 32 ä¸ªæ ·æœ¬ï¼Œçº¦ 0.67ms å»¶è¿Ÿã€‚è¾ƒå°çš„ç¼“å†²åŒºå‡å°‘éŸ³é¢‘å»¶è¿Ÿï¼Œä½†éœ€è¦æ›´é¢‘ç¹çš„éŸ³é¢‘å¤„ç†ã€‚è®¡ç®—æ–¹å¼ï¼š32 æ ·æœ¬ Ã· 48000Hz = 0.67ms å»¶è¿Ÿï¼Œé€‚ç”¨äºå®æ—¶éŸ³é¢‘åº”ç”¨ï¼Œå¦‚éŸ³ä¹åˆ¶ä½œã€æ¸¸æˆã€è§†é¢‘ä¼šè®®ã€‚ default.clock.min-quantum = 32 è®¾ç½®æœ€å°ç¼“å†²åŒºå¤§å°ï¼Œé˜²æ­¢ç³»ç»ŸåŠ¨æ€è°ƒæ•´åˆ°æ›´å°çš„å€¼ã€‚å›ºå®šæœ€å°ç¼“å†²åŒºå¤§å°ï¼Œé¿å…ç³»ç»Ÿåœ¨ä½è´Ÿè½½æ—¶è¿‡åº¦ä¼˜åŒ–å¯¼è‡´çš„ä¸ç¨³å®šï¼Œç¡®ä¿å»¶è¿Ÿçš„ä¸€è‡´æ€§ï¼Œé¿å…éŸ³é¢‘å¤„ç†çš„ä¸ç¨³å®šã€‚ default.clock.max-quantum = 32 è®¾ç½®æœ€å¤§ç¼“å†²åŒºå¤§å°ï¼Œé˜²æ­¢ç³»ç»ŸåŠ¨æ€è°ƒæ•´åˆ°æ›´å¤§çš„å€¼ã€‚å›ºå®šæœ€å¤§ç¼“å†²åŒºå¤§å°ï¼Œé¿å…ç³»ç»Ÿåœ¨é«˜è´Ÿè½½æ—¶å¢åŠ å»¶è¿Ÿï¼Œç¡®ä¿å»¶è¿Ÿçš„ä¸Šé™ï¼Œä¿æŒä½å»¶è¿Ÿç‰¹æ€§ã€‚ å»¶è¿Ÿä¼˜åŒ–æ•ˆæœï¼šçº¦ 0.67ms çš„éŸ³é¢‘å»¶è¿Ÿï¼Œé€‚åˆå®æ—¶åº”ç”¨ï¼›é€‚åº¦çš„ CPU ä½¿ç”¨å¢åŠ ï¼Œä½†é€šå¸¸å¯æ¥å—ï¼›å›ºå®šç¼“å†²åŒºå¤§å°æä¾›æ›´ç¨³å®šçš„éŸ³é¢‘å¤„ç†ï¼›ç‰¹åˆ«é€‚åˆéŸ³ä¹åˆ¶ä½œã€æ¸¸æˆã€å®æ—¶é€šä¿¡ç­‰å¯¹å»¶è¿Ÿæ•æ„Ÿçš„åº”ç”¨ã€‚ æ³¨æ„äº‹é¡¹ï¼šè¿‡å°çš„ç¼“å†²åŒºå¯èƒ½å¯¼è‡´éŸ³é¢‘æ–­æ–­ç»­ç»­æˆ– CPU ä½¿ç”¨ç‡è¿‡é«˜ï¼›éœ€è¦æ ¹æ®å…·ä½“ç¡¬ä»¶å’Œåº”ç”¨éœ€æ±‚è°ƒæ•´å‚æ•°ï¼›æŸäº›éŸ³é¢‘è®¾å¤‡å¯èƒ½ä¸æ”¯æŒæå°çš„ç¼“å†²åŒºå¤§å°ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-4-multimedia-input/:2:4","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Multimedia","Audio","Video","Input Method"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå››ï¼‰ - å¤šåª’ä½“å¤„ç†ä¸ä¸­æ–‡æ”¯æŒ","uri":"/posts/linux-desktop-4-multimedia-input/#14-æ•…éšœæ’æŸ¥"},{"categories":["tech"],"content":" ä¸­æ–‡æ”¯æŒä¸­æ–‡æ”¯æŒæ˜¯ä¸­æ–‡ç”¨æˆ·æ¡Œé¢ä½“éªŒçš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ï¼ŒåŒ…æ‹¬å­—ä½“æ¸²æŸ“é…ç½®å’Œä¸­æ–‡è¾“å…¥æ³•è®¾ç½®ã€‚æœ¬ç« èŠ‚å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨ Linux æ¡Œé¢ç¯å¢ƒä¸­æ­£ç¡®é…ç½®ä¸­æ–‡å­—ä½“å’Œè¾“å…¥æ³•ï¼Œè§£å†³å¸¸è§çš„æ˜¾ç¤ºå’Œè¾“å…¥é—®é¢˜ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-4-multimedia-input/:3:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Multimedia","Audio","Video","Input Method"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå››ï¼‰ - å¤šåª’ä½“å¤„ç†ä¸ä¸­æ–‡æ”¯æŒ","uri":"/posts/linux-desktop-4-multimedia-input/#ä¸­æ–‡æ”¯æŒ"},{"categories":["tech"],"content":" 2.1 å­—ä½“æ¸²æŸ“å­—ä½“æ¸²æŸ“æ˜¯æ¡Œé¢åº”ç”¨æ˜¾ç¤ºè´¨é‡çš„å…³é”®å› ç´ ï¼Œç‰¹åˆ«æ˜¯å¯¹äºä¸­æ–‡ç”¨æˆ·ï¼ŒCJKï¼ˆä¸­æ—¥éŸ©ï¼‰å­—ä½“çš„æ­£ç¡®é…ç½®ç›´æ¥å½±å“é˜…è¯»ä½“éªŒã€‚Linux æ¡Œé¢é€šè¿‡ fontconfig ç³»ç»Ÿç»Ÿä¸€ç®¡ç†å­—ä½“é…ç½®ï¼Œè§£å†³å­—ä½“åŒ¹é…ã€æ¸²æŸ“å’Œæ˜¾ç¤ºé—®é¢˜ã€‚ 2.1.1 fontconfig æ¶æ„æ¦‚è§ˆfontconfig æ˜¯ Linux æ¡Œé¢ç³»ç»Ÿçš„å­—ä½“é…ç½®æ¡†æ¶ï¼Œè´Ÿè´£ï¼š å­—ä½“å‘ç°ï¼šæ‰«æç³»ç»Ÿå­—ä½“ç›®å½•ï¼Œå»ºç«‹å­—ä½“ç´¢å¼• å­—ä½“åŒ¹é…ï¼šæ ¹æ®åº”ç”¨è¯·æ±‚çš„å­—ä½“ç‰¹å¾ï¼ˆæ—åã€æ ·å¼ã€è¯­è¨€ç­‰ï¼‰é€‰æ‹©æœ€åˆé€‚çš„å­—ä½“ å­—ä½“æ¸²æŸ“ï¼šé…ç½®å­—ä½“æ¸²æŸ“å‚æ•°ï¼ˆæŠ—é”¯é½¿ã€å­åƒç´ æ¸²æŸ“ã€æç¤ºç­‰ï¼‰ å­—ä½“æ›¿æ¢ï¼šå½“è¯·æ±‚çš„å­—ä½“ä¸å­˜åœ¨æ—¶ï¼Œæä¾›åˆé€‚çš„æ›¿ä»£å­—ä½“ æ ¸å¿ƒç»„ä»¶ï¼š fc-cacheï¼šå­—ä½“ç¼“å­˜ç”Ÿæˆå·¥å…· fc-listï¼šå­—ä½“åˆ—è¡¨æŸ¥è¯¢å·¥å…· fc-matchï¼šå­—ä½“åŒ¹é…æµ‹è¯•å·¥å…· é…ç½®æ–‡ä»¶ï¼šXML æ ¼å¼çš„å­—ä½“é…ç½®è§„åˆ™ é…ç½®æ–‡ä»¶å±‚æ¬¡ï¼š bash # ç³»ç»Ÿçº§é…ç½®ï¼ˆä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼‰ /etc/fonts/fonts.conf # ä¸»é…ç½®æ–‡ä»¶ /etc/fonts/conf.d/ # é…ç½®ç‰‡æ®µç›®å½• # ç”¨æˆ·çº§é…ç½® ~/.config/fontconfig/fonts.conf # ç”¨æˆ·ä¸»é…ç½® ~/.config/fontconfig/conf.d/ # ç”¨æˆ·é…ç½®ç‰‡æ®µ 2.1.2 CJK å­—ä½“é…ç½®åŸºç¡€å¸¸è§ CJK å­—ä½“æ—ï¼š å­—ä½“æ— ç‰¹ç‚¹ é€‚ç”¨åœºæ™¯ Source Han Sans Adobe å¼€æºï¼Œä¸“ä¸šè®¾è®¡ ç°ä»£åº”ç”¨ï¼Œç½‘é¡µæ˜¾ç¤º Source Han Serif Adobe å¼€æºï¼Œè¡¬çº¿å­—ä½“ è®¾è®¡è½¯ä»¶ï¼Œå°åˆ· Source Han Mono æ€æºç­‰å®½å­—ä½“ ç¼–ç¨‹ï¼Œä»£ç æ˜¾ç¤º Noto Sans CJK Google å¼€æºï¼Œä¸ Source Han ä¸ºåŒä¸€å­—ä½“ ç³»ç»Ÿç•Œé¢ï¼Œå…¼å®¹æ€§ WenQuanYi æ–‡æ³‰é©¿ï¼Œè½»é‡çº§ ç³»ç»Ÿç•Œé¢ï¼Œç»ˆç«¯ è¯´æ˜ï¼šSource Han ç³»åˆ—å’Œ Noto CJK ç³»åˆ—å®é™…ä¸Šæ˜¯åŒä¸€å¥—å­—ä½“ï¼Œåªæ˜¯åˆ†åˆ«ç”± Adobe å’Œ Google ä»¥è‡ªå·±çš„å“ç‰Œåå‘å¸ƒã€‚ ä»¥åŠä¸€äº›æ–°å…´çš„å¼€æºå­—ä½“ï¼š å­—ä½“æ— ç‰¹ç‚¹ é€‚ç”¨åœºæ™¯ LXGW WenKai Screen éœé¹œæ–‡æ¥·å±å¹•ç‰ˆ å±å¹•é˜…è¯»ï¼Œæ–‡æ¡£ Maple Mono NF CN ä¸­è‹±æ–‡ç­‰å®½å­—ä½“ ç¼–ç¨‹ï¼Œç»ˆç«¯ NixOS å­—ä½“é…ç½®ç¤ºä¾‹ï¼š nix # configuration.nix fonts = { # ç¦ç”¨é»˜è®¤å­—ä½“åŒ…ï¼Œä½¿ç”¨è‡ªå®šä¹‰é…ç½® enableDefaultPackages = false; fontDir.enable = true; # å®‰è£…å¸¸ç”¨ CJK å­—ä½“å’Œå›¾æ ‡å­—ä½“ packages = with pkgs; [ # å›¾æ ‡å­—ä½“ material-design-icons font-awesome nerd-fonts.symbols-only nerd-fonts.jetbrains-mono # Noto æ˜¯ Google å¼€å‘çš„å¼€æºå­—ä½“å®¶æ— # åå­—çš„å«ä¹‰æ˜¯ã€Œæ²¡æœ‰è±†è…ã€ï¼ˆno tofuï¼‰ï¼Œå› ä¸ºç¼ºå­—æ—¶æ˜¾ç¤ºçš„æ–¹æ¡†æˆ–è€…æ–¹æ¡†è¢«å«ä½œ tofu # # Noto ç³»åˆ—å­—æ—åªæ”¯æŒè¥¿æ–‡ï¼Œå‘½åè§„åˆ™æ˜¯ Noto + Sans æˆ– Serif + æ–‡å­—åç§°ã€‚ noto-fonts # å¤§éƒ¨åˆ†æ–‡å­—çš„å¸¸è§æ ·å¼ï¼Œä¸åŒ…å«æ±‰å­— noto-fonts-color-emoji # å½©è‰²çš„è¡¨æƒ…ç¬¦å·å­—ä½“ # Noto CJK ä¸ºã€Œæ€æºã€ç³»åˆ—æ±‰å­—å­—ä½“ï¼Œç”± Adobe + Google å…±åŒå¼€å‘ # Google ä»¥ Noto Sans/Serif CJK SC/TC/HK/JP/KR çš„åç§°å‘å¸ƒè¯¥ç³»åˆ—å­—ä½“ã€‚ # è¿™ä¿©è·Ÿ noto-fonts-cjk-sans/serif å®é™…ä¸ºåŒä¸€å­—ä½“ï¼Œåªæ˜¯åˆ†åˆ«ç”± Adobe/Google ä»¥è‡ªå·±çš„å“ç‰Œåå‘å¸ƒ # noto-fonts-cjk-sans # æ€æºé»‘ä½“ # noto-fonts-cjk-serif # æ€æºå®‹ä½“ # Adobe ä»¥ Source Han Sans/Serif çš„åç§°å‘å¸ƒæ­¤ç³»åˆ—å­—ä½“ source-sans # æ— è¡¬çº¿å­—ä½“ï¼Œä¸å«æ±‰å­—ã€‚å­—æ—åå« Source Sans 3ï¼Œä»¥åŠå¸¦å­—é‡çš„å˜ä½“ï¼ˆVFï¼‰ source-serif # è¡¬çº¿å­—ä½“ï¼Œä¸å«æ±‰å­—ã€‚å­—æ—åå« Source Serif 4ï¼Œä»¥åŠå¸¦å­—é‡çš„å˜ä½“ # Source Hans ç³»åˆ—æ±‰å­—å­—ä½“ç”± Adobe + Google å…±åŒå¼€å‘ source-han-sans # æ€æºé»‘ä½“ source-han-serif # æ€æºå®‹ä½“ source-han-mono # æ€æºç­‰å®½ ]; # å­—ä½“æ¸²æŸ“é…ç½® fontconfig = { enable = true; antialias = true; # å¯ç”¨æŠ—é”¯é½¿ hinting.enable = false; # é«˜åˆ†è¾¨ç‡ä¸‹ç¦ç”¨å­—ä½“å¾®è°ƒ subpixel.rgba = \"rgb\"; # IPS å±å¹•ä½¿ç”¨ RGB å­åƒç´ æ’åˆ— # é»˜è®¤å­—ä½“æ—é…ç½® defaultFonts = { serif = [ \"Source Serif 4\" # è¥¿æ–‡è¡¬çº¿å­—ä½“ \"Source Han Serif SC\" # ä¸­æ–‡å®‹ä½“ \"Source Han Serif TC\" # ç¹ä½“å®‹ä½“ ]; sansSerif = [ \"Source Sans 3\" # è¥¿æ–‡æ— è¡¬çº¿å­—ä½“ \"Source Han Sans SC\" # ä¸­æ–‡é»‘ä½“ \"Source Han Sans TC\" # ç¹ä½“é»‘ä½“ ]; monospace = [ \"Maple Mono NF CN\" # ä¸­è‹±æ–‡ç­‰å®½å­—ä½“ \"Source Han Mono SC\" # ä¸­æ–‡ç­‰å®½ \"JetBrainsMono Nerd Font\" # è¥¿æ–‡ç­‰å®½ ]; emoji = [ \"Noto Color Emoji\" ]; }; }; }; å­—ä½“æ¸²æŸ“é…ç½®å‚æ•°ï¼š antialias = true å¯ç”¨å­—ä½“æŠ—é”¯é½¿ï¼Œè®©å­—ä½“è¾¹ç¼˜æ›´å¹³æ»‘ï¼Œæå‡æ˜¾ç¤ºè´¨é‡ã€‚é€šè¿‡ç°åº¦æ’å€¼æŠ€æœ¯å¹³æ»‘å­—ä½“è¾¹ç¼˜ï¼Œå‡å°‘é”¯é½¿æ•ˆæœï¼Œæ˜¾è‘—æå‡æ–‡å­—æ˜¾ç¤ºè´¨é‡ï¼Œç‰¹åˆ«æ˜¯åœ¨é«˜åˆ†è¾¨ç‡å±å¹•ä¸Šï¼Œé€‚ç”¨äºæ‰€æœ‰ç°ä»£æ˜¾ç¤ºè®¾å¤‡ï¼Œç‰¹åˆ«æ˜¯é«˜åˆ†è¾¨ç‡å±å¹•ã€‚ hinting.enable = false åœ¨é«˜åˆ†è¾¨ç‡å±å¹•ï¼ˆå¦‚ 4Kï¼‰ä¸Šç¦ç”¨å­—ä½“å¾®è°ƒï¼Œé¿å…è¿‡åº¦æ¸²æŸ“ã€‚å­—ä½“å¾®è°ƒ ï¼ˆhintingï¼‰æ˜¯ä¸ºä½åˆ†è¾¨ç‡å±å¹•è®¾è®¡çš„ä¼˜åŒ–æŠ€æœ¯ï¼Œåœ¨é«˜åˆ†è¾¨ç‡ä¸‹å¯èƒ½é€ æˆè¿‡åº¦æ¸²æŸ“ï¼Œåœ¨é«˜åˆ†è¾¨ç‡å±å¹•ä¸Šæä¾›æ›´è‡ªç„¶çš„å­—ä½“æ˜¾ç¤ºæ•ˆæœï¼Œé€‚ç”¨äºé«˜åˆ†è¾¨ç‡å±å¹•ï¼ˆé€šå¸¸ 200+ DPIï¼‰ï¼Œå¦‚ 4K æ˜¾ç¤ºå™¨ã€é«˜åˆ†è¾¨ç‡ç¬”è®°æœ¬å±å¹•ã€‚ subpixel.rgba = \"rgb\" é’ˆå¯¹ IPS å±å¹•çš„ RGB å­åƒç´ æ’åˆ—ä¼˜åŒ–ï¼Œæå‡å­—ä½“æ¸…æ™°åº¦ã€‚åˆ©ç”¨ LCD å±å¹•çš„ RGB å­åƒç´ ç»“æ„ï¼Œé€šè¿‡å­åƒç´ æ¸²æŸ“æŠ€æœ¯æå‡å­—ä½“æ¸…æ™°åº¦ï¼Œåœ¨ LCD å±å¹•ä¸Šæ˜¾è‘—æå‡å­—ä½“æ¸…æ™°åº¦ï¼Œå‡å°‘æ¨¡ç³Šæ„Ÿï¼Œé€‚ç”¨äº IPSã€TNã€VA ç­‰ LCD å±å¹•ï¼Œä¸é€‚ç”¨äº OLED å±å¹•ã€‚ å­—ä½“æ¸²æŸ“ä¼˜åŒ–æ•ˆæœï¼šæŠ—é”¯é½¿å’Œå­åƒç´ æ¸²æŸ“æ˜¾è‘—æå‡æ–‡å­—æ˜¾ç¤ºè´¨é‡ï¼›åœ¨é«˜åˆ†è¾¨ç‡å±å¹•ä¸Šç¦ç”¨å¾®è°ƒæä¾›æ›´è‡ªç„¶çš„æ˜¾ç¤ºæ•ˆæœï¼›åˆç†çš„å­—ä½“å›é€€æœºåˆ¶ç¡®ä¿å„ç§æ–‡å­—çš„æ­£ç¡®æ˜¾ç¤ºï¼›ä¼˜åŒ–çš„æ¸²æŸ“é…ç½®åœ¨æå‡è´¨é‡çš„åŒæ—¶ä¿æŒè‰¯å¥½æ€§èƒ½ã€‚ é‡è¦è¯´æ˜ï¼šSource Han ç³»åˆ—ï¼ˆAdobe å‘å¸ƒï¼‰å’Œ Noto CJK ç³»åˆ—ï¼ˆGoogle å‘å¸ƒï¼‰å®é™…ä¸Šæ˜¯åŒä¸€å¥—å­—ä½“ï¼Œåªæ˜¯åˆ†åˆ«ç”± Adobe å’Œ Google ä»¥è‡ªå·±çš„å“ç‰Œåå‘å¸ƒã€‚åœ¨ NixOS ä¸­ï¼Œsource-han-sans å’Œnoto-fonts-cjk-sans æŒ‡å‘çš„æ˜¯åŒä¸€å¥—å­—ä½“æ–‡ä»¶ã€‚ 2.1.3 å¸¸è§ CJK å­—ä½“é—®é¢˜ä¸è§£å†³æ–¹æ³•","date":"2025-10-19","objectID":"/posts/linux-desktop-4-multimedia-input/:3:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Multimedia","Audio","Video","Input Method"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå››ï¼‰ - å¤šåª’ä½“å¤„ç†ä¸ä¸­æ–‡æ”¯æŒ","uri":"/posts/linux-desktop-4-multimedia-input/#21-å­—ä½“æ¸²æŸ“"},{"categories":["tech"],"content":" 2.1 å­—ä½“æ¸²æŸ“å­—ä½“æ¸²æŸ“æ˜¯æ¡Œé¢åº”ç”¨æ˜¾ç¤ºè´¨é‡çš„å…³é”®å› ç´ ï¼Œç‰¹åˆ«æ˜¯å¯¹äºä¸­æ–‡ç”¨æˆ·ï¼ŒCJKï¼ˆä¸­æ—¥éŸ©ï¼‰å­—ä½“çš„æ­£ç¡®é…ç½®ç›´æ¥å½±å“é˜…è¯»ä½“éªŒã€‚Linux æ¡Œé¢é€šè¿‡ fontconfig ç³»ç»Ÿç»Ÿä¸€ç®¡ç†å­—ä½“é…ç½®ï¼Œè§£å†³å­—ä½“åŒ¹é…ã€æ¸²æŸ“å’Œæ˜¾ç¤ºé—®é¢˜ã€‚ 2.1.1 fontconfig æ¶æ„æ¦‚è§ˆfontconfig æ˜¯ Linux æ¡Œé¢ç³»ç»Ÿçš„å­—ä½“é…ç½®æ¡†æ¶ï¼Œè´Ÿè´£ï¼š å­—ä½“å‘ç°ï¼šæ‰«æç³»ç»Ÿå­—ä½“ç›®å½•ï¼Œå»ºç«‹å­—ä½“ç´¢å¼• å­—ä½“åŒ¹é…ï¼šæ ¹æ®åº”ç”¨è¯·æ±‚çš„å­—ä½“ç‰¹å¾ï¼ˆæ—åã€æ ·å¼ã€è¯­è¨€ç­‰ï¼‰é€‰æ‹©æœ€åˆé€‚çš„å­—ä½“ å­—ä½“æ¸²æŸ“ï¼šé…ç½®å­—ä½“æ¸²æŸ“å‚æ•°ï¼ˆæŠ—é”¯é½¿ã€å­åƒç´ æ¸²æŸ“ã€æç¤ºç­‰ï¼‰ å­—ä½“æ›¿æ¢ï¼šå½“è¯·æ±‚çš„å­—ä½“ä¸å­˜åœ¨æ—¶ï¼Œæä¾›åˆé€‚çš„æ›¿ä»£å­—ä½“ æ ¸å¿ƒç»„ä»¶ï¼š fc-cacheï¼šå­—ä½“ç¼“å­˜ç”Ÿæˆå·¥å…· fc-listï¼šå­—ä½“åˆ—è¡¨æŸ¥è¯¢å·¥å…· fc-matchï¼šå­—ä½“åŒ¹é…æµ‹è¯•å·¥å…· é…ç½®æ–‡ä»¶ï¼šXML æ ¼å¼çš„å­—ä½“é…ç½®è§„åˆ™ é…ç½®æ–‡ä»¶å±‚æ¬¡ï¼š bash # ç³»ç»Ÿçº§é…ç½®ï¼ˆä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼‰ /etc/fonts/fonts.conf # ä¸»é…ç½®æ–‡ä»¶ /etc/fonts/conf.d/ # é…ç½®ç‰‡æ®µç›®å½• # ç”¨æˆ·çº§é…ç½® ~/.config/fontconfig/fonts.conf # ç”¨æˆ·ä¸»é…ç½® ~/.config/fontconfig/conf.d/ # ç”¨æˆ·é…ç½®ç‰‡æ®µ 2.1.2 CJK å­—ä½“é…ç½®åŸºç¡€å¸¸è§ CJK å­—ä½“æ—ï¼š å­—ä½“æ— ç‰¹ç‚¹ é€‚ç”¨åœºæ™¯ Source Han Sans Adobe å¼€æºï¼Œä¸“ä¸šè®¾è®¡ ç°ä»£åº”ç”¨ï¼Œç½‘é¡µæ˜¾ç¤º Source Han Serif Adobe å¼€æºï¼Œè¡¬çº¿å­—ä½“ è®¾è®¡è½¯ä»¶ï¼Œå°åˆ· Source Han Mono æ€æºç­‰å®½å­—ä½“ ç¼–ç¨‹ï¼Œä»£ç æ˜¾ç¤º Noto Sans CJK Google å¼€æºï¼Œä¸ Source Han ä¸ºåŒä¸€å­—ä½“ ç³»ç»Ÿç•Œé¢ï¼Œå…¼å®¹æ€§ WenQuanYi æ–‡æ³‰é©¿ï¼Œè½»é‡çº§ ç³»ç»Ÿç•Œé¢ï¼Œç»ˆç«¯ è¯´æ˜ï¼šSource Han ç³»åˆ—å’Œ Noto CJK ç³»åˆ—å®é™…ä¸Šæ˜¯åŒä¸€å¥—å­—ä½“ï¼Œåªæ˜¯åˆ†åˆ«ç”± Adobe å’Œ Google ä»¥è‡ªå·±çš„å“ç‰Œåå‘å¸ƒã€‚ ä»¥åŠä¸€äº›æ–°å…´çš„å¼€æºå­—ä½“ï¼š å­—ä½“æ— ç‰¹ç‚¹ é€‚ç”¨åœºæ™¯ LXGW WenKai Screen éœé¹œæ–‡æ¥·å±å¹•ç‰ˆ å±å¹•é˜…è¯»ï¼Œæ–‡æ¡£ Maple Mono NF CN ä¸­è‹±æ–‡ç­‰å®½å­—ä½“ ç¼–ç¨‹ï¼Œç»ˆç«¯ NixOS å­—ä½“é…ç½®ç¤ºä¾‹ï¼š nix # configuration.nix fonts = { # ç¦ç”¨é»˜è®¤å­—ä½“åŒ…ï¼Œä½¿ç”¨è‡ªå®šä¹‰é…ç½® enableDefaultPackages = false; fontDir.enable = true; # å®‰è£…å¸¸ç”¨ CJK å­—ä½“å’Œå›¾æ ‡å­—ä½“ packages = with pkgs; [ # å›¾æ ‡å­—ä½“ material-design-icons font-awesome nerd-fonts.symbols-only nerd-fonts.jetbrains-mono # Noto æ˜¯ Google å¼€å‘çš„å¼€æºå­—ä½“å®¶æ— # åå­—çš„å«ä¹‰æ˜¯ã€Œæ²¡æœ‰è±†è…ã€ï¼ˆno tofuï¼‰ï¼Œå› ä¸ºç¼ºå­—æ—¶æ˜¾ç¤ºçš„æ–¹æ¡†æˆ–è€…æ–¹æ¡†è¢«å«ä½œ tofu # # Noto ç³»åˆ—å­—æ—åªæ”¯æŒè¥¿æ–‡ï¼Œå‘½åè§„åˆ™æ˜¯ Noto + Sans æˆ– Serif + æ–‡å­—åç§°ã€‚ noto-fonts # å¤§éƒ¨åˆ†æ–‡å­—çš„å¸¸è§æ ·å¼ï¼Œä¸åŒ…å«æ±‰å­— noto-fonts-color-emoji # å½©è‰²çš„è¡¨æƒ…ç¬¦å·å­—ä½“ # Noto CJK ä¸ºã€Œæ€æºã€ç³»åˆ—æ±‰å­—å­—ä½“ï¼Œç”± Adobe + Google å…±åŒå¼€å‘ # Google ä»¥ Noto Sans/Serif CJK SC/TC/HK/JP/KR çš„åç§°å‘å¸ƒè¯¥ç³»åˆ—å­—ä½“ã€‚ # è¿™ä¿©è·Ÿ noto-fonts-cjk-sans/serif å®é™…ä¸ºåŒä¸€å­—ä½“ï¼Œåªæ˜¯åˆ†åˆ«ç”± Adobe/Google ä»¥è‡ªå·±çš„å“ç‰Œåå‘å¸ƒ # noto-fonts-cjk-sans # æ€æºé»‘ä½“ # noto-fonts-cjk-serif # æ€æºå®‹ä½“ # Adobe ä»¥ Source Han Sans/Serif çš„åç§°å‘å¸ƒæ­¤ç³»åˆ—å­—ä½“ source-sans # æ— è¡¬çº¿å­—ä½“ï¼Œä¸å«æ±‰å­—ã€‚å­—æ—åå« Source Sans 3ï¼Œä»¥åŠå¸¦å­—é‡çš„å˜ä½“ï¼ˆVFï¼‰ source-serif # è¡¬çº¿å­—ä½“ï¼Œä¸å«æ±‰å­—ã€‚å­—æ—åå« Source Serif 4ï¼Œä»¥åŠå¸¦å­—é‡çš„å˜ä½“ # Source Hans ç³»åˆ—æ±‰å­—å­—ä½“ç”± Adobe + Google å…±åŒå¼€å‘ source-han-sans # æ€æºé»‘ä½“ source-han-serif # æ€æºå®‹ä½“ source-han-mono # æ€æºç­‰å®½ ]; # å­—ä½“æ¸²æŸ“é…ç½® fontconfig = { enable = true; antialias = true; # å¯ç”¨æŠ—é”¯é½¿ hinting.enable = false; # é«˜åˆ†è¾¨ç‡ä¸‹ç¦ç”¨å­—ä½“å¾®è°ƒ subpixel.rgba = \"rgb\"; # IPS å±å¹•ä½¿ç”¨ RGB å­åƒç´ æ’åˆ— # é»˜è®¤å­—ä½“æ—é…ç½® defaultFonts = { serif = [ \"Source Serif 4\" # è¥¿æ–‡è¡¬çº¿å­—ä½“ \"Source Han Serif SC\" # ä¸­æ–‡å®‹ä½“ \"Source Han Serif TC\" # ç¹ä½“å®‹ä½“ ]; sansSerif = [ \"Source Sans 3\" # è¥¿æ–‡æ— è¡¬çº¿å­—ä½“ \"Source Han Sans SC\" # ä¸­æ–‡é»‘ä½“ \"Source Han Sans TC\" # ç¹ä½“é»‘ä½“ ]; monospace = [ \"Maple Mono NF CN\" # ä¸­è‹±æ–‡ç­‰å®½å­—ä½“ \"Source Han Mono SC\" # ä¸­æ–‡ç­‰å®½ \"JetBrainsMono Nerd Font\" # è¥¿æ–‡ç­‰å®½ ]; emoji = [ \"Noto Color Emoji\" ]; }; }; }; å­—ä½“æ¸²æŸ“é…ç½®å‚æ•°ï¼š antialias = true å¯ç”¨å­—ä½“æŠ—é”¯é½¿ï¼Œè®©å­—ä½“è¾¹ç¼˜æ›´å¹³æ»‘ï¼Œæå‡æ˜¾ç¤ºè´¨é‡ã€‚é€šè¿‡ç°åº¦æ’å€¼æŠ€æœ¯å¹³æ»‘å­—ä½“è¾¹ç¼˜ï¼Œå‡å°‘é”¯é½¿æ•ˆæœï¼Œæ˜¾è‘—æå‡æ–‡å­—æ˜¾ç¤ºè´¨é‡ï¼Œç‰¹åˆ«æ˜¯åœ¨é«˜åˆ†è¾¨ç‡å±å¹•ä¸Šï¼Œé€‚ç”¨äºæ‰€æœ‰ç°ä»£æ˜¾ç¤ºè®¾å¤‡ï¼Œç‰¹åˆ«æ˜¯é«˜åˆ†è¾¨ç‡å±å¹•ã€‚ hinting.enable = false åœ¨é«˜åˆ†è¾¨ç‡å±å¹•ï¼ˆå¦‚ 4Kï¼‰ä¸Šç¦ç”¨å­—ä½“å¾®è°ƒï¼Œé¿å…è¿‡åº¦æ¸²æŸ“ã€‚å­—ä½“å¾®è°ƒ ï¼ˆhintingï¼‰æ˜¯ä¸ºä½åˆ†è¾¨ç‡å±å¹•è®¾è®¡çš„ä¼˜åŒ–æŠ€æœ¯ï¼Œåœ¨é«˜åˆ†è¾¨ç‡ä¸‹å¯èƒ½é€ æˆè¿‡åº¦æ¸²æŸ“ï¼Œåœ¨é«˜åˆ†è¾¨ç‡å±å¹•ä¸Šæä¾›æ›´è‡ªç„¶çš„å­—ä½“æ˜¾ç¤ºæ•ˆæœï¼Œé€‚ç”¨äºé«˜åˆ†è¾¨ç‡å±å¹•ï¼ˆé€šå¸¸ 200+ DPIï¼‰ï¼Œå¦‚ 4K æ˜¾ç¤ºå™¨ã€é«˜åˆ†è¾¨ç‡ç¬”è®°æœ¬å±å¹•ã€‚ subpixel.rgba = \"rgb\" é’ˆå¯¹ IPS å±å¹•çš„ RGB å­åƒç´ æ’åˆ—ä¼˜åŒ–ï¼Œæå‡å­—ä½“æ¸…æ™°åº¦ã€‚åˆ©ç”¨ LCD å±å¹•çš„ RGB å­åƒç´ ç»“æ„ï¼Œé€šè¿‡å­åƒç´ æ¸²æŸ“æŠ€æœ¯æå‡å­—ä½“æ¸…æ™°åº¦ï¼Œåœ¨ LCD å±å¹•ä¸Šæ˜¾è‘—æå‡å­—ä½“æ¸…æ™°åº¦ï¼Œå‡å°‘æ¨¡ç³Šæ„Ÿï¼Œé€‚ç”¨äº IPSã€TNã€VA ç­‰ LCD å±å¹•ï¼Œä¸é€‚ç”¨äº OLED å±å¹•ã€‚ å­—ä½“æ¸²æŸ“ä¼˜åŒ–æ•ˆæœï¼šæŠ—é”¯é½¿å’Œå­åƒç´ æ¸²æŸ“æ˜¾è‘—æå‡æ–‡å­—æ˜¾ç¤ºè´¨é‡ï¼›åœ¨é«˜åˆ†è¾¨ç‡å±å¹•ä¸Šç¦ç”¨å¾®è°ƒæä¾›æ›´è‡ªç„¶çš„æ˜¾ç¤ºæ•ˆæœï¼›åˆç†çš„å­—ä½“å›é€€æœºåˆ¶ç¡®ä¿å„ç§æ–‡å­—çš„æ­£ç¡®æ˜¾ç¤ºï¼›ä¼˜åŒ–çš„æ¸²æŸ“é…ç½®åœ¨æå‡è´¨é‡çš„åŒæ—¶ä¿æŒè‰¯å¥½æ€§èƒ½ã€‚ é‡è¦è¯´æ˜ï¼šSource Han ç³»åˆ—ï¼ˆAdobe å‘å¸ƒï¼‰å’Œ Noto CJK ç³»åˆ—ï¼ˆGoogle å‘å¸ƒï¼‰å®é™…ä¸Šæ˜¯åŒä¸€å¥—å­—ä½“ï¼Œåªæ˜¯åˆ†åˆ«ç”± Adobe å’Œ Google ä»¥è‡ªå·±çš„å“ç‰Œåå‘å¸ƒã€‚åœ¨ NixOS ä¸­ï¼Œsource-han-sans å’Œnoto-fonts-cjk-sans æŒ‡å‘çš„æ˜¯åŒä¸€å¥—å­—ä½“æ–‡ä»¶ã€‚ 2.1.3 å¸¸è§ CJK å­—ä½“é—®é¢˜ä¸è§£å†³æ–¹æ³•","date":"2025-10-19","objectID":"/posts/linux-desktop-4-multimedia-input/:3:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Multimedia","Audio","Video","Input Method"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå››ï¼‰ - å¤šåª’ä½“å¤„ç†ä¸ä¸­æ–‡æ”¯æŒ","uri":"/posts/linux-desktop-4-multimedia-input/#211-fontconfig-æ¶æ„æ¦‚è§ˆ"},{"categories":["tech"],"content":" 2.1 å­—ä½“æ¸²æŸ“å­—ä½“æ¸²æŸ“æ˜¯æ¡Œé¢åº”ç”¨æ˜¾ç¤ºè´¨é‡çš„å…³é”®å› ç´ ï¼Œç‰¹åˆ«æ˜¯å¯¹äºä¸­æ–‡ç”¨æˆ·ï¼ŒCJKï¼ˆä¸­æ—¥éŸ©ï¼‰å­—ä½“çš„æ­£ç¡®é…ç½®ç›´æ¥å½±å“é˜…è¯»ä½“éªŒã€‚Linux æ¡Œé¢é€šè¿‡ fontconfig ç³»ç»Ÿç»Ÿä¸€ç®¡ç†å­—ä½“é…ç½®ï¼Œè§£å†³å­—ä½“åŒ¹é…ã€æ¸²æŸ“å’Œæ˜¾ç¤ºé—®é¢˜ã€‚ 2.1.1 fontconfig æ¶æ„æ¦‚è§ˆfontconfig æ˜¯ Linux æ¡Œé¢ç³»ç»Ÿçš„å­—ä½“é…ç½®æ¡†æ¶ï¼Œè´Ÿè´£ï¼š å­—ä½“å‘ç°ï¼šæ‰«æç³»ç»Ÿå­—ä½“ç›®å½•ï¼Œå»ºç«‹å­—ä½“ç´¢å¼• å­—ä½“åŒ¹é…ï¼šæ ¹æ®åº”ç”¨è¯·æ±‚çš„å­—ä½“ç‰¹å¾ï¼ˆæ—åã€æ ·å¼ã€è¯­è¨€ç­‰ï¼‰é€‰æ‹©æœ€åˆé€‚çš„å­—ä½“ å­—ä½“æ¸²æŸ“ï¼šé…ç½®å­—ä½“æ¸²æŸ“å‚æ•°ï¼ˆæŠ—é”¯é½¿ã€å­åƒç´ æ¸²æŸ“ã€æç¤ºç­‰ï¼‰ å­—ä½“æ›¿æ¢ï¼šå½“è¯·æ±‚çš„å­—ä½“ä¸å­˜åœ¨æ—¶ï¼Œæä¾›åˆé€‚çš„æ›¿ä»£å­—ä½“ æ ¸å¿ƒç»„ä»¶ï¼š fc-cacheï¼šå­—ä½“ç¼“å­˜ç”Ÿæˆå·¥å…· fc-listï¼šå­—ä½“åˆ—è¡¨æŸ¥è¯¢å·¥å…· fc-matchï¼šå­—ä½“åŒ¹é…æµ‹è¯•å·¥å…· é…ç½®æ–‡ä»¶ï¼šXML æ ¼å¼çš„å­—ä½“é…ç½®è§„åˆ™ é…ç½®æ–‡ä»¶å±‚æ¬¡ï¼š bash # ç³»ç»Ÿçº§é…ç½®ï¼ˆä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼‰ /etc/fonts/fonts.conf # ä¸»é…ç½®æ–‡ä»¶ /etc/fonts/conf.d/ # é…ç½®ç‰‡æ®µç›®å½• # ç”¨æˆ·çº§é…ç½® ~/.config/fontconfig/fonts.conf # ç”¨æˆ·ä¸»é…ç½® ~/.config/fontconfig/conf.d/ # ç”¨æˆ·é…ç½®ç‰‡æ®µ 2.1.2 CJK å­—ä½“é…ç½®åŸºç¡€å¸¸è§ CJK å­—ä½“æ—ï¼š å­—ä½“æ— ç‰¹ç‚¹ é€‚ç”¨åœºæ™¯ Source Han Sans Adobe å¼€æºï¼Œä¸“ä¸šè®¾è®¡ ç°ä»£åº”ç”¨ï¼Œç½‘é¡µæ˜¾ç¤º Source Han Serif Adobe å¼€æºï¼Œè¡¬çº¿å­—ä½“ è®¾è®¡è½¯ä»¶ï¼Œå°åˆ· Source Han Mono æ€æºç­‰å®½å­—ä½“ ç¼–ç¨‹ï¼Œä»£ç æ˜¾ç¤º Noto Sans CJK Google å¼€æºï¼Œä¸ Source Han ä¸ºåŒä¸€å­—ä½“ ç³»ç»Ÿç•Œé¢ï¼Œå…¼å®¹æ€§ WenQuanYi æ–‡æ³‰é©¿ï¼Œè½»é‡çº§ ç³»ç»Ÿç•Œé¢ï¼Œç»ˆç«¯ è¯´æ˜ï¼šSource Han ç³»åˆ—å’Œ Noto CJK ç³»åˆ—å®é™…ä¸Šæ˜¯åŒä¸€å¥—å­—ä½“ï¼Œåªæ˜¯åˆ†åˆ«ç”± Adobe å’Œ Google ä»¥è‡ªå·±çš„å“ç‰Œåå‘å¸ƒã€‚ ä»¥åŠä¸€äº›æ–°å…´çš„å¼€æºå­—ä½“ï¼š å­—ä½“æ— ç‰¹ç‚¹ é€‚ç”¨åœºæ™¯ LXGW WenKai Screen éœé¹œæ–‡æ¥·å±å¹•ç‰ˆ å±å¹•é˜…è¯»ï¼Œæ–‡æ¡£ Maple Mono NF CN ä¸­è‹±æ–‡ç­‰å®½å­—ä½“ ç¼–ç¨‹ï¼Œç»ˆç«¯ NixOS å­—ä½“é…ç½®ç¤ºä¾‹ï¼š nix # configuration.nix fonts = { # ç¦ç”¨é»˜è®¤å­—ä½“åŒ…ï¼Œä½¿ç”¨è‡ªå®šä¹‰é…ç½® enableDefaultPackages = false; fontDir.enable = true; # å®‰è£…å¸¸ç”¨ CJK å­—ä½“å’Œå›¾æ ‡å­—ä½“ packages = with pkgs; [ # å›¾æ ‡å­—ä½“ material-design-icons font-awesome nerd-fonts.symbols-only nerd-fonts.jetbrains-mono # Noto æ˜¯ Google å¼€å‘çš„å¼€æºå­—ä½“å®¶æ— # åå­—çš„å«ä¹‰æ˜¯ã€Œæ²¡æœ‰è±†è…ã€ï¼ˆno tofuï¼‰ï¼Œå› ä¸ºç¼ºå­—æ—¶æ˜¾ç¤ºçš„æ–¹æ¡†æˆ–è€…æ–¹æ¡†è¢«å«ä½œ tofu # # Noto ç³»åˆ—å­—æ—åªæ”¯æŒè¥¿æ–‡ï¼Œå‘½åè§„åˆ™æ˜¯ Noto + Sans æˆ– Serif + æ–‡å­—åç§°ã€‚ noto-fonts # å¤§éƒ¨åˆ†æ–‡å­—çš„å¸¸è§æ ·å¼ï¼Œä¸åŒ…å«æ±‰å­— noto-fonts-color-emoji # å½©è‰²çš„è¡¨æƒ…ç¬¦å·å­—ä½“ # Noto CJK ä¸ºã€Œæ€æºã€ç³»åˆ—æ±‰å­—å­—ä½“ï¼Œç”± Adobe + Google å…±åŒå¼€å‘ # Google ä»¥ Noto Sans/Serif CJK SC/TC/HK/JP/KR çš„åç§°å‘å¸ƒè¯¥ç³»åˆ—å­—ä½“ã€‚ # è¿™ä¿©è·Ÿ noto-fonts-cjk-sans/serif å®é™…ä¸ºåŒä¸€å­—ä½“ï¼Œåªæ˜¯åˆ†åˆ«ç”± Adobe/Google ä»¥è‡ªå·±çš„å“ç‰Œåå‘å¸ƒ # noto-fonts-cjk-sans # æ€æºé»‘ä½“ # noto-fonts-cjk-serif # æ€æºå®‹ä½“ # Adobe ä»¥ Source Han Sans/Serif çš„åç§°å‘å¸ƒæ­¤ç³»åˆ—å­—ä½“ source-sans # æ— è¡¬çº¿å­—ä½“ï¼Œä¸å«æ±‰å­—ã€‚å­—æ—åå« Source Sans 3ï¼Œä»¥åŠå¸¦å­—é‡çš„å˜ä½“ï¼ˆVFï¼‰ source-serif # è¡¬çº¿å­—ä½“ï¼Œä¸å«æ±‰å­—ã€‚å­—æ—åå« Source Serif 4ï¼Œä»¥åŠå¸¦å­—é‡çš„å˜ä½“ # Source Hans ç³»åˆ—æ±‰å­—å­—ä½“ç”± Adobe + Google å…±åŒå¼€å‘ source-han-sans # æ€æºé»‘ä½“ source-han-serif # æ€æºå®‹ä½“ source-han-mono # æ€æºç­‰å®½ ]; # å­—ä½“æ¸²æŸ“é…ç½® fontconfig = { enable = true; antialias = true; # å¯ç”¨æŠ—é”¯é½¿ hinting.enable = false; # é«˜åˆ†è¾¨ç‡ä¸‹ç¦ç”¨å­—ä½“å¾®è°ƒ subpixel.rgba = \"rgb\"; # IPS å±å¹•ä½¿ç”¨ RGB å­åƒç´ æ’åˆ— # é»˜è®¤å­—ä½“æ—é…ç½® defaultFonts = { serif = [ \"Source Serif 4\" # è¥¿æ–‡è¡¬çº¿å­—ä½“ \"Source Han Serif SC\" # ä¸­æ–‡å®‹ä½“ \"Source Han Serif TC\" # ç¹ä½“å®‹ä½“ ]; sansSerif = [ \"Source Sans 3\" # è¥¿æ–‡æ— è¡¬çº¿å­—ä½“ \"Source Han Sans SC\" # ä¸­æ–‡é»‘ä½“ \"Source Han Sans TC\" # ç¹ä½“é»‘ä½“ ]; monospace = [ \"Maple Mono NF CN\" # ä¸­è‹±æ–‡ç­‰å®½å­—ä½“ \"Source Han Mono SC\" # ä¸­æ–‡ç­‰å®½ \"JetBrainsMono Nerd Font\" # è¥¿æ–‡ç­‰å®½ ]; emoji = [ \"Noto Color Emoji\" ]; }; }; }; å­—ä½“æ¸²æŸ“é…ç½®å‚æ•°ï¼š antialias = true å¯ç”¨å­—ä½“æŠ—é”¯é½¿ï¼Œè®©å­—ä½“è¾¹ç¼˜æ›´å¹³æ»‘ï¼Œæå‡æ˜¾ç¤ºè´¨é‡ã€‚é€šè¿‡ç°åº¦æ’å€¼æŠ€æœ¯å¹³æ»‘å­—ä½“è¾¹ç¼˜ï¼Œå‡å°‘é”¯é½¿æ•ˆæœï¼Œæ˜¾è‘—æå‡æ–‡å­—æ˜¾ç¤ºè´¨é‡ï¼Œç‰¹åˆ«æ˜¯åœ¨é«˜åˆ†è¾¨ç‡å±å¹•ä¸Šï¼Œé€‚ç”¨äºæ‰€æœ‰ç°ä»£æ˜¾ç¤ºè®¾å¤‡ï¼Œç‰¹åˆ«æ˜¯é«˜åˆ†è¾¨ç‡å±å¹•ã€‚ hinting.enable = false åœ¨é«˜åˆ†è¾¨ç‡å±å¹•ï¼ˆå¦‚ 4Kï¼‰ä¸Šç¦ç”¨å­—ä½“å¾®è°ƒï¼Œé¿å…è¿‡åº¦æ¸²æŸ“ã€‚å­—ä½“å¾®è°ƒ ï¼ˆhintingï¼‰æ˜¯ä¸ºä½åˆ†è¾¨ç‡å±å¹•è®¾è®¡çš„ä¼˜åŒ–æŠ€æœ¯ï¼Œåœ¨é«˜åˆ†è¾¨ç‡ä¸‹å¯èƒ½é€ æˆè¿‡åº¦æ¸²æŸ“ï¼Œåœ¨é«˜åˆ†è¾¨ç‡å±å¹•ä¸Šæä¾›æ›´è‡ªç„¶çš„å­—ä½“æ˜¾ç¤ºæ•ˆæœï¼Œé€‚ç”¨äºé«˜åˆ†è¾¨ç‡å±å¹•ï¼ˆé€šå¸¸ 200+ DPIï¼‰ï¼Œå¦‚ 4K æ˜¾ç¤ºå™¨ã€é«˜åˆ†è¾¨ç‡ç¬”è®°æœ¬å±å¹•ã€‚ subpixel.rgba = \"rgb\" é’ˆå¯¹ IPS å±å¹•çš„ RGB å­åƒç´ æ’åˆ—ä¼˜åŒ–ï¼Œæå‡å­—ä½“æ¸…æ™°åº¦ã€‚åˆ©ç”¨ LCD å±å¹•çš„ RGB å­åƒç´ ç»“æ„ï¼Œé€šè¿‡å­åƒç´ æ¸²æŸ“æŠ€æœ¯æå‡å­—ä½“æ¸…æ™°åº¦ï¼Œåœ¨ LCD å±å¹•ä¸Šæ˜¾è‘—æå‡å­—ä½“æ¸…æ™°åº¦ï¼Œå‡å°‘æ¨¡ç³Šæ„Ÿï¼Œé€‚ç”¨äº IPSã€TNã€VA ç­‰ LCD å±å¹•ï¼Œä¸é€‚ç”¨äº OLED å±å¹•ã€‚ å­—ä½“æ¸²æŸ“ä¼˜åŒ–æ•ˆæœï¼šæŠ—é”¯é½¿å’Œå­åƒç´ æ¸²æŸ“æ˜¾è‘—æå‡æ–‡å­—æ˜¾ç¤ºè´¨é‡ï¼›åœ¨é«˜åˆ†è¾¨ç‡å±å¹•ä¸Šç¦ç”¨å¾®è°ƒæä¾›æ›´è‡ªç„¶çš„æ˜¾ç¤ºæ•ˆæœï¼›åˆç†çš„å­—ä½“å›é€€æœºåˆ¶ç¡®ä¿å„ç§æ–‡å­—çš„æ­£ç¡®æ˜¾ç¤ºï¼›ä¼˜åŒ–çš„æ¸²æŸ“é…ç½®åœ¨æå‡è´¨é‡çš„åŒæ—¶ä¿æŒè‰¯å¥½æ€§èƒ½ã€‚ é‡è¦è¯´æ˜ï¼šSource Han ç³»åˆ—ï¼ˆAdobe å‘å¸ƒï¼‰å’Œ Noto CJK ç³»åˆ—ï¼ˆGoogle å‘å¸ƒï¼‰å®é™…ä¸Šæ˜¯åŒä¸€å¥—å­—ä½“ï¼Œåªæ˜¯åˆ†åˆ«ç”± Adobe å’Œ Google ä»¥è‡ªå·±çš„å“ç‰Œåå‘å¸ƒã€‚åœ¨ NixOS ä¸­ï¼Œsource-han-sans å’Œnoto-fonts-cjk-sans æŒ‡å‘çš„æ˜¯åŒä¸€å¥—å­—ä½“æ–‡ä»¶ã€‚ 2.1.3 å¸¸è§ CJK å­—ä½“é—®é¢˜ä¸è§£å†³æ–¹æ³•","date":"2025-10-19","objectID":"/posts/linux-desktop-4-multimedia-input/:3:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Multimedia","Audio","Video","Input Method"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå››ï¼‰ - å¤šåª’ä½“å¤„ç†ä¸ä¸­æ–‡æ”¯æŒ","uri":"/posts/linux-desktop-4-multimedia-input/#212-cjk-å­—ä½“é…ç½®åŸºç¡€"},{"categories":["tech"],"content":" 2.1 å­—ä½“æ¸²æŸ“å­—ä½“æ¸²æŸ“æ˜¯æ¡Œé¢åº”ç”¨æ˜¾ç¤ºè´¨é‡çš„å…³é”®å› ç´ ï¼Œç‰¹åˆ«æ˜¯å¯¹äºä¸­æ–‡ç”¨æˆ·ï¼ŒCJKï¼ˆä¸­æ—¥éŸ©ï¼‰å­—ä½“çš„æ­£ç¡®é…ç½®ç›´æ¥å½±å“é˜…è¯»ä½“éªŒã€‚Linux æ¡Œé¢é€šè¿‡ fontconfig ç³»ç»Ÿç»Ÿä¸€ç®¡ç†å­—ä½“é…ç½®ï¼Œè§£å†³å­—ä½“åŒ¹é…ã€æ¸²æŸ“å’Œæ˜¾ç¤ºé—®é¢˜ã€‚ 2.1.1 fontconfig æ¶æ„æ¦‚è§ˆfontconfig æ˜¯ Linux æ¡Œé¢ç³»ç»Ÿçš„å­—ä½“é…ç½®æ¡†æ¶ï¼Œè´Ÿè´£ï¼š å­—ä½“å‘ç°ï¼šæ‰«æç³»ç»Ÿå­—ä½“ç›®å½•ï¼Œå»ºç«‹å­—ä½“ç´¢å¼• å­—ä½“åŒ¹é…ï¼šæ ¹æ®åº”ç”¨è¯·æ±‚çš„å­—ä½“ç‰¹å¾ï¼ˆæ—åã€æ ·å¼ã€è¯­è¨€ç­‰ï¼‰é€‰æ‹©æœ€åˆé€‚çš„å­—ä½“ å­—ä½“æ¸²æŸ“ï¼šé…ç½®å­—ä½“æ¸²æŸ“å‚æ•°ï¼ˆæŠ—é”¯é½¿ã€å­åƒç´ æ¸²æŸ“ã€æç¤ºç­‰ï¼‰ å­—ä½“æ›¿æ¢ï¼šå½“è¯·æ±‚çš„å­—ä½“ä¸å­˜åœ¨æ—¶ï¼Œæä¾›åˆé€‚çš„æ›¿ä»£å­—ä½“ æ ¸å¿ƒç»„ä»¶ï¼š fc-cacheï¼šå­—ä½“ç¼“å­˜ç”Ÿæˆå·¥å…· fc-listï¼šå­—ä½“åˆ—è¡¨æŸ¥è¯¢å·¥å…· fc-matchï¼šå­—ä½“åŒ¹é…æµ‹è¯•å·¥å…· é…ç½®æ–‡ä»¶ï¼šXML æ ¼å¼çš„å­—ä½“é…ç½®è§„åˆ™ é…ç½®æ–‡ä»¶å±‚æ¬¡ï¼š bash # ç³»ç»Ÿçº§é…ç½®ï¼ˆä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼‰ /etc/fonts/fonts.conf # ä¸»é…ç½®æ–‡ä»¶ /etc/fonts/conf.d/ # é…ç½®ç‰‡æ®µç›®å½• # ç”¨æˆ·çº§é…ç½® ~/.config/fontconfig/fonts.conf # ç”¨æˆ·ä¸»é…ç½® ~/.config/fontconfig/conf.d/ # ç”¨æˆ·é…ç½®ç‰‡æ®µ 2.1.2 CJK å­—ä½“é…ç½®åŸºç¡€å¸¸è§ CJK å­—ä½“æ—ï¼š å­—ä½“æ— ç‰¹ç‚¹ é€‚ç”¨åœºæ™¯ Source Han Sans Adobe å¼€æºï¼Œä¸“ä¸šè®¾è®¡ ç°ä»£åº”ç”¨ï¼Œç½‘é¡µæ˜¾ç¤º Source Han Serif Adobe å¼€æºï¼Œè¡¬çº¿å­—ä½“ è®¾è®¡è½¯ä»¶ï¼Œå°åˆ· Source Han Mono æ€æºç­‰å®½å­—ä½“ ç¼–ç¨‹ï¼Œä»£ç æ˜¾ç¤º Noto Sans CJK Google å¼€æºï¼Œä¸ Source Han ä¸ºåŒä¸€å­—ä½“ ç³»ç»Ÿç•Œé¢ï¼Œå…¼å®¹æ€§ WenQuanYi æ–‡æ³‰é©¿ï¼Œè½»é‡çº§ ç³»ç»Ÿç•Œé¢ï¼Œç»ˆç«¯ è¯´æ˜ï¼šSource Han ç³»åˆ—å’Œ Noto CJK ç³»åˆ—å®é™…ä¸Šæ˜¯åŒä¸€å¥—å­—ä½“ï¼Œåªæ˜¯åˆ†åˆ«ç”± Adobe å’Œ Google ä»¥è‡ªå·±çš„å“ç‰Œåå‘å¸ƒã€‚ ä»¥åŠä¸€äº›æ–°å…´çš„å¼€æºå­—ä½“ï¼š å­—ä½“æ— ç‰¹ç‚¹ é€‚ç”¨åœºæ™¯ LXGW WenKai Screen éœé¹œæ–‡æ¥·å±å¹•ç‰ˆ å±å¹•é˜…è¯»ï¼Œæ–‡æ¡£ Maple Mono NF CN ä¸­è‹±æ–‡ç­‰å®½å­—ä½“ ç¼–ç¨‹ï¼Œç»ˆç«¯ NixOS å­—ä½“é…ç½®ç¤ºä¾‹ï¼š nix # configuration.nix fonts = { # ç¦ç”¨é»˜è®¤å­—ä½“åŒ…ï¼Œä½¿ç”¨è‡ªå®šä¹‰é…ç½® enableDefaultPackages = false; fontDir.enable = true; # å®‰è£…å¸¸ç”¨ CJK å­—ä½“å’Œå›¾æ ‡å­—ä½“ packages = with pkgs; [ # å›¾æ ‡å­—ä½“ material-design-icons font-awesome nerd-fonts.symbols-only nerd-fonts.jetbrains-mono # Noto æ˜¯ Google å¼€å‘çš„å¼€æºå­—ä½“å®¶æ— # åå­—çš„å«ä¹‰æ˜¯ã€Œæ²¡æœ‰è±†è…ã€ï¼ˆno tofuï¼‰ï¼Œå› ä¸ºç¼ºå­—æ—¶æ˜¾ç¤ºçš„æ–¹æ¡†æˆ–è€…æ–¹æ¡†è¢«å«ä½œ tofu # # Noto ç³»åˆ—å­—æ—åªæ”¯æŒè¥¿æ–‡ï¼Œå‘½åè§„åˆ™æ˜¯ Noto + Sans æˆ– Serif + æ–‡å­—åç§°ã€‚ noto-fonts # å¤§éƒ¨åˆ†æ–‡å­—çš„å¸¸è§æ ·å¼ï¼Œä¸åŒ…å«æ±‰å­— noto-fonts-color-emoji # å½©è‰²çš„è¡¨æƒ…ç¬¦å·å­—ä½“ # Noto CJK ä¸ºã€Œæ€æºã€ç³»åˆ—æ±‰å­—å­—ä½“ï¼Œç”± Adobe + Google å…±åŒå¼€å‘ # Google ä»¥ Noto Sans/Serif CJK SC/TC/HK/JP/KR çš„åç§°å‘å¸ƒè¯¥ç³»åˆ—å­—ä½“ã€‚ # è¿™ä¿©è·Ÿ noto-fonts-cjk-sans/serif å®é™…ä¸ºåŒä¸€å­—ä½“ï¼Œåªæ˜¯åˆ†åˆ«ç”± Adobe/Google ä»¥è‡ªå·±çš„å“ç‰Œåå‘å¸ƒ # noto-fonts-cjk-sans # æ€æºé»‘ä½“ # noto-fonts-cjk-serif # æ€æºå®‹ä½“ # Adobe ä»¥ Source Han Sans/Serif çš„åç§°å‘å¸ƒæ­¤ç³»åˆ—å­—ä½“ source-sans # æ— è¡¬çº¿å­—ä½“ï¼Œä¸å«æ±‰å­—ã€‚å­—æ—åå« Source Sans 3ï¼Œä»¥åŠå¸¦å­—é‡çš„å˜ä½“ï¼ˆVFï¼‰ source-serif # è¡¬çº¿å­—ä½“ï¼Œä¸å«æ±‰å­—ã€‚å­—æ—åå« Source Serif 4ï¼Œä»¥åŠå¸¦å­—é‡çš„å˜ä½“ # Source Hans ç³»åˆ—æ±‰å­—å­—ä½“ç”± Adobe + Google å…±åŒå¼€å‘ source-han-sans # æ€æºé»‘ä½“ source-han-serif # æ€æºå®‹ä½“ source-han-mono # æ€æºç­‰å®½ ]; # å­—ä½“æ¸²æŸ“é…ç½® fontconfig = { enable = true; antialias = true; # å¯ç”¨æŠ—é”¯é½¿ hinting.enable = false; # é«˜åˆ†è¾¨ç‡ä¸‹ç¦ç”¨å­—ä½“å¾®è°ƒ subpixel.rgba = \"rgb\"; # IPS å±å¹•ä½¿ç”¨ RGB å­åƒç´ æ’åˆ— # é»˜è®¤å­—ä½“æ—é…ç½® defaultFonts = { serif = [ \"Source Serif 4\" # è¥¿æ–‡è¡¬çº¿å­—ä½“ \"Source Han Serif SC\" # ä¸­æ–‡å®‹ä½“ \"Source Han Serif TC\" # ç¹ä½“å®‹ä½“ ]; sansSerif = [ \"Source Sans 3\" # è¥¿æ–‡æ— è¡¬çº¿å­—ä½“ \"Source Han Sans SC\" # ä¸­æ–‡é»‘ä½“ \"Source Han Sans TC\" # ç¹ä½“é»‘ä½“ ]; monospace = [ \"Maple Mono NF CN\" # ä¸­è‹±æ–‡ç­‰å®½å­—ä½“ \"Source Han Mono SC\" # ä¸­æ–‡ç­‰å®½ \"JetBrainsMono Nerd Font\" # è¥¿æ–‡ç­‰å®½ ]; emoji = [ \"Noto Color Emoji\" ]; }; }; }; å­—ä½“æ¸²æŸ“é…ç½®å‚æ•°ï¼š antialias = true å¯ç”¨å­—ä½“æŠ—é”¯é½¿ï¼Œè®©å­—ä½“è¾¹ç¼˜æ›´å¹³æ»‘ï¼Œæå‡æ˜¾ç¤ºè´¨é‡ã€‚é€šè¿‡ç°åº¦æ’å€¼æŠ€æœ¯å¹³æ»‘å­—ä½“è¾¹ç¼˜ï¼Œå‡å°‘é”¯é½¿æ•ˆæœï¼Œæ˜¾è‘—æå‡æ–‡å­—æ˜¾ç¤ºè´¨é‡ï¼Œç‰¹åˆ«æ˜¯åœ¨é«˜åˆ†è¾¨ç‡å±å¹•ä¸Šï¼Œé€‚ç”¨äºæ‰€æœ‰ç°ä»£æ˜¾ç¤ºè®¾å¤‡ï¼Œç‰¹åˆ«æ˜¯é«˜åˆ†è¾¨ç‡å±å¹•ã€‚ hinting.enable = false åœ¨é«˜åˆ†è¾¨ç‡å±å¹•ï¼ˆå¦‚ 4Kï¼‰ä¸Šç¦ç”¨å­—ä½“å¾®è°ƒï¼Œé¿å…è¿‡åº¦æ¸²æŸ“ã€‚å­—ä½“å¾®è°ƒ ï¼ˆhintingï¼‰æ˜¯ä¸ºä½åˆ†è¾¨ç‡å±å¹•è®¾è®¡çš„ä¼˜åŒ–æŠ€æœ¯ï¼Œåœ¨é«˜åˆ†è¾¨ç‡ä¸‹å¯èƒ½é€ æˆè¿‡åº¦æ¸²æŸ“ï¼Œåœ¨é«˜åˆ†è¾¨ç‡å±å¹•ä¸Šæä¾›æ›´è‡ªç„¶çš„å­—ä½“æ˜¾ç¤ºæ•ˆæœï¼Œé€‚ç”¨äºé«˜åˆ†è¾¨ç‡å±å¹•ï¼ˆé€šå¸¸ 200+ DPIï¼‰ï¼Œå¦‚ 4K æ˜¾ç¤ºå™¨ã€é«˜åˆ†è¾¨ç‡ç¬”è®°æœ¬å±å¹•ã€‚ subpixel.rgba = \"rgb\" é’ˆå¯¹ IPS å±å¹•çš„ RGB å­åƒç´ æ’åˆ—ä¼˜åŒ–ï¼Œæå‡å­—ä½“æ¸…æ™°åº¦ã€‚åˆ©ç”¨ LCD å±å¹•çš„ RGB å­åƒç´ ç»“æ„ï¼Œé€šè¿‡å­åƒç´ æ¸²æŸ“æŠ€æœ¯æå‡å­—ä½“æ¸…æ™°åº¦ï¼Œåœ¨ LCD å±å¹•ä¸Šæ˜¾è‘—æå‡å­—ä½“æ¸…æ™°åº¦ï¼Œå‡å°‘æ¨¡ç³Šæ„Ÿï¼Œé€‚ç”¨äº IPSã€TNã€VA ç­‰ LCD å±å¹•ï¼Œä¸é€‚ç”¨äº OLED å±å¹•ã€‚ å­—ä½“æ¸²æŸ“ä¼˜åŒ–æ•ˆæœï¼šæŠ—é”¯é½¿å’Œå­åƒç´ æ¸²æŸ“æ˜¾è‘—æå‡æ–‡å­—æ˜¾ç¤ºè´¨é‡ï¼›åœ¨é«˜åˆ†è¾¨ç‡å±å¹•ä¸Šç¦ç”¨å¾®è°ƒæä¾›æ›´è‡ªç„¶çš„æ˜¾ç¤ºæ•ˆæœï¼›åˆç†çš„å­—ä½“å›é€€æœºåˆ¶ç¡®ä¿å„ç§æ–‡å­—çš„æ­£ç¡®æ˜¾ç¤ºï¼›ä¼˜åŒ–çš„æ¸²æŸ“é…ç½®åœ¨æå‡è´¨é‡çš„åŒæ—¶ä¿æŒè‰¯å¥½æ€§èƒ½ã€‚ é‡è¦è¯´æ˜ï¼šSource Han ç³»åˆ—ï¼ˆAdobe å‘å¸ƒï¼‰å’Œ Noto CJK ç³»åˆ—ï¼ˆGoogle å‘å¸ƒï¼‰å®é™…ä¸Šæ˜¯åŒä¸€å¥—å­—ä½“ï¼Œåªæ˜¯åˆ†åˆ«ç”± Adobe å’Œ Google ä»¥è‡ªå·±çš„å“ç‰Œåå‘å¸ƒã€‚åœ¨ NixOS ä¸­ï¼Œsource-han-sans å’Œnoto-fonts-cjk-sans æŒ‡å‘çš„æ˜¯åŒä¸€å¥—å­—ä½“æ–‡ä»¶ã€‚ 2.1.3 å¸¸è§ CJK å­—ä½“é—®é¢˜ä¸è§£å†³æ–¹æ³•","date":"2025-10-19","objectID":"/posts/linux-desktop-4-multimedia-input/:3:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Multimedia","Audio","Video","Input Method"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå››ï¼‰ - å¤šåª’ä½“å¤„ç†ä¸ä¸­æ–‡æ”¯æŒ","uri":"/posts/linux-desktop-4-multimedia-input/#213-å¸¸è§-cjk-å­—ä½“é—®é¢˜ä¸è§£å†³æ–¹æ³•"},{"categories":["tech"],"content":" é—®é¢˜ 1ï¼šä¸­æ–‡å­—ç¬¦æ˜¾ç¤ºä¸ºæ–¹å—æˆ–é—®å·åŸå› ï¼šç³»ç»Ÿç¼ºå°‘ä¸­æ–‡å­—ä½“æˆ–å­—ä½“åŒ¹é…è§„åˆ™ä¸æ­£ç¡® æ’æŸ¥æ­¥éª¤ï¼š bash # 1. æ£€æŸ¥å·²å®‰è£…çš„ CJK å­—ä½“ fc-list :lang=zh-cn # 2. æµ‹è¯•å­—ä½“åŒ¹é… fc-match \"sans-serif:lang=zh-cn\" fc-match \"serif:lang=zh-cn\" # 3. æŸ¥çœ‹å­—ä½“è¯¦ç»†ä¿¡æ¯ fc-list | grep -i \"noto\\|source\\|wqy\" ä½¿ç”¨ä¸Šé¢æä¾›çš„ç¤ºä¾‹é…ç½®é€šå¸¸å¯è§£å†³é—®é¢˜ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-4-multimedia-input/:3:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Multimedia","Audio","Video","Input Method"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå››ï¼‰ - å¤šåª’ä½“å¤„ç†ä¸ä¸­æ–‡æ”¯æŒ","uri":"/posts/linux-desktop-4-multimedia-input/#é—®é¢˜-1ä¸­æ–‡å­—ç¬¦æ˜¾ç¤ºä¸ºæ–¹å—æˆ–é—®å·"},{"categories":["tech"],"content":" é—®é¢˜ 2ï¼šä¸­æ–‡å­—ä½“ä¸­å¤¹æ‚æ—¥è¯­å­—ä½“åŸå› ï¼šCJK å­—ä½“é€šå¸¸åŒ…å«ä¸­æ–‡ã€æ—¥æ–‡ã€éŸ©æ–‡å­—ç¬¦ï¼Œå½“ç³»ç»Ÿç¼ºå°‘ä¸“é—¨çš„ä¸­æ–‡å­—ä½“æ—¶ï¼Œä¼šä½¿ç”¨åŒ…å«æ—¥æ–‡å­—ç¬¦çš„ CJK å­—ä½“ï¼Œå¯¼è‡´ä¸­æ–‡å­—ç¬¦æ˜¾ç¤ºä¸ºæ—¥è¯­å­—å½¢ã€‚ æ’æŸ¥æ­¥éª¤ï¼š bash # æ£€æŸ¥å½“å‰ä½¿ç”¨çš„å­—ä½“ fc-match \"sans-serif:lang=zh-cn\" fc-match \"serif:lang=zh-cn\" # æŸ¥çœ‹å­—ä½“åŒ…å«çš„è¯­è¨€æ”¯æŒ fc-list :lang=zh-cn fc-list :lang=ja è§£å†³æ–¹æ³•ï¼š nix # configuration.nix fonts.fontconfig = { enable = true; defaultFonts = { sansSerif = [ \"Source Han Sans SC\" # ç®€ä½“ä¸­æ–‡ä¼˜å…ˆ \"Source Han Sans TC\" # ç¹ä½“ä¸­æ–‡å¤‡é€‰ \"Source Sans 3\" # è¥¿æ–‡å¤‡é€‰ ]; serif = [ \"Source Han Serif SC\" # ç®€ä½“ä¸­æ–‡ä¼˜å…ˆ \"Source Han Serif TC\" # ç¹ä½“ä¸­æ–‡å¤‡é€‰ \"Source Serif 4\" # è¥¿æ–‡å¤‡é€‰ ]; }; }; 2.1.4 å­—ä½“è°ƒè¯•ä¸ä¼˜åŒ–å·¥å…·å­—ä½“ä¿¡æ¯æŸ¥è¯¢ï¼š bash # åˆ—å‡ºæ‰€æœ‰å­—ä½“ fc-list # æŒ‰è¯­è¨€è¿‡æ»¤å­—ä½“ fc-list :lang=zh-cn fc-list :lang=en # æŸ¥çœ‹å­—ä½“è¯¦ç»†ä¿¡æ¯ fc-list -v \"Source Han Sans SC\" fc-list -v \"LXGW WenKai Screen\" # æµ‹è¯•å­—ä½“åŒ¹é… fc-match -v \"sans-serif:lang=zh-cn\" fc-match -v \"serif:lang=zh-cn\" fc-match -v \"monospace:lang=zh-cn\" å­—ä½“æ¸²æŸ“æµ‹è¯•ï¼š bash # ä¸´æ—¶å®‰è£…å­—ä½“æµ‹è¯•å·¥å…· nix shell nixpkgs#pango # åˆ›å»ºæµ‹è¯•æ–‡æœ¬æ–‡ä»¶ echo \"ä¸­æ–‡æµ‹è¯• Chinese Test 123\" \u003e test.txt # ä½¿ç”¨ä¸åŒå­—ä½“æ¸²æŸ“æµ‹è¯• pango-view --font=\"Source Han Sans SC 12\" test.txt pango-view --font=\"LXGW WenKai Screen 12\" test.txt pango-view --font=\"Maple Mono NF CN 12\" test.txt ","date":"2025-10-19","objectID":"/posts/linux-desktop-4-multimedia-input/:3:3","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Multimedia","Audio","Video","Input Method"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå››ï¼‰ - å¤šåª’ä½“å¤„ç†ä¸ä¸­æ–‡æ”¯æŒ","uri":"/posts/linux-desktop-4-multimedia-input/#é—®é¢˜-2ä¸­æ–‡å­—ä½“ä¸­å¤¹æ‚æ—¥è¯­å­—ä½“"},{"categories":["tech"],"content":" é—®é¢˜ 2ï¼šä¸­æ–‡å­—ä½“ä¸­å¤¹æ‚æ—¥è¯­å­—ä½“åŸå› ï¼šCJK å­—ä½“é€šå¸¸åŒ…å«ä¸­æ–‡ã€æ—¥æ–‡ã€éŸ©æ–‡å­—ç¬¦ï¼Œå½“ç³»ç»Ÿç¼ºå°‘ä¸“é—¨çš„ä¸­æ–‡å­—ä½“æ—¶ï¼Œä¼šä½¿ç”¨åŒ…å«æ—¥æ–‡å­—ç¬¦çš„ CJK å­—ä½“ï¼Œå¯¼è‡´ä¸­æ–‡å­—ç¬¦æ˜¾ç¤ºä¸ºæ—¥è¯­å­—å½¢ã€‚ æ’æŸ¥æ­¥éª¤ï¼š bash # æ£€æŸ¥å½“å‰ä½¿ç”¨çš„å­—ä½“ fc-match \"sans-serif:lang=zh-cn\" fc-match \"serif:lang=zh-cn\" # æŸ¥çœ‹å­—ä½“åŒ…å«çš„è¯­è¨€æ”¯æŒ fc-list :lang=zh-cn fc-list :lang=ja è§£å†³æ–¹æ³•ï¼š nix # configuration.nix fonts.fontconfig = { enable = true; defaultFonts = { sansSerif = [ \"Source Han Sans SC\" # ç®€ä½“ä¸­æ–‡ä¼˜å…ˆ \"Source Han Sans TC\" # ç¹ä½“ä¸­æ–‡å¤‡é€‰ \"Source Sans 3\" # è¥¿æ–‡å¤‡é€‰ ]; serif = [ \"Source Han Serif SC\" # ç®€ä½“ä¸­æ–‡ä¼˜å…ˆ \"Source Han Serif TC\" # ç¹ä½“ä¸­æ–‡å¤‡é€‰ \"Source Serif 4\" # è¥¿æ–‡å¤‡é€‰ ]; }; }; 2.1.4 å­—ä½“è°ƒè¯•ä¸ä¼˜åŒ–å·¥å…·å­—ä½“ä¿¡æ¯æŸ¥è¯¢ï¼š bash # åˆ—å‡ºæ‰€æœ‰å­—ä½“ fc-list # æŒ‰è¯­è¨€è¿‡æ»¤å­—ä½“ fc-list :lang=zh-cn fc-list :lang=en # æŸ¥çœ‹å­—ä½“è¯¦ç»†ä¿¡æ¯ fc-list -v \"Source Han Sans SC\" fc-list -v \"LXGW WenKai Screen\" # æµ‹è¯•å­—ä½“åŒ¹é… fc-match -v \"sans-serif:lang=zh-cn\" fc-match -v \"serif:lang=zh-cn\" fc-match -v \"monospace:lang=zh-cn\" å­—ä½“æ¸²æŸ“æµ‹è¯•ï¼š bash # ä¸´æ—¶å®‰è£…å­—ä½“æµ‹è¯•å·¥å…· nix shell nixpkgs#pango # åˆ›å»ºæµ‹è¯•æ–‡æœ¬æ–‡ä»¶ echo \"ä¸­æ–‡æµ‹è¯• Chinese Test 123\" \u003e test.txt # ä½¿ç”¨ä¸åŒå­—ä½“æ¸²æŸ“æµ‹è¯• pango-view --font=\"Source Han Sans SC 12\" test.txt pango-view --font=\"LXGW WenKai Screen 12\" test.txt pango-view --font=\"Maple Mono NF CN 12\" test.txt ","date":"2025-10-19","objectID":"/posts/linux-desktop-4-multimedia-input/:3:3","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Multimedia","Audio","Video","Input Method"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå››ï¼‰ - å¤šåª’ä½“å¤„ç†ä¸ä¸­æ–‡æ”¯æŒ","uri":"/posts/linux-desktop-4-multimedia-input/#214-å­—ä½“è°ƒè¯•ä¸ä¼˜åŒ–å·¥å…·"},{"categories":["tech"],"content":" 2.2 ä¸­æ–‡è¾“å…¥æ³•ç°ä»£ Linux æ¡Œé¢ä¸»è¦ä½¿ç”¨ fcitx5 ä½œä¸ºä¸­æ–‡è¾“å…¥è§£å†³æ–¹æ¡ˆï¼Œå®ƒé€šè¿‡æ’ä»¶ç³»ç»Ÿæ”¯æŒå¤šç§è¾“å…¥å¼•æ“ï¼Œå¹¶ä¸å›¾å½¢ç¯å¢ƒæ·±åº¦é›†æˆã€‚ 2.2.1 è¾“å…¥æ³•æ¡†æ¶æ¶æ„æ ¸å¿ƒç»„ä»¶ï¼š fcitx5-daemonï¼šä¸»å®ˆæŠ¤è¿›ç¨‹ï¼Œç®¡ç†è¾“å…¥æ³•çŠ¶æ€ è¾“å…¥å¼•æ“ï¼šæ‹¼éŸ³ã€äº”ç¬”ã€ä»“é¢‰ç­‰å…·ä½“è¾“å…¥æ³•å®ç° å›¾å½¢å‰ç«¯ï¼šè´Ÿè´£å€™é€‰è¯ç•Œé¢æ˜¾ç¤º é…ç½®å·¥å…·ï¼šfcitx5-configtool æä¾›å›¾å½¢åŒ–é…ç½® é…ç½®æ–‡ä»¶è·¯å¾„ï¼š ~/.config/fcitx5/configï¼šä¸»é…ç½®æ–‡ä»¶ ~/.config/fcitx5/profileï¼šè¾“å…¥æ³•å¼•æ“é…ç½® ~/.config/fcitx5/conf/ï¼šå„è¾“å…¥æ³•å¼•æ“çš„è¯¦ç»†é…ç½® 2.2.2 Wayland åŸç”Ÿè¾“å…¥æ³•æµç¨‹Wayland text-input åè®®æµç¨‹ï¼š æŒ‰é”®æ•è·ï¼šé”®ç›˜äº‹ä»¶é¦–å…ˆåˆ°è¾¾ Wayland åˆæˆå™¨ åè®®é€šä¿¡ï¼šåˆæˆå™¨é€šè¿‡ text-input åè®®ä¸å®¢æˆ·ç«¯åº”ç”¨é€šä¿¡ è¾“å…¥æ³•æœåŠ¡ï¼šfcitx5 ä½œä¸º Wayland è¾“å…¥æ³•æœåŠ¡æ¥æ”¶äº‹ä»¶ å€™é€‰ç”Ÿæˆï¼šfcitx5 å¤„ç†æŒ‰é”®å¹¶ç”Ÿæˆå€™é€‰è¯ å€™é€‰æ˜¾ç¤ºï¼šé€šè¿‡ Wayland åè®®åœ¨å…‰æ ‡ä½ç½®æ˜¾ç¤ºå€™é€‰çª—å£ æ–‡æœ¬æäº¤ï¼šç”¨æˆ·é€‰æ‹©åé€šè¿‡ text-input åè®®æäº¤æœ€ç»ˆæ–‡æœ¬ text-input åè®®æœ‰ v1 è·Ÿ v3 ä¸¤ä¸ªç‰ˆæœ¬ï¼Œç›®å‰ï¼ˆ2025-09ï¼‰Electron/Chrome ä»¥åŠå…¶ä»–å¤§éƒ¨åˆ†ç¨‹åºæ¡†æ¶éƒ½å·²ç»æ”¯æŒäº† text-input-v3. æ¡Œé¢ç¯å¢ƒæ–¹é¢æ‰€æœ‰ä¸»æµ Compositor ä¹Ÿéƒ½æ”¯æŒ text-input-v3. æ‰€ä»¥ç›®å‰ wayland ä¸‹è¾“å…¥æ³•çš„å¯ç”¨æ€§å·²ç»å¾ˆé«˜äº†ã€‚ 2.2.3 X11 / XWayland è¾“å…¥æ³•æµç¨‹XWayland ä½¿ç”¨åœºæ™¯ï¼š å°šæœªæ”¯æŒ Wayland çš„æ—§ç‰ˆåº”ç”¨ éœ€è¦ç‰¹å®š X11 åŠŸèƒ½çš„ä¸“ä¸šè½¯ä»¶ é€šè¿‡åº”ç”¨å¯åŠ¨è„šæœ¬å•ç‹¬è®¾ç½®ç¯å¢ƒå˜é‡ XWayland åº”ç”¨è¾“å…¥æµç¨‹ï¼š æŒ‰é”®æ•è·ï¼šé”®ç›˜äº‹ä»¶é¦–å…ˆè¿›å…¥ Wayland åˆæˆå™¨ï¼ˆHyprlandã€KWin ç­‰ï¼‰ã€‚ äº‹ä»¶è½¬å‘ç»™ XWaylandï¼ˆä¾‹å¦‚xwayland-satelliteï¼‰ å¦‚æœç›®æ ‡æ˜¯ X11 åº”ç”¨çª—å£ï¼Œåˆæˆå™¨ä¼šå°†äº‹ä»¶äº¤ç»™ XWaylandã€‚ XWayland å°† Wayland è¾“å…¥äº‹ä»¶è½¬æ¢ä¸º X11 åè®®äº‹ä»¶ï¼ˆå¦‚ KeyPress/KeyReleaseï¼‰ï¼Œå¹¶äº¤ä»˜ç»™ç›®æ ‡åº”ç”¨ã€‚ åº”ç”¨ä¾§çš„è¾“å…¥æ³•æ¨¡å—æ‹¦æˆªäº‹ä»¶ X11 åº”ç”¨ï¼ˆGTK/Qt ç¨‹åºï¼‰å†…éƒ¨åŠ è½½äº† fcitx5-gtk / fcitx5-qt æ’ä»¶ï¼ˆé€šå¸¸æ ¹æ®ç¯å¢ƒå˜é‡åŠ è½½ï¼Œåé¢ä¼šä»‹ç»è¿™äº›ç¯å¢ƒå˜é‡ï¼‰ã€‚ è¿™äº›æ’ä»¶æ‹¦æˆªæ¥è‡ª XWayland çš„é”®ç›˜äº‹ä»¶ï¼Œå¹¶é€šè¿‡ D-Bus å°†äº‹ä»¶ä¸ŠæŠ¥ç»™ fcitx5ã€‚ æ­¤æ—¶åº”ç”¨ç›¸å½“äºæ˜¯ã€ŒæŠŠé”®ç›˜è¾“å…¥äº¤ç»™ fcitx5 ä»£ç®¡ã€ã€‚ fcitx5 å¤„ç†è¾“å…¥é€»è¾‘ fcitx5 æ”¶åˆ°é”®ç›˜åºåˆ—åï¼Œè¿›å…¥è¾“å…¥æ³•é€»è¾‘ï¼šæ‹¼éŸ³è§£æã€å€™é€‰è¯ç”Ÿæˆã€‚ fcitx5 æ§åˆ¶å€™é€‰çª—å£çš„æ˜¾ç¤ºä½ç½®ï¼ˆé€šå¸¸è·Ÿéšè¾“å…¥å…‰æ ‡ï¼‰ï¼Œå€™é€‰çª—å£æœ¬èº«å¯èƒ½æ˜¯ X11 çª—å£ï¼ˆç”± fcitx5 è‡ªå·±åˆ›å»ºï¼Œå¹¶é€šè¿‡ XWayland æ˜¾ç¤ºï¼‰ã€‚ è¾“å…¥ç»“æœè¿”å›åº”ç”¨ å½“ç”¨æˆ·é€‰å®šå€™é€‰è¯åï¼Œfcitx5 é€šè¿‡ D-Bus è°ƒç”¨ IM æ’ä»¶æ¥å£ç›´æ¥æŠŠç¡®è®¤åçš„å­—ç¬¦ä¸²ä¼ ç»™åº”ç”¨ã€‚ åº”ç”¨çš„ IM æ’ä»¶æ”¶åˆ°å­—ç¬¦ä¸²åï¼Œè°ƒç”¨åº”ç”¨å†…çš„ã€Œè¾“å…¥ä¸Šä¸‹æ–‡ APIã€æ’å…¥æ–‡æœ¬ã€‚ åœ¨åº”ç”¨çœ‹æ¥ï¼Œå®ƒå°±åƒç›´æ¥å¾—åˆ°äº†ã€Œè¾“å…¥äº†ä¸€ä¸²ä¸­æ–‡ã€çš„äº‹ä»¶ã€‚ XWayland ç¯å¢ƒå˜é‡è®¾ç½®ï¼š bash # GTK åº”ç”¨ä½¿ç”¨ fcitxï¼ˆé€šè¿‡ GTK IM æ¨¡å—ï¼‰ export GTK_IM_MODULE=fcitx # Qt åº”ç”¨ä½¿ç”¨ fcitxï¼ˆé€šè¿‡ Qt IM æ¨¡å—ï¼‰ export QT_IM_MODULE=fcitx # X11 åº”ç”¨ä½¿ç”¨ fcitxï¼ˆé€šè¿‡ XIM åè®®ï¼‰ export XMODIFIERS=@im=fcitx è¾“å…¥æ³•æœºåˆ¶è¯´æ˜ï¼š GTK IM æ¨¡å—ã€Qt IM æ¨¡å—ä»¥åŠ XIM åè®®ï¼Œéƒ½æ˜¯ X11 ä¸‹çš„ä¸œè¥¿ï¼Œåœ¨ wayland ä¸‹åªéœ€è¦ text-input åè®®å³å¯ï¼Œä¸éœ€è¦è¿™äº›å¹ºè›¾å­ã€‚ 2.2.4 æ··åˆç¯å¢ƒç®¡ç†ç­–ç•¥æ¨èé…ç½®ç­–ç•¥ï¼š é»˜è®¤ Wayland ä¼˜å…ˆï¼š è®©ç°ä»£åº”ç”¨ä½¿ç”¨åŸç”Ÿ Wayland text-input åè®® æŒ‰éœ€ XWaylandï¼š ä½¿ç”¨ GDK_BACKEND=x11 å¼ºåˆ¶ç‰¹å®šåº”ç”¨ä½¿ç”¨ XWayland ä¸ºç‰¹å®šåº”ç”¨åˆ›å»ºå¯åŠ¨è„šæœ¬è®¾ç½® IM_MODULE ç›¸å…³ç¯å¢ƒå˜é‡ åº”ç”¨å¯åŠ¨è„šæœ¬ç¤ºä¾‹ï¼š bash #!/bin/bash # å¼ºåˆ¶ç‰¹å®šåº”ç”¨ä½¿ç”¨ XWayland export GTK_IM_MODULE=fcitx # ä½¿ç”¨ GTK IM æ¨¡å— export QT_IM_MODULE=fcitx # ä½¿ç”¨ Qt IM æ¨¡å— export GDK_BACKEND=x11 # å¼ºåˆ¶ä½¿ç”¨ X11 åç«¯ your-application 2.2.5 æ•…éšœæ’æŸ¥ä¸ä¼˜åŒ–è¾“å…¥æ³•æ— å“åº”é—®é¢˜ï¼š è¿›ç¨‹çŠ¶æ€æ£€æŸ¥ï¼š bash ps aux | grep fcitx5 systemctl --user status fcitx5 ç¯å¢ƒå˜é‡éªŒè¯ï¼ˆä»… xwayland åœºæ™¯ï¼‰ï¼š bash echo $GTK_IM_MODULE $QT_IM_MODULE $XMODIFIERS echo $XDG_RUNTIME_DIR $DBUS_SESSION_BUS_ADDRESS D-Bus é€šä¿¡æ£€æŸ¥ï¼š bash busctl --user tree org.fcitx.Fcitx5 dbus-monitor --session \"interface='org.fcitx.Fcitx5'\" è¯Šæ–­å·¥å…·ä½¿ç”¨ï¼š bash fcitx5-diagnose fcitx5-configtool å€™é€‰æ¡†æ˜¾ç¤ºé—®é¢˜ï¼š Wayland åŸç”Ÿåº”ç”¨æ’æŸ¥ï¼š bash # æ£€æŸ¥ Wayland ç¯å¢ƒ echo $WAYLAND_DISPLAY $XDG_RUNTIME_DIR # æ£€æŸ¥ text-input åè®®æ”¯æŒ wayland-info | grep text-input # æŸ¥çœ‹åˆæˆå™¨æ—¥å¿—ä¸­ text-input ç›¸å…³é”™è¯¯ journalctl --user -u fcitx5 XWayland åº”ç”¨æ’æŸ¥ï¼š bash # æ£€æŸ¥ XWayland ç¯å¢ƒå˜é‡ echo $GTK_IM_MODULE $QT_IM_MODULE $XMODIFIERS # æ£€æŸ¥ XWayland è¿æ¥ echo $DISPLAY # éªŒè¯ XIM è¿æ¥ xdpyinfo | grep -i input æƒé™å’Œä¼šè¯æ£€æŸ¥ï¼š bash # ç¡®è®¤ fcitx5 åœ¨æ­£ç¡®çš„ç”¨æˆ·ä¼šè¯ä¸­è¿è¡Œ loginctl show-session $(loginctl | grep $USER | awk '{print $1}') # æ£€æŸ¥ D-Bus ä¼šè¯ echo $DBUS_SESSION_BUS_ADDRESS åº”ç”¨å…¼å®¹æ€§ï¼š Wayland åº”ç”¨ï¼šéƒ¨åˆ†åº”ç”¨éœ€è¦é‡æ–°å¯åŠ¨æ‰èƒ½è¯†åˆ«è¾“å…¥æ³• XWayland åº”ç”¨ï¼šéœ€è¦æ­£ç¡®è®¾ç½® XMODIFIERS ç¯å¢ƒå˜é‡ æ··åˆç¯å¢ƒï¼šæŸäº›åº”ç”¨å¯èƒ½åœ¨ä¸åŒç¯å¢ƒä¸‹è¡¨ç°ä¸åŒ æ€§èƒ½ä¼˜åŒ–ï¼š bash # è°ƒæ•´ fcitx5 é…ç½® vim ~/.config/fcitx5/profile # ç¦ç”¨ä¸éœ€è¦çš„è¾“å…¥å¼•æ“ # å‡å°‘å€™é€‰è¯æ•°é‡æé«˜å“åº”é€Ÿåº¦ # äº‘æ‹¼éŸ³é…ç½® vim ~/.config/fcitx5/conf/cloudpinyin.conf ç‰¹æ®Šåœºæ™¯å¤„ç†ï¼š å¤šæ˜¾ç¤ºå™¨ç¯å¢ƒï¼š Waylandï¼šå€™é€‰æ¡†é€šå¸¸èƒ½æ­£ç¡®è·Ÿéšå…‰æ ‡ä½ç½® XWaylandï¼šå€™é€‰æ¡†å¯èƒ½åœ¨é”™è¯¯å±å¹•æ˜¾ç¤ºï¼Œéœ€è¦è°ƒæ•´ X11 é…ç½® é«˜åˆ†å±é€‚é…ï¼š Waylandï¼šè‡ªåŠ¨é€‚é…ç³»ç»Ÿç¼©æ”¾æ¯”ä¾‹ XWaylandï¼šå¯èƒ½éœ€è¦æ‰‹åŠ¨è®¾ç½® GDK_SCALE æˆ– QT_SCALE_FACTOR æ¸¸æˆå’Œå…¨å±åº”ç”¨ï¼š Waylandï¼šéƒ¨åˆ†æ¸¸æˆå¯èƒ½éœ€è¦ gamescope ç­‰å·¥å…· XWaylandï¼šä¼ ç»Ÿå…¨å±æ¸¸æˆé€šå¸¸å·¥ä½œæ­£å¸¸ ç»ˆç«¯åº”ç”¨ï¼š Wayland ç»ˆç«¯ï¼šéœ€è¦ç»ˆç«¯æ¨¡æ‹Ÿå™¨æ”¯æŒ text-input åè®® XWayland ç»ˆç«¯ï¼šä½¿ç”¨ X11 çš„ XIM åè®®æˆ– GTK/Qt IM æ¨¡å— ","date":"2025-10-19","objectID":"/posts/linux-desktop-4-multimedia-input/:3:4","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Multimedia","Audio","Video","Input Method"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå››ï¼‰ - å¤šåª’ä½“å¤„ç†ä¸ä¸­æ–‡æ”¯æŒ","uri":"/posts/linux-desktop-4-multimedia-input/#22-ä¸­æ–‡è¾“å…¥æ³•"},{"categories":["tech"],"content":" 2.2 ä¸­æ–‡è¾“å…¥æ³•ç°ä»£ Linux æ¡Œé¢ä¸»è¦ä½¿ç”¨ fcitx5 ä½œä¸ºä¸­æ–‡è¾“å…¥è§£å†³æ–¹æ¡ˆï¼Œå®ƒé€šè¿‡æ’ä»¶ç³»ç»Ÿæ”¯æŒå¤šç§è¾“å…¥å¼•æ“ï¼Œå¹¶ä¸å›¾å½¢ç¯å¢ƒæ·±åº¦é›†æˆã€‚ 2.2.1 è¾“å…¥æ³•æ¡†æ¶æ¶æ„æ ¸å¿ƒç»„ä»¶ï¼š fcitx5-daemonï¼šä¸»å®ˆæŠ¤è¿›ç¨‹ï¼Œç®¡ç†è¾“å…¥æ³•çŠ¶æ€ è¾“å…¥å¼•æ“ï¼šæ‹¼éŸ³ã€äº”ç¬”ã€ä»“é¢‰ç­‰å…·ä½“è¾“å…¥æ³•å®ç° å›¾å½¢å‰ç«¯ï¼šè´Ÿè´£å€™é€‰è¯ç•Œé¢æ˜¾ç¤º é…ç½®å·¥å…·ï¼šfcitx5-configtool æä¾›å›¾å½¢åŒ–é…ç½® é…ç½®æ–‡ä»¶è·¯å¾„ï¼š ~/.config/fcitx5/configï¼šä¸»é…ç½®æ–‡ä»¶ ~/.config/fcitx5/profileï¼šè¾“å…¥æ³•å¼•æ“é…ç½® ~/.config/fcitx5/conf/ï¼šå„è¾“å…¥æ³•å¼•æ“çš„è¯¦ç»†é…ç½® 2.2.2 Wayland åŸç”Ÿè¾“å…¥æ³•æµç¨‹Wayland text-input åè®®æµç¨‹ï¼š æŒ‰é”®æ•è·ï¼šé”®ç›˜äº‹ä»¶é¦–å…ˆåˆ°è¾¾ Wayland åˆæˆå™¨ åè®®é€šä¿¡ï¼šåˆæˆå™¨é€šè¿‡ text-input åè®®ä¸å®¢æˆ·ç«¯åº”ç”¨é€šä¿¡ è¾“å…¥æ³•æœåŠ¡ï¼šfcitx5 ä½œä¸º Wayland è¾“å…¥æ³•æœåŠ¡æ¥æ”¶äº‹ä»¶ å€™é€‰ç”Ÿæˆï¼šfcitx5 å¤„ç†æŒ‰é”®å¹¶ç”Ÿæˆå€™é€‰è¯ å€™é€‰æ˜¾ç¤ºï¼šé€šè¿‡ Wayland åè®®åœ¨å…‰æ ‡ä½ç½®æ˜¾ç¤ºå€™é€‰çª—å£ æ–‡æœ¬æäº¤ï¼šç”¨æˆ·é€‰æ‹©åé€šè¿‡ text-input åè®®æäº¤æœ€ç»ˆæ–‡æœ¬ text-input åè®®æœ‰ v1 è·Ÿ v3 ä¸¤ä¸ªç‰ˆæœ¬ï¼Œç›®å‰ï¼ˆ2025-09ï¼‰Electron/Chrome ä»¥åŠå…¶ä»–å¤§éƒ¨åˆ†ç¨‹åºæ¡†æ¶éƒ½å·²ç»æ”¯æŒäº† text-input-v3. æ¡Œé¢ç¯å¢ƒæ–¹é¢æ‰€æœ‰ä¸»æµ Compositor ä¹Ÿéƒ½æ”¯æŒ text-input-v3. æ‰€ä»¥ç›®å‰ wayland ä¸‹è¾“å…¥æ³•çš„å¯ç”¨æ€§å·²ç»å¾ˆé«˜äº†ã€‚ 2.2.3 X11 / XWayland è¾“å…¥æ³•æµç¨‹XWayland ä½¿ç”¨åœºæ™¯ï¼š å°šæœªæ”¯æŒ Wayland çš„æ—§ç‰ˆåº”ç”¨ éœ€è¦ç‰¹å®š X11 åŠŸèƒ½çš„ä¸“ä¸šè½¯ä»¶ é€šè¿‡åº”ç”¨å¯åŠ¨è„šæœ¬å•ç‹¬è®¾ç½®ç¯å¢ƒå˜é‡ XWayland åº”ç”¨è¾“å…¥æµç¨‹ï¼š æŒ‰é”®æ•è·ï¼šé”®ç›˜äº‹ä»¶é¦–å…ˆè¿›å…¥ Wayland åˆæˆå™¨ï¼ˆHyprlandã€KWin ç­‰ï¼‰ã€‚ äº‹ä»¶è½¬å‘ç»™ XWaylandï¼ˆä¾‹å¦‚xwayland-satelliteï¼‰ å¦‚æœç›®æ ‡æ˜¯ X11 åº”ç”¨çª—å£ï¼Œåˆæˆå™¨ä¼šå°†äº‹ä»¶äº¤ç»™ XWaylandã€‚ XWayland å°† Wayland è¾“å…¥äº‹ä»¶è½¬æ¢ä¸º X11 åè®®äº‹ä»¶ï¼ˆå¦‚ KeyPress/KeyReleaseï¼‰ï¼Œå¹¶äº¤ä»˜ç»™ç›®æ ‡åº”ç”¨ã€‚ åº”ç”¨ä¾§çš„è¾“å…¥æ³•æ¨¡å—æ‹¦æˆªäº‹ä»¶ X11 åº”ç”¨ï¼ˆGTK/Qt ç¨‹åºï¼‰å†…éƒ¨åŠ è½½äº† fcitx5-gtk / fcitx5-qt æ’ä»¶ï¼ˆé€šå¸¸æ ¹æ®ç¯å¢ƒå˜é‡åŠ è½½ï¼Œåé¢ä¼šä»‹ç»è¿™äº›ç¯å¢ƒå˜é‡ï¼‰ã€‚ è¿™äº›æ’ä»¶æ‹¦æˆªæ¥è‡ª XWayland çš„é”®ç›˜äº‹ä»¶ï¼Œå¹¶é€šè¿‡ D-Bus å°†äº‹ä»¶ä¸ŠæŠ¥ç»™ fcitx5ã€‚ æ­¤æ—¶åº”ç”¨ç›¸å½“äºæ˜¯ã€ŒæŠŠé”®ç›˜è¾“å…¥äº¤ç»™ fcitx5 ä»£ç®¡ã€ã€‚ fcitx5 å¤„ç†è¾“å…¥é€»è¾‘ fcitx5 æ”¶åˆ°é”®ç›˜åºåˆ—åï¼Œè¿›å…¥è¾“å…¥æ³•é€»è¾‘ï¼šæ‹¼éŸ³è§£æã€å€™é€‰è¯ç”Ÿæˆã€‚ fcitx5 æ§åˆ¶å€™é€‰çª—å£çš„æ˜¾ç¤ºä½ç½®ï¼ˆé€šå¸¸è·Ÿéšè¾“å…¥å…‰æ ‡ï¼‰ï¼Œå€™é€‰çª—å£æœ¬èº«å¯èƒ½æ˜¯ X11 çª—å£ï¼ˆç”± fcitx5 è‡ªå·±åˆ›å»ºï¼Œå¹¶é€šè¿‡ XWayland æ˜¾ç¤ºï¼‰ã€‚ è¾“å…¥ç»“æœè¿”å›åº”ç”¨ å½“ç”¨æˆ·é€‰å®šå€™é€‰è¯åï¼Œfcitx5 é€šè¿‡ D-Bus è°ƒç”¨ IM æ’ä»¶æ¥å£ç›´æ¥æŠŠç¡®è®¤åçš„å­—ç¬¦ä¸²ä¼ ç»™åº”ç”¨ã€‚ åº”ç”¨çš„ IM æ’ä»¶æ”¶åˆ°å­—ç¬¦ä¸²åï¼Œè°ƒç”¨åº”ç”¨å†…çš„ã€Œè¾“å…¥ä¸Šä¸‹æ–‡ APIã€æ’å…¥æ–‡æœ¬ã€‚ åœ¨åº”ç”¨çœ‹æ¥ï¼Œå®ƒå°±åƒç›´æ¥å¾—åˆ°äº†ã€Œè¾“å…¥äº†ä¸€ä¸²ä¸­æ–‡ã€çš„äº‹ä»¶ã€‚ XWayland ç¯å¢ƒå˜é‡è®¾ç½®ï¼š bash # GTK åº”ç”¨ä½¿ç”¨ fcitxï¼ˆé€šè¿‡ GTK IM æ¨¡å—ï¼‰ export GTK_IM_MODULE=fcitx # Qt åº”ç”¨ä½¿ç”¨ fcitxï¼ˆé€šè¿‡ Qt IM æ¨¡å—ï¼‰ export QT_IM_MODULE=fcitx # X11 åº”ç”¨ä½¿ç”¨ fcitxï¼ˆé€šè¿‡ XIM åè®®ï¼‰ export XMODIFIERS=@im=fcitx è¾“å…¥æ³•æœºåˆ¶è¯´æ˜ï¼š GTK IM æ¨¡å—ã€Qt IM æ¨¡å—ä»¥åŠ XIM åè®®ï¼Œéƒ½æ˜¯ X11 ä¸‹çš„ä¸œè¥¿ï¼Œåœ¨ wayland ä¸‹åªéœ€è¦ text-input åè®®å³å¯ï¼Œä¸éœ€è¦è¿™äº›å¹ºè›¾å­ã€‚ 2.2.4 æ··åˆç¯å¢ƒç®¡ç†ç­–ç•¥æ¨èé…ç½®ç­–ç•¥ï¼š é»˜è®¤ Wayland ä¼˜å…ˆï¼š è®©ç°ä»£åº”ç”¨ä½¿ç”¨åŸç”Ÿ Wayland text-input åè®® æŒ‰éœ€ XWaylandï¼š ä½¿ç”¨ GDK_BACKEND=x11 å¼ºåˆ¶ç‰¹å®šåº”ç”¨ä½¿ç”¨ XWayland ä¸ºç‰¹å®šåº”ç”¨åˆ›å»ºå¯åŠ¨è„šæœ¬è®¾ç½® IM_MODULE ç›¸å…³ç¯å¢ƒå˜é‡ åº”ç”¨å¯åŠ¨è„šæœ¬ç¤ºä¾‹ï¼š bash #!/bin/bash # å¼ºåˆ¶ç‰¹å®šåº”ç”¨ä½¿ç”¨ XWayland export GTK_IM_MODULE=fcitx # ä½¿ç”¨ GTK IM æ¨¡å— export QT_IM_MODULE=fcitx # ä½¿ç”¨ Qt IM æ¨¡å— export GDK_BACKEND=x11 # å¼ºåˆ¶ä½¿ç”¨ X11 åç«¯ your-application 2.2.5 æ•…éšœæ’æŸ¥ä¸ä¼˜åŒ–è¾“å…¥æ³•æ— å“åº”é—®é¢˜ï¼š è¿›ç¨‹çŠ¶æ€æ£€æŸ¥ï¼š bash ps aux | grep fcitx5 systemctl --user status fcitx5 ç¯å¢ƒå˜é‡éªŒè¯ï¼ˆä»… xwayland åœºæ™¯ï¼‰ï¼š bash echo $GTK_IM_MODULE $QT_IM_MODULE $XMODIFIERS echo $XDG_RUNTIME_DIR $DBUS_SESSION_BUS_ADDRESS D-Bus é€šä¿¡æ£€æŸ¥ï¼š bash busctl --user tree org.fcitx.Fcitx5 dbus-monitor --session \"interface='org.fcitx.Fcitx5'\" è¯Šæ–­å·¥å…·ä½¿ç”¨ï¼š bash fcitx5-diagnose fcitx5-configtool å€™é€‰æ¡†æ˜¾ç¤ºé—®é¢˜ï¼š Wayland åŸç”Ÿåº”ç”¨æ’æŸ¥ï¼š bash # æ£€æŸ¥ Wayland ç¯å¢ƒ echo $WAYLAND_DISPLAY $XDG_RUNTIME_DIR # æ£€æŸ¥ text-input åè®®æ”¯æŒ wayland-info | grep text-input # æŸ¥çœ‹åˆæˆå™¨æ—¥å¿—ä¸­ text-input ç›¸å…³é”™è¯¯ journalctl --user -u fcitx5 XWayland åº”ç”¨æ’æŸ¥ï¼š bash # æ£€æŸ¥ XWayland ç¯å¢ƒå˜é‡ echo $GTK_IM_MODULE $QT_IM_MODULE $XMODIFIERS # æ£€æŸ¥ XWayland è¿æ¥ echo $DISPLAY # éªŒè¯ XIM è¿æ¥ xdpyinfo | grep -i input æƒé™å’Œä¼šè¯æ£€æŸ¥ï¼š bash # ç¡®è®¤ fcitx5 åœ¨æ­£ç¡®çš„ç”¨æˆ·ä¼šè¯ä¸­è¿è¡Œ loginctl show-session $(loginctl | grep $USER | awk '{print $1}') # æ£€æŸ¥ D-Bus ä¼šè¯ echo $DBUS_SESSION_BUS_ADDRESS åº”ç”¨å…¼å®¹æ€§ï¼š Wayland åº”ç”¨ï¼šéƒ¨åˆ†åº”ç”¨éœ€è¦é‡æ–°å¯åŠ¨æ‰èƒ½è¯†åˆ«è¾“å…¥æ³• XWayland åº”ç”¨ï¼šéœ€è¦æ­£ç¡®è®¾ç½® XMODIFIERS ç¯å¢ƒå˜é‡ æ··åˆç¯å¢ƒï¼šæŸäº›åº”ç”¨å¯èƒ½åœ¨ä¸åŒç¯å¢ƒä¸‹è¡¨ç°ä¸åŒ æ€§èƒ½ä¼˜åŒ–ï¼š bash # è°ƒæ•´ fcitx5 é…ç½® vim ~/.config/fcitx5/profile # ç¦ç”¨ä¸éœ€è¦çš„è¾“å…¥å¼•æ“ # å‡å°‘å€™é€‰è¯æ•°é‡æé«˜å“åº”é€Ÿåº¦ # äº‘æ‹¼éŸ³é…ç½® vim ~/.config/fcitx5/conf/cloudpinyin.conf ç‰¹æ®Šåœºæ™¯å¤„ç†ï¼š å¤šæ˜¾ç¤ºå™¨ç¯å¢ƒï¼š Waylandï¼šå€™é€‰æ¡†é€šå¸¸èƒ½æ­£ç¡®è·Ÿéšå…‰æ ‡ä½ç½® XWaylandï¼šå€™é€‰æ¡†å¯èƒ½åœ¨é”™è¯¯å±å¹•æ˜¾ç¤ºï¼Œéœ€è¦è°ƒæ•´ X11 é…ç½® é«˜åˆ†å±é€‚é…ï¼š Waylandï¼šè‡ªåŠ¨é€‚é…ç³»ç»Ÿç¼©æ”¾æ¯”ä¾‹ XWaylandï¼šå¯èƒ½éœ€è¦æ‰‹åŠ¨è®¾ç½® GDK_SCALE æˆ– QT_SCALE_FACTOR æ¸¸æˆå’Œå…¨å±åº”ç”¨ï¼š Waylandï¼šéƒ¨åˆ†æ¸¸æˆå¯èƒ½éœ€è¦ gamescope ç­‰å·¥å…· XWaylandï¼šä¼ ç»Ÿå…¨å±æ¸¸æˆé€šå¸¸å·¥ä½œæ­£å¸¸ ç»ˆç«¯åº”ç”¨ï¼š Wayland ç»ˆç«¯ï¼šéœ€è¦ç»ˆç«¯æ¨¡æ‹Ÿå™¨æ”¯æŒ text-input åè®® XWayland ç»ˆç«¯ï¼šä½¿ç”¨ X11 çš„ XIM åè®®æˆ– GTK/Qt IM æ¨¡å— ","date":"2025-10-19","objectID":"/posts/linux-desktop-4-multimedia-input/:3:4","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Multimedia","Audio","Video","Input Method"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå››ï¼‰ - å¤šåª’ä½“å¤„ç†ä¸ä¸­æ–‡æ”¯æŒ","uri":"/posts/linux-desktop-4-multimedia-input/#221-è¾“å…¥æ³•æ¡†æ¶æ¶æ„"},{"categories":["tech"],"content":" 2.2 ä¸­æ–‡è¾“å…¥æ³•ç°ä»£ Linux æ¡Œé¢ä¸»è¦ä½¿ç”¨ fcitx5 ä½œä¸ºä¸­æ–‡è¾“å…¥è§£å†³æ–¹æ¡ˆï¼Œå®ƒé€šè¿‡æ’ä»¶ç³»ç»Ÿæ”¯æŒå¤šç§è¾“å…¥å¼•æ“ï¼Œå¹¶ä¸å›¾å½¢ç¯å¢ƒæ·±åº¦é›†æˆã€‚ 2.2.1 è¾“å…¥æ³•æ¡†æ¶æ¶æ„æ ¸å¿ƒç»„ä»¶ï¼š fcitx5-daemonï¼šä¸»å®ˆæŠ¤è¿›ç¨‹ï¼Œç®¡ç†è¾“å…¥æ³•çŠ¶æ€ è¾“å…¥å¼•æ“ï¼šæ‹¼éŸ³ã€äº”ç¬”ã€ä»“é¢‰ç­‰å…·ä½“è¾“å…¥æ³•å®ç° å›¾å½¢å‰ç«¯ï¼šè´Ÿè´£å€™é€‰è¯ç•Œé¢æ˜¾ç¤º é…ç½®å·¥å…·ï¼šfcitx5-configtool æä¾›å›¾å½¢åŒ–é…ç½® é…ç½®æ–‡ä»¶è·¯å¾„ï¼š ~/.config/fcitx5/configï¼šä¸»é…ç½®æ–‡ä»¶ ~/.config/fcitx5/profileï¼šè¾“å…¥æ³•å¼•æ“é…ç½® ~/.config/fcitx5/conf/ï¼šå„è¾“å…¥æ³•å¼•æ“çš„è¯¦ç»†é…ç½® 2.2.2 Wayland åŸç”Ÿè¾“å…¥æ³•æµç¨‹Wayland text-input åè®®æµç¨‹ï¼š æŒ‰é”®æ•è·ï¼šé”®ç›˜äº‹ä»¶é¦–å…ˆåˆ°è¾¾ Wayland åˆæˆå™¨ åè®®é€šä¿¡ï¼šåˆæˆå™¨é€šè¿‡ text-input åè®®ä¸å®¢æˆ·ç«¯åº”ç”¨é€šä¿¡ è¾“å…¥æ³•æœåŠ¡ï¼šfcitx5 ä½œä¸º Wayland è¾“å…¥æ³•æœåŠ¡æ¥æ”¶äº‹ä»¶ å€™é€‰ç”Ÿæˆï¼šfcitx5 å¤„ç†æŒ‰é”®å¹¶ç”Ÿæˆå€™é€‰è¯ å€™é€‰æ˜¾ç¤ºï¼šé€šè¿‡ Wayland åè®®åœ¨å…‰æ ‡ä½ç½®æ˜¾ç¤ºå€™é€‰çª—å£ æ–‡æœ¬æäº¤ï¼šç”¨æˆ·é€‰æ‹©åé€šè¿‡ text-input åè®®æäº¤æœ€ç»ˆæ–‡æœ¬ text-input åè®®æœ‰ v1 è·Ÿ v3 ä¸¤ä¸ªç‰ˆæœ¬ï¼Œç›®å‰ï¼ˆ2025-09ï¼‰Electron/Chrome ä»¥åŠå…¶ä»–å¤§éƒ¨åˆ†ç¨‹åºæ¡†æ¶éƒ½å·²ç»æ”¯æŒäº† text-input-v3. æ¡Œé¢ç¯å¢ƒæ–¹é¢æ‰€æœ‰ä¸»æµ Compositor ä¹Ÿéƒ½æ”¯æŒ text-input-v3. æ‰€ä»¥ç›®å‰ wayland ä¸‹è¾“å…¥æ³•çš„å¯ç”¨æ€§å·²ç»å¾ˆé«˜äº†ã€‚ 2.2.3 X11 / XWayland è¾“å…¥æ³•æµç¨‹XWayland ä½¿ç”¨åœºæ™¯ï¼š å°šæœªæ”¯æŒ Wayland çš„æ—§ç‰ˆåº”ç”¨ éœ€è¦ç‰¹å®š X11 åŠŸèƒ½çš„ä¸“ä¸šè½¯ä»¶ é€šè¿‡åº”ç”¨å¯åŠ¨è„šæœ¬å•ç‹¬è®¾ç½®ç¯å¢ƒå˜é‡ XWayland åº”ç”¨è¾“å…¥æµç¨‹ï¼š æŒ‰é”®æ•è·ï¼šé”®ç›˜äº‹ä»¶é¦–å…ˆè¿›å…¥ Wayland åˆæˆå™¨ï¼ˆHyprlandã€KWin ç­‰ï¼‰ã€‚ äº‹ä»¶è½¬å‘ç»™ XWaylandï¼ˆä¾‹å¦‚xwayland-satelliteï¼‰ å¦‚æœç›®æ ‡æ˜¯ X11 åº”ç”¨çª—å£ï¼Œåˆæˆå™¨ä¼šå°†äº‹ä»¶äº¤ç»™ XWaylandã€‚ XWayland å°† Wayland è¾“å…¥äº‹ä»¶è½¬æ¢ä¸º X11 åè®®äº‹ä»¶ï¼ˆå¦‚ KeyPress/KeyReleaseï¼‰ï¼Œå¹¶äº¤ä»˜ç»™ç›®æ ‡åº”ç”¨ã€‚ åº”ç”¨ä¾§çš„è¾“å…¥æ³•æ¨¡å—æ‹¦æˆªäº‹ä»¶ X11 åº”ç”¨ï¼ˆGTK/Qt ç¨‹åºï¼‰å†…éƒ¨åŠ è½½äº† fcitx5-gtk / fcitx5-qt æ’ä»¶ï¼ˆé€šå¸¸æ ¹æ®ç¯å¢ƒå˜é‡åŠ è½½ï¼Œåé¢ä¼šä»‹ç»è¿™äº›ç¯å¢ƒå˜é‡ï¼‰ã€‚ è¿™äº›æ’ä»¶æ‹¦æˆªæ¥è‡ª XWayland çš„é”®ç›˜äº‹ä»¶ï¼Œå¹¶é€šè¿‡ D-Bus å°†äº‹ä»¶ä¸ŠæŠ¥ç»™ fcitx5ã€‚ æ­¤æ—¶åº”ç”¨ç›¸å½“äºæ˜¯ã€ŒæŠŠé”®ç›˜è¾“å…¥äº¤ç»™ fcitx5 ä»£ç®¡ã€ã€‚ fcitx5 å¤„ç†è¾“å…¥é€»è¾‘ fcitx5 æ”¶åˆ°é”®ç›˜åºåˆ—åï¼Œè¿›å…¥è¾“å…¥æ³•é€»è¾‘ï¼šæ‹¼éŸ³è§£æã€å€™é€‰è¯ç”Ÿæˆã€‚ fcitx5 æ§åˆ¶å€™é€‰çª—å£çš„æ˜¾ç¤ºä½ç½®ï¼ˆé€šå¸¸è·Ÿéšè¾“å…¥å…‰æ ‡ï¼‰ï¼Œå€™é€‰çª—å£æœ¬èº«å¯èƒ½æ˜¯ X11 çª—å£ï¼ˆç”± fcitx5 è‡ªå·±åˆ›å»ºï¼Œå¹¶é€šè¿‡ XWayland æ˜¾ç¤ºï¼‰ã€‚ è¾“å…¥ç»“æœè¿”å›åº”ç”¨ å½“ç”¨æˆ·é€‰å®šå€™é€‰è¯åï¼Œfcitx5 é€šè¿‡ D-Bus è°ƒç”¨ IM æ’ä»¶æ¥å£ç›´æ¥æŠŠç¡®è®¤åçš„å­—ç¬¦ä¸²ä¼ ç»™åº”ç”¨ã€‚ åº”ç”¨çš„ IM æ’ä»¶æ”¶åˆ°å­—ç¬¦ä¸²åï¼Œè°ƒç”¨åº”ç”¨å†…çš„ã€Œè¾“å…¥ä¸Šä¸‹æ–‡ APIã€æ’å…¥æ–‡æœ¬ã€‚ åœ¨åº”ç”¨çœ‹æ¥ï¼Œå®ƒå°±åƒç›´æ¥å¾—åˆ°äº†ã€Œè¾“å…¥äº†ä¸€ä¸²ä¸­æ–‡ã€çš„äº‹ä»¶ã€‚ XWayland ç¯å¢ƒå˜é‡è®¾ç½®ï¼š bash # GTK åº”ç”¨ä½¿ç”¨ fcitxï¼ˆé€šè¿‡ GTK IM æ¨¡å—ï¼‰ export GTK_IM_MODULE=fcitx # Qt åº”ç”¨ä½¿ç”¨ fcitxï¼ˆé€šè¿‡ Qt IM æ¨¡å—ï¼‰ export QT_IM_MODULE=fcitx # X11 åº”ç”¨ä½¿ç”¨ fcitxï¼ˆé€šè¿‡ XIM åè®®ï¼‰ export XMODIFIERS=@im=fcitx è¾“å…¥æ³•æœºåˆ¶è¯´æ˜ï¼š GTK IM æ¨¡å—ã€Qt IM æ¨¡å—ä»¥åŠ XIM åè®®ï¼Œéƒ½æ˜¯ X11 ä¸‹çš„ä¸œè¥¿ï¼Œåœ¨ wayland ä¸‹åªéœ€è¦ text-input åè®®å³å¯ï¼Œä¸éœ€è¦è¿™äº›å¹ºè›¾å­ã€‚ 2.2.4 æ··åˆç¯å¢ƒç®¡ç†ç­–ç•¥æ¨èé…ç½®ç­–ç•¥ï¼š é»˜è®¤ Wayland ä¼˜å…ˆï¼š è®©ç°ä»£åº”ç”¨ä½¿ç”¨åŸç”Ÿ Wayland text-input åè®® æŒ‰éœ€ XWaylandï¼š ä½¿ç”¨ GDK_BACKEND=x11 å¼ºåˆ¶ç‰¹å®šåº”ç”¨ä½¿ç”¨ XWayland ä¸ºç‰¹å®šåº”ç”¨åˆ›å»ºå¯åŠ¨è„šæœ¬è®¾ç½® IM_MODULE ç›¸å…³ç¯å¢ƒå˜é‡ åº”ç”¨å¯åŠ¨è„šæœ¬ç¤ºä¾‹ï¼š bash #!/bin/bash # å¼ºåˆ¶ç‰¹å®šåº”ç”¨ä½¿ç”¨ XWayland export GTK_IM_MODULE=fcitx # ä½¿ç”¨ GTK IM æ¨¡å— export QT_IM_MODULE=fcitx # ä½¿ç”¨ Qt IM æ¨¡å— export GDK_BACKEND=x11 # å¼ºåˆ¶ä½¿ç”¨ X11 åç«¯ your-application 2.2.5 æ•…éšœæ’æŸ¥ä¸ä¼˜åŒ–è¾“å…¥æ³•æ— å“åº”é—®é¢˜ï¼š è¿›ç¨‹çŠ¶æ€æ£€æŸ¥ï¼š bash ps aux | grep fcitx5 systemctl --user status fcitx5 ç¯å¢ƒå˜é‡éªŒè¯ï¼ˆä»… xwayland åœºæ™¯ï¼‰ï¼š bash echo $GTK_IM_MODULE $QT_IM_MODULE $XMODIFIERS echo $XDG_RUNTIME_DIR $DBUS_SESSION_BUS_ADDRESS D-Bus é€šä¿¡æ£€æŸ¥ï¼š bash busctl --user tree org.fcitx.Fcitx5 dbus-monitor --session \"interface='org.fcitx.Fcitx5'\" è¯Šæ–­å·¥å…·ä½¿ç”¨ï¼š bash fcitx5-diagnose fcitx5-configtool å€™é€‰æ¡†æ˜¾ç¤ºé—®é¢˜ï¼š Wayland åŸç”Ÿåº”ç”¨æ’æŸ¥ï¼š bash # æ£€æŸ¥ Wayland ç¯å¢ƒ echo $WAYLAND_DISPLAY $XDG_RUNTIME_DIR # æ£€æŸ¥ text-input åè®®æ”¯æŒ wayland-info | grep text-input # æŸ¥çœ‹åˆæˆå™¨æ—¥å¿—ä¸­ text-input ç›¸å…³é”™è¯¯ journalctl --user -u fcitx5 XWayland åº”ç”¨æ’æŸ¥ï¼š bash # æ£€æŸ¥ XWayland ç¯å¢ƒå˜é‡ echo $GTK_IM_MODULE $QT_IM_MODULE $XMODIFIERS # æ£€æŸ¥ XWayland è¿æ¥ echo $DISPLAY # éªŒè¯ XIM è¿æ¥ xdpyinfo | grep -i input æƒé™å’Œä¼šè¯æ£€æŸ¥ï¼š bash # ç¡®è®¤ fcitx5 åœ¨æ­£ç¡®çš„ç”¨æˆ·ä¼šè¯ä¸­è¿è¡Œ loginctl show-session $(loginctl | grep $USER | awk '{print $1}') # æ£€æŸ¥ D-Bus ä¼šè¯ echo $DBUS_SESSION_BUS_ADDRESS åº”ç”¨å…¼å®¹æ€§ï¼š Wayland åº”ç”¨ï¼šéƒ¨åˆ†åº”ç”¨éœ€è¦é‡æ–°å¯åŠ¨æ‰èƒ½è¯†åˆ«è¾“å…¥æ³• XWayland åº”ç”¨ï¼šéœ€è¦æ­£ç¡®è®¾ç½® XMODIFIERS ç¯å¢ƒå˜é‡ æ··åˆç¯å¢ƒï¼šæŸäº›åº”ç”¨å¯èƒ½åœ¨ä¸åŒç¯å¢ƒä¸‹è¡¨ç°ä¸åŒ æ€§èƒ½ä¼˜åŒ–ï¼š bash # è°ƒæ•´ fcitx5 é…ç½® vim ~/.config/fcitx5/profile # ç¦ç”¨ä¸éœ€è¦çš„è¾“å…¥å¼•æ“ # å‡å°‘å€™é€‰è¯æ•°é‡æé«˜å“åº”é€Ÿåº¦ # äº‘æ‹¼éŸ³é…ç½® vim ~/.config/fcitx5/conf/cloudpinyin.conf ç‰¹æ®Šåœºæ™¯å¤„ç†ï¼š å¤šæ˜¾ç¤ºå™¨ç¯å¢ƒï¼š Waylandï¼šå€™é€‰æ¡†é€šå¸¸èƒ½æ­£ç¡®è·Ÿéšå…‰æ ‡ä½ç½® XWaylandï¼šå€™é€‰æ¡†å¯èƒ½åœ¨é”™è¯¯å±å¹•æ˜¾ç¤ºï¼Œéœ€è¦è°ƒæ•´ X11 é…ç½® é«˜åˆ†å±é€‚é…ï¼š Waylandï¼šè‡ªåŠ¨é€‚é…ç³»ç»Ÿç¼©æ”¾æ¯”ä¾‹ XWaylandï¼šå¯èƒ½éœ€è¦æ‰‹åŠ¨è®¾ç½® GDK_SCALE æˆ– QT_SCALE_FACTOR æ¸¸æˆå’Œå…¨å±åº”ç”¨ï¼š Waylandï¼šéƒ¨åˆ†æ¸¸æˆå¯èƒ½éœ€è¦ gamescope ç­‰å·¥å…· XWaylandï¼šä¼ ç»Ÿå…¨å±æ¸¸æˆé€šå¸¸å·¥ä½œæ­£å¸¸ ç»ˆç«¯åº”ç”¨ï¼š Wayland ç»ˆç«¯ï¼šéœ€è¦ç»ˆç«¯æ¨¡æ‹Ÿå™¨æ”¯æŒ text-input åè®® XWayland ç»ˆç«¯ï¼šä½¿ç”¨ X11 çš„ XIM åè®®æˆ– GTK/Qt IM æ¨¡å— ","date":"2025-10-19","objectID":"/posts/linux-desktop-4-multimedia-input/:3:4","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Multimedia","Audio","Video","Input Method"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå››ï¼‰ - å¤šåª’ä½“å¤„ç†ä¸ä¸­æ–‡æ”¯æŒ","uri":"/posts/linux-desktop-4-multimedia-input/#222-wayland-åŸç”Ÿè¾“å…¥æ³•æµç¨‹"},{"categories":["tech"],"content":" 2.2 ä¸­æ–‡è¾“å…¥æ³•ç°ä»£ Linux æ¡Œé¢ä¸»è¦ä½¿ç”¨ fcitx5 ä½œä¸ºä¸­æ–‡è¾“å…¥è§£å†³æ–¹æ¡ˆï¼Œå®ƒé€šè¿‡æ’ä»¶ç³»ç»Ÿæ”¯æŒå¤šç§è¾“å…¥å¼•æ“ï¼Œå¹¶ä¸å›¾å½¢ç¯å¢ƒæ·±åº¦é›†æˆã€‚ 2.2.1 è¾“å…¥æ³•æ¡†æ¶æ¶æ„æ ¸å¿ƒç»„ä»¶ï¼š fcitx5-daemonï¼šä¸»å®ˆæŠ¤è¿›ç¨‹ï¼Œç®¡ç†è¾“å…¥æ³•çŠ¶æ€ è¾“å…¥å¼•æ“ï¼šæ‹¼éŸ³ã€äº”ç¬”ã€ä»“é¢‰ç­‰å…·ä½“è¾“å…¥æ³•å®ç° å›¾å½¢å‰ç«¯ï¼šè´Ÿè´£å€™é€‰è¯ç•Œé¢æ˜¾ç¤º é…ç½®å·¥å…·ï¼šfcitx5-configtool æä¾›å›¾å½¢åŒ–é…ç½® é…ç½®æ–‡ä»¶è·¯å¾„ï¼š ~/.config/fcitx5/configï¼šä¸»é…ç½®æ–‡ä»¶ ~/.config/fcitx5/profileï¼šè¾“å…¥æ³•å¼•æ“é…ç½® ~/.config/fcitx5/conf/ï¼šå„è¾“å…¥æ³•å¼•æ“çš„è¯¦ç»†é…ç½® 2.2.2 Wayland åŸç”Ÿè¾“å…¥æ³•æµç¨‹Wayland text-input åè®®æµç¨‹ï¼š æŒ‰é”®æ•è·ï¼šé”®ç›˜äº‹ä»¶é¦–å…ˆåˆ°è¾¾ Wayland åˆæˆå™¨ åè®®é€šä¿¡ï¼šåˆæˆå™¨é€šè¿‡ text-input åè®®ä¸å®¢æˆ·ç«¯åº”ç”¨é€šä¿¡ è¾“å…¥æ³•æœåŠ¡ï¼šfcitx5 ä½œä¸º Wayland è¾“å…¥æ³•æœåŠ¡æ¥æ”¶äº‹ä»¶ å€™é€‰ç”Ÿæˆï¼šfcitx5 å¤„ç†æŒ‰é”®å¹¶ç”Ÿæˆå€™é€‰è¯ å€™é€‰æ˜¾ç¤ºï¼šé€šè¿‡ Wayland åè®®åœ¨å…‰æ ‡ä½ç½®æ˜¾ç¤ºå€™é€‰çª—å£ æ–‡æœ¬æäº¤ï¼šç”¨æˆ·é€‰æ‹©åé€šè¿‡ text-input åè®®æäº¤æœ€ç»ˆæ–‡æœ¬ text-input åè®®æœ‰ v1 è·Ÿ v3 ä¸¤ä¸ªç‰ˆæœ¬ï¼Œç›®å‰ï¼ˆ2025-09ï¼‰Electron/Chrome ä»¥åŠå…¶ä»–å¤§éƒ¨åˆ†ç¨‹åºæ¡†æ¶éƒ½å·²ç»æ”¯æŒäº† text-input-v3. æ¡Œé¢ç¯å¢ƒæ–¹é¢æ‰€æœ‰ä¸»æµ Compositor ä¹Ÿéƒ½æ”¯æŒ text-input-v3. æ‰€ä»¥ç›®å‰ wayland ä¸‹è¾“å…¥æ³•çš„å¯ç”¨æ€§å·²ç»å¾ˆé«˜äº†ã€‚ 2.2.3 X11 / XWayland è¾“å…¥æ³•æµç¨‹XWayland ä½¿ç”¨åœºæ™¯ï¼š å°šæœªæ”¯æŒ Wayland çš„æ—§ç‰ˆåº”ç”¨ éœ€è¦ç‰¹å®š X11 åŠŸèƒ½çš„ä¸“ä¸šè½¯ä»¶ é€šè¿‡åº”ç”¨å¯åŠ¨è„šæœ¬å•ç‹¬è®¾ç½®ç¯å¢ƒå˜é‡ XWayland åº”ç”¨è¾“å…¥æµç¨‹ï¼š æŒ‰é”®æ•è·ï¼šé”®ç›˜äº‹ä»¶é¦–å…ˆè¿›å…¥ Wayland åˆæˆå™¨ï¼ˆHyprlandã€KWin ç­‰ï¼‰ã€‚ äº‹ä»¶è½¬å‘ç»™ XWaylandï¼ˆä¾‹å¦‚xwayland-satelliteï¼‰ å¦‚æœç›®æ ‡æ˜¯ X11 åº”ç”¨çª—å£ï¼Œåˆæˆå™¨ä¼šå°†äº‹ä»¶äº¤ç»™ XWaylandã€‚ XWayland å°† Wayland è¾“å…¥äº‹ä»¶è½¬æ¢ä¸º X11 åè®®äº‹ä»¶ï¼ˆå¦‚ KeyPress/KeyReleaseï¼‰ï¼Œå¹¶äº¤ä»˜ç»™ç›®æ ‡åº”ç”¨ã€‚ åº”ç”¨ä¾§çš„è¾“å…¥æ³•æ¨¡å—æ‹¦æˆªäº‹ä»¶ X11 åº”ç”¨ï¼ˆGTK/Qt ç¨‹åºï¼‰å†…éƒ¨åŠ è½½äº† fcitx5-gtk / fcitx5-qt æ’ä»¶ï¼ˆé€šå¸¸æ ¹æ®ç¯å¢ƒå˜é‡åŠ è½½ï¼Œåé¢ä¼šä»‹ç»è¿™äº›ç¯å¢ƒå˜é‡ï¼‰ã€‚ è¿™äº›æ’ä»¶æ‹¦æˆªæ¥è‡ª XWayland çš„é”®ç›˜äº‹ä»¶ï¼Œå¹¶é€šè¿‡ D-Bus å°†äº‹ä»¶ä¸ŠæŠ¥ç»™ fcitx5ã€‚ æ­¤æ—¶åº”ç”¨ç›¸å½“äºæ˜¯ã€ŒæŠŠé”®ç›˜è¾“å…¥äº¤ç»™ fcitx5 ä»£ç®¡ã€ã€‚ fcitx5 å¤„ç†è¾“å…¥é€»è¾‘ fcitx5 æ”¶åˆ°é”®ç›˜åºåˆ—åï¼Œè¿›å…¥è¾“å…¥æ³•é€»è¾‘ï¼šæ‹¼éŸ³è§£æã€å€™é€‰è¯ç”Ÿæˆã€‚ fcitx5 æ§åˆ¶å€™é€‰çª—å£çš„æ˜¾ç¤ºä½ç½®ï¼ˆé€šå¸¸è·Ÿéšè¾“å…¥å…‰æ ‡ï¼‰ï¼Œå€™é€‰çª—å£æœ¬èº«å¯èƒ½æ˜¯ X11 çª—å£ï¼ˆç”± fcitx5 è‡ªå·±åˆ›å»ºï¼Œå¹¶é€šè¿‡ XWayland æ˜¾ç¤ºï¼‰ã€‚ è¾“å…¥ç»“æœè¿”å›åº”ç”¨ å½“ç”¨æˆ·é€‰å®šå€™é€‰è¯åï¼Œfcitx5 é€šè¿‡ D-Bus è°ƒç”¨ IM æ’ä»¶æ¥å£ç›´æ¥æŠŠç¡®è®¤åçš„å­—ç¬¦ä¸²ä¼ ç»™åº”ç”¨ã€‚ åº”ç”¨çš„ IM æ’ä»¶æ”¶åˆ°å­—ç¬¦ä¸²åï¼Œè°ƒç”¨åº”ç”¨å†…çš„ã€Œè¾“å…¥ä¸Šä¸‹æ–‡ APIã€æ’å…¥æ–‡æœ¬ã€‚ åœ¨åº”ç”¨çœ‹æ¥ï¼Œå®ƒå°±åƒç›´æ¥å¾—åˆ°äº†ã€Œè¾“å…¥äº†ä¸€ä¸²ä¸­æ–‡ã€çš„äº‹ä»¶ã€‚ XWayland ç¯å¢ƒå˜é‡è®¾ç½®ï¼š bash # GTK åº”ç”¨ä½¿ç”¨ fcitxï¼ˆé€šè¿‡ GTK IM æ¨¡å—ï¼‰ export GTK_IM_MODULE=fcitx # Qt åº”ç”¨ä½¿ç”¨ fcitxï¼ˆé€šè¿‡ Qt IM æ¨¡å—ï¼‰ export QT_IM_MODULE=fcitx # X11 åº”ç”¨ä½¿ç”¨ fcitxï¼ˆé€šè¿‡ XIM åè®®ï¼‰ export XMODIFIERS=@im=fcitx è¾“å…¥æ³•æœºåˆ¶è¯´æ˜ï¼š GTK IM æ¨¡å—ã€Qt IM æ¨¡å—ä»¥åŠ XIM åè®®ï¼Œéƒ½æ˜¯ X11 ä¸‹çš„ä¸œè¥¿ï¼Œåœ¨ wayland ä¸‹åªéœ€è¦ text-input åè®®å³å¯ï¼Œä¸éœ€è¦è¿™äº›å¹ºè›¾å­ã€‚ 2.2.4 æ··åˆç¯å¢ƒç®¡ç†ç­–ç•¥æ¨èé…ç½®ç­–ç•¥ï¼š é»˜è®¤ Wayland ä¼˜å…ˆï¼š è®©ç°ä»£åº”ç”¨ä½¿ç”¨åŸç”Ÿ Wayland text-input åè®® æŒ‰éœ€ XWaylandï¼š ä½¿ç”¨ GDK_BACKEND=x11 å¼ºåˆ¶ç‰¹å®šåº”ç”¨ä½¿ç”¨ XWayland ä¸ºç‰¹å®šåº”ç”¨åˆ›å»ºå¯åŠ¨è„šæœ¬è®¾ç½® IM_MODULE ç›¸å…³ç¯å¢ƒå˜é‡ åº”ç”¨å¯åŠ¨è„šæœ¬ç¤ºä¾‹ï¼š bash #!/bin/bash # å¼ºåˆ¶ç‰¹å®šåº”ç”¨ä½¿ç”¨ XWayland export GTK_IM_MODULE=fcitx # ä½¿ç”¨ GTK IM æ¨¡å— export QT_IM_MODULE=fcitx # ä½¿ç”¨ Qt IM æ¨¡å— export GDK_BACKEND=x11 # å¼ºåˆ¶ä½¿ç”¨ X11 åç«¯ your-application 2.2.5 æ•…éšœæ’æŸ¥ä¸ä¼˜åŒ–è¾“å…¥æ³•æ— å“åº”é—®é¢˜ï¼š è¿›ç¨‹çŠ¶æ€æ£€æŸ¥ï¼š bash ps aux | grep fcitx5 systemctl --user status fcitx5 ç¯å¢ƒå˜é‡éªŒè¯ï¼ˆä»… xwayland åœºæ™¯ï¼‰ï¼š bash echo $GTK_IM_MODULE $QT_IM_MODULE $XMODIFIERS echo $XDG_RUNTIME_DIR $DBUS_SESSION_BUS_ADDRESS D-Bus é€šä¿¡æ£€æŸ¥ï¼š bash busctl --user tree org.fcitx.Fcitx5 dbus-monitor --session \"interface='org.fcitx.Fcitx5'\" è¯Šæ–­å·¥å…·ä½¿ç”¨ï¼š bash fcitx5-diagnose fcitx5-configtool å€™é€‰æ¡†æ˜¾ç¤ºé—®é¢˜ï¼š Wayland åŸç”Ÿåº”ç”¨æ’æŸ¥ï¼š bash # æ£€æŸ¥ Wayland ç¯å¢ƒ echo $WAYLAND_DISPLAY $XDG_RUNTIME_DIR # æ£€æŸ¥ text-input åè®®æ”¯æŒ wayland-info | grep text-input # æŸ¥çœ‹åˆæˆå™¨æ—¥å¿—ä¸­ text-input ç›¸å…³é”™è¯¯ journalctl --user -u fcitx5 XWayland åº”ç”¨æ’æŸ¥ï¼š bash # æ£€æŸ¥ XWayland ç¯å¢ƒå˜é‡ echo $GTK_IM_MODULE $QT_IM_MODULE $XMODIFIERS # æ£€æŸ¥ XWayland è¿æ¥ echo $DISPLAY # éªŒè¯ XIM è¿æ¥ xdpyinfo | grep -i input æƒé™å’Œä¼šè¯æ£€æŸ¥ï¼š bash # ç¡®è®¤ fcitx5 åœ¨æ­£ç¡®çš„ç”¨æˆ·ä¼šè¯ä¸­è¿è¡Œ loginctl show-session $(loginctl | grep $USER | awk '{print $1}') # æ£€æŸ¥ D-Bus ä¼šè¯ echo $DBUS_SESSION_BUS_ADDRESS åº”ç”¨å…¼å®¹æ€§ï¼š Wayland åº”ç”¨ï¼šéƒ¨åˆ†åº”ç”¨éœ€è¦é‡æ–°å¯åŠ¨æ‰èƒ½è¯†åˆ«è¾“å…¥æ³• XWayland åº”ç”¨ï¼šéœ€è¦æ­£ç¡®è®¾ç½® XMODIFIERS ç¯å¢ƒå˜é‡ æ··åˆç¯å¢ƒï¼šæŸäº›åº”ç”¨å¯èƒ½åœ¨ä¸åŒç¯å¢ƒä¸‹è¡¨ç°ä¸åŒ æ€§èƒ½ä¼˜åŒ–ï¼š bash # è°ƒæ•´ fcitx5 é…ç½® vim ~/.config/fcitx5/profile # ç¦ç”¨ä¸éœ€è¦çš„è¾“å…¥å¼•æ“ # å‡å°‘å€™é€‰è¯æ•°é‡æé«˜å“åº”é€Ÿåº¦ # äº‘æ‹¼éŸ³é…ç½® vim ~/.config/fcitx5/conf/cloudpinyin.conf ç‰¹æ®Šåœºæ™¯å¤„ç†ï¼š å¤šæ˜¾ç¤ºå™¨ç¯å¢ƒï¼š Waylandï¼šå€™é€‰æ¡†é€šå¸¸èƒ½æ­£ç¡®è·Ÿéšå…‰æ ‡ä½ç½® XWaylandï¼šå€™é€‰æ¡†å¯èƒ½åœ¨é”™è¯¯å±å¹•æ˜¾ç¤ºï¼Œéœ€è¦è°ƒæ•´ X11 é…ç½® é«˜åˆ†å±é€‚é…ï¼š Waylandï¼šè‡ªåŠ¨é€‚é…ç³»ç»Ÿç¼©æ”¾æ¯”ä¾‹ XWaylandï¼šå¯èƒ½éœ€è¦æ‰‹åŠ¨è®¾ç½® GDK_SCALE æˆ– QT_SCALE_FACTOR æ¸¸æˆå’Œå…¨å±åº”ç”¨ï¼š Waylandï¼šéƒ¨åˆ†æ¸¸æˆå¯èƒ½éœ€è¦ gamescope ç­‰å·¥å…· XWaylandï¼šä¼ ç»Ÿå…¨å±æ¸¸æˆé€šå¸¸å·¥ä½œæ­£å¸¸ ç»ˆç«¯åº”ç”¨ï¼š Wayland ç»ˆç«¯ï¼šéœ€è¦ç»ˆç«¯æ¨¡æ‹Ÿå™¨æ”¯æŒ text-input åè®® XWayland ç»ˆç«¯ï¼šä½¿ç”¨ X11 çš„ XIM åè®®æˆ– GTK/Qt IM æ¨¡å— ","date":"2025-10-19","objectID":"/posts/linux-desktop-4-multimedia-input/:3:4","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Multimedia","Audio","Video","Input Method"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå››ï¼‰ - å¤šåª’ä½“å¤„ç†ä¸ä¸­æ–‡æ”¯æŒ","uri":"/posts/linux-desktop-4-multimedia-input/#223-x11--xwayland-è¾“å…¥æ³•æµç¨‹"},{"categories":["tech"],"content":" 2.2 ä¸­æ–‡è¾“å…¥æ³•ç°ä»£ Linux æ¡Œé¢ä¸»è¦ä½¿ç”¨ fcitx5 ä½œä¸ºä¸­æ–‡è¾“å…¥è§£å†³æ–¹æ¡ˆï¼Œå®ƒé€šè¿‡æ’ä»¶ç³»ç»Ÿæ”¯æŒå¤šç§è¾“å…¥å¼•æ“ï¼Œå¹¶ä¸å›¾å½¢ç¯å¢ƒæ·±åº¦é›†æˆã€‚ 2.2.1 è¾“å…¥æ³•æ¡†æ¶æ¶æ„æ ¸å¿ƒç»„ä»¶ï¼š fcitx5-daemonï¼šä¸»å®ˆæŠ¤è¿›ç¨‹ï¼Œç®¡ç†è¾“å…¥æ³•çŠ¶æ€ è¾“å…¥å¼•æ“ï¼šæ‹¼éŸ³ã€äº”ç¬”ã€ä»“é¢‰ç­‰å…·ä½“è¾“å…¥æ³•å®ç° å›¾å½¢å‰ç«¯ï¼šè´Ÿè´£å€™é€‰è¯ç•Œé¢æ˜¾ç¤º é…ç½®å·¥å…·ï¼šfcitx5-configtool æä¾›å›¾å½¢åŒ–é…ç½® é…ç½®æ–‡ä»¶è·¯å¾„ï¼š ~/.config/fcitx5/configï¼šä¸»é…ç½®æ–‡ä»¶ ~/.config/fcitx5/profileï¼šè¾“å…¥æ³•å¼•æ“é…ç½® ~/.config/fcitx5/conf/ï¼šå„è¾“å…¥æ³•å¼•æ“çš„è¯¦ç»†é…ç½® 2.2.2 Wayland åŸç”Ÿè¾“å…¥æ³•æµç¨‹Wayland text-input åè®®æµç¨‹ï¼š æŒ‰é”®æ•è·ï¼šé”®ç›˜äº‹ä»¶é¦–å…ˆåˆ°è¾¾ Wayland åˆæˆå™¨ åè®®é€šä¿¡ï¼šåˆæˆå™¨é€šè¿‡ text-input åè®®ä¸å®¢æˆ·ç«¯åº”ç”¨é€šä¿¡ è¾“å…¥æ³•æœåŠ¡ï¼šfcitx5 ä½œä¸º Wayland è¾“å…¥æ³•æœåŠ¡æ¥æ”¶äº‹ä»¶ å€™é€‰ç”Ÿæˆï¼šfcitx5 å¤„ç†æŒ‰é”®å¹¶ç”Ÿæˆå€™é€‰è¯ å€™é€‰æ˜¾ç¤ºï¼šé€šè¿‡ Wayland åè®®åœ¨å…‰æ ‡ä½ç½®æ˜¾ç¤ºå€™é€‰çª—å£ æ–‡æœ¬æäº¤ï¼šç”¨æˆ·é€‰æ‹©åé€šè¿‡ text-input åè®®æäº¤æœ€ç»ˆæ–‡æœ¬ text-input åè®®æœ‰ v1 è·Ÿ v3 ä¸¤ä¸ªç‰ˆæœ¬ï¼Œç›®å‰ï¼ˆ2025-09ï¼‰Electron/Chrome ä»¥åŠå…¶ä»–å¤§éƒ¨åˆ†ç¨‹åºæ¡†æ¶éƒ½å·²ç»æ”¯æŒäº† text-input-v3. æ¡Œé¢ç¯å¢ƒæ–¹é¢æ‰€æœ‰ä¸»æµ Compositor ä¹Ÿéƒ½æ”¯æŒ text-input-v3. æ‰€ä»¥ç›®å‰ wayland ä¸‹è¾“å…¥æ³•çš„å¯ç”¨æ€§å·²ç»å¾ˆé«˜äº†ã€‚ 2.2.3 X11 / XWayland è¾“å…¥æ³•æµç¨‹XWayland ä½¿ç”¨åœºæ™¯ï¼š å°šæœªæ”¯æŒ Wayland çš„æ—§ç‰ˆåº”ç”¨ éœ€è¦ç‰¹å®š X11 åŠŸèƒ½çš„ä¸“ä¸šè½¯ä»¶ é€šè¿‡åº”ç”¨å¯åŠ¨è„šæœ¬å•ç‹¬è®¾ç½®ç¯å¢ƒå˜é‡ XWayland åº”ç”¨è¾“å…¥æµç¨‹ï¼š æŒ‰é”®æ•è·ï¼šé”®ç›˜äº‹ä»¶é¦–å…ˆè¿›å…¥ Wayland åˆæˆå™¨ï¼ˆHyprlandã€KWin ç­‰ï¼‰ã€‚ äº‹ä»¶è½¬å‘ç»™ XWaylandï¼ˆä¾‹å¦‚xwayland-satelliteï¼‰ å¦‚æœç›®æ ‡æ˜¯ X11 åº”ç”¨çª—å£ï¼Œåˆæˆå™¨ä¼šå°†äº‹ä»¶äº¤ç»™ XWaylandã€‚ XWayland å°† Wayland è¾“å…¥äº‹ä»¶è½¬æ¢ä¸º X11 åè®®äº‹ä»¶ï¼ˆå¦‚ KeyPress/KeyReleaseï¼‰ï¼Œå¹¶äº¤ä»˜ç»™ç›®æ ‡åº”ç”¨ã€‚ åº”ç”¨ä¾§çš„è¾“å…¥æ³•æ¨¡å—æ‹¦æˆªäº‹ä»¶ X11 åº”ç”¨ï¼ˆGTK/Qt ç¨‹åºï¼‰å†…éƒ¨åŠ è½½äº† fcitx5-gtk / fcitx5-qt æ’ä»¶ï¼ˆé€šå¸¸æ ¹æ®ç¯å¢ƒå˜é‡åŠ è½½ï¼Œåé¢ä¼šä»‹ç»è¿™äº›ç¯å¢ƒå˜é‡ï¼‰ã€‚ è¿™äº›æ’ä»¶æ‹¦æˆªæ¥è‡ª XWayland çš„é”®ç›˜äº‹ä»¶ï¼Œå¹¶é€šè¿‡ D-Bus å°†äº‹ä»¶ä¸ŠæŠ¥ç»™ fcitx5ã€‚ æ­¤æ—¶åº”ç”¨ç›¸å½“äºæ˜¯ã€ŒæŠŠé”®ç›˜è¾“å…¥äº¤ç»™ fcitx5 ä»£ç®¡ã€ã€‚ fcitx5 å¤„ç†è¾“å…¥é€»è¾‘ fcitx5 æ”¶åˆ°é”®ç›˜åºåˆ—åï¼Œè¿›å…¥è¾“å…¥æ³•é€»è¾‘ï¼šæ‹¼éŸ³è§£æã€å€™é€‰è¯ç”Ÿæˆã€‚ fcitx5 æ§åˆ¶å€™é€‰çª—å£çš„æ˜¾ç¤ºä½ç½®ï¼ˆé€šå¸¸è·Ÿéšè¾“å…¥å…‰æ ‡ï¼‰ï¼Œå€™é€‰çª—å£æœ¬èº«å¯èƒ½æ˜¯ X11 çª—å£ï¼ˆç”± fcitx5 è‡ªå·±åˆ›å»ºï¼Œå¹¶é€šè¿‡ XWayland æ˜¾ç¤ºï¼‰ã€‚ è¾“å…¥ç»“æœè¿”å›åº”ç”¨ å½“ç”¨æˆ·é€‰å®šå€™é€‰è¯åï¼Œfcitx5 é€šè¿‡ D-Bus è°ƒç”¨ IM æ’ä»¶æ¥å£ç›´æ¥æŠŠç¡®è®¤åçš„å­—ç¬¦ä¸²ä¼ ç»™åº”ç”¨ã€‚ åº”ç”¨çš„ IM æ’ä»¶æ”¶åˆ°å­—ç¬¦ä¸²åï¼Œè°ƒç”¨åº”ç”¨å†…çš„ã€Œè¾“å…¥ä¸Šä¸‹æ–‡ APIã€æ’å…¥æ–‡æœ¬ã€‚ åœ¨åº”ç”¨çœ‹æ¥ï¼Œå®ƒå°±åƒç›´æ¥å¾—åˆ°äº†ã€Œè¾“å…¥äº†ä¸€ä¸²ä¸­æ–‡ã€çš„äº‹ä»¶ã€‚ XWayland ç¯å¢ƒå˜é‡è®¾ç½®ï¼š bash # GTK åº”ç”¨ä½¿ç”¨ fcitxï¼ˆé€šè¿‡ GTK IM æ¨¡å—ï¼‰ export GTK_IM_MODULE=fcitx # Qt åº”ç”¨ä½¿ç”¨ fcitxï¼ˆé€šè¿‡ Qt IM æ¨¡å—ï¼‰ export QT_IM_MODULE=fcitx # X11 åº”ç”¨ä½¿ç”¨ fcitxï¼ˆé€šè¿‡ XIM åè®®ï¼‰ export XMODIFIERS=@im=fcitx è¾“å…¥æ³•æœºåˆ¶è¯´æ˜ï¼š GTK IM æ¨¡å—ã€Qt IM æ¨¡å—ä»¥åŠ XIM åè®®ï¼Œéƒ½æ˜¯ X11 ä¸‹çš„ä¸œè¥¿ï¼Œåœ¨ wayland ä¸‹åªéœ€è¦ text-input åè®®å³å¯ï¼Œä¸éœ€è¦è¿™äº›å¹ºè›¾å­ã€‚ 2.2.4 æ··åˆç¯å¢ƒç®¡ç†ç­–ç•¥æ¨èé…ç½®ç­–ç•¥ï¼š é»˜è®¤ Wayland ä¼˜å…ˆï¼š è®©ç°ä»£åº”ç”¨ä½¿ç”¨åŸç”Ÿ Wayland text-input åè®® æŒ‰éœ€ XWaylandï¼š ä½¿ç”¨ GDK_BACKEND=x11 å¼ºåˆ¶ç‰¹å®šåº”ç”¨ä½¿ç”¨ XWayland ä¸ºç‰¹å®šåº”ç”¨åˆ›å»ºå¯åŠ¨è„šæœ¬è®¾ç½® IM_MODULE ç›¸å…³ç¯å¢ƒå˜é‡ åº”ç”¨å¯åŠ¨è„šæœ¬ç¤ºä¾‹ï¼š bash #!/bin/bash # å¼ºåˆ¶ç‰¹å®šåº”ç”¨ä½¿ç”¨ XWayland export GTK_IM_MODULE=fcitx # ä½¿ç”¨ GTK IM æ¨¡å— export QT_IM_MODULE=fcitx # ä½¿ç”¨ Qt IM æ¨¡å— export GDK_BACKEND=x11 # å¼ºåˆ¶ä½¿ç”¨ X11 åç«¯ your-application 2.2.5 æ•…éšœæ’æŸ¥ä¸ä¼˜åŒ–è¾“å…¥æ³•æ— å“åº”é—®é¢˜ï¼š è¿›ç¨‹çŠ¶æ€æ£€æŸ¥ï¼š bash ps aux | grep fcitx5 systemctl --user status fcitx5 ç¯å¢ƒå˜é‡éªŒè¯ï¼ˆä»… xwayland åœºæ™¯ï¼‰ï¼š bash echo $GTK_IM_MODULE $QT_IM_MODULE $XMODIFIERS echo $XDG_RUNTIME_DIR $DBUS_SESSION_BUS_ADDRESS D-Bus é€šä¿¡æ£€æŸ¥ï¼š bash busctl --user tree org.fcitx.Fcitx5 dbus-monitor --session \"interface='org.fcitx.Fcitx5'\" è¯Šæ–­å·¥å…·ä½¿ç”¨ï¼š bash fcitx5-diagnose fcitx5-configtool å€™é€‰æ¡†æ˜¾ç¤ºé—®é¢˜ï¼š Wayland åŸç”Ÿåº”ç”¨æ’æŸ¥ï¼š bash # æ£€æŸ¥ Wayland ç¯å¢ƒ echo $WAYLAND_DISPLAY $XDG_RUNTIME_DIR # æ£€æŸ¥ text-input åè®®æ”¯æŒ wayland-info | grep text-input # æŸ¥çœ‹åˆæˆå™¨æ—¥å¿—ä¸­ text-input ç›¸å…³é”™è¯¯ journalctl --user -u fcitx5 XWayland åº”ç”¨æ’æŸ¥ï¼š bash # æ£€æŸ¥ XWayland ç¯å¢ƒå˜é‡ echo $GTK_IM_MODULE $QT_IM_MODULE $XMODIFIERS # æ£€æŸ¥ XWayland è¿æ¥ echo $DISPLAY # éªŒè¯ XIM è¿æ¥ xdpyinfo | grep -i input æƒé™å’Œä¼šè¯æ£€æŸ¥ï¼š bash # ç¡®è®¤ fcitx5 åœ¨æ­£ç¡®çš„ç”¨æˆ·ä¼šè¯ä¸­è¿è¡Œ loginctl show-session $(loginctl | grep $USER | awk '{print $1}') # æ£€æŸ¥ D-Bus ä¼šè¯ echo $DBUS_SESSION_BUS_ADDRESS åº”ç”¨å…¼å®¹æ€§ï¼š Wayland åº”ç”¨ï¼šéƒ¨åˆ†åº”ç”¨éœ€è¦é‡æ–°å¯åŠ¨æ‰èƒ½è¯†åˆ«è¾“å…¥æ³• XWayland åº”ç”¨ï¼šéœ€è¦æ­£ç¡®è®¾ç½® XMODIFIERS ç¯å¢ƒå˜é‡ æ··åˆç¯å¢ƒï¼šæŸäº›åº”ç”¨å¯èƒ½åœ¨ä¸åŒç¯å¢ƒä¸‹è¡¨ç°ä¸åŒ æ€§èƒ½ä¼˜åŒ–ï¼š bash # è°ƒæ•´ fcitx5 é…ç½® vim ~/.config/fcitx5/profile # ç¦ç”¨ä¸éœ€è¦çš„è¾“å…¥å¼•æ“ # å‡å°‘å€™é€‰è¯æ•°é‡æé«˜å“åº”é€Ÿåº¦ # äº‘æ‹¼éŸ³é…ç½® vim ~/.config/fcitx5/conf/cloudpinyin.conf ç‰¹æ®Šåœºæ™¯å¤„ç†ï¼š å¤šæ˜¾ç¤ºå™¨ç¯å¢ƒï¼š Waylandï¼šå€™é€‰æ¡†é€šå¸¸èƒ½æ­£ç¡®è·Ÿéšå…‰æ ‡ä½ç½® XWaylandï¼šå€™é€‰æ¡†å¯èƒ½åœ¨é”™è¯¯å±å¹•æ˜¾ç¤ºï¼Œéœ€è¦è°ƒæ•´ X11 é…ç½® é«˜åˆ†å±é€‚é…ï¼š Waylandï¼šè‡ªåŠ¨é€‚é…ç³»ç»Ÿç¼©æ”¾æ¯”ä¾‹ XWaylandï¼šå¯èƒ½éœ€è¦æ‰‹åŠ¨è®¾ç½® GDK_SCALE æˆ– QT_SCALE_FACTOR æ¸¸æˆå’Œå…¨å±åº”ç”¨ï¼š Waylandï¼šéƒ¨åˆ†æ¸¸æˆå¯èƒ½éœ€è¦ gamescope ç­‰å·¥å…· XWaylandï¼šä¼ ç»Ÿå…¨å±æ¸¸æˆé€šå¸¸å·¥ä½œæ­£å¸¸ ç»ˆç«¯åº”ç”¨ï¼š Wayland ç»ˆç«¯ï¼šéœ€è¦ç»ˆç«¯æ¨¡æ‹Ÿå™¨æ”¯æŒ text-input åè®® XWayland ç»ˆç«¯ï¼šä½¿ç”¨ X11 çš„ XIM åè®®æˆ– GTK/Qt IM æ¨¡å— ","date":"2025-10-19","objectID":"/posts/linux-desktop-4-multimedia-input/:3:4","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Multimedia","Audio","Video","Input Method"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå››ï¼‰ - å¤šåª’ä½“å¤„ç†ä¸ä¸­æ–‡æ”¯æŒ","uri":"/posts/linux-desktop-4-multimedia-input/#224-æ··åˆç¯å¢ƒç®¡ç†ç­–ç•¥"},{"categories":["tech"],"content":" 2.2 ä¸­æ–‡è¾“å…¥æ³•ç°ä»£ Linux æ¡Œé¢ä¸»è¦ä½¿ç”¨ fcitx5 ä½œä¸ºä¸­æ–‡è¾“å…¥è§£å†³æ–¹æ¡ˆï¼Œå®ƒé€šè¿‡æ’ä»¶ç³»ç»Ÿæ”¯æŒå¤šç§è¾“å…¥å¼•æ“ï¼Œå¹¶ä¸å›¾å½¢ç¯å¢ƒæ·±åº¦é›†æˆã€‚ 2.2.1 è¾“å…¥æ³•æ¡†æ¶æ¶æ„æ ¸å¿ƒç»„ä»¶ï¼š fcitx5-daemonï¼šä¸»å®ˆæŠ¤è¿›ç¨‹ï¼Œç®¡ç†è¾“å…¥æ³•çŠ¶æ€ è¾“å…¥å¼•æ“ï¼šæ‹¼éŸ³ã€äº”ç¬”ã€ä»“é¢‰ç­‰å…·ä½“è¾“å…¥æ³•å®ç° å›¾å½¢å‰ç«¯ï¼šè´Ÿè´£å€™é€‰è¯ç•Œé¢æ˜¾ç¤º é…ç½®å·¥å…·ï¼šfcitx5-configtool æä¾›å›¾å½¢åŒ–é…ç½® é…ç½®æ–‡ä»¶è·¯å¾„ï¼š ~/.config/fcitx5/configï¼šä¸»é…ç½®æ–‡ä»¶ ~/.config/fcitx5/profileï¼šè¾“å…¥æ³•å¼•æ“é…ç½® ~/.config/fcitx5/conf/ï¼šå„è¾“å…¥æ³•å¼•æ“çš„è¯¦ç»†é…ç½® 2.2.2 Wayland åŸç”Ÿè¾“å…¥æ³•æµç¨‹Wayland text-input åè®®æµç¨‹ï¼š æŒ‰é”®æ•è·ï¼šé”®ç›˜äº‹ä»¶é¦–å…ˆåˆ°è¾¾ Wayland åˆæˆå™¨ åè®®é€šä¿¡ï¼šåˆæˆå™¨é€šè¿‡ text-input åè®®ä¸å®¢æˆ·ç«¯åº”ç”¨é€šä¿¡ è¾“å…¥æ³•æœåŠ¡ï¼šfcitx5 ä½œä¸º Wayland è¾“å…¥æ³•æœåŠ¡æ¥æ”¶äº‹ä»¶ å€™é€‰ç”Ÿæˆï¼šfcitx5 å¤„ç†æŒ‰é”®å¹¶ç”Ÿæˆå€™é€‰è¯ å€™é€‰æ˜¾ç¤ºï¼šé€šè¿‡ Wayland åè®®åœ¨å…‰æ ‡ä½ç½®æ˜¾ç¤ºå€™é€‰çª—å£ æ–‡æœ¬æäº¤ï¼šç”¨æˆ·é€‰æ‹©åé€šè¿‡ text-input åè®®æäº¤æœ€ç»ˆæ–‡æœ¬ text-input åè®®æœ‰ v1 è·Ÿ v3 ä¸¤ä¸ªç‰ˆæœ¬ï¼Œç›®å‰ï¼ˆ2025-09ï¼‰Electron/Chrome ä»¥åŠå…¶ä»–å¤§éƒ¨åˆ†ç¨‹åºæ¡†æ¶éƒ½å·²ç»æ”¯æŒäº† text-input-v3. æ¡Œé¢ç¯å¢ƒæ–¹é¢æ‰€æœ‰ä¸»æµ Compositor ä¹Ÿéƒ½æ”¯æŒ text-input-v3. æ‰€ä»¥ç›®å‰ wayland ä¸‹è¾“å…¥æ³•çš„å¯ç”¨æ€§å·²ç»å¾ˆé«˜äº†ã€‚ 2.2.3 X11 / XWayland è¾“å…¥æ³•æµç¨‹XWayland ä½¿ç”¨åœºæ™¯ï¼š å°šæœªæ”¯æŒ Wayland çš„æ—§ç‰ˆåº”ç”¨ éœ€è¦ç‰¹å®š X11 åŠŸèƒ½çš„ä¸“ä¸šè½¯ä»¶ é€šè¿‡åº”ç”¨å¯åŠ¨è„šæœ¬å•ç‹¬è®¾ç½®ç¯å¢ƒå˜é‡ XWayland åº”ç”¨è¾“å…¥æµç¨‹ï¼š æŒ‰é”®æ•è·ï¼šé”®ç›˜äº‹ä»¶é¦–å…ˆè¿›å…¥ Wayland åˆæˆå™¨ï¼ˆHyprlandã€KWin ç­‰ï¼‰ã€‚ äº‹ä»¶è½¬å‘ç»™ XWaylandï¼ˆä¾‹å¦‚xwayland-satelliteï¼‰ å¦‚æœç›®æ ‡æ˜¯ X11 åº”ç”¨çª—å£ï¼Œåˆæˆå™¨ä¼šå°†äº‹ä»¶äº¤ç»™ XWaylandã€‚ XWayland å°† Wayland è¾“å…¥äº‹ä»¶è½¬æ¢ä¸º X11 åè®®äº‹ä»¶ï¼ˆå¦‚ KeyPress/KeyReleaseï¼‰ï¼Œå¹¶äº¤ä»˜ç»™ç›®æ ‡åº”ç”¨ã€‚ åº”ç”¨ä¾§çš„è¾“å…¥æ³•æ¨¡å—æ‹¦æˆªäº‹ä»¶ X11 åº”ç”¨ï¼ˆGTK/Qt ç¨‹åºï¼‰å†…éƒ¨åŠ è½½äº† fcitx5-gtk / fcitx5-qt æ’ä»¶ï¼ˆé€šå¸¸æ ¹æ®ç¯å¢ƒå˜é‡åŠ è½½ï¼Œåé¢ä¼šä»‹ç»è¿™äº›ç¯å¢ƒå˜é‡ï¼‰ã€‚ è¿™äº›æ’ä»¶æ‹¦æˆªæ¥è‡ª XWayland çš„é”®ç›˜äº‹ä»¶ï¼Œå¹¶é€šè¿‡ D-Bus å°†äº‹ä»¶ä¸ŠæŠ¥ç»™ fcitx5ã€‚ æ­¤æ—¶åº”ç”¨ç›¸å½“äºæ˜¯ã€ŒæŠŠé”®ç›˜è¾“å…¥äº¤ç»™ fcitx5 ä»£ç®¡ã€ã€‚ fcitx5 å¤„ç†è¾“å…¥é€»è¾‘ fcitx5 æ”¶åˆ°é”®ç›˜åºåˆ—åï¼Œè¿›å…¥è¾“å…¥æ³•é€»è¾‘ï¼šæ‹¼éŸ³è§£æã€å€™é€‰è¯ç”Ÿæˆã€‚ fcitx5 æ§åˆ¶å€™é€‰çª—å£çš„æ˜¾ç¤ºä½ç½®ï¼ˆé€šå¸¸è·Ÿéšè¾“å…¥å…‰æ ‡ï¼‰ï¼Œå€™é€‰çª—å£æœ¬èº«å¯èƒ½æ˜¯ X11 çª—å£ï¼ˆç”± fcitx5 è‡ªå·±åˆ›å»ºï¼Œå¹¶é€šè¿‡ XWayland æ˜¾ç¤ºï¼‰ã€‚ è¾“å…¥ç»“æœè¿”å›åº”ç”¨ å½“ç”¨æˆ·é€‰å®šå€™é€‰è¯åï¼Œfcitx5 é€šè¿‡ D-Bus è°ƒç”¨ IM æ’ä»¶æ¥å£ç›´æ¥æŠŠç¡®è®¤åçš„å­—ç¬¦ä¸²ä¼ ç»™åº”ç”¨ã€‚ åº”ç”¨çš„ IM æ’ä»¶æ”¶åˆ°å­—ç¬¦ä¸²åï¼Œè°ƒç”¨åº”ç”¨å†…çš„ã€Œè¾“å…¥ä¸Šä¸‹æ–‡ APIã€æ’å…¥æ–‡æœ¬ã€‚ åœ¨åº”ç”¨çœ‹æ¥ï¼Œå®ƒå°±åƒç›´æ¥å¾—åˆ°äº†ã€Œè¾“å…¥äº†ä¸€ä¸²ä¸­æ–‡ã€çš„äº‹ä»¶ã€‚ XWayland ç¯å¢ƒå˜é‡è®¾ç½®ï¼š bash # GTK åº”ç”¨ä½¿ç”¨ fcitxï¼ˆé€šè¿‡ GTK IM æ¨¡å—ï¼‰ export GTK_IM_MODULE=fcitx # Qt åº”ç”¨ä½¿ç”¨ fcitxï¼ˆé€šè¿‡ Qt IM æ¨¡å—ï¼‰ export QT_IM_MODULE=fcitx # X11 åº”ç”¨ä½¿ç”¨ fcitxï¼ˆé€šè¿‡ XIM åè®®ï¼‰ export XMODIFIERS=@im=fcitx è¾“å…¥æ³•æœºåˆ¶è¯´æ˜ï¼š GTK IM æ¨¡å—ã€Qt IM æ¨¡å—ä»¥åŠ XIM åè®®ï¼Œéƒ½æ˜¯ X11 ä¸‹çš„ä¸œè¥¿ï¼Œåœ¨ wayland ä¸‹åªéœ€è¦ text-input åè®®å³å¯ï¼Œä¸éœ€è¦è¿™äº›å¹ºè›¾å­ã€‚ 2.2.4 æ··åˆç¯å¢ƒç®¡ç†ç­–ç•¥æ¨èé…ç½®ç­–ç•¥ï¼š é»˜è®¤ Wayland ä¼˜å…ˆï¼š è®©ç°ä»£åº”ç”¨ä½¿ç”¨åŸç”Ÿ Wayland text-input åè®® æŒ‰éœ€ XWaylandï¼š ä½¿ç”¨ GDK_BACKEND=x11 å¼ºåˆ¶ç‰¹å®šåº”ç”¨ä½¿ç”¨ XWayland ä¸ºç‰¹å®šåº”ç”¨åˆ›å»ºå¯åŠ¨è„šæœ¬è®¾ç½® IM_MODULE ç›¸å…³ç¯å¢ƒå˜é‡ åº”ç”¨å¯åŠ¨è„šæœ¬ç¤ºä¾‹ï¼š bash #!/bin/bash # å¼ºåˆ¶ç‰¹å®šåº”ç”¨ä½¿ç”¨ XWayland export GTK_IM_MODULE=fcitx # ä½¿ç”¨ GTK IM æ¨¡å— export QT_IM_MODULE=fcitx # ä½¿ç”¨ Qt IM æ¨¡å— export GDK_BACKEND=x11 # å¼ºåˆ¶ä½¿ç”¨ X11 åç«¯ your-application 2.2.5 æ•…éšœæ’æŸ¥ä¸ä¼˜åŒ–è¾“å…¥æ³•æ— å“åº”é—®é¢˜ï¼š è¿›ç¨‹çŠ¶æ€æ£€æŸ¥ï¼š bash ps aux | grep fcitx5 systemctl --user status fcitx5 ç¯å¢ƒå˜é‡éªŒè¯ï¼ˆä»… xwayland åœºæ™¯ï¼‰ï¼š bash echo $GTK_IM_MODULE $QT_IM_MODULE $XMODIFIERS echo $XDG_RUNTIME_DIR $DBUS_SESSION_BUS_ADDRESS D-Bus é€šä¿¡æ£€æŸ¥ï¼š bash busctl --user tree org.fcitx.Fcitx5 dbus-monitor --session \"interface='org.fcitx.Fcitx5'\" è¯Šæ–­å·¥å…·ä½¿ç”¨ï¼š bash fcitx5-diagnose fcitx5-configtool å€™é€‰æ¡†æ˜¾ç¤ºé—®é¢˜ï¼š Wayland åŸç”Ÿåº”ç”¨æ’æŸ¥ï¼š bash # æ£€æŸ¥ Wayland ç¯å¢ƒ echo $WAYLAND_DISPLAY $XDG_RUNTIME_DIR # æ£€æŸ¥ text-input åè®®æ”¯æŒ wayland-info | grep text-input # æŸ¥çœ‹åˆæˆå™¨æ—¥å¿—ä¸­ text-input ç›¸å…³é”™è¯¯ journalctl --user -u fcitx5 XWayland åº”ç”¨æ’æŸ¥ï¼š bash # æ£€æŸ¥ XWayland ç¯å¢ƒå˜é‡ echo $GTK_IM_MODULE $QT_IM_MODULE $XMODIFIERS # æ£€æŸ¥ XWayland è¿æ¥ echo $DISPLAY # éªŒè¯ XIM è¿æ¥ xdpyinfo | grep -i input æƒé™å’Œä¼šè¯æ£€æŸ¥ï¼š bash # ç¡®è®¤ fcitx5 åœ¨æ­£ç¡®çš„ç”¨æˆ·ä¼šè¯ä¸­è¿è¡Œ loginctl show-session $(loginctl | grep $USER | awk '{print $1}') # æ£€æŸ¥ D-Bus ä¼šè¯ echo $DBUS_SESSION_BUS_ADDRESS åº”ç”¨å…¼å®¹æ€§ï¼š Wayland åº”ç”¨ï¼šéƒ¨åˆ†åº”ç”¨éœ€è¦é‡æ–°å¯åŠ¨æ‰èƒ½è¯†åˆ«è¾“å…¥æ³• XWayland åº”ç”¨ï¼šéœ€è¦æ­£ç¡®è®¾ç½® XMODIFIERS ç¯å¢ƒå˜é‡ æ··åˆç¯å¢ƒï¼šæŸäº›åº”ç”¨å¯èƒ½åœ¨ä¸åŒç¯å¢ƒä¸‹è¡¨ç°ä¸åŒ æ€§èƒ½ä¼˜åŒ–ï¼š bash # è°ƒæ•´ fcitx5 é…ç½® vim ~/.config/fcitx5/profile # ç¦ç”¨ä¸éœ€è¦çš„è¾“å…¥å¼•æ“ # å‡å°‘å€™é€‰è¯æ•°é‡æé«˜å“åº”é€Ÿåº¦ # äº‘æ‹¼éŸ³é…ç½® vim ~/.config/fcitx5/conf/cloudpinyin.conf ç‰¹æ®Šåœºæ™¯å¤„ç†ï¼š å¤šæ˜¾ç¤ºå™¨ç¯å¢ƒï¼š Waylandï¼šå€™é€‰æ¡†é€šå¸¸èƒ½æ­£ç¡®è·Ÿéšå…‰æ ‡ä½ç½® XWaylandï¼šå€™é€‰æ¡†å¯èƒ½åœ¨é”™è¯¯å±å¹•æ˜¾ç¤ºï¼Œéœ€è¦è°ƒæ•´ X11 é…ç½® é«˜åˆ†å±é€‚é…ï¼š Waylandï¼šè‡ªåŠ¨é€‚é…ç³»ç»Ÿç¼©æ”¾æ¯”ä¾‹ XWaylandï¼šå¯èƒ½éœ€è¦æ‰‹åŠ¨è®¾ç½® GDK_SCALE æˆ– QT_SCALE_FACTOR æ¸¸æˆå’Œå…¨å±åº”ç”¨ï¼š Waylandï¼šéƒ¨åˆ†æ¸¸æˆå¯èƒ½éœ€è¦ gamescope ç­‰å·¥å…· XWaylandï¼šä¼ ç»Ÿå…¨å±æ¸¸æˆé€šå¸¸å·¥ä½œæ­£å¸¸ ç»ˆç«¯åº”ç”¨ï¼š Wayland ç»ˆç«¯ï¼šéœ€è¦ç»ˆç«¯æ¨¡æ‹Ÿå™¨æ”¯æŒ text-input åè®® XWayland ç»ˆç«¯ï¼šä½¿ç”¨ X11 çš„ XIM åè®®æˆ– GTK/Qt IM æ¨¡å— ","date":"2025-10-19","objectID":"/posts/linux-desktop-4-multimedia-input/:3:4","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Multimedia","Audio","Video","Input Method"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå››ï¼‰ - å¤šåª’ä½“å¤„ç†ä¸ä¸­æ–‡æ”¯æŒ","uri":"/posts/linux-desktop-4-multimedia-input/#225-æ•…éšœæ’æŸ¥ä¸ä¼˜åŒ–"},{"categories":["tech"],"content":" æ€»ç»“æœ¬æ–‡è¯¦ç»†ä»‹ç»äº† Linux æ¡Œé¢ç³»ç»Ÿçš„å¤šåª’ä½“å¤„ç†èƒ½åŠ›ï¼Œé‡ç‚¹é˜è¿°äº† PipeWire å¦‚ä½•ç»Ÿä¸€ç®¡ç†éŸ³é¢‘å’Œè§†é¢‘ï¼Œä»¥åŠ fontconfig å’Œ fcitx5 å¦‚ä½•æä¾›å®Œå–„çš„ä¸­æ–‡æ”¯æŒã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-4-multimedia-input/:4:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Multimedia","Audio","Video","Input Method"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå››ï¼‰ - å¤šåª’ä½“å¤„ç†ä¸ä¸­æ–‡æ”¯æŒ","uri":"/posts/linux-desktop-4-multimedia-input/#æ€»ç»“"},{"categories":["tech"],"content":" PipeWire çš„é©å‘½æ€§æ„ä¹‰PipeWire æ”¯æŒè§†é¢‘æµå¤„ç†ï¼Œæœ¬è´¨æ˜¯ä¸ºäº†è§£å†³ Linux å¤šåª’ä½“ç”Ÿæ€ä¸­é•¿æœŸå­˜åœ¨çš„\"éŸ³é¢‘-è§†é¢‘å‰²è£‚\"â€œä¼ ç»Ÿåè®®é€‚é…å›°éš¾\"â€œæ²™ç›’æƒé™å¤æ‚\"ç­‰é—®é¢˜ã€‚ç›¸æ¯”ä¼ ç»Ÿæ–¹æ³•ï¼Œå®ƒé€šè¿‡ç»Ÿä¸€ç®¡é“æ¨¡å‹ã€åŸç”Ÿé€‚é…ç°ä»£æ¡Œé¢ã€ç®€åŒ–æƒé™ç®¡ç†ã€æ•´åˆç¡¬ä»¶åŠ é€Ÿã€åŠ¨æ€è·¯ç”±ç­‰ç‰¹æ€§ï¼Œè®©è§†é¢‘æµçš„æ•è·ã€ä¼ è¾“ã€å¤„ç†å’Œåä½œå˜å¾—æ›´é«˜æ•ˆã€æ›´å®‰å…¨ã€æ›´æ˜“ç”¨ã€‚ å¦‚ä»Šï¼ŒPipeWire å·²æˆä¸º Linux æ¡Œé¢è§†é¢‘å¤„ç†çš„äº‹å®æ ‡å‡†ï¼ˆå¦‚ GNOME 45+ã€KDE Plasma 6 å‡é»˜è®¤ä¾èµ–ï¼‰ï¼Œæœªæ¥è¿˜å°†è¿›ä¸€æ­¥æ•´åˆ AI å¤„ç†ï¼ˆå¦‚å®æ—¶ç¾é¢œã€é™å™ªï¼‰ç­‰æ–°åŠŸèƒ½ï¼Œæˆä¸ºè¿æ¥ç¡¬ä»¶ã€åº”ç”¨ä¸ç”¨æˆ·çš„\"å¤šåª’ä½“ä¸­æ¢â€ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-4-multimedia-input/:4:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Multimedia","Audio","Video","Input Method"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå››ï¼‰ - å¤šåª’ä½“å¤„ç†ä¸ä¸­æ–‡æ”¯æŒ","uri":"/posts/linux-desktop-4-multimedia-input/#pipewire-çš„é©å‘½æ€§æ„ä¹‰"},{"categories":["tech"],"content":" ä¸­æ–‡æ”¯æŒçš„é‡è¦æ€§ä¸­æ–‡æ”¯æŒæ–¹é¢ï¼Œè™½ç„¶é…ç½®ç¨å¾®å¤æ‚ä¸€äº›ï¼Œä½†ä¸€æ—¦æå®šå°±åŸºæœ¬ä¸ç”¨å†æ“å¿ƒäº†ã€‚fontconfig çš„å­—ä½“åŒ¹é…æœºåˆ¶å’Œ fcitx5 çš„è¾“å…¥æ³•æ¡†æ¶ä¸ºä¸­æ–‡ç”¨æˆ·æä¾›äº†å®Œæ•´çš„æ¡Œé¢ä½“éªŒã€‚ ä¸‹ä¸€ç¯‡æ–‡ç« æˆ‘ä»¬ä¼šèŠèŠç½‘ç»œæ¶æ„ï¼Œçœ‹çœ‹ç³»ç»Ÿæ˜¯å¦‚ä½•å¤„ç†ç½‘ç»œè¿æ¥å’Œç®¡ç†çš„ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-4-multimedia-input/:4:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Multimedia","Audio","Video","Input Method"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå››ï¼‰ - å¤šåª’ä½“å¤„ç†ä¸ä¸­æ–‡æ”¯æŒ","uri":"/posts/linux-desktop-4-multimedia-input/#ä¸­æ–‡æ”¯æŒçš„é‡è¦æ€§"},{"categories":["tech"],"content":"è¯¦è§£ Linux æ¡Œé¢ä¼šè¯ç®¡ç†ã€å›¾å½¢æ¸²æŸ“æ¶æ„ã€Wayland ä¸ X11 åè®®ï¼Œä»¥åŠæ˜¾ç¤ºé©±åŠ¨å’Œåˆæˆå™¨çš„æ•…éšœæ’æŸ¥","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/"},{"categories":["tech"],"content":" AI åˆ›ä½œå£°æ˜ï¼šæœ¬ç³»åˆ—æ–‡ç« ç”±ç¬”è€…å€ŸåŠ© ChatGPT, Kimi K2, è±†åŒ…å’Œ Cursor ç­‰ AI å·¥å…·åˆ›ä½œï¼Œæœ‰å¾ˆå¤§ç¯‡å¹…çš„å†…å®¹å®Œå…¨ç”± AI åœ¨æˆ‘çš„æŒ‡å¯¼ä¸‹ç”Ÿæˆã€‚å¦‚æœ‰é”™è¯¯ï¼Œè¿˜è¯·æŒ‡æ­£ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:0:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#"},{"categories":["tech"],"content":" å‰è¨€Systemd åŠå„é¡¹ç³»ç»ŸæœåŠ¡å¯åŠ¨åä¼šè¿›å…¥ç™»å½•é¡µé¢ï¼Œä»è¿™ä¸€åˆ»å¼€å§‹çš„ Linux æ¡Œé¢ä½¿ç”¨è¿‡ç¨‹æ¶‰åŠä¼šè¯ç®¡ç†ã€çª—å£åˆæˆã€å›¾å½¢æ¸²æŸ“å’Œè¾“å…¥å¤„ç†ç­‰å¤šä¸ªç»„ä»¶ã€‚ æœ¬æ–‡å°†æ¢è®¨ Linux æ¡Œé¢ç³»ç»Ÿçš„å›¾å½¢æ¶æ„ï¼Œä»ç”¨æˆ·ç™»å½•åˆ°åº”ç”¨æ¸²æŸ“çš„å®Œæ•´æµç¨‹ï¼ŒåŒ…æ‹¬ Wayland å’Œ X11 çš„åŒºåˆ«ï¼Œå›¾å½¢é©±åŠ¨çš„å·¥ä½œåŸç†ï¼Œä»¥åŠå¦‚ä½•è¯Šæ–­å’Œè§£å†³å„ç§å›¾å½¢é—®é¢˜ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:1:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#å‰è¨€"},{"categories":["tech"],"content":" ç”¨æˆ·ä¼šè¯ï¼šä»ç™»å½•åˆ°æ¡Œé¢ç”¨æˆ·ä»ç™»å½•åˆ°è¿›å…¥æ¡Œé¢ç¯å¢ƒçš„è¿‡ç¨‹æ¶‰åŠå¤šä¸ªç»„ä»¶çš„åè°ƒï¼šdisplay manager è´Ÿè´£è®¤è¯ï¼Œsystemd-logind ç®¡ç†ä¼šè¯ï¼Œwindow compositor æä¾›å›¾å½¢ç¯å¢ƒã€‚è¿™ä¸ªé˜¶æ®µçš„æ•…éšœå¾€å¾€è¡¨ç°ä¸ºç™»å½•å¤±è´¥ã€æƒé™é”™è¯¯æˆ–å›¾å½¢ç•Œé¢å¼‚å¸¸ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:2:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#ç”¨æˆ·ä¼šè¯ä»ç™»å½•åˆ°æ¡Œé¢"},{"categories":["tech"],"content":" 1.1 ç™»å½•æµç¨‹å…¸å‹çš„å›¾å½¢ç™»å½•æµç¨‹ï¼š æ˜¾ç¤ºç®¡ç†å™¨å¯åŠ¨ï¼šgreetd / GDM ç­‰æ˜¾ç¤ºç®¡ç†å™¨æ˜¾ç¤ºç™»å½•ç•Œé¢ ç”¨æˆ·è®¤è¯ï¼šé€šè¿‡ PAM éªŒè¯ç”¨æˆ·å / å¯†ç  ä¼šè¯åˆ›å»ºï¼šDisplay Manager è¯·æ±‚ logind åˆ›å»º session ç”¨æˆ·æœåŠ¡å¯åŠ¨ï¼šsystemd ç”¨æˆ·å®ä¾‹å¯åŠ¨ï¼Œè¿è¡Œç”¨æˆ·é…ç½®çš„æœåŠ¡ åˆæˆå™¨å¯åŠ¨ï¼šè·å¾—ç¯å¢ƒå˜é‡å’Œè®¾å¤‡è®¿é—®æƒé™ å…³é”®è§‚å¯Ÿç‚¹ï¼š bash # æŸ¥çœ‹æ˜¾ç¤ºç®¡ç†å™¨æ—¥å¿— journalctl -u greetd journalctl -b _COMM=greetd # æ£€æŸ¥ä¼šè¯çŠ¶æ€ loginctl list-sessions loginctl show-session \u003cid\u003e --property=Name,UID,State # æŸ¥çœ‹ç”¨æˆ·æœåŠ¡æ—¥å¿— journalctl --user -b æ•…éšœæ’æŸ¥ç¤ºä¾‹ï¼šç”¨æˆ·ç™»å½•ååˆæˆå™¨æœªå¯åŠ¨ æ£€æŸ¥ç”¨æˆ·æœåŠ¡æ—¥å¿—ï¼šjournalctl --user -u hyprland.service éªŒè¯ä¼šè¯çŠ¶æ€ï¼šloginctl show-session \u003cid\u003e -p Active -p State æŸ¥çœ‹ PAM è®¤è¯æ—¥å¿—ï¼šjournalctl -t login ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:2:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#11-ç™»å½•æµç¨‹"},{"categories":["tech"],"content":" 1.2 ä¼šè¯ç®¡ç†systemd-logind æ˜¯è¿æ¥ç™»å½•ã€ä¼šè¯ã€è®¾å¤‡æƒé™å’Œç”µæºç®¡ç†çš„æ ¸å¿ƒæœåŠ¡ã€‚å®ƒé€šè¿‡ D-Bus æš´éœ² APIï¼Œç®¡ç†ç”¨æˆ·ä¼šè¯å¹¶åˆ†é…è®¾å¤‡ ACLã€‚ æ ¸å¿ƒèŒè´£ï¼š ä¼šè¯ç®¡ç†ï¼šåˆ›å»ºå’Œç»´æŠ¤ç”¨æˆ·ä¼šè¯ï¼Œæ˜ å°„ session -\u003e UID -\u003e TTY / seat è®¾å¤‡è®¿é—®ï¼šåŸºäº udev æ ‡ç­¾åˆ†é…è®¾å¤‡ ACL ç»™å½“å‰ä¼šè¯ ç”µæºç®¡ç†ï¼šå¤„ç†ç”µæºé”®äº‹ä»¶ï¼Œæ ¹æ®ç­–ç•¥è§¦å‘ suspend / shutdown å¤šåº§å¸­æ”¯æŒï¼šæ”¯æŒ seat æ¦‚å¿µï¼Œç®¡ç†å¤šç”¨æˆ·åœºæ™¯ seatï¼ˆåº§å¸­ï¼‰æ¦‚å¿µ https://www.freedesktop.org/wiki/Software/systemd/multiseat/ seatï¼ˆåº§å¸­ï¼‰æ˜¯ systemd/logind å¼•å…¥çš„æœ¯è¯­ï¼Œç”¨æ¥è¡¨ç¤ºã€Œä¸€ç»„ç‰©ç†è®¾å¤‡çš„é›†åˆã€ï¼ˆä¾‹å¦‚ä¸€ä¸ªæ˜¾ç¤ºå™¨ + ä¸€å¥—é”®ç›˜å’Œé¼ æ ‡ + éŸ³é¢‘è®¾å¤‡ï¼‰ï¼Œä»¥åŠä¸ä¹‹å…³è”çš„ä¼šè¯ã€‚ æ‰€æœ‰è®¾å¤‡é»˜è®¤éƒ½ä¼šè¢«åˆ†é…ç»™ seat0, æƒ³å†æä¸€ä¸ª seat1 å®ç°å¤šäººå›¾å½¢åŒ–ç™»å½•ï¼Œå¿…é¡»é€šè¿‡ udev è§„åˆ™å®Œæˆå¦‚ä¸‹æ“ä½œï¼š å¿…é¡»æ‹¥æœ‰ç¬¬äºŒå¼ æ˜¾å¡ï¼Œè¿™æ˜¯ç¡¬æ€§çš„å‰æï¼ä¸ºäº†è®© seat1 å®é™…å¯ç”¨ï¼Œè¿˜å¿…é¡»æ‹¥æœ‰ç¬¬äºŒå¥—é”®é¼ ä¸å£°å¡ã€‚ ç»™ç¬¬äºŒå—æ˜¾å¡å†™ udev è§„åˆ™ï¼Œæ‰“ä¸Š TAG+=\"master-of-seat\" å¹¶è®¾ç½®ENV{ID_SEAT}=\"seat1\"ã€‚ æŠŠç¬¬äºŒå¥—é”®ç›˜ã€é¼ æ ‡ã€å£°å¡ç­‰è®¾å¤‡ä¹Ÿå†™è§„åˆ™æ”¹æˆ ENV{ID_SEAT}=\"seat1\"ã€‚ é‡å¯ç³»ç»Ÿã€‚ logind ä¼šæŠŠ VT/å›¾å½¢ä¼šè¯ç»‘å®šåˆ°å…·ä½“ seatï¼Œä»è€ŒæŒ‰ seat ç²’åº¦åšç”µæºç®¡ç†ã€è®¾å¤‡è®¿é—®æ§åˆ¶ã€ç©ºé—²æ£€æµ‹ç­‰ç­–ç•¥ã€‚ è¿œç¨‹ SSH ç™»å½•ä¸ç”Ÿæˆä¹Ÿä¸å½’å±ä»»ä½• seatï¼›logind ä»…ä¸ºå…¶å»ºç«‹ä¼šè¯å¯¹è±¡ï¼Œseat å­—æ®µç•™ç©ºã€‚å› æ­¤ seat æ¦‚å¿µå¯¹ SSH å®Œå…¨é€æ˜ã€‚ æ³¨æ„ï¼šè™½ç„¶ SSH ä¼šè¯ä¸å½’å±ä»»ä½• seatï¼Œä½†è¿™ä¸å½±å“å¤§å¤šæ•°è®¾å¤‡çš„è®¿é—®ã€‚è®¾å¤‡æƒé™ç®¡ç†æœ‰ä¸¤å¥—å¹¶è¡Œçš„æœºåˆ¶ï¼šä¼ ç»Ÿçš„ Unix æƒé™æ¨¡å‹ï¼ˆåŸºäºç”¨æˆ·ç»„ï¼Œå¦‚ videoã€audioã€input ç­‰ï¼‰å’Œç°ä»£çš„ systemd-logind ACL æœºåˆ¶ï¼ˆåŸºäº seat å’Œä¼šè¯ï¼‰ã€‚SSH ä¼šè¯ä¸»è¦ä¾èµ–å‰è€…ï¼Œå› æ­¤åªè¦ç”¨æˆ·å…·æœ‰ç›¸åº”çš„è®¾å¤‡æƒé™ï¼Œä»å¯æ­£å¸¸è®¿é—® GPUã€å£°å¡ã€å­˜å‚¨è®¾å¤‡ç­‰ç¡¬ä»¶èµ„æºã€‚seat æœºåˆ¶ä¸»è¦å½±å“çš„æ˜¯éœ€è¦å›¾å½¢ç•Œé¢äº¤äº’çš„è®¾å¤‡ï¼ˆå¦‚æ˜¾ç¤ºå™¨ã€é”®ç›˜é¼ æ ‡ï¼‰çš„è®¿é—®æ§åˆ¶ã€‚ ç°ä»£ Linux æ¡Œé¢ç³»ç»ŸåŸºæœ¬éƒ½æ˜¯å•ç”¨æˆ·ä½¿ç”¨ï¼Œå› æ­¤åç»­è®¨è®ºé»˜è®¤èšç„¦å• seat åœºæ™¯ã€‚ å¸¸ç”¨å‘½ä»¤ bash # ä¼šè¯ç®¡ç† loginctl list-sessions # åˆ—å‡ºæ‰€æœ‰ä¼šè¯ loginctl show-session \u003cid\u003e -p Name -p UID -p Seat # ä¼šè¯è¯¦æƒ… loginctl terminate-session \u003cid\u003e # ç»ˆæ­¢ä¼šè¯ # seat ç®¡ç† loginctl seat-status # æŸ¥çœ‹ seat çŠ¶æ€ loginctl seat-status seat0 # ç‰¹å®š seat è¯¦æƒ… # D-Bus æ¥å£è°ƒè¯• busctl --system call org.freedesktop.login1 \\ /org/freedesktop/login1 org.freedesktop.login1.Manager \\ ListSessions è®¾å¤‡æƒé™é—®é¢˜æ’æŸ¥ Wayland compositor å¯åŠ¨ä½†æ— æ³•æ‰“å¼€ /dev/dri/card0ï¼ˆGPU æƒé™é—®é¢˜ï¼‰æ’æŸ¥ï¼š ç¡®è®¤ ls -l /dev/dri/card0 çš„ owner/groupã€‚é€šå¸¸åº”ä¸º root:videoï¼Œå¹¶ä¸”å½“å‰ä¼šè¯åº”è¢«æˆäºˆè®¾å¤‡ ACLã€‚ loginctl seat-status seat0 æŸ¥çœ‹æ˜¯å¦åˆ—å‡º /dev/dri/card0 å¹¶æ˜¾ç¤º ACL ç»™å½“å‰ sessionã€‚ è‹¥æ— ï¼Œé€šè¿‡ udevadm info /dev/dri/card0 æ£€æŸ¥ udev æ˜¯å¦ä¸º GPU è®¾å¤‡æ‰“ä¸Šäº†TAG+=\"uaccess\" æˆ– TAG+=\"seat\"ã€‚ æŸ¥çœ‹ journalctl -u systemd-logindï¼Œçœ‹æ˜¯å¦åœ¨ç”¨æˆ·ç™»å½•æ—¶æœ‰å…³äºè®¾å¤‡åˆ†é…çš„é”™è¯¯ã€‚ è‹¥æœåŠ¡æ˜¯ä»¥ system user çš„æ–¹å¼å¯åŠ¨ï¼Œç¡®ä¿ compositor çš„è¿›ç¨‹æ˜¯åœ¨ç”¨æˆ· session ä¸‹ï¼Œè€Œä¸æ˜¯ systemd æœåŠ¡æˆ– root å¯åŠ¨çš„è¿›ç¨‹ï¼ˆèµ·è¿›ç¨‹èº«ä»½ä¸åŒä¼šå¯¼è‡´æƒé™é—®é¢˜ï¼‰ã€‚ æ„å¤–æŒ‚èµ·/å…³æœºï¼ˆç”µæºé”®/ç¡çœ æŒ‰é’®ä¸æŒ‰ç”¨æˆ·è®¾ç½®å·¥ä½œï¼‰ æ£€æŸ¥ logind.confï¼ˆNixOS å¯¹åº”ä½ç½®è¯·ç”¨ NixOS config æ¥è¦†å†™ï¼‰ä¸­ HandlePowerKey,HandleLidSwitch çš„é…ç½®ã€‚ journalctl -u systemd-logind æŸ¥çœ‹è§¦å‘äº‹ä»¶æ—¶é—´ç‚¹ï¼›é€šå¸¸æŒ‰é”®ä¼šä»¥ D-Bus äº‹ä»¶æˆ– ACPI äº‹ä»¶å…¥æ—¥å¿—ã€‚ è‹¥æŸæ¡Œé¢ç¯å¢ƒæˆ–åº”ç”¨æ‹¦æˆªäº†æŒ‰é”®ï¼Œä¼šé˜»æ­¢ logind è¡Œä¸ºã€‚å¯ä»¥é€šè¿‡ busctl monitor ç›‘å¬org.freedesktop.login1 çš„æ¶ˆæ¯ï¼Œçœ‹æ˜¯å¦æ”¶åˆ°è¯·æ±‚ã€‚ è‹¥éœ€è¦ç›‘æ§ logind åœ¨ç™»å½•/ç™»å‡ºæ—¶åšäº†ä»€ä¹ˆï¼Œå¯ä»¥ç”¨busctl monitor --system org.freedesktop.login1 æˆ–ï¼š bash sudo dbus-monitor --system \"interface='org.freedesktop.login1.Manager'\" è¿™èƒ½è§‚å¯Ÿåˆ° session åˆ›å»ºã€ç§»é™¤ã€seat åˆ†é…ã€é”å±è¯·æ±‚ç­‰ä¿¡å·ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:2:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#12-ä¼šè¯ç®¡ç†"},{"categories":["tech"],"content":" 1.2 ä¼šè¯ç®¡ç†systemd-logind æ˜¯è¿æ¥ç™»å½•ã€ä¼šè¯ã€è®¾å¤‡æƒé™å’Œç”µæºç®¡ç†çš„æ ¸å¿ƒæœåŠ¡ã€‚å®ƒé€šè¿‡ D-Bus æš´éœ² APIï¼Œç®¡ç†ç”¨æˆ·ä¼šè¯å¹¶åˆ†é…è®¾å¤‡ ACLã€‚ æ ¸å¿ƒèŒè´£ï¼š ä¼šè¯ç®¡ç†ï¼šåˆ›å»ºå’Œç»´æŠ¤ç”¨æˆ·ä¼šè¯ï¼Œæ˜ å°„ session -\u003e UID -\u003e TTY / seat è®¾å¤‡è®¿é—®ï¼šåŸºäº udev æ ‡ç­¾åˆ†é…è®¾å¤‡ ACL ç»™å½“å‰ä¼šè¯ ç”µæºç®¡ç†ï¼šå¤„ç†ç”µæºé”®äº‹ä»¶ï¼Œæ ¹æ®ç­–ç•¥è§¦å‘ suspend / shutdown å¤šåº§å¸­æ”¯æŒï¼šæ”¯æŒ seat æ¦‚å¿µï¼Œç®¡ç†å¤šç”¨æˆ·åœºæ™¯ seatï¼ˆåº§å¸­ï¼‰æ¦‚å¿µ https://www.freedesktop.org/wiki/Software/systemd/multiseat/ seatï¼ˆåº§å¸­ï¼‰æ˜¯ systemd/logind å¼•å…¥çš„æœ¯è¯­ï¼Œç”¨æ¥è¡¨ç¤ºã€Œä¸€ç»„ç‰©ç†è®¾å¤‡çš„é›†åˆã€ï¼ˆä¾‹å¦‚ä¸€ä¸ªæ˜¾ç¤ºå™¨ + ä¸€å¥—é”®ç›˜å’Œé¼ æ ‡ + éŸ³é¢‘è®¾å¤‡ï¼‰ï¼Œä»¥åŠä¸ä¹‹å…³è”çš„ä¼šè¯ã€‚ æ‰€æœ‰è®¾å¤‡é»˜è®¤éƒ½ä¼šè¢«åˆ†é…ç»™ seat0, æƒ³å†æä¸€ä¸ª seat1 å®ç°å¤šäººå›¾å½¢åŒ–ç™»å½•ï¼Œå¿…é¡»é€šè¿‡ udev è§„åˆ™å®Œæˆå¦‚ä¸‹æ“ä½œï¼š å¿…é¡»æ‹¥æœ‰ç¬¬äºŒå¼ æ˜¾å¡ï¼Œè¿™æ˜¯ç¡¬æ€§çš„å‰æï¼ä¸ºäº†è®© seat1 å®é™…å¯ç”¨ï¼Œè¿˜å¿…é¡»æ‹¥æœ‰ç¬¬äºŒå¥—é”®é¼ ä¸å£°å¡ã€‚ ç»™ç¬¬äºŒå—æ˜¾å¡å†™ udev è§„åˆ™ï¼Œæ‰“ä¸Š TAG+=\"master-of-seat\" å¹¶è®¾ç½®ENV{ID_SEAT}=\"seat1\"ã€‚ æŠŠç¬¬äºŒå¥—é”®ç›˜ã€é¼ æ ‡ã€å£°å¡ç­‰è®¾å¤‡ä¹Ÿå†™è§„åˆ™æ”¹æˆ ENV{ID_SEAT}=\"seat1\"ã€‚ é‡å¯ç³»ç»Ÿã€‚ logind ä¼šæŠŠ VT/å›¾å½¢ä¼šè¯ç»‘å®šåˆ°å…·ä½“ seatï¼Œä»è€ŒæŒ‰ seat ç²’åº¦åšç”µæºç®¡ç†ã€è®¾å¤‡è®¿é—®æ§åˆ¶ã€ç©ºé—²æ£€æµ‹ç­‰ç­–ç•¥ã€‚ è¿œç¨‹ SSH ç™»å½•ä¸ç”Ÿæˆä¹Ÿä¸å½’å±ä»»ä½• seatï¼›logind ä»…ä¸ºå…¶å»ºç«‹ä¼šè¯å¯¹è±¡ï¼Œseat å­—æ®µç•™ç©ºã€‚å› æ­¤ seat æ¦‚å¿µå¯¹ SSH å®Œå…¨é€æ˜ã€‚ æ³¨æ„ï¼šè™½ç„¶ SSH ä¼šè¯ä¸å½’å±ä»»ä½• seatï¼Œä½†è¿™ä¸å½±å“å¤§å¤šæ•°è®¾å¤‡çš„è®¿é—®ã€‚è®¾å¤‡æƒé™ç®¡ç†æœ‰ä¸¤å¥—å¹¶è¡Œçš„æœºåˆ¶ï¼šä¼ ç»Ÿçš„ Unix æƒé™æ¨¡å‹ï¼ˆåŸºäºç”¨æˆ·ç»„ï¼Œå¦‚ videoã€audioã€input ç­‰ï¼‰å’Œç°ä»£çš„ systemd-logind ACL æœºåˆ¶ï¼ˆåŸºäº seat å’Œä¼šè¯ï¼‰ã€‚SSH ä¼šè¯ä¸»è¦ä¾èµ–å‰è€…ï¼Œå› æ­¤åªè¦ç”¨æˆ·å…·æœ‰ç›¸åº”çš„è®¾å¤‡æƒé™ï¼Œä»å¯æ­£å¸¸è®¿é—® GPUã€å£°å¡ã€å­˜å‚¨è®¾å¤‡ç­‰ç¡¬ä»¶èµ„æºã€‚seat æœºåˆ¶ä¸»è¦å½±å“çš„æ˜¯éœ€è¦å›¾å½¢ç•Œé¢äº¤äº’çš„è®¾å¤‡ï¼ˆå¦‚æ˜¾ç¤ºå™¨ã€é”®ç›˜é¼ æ ‡ï¼‰çš„è®¿é—®æ§åˆ¶ã€‚ ç°ä»£ Linux æ¡Œé¢ç³»ç»ŸåŸºæœ¬éƒ½æ˜¯å•ç”¨æˆ·ä½¿ç”¨ï¼Œå› æ­¤åç»­è®¨è®ºé»˜è®¤èšç„¦å• seat åœºæ™¯ã€‚ å¸¸ç”¨å‘½ä»¤ bash # ä¼šè¯ç®¡ç† loginctl list-sessions # åˆ—å‡ºæ‰€æœ‰ä¼šè¯ loginctl show-session -p Name -p UID -p Seat # ä¼šè¯è¯¦æƒ… loginctl terminate-session # ç»ˆæ­¢ä¼šè¯ # seat ç®¡ç† loginctl seat-status # æŸ¥çœ‹ seat çŠ¶æ€ loginctl seat-status seat0 # ç‰¹å®š seat è¯¦æƒ… # D-Bus æ¥å£è°ƒè¯• busctl --system call org.freedesktop.login1 \\ /org/freedesktop/login1 org.freedesktop.login1.Manager \\ ListSessions è®¾å¤‡æƒé™é—®é¢˜æ’æŸ¥ Wayland compositor å¯åŠ¨ä½†æ— æ³•æ‰“å¼€ /dev/dri/card0ï¼ˆGPU æƒé™é—®é¢˜ï¼‰æ’æŸ¥ï¼š ç¡®è®¤ ls -l /dev/dri/card0 çš„ owner/groupã€‚é€šå¸¸åº”ä¸º root:videoï¼Œå¹¶ä¸”å½“å‰ä¼šè¯åº”è¢«æˆäºˆè®¾å¤‡ ACLã€‚ loginctl seat-status seat0 æŸ¥çœ‹æ˜¯å¦åˆ—å‡º /dev/dri/card0 å¹¶æ˜¾ç¤º ACL ç»™å½“å‰ sessionã€‚ è‹¥æ— ï¼Œé€šè¿‡ udevadm info /dev/dri/card0 æ£€æŸ¥ udev æ˜¯å¦ä¸º GPU è®¾å¤‡æ‰“ä¸Šäº†TAG+=\"uaccess\" æˆ– TAG+=\"seat\"ã€‚ æŸ¥çœ‹ journalctl -u systemd-logindï¼Œçœ‹æ˜¯å¦åœ¨ç”¨æˆ·ç™»å½•æ—¶æœ‰å…³äºè®¾å¤‡åˆ†é…çš„é”™è¯¯ã€‚ è‹¥æœåŠ¡æ˜¯ä»¥ system user çš„æ–¹å¼å¯åŠ¨ï¼Œç¡®ä¿ compositor çš„è¿›ç¨‹æ˜¯åœ¨ç”¨æˆ· session ä¸‹ï¼Œè€Œä¸æ˜¯ systemd æœåŠ¡æˆ– root å¯åŠ¨çš„è¿›ç¨‹ï¼ˆèµ·è¿›ç¨‹èº«ä»½ä¸åŒä¼šå¯¼è‡´æƒé™é—®é¢˜ï¼‰ã€‚ æ„å¤–æŒ‚èµ·/å…³æœºï¼ˆç”µæºé”®/ç¡çœ æŒ‰é’®ä¸æŒ‰ç”¨æˆ·è®¾ç½®å·¥ä½œï¼‰ æ£€æŸ¥ logind.confï¼ˆNixOS å¯¹åº”ä½ç½®è¯·ç”¨ NixOS config æ¥è¦†å†™ï¼‰ä¸­ HandlePowerKey,HandleLidSwitch çš„é…ç½®ã€‚ journalctl -u systemd-logind æŸ¥çœ‹è§¦å‘äº‹ä»¶æ—¶é—´ç‚¹ï¼›é€šå¸¸æŒ‰é”®ä¼šä»¥ D-Bus äº‹ä»¶æˆ– ACPI äº‹ä»¶å…¥æ—¥å¿—ã€‚ è‹¥æŸæ¡Œé¢ç¯å¢ƒæˆ–åº”ç”¨æ‹¦æˆªäº†æŒ‰é”®ï¼Œä¼šé˜»æ­¢ logind è¡Œä¸ºã€‚å¯ä»¥é€šè¿‡ busctl monitor ç›‘å¬org.freedesktop.login1 çš„æ¶ˆæ¯ï¼Œçœ‹æ˜¯å¦æ”¶åˆ°è¯·æ±‚ã€‚ è‹¥éœ€è¦ç›‘æ§ logind åœ¨ç™»å½•/ç™»å‡ºæ—¶åšäº†ä»€ä¹ˆï¼Œå¯ä»¥ç”¨busctl monitor --system org.freedesktop.login1 æˆ–ï¼š bash sudo dbus-monitor --system \"interface='org.freedesktop.login1.Manager'\" è¿™èƒ½è§‚å¯Ÿåˆ° session åˆ›å»ºã€ç§»é™¤ã€seat åˆ†é…ã€é”å±è¯·æ±‚ç­‰ä¿¡å·ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:2:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#seatåº§å¸­æ¦‚å¿µ"},{"categories":["tech"],"content":" 1.2 ä¼šè¯ç®¡ç†systemd-logind æ˜¯è¿æ¥ç™»å½•ã€ä¼šè¯ã€è®¾å¤‡æƒé™å’Œç”µæºç®¡ç†çš„æ ¸å¿ƒæœåŠ¡ã€‚å®ƒé€šè¿‡ D-Bus æš´éœ² APIï¼Œç®¡ç†ç”¨æˆ·ä¼šè¯å¹¶åˆ†é…è®¾å¤‡ ACLã€‚ æ ¸å¿ƒèŒè´£ï¼š ä¼šè¯ç®¡ç†ï¼šåˆ›å»ºå’Œç»´æŠ¤ç”¨æˆ·ä¼šè¯ï¼Œæ˜ å°„ session -\u003e UID -\u003e TTY / seat è®¾å¤‡è®¿é—®ï¼šåŸºäº udev æ ‡ç­¾åˆ†é…è®¾å¤‡ ACL ç»™å½“å‰ä¼šè¯ ç”µæºç®¡ç†ï¼šå¤„ç†ç”µæºé”®äº‹ä»¶ï¼Œæ ¹æ®ç­–ç•¥è§¦å‘ suspend / shutdown å¤šåº§å¸­æ”¯æŒï¼šæ”¯æŒ seat æ¦‚å¿µï¼Œç®¡ç†å¤šç”¨æˆ·åœºæ™¯ seatï¼ˆåº§å¸­ï¼‰æ¦‚å¿µ https://www.freedesktop.org/wiki/Software/systemd/multiseat/ seatï¼ˆåº§å¸­ï¼‰æ˜¯ systemd/logind å¼•å…¥çš„æœ¯è¯­ï¼Œç”¨æ¥è¡¨ç¤ºã€Œä¸€ç»„ç‰©ç†è®¾å¤‡çš„é›†åˆã€ï¼ˆä¾‹å¦‚ä¸€ä¸ªæ˜¾ç¤ºå™¨ + ä¸€å¥—é”®ç›˜å’Œé¼ æ ‡ + éŸ³é¢‘è®¾å¤‡ï¼‰ï¼Œä»¥åŠä¸ä¹‹å…³è”çš„ä¼šè¯ã€‚ æ‰€æœ‰è®¾å¤‡é»˜è®¤éƒ½ä¼šè¢«åˆ†é…ç»™ seat0, æƒ³å†æä¸€ä¸ª seat1 å®ç°å¤šäººå›¾å½¢åŒ–ç™»å½•ï¼Œå¿…é¡»é€šè¿‡ udev è§„åˆ™å®Œæˆå¦‚ä¸‹æ“ä½œï¼š å¿…é¡»æ‹¥æœ‰ç¬¬äºŒå¼ æ˜¾å¡ï¼Œè¿™æ˜¯ç¡¬æ€§çš„å‰æï¼ä¸ºäº†è®© seat1 å®é™…å¯ç”¨ï¼Œè¿˜å¿…é¡»æ‹¥æœ‰ç¬¬äºŒå¥—é”®é¼ ä¸å£°å¡ã€‚ ç»™ç¬¬äºŒå—æ˜¾å¡å†™ udev è§„åˆ™ï¼Œæ‰“ä¸Š TAG+=\"master-of-seat\" å¹¶è®¾ç½®ENV{ID_SEAT}=\"seat1\"ã€‚ æŠŠç¬¬äºŒå¥—é”®ç›˜ã€é¼ æ ‡ã€å£°å¡ç­‰è®¾å¤‡ä¹Ÿå†™è§„åˆ™æ”¹æˆ ENV{ID_SEAT}=\"seat1\"ã€‚ é‡å¯ç³»ç»Ÿã€‚ logind ä¼šæŠŠ VT/å›¾å½¢ä¼šè¯ç»‘å®šåˆ°å…·ä½“ seatï¼Œä»è€ŒæŒ‰ seat ç²’åº¦åšç”µæºç®¡ç†ã€è®¾å¤‡è®¿é—®æ§åˆ¶ã€ç©ºé—²æ£€æµ‹ç­‰ç­–ç•¥ã€‚ è¿œç¨‹ SSH ç™»å½•ä¸ç”Ÿæˆä¹Ÿä¸å½’å±ä»»ä½• seatï¼›logind ä»…ä¸ºå…¶å»ºç«‹ä¼šè¯å¯¹è±¡ï¼Œseat å­—æ®µç•™ç©ºã€‚å› æ­¤ seat æ¦‚å¿µå¯¹ SSH å®Œå…¨é€æ˜ã€‚ æ³¨æ„ï¼šè™½ç„¶ SSH ä¼šè¯ä¸å½’å±ä»»ä½• seatï¼Œä½†è¿™ä¸å½±å“å¤§å¤šæ•°è®¾å¤‡çš„è®¿é—®ã€‚è®¾å¤‡æƒé™ç®¡ç†æœ‰ä¸¤å¥—å¹¶è¡Œçš„æœºåˆ¶ï¼šä¼ ç»Ÿçš„ Unix æƒé™æ¨¡å‹ï¼ˆåŸºäºç”¨æˆ·ç»„ï¼Œå¦‚ videoã€audioã€input ç­‰ï¼‰å’Œç°ä»£çš„ systemd-logind ACL æœºåˆ¶ï¼ˆåŸºäº seat å’Œä¼šè¯ï¼‰ã€‚SSH ä¼šè¯ä¸»è¦ä¾èµ–å‰è€…ï¼Œå› æ­¤åªè¦ç”¨æˆ·å…·æœ‰ç›¸åº”çš„è®¾å¤‡æƒé™ï¼Œä»å¯æ­£å¸¸è®¿é—® GPUã€å£°å¡ã€å­˜å‚¨è®¾å¤‡ç­‰ç¡¬ä»¶èµ„æºã€‚seat æœºåˆ¶ä¸»è¦å½±å“çš„æ˜¯éœ€è¦å›¾å½¢ç•Œé¢äº¤äº’çš„è®¾å¤‡ï¼ˆå¦‚æ˜¾ç¤ºå™¨ã€é”®ç›˜é¼ æ ‡ï¼‰çš„è®¿é—®æ§åˆ¶ã€‚ ç°ä»£ Linux æ¡Œé¢ç³»ç»ŸåŸºæœ¬éƒ½æ˜¯å•ç”¨æˆ·ä½¿ç”¨ï¼Œå› æ­¤åç»­è®¨è®ºé»˜è®¤èšç„¦å• seat åœºæ™¯ã€‚ å¸¸ç”¨å‘½ä»¤ bash # ä¼šè¯ç®¡ç† loginctl list-sessions # åˆ—å‡ºæ‰€æœ‰ä¼šè¯ loginctl show-session -p Name -p UID -p Seat # ä¼šè¯è¯¦æƒ… loginctl terminate-session # ç»ˆæ­¢ä¼šè¯ # seat ç®¡ç† loginctl seat-status # æŸ¥çœ‹ seat çŠ¶æ€ loginctl seat-status seat0 # ç‰¹å®š seat è¯¦æƒ… # D-Bus æ¥å£è°ƒè¯• busctl --system call org.freedesktop.login1 \\ /org/freedesktop/login1 org.freedesktop.login1.Manager \\ ListSessions è®¾å¤‡æƒé™é—®é¢˜æ’æŸ¥ Wayland compositor å¯åŠ¨ä½†æ— æ³•æ‰“å¼€ /dev/dri/card0ï¼ˆGPU æƒé™é—®é¢˜ï¼‰æ’æŸ¥ï¼š ç¡®è®¤ ls -l /dev/dri/card0 çš„ owner/groupã€‚é€šå¸¸åº”ä¸º root:videoï¼Œå¹¶ä¸”å½“å‰ä¼šè¯åº”è¢«æˆäºˆè®¾å¤‡ ACLã€‚ loginctl seat-status seat0 æŸ¥çœ‹æ˜¯å¦åˆ—å‡º /dev/dri/card0 å¹¶æ˜¾ç¤º ACL ç»™å½“å‰ sessionã€‚ è‹¥æ— ï¼Œé€šè¿‡ udevadm info /dev/dri/card0 æ£€æŸ¥ udev æ˜¯å¦ä¸º GPU è®¾å¤‡æ‰“ä¸Šäº†TAG+=\"uaccess\" æˆ– TAG+=\"seat\"ã€‚ æŸ¥çœ‹ journalctl -u systemd-logindï¼Œçœ‹æ˜¯å¦åœ¨ç”¨æˆ·ç™»å½•æ—¶æœ‰å…³äºè®¾å¤‡åˆ†é…çš„é”™è¯¯ã€‚ è‹¥æœåŠ¡æ˜¯ä»¥ system user çš„æ–¹å¼å¯åŠ¨ï¼Œç¡®ä¿ compositor çš„è¿›ç¨‹æ˜¯åœ¨ç”¨æˆ· session ä¸‹ï¼Œè€Œä¸æ˜¯ systemd æœåŠ¡æˆ– root å¯åŠ¨çš„è¿›ç¨‹ï¼ˆèµ·è¿›ç¨‹èº«ä»½ä¸åŒä¼šå¯¼è‡´æƒé™é—®é¢˜ï¼‰ã€‚ æ„å¤–æŒ‚èµ·/å…³æœºï¼ˆç”µæºé”®/ç¡çœ æŒ‰é’®ä¸æŒ‰ç”¨æˆ·è®¾ç½®å·¥ä½œï¼‰ æ£€æŸ¥ logind.confï¼ˆNixOS å¯¹åº”ä½ç½®è¯·ç”¨ NixOS config æ¥è¦†å†™ï¼‰ä¸­ HandlePowerKey,HandleLidSwitch çš„é…ç½®ã€‚ journalctl -u systemd-logind æŸ¥çœ‹è§¦å‘äº‹ä»¶æ—¶é—´ç‚¹ï¼›é€šå¸¸æŒ‰é”®ä¼šä»¥ D-Bus äº‹ä»¶æˆ– ACPI äº‹ä»¶å…¥æ—¥å¿—ã€‚ è‹¥æŸæ¡Œé¢ç¯å¢ƒæˆ–åº”ç”¨æ‹¦æˆªäº†æŒ‰é”®ï¼Œä¼šé˜»æ­¢ logind è¡Œä¸ºã€‚å¯ä»¥é€šè¿‡ busctl monitor ç›‘å¬org.freedesktop.login1 çš„æ¶ˆæ¯ï¼Œçœ‹æ˜¯å¦æ”¶åˆ°è¯·æ±‚ã€‚ è‹¥éœ€è¦ç›‘æ§ logind åœ¨ç™»å½•/ç™»å‡ºæ—¶åšäº†ä»€ä¹ˆï¼Œå¯ä»¥ç”¨busctl monitor --system org.freedesktop.login1 æˆ–ï¼š bash sudo dbus-monitor --system \"interface='org.freedesktop.login1.Manager'\" è¿™èƒ½è§‚å¯Ÿåˆ° session åˆ›å»ºã€ç§»é™¤ã€seat åˆ†é…ã€é”å±è¯·æ±‚ç­‰ä¿¡å·ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:2:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#å¸¸ç”¨å‘½ä»¤"},{"categories":["tech"],"content":" 1.2 ä¼šè¯ç®¡ç†systemd-logind æ˜¯è¿æ¥ç™»å½•ã€ä¼šè¯ã€è®¾å¤‡æƒé™å’Œç”µæºç®¡ç†çš„æ ¸å¿ƒæœåŠ¡ã€‚å®ƒé€šè¿‡ D-Bus æš´éœ² APIï¼Œç®¡ç†ç”¨æˆ·ä¼šè¯å¹¶åˆ†é…è®¾å¤‡ ACLã€‚ æ ¸å¿ƒèŒè´£ï¼š ä¼šè¯ç®¡ç†ï¼šåˆ›å»ºå’Œç»´æŠ¤ç”¨æˆ·ä¼šè¯ï¼Œæ˜ å°„ session -\u003e UID -\u003e TTY / seat è®¾å¤‡è®¿é—®ï¼šåŸºäº udev æ ‡ç­¾åˆ†é…è®¾å¤‡ ACL ç»™å½“å‰ä¼šè¯ ç”µæºç®¡ç†ï¼šå¤„ç†ç”µæºé”®äº‹ä»¶ï¼Œæ ¹æ®ç­–ç•¥è§¦å‘ suspend / shutdown å¤šåº§å¸­æ”¯æŒï¼šæ”¯æŒ seat æ¦‚å¿µï¼Œç®¡ç†å¤šç”¨æˆ·åœºæ™¯ seatï¼ˆåº§å¸­ï¼‰æ¦‚å¿µ https://www.freedesktop.org/wiki/Software/systemd/multiseat/ seatï¼ˆåº§å¸­ï¼‰æ˜¯ systemd/logind å¼•å…¥çš„æœ¯è¯­ï¼Œç”¨æ¥è¡¨ç¤ºã€Œä¸€ç»„ç‰©ç†è®¾å¤‡çš„é›†åˆã€ï¼ˆä¾‹å¦‚ä¸€ä¸ªæ˜¾ç¤ºå™¨ + ä¸€å¥—é”®ç›˜å’Œé¼ æ ‡ + éŸ³é¢‘è®¾å¤‡ï¼‰ï¼Œä»¥åŠä¸ä¹‹å…³è”çš„ä¼šè¯ã€‚ æ‰€æœ‰è®¾å¤‡é»˜è®¤éƒ½ä¼šè¢«åˆ†é…ç»™ seat0, æƒ³å†æä¸€ä¸ª seat1 å®ç°å¤šäººå›¾å½¢åŒ–ç™»å½•ï¼Œå¿…é¡»é€šè¿‡ udev è§„åˆ™å®Œæˆå¦‚ä¸‹æ“ä½œï¼š å¿…é¡»æ‹¥æœ‰ç¬¬äºŒå¼ æ˜¾å¡ï¼Œè¿™æ˜¯ç¡¬æ€§çš„å‰æï¼ä¸ºäº†è®© seat1 å®é™…å¯ç”¨ï¼Œè¿˜å¿…é¡»æ‹¥æœ‰ç¬¬äºŒå¥—é”®é¼ ä¸å£°å¡ã€‚ ç»™ç¬¬äºŒå—æ˜¾å¡å†™ udev è§„åˆ™ï¼Œæ‰“ä¸Š TAG+=\"master-of-seat\" å¹¶è®¾ç½®ENV{ID_SEAT}=\"seat1\"ã€‚ æŠŠç¬¬äºŒå¥—é”®ç›˜ã€é¼ æ ‡ã€å£°å¡ç­‰è®¾å¤‡ä¹Ÿå†™è§„åˆ™æ”¹æˆ ENV{ID_SEAT}=\"seat1\"ã€‚ é‡å¯ç³»ç»Ÿã€‚ logind ä¼šæŠŠ VT/å›¾å½¢ä¼šè¯ç»‘å®šåˆ°å…·ä½“ seatï¼Œä»è€ŒæŒ‰ seat ç²’åº¦åšç”µæºç®¡ç†ã€è®¾å¤‡è®¿é—®æ§åˆ¶ã€ç©ºé—²æ£€æµ‹ç­‰ç­–ç•¥ã€‚ è¿œç¨‹ SSH ç™»å½•ä¸ç”Ÿæˆä¹Ÿä¸å½’å±ä»»ä½• seatï¼›logind ä»…ä¸ºå…¶å»ºç«‹ä¼šè¯å¯¹è±¡ï¼Œseat å­—æ®µç•™ç©ºã€‚å› æ­¤ seat æ¦‚å¿µå¯¹ SSH å®Œå…¨é€æ˜ã€‚ æ³¨æ„ï¼šè™½ç„¶ SSH ä¼šè¯ä¸å½’å±ä»»ä½• seatï¼Œä½†è¿™ä¸å½±å“å¤§å¤šæ•°è®¾å¤‡çš„è®¿é—®ã€‚è®¾å¤‡æƒé™ç®¡ç†æœ‰ä¸¤å¥—å¹¶è¡Œçš„æœºåˆ¶ï¼šä¼ ç»Ÿçš„ Unix æƒé™æ¨¡å‹ï¼ˆåŸºäºç”¨æˆ·ç»„ï¼Œå¦‚ videoã€audioã€input ç­‰ï¼‰å’Œç°ä»£çš„ systemd-logind ACL æœºåˆ¶ï¼ˆåŸºäº seat å’Œä¼šè¯ï¼‰ã€‚SSH ä¼šè¯ä¸»è¦ä¾èµ–å‰è€…ï¼Œå› æ­¤åªè¦ç”¨æˆ·å…·æœ‰ç›¸åº”çš„è®¾å¤‡æƒé™ï¼Œä»å¯æ­£å¸¸è®¿é—® GPUã€å£°å¡ã€å­˜å‚¨è®¾å¤‡ç­‰ç¡¬ä»¶èµ„æºã€‚seat æœºåˆ¶ä¸»è¦å½±å“çš„æ˜¯éœ€è¦å›¾å½¢ç•Œé¢äº¤äº’çš„è®¾å¤‡ï¼ˆå¦‚æ˜¾ç¤ºå™¨ã€é”®ç›˜é¼ æ ‡ï¼‰çš„è®¿é—®æ§åˆ¶ã€‚ ç°ä»£ Linux æ¡Œé¢ç³»ç»ŸåŸºæœ¬éƒ½æ˜¯å•ç”¨æˆ·ä½¿ç”¨ï¼Œå› æ­¤åç»­è®¨è®ºé»˜è®¤èšç„¦å• seat åœºæ™¯ã€‚ å¸¸ç”¨å‘½ä»¤ bash # ä¼šè¯ç®¡ç† loginctl list-sessions # åˆ—å‡ºæ‰€æœ‰ä¼šè¯ loginctl show-session -p Name -p UID -p Seat # ä¼šè¯è¯¦æƒ… loginctl terminate-session # ç»ˆæ­¢ä¼šè¯ # seat ç®¡ç† loginctl seat-status # æŸ¥çœ‹ seat çŠ¶æ€ loginctl seat-status seat0 # ç‰¹å®š seat è¯¦æƒ… # D-Bus æ¥å£è°ƒè¯• busctl --system call org.freedesktop.login1 \\ /org/freedesktop/login1 org.freedesktop.login1.Manager \\ ListSessions è®¾å¤‡æƒé™é—®é¢˜æ’æŸ¥ Wayland compositor å¯åŠ¨ä½†æ— æ³•æ‰“å¼€ /dev/dri/card0ï¼ˆGPU æƒé™é—®é¢˜ï¼‰æ’æŸ¥ï¼š ç¡®è®¤ ls -l /dev/dri/card0 çš„ owner/groupã€‚é€šå¸¸åº”ä¸º root:videoï¼Œå¹¶ä¸”å½“å‰ä¼šè¯åº”è¢«æˆäºˆè®¾å¤‡ ACLã€‚ loginctl seat-status seat0 æŸ¥çœ‹æ˜¯å¦åˆ—å‡º /dev/dri/card0 å¹¶æ˜¾ç¤º ACL ç»™å½“å‰ sessionã€‚ è‹¥æ— ï¼Œé€šè¿‡ udevadm info /dev/dri/card0 æ£€æŸ¥ udev æ˜¯å¦ä¸º GPU è®¾å¤‡æ‰“ä¸Šäº†TAG+=\"uaccess\" æˆ– TAG+=\"seat\"ã€‚ æŸ¥çœ‹ journalctl -u systemd-logindï¼Œçœ‹æ˜¯å¦åœ¨ç”¨æˆ·ç™»å½•æ—¶æœ‰å…³äºè®¾å¤‡åˆ†é…çš„é”™è¯¯ã€‚ è‹¥æœåŠ¡æ˜¯ä»¥ system user çš„æ–¹å¼å¯åŠ¨ï¼Œç¡®ä¿ compositor çš„è¿›ç¨‹æ˜¯åœ¨ç”¨æˆ· session ä¸‹ï¼Œè€Œä¸æ˜¯ systemd æœåŠ¡æˆ– root å¯åŠ¨çš„è¿›ç¨‹ï¼ˆèµ·è¿›ç¨‹èº«ä»½ä¸åŒä¼šå¯¼è‡´æƒé™é—®é¢˜ï¼‰ã€‚ æ„å¤–æŒ‚èµ·/å…³æœºï¼ˆç”µæºé”®/ç¡çœ æŒ‰é’®ä¸æŒ‰ç”¨æˆ·è®¾ç½®å·¥ä½œï¼‰ æ£€æŸ¥ logind.confï¼ˆNixOS å¯¹åº”ä½ç½®è¯·ç”¨ NixOS config æ¥è¦†å†™ï¼‰ä¸­ HandlePowerKey,HandleLidSwitch çš„é…ç½®ã€‚ journalctl -u systemd-logind æŸ¥çœ‹è§¦å‘äº‹ä»¶æ—¶é—´ç‚¹ï¼›é€šå¸¸æŒ‰é”®ä¼šä»¥ D-Bus äº‹ä»¶æˆ– ACPI äº‹ä»¶å…¥æ—¥å¿—ã€‚ è‹¥æŸæ¡Œé¢ç¯å¢ƒæˆ–åº”ç”¨æ‹¦æˆªäº†æŒ‰é”®ï¼Œä¼šé˜»æ­¢ logind è¡Œä¸ºã€‚å¯ä»¥é€šè¿‡ busctl monitor ç›‘å¬org.freedesktop.login1 çš„æ¶ˆæ¯ï¼Œçœ‹æ˜¯å¦æ”¶åˆ°è¯·æ±‚ã€‚ è‹¥éœ€è¦ç›‘æ§ logind åœ¨ç™»å½•/ç™»å‡ºæ—¶åšäº†ä»€ä¹ˆï¼Œå¯ä»¥ç”¨busctl monitor --system org.freedesktop.login1 æˆ–ï¼š bash sudo dbus-monitor --system \"interface='org.freedesktop.login1.Manager'\" è¿™èƒ½è§‚å¯Ÿåˆ° session åˆ›å»ºã€ç§»é™¤ã€seat åˆ†é…ã€é”å±è¯·æ±‚ç­‰ä¿¡å·ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:2:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#è®¾å¤‡æƒé™é—®é¢˜æ’æŸ¥"},{"categories":["tech"],"content":" 1.2 ä¼šè¯ç®¡ç†systemd-logind æ˜¯è¿æ¥ç™»å½•ã€ä¼šè¯ã€è®¾å¤‡æƒé™å’Œç”µæºç®¡ç†çš„æ ¸å¿ƒæœåŠ¡ã€‚å®ƒé€šè¿‡ D-Bus æš´éœ² APIï¼Œç®¡ç†ç”¨æˆ·ä¼šè¯å¹¶åˆ†é…è®¾å¤‡ ACLã€‚ æ ¸å¿ƒèŒè´£ï¼š ä¼šè¯ç®¡ç†ï¼šåˆ›å»ºå’Œç»´æŠ¤ç”¨æˆ·ä¼šè¯ï¼Œæ˜ å°„ session -\u003e UID -\u003e TTY / seat è®¾å¤‡è®¿é—®ï¼šåŸºäº udev æ ‡ç­¾åˆ†é…è®¾å¤‡ ACL ç»™å½“å‰ä¼šè¯ ç”µæºç®¡ç†ï¼šå¤„ç†ç”µæºé”®äº‹ä»¶ï¼Œæ ¹æ®ç­–ç•¥è§¦å‘ suspend / shutdown å¤šåº§å¸­æ”¯æŒï¼šæ”¯æŒ seat æ¦‚å¿µï¼Œç®¡ç†å¤šç”¨æˆ·åœºæ™¯ seatï¼ˆåº§å¸­ï¼‰æ¦‚å¿µ https://www.freedesktop.org/wiki/Software/systemd/multiseat/ seatï¼ˆåº§å¸­ï¼‰æ˜¯ systemd/logind å¼•å…¥çš„æœ¯è¯­ï¼Œç”¨æ¥è¡¨ç¤ºã€Œä¸€ç»„ç‰©ç†è®¾å¤‡çš„é›†åˆã€ï¼ˆä¾‹å¦‚ä¸€ä¸ªæ˜¾ç¤ºå™¨ + ä¸€å¥—é”®ç›˜å’Œé¼ æ ‡ + éŸ³é¢‘è®¾å¤‡ï¼‰ï¼Œä»¥åŠä¸ä¹‹å…³è”çš„ä¼šè¯ã€‚ æ‰€æœ‰è®¾å¤‡é»˜è®¤éƒ½ä¼šè¢«åˆ†é…ç»™ seat0, æƒ³å†æä¸€ä¸ª seat1 å®ç°å¤šäººå›¾å½¢åŒ–ç™»å½•ï¼Œå¿…é¡»é€šè¿‡ udev è§„åˆ™å®Œæˆå¦‚ä¸‹æ“ä½œï¼š å¿…é¡»æ‹¥æœ‰ç¬¬äºŒå¼ æ˜¾å¡ï¼Œè¿™æ˜¯ç¡¬æ€§çš„å‰æï¼ä¸ºäº†è®© seat1 å®é™…å¯ç”¨ï¼Œè¿˜å¿…é¡»æ‹¥æœ‰ç¬¬äºŒå¥—é”®é¼ ä¸å£°å¡ã€‚ ç»™ç¬¬äºŒå—æ˜¾å¡å†™ udev è§„åˆ™ï¼Œæ‰“ä¸Š TAG+=\"master-of-seat\" å¹¶è®¾ç½®ENV{ID_SEAT}=\"seat1\"ã€‚ æŠŠç¬¬äºŒå¥—é”®ç›˜ã€é¼ æ ‡ã€å£°å¡ç­‰è®¾å¤‡ä¹Ÿå†™è§„åˆ™æ”¹æˆ ENV{ID_SEAT}=\"seat1\"ã€‚ é‡å¯ç³»ç»Ÿã€‚ logind ä¼šæŠŠ VT/å›¾å½¢ä¼šè¯ç»‘å®šåˆ°å…·ä½“ seatï¼Œä»è€ŒæŒ‰ seat ç²’åº¦åšç”µæºç®¡ç†ã€è®¾å¤‡è®¿é—®æ§åˆ¶ã€ç©ºé—²æ£€æµ‹ç­‰ç­–ç•¥ã€‚ è¿œç¨‹ SSH ç™»å½•ä¸ç”Ÿæˆä¹Ÿä¸å½’å±ä»»ä½• seatï¼›logind ä»…ä¸ºå…¶å»ºç«‹ä¼šè¯å¯¹è±¡ï¼Œseat å­—æ®µç•™ç©ºã€‚å› æ­¤ seat æ¦‚å¿µå¯¹ SSH å®Œå…¨é€æ˜ã€‚ æ³¨æ„ï¼šè™½ç„¶ SSH ä¼šè¯ä¸å½’å±ä»»ä½• seatï¼Œä½†è¿™ä¸å½±å“å¤§å¤šæ•°è®¾å¤‡çš„è®¿é—®ã€‚è®¾å¤‡æƒé™ç®¡ç†æœ‰ä¸¤å¥—å¹¶è¡Œçš„æœºåˆ¶ï¼šä¼ ç»Ÿçš„ Unix æƒé™æ¨¡å‹ï¼ˆåŸºäºç”¨æˆ·ç»„ï¼Œå¦‚ videoã€audioã€input ç­‰ï¼‰å’Œç°ä»£çš„ systemd-logind ACL æœºåˆ¶ï¼ˆåŸºäº seat å’Œä¼šè¯ï¼‰ã€‚SSH ä¼šè¯ä¸»è¦ä¾èµ–å‰è€…ï¼Œå› æ­¤åªè¦ç”¨æˆ·å…·æœ‰ç›¸åº”çš„è®¾å¤‡æƒé™ï¼Œä»å¯æ­£å¸¸è®¿é—® GPUã€å£°å¡ã€å­˜å‚¨è®¾å¤‡ç­‰ç¡¬ä»¶èµ„æºã€‚seat æœºåˆ¶ä¸»è¦å½±å“çš„æ˜¯éœ€è¦å›¾å½¢ç•Œé¢äº¤äº’çš„è®¾å¤‡ï¼ˆå¦‚æ˜¾ç¤ºå™¨ã€é”®ç›˜é¼ æ ‡ï¼‰çš„è®¿é—®æ§åˆ¶ã€‚ ç°ä»£ Linux æ¡Œé¢ç³»ç»ŸåŸºæœ¬éƒ½æ˜¯å•ç”¨æˆ·ä½¿ç”¨ï¼Œå› æ­¤åç»­è®¨è®ºé»˜è®¤èšç„¦å• seat åœºæ™¯ã€‚ å¸¸ç”¨å‘½ä»¤ bash # ä¼šè¯ç®¡ç† loginctl list-sessions # åˆ—å‡ºæ‰€æœ‰ä¼šè¯ loginctl show-session -p Name -p UID -p Seat # ä¼šè¯è¯¦æƒ… loginctl terminate-session # ç»ˆæ­¢ä¼šè¯ # seat ç®¡ç† loginctl seat-status # æŸ¥çœ‹ seat çŠ¶æ€ loginctl seat-status seat0 # ç‰¹å®š seat è¯¦æƒ… # D-Bus æ¥å£è°ƒè¯• busctl --system call org.freedesktop.login1 \\ /org/freedesktop/login1 org.freedesktop.login1.Manager \\ ListSessions è®¾å¤‡æƒé™é—®é¢˜æ’æŸ¥ Wayland compositor å¯åŠ¨ä½†æ— æ³•æ‰“å¼€ /dev/dri/card0ï¼ˆGPU æƒé™é—®é¢˜ï¼‰æ’æŸ¥ï¼š ç¡®è®¤ ls -l /dev/dri/card0 çš„ owner/groupã€‚é€šå¸¸åº”ä¸º root:videoï¼Œå¹¶ä¸”å½“å‰ä¼šè¯åº”è¢«æˆäºˆè®¾å¤‡ ACLã€‚ loginctl seat-status seat0 æŸ¥çœ‹æ˜¯å¦åˆ—å‡º /dev/dri/card0 å¹¶æ˜¾ç¤º ACL ç»™å½“å‰ sessionã€‚ è‹¥æ— ï¼Œé€šè¿‡ udevadm info /dev/dri/card0 æ£€æŸ¥ udev æ˜¯å¦ä¸º GPU è®¾å¤‡æ‰“ä¸Šäº†TAG+=\"uaccess\" æˆ– TAG+=\"seat\"ã€‚ æŸ¥çœ‹ journalctl -u systemd-logindï¼Œçœ‹æ˜¯å¦åœ¨ç”¨æˆ·ç™»å½•æ—¶æœ‰å…³äºè®¾å¤‡åˆ†é…çš„é”™è¯¯ã€‚ è‹¥æœåŠ¡æ˜¯ä»¥ system user çš„æ–¹å¼å¯åŠ¨ï¼Œç¡®ä¿ compositor çš„è¿›ç¨‹æ˜¯åœ¨ç”¨æˆ· session ä¸‹ï¼Œè€Œä¸æ˜¯ systemd æœåŠ¡æˆ– root å¯åŠ¨çš„è¿›ç¨‹ï¼ˆèµ·è¿›ç¨‹èº«ä»½ä¸åŒä¼šå¯¼è‡´æƒé™é—®é¢˜ï¼‰ã€‚ æ„å¤–æŒ‚èµ·/å…³æœºï¼ˆç”µæºé”®/ç¡çœ æŒ‰é’®ä¸æŒ‰ç”¨æˆ·è®¾ç½®å·¥ä½œï¼‰ æ£€æŸ¥ logind.confï¼ˆNixOS å¯¹åº”ä½ç½®è¯·ç”¨ NixOS config æ¥è¦†å†™ï¼‰ä¸­ HandlePowerKey,HandleLidSwitch çš„é…ç½®ã€‚ journalctl -u systemd-logind æŸ¥çœ‹è§¦å‘äº‹ä»¶æ—¶é—´ç‚¹ï¼›é€šå¸¸æŒ‰é”®ä¼šä»¥ D-Bus äº‹ä»¶æˆ– ACPI äº‹ä»¶å…¥æ—¥å¿—ã€‚ è‹¥æŸæ¡Œé¢ç¯å¢ƒæˆ–åº”ç”¨æ‹¦æˆªäº†æŒ‰é”®ï¼Œä¼šé˜»æ­¢ logind è¡Œä¸ºã€‚å¯ä»¥é€šè¿‡ busctl monitor ç›‘å¬org.freedesktop.login1 çš„æ¶ˆæ¯ï¼Œçœ‹æ˜¯å¦æ”¶åˆ°è¯·æ±‚ã€‚ è‹¥éœ€è¦ç›‘æ§ logind åœ¨ç™»å½•/ç™»å‡ºæ—¶åšäº†ä»€ä¹ˆï¼Œå¯ä»¥ç”¨busctl monitor --system org.freedesktop.login1 æˆ–ï¼š bash sudo dbus-monitor --system \"interface='org.freedesktop.login1.Manager'\" è¿™èƒ½è§‚å¯Ÿåˆ° session åˆ›å»ºã€ç§»é™¤ã€seat åˆ†é…ã€é”å±è¯·æ±‚ç­‰ä¿¡å·ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:2:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#wayland-compositor-å¯åŠ¨ä½†æ— æ³•æ‰“å¼€"},{"categories":["tech"],"content":" 1.2 ä¼šè¯ç®¡ç†systemd-logind æ˜¯è¿æ¥ç™»å½•ã€ä¼šè¯ã€è®¾å¤‡æƒé™å’Œç”µæºç®¡ç†çš„æ ¸å¿ƒæœåŠ¡ã€‚å®ƒé€šè¿‡ D-Bus æš´éœ² APIï¼Œç®¡ç†ç”¨æˆ·ä¼šè¯å¹¶åˆ†é…è®¾å¤‡ ACLã€‚ æ ¸å¿ƒèŒè´£ï¼š ä¼šè¯ç®¡ç†ï¼šåˆ›å»ºå’Œç»´æŠ¤ç”¨æˆ·ä¼šè¯ï¼Œæ˜ å°„ session -\u003e UID -\u003e TTY / seat è®¾å¤‡è®¿é—®ï¼šåŸºäº udev æ ‡ç­¾åˆ†é…è®¾å¤‡ ACL ç»™å½“å‰ä¼šè¯ ç”µæºç®¡ç†ï¼šå¤„ç†ç”µæºé”®äº‹ä»¶ï¼Œæ ¹æ®ç­–ç•¥è§¦å‘ suspend / shutdown å¤šåº§å¸­æ”¯æŒï¼šæ”¯æŒ seat æ¦‚å¿µï¼Œç®¡ç†å¤šç”¨æˆ·åœºæ™¯ seatï¼ˆåº§å¸­ï¼‰æ¦‚å¿µ https://www.freedesktop.org/wiki/Software/systemd/multiseat/ seatï¼ˆåº§å¸­ï¼‰æ˜¯ systemd/logind å¼•å…¥çš„æœ¯è¯­ï¼Œç”¨æ¥è¡¨ç¤ºã€Œä¸€ç»„ç‰©ç†è®¾å¤‡çš„é›†åˆã€ï¼ˆä¾‹å¦‚ä¸€ä¸ªæ˜¾ç¤ºå™¨ + ä¸€å¥—é”®ç›˜å’Œé¼ æ ‡ + éŸ³é¢‘è®¾å¤‡ï¼‰ï¼Œä»¥åŠä¸ä¹‹å…³è”çš„ä¼šè¯ã€‚ æ‰€æœ‰è®¾å¤‡é»˜è®¤éƒ½ä¼šè¢«åˆ†é…ç»™ seat0, æƒ³å†æä¸€ä¸ª seat1 å®ç°å¤šäººå›¾å½¢åŒ–ç™»å½•ï¼Œå¿…é¡»é€šè¿‡ udev è§„åˆ™å®Œæˆå¦‚ä¸‹æ“ä½œï¼š å¿…é¡»æ‹¥æœ‰ç¬¬äºŒå¼ æ˜¾å¡ï¼Œè¿™æ˜¯ç¡¬æ€§çš„å‰æï¼ä¸ºäº†è®© seat1 å®é™…å¯ç”¨ï¼Œè¿˜å¿…é¡»æ‹¥æœ‰ç¬¬äºŒå¥—é”®é¼ ä¸å£°å¡ã€‚ ç»™ç¬¬äºŒå—æ˜¾å¡å†™ udev è§„åˆ™ï¼Œæ‰“ä¸Š TAG+=\"master-of-seat\" å¹¶è®¾ç½®ENV{ID_SEAT}=\"seat1\"ã€‚ æŠŠç¬¬äºŒå¥—é”®ç›˜ã€é¼ æ ‡ã€å£°å¡ç­‰è®¾å¤‡ä¹Ÿå†™è§„åˆ™æ”¹æˆ ENV{ID_SEAT}=\"seat1\"ã€‚ é‡å¯ç³»ç»Ÿã€‚ logind ä¼šæŠŠ VT/å›¾å½¢ä¼šè¯ç»‘å®šåˆ°å…·ä½“ seatï¼Œä»è€ŒæŒ‰ seat ç²’åº¦åšç”µæºç®¡ç†ã€è®¾å¤‡è®¿é—®æ§åˆ¶ã€ç©ºé—²æ£€æµ‹ç­‰ç­–ç•¥ã€‚ è¿œç¨‹ SSH ç™»å½•ä¸ç”Ÿæˆä¹Ÿä¸å½’å±ä»»ä½• seatï¼›logind ä»…ä¸ºå…¶å»ºç«‹ä¼šè¯å¯¹è±¡ï¼Œseat å­—æ®µç•™ç©ºã€‚å› æ­¤ seat æ¦‚å¿µå¯¹ SSH å®Œå…¨é€æ˜ã€‚ æ³¨æ„ï¼šè™½ç„¶ SSH ä¼šè¯ä¸å½’å±ä»»ä½• seatï¼Œä½†è¿™ä¸å½±å“å¤§å¤šæ•°è®¾å¤‡çš„è®¿é—®ã€‚è®¾å¤‡æƒé™ç®¡ç†æœ‰ä¸¤å¥—å¹¶è¡Œçš„æœºåˆ¶ï¼šä¼ ç»Ÿçš„ Unix æƒé™æ¨¡å‹ï¼ˆåŸºäºç”¨æˆ·ç»„ï¼Œå¦‚ videoã€audioã€input ç­‰ï¼‰å’Œç°ä»£çš„ systemd-logind ACL æœºåˆ¶ï¼ˆåŸºäº seat å’Œä¼šè¯ï¼‰ã€‚SSH ä¼šè¯ä¸»è¦ä¾èµ–å‰è€…ï¼Œå› æ­¤åªè¦ç”¨æˆ·å…·æœ‰ç›¸åº”çš„è®¾å¤‡æƒé™ï¼Œä»å¯æ­£å¸¸è®¿é—® GPUã€å£°å¡ã€å­˜å‚¨è®¾å¤‡ç­‰ç¡¬ä»¶èµ„æºã€‚seat æœºåˆ¶ä¸»è¦å½±å“çš„æ˜¯éœ€è¦å›¾å½¢ç•Œé¢äº¤äº’çš„è®¾å¤‡ï¼ˆå¦‚æ˜¾ç¤ºå™¨ã€é”®ç›˜é¼ æ ‡ï¼‰çš„è®¿é—®æ§åˆ¶ã€‚ ç°ä»£ Linux æ¡Œé¢ç³»ç»ŸåŸºæœ¬éƒ½æ˜¯å•ç”¨æˆ·ä½¿ç”¨ï¼Œå› æ­¤åç»­è®¨è®ºé»˜è®¤èšç„¦å• seat åœºæ™¯ã€‚ å¸¸ç”¨å‘½ä»¤ bash # ä¼šè¯ç®¡ç† loginctl list-sessions # åˆ—å‡ºæ‰€æœ‰ä¼šè¯ loginctl show-session -p Name -p UID -p Seat # ä¼šè¯è¯¦æƒ… loginctl terminate-session # ç»ˆæ­¢ä¼šè¯ # seat ç®¡ç† loginctl seat-status # æŸ¥çœ‹ seat çŠ¶æ€ loginctl seat-status seat0 # ç‰¹å®š seat è¯¦æƒ… # D-Bus æ¥å£è°ƒè¯• busctl --system call org.freedesktop.login1 \\ /org/freedesktop/login1 org.freedesktop.login1.Manager \\ ListSessions è®¾å¤‡æƒé™é—®é¢˜æ’æŸ¥ Wayland compositor å¯åŠ¨ä½†æ— æ³•æ‰“å¼€ /dev/dri/card0ï¼ˆGPU æƒé™é—®é¢˜ï¼‰æ’æŸ¥ï¼š ç¡®è®¤ ls -l /dev/dri/card0 çš„ owner/groupã€‚é€šå¸¸åº”ä¸º root:videoï¼Œå¹¶ä¸”å½“å‰ä¼šè¯åº”è¢«æˆäºˆè®¾å¤‡ ACLã€‚ loginctl seat-status seat0 æŸ¥çœ‹æ˜¯å¦åˆ—å‡º /dev/dri/card0 å¹¶æ˜¾ç¤º ACL ç»™å½“å‰ sessionã€‚ è‹¥æ— ï¼Œé€šè¿‡ udevadm info /dev/dri/card0 æ£€æŸ¥ udev æ˜¯å¦ä¸º GPU è®¾å¤‡æ‰“ä¸Šäº†TAG+=\"uaccess\" æˆ– TAG+=\"seat\"ã€‚ æŸ¥çœ‹ journalctl -u systemd-logindï¼Œçœ‹æ˜¯å¦åœ¨ç”¨æˆ·ç™»å½•æ—¶æœ‰å…³äºè®¾å¤‡åˆ†é…çš„é”™è¯¯ã€‚ è‹¥æœåŠ¡æ˜¯ä»¥ system user çš„æ–¹å¼å¯åŠ¨ï¼Œç¡®ä¿ compositor çš„è¿›ç¨‹æ˜¯åœ¨ç”¨æˆ· session ä¸‹ï¼Œè€Œä¸æ˜¯ systemd æœåŠ¡æˆ– root å¯åŠ¨çš„è¿›ç¨‹ï¼ˆèµ·è¿›ç¨‹èº«ä»½ä¸åŒä¼šå¯¼è‡´æƒé™é—®é¢˜ï¼‰ã€‚ æ„å¤–æŒ‚èµ·/å…³æœºï¼ˆç”µæºé”®/ç¡çœ æŒ‰é’®ä¸æŒ‰ç”¨æˆ·è®¾ç½®å·¥ä½œï¼‰ æ£€æŸ¥ logind.confï¼ˆNixOS å¯¹åº”ä½ç½®è¯·ç”¨ NixOS config æ¥è¦†å†™ï¼‰ä¸­ HandlePowerKey,HandleLidSwitch çš„é…ç½®ã€‚ journalctl -u systemd-logind æŸ¥çœ‹è§¦å‘äº‹ä»¶æ—¶é—´ç‚¹ï¼›é€šå¸¸æŒ‰é”®ä¼šä»¥ D-Bus äº‹ä»¶æˆ– ACPI äº‹ä»¶å…¥æ—¥å¿—ã€‚ è‹¥æŸæ¡Œé¢ç¯å¢ƒæˆ–åº”ç”¨æ‹¦æˆªäº†æŒ‰é”®ï¼Œä¼šé˜»æ­¢ logind è¡Œä¸ºã€‚å¯ä»¥é€šè¿‡ busctl monitor ç›‘å¬org.freedesktop.login1 çš„æ¶ˆæ¯ï¼Œçœ‹æ˜¯å¦æ”¶åˆ°è¯·æ±‚ã€‚ è‹¥éœ€è¦ç›‘æ§ logind åœ¨ç™»å½•/ç™»å‡ºæ—¶åšäº†ä»€ä¹ˆï¼Œå¯ä»¥ç”¨busctl monitor --system org.freedesktop.login1 æˆ–ï¼š bash sudo dbus-monitor --system \"interface='org.freedesktop.login1.Manager'\" è¿™èƒ½è§‚å¯Ÿåˆ° session åˆ›å»ºã€ç§»é™¤ã€seat åˆ†é…ã€é”å±è¯·æ±‚ç­‰ä¿¡å·ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:2:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#æ„å¤–æŒ‚èµ·å…³æœºç”µæºé”®ç¡çœ æŒ‰é’®ä¸æŒ‰ç”¨æˆ·è®¾ç½®å·¥ä½œ"},{"categories":["tech"],"content":" Linux å›¾å½¢ç³»ç»ŸåŸºç¡€æ¦‚å¿µåœ¨æ·±å…¥è®¨è®ºæ¡Œé¢ä¼šè¯å’Œå›¾å½¢æ¸²æŸ“ä¹‹å‰ï¼Œéœ€è¦å…ˆç†è§£ Linux å›¾å½¢ç³»ç»Ÿçš„åŸºç¡€ç»„ä»¶å’Œæ¦‚å¿µã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:3:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#linux-å›¾å½¢ç³»ç»ŸåŸºç¡€æ¦‚å¿µ"},{"categories":["tech"],"content":" 2.1 TTY ä¸ VTï¼ˆVirtual Terminalï¼‰TTYï¼ˆTeletypeï¼‰ æ˜¯ Linux ç³»ç»Ÿä¸­ç»ˆç«¯è®¾å¤‡çš„æŠ½è±¡æ¦‚å¿µï¼Œæºäºæ—©æœŸè®¡ç®—æœºçš„ç»ˆç«¯è®¾å¤‡ã€‚åœ¨ç°ä»£ Linux ç³»ç»Ÿä¸­ï¼š ç‰©ç† TTYï¼šé€šè¿‡ä¸²å£è¿æ¥çš„ç»ˆç«¯è®¾å¤‡ï¼ˆå¤šç”¨äºåµŒå…¥å¼æˆ–æœåŠ¡å™¨è°ƒè¯•ï¼‰ã€‚ è™šæ‹Ÿ TTYï¼šé€šè¿‡é”®ç›˜å’Œæ˜¾ç¤ºå™¨æ¨¡æ‹Ÿçš„ç»ˆç«¯ï¼Œé€šå¸¸æœ‰ 63 ä¸ªï¼ˆtty1-tty63ï¼‰ã€‚åœ¨è®¸å¤šç»å…¸å‘è¡Œç‰ˆä¸­ï¼Œtty1-tty6 é»˜è®¤ä¸ºæ–‡æœ¬ VTï¼Œå›¾å½¢ä¼šè¯ï¼ˆå¦‚ X11 æˆ– Wayland åˆæˆå™¨ï¼‰é€šå¸¸åœ¨ tty7 æˆ– tty1/tty2 å¯åŠ¨ã€‚ ä¼ª TTYï¼ˆPTYï¼‰ï¼šç”¨äºç½‘ç»œè¿æ¥ï¼ˆå¦‚ SSHï¼‰æˆ–ç»ˆç«¯æ¨¡æ‹Ÿå™¨ï¼ˆå¦‚ GNOME Terminalï¼‰çš„è™šæ‹Ÿç»ˆç«¯ã€‚ VTï¼ˆVirtual Terminalï¼‰ æ˜¯å†…æ ¸ä¸­çš„è™šæ‹Ÿç»ˆç«¯å­ç³»ç»Ÿï¼ˆdrivers/tty/vt/ï¼‰ï¼Œè´Ÿè´£ç®¡ç†å¤šä¸ªè™šæ‹Ÿç»ˆç«¯ï¼š æ¯ä¸ª VT å¯¹åº”ä¸€ä¸ª struct vc_data ç»“æ„ä½“ã€‚ ç»´æŠ¤å­—ç¬¦çŸ©é˜µã€å…‰æ ‡ä½ç½®ã€å­—ä½“ç­‰ä¿¡æ¯ã€‚ æ”¯æŒä¸¤ç§æ˜¾ç¤ºæ¨¡å¼ï¼šKD_TEXTï¼ˆæ–‡æœ¬æ¨¡å¼ï¼‰å’Œ KD_GRAPHICSï¼ˆå›¾å½¢æ¨¡å¼ï¼‰ã€‚ åªæœ‰å‰å° VT æ¥æ”¶é”®ç›˜è¾“å…¥ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:3:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#21-tty-ä¸-vtvirtual-terminal"},{"categories":["tech"],"content":" 2.2 å†…æ ¸æ˜¾ç¤ºæ¨¡å¼åˆ‡æ¢Linux å†…æ ¸ VT å­ç³»ç»Ÿæ”¯æŒä¸¤ç§æ˜¾ç¤ºæ¨¡å¼ï¼Œé€šè¿‡ KDSETMODE ioctl è¿›è¡Œåˆ‡æ¢ï¼š KD_TEXT æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰ï¼š å†…æ ¸ VT å­ç³»ç»Ÿè´Ÿè´£å­—ç¬¦åˆ°åƒç´ çš„è½¬æ¢å’Œåˆ·æ–°ã€‚ ä½¿ç”¨ fbconï¼ˆframebuffer consoleï¼‰ å°†å­—ç¬¦çŸ©é˜µæ¸²æŸ“åˆ°æ˜¾å­˜ã€‚ æ”¯æŒå…‰æ ‡é—ªçƒã€æ»šåŠ¨ã€å­—ä½“åˆ‡æ¢ç­‰æ–‡æœ¬ç»ˆç«¯åŠŸèƒ½ã€‚ å…¸å‹çš„é»‘åº•ç™½å­—æ–‡æœ¬ç•Œé¢ã€‚ KD_GRAPHICS æ¨¡å¼ï¼š å†…æ ¸åœæ­¢å­—ç¬¦åˆ·æ–°ï¼Œfbcon ä¸å†æ›´æ–°æ˜¾å­˜ã€‚ ç”¨æˆ·ç©ºé—´è¿›ç¨‹ï¼ˆå¦‚å›¾å½¢æœåŠ¡å™¨ï¼‰è·å¾—æ˜¾å­˜æ§åˆ¶æƒï¼Œç›´æ¥è¿›è¡Œåƒç´ çº§æ“ä½œã€‚ å›¾å½¢ç•Œé¢ï¼ˆX11ã€Waylandï¼‰çš„åŸºç¡€æ¨¡å¼ã€‚ fbconï¼ˆframebuffer consoleï¼‰ æ˜¯å†…æ ¸ä¸­çš„å¸§ç¼“å†²æ§åˆ¶å°é©±åŠ¨ï¼Œè´Ÿè´£åœ¨ KD_TEXT æ¨¡å¼ä¸‹å°†å­—ç¬¦çŸ©é˜µæ¸²æŸ“åˆ°æ˜¾å­˜ï¼š å°†å­—ç¬¦çŸ©é˜µè½¬æ¢ä¸ºåƒç´ æ•°æ® ç®¡ç†å­—ä½“æ¸²æŸ“ã€å…‰æ ‡æ˜¾ç¤ºã€å±å¹•æ»šåŠ¨ åœ¨ KD_TEXT æ¨¡å¼ä¸‹æŒç»­åˆ·æ–°æ˜¾å­˜ åœ¨ KD_GRAPHICS æ¨¡å¼ä¸‹åœæ­¢å·¥ä½œ fbcon åŸºäº fbdevï¼ˆframebuffer deviceï¼‰ æ¡†æ¶å·¥ä½œï¼Œé€šè¿‡ /dev/fb0 ç­‰è®¾å¤‡æ–‡ä»¶è®¿é—®æ˜¾å­˜ã€‚fbcon å¯ä»¥åœ¨ä¸å®‰è£…ä¸“ç”¨æ˜¾å¡é©±åŠ¨ï¼ˆå¦‚ NVIDIA/AMD é©±åŠ¨ï¼‰æ—¶å·¥ä½œï¼Œè¿™æ˜¯å› ä¸ºå®ƒä¾èµ–äºæ˜¾å¡å›ºä»¶æä¾›çš„æ ‡å‡†åŒ–æ¥å£ï¼š VESA BIOS Extensions (VBE)ï¼šåœ¨ä¼ ç»Ÿ BIOS ç³»ç»Ÿä¸Šï¼Œå†…æ ¸çš„ vesafb é©±åŠ¨é€šè¿‡ VBE æ¥å£ ï¼ˆç”±æ˜¾å¡ BIOS å®ç°ï¼‰è¯·æ±‚ä¸€ä¸ªæ ‡å‡†çš„æ˜¾ç¤ºæ¨¡å¼ï¼ˆå¦‚ 1024x768ï¼‰ï¼Œå¹¶è·å–ä¸€ä¸ªæŒ‡å‘æ˜¾å­˜çš„ã€Œçº¿æ€§å¸§ç¼“å†²åŒºã€ï¼ˆLFBï¼‰åœ°å€ã€‚ UEFI Graphics Output Protocol (GOP)ï¼šåœ¨ç°ä»£ UEFI ç³»ç»Ÿä¸Šï¼Œå†…æ ¸çš„ efifb é©±åŠ¨é€šè¿‡ GOP æ¥å£å®ç°ç›¸åŒçš„åŠŸèƒ½ã€‚ å…³é”®ç‚¹åœ¨äºï¼š æ— è®ºæ˜¯ VBE è¿˜æ˜¯ GOPï¼Œå®ƒä»¬éƒ½åªæä¾›æœ€åŸºæœ¬çš„åŠŸèƒ½â€”â€”è®¾ç½®æ¨¡å¼å¹¶è¿”å›ä¸€å—å†…å­˜ï¼ˆå¸§ç¼“å†²åŒºï¼‰åœ°å€ã€‚fbcon é©±åŠ¨ï¼ˆè¿è¡Œåœ¨ CPU ä¸Šï¼‰è´Ÿè´£å‘è¿™å—å†…å­˜ä¸­å†™å…¥åƒç´ æ•°æ®æ¥æ˜¾ç¤ºæ–‡æœ¬ã€‚è¿™ç§æ–¹å¼éå¸¸å¯é ï¼ˆå› ä¸ºå®ƒæ˜¯å›ºä»¶æ ‡å‡†ï¼Œæ€»èƒ½å·¥ä½œï¼‰ï¼Œä½†ä¸æä¾›ä»»ä½•ç¡¬ä»¶åŠ é€Ÿã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ–‡æœ¬ç•Œé¢ ï¼ˆKD_TEXTï¼‰æ€»æ˜¯èƒ½æ˜¾ç¤ºï¼Œè€Œå›¾å½¢ç•Œé¢ï¼ˆKD_GRAPHICSï¼‰åˆ™å¿…é¡»åŠ è½½ä¸“ç”¨çš„ DRM/KMS é©±åŠ¨ï¼Œä»¥åˆ©ç”¨ GPU çš„ 2D/3D åŠ é€Ÿã€é«˜çº§æ˜¾ç¤ºè®¾ç½®å’Œç”µæºç®¡ç†åŠŸèƒ½ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:3:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#22-å†…æ ¸æ˜¾ç¤ºæ¨¡å¼åˆ‡æ¢"},{"categories":["tech"],"content":" 2.3 è¾“å…¥è®¾å¤‡å¤„ç†evdev æ˜¯ Linux è¾“å…¥å­ç³»ç»Ÿçš„äº‹ä»¶æ¥å£ï¼š æä¾›ç»Ÿä¸€çš„è¾“å…¥äº‹ä»¶æ ¼å¼ã€‚ æ”¯æŒé”®ç›˜ã€é¼ æ ‡ã€è§¦æ‘¸æ¿ç­‰è®¾å¤‡ã€‚ é€šè¿‡ /dev/input/event* è®¾å¤‡æ–‡ä»¶è®¿é—®ã€‚ æ³¨æ„ï¼šåœ¨ KD_TEXT æ¨¡å¼ä¸‹ï¼Œé”®ç›˜è¾“å…¥ç”±å†…æ ¸ VT å­ç³»ç»Ÿç›´æ¥å¤„ç†ï¼Œç»•è¿‡äº† evdevï¼›åªæœ‰åœ¨ KD_GRAPHICS æ¨¡å¼ä¸‹ï¼Œå›¾å½¢æœåŠ¡å™¨æ‰ä¼šæ¥ç®¡ evdev è®¾å¤‡ã€‚ libinput æ˜¯ç”¨æˆ·ç©ºé—´çš„è¾“å…¥å¤„ç†åº“ï¼š æä¾›è®¾å¤‡æšä¸¾å’Œäº‹ä»¶å›è°ƒã€‚ å¤„ç†æ‰‹åŠ¿è¯†åˆ«ã€è¾¹ç¼˜æ»šåŠ¨ã€æŒ‡é’ˆåŠ é€Ÿç­‰é«˜çº§åŠŸèƒ½ã€‚ è¢« X11ï¼ˆé€šè¿‡ xf86-input-libinput é©±åŠ¨ï¼‰å’Œ Wayland åˆæˆå™¨ï¼ˆåŸç”Ÿï¼‰å¹¿æ³›ä½¿ç”¨ã€‚ å›¾å½¢ç•Œé¢ä¸“ç”¨ï¼šéœ€è¦ evdev æ”¯æŒï¼Œå› æ­¤åªåœ¨å›¾å½¢æ¨¡å¼ä¸‹å·¥ä½œã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:3:3","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#23-è¾“å…¥è®¾å¤‡å¤„ç†"},{"categories":["tech"],"content":" å›¾å½¢é©±åŠ¨ä¸æ¸²æŸ“æ ˆç°ä»£ Linux æ¡Œé¢ç³»ç»Ÿçš„å›¾å½¢æ¸²æŸ“æ¶‰åŠå¤šä¸ªå±‚æ¬¡çš„ç»„ä»¶ï¼Œä»åº•å±‚çš„ç¡¬ä»¶é©±åŠ¨åˆ°é«˜å±‚çš„å›¾å½¢ APIï¼Œå„å±‚ååŒå·¥ä½œå®ç°é«˜æ•ˆçš„å›¾å½¢æ¸²æŸ“ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:4:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#å›¾å½¢é©±åŠ¨ä¸æ¸²æŸ“æ ˆ"},{"categories":["tech"],"content":" 3.1 å›¾å½¢æ ˆæ¶æ„æ¶æ„å±‚æ¬¡ï¼š ç¡¬ä»¶å±‚ï¼šGPU å’Œæ˜¾ç¤ºè®¾å¤‡ é©±åŠ¨å±‚ï¼šMesa å›¾å½¢é©±åŠ¨å’Œå†…æ ¸ DRM ç³»ç»Ÿå±‚ï¼šWayland åè®®å’Œåˆæˆå™¨ / X Server å·¥å…·åŒ…å±‚ï¼šGTKã€Qt ç­‰å›¾å½¢ç•Œé¢åº“ åº”ç”¨å±‚ï¼šå…·ä½“çš„æ¡Œé¢åº”ç”¨ç¨‹åº æ ¸å¿ƒç»„ä»¶ï¼š DRMï¼ˆDirect Rendering Managerï¼‰ï¼šå†…æ ¸ä¸­çš„å›¾å½¢é©±åŠ¨æ¡†æ¶ï¼Œæ˜¯ç°ä»£ Linux å›¾å½¢æ ˆçš„åŸºçŸ³ã€‚å®ƒå°† GPU ç¡¬ä»¶æŠ½è±¡ä¸º /dev/dri/card0 ç­‰è®¾å¤‡æ–‡ä»¶ï¼Œå¹¶æä¾›ä¸¤å¤§æ ¸å¿ƒåŠŸèƒ½ï¼š KMSï¼ˆKernel Mode Settingï¼‰ï¼šLinux å†…æ ¸ä¸­ä¸“é—¨è´Ÿè´£æ§åˆ¶æ˜¾å¡è¾“å‡ºã€è®¾ç½®æ˜¾ç¤ºå™¨åˆ†è¾¨ç‡å’Œåˆ·æ–°ç‡ç­‰æ¨¡å¼ï¼ˆModesettingï¼‰çš„å­ç³»ç»Ÿã€‚ä¸»è¦ç‰¹ç‚¹ï¼š å†…æ ¸çº§æ§åˆ¶ï¼šç”±å†…æ ¸ç›´æ¥ç®¡ç†æ˜¾ç¤ºæ¨¡å¼ï¼Œé¿å…ç”¨æˆ·ç©ºé—´ç¨‹åºç›´æ¥æ“ä½œç¡¬ä»¶ æ— é—ªçƒå¯åŠ¨ï¼šç³»ç»Ÿå¯åŠ¨æ—¶ç›´æ¥è®¾ç½®åˆ°æ˜¾ç¤ºå™¨åŸç”Ÿåˆ†è¾¨ç‡ï¼Œé¿å…åˆ†è¾¨ç‡åˆ‡æ¢æ—¶çš„é—ªçƒ çƒ­æ’æ‹”æ”¯æŒï¼šå¯ä»¥åŠ¨æ€æ£€æµ‹å’Œé…ç½®æ–°è¿æ¥çš„æ˜¾ç¤ºå™¨ å¤šæ˜¾ç¤ºå™¨æ”¯æŒï¼šæ”¯æŒå¤šæ˜¾ç¤ºå™¨é…ç½®å’Œæ‰©å±•æ¡Œé¢ ç¨³å®šåˆ‡æ¢ï¼šVT åˆ‡æ¢ï¼ˆCtrl+Alt+F1 ç­‰ï¼‰ç¬æ—¶ä¸”ç¨³å®š æƒé™å®‰å…¨ï¼šç”¨æˆ·ç©ºé—´ç¨‹åºæ— éœ€ root æƒé™å³å¯è¯·æ±‚æ˜¾ç¤ºæ¨¡å¼åˆ‡æ¢ GEMï¼ˆGraphics Execution Managerï¼‰ï¼šå›¾å½¢æ‰§è¡Œç®¡ç†å™¨ã€‚DRM æä¾›çš„ç¼“å†²åŒºç®¡ç†æ¡†æ¶ï¼Œè´Ÿè´£åˆ†é…å’Œç®¡ç† GPU æ˜¾å­˜ï¼Œå¹¶æ§åˆ¶ 2D/3D å¼•æ“çš„æ‰§è¡Œã€‚ DRM-Masterï¼šè®¾å¤‡ä¸»æ§æƒé™ã€‚è¿™æ˜¯å†…æ ¸ DRM æä¾›çš„ä¸€ç§ç‹¬å é”ï¼Œç”¨äºä»²è£å“ªä¸ªè¿›ç¨‹æœ‰æƒè¯·æ±‚ KMS æ“ä½œï¼ˆå³è®¾ç½®æ˜¾ç¤ºæ¨¡å¼ï¼‰ã€‚systemd-logind ä¼šå°†è¿™ä¸ªæƒé™æˆäºˆã€Œæ´»åŠ¨ã€çš„å›¾å½¢ä¼šè¯ï¼ˆå¦‚ Waylandåˆæˆå™¨æˆ– X Serverï¼‰ï¼Œç¡®ä¿åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªã€Œä¸»å®°è€…ã€èƒ½æ§åˆ¶å±å¹•è¾“å‡ºã€‚ Mesaï¼šç”¨æˆ·ç©ºé—´çš„ 3D å›¾å½¢é©±åŠ¨åº“ï¼Œæä¾›äº† OpenGL å’Œ Vulkan ç­‰å›¾å½¢ API çš„å¼€æºå®ç°ã€‚ EGLï¼šKhronos ç»„ç»‡å®šä¹‰çš„æ¥å£ï¼Œæ˜¯ Mesa å’Œ Waylandï¼ˆæˆ– X11ï¼‰ä¹‹é—´çš„ã€Œèƒ¶æ°´ã€ï¼Œè´Ÿè´£å°† OpenGL/Vulkan æ¸²æŸ“ API ä¸æœ¬åœ°çª—å£ç³»ç»Ÿè¿æ¥èµ·æ¥ã€‚ GBMï¼ˆGeneric Buffer Managerï¼‰ï¼šMesa æä¾›çš„ä¸€ä¸ª APIï¼Œå…è®¸åˆæˆå™¨ï¼ˆCompositorï¼‰é€šè¿‡ DRM/KMS æ¡†æ¶ï¼Œä»¥ã€Œé EGLã€çš„æ–¹å¼ç›´æ¥åˆ†é…å’Œç®¡ç†å›¾å½¢ç¼“å†²åŒºï¼ˆBuffersï¼‰ã€‚ libdrmï¼šä¸€ä¸ªç”¨æˆ·ç©ºé—´åº“ï¼Œå°è£…äº†ä¸å†…æ ¸ DRM é©±åŠ¨è¿›è¡Œ ioctl é€šä¿¡çš„å¤æ‚ç»†èŠ‚ï¼Œç®€åŒ–äº† Mesa å’Œåˆæˆå™¨å¯¹ DRM/KMS/GEM çš„è°ƒç”¨ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:4:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#31-å›¾å½¢æ ˆæ¶æ„"},{"categories":["tech"],"content":" 3.2 æ¸²æŸ“ç®¡çº¿å®Œæ•´æ¸²æŸ“æµç¨‹ï¼š åº”ç”¨åˆ›å»ºæ¸²æŸ“ä¸Šä¸‹æ–‡ï¼š åº”ç”¨ï¼ˆå¦‚ Firefoxï¼‰è°ƒç”¨ OpenGL/Vulkan API åˆ›å»ºæ¸²æŸ“ä¸Šä¸‹æ–‡ã€‚ EGL è´Ÿè´£å°†å›¾å½¢ API ä¸ Wayland çª—å£ç³»ç»Ÿè¿æ¥ã€‚ Mesa é©±åŠ¨åŠ è½½å¹¶åˆå§‹åŒ– GPU ä¸Šä¸‹æ–‡ã€‚ GPU æ¸²æŸ“æ‰§è¡Œï¼š åº”ç”¨è°ƒç”¨ API ç»˜åˆ¶ç•Œé¢å†…å®¹ï¼ˆå¦‚ç½‘é¡µï¼‰ã€‚ Mesa å°† API è°ƒç”¨è½¬æ¢ä¸º GPU æŒ‡ä»¤ã€‚ GPU æ‰§è¡Œæ¸²æŸ“ï¼Œå°†ç»“æœå†™å…¥ä¸€ä¸ªå›¾å½¢ç¼“å†²åŒºï¼ˆBufferï¼‰ã€‚ ç¼“å†²åŒºç®¡ç†ï¼š GBM è´Ÿè´£ä¸ºåº”ç”¨åˆ†é…è¿™ä¸ªç¼“å†²åŒºã€‚ åº”ç”¨å°†æ¸²æŸ“å®Œæˆçš„ç¼“å†²åŒºï¼ˆé€šè¿‡ Wayland åè®®ï¼‰æäº¤ç»™åˆæˆå™¨ï¼ˆCompositorï¼‰ã€‚ åˆæˆä¸å±•ç¤ºï¼š åˆæˆå™¨æ”¶é›†æ‰€æœ‰åº”ç”¨çš„ç¼“å†²åŒºï¼ˆå¦‚ Firefox çš„ã€ç»ˆç«¯çš„ã€è¾“å…¥æ³•çš„ï¼‰ã€‚ åˆæˆå™¨å°†è¿™äº›ç¼“å†²åŒºç»„åˆæˆä¸€ä¸ªæœ€ç»ˆå¸§ã€‚ åˆæˆå™¨é€šè¿‡DRM/KMSæ¥å£ï¼Œè¯·æ±‚å†…æ ¸å°†è¿™ä¸ªæœ€ç»ˆå¸§æ˜¾ç¤ºåˆ°å±å¹•ä¸Šã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:4:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#32-æ¸²æŸ“ç®¡çº¿"},{"categories":["tech"],"content":" Wayland å›¾å½¢æ¶æ„Wayland æ˜¯ç°ä»£ Linux æ¡Œé¢ç³»ç»Ÿçš„å›¾å½¢åè®®ï¼Œé‡‡ç”¨å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¨¡å‹ã€‚åˆæˆå™¨åŒæ—¶æ‰®æ¼”æ˜¾ç¤ºæœåŠ¡å™¨å’Œçª—å£ç®¡ç†å™¨çš„è§’è‰²ï¼Œç›´æ¥ä¸å†…æ ¸çš„ DRM/KMS å’Œè¾“å…¥è®¾å¤‡äº¤äº’ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:5:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#wayland-å›¾å½¢æ¶æ„"},{"categories":["tech"],"content":" 4.1 æ¶æ„å¯¹æ¯”ï¼šX11 vs Wayland X11ï¼ˆä¼ ç»Ÿï¼‰ï¼šåœ¨ X11 æ¶æ„ä¸­ï¼ŒX Serverï¼ˆä¾‹å¦‚ Xorgï¼‰æ˜¯æ˜¾ç¤ºæœåŠ¡å™¨ï¼Œç›´æ¥ä¸æ˜¾å¡é©±åŠ¨å’Œè¾“å…¥è®¾å¤‡äº¤äº’ï¼› çª—å£ç®¡ç†å™¨ / æ¡Œé¢ç¯å¢ƒï¼ˆä¾‹å¦‚ i3ã€GNOMEï¼‰åˆ™ä½œä¸º X client è¿æ¥åˆ° X Serverï¼Œè´Ÿè´£çª—å£æ‘†æ”¾ã€è£…é¥°ä»¥åŠç”¨æˆ·ç•Œé¢ã€‚ä½¿ç”¨ startxï¼ˆå®é™…ä¸Šè°ƒç”¨ xinitï¼‰å¯åŠ¨å›¾å½¢ä¼šè¯æ—¶ï¼Œæœ¬è´¨æµç¨‹æ˜¯ï¼šå…ˆå¯åŠ¨ X Serverï¼Œå†åœ¨å…¶ä¸­è¿è¡Œçª—å£ç®¡ç†å™¨æˆ–æ¡Œé¢ç¯å¢ƒï¼ˆå¦‚exec i3ï¼‰ã€‚Display Managerï¼ˆå¦‚ GDMã€SDDMï¼‰åœ¨å›¾å½¢ç™»å½•æ—¶ä¼šè‡ªåŠ¨å¯åŠ¨ X Serverï¼Œå¹¶å®Œæˆç”¨æˆ·è®¤è¯ã€è®¾ç½® DISPLAY ç­‰ç¯å¢ƒå˜é‡ï¼Œç„¶åå†è¿è¡Œä¼šè¯ã€‚ Waylandï¼ˆç°ä»£ï¼‰ï¼š Wayland åˆæˆå™¨æœ¬èº«æ—¢æ˜¯æ˜¾ç¤ºæœåŠ¡å™¨ï¼Œåˆæ˜¯çª—å£ç®¡ç†å™¨ã€‚å®ƒç›´æ¥é€šè¿‡å†…æ ¸çš„ DRM/KMS æ§åˆ¶æ˜¾ç¤ºæ¨¡å¼ï¼Œé€šè¿‡ evdev/libinput é‡‡é›†å¹¶åˆ†å‘è¾“å…¥äº‹ä»¶ã€‚Wayland å®¢æˆ·ç«¯åº”ç”¨é€šè¿‡ Wayland socketï¼ˆé€šå¸¸ä½äº $XDG_RUNTIME_DIR/wayland-0ï¼Œä½†å…·ä½“åå­—å¯å˜ï¼‰ä¸åˆæˆå™¨é€šä¿¡ã€‚å› ä¸ºåˆæˆå™¨æœ¬èº«ç›´æ¥æ§åˆ¶æ˜¾ç¤ºå’Œè¾“å…¥è®¾å¤‡ï¼Œæ‰€ä»¥å®ƒå¯ä»¥ç›´æ¥ä»ä¸€ä¸ªå·²ç™»å½•çš„ TTY å¯åŠ¨ï¼Œä½œä¸ºè¯¥ TTY çš„å›¾å½¢ä¼šè¯çš„ã€Œdisplay serverã€ï¼Œæ— éœ€å…ˆç”¨ startx å¯åŠ¨ä¸€ä¸ªç‹¬ç«‹çš„ X Serverã€‚å¦‚æœä½¿ç”¨ Display Manager ç™»å½• Wayland ä¼šè¯ï¼Œåˆ™ç”± DM åœ¨åˆé€‚çš„ TTY å¯åŠ¨åˆæˆå™¨å¹¶å‡†å¤‡_ä¼šè¯_ç¯å¢ƒã€‚ TTY åˆ°å›¾å½¢ç•Œé¢çš„åˆ‡æ¢æœºåˆ¶å½“ä» TTY å¯åŠ¨ Wayland åˆæˆå™¨æ—¶ï¼Œæ¶‰åŠä»¥ä¸‹å…³é”®æ­¥éª¤ï¼š è®¾å¤‡æƒé™è·å–ï¼šåˆæˆå™¨é€šè¿‡ systemd-logind è·å¾— seat å’Œ GPU çš„ DRM-Master æƒé™ã€‚ æ˜¾ç¤ºæ¨¡å¼åˆ‡æ¢ï¼šè°ƒç”¨ KDSETMODE ioctl å°† VT ä» KD_TEXT åˆ‡æ¢åˆ° KD_GRAPHICSï¼Œå†…æ ¸åœæ­¢ fbcon åˆ·æ–°ã€‚ è¾“å…¥è®¾å¤‡æ¥ç®¡ï¼šæ‰“å¼€ /dev/input/event* å¹¶æ‰§è¡Œ EVIOCGRABï¼Œæˆ–é€šè¿‡ logind çš„TakeControl() è·å¾—è¾“å…¥æ§åˆ¶æƒã€‚å®Œæˆåï¼Œåˆæˆå™¨é€šè¿‡ libdrm/EGL/GBM ç›´æ¥æ¸²æŸ“åˆ° framebufferï¼Œé€šå¸¸é¦–å¸§æ˜¾ç¤ºé»‘å±å’Œé¼ æ ‡æŒ‡é’ˆã€‚ é€€å‡º/åˆ‡æ¢ VTï¼ˆCtrl+Alt+FâŸ‚ï¼‰æ—¶ï¼š é‡Šæ”¾ DRM-Masterï¼šdrmDropMaster() æ¢å¤æ–‡æœ¬æ¨¡å¼ï¼šKDSETMODE åˆ‡å› KD_TEXT é‡Šæ”¾è¾“å…¥æ§åˆ¶ï¼šå…³é—­ evdev fdï¼Œlogind æ”¶å›è®¾å¤‡æ§åˆ¶æƒ fbcon é‡æ–°å¼€å§‹åˆ·æ–°ï¼Œæ–‡æœ¬ç•Œé¢æ¢å¤æ˜¾ç¤ºã€‚è‹¥åˆæˆå™¨å¼‚å¸¸é€€å‡ºï¼Œlogind çš„ PauseDevice() ä¼šæ”¶å› DRM-Masterï¼Œç³»ç»Ÿå¯æ¢å¤æ–‡æœ¬æ¨¡å¼ã€‚ æ¶æ„å·®å¼‚å¸¦æ¥çš„å®é™…å½±å“ å®‰å…¨ä¸æƒé™ï¼šWayland æŠŠåˆæˆå™¨æ”¾åœ¨æ›´æ ¸å¿ƒçš„ä½ç½®ï¼ˆå®ƒæœ‰ç›´æ¥è®¾å¤‡è®¿é—®ï¼‰ï¼Œå› æ­¤ç¡®ä¿åˆæˆå™¨è¿è¡Œåœ¨æ­£ç¡®ä¼šè¯ï¼ˆç”± logind ç®¡ç†ï¼‰ä¸‹è‡³å…³é‡è¦ã€‚é”™è¯¯åœ°ä»¥ root æˆ– system service å¯åŠ¨åˆæˆå™¨ä¼šå¯¼è‡´æƒé™/ACL ä¸ä¸€è‡´ï¼ˆcompositor æ— æ³•è®¿é—®è®¾å¤‡æˆ–å®‰å…¨çº§åˆ«é—®é¢˜ï¼‰ã€‚ ç®€åŒ–æµç¨‹ï¼šWayland æŠŠå¤šä¸ªè§’è‰²åˆå¹¶åˆ°åˆæˆå™¨è¿›ç¨‹ï¼Œæ¶ˆé™¤äº† X11 æ—¶ä»£å®¢æˆ·ç«¯/çª—å£ç®¡ç†å™¨ä¸æœåŠ¡å™¨çš„åˆ†ç¦»å¤æ‚åº¦ï¼Œä»¤ç›´æ¥ä» tty å¯åŠ¨åˆæˆå™¨æˆä¸ºå¯è¡Œä¸”å¸¸è§çš„åšæ³•ã€‚ å…¼å®¹æ€§ï¼šXwayland æä¾›å¯¹ legacy X11 åº”ç”¨çš„å…¼å®¹ï¼Œåˆæˆå™¨è´Ÿè´£åœ¨å¯åŠ¨æ—¶/æŒ‰éœ€å¯åŠ¨ Xwayland ä»¥æ”¯æŒè€åº”ç”¨ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:5:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#41-æ¶æ„å¯¹æ¯”x11-vs-wayland"},{"categories":["tech"],"content":" 4.1 æ¶æ„å¯¹æ¯”ï¼šX11 vs Wayland X11ï¼ˆä¼ ç»Ÿï¼‰ï¼šåœ¨ X11 æ¶æ„ä¸­ï¼ŒX Serverï¼ˆä¾‹å¦‚ Xorgï¼‰æ˜¯æ˜¾ç¤ºæœåŠ¡å™¨ï¼Œç›´æ¥ä¸æ˜¾å¡é©±åŠ¨å’Œè¾“å…¥è®¾å¤‡äº¤äº’ï¼› çª—å£ç®¡ç†å™¨ / æ¡Œé¢ç¯å¢ƒï¼ˆä¾‹å¦‚ i3ã€GNOMEï¼‰åˆ™ä½œä¸º X client è¿æ¥åˆ° X Serverï¼Œè´Ÿè´£çª—å£æ‘†æ”¾ã€è£…é¥°ä»¥åŠç”¨æˆ·ç•Œé¢ã€‚ä½¿ç”¨ startxï¼ˆå®é™…ä¸Šè°ƒç”¨ xinitï¼‰å¯åŠ¨å›¾å½¢ä¼šè¯æ—¶ï¼Œæœ¬è´¨æµç¨‹æ˜¯ï¼šå…ˆå¯åŠ¨ X Serverï¼Œå†åœ¨å…¶ä¸­è¿è¡Œçª—å£ç®¡ç†å™¨æˆ–æ¡Œé¢ç¯å¢ƒï¼ˆå¦‚exec i3ï¼‰ã€‚Display Managerï¼ˆå¦‚ GDMã€SDDMï¼‰åœ¨å›¾å½¢ç™»å½•æ—¶ä¼šè‡ªåŠ¨å¯åŠ¨ X Serverï¼Œå¹¶å®Œæˆç”¨æˆ·è®¤è¯ã€è®¾ç½® DISPLAY ç­‰ç¯å¢ƒå˜é‡ï¼Œç„¶åå†è¿è¡Œä¼šè¯ã€‚ Waylandï¼ˆç°ä»£ï¼‰ï¼š Wayland åˆæˆå™¨æœ¬èº«æ—¢æ˜¯æ˜¾ç¤ºæœåŠ¡å™¨ï¼Œåˆæ˜¯çª—å£ç®¡ç†å™¨ã€‚å®ƒç›´æ¥é€šè¿‡å†…æ ¸çš„ DRM/KMS æ§åˆ¶æ˜¾ç¤ºæ¨¡å¼ï¼Œé€šè¿‡ evdev/libinput é‡‡é›†å¹¶åˆ†å‘è¾“å…¥äº‹ä»¶ã€‚Wayland å®¢æˆ·ç«¯åº”ç”¨é€šè¿‡ Wayland socketï¼ˆé€šå¸¸ä½äº $XDG_RUNTIME_DIR/wayland-0ï¼Œä½†å…·ä½“åå­—å¯å˜ï¼‰ä¸åˆæˆå™¨é€šä¿¡ã€‚å› ä¸ºåˆæˆå™¨æœ¬èº«ç›´æ¥æ§åˆ¶æ˜¾ç¤ºå’Œè¾“å…¥è®¾å¤‡ï¼Œæ‰€ä»¥å®ƒå¯ä»¥ç›´æ¥ä»ä¸€ä¸ªå·²ç™»å½•çš„ TTY å¯åŠ¨ï¼Œä½œä¸ºè¯¥ TTY çš„å›¾å½¢ä¼šè¯çš„ã€Œdisplay serverã€ï¼Œæ— éœ€å…ˆç”¨ startx å¯åŠ¨ä¸€ä¸ªç‹¬ç«‹çš„ X Serverã€‚å¦‚æœä½¿ç”¨ Display Manager ç™»å½• Wayland ä¼šè¯ï¼Œåˆ™ç”± DM åœ¨åˆé€‚çš„ TTY å¯åŠ¨åˆæˆå™¨å¹¶å‡†å¤‡_ä¼šè¯_ç¯å¢ƒã€‚ TTY åˆ°å›¾å½¢ç•Œé¢çš„åˆ‡æ¢æœºåˆ¶å½“ä» TTY å¯åŠ¨ Wayland åˆæˆå™¨æ—¶ï¼Œæ¶‰åŠä»¥ä¸‹å…³é”®æ­¥éª¤ï¼š è®¾å¤‡æƒé™è·å–ï¼šåˆæˆå™¨é€šè¿‡ systemd-logind è·å¾— seat å’Œ GPU çš„ DRM-Master æƒé™ã€‚ æ˜¾ç¤ºæ¨¡å¼åˆ‡æ¢ï¼šè°ƒç”¨ KDSETMODE ioctl å°† VT ä» KD_TEXT åˆ‡æ¢åˆ° KD_GRAPHICSï¼Œå†…æ ¸åœæ­¢ fbcon åˆ·æ–°ã€‚ è¾“å…¥è®¾å¤‡æ¥ç®¡ï¼šæ‰“å¼€ /dev/input/event* å¹¶æ‰§è¡Œ EVIOCGRABï¼Œæˆ–é€šè¿‡ logind çš„TakeControl() è·å¾—è¾“å…¥æ§åˆ¶æƒã€‚å®Œæˆåï¼Œåˆæˆå™¨é€šè¿‡ libdrm/EGL/GBM ç›´æ¥æ¸²æŸ“åˆ° framebufferï¼Œé€šå¸¸é¦–å¸§æ˜¾ç¤ºé»‘å±å’Œé¼ æ ‡æŒ‡é’ˆã€‚ é€€å‡º/åˆ‡æ¢ VTï¼ˆCtrl+Alt+FâŸ‚ï¼‰æ—¶ï¼š é‡Šæ”¾ DRM-Masterï¼šdrmDropMaster() æ¢å¤æ–‡æœ¬æ¨¡å¼ï¼šKDSETMODE åˆ‡å› KD_TEXT é‡Šæ”¾è¾“å…¥æ§åˆ¶ï¼šå…³é—­ evdev fdï¼Œlogind æ”¶å›è®¾å¤‡æ§åˆ¶æƒ fbcon é‡æ–°å¼€å§‹åˆ·æ–°ï¼Œæ–‡æœ¬ç•Œé¢æ¢å¤æ˜¾ç¤ºã€‚è‹¥åˆæˆå™¨å¼‚å¸¸é€€å‡ºï¼Œlogind çš„ PauseDevice() ä¼šæ”¶å› DRM-Masterï¼Œç³»ç»Ÿå¯æ¢å¤æ–‡æœ¬æ¨¡å¼ã€‚ æ¶æ„å·®å¼‚å¸¦æ¥çš„å®é™…å½±å“ å®‰å…¨ä¸æƒé™ï¼šWayland æŠŠåˆæˆå™¨æ”¾åœ¨æ›´æ ¸å¿ƒçš„ä½ç½®ï¼ˆå®ƒæœ‰ç›´æ¥è®¾å¤‡è®¿é—®ï¼‰ï¼Œå› æ­¤ç¡®ä¿åˆæˆå™¨è¿è¡Œåœ¨æ­£ç¡®ä¼šè¯ï¼ˆç”± logind ç®¡ç†ï¼‰ä¸‹è‡³å…³é‡è¦ã€‚é”™è¯¯åœ°ä»¥ root æˆ– system service å¯åŠ¨åˆæˆå™¨ä¼šå¯¼è‡´æƒé™/ACL ä¸ä¸€è‡´ï¼ˆcompositor æ— æ³•è®¿é—®è®¾å¤‡æˆ–å®‰å…¨çº§åˆ«é—®é¢˜ï¼‰ã€‚ ç®€åŒ–æµç¨‹ï¼šWayland æŠŠå¤šä¸ªè§’è‰²åˆå¹¶åˆ°åˆæˆå™¨è¿›ç¨‹ï¼Œæ¶ˆé™¤äº† X11 æ—¶ä»£å®¢æˆ·ç«¯/çª—å£ç®¡ç†å™¨ä¸æœåŠ¡å™¨çš„åˆ†ç¦»å¤æ‚åº¦ï¼Œä»¤ç›´æ¥ä» tty å¯åŠ¨åˆæˆå™¨æˆä¸ºå¯è¡Œä¸”å¸¸è§çš„åšæ³•ã€‚ å…¼å®¹æ€§ï¼šXwayland æä¾›å¯¹ legacy X11 åº”ç”¨çš„å…¼å®¹ï¼Œåˆæˆå™¨è´Ÿè´£åœ¨å¯åŠ¨æ—¶/æŒ‰éœ€å¯åŠ¨ Xwayland ä»¥æ”¯æŒè€åº”ç”¨ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:5:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#tty-åˆ°å›¾å½¢ç•Œé¢çš„åˆ‡æ¢æœºåˆ¶"},{"categories":["tech"],"content":" 4.1 æ¶æ„å¯¹æ¯”ï¼šX11 vs Wayland X11ï¼ˆä¼ ç»Ÿï¼‰ï¼šåœ¨ X11 æ¶æ„ä¸­ï¼ŒX Serverï¼ˆä¾‹å¦‚ Xorgï¼‰æ˜¯æ˜¾ç¤ºæœåŠ¡å™¨ï¼Œç›´æ¥ä¸æ˜¾å¡é©±åŠ¨å’Œè¾“å…¥è®¾å¤‡äº¤äº’ï¼› çª—å£ç®¡ç†å™¨ / æ¡Œé¢ç¯å¢ƒï¼ˆä¾‹å¦‚ i3ã€GNOMEï¼‰åˆ™ä½œä¸º X client è¿æ¥åˆ° X Serverï¼Œè´Ÿè´£çª—å£æ‘†æ”¾ã€è£…é¥°ä»¥åŠç”¨æˆ·ç•Œé¢ã€‚ä½¿ç”¨ startxï¼ˆå®é™…ä¸Šè°ƒç”¨ xinitï¼‰å¯åŠ¨å›¾å½¢ä¼šè¯æ—¶ï¼Œæœ¬è´¨æµç¨‹æ˜¯ï¼šå…ˆå¯åŠ¨ X Serverï¼Œå†åœ¨å…¶ä¸­è¿è¡Œçª—å£ç®¡ç†å™¨æˆ–æ¡Œé¢ç¯å¢ƒï¼ˆå¦‚exec i3ï¼‰ã€‚Display Managerï¼ˆå¦‚ GDMã€SDDMï¼‰åœ¨å›¾å½¢ç™»å½•æ—¶ä¼šè‡ªåŠ¨å¯åŠ¨ X Serverï¼Œå¹¶å®Œæˆç”¨æˆ·è®¤è¯ã€è®¾ç½® DISPLAY ç­‰ç¯å¢ƒå˜é‡ï¼Œç„¶åå†è¿è¡Œä¼šè¯ã€‚ Waylandï¼ˆç°ä»£ï¼‰ï¼š Wayland åˆæˆå™¨æœ¬èº«æ—¢æ˜¯æ˜¾ç¤ºæœåŠ¡å™¨ï¼Œåˆæ˜¯çª—å£ç®¡ç†å™¨ã€‚å®ƒç›´æ¥é€šè¿‡å†…æ ¸çš„ DRM/KMS æ§åˆ¶æ˜¾ç¤ºæ¨¡å¼ï¼Œé€šè¿‡ evdev/libinput é‡‡é›†å¹¶åˆ†å‘è¾“å…¥äº‹ä»¶ã€‚Wayland å®¢æˆ·ç«¯åº”ç”¨é€šè¿‡ Wayland socketï¼ˆé€šå¸¸ä½äº $XDG_RUNTIME_DIR/wayland-0ï¼Œä½†å…·ä½“åå­—å¯å˜ï¼‰ä¸åˆæˆå™¨é€šä¿¡ã€‚å› ä¸ºåˆæˆå™¨æœ¬èº«ç›´æ¥æ§åˆ¶æ˜¾ç¤ºå’Œè¾“å…¥è®¾å¤‡ï¼Œæ‰€ä»¥å®ƒå¯ä»¥ç›´æ¥ä»ä¸€ä¸ªå·²ç™»å½•çš„ TTY å¯åŠ¨ï¼Œä½œä¸ºè¯¥ TTY çš„å›¾å½¢ä¼šè¯çš„ã€Œdisplay serverã€ï¼Œæ— éœ€å…ˆç”¨ startx å¯åŠ¨ä¸€ä¸ªç‹¬ç«‹çš„ X Serverã€‚å¦‚æœä½¿ç”¨ Display Manager ç™»å½• Wayland ä¼šè¯ï¼Œåˆ™ç”± DM åœ¨åˆé€‚çš„ TTY å¯åŠ¨åˆæˆå™¨å¹¶å‡†å¤‡_ä¼šè¯_ç¯å¢ƒã€‚ TTY åˆ°å›¾å½¢ç•Œé¢çš„åˆ‡æ¢æœºåˆ¶å½“ä» TTY å¯åŠ¨ Wayland åˆæˆå™¨æ—¶ï¼Œæ¶‰åŠä»¥ä¸‹å…³é”®æ­¥éª¤ï¼š è®¾å¤‡æƒé™è·å–ï¼šåˆæˆå™¨é€šè¿‡ systemd-logind è·å¾— seat å’Œ GPU çš„ DRM-Master æƒé™ã€‚ æ˜¾ç¤ºæ¨¡å¼åˆ‡æ¢ï¼šè°ƒç”¨ KDSETMODE ioctl å°† VT ä» KD_TEXT åˆ‡æ¢åˆ° KD_GRAPHICSï¼Œå†…æ ¸åœæ­¢ fbcon åˆ·æ–°ã€‚ è¾“å…¥è®¾å¤‡æ¥ç®¡ï¼šæ‰“å¼€ /dev/input/event* å¹¶æ‰§è¡Œ EVIOCGRABï¼Œæˆ–é€šè¿‡ logind çš„TakeControl() è·å¾—è¾“å…¥æ§åˆ¶æƒã€‚å®Œæˆåï¼Œåˆæˆå™¨é€šè¿‡ libdrm/EGL/GBM ç›´æ¥æ¸²æŸ“åˆ° framebufferï¼Œé€šå¸¸é¦–å¸§æ˜¾ç¤ºé»‘å±å’Œé¼ æ ‡æŒ‡é’ˆã€‚ é€€å‡º/åˆ‡æ¢ VTï¼ˆCtrl+Alt+FâŸ‚ï¼‰æ—¶ï¼š é‡Šæ”¾ DRM-Masterï¼šdrmDropMaster() æ¢å¤æ–‡æœ¬æ¨¡å¼ï¼šKDSETMODE åˆ‡å› KD_TEXT é‡Šæ”¾è¾“å…¥æ§åˆ¶ï¼šå…³é—­ evdev fdï¼Œlogind æ”¶å›è®¾å¤‡æ§åˆ¶æƒ fbcon é‡æ–°å¼€å§‹åˆ·æ–°ï¼Œæ–‡æœ¬ç•Œé¢æ¢å¤æ˜¾ç¤ºã€‚è‹¥åˆæˆå™¨å¼‚å¸¸é€€å‡ºï¼Œlogind çš„ PauseDevice() ä¼šæ”¶å› DRM-Masterï¼Œç³»ç»Ÿå¯æ¢å¤æ–‡æœ¬æ¨¡å¼ã€‚ æ¶æ„å·®å¼‚å¸¦æ¥çš„å®é™…å½±å“ å®‰å…¨ä¸æƒé™ï¼šWayland æŠŠåˆæˆå™¨æ”¾åœ¨æ›´æ ¸å¿ƒçš„ä½ç½®ï¼ˆå®ƒæœ‰ç›´æ¥è®¾å¤‡è®¿é—®ï¼‰ï¼Œå› æ­¤ç¡®ä¿åˆæˆå™¨è¿è¡Œåœ¨æ­£ç¡®ä¼šè¯ï¼ˆç”± logind ç®¡ç†ï¼‰ä¸‹è‡³å…³é‡è¦ã€‚é”™è¯¯åœ°ä»¥ root æˆ– system service å¯åŠ¨åˆæˆå™¨ä¼šå¯¼è‡´æƒé™/ACL ä¸ä¸€è‡´ï¼ˆcompositor æ— æ³•è®¿é—®è®¾å¤‡æˆ–å®‰å…¨çº§åˆ«é—®é¢˜ï¼‰ã€‚ ç®€åŒ–æµç¨‹ï¼šWayland æŠŠå¤šä¸ªè§’è‰²åˆå¹¶åˆ°åˆæˆå™¨è¿›ç¨‹ï¼Œæ¶ˆé™¤äº† X11 æ—¶ä»£å®¢æˆ·ç«¯/çª—å£ç®¡ç†å™¨ä¸æœåŠ¡å™¨çš„åˆ†ç¦»å¤æ‚åº¦ï¼Œä»¤ç›´æ¥ä» tty å¯åŠ¨åˆæˆå™¨æˆä¸ºå¯è¡Œä¸”å¸¸è§çš„åšæ³•ã€‚ å…¼å®¹æ€§ï¼šXwayland æä¾›å¯¹ legacy X11 åº”ç”¨çš„å…¼å®¹ï¼Œåˆæˆå™¨è´Ÿè´£åœ¨å¯åŠ¨æ—¶/æŒ‰éœ€å¯åŠ¨ Xwayland ä»¥æ”¯æŒè€åº”ç”¨ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:5:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#æ¶æ„å·®å¼‚å¸¦æ¥çš„å®é™…å½±å“"},{"categories":["tech"],"content":" 4.2 Wayland åè®®ä¸é€šä¿¡å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶æ„ï¼š å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¨¡å‹ï¼šåº”ç”¨ä½œä¸ºå®¢æˆ·ç«¯ï¼Œåˆæˆå™¨ä½œä¸ºæœåŠ¡å™¨ã€‚ Unix åŸŸå¥—æ¥å­—ï¼šé€šè¿‡ $XDG_RUNTIME_DIR/wayland-0 è¿›è¡Œé€šä¿¡ã€‚ åè®®æ‰©å±•ï¼šæ”¯æŒ xdg-shellã€text-input ç­‰æ‰©å±•åè®®ã€‚ å®‰å…¨éš”ç¦»ï¼šåº”ç”¨åªèƒ½è®¿é—®è‡ªå·±çš„çª—å£å’Œè¾“å…¥äº‹ä»¶ã€‚ æ ¸å¿ƒåè®®ï¼š wayland-coreï¼šåŸºç¡€åè®®ï¼Œå®šä¹‰ surfaceã€buffer ç­‰æ ¸å¿ƒå¯¹è±¡ã€‚ xdg-shellï¼šçª—å£ç®¡ç†åè®®ï¼Œå®šä¹‰çª—å£ã€å¯¹è¯æ¡†ç­‰ã€‚ wl_seatï¼šè¾“å…¥è®¾å¤‡åè®®ï¼Œå¤„ç†é”®ç›˜ã€é¼ æ ‡ã€è§¦æ‘¸æ¿ã€‚ wl_outputï¼šæ˜¾ç¤ºè¾“å‡ºåè®®ï¼Œç®¡ç†æ˜¾ç¤ºå™¨é…ç½®ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:5:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#42-wayland-åè®®ä¸é€šä¿¡"},{"categories":["tech"],"content":" 4.3 åˆæˆå™¨æ¶æ„è¾“å…¥å¤„ç†ç»„ä»¶ï¼š libinputï¼šä» /dev/input/* è¯»å–äº‹ä»¶å¹¶åšé¢„å¤„ç†ï¼ˆæ‰‹åŠ¿è¯†åˆ«ã€è§¦æ‘¸æ¿è¾¹ç¼˜ã€é”®ç›˜å…ƒé”®å¤„ç†ç­‰ï¼‰ã€‚ åˆæˆå™¨ä½¿ç”¨ libinput çš„ API è¿›è¡Œè®¾å¤‡æšä¸¾ä¸äº‹ä»¶å›è°ƒã€‚ è®¾å¤‡è®¿é—®ï¼š åˆæˆå™¨é€šè¿‡ /dev/dri/card0 ä¸å†…æ ¸ DRM äº¤äº’ã€‚ é€šè¿‡ /dev/input/event* è®¿é—®è¾“å…¥è®¾å¤‡ã€‚ é€šè¿‡ PipeWire å¤„ç†éŸ³é¢‘ã€è§†é¢‘å’Œå±å¹•å…±äº«ï¼ˆè¯¦è§åç»­å¤šåª’ä½“ç« èŠ‚ï¼‰ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:5:3","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#43-åˆæˆå™¨æ¶æ„"},{"categories":["tech"],"content":" 4.4 xdg-desktop-portalï¼šWayland æ¡Œé¢è®¿é—®æ§åˆ¶XDG Desktop Portal æ˜¯ä¸€å¥—ç”¨äºåœ¨ Linux æ¡Œé¢ç¯å¢ƒä¸‹æä¾›ç»Ÿä¸€å®‰å…¨æ¥å£çš„æ¡†æ¶ï¼Œæœ€åˆä¸º Flatpak ç­‰æ²™ç›’åº”ç”¨è®¿é—®æ²™ç®±å¤–éƒ¨èµ„æºè€Œè®¾è®¡ã€‚å®ƒé€šè¿‡ D-Bus æš´éœ²ä¸€ç³»åˆ—ã€Œé—¨æˆ·ï¼ˆPortalï¼‰ã€æ¥å£ï¼Œè®©æ²™ç®±åŒ–æˆ–å—é™åº”ç”¨èƒ½å¤Ÿå®‰å…¨åœ°è¯·æ±‚æ–‡ä»¶é€‰æ‹©ã€æˆªå›¾ã€å±å¹•å…±äº«ã€æ‰“å¼€ URI ç­‰æ“ä½œã€‚ åœ¨ Wayland ç¯å¢ƒä¸‹ï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºåªèƒ½è®¿é—®è‡ªå·±çš„çª—å£ã€é”®ç›˜é¼ æ ‡äº‹ä»¶ç­‰ç­‰ï¼Œæ— æ³•éšæ„æˆªå±æˆ–è®¿é—®å…¨å±€èµ„æºã€‚åœ¨ Wayland å‘å±•è¿‡ç¨‹ä¸­ï¼Œæ—©æœŸå„ DE ä¸ WM å„è‡ªä¸ºæˆ˜ï¼Œå®ç°äº†è®¸å¤šç§æœ‰åè®®å»å®Œæˆè¿™äº›å·¥ä½œï¼Œç¢ç‰‡åŒ–ä¸¥é‡ã€å®¢æˆ·ç«¯ç¨‹åºå…¼å®¹å›°éš¾ã€‚ä¹‹åç¤¾åŒºé€æ¸å½¢æˆäº†ä½¿ç”¨ XDG Desktop Portal ä½œä¸ºæ¡Œé¢è®¿é—®æ§åˆ¶æ¡†æ¶çš„å…±è¯†ï¼Œå¦‚ä»Šå‡ ä¹æ‰€æœ‰çš„ DE/WM ä¸å®¢æˆ·ç«¯åº”ç”¨éƒ½å¹¿æ³›é‡‡ç”¨äº†è¿™ä¸€æ¡†æ¶ï¼Œå®ƒå·²æˆä¸º Wayland ä¸­èµ„æºè®¿é—®æ§åˆ¶çš„äº‹å®æ ‡å‡†ã€‚ å¦‚ä»Šç»å¤§éƒ¨åˆ†åº”ç”¨åœ¨ X11 ç¯å¢ƒä¸‹ä»ç„¶ä¼šä½¿ç”¨ X11 åŸç”Ÿæ¥å£ï¼ˆå¦‚ XShmã€XRecordã€XSelectInput ç­‰ï¼‰ å®ç°å±å¹•å…±äº«ã€æ–‡ä»¶é€‰æ‹©ã€æ‰“å¼€ URI ç­‰åŠŸèƒ½ï¼Œè€Œåœ¨ Wayland ä¸‹åˆ™å¿…é¡»ä½¿ç”¨ xdg-desktop-portal. NOTE: è®¸å¤šå‘½ä»¤è¡Œæˆªå›¾/å½•å±å·¥å…·ï¼ˆå¦‚wl-screenrec,wf-recorderï¼‰é€‰æ‹©äº†ä½¿ç”¨ wlr-screencopy-unstable-v1 / ext-image-copy-capture-v1 ç­‰ Wayland åŸç”Ÿçš„åè®®æ¥å®ç°æˆªå›¾åŠŸèƒ½ï¼Œè¿™äº›å·¥å…·å®Œå…¨ç»•è¿‡äº† XDG Desktop Portal, é€šå¸¸åªåœ¨ wlroots-based compositors ä¸Šèƒ½æ­£å¸¸ä½¿ç”¨ï¼ŒGnome/KDE ç›®å‰éƒ½è¦æ±‚èµ° Portal æ¥å£ã€ä¸æ”¯æŒæ­¤ç±»åè®®ã€‚ æ ¸å¿ƒé—¨æˆ·æœåŠ¡ https://flatpak.github.io/xdg-desktop-portal/docs/api-reference.html æ–‡ä»¶æ“ä½œï¼š æ–‡ä»¶é€‰æ‹©å™¨ï¼šorg.freedesktop.portal.FileChooser ç»Ÿä¸€çš„æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡† æ–‡ä»¶ä¼ è¾“ï¼šorg.freedesktop.portal.FileTransfer é€šè¿‡æ‹–æ‹½æˆ–å¤åˆ¶ç²˜è´´ç­‰æ–¹å¼åœ¨ Apps ä¹‹é—´ä¼ è¾“æ–‡ä»¶ å±å¹•ä¸åª’ä½“è®¿é—®ï¼š æˆªå±ï¼šorg.freedesktop.portal.Screenshot å®‰å…¨æˆªå±åŠŸèƒ½ å½•å±ï¼šorg.freedesktop.portal.ScreenCast å±å¹•å½•åˆ¶å’Œçª—å£å…±äº«ï¼Œè§†é¢‘ä¼šè®®åº”ç”¨çš„æ ¸å¿ƒä¾èµ– æ‘„åƒå¤´ï¼šorg.freedesktop.portal.Camera æ‘„åƒå¤´è®¿é—®æ§åˆ¶ ç³»ç»Ÿè®¿é—®ï¼š æ‰“å°æœºï¼šorg.freedesktop.portal.Print ç»Ÿä¸€çš„æ‰“å°æ¥å£ é€šçŸ¥ï¼šorg.freedesktop.portal.Notification è·¨æ¡Œé¢ç¯å¢ƒçš„é€šçŸ¥å‘é€ ä½ç½®æœåŠ¡ï¼šorg.freedesktop.portal.Location åœ°ç†ä½ç½®ä¿¡æ¯è®¿é—® è´¦æˆ·ä¸æƒé™ï¼š è´¦æˆ·ä¿¡æ¯ï¼šorg.freedesktop.portal.Account è·å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ å¯†ç ç®¡ç†ï¼šorg.freedesktop.portal.Secret ä¸ç³»ç»Ÿå¯†é’¥ç¯é›†æˆ è®¾å¤‡æˆæƒï¼šorg.freedesktop.portal.Usb USB è®¾å¤‡ç­‰å¤–è®¾è®¿é—®æ§åˆ¶ é—¨æˆ·å®ç°ï¼šä¸åŒæ¡Œé¢ç¯å¢ƒçš„é€‚é…å™¨xdg-desktop-portal æ˜¯æ¡†æ¶æœ¬èº«ï¼Œå…·ä½“çš„åŠŸèƒ½å®ç°ç”±å„ä¸ªæ¡Œé¢ç¯å¢ƒæä¾›ï¼š xdg-desktop-portal-gtkï¼šå®ç°äº† Portal æœ€åŸºç¡€çš„åŠŸèƒ½ï¼Œæ˜¯ Niri/Hyprland ç­‰å¤§éƒ¨åˆ† Compositors çš„é»˜è®¤ Portal. xdg-desktop-portal-wlrï¼šwlroots çš„é€šç”¨ portal ç»„ä»¶ï¼Œå®ç°äº†é€šç”¨çš„å±å¹•å…±äº«ä¸æˆªå›¾ä¸¤é¡¹åŠŸèƒ½ï¼Œæ‰€æœ‰åŸºäº wlroots çš„ Compositors éƒ½å¯ä½¿ç”¨å®ƒã€‚ xdg-desktop-portal-gnomeï¼šè¢« Niri ç­‰éƒ¨åˆ† Compositor ç”¨äºå®ç°å±å¹•å…±äº«ä¸æˆªå›¾åŠŸèƒ½ã€‚ gnome-keyring: å®ç°äº† Portal çš„å¯†ç ç®¡ç† API, Niri/Hyprland ç­‰ Compositor éƒ½ä½¿ç”¨å®ƒä½œä¸ºå¯†ç ç®¡ç†ç»„ä»¶ã€‚ ä¸å¤šåª’ä½“å’Œ PipeWire çš„å…³ç³»åœ¨åç»­çš„å¤šåª’ä½“ç« èŠ‚ä¸­ä¼šè¯¦ç»†ä»‹ç»ï¼ŒPipeWire çš„å±å¹•å…±äº«åŠŸèƒ½å®Œå…¨ä¾èµ– xdg-desktop-portalï¼š å±å¹•æ•è·æµç¨‹ï¼šè§†é¢‘ä¼šè®®è½¯ä»¶ â†’ PipeWire â†’ xdg-desktop-portal â†’ ç”¨æˆ·æˆæƒ â†’ åˆæˆå™¨æä¾›å±å¹•å†…å®¹ æƒé™ç®¡ç†ï¼šç”¨æˆ·å¯ä»¥ç²¾ç»†æ§åˆ¶å“ªäº›åº”ç”¨å¯ä»¥è®¿é—®å±å¹•ï¼Œä»¥åŠè®¿é—®çš„èŒƒå›´ å®‰å…¨ä¿è¯ï¼šå³ä½¿åº”ç”¨è·å¾—äº†å±å¹•è®¿é—®æƒé™ï¼Œä¹Ÿåªèƒ½åœ¨ç”¨æˆ·æˆæƒçš„èŒƒå›´å†…å·¥ä½œ è¿™ç§è®¾è®¡è§£å†³äº† Wayland éš”ç¦»åŸåˆ™ä¸å®é™…åŠŸèƒ½éœ€æ±‚çš„çŸ›ç›¾ï¼Œæ˜¯å…¸å‹çš„\"å®‰å…¨ä¸ä¾¿åˆ©çš„å¹³è¡¡\"æ–¹æ¡ˆã€‚ å·¥ä½œåŸç†ä¸é€šä¿¡æµç¨‹å…¸å‹äº¤äº’æµç¨‹ï¼š åº”ç”¨å‘èµ·è¯·æ±‚ï¼šåº”ç”¨é€šè¿‡ D-Bus è°ƒç”¨ç›¸åº”çš„é—¨æˆ·æ¥å£ é—¨æˆ·æœåŠ¡è½¬å‘ï¼šxdg-desktop-portal æ ¹æ®é…ç½®å°†è¯·æ±‚è½¬å‘ç»™å¯¹åº”çš„å®ç° ç”¨æˆ·ç•Œé¢æ˜¾ç¤ºï¼šå…·ä½“å®ç°æ˜¾ç¤ºåŸç”Ÿå¯¹è¯æ¡†ï¼Œè¯·æ±‚ç”¨æˆ·æˆæƒ æƒé™æˆäºˆï¼šç”¨æˆ·ç¡®è®¤åï¼Œé—¨æˆ·æœåŠ¡è¿”å›æˆæƒä»¤ç‰Œæˆ–ç»“æœ èµ„æºè®¿é—®ï¼šåº”ç”¨ä½¿ç”¨ä»¤ç‰Œé€šè¿‡å—é™æ¥å£è®¿é—®èµ„æº D-Bus æ¶æ„ï¼š bash # æŸ¥çœ‹å·²å®‰è£…çš„é—¨æˆ·å®ç° ls /usr/share/xdg-desktop-portal/portals/ # æˆ–åœ¨ NixOS ä¸Š ls /run/current-system/sw/share/xdg-desktop-portal/portals/ # æŸ¥çœ‹å½“å‰æ¿€æ´»çš„é—¨æˆ· busctl --user list-units | grep portal # ç›‘æ§é—¨æˆ·æ´»åŠ¨ busctl monitor --user org.freedesktop.portal.* é…ç½®ä¸æ•…éšœæ’æŸ¥ä¼˜å…ˆçº§é…ç½®ï¼š ç³»ç»ŸæŒ‰ä¼˜å…ˆçº§é€‰æ‹©é—¨æˆ·å®ç°ï¼Œä¼˜å…ˆçº§æ–‡ä»¶é€šå¸¸ä½äºï¼š bash # ç³»ç»Ÿçº§é…ç½® /etc/xdg-desktop-portal/*-portals.conf # ç”¨æˆ·çº§é…ç½® ~/.config/xdg-desktop-portal/*-portals.conf å¸¸è§é—®é¢˜æ’æŸ¥ï¼š bash # æ£€æŸ¥é—¨æˆ·æœåŠ¡çŠ¶æ€ systemctl --user status xdg-desktop-portal systemctl --user status xdg-desktop-portal-gtk systemctl --user status xdg-desktop-portal-gnome # æŸ¥çœ‹é—¨æˆ·æ—¥å¿— journalctl --user -u xdg-desktop-portal -f # æµ‹è¯•é—¨æˆ·åŠŸèƒ½ gdbus introspect --session --dest org.freedesktop.portal.Desktop \\ --object-path /org/freedesktop/portal/desktop # æ£€æŸ¥ç‰¹å®šé—¨æˆ·æ”¯æŒ gdbus call --session --dest org.freedesktop.portal.Desktop \\ --object-path /org/freedesktop/portal/desktop \\ --method org.freedesktop.portal.Request.Response NixOS é…ç½®ç¤ºä¾‹ï¼š nix { # å¯ç”¨ xdg-desktop-portal æœåŠ¡ xdg.portal = { enable = true; extraPortals = with pkgs; [ xdg-desktop-portal-gtk # GTK é—¨æˆ· xdg-desktop-portal-wlr # Wayland åˆæˆå™¨é—¨æˆ· ]; xdgOpenUsePortal = true; # ä½¿ç”¨é—¨æˆ·å¤„ç† xdg-open }; } ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:5:4","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#44-xdg-desktop-portalwayland-æ¡Œé¢è®¿é—®æ§åˆ¶"},{"categories":["tech"],"content":" 4.4 xdg-desktop-portalï¼šWayland æ¡Œé¢è®¿é—®æ§åˆ¶XDG Desktop Portal æ˜¯ä¸€å¥—ç”¨äºåœ¨ Linux æ¡Œé¢ç¯å¢ƒä¸‹æä¾›ç»Ÿä¸€å®‰å…¨æ¥å£çš„æ¡†æ¶ï¼Œæœ€åˆä¸º Flatpak ç­‰æ²™ç›’åº”ç”¨è®¿é—®æ²™ç®±å¤–éƒ¨èµ„æºè€Œè®¾è®¡ã€‚å®ƒé€šè¿‡ D-Bus æš´éœ²ä¸€ç³»åˆ—ã€Œé—¨æˆ·ï¼ˆPortalï¼‰ã€æ¥å£ï¼Œè®©æ²™ç®±åŒ–æˆ–å—é™åº”ç”¨èƒ½å¤Ÿå®‰å…¨åœ°è¯·æ±‚æ–‡ä»¶é€‰æ‹©ã€æˆªå›¾ã€å±å¹•å…±äº«ã€æ‰“å¼€ URI ç­‰æ“ä½œã€‚ åœ¨ Wayland ç¯å¢ƒä¸‹ï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºåªèƒ½è®¿é—®è‡ªå·±çš„çª—å£ã€é”®ç›˜é¼ æ ‡äº‹ä»¶ç­‰ç­‰ï¼Œæ— æ³•éšæ„æˆªå±æˆ–è®¿é—®å…¨å±€èµ„æºã€‚åœ¨ Wayland å‘å±•è¿‡ç¨‹ä¸­ï¼Œæ—©æœŸå„ DE ä¸ WM å„è‡ªä¸ºæˆ˜ï¼Œå®ç°äº†è®¸å¤šç§æœ‰åè®®å»å®Œæˆè¿™äº›å·¥ä½œï¼Œç¢ç‰‡åŒ–ä¸¥é‡ã€å®¢æˆ·ç«¯ç¨‹åºå…¼å®¹å›°éš¾ã€‚ä¹‹åç¤¾åŒºé€æ¸å½¢æˆäº†ä½¿ç”¨ XDG Desktop Portal ä½œä¸ºæ¡Œé¢è®¿é—®æ§åˆ¶æ¡†æ¶çš„å…±è¯†ï¼Œå¦‚ä»Šå‡ ä¹æ‰€æœ‰çš„ DE/WM ä¸å®¢æˆ·ç«¯åº”ç”¨éƒ½å¹¿æ³›é‡‡ç”¨äº†è¿™ä¸€æ¡†æ¶ï¼Œå®ƒå·²æˆä¸º Wayland ä¸­èµ„æºè®¿é—®æ§åˆ¶çš„äº‹å®æ ‡å‡†ã€‚ å¦‚ä»Šç»å¤§éƒ¨åˆ†åº”ç”¨åœ¨ X11 ç¯å¢ƒä¸‹ä»ç„¶ä¼šä½¿ç”¨ X11 åŸç”Ÿæ¥å£ï¼ˆå¦‚ XShmã€XRecordã€XSelectInput ç­‰ï¼‰ å®ç°å±å¹•å…±äº«ã€æ–‡ä»¶é€‰æ‹©ã€æ‰“å¼€ URI ç­‰åŠŸèƒ½ï¼Œè€Œåœ¨ Wayland ä¸‹åˆ™å¿…é¡»ä½¿ç”¨ xdg-desktop-portal. NOTE: è®¸å¤šå‘½ä»¤è¡Œæˆªå›¾/å½•å±å·¥å…·ï¼ˆå¦‚wl-screenrec,wf-recorderï¼‰é€‰æ‹©äº†ä½¿ç”¨ wlr-screencopy-unstable-v1 / ext-image-copy-capture-v1 ç­‰ Wayland åŸç”Ÿçš„åè®®æ¥å®ç°æˆªå›¾åŠŸèƒ½ï¼Œè¿™äº›å·¥å…·å®Œå…¨ç»•è¿‡äº† XDG Desktop Portal, é€šå¸¸åªåœ¨ wlroots-based compositors ä¸Šèƒ½æ­£å¸¸ä½¿ç”¨ï¼ŒGnome/KDE ç›®å‰éƒ½è¦æ±‚èµ° Portal æ¥å£ã€ä¸æ”¯æŒæ­¤ç±»åè®®ã€‚ æ ¸å¿ƒé—¨æˆ·æœåŠ¡ https://flatpak.github.io/xdg-desktop-portal/docs/api-reference.html æ–‡ä»¶æ“ä½œï¼š æ–‡ä»¶é€‰æ‹©å™¨ï¼šorg.freedesktop.portal.FileChooser ç»Ÿä¸€çš„æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡† æ–‡ä»¶ä¼ è¾“ï¼šorg.freedesktop.portal.FileTransfer é€šè¿‡æ‹–æ‹½æˆ–å¤åˆ¶ç²˜è´´ç­‰æ–¹å¼åœ¨ Apps ä¹‹é—´ä¼ è¾“æ–‡ä»¶ å±å¹•ä¸åª’ä½“è®¿é—®ï¼š æˆªå±ï¼šorg.freedesktop.portal.Screenshot å®‰å…¨æˆªå±åŠŸèƒ½ å½•å±ï¼šorg.freedesktop.portal.ScreenCast å±å¹•å½•åˆ¶å’Œçª—å£å…±äº«ï¼Œè§†é¢‘ä¼šè®®åº”ç”¨çš„æ ¸å¿ƒä¾èµ– æ‘„åƒå¤´ï¼šorg.freedesktop.portal.Camera æ‘„åƒå¤´è®¿é—®æ§åˆ¶ ç³»ç»Ÿè®¿é—®ï¼š æ‰“å°æœºï¼šorg.freedesktop.portal.Print ç»Ÿä¸€çš„æ‰“å°æ¥å£ é€šçŸ¥ï¼šorg.freedesktop.portal.Notification è·¨æ¡Œé¢ç¯å¢ƒçš„é€šçŸ¥å‘é€ ä½ç½®æœåŠ¡ï¼šorg.freedesktop.portal.Location åœ°ç†ä½ç½®ä¿¡æ¯è®¿é—® è´¦æˆ·ä¸æƒé™ï¼š è´¦æˆ·ä¿¡æ¯ï¼šorg.freedesktop.portal.Account è·å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ å¯†ç ç®¡ç†ï¼šorg.freedesktop.portal.Secret ä¸ç³»ç»Ÿå¯†é’¥ç¯é›†æˆ è®¾å¤‡æˆæƒï¼šorg.freedesktop.portal.Usb USB è®¾å¤‡ç­‰å¤–è®¾è®¿é—®æ§åˆ¶ é—¨æˆ·å®ç°ï¼šä¸åŒæ¡Œé¢ç¯å¢ƒçš„é€‚é…å™¨xdg-desktop-portal æ˜¯æ¡†æ¶æœ¬èº«ï¼Œå…·ä½“çš„åŠŸèƒ½å®ç°ç”±å„ä¸ªæ¡Œé¢ç¯å¢ƒæä¾›ï¼š xdg-desktop-portal-gtkï¼šå®ç°äº† Portal æœ€åŸºç¡€çš„åŠŸèƒ½ï¼Œæ˜¯ Niri/Hyprland ç­‰å¤§éƒ¨åˆ† Compositors çš„é»˜è®¤ Portal. xdg-desktop-portal-wlrï¼šwlroots çš„é€šç”¨ portal ç»„ä»¶ï¼Œå®ç°äº†é€šç”¨çš„å±å¹•å…±äº«ä¸æˆªå›¾ä¸¤é¡¹åŠŸèƒ½ï¼Œæ‰€æœ‰åŸºäº wlroots çš„ Compositors éƒ½å¯ä½¿ç”¨å®ƒã€‚ xdg-desktop-portal-gnomeï¼šè¢« Niri ç­‰éƒ¨åˆ† Compositor ç”¨äºå®ç°å±å¹•å…±äº«ä¸æˆªå›¾åŠŸèƒ½ã€‚ gnome-keyring: å®ç°äº† Portal çš„å¯†ç ç®¡ç† API, Niri/Hyprland ç­‰ Compositor éƒ½ä½¿ç”¨å®ƒä½œä¸ºå¯†ç ç®¡ç†ç»„ä»¶ã€‚ ä¸å¤šåª’ä½“å’Œ PipeWire çš„å…³ç³»åœ¨åç»­çš„å¤šåª’ä½“ç« èŠ‚ä¸­ä¼šè¯¦ç»†ä»‹ç»ï¼ŒPipeWire çš„å±å¹•å…±äº«åŠŸèƒ½å®Œå…¨ä¾èµ– xdg-desktop-portalï¼š å±å¹•æ•è·æµç¨‹ï¼šè§†é¢‘ä¼šè®®è½¯ä»¶ â†’ PipeWire â†’ xdg-desktop-portal â†’ ç”¨æˆ·æˆæƒ â†’ åˆæˆå™¨æä¾›å±å¹•å†…å®¹ æƒé™ç®¡ç†ï¼šç”¨æˆ·å¯ä»¥ç²¾ç»†æ§åˆ¶å“ªäº›åº”ç”¨å¯ä»¥è®¿é—®å±å¹•ï¼Œä»¥åŠè®¿é—®çš„èŒƒå›´ å®‰å…¨ä¿è¯ï¼šå³ä½¿åº”ç”¨è·å¾—äº†å±å¹•è®¿é—®æƒé™ï¼Œä¹Ÿåªèƒ½åœ¨ç”¨æˆ·æˆæƒçš„èŒƒå›´å†…å·¥ä½œ è¿™ç§è®¾è®¡è§£å†³äº† Wayland éš”ç¦»åŸåˆ™ä¸å®é™…åŠŸèƒ½éœ€æ±‚çš„çŸ›ç›¾ï¼Œæ˜¯å…¸å‹çš„\"å®‰å…¨ä¸ä¾¿åˆ©çš„å¹³è¡¡\"æ–¹æ¡ˆã€‚ å·¥ä½œåŸç†ä¸é€šä¿¡æµç¨‹å…¸å‹äº¤äº’æµç¨‹ï¼š åº”ç”¨å‘èµ·è¯·æ±‚ï¼šåº”ç”¨é€šè¿‡ D-Bus è°ƒç”¨ç›¸åº”çš„é—¨æˆ·æ¥å£ é—¨æˆ·æœåŠ¡è½¬å‘ï¼šxdg-desktop-portal æ ¹æ®é…ç½®å°†è¯·æ±‚è½¬å‘ç»™å¯¹åº”çš„å®ç° ç”¨æˆ·ç•Œé¢æ˜¾ç¤ºï¼šå…·ä½“å®ç°æ˜¾ç¤ºåŸç”Ÿå¯¹è¯æ¡†ï¼Œè¯·æ±‚ç”¨æˆ·æˆæƒ æƒé™æˆäºˆï¼šç”¨æˆ·ç¡®è®¤åï¼Œé—¨æˆ·æœåŠ¡è¿”å›æˆæƒä»¤ç‰Œæˆ–ç»“æœ èµ„æºè®¿é—®ï¼šåº”ç”¨ä½¿ç”¨ä»¤ç‰Œé€šè¿‡å—é™æ¥å£è®¿é—®èµ„æº D-Bus æ¶æ„ï¼š bash # æŸ¥çœ‹å·²å®‰è£…çš„é—¨æˆ·å®ç° ls /usr/share/xdg-desktop-portal/portals/ # æˆ–åœ¨ NixOS ä¸Š ls /run/current-system/sw/share/xdg-desktop-portal/portals/ # æŸ¥çœ‹å½“å‰æ¿€æ´»çš„é—¨æˆ· busctl --user list-units | grep portal # ç›‘æ§é—¨æˆ·æ´»åŠ¨ busctl monitor --user org.freedesktop.portal.* é…ç½®ä¸æ•…éšœæ’æŸ¥ä¼˜å…ˆçº§é…ç½®ï¼š ç³»ç»ŸæŒ‰ä¼˜å…ˆçº§é€‰æ‹©é—¨æˆ·å®ç°ï¼Œä¼˜å…ˆçº§æ–‡ä»¶é€šå¸¸ä½äºï¼š bash # ç³»ç»Ÿçº§é…ç½® /etc/xdg-desktop-portal/*-portals.conf # ç”¨æˆ·çº§é…ç½® ~/.config/xdg-desktop-portal/*-portals.conf å¸¸è§é—®é¢˜æ’æŸ¥ï¼š bash # æ£€æŸ¥é—¨æˆ·æœåŠ¡çŠ¶æ€ systemctl --user status xdg-desktop-portal systemctl --user status xdg-desktop-portal-gtk systemctl --user status xdg-desktop-portal-gnome # æŸ¥çœ‹é—¨æˆ·æ—¥å¿— journalctl --user -u xdg-desktop-portal -f # æµ‹è¯•é—¨æˆ·åŠŸèƒ½ gdbus introspect --session --dest org.freedesktop.portal.Desktop \\ --object-path /org/freedesktop/portal/desktop # æ£€æŸ¥ç‰¹å®šé—¨æˆ·æ”¯æŒ gdbus call --session --dest org.freedesktop.portal.Desktop \\ --object-path /org/freedesktop/portal/desktop \\ --method org.freedesktop.portal.Request.Response NixOS é…ç½®ç¤ºä¾‹ï¼š nix { # å¯ç”¨ xdg-desktop-portal æœåŠ¡ xdg.portal = { enable = true; extraPortals = with pkgs; [ xdg-desktop-portal-gtk # GTK é—¨æˆ· xdg-desktop-portal-wlr # Wayland åˆæˆå™¨é—¨æˆ· ]; xdgOpenUsePortal = true; # ä½¿ç”¨é—¨æˆ·å¤„ç† xdg-open }; } ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:5:4","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#æ ¸å¿ƒé—¨æˆ·æœåŠ¡"},{"categories":["tech"],"content":" 4.4 xdg-desktop-portalï¼šWayland æ¡Œé¢è®¿é—®æ§åˆ¶XDG Desktop Portal æ˜¯ä¸€å¥—ç”¨äºåœ¨ Linux æ¡Œé¢ç¯å¢ƒä¸‹æä¾›ç»Ÿä¸€å®‰å…¨æ¥å£çš„æ¡†æ¶ï¼Œæœ€åˆä¸º Flatpak ç­‰æ²™ç›’åº”ç”¨è®¿é—®æ²™ç®±å¤–éƒ¨èµ„æºè€Œè®¾è®¡ã€‚å®ƒé€šè¿‡ D-Bus æš´éœ²ä¸€ç³»åˆ—ã€Œé—¨æˆ·ï¼ˆPortalï¼‰ã€æ¥å£ï¼Œè®©æ²™ç®±åŒ–æˆ–å—é™åº”ç”¨èƒ½å¤Ÿå®‰å…¨åœ°è¯·æ±‚æ–‡ä»¶é€‰æ‹©ã€æˆªå›¾ã€å±å¹•å…±äº«ã€æ‰“å¼€ URI ç­‰æ“ä½œã€‚ åœ¨ Wayland ç¯å¢ƒä¸‹ï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºåªèƒ½è®¿é—®è‡ªå·±çš„çª—å£ã€é”®ç›˜é¼ æ ‡äº‹ä»¶ç­‰ç­‰ï¼Œæ— æ³•éšæ„æˆªå±æˆ–è®¿é—®å…¨å±€èµ„æºã€‚åœ¨ Wayland å‘å±•è¿‡ç¨‹ä¸­ï¼Œæ—©æœŸå„ DE ä¸ WM å„è‡ªä¸ºæˆ˜ï¼Œå®ç°äº†è®¸å¤šç§æœ‰åè®®å»å®Œæˆè¿™äº›å·¥ä½œï¼Œç¢ç‰‡åŒ–ä¸¥é‡ã€å®¢æˆ·ç«¯ç¨‹åºå…¼å®¹å›°éš¾ã€‚ä¹‹åç¤¾åŒºé€æ¸å½¢æˆäº†ä½¿ç”¨ XDG Desktop Portal ä½œä¸ºæ¡Œé¢è®¿é—®æ§åˆ¶æ¡†æ¶çš„å…±è¯†ï¼Œå¦‚ä»Šå‡ ä¹æ‰€æœ‰çš„ DE/WM ä¸å®¢æˆ·ç«¯åº”ç”¨éƒ½å¹¿æ³›é‡‡ç”¨äº†è¿™ä¸€æ¡†æ¶ï¼Œå®ƒå·²æˆä¸º Wayland ä¸­èµ„æºè®¿é—®æ§åˆ¶çš„äº‹å®æ ‡å‡†ã€‚ å¦‚ä»Šç»å¤§éƒ¨åˆ†åº”ç”¨åœ¨ X11 ç¯å¢ƒä¸‹ä»ç„¶ä¼šä½¿ç”¨ X11 åŸç”Ÿæ¥å£ï¼ˆå¦‚ XShmã€XRecordã€XSelectInput ç­‰ï¼‰ å®ç°å±å¹•å…±äº«ã€æ–‡ä»¶é€‰æ‹©ã€æ‰“å¼€ URI ç­‰åŠŸèƒ½ï¼Œè€Œåœ¨ Wayland ä¸‹åˆ™å¿…é¡»ä½¿ç”¨ xdg-desktop-portal. NOTE: è®¸å¤šå‘½ä»¤è¡Œæˆªå›¾/å½•å±å·¥å…·ï¼ˆå¦‚wl-screenrec,wf-recorderï¼‰é€‰æ‹©äº†ä½¿ç”¨ wlr-screencopy-unstable-v1 / ext-image-copy-capture-v1 ç­‰ Wayland åŸç”Ÿçš„åè®®æ¥å®ç°æˆªå›¾åŠŸèƒ½ï¼Œè¿™äº›å·¥å…·å®Œå…¨ç»•è¿‡äº† XDG Desktop Portal, é€šå¸¸åªåœ¨ wlroots-based compositors ä¸Šèƒ½æ­£å¸¸ä½¿ç”¨ï¼ŒGnome/KDE ç›®å‰éƒ½è¦æ±‚èµ° Portal æ¥å£ã€ä¸æ”¯æŒæ­¤ç±»åè®®ã€‚ æ ¸å¿ƒé—¨æˆ·æœåŠ¡ https://flatpak.github.io/xdg-desktop-portal/docs/api-reference.html æ–‡ä»¶æ“ä½œï¼š æ–‡ä»¶é€‰æ‹©å™¨ï¼šorg.freedesktop.portal.FileChooser ç»Ÿä¸€çš„æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡† æ–‡ä»¶ä¼ è¾“ï¼šorg.freedesktop.portal.FileTransfer é€šè¿‡æ‹–æ‹½æˆ–å¤åˆ¶ç²˜è´´ç­‰æ–¹å¼åœ¨ Apps ä¹‹é—´ä¼ è¾“æ–‡ä»¶ å±å¹•ä¸åª’ä½“è®¿é—®ï¼š æˆªå±ï¼šorg.freedesktop.portal.Screenshot å®‰å…¨æˆªå±åŠŸèƒ½ å½•å±ï¼šorg.freedesktop.portal.ScreenCast å±å¹•å½•åˆ¶å’Œçª—å£å…±äº«ï¼Œè§†é¢‘ä¼šè®®åº”ç”¨çš„æ ¸å¿ƒä¾èµ– æ‘„åƒå¤´ï¼šorg.freedesktop.portal.Camera æ‘„åƒå¤´è®¿é—®æ§åˆ¶ ç³»ç»Ÿè®¿é—®ï¼š æ‰“å°æœºï¼šorg.freedesktop.portal.Print ç»Ÿä¸€çš„æ‰“å°æ¥å£ é€šçŸ¥ï¼šorg.freedesktop.portal.Notification è·¨æ¡Œé¢ç¯å¢ƒçš„é€šçŸ¥å‘é€ ä½ç½®æœåŠ¡ï¼šorg.freedesktop.portal.Location åœ°ç†ä½ç½®ä¿¡æ¯è®¿é—® è´¦æˆ·ä¸æƒé™ï¼š è´¦æˆ·ä¿¡æ¯ï¼šorg.freedesktop.portal.Account è·å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ å¯†ç ç®¡ç†ï¼šorg.freedesktop.portal.Secret ä¸ç³»ç»Ÿå¯†é’¥ç¯é›†æˆ è®¾å¤‡æˆæƒï¼šorg.freedesktop.portal.Usb USB è®¾å¤‡ç­‰å¤–è®¾è®¿é—®æ§åˆ¶ é—¨æˆ·å®ç°ï¼šä¸åŒæ¡Œé¢ç¯å¢ƒçš„é€‚é…å™¨xdg-desktop-portal æ˜¯æ¡†æ¶æœ¬èº«ï¼Œå…·ä½“çš„åŠŸèƒ½å®ç°ç”±å„ä¸ªæ¡Œé¢ç¯å¢ƒæä¾›ï¼š xdg-desktop-portal-gtkï¼šå®ç°äº† Portal æœ€åŸºç¡€çš„åŠŸèƒ½ï¼Œæ˜¯ Niri/Hyprland ç­‰å¤§éƒ¨åˆ† Compositors çš„é»˜è®¤ Portal. xdg-desktop-portal-wlrï¼šwlroots çš„é€šç”¨ portal ç»„ä»¶ï¼Œå®ç°äº†é€šç”¨çš„å±å¹•å…±äº«ä¸æˆªå›¾ä¸¤é¡¹åŠŸèƒ½ï¼Œæ‰€æœ‰åŸºäº wlroots çš„ Compositors éƒ½å¯ä½¿ç”¨å®ƒã€‚ xdg-desktop-portal-gnomeï¼šè¢« Niri ç­‰éƒ¨åˆ† Compositor ç”¨äºå®ç°å±å¹•å…±äº«ä¸æˆªå›¾åŠŸèƒ½ã€‚ gnome-keyring: å®ç°äº† Portal çš„å¯†ç ç®¡ç† API, Niri/Hyprland ç­‰ Compositor éƒ½ä½¿ç”¨å®ƒä½œä¸ºå¯†ç ç®¡ç†ç»„ä»¶ã€‚ ä¸å¤šåª’ä½“å’Œ PipeWire çš„å…³ç³»åœ¨åç»­çš„å¤šåª’ä½“ç« èŠ‚ä¸­ä¼šè¯¦ç»†ä»‹ç»ï¼ŒPipeWire çš„å±å¹•å…±äº«åŠŸèƒ½å®Œå…¨ä¾èµ– xdg-desktop-portalï¼š å±å¹•æ•è·æµç¨‹ï¼šè§†é¢‘ä¼šè®®è½¯ä»¶ â†’ PipeWire â†’ xdg-desktop-portal â†’ ç”¨æˆ·æˆæƒ â†’ åˆæˆå™¨æä¾›å±å¹•å†…å®¹ æƒé™ç®¡ç†ï¼šç”¨æˆ·å¯ä»¥ç²¾ç»†æ§åˆ¶å“ªäº›åº”ç”¨å¯ä»¥è®¿é—®å±å¹•ï¼Œä»¥åŠè®¿é—®çš„èŒƒå›´ å®‰å…¨ä¿è¯ï¼šå³ä½¿åº”ç”¨è·å¾—äº†å±å¹•è®¿é—®æƒé™ï¼Œä¹Ÿåªèƒ½åœ¨ç”¨æˆ·æˆæƒçš„èŒƒå›´å†…å·¥ä½œ è¿™ç§è®¾è®¡è§£å†³äº† Wayland éš”ç¦»åŸåˆ™ä¸å®é™…åŠŸèƒ½éœ€æ±‚çš„çŸ›ç›¾ï¼Œæ˜¯å…¸å‹çš„\"å®‰å…¨ä¸ä¾¿åˆ©çš„å¹³è¡¡\"æ–¹æ¡ˆã€‚ å·¥ä½œåŸç†ä¸é€šä¿¡æµç¨‹å…¸å‹äº¤äº’æµç¨‹ï¼š åº”ç”¨å‘èµ·è¯·æ±‚ï¼šåº”ç”¨é€šè¿‡ D-Bus è°ƒç”¨ç›¸åº”çš„é—¨æˆ·æ¥å£ é—¨æˆ·æœåŠ¡è½¬å‘ï¼šxdg-desktop-portal æ ¹æ®é…ç½®å°†è¯·æ±‚è½¬å‘ç»™å¯¹åº”çš„å®ç° ç”¨æˆ·ç•Œé¢æ˜¾ç¤ºï¼šå…·ä½“å®ç°æ˜¾ç¤ºåŸç”Ÿå¯¹è¯æ¡†ï¼Œè¯·æ±‚ç”¨æˆ·æˆæƒ æƒé™æˆäºˆï¼šç”¨æˆ·ç¡®è®¤åï¼Œé—¨æˆ·æœåŠ¡è¿”å›æˆæƒä»¤ç‰Œæˆ–ç»“æœ èµ„æºè®¿é—®ï¼šåº”ç”¨ä½¿ç”¨ä»¤ç‰Œé€šè¿‡å—é™æ¥å£è®¿é—®èµ„æº D-Bus æ¶æ„ï¼š bash # æŸ¥çœ‹å·²å®‰è£…çš„é—¨æˆ·å®ç° ls /usr/share/xdg-desktop-portal/portals/ # æˆ–åœ¨ NixOS ä¸Š ls /run/current-system/sw/share/xdg-desktop-portal/portals/ # æŸ¥çœ‹å½“å‰æ¿€æ´»çš„é—¨æˆ· busctl --user list-units | grep portal # ç›‘æ§é—¨æˆ·æ´»åŠ¨ busctl monitor --user org.freedesktop.portal.* é…ç½®ä¸æ•…éšœæ’æŸ¥ä¼˜å…ˆçº§é…ç½®ï¼š ç³»ç»ŸæŒ‰ä¼˜å…ˆçº§é€‰æ‹©é—¨æˆ·å®ç°ï¼Œä¼˜å…ˆçº§æ–‡ä»¶é€šå¸¸ä½äºï¼š bash # ç³»ç»Ÿçº§é…ç½® /etc/xdg-desktop-portal/*-portals.conf # ç”¨æˆ·çº§é…ç½® ~/.config/xdg-desktop-portal/*-portals.conf å¸¸è§é—®é¢˜æ’æŸ¥ï¼š bash # æ£€æŸ¥é—¨æˆ·æœåŠ¡çŠ¶æ€ systemctl --user status xdg-desktop-portal systemctl --user status xdg-desktop-portal-gtk systemctl --user status xdg-desktop-portal-gnome # æŸ¥çœ‹é—¨æˆ·æ—¥å¿— journalctl --user -u xdg-desktop-portal -f # æµ‹è¯•é—¨æˆ·åŠŸèƒ½ gdbus introspect --session --dest org.freedesktop.portal.Desktop \\ --object-path /org/freedesktop/portal/desktop # æ£€æŸ¥ç‰¹å®šé—¨æˆ·æ”¯æŒ gdbus call --session --dest org.freedesktop.portal.Desktop \\ --object-path /org/freedesktop/portal/desktop \\ --method org.freedesktop.portal.Request.Response NixOS é…ç½®ç¤ºä¾‹ï¼š nix { # å¯ç”¨ xdg-desktop-portal æœåŠ¡ xdg.portal = { enable = true; extraPortals = with pkgs; [ xdg-desktop-portal-gtk # GTK é—¨æˆ· xdg-desktop-portal-wlr # Wayland åˆæˆå™¨é—¨æˆ· ]; xdgOpenUsePortal = true; # ä½¿ç”¨é—¨æˆ·å¤„ç† xdg-open }; } ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:5:4","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#é—¨æˆ·å®ç°ä¸åŒæ¡Œé¢ç¯å¢ƒçš„é€‚é…å™¨"},{"categories":["tech"],"content":" 4.4 xdg-desktop-portalï¼šWayland æ¡Œé¢è®¿é—®æ§åˆ¶XDG Desktop Portal æ˜¯ä¸€å¥—ç”¨äºåœ¨ Linux æ¡Œé¢ç¯å¢ƒä¸‹æä¾›ç»Ÿä¸€å®‰å…¨æ¥å£çš„æ¡†æ¶ï¼Œæœ€åˆä¸º Flatpak ç­‰æ²™ç›’åº”ç”¨è®¿é—®æ²™ç®±å¤–éƒ¨èµ„æºè€Œè®¾è®¡ã€‚å®ƒé€šè¿‡ D-Bus æš´éœ²ä¸€ç³»åˆ—ã€Œé—¨æˆ·ï¼ˆPortalï¼‰ã€æ¥å£ï¼Œè®©æ²™ç®±åŒ–æˆ–å—é™åº”ç”¨èƒ½å¤Ÿå®‰å…¨åœ°è¯·æ±‚æ–‡ä»¶é€‰æ‹©ã€æˆªå›¾ã€å±å¹•å…±äº«ã€æ‰“å¼€ URI ç­‰æ“ä½œã€‚ åœ¨ Wayland ç¯å¢ƒä¸‹ï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºåªèƒ½è®¿é—®è‡ªå·±çš„çª—å£ã€é”®ç›˜é¼ æ ‡äº‹ä»¶ç­‰ç­‰ï¼Œæ— æ³•éšæ„æˆªå±æˆ–è®¿é—®å…¨å±€èµ„æºã€‚åœ¨ Wayland å‘å±•è¿‡ç¨‹ä¸­ï¼Œæ—©æœŸå„ DE ä¸ WM å„è‡ªä¸ºæˆ˜ï¼Œå®ç°äº†è®¸å¤šç§æœ‰åè®®å»å®Œæˆè¿™äº›å·¥ä½œï¼Œç¢ç‰‡åŒ–ä¸¥é‡ã€å®¢æˆ·ç«¯ç¨‹åºå…¼å®¹å›°éš¾ã€‚ä¹‹åç¤¾åŒºé€æ¸å½¢æˆäº†ä½¿ç”¨ XDG Desktop Portal ä½œä¸ºæ¡Œé¢è®¿é—®æ§åˆ¶æ¡†æ¶çš„å…±è¯†ï¼Œå¦‚ä»Šå‡ ä¹æ‰€æœ‰çš„ DE/WM ä¸å®¢æˆ·ç«¯åº”ç”¨éƒ½å¹¿æ³›é‡‡ç”¨äº†è¿™ä¸€æ¡†æ¶ï¼Œå®ƒå·²æˆä¸º Wayland ä¸­èµ„æºè®¿é—®æ§åˆ¶çš„äº‹å®æ ‡å‡†ã€‚ å¦‚ä»Šç»å¤§éƒ¨åˆ†åº”ç”¨åœ¨ X11 ç¯å¢ƒä¸‹ä»ç„¶ä¼šä½¿ç”¨ X11 åŸç”Ÿæ¥å£ï¼ˆå¦‚ XShmã€XRecordã€XSelectInput ç­‰ï¼‰ å®ç°å±å¹•å…±äº«ã€æ–‡ä»¶é€‰æ‹©ã€æ‰“å¼€ URI ç­‰åŠŸèƒ½ï¼Œè€Œåœ¨ Wayland ä¸‹åˆ™å¿…é¡»ä½¿ç”¨ xdg-desktop-portal. NOTE: è®¸å¤šå‘½ä»¤è¡Œæˆªå›¾/å½•å±å·¥å…·ï¼ˆå¦‚wl-screenrec,wf-recorderï¼‰é€‰æ‹©äº†ä½¿ç”¨ wlr-screencopy-unstable-v1 / ext-image-copy-capture-v1 ç­‰ Wayland åŸç”Ÿçš„åè®®æ¥å®ç°æˆªå›¾åŠŸèƒ½ï¼Œè¿™äº›å·¥å…·å®Œå…¨ç»•è¿‡äº† XDG Desktop Portal, é€šå¸¸åªåœ¨ wlroots-based compositors ä¸Šèƒ½æ­£å¸¸ä½¿ç”¨ï¼ŒGnome/KDE ç›®å‰éƒ½è¦æ±‚èµ° Portal æ¥å£ã€ä¸æ”¯æŒæ­¤ç±»åè®®ã€‚ æ ¸å¿ƒé—¨æˆ·æœåŠ¡ https://flatpak.github.io/xdg-desktop-portal/docs/api-reference.html æ–‡ä»¶æ“ä½œï¼š æ–‡ä»¶é€‰æ‹©å™¨ï¼šorg.freedesktop.portal.FileChooser ç»Ÿä¸€çš„æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡† æ–‡ä»¶ä¼ è¾“ï¼šorg.freedesktop.portal.FileTransfer é€šè¿‡æ‹–æ‹½æˆ–å¤åˆ¶ç²˜è´´ç­‰æ–¹å¼åœ¨ Apps ä¹‹é—´ä¼ è¾“æ–‡ä»¶ å±å¹•ä¸åª’ä½“è®¿é—®ï¼š æˆªå±ï¼šorg.freedesktop.portal.Screenshot å®‰å…¨æˆªå±åŠŸèƒ½ å½•å±ï¼šorg.freedesktop.portal.ScreenCast å±å¹•å½•åˆ¶å’Œçª—å£å…±äº«ï¼Œè§†é¢‘ä¼šè®®åº”ç”¨çš„æ ¸å¿ƒä¾èµ– æ‘„åƒå¤´ï¼šorg.freedesktop.portal.Camera æ‘„åƒå¤´è®¿é—®æ§åˆ¶ ç³»ç»Ÿè®¿é—®ï¼š æ‰“å°æœºï¼šorg.freedesktop.portal.Print ç»Ÿä¸€çš„æ‰“å°æ¥å£ é€šçŸ¥ï¼šorg.freedesktop.portal.Notification è·¨æ¡Œé¢ç¯å¢ƒçš„é€šçŸ¥å‘é€ ä½ç½®æœåŠ¡ï¼šorg.freedesktop.portal.Location åœ°ç†ä½ç½®ä¿¡æ¯è®¿é—® è´¦æˆ·ä¸æƒé™ï¼š è´¦æˆ·ä¿¡æ¯ï¼šorg.freedesktop.portal.Account è·å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ å¯†ç ç®¡ç†ï¼šorg.freedesktop.portal.Secret ä¸ç³»ç»Ÿå¯†é’¥ç¯é›†æˆ è®¾å¤‡æˆæƒï¼šorg.freedesktop.portal.Usb USB è®¾å¤‡ç­‰å¤–è®¾è®¿é—®æ§åˆ¶ é—¨æˆ·å®ç°ï¼šä¸åŒæ¡Œé¢ç¯å¢ƒçš„é€‚é…å™¨xdg-desktop-portal æ˜¯æ¡†æ¶æœ¬èº«ï¼Œå…·ä½“çš„åŠŸèƒ½å®ç°ç”±å„ä¸ªæ¡Œé¢ç¯å¢ƒæä¾›ï¼š xdg-desktop-portal-gtkï¼šå®ç°äº† Portal æœ€åŸºç¡€çš„åŠŸèƒ½ï¼Œæ˜¯ Niri/Hyprland ç­‰å¤§éƒ¨åˆ† Compositors çš„é»˜è®¤ Portal. xdg-desktop-portal-wlrï¼šwlroots çš„é€šç”¨ portal ç»„ä»¶ï¼Œå®ç°äº†é€šç”¨çš„å±å¹•å…±äº«ä¸æˆªå›¾ä¸¤é¡¹åŠŸèƒ½ï¼Œæ‰€æœ‰åŸºäº wlroots çš„ Compositors éƒ½å¯ä½¿ç”¨å®ƒã€‚ xdg-desktop-portal-gnomeï¼šè¢« Niri ç­‰éƒ¨åˆ† Compositor ç”¨äºå®ç°å±å¹•å…±äº«ä¸æˆªå›¾åŠŸèƒ½ã€‚ gnome-keyring: å®ç°äº† Portal çš„å¯†ç ç®¡ç† API, Niri/Hyprland ç­‰ Compositor éƒ½ä½¿ç”¨å®ƒä½œä¸ºå¯†ç ç®¡ç†ç»„ä»¶ã€‚ ä¸å¤šåª’ä½“å’Œ PipeWire çš„å…³ç³»åœ¨åç»­çš„å¤šåª’ä½“ç« èŠ‚ä¸­ä¼šè¯¦ç»†ä»‹ç»ï¼ŒPipeWire çš„å±å¹•å…±äº«åŠŸèƒ½å®Œå…¨ä¾èµ– xdg-desktop-portalï¼š å±å¹•æ•è·æµç¨‹ï¼šè§†é¢‘ä¼šè®®è½¯ä»¶ â†’ PipeWire â†’ xdg-desktop-portal â†’ ç”¨æˆ·æˆæƒ â†’ åˆæˆå™¨æä¾›å±å¹•å†…å®¹ æƒé™ç®¡ç†ï¼šç”¨æˆ·å¯ä»¥ç²¾ç»†æ§åˆ¶å“ªäº›åº”ç”¨å¯ä»¥è®¿é—®å±å¹•ï¼Œä»¥åŠè®¿é—®çš„èŒƒå›´ å®‰å…¨ä¿è¯ï¼šå³ä½¿åº”ç”¨è·å¾—äº†å±å¹•è®¿é—®æƒé™ï¼Œä¹Ÿåªèƒ½åœ¨ç”¨æˆ·æˆæƒçš„èŒƒå›´å†…å·¥ä½œ è¿™ç§è®¾è®¡è§£å†³äº† Wayland éš”ç¦»åŸåˆ™ä¸å®é™…åŠŸèƒ½éœ€æ±‚çš„çŸ›ç›¾ï¼Œæ˜¯å…¸å‹çš„\"å®‰å…¨ä¸ä¾¿åˆ©çš„å¹³è¡¡\"æ–¹æ¡ˆã€‚ å·¥ä½œåŸç†ä¸é€šä¿¡æµç¨‹å…¸å‹äº¤äº’æµç¨‹ï¼š åº”ç”¨å‘èµ·è¯·æ±‚ï¼šåº”ç”¨é€šè¿‡ D-Bus è°ƒç”¨ç›¸åº”çš„é—¨æˆ·æ¥å£ é—¨æˆ·æœåŠ¡è½¬å‘ï¼šxdg-desktop-portal æ ¹æ®é…ç½®å°†è¯·æ±‚è½¬å‘ç»™å¯¹åº”çš„å®ç° ç”¨æˆ·ç•Œé¢æ˜¾ç¤ºï¼šå…·ä½“å®ç°æ˜¾ç¤ºåŸç”Ÿå¯¹è¯æ¡†ï¼Œè¯·æ±‚ç”¨æˆ·æˆæƒ æƒé™æˆäºˆï¼šç”¨æˆ·ç¡®è®¤åï¼Œé—¨æˆ·æœåŠ¡è¿”å›æˆæƒä»¤ç‰Œæˆ–ç»“æœ èµ„æºè®¿é—®ï¼šåº”ç”¨ä½¿ç”¨ä»¤ç‰Œé€šè¿‡å—é™æ¥å£è®¿é—®èµ„æº D-Bus æ¶æ„ï¼š bash # æŸ¥çœ‹å·²å®‰è£…çš„é—¨æˆ·å®ç° ls /usr/share/xdg-desktop-portal/portals/ # æˆ–åœ¨ NixOS ä¸Š ls /run/current-system/sw/share/xdg-desktop-portal/portals/ # æŸ¥çœ‹å½“å‰æ¿€æ´»çš„é—¨æˆ· busctl --user list-units | grep portal # ç›‘æ§é—¨æˆ·æ´»åŠ¨ busctl monitor --user org.freedesktop.portal.* é…ç½®ä¸æ•…éšœæ’æŸ¥ä¼˜å…ˆçº§é…ç½®ï¼š ç³»ç»ŸæŒ‰ä¼˜å…ˆçº§é€‰æ‹©é—¨æˆ·å®ç°ï¼Œä¼˜å…ˆçº§æ–‡ä»¶é€šå¸¸ä½äºï¼š bash # ç³»ç»Ÿçº§é…ç½® /etc/xdg-desktop-portal/*-portals.conf # ç”¨æˆ·çº§é…ç½® ~/.config/xdg-desktop-portal/*-portals.conf å¸¸è§é—®é¢˜æ’æŸ¥ï¼š bash # æ£€æŸ¥é—¨æˆ·æœåŠ¡çŠ¶æ€ systemctl --user status xdg-desktop-portal systemctl --user status xdg-desktop-portal-gtk systemctl --user status xdg-desktop-portal-gnome # æŸ¥çœ‹é—¨æˆ·æ—¥å¿— journalctl --user -u xdg-desktop-portal -f # æµ‹è¯•é—¨æˆ·åŠŸèƒ½ gdbus introspect --session --dest org.freedesktop.portal.Desktop \\ --object-path /org/freedesktop/portal/desktop # æ£€æŸ¥ç‰¹å®šé—¨æˆ·æ”¯æŒ gdbus call --session --dest org.freedesktop.portal.Desktop \\ --object-path /org/freedesktop/portal/desktop \\ --method org.freedesktop.portal.Request.Response NixOS é…ç½®ç¤ºä¾‹ï¼š nix { # å¯ç”¨ xdg-desktop-portal æœåŠ¡ xdg.portal = { enable = true; extraPortals = with pkgs; [ xdg-desktop-portal-gtk # GTK é—¨æˆ· xdg-desktop-portal-wlr # Wayland åˆæˆå™¨é—¨æˆ· ]; xdgOpenUsePortal = true; # ä½¿ç”¨é—¨æˆ·å¤„ç† xdg-open }; } ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:5:4","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#ä¸å¤šåª’ä½“å’Œ-pipewire-çš„å…³ç³»"},{"categories":["tech"],"content":" 4.4 xdg-desktop-portalï¼šWayland æ¡Œé¢è®¿é—®æ§åˆ¶XDG Desktop Portal æ˜¯ä¸€å¥—ç”¨äºåœ¨ Linux æ¡Œé¢ç¯å¢ƒä¸‹æä¾›ç»Ÿä¸€å®‰å…¨æ¥å£çš„æ¡†æ¶ï¼Œæœ€åˆä¸º Flatpak ç­‰æ²™ç›’åº”ç”¨è®¿é—®æ²™ç®±å¤–éƒ¨èµ„æºè€Œè®¾è®¡ã€‚å®ƒé€šè¿‡ D-Bus æš´éœ²ä¸€ç³»åˆ—ã€Œé—¨æˆ·ï¼ˆPortalï¼‰ã€æ¥å£ï¼Œè®©æ²™ç®±åŒ–æˆ–å—é™åº”ç”¨èƒ½å¤Ÿå®‰å…¨åœ°è¯·æ±‚æ–‡ä»¶é€‰æ‹©ã€æˆªå›¾ã€å±å¹•å…±äº«ã€æ‰“å¼€ URI ç­‰æ“ä½œã€‚ åœ¨ Wayland ç¯å¢ƒä¸‹ï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºåªèƒ½è®¿é—®è‡ªå·±çš„çª—å£ã€é”®ç›˜é¼ æ ‡äº‹ä»¶ç­‰ç­‰ï¼Œæ— æ³•éšæ„æˆªå±æˆ–è®¿é—®å…¨å±€èµ„æºã€‚åœ¨ Wayland å‘å±•è¿‡ç¨‹ä¸­ï¼Œæ—©æœŸå„ DE ä¸ WM å„è‡ªä¸ºæˆ˜ï¼Œå®ç°äº†è®¸å¤šç§æœ‰åè®®å»å®Œæˆè¿™äº›å·¥ä½œï¼Œç¢ç‰‡åŒ–ä¸¥é‡ã€å®¢æˆ·ç«¯ç¨‹åºå…¼å®¹å›°éš¾ã€‚ä¹‹åç¤¾åŒºé€æ¸å½¢æˆäº†ä½¿ç”¨ XDG Desktop Portal ä½œä¸ºæ¡Œé¢è®¿é—®æ§åˆ¶æ¡†æ¶çš„å…±è¯†ï¼Œå¦‚ä»Šå‡ ä¹æ‰€æœ‰çš„ DE/WM ä¸å®¢æˆ·ç«¯åº”ç”¨éƒ½å¹¿æ³›é‡‡ç”¨äº†è¿™ä¸€æ¡†æ¶ï¼Œå®ƒå·²æˆä¸º Wayland ä¸­èµ„æºè®¿é—®æ§åˆ¶çš„äº‹å®æ ‡å‡†ã€‚ å¦‚ä»Šç»å¤§éƒ¨åˆ†åº”ç”¨åœ¨ X11 ç¯å¢ƒä¸‹ä»ç„¶ä¼šä½¿ç”¨ X11 åŸç”Ÿæ¥å£ï¼ˆå¦‚ XShmã€XRecordã€XSelectInput ç­‰ï¼‰ å®ç°å±å¹•å…±äº«ã€æ–‡ä»¶é€‰æ‹©ã€æ‰“å¼€ URI ç­‰åŠŸèƒ½ï¼Œè€Œåœ¨ Wayland ä¸‹åˆ™å¿…é¡»ä½¿ç”¨ xdg-desktop-portal. NOTE: è®¸å¤šå‘½ä»¤è¡Œæˆªå›¾/å½•å±å·¥å…·ï¼ˆå¦‚wl-screenrec,wf-recorderï¼‰é€‰æ‹©äº†ä½¿ç”¨ wlr-screencopy-unstable-v1 / ext-image-copy-capture-v1 ç­‰ Wayland åŸç”Ÿçš„åè®®æ¥å®ç°æˆªå›¾åŠŸèƒ½ï¼Œè¿™äº›å·¥å…·å®Œå…¨ç»•è¿‡äº† XDG Desktop Portal, é€šå¸¸åªåœ¨ wlroots-based compositors ä¸Šèƒ½æ­£å¸¸ä½¿ç”¨ï¼ŒGnome/KDE ç›®å‰éƒ½è¦æ±‚èµ° Portal æ¥å£ã€ä¸æ”¯æŒæ­¤ç±»åè®®ã€‚ æ ¸å¿ƒé—¨æˆ·æœåŠ¡ https://flatpak.github.io/xdg-desktop-portal/docs/api-reference.html æ–‡ä»¶æ“ä½œï¼š æ–‡ä»¶é€‰æ‹©å™¨ï¼šorg.freedesktop.portal.FileChooser ç»Ÿä¸€çš„æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡† æ–‡ä»¶ä¼ è¾“ï¼šorg.freedesktop.portal.FileTransfer é€šè¿‡æ‹–æ‹½æˆ–å¤åˆ¶ç²˜è´´ç­‰æ–¹å¼åœ¨ Apps ä¹‹é—´ä¼ è¾“æ–‡ä»¶ å±å¹•ä¸åª’ä½“è®¿é—®ï¼š æˆªå±ï¼šorg.freedesktop.portal.Screenshot å®‰å…¨æˆªå±åŠŸèƒ½ å½•å±ï¼šorg.freedesktop.portal.ScreenCast å±å¹•å½•åˆ¶å’Œçª—å£å…±äº«ï¼Œè§†é¢‘ä¼šè®®åº”ç”¨çš„æ ¸å¿ƒä¾èµ– æ‘„åƒå¤´ï¼šorg.freedesktop.portal.Camera æ‘„åƒå¤´è®¿é—®æ§åˆ¶ ç³»ç»Ÿè®¿é—®ï¼š æ‰“å°æœºï¼šorg.freedesktop.portal.Print ç»Ÿä¸€çš„æ‰“å°æ¥å£ é€šçŸ¥ï¼šorg.freedesktop.portal.Notification è·¨æ¡Œé¢ç¯å¢ƒçš„é€šçŸ¥å‘é€ ä½ç½®æœåŠ¡ï¼šorg.freedesktop.portal.Location åœ°ç†ä½ç½®ä¿¡æ¯è®¿é—® è´¦æˆ·ä¸æƒé™ï¼š è´¦æˆ·ä¿¡æ¯ï¼šorg.freedesktop.portal.Account è·å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ å¯†ç ç®¡ç†ï¼šorg.freedesktop.portal.Secret ä¸ç³»ç»Ÿå¯†é’¥ç¯é›†æˆ è®¾å¤‡æˆæƒï¼šorg.freedesktop.portal.Usb USB è®¾å¤‡ç­‰å¤–è®¾è®¿é—®æ§åˆ¶ é—¨æˆ·å®ç°ï¼šä¸åŒæ¡Œé¢ç¯å¢ƒçš„é€‚é…å™¨xdg-desktop-portal æ˜¯æ¡†æ¶æœ¬èº«ï¼Œå…·ä½“çš„åŠŸèƒ½å®ç°ç”±å„ä¸ªæ¡Œé¢ç¯å¢ƒæä¾›ï¼š xdg-desktop-portal-gtkï¼šå®ç°äº† Portal æœ€åŸºç¡€çš„åŠŸèƒ½ï¼Œæ˜¯ Niri/Hyprland ç­‰å¤§éƒ¨åˆ† Compositors çš„é»˜è®¤ Portal. xdg-desktop-portal-wlrï¼šwlroots çš„é€šç”¨ portal ç»„ä»¶ï¼Œå®ç°äº†é€šç”¨çš„å±å¹•å…±äº«ä¸æˆªå›¾ä¸¤é¡¹åŠŸèƒ½ï¼Œæ‰€æœ‰åŸºäº wlroots çš„ Compositors éƒ½å¯ä½¿ç”¨å®ƒã€‚ xdg-desktop-portal-gnomeï¼šè¢« Niri ç­‰éƒ¨åˆ† Compositor ç”¨äºå®ç°å±å¹•å…±äº«ä¸æˆªå›¾åŠŸèƒ½ã€‚ gnome-keyring: å®ç°äº† Portal çš„å¯†ç ç®¡ç† API, Niri/Hyprland ç­‰ Compositor éƒ½ä½¿ç”¨å®ƒä½œä¸ºå¯†ç ç®¡ç†ç»„ä»¶ã€‚ ä¸å¤šåª’ä½“å’Œ PipeWire çš„å…³ç³»åœ¨åç»­çš„å¤šåª’ä½“ç« èŠ‚ä¸­ä¼šè¯¦ç»†ä»‹ç»ï¼ŒPipeWire çš„å±å¹•å…±äº«åŠŸèƒ½å®Œå…¨ä¾èµ– xdg-desktop-portalï¼š å±å¹•æ•è·æµç¨‹ï¼šè§†é¢‘ä¼šè®®è½¯ä»¶ â†’ PipeWire â†’ xdg-desktop-portal â†’ ç”¨æˆ·æˆæƒ â†’ åˆæˆå™¨æä¾›å±å¹•å†…å®¹ æƒé™ç®¡ç†ï¼šç”¨æˆ·å¯ä»¥ç²¾ç»†æ§åˆ¶å“ªäº›åº”ç”¨å¯ä»¥è®¿é—®å±å¹•ï¼Œä»¥åŠè®¿é—®çš„èŒƒå›´ å®‰å…¨ä¿è¯ï¼šå³ä½¿åº”ç”¨è·å¾—äº†å±å¹•è®¿é—®æƒé™ï¼Œä¹Ÿåªèƒ½åœ¨ç”¨æˆ·æˆæƒçš„èŒƒå›´å†…å·¥ä½œ è¿™ç§è®¾è®¡è§£å†³äº† Wayland éš”ç¦»åŸåˆ™ä¸å®é™…åŠŸèƒ½éœ€æ±‚çš„çŸ›ç›¾ï¼Œæ˜¯å…¸å‹çš„\"å®‰å…¨ä¸ä¾¿åˆ©çš„å¹³è¡¡\"æ–¹æ¡ˆã€‚ å·¥ä½œåŸç†ä¸é€šä¿¡æµç¨‹å…¸å‹äº¤äº’æµç¨‹ï¼š åº”ç”¨å‘èµ·è¯·æ±‚ï¼šåº”ç”¨é€šè¿‡ D-Bus è°ƒç”¨ç›¸åº”çš„é—¨æˆ·æ¥å£ é—¨æˆ·æœåŠ¡è½¬å‘ï¼šxdg-desktop-portal æ ¹æ®é…ç½®å°†è¯·æ±‚è½¬å‘ç»™å¯¹åº”çš„å®ç° ç”¨æˆ·ç•Œé¢æ˜¾ç¤ºï¼šå…·ä½“å®ç°æ˜¾ç¤ºåŸç”Ÿå¯¹è¯æ¡†ï¼Œè¯·æ±‚ç”¨æˆ·æˆæƒ æƒé™æˆäºˆï¼šç”¨æˆ·ç¡®è®¤åï¼Œé—¨æˆ·æœåŠ¡è¿”å›æˆæƒä»¤ç‰Œæˆ–ç»“æœ èµ„æºè®¿é—®ï¼šåº”ç”¨ä½¿ç”¨ä»¤ç‰Œé€šè¿‡å—é™æ¥å£è®¿é—®èµ„æº D-Bus æ¶æ„ï¼š bash # æŸ¥çœ‹å·²å®‰è£…çš„é—¨æˆ·å®ç° ls /usr/share/xdg-desktop-portal/portals/ # æˆ–åœ¨ NixOS ä¸Š ls /run/current-system/sw/share/xdg-desktop-portal/portals/ # æŸ¥çœ‹å½“å‰æ¿€æ´»çš„é—¨æˆ· busctl --user list-units | grep portal # ç›‘æ§é—¨æˆ·æ´»åŠ¨ busctl monitor --user org.freedesktop.portal.* é…ç½®ä¸æ•…éšœæ’æŸ¥ä¼˜å…ˆçº§é…ç½®ï¼š ç³»ç»ŸæŒ‰ä¼˜å…ˆçº§é€‰æ‹©é—¨æˆ·å®ç°ï¼Œä¼˜å…ˆçº§æ–‡ä»¶é€šå¸¸ä½äºï¼š bash # ç³»ç»Ÿçº§é…ç½® /etc/xdg-desktop-portal/*-portals.conf # ç”¨æˆ·çº§é…ç½® ~/.config/xdg-desktop-portal/*-portals.conf å¸¸è§é—®é¢˜æ’æŸ¥ï¼š bash # æ£€æŸ¥é—¨æˆ·æœåŠ¡çŠ¶æ€ systemctl --user status xdg-desktop-portal systemctl --user status xdg-desktop-portal-gtk systemctl --user status xdg-desktop-portal-gnome # æŸ¥çœ‹é—¨æˆ·æ—¥å¿— journalctl --user -u xdg-desktop-portal -f # æµ‹è¯•é—¨æˆ·åŠŸèƒ½ gdbus introspect --session --dest org.freedesktop.portal.Desktop \\ --object-path /org/freedesktop/portal/desktop # æ£€æŸ¥ç‰¹å®šé—¨æˆ·æ”¯æŒ gdbus call --session --dest org.freedesktop.portal.Desktop \\ --object-path /org/freedesktop/portal/desktop \\ --method org.freedesktop.portal.Request.Response NixOS é…ç½®ç¤ºä¾‹ï¼š nix { # å¯ç”¨ xdg-desktop-portal æœåŠ¡ xdg.portal = { enable = true; extraPortals = with pkgs; [ xdg-desktop-portal-gtk # GTK é—¨æˆ· xdg-desktop-portal-wlr # Wayland åˆæˆå™¨é—¨æˆ· ]; xdgOpenUsePortal = true; # ä½¿ç”¨é—¨æˆ·å¤„ç† xdg-open }; } ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:5:4","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#å·¥ä½œåŸç†ä¸é€šä¿¡æµç¨‹"},{"categories":["tech"],"content":" 4.4 xdg-desktop-portalï¼šWayland æ¡Œé¢è®¿é—®æ§åˆ¶XDG Desktop Portal æ˜¯ä¸€å¥—ç”¨äºåœ¨ Linux æ¡Œé¢ç¯å¢ƒä¸‹æä¾›ç»Ÿä¸€å®‰å…¨æ¥å£çš„æ¡†æ¶ï¼Œæœ€åˆä¸º Flatpak ç­‰æ²™ç›’åº”ç”¨è®¿é—®æ²™ç®±å¤–éƒ¨èµ„æºè€Œè®¾è®¡ã€‚å®ƒé€šè¿‡ D-Bus æš´éœ²ä¸€ç³»åˆ—ã€Œé—¨æˆ·ï¼ˆPortalï¼‰ã€æ¥å£ï¼Œè®©æ²™ç®±åŒ–æˆ–å—é™åº”ç”¨èƒ½å¤Ÿå®‰å…¨åœ°è¯·æ±‚æ–‡ä»¶é€‰æ‹©ã€æˆªå›¾ã€å±å¹•å…±äº«ã€æ‰“å¼€ URI ç­‰æ“ä½œã€‚ åœ¨ Wayland ç¯å¢ƒä¸‹ï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºåªèƒ½è®¿é—®è‡ªå·±çš„çª—å£ã€é”®ç›˜é¼ æ ‡äº‹ä»¶ç­‰ç­‰ï¼Œæ— æ³•éšæ„æˆªå±æˆ–è®¿é—®å…¨å±€èµ„æºã€‚åœ¨ Wayland å‘å±•è¿‡ç¨‹ä¸­ï¼Œæ—©æœŸå„ DE ä¸ WM å„è‡ªä¸ºæˆ˜ï¼Œå®ç°äº†è®¸å¤šç§æœ‰åè®®å»å®Œæˆè¿™äº›å·¥ä½œï¼Œç¢ç‰‡åŒ–ä¸¥é‡ã€å®¢æˆ·ç«¯ç¨‹åºå…¼å®¹å›°éš¾ã€‚ä¹‹åç¤¾åŒºé€æ¸å½¢æˆäº†ä½¿ç”¨ XDG Desktop Portal ä½œä¸ºæ¡Œé¢è®¿é—®æ§åˆ¶æ¡†æ¶çš„å…±è¯†ï¼Œå¦‚ä»Šå‡ ä¹æ‰€æœ‰çš„ DE/WM ä¸å®¢æˆ·ç«¯åº”ç”¨éƒ½å¹¿æ³›é‡‡ç”¨äº†è¿™ä¸€æ¡†æ¶ï¼Œå®ƒå·²æˆä¸º Wayland ä¸­èµ„æºè®¿é—®æ§åˆ¶çš„äº‹å®æ ‡å‡†ã€‚ å¦‚ä»Šç»å¤§éƒ¨åˆ†åº”ç”¨åœ¨ X11 ç¯å¢ƒä¸‹ä»ç„¶ä¼šä½¿ç”¨ X11 åŸç”Ÿæ¥å£ï¼ˆå¦‚ XShmã€XRecordã€XSelectInput ç­‰ï¼‰ å®ç°å±å¹•å…±äº«ã€æ–‡ä»¶é€‰æ‹©ã€æ‰“å¼€ URI ç­‰åŠŸèƒ½ï¼Œè€Œåœ¨ Wayland ä¸‹åˆ™å¿…é¡»ä½¿ç”¨ xdg-desktop-portal. NOTE: è®¸å¤šå‘½ä»¤è¡Œæˆªå›¾/å½•å±å·¥å…·ï¼ˆå¦‚wl-screenrec,wf-recorderï¼‰é€‰æ‹©äº†ä½¿ç”¨ wlr-screencopy-unstable-v1 / ext-image-copy-capture-v1 ç­‰ Wayland åŸç”Ÿçš„åè®®æ¥å®ç°æˆªå›¾åŠŸèƒ½ï¼Œè¿™äº›å·¥å…·å®Œå…¨ç»•è¿‡äº† XDG Desktop Portal, é€šå¸¸åªåœ¨ wlroots-based compositors ä¸Šèƒ½æ­£å¸¸ä½¿ç”¨ï¼ŒGnome/KDE ç›®å‰éƒ½è¦æ±‚èµ° Portal æ¥å£ã€ä¸æ”¯æŒæ­¤ç±»åè®®ã€‚ æ ¸å¿ƒé—¨æˆ·æœåŠ¡ https://flatpak.github.io/xdg-desktop-portal/docs/api-reference.html æ–‡ä»¶æ“ä½œï¼š æ–‡ä»¶é€‰æ‹©å™¨ï¼šorg.freedesktop.portal.FileChooser ç»Ÿä¸€çš„æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡† æ–‡ä»¶ä¼ è¾“ï¼šorg.freedesktop.portal.FileTransfer é€šè¿‡æ‹–æ‹½æˆ–å¤åˆ¶ç²˜è´´ç­‰æ–¹å¼åœ¨ Apps ä¹‹é—´ä¼ è¾“æ–‡ä»¶ å±å¹•ä¸åª’ä½“è®¿é—®ï¼š æˆªå±ï¼šorg.freedesktop.portal.Screenshot å®‰å…¨æˆªå±åŠŸèƒ½ å½•å±ï¼šorg.freedesktop.portal.ScreenCast å±å¹•å½•åˆ¶å’Œçª—å£å…±äº«ï¼Œè§†é¢‘ä¼šè®®åº”ç”¨çš„æ ¸å¿ƒä¾èµ– æ‘„åƒå¤´ï¼šorg.freedesktop.portal.Camera æ‘„åƒå¤´è®¿é—®æ§åˆ¶ ç³»ç»Ÿè®¿é—®ï¼š æ‰“å°æœºï¼šorg.freedesktop.portal.Print ç»Ÿä¸€çš„æ‰“å°æ¥å£ é€šçŸ¥ï¼šorg.freedesktop.portal.Notification è·¨æ¡Œé¢ç¯å¢ƒçš„é€šçŸ¥å‘é€ ä½ç½®æœåŠ¡ï¼šorg.freedesktop.portal.Location åœ°ç†ä½ç½®ä¿¡æ¯è®¿é—® è´¦æˆ·ä¸æƒé™ï¼š è´¦æˆ·ä¿¡æ¯ï¼šorg.freedesktop.portal.Account è·å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ å¯†ç ç®¡ç†ï¼šorg.freedesktop.portal.Secret ä¸ç³»ç»Ÿå¯†é’¥ç¯é›†æˆ è®¾å¤‡æˆæƒï¼šorg.freedesktop.portal.Usb USB è®¾å¤‡ç­‰å¤–è®¾è®¿é—®æ§åˆ¶ é—¨æˆ·å®ç°ï¼šä¸åŒæ¡Œé¢ç¯å¢ƒçš„é€‚é…å™¨xdg-desktop-portal æ˜¯æ¡†æ¶æœ¬èº«ï¼Œå…·ä½“çš„åŠŸèƒ½å®ç°ç”±å„ä¸ªæ¡Œé¢ç¯å¢ƒæä¾›ï¼š xdg-desktop-portal-gtkï¼šå®ç°äº† Portal æœ€åŸºç¡€çš„åŠŸèƒ½ï¼Œæ˜¯ Niri/Hyprland ç­‰å¤§éƒ¨åˆ† Compositors çš„é»˜è®¤ Portal. xdg-desktop-portal-wlrï¼šwlroots çš„é€šç”¨ portal ç»„ä»¶ï¼Œå®ç°äº†é€šç”¨çš„å±å¹•å…±äº«ä¸æˆªå›¾ä¸¤é¡¹åŠŸèƒ½ï¼Œæ‰€æœ‰åŸºäº wlroots çš„ Compositors éƒ½å¯ä½¿ç”¨å®ƒã€‚ xdg-desktop-portal-gnomeï¼šè¢« Niri ç­‰éƒ¨åˆ† Compositor ç”¨äºå®ç°å±å¹•å…±äº«ä¸æˆªå›¾åŠŸèƒ½ã€‚ gnome-keyring: å®ç°äº† Portal çš„å¯†ç ç®¡ç† API, Niri/Hyprland ç­‰ Compositor éƒ½ä½¿ç”¨å®ƒä½œä¸ºå¯†ç ç®¡ç†ç»„ä»¶ã€‚ ä¸å¤šåª’ä½“å’Œ PipeWire çš„å…³ç³»åœ¨åç»­çš„å¤šåª’ä½“ç« èŠ‚ä¸­ä¼šè¯¦ç»†ä»‹ç»ï¼ŒPipeWire çš„å±å¹•å…±äº«åŠŸèƒ½å®Œå…¨ä¾èµ– xdg-desktop-portalï¼š å±å¹•æ•è·æµç¨‹ï¼šè§†é¢‘ä¼šè®®è½¯ä»¶ â†’ PipeWire â†’ xdg-desktop-portal â†’ ç”¨æˆ·æˆæƒ â†’ åˆæˆå™¨æä¾›å±å¹•å†…å®¹ æƒé™ç®¡ç†ï¼šç”¨æˆ·å¯ä»¥ç²¾ç»†æ§åˆ¶å“ªäº›åº”ç”¨å¯ä»¥è®¿é—®å±å¹•ï¼Œä»¥åŠè®¿é—®çš„èŒƒå›´ å®‰å…¨ä¿è¯ï¼šå³ä½¿åº”ç”¨è·å¾—äº†å±å¹•è®¿é—®æƒé™ï¼Œä¹Ÿåªèƒ½åœ¨ç”¨æˆ·æˆæƒçš„èŒƒå›´å†…å·¥ä½œ è¿™ç§è®¾è®¡è§£å†³äº† Wayland éš”ç¦»åŸåˆ™ä¸å®é™…åŠŸèƒ½éœ€æ±‚çš„çŸ›ç›¾ï¼Œæ˜¯å…¸å‹çš„\"å®‰å…¨ä¸ä¾¿åˆ©çš„å¹³è¡¡\"æ–¹æ¡ˆã€‚ å·¥ä½œåŸç†ä¸é€šä¿¡æµç¨‹å…¸å‹äº¤äº’æµç¨‹ï¼š åº”ç”¨å‘èµ·è¯·æ±‚ï¼šåº”ç”¨é€šè¿‡ D-Bus è°ƒç”¨ç›¸åº”çš„é—¨æˆ·æ¥å£ é—¨æˆ·æœåŠ¡è½¬å‘ï¼šxdg-desktop-portal æ ¹æ®é…ç½®å°†è¯·æ±‚è½¬å‘ç»™å¯¹åº”çš„å®ç° ç”¨æˆ·ç•Œé¢æ˜¾ç¤ºï¼šå…·ä½“å®ç°æ˜¾ç¤ºåŸç”Ÿå¯¹è¯æ¡†ï¼Œè¯·æ±‚ç”¨æˆ·æˆæƒ æƒé™æˆäºˆï¼šç”¨æˆ·ç¡®è®¤åï¼Œé—¨æˆ·æœåŠ¡è¿”å›æˆæƒä»¤ç‰Œæˆ–ç»“æœ èµ„æºè®¿é—®ï¼šåº”ç”¨ä½¿ç”¨ä»¤ç‰Œé€šè¿‡å—é™æ¥å£è®¿é—®èµ„æº D-Bus æ¶æ„ï¼š bash # æŸ¥çœ‹å·²å®‰è£…çš„é—¨æˆ·å®ç° ls /usr/share/xdg-desktop-portal/portals/ # æˆ–åœ¨ NixOS ä¸Š ls /run/current-system/sw/share/xdg-desktop-portal/portals/ # æŸ¥çœ‹å½“å‰æ¿€æ´»çš„é—¨æˆ· busctl --user list-units | grep portal # ç›‘æ§é—¨æˆ·æ´»åŠ¨ busctl monitor --user org.freedesktop.portal.* é…ç½®ä¸æ•…éšœæ’æŸ¥ä¼˜å…ˆçº§é…ç½®ï¼š ç³»ç»ŸæŒ‰ä¼˜å…ˆçº§é€‰æ‹©é—¨æˆ·å®ç°ï¼Œä¼˜å…ˆçº§æ–‡ä»¶é€šå¸¸ä½äºï¼š bash # ç³»ç»Ÿçº§é…ç½® /etc/xdg-desktop-portal/*-portals.conf # ç”¨æˆ·çº§é…ç½® ~/.config/xdg-desktop-portal/*-portals.conf å¸¸è§é—®é¢˜æ’æŸ¥ï¼š bash # æ£€æŸ¥é—¨æˆ·æœåŠ¡çŠ¶æ€ systemctl --user status xdg-desktop-portal systemctl --user status xdg-desktop-portal-gtk systemctl --user status xdg-desktop-portal-gnome # æŸ¥çœ‹é—¨æˆ·æ—¥å¿— journalctl --user -u xdg-desktop-portal -f # æµ‹è¯•é—¨æˆ·åŠŸèƒ½ gdbus introspect --session --dest org.freedesktop.portal.Desktop \\ --object-path /org/freedesktop/portal/desktop # æ£€æŸ¥ç‰¹å®šé—¨æˆ·æ”¯æŒ gdbus call --session --dest org.freedesktop.portal.Desktop \\ --object-path /org/freedesktop/portal/desktop \\ --method org.freedesktop.portal.Request.Response NixOS é…ç½®ç¤ºä¾‹ï¼š nix { # å¯ç”¨ xdg-desktop-portal æœåŠ¡ xdg.portal = { enable = true; extraPortals = with pkgs; [ xdg-desktop-portal-gtk # GTK é—¨æˆ· xdg-desktop-portal-wlr # Wayland åˆæˆå™¨é—¨æˆ· ]; xdgOpenUsePortal = true; # ä½¿ç”¨é—¨æˆ·å¤„ç† xdg-open }; } ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:5:4","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#é…ç½®ä¸æ•…éšœæ’æŸ¥"},{"categories":["tech"],"content":" åº”ç”¨ç¨‹åºä¸å·¥å…·åŒ…GUI åº”ç”¨ç¨‹åºæ˜¯ç”¨æˆ·ä¸ Linux æ¡Œé¢äº¤äº’çš„ä¸»è¦æ–¹å¼ã€‚åœ¨ Wayland ç¯å¢ƒä¸‹ï¼Œåº”ç”¨é€šè¿‡æ ‡å‡†åŒ–çš„åè®®ä¸åˆæˆå™¨é€šä¿¡ï¼Œå®ç°çª—å£ç®¡ç†ã€è¾“å…¥å¤„ç†å’Œå›¾å½¢æ¸²æŸ“ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:6:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#åº”ç”¨ç¨‹åºä¸å·¥å…·åŒ…"},{"categories":["tech"],"content":" 5.1 åº”ç”¨å¯åŠ¨æµç¨‹æ ‡å‡†å¯åŠ¨è¿‡ç¨‹ï¼š ç¯å¢ƒå‡†å¤‡ï¼š è®¾ç½® WAYLAND_DISPLAY å’Œ XDG_RUNTIME_DIR åŠ è½½å›¾å½¢å·¥å…·åŒ…åº“ï¼ˆGTK/Qtï¼‰ åˆå§‹åŒ– Wayland è¿æ¥ çª—å£åˆ›å»ºï¼š åˆ›å»º Wayland è¡¨é¢ è®¾ç½®çª—å£å±æ€§å’Œè£…é¥° æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨ æ¸²æŸ“åˆå§‹åŒ–ï¼š åˆ›å»º EGL ä¸Šä¸‹æ–‡ åŠ è½½ Mesa é©±åŠ¨ é…ç½®å›¾å½¢ç¼“å†²åŒº å†…å®¹ç»˜åˆ¶ï¼š åº”ç”¨è°ƒç”¨ OpenGL/Vulkan API ç»˜åˆ¶ç•Œé¢å†…å®¹ Mesa å°† API è°ƒç”¨è½¬æ¢ä¸º GPU æŒ‡ä»¤ åœ¨ GPU ä¸Šæ‰§è¡Œæ¸²æŸ“ï¼Œç”Ÿæˆå¸§ç¼“å†²æ•°æ® åº”ç”¨å°†æ¸²æŸ“å®Œæˆçš„ç¼“å†²åŒºæäº¤ç»™åˆæˆå™¨ åˆæˆä¸å±•ç¤ºï¼š åˆæˆå™¨æ¥æ”¶ç¼“å†²åŒºåè¿›è¡Œæœ€ç»ˆåˆæˆå’Œæ˜¾ç¤º åˆæˆå™¨å°†å¤šä¸ªåº”ç”¨çš„ç¼“å†²åŒºç»„åˆæˆæœ€ç»ˆå¸§ é€šè¿‡ DRM/KMS å°†æœ€ç»ˆå¸§æäº¤åˆ°æ˜¾ç¤ºè®¾å¤‡ è°ƒè¯•å¯åŠ¨é—®é¢˜ï¼š bash # æŸ¥çœ‹ Wayland ç¯å¢ƒ echo $WAYLAND_DISPLAY $XDG_RUNTIME_DIR # æ£€æŸ¥åº”ç”¨æ—¥å¿— journalctl --user -u \u003capplication\u003e.service # Wayland è°ƒè¯•å˜é‡ export WAYLAND_DEBUG=1 export MESA_DEBUG=1 # è·Ÿè¸ªç³»ç»Ÿè°ƒç”¨ strace -f -e trace=network,ipc \u003capplication\u003e ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:6:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#51-åº”ç”¨å¯åŠ¨æµç¨‹"},{"categories":["tech"],"content":" 5.2 å·¥å…·åŒ…æ”¯æŒGTK åº”ç”¨ï¼š GTK3/4 åŸç”Ÿæ”¯æŒ Wayland è‡ªåŠ¨æ£€æµ‹è¿è¡Œç¯å¢ƒ å¯é€šè¿‡ GDK_BACKEND å¼ºåˆ¶æŒ‡å®šåç«¯ bash # å¼ºåˆ¶ä½¿ç”¨ Wayland GDK_BACKEND=wayland gtk-application # å¼ºåˆ¶ä½¿ç”¨ X11ï¼ˆé€šè¿‡ Xwaylandï¼‰ GDK_BACKEND=x11 gtk-application Qt åº”ç”¨ï¼š Qt5/6 æ”¯æŒ Wayland éœ€è¦å®‰è£… Wayland å¹³å°æ’ä»¶ è‡ªåŠ¨é€‰æ‹©æœ€ä½³åç«¯ bash # æŸ¥çœ‹ Qt å¹³å°æ’ä»¶ï¼ˆNixOSï¼‰ ls /run/current-system/sw/lib/qt*/plugins/platforms/ # ä¼ ç»Ÿå‘è¡Œç‰ˆ ls /usr/lib/qt*/plugins/platforms/ # Qt è°ƒè¯•ä¿¡æ¯ export QT_LOGGING_RULES=\"qt.qpa.*=true\" SDL åº”ç”¨ï¼š SDL2 å†…ç½® Wayland æ”¯æŒ ä¸»è¦ç”¨äºæ¸¸æˆå’Œå¤šåª’ä½“åº”ç”¨ è‡ªåŠ¨é€‚é…è¿è¡Œç¯å¢ƒ ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:6:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#52-å·¥å…·åŒ…æ”¯æŒ"},{"categories":["tech"],"content":" å›¾å½¢æ ˆè°ƒè¯•ä¸ä¼˜åŒ–","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:7:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#å›¾å½¢æ ˆè°ƒè¯•ä¸ä¼˜åŒ–"},{"categories":["tech"],"content":" 6.1 å›¾å½¢é©±åŠ¨ä¿¡æ¯æŸ¥è¯¢é¦–å…ˆï¼Œéœ€è¦åˆ¤æ–­æ‚¨å½“å‰æ‰€å¤„çš„ç¯å¢ƒã€‚åœ¨ç»ˆç«¯ä¸­è¿è¡Œ tty å‘½ä»¤ï¼š è¾“å‡º /dev/pts/0 ç­‰ï¼šæ‚¨åœ¨å›¾å½¢ç•Œé¢ä¸‹çš„ä¼ª TTY (pts) ä¸­ã€‚ è¾“å‡º /dev/tty1 ç­‰ï¼šæ‚¨åœ¨ Ctrl+Alt+F1 åˆ‡æ¢çš„è™šæ‹Ÿ TTY (tty) æ–‡æœ¬æ§åˆ¶å°ä¸­ã€‚ 1. åˆ¤æ–­å›¾å½¢ä¼šè¯ (pts) é©±åŠ¨åœ¨ä¼ª TTY ä¸­ï¼Œæ‚¨æŸ¥è¯¢çš„æ˜¯æ•´ä¸ªå›¾å½¢ç•Œé¢çš„å†…æ ¸ DRM é©±åŠ¨ï¼š bash lspci -k | grep -A 3 -i vga ç¤ºä¾‹è¾“å‡ºï¼š text 01:00.0 VGA compatible controller: NVIDIA Corporation GP107 [GeForce GTX 1050 Ti] (rev a1) Subsystem: ZOTAC International (MCO) Ltd. GP107 [GeForce GTX 1050 Ti] Kernel driver in use: nvidia Kernel modules: nvidiafb, nouveau, nvidia_drm, nvidia Kernel driver in use: nvidiaï¼šè¡¨æ˜ NVIDIA ä¸“æœ‰é©±åŠ¨æ­£åœ¨ä½¿ç”¨ã€‚ å¸¸è§çš„é©±åŠ¨æœ‰ï¼ši915 (Intel), amdgpu (AMD), nouveau (NVIDIA å¼€æº), nvidia (NVIDIA ä¸“æœ‰)ã€‚ 2. åˆ¤æ–­æ–‡æœ¬æ§åˆ¶å° (tty) é©±åŠ¨åœ¨è™šæ‹Ÿ TTY ä¸­ï¼ˆæˆ–åœ¨ pts ä¸­æŸ¥è¯¢ TTY çš„æ—¥å¿—ï¼‰ï¼Œæ‚¨æŸ¥è¯¢çš„æ˜¯å¸§ç¼“å†² é©±åŠ¨ï¼š bash dmesg | grep -i fbcon å¸¸è§çš„è¾“å‡ºåŠå«ä¹‰ï¼š ç°ä»£ DRM é©±åŠ¨ (æœ€ä¼˜æƒ…å†µ): text [ 20.709925] fbcon: nvidia-drmdrmfb (fb0) is primary device æˆ– text [ 1.512345] fbcon: i915drmfb (fb0) is primary device å«ä¹‰ï¼šfbcon å·²ç»‘å®šåˆ°ä¸»å†…æ ¸å›¾å½¢é©±åŠ¨ï¼ˆnvidia-drm æˆ– i915ï¼‰æä¾›çš„å¸§ç¼“å†²åŒº ï¼ˆdrmfbï¼‰ä¸Šã€‚è¿™è¡¨æ˜ KMS å·²æ­£å¸¸å¯åŠ¨ï¼Œæ–‡æœ¬æ§åˆ¶å°å°†ä½¿ç”¨æ˜¾ç¤ºå™¨åŸç”Ÿåˆ†è¾¨ç‡ï¼Œä¸” TTY åˆ‡æ¢ ï¼ˆCtrl+Alt+F...ï¼‰ä¼šéå¸¸å¹³æ»‘ã€‚ UEFI å›ºä»¶é©±åŠ¨ (UEFI å›é€€æƒ…å†µ): text [ 1.234567] fbcon: efifb (fb0) is primary device å«ä¹‰ï¼šfbcon æ­£åœ¨ä½¿ç”¨ UEFI å›ºä»¶æä¾›çš„å¸§ç¼“å†²åŒºï¼ˆefifbï¼‰ã€‚è¿™é€šå¸¸å‘ç”Ÿåœ¨å†…æ ¸çš„ DRM é©±åŠ¨å°šæœªåŠ è½½æˆ–è¢« nomodeset å‚æ•°ç¦ç”¨æ—¶ã€‚ ä¼ ç»Ÿ VESA é©±åŠ¨ (legacyBIOS å›é€€æƒ…å†µ): text [ 1.345678] fbcon: vesafb (fb0) is primary device å«ä¹‰ï¼šfbcon æ­£åœ¨ä½¿ç”¨ vesafb é©±åŠ¨ï¼Œé€šè¿‡ VBE æ¥å£å·¥ä½œã€‚ 3. å…¶ä»–é©±åŠ¨ä¿¡æ¯æŸ¥è¯¢ bash # æŸ¥çœ‹ DRM è®¾å¤‡æ–‡ä»¶ ls -la /dev/dri/ # æŸ¥çœ‹ Mesa/OpenGL renderer ä¿¡æ¯ glxinfo | grep \"OpenGL renderer\" # æŸ¥çœ‹ Vulkan GPU ä¿¡æ¯ vulkaninfo | grep \"GPU id\" ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:7:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#61-å›¾å½¢é©±åŠ¨ä¿¡æ¯æŸ¥è¯¢"},{"categories":["tech"],"content":" 6.1 å›¾å½¢é©±åŠ¨ä¿¡æ¯æŸ¥è¯¢é¦–å…ˆï¼Œéœ€è¦åˆ¤æ–­æ‚¨å½“å‰æ‰€å¤„çš„ç¯å¢ƒã€‚åœ¨ç»ˆç«¯ä¸­è¿è¡Œ tty å‘½ä»¤ï¼š è¾“å‡º /dev/pts/0 ç­‰ï¼šæ‚¨åœ¨å›¾å½¢ç•Œé¢ä¸‹çš„ä¼ª TTY (pts) ä¸­ã€‚ è¾“å‡º /dev/tty1 ç­‰ï¼šæ‚¨åœ¨ Ctrl+Alt+F1 åˆ‡æ¢çš„è™šæ‹Ÿ TTY (tty) æ–‡æœ¬æ§åˆ¶å°ä¸­ã€‚ 1. åˆ¤æ–­å›¾å½¢ä¼šè¯ (pts) é©±åŠ¨åœ¨ä¼ª TTY ä¸­ï¼Œæ‚¨æŸ¥è¯¢çš„æ˜¯æ•´ä¸ªå›¾å½¢ç•Œé¢çš„å†…æ ¸ DRM é©±åŠ¨ï¼š bash lspci -k | grep -A 3 -i vga ç¤ºä¾‹è¾“å‡ºï¼š text 01:00.0 VGA compatible controller: NVIDIA Corporation GP107 [GeForce GTX 1050 Ti] (rev a1) Subsystem: ZOTAC International (MCO) Ltd. GP107 [GeForce GTX 1050 Ti] Kernel driver in use: nvidia Kernel modules: nvidiafb, nouveau, nvidia_drm, nvidia Kernel driver in use: nvidiaï¼šè¡¨æ˜ NVIDIA ä¸“æœ‰é©±åŠ¨æ­£åœ¨ä½¿ç”¨ã€‚ å¸¸è§çš„é©±åŠ¨æœ‰ï¼ši915 (Intel), amdgpu (AMD), nouveau (NVIDIA å¼€æº), nvidia (NVIDIA ä¸“æœ‰)ã€‚ 2. åˆ¤æ–­æ–‡æœ¬æ§åˆ¶å° (tty) é©±åŠ¨åœ¨è™šæ‹Ÿ TTY ä¸­ï¼ˆæˆ–åœ¨ pts ä¸­æŸ¥è¯¢ TTY çš„æ—¥å¿—ï¼‰ï¼Œæ‚¨æŸ¥è¯¢çš„æ˜¯å¸§ç¼“å†² é©±åŠ¨ï¼š bash dmesg | grep -i fbcon å¸¸è§çš„è¾“å‡ºåŠå«ä¹‰ï¼š ç°ä»£ DRM é©±åŠ¨ (æœ€ä¼˜æƒ…å†µ): text [ 20.709925] fbcon: nvidia-drmdrmfb (fb0) is primary device æˆ– text [ 1.512345] fbcon: i915drmfb (fb0) is primary device å«ä¹‰ï¼šfbcon å·²ç»‘å®šåˆ°ä¸»å†…æ ¸å›¾å½¢é©±åŠ¨ï¼ˆnvidia-drm æˆ– i915ï¼‰æä¾›çš„å¸§ç¼“å†²åŒº ï¼ˆdrmfbï¼‰ä¸Šã€‚è¿™è¡¨æ˜ KMS å·²æ­£å¸¸å¯åŠ¨ï¼Œæ–‡æœ¬æ§åˆ¶å°å°†ä½¿ç”¨æ˜¾ç¤ºå™¨åŸç”Ÿåˆ†è¾¨ç‡ï¼Œä¸” TTY åˆ‡æ¢ ï¼ˆCtrl+Alt+F...ï¼‰ä¼šéå¸¸å¹³æ»‘ã€‚ UEFI å›ºä»¶é©±åŠ¨ (UEFI å›é€€æƒ…å†µ): text [ 1.234567] fbcon: efifb (fb0) is primary device å«ä¹‰ï¼šfbcon æ­£åœ¨ä½¿ç”¨ UEFI å›ºä»¶æä¾›çš„å¸§ç¼“å†²åŒºï¼ˆefifbï¼‰ã€‚è¿™é€šå¸¸å‘ç”Ÿåœ¨å†…æ ¸çš„ DRM é©±åŠ¨å°šæœªåŠ è½½æˆ–è¢« nomodeset å‚æ•°ç¦ç”¨æ—¶ã€‚ ä¼ ç»Ÿ VESA é©±åŠ¨ (legacyBIOS å›é€€æƒ…å†µ): text [ 1.345678] fbcon: vesafb (fb0) is primary device å«ä¹‰ï¼šfbcon æ­£åœ¨ä½¿ç”¨ vesafb é©±åŠ¨ï¼Œé€šè¿‡ VBE æ¥å£å·¥ä½œã€‚ 3. å…¶ä»–é©±åŠ¨ä¿¡æ¯æŸ¥è¯¢ bash # æŸ¥çœ‹ DRM è®¾å¤‡æ–‡ä»¶ ls -la /dev/dri/ # æŸ¥çœ‹ Mesa/OpenGL renderer ä¿¡æ¯ glxinfo | grep \"OpenGL renderer\" # æŸ¥çœ‹ Vulkan GPU ä¿¡æ¯ vulkaninfo | grep \"GPU id\" ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:7:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#1-åˆ¤æ–­å›¾å½¢ä¼šè¯-pts-é©±åŠ¨"},{"categories":["tech"],"content":" 6.1 å›¾å½¢é©±åŠ¨ä¿¡æ¯æŸ¥è¯¢é¦–å…ˆï¼Œéœ€è¦åˆ¤æ–­æ‚¨å½“å‰æ‰€å¤„çš„ç¯å¢ƒã€‚åœ¨ç»ˆç«¯ä¸­è¿è¡Œ tty å‘½ä»¤ï¼š è¾“å‡º /dev/pts/0 ç­‰ï¼šæ‚¨åœ¨å›¾å½¢ç•Œé¢ä¸‹çš„ä¼ª TTY (pts) ä¸­ã€‚ è¾“å‡º /dev/tty1 ç­‰ï¼šæ‚¨åœ¨ Ctrl+Alt+F1 åˆ‡æ¢çš„è™šæ‹Ÿ TTY (tty) æ–‡æœ¬æ§åˆ¶å°ä¸­ã€‚ 1. åˆ¤æ–­å›¾å½¢ä¼šè¯ (pts) é©±åŠ¨åœ¨ä¼ª TTY ä¸­ï¼Œæ‚¨æŸ¥è¯¢çš„æ˜¯æ•´ä¸ªå›¾å½¢ç•Œé¢çš„å†…æ ¸ DRM é©±åŠ¨ï¼š bash lspci -k | grep -A 3 -i vga ç¤ºä¾‹è¾“å‡ºï¼š text 01:00.0 VGA compatible controller: NVIDIA Corporation GP107 [GeForce GTX 1050 Ti] (rev a1) Subsystem: ZOTAC International (MCO) Ltd. GP107 [GeForce GTX 1050 Ti] Kernel driver in use: nvidia Kernel modules: nvidiafb, nouveau, nvidia_drm, nvidia Kernel driver in use: nvidiaï¼šè¡¨æ˜ NVIDIA ä¸“æœ‰é©±åŠ¨æ­£åœ¨ä½¿ç”¨ã€‚ å¸¸è§çš„é©±åŠ¨æœ‰ï¼ši915 (Intel), amdgpu (AMD), nouveau (NVIDIA å¼€æº), nvidia (NVIDIA ä¸“æœ‰)ã€‚ 2. åˆ¤æ–­æ–‡æœ¬æ§åˆ¶å° (tty) é©±åŠ¨åœ¨è™šæ‹Ÿ TTY ä¸­ï¼ˆæˆ–åœ¨ pts ä¸­æŸ¥è¯¢ TTY çš„æ—¥å¿—ï¼‰ï¼Œæ‚¨æŸ¥è¯¢çš„æ˜¯å¸§ç¼“å†² é©±åŠ¨ï¼š bash dmesg | grep -i fbcon å¸¸è§çš„è¾“å‡ºåŠå«ä¹‰ï¼š ç°ä»£ DRM é©±åŠ¨ (æœ€ä¼˜æƒ…å†µ): text [ 20.709925] fbcon: nvidia-drmdrmfb (fb0) is primary device æˆ– text [ 1.512345] fbcon: i915drmfb (fb0) is primary device å«ä¹‰ï¼šfbcon å·²ç»‘å®šåˆ°ä¸»å†…æ ¸å›¾å½¢é©±åŠ¨ï¼ˆnvidia-drm æˆ– i915ï¼‰æä¾›çš„å¸§ç¼“å†²åŒº ï¼ˆdrmfbï¼‰ä¸Šã€‚è¿™è¡¨æ˜ KMS å·²æ­£å¸¸å¯åŠ¨ï¼Œæ–‡æœ¬æ§åˆ¶å°å°†ä½¿ç”¨æ˜¾ç¤ºå™¨åŸç”Ÿåˆ†è¾¨ç‡ï¼Œä¸” TTY åˆ‡æ¢ ï¼ˆCtrl+Alt+F...ï¼‰ä¼šéå¸¸å¹³æ»‘ã€‚ UEFI å›ºä»¶é©±åŠ¨ (UEFI å›é€€æƒ…å†µ): text [ 1.234567] fbcon: efifb (fb0) is primary device å«ä¹‰ï¼šfbcon æ­£åœ¨ä½¿ç”¨ UEFI å›ºä»¶æä¾›çš„å¸§ç¼“å†²åŒºï¼ˆefifbï¼‰ã€‚è¿™é€šå¸¸å‘ç”Ÿåœ¨å†…æ ¸çš„ DRM é©±åŠ¨å°šæœªåŠ è½½æˆ–è¢« nomodeset å‚æ•°ç¦ç”¨æ—¶ã€‚ ä¼ ç»Ÿ VESA é©±åŠ¨ (legacyBIOS å›é€€æƒ…å†µ): text [ 1.345678] fbcon: vesafb (fb0) is primary device å«ä¹‰ï¼šfbcon æ­£åœ¨ä½¿ç”¨ vesafb é©±åŠ¨ï¼Œé€šè¿‡ VBE æ¥å£å·¥ä½œã€‚ 3. å…¶ä»–é©±åŠ¨ä¿¡æ¯æŸ¥è¯¢ bash # æŸ¥çœ‹ DRM è®¾å¤‡æ–‡ä»¶ ls -la /dev/dri/ # æŸ¥çœ‹ Mesa/OpenGL renderer ä¿¡æ¯ glxinfo | grep \"OpenGL renderer\" # æŸ¥çœ‹ Vulkan GPU ä¿¡æ¯ vulkaninfo | grep \"GPU id\" ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:7:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#2-åˆ¤æ–­æ–‡æœ¬æ§åˆ¶å°-tty-é©±åŠ¨"},{"categories":["tech"],"content":" 6.1 å›¾å½¢é©±åŠ¨ä¿¡æ¯æŸ¥è¯¢é¦–å…ˆï¼Œéœ€è¦åˆ¤æ–­æ‚¨å½“å‰æ‰€å¤„çš„ç¯å¢ƒã€‚åœ¨ç»ˆç«¯ä¸­è¿è¡Œ tty å‘½ä»¤ï¼š è¾“å‡º /dev/pts/0 ç­‰ï¼šæ‚¨åœ¨å›¾å½¢ç•Œé¢ä¸‹çš„ä¼ª TTY (pts) ä¸­ã€‚ è¾“å‡º /dev/tty1 ç­‰ï¼šæ‚¨åœ¨ Ctrl+Alt+F1 åˆ‡æ¢çš„è™šæ‹Ÿ TTY (tty) æ–‡æœ¬æ§åˆ¶å°ä¸­ã€‚ 1. åˆ¤æ–­å›¾å½¢ä¼šè¯ (pts) é©±åŠ¨åœ¨ä¼ª TTY ä¸­ï¼Œæ‚¨æŸ¥è¯¢çš„æ˜¯æ•´ä¸ªå›¾å½¢ç•Œé¢çš„å†…æ ¸ DRM é©±åŠ¨ï¼š bash lspci -k | grep -A 3 -i vga ç¤ºä¾‹è¾“å‡ºï¼š text 01:00.0 VGA compatible controller: NVIDIA Corporation GP107 [GeForce GTX 1050 Ti] (rev a1) Subsystem: ZOTAC International (MCO) Ltd. GP107 [GeForce GTX 1050 Ti] Kernel driver in use: nvidia Kernel modules: nvidiafb, nouveau, nvidia_drm, nvidia Kernel driver in use: nvidiaï¼šè¡¨æ˜ NVIDIA ä¸“æœ‰é©±åŠ¨æ­£åœ¨ä½¿ç”¨ã€‚ å¸¸è§çš„é©±åŠ¨æœ‰ï¼ši915 (Intel), amdgpu (AMD), nouveau (NVIDIA å¼€æº), nvidia (NVIDIA ä¸“æœ‰)ã€‚ 2. åˆ¤æ–­æ–‡æœ¬æ§åˆ¶å° (tty) é©±åŠ¨åœ¨è™šæ‹Ÿ TTY ä¸­ï¼ˆæˆ–åœ¨ pts ä¸­æŸ¥è¯¢ TTY çš„æ—¥å¿—ï¼‰ï¼Œæ‚¨æŸ¥è¯¢çš„æ˜¯å¸§ç¼“å†² é©±åŠ¨ï¼š bash dmesg | grep -i fbcon å¸¸è§çš„è¾“å‡ºåŠå«ä¹‰ï¼š ç°ä»£ DRM é©±åŠ¨ (æœ€ä¼˜æƒ…å†µ): text [ 20.709925] fbcon: nvidia-drmdrmfb (fb0) is primary device æˆ– text [ 1.512345] fbcon: i915drmfb (fb0) is primary device å«ä¹‰ï¼šfbcon å·²ç»‘å®šåˆ°ä¸»å†…æ ¸å›¾å½¢é©±åŠ¨ï¼ˆnvidia-drm æˆ– i915ï¼‰æä¾›çš„å¸§ç¼“å†²åŒº ï¼ˆdrmfbï¼‰ä¸Šã€‚è¿™è¡¨æ˜ KMS å·²æ­£å¸¸å¯åŠ¨ï¼Œæ–‡æœ¬æ§åˆ¶å°å°†ä½¿ç”¨æ˜¾ç¤ºå™¨åŸç”Ÿåˆ†è¾¨ç‡ï¼Œä¸” TTY åˆ‡æ¢ ï¼ˆCtrl+Alt+F...ï¼‰ä¼šéå¸¸å¹³æ»‘ã€‚ UEFI å›ºä»¶é©±åŠ¨ (UEFI å›é€€æƒ…å†µ): text [ 1.234567] fbcon: efifb (fb0) is primary device å«ä¹‰ï¼šfbcon æ­£åœ¨ä½¿ç”¨ UEFI å›ºä»¶æä¾›çš„å¸§ç¼“å†²åŒºï¼ˆefifbï¼‰ã€‚è¿™é€šå¸¸å‘ç”Ÿåœ¨å†…æ ¸çš„ DRM é©±åŠ¨å°šæœªåŠ è½½æˆ–è¢« nomodeset å‚æ•°ç¦ç”¨æ—¶ã€‚ ä¼ ç»Ÿ VESA é©±åŠ¨ (legacyBIOS å›é€€æƒ…å†µ): text [ 1.345678] fbcon: vesafb (fb0) is primary device å«ä¹‰ï¼šfbcon æ­£åœ¨ä½¿ç”¨ vesafb é©±åŠ¨ï¼Œé€šè¿‡ VBE æ¥å£å·¥ä½œã€‚ 3. å…¶ä»–é©±åŠ¨ä¿¡æ¯æŸ¥è¯¢ bash # æŸ¥çœ‹ DRM è®¾å¤‡æ–‡ä»¶ ls -la /dev/dri/ # æŸ¥çœ‹ Mesa/OpenGL renderer ä¿¡æ¯ glxinfo | grep \"OpenGL renderer\" # æŸ¥çœ‹ Vulkan GPU ä¿¡æ¯ vulkaninfo | grep \"GPU id\" ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:7:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#3-å…¶ä»–é©±åŠ¨ä¿¡æ¯æŸ¥è¯¢"},{"categories":["tech"],"content":" 6.2 æ¸²æŸ“å™¨é€‰æ‹©ä¸å‚æ•°ä¼˜åŒ– GTK åº”ç”¨æ¸²æŸ“å™¨é€‰æ‹© bash # GTK åº”ç”¨æ¸²æŸ“å™¨é€‰æ‹© export GSK_RENDERER=vulkan # ä½¿ç”¨ Vulkan æ¸²æŸ“ export GSK_RENDERER=opengl # ä½¿ç”¨ OpenGL æ¸²æŸ“ export GSK_RENDERER=cairo # ä½¿ç”¨è½¯ä»¶æ¸²æŸ“ GSK_RENDERER=vulkanï¼šä½¿ç”¨ç°ä»£ä½çº§åˆ«å›¾å½¢ API Vulkanï¼Œæä¾›æ›´å¥½çš„å¤šçº¿ç¨‹æ”¯æŒå’Œæ›´ä½çš„ CPU å¼€é”€ã€‚æ€§èƒ½æœ€ä½³ï¼Œæ”¯æŒç°ä»£ GPU ç‰¹æ€§ï¼Œé€‚ç”¨äºç°ä»£ GPU å’Œéœ€è¦æœ€ä½³æ€§èƒ½çš„åº”ç”¨ï¼Œä½†éœ€è¦æ”¯æŒ Vulkan çš„ GPU é©±åŠ¨ã€‚ GSK_RENDERER=openglï¼šä½¿ç”¨ä¼ ç»Ÿç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“ OpenGLï¼Œå…¼å®¹æ€§å¥½ï¼Œæ€§èƒ½ç¨³å®šã€‚æ”¯æŒå¹¿æ³›çš„ç¡¬ä»¶å’Œé©±åŠ¨ï¼Œé€‚ç”¨äºå¤§å¤šæ•°ç°ä»£ GPU å’Œéœ€è¦ç¨³å®šå…¼å®¹æ€§çš„åº”ç”¨ï¼Œç‰¹ç‚¹æ˜¯å•çº¿ç¨‹æ¸²æŸ“ï¼ŒCPU å¼€é”€ç›¸å¯¹è¾ƒé«˜ã€‚ GSK_RENDERER=cairoï¼šä½¿ç”¨ CPU è½¯ä»¶æ¸²æŸ“ï¼Œä¸ä¾èµ– GPU ç¡¬ä»¶åŠ é€Ÿã€‚å…¼å®¹æ€§æœ€å¥½ï¼Œä¸ä¾èµ– GPU é©±åŠ¨ï¼Œé€‚ç”¨äº GPU é©±åŠ¨é—®é¢˜æ—¶çš„å¤‡é€‰æ–¹æ¡ˆï¼Œæˆ–å¯¹æ€§èƒ½è¦æ±‚ä¸é«˜çš„åº”ç”¨ï¼Œç¼ºç‚¹æ˜¯æ€§èƒ½æœ€ä½ï¼ŒCPU å ç”¨é«˜ã€‚ Qt åº”ç”¨æ¸²æŸ“å™¨é€‰æ‹© bash # Qt åº”ç”¨æ¸²æŸ“å™¨é€‰æ‹© export QT_OPENGL=desktop # ä½¿ç”¨æ¡Œé¢ OpenGL export QT_OPENGL=software # ä½¿ç”¨è½¯ä»¶æ¸²æŸ“ export QT_OPENGL=angle # ä½¿ç”¨ ANGLEï¼ˆWindows å…¼å®¹å±‚ï¼‰ QT_OPENGL=desktopï¼šä½¿ç”¨æ¡Œé¢ç‰ˆ OpenGLï¼Œæ”¯æŒå®Œæ•´çš„ OpenGL åŠŸèƒ½é›†ã€‚åŠŸèƒ½å®Œæ•´ï¼Œæ€§èƒ½è‰¯å¥½ï¼Œé€‚ç”¨äºå¤§å¤šæ•°æ¡Œé¢åº”ç”¨ï¼Œéœ€è¦å®Œæ•´ OpenGL æ”¯æŒã€‚ QT_OPENGL=softwareï¼šä½¿ç”¨ CPU è½¯ä»¶æ¸²æŸ“ï¼Œå®Œå…¨ç»•è¿‡ GPUã€‚å…¼å®¹æ€§æœ€å¥½ï¼Œä¸ä¾èµ– GPUï¼Œé€‚ç”¨äº GPU é©±åŠ¨é—®é¢˜ï¼Œæˆ–éœ€è¦ç¡®ä¿å…¼å®¹æ€§çš„åœºæ™¯ã€‚ QT_OPENGL=angleï¼šä½¿ç”¨ ANGLE å°† OpenGL ES è½¬æ¢ä¸º DirectXï¼Œä¸»è¦ç”¨äº Windows å…¼å®¹æ€§ã€‚åœ¨æŸäº› Windows å…¼å®¹å±‚ç¯å¢ƒä¸‹æ€§èƒ½æ›´å¥½ï¼Œé€‚ç”¨äº Wine ç­‰ Windows å…¼å®¹å±‚ç¯å¢ƒã€‚ Mesa é©±åŠ¨ä¼˜åŒ–å‚æ•° bash # Mesa é©±åŠ¨ç‰ˆæœ¬è¦†ç›– export MESA_GL_VERSION_OVERRIDE=4.5 export MESA_GLSL_VERSION_OVERRIDE=450 # è°ƒè¯•ä¿¡æ¯ export MESA_DEBUG=1 # å¯ç”¨ Mesa è°ƒè¯•ä¿¡æ¯ export LIBGL_DEBUG=verbose # å¯ç”¨ OpenGL è°ƒè¯•ä¿¡æ¯ MESA_GL_VERSION_OVERRIDE=4.5ï¼šå¼ºåˆ¶ä½¿ç”¨æŒ‡å®šç‰ˆæœ¬çš„ OpenGLï¼Œè§£å†³æŸäº›åº”ç”¨çš„å…¼å®¹æ€§é—®é¢˜ã€‚è¦†ç›–åº”ç”¨è¯·æ±‚çš„ OpenGL ç‰ˆæœ¬ï¼Œé€‚ç”¨äºåº”ç”¨è¦æ±‚è¿‡é«˜ OpenGL ç‰ˆæœ¬å¯¼è‡´æ— æ³•å¯åŠ¨æ—¶ã€‚ MESA_GLSL_VERSION_OVERRIDE=450ï¼šå¼ºåˆ¶ä½¿ç”¨æŒ‡å®šç‰ˆæœ¬çš„ GLSL ç€è‰²å™¨è¯­è¨€ï¼Œç¡®ä¿ç€è‰²å™¨å…¼å®¹æ€§ã€‚è¦†ç›–ç€è‰²å™¨ç¼–è¯‘å™¨ç‰ˆæœ¬ï¼Œé¿å…ç‰ˆæœ¬ä¸åŒ¹é…é—®é¢˜ï¼Œé€‚ç”¨äºç€è‰²å™¨ç¼–è¯‘é”™è¯¯æˆ–ç‰ˆæœ¬ä¸åŒ¹é…æ—¶ã€‚ MESA_DEBUG=1ï¼šå¯ç”¨è¯¦ç»†çš„ Mesa è°ƒè¯•ä¿¡æ¯ï¼Œå¸®åŠ©è¯Šæ–­å›¾å½¢é—®é¢˜ã€‚ LIBGL_DEBUG=verboseï¼šå¯ç”¨ OpenGL åº“çš„è¯¦ç»†è°ƒè¯•è¾“å‡ºï¼Œç”¨äºæ·±å…¥åˆ†æ OpenGL è°ƒç”¨é—®é¢˜ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:7:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#62-æ¸²æŸ“å™¨é€‰æ‹©ä¸å‚æ•°ä¼˜åŒ–"},{"categories":["tech"],"content":" 6.2 æ¸²æŸ“å™¨é€‰æ‹©ä¸å‚æ•°ä¼˜åŒ– GTK åº”ç”¨æ¸²æŸ“å™¨é€‰æ‹© bash # GTK åº”ç”¨æ¸²æŸ“å™¨é€‰æ‹© export GSK_RENDERER=vulkan # ä½¿ç”¨ Vulkan æ¸²æŸ“ export GSK_RENDERER=opengl # ä½¿ç”¨ OpenGL æ¸²æŸ“ export GSK_RENDERER=cairo # ä½¿ç”¨è½¯ä»¶æ¸²æŸ“ GSK_RENDERER=vulkanï¼šä½¿ç”¨ç°ä»£ä½çº§åˆ«å›¾å½¢ API Vulkanï¼Œæä¾›æ›´å¥½çš„å¤šçº¿ç¨‹æ”¯æŒå’Œæ›´ä½çš„ CPU å¼€é”€ã€‚æ€§èƒ½æœ€ä½³ï¼Œæ”¯æŒç°ä»£ GPU ç‰¹æ€§ï¼Œé€‚ç”¨äºç°ä»£ GPU å’Œéœ€è¦æœ€ä½³æ€§èƒ½çš„åº”ç”¨ï¼Œä½†éœ€è¦æ”¯æŒ Vulkan çš„ GPU é©±åŠ¨ã€‚ GSK_RENDERER=openglï¼šä½¿ç”¨ä¼ ç»Ÿç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“ OpenGLï¼Œå…¼å®¹æ€§å¥½ï¼Œæ€§èƒ½ç¨³å®šã€‚æ”¯æŒå¹¿æ³›çš„ç¡¬ä»¶å’Œé©±åŠ¨ï¼Œé€‚ç”¨äºå¤§å¤šæ•°ç°ä»£ GPU å’Œéœ€è¦ç¨³å®šå…¼å®¹æ€§çš„åº”ç”¨ï¼Œç‰¹ç‚¹æ˜¯å•çº¿ç¨‹æ¸²æŸ“ï¼ŒCPU å¼€é”€ç›¸å¯¹è¾ƒé«˜ã€‚ GSK_RENDERER=cairoï¼šä½¿ç”¨ CPU è½¯ä»¶æ¸²æŸ“ï¼Œä¸ä¾èµ– GPU ç¡¬ä»¶åŠ é€Ÿã€‚å…¼å®¹æ€§æœ€å¥½ï¼Œä¸ä¾èµ– GPU é©±åŠ¨ï¼Œé€‚ç”¨äº GPU é©±åŠ¨é—®é¢˜æ—¶çš„å¤‡é€‰æ–¹æ¡ˆï¼Œæˆ–å¯¹æ€§èƒ½è¦æ±‚ä¸é«˜çš„åº”ç”¨ï¼Œç¼ºç‚¹æ˜¯æ€§èƒ½æœ€ä½ï¼ŒCPU å ç”¨é«˜ã€‚ Qt åº”ç”¨æ¸²æŸ“å™¨é€‰æ‹© bash # Qt åº”ç”¨æ¸²æŸ“å™¨é€‰æ‹© export QT_OPENGL=desktop # ä½¿ç”¨æ¡Œé¢ OpenGL export QT_OPENGL=software # ä½¿ç”¨è½¯ä»¶æ¸²æŸ“ export QT_OPENGL=angle # ä½¿ç”¨ ANGLEï¼ˆWindows å…¼å®¹å±‚ï¼‰ QT_OPENGL=desktopï¼šä½¿ç”¨æ¡Œé¢ç‰ˆ OpenGLï¼Œæ”¯æŒå®Œæ•´çš„ OpenGL åŠŸèƒ½é›†ã€‚åŠŸèƒ½å®Œæ•´ï¼Œæ€§èƒ½è‰¯å¥½ï¼Œé€‚ç”¨äºå¤§å¤šæ•°æ¡Œé¢åº”ç”¨ï¼Œéœ€è¦å®Œæ•´ OpenGL æ”¯æŒã€‚ QT_OPENGL=softwareï¼šä½¿ç”¨ CPU è½¯ä»¶æ¸²æŸ“ï¼Œå®Œå…¨ç»•è¿‡ GPUã€‚å…¼å®¹æ€§æœ€å¥½ï¼Œä¸ä¾èµ– GPUï¼Œé€‚ç”¨äº GPU é©±åŠ¨é—®é¢˜ï¼Œæˆ–éœ€è¦ç¡®ä¿å…¼å®¹æ€§çš„åœºæ™¯ã€‚ QT_OPENGL=angleï¼šä½¿ç”¨ ANGLE å°† OpenGL ES è½¬æ¢ä¸º DirectXï¼Œä¸»è¦ç”¨äº Windows å…¼å®¹æ€§ã€‚åœ¨æŸäº› Windows å…¼å®¹å±‚ç¯å¢ƒä¸‹æ€§èƒ½æ›´å¥½ï¼Œé€‚ç”¨äº Wine ç­‰ Windows å…¼å®¹å±‚ç¯å¢ƒã€‚ Mesa é©±åŠ¨ä¼˜åŒ–å‚æ•° bash # Mesa é©±åŠ¨ç‰ˆæœ¬è¦†ç›– export MESA_GL_VERSION_OVERRIDE=4.5 export MESA_GLSL_VERSION_OVERRIDE=450 # è°ƒè¯•ä¿¡æ¯ export MESA_DEBUG=1 # å¯ç”¨ Mesa è°ƒè¯•ä¿¡æ¯ export LIBGL_DEBUG=verbose # å¯ç”¨ OpenGL è°ƒè¯•ä¿¡æ¯ MESA_GL_VERSION_OVERRIDE=4.5ï¼šå¼ºåˆ¶ä½¿ç”¨æŒ‡å®šç‰ˆæœ¬çš„ OpenGLï¼Œè§£å†³æŸäº›åº”ç”¨çš„å…¼å®¹æ€§é—®é¢˜ã€‚è¦†ç›–åº”ç”¨è¯·æ±‚çš„ OpenGL ç‰ˆæœ¬ï¼Œé€‚ç”¨äºåº”ç”¨è¦æ±‚è¿‡é«˜ OpenGL ç‰ˆæœ¬å¯¼è‡´æ— æ³•å¯åŠ¨æ—¶ã€‚ MESA_GLSL_VERSION_OVERRIDE=450ï¼šå¼ºåˆ¶ä½¿ç”¨æŒ‡å®šç‰ˆæœ¬çš„ GLSL ç€è‰²å™¨è¯­è¨€ï¼Œç¡®ä¿ç€è‰²å™¨å…¼å®¹æ€§ã€‚è¦†ç›–ç€è‰²å™¨ç¼–è¯‘å™¨ç‰ˆæœ¬ï¼Œé¿å…ç‰ˆæœ¬ä¸åŒ¹é…é—®é¢˜ï¼Œé€‚ç”¨äºç€è‰²å™¨ç¼–è¯‘é”™è¯¯æˆ–ç‰ˆæœ¬ä¸åŒ¹é…æ—¶ã€‚ MESA_DEBUG=1ï¼šå¯ç”¨è¯¦ç»†çš„ Mesa è°ƒè¯•ä¿¡æ¯ï¼Œå¸®åŠ©è¯Šæ–­å›¾å½¢é—®é¢˜ã€‚ LIBGL_DEBUG=verboseï¼šå¯ç”¨ OpenGL åº“çš„è¯¦ç»†è°ƒè¯•è¾“å‡ºï¼Œç”¨äºæ·±å…¥åˆ†æ OpenGL è°ƒç”¨é—®é¢˜ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:7:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#gtk-åº”ç”¨æ¸²æŸ“å™¨é€‰æ‹©"},{"categories":["tech"],"content":" 6.2 æ¸²æŸ“å™¨é€‰æ‹©ä¸å‚æ•°ä¼˜åŒ– GTK åº”ç”¨æ¸²æŸ“å™¨é€‰æ‹© bash # GTK åº”ç”¨æ¸²æŸ“å™¨é€‰æ‹© export GSK_RENDERER=vulkan # ä½¿ç”¨ Vulkan æ¸²æŸ“ export GSK_RENDERER=opengl # ä½¿ç”¨ OpenGL æ¸²æŸ“ export GSK_RENDERER=cairo # ä½¿ç”¨è½¯ä»¶æ¸²æŸ“ GSK_RENDERER=vulkanï¼šä½¿ç”¨ç°ä»£ä½çº§åˆ«å›¾å½¢ API Vulkanï¼Œæä¾›æ›´å¥½çš„å¤šçº¿ç¨‹æ”¯æŒå’Œæ›´ä½çš„ CPU å¼€é”€ã€‚æ€§èƒ½æœ€ä½³ï¼Œæ”¯æŒç°ä»£ GPU ç‰¹æ€§ï¼Œé€‚ç”¨äºç°ä»£ GPU å’Œéœ€è¦æœ€ä½³æ€§èƒ½çš„åº”ç”¨ï¼Œä½†éœ€è¦æ”¯æŒ Vulkan çš„ GPU é©±åŠ¨ã€‚ GSK_RENDERER=openglï¼šä½¿ç”¨ä¼ ç»Ÿç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“ OpenGLï¼Œå…¼å®¹æ€§å¥½ï¼Œæ€§èƒ½ç¨³å®šã€‚æ”¯æŒå¹¿æ³›çš„ç¡¬ä»¶å’Œé©±åŠ¨ï¼Œé€‚ç”¨äºå¤§å¤šæ•°ç°ä»£ GPU å’Œéœ€è¦ç¨³å®šå…¼å®¹æ€§çš„åº”ç”¨ï¼Œç‰¹ç‚¹æ˜¯å•çº¿ç¨‹æ¸²æŸ“ï¼ŒCPU å¼€é”€ç›¸å¯¹è¾ƒé«˜ã€‚ GSK_RENDERER=cairoï¼šä½¿ç”¨ CPU è½¯ä»¶æ¸²æŸ“ï¼Œä¸ä¾èµ– GPU ç¡¬ä»¶åŠ é€Ÿã€‚å…¼å®¹æ€§æœ€å¥½ï¼Œä¸ä¾èµ– GPU é©±åŠ¨ï¼Œé€‚ç”¨äº GPU é©±åŠ¨é—®é¢˜æ—¶çš„å¤‡é€‰æ–¹æ¡ˆï¼Œæˆ–å¯¹æ€§èƒ½è¦æ±‚ä¸é«˜çš„åº”ç”¨ï¼Œç¼ºç‚¹æ˜¯æ€§èƒ½æœ€ä½ï¼ŒCPU å ç”¨é«˜ã€‚ Qt åº”ç”¨æ¸²æŸ“å™¨é€‰æ‹© bash # Qt åº”ç”¨æ¸²æŸ“å™¨é€‰æ‹© export QT_OPENGL=desktop # ä½¿ç”¨æ¡Œé¢ OpenGL export QT_OPENGL=software # ä½¿ç”¨è½¯ä»¶æ¸²æŸ“ export QT_OPENGL=angle # ä½¿ç”¨ ANGLEï¼ˆWindows å…¼å®¹å±‚ï¼‰ QT_OPENGL=desktopï¼šä½¿ç”¨æ¡Œé¢ç‰ˆ OpenGLï¼Œæ”¯æŒå®Œæ•´çš„ OpenGL åŠŸèƒ½é›†ã€‚åŠŸèƒ½å®Œæ•´ï¼Œæ€§èƒ½è‰¯å¥½ï¼Œé€‚ç”¨äºå¤§å¤šæ•°æ¡Œé¢åº”ç”¨ï¼Œéœ€è¦å®Œæ•´ OpenGL æ”¯æŒã€‚ QT_OPENGL=softwareï¼šä½¿ç”¨ CPU è½¯ä»¶æ¸²æŸ“ï¼Œå®Œå…¨ç»•è¿‡ GPUã€‚å…¼å®¹æ€§æœ€å¥½ï¼Œä¸ä¾èµ– GPUï¼Œé€‚ç”¨äº GPU é©±åŠ¨é—®é¢˜ï¼Œæˆ–éœ€è¦ç¡®ä¿å…¼å®¹æ€§çš„åœºæ™¯ã€‚ QT_OPENGL=angleï¼šä½¿ç”¨ ANGLE å°† OpenGL ES è½¬æ¢ä¸º DirectXï¼Œä¸»è¦ç”¨äº Windows å…¼å®¹æ€§ã€‚åœ¨æŸäº› Windows å…¼å®¹å±‚ç¯å¢ƒä¸‹æ€§èƒ½æ›´å¥½ï¼Œé€‚ç”¨äº Wine ç­‰ Windows å…¼å®¹å±‚ç¯å¢ƒã€‚ Mesa é©±åŠ¨ä¼˜åŒ–å‚æ•° bash # Mesa é©±åŠ¨ç‰ˆæœ¬è¦†ç›– export MESA_GL_VERSION_OVERRIDE=4.5 export MESA_GLSL_VERSION_OVERRIDE=450 # è°ƒè¯•ä¿¡æ¯ export MESA_DEBUG=1 # å¯ç”¨ Mesa è°ƒè¯•ä¿¡æ¯ export LIBGL_DEBUG=verbose # å¯ç”¨ OpenGL è°ƒè¯•ä¿¡æ¯ MESA_GL_VERSION_OVERRIDE=4.5ï¼šå¼ºåˆ¶ä½¿ç”¨æŒ‡å®šç‰ˆæœ¬çš„ OpenGLï¼Œè§£å†³æŸäº›åº”ç”¨çš„å…¼å®¹æ€§é—®é¢˜ã€‚è¦†ç›–åº”ç”¨è¯·æ±‚çš„ OpenGL ç‰ˆæœ¬ï¼Œé€‚ç”¨äºåº”ç”¨è¦æ±‚è¿‡é«˜ OpenGL ç‰ˆæœ¬å¯¼è‡´æ— æ³•å¯åŠ¨æ—¶ã€‚ MESA_GLSL_VERSION_OVERRIDE=450ï¼šå¼ºåˆ¶ä½¿ç”¨æŒ‡å®šç‰ˆæœ¬çš„ GLSL ç€è‰²å™¨è¯­è¨€ï¼Œç¡®ä¿ç€è‰²å™¨å…¼å®¹æ€§ã€‚è¦†ç›–ç€è‰²å™¨ç¼–è¯‘å™¨ç‰ˆæœ¬ï¼Œé¿å…ç‰ˆæœ¬ä¸åŒ¹é…é—®é¢˜ï¼Œé€‚ç”¨äºç€è‰²å™¨ç¼–è¯‘é”™è¯¯æˆ–ç‰ˆæœ¬ä¸åŒ¹é…æ—¶ã€‚ MESA_DEBUG=1ï¼šå¯ç”¨è¯¦ç»†çš„ Mesa è°ƒè¯•ä¿¡æ¯ï¼Œå¸®åŠ©è¯Šæ–­å›¾å½¢é—®é¢˜ã€‚ LIBGL_DEBUG=verboseï¼šå¯ç”¨ OpenGL åº“çš„è¯¦ç»†è°ƒè¯•è¾“å‡ºï¼Œç”¨äºæ·±å…¥åˆ†æ OpenGL è°ƒç”¨é—®é¢˜ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:7:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#qt-åº”ç”¨æ¸²æŸ“å™¨é€‰æ‹©"},{"categories":["tech"],"content":" 6.2 æ¸²æŸ“å™¨é€‰æ‹©ä¸å‚æ•°ä¼˜åŒ– GTK åº”ç”¨æ¸²æŸ“å™¨é€‰æ‹© bash # GTK åº”ç”¨æ¸²æŸ“å™¨é€‰æ‹© export GSK_RENDERER=vulkan # ä½¿ç”¨ Vulkan æ¸²æŸ“ export GSK_RENDERER=opengl # ä½¿ç”¨ OpenGL æ¸²æŸ“ export GSK_RENDERER=cairo # ä½¿ç”¨è½¯ä»¶æ¸²æŸ“ GSK_RENDERER=vulkanï¼šä½¿ç”¨ç°ä»£ä½çº§åˆ«å›¾å½¢ API Vulkanï¼Œæä¾›æ›´å¥½çš„å¤šçº¿ç¨‹æ”¯æŒå’Œæ›´ä½çš„ CPU å¼€é”€ã€‚æ€§èƒ½æœ€ä½³ï¼Œæ”¯æŒç°ä»£ GPU ç‰¹æ€§ï¼Œé€‚ç”¨äºç°ä»£ GPU å’Œéœ€è¦æœ€ä½³æ€§èƒ½çš„åº”ç”¨ï¼Œä½†éœ€è¦æ”¯æŒ Vulkan çš„ GPU é©±åŠ¨ã€‚ GSK_RENDERER=openglï¼šä½¿ç”¨ä¼ ç»Ÿç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“ OpenGLï¼Œå…¼å®¹æ€§å¥½ï¼Œæ€§èƒ½ç¨³å®šã€‚æ”¯æŒå¹¿æ³›çš„ç¡¬ä»¶å’Œé©±åŠ¨ï¼Œé€‚ç”¨äºå¤§å¤šæ•°ç°ä»£ GPU å’Œéœ€è¦ç¨³å®šå…¼å®¹æ€§çš„åº”ç”¨ï¼Œç‰¹ç‚¹æ˜¯å•çº¿ç¨‹æ¸²æŸ“ï¼ŒCPU å¼€é”€ç›¸å¯¹è¾ƒé«˜ã€‚ GSK_RENDERER=cairoï¼šä½¿ç”¨ CPU è½¯ä»¶æ¸²æŸ“ï¼Œä¸ä¾èµ– GPU ç¡¬ä»¶åŠ é€Ÿã€‚å…¼å®¹æ€§æœ€å¥½ï¼Œä¸ä¾èµ– GPU é©±åŠ¨ï¼Œé€‚ç”¨äº GPU é©±åŠ¨é—®é¢˜æ—¶çš„å¤‡é€‰æ–¹æ¡ˆï¼Œæˆ–å¯¹æ€§èƒ½è¦æ±‚ä¸é«˜çš„åº”ç”¨ï¼Œç¼ºç‚¹æ˜¯æ€§èƒ½æœ€ä½ï¼ŒCPU å ç”¨é«˜ã€‚ Qt åº”ç”¨æ¸²æŸ“å™¨é€‰æ‹© bash # Qt åº”ç”¨æ¸²æŸ“å™¨é€‰æ‹© export QT_OPENGL=desktop # ä½¿ç”¨æ¡Œé¢ OpenGL export QT_OPENGL=software # ä½¿ç”¨è½¯ä»¶æ¸²æŸ“ export QT_OPENGL=angle # ä½¿ç”¨ ANGLEï¼ˆWindows å…¼å®¹å±‚ï¼‰ QT_OPENGL=desktopï¼šä½¿ç”¨æ¡Œé¢ç‰ˆ OpenGLï¼Œæ”¯æŒå®Œæ•´çš„ OpenGL åŠŸèƒ½é›†ã€‚åŠŸèƒ½å®Œæ•´ï¼Œæ€§èƒ½è‰¯å¥½ï¼Œé€‚ç”¨äºå¤§å¤šæ•°æ¡Œé¢åº”ç”¨ï¼Œéœ€è¦å®Œæ•´ OpenGL æ”¯æŒã€‚ QT_OPENGL=softwareï¼šä½¿ç”¨ CPU è½¯ä»¶æ¸²æŸ“ï¼Œå®Œå…¨ç»•è¿‡ GPUã€‚å…¼å®¹æ€§æœ€å¥½ï¼Œä¸ä¾èµ– GPUï¼Œé€‚ç”¨äº GPU é©±åŠ¨é—®é¢˜ï¼Œæˆ–éœ€è¦ç¡®ä¿å…¼å®¹æ€§çš„åœºæ™¯ã€‚ QT_OPENGL=angleï¼šä½¿ç”¨ ANGLE å°† OpenGL ES è½¬æ¢ä¸º DirectXï¼Œä¸»è¦ç”¨äº Windows å…¼å®¹æ€§ã€‚åœ¨æŸäº› Windows å…¼å®¹å±‚ç¯å¢ƒä¸‹æ€§èƒ½æ›´å¥½ï¼Œé€‚ç”¨äº Wine ç­‰ Windows å…¼å®¹å±‚ç¯å¢ƒã€‚ Mesa é©±åŠ¨ä¼˜åŒ–å‚æ•° bash # Mesa é©±åŠ¨ç‰ˆæœ¬è¦†ç›– export MESA_GL_VERSION_OVERRIDE=4.5 export MESA_GLSL_VERSION_OVERRIDE=450 # è°ƒè¯•ä¿¡æ¯ export MESA_DEBUG=1 # å¯ç”¨ Mesa è°ƒè¯•ä¿¡æ¯ export LIBGL_DEBUG=verbose # å¯ç”¨ OpenGL è°ƒè¯•ä¿¡æ¯ MESA_GL_VERSION_OVERRIDE=4.5ï¼šå¼ºåˆ¶ä½¿ç”¨æŒ‡å®šç‰ˆæœ¬çš„ OpenGLï¼Œè§£å†³æŸäº›åº”ç”¨çš„å…¼å®¹æ€§é—®é¢˜ã€‚è¦†ç›–åº”ç”¨è¯·æ±‚çš„ OpenGL ç‰ˆæœ¬ï¼Œé€‚ç”¨äºåº”ç”¨è¦æ±‚è¿‡é«˜ OpenGL ç‰ˆæœ¬å¯¼è‡´æ— æ³•å¯åŠ¨æ—¶ã€‚ MESA_GLSL_VERSION_OVERRIDE=450ï¼šå¼ºåˆ¶ä½¿ç”¨æŒ‡å®šç‰ˆæœ¬çš„ GLSL ç€è‰²å™¨è¯­è¨€ï¼Œç¡®ä¿ç€è‰²å™¨å…¼å®¹æ€§ã€‚è¦†ç›–ç€è‰²å™¨ç¼–è¯‘å™¨ç‰ˆæœ¬ï¼Œé¿å…ç‰ˆæœ¬ä¸åŒ¹é…é—®é¢˜ï¼Œé€‚ç”¨äºç€è‰²å™¨ç¼–è¯‘é”™è¯¯æˆ–ç‰ˆæœ¬ä¸åŒ¹é…æ—¶ã€‚ MESA_DEBUG=1ï¼šå¯ç”¨è¯¦ç»†çš„ Mesa è°ƒè¯•ä¿¡æ¯ï¼Œå¸®åŠ©è¯Šæ–­å›¾å½¢é—®é¢˜ã€‚ LIBGL_DEBUG=verboseï¼šå¯ç”¨ OpenGL åº“çš„è¯¦ç»†è°ƒè¯•è¾“å‡ºï¼Œç”¨äºæ·±å…¥åˆ†æ OpenGL è°ƒç”¨é—®é¢˜ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:7:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#mesa-é©±åŠ¨ä¼˜åŒ–å‚æ•°"},{"categories":["tech"],"content":" 6.3 è°ƒè¯• Wayland é€šä¿¡ bash # æŸ¥çœ‹ Wayland ç¯å¢ƒå˜é‡ echo $WAYLAND_DISPLAY $XDG_RUNTIME_DIR # å¯ç”¨ Wayland è°ƒè¯•è¾“å‡ºï¼ˆå®¢æˆ·ç«¯ï¼‰ export WAYLAND_DEBUG=1 # æ£€æŸ¥åˆæˆå™¨æ”¯æŒçš„åè®® wayland-info | grep text-input # è·Ÿè¸ªç³»ç»Ÿè°ƒç”¨ï¼ˆæŸ¥çœ‹ socket é€šä¿¡ï¼‰ strace -f -e trace=network,ipc \u003capplication\u003e ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:7:3","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#63-è°ƒè¯•-wayland-é€šä¿¡"},{"categories":["tech"],"content":" æ•…éšœæ’æŸ¥","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:8:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#æ•…éšœæ’æŸ¥"},{"categories":["tech"],"content":" 7.1 ä¼šè¯ç®¡ç†é—®é¢˜ç™»å½•å¤±è´¥æ’æŸ¥ï¼š bash # æ£€æŸ¥æ˜¾ç¤ºç®¡ç†å™¨çŠ¶æ€ systemctl status display-manager journalctl -u display-manager -b # æŸ¥çœ‹ç”¨æˆ·ä¼šè¯ loginctl list-sessions loginctl show-session \u003csession_id\u003e # æ£€æŸ¥ PAM è®¤è¯ journalctl -t login -f æƒé™é—®é¢˜æ’æŸ¥ï¼š bash # æ£€æŸ¥è®¾å¤‡æƒé™ loginctl seat-status seat0 ls -la /dev/dri/card0 # æŸ¥çœ‹ ACL åˆ†é… getfacl /dev/dri/card0 ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:8:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#71-ä¼šè¯ç®¡ç†é—®é¢˜"},{"categories":["tech"],"content":" 7.2 å›¾å½¢æ¸²æŸ“é—®é¢˜åº”ç”¨å´©æºƒè¯Šæ–­ï¼š æ ¸å¿ƒè½¬å‚¨åˆ†æï¼š bash # æŸ¥çœ‹æ ¸å¿ƒè½¬å‚¨ coredumpctl list coredumpctl info \u003cpid\u003e # è°ƒè¯•æ ¸å¿ƒæ–‡ä»¶ coredumpctl debug \u003cpid\u003e GPU é—®é¢˜è¯Šæ–­ï¼š bash # æ£€æŸ¥ GPU é‡ç½® dmesg | grep -i \"gpu hang\\|reset\" # Mesa è°ƒè¯•ä¿¡æ¯ export MESA_DEBUG=1 export LIBGL_DEBUG=verbose Wayland åè®®é”™è¯¯ï¼š bash # Wayland è°ƒè¯•è¾“å‡º export WAYLAND_DEBUG=1 # åˆæˆå™¨æ—¥å¿— journalctl --user -u \u003ccompositor\u003e -f æ€§èƒ½é—®é¢˜åˆ†æï¼š bash # GPU ä½¿ç”¨ç‡ nvidia-smi # NVIDIA radeontop # AMD # CPU ä½¿ç”¨ç‡åˆ†æ perf top -p \u003cpid\u003e # å†…å­˜ä½¿ç”¨ smem -p | grep \u003capplication\u003e # å¸§ç‡ç›‘æ§ export __GL_SHOW_GRAPHICS_OSD=1 # NVIDIA å…¼å®¹æ€§é—®é¢˜ï¼š Xwayland é—®é¢˜ï¼šéƒ¨åˆ† X11 åº”ç”¨åœ¨ Xwayland ä¸‹è¿è¡Œå¼‚å¸¸ Wayland åè®®ç¼ºå¤±ï¼šæŸäº›åŠŸèƒ½éœ€è¦ç‰¹å®šçš„ Wayland æ‰©å±• é©±åŠ¨å…¼å®¹æ€§ï¼šGPU é©±åŠ¨å¯èƒ½ä¸å®Œå…¨æ”¯æŒæŸäº› Wayland ç‰¹æ€§ è§£å†³æ–¹æ³•ï¼š æ›´æ–° Mesa å’Œ GPU é©±åŠ¨ æ£€æŸ¥åˆæˆå™¨å¯¹å¿…è¦ Wayland æ‰©å±•çš„æ”¯æŒ å¯¹äºé¡½å›ºé—®é¢˜ï¼Œå¯ä¸´æ—¶ä½¿ç”¨ X11 ä¼šè¯ ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:8:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#72-å›¾å½¢æ¸²æŸ“é—®é¢˜"},{"categories":["tech"],"content":" æ€»ç»“ä»ç”¨æˆ·ç™»å½•åˆ°ç”»é¢æ˜¾ç¤ºï¼Œè¿™ä¸€æ•´å¥—æµç¨‹ç¡®å®æŒºå¤æ‚çš„ï¼Œå±•å¼€è¯´é‚£å¯èƒ½å¾—å¥½å‡ æœ¬å¤§éƒ¨å¤´äº†ã€‚ Wayland è™½ç„¶è¿˜åœ¨å‘å±•ä¸­ï¼Œä½†ç¡®å®æ¯” X11 è¦ç°ä»£åŒ–å¾ˆå¤šï¼Œæ€§èƒ½å’Œå®‰å…¨æ€§çš„æå‡æ˜¯å®å®åœ¨åœ¨çš„ï¼Œè€Œä¸”åœ¨ 2025 å¹´çš„ä»Šå¤© Wayland ç”Ÿæ€çš„å¯ç”¨æ€§å·²ç»å¾ˆä¸é”™äº†ã€‚ ä¸‹ä¸€ç¯‡æ–‡ç« æˆ‘ä»¬ä¼šèŠèŠå¤šåª’ä½“å’Œä¸­æ–‡æ”¯æŒï¼Œçœ‹çœ‹ç³»ç»Ÿæ˜¯å¦‚ä½•å¤„ç†éŸ³é¢‘è§†é¢‘å’Œä¸­æ–‡æ˜¾ç¤ºçš„ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:9:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#æ€»ç»“"},{"categories":["tech"],"content":" å¿«é€Ÿå‚è€ƒ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:10:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#å¿«é€Ÿå‚è€ƒ"},{"categories":["tech"],"content":" å¸¸ç”¨ä¼šè¯ç®¡ç†å‘½ä»¤ bash # ä¼šè¯ç®¡ç† loginctl list-sessions # åˆ—å‡ºæ‰€æœ‰ä¼šè¯ loginctl show-session \u003cid\u003e -p Name -p UID -p Seat # ä¼šè¯è¯¦æƒ… loginctl terminate-session \u003cid\u003e # ç»ˆæ­¢ä¼šè¯ # seat ç®¡ç† loginctl seat-status # æŸ¥çœ‹ seat çŠ¶æ€ loginctl seat-status seat0 # ç‰¹å®š seat è¯¦æƒ… # è®¾å¤‡æƒé™æ£€æŸ¥ ls -la /dev/dri/card0 # GPU è®¾å¤‡æƒé™ ls -la /dev/input/event* # è¾“å…¥è®¾å¤‡æƒé™ ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:10:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#å¸¸ç”¨ä¼šè¯ç®¡ç†å‘½ä»¤"},{"categories":["tech"],"content":" å¸¸ç”¨å›¾å½¢è°ƒè¯•å‘½ä»¤ bash # å›¾å½¢é©±åŠ¨ä¿¡æ¯ glxinfo | grep \"OpenGL renderer\" # OpenGL ä¿¡æ¯ vulkaninfo | grep \"GPU id\" # Vulkan ä¿¡æ¯ lspci -k | grep -A 3 -i vga # æ˜¾å¡é©±åŠ¨ ls -la /dev/dri/ # DRM è®¾å¤‡ # Wayland ç¯å¢ƒ echo $WAYLAND_DISPLAY $XDG_RUNTIME_DIR # ç¯å¢ƒå˜é‡ wayland-info | grep text-input # åè®®æ”¯æŒ # è°ƒè¯•å˜é‡ export WAYLAND_DEBUG=1 # Wayland è°ƒè¯• export MESA_DEBUG=1 # Mesa è°ƒè¯• export GSK_RENDERER=vulkan # GTK æ¸²æŸ“å™¨ export QT_OPENGL=desktop # Qt æ¸²æŸ“å™¨ ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:10:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#å¸¸ç”¨å›¾å½¢è°ƒè¯•å‘½ä»¤"},{"categories":["tech"],"content":" é‡è¦é…ç½®æ–‡ä»¶ä½ç½® bash # ä¼šè¯ç›¸å…³ /etc/systemd/logind.conf # logind é…ç½® ~/.config/systemd/user/ # ç”¨æˆ·æœåŠ¡é…ç½® # å›¾å½¢ç›¸å…³ ~/.config/wayland/ # Wayland é…ç½® ~/.config/gtk-3.0/ # GTK é…ç½® ~/.config/qt5ct/ # Qt é…ç½® ~/.config/mesa/ # Mesa é…ç½® # è®¾å¤‡æƒé™ /etc/udev/rules.d/ # udev è§„åˆ™ /dev/dri/ # GPU è®¾å¤‡ /dev/input/ # è¾“å…¥è®¾å¤‡ # æ˜¾ç¤ºç®¡ç†å™¨ /etc/gdm/ # GDM é…ç½® /etc/lightdm/ # LightDM é…ç½® /etc/sddm.conf # SDDM é…ç½® ","date":"2025-10-19","objectID":"/posts/linux-desktop-3-session-graphics/:10:3","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Graphics","Wayland","X11"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“","uri":"/posts/linux-desktop-3-session-graphics/#é‡è¦é…ç½®æ–‡ä»¶ä½ç½®"},{"categories":["tech"],"content":"å…¨é¢ä»‹ç» systemd æœåŠ¡ç®¡ç†ã€ç”¨æˆ·æœåŠ¡ã€D-Bus é€šä¿¡æœºåˆ¶å’Œæ¡Œé¢ç¯å¢ƒé›†æˆï¼ŒæŒæ¡ç°ä»£ Linux ç³»ç»Ÿçš„æœåŠ¡æ¶æ„","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/"},{"categories":["tech"],"content":" AI åˆ›ä½œå£°æ˜ï¼šæœ¬ç³»åˆ—æ–‡ç« ç”±ç¬”è€…å€ŸåŠ© ChatGPT, Kimi K2, è±†åŒ…å’Œ Cursor ç­‰ AI å·¥å…·åˆ›ä½œï¼Œæœ‰å¾ˆå¤§ç¯‡å¹…çš„å†…å®¹å®Œå…¨ç”± AI åœ¨æˆ‘çš„æŒ‡å¯¼ä¸‹ç”Ÿæˆã€‚å¦‚æœ‰é”™è¯¯ï¼Œè¿˜è¯·æŒ‡æ­£ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:0:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#"},{"categories":["tech"],"content":" æ¦‚è¿°æœ¬æ–‡æ˜¯ã€ŠLinux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ã€‹ç³»åˆ—çš„ç¬¬äºŒç¯‡ï¼Œä¸“æ³¨äº systemd ç”Ÿæ€ç³»ç»Ÿä¸æœåŠ¡ç®¡ç†ã€‚åœ¨ä¸Šä¸€ç¯‡ä¸­ï¼Œæˆ‘ä»¬äº†è§£äº†ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶ï¼Œç°åœ¨è®©æˆ‘ä»¬æ·±å…¥æ¢è®¨ systemd æ ¸å¿ƒåŠŸèƒ½ä»¥åŠ systemd ç”Ÿæ€ç³»ç»Ÿä¸­çš„å„ä¸ªä¸“é—¨åŒ–ç»„ä»¶ã€‚ âš™ï¸ æœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚ä¸‹å†…å®¹ï¼š systemd æ ¸å¿ƒåŠŸèƒ½ï¼šæœåŠ¡ç®¡ç†ã€ä¾èµ–å…³ç³»ã€å¹¶è¡Œå¯åŠ¨ã€å•å…ƒç±»å‹é…ç½® systemd ç”Ÿæ€ç³»ç»ŸæœåŠ¡ï¼šsystemd-journaldã€systemd-oomdã€systemd-resolvedã€systemd-timesyncdã€systemd-udevd ç­‰ è®¾å¤‡ç®¡ç†ï¼šudev è§„åˆ™å’Œè®¾å¤‡æƒé™åˆ†é…ã€æ•…éšœæ’æŸ¥ D-Bus ç³»ç»Ÿæ€»çº¿ï¼šè¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ã€æƒé™ç®¡æ§ã€è°ƒè¯•æ–¹æ³• ","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:1:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#æ¦‚è¿°"},{"categories":["tech"],"content":" 1. systemd æ ¸å¿ƒåŠŸèƒ½systemd ä½œä¸º PID 1ï¼Œæ˜¯ç°ä»£ Linux ç³»ç»Ÿçš„åˆå§‹åŒ–ç³»ç»Ÿå’ŒæœåŠ¡ç®¡ç†å™¨ã€‚å®ƒè´Ÿè´£å¹¶è¡Œå¯åŠ¨æœåŠ¡ã€ç»´æŠ¤ä¾èµ–å…³ç³»ã€ç®¡ç† cgroupsï¼Œå¹¶æä¾›ç»Ÿä¸€çš„ç³»ç»Ÿç®¡ç†æ¥å£ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:2:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#1-systemd-æ ¸å¿ƒåŠŸèƒ½"},{"categories":["tech"],"content":" 1.1 systemd æ¦‚è§ˆä¸åŸºæœ¬æ“ä½œsystemd ä½œä¸ºç°ä»£ Linux ç³»ç»Ÿçš„åˆå§‹åŒ–ç³»ç»Ÿå’ŒæœåŠ¡ç®¡ç†å™¨ï¼Œä¸»è¦ä¸“æ³¨äºæœåŠ¡ç®¡ç†å’Œç³»ç»Ÿæ§åˆ¶ã€‚ æ ¸å¿ƒåŠŸèƒ½ï¼š æœåŠ¡ç®¡ç†ï¼šå¹¶è¡Œå¯åŠ¨ unitsï¼Œç»´æŠ¤ä¾èµ–å…³ç³» èµ„æºæ§åˆ¶ï¼šé€šè¿‡ cgroups å®ç°è¿›ç¨‹éš”ç¦»å’Œèµ„æºé™åˆ¶ ç³»ç»ŸçŠ¶æ€ç®¡ç†ï¼šé€šè¿‡ target ç®¡ç†ä¸åŒçš„ç³»ç»Ÿè¿è¡ŒçŠ¶æ€ å•å…ƒç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼šç®¡ç†å„ç§ç±»å‹å•å…ƒï¼ˆserviceã€mountã€timer ç­‰ï¼‰çš„å¯åŠ¨ã€åœæ­¢å’Œé‡å¯ å¸¸ç”¨å‘½ä»¤ï¼š bash # ç³»ç»ŸçŠ¶æ€æŸ¥çœ‹ systemctl get-default # é»˜è®¤ target systemctl list-units --type=service # åˆ—å‡ºæœåŠ¡ systemctl status sshd.service # æœåŠ¡çŠ¶æ€ # æ€§èƒ½åˆ†æ systemd-analyze blame # å¯åŠ¨è€—æ—¶åˆ†æ systemd-analyze critical-chain # å…³é”®è·¯å¾„åˆ†æ # æœåŠ¡ç®¡ç† systemctl start/stop/restart service # æœåŠ¡æ§åˆ¶ systemctl enable/disable service # å¼€æœºè‡ªå¯æ§åˆ¶ systemctl reload service # é‡è½½é…ç½® NixOS ç‰¹æ®Šè¯´æ˜ï¼šåœ¨ NixOS ä¸­ï¼Œ/etc/systemd/system ä¸‹çš„é…ç½®æ–‡ä»¶éƒ½æ˜¯é€šè¿‡å£°æ˜å¼å‚æ•°ç”Ÿæˆçš„è½¯é“¾æ¥ï¼ŒæŒ‡å‘ /nix/storeã€‚ä¿®æ”¹é…ç½®åº”é€šè¿‡ NixOS é…ç½®ç³»ç»Ÿï¼Œè€Œéç›´æ¥ç¼–è¾‘è¿™äº›æ–‡ä»¶ã€‚NixOS æ²¡æœ‰ä¼ ç»Ÿçš„ /usr å’Œ /lib ç­‰ FHS ç›®å½•ï¼Œæ‰€æœ‰è½¯ä»¶åŒ…éƒ½å­˜å‚¨åœ¨ /nix/store ä¸­ï¼Œé€šè¿‡/run/current-system/sw/ ç­‰ç¬¦å·é“¾æ¥æä¾›è®¿é—®ã€‚ é…ç½®æ–‡ä»¶è·¯å¾„ï¼š /etc/systemd/system/ï¼šç³»ç»Ÿçº§æœåŠ¡é…ç½® /run/current-system/sw/lib/systemd/system/ï¼ˆNixOSï¼‰æˆ– /usr/lib/systemd/system/ï¼ˆä¼ ç»Ÿå‘è¡Œç‰ˆï¼‰ï¼šè½¯ä»¶åŒ…æä¾›çš„é»˜è®¤é…ç½® /etc/systemd/user/ï¼šç”¨æˆ·çº§æœåŠ¡é…ç½® ","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:2:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#11-systemd-æ¦‚è§ˆä¸åŸºæœ¬æ“ä½œ"},{"categories":["tech"],"content":" 1.2 æœåŠ¡å•å…ƒç±»å‹ä¸é…ç½®systemd æ”¯æŒå¤šç§å•å…ƒç±»å‹ï¼Œæ¯ç§ç±»å‹éƒ½æœ‰å…¶ç‰¹å®šçš„ç”¨é€”å’Œé…ç½®æ–¹å¼ã€‚ ä¸»è¦å•å…ƒç±»å‹ï¼š serviceï¼šæœåŠ¡å•å…ƒï¼Œç®¡ç†åå°è¿›ç¨‹ targetï¼šç›®æ ‡å•å…ƒï¼Œç”¨äºç³»ç»ŸçŠ¶æ€ç®¡ç† mountï¼šæŒ‚è½½å•å…ƒï¼Œç®¡ç†æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ timerï¼šå®šæ—¶å™¨å•å…ƒï¼Œæ›¿ä»£ cron ä»»åŠ¡ socketï¼šå¥—æ¥å­—å•å…ƒï¼ŒæŒ‰éœ€å¯åŠ¨æœåŠ¡ æœåŠ¡å•å…ƒé…ç½®ç¤ºä¾‹ï¼š ini [Unit] Description=My Custom Service After=network.target Wants=network.target [Service] Type=simple ExecStart=/usr/bin/my-service Restart=always User=myuser Group=mygroup [Install] WantedBy=multi-user.target ","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:2:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#12-æœåŠ¡å•å…ƒç±»å‹ä¸é…ç½®"},{"categories":["tech"],"content":" 1.3 systemd ä¾èµ–å…³ç³»ä¸å¯åŠ¨é¡ºåºsystemd é€šè¿‡ä¾èµ–å…³ç³»ç®¡ç†æœåŠ¡çš„å¯åŠ¨é¡ºåºï¼Œç¡®ä¿æœåŠ¡æŒ‰æ­£ç¡®çš„é¡ºåºå¯åŠ¨ã€‚ ä¾èµ–å…³ç³»ç±»å‹ï¼š Requiresï¼šå¼ºä¾èµ–ï¼Œè¢«ä¾èµ–æœåŠ¡å¤±è´¥æ—¶ï¼Œä¾èµ–æœåŠ¡ä¹Ÿä¼šå¤±è´¥ Wantsï¼šå¼±ä¾èµ–ï¼Œè¢«ä¾èµ–æœåŠ¡å¤±è´¥æ—¶ï¼Œä¾èµ–æœåŠ¡ä»å¯å¯åŠ¨ Afterï¼šå¯åŠ¨é¡ºåºä¾èµ–ï¼Œç¡®ä¿åœ¨æŒ‡å®šæœåŠ¡ä¹‹åå¯åŠ¨ Beforeï¼šå¯åŠ¨é¡ºåºä¾èµ–ï¼Œç¡®ä¿åœ¨æŒ‡å®šæœåŠ¡ä¹‹å‰å¯åŠ¨ ç¤ºä¾‹é…ç½®ï¼š ini [Unit] Description=Web Server After=network.target Wants=network.target Requires=nginx.service [Service] Type=forking ExecStart=/usr/sbin/nginx Restart=always [Install] WantedBy=multi-user.target ","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:2:3","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#13-systemd-ä¾èµ–å…³ç³»ä¸å¯åŠ¨é¡ºåº"},{"categories":["tech"],"content":" 2. systemd ç”Ÿæ€ç³»ç»ŸæœåŠ¡é™¤äº†åŸºæœ¬çš„æœåŠ¡ç®¡ç†å¤–ï¼Œsystemd è¿˜æä¾›äº†å¤šä¸ªä¸“é—¨åŒ–çš„ç³»ç»ŸæœåŠ¡æ¥æ”¯æŒç°ä»£ Linux æ¡Œé¢çš„æ ¸å¿ƒåŠŸèƒ½ï¼ŒåŒ…æ‹¬æ—¥å¿—ç®¡ç†ã€å†…å­˜ç®¡ç†ã€DNS è§£æå’Œæ—¶é—´åŒæ­¥ç­‰ã€‚ æœ¬èŠ‚å†…å®¹ä»…ä»‹ç»æœ€æ ¸å¿ƒçš„å‡ ä¸ª systemd æœåŠ¡ã€‚ systemd å…¨å®¶æ¡¶ï¼Œä½ å€¼å¾—æ‹¥æœ‰ï¼ˆ ","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:3:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#2-systemd-ç”Ÿæ€ç³»ç»ŸæœåŠ¡"},{"categories":["tech"],"content":" 2.1 æ—¥å¿—ç³»ç»Ÿï¼šsystemd-journaldsystemd-journald æ˜¯ systemd å†…ç½®çš„æ—¥å¿—æ”¶é›†å®ˆæŠ¤è¿›ç¨‹ï¼Œç»Ÿä¸€å¤„ç†å†…æ ¸ã€ç³»ç»ŸæœåŠ¡åŠåº”ç”¨çš„æ—¥å¿—ï¼Œæ˜¯ç°ä»£ Linux ç³»ç»Ÿæ—¥å¿—ç®¡ç†çš„æ ¸å¿ƒç»„ä»¶ã€‚ 2.1.1 æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ è¯´æ˜ ç»Ÿä¸€æ”¶é›† å†…æ ¸æ—¥å¿—ã€systemd å•å…ƒï¼ˆstdout/stderrï¼‰ã€æ™®é€šè¿›ç¨‹ã€å®¹å™¨ã€ç¬¬ä¸‰æ–¹ syslog å‡æ±‡æ€»åˆ°åŒä¸€æ—¥å¿—æµã€‚ äºŒè¿›åˆ¶ç´¢å¼• ä»¥ B+æ ‘ï¼ˆæœ‰åºç´¢å¼•ï¼‰+åç§»é‡å»ºç«‹å­—æ®µç´¢å¼•ï¼Œæ”¯æŒç²¾ç¡®æŸ¥è¯¢ä¸æ—¶é—´/ä¼˜å…ˆçº§èŒƒå›´æŸ¥è¯¢ï¼Œé€Ÿåº¦è¿œè¶…æ–‡æœ¬ grepã€‚ å­—æ®µåŒ–å­˜å‚¨ è‡ªåŠ¨ç”Ÿæˆ _PIDã€_UIDã€_SYSTEMD_UNIT ç­‰å¯ä¿¡å­—æ®µï¼ˆä¸å¯ä¼ªé€ ï¼‰ï¼›æ”¯æŒè‡ªå®šä¹‰ FOO=bar å­—æ®µã€‚ è‡ªåŠ¨è½®è½¬ä¸å‹ç¼© æŒ‰ã€Œå¤§å°ã€æ—¶é—´ã€æ–‡ä»¶æ•°ã€å›æ”¶æ—¥å¿—ï¼›è½®è½¬åé»˜è®¤ç”¨ LZ4 å‹ç¼©ï¼ŒèŠ‚çœ 60% ä»¥ä¸Šç©ºé—´ã€‚ é€Ÿç‡é™åˆ¶ å¯é€šè¿‡ RateLimitIntervalSec=/RateLimitBurst= è°ƒæ•´ã€‚ æ—¥å¿—é˜²ç¯¡æ”¹ é…ç½® Seal=yes åï¼Œç”¨ journalctl --setup-keys ç”Ÿæˆå¯†é’¥ï¼Œä¹‹åå¯ç”¨è¯¥å¯†é’¥éªŒè¯æ—¥å¿—å®Œæ•´æ€§ã€‚ 2.1.2 æ—¥å¿—çš„4ä¸ªæ”¶é›†å…¥å£journald ä»…é€šè¿‡æ ‡å‡†åŒ–å…¥å£æ”¶é›†æ—¥å¿—ï¼Œç¡®ä¿æ¥æºå¯è¿½æº¯ï¼š å†…æ ¸æ—¥å¿—ï¼šå†…æ ¸ printk() è¾“å‡º â†’ /dev/kmsg â†’ journaldï¼ˆä¼šè‡ªåŠ¨æ·»åŠ  _PID/_COMM ç­‰å­—æ®µï¼‰ï¼› systemd å•å…ƒ stdout/stderrï¼šå•å…ƒè¿›ç¨‹è¾“å‡ºè‡ªåŠ¨æ•è·ï¼Œä¼šé™„åŠ _SYSTEMD_UNIT=xxx.service ç­‰ systemd ç›¸å…³å­—æ®µï¼› æœ¬åœ° Socketï¼š/run/systemd/journal/socket ç­‰ï¼Œæ¥æ”¶ logger/systemd-cat åŠæ—§ syslog åº”ç”¨æ—¥å¿—ï¼› æ˜¾å¼ APIï¼šsd_journal_send()ï¼Œä»…éœ€è‡ªå®šä¹‰å¤æ‚ç»“æ„åŒ–æ—¥å¿—æ—¶ä½¿ç”¨ï¼ˆè­¬å¦‚ Docker daemonï¼‰, ä¸€èˆ¬ç›´æ¥ print å³å¯ã€‚ 2.1.3 æ—¥å¿—ä¼˜å…ˆçº§ä¸æ ¸å¿ƒé…ç½® 1. æ—¥å¿—ä¼˜å…ˆçº§ç®€è¿°æ—¥å¿—æŒ‰ä¸¥é‡ç¨‹åº¦åˆ† 8 çº§ï¼ˆæ•°å­—è¶Šå°ï¼Œçº§åˆ«è¶Šé«˜ï¼‰ï¼Œå¸¸ç”¨çº§åˆ«ï¼š errï¼šé”™è¯¯ï¼ˆéƒ¨åˆ†åŠŸèƒ½å¼‚å¸¸ï¼‰ï¼Œçº§åˆ« 3 warningï¼šè­¦å‘Šï¼ˆæ½œåœ¨é£é™©ï¼‰ï¼Œçº§åˆ« 4 infoï¼šä¿¡æ¯ï¼ˆå¸¸è§„è¿è¡Œæ—¥å¿—ï¼‰ï¼Œçº§åˆ« 6 debugï¼šè°ƒè¯•ï¼ˆå¼€å‘ç»†èŠ‚ï¼‰ï¼Œçº§åˆ« 7 å¯ç”¨äºç­›é€‰å…³é”®æ—¥å¿—ã€‚ 2. journald é…ç½®ä¸»é…ç½®æ–‡ä»¶ï¼š/etc/systemd/journald.confï¼Œæ”¯æŒé€šè¿‡ /etc/systemd/journald.conf.d/*.conf è¦†ç›–é…ç½®ï¼Œæ ¸å¿ƒé…ç½®é¡¹å¦‚ä¸‹ï¼š é…ç½®é¡¹ è¯´æ˜ ç¤ºä¾‹ Storage= å­˜å‚¨ç­–ç•¥ persistentï¼ˆå­˜ /var/log/journalï¼Œæ¨èï¼‰/volatileï¼ˆå­˜å†…å­˜ï¼‰ SystemMaxUse= æŒä¹…å­˜å‚¨æœ€å¤§å ç”¨ 1G MaxRetentionSec= æ—¥å¿—æœ€å¤§ä¿ç•™æ—¶é—´ 1month ForwardToSyslog= æ˜¯å¦è½¬å‘åˆ°æ—§æ—¥å¿—ç³»ç»Ÿ yesï¼ˆå…¼å®¹ä¼ ç»Ÿæ–‡æœ¬æ—¥å¿—ï¼‰ Seal= æ˜¯å¦å¯ç”¨æ—¥å¿—é˜²ç¯¡æ”¹ yes ç”Ÿäº§é…ç½®ç¤ºä¾‹ï¼š ini # /etc/systemd/journald.conf.d/00-production.conf [Journal] Storage=persistent SystemMaxUse=2G MaxRetentionSec=3month ForwardToSyslog=yes Seal=yes é…ç½®ç”Ÿæ•ˆéœ€é‡å¯æœåŠ¡ï¼šsudo systemctl restart systemd-journald 2.1.4 å®éªŒï¼šç”¨ logger éªŒè¯æ—¥å¿—æ”¶é›†ä¸‹é¢æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ logger å°†ç»“æ„åŒ–æ—¥å¿—ç›´æ¥å†™è¿› journalï¼Œå¹¶ç«‹å³ç”¨ journalctl æ£€ç´¢ã€‚ é¦–å…ˆå†™å…¥æ—¥å¿—ï¼š bash logger --journald \u003c\u003cEOF SYSLOG_IDENTIFIER=myapp PRIORITY=3 MESSAGE=ç”¨æˆ·ç™»å½•å¤±è´¥ USER_ID=alice LOGIN_RESULT=fail EOF å…¶ä¸­çš„ SYSLOG_IDENTIFIER, PRIORITY, MESSAGE åœ¨ journald ä¸­éƒ½æœ‰å±æ€§å¯¹åº”ï¼Œè€Œåä¸¤ä¸ªUSER_ID ä¸ LOGIN_RESULT åˆ™å±äºè‡ªå®šä¹‰çš„æ—¥å¿—æ ‡ç­¾ã€‚ ç„¶åæŸ¥è¯¢æ—¥å¿—ï¼š bash # 2. æŒ‰æ ‡è¯†ç¬¦è¿‡æ»¤ journalctl -t myapp # ç­‰ä»·äº journalctl SYSLOG_IDENTIFIER=myapp # 3. æŒ‰ä¼˜å…ˆçº§+è‡ªå®šä¹‰å­—æ®µç²¾ç¡®å®šä½ journalctl -p err LOGIN_RESULT=fail 2.1.5 æ—§æ—¥å¿—ç³»ç»Ÿä¸ /var/log/ è§£æ æ—§æ—¥å¿—ç³»ç»Ÿï¼šåŸºäº syslog çš„æ–‡æœ¬ç®¡ç†åœ¨ systemd æ™®åŠå‰ï¼ŒLinux ä¾èµ– syslog åè®®+æ–‡æœ¬æ–‡ä»¶ ç®¡ç†æ—¥å¿—ï¼Œæ ¸å¿ƒç»„ä»¶æ˜¯rsyslogï¼ˆsyslog ä¸»æµå®ç°ï¼ŒåŠŸèƒ½å¼ºäºæ—©æœŸ syslogdï¼‰ã€‚ æ—§ç³»ç»Ÿå·¥ä½œæµï¼šåº”ç”¨é€šè¿‡ syslog(3) æ¥å£è¾“å‡ºæ—¥å¿— â†’ rsyslog æ¥æ”¶ â†’ æŒ‰ã€Œè®¾æ–½+ä¼˜å…ˆçº§ã€å†™å…¥ /var/log/ æ–‡æœ¬æ–‡ä»¶ï¼› ç°ä»£ç³»ç»Ÿä¸­çš„è§’è‰²ï¼šrsyslog ä¸å†æ˜¯æ ¸å¿ƒæ”¶é›†å™¨ï¼Œè€Œæ˜¯ä½œä¸ºã€Œå…¼å®¹å±‚ã€â€”â€”æ¥æ”¶ journald è½¬å‘çš„æ—¥å¿—ï¼Œç”Ÿæˆä¼ ç»Ÿæ–‡æœ¬æ–‡ä»¶ï¼ˆå¦‚ /var/log/auth.logï¼‰ï¼Œæˆ–è½¬å‘åˆ°è¿œç¨‹æ—¥å¿—æœåŠ¡å™¨ï¼ˆæ”¯æŒ TCP/TLS åŠ å¯†ï¼‰ã€‚ /var/log/ å¸¸è§æ–‡ä»¶åŠåŠŸèƒ½ç°ä»£ç³»ç»Ÿä¸­ï¼Œè¿™äº›æ–‡ä»¶ç”± rsyslog ç”Ÿæˆï¼ˆå…¼å®¹æ—§ä¹ æƒ¯ï¼‰ï¼Œä¸åŒå‘è¡Œç‰ˆåç§°ç•¥æœ‰å·®å¼‚ï¼Œä½†éƒ½ä¸ºçº¯æ–‡æœ¬æ ¼å¼ï¼š æ–‡ä»¶ï¼ˆæˆ–ç›®å½•ï¼‰ ä¸»è¦å‘è¡Œç‰ˆå·®å¼‚ åŠŸèƒ½è¯´æ˜ /var/log/messages RHEL/CentOS/SUSE ç³»ç»Ÿé€šç”¨æ—¥å¿—ï¼šæœåŠ¡å¯åœã€å†…æ ¸æç¤ºã€éä¸“é¡¹åº”ç”¨æ¶ˆæ¯ã€‚ /var/log/syslog Ubuntu/Debian ç­‰ä»·äº RHEL çš„ messagesï¼Œå­˜å‚¨å†…æ ¸åŠä¸€èˆ¬ç³»ç»Ÿæ—¥å¿—ã€‚ /var/log/auth.logï¼ˆUbuntuï¼‰ / /var/log/secureï¼ˆRHELï¼‰ åç§°ä¸åŒ è®¤è¯ä¸æˆæƒäº‹ä»¶ï¼šSSH ç™»å½•ã€su/sudoã€ç”¨æˆ·æ·»åŠ /åˆ é™¤ã€PAM å‘Šè­¦ã€‚å®‰å…¨å®¡è®¡å¿…çœ‹ã€‚ /var/log/kern.log é€šç”¨ ä»…å†…æ ¸ç¯æ§è¾“å‡ºï¼šç¡¬ä»¶æ•…éšœã€é©±åŠ¨åŠ è½½ã€OOMã€segfaultã€‚ /var/log/cron é€šç”¨ crond æ‰§è¡Œè®°å½•ï¼šä»»åŠ¡å¯åŠ¨/ç»“æŸã€é”™è¯¯è¾“å‡ºã€é‚®ä»¶å‘é€ç»“æœã€‚ /var/log/btmp é€šç”¨ äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè®°å½•å¤±è´¥ç™»å½•ï¼ˆlastb è¯»å–ï¼‰ï¼›å¤§å°éšæš´åŠ›ç ´è§£å¢é•¿ã€‚ /var/log/wtmp é€šç”¨ äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè®°å½•æˆåŠŸç™»å½•/æ³¨é”€/é‡å¯ï¼ˆlastã€who è¯»å–ï¼‰ã€‚ /var/log/lastlog é€šç”¨ äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè®°å½•æ¯ä¸ªç”¨æˆ·æœ€è¿‘ä¸€æ¬¡ç™»å½•æ—¶é—´ï¼ˆlastlog è¯»å–ï¼‰ã€‚ /var/log/journal/ å¯ç”¨ systemd-journald åå¯è§ ç›®å½•ï¼›è‹¥ Storage=persistentï¼Œåˆ™äºŒè¿›åˆ¶ journal æ–‡ä»¶å­˜äºæ­¤ã€‚ 2.1.6 æ—¥å¿—å†™å…¥æœ€ä½³å®è·µ åœºæ™¯ æ¨èåšæ³• Shellè„šæœ¬ï¼ˆç‹¬ç«‹è¿è¡Œï¼‰ logger -t è„šæœ¬å -p daemon.err \"é”™è¯¯ï¼š$msg\"ï¼ˆå¦‚ logger -t backup -p err \"å¤‡ä»½å¤±è´¥\"ï¼‰ åº”ç”¨ç¨‹åº ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ systemd service, å°‘æ•°åœºæ™¯å¯è€ƒè™‘ç›´æ¥è°ƒç”¨ sd_journal_send() API å®¹å™¨ Docker/Podman åŠ  --log-driver=journaldï¼ˆå®¹å™¨å†…æ­£å¸¸è¾“å‡ºå³å¯ï¼‰ é«˜é¢‘æ—¥å¿— è®¾ RateLimitIntervalSec=0 å…³é—­é™åˆ¶ï¼ˆéœ€è¯„ä¼°é£é™©ï¼‰ï¼Œæˆ–æ‰¹é‡å†™å…¥ æ•æ„Ÿä¿¡æ¯ è„±æ•å¤„ç†ï¼ˆå¦‚ PASSWORD=***ï¼‰ï¼Œé¿å…æ˜æ–‡å­˜å‚¨ 2.1.7 è¿ç»´å‘½ä»¤é€ŸæŸ¥ bash # ä¸€ã€æ—¥å¿—æŸ¥è¯¢ï¼ˆå«ä¼˜å…ˆçº§è¿‡æ»¤ï¼‰ # å®æ—¶è·Ÿè¸ªæœåŠ¡æ—¥å¿—ï¼ˆä»…çœ‹ err åŠä»¥ä¸Šçº§åˆ«ï¼‰ journalctl -f -p err -u sshd.service # ç­‰ä»·äº journalctl -f -p err _SYSTEMD_UNIT=sshd.service # æŒ‰æ—¶é—´+ä¼˜å…ˆçº§è¿‡æ»¤ï¼ˆè¿‡å»1å°æ—¶ warning åŠä»¥ä¸Šï¼‰ journalctl --since \"1h ago\" -p warning # -p çš„å‚æ•°æ—¢å¯ä½¿ç”¨åç§°ï¼Œä¹Ÿå¯ä½¿ç”¨å¯¹åº”çš„æ•°å­—ï¼Œwarning å¯¹åº” 4 journalctl --since \"1h ago\" -p 4 # å†…æ ¸æ—¥å¿—ï¼ˆæœ¬æ¬¡å¯åŠ¨çš„ err æ—¥å¿—ï¼‰ journalctl -k -p err -b # æŒ‰è‡ªå®šä¹‰å­—æ®µè¿‡æ»¤ï¼ˆUSER_ID=1001 + ä¼˜å…ˆçº§ errï¼‰ journalctl USER_ID=1001 -p err # é€šè¿‡ Perl æ ¼å¼çš„æ­£åˆ™è¡¨è¾¾å¼æœç´¢æ—¥å¿— journalctl --grep \"Auth\" # äºŒã€æ—¥å¿—ç®¡ç† # æŸ¥çœ‹ journal å ç”¨ç©ºé—´ sudo journalctl --disk-usage # æ¸…ç†æ—¥å¿—ï¼ˆä¿ç•™æœ€è¿‘2å‘¨/500Mï¼‰ sudo journalctl --vacuum-time=2weeks sudo journalctl --vacuum-size=500M # æ‰‹åŠ¨è½®è½¬æ—¥å¿— sudo journalctl --rotate # ä¸‰ã€æ—§æ—¥å¿—æ–‡ä»¶æ“ä½œ # å®æ—¶æŸ¥çœ‹è®¤è¯æ—¥å¿—ï¼ˆUbuntuï¼‰ tail -f /var/log/auth.log # å®æ—¶æŸ¥çœ‹è®¤è¯æ—¥å¿—ï¼ˆCentOSï¼‰ tail -f /var/log/secure # å››ã€æ—¥å¿—é˜²ç¯¡æ”¹éªŒè¯ sudo journalctl --setup-keys \u003e /etc/journal-sea","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:3:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#21-æ—¥å¿—ç³»ç»Ÿsystemd-journald"},{"categories":["tech"],"content":" 2.1 æ—¥å¿—ç³»ç»Ÿï¼šsystemd-journaldsystemd-journald æ˜¯ systemd å†…ç½®çš„æ—¥å¿—æ”¶é›†å®ˆæŠ¤è¿›ç¨‹ï¼Œç»Ÿä¸€å¤„ç†å†…æ ¸ã€ç³»ç»ŸæœåŠ¡åŠåº”ç”¨çš„æ—¥å¿—ï¼Œæ˜¯ç°ä»£ Linux ç³»ç»Ÿæ—¥å¿—ç®¡ç†çš„æ ¸å¿ƒç»„ä»¶ã€‚ 2.1.1 æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ è¯´æ˜ ç»Ÿä¸€æ”¶é›† å†…æ ¸æ—¥å¿—ã€systemd å•å…ƒï¼ˆstdout/stderrï¼‰ã€æ™®é€šè¿›ç¨‹ã€å®¹å™¨ã€ç¬¬ä¸‰æ–¹ syslog å‡æ±‡æ€»åˆ°åŒä¸€æ—¥å¿—æµã€‚ äºŒè¿›åˆ¶ç´¢å¼• ä»¥ B+æ ‘ï¼ˆæœ‰åºç´¢å¼•ï¼‰+åç§»é‡å»ºç«‹å­—æ®µç´¢å¼•ï¼Œæ”¯æŒç²¾ç¡®æŸ¥è¯¢ä¸æ—¶é—´/ä¼˜å…ˆçº§èŒƒå›´æŸ¥è¯¢ï¼Œé€Ÿåº¦è¿œè¶…æ–‡æœ¬ grepã€‚ å­—æ®µåŒ–å­˜å‚¨ è‡ªåŠ¨ç”Ÿæˆ _PIDã€_UIDã€_SYSTEMD_UNIT ç­‰å¯ä¿¡å­—æ®µï¼ˆä¸å¯ä¼ªé€ ï¼‰ï¼›æ”¯æŒè‡ªå®šä¹‰ FOO=bar å­—æ®µã€‚ è‡ªåŠ¨è½®è½¬ä¸å‹ç¼© æŒ‰ã€Œå¤§å°ã€æ—¶é—´ã€æ–‡ä»¶æ•°ã€å›æ”¶æ—¥å¿—ï¼›è½®è½¬åé»˜è®¤ç”¨ LZ4 å‹ç¼©ï¼ŒèŠ‚çœ 60% ä»¥ä¸Šç©ºé—´ã€‚ é€Ÿç‡é™åˆ¶ å¯é€šè¿‡ RateLimitIntervalSec=/RateLimitBurst= è°ƒæ•´ã€‚ æ—¥å¿—é˜²ç¯¡æ”¹ é…ç½® Seal=yes åï¼Œç”¨ journalctl --setup-keys ç”Ÿæˆå¯†é’¥ï¼Œä¹‹åå¯ç”¨è¯¥å¯†é’¥éªŒè¯æ—¥å¿—å®Œæ•´æ€§ã€‚ 2.1.2 æ—¥å¿—çš„4ä¸ªæ”¶é›†å…¥å£journald ä»…é€šè¿‡æ ‡å‡†åŒ–å…¥å£æ”¶é›†æ—¥å¿—ï¼Œç¡®ä¿æ¥æºå¯è¿½æº¯ï¼š å†…æ ¸æ—¥å¿—ï¼šå†…æ ¸ printk() è¾“å‡º â†’ /dev/kmsg â†’ journaldï¼ˆä¼šè‡ªåŠ¨æ·»åŠ  _PID/_COMM ç­‰å­—æ®µï¼‰ï¼› systemd å•å…ƒ stdout/stderrï¼šå•å…ƒè¿›ç¨‹è¾“å‡ºè‡ªåŠ¨æ•è·ï¼Œä¼šé™„åŠ _SYSTEMD_UNIT=xxx.service ç­‰ systemd ç›¸å…³å­—æ®µï¼› æœ¬åœ° Socketï¼š/run/systemd/journal/socket ç­‰ï¼Œæ¥æ”¶ logger/systemd-cat åŠæ—§ syslog åº”ç”¨æ—¥å¿—ï¼› æ˜¾å¼ APIï¼šsd_journal_send()ï¼Œä»…éœ€è‡ªå®šä¹‰å¤æ‚ç»“æ„åŒ–æ—¥å¿—æ—¶ä½¿ç”¨ï¼ˆè­¬å¦‚ Docker daemonï¼‰, ä¸€èˆ¬ç›´æ¥ print å³å¯ã€‚ 2.1.3 æ—¥å¿—ä¼˜å…ˆçº§ä¸æ ¸å¿ƒé…ç½® 1. æ—¥å¿—ä¼˜å…ˆçº§ç®€è¿°æ—¥å¿—æŒ‰ä¸¥é‡ç¨‹åº¦åˆ† 8 çº§ï¼ˆæ•°å­—è¶Šå°ï¼Œçº§åˆ«è¶Šé«˜ï¼‰ï¼Œå¸¸ç”¨çº§åˆ«ï¼š errï¼šé”™è¯¯ï¼ˆéƒ¨åˆ†åŠŸèƒ½å¼‚å¸¸ï¼‰ï¼Œçº§åˆ« 3 warningï¼šè­¦å‘Šï¼ˆæ½œåœ¨é£é™©ï¼‰ï¼Œçº§åˆ« 4 infoï¼šä¿¡æ¯ï¼ˆå¸¸è§„è¿è¡Œæ—¥å¿—ï¼‰ï¼Œçº§åˆ« 6 debugï¼šè°ƒè¯•ï¼ˆå¼€å‘ç»†èŠ‚ï¼‰ï¼Œçº§åˆ« 7 å¯ç”¨äºç­›é€‰å…³é”®æ—¥å¿—ã€‚ 2. journald é…ç½®ä¸»é…ç½®æ–‡ä»¶ï¼š/etc/systemd/journald.confï¼Œæ”¯æŒé€šè¿‡ /etc/systemd/journald.conf.d/*.conf è¦†ç›–é…ç½®ï¼Œæ ¸å¿ƒé…ç½®é¡¹å¦‚ä¸‹ï¼š é…ç½®é¡¹ è¯´æ˜ ç¤ºä¾‹ Storage= å­˜å‚¨ç­–ç•¥ persistentï¼ˆå­˜ /var/log/journalï¼Œæ¨èï¼‰/volatileï¼ˆå­˜å†…å­˜ï¼‰ SystemMaxUse= æŒä¹…å­˜å‚¨æœ€å¤§å ç”¨ 1G MaxRetentionSec= æ—¥å¿—æœ€å¤§ä¿ç•™æ—¶é—´ 1month ForwardToSyslog= æ˜¯å¦è½¬å‘åˆ°æ—§æ—¥å¿—ç³»ç»Ÿ yesï¼ˆå…¼å®¹ä¼ ç»Ÿæ–‡æœ¬æ—¥å¿—ï¼‰ Seal= æ˜¯å¦å¯ç”¨æ—¥å¿—é˜²ç¯¡æ”¹ yes ç”Ÿäº§é…ç½®ç¤ºä¾‹ï¼š ini # /etc/systemd/journald.conf.d/00-production.conf [Journal] Storage=persistent SystemMaxUse=2G MaxRetentionSec=3month ForwardToSyslog=yes Seal=yes é…ç½®ç”Ÿæ•ˆéœ€é‡å¯æœåŠ¡ï¼šsudo systemctl restart systemd-journald 2.1.4 å®éªŒï¼šç”¨ logger éªŒè¯æ—¥å¿—æ”¶é›†ä¸‹é¢æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ logger å°†ç»“æ„åŒ–æ—¥å¿—ç›´æ¥å†™è¿› journalï¼Œå¹¶ç«‹å³ç”¨ journalctl æ£€ç´¢ã€‚ é¦–å…ˆå†™å…¥æ—¥å¿—ï¼š bash logger --journald \u003c","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:3:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#211-æ ¸å¿ƒç‰¹æ€§"},{"categories":["tech"],"content":" 2.1 æ—¥å¿—ç³»ç»Ÿï¼šsystemd-journaldsystemd-journald æ˜¯ systemd å†…ç½®çš„æ—¥å¿—æ”¶é›†å®ˆæŠ¤è¿›ç¨‹ï¼Œç»Ÿä¸€å¤„ç†å†…æ ¸ã€ç³»ç»ŸæœåŠ¡åŠåº”ç”¨çš„æ—¥å¿—ï¼Œæ˜¯ç°ä»£ Linux ç³»ç»Ÿæ—¥å¿—ç®¡ç†çš„æ ¸å¿ƒç»„ä»¶ã€‚ 2.1.1 æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ è¯´æ˜ ç»Ÿä¸€æ”¶é›† å†…æ ¸æ—¥å¿—ã€systemd å•å…ƒï¼ˆstdout/stderrï¼‰ã€æ™®é€šè¿›ç¨‹ã€å®¹å™¨ã€ç¬¬ä¸‰æ–¹ syslog å‡æ±‡æ€»åˆ°åŒä¸€æ—¥å¿—æµã€‚ äºŒè¿›åˆ¶ç´¢å¼• ä»¥ B+æ ‘ï¼ˆæœ‰åºç´¢å¼•ï¼‰+åç§»é‡å»ºç«‹å­—æ®µç´¢å¼•ï¼Œæ”¯æŒç²¾ç¡®æŸ¥è¯¢ä¸æ—¶é—´/ä¼˜å…ˆçº§èŒƒå›´æŸ¥è¯¢ï¼Œé€Ÿåº¦è¿œè¶…æ–‡æœ¬ grepã€‚ å­—æ®µåŒ–å­˜å‚¨ è‡ªåŠ¨ç”Ÿæˆ _PIDã€_UIDã€_SYSTEMD_UNIT ç­‰å¯ä¿¡å­—æ®µï¼ˆä¸å¯ä¼ªé€ ï¼‰ï¼›æ”¯æŒè‡ªå®šä¹‰ FOO=bar å­—æ®µã€‚ è‡ªåŠ¨è½®è½¬ä¸å‹ç¼© æŒ‰ã€Œå¤§å°ã€æ—¶é—´ã€æ–‡ä»¶æ•°ã€å›æ”¶æ—¥å¿—ï¼›è½®è½¬åé»˜è®¤ç”¨ LZ4 å‹ç¼©ï¼ŒèŠ‚çœ 60% ä»¥ä¸Šç©ºé—´ã€‚ é€Ÿç‡é™åˆ¶ å¯é€šè¿‡ RateLimitIntervalSec=/RateLimitBurst= è°ƒæ•´ã€‚ æ—¥å¿—é˜²ç¯¡æ”¹ é…ç½® Seal=yes åï¼Œç”¨ journalctl --setup-keys ç”Ÿæˆå¯†é’¥ï¼Œä¹‹åå¯ç”¨è¯¥å¯†é’¥éªŒè¯æ—¥å¿—å®Œæ•´æ€§ã€‚ 2.1.2 æ—¥å¿—çš„4ä¸ªæ”¶é›†å…¥å£journald ä»…é€šè¿‡æ ‡å‡†åŒ–å…¥å£æ”¶é›†æ—¥å¿—ï¼Œç¡®ä¿æ¥æºå¯è¿½æº¯ï¼š å†…æ ¸æ—¥å¿—ï¼šå†…æ ¸ printk() è¾“å‡º â†’ /dev/kmsg â†’ journaldï¼ˆä¼šè‡ªåŠ¨æ·»åŠ  _PID/_COMM ç­‰å­—æ®µï¼‰ï¼› systemd å•å…ƒ stdout/stderrï¼šå•å…ƒè¿›ç¨‹è¾“å‡ºè‡ªåŠ¨æ•è·ï¼Œä¼šé™„åŠ _SYSTEMD_UNIT=xxx.service ç­‰ systemd ç›¸å…³å­—æ®µï¼› æœ¬åœ° Socketï¼š/run/systemd/journal/socket ç­‰ï¼Œæ¥æ”¶ logger/systemd-cat åŠæ—§ syslog åº”ç”¨æ—¥å¿—ï¼› æ˜¾å¼ APIï¼šsd_journal_send()ï¼Œä»…éœ€è‡ªå®šä¹‰å¤æ‚ç»“æ„åŒ–æ—¥å¿—æ—¶ä½¿ç”¨ï¼ˆè­¬å¦‚ Docker daemonï¼‰, ä¸€èˆ¬ç›´æ¥ print å³å¯ã€‚ 2.1.3 æ—¥å¿—ä¼˜å…ˆçº§ä¸æ ¸å¿ƒé…ç½® 1. æ—¥å¿—ä¼˜å…ˆçº§ç®€è¿°æ—¥å¿—æŒ‰ä¸¥é‡ç¨‹åº¦åˆ† 8 çº§ï¼ˆæ•°å­—è¶Šå°ï¼Œçº§åˆ«è¶Šé«˜ï¼‰ï¼Œå¸¸ç”¨çº§åˆ«ï¼š errï¼šé”™è¯¯ï¼ˆéƒ¨åˆ†åŠŸèƒ½å¼‚å¸¸ï¼‰ï¼Œçº§åˆ« 3 warningï¼šè­¦å‘Šï¼ˆæ½œåœ¨é£é™©ï¼‰ï¼Œçº§åˆ« 4 infoï¼šä¿¡æ¯ï¼ˆå¸¸è§„è¿è¡Œæ—¥å¿—ï¼‰ï¼Œçº§åˆ« 6 debugï¼šè°ƒè¯•ï¼ˆå¼€å‘ç»†èŠ‚ï¼‰ï¼Œçº§åˆ« 7 å¯ç”¨äºç­›é€‰å…³é”®æ—¥å¿—ã€‚ 2. journald é…ç½®ä¸»é…ç½®æ–‡ä»¶ï¼š/etc/systemd/journald.confï¼Œæ”¯æŒé€šè¿‡ /etc/systemd/journald.conf.d/*.conf è¦†ç›–é…ç½®ï¼Œæ ¸å¿ƒé…ç½®é¡¹å¦‚ä¸‹ï¼š é…ç½®é¡¹ è¯´æ˜ ç¤ºä¾‹ Storage= å­˜å‚¨ç­–ç•¥ persistentï¼ˆå­˜ /var/log/journalï¼Œæ¨èï¼‰/volatileï¼ˆå­˜å†…å­˜ï¼‰ SystemMaxUse= æŒä¹…å­˜å‚¨æœ€å¤§å ç”¨ 1G MaxRetentionSec= æ—¥å¿—æœ€å¤§ä¿ç•™æ—¶é—´ 1month ForwardToSyslog= æ˜¯å¦è½¬å‘åˆ°æ—§æ—¥å¿—ç³»ç»Ÿ yesï¼ˆå…¼å®¹ä¼ ç»Ÿæ–‡æœ¬æ—¥å¿—ï¼‰ Seal= æ˜¯å¦å¯ç”¨æ—¥å¿—é˜²ç¯¡æ”¹ yes ç”Ÿäº§é…ç½®ç¤ºä¾‹ï¼š ini # /etc/systemd/journald.conf.d/00-production.conf [Journal] Storage=persistent SystemMaxUse=2G MaxRetentionSec=3month ForwardToSyslog=yes Seal=yes é…ç½®ç”Ÿæ•ˆéœ€é‡å¯æœåŠ¡ï¼šsudo systemctl restart systemd-journald 2.1.4 å®éªŒï¼šç”¨ logger éªŒè¯æ—¥å¿—æ”¶é›†ä¸‹é¢æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ logger å°†ç»“æ„åŒ–æ—¥å¿—ç›´æ¥å†™è¿› journalï¼Œå¹¶ç«‹å³ç”¨ journalctl æ£€ç´¢ã€‚ é¦–å…ˆå†™å…¥æ—¥å¿—ï¼š bash logger --journald \u003c","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:3:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#212-æ—¥å¿—çš„4ä¸ªæ”¶é›†å…¥å£"},{"categories":["tech"],"content":" 2.1 æ—¥å¿—ç³»ç»Ÿï¼šsystemd-journaldsystemd-journald æ˜¯ systemd å†…ç½®çš„æ—¥å¿—æ”¶é›†å®ˆæŠ¤è¿›ç¨‹ï¼Œç»Ÿä¸€å¤„ç†å†…æ ¸ã€ç³»ç»ŸæœåŠ¡åŠåº”ç”¨çš„æ—¥å¿—ï¼Œæ˜¯ç°ä»£ Linux ç³»ç»Ÿæ—¥å¿—ç®¡ç†çš„æ ¸å¿ƒç»„ä»¶ã€‚ 2.1.1 æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ è¯´æ˜ ç»Ÿä¸€æ”¶é›† å†…æ ¸æ—¥å¿—ã€systemd å•å…ƒï¼ˆstdout/stderrï¼‰ã€æ™®é€šè¿›ç¨‹ã€å®¹å™¨ã€ç¬¬ä¸‰æ–¹ syslog å‡æ±‡æ€»åˆ°åŒä¸€æ—¥å¿—æµã€‚ äºŒè¿›åˆ¶ç´¢å¼• ä»¥ B+æ ‘ï¼ˆæœ‰åºç´¢å¼•ï¼‰+åç§»é‡å»ºç«‹å­—æ®µç´¢å¼•ï¼Œæ”¯æŒç²¾ç¡®æŸ¥è¯¢ä¸æ—¶é—´/ä¼˜å…ˆçº§èŒƒå›´æŸ¥è¯¢ï¼Œé€Ÿåº¦è¿œè¶…æ–‡æœ¬ grepã€‚ å­—æ®µåŒ–å­˜å‚¨ è‡ªåŠ¨ç”Ÿæˆ _PIDã€_UIDã€_SYSTEMD_UNIT ç­‰å¯ä¿¡å­—æ®µï¼ˆä¸å¯ä¼ªé€ ï¼‰ï¼›æ”¯æŒè‡ªå®šä¹‰ FOO=bar å­—æ®µã€‚ è‡ªåŠ¨è½®è½¬ä¸å‹ç¼© æŒ‰ã€Œå¤§å°ã€æ—¶é—´ã€æ–‡ä»¶æ•°ã€å›æ”¶æ—¥å¿—ï¼›è½®è½¬åé»˜è®¤ç”¨ LZ4 å‹ç¼©ï¼ŒèŠ‚çœ 60% ä»¥ä¸Šç©ºé—´ã€‚ é€Ÿç‡é™åˆ¶ å¯é€šè¿‡ RateLimitIntervalSec=/RateLimitBurst= è°ƒæ•´ã€‚ æ—¥å¿—é˜²ç¯¡æ”¹ é…ç½® Seal=yes åï¼Œç”¨ journalctl --setup-keys ç”Ÿæˆå¯†é’¥ï¼Œä¹‹åå¯ç”¨è¯¥å¯†é’¥éªŒè¯æ—¥å¿—å®Œæ•´æ€§ã€‚ 2.1.2 æ—¥å¿—çš„4ä¸ªæ”¶é›†å…¥å£journald ä»…é€šè¿‡æ ‡å‡†åŒ–å…¥å£æ”¶é›†æ—¥å¿—ï¼Œç¡®ä¿æ¥æºå¯è¿½æº¯ï¼š å†…æ ¸æ—¥å¿—ï¼šå†…æ ¸ printk() è¾“å‡º â†’ /dev/kmsg â†’ journaldï¼ˆä¼šè‡ªåŠ¨æ·»åŠ  _PID/_COMM ç­‰å­—æ®µï¼‰ï¼› systemd å•å…ƒ stdout/stderrï¼šå•å…ƒè¿›ç¨‹è¾“å‡ºè‡ªåŠ¨æ•è·ï¼Œä¼šé™„åŠ _SYSTEMD_UNIT=xxx.service ç­‰ systemd ç›¸å…³å­—æ®µï¼› æœ¬åœ° Socketï¼š/run/systemd/journal/socket ç­‰ï¼Œæ¥æ”¶ logger/systemd-cat åŠæ—§ syslog åº”ç”¨æ—¥å¿—ï¼› æ˜¾å¼ APIï¼šsd_journal_send()ï¼Œä»…éœ€è‡ªå®šä¹‰å¤æ‚ç»“æ„åŒ–æ—¥å¿—æ—¶ä½¿ç”¨ï¼ˆè­¬å¦‚ Docker daemonï¼‰, ä¸€èˆ¬ç›´æ¥ print å³å¯ã€‚ 2.1.3 æ—¥å¿—ä¼˜å…ˆçº§ä¸æ ¸å¿ƒé…ç½® 1. æ—¥å¿—ä¼˜å…ˆçº§ç®€è¿°æ—¥å¿—æŒ‰ä¸¥é‡ç¨‹åº¦åˆ† 8 çº§ï¼ˆæ•°å­—è¶Šå°ï¼Œçº§åˆ«è¶Šé«˜ï¼‰ï¼Œå¸¸ç”¨çº§åˆ«ï¼š errï¼šé”™è¯¯ï¼ˆéƒ¨åˆ†åŠŸèƒ½å¼‚å¸¸ï¼‰ï¼Œçº§åˆ« 3 warningï¼šè­¦å‘Šï¼ˆæ½œåœ¨é£é™©ï¼‰ï¼Œçº§åˆ« 4 infoï¼šä¿¡æ¯ï¼ˆå¸¸è§„è¿è¡Œæ—¥å¿—ï¼‰ï¼Œçº§åˆ« 6 debugï¼šè°ƒè¯•ï¼ˆå¼€å‘ç»†èŠ‚ï¼‰ï¼Œçº§åˆ« 7 å¯ç”¨äºç­›é€‰å…³é”®æ—¥å¿—ã€‚ 2. journald é…ç½®ä¸»é…ç½®æ–‡ä»¶ï¼š/etc/systemd/journald.confï¼Œæ”¯æŒé€šè¿‡ /etc/systemd/journald.conf.d/*.conf è¦†ç›–é…ç½®ï¼Œæ ¸å¿ƒé…ç½®é¡¹å¦‚ä¸‹ï¼š é…ç½®é¡¹ è¯´æ˜ ç¤ºä¾‹ Storage= å­˜å‚¨ç­–ç•¥ persistentï¼ˆå­˜ /var/log/journalï¼Œæ¨èï¼‰/volatileï¼ˆå­˜å†…å­˜ï¼‰ SystemMaxUse= æŒä¹…å­˜å‚¨æœ€å¤§å ç”¨ 1G MaxRetentionSec= æ—¥å¿—æœ€å¤§ä¿ç•™æ—¶é—´ 1month ForwardToSyslog= æ˜¯å¦è½¬å‘åˆ°æ—§æ—¥å¿—ç³»ç»Ÿ yesï¼ˆå…¼å®¹ä¼ ç»Ÿæ–‡æœ¬æ—¥å¿—ï¼‰ Seal= æ˜¯å¦å¯ç”¨æ—¥å¿—é˜²ç¯¡æ”¹ yes ç”Ÿäº§é…ç½®ç¤ºä¾‹ï¼š ini # /etc/systemd/journald.conf.d/00-production.conf [Journal] Storage=persistent SystemMaxUse=2G MaxRetentionSec=3month ForwardToSyslog=yes Seal=yes é…ç½®ç”Ÿæ•ˆéœ€é‡å¯æœåŠ¡ï¼šsudo systemctl restart systemd-journald 2.1.4 å®éªŒï¼šç”¨ logger éªŒè¯æ—¥å¿—æ”¶é›†ä¸‹é¢æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ logger å°†ç»“æ„åŒ–æ—¥å¿—ç›´æ¥å†™è¿› journalï¼Œå¹¶ç«‹å³ç”¨ journalctl æ£€ç´¢ã€‚ é¦–å…ˆå†™å…¥æ—¥å¿—ï¼š bash logger --journald \u003c","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:3:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#213-æ—¥å¿—ä¼˜å…ˆçº§ä¸æ ¸å¿ƒé…ç½®"},{"categories":["tech"],"content":" 2.1 æ—¥å¿—ç³»ç»Ÿï¼šsystemd-journaldsystemd-journald æ˜¯ systemd å†…ç½®çš„æ—¥å¿—æ”¶é›†å®ˆæŠ¤è¿›ç¨‹ï¼Œç»Ÿä¸€å¤„ç†å†…æ ¸ã€ç³»ç»ŸæœåŠ¡åŠåº”ç”¨çš„æ—¥å¿—ï¼Œæ˜¯ç°ä»£ Linux ç³»ç»Ÿæ—¥å¿—ç®¡ç†çš„æ ¸å¿ƒç»„ä»¶ã€‚ 2.1.1 æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ è¯´æ˜ ç»Ÿä¸€æ”¶é›† å†…æ ¸æ—¥å¿—ã€systemd å•å…ƒï¼ˆstdout/stderrï¼‰ã€æ™®é€šè¿›ç¨‹ã€å®¹å™¨ã€ç¬¬ä¸‰æ–¹ syslog å‡æ±‡æ€»åˆ°åŒä¸€æ—¥å¿—æµã€‚ äºŒè¿›åˆ¶ç´¢å¼• ä»¥ B+æ ‘ï¼ˆæœ‰åºç´¢å¼•ï¼‰+åç§»é‡å»ºç«‹å­—æ®µç´¢å¼•ï¼Œæ”¯æŒç²¾ç¡®æŸ¥è¯¢ä¸æ—¶é—´/ä¼˜å…ˆçº§èŒƒå›´æŸ¥è¯¢ï¼Œé€Ÿåº¦è¿œè¶…æ–‡æœ¬ grepã€‚ å­—æ®µåŒ–å­˜å‚¨ è‡ªåŠ¨ç”Ÿæˆ _PIDã€_UIDã€_SYSTEMD_UNIT ç­‰å¯ä¿¡å­—æ®µï¼ˆä¸å¯ä¼ªé€ ï¼‰ï¼›æ”¯æŒè‡ªå®šä¹‰ FOO=bar å­—æ®µã€‚ è‡ªåŠ¨è½®è½¬ä¸å‹ç¼© æŒ‰ã€Œå¤§å°ã€æ—¶é—´ã€æ–‡ä»¶æ•°ã€å›æ”¶æ—¥å¿—ï¼›è½®è½¬åé»˜è®¤ç”¨ LZ4 å‹ç¼©ï¼ŒèŠ‚çœ 60% ä»¥ä¸Šç©ºé—´ã€‚ é€Ÿç‡é™åˆ¶ å¯é€šè¿‡ RateLimitIntervalSec=/RateLimitBurst= è°ƒæ•´ã€‚ æ—¥å¿—é˜²ç¯¡æ”¹ é…ç½® Seal=yes åï¼Œç”¨ journalctl --setup-keys ç”Ÿæˆå¯†é’¥ï¼Œä¹‹åå¯ç”¨è¯¥å¯†é’¥éªŒè¯æ—¥å¿—å®Œæ•´æ€§ã€‚ 2.1.2 æ—¥å¿—çš„4ä¸ªæ”¶é›†å…¥å£journald ä»…é€šè¿‡æ ‡å‡†åŒ–å…¥å£æ”¶é›†æ—¥å¿—ï¼Œç¡®ä¿æ¥æºå¯è¿½æº¯ï¼š å†…æ ¸æ—¥å¿—ï¼šå†…æ ¸ printk() è¾“å‡º â†’ /dev/kmsg â†’ journaldï¼ˆä¼šè‡ªåŠ¨æ·»åŠ  _PID/_COMM ç­‰å­—æ®µï¼‰ï¼› systemd å•å…ƒ stdout/stderrï¼šå•å…ƒè¿›ç¨‹è¾“å‡ºè‡ªåŠ¨æ•è·ï¼Œä¼šé™„åŠ _SYSTEMD_UNIT=xxx.service ç­‰ systemd ç›¸å…³å­—æ®µï¼› æœ¬åœ° Socketï¼š/run/systemd/journal/socket ç­‰ï¼Œæ¥æ”¶ logger/systemd-cat åŠæ—§ syslog åº”ç”¨æ—¥å¿—ï¼› æ˜¾å¼ APIï¼šsd_journal_send()ï¼Œä»…éœ€è‡ªå®šä¹‰å¤æ‚ç»“æ„åŒ–æ—¥å¿—æ—¶ä½¿ç”¨ï¼ˆè­¬å¦‚ Docker daemonï¼‰, ä¸€èˆ¬ç›´æ¥ print å³å¯ã€‚ 2.1.3 æ—¥å¿—ä¼˜å…ˆçº§ä¸æ ¸å¿ƒé…ç½® 1. æ—¥å¿—ä¼˜å…ˆçº§ç®€è¿°æ—¥å¿—æŒ‰ä¸¥é‡ç¨‹åº¦åˆ† 8 çº§ï¼ˆæ•°å­—è¶Šå°ï¼Œçº§åˆ«è¶Šé«˜ï¼‰ï¼Œå¸¸ç”¨çº§åˆ«ï¼š errï¼šé”™è¯¯ï¼ˆéƒ¨åˆ†åŠŸèƒ½å¼‚å¸¸ï¼‰ï¼Œçº§åˆ« 3 warningï¼šè­¦å‘Šï¼ˆæ½œåœ¨é£é™©ï¼‰ï¼Œçº§åˆ« 4 infoï¼šä¿¡æ¯ï¼ˆå¸¸è§„è¿è¡Œæ—¥å¿—ï¼‰ï¼Œçº§åˆ« 6 debugï¼šè°ƒè¯•ï¼ˆå¼€å‘ç»†èŠ‚ï¼‰ï¼Œçº§åˆ« 7 å¯ç”¨äºç­›é€‰å…³é”®æ—¥å¿—ã€‚ 2. journald é…ç½®ä¸»é…ç½®æ–‡ä»¶ï¼š/etc/systemd/journald.confï¼Œæ”¯æŒé€šè¿‡ /etc/systemd/journald.conf.d/*.conf è¦†ç›–é…ç½®ï¼Œæ ¸å¿ƒé…ç½®é¡¹å¦‚ä¸‹ï¼š é…ç½®é¡¹ è¯´æ˜ ç¤ºä¾‹ Storage= å­˜å‚¨ç­–ç•¥ persistentï¼ˆå­˜ /var/log/journalï¼Œæ¨èï¼‰/volatileï¼ˆå­˜å†…å­˜ï¼‰ SystemMaxUse= æŒä¹…å­˜å‚¨æœ€å¤§å ç”¨ 1G MaxRetentionSec= æ—¥å¿—æœ€å¤§ä¿ç•™æ—¶é—´ 1month ForwardToSyslog= æ˜¯å¦è½¬å‘åˆ°æ—§æ—¥å¿—ç³»ç»Ÿ yesï¼ˆå…¼å®¹ä¼ ç»Ÿæ–‡æœ¬æ—¥å¿—ï¼‰ Seal= æ˜¯å¦å¯ç”¨æ—¥å¿—é˜²ç¯¡æ”¹ yes ç”Ÿäº§é…ç½®ç¤ºä¾‹ï¼š ini # /etc/systemd/journald.conf.d/00-production.conf [Journal] Storage=persistent SystemMaxUse=2G MaxRetentionSec=3month ForwardToSyslog=yes Seal=yes é…ç½®ç”Ÿæ•ˆéœ€é‡å¯æœåŠ¡ï¼šsudo systemctl restart systemd-journald 2.1.4 å®éªŒï¼šç”¨ logger éªŒè¯æ—¥å¿—æ”¶é›†ä¸‹é¢æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ logger å°†ç»“æ„åŒ–æ—¥å¿—ç›´æ¥å†™è¿› journalï¼Œå¹¶ç«‹å³ç”¨ journalctl æ£€ç´¢ã€‚ é¦–å…ˆå†™å…¥æ—¥å¿—ï¼š bash logger --journald \u003c","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:3:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#1-æ—¥å¿—ä¼˜å…ˆçº§ç®€è¿°"},{"categories":["tech"],"content":" 2.1 æ—¥å¿—ç³»ç»Ÿï¼šsystemd-journaldsystemd-journald æ˜¯ systemd å†…ç½®çš„æ—¥å¿—æ”¶é›†å®ˆæŠ¤è¿›ç¨‹ï¼Œç»Ÿä¸€å¤„ç†å†…æ ¸ã€ç³»ç»ŸæœåŠ¡åŠåº”ç”¨çš„æ—¥å¿—ï¼Œæ˜¯ç°ä»£ Linux ç³»ç»Ÿæ—¥å¿—ç®¡ç†çš„æ ¸å¿ƒç»„ä»¶ã€‚ 2.1.1 æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ è¯´æ˜ ç»Ÿä¸€æ”¶é›† å†…æ ¸æ—¥å¿—ã€systemd å•å…ƒï¼ˆstdout/stderrï¼‰ã€æ™®é€šè¿›ç¨‹ã€å®¹å™¨ã€ç¬¬ä¸‰æ–¹ syslog å‡æ±‡æ€»åˆ°åŒä¸€æ—¥å¿—æµã€‚ äºŒè¿›åˆ¶ç´¢å¼• ä»¥ B+æ ‘ï¼ˆæœ‰åºç´¢å¼•ï¼‰+åç§»é‡å»ºç«‹å­—æ®µç´¢å¼•ï¼Œæ”¯æŒç²¾ç¡®æŸ¥è¯¢ä¸æ—¶é—´/ä¼˜å…ˆçº§èŒƒå›´æŸ¥è¯¢ï¼Œé€Ÿåº¦è¿œè¶…æ–‡æœ¬ grepã€‚ å­—æ®µåŒ–å­˜å‚¨ è‡ªåŠ¨ç”Ÿæˆ _PIDã€_UIDã€_SYSTEMD_UNIT ç­‰å¯ä¿¡å­—æ®µï¼ˆä¸å¯ä¼ªé€ ï¼‰ï¼›æ”¯æŒè‡ªå®šä¹‰ FOO=bar å­—æ®µã€‚ è‡ªåŠ¨è½®è½¬ä¸å‹ç¼© æŒ‰ã€Œå¤§å°ã€æ—¶é—´ã€æ–‡ä»¶æ•°ã€å›æ”¶æ—¥å¿—ï¼›è½®è½¬åé»˜è®¤ç”¨ LZ4 å‹ç¼©ï¼ŒèŠ‚çœ 60% ä»¥ä¸Šç©ºé—´ã€‚ é€Ÿç‡é™åˆ¶ å¯é€šè¿‡ RateLimitIntervalSec=/RateLimitBurst= è°ƒæ•´ã€‚ æ—¥å¿—é˜²ç¯¡æ”¹ é…ç½® Seal=yes åï¼Œç”¨ journalctl --setup-keys ç”Ÿæˆå¯†é’¥ï¼Œä¹‹åå¯ç”¨è¯¥å¯†é’¥éªŒè¯æ—¥å¿—å®Œæ•´æ€§ã€‚ 2.1.2 æ—¥å¿—çš„4ä¸ªæ”¶é›†å…¥å£journald ä»…é€šè¿‡æ ‡å‡†åŒ–å…¥å£æ”¶é›†æ—¥å¿—ï¼Œç¡®ä¿æ¥æºå¯è¿½æº¯ï¼š å†…æ ¸æ—¥å¿—ï¼šå†…æ ¸ printk() è¾“å‡º â†’ /dev/kmsg â†’ journaldï¼ˆä¼šè‡ªåŠ¨æ·»åŠ  _PID/_COMM ç­‰å­—æ®µï¼‰ï¼› systemd å•å…ƒ stdout/stderrï¼šå•å…ƒè¿›ç¨‹è¾“å‡ºè‡ªåŠ¨æ•è·ï¼Œä¼šé™„åŠ _SYSTEMD_UNIT=xxx.service ç­‰ systemd ç›¸å…³å­—æ®µï¼› æœ¬åœ° Socketï¼š/run/systemd/journal/socket ç­‰ï¼Œæ¥æ”¶ logger/systemd-cat åŠæ—§ syslog åº”ç”¨æ—¥å¿—ï¼› æ˜¾å¼ APIï¼šsd_journal_send()ï¼Œä»…éœ€è‡ªå®šä¹‰å¤æ‚ç»“æ„åŒ–æ—¥å¿—æ—¶ä½¿ç”¨ï¼ˆè­¬å¦‚ Docker daemonï¼‰, ä¸€èˆ¬ç›´æ¥ print å³å¯ã€‚ 2.1.3 æ—¥å¿—ä¼˜å…ˆçº§ä¸æ ¸å¿ƒé…ç½® 1. æ—¥å¿—ä¼˜å…ˆçº§ç®€è¿°æ—¥å¿—æŒ‰ä¸¥é‡ç¨‹åº¦åˆ† 8 çº§ï¼ˆæ•°å­—è¶Šå°ï¼Œçº§åˆ«è¶Šé«˜ï¼‰ï¼Œå¸¸ç”¨çº§åˆ«ï¼š errï¼šé”™è¯¯ï¼ˆéƒ¨åˆ†åŠŸèƒ½å¼‚å¸¸ï¼‰ï¼Œçº§åˆ« 3 warningï¼šè­¦å‘Šï¼ˆæ½œåœ¨é£é™©ï¼‰ï¼Œçº§åˆ« 4 infoï¼šä¿¡æ¯ï¼ˆå¸¸è§„è¿è¡Œæ—¥å¿—ï¼‰ï¼Œçº§åˆ« 6 debugï¼šè°ƒè¯•ï¼ˆå¼€å‘ç»†èŠ‚ï¼‰ï¼Œçº§åˆ« 7 å¯ç”¨äºç­›é€‰å…³é”®æ—¥å¿—ã€‚ 2. journald é…ç½®ä¸»é…ç½®æ–‡ä»¶ï¼š/etc/systemd/journald.confï¼Œæ”¯æŒé€šè¿‡ /etc/systemd/journald.conf.d/*.conf è¦†ç›–é…ç½®ï¼Œæ ¸å¿ƒé…ç½®é¡¹å¦‚ä¸‹ï¼š é…ç½®é¡¹ è¯´æ˜ ç¤ºä¾‹ Storage= å­˜å‚¨ç­–ç•¥ persistentï¼ˆå­˜ /var/log/journalï¼Œæ¨èï¼‰/volatileï¼ˆå­˜å†…å­˜ï¼‰ SystemMaxUse= æŒä¹…å­˜å‚¨æœ€å¤§å ç”¨ 1G MaxRetentionSec= æ—¥å¿—æœ€å¤§ä¿ç•™æ—¶é—´ 1month ForwardToSyslog= æ˜¯å¦è½¬å‘åˆ°æ—§æ—¥å¿—ç³»ç»Ÿ yesï¼ˆå…¼å®¹ä¼ ç»Ÿæ–‡æœ¬æ—¥å¿—ï¼‰ Seal= æ˜¯å¦å¯ç”¨æ—¥å¿—é˜²ç¯¡æ”¹ yes ç”Ÿäº§é…ç½®ç¤ºä¾‹ï¼š ini # /etc/systemd/journald.conf.d/00-production.conf [Journal] Storage=persistent SystemMaxUse=2G MaxRetentionSec=3month ForwardToSyslog=yes Seal=yes é…ç½®ç”Ÿæ•ˆéœ€é‡å¯æœåŠ¡ï¼šsudo systemctl restart systemd-journald 2.1.4 å®éªŒï¼šç”¨ logger éªŒè¯æ—¥å¿—æ”¶é›†ä¸‹é¢æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ logger å°†ç»“æ„åŒ–æ—¥å¿—ç›´æ¥å†™è¿› journalï¼Œå¹¶ç«‹å³ç”¨ journalctl æ£€ç´¢ã€‚ é¦–å…ˆå†™å…¥æ—¥å¿—ï¼š bash logger --journald \u003c","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:3:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#2-journald-é…ç½®"},{"categories":["tech"],"content":" 2.1 æ—¥å¿—ç³»ç»Ÿï¼šsystemd-journaldsystemd-journald æ˜¯ systemd å†…ç½®çš„æ—¥å¿—æ”¶é›†å®ˆæŠ¤è¿›ç¨‹ï¼Œç»Ÿä¸€å¤„ç†å†…æ ¸ã€ç³»ç»ŸæœåŠ¡åŠåº”ç”¨çš„æ—¥å¿—ï¼Œæ˜¯ç°ä»£ Linux ç³»ç»Ÿæ—¥å¿—ç®¡ç†çš„æ ¸å¿ƒç»„ä»¶ã€‚ 2.1.1 æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ è¯´æ˜ ç»Ÿä¸€æ”¶é›† å†…æ ¸æ—¥å¿—ã€systemd å•å…ƒï¼ˆstdout/stderrï¼‰ã€æ™®é€šè¿›ç¨‹ã€å®¹å™¨ã€ç¬¬ä¸‰æ–¹ syslog å‡æ±‡æ€»åˆ°åŒä¸€æ—¥å¿—æµã€‚ äºŒè¿›åˆ¶ç´¢å¼• ä»¥ B+æ ‘ï¼ˆæœ‰åºç´¢å¼•ï¼‰+åç§»é‡å»ºç«‹å­—æ®µç´¢å¼•ï¼Œæ”¯æŒç²¾ç¡®æŸ¥è¯¢ä¸æ—¶é—´/ä¼˜å…ˆçº§èŒƒå›´æŸ¥è¯¢ï¼Œé€Ÿåº¦è¿œè¶…æ–‡æœ¬ grepã€‚ å­—æ®µåŒ–å­˜å‚¨ è‡ªåŠ¨ç”Ÿæˆ _PIDã€_UIDã€_SYSTEMD_UNIT ç­‰å¯ä¿¡å­—æ®µï¼ˆä¸å¯ä¼ªé€ ï¼‰ï¼›æ”¯æŒè‡ªå®šä¹‰ FOO=bar å­—æ®µã€‚ è‡ªåŠ¨è½®è½¬ä¸å‹ç¼© æŒ‰ã€Œå¤§å°ã€æ—¶é—´ã€æ–‡ä»¶æ•°ã€å›æ”¶æ—¥å¿—ï¼›è½®è½¬åé»˜è®¤ç”¨ LZ4 å‹ç¼©ï¼ŒèŠ‚çœ 60% ä»¥ä¸Šç©ºé—´ã€‚ é€Ÿç‡é™åˆ¶ å¯é€šè¿‡ RateLimitIntervalSec=/RateLimitBurst= è°ƒæ•´ã€‚ æ—¥å¿—é˜²ç¯¡æ”¹ é…ç½® Seal=yes åï¼Œç”¨ journalctl --setup-keys ç”Ÿæˆå¯†é’¥ï¼Œä¹‹åå¯ç”¨è¯¥å¯†é’¥éªŒè¯æ—¥å¿—å®Œæ•´æ€§ã€‚ 2.1.2 æ—¥å¿—çš„4ä¸ªæ”¶é›†å…¥å£journald ä»…é€šè¿‡æ ‡å‡†åŒ–å…¥å£æ”¶é›†æ—¥å¿—ï¼Œç¡®ä¿æ¥æºå¯è¿½æº¯ï¼š å†…æ ¸æ—¥å¿—ï¼šå†…æ ¸ printk() è¾“å‡º â†’ /dev/kmsg â†’ journaldï¼ˆä¼šè‡ªåŠ¨æ·»åŠ  _PID/_COMM ç­‰å­—æ®µï¼‰ï¼› systemd å•å…ƒ stdout/stderrï¼šå•å…ƒè¿›ç¨‹è¾“å‡ºè‡ªåŠ¨æ•è·ï¼Œä¼šé™„åŠ _SYSTEMD_UNIT=xxx.service ç­‰ systemd ç›¸å…³å­—æ®µï¼› æœ¬åœ° Socketï¼š/run/systemd/journal/socket ç­‰ï¼Œæ¥æ”¶ logger/systemd-cat åŠæ—§ syslog åº”ç”¨æ—¥å¿—ï¼› æ˜¾å¼ APIï¼šsd_journal_send()ï¼Œä»…éœ€è‡ªå®šä¹‰å¤æ‚ç»“æ„åŒ–æ—¥å¿—æ—¶ä½¿ç”¨ï¼ˆè­¬å¦‚ Docker daemonï¼‰, ä¸€èˆ¬ç›´æ¥ print å³å¯ã€‚ 2.1.3 æ—¥å¿—ä¼˜å…ˆçº§ä¸æ ¸å¿ƒé…ç½® 1. æ—¥å¿—ä¼˜å…ˆçº§ç®€è¿°æ—¥å¿—æŒ‰ä¸¥é‡ç¨‹åº¦åˆ† 8 çº§ï¼ˆæ•°å­—è¶Šå°ï¼Œçº§åˆ«è¶Šé«˜ï¼‰ï¼Œå¸¸ç”¨çº§åˆ«ï¼š errï¼šé”™è¯¯ï¼ˆéƒ¨åˆ†åŠŸèƒ½å¼‚å¸¸ï¼‰ï¼Œçº§åˆ« 3 warningï¼šè­¦å‘Šï¼ˆæ½œåœ¨é£é™©ï¼‰ï¼Œçº§åˆ« 4 infoï¼šä¿¡æ¯ï¼ˆå¸¸è§„è¿è¡Œæ—¥å¿—ï¼‰ï¼Œçº§åˆ« 6 debugï¼šè°ƒè¯•ï¼ˆå¼€å‘ç»†èŠ‚ï¼‰ï¼Œçº§åˆ« 7 å¯ç”¨äºç­›é€‰å…³é”®æ—¥å¿—ã€‚ 2. journald é…ç½®ä¸»é…ç½®æ–‡ä»¶ï¼š/etc/systemd/journald.confï¼Œæ”¯æŒé€šè¿‡ /etc/systemd/journald.conf.d/*.conf è¦†ç›–é…ç½®ï¼Œæ ¸å¿ƒé…ç½®é¡¹å¦‚ä¸‹ï¼š é…ç½®é¡¹ è¯´æ˜ ç¤ºä¾‹ Storage= å­˜å‚¨ç­–ç•¥ persistentï¼ˆå­˜ /var/log/journalï¼Œæ¨èï¼‰/volatileï¼ˆå­˜å†…å­˜ï¼‰ SystemMaxUse= æŒä¹…å­˜å‚¨æœ€å¤§å ç”¨ 1G MaxRetentionSec= æ—¥å¿—æœ€å¤§ä¿ç•™æ—¶é—´ 1month ForwardToSyslog= æ˜¯å¦è½¬å‘åˆ°æ—§æ—¥å¿—ç³»ç»Ÿ yesï¼ˆå…¼å®¹ä¼ ç»Ÿæ–‡æœ¬æ—¥å¿—ï¼‰ Seal= æ˜¯å¦å¯ç”¨æ—¥å¿—é˜²ç¯¡æ”¹ yes ç”Ÿäº§é…ç½®ç¤ºä¾‹ï¼š ini # /etc/systemd/journald.conf.d/00-production.conf [Journal] Storage=persistent SystemMaxUse=2G MaxRetentionSec=3month ForwardToSyslog=yes Seal=yes é…ç½®ç”Ÿæ•ˆéœ€é‡å¯æœåŠ¡ï¼šsudo systemctl restart systemd-journald 2.1.4 å®éªŒï¼šç”¨ logger éªŒè¯æ—¥å¿—æ”¶é›†ä¸‹é¢æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ logger å°†ç»“æ„åŒ–æ—¥å¿—ç›´æ¥å†™è¿› journalï¼Œå¹¶ç«‹å³ç”¨ journalctl æ£€ç´¢ã€‚ é¦–å…ˆå†™å…¥æ—¥å¿—ï¼š bash logger --journald \u003c","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:3:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#214-å®éªŒç”¨-logger-éªŒè¯æ—¥å¿—æ”¶é›†"},{"categories":["tech"],"content":" 2.1 æ—¥å¿—ç³»ç»Ÿï¼šsystemd-journaldsystemd-journald æ˜¯ systemd å†…ç½®çš„æ—¥å¿—æ”¶é›†å®ˆæŠ¤è¿›ç¨‹ï¼Œç»Ÿä¸€å¤„ç†å†…æ ¸ã€ç³»ç»ŸæœåŠ¡åŠåº”ç”¨çš„æ—¥å¿—ï¼Œæ˜¯ç°ä»£ Linux ç³»ç»Ÿæ—¥å¿—ç®¡ç†çš„æ ¸å¿ƒç»„ä»¶ã€‚ 2.1.1 æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ è¯´æ˜ ç»Ÿä¸€æ”¶é›† å†…æ ¸æ—¥å¿—ã€systemd å•å…ƒï¼ˆstdout/stderrï¼‰ã€æ™®é€šè¿›ç¨‹ã€å®¹å™¨ã€ç¬¬ä¸‰æ–¹ syslog å‡æ±‡æ€»åˆ°åŒä¸€æ—¥å¿—æµã€‚ äºŒè¿›åˆ¶ç´¢å¼• ä»¥ B+æ ‘ï¼ˆæœ‰åºç´¢å¼•ï¼‰+åç§»é‡å»ºç«‹å­—æ®µç´¢å¼•ï¼Œæ”¯æŒç²¾ç¡®æŸ¥è¯¢ä¸æ—¶é—´/ä¼˜å…ˆçº§èŒƒå›´æŸ¥è¯¢ï¼Œé€Ÿåº¦è¿œè¶…æ–‡æœ¬ grepã€‚ å­—æ®µåŒ–å­˜å‚¨ è‡ªåŠ¨ç”Ÿæˆ _PIDã€_UIDã€_SYSTEMD_UNIT ç­‰å¯ä¿¡å­—æ®µï¼ˆä¸å¯ä¼ªé€ ï¼‰ï¼›æ”¯æŒè‡ªå®šä¹‰ FOO=bar å­—æ®µã€‚ è‡ªåŠ¨è½®è½¬ä¸å‹ç¼© æŒ‰ã€Œå¤§å°ã€æ—¶é—´ã€æ–‡ä»¶æ•°ã€å›æ”¶æ—¥å¿—ï¼›è½®è½¬åé»˜è®¤ç”¨ LZ4 å‹ç¼©ï¼ŒèŠ‚çœ 60% ä»¥ä¸Šç©ºé—´ã€‚ é€Ÿç‡é™åˆ¶ å¯é€šè¿‡ RateLimitIntervalSec=/RateLimitBurst= è°ƒæ•´ã€‚ æ—¥å¿—é˜²ç¯¡æ”¹ é…ç½® Seal=yes åï¼Œç”¨ journalctl --setup-keys ç”Ÿæˆå¯†é’¥ï¼Œä¹‹åå¯ç”¨è¯¥å¯†é’¥éªŒè¯æ—¥å¿—å®Œæ•´æ€§ã€‚ 2.1.2 æ—¥å¿—çš„4ä¸ªæ”¶é›†å…¥å£journald ä»…é€šè¿‡æ ‡å‡†åŒ–å…¥å£æ”¶é›†æ—¥å¿—ï¼Œç¡®ä¿æ¥æºå¯è¿½æº¯ï¼š å†…æ ¸æ—¥å¿—ï¼šå†…æ ¸ printk() è¾“å‡º â†’ /dev/kmsg â†’ journaldï¼ˆä¼šè‡ªåŠ¨æ·»åŠ  _PID/_COMM ç­‰å­—æ®µï¼‰ï¼› systemd å•å…ƒ stdout/stderrï¼šå•å…ƒè¿›ç¨‹è¾“å‡ºè‡ªåŠ¨æ•è·ï¼Œä¼šé™„åŠ _SYSTEMD_UNIT=xxx.service ç­‰ systemd ç›¸å…³å­—æ®µï¼› æœ¬åœ° Socketï¼š/run/systemd/journal/socket ç­‰ï¼Œæ¥æ”¶ logger/systemd-cat åŠæ—§ syslog åº”ç”¨æ—¥å¿—ï¼› æ˜¾å¼ APIï¼šsd_journal_send()ï¼Œä»…éœ€è‡ªå®šä¹‰å¤æ‚ç»“æ„åŒ–æ—¥å¿—æ—¶ä½¿ç”¨ï¼ˆè­¬å¦‚ Docker daemonï¼‰, ä¸€èˆ¬ç›´æ¥ print å³å¯ã€‚ 2.1.3 æ—¥å¿—ä¼˜å…ˆçº§ä¸æ ¸å¿ƒé…ç½® 1. æ—¥å¿—ä¼˜å…ˆçº§ç®€è¿°æ—¥å¿—æŒ‰ä¸¥é‡ç¨‹åº¦åˆ† 8 çº§ï¼ˆæ•°å­—è¶Šå°ï¼Œçº§åˆ«è¶Šé«˜ï¼‰ï¼Œå¸¸ç”¨çº§åˆ«ï¼š errï¼šé”™è¯¯ï¼ˆéƒ¨åˆ†åŠŸèƒ½å¼‚å¸¸ï¼‰ï¼Œçº§åˆ« 3 warningï¼šè­¦å‘Šï¼ˆæ½œåœ¨é£é™©ï¼‰ï¼Œçº§åˆ« 4 infoï¼šä¿¡æ¯ï¼ˆå¸¸è§„è¿è¡Œæ—¥å¿—ï¼‰ï¼Œçº§åˆ« 6 debugï¼šè°ƒè¯•ï¼ˆå¼€å‘ç»†èŠ‚ï¼‰ï¼Œçº§åˆ« 7 å¯ç”¨äºç­›é€‰å…³é”®æ—¥å¿—ã€‚ 2. journald é…ç½®ä¸»é…ç½®æ–‡ä»¶ï¼š/etc/systemd/journald.confï¼Œæ”¯æŒé€šè¿‡ /etc/systemd/journald.conf.d/*.conf è¦†ç›–é…ç½®ï¼Œæ ¸å¿ƒé…ç½®é¡¹å¦‚ä¸‹ï¼š é…ç½®é¡¹ è¯´æ˜ ç¤ºä¾‹ Storage= å­˜å‚¨ç­–ç•¥ persistentï¼ˆå­˜ /var/log/journalï¼Œæ¨èï¼‰/volatileï¼ˆå­˜å†…å­˜ï¼‰ SystemMaxUse= æŒä¹…å­˜å‚¨æœ€å¤§å ç”¨ 1G MaxRetentionSec= æ—¥å¿—æœ€å¤§ä¿ç•™æ—¶é—´ 1month ForwardToSyslog= æ˜¯å¦è½¬å‘åˆ°æ—§æ—¥å¿—ç³»ç»Ÿ yesï¼ˆå…¼å®¹ä¼ ç»Ÿæ–‡æœ¬æ—¥å¿—ï¼‰ Seal= æ˜¯å¦å¯ç”¨æ—¥å¿—é˜²ç¯¡æ”¹ yes ç”Ÿäº§é…ç½®ç¤ºä¾‹ï¼š ini # /etc/systemd/journald.conf.d/00-production.conf [Journal] Storage=persistent SystemMaxUse=2G MaxRetentionSec=3month ForwardToSyslog=yes Seal=yes é…ç½®ç”Ÿæ•ˆéœ€é‡å¯æœåŠ¡ï¼šsudo systemctl restart systemd-journald 2.1.4 å®éªŒï¼šç”¨ logger éªŒè¯æ—¥å¿—æ”¶é›†ä¸‹é¢æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ logger å°†ç»“æ„åŒ–æ—¥å¿—ç›´æ¥å†™è¿› journalï¼Œå¹¶ç«‹å³ç”¨ journalctl æ£€ç´¢ã€‚ é¦–å…ˆå†™å…¥æ—¥å¿—ï¼š bash logger --journald \u003c","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:3:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#215-æ—§æ—¥å¿—ç³»ç»Ÿä¸-varlog-è§£æ"},{"categories":["tech"],"content":" 2.1 æ—¥å¿—ç³»ç»Ÿï¼šsystemd-journaldsystemd-journald æ˜¯ systemd å†…ç½®çš„æ—¥å¿—æ”¶é›†å®ˆæŠ¤è¿›ç¨‹ï¼Œç»Ÿä¸€å¤„ç†å†…æ ¸ã€ç³»ç»ŸæœåŠ¡åŠåº”ç”¨çš„æ—¥å¿—ï¼Œæ˜¯ç°ä»£ Linux ç³»ç»Ÿæ—¥å¿—ç®¡ç†çš„æ ¸å¿ƒç»„ä»¶ã€‚ 2.1.1 æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ è¯´æ˜ ç»Ÿä¸€æ”¶é›† å†…æ ¸æ—¥å¿—ã€systemd å•å…ƒï¼ˆstdout/stderrï¼‰ã€æ™®é€šè¿›ç¨‹ã€å®¹å™¨ã€ç¬¬ä¸‰æ–¹ syslog å‡æ±‡æ€»åˆ°åŒä¸€æ—¥å¿—æµã€‚ äºŒè¿›åˆ¶ç´¢å¼• ä»¥ B+æ ‘ï¼ˆæœ‰åºç´¢å¼•ï¼‰+åç§»é‡å»ºç«‹å­—æ®µç´¢å¼•ï¼Œæ”¯æŒç²¾ç¡®æŸ¥è¯¢ä¸æ—¶é—´/ä¼˜å…ˆçº§èŒƒå›´æŸ¥è¯¢ï¼Œé€Ÿåº¦è¿œè¶…æ–‡æœ¬ grepã€‚ å­—æ®µåŒ–å­˜å‚¨ è‡ªåŠ¨ç”Ÿæˆ _PIDã€_UIDã€_SYSTEMD_UNIT ç­‰å¯ä¿¡å­—æ®µï¼ˆä¸å¯ä¼ªé€ ï¼‰ï¼›æ”¯æŒè‡ªå®šä¹‰ FOO=bar å­—æ®µã€‚ è‡ªåŠ¨è½®è½¬ä¸å‹ç¼© æŒ‰ã€Œå¤§å°ã€æ—¶é—´ã€æ–‡ä»¶æ•°ã€å›æ”¶æ—¥å¿—ï¼›è½®è½¬åé»˜è®¤ç”¨ LZ4 å‹ç¼©ï¼ŒèŠ‚çœ 60% ä»¥ä¸Šç©ºé—´ã€‚ é€Ÿç‡é™åˆ¶ å¯é€šè¿‡ RateLimitIntervalSec=/RateLimitBurst= è°ƒæ•´ã€‚ æ—¥å¿—é˜²ç¯¡æ”¹ é…ç½® Seal=yes åï¼Œç”¨ journalctl --setup-keys ç”Ÿæˆå¯†é’¥ï¼Œä¹‹åå¯ç”¨è¯¥å¯†é’¥éªŒè¯æ—¥å¿—å®Œæ•´æ€§ã€‚ 2.1.2 æ—¥å¿—çš„4ä¸ªæ”¶é›†å…¥å£journald ä»…é€šè¿‡æ ‡å‡†åŒ–å…¥å£æ”¶é›†æ—¥å¿—ï¼Œç¡®ä¿æ¥æºå¯è¿½æº¯ï¼š å†…æ ¸æ—¥å¿—ï¼šå†…æ ¸ printk() è¾“å‡º â†’ /dev/kmsg â†’ journaldï¼ˆä¼šè‡ªåŠ¨æ·»åŠ  _PID/_COMM ç­‰å­—æ®µï¼‰ï¼› systemd å•å…ƒ stdout/stderrï¼šå•å…ƒè¿›ç¨‹è¾“å‡ºè‡ªåŠ¨æ•è·ï¼Œä¼šé™„åŠ _SYSTEMD_UNIT=xxx.service ç­‰ systemd ç›¸å…³å­—æ®µï¼› æœ¬åœ° Socketï¼š/run/systemd/journal/socket ç­‰ï¼Œæ¥æ”¶ logger/systemd-cat åŠæ—§ syslog åº”ç”¨æ—¥å¿—ï¼› æ˜¾å¼ APIï¼šsd_journal_send()ï¼Œä»…éœ€è‡ªå®šä¹‰å¤æ‚ç»“æ„åŒ–æ—¥å¿—æ—¶ä½¿ç”¨ï¼ˆè­¬å¦‚ Docker daemonï¼‰, ä¸€èˆ¬ç›´æ¥ print å³å¯ã€‚ 2.1.3 æ—¥å¿—ä¼˜å…ˆçº§ä¸æ ¸å¿ƒé…ç½® 1. æ—¥å¿—ä¼˜å…ˆçº§ç®€è¿°æ—¥å¿—æŒ‰ä¸¥é‡ç¨‹åº¦åˆ† 8 çº§ï¼ˆæ•°å­—è¶Šå°ï¼Œçº§åˆ«è¶Šé«˜ï¼‰ï¼Œå¸¸ç”¨çº§åˆ«ï¼š errï¼šé”™è¯¯ï¼ˆéƒ¨åˆ†åŠŸèƒ½å¼‚å¸¸ï¼‰ï¼Œçº§åˆ« 3 warningï¼šè­¦å‘Šï¼ˆæ½œåœ¨é£é™©ï¼‰ï¼Œçº§åˆ« 4 infoï¼šä¿¡æ¯ï¼ˆå¸¸è§„è¿è¡Œæ—¥å¿—ï¼‰ï¼Œçº§åˆ« 6 debugï¼šè°ƒè¯•ï¼ˆå¼€å‘ç»†èŠ‚ï¼‰ï¼Œçº§åˆ« 7 å¯ç”¨äºç­›é€‰å…³é”®æ—¥å¿—ã€‚ 2. journald é…ç½®ä¸»é…ç½®æ–‡ä»¶ï¼š/etc/systemd/journald.confï¼Œæ”¯æŒé€šè¿‡ /etc/systemd/journald.conf.d/*.conf è¦†ç›–é…ç½®ï¼Œæ ¸å¿ƒé…ç½®é¡¹å¦‚ä¸‹ï¼š é…ç½®é¡¹ è¯´æ˜ ç¤ºä¾‹ Storage= å­˜å‚¨ç­–ç•¥ persistentï¼ˆå­˜ /var/log/journalï¼Œæ¨èï¼‰/volatileï¼ˆå­˜å†…å­˜ï¼‰ SystemMaxUse= æŒä¹…å­˜å‚¨æœ€å¤§å ç”¨ 1G MaxRetentionSec= æ—¥å¿—æœ€å¤§ä¿ç•™æ—¶é—´ 1month ForwardToSyslog= æ˜¯å¦è½¬å‘åˆ°æ—§æ—¥å¿—ç³»ç»Ÿ yesï¼ˆå…¼å®¹ä¼ ç»Ÿæ–‡æœ¬æ—¥å¿—ï¼‰ Seal= æ˜¯å¦å¯ç”¨æ—¥å¿—é˜²ç¯¡æ”¹ yes ç”Ÿäº§é…ç½®ç¤ºä¾‹ï¼š ini # /etc/systemd/journald.conf.d/00-production.conf [Journal] Storage=persistent SystemMaxUse=2G MaxRetentionSec=3month ForwardToSyslog=yes Seal=yes é…ç½®ç”Ÿæ•ˆéœ€é‡å¯æœåŠ¡ï¼šsudo systemctl restart systemd-journald 2.1.4 å®éªŒï¼šç”¨ logger éªŒè¯æ—¥å¿—æ”¶é›†ä¸‹é¢æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ logger å°†ç»“æ„åŒ–æ—¥å¿—ç›´æ¥å†™è¿› journalï¼Œå¹¶ç«‹å³ç”¨ journalctl æ£€ç´¢ã€‚ é¦–å…ˆå†™å…¥æ—¥å¿—ï¼š bash logger --journald \u003c","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:3:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#æ—§æ—¥å¿—ç³»ç»ŸåŸºäº-syslog-çš„æ–‡æœ¬ç®¡ç†"},{"categories":["tech"],"content":" 2.1 æ—¥å¿—ç³»ç»Ÿï¼šsystemd-journaldsystemd-journald æ˜¯ systemd å†…ç½®çš„æ—¥å¿—æ”¶é›†å®ˆæŠ¤è¿›ç¨‹ï¼Œç»Ÿä¸€å¤„ç†å†…æ ¸ã€ç³»ç»ŸæœåŠ¡åŠåº”ç”¨çš„æ—¥å¿—ï¼Œæ˜¯ç°ä»£ Linux ç³»ç»Ÿæ—¥å¿—ç®¡ç†çš„æ ¸å¿ƒç»„ä»¶ã€‚ 2.1.1 æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ è¯´æ˜ ç»Ÿä¸€æ”¶é›† å†…æ ¸æ—¥å¿—ã€systemd å•å…ƒï¼ˆstdout/stderrï¼‰ã€æ™®é€šè¿›ç¨‹ã€å®¹å™¨ã€ç¬¬ä¸‰æ–¹ syslog å‡æ±‡æ€»åˆ°åŒä¸€æ—¥å¿—æµã€‚ äºŒè¿›åˆ¶ç´¢å¼• ä»¥ B+æ ‘ï¼ˆæœ‰åºç´¢å¼•ï¼‰+åç§»é‡å»ºç«‹å­—æ®µç´¢å¼•ï¼Œæ”¯æŒç²¾ç¡®æŸ¥è¯¢ä¸æ—¶é—´/ä¼˜å…ˆçº§èŒƒå›´æŸ¥è¯¢ï¼Œé€Ÿåº¦è¿œè¶…æ–‡æœ¬ grepã€‚ å­—æ®µåŒ–å­˜å‚¨ è‡ªåŠ¨ç”Ÿæˆ _PIDã€_UIDã€_SYSTEMD_UNIT ç­‰å¯ä¿¡å­—æ®µï¼ˆä¸å¯ä¼ªé€ ï¼‰ï¼›æ”¯æŒè‡ªå®šä¹‰ FOO=bar å­—æ®µã€‚ è‡ªåŠ¨è½®è½¬ä¸å‹ç¼© æŒ‰ã€Œå¤§å°ã€æ—¶é—´ã€æ–‡ä»¶æ•°ã€å›æ”¶æ—¥å¿—ï¼›è½®è½¬åé»˜è®¤ç”¨ LZ4 å‹ç¼©ï¼ŒèŠ‚çœ 60% ä»¥ä¸Šç©ºé—´ã€‚ é€Ÿç‡é™åˆ¶ å¯é€šè¿‡ RateLimitIntervalSec=/RateLimitBurst= è°ƒæ•´ã€‚ æ—¥å¿—é˜²ç¯¡æ”¹ é…ç½® Seal=yes åï¼Œç”¨ journalctl --setup-keys ç”Ÿæˆå¯†é’¥ï¼Œä¹‹åå¯ç”¨è¯¥å¯†é’¥éªŒè¯æ—¥å¿—å®Œæ•´æ€§ã€‚ 2.1.2 æ—¥å¿—çš„4ä¸ªæ”¶é›†å…¥å£journald ä»…é€šè¿‡æ ‡å‡†åŒ–å…¥å£æ”¶é›†æ—¥å¿—ï¼Œç¡®ä¿æ¥æºå¯è¿½æº¯ï¼š å†…æ ¸æ—¥å¿—ï¼šå†…æ ¸ printk() è¾“å‡º â†’ /dev/kmsg â†’ journaldï¼ˆä¼šè‡ªåŠ¨æ·»åŠ  _PID/_COMM ç­‰å­—æ®µï¼‰ï¼› systemd å•å…ƒ stdout/stderrï¼šå•å…ƒè¿›ç¨‹è¾“å‡ºè‡ªåŠ¨æ•è·ï¼Œä¼šé™„åŠ _SYSTEMD_UNIT=xxx.service ç­‰ systemd ç›¸å…³å­—æ®µï¼› æœ¬åœ° Socketï¼š/run/systemd/journal/socket ç­‰ï¼Œæ¥æ”¶ logger/systemd-cat åŠæ—§ syslog åº”ç”¨æ—¥å¿—ï¼› æ˜¾å¼ APIï¼šsd_journal_send()ï¼Œä»…éœ€è‡ªå®šä¹‰å¤æ‚ç»“æ„åŒ–æ—¥å¿—æ—¶ä½¿ç”¨ï¼ˆè­¬å¦‚ Docker daemonï¼‰, ä¸€èˆ¬ç›´æ¥ print å³å¯ã€‚ 2.1.3 æ—¥å¿—ä¼˜å…ˆçº§ä¸æ ¸å¿ƒé…ç½® 1. æ—¥å¿—ä¼˜å…ˆçº§ç®€è¿°æ—¥å¿—æŒ‰ä¸¥é‡ç¨‹åº¦åˆ† 8 çº§ï¼ˆæ•°å­—è¶Šå°ï¼Œçº§åˆ«è¶Šé«˜ï¼‰ï¼Œå¸¸ç”¨çº§åˆ«ï¼š errï¼šé”™è¯¯ï¼ˆéƒ¨åˆ†åŠŸèƒ½å¼‚å¸¸ï¼‰ï¼Œçº§åˆ« 3 warningï¼šè­¦å‘Šï¼ˆæ½œåœ¨é£é™©ï¼‰ï¼Œçº§åˆ« 4 infoï¼šä¿¡æ¯ï¼ˆå¸¸è§„è¿è¡Œæ—¥å¿—ï¼‰ï¼Œçº§åˆ« 6 debugï¼šè°ƒè¯•ï¼ˆå¼€å‘ç»†èŠ‚ï¼‰ï¼Œçº§åˆ« 7 å¯ç”¨äºç­›é€‰å…³é”®æ—¥å¿—ã€‚ 2. journald é…ç½®ä¸»é…ç½®æ–‡ä»¶ï¼š/etc/systemd/journald.confï¼Œæ”¯æŒé€šè¿‡ /etc/systemd/journald.conf.d/*.conf è¦†ç›–é…ç½®ï¼Œæ ¸å¿ƒé…ç½®é¡¹å¦‚ä¸‹ï¼š é…ç½®é¡¹ è¯´æ˜ ç¤ºä¾‹ Storage= å­˜å‚¨ç­–ç•¥ persistentï¼ˆå­˜ /var/log/journalï¼Œæ¨èï¼‰/volatileï¼ˆå­˜å†…å­˜ï¼‰ SystemMaxUse= æŒä¹…å­˜å‚¨æœ€å¤§å ç”¨ 1G MaxRetentionSec= æ—¥å¿—æœ€å¤§ä¿ç•™æ—¶é—´ 1month ForwardToSyslog= æ˜¯å¦è½¬å‘åˆ°æ—§æ—¥å¿—ç³»ç»Ÿ yesï¼ˆå…¼å®¹ä¼ ç»Ÿæ–‡æœ¬æ—¥å¿—ï¼‰ Seal= æ˜¯å¦å¯ç”¨æ—¥å¿—é˜²ç¯¡æ”¹ yes ç”Ÿäº§é…ç½®ç¤ºä¾‹ï¼š ini # /etc/systemd/journald.conf.d/00-production.conf [Journal] Storage=persistent SystemMaxUse=2G MaxRetentionSec=3month ForwardToSyslog=yes Seal=yes é…ç½®ç”Ÿæ•ˆéœ€é‡å¯æœåŠ¡ï¼šsudo systemctl restart systemd-journald 2.1.4 å®éªŒï¼šç”¨ logger éªŒè¯æ—¥å¿—æ”¶é›†ä¸‹é¢æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ logger å°†ç»“æ„åŒ–æ—¥å¿—ç›´æ¥å†™è¿› journalï¼Œå¹¶ç«‹å³ç”¨ journalctl æ£€ç´¢ã€‚ é¦–å…ˆå†™å…¥æ—¥å¿—ï¼š bash logger --journald \u003c","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:3:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#varlog-å¸¸è§æ–‡ä»¶åŠåŠŸèƒ½"},{"categories":["tech"],"content":" 2.1 æ—¥å¿—ç³»ç»Ÿï¼šsystemd-journaldsystemd-journald æ˜¯ systemd å†…ç½®çš„æ—¥å¿—æ”¶é›†å®ˆæŠ¤è¿›ç¨‹ï¼Œç»Ÿä¸€å¤„ç†å†…æ ¸ã€ç³»ç»ŸæœåŠ¡åŠåº”ç”¨çš„æ—¥å¿—ï¼Œæ˜¯ç°ä»£ Linux ç³»ç»Ÿæ—¥å¿—ç®¡ç†çš„æ ¸å¿ƒç»„ä»¶ã€‚ 2.1.1 æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ è¯´æ˜ ç»Ÿä¸€æ”¶é›† å†…æ ¸æ—¥å¿—ã€systemd å•å…ƒï¼ˆstdout/stderrï¼‰ã€æ™®é€šè¿›ç¨‹ã€å®¹å™¨ã€ç¬¬ä¸‰æ–¹ syslog å‡æ±‡æ€»åˆ°åŒä¸€æ—¥å¿—æµã€‚ äºŒè¿›åˆ¶ç´¢å¼• ä»¥ B+æ ‘ï¼ˆæœ‰åºç´¢å¼•ï¼‰+åç§»é‡å»ºç«‹å­—æ®µç´¢å¼•ï¼Œæ”¯æŒç²¾ç¡®æŸ¥è¯¢ä¸æ—¶é—´/ä¼˜å…ˆçº§èŒƒå›´æŸ¥è¯¢ï¼Œé€Ÿåº¦è¿œè¶…æ–‡æœ¬ grepã€‚ å­—æ®µåŒ–å­˜å‚¨ è‡ªåŠ¨ç”Ÿæˆ _PIDã€_UIDã€_SYSTEMD_UNIT ç­‰å¯ä¿¡å­—æ®µï¼ˆä¸å¯ä¼ªé€ ï¼‰ï¼›æ”¯æŒè‡ªå®šä¹‰ FOO=bar å­—æ®µã€‚ è‡ªåŠ¨è½®è½¬ä¸å‹ç¼© æŒ‰ã€Œå¤§å°ã€æ—¶é—´ã€æ–‡ä»¶æ•°ã€å›æ”¶æ—¥å¿—ï¼›è½®è½¬åé»˜è®¤ç”¨ LZ4 å‹ç¼©ï¼ŒèŠ‚çœ 60% ä»¥ä¸Šç©ºé—´ã€‚ é€Ÿç‡é™åˆ¶ å¯é€šè¿‡ RateLimitIntervalSec=/RateLimitBurst= è°ƒæ•´ã€‚ æ—¥å¿—é˜²ç¯¡æ”¹ é…ç½® Seal=yes åï¼Œç”¨ journalctl --setup-keys ç”Ÿæˆå¯†é’¥ï¼Œä¹‹åå¯ç”¨è¯¥å¯†é’¥éªŒè¯æ—¥å¿—å®Œæ•´æ€§ã€‚ 2.1.2 æ—¥å¿—çš„4ä¸ªæ”¶é›†å…¥å£journald ä»…é€šè¿‡æ ‡å‡†åŒ–å…¥å£æ”¶é›†æ—¥å¿—ï¼Œç¡®ä¿æ¥æºå¯è¿½æº¯ï¼š å†…æ ¸æ—¥å¿—ï¼šå†…æ ¸ printk() è¾“å‡º â†’ /dev/kmsg â†’ journaldï¼ˆä¼šè‡ªåŠ¨æ·»åŠ  _PID/_COMM ç­‰å­—æ®µï¼‰ï¼› systemd å•å…ƒ stdout/stderrï¼šå•å…ƒè¿›ç¨‹è¾“å‡ºè‡ªåŠ¨æ•è·ï¼Œä¼šé™„åŠ _SYSTEMD_UNIT=xxx.service ç­‰ systemd ç›¸å…³å­—æ®µï¼› æœ¬åœ° Socketï¼š/run/systemd/journal/socket ç­‰ï¼Œæ¥æ”¶ logger/systemd-cat åŠæ—§ syslog åº”ç”¨æ—¥å¿—ï¼› æ˜¾å¼ APIï¼šsd_journal_send()ï¼Œä»…éœ€è‡ªå®šä¹‰å¤æ‚ç»“æ„åŒ–æ—¥å¿—æ—¶ä½¿ç”¨ï¼ˆè­¬å¦‚ Docker daemonï¼‰, ä¸€èˆ¬ç›´æ¥ print å³å¯ã€‚ 2.1.3 æ—¥å¿—ä¼˜å…ˆçº§ä¸æ ¸å¿ƒé…ç½® 1. æ—¥å¿—ä¼˜å…ˆçº§ç®€è¿°æ—¥å¿—æŒ‰ä¸¥é‡ç¨‹åº¦åˆ† 8 çº§ï¼ˆæ•°å­—è¶Šå°ï¼Œçº§åˆ«è¶Šé«˜ï¼‰ï¼Œå¸¸ç”¨çº§åˆ«ï¼š errï¼šé”™è¯¯ï¼ˆéƒ¨åˆ†åŠŸèƒ½å¼‚å¸¸ï¼‰ï¼Œçº§åˆ« 3 warningï¼šè­¦å‘Šï¼ˆæ½œåœ¨é£é™©ï¼‰ï¼Œçº§åˆ« 4 infoï¼šä¿¡æ¯ï¼ˆå¸¸è§„è¿è¡Œæ—¥å¿—ï¼‰ï¼Œçº§åˆ« 6 debugï¼šè°ƒè¯•ï¼ˆå¼€å‘ç»†èŠ‚ï¼‰ï¼Œçº§åˆ« 7 å¯ç”¨äºç­›é€‰å…³é”®æ—¥å¿—ã€‚ 2. journald é…ç½®ä¸»é…ç½®æ–‡ä»¶ï¼š/etc/systemd/journald.confï¼Œæ”¯æŒé€šè¿‡ /etc/systemd/journald.conf.d/*.conf è¦†ç›–é…ç½®ï¼Œæ ¸å¿ƒé…ç½®é¡¹å¦‚ä¸‹ï¼š é…ç½®é¡¹ è¯´æ˜ ç¤ºä¾‹ Storage= å­˜å‚¨ç­–ç•¥ persistentï¼ˆå­˜ /var/log/journalï¼Œæ¨èï¼‰/volatileï¼ˆå­˜å†…å­˜ï¼‰ SystemMaxUse= æŒä¹…å­˜å‚¨æœ€å¤§å ç”¨ 1G MaxRetentionSec= æ—¥å¿—æœ€å¤§ä¿ç•™æ—¶é—´ 1month ForwardToSyslog= æ˜¯å¦è½¬å‘åˆ°æ—§æ—¥å¿—ç³»ç»Ÿ yesï¼ˆå…¼å®¹ä¼ ç»Ÿæ–‡æœ¬æ—¥å¿—ï¼‰ Seal= æ˜¯å¦å¯ç”¨æ—¥å¿—é˜²ç¯¡æ”¹ yes ç”Ÿäº§é…ç½®ç¤ºä¾‹ï¼š ini # /etc/systemd/journald.conf.d/00-production.conf [Journal] Storage=persistent SystemMaxUse=2G MaxRetentionSec=3month ForwardToSyslog=yes Seal=yes é…ç½®ç”Ÿæ•ˆéœ€é‡å¯æœåŠ¡ï¼šsudo systemctl restart systemd-journald 2.1.4 å®éªŒï¼šç”¨ logger éªŒè¯æ—¥å¿—æ”¶é›†ä¸‹é¢æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ logger å°†ç»“æ„åŒ–æ—¥å¿—ç›´æ¥å†™è¿› journalï¼Œå¹¶ç«‹å³ç”¨ journalctl æ£€ç´¢ã€‚ é¦–å…ˆå†™å…¥æ—¥å¿—ï¼š bash logger --journald \u003c","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:3:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#216-æ—¥å¿—å†™å…¥æœ€ä½³å®è·µ"},{"categories":["tech"],"content":" 2.1 æ—¥å¿—ç³»ç»Ÿï¼šsystemd-journaldsystemd-journald æ˜¯ systemd å†…ç½®çš„æ—¥å¿—æ”¶é›†å®ˆæŠ¤è¿›ç¨‹ï¼Œç»Ÿä¸€å¤„ç†å†…æ ¸ã€ç³»ç»ŸæœåŠ¡åŠåº”ç”¨çš„æ—¥å¿—ï¼Œæ˜¯ç°ä»£ Linux ç³»ç»Ÿæ—¥å¿—ç®¡ç†çš„æ ¸å¿ƒç»„ä»¶ã€‚ 2.1.1 æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ è¯´æ˜ ç»Ÿä¸€æ”¶é›† å†…æ ¸æ—¥å¿—ã€systemd å•å…ƒï¼ˆstdout/stderrï¼‰ã€æ™®é€šè¿›ç¨‹ã€å®¹å™¨ã€ç¬¬ä¸‰æ–¹ syslog å‡æ±‡æ€»åˆ°åŒä¸€æ—¥å¿—æµã€‚ äºŒè¿›åˆ¶ç´¢å¼• ä»¥ B+æ ‘ï¼ˆæœ‰åºç´¢å¼•ï¼‰+åç§»é‡å»ºç«‹å­—æ®µç´¢å¼•ï¼Œæ”¯æŒç²¾ç¡®æŸ¥è¯¢ä¸æ—¶é—´/ä¼˜å…ˆçº§èŒƒå›´æŸ¥è¯¢ï¼Œé€Ÿåº¦è¿œè¶…æ–‡æœ¬ grepã€‚ å­—æ®µåŒ–å­˜å‚¨ è‡ªåŠ¨ç”Ÿæˆ _PIDã€_UIDã€_SYSTEMD_UNIT ç­‰å¯ä¿¡å­—æ®µï¼ˆä¸å¯ä¼ªé€ ï¼‰ï¼›æ”¯æŒè‡ªå®šä¹‰ FOO=bar å­—æ®µã€‚ è‡ªåŠ¨è½®è½¬ä¸å‹ç¼© æŒ‰ã€Œå¤§å°ã€æ—¶é—´ã€æ–‡ä»¶æ•°ã€å›æ”¶æ—¥å¿—ï¼›è½®è½¬åé»˜è®¤ç”¨ LZ4 å‹ç¼©ï¼ŒèŠ‚çœ 60% ä»¥ä¸Šç©ºé—´ã€‚ é€Ÿç‡é™åˆ¶ å¯é€šè¿‡ RateLimitIntervalSec=/RateLimitBurst= è°ƒæ•´ã€‚ æ—¥å¿—é˜²ç¯¡æ”¹ é…ç½® Seal=yes åï¼Œç”¨ journalctl --setup-keys ç”Ÿæˆå¯†é’¥ï¼Œä¹‹åå¯ç”¨è¯¥å¯†é’¥éªŒè¯æ—¥å¿—å®Œæ•´æ€§ã€‚ 2.1.2 æ—¥å¿—çš„4ä¸ªæ”¶é›†å…¥å£journald ä»…é€šè¿‡æ ‡å‡†åŒ–å…¥å£æ”¶é›†æ—¥å¿—ï¼Œç¡®ä¿æ¥æºå¯è¿½æº¯ï¼š å†…æ ¸æ—¥å¿—ï¼šå†…æ ¸ printk() è¾“å‡º â†’ /dev/kmsg â†’ journaldï¼ˆä¼šè‡ªåŠ¨æ·»åŠ  _PID/_COMM ç­‰å­—æ®µï¼‰ï¼› systemd å•å…ƒ stdout/stderrï¼šå•å…ƒè¿›ç¨‹è¾“å‡ºè‡ªåŠ¨æ•è·ï¼Œä¼šé™„åŠ _SYSTEMD_UNIT=xxx.service ç­‰ systemd ç›¸å…³å­—æ®µï¼› æœ¬åœ° Socketï¼š/run/systemd/journal/socket ç­‰ï¼Œæ¥æ”¶ logger/systemd-cat åŠæ—§ syslog åº”ç”¨æ—¥å¿—ï¼› æ˜¾å¼ APIï¼šsd_journal_send()ï¼Œä»…éœ€è‡ªå®šä¹‰å¤æ‚ç»“æ„åŒ–æ—¥å¿—æ—¶ä½¿ç”¨ï¼ˆè­¬å¦‚ Docker daemonï¼‰, ä¸€èˆ¬ç›´æ¥ print å³å¯ã€‚ 2.1.3 æ—¥å¿—ä¼˜å…ˆçº§ä¸æ ¸å¿ƒé…ç½® 1. æ—¥å¿—ä¼˜å…ˆçº§ç®€è¿°æ—¥å¿—æŒ‰ä¸¥é‡ç¨‹åº¦åˆ† 8 çº§ï¼ˆæ•°å­—è¶Šå°ï¼Œçº§åˆ«è¶Šé«˜ï¼‰ï¼Œå¸¸ç”¨çº§åˆ«ï¼š errï¼šé”™è¯¯ï¼ˆéƒ¨åˆ†åŠŸèƒ½å¼‚å¸¸ï¼‰ï¼Œçº§åˆ« 3 warningï¼šè­¦å‘Šï¼ˆæ½œåœ¨é£é™©ï¼‰ï¼Œçº§åˆ« 4 infoï¼šä¿¡æ¯ï¼ˆå¸¸è§„è¿è¡Œæ—¥å¿—ï¼‰ï¼Œçº§åˆ« 6 debugï¼šè°ƒè¯•ï¼ˆå¼€å‘ç»†èŠ‚ï¼‰ï¼Œçº§åˆ« 7 å¯ç”¨äºç­›é€‰å…³é”®æ—¥å¿—ã€‚ 2. journald é…ç½®ä¸»é…ç½®æ–‡ä»¶ï¼š/etc/systemd/journald.confï¼Œæ”¯æŒé€šè¿‡ /etc/systemd/journald.conf.d/*.conf è¦†ç›–é…ç½®ï¼Œæ ¸å¿ƒé…ç½®é¡¹å¦‚ä¸‹ï¼š é…ç½®é¡¹ è¯´æ˜ ç¤ºä¾‹ Storage= å­˜å‚¨ç­–ç•¥ persistentï¼ˆå­˜ /var/log/journalï¼Œæ¨èï¼‰/volatileï¼ˆå­˜å†…å­˜ï¼‰ SystemMaxUse= æŒä¹…å­˜å‚¨æœ€å¤§å ç”¨ 1G MaxRetentionSec= æ—¥å¿—æœ€å¤§ä¿ç•™æ—¶é—´ 1month ForwardToSyslog= æ˜¯å¦è½¬å‘åˆ°æ—§æ—¥å¿—ç³»ç»Ÿ yesï¼ˆå…¼å®¹ä¼ ç»Ÿæ–‡æœ¬æ—¥å¿—ï¼‰ Seal= æ˜¯å¦å¯ç”¨æ—¥å¿—é˜²ç¯¡æ”¹ yes ç”Ÿäº§é…ç½®ç¤ºä¾‹ï¼š ini # /etc/systemd/journald.conf.d/00-production.conf [Journal] Storage=persistent SystemMaxUse=2G MaxRetentionSec=3month ForwardToSyslog=yes Seal=yes é…ç½®ç”Ÿæ•ˆéœ€é‡å¯æœåŠ¡ï¼šsudo systemctl restart systemd-journald 2.1.4 å®éªŒï¼šç”¨ logger éªŒè¯æ—¥å¿—æ”¶é›†ä¸‹é¢æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ logger å°†ç»“æ„åŒ–æ—¥å¿—ç›´æ¥å†™è¿› journalï¼Œå¹¶ç«‹å³ç”¨ journalctl æ£€ç´¢ã€‚ é¦–å…ˆå†™å…¥æ—¥å¿—ï¼š bash logger --journald \u003c","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:3:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#217-è¿ç»´å‘½ä»¤é€ŸæŸ¥"},{"categories":["tech"],"content":" 2.2 å†…å­˜ç®¡ç†ï¼šsystemd-oomdsystemd-oomd æ˜¯ systemd æä¾›çš„å†…å­˜ä¸è¶³ï¼ˆOOMï¼‰å®ˆæŠ¤è¿›ç¨‹ï¼Œç”¨äºåœ¨ç³»ç»Ÿå†…å­˜ç´§å¼ æ—¶ä¸»åŠ¨ç»ˆæ­¢è¿›ç¨‹ï¼Œ é˜²æ­¢ç³»ç»Ÿå®Œå…¨å¡æ­»ã€‚å¬èµ·æ¥æœ‰ç‚¹\"æ®‹å¿\"ï¼Œä¸è¿‡æ€»æ¯”ç³»ç»Ÿå½»åº•æ­»æœºè¦å¥½ã€‚ å·¥ä½œåŸç†ï¼š å†…å­˜ç›‘æ§ï¼šå®æ—¶ç›‘æ§ç³»ç»Ÿå†…å­˜ä½¿ç”¨æƒ…å†µå’Œå†…å­˜å‹åŠ› æ™ºèƒ½é€‰æ‹©ï¼šåŸºäº cgroup å±‚æ¬¡ç»“æ„å’Œå†…å­˜ä½¿ç”¨é‡é€‰æ‹©è¦ç»ˆæ­¢çš„è¿›ç¨‹ ç”¨æˆ·ç©ºé—´ä¿æŠ¤ï¼šä¼˜å…ˆç»ˆæ­¢ç”¨æˆ·ç©ºé—´è¿›ç¨‹ï¼Œä¿æŠ¤ç³»ç»Ÿå…³é”®æœåŠ¡ æ¸è¿›å¼å¤„ç†ï¼šé€æ­¥é‡Šæ”¾å†…å­˜ï¼Œé¿å…è¿‡åº¦ kill è¿›ç¨‹ é…ç½®ç¤ºä¾‹ï¼š nix # NixOS é…ç½® systemd.oomd.enable = true; systemd.oomd.extraConfig = '' [OOM] DefaultMemoryPressureLimitSec=20s DefaultMemoryPressureLimit=60% ''; é…ç½®æ–‡ä»¶è·¯å¾„ï¼š/etc/systemd/oomd.conf ç›‘æ§ä¸è°ƒè¯•ï¼š bash # æŸ¥çœ‹ oomd çŠ¶æ€ systemctl status systemd-oomd # å†…å­˜å‹åŠ›ä¿¡æ¯ cat /proc/pressure/memory # æŸ¥çœ‹ oomd æ—¥å¿— journalctl -u systemd-oomd -f # å†…å­˜ä½¿ç”¨ç»Ÿè®¡ systemctl status user@$(id -u).service ","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:3:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#22-å†…å­˜ç®¡ç†systemd-oomd"},{"categories":["tech"],"content":" 2.3 DNS è§£æï¼šsystemd-resolvedsystemd-resolved æä¾›ç»Ÿä¸€çš„ DNS è§£ææœåŠ¡ï¼Œæ”¯æŒ DNSSEC éªŒè¯ã€DNS over TLS ç­‰ç°ä»£ DNS ç‰¹æ€§ã€‚åå­—æ˜¯é•¿äº†ç‚¹ï¼Œä¸è¿‡åŠŸèƒ½å€’æ˜¯æŒºå…¨é¢çš„ï¼ŒåŸºæœ¬ä¸ŠæŠŠ DNS è§£æè¿™ä»¶äº‹åŒ…åœ†äº†ã€‚ ä¸»è¦åŠŸèƒ½ï¼š ç»Ÿä¸€æ¥å£ï¼šä¸ºç³»ç»Ÿæä¾›å•ä¸€çš„ DNS è§£æå…¥å£ æœ¬åœ°ç¼“å­˜ï¼šç¼“å­˜ DNS æŸ¥è¯¢ç»“æœï¼Œæé«˜è§£æé€Ÿåº¦ DNSSEC æ”¯æŒï¼šéªŒè¯ DNS å“åº”çš„çœŸå®æ€§ éšç§ä¿æŠ¤ï¼šæ”¯æŒ DNS over TLS(DoT), ä½†æˆªæ­¢ç›®å‰ï¼ˆ2025 å¹´ï¼‰å°šæœªæ”¯æŒ DNS over HTTPS(DoH). é…ç½®æ–¹æ³•ï¼š nix # å¯ç”¨ systemd-resolved services.resolved.enable = true; # é…ç½® DNS æœåŠ¡å™¨ networking.nameservers = [ \"8.8.8.8\" \"1.1.1.1\" # IPv4 \"2001:4860:4860::8888\" \"2606:4700:4700::1111\" # IPv6 ]; # é«˜çº§é…ç½® services.resolved.extraConfig = '' [Resolve] DNSSEC=yes DNSOverTLS=yes Cache=yes ''; é…ç½®æ–‡ä»¶è·¯å¾„ï¼š/etc/systemd/resolved.conf ä½¿ç”¨å‘½ä»¤ï¼š bash # DNS çŠ¶æ€æŸ¥çœ‹ resolvectl status # DNS æŸ¥è¯¢æµ‹è¯• resolvectl query example.com resolvectl query -t AAAA ipv6.google.com # ç¼“å­˜ç®¡ç† resolvectl flush-caches resolvectl statistics # DNS æœåŠ¡å™¨çŠ¶æ€ resolvectl dns ","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:3:3","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#23-dns-è§£æsystemd-resolved"},{"categories":["tech"],"content":" 2.4 æ—¶é—´åŒæ­¥ï¼šsystemd-timesyncdsystemd-timesyncd æ˜¯è½»é‡çº§ NTP å®¢æˆ·ç«¯ï¼Œè´Ÿè´£ä¿æŒç³»ç»Ÿæ—¶é—´ä¸ç½‘ç»œæ—¶é—´æœåŠ¡å™¨åŒæ­¥ã€‚åŠŸèƒ½ç®€å•ç›´æ¥ï¼Œå°±æ˜¯ç¡®ä¿ä½ çš„ç³»ç»Ÿæ—¶é—´ä¸ä¼šè·‘åï¼Œé¿å…å‡ºç°\"æ—¶é—´ç©¿è¶Š\"çš„å°´å°¬æƒ…å†µã€‚ åŠŸèƒ½ç‰¹ç‚¹ï¼š è½»é‡çº§è®¾è®¡ï¼šç›¸æ¯”å®Œæ•´ NTP æœåŠ¡å ç”¨æ›´å°‘èµ„æº è‡ªåŠ¨åŒæ­¥ï¼šå®šæœŸä¸æ—¶é—´æœåŠ¡å™¨åŒæ­¥ SNTP åè®®ï¼šä½¿ç”¨ç®€å•ç½‘ç»œæ—¶é—´åè®® systemd é›†æˆï¼šä¸ systemd æœåŠ¡ç®¡ç†æ·±åº¦é›†æˆ NixOS é…ç½®ï¼š nix # å¯ç”¨æ—¶é—´åŒæ­¥ services.timesyncd.enable = true; # é…ç½® NTP æœåŠ¡å™¨ services.timesyncd.servers = [ \"pool.ntp.org\" \"time.google.com\" \"ntp.aliyun.com\" ]; é…ç½®æ–‡ä»¶è·¯å¾„ï¼š/etc/systemd/timesyncd.conf æ—¶é—´åŒæ­¥ç®¡ç†ï¼š bash # æ—¶é—´çŠ¶æ€æŸ¥çœ‹ timedatectl status timedatectl timesync-status # æ‰‹åŠ¨æ§åˆ¶ timedatectl set-ntp true # å¯ç”¨ NTP timedatectl set-timezone Asia/Shanghai # æŸ¥çœ‹åŒæ­¥æ—¥å¿— journalctl -u systemd-timesyncd -f # æ—¶é—´ç²¾åº¦æ£€æŸ¥ chronyc tracking # å¦‚æœå®‰è£…äº† chrony ","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:3:4","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#24-æ—¶é—´åŒæ­¥systemd-timesyncd"},{"categories":["tech"],"content":" 3. è®¾å¤‡ç®¡ç†ï¼šudev ä¸ systemd-udevdudev æ˜¯ Linux ç”¨æˆ·ç©ºé—´çš„è®¾å¤‡ç®¡ç†å‘˜ï¼Œè´Ÿè´£å¤„ç†å†…æ ¸çš„è®¾å¤‡äº‹ä»¶ï¼Œåˆ›å»ºèŠ‚ç‚¹å¹¶è®¾ç½®æƒé™ã€‚åœ¨ç°ä»£ systemd ç³»ç»Ÿä¸­ï¼Œudev åŠŸèƒ½ç”± systemd-udevd å®ˆæŠ¤è¿›ç¨‹å®ç°ï¼Œå®ƒæ˜¯ systemd ç”Ÿæ€ç³»ç»Ÿçš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:4:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#3-è®¾å¤‡ç®¡ç†udev-ä¸-systemd-udevd"},{"categories":["tech"],"content":" 3.1 udev ä¸ systemd-udevd 3.1.1 udev è®¾å¤‡ç®¡ç†æ¡†æ¶udev æ˜¯ Linux å†…æ ¸çš„ç”¨æˆ·ç©ºé—´è®¾å¤‡ç®¡ç†æ¡†æ¶ï¼Œè´Ÿè´£å¤„ç†å†…æ ¸çš„è®¾å¤‡äº‹ä»¶å¹¶ç®¡ç† /dev ç›®å½•ä¸‹çš„è®¾å¤‡èŠ‚ç‚¹ã€‚ udev çš„æ ¸å¿ƒåŠŸèƒ½ï¼š åŠ¨æ€è®¾å¤‡ç®¡ç†ï¼šå½“ç¡¬ä»¶è®¾å¤‡æ’å…¥æˆ–ç§»é™¤æ—¶ï¼Œè‡ªåŠ¨åˆ›å»ºè®¾å¤‡èŠ‚ç‚¹ è®¾å¤‡å‘½åï¼šæä¾›ä¸€è‡´çš„è®¾å¤‡å‘½åè§„åˆ™ï¼Œå¦‚ /dev/disk/by-uuid/ã€/dev/input/by-id/ æƒé™æ§åˆ¶ï¼šæ ¹æ®è®¾å¤‡ç±»å‹å’Œç”¨æˆ·éœ€æ±‚è®¾ç½®é€‚å½“çš„è®¾å¤‡æƒé™ è§„åˆ™ç³»ç»Ÿï¼šé€šè¿‡è§„åˆ™æ–‡ä»¶å®ç°å¤æ‚çš„è®¾å¤‡å¤„ç†é€»è¾‘ udev çš„å·¥ä½œåŸç†ï¼š å†…æ ¸æ£€æµ‹åˆ°ç¡¬ä»¶å˜åŒ–ï¼Œé€šè¿‡ netlink socket å‘é€ uevent åˆ°ç”¨æˆ·ç©ºé—´ udev å®ˆæŠ¤è¿›ç¨‹æ¥æ”¶ ueventï¼Œè§£æè®¾å¤‡å±æ€§ æ ¹æ®è§„åˆ™æ–‡ä»¶åŒ¹é…è®¾å¤‡ï¼Œæ‰§è¡Œç›¸åº”çš„åŠ¨ä½œï¼ˆåˆ›å»ºè®¾å¤‡èŠ‚ç‚¹ã€è®¾ç½®æƒé™ç­‰ï¼‰ 3.1.2 systemd-udevd å®ç°åœ¨ç°ä»£ systemd ç³»ç»Ÿä¸­ï¼Œudev ç”¨æˆ·ç©ºé—´çš„åŠŸèƒ½ç”± systemd-udevd å®ˆæŠ¤è¿›ç¨‹å®ç°ï¼Œå®ƒæ˜¯ systemd ç”Ÿæ€ç³»ç»Ÿçš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚ systemd-udevd çš„ä¼˜åŠ¿ï¼š systemd é›†æˆï¼šä½œä¸º systemd æœåŠ¡è¿è¡Œï¼Œäº«å— systemd çš„æœåŠ¡ç®¡ç†ã€æ—¥å¿—è®°å½•ã€ä¾èµ–ç®¡ç†ç­‰åŠŸèƒ½ æ€§èƒ½ä¼˜åŒ–ï¼šç›¸æ¯”ä¼ ç»Ÿçš„ udevdï¼Œsystemd-udevd åœ¨å¯åŠ¨é€Ÿåº¦å’Œèµ„æºä½¿ç”¨ä¸Šæœ‰æ‰€ä¼˜åŒ– ç»Ÿä¸€ç®¡ç†ï¼šä¸ systemd çš„å…¶ä»–ç»„ä»¶ï¼ˆå¦‚ systemd-logindï¼‰æ·±åº¦é›†æˆï¼Œæä¾›ç»Ÿä¸€çš„è®¾å¤‡æƒé™ç®¡ç† systemd-udevd æœåŠ¡ç®¡ç†ï¼š bash # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ systemctl status systemd-udevd # é‡å¯æœåŠ¡ sudo systemctl restart systemd-udevd # æŸ¥çœ‹æœåŠ¡æ—¥å¿— journalctl -u systemd-udevd -f 3.1.3 å·¥ä½œæµç¨‹å®Œæ•´çš„è®¾å¤‡ç®¡ç†æµç¨‹å¦‚ä¸‹ï¼š ç¡¬ä»¶æ£€æµ‹ï¼šå†…æ ¸æ£€æµ‹åˆ°ç¡¬ä»¶å˜åŒ–ï¼ˆæ’å…¥ã€ç§»é™¤ã€çŠ¶æ€æ”¹å˜ï¼‰ äº‹ä»¶å‘é€ï¼šå†…æ ¸é€šè¿‡ netlink socket å‘é€ uevent åˆ°ç”¨æˆ·ç©ºé—´ äº‹ä»¶æ¥æ”¶ï¼šsystemd-udevd æ¥æ”¶ ueventï¼Œè§£æè®¾å¤‡å±æ€§ è§„åˆ™åŒ¹é…ï¼šæ ¹æ®è§„åˆ™æ–‡ä»¶ï¼ˆ/run/current-system/sw/lib/udev/rules.d/ï¼ˆNixOSï¼‰æˆ–/usr/lib/udev/rules.d/ï¼ˆä¼ ç»Ÿå‘è¡Œç‰ˆï¼‰ã€/etc/udev/rules.d/ï¼‰åŒ¹é…è®¾å¤‡ åŠ¨ä½œæ‰§è¡Œï¼šæ‰§è¡ŒåŒ¹é…è§„åˆ™ä¸­å®šä¹‰çš„åŠ¨ä½œï¼ˆRUN è„šæœ¬ã€è®¾ç½® OWNER/GROUP/MODEã€åˆ›å»º symlinkã€è®¾ç½®æƒé™ï¼‰ systemd é›†æˆï¼šé€šçŸ¥ systemdï¼Œå¯èƒ½è§¦å‘ device units 3.1.4 é…ç½®ç¤ºä¾‹åŸºæœ¬è§„åˆ™ç¤ºä¾‹ï¼š ini # /etc/udev/rules.d/90-mydevice.rules SUBSYSTEM==\"input\", ATTRS{idVendor}==\"abcd\", ATTRS{idProduct}==\"1234\", MODE=\"660\", GROUP=\"input\", TAG+=\"uaccess\" è§„åˆ™è¯´æ˜ï¼š SUBSYSTEM==\"input\"ï¼šåŒ¹é…è¾“å…¥è®¾å¤‡å­ç³»ç»Ÿ ATTRS{idVendor}==\"abcd\"ï¼šåŒ¹é…å‚å•† ID ATTRS{idProduct}==\"1234\"ï¼šåŒ¹é…äº§å“ ID MODE=\"660\"ï¼šè®¾ç½®è®¾å¤‡æƒé™ä¸º 660 GROUP=\"input\"ï¼šè®¾ç½®è®¾å¤‡ç»„ä¸º input TAG+=\"uaccess\"ï¼šæ·»åŠ  uaccess æ ‡ç­¾ï¼Œè®© systemd-logind æ¥ç®¡è®¾å¤‡æƒé™ é«˜çº§è§„åˆ™ç¤ºä¾‹ï¼š ini # /etc/udev/rules.d/99-custom-storage.rules # ä¸ºç‰¹å®š USB å­˜å‚¨è®¾å¤‡åˆ›å»ºç¬¦å·é“¾æ¥ SUBSYSTEM==\"block\", ATTRS{idVendor}==\"1234\", ATTRS{idProduct}==\"5678\", SYMLINK+=\"myusb\" # ä¸ºç‰¹å®šç½‘å¡è®¾ç½®æŒä¹…åŒ–åç§° SUBSYSTEM==\"net\", ATTRS{address}==\"aa:bb:cc:dd:ee:ff\", NAME=\"eth0\" # ä¸ºç‰¹å®šè®¾å¤‡è¿è¡Œè‡ªå®šä¹‰è„šæœ¬ SUBSYSTEM==\"usb\", ATTRS{idVendor}==\"abcd\", RUN+=\"/usr/local/bin/my-device-handler.sh\" TAG+=\"uaccess\" æ˜¯ç°ä»£æ¡Œé¢ç”¨æ¥è®© systemd-logind æ¥ç®¡è®¾å¤‡æƒé™ä¸ session ACLï¼ˆç”± logind é…ç½®ï¼‰ï¼Œç¡®ä¿åªæœ‰å½“å‰æ´»åŠ¨ä¼šè¯èƒ½è®¿é—®è¾“å…¥ã€éŸ³é¢‘ã€GPU ç­‰è®¾å¤‡ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:4:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#31-udev-ä¸-systemd-udevd"},{"categories":["tech"],"content":" 3.1 udev ä¸ systemd-udevd 3.1.1 udev è®¾å¤‡ç®¡ç†æ¡†æ¶udev æ˜¯ Linux å†…æ ¸çš„ç”¨æˆ·ç©ºé—´è®¾å¤‡ç®¡ç†æ¡†æ¶ï¼Œè´Ÿè´£å¤„ç†å†…æ ¸çš„è®¾å¤‡äº‹ä»¶å¹¶ç®¡ç† /dev ç›®å½•ä¸‹çš„è®¾å¤‡èŠ‚ç‚¹ã€‚ udev çš„æ ¸å¿ƒåŠŸèƒ½ï¼š åŠ¨æ€è®¾å¤‡ç®¡ç†ï¼šå½“ç¡¬ä»¶è®¾å¤‡æ’å…¥æˆ–ç§»é™¤æ—¶ï¼Œè‡ªåŠ¨åˆ›å»ºè®¾å¤‡èŠ‚ç‚¹ è®¾å¤‡å‘½åï¼šæä¾›ä¸€è‡´çš„è®¾å¤‡å‘½åè§„åˆ™ï¼Œå¦‚ /dev/disk/by-uuid/ã€/dev/input/by-id/ æƒé™æ§åˆ¶ï¼šæ ¹æ®è®¾å¤‡ç±»å‹å’Œç”¨æˆ·éœ€æ±‚è®¾ç½®é€‚å½“çš„è®¾å¤‡æƒé™ è§„åˆ™ç³»ç»Ÿï¼šé€šè¿‡è§„åˆ™æ–‡ä»¶å®ç°å¤æ‚çš„è®¾å¤‡å¤„ç†é€»è¾‘ udev çš„å·¥ä½œåŸç†ï¼š å†…æ ¸æ£€æµ‹åˆ°ç¡¬ä»¶å˜åŒ–ï¼Œé€šè¿‡ netlink socket å‘é€ uevent åˆ°ç”¨æˆ·ç©ºé—´ udev å®ˆæŠ¤è¿›ç¨‹æ¥æ”¶ ueventï¼Œè§£æè®¾å¤‡å±æ€§ æ ¹æ®è§„åˆ™æ–‡ä»¶åŒ¹é…è®¾å¤‡ï¼Œæ‰§è¡Œç›¸åº”çš„åŠ¨ä½œï¼ˆåˆ›å»ºè®¾å¤‡èŠ‚ç‚¹ã€è®¾ç½®æƒé™ç­‰ï¼‰ 3.1.2 systemd-udevd å®ç°åœ¨ç°ä»£ systemd ç³»ç»Ÿä¸­ï¼Œudev ç”¨æˆ·ç©ºé—´çš„åŠŸèƒ½ç”± systemd-udevd å®ˆæŠ¤è¿›ç¨‹å®ç°ï¼Œå®ƒæ˜¯ systemd ç”Ÿæ€ç³»ç»Ÿçš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚ systemd-udevd çš„ä¼˜åŠ¿ï¼š systemd é›†æˆï¼šä½œä¸º systemd æœåŠ¡è¿è¡Œï¼Œäº«å— systemd çš„æœåŠ¡ç®¡ç†ã€æ—¥å¿—è®°å½•ã€ä¾èµ–ç®¡ç†ç­‰åŠŸèƒ½ æ€§èƒ½ä¼˜åŒ–ï¼šç›¸æ¯”ä¼ ç»Ÿçš„ udevdï¼Œsystemd-udevd åœ¨å¯åŠ¨é€Ÿåº¦å’Œèµ„æºä½¿ç”¨ä¸Šæœ‰æ‰€ä¼˜åŒ– ç»Ÿä¸€ç®¡ç†ï¼šä¸ systemd çš„å…¶ä»–ç»„ä»¶ï¼ˆå¦‚ systemd-logindï¼‰æ·±åº¦é›†æˆï¼Œæä¾›ç»Ÿä¸€çš„è®¾å¤‡æƒé™ç®¡ç† systemd-udevd æœåŠ¡ç®¡ç†ï¼š bash # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ systemctl status systemd-udevd # é‡å¯æœåŠ¡ sudo systemctl restart systemd-udevd # æŸ¥çœ‹æœåŠ¡æ—¥å¿— journalctl -u systemd-udevd -f 3.1.3 å·¥ä½œæµç¨‹å®Œæ•´çš„è®¾å¤‡ç®¡ç†æµç¨‹å¦‚ä¸‹ï¼š ç¡¬ä»¶æ£€æµ‹ï¼šå†…æ ¸æ£€æµ‹åˆ°ç¡¬ä»¶å˜åŒ–ï¼ˆæ’å…¥ã€ç§»é™¤ã€çŠ¶æ€æ”¹å˜ï¼‰ äº‹ä»¶å‘é€ï¼šå†…æ ¸é€šè¿‡ netlink socket å‘é€ uevent åˆ°ç”¨æˆ·ç©ºé—´ äº‹ä»¶æ¥æ”¶ï¼šsystemd-udevd æ¥æ”¶ ueventï¼Œè§£æè®¾å¤‡å±æ€§ è§„åˆ™åŒ¹é…ï¼šæ ¹æ®è§„åˆ™æ–‡ä»¶ï¼ˆ/run/current-system/sw/lib/udev/rules.d/ï¼ˆNixOSï¼‰æˆ–/usr/lib/udev/rules.d/ï¼ˆä¼ ç»Ÿå‘è¡Œç‰ˆï¼‰ã€/etc/udev/rules.d/ï¼‰åŒ¹é…è®¾å¤‡ åŠ¨ä½œæ‰§è¡Œï¼šæ‰§è¡ŒåŒ¹é…è§„åˆ™ä¸­å®šä¹‰çš„åŠ¨ä½œï¼ˆRUN è„šæœ¬ã€è®¾ç½® OWNER/GROUP/MODEã€åˆ›å»º symlinkã€è®¾ç½®æƒé™ï¼‰ systemd é›†æˆï¼šé€šçŸ¥ systemdï¼Œå¯èƒ½è§¦å‘ device units 3.1.4 é…ç½®ç¤ºä¾‹åŸºæœ¬è§„åˆ™ç¤ºä¾‹ï¼š ini # /etc/udev/rules.d/90-mydevice.rules SUBSYSTEM==\"input\", ATTRS{idVendor}==\"abcd\", ATTRS{idProduct}==\"1234\", MODE=\"660\", GROUP=\"input\", TAG+=\"uaccess\" è§„åˆ™è¯´æ˜ï¼š SUBSYSTEM==\"input\"ï¼šåŒ¹é…è¾“å…¥è®¾å¤‡å­ç³»ç»Ÿ ATTRS{idVendor}==\"abcd\"ï¼šåŒ¹é…å‚å•† ID ATTRS{idProduct}==\"1234\"ï¼šåŒ¹é…äº§å“ ID MODE=\"660\"ï¼šè®¾ç½®è®¾å¤‡æƒé™ä¸º 660 GROUP=\"input\"ï¼šè®¾ç½®è®¾å¤‡ç»„ä¸º input TAG+=\"uaccess\"ï¼šæ·»åŠ  uaccess æ ‡ç­¾ï¼Œè®© systemd-logind æ¥ç®¡è®¾å¤‡æƒé™ é«˜çº§è§„åˆ™ç¤ºä¾‹ï¼š ini # /etc/udev/rules.d/99-custom-storage.rules # ä¸ºç‰¹å®š USB å­˜å‚¨è®¾å¤‡åˆ›å»ºç¬¦å·é“¾æ¥ SUBSYSTEM==\"block\", ATTRS{idVendor}==\"1234\", ATTRS{idProduct}==\"5678\", SYMLINK+=\"myusb\" # ä¸ºç‰¹å®šç½‘å¡è®¾ç½®æŒä¹…åŒ–åç§° SUBSYSTEM==\"net\", ATTRS{address}==\"aa:bb:cc:dd:ee:ff\", NAME=\"eth0\" # ä¸ºç‰¹å®šè®¾å¤‡è¿è¡Œè‡ªå®šä¹‰è„šæœ¬ SUBSYSTEM==\"usb\", ATTRS{idVendor}==\"abcd\", RUN+=\"/usr/local/bin/my-device-handler.sh\" TAG+=\"uaccess\" æ˜¯ç°ä»£æ¡Œé¢ç”¨æ¥è®© systemd-logind æ¥ç®¡è®¾å¤‡æƒé™ä¸ session ACLï¼ˆç”± logind é…ç½®ï¼‰ï¼Œç¡®ä¿åªæœ‰å½“å‰æ´»åŠ¨ä¼šè¯èƒ½è®¿é—®è¾“å…¥ã€éŸ³é¢‘ã€GPU ç­‰è®¾å¤‡ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:4:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#311-udev-è®¾å¤‡ç®¡ç†æ¡†æ¶"},{"categories":["tech"],"content":" 3.1 udev ä¸ systemd-udevd 3.1.1 udev è®¾å¤‡ç®¡ç†æ¡†æ¶udev æ˜¯ Linux å†…æ ¸çš„ç”¨æˆ·ç©ºé—´è®¾å¤‡ç®¡ç†æ¡†æ¶ï¼Œè´Ÿè´£å¤„ç†å†…æ ¸çš„è®¾å¤‡äº‹ä»¶å¹¶ç®¡ç† /dev ç›®å½•ä¸‹çš„è®¾å¤‡èŠ‚ç‚¹ã€‚ udev çš„æ ¸å¿ƒåŠŸèƒ½ï¼š åŠ¨æ€è®¾å¤‡ç®¡ç†ï¼šå½“ç¡¬ä»¶è®¾å¤‡æ’å…¥æˆ–ç§»é™¤æ—¶ï¼Œè‡ªåŠ¨åˆ›å»ºè®¾å¤‡èŠ‚ç‚¹ è®¾å¤‡å‘½åï¼šæä¾›ä¸€è‡´çš„è®¾å¤‡å‘½åè§„åˆ™ï¼Œå¦‚ /dev/disk/by-uuid/ã€/dev/input/by-id/ æƒé™æ§åˆ¶ï¼šæ ¹æ®è®¾å¤‡ç±»å‹å’Œç”¨æˆ·éœ€æ±‚è®¾ç½®é€‚å½“çš„è®¾å¤‡æƒé™ è§„åˆ™ç³»ç»Ÿï¼šé€šè¿‡è§„åˆ™æ–‡ä»¶å®ç°å¤æ‚çš„è®¾å¤‡å¤„ç†é€»è¾‘ udev çš„å·¥ä½œåŸç†ï¼š å†…æ ¸æ£€æµ‹åˆ°ç¡¬ä»¶å˜åŒ–ï¼Œé€šè¿‡ netlink socket å‘é€ uevent åˆ°ç”¨æˆ·ç©ºé—´ udev å®ˆæŠ¤è¿›ç¨‹æ¥æ”¶ ueventï¼Œè§£æè®¾å¤‡å±æ€§ æ ¹æ®è§„åˆ™æ–‡ä»¶åŒ¹é…è®¾å¤‡ï¼Œæ‰§è¡Œç›¸åº”çš„åŠ¨ä½œï¼ˆåˆ›å»ºè®¾å¤‡èŠ‚ç‚¹ã€è®¾ç½®æƒé™ç­‰ï¼‰ 3.1.2 systemd-udevd å®ç°åœ¨ç°ä»£ systemd ç³»ç»Ÿä¸­ï¼Œudev ç”¨æˆ·ç©ºé—´çš„åŠŸèƒ½ç”± systemd-udevd å®ˆæŠ¤è¿›ç¨‹å®ç°ï¼Œå®ƒæ˜¯ systemd ç”Ÿæ€ç³»ç»Ÿçš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚ systemd-udevd çš„ä¼˜åŠ¿ï¼š systemd é›†æˆï¼šä½œä¸º systemd æœåŠ¡è¿è¡Œï¼Œäº«å— systemd çš„æœåŠ¡ç®¡ç†ã€æ—¥å¿—è®°å½•ã€ä¾èµ–ç®¡ç†ç­‰åŠŸèƒ½ æ€§èƒ½ä¼˜åŒ–ï¼šç›¸æ¯”ä¼ ç»Ÿçš„ udevdï¼Œsystemd-udevd åœ¨å¯åŠ¨é€Ÿåº¦å’Œèµ„æºä½¿ç”¨ä¸Šæœ‰æ‰€ä¼˜åŒ– ç»Ÿä¸€ç®¡ç†ï¼šä¸ systemd çš„å…¶ä»–ç»„ä»¶ï¼ˆå¦‚ systemd-logindï¼‰æ·±åº¦é›†æˆï¼Œæä¾›ç»Ÿä¸€çš„è®¾å¤‡æƒé™ç®¡ç† systemd-udevd æœåŠ¡ç®¡ç†ï¼š bash # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ systemctl status systemd-udevd # é‡å¯æœåŠ¡ sudo systemctl restart systemd-udevd # æŸ¥çœ‹æœåŠ¡æ—¥å¿— journalctl -u systemd-udevd -f 3.1.3 å·¥ä½œæµç¨‹å®Œæ•´çš„è®¾å¤‡ç®¡ç†æµç¨‹å¦‚ä¸‹ï¼š ç¡¬ä»¶æ£€æµ‹ï¼šå†…æ ¸æ£€æµ‹åˆ°ç¡¬ä»¶å˜åŒ–ï¼ˆæ’å…¥ã€ç§»é™¤ã€çŠ¶æ€æ”¹å˜ï¼‰ äº‹ä»¶å‘é€ï¼šå†…æ ¸é€šè¿‡ netlink socket å‘é€ uevent åˆ°ç”¨æˆ·ç©ºé—´ äº‹ä»¶æ¥æ”¶ï¼šsystemd-udevd æ¥æ”¶ ueventï¼Œè§£æè®¾å¤‡å±æ€§ è§„åˆ™åŒ¹é…ï¼šæ ¹æ®è§„åˆ™æ–‡ä»¶ï¼ˆ/run/current-system/sw/lib/udev/rules.d/ï¼ˆNixOSï¼‰æˆ–/usr/lib/udev/rules.d/ï¼ˆä¼ ç»Ÿå‘è¡Œç‰ˆï¼‰ã€/etc/udev/rules.d/ï¼‰åŒ¹é…è®¾å¤‡ åŠ¨ä½œæ‰§è¡Œï¼šæ‰§è¡ŒåŒ¹é…è§„åˆ™ä¸­å®šä¹‰çš„åŠ¨ä½œï¼ˆRUN è„šæœ¬ã€è®¾ç½® OWNER/GROUP/MODEã€åˆ›å»º symlinkã€è®¾ç½®æƒé™ï¼‰ systemd é›†æˆï¼šé€šçŸ¥ systemdï¼Œå¯èƒ½è§¦å‘ device units 3.1.4 é…ç½®ç¤ºä¾‹åŸºæœ¬è§„åˆ™ç¤ºä¾‹ï¼š ini # /etc/udev/rules.d/90-mydevice.rules SUBSYSTEM==\"input\", ATTRS{idVendor}==\"abcd\", ATTRS{idProduct}==\"1234\", MODE=\"660\", GROUP=\"input\", TAG+=\"uaccess\" è§„åˆ™è¯´æ˜ï¼š SUBSYSTEM==\"input\"ï¼šåŒ¹é…è¾“å…¥è®¾å¤‡å­ç³»ç»Ÿ ATTRS{idVendor}==\"abcd\"ï¼šåŒ¹é…å‚å•† ID ATTRS{idProduct}==\"1234\"ï¼šåŒ¹é…äº§å“ ID MODE=\"660\"ï¼šè®¾ç½®è®¾å¤‡æƒé™ä¸º 660 GROUP=\"input\"ï¼šè®¾ç½®è®¾å¤‡ç»„ä¸º input TAG+=\"uaccess\"ï¼šæ·»åŠ  uaccess æ ‡ç­¾ï¼Œè®© systemd-logind æ¥ç®¡è®¾å¤‡æƒé™ é«˜çº§è§„åˆ™ç¤ºä¾‹ï¼š ini # /etc/udev/rules.d/99-custom-storage.rules # ä¸ºç‰¹å®š USB å­˜å‚¨è®¾å¤‡åˆ›å»ºç¬¦å·é“¾æ¥ SUBSYSTEM==\"block\", ATTRS{idVendor}==\"1234\", ATTRS{idProduct}==\"5678\", SYMLINK+=\"myusb\" # ä¸ºç‰¹å®šç½‘å¡è®¾ç½®æŒä¹…åŒ–åç§° SUBSYSTEM==\"net\", ATTRS{address}==\"aa:bb:cc:dd:ee:ff\", NAME=\"eth0\" # ä¸ºç‰¹å®šè®¾å¤‡è¿è¡Œè‡ªå®šä¹‰è„šæœ¬ SUBSYSTEM==\"usb\", ATTRS{idVendor}==\"abcd\", RUN+=\"/usr/local/bin/my-device-handler.sh\" TAG+=\"uaccess\" æ˜¯ç°ä»£æ¡Œé¢ç”¨æ¥è®© systemd-logind æ¥ç®¡è®¾å¤‡æƒé™ä¸ session ACLï¼ˆç”± logind é…ç½®ï¼‰ï¼Œç¡®ä¿åªæœ‰å½“å‰æ´»åŠ¨ä¼šè¯èƒ½è®¿é—®è¾“å…¥ã€éŸ³é¢‘ã€GPU ç­‰è®¾å¤‡ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:4:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#312-systemd-udevd-å®ç°"},{"categories":["tech"],"content":" 3.1 udev ä¸ systemd-udevd 3.1.1 udev è®¾å¤‡ç®¡ç†æ¡†æ¶udev æ˜¯ Linux å†…æ ¸çš„ç”¨æˆ·ç©ºé—´è®¾å¤‡ç®¡ç†æ¡†æ¶ï¼Œè´Ÿè´£å¤„ç†å†…æ ¸çš„è®¾å¤‡äº‹ä»¶å¹¶ç®¡ç† /dev ç›®å½•ä¸‹çš„è®¾å¤‡èŠ‚ç‚¹ã€‚ udev çš„æ ¸å¿ƒåŠŸèƒ½ï¼š åŠ¨æ€è®¾å¤‡ç®¡ç†ï¼šå½“ç¡¬ä»¶è®¾å¤‡æ’å…¥æˆ–ç§»é™¤æ—¶ï¼Œè‡ªåŠ¨åˆ›å»ºè®¾å¤‡èŠ‚ç‚¹ è®¾å¤‡å‘½åï¼šæä¾›ä¸€è‡´çš„è®¾å¤‡å‘½åè§„åˆ™ï¼Œå¦‚ /dev/disk/by-uuid/ã€/dev/input/by-id/ æƒé™æ§åˆ¶ï¼šæ ¹æ®è®¾å¤‡ç±»å‹å’Œç”¨æˆ·éœ€æ±‚è®¾ç½®é€‚å½“çš„è®¾å¤‡æƒé™ è§„åˆ™ç³»ç»Ÿï¼šé€šè¿‡è§„åˆ™æ–‡ä»¶å®ç°å¤æ‚çš„è®¾å¤‡å¤„ç†é€»è¾‘ udev çš„å·¥ä½œåŸç†ï¼š å†…æ ¸æ£€æµ‹åˆ°ç¡¬ä»¶å˜åŒ–ï¼Œé€šè¿‡ netlink socket å‘é€ uevent åˆ°ç”¨æˆ·ç©ºé—´ udev å®ˆæŠ¤è¿›ç¨‹æ¥æ”¶ ueventï¼Œè§£æè®¾å¤‡å±æ€§ æ ¹æ®è§„åˆ™æ–‡ä»¶åŒ¹é…è®¾å¤‡ï¼Œæ‰§è¡Œç›¸åº”çš„åŠ¨ä½œï¼ˆåˆ›å»ºè®¾å¤‡èŠ‚ç‚¹ã€è®¾ç½®æƒé™ç­‰ï¼‰ 3.1.2 systemd-udevd å®ç°åœ¨ç°ä»£ systemd ç³»ç»Ÿä¸­ï¼Œudev ç”¨æˆ·ç©ºé—´çš„åŠŸèƒ½ç”± systemd-udevd å®ˆæŠ¤è¿›ç¨‹å®ç°ï¼Œå®ƒæ˜¯ systemd ç”Ÿæ€ç³»ç»Ÿçš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚ systemd-udevd çš„ä¼˜åŠ¿ï¼š systemd é›†æˆï¼šä½œä¸º systemd æœåŠ¡è¿è¡Œï¼Œäº«å— systemd çš„æœåŠ¡ç®¡ç†ã€æ—¥å¿—è®°å½•ã€ä¾èµ–ç®¡ç†ç­‰åŠŸèƒ½ æ€§èƒ½ä¼˜åŒ–ï¼šç›¸æ¯”ä¼ ç»Ÿçš„ udevdï¼Œsystemd-udevd åœ¨å¯åŠ¨é€Ÿåº¦å’Œèµ„æºä½¿ç”¨ä¸Šæœ‰æ‰€ä¼˜åŒ– ç»Ÿä¸€ç®¡ç†ï¼šä¸ systemd çš„å…¶ä»–ç»„ä»¶ï¼ˆå¦‚ systemd-logindï¼‰æ·±åº¦é›†æˆï¼Œæä¾›ç»Ÿä¸€çš„è®¾å¤‡æƒé™ç®¡ç† systemd-udevd æœåŠ¡ç®¡ç†ï¼š bash # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ systemctl status systemd-udevd # é‡å¯æœåŠ¡ sudo systemctl restart systemd-udevd # æŸ¥çœ‹æœåŠ¡æ—¥å¿— journalctl -u systemd-udevd -f 3.1.3 å·¥ä½œæµç¨‹å®Œæ•´çš„è®¾å¤‡ç®¡ç†æµç¨‹å¦‚ä¸‹ï¼š ç¡¬ä»¶æ£€æµ‹ï¼šå†…æ ¸æ£€æµ‹åˆ°ç¡¬ä»¶å˜åŒ–ï¼ˆæ’å…¥ã€ç§»é™¤ã€çŠ¶æ€æ”¹å˜ï¼‰ äº‹ä»¶å‘é€ï¼šå†…æ ¸é€šè¿‡ netlink socket å‘é€ uevent åˆ°ç”¨æˆ·ç©ºé—´ äº‹ä»¶æ¥æ”¶ï¼šsystemd-udevd æ¥æ”¶ ueventï¼Œè§£æè®¾å¤‡å±æ€§ è§„åˆ™åŒ¹é…ï¼šæ ¹æ®è§„åˆ™æ–‡ä»¶ï¼ˆ/run/current-system/sw/lib/udev/rules.d/ï¼ˆNixOSï¼‰æˆ–/usr/lib/udev/rules.d/ï¼ˆä¼ ç»Ÿå‘è¡Œç‰ˆï¼‰ã€/etc/udev/rules.d/ï¼‰åŒ¹é…è®¾å¤‡ åŠ¨ä½œæ‰§è¡Œï¼šæ‰§è¡ŒåŒ¹é…è§„åˆ™ä¸­å®šä¹‰çš„åŠ¨ä½œï¼ˆRUN è„šæœ¬ã€è®¾ç½® OWNER/GROUP/MODEã€åˆ›å»º symlinkã€è®¾ç½®æƒé™ï¼‰ systemd é›†æˆï¼šé€šçŸ¥ systemdï¼Œå¯èƒ½è§¦å‘ device units 3.1.4 é…ç½®ç¤ºä¾‹åŸºæœ¬è§„åˆ™ç¤ºä¾‹ï¼š ini # /etc/udev/rules.d/90-mydevice.rules SUBSYSTEM==\"input\", ATTRS{idVendor}==\"abcd\", ATTRS{idProduct}==\"1234\", MODE=\"660\", GROUP=\"input\", TAG+=\"uaccess\" è§„åˆ™è¯´æ˜ï¼š SUBSYSTEM==\"input\"ï¼šåŒ¹é…è¾“å…¥è®¾å¤‡å­ç³»ç»Ÿ ATTRS{idVendor}==\"abcd\"ï¼šåŒ¹é…å‚å•† ID ATTRS{idProduct}==\"1234\"ï¼šåŒ¹é…äº§å“ ID MODE=\"660\"ï¼šè®¾ç½®è®¾å¤‡æƒé™ä¸º 660 GROUP=\"input\"ï¼šè®¾ç½®è®¾å¤‡ç»„ä¸º input TAG+=\"uaccess\"ï¼šæ·»åŠ  uaccess æ ‡ç­¾ï¼Œè®© systemd-logind æ¥ç®¡è®¾å¤‡æƒé™ é«˜çº§è§„åˆ™ç¤ºä¾‹ï¼š ini # /etc/udev/rules.d/99-custom-storage.rules # ä¸ºç‰¹å®š USB å­˜å‚¨è®¾å¤‡åˆ›å»ºç¬¦å·é“¾æ¥ SUBSYSTEM==\"block\", ATTRS{idVendor}==\"1234\", ATTRS{idProduct}==\"5678\", SYMLINK+=\"myusb\" # ä¸ºç‰¹å®šç½‘å¡è®¾ç½®æŒä¹…åŒ–åç§° SUBSYSTEM==\"net\", ATTRS{address}==\"aa:bb:cc:dd:ee:ff\", NAME=\"eth0\" # ä¸ºç‰¹å®šè®¾å¤‡è¿è¡Œè‡ªå®šä¹‰è„šæœ¬ SUBSYSTEM==\"usb\", ATTRS{idVendor}==\"abcd\", RUN+=\"/usr/local/bin/my-device-handler.sh\" TAG+=\"uaccess\" æ˜¯ç°ä»£æ¡Œé¢ç”¨æ¥è®© systemd-logind æ¥ç®¡è®¾å¤‡æƒé™ä¸ session ACLï¼ˆç”± logind é…ç½®ï¼‰ï¼Œç¡®ä¿åªæœ‰å½“å‰æ´»åŠ¨ä¼šè¯èƒ½è®¿é—®è¾“å…¥ã€éŸ³é¢‘ã€GPU ç­‰è®¾å¤‡ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:4:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#313-å·¥ä½œæµç¨‹"},{"categories":["tech"],"content":" 3.1 udev ä¸ systemd-udevd 3.1.1 udev è®¾å¤‡ç®¡ç†æ¡†æ¶udev æ˜¯ Linux å†…æ ¸çš„ç”¨æˆ·ç©ºé—´è®¾å¤‡ç®¡ç†æ¡†æ¶ï¼Œè´Ÿè´£å¤„ç†å†…æ ¸çš„è®¾å¤‡äº‹ä»¶å¹¶ç®¡ç† /dev ç›®å½•ä¸‹çš„è®¾å¤‡èŠ‚ç‚¹ã€‚ udev çš„æ ¸å¿ƒåŠŸèƒ½ï¼š åŠ¨æ€è®¾å¤‡ç®¡ç†ï¼šå½“ç¡¬ä»¶è®¾å¤‡æ’å…¥æˆ–ç§»é™¤æ—¶ï¼Œè‡ªåŠ¨åˆ›å»ºè®¾å¤‡èŠ‚ç‚¹ è®¾å¤‡å‘½åï¼šæä¾›ä¸€è‡´çš„è®¾å¤‡å‘½åè§„åˆ™ï¼Œå¦‚ /dev/disk/by-uuid/ã€/dev/input/by-id/ æƒé™æ§åˆ¶ï¼šæ ¹æ®è®¾å¤‡ç±»å‹å’Œç”¨æˆ·éœ€æ±‚è®¾ç½®é€‚å½“çš„è®¾å¤‡æƒé™ è§„åˆ™ç³»ç»Ÿï¼šé€šè¿‡è§„åˆ™æ–‡ä»¶å®ç°å¤æ‚çš„è®¾å¤‡å¤„ç†é€»è¾‘ udev çš„å·¥ä½œåŸç†ï¼š å†…æ ¸æ£€æµ‹åˆ°ç¡¬ä»¶å˜åŒ–ï¼Œé€šè¿‡ netlink socket å‘é€ uevent åˆ°ç”¨æˆ·ç©ºé—´ udev å®ˆæŠ¤è¿›ç¨‹æ¥æ”¶ ueventï¼Œè§£æè®¾å¤‡å±æ€§ æ ¹æ®è§„åˆ™æ–‡ä»¶åŒ¹é…è®¾å¤‡ï¼Œæ‰§è¡Œç›¸åº”çš„åŠ¨ä½œï¼ˆåˆ›å»ºè®¾å¤‡èŠ‚ç‚¹ã€è®¾ç½®æƒé™ç­‰ï¼‰ 3.1.2 systemd-udevd å®ç°åœ¨ç°ä»£ systemd ç³»ç»Ÿä¸­ï¼Œudev ç”¨æˆ·ç©ºé—´çš„åŠŸèƒ½ç”± systemd-udevd å®ˆæŠ¤è¿›ç¨‹å®ç°ï¼Œå®ƒæ˜¯ systemd ç”Ÿæ€ç³»ç»Ÿçš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚ systemd-udevd çš„ä¼˜åŠ¿ï¼š systemd é›†æˆï¼šä½œä¸º systemd æœåŠ¡è¿è¡Œï¼Œäº«å— systemd çš„æœåŠ¡ç®¡ç†ã€æ—¥å¿—è®°å½•ã€ä¾èµ–ç®¡ç†ç­‰åŠŸèƒ½ æ€§èƒ½ä¼˜åŒ–ï¼šç›¸æ¯”ä¼ ç»Ÿçš„ udevdï¼Œsystemd-udevd åœ¨å¯åŠ¨é€Ÿåº¦å’Œèµ„æºä½¿ç”¨ä¸Šæœ‰æ‰€ä¼˜åŒ– ç»Ÿä¸€ç®¡ç†ï¼šä¸ systemd çš„å…¶ä»–ç»„ä»¶ï¼ˆå¦‚ systemd-logindï¼‰æ·±åº¦é›†æˆï¼Œæä¾›ç»Ÿä¸€çš„è®¾å¤‡æƒé™ç®¡ç† systemd-udevd æœåŠ¡ç®¡ç†ï¼š bash # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ systemctl status systemd-udevd # é‡å¯æœåŠ¡ sudo systemctl restart systemd-udevd # æŸ¥çœ‹æœåŠ¡æ—¥å¿— journalctl -u systemd-udevd -f 3.1.3 å·¥ä½œæµç¨‹å®Œæ•´çš„è®¾å¤‡ç®¡ç†æµç¨‹å¦‚ä¸‹ï¼š ç¡¬ä»¶æ£€æµ‹ï¼šå†…æ ¸æ£€æµ‹åˆ°ç¡¬ä»¶å˜åŒ–ï¼ˆæ’å…¥ã€ç§»é™¤ã€çŠ¶æ€æ”¹å˜ï¼‰ äº‹ä»¶å‘é€ï¼šå†…æ ¸é€šè¿‡ netlink socket å‘é€ uevent åˆ°ç”¨æˆ·ç©ºé—´ äº‹ä»¶æ¥æ”¶ï¼šsystemd-udevd æ¥æ”¶ ueventï¼Œè§£æè®¾å¤‡å±æ€§ è§„åˆ™åŒ¹é…ï¼šæ ¹æ®è§„åˆ™æ–‡ä»¶ï¼ˆ/run/current-system/sw/lib/udev/rules.d/ï¼ˆNixOSï¼‰æˆ–/usr/lib/udev/rules.d/ï¼ˆä¼ ç»Ÿå‘è¡Œç‰ˆï¼‰ã€/etc/udev/rules.d/ï¼‰åŒ¹é…è®¾å¤‡ åŠ¨ä½œæ‰§è¡Œï¼šæ‰§è¡ŒåŒ¹é…è§„åˆ™ä¸­å®šä¹‰çš„åŠ¨ä½œï¼ˆRUN è„šæœ¬ã€è®¾ç½® OWNER/GROUP/MODEã€åˆ›å»º symlinkã€è®¾ç½®æƒé™ï¼‰ systemd é›†æˆï¼šé€šçŸ¥ systemdï¼Œå¯èƒ½è§¦å‘ device units 3.1.4 é…ç½®ç¤ºä¾‹åŸºæœ¬è§„åˆ™ç¤ºä¾‹ï¼š ini # /etc/udev/rules.d/90-mydevice.rules SUBSYSTEM==\"input\", ATTRS{idVendor}==\"abcd\", ATTRS{idProduct}==\"1234\", MODE=\"660\", GROUP=\"input\", TAG+=\"uaccess\" è§„åˆ™è¯´æ˜ï¼š SUBSYSTEM==\"input\"ï¼šåŒ¹é…è¾“å…¥è®¾å¤‡å­ç³»ç»Ÿ ATTRS{idVendor}==\"abcd\"ï¼šåŒ¹é…å‚å•† ID ATTRS{idProduct}==\"1234\"ï¼šåŒ¹é…äº§å“ ID MODE=\"660\"ï¼šè®¾ç½®è®¾å¤‡æƒé™ä¸º 660 GROUP=\"input\"ï¼šè®¾ç½®è®¾å¤‡ç»„ä¸º input TAG+=\"uaccess\"ï¼šæ·»åŠ  uaccess æ ‡ç­¾ï¼Œè®© systemd-logind æ¥ç®¡è®¾å¤‡æƒé™ é«˜çº§è§„åˆ™ç¤ºä¾‹ï¼š ini # /etc/udev/rules.d/99-custom-storage.rules # ä¸ºç‰¹å®š USB å­˜å‚¨è®¾å¤‡åˆ›å»ºç¬¦å·é“¾æ¥ SUBSYSTEM==\"block\", ATTRS{idVendor}==\"1234\", ATTRS{idProduct}==\"5678\", SYMLINK+=\"myusb\" # ä¸ºç‰¹å®šç½‘å¡è®¾ç½®æŒä¹…åŒ–åç§° SUBSYSTEM==\"net\", ATTRS{address}==\"aa:bb:cc:dd:ee:ff\", NAME=\"eth0\" # ä¸ºç‰¹å®šè®¾å¤‡è¿è¡Œè‡ªå®šä¹‰è„šæœ¬ SUBSYSTEM==\"usb\", ATTRS{idVendor}==\"abcd\", RUN+=\"/usr/local/bin/my-device-handler.sh\" TAG+=\"uaccess\" æ˜¯ç°ä»£æ¡Œé¢ç”¨æ¥è®© systemd-logind æ¥ç®¡è®¾å¤‡æƒé™ä¸ session ACLï¼ˆç”± logind é…ç½®ï¼‰ï¼Œç¡®ä¿åªæœ‰å½“å‰æ´»åŠ¨ä¼šè¯èƒ½è®¿é—®è¾“å…¥ã€éŸ³é¢‘ã€GPU ç­‰è®¾å¤‡ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:4:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#314-é…ç½®ç¤ºä¾‹"},{"categories":["tech"],"content":" 3.2 è®¾å¤‡æƒé™ä¸ ACLç°ä»£ systemd + logind ä½¿ç”¨ udev tag uaccess æˆ– seat æ ‡ç­¾æ¥ç”± logind æŠŠè®¾å¤‡ ACL æˆäºˆå½“å‰çš„ç™»å½• sessionã€‚å…·ä½“æµç¨‹ï¼š systemd-udevd åˆ›å»º /dev/input/eventX å¹¶æ‰“ä¸Š TAG+=\"uaccess\". systemd-logind å¯¹åº”çš„ PAM/session ç³»ç»Ÿä¼šæŠŠè¯¥è®¾å¤‡çš„ ACL æˆäºˆå½“å‰ä¼šè¯çš„ç”¨æˆ·ï¼Œè¿™æ ·è¿è¡Œåœ¨ä¼šè¯å†…çš„ Wayland compositor ä¸å…¶å­è¿›ç¨‹å¯ä»¥è®¿é—®è®¾å¤‡ã€‚ æ£€æŸ¥è®¾å¤‡æƒé™åˆ†é…ï¼š bash # æŸ¥çœ‹æŸè®¾å¤‡çš„ udev å±æ€§ $ udevadm info -a -n /dev/input/event5 # å®æ—¶ç›‘æ§ udev äº‹ä»¶ $ sudo udevadm monitor --udev --property # æŸ¥çœ‹ seat çŠ¶æ€ä¸ ACL $ loginctl seat-status seat0 # æˆ– $ loginctl show-session \u003cid\u003e -p Remote -p Display -p Name ","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:4:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#32-è®¾å¤‡æƒé™ä¸-acl"},{"categories":["tech"],"content":" 3.3 æ•…éšœæ’æŸ¥åœºæ™¯ï¼šæ’å…¥å¤–æ¥é”®ç›˜åï¼ŒWayland ä¼šè¯æ”¶ä¸åˆ°é”®ç›˜äº‹ä»¶ï¼ˆé”®ç›˜æ— æ•ˆï¼‰ æ’æŸ¥æ­¥éª¤ï¼š æ£€æŸ¥ systemd-udevd æœåŠ¡çŠ¶æ€ï¼š bash systemctl status systemd-udevd åœ¨ä¸»æœºä¸Šç”¨ udevadm monitor æ’å…¥é”®ç›˜ï¼Œè§‚å¯Ÿæ˜¯å¦æœ‰ udev äº‹ä»¶è¢«è§¦å‘ï¼š bash sudo udevadm monitor --udev æ£€æŸ¥ /dev/input/ æ˜¯å¦ç”Ÿæˆæ–°èŠ‚ç‚¹ï¼šls -l /dev/input/by-idã€‚ ç”¨ udevadm info -a -n /dev/input/eventX æŸ¥çœ‹è¯¥è®¾å¤‡çš„å±æ€§ï¼Œç¡®è®¤ TAG æ˜¯å¦åŒ…å«uaccess æˆ– seat. ä½¿ç”¨ loginctl seat-status seat0 çœ‹è®¾å¤‡æ˜¯å¦åˆ†é…ç»™å½“å‰ä¼šè¯ã€‚è‹¥æ²¡æœ‰ï¼Œå¯èƒ½æ˜¯ PAM/session æœªæ­£ç¡®å»ºç«‹æˆ– udev è§„åˆ™æ²¡æœ‰æ‰“ä¸Š tagã€‚ æ£€æŸ¥ systemd-udevd çš„æ—¥å¿—ï¼š bash journalctl -b -u systemd-udevd journalctl -k | grep -i udev ä¸´æ—¶è§£å†³ï¼šç”¨ chmod/chown ä¿®æ”¹è®¾å¤‡æƒé™éªŒè¯æ˜¯å¦æ¢å¤ï¼ˆä¸å»ºè®®é•¿æœŸé‡‡ç”¨ï¼‰ï¼š bash sudo chown root:input /dev/input/eventX sudo chmod 660 /dev/input/eventX æ°¸ä¹…ä¿®å¤ï¼šåœ¨ /etc/udev/rules.d/ ä¸­æ·»åŠ è§„åˆ™ç¡®ä¿ TAG+=\"uaccess\" æˆ–æ­£ç¡®çš„OWNER/GROUPã€‚ç„¶å udevadm control --reload-rules \u0026\u0026 sudo udevadm triggerã€‚ æ³¨æ„ï¼šNixOS ä¸‹ç›´æ¥ç¼–è¾‘ /etc/udev/rules.d å¯èƒ½æ˜¯ä¸´æ—¶çš„ï¼ˆNix ç®¡ç†çš„æ–‡ä»¶ä¼šè¢«ç³»ç»Ÿé‡å»ºè¦†ç›–ï¼‰ï¼Œæ­£ç¡®åšæ³•æ˜¯åœ¨ configuration.nix ä¸­é…ç½® services.udev.extraRules æˆ–æŠŠè§„åˆ™æ”¾åœ¨environment.etc å¹¶ç”± Nix ç®¡ç†ã€‚ é…ç½®æ–‡ä»¶è·¯å¾„ï¼š /etc/udev/rules.d/ï¼šç³»ç»Ÿç®¡ç†å‘˜è‡ªå®šä¹‰è§„åˆ™ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰ /run/current-system/sw/lib/udev/rules.d/ï¼ˆNixOSï¼‰æˆ– /usr/lib/udev/rules.d/ï¼ˆä¼ ç»Ÿå‘è¡Œç‰ˆï¼‰ï¼šè½¯ä»¶åŒ…æä¾›çš„é»˜è®¤è§„åˆ™ ","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:4:3","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#33-æ•…éšœæ’æŸ¥"},{"categories":["tech"],"content":" 4. D-Bus ç³»ç»Ÿæ€»çº¿ - åº”ç”¨é—´é€šä¿¡çš„ä¸»è¦é€šé“D-Bus æ˜¯ Linux ç³»ç»Ÿä¸­ä¸»æµçš„è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰æœºåˆ¶ï¼Œæ—¨åœ¨è§£å†³ä¸åŒè¿›ç¨‹ï¼ˆå°¤å…¶æ˜¯æ¡Œé¢åº”ç”¨ã€ç³»ç»ŸæœåŠ¡ï¼‰é—´çš„é«˜æ•ˆã€å®‰å…¨é€šä¿¡é—®é¢˜ï¼Œå¹¿æ³›ç”¨äº GNOMEã€KDE ç­‰æ¡Œé¢ç¯å¢ƒåŠç³»ç»ŸæœåŠ¡ç®¡ç†ï¼ˆå¦‚ systemdï¼‰ã€‚å®ƒæœ¬è´¨æ˜¯ â€œæ¶ˆæ¯æ€»çº¿â€ï¼Œé€šè¿‡ä¸­å¿ƒåŒ–çš„ â€œæ€»çº¿å®ˆæŠ¤è¿›ç¨‹â€ å®ç°å¤šè¿›ç¨‹é—´çš„æ¶ˆæ¯è·¯ç”±ã€‚åå­—è™½ç„¶æœ‰ç‚¹å¥‡æ€ªï¼Œ åŠŸèƒ½å€’æ˜¯æŒºå®åœ¨çš„ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:5:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#4-d-bus-ç³»ç»Ÿæ€»çº¿---åº”ç”¨é—´é€šä¿¡çš„ä¸»è¦é€šé“"},{"categories":["tech"],"content":" 4.1 D-Bus é¡¹ç›®èƒŒæ™¯D-Bus å¹¶é systemd ç¤¾åŒºçš„é¡¹ç›®ï¼Œè€Œæ˜¯ freedesktop.org çš„ç‹¬ç«‹é¡¹ç›®ã€‚D-Bus åœ¨ systemd å‡ºç°ä¹‹å‰å°±å·²ç»å­˜åœ¨ï¼Œæ˜¯ Linux æ¡Œé¢ç¯å¢ƒæ ‡å‡†åŒ–è¿›ç¨‹é—´é€šä¿¡çš„é‡è¦åŸºç¡€è®¾æ–½ã€‚ D-Bus ä¸ systemd çš„å…³ç³»ï¼š ç‹¬ç«‹é¡¹ç›®ï¼šD-Bus ç”± freedesktop.org ç»´æŠ¤ï¼Œæœ‰è‡ªå·±çš„å‘å¸ƒå‘¨æœŸå’Œå¼€å‘å›¢é˜Ÿ æ·±åº¦é›†æˆï¼šsystemd å°† D-Bus ä½œä¸ºæ ¸å¿ƒä¾èµ–ï¼Œæ·±åº¦é›†æˆåˆ°å…¶æ¶æ„ä¸­ æœåŠ¡ç®¡ç†ï¼šsystemd è´Ÿè´£å¯åŠ¨å’Œç®¡ç† D-Bus å®ˆæŠ¤è¿›ç¨‹ï¼ˆdbus-daemonï¼‰ ç»Ÿä¸€æ¥å£ï¼šsystemd é€šè¿‡ D-Bus æä¾›ç»Ÿä¸€çš„æœåŠ¡ç®¡ç†æ¥å£ systemd æœ¬èº«å°±æ˜¯ä¸€ä¸ª D-Bus æœåŠ¡ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨ systemctl å‘½ä»¤ä¸ systemd äº¤äº’æ—¶ï¼Œå®é™…ä¸Šå°±æ˜¯ D-Bus ä¸ org.freedesktop.systemd1 é€šä¿¡ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:5:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#41-d-bus-é¡¹ç›®èƒŒæ™¯"},{"categories":["tech"],"content":" 4.2 å…³é”®æ¦‚å¿µD-Bus é€šè¿‡ ã€Œå¯¹è±¡ - æ¥å£ã€ æ¨¡å‹ï¼ˆè·Ÿé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰ä¸­çš„æ¦‚å¿µæœ‰äº›ç±»ä¼¼ï¼‰å°è£…åŠŸèƒ½ï¼Œä»¥ä¸‹ç»“åˆsystemd1 ä¸ logind1 çš„çœŸå®å®šä¹‰ï¼Œå¯¹åº”æ ¸å¿ƒæ¦‚å¿µï¼š æ¦‚å¿µ å®šä¹‰ä¸ä½œç”¨ ç¤ºä¾‹ï¼ˆsystemd1/logind1ï¼‰ æ€»çº¿ï¼ˆBusï¼‰ D-Bus æ¶ˆæ¯ä¼ è¾“çš„åŸºç¡€é€šé“ï¼Œåˆ†ç³»ç»Ÿ / ä¼šè¯ä¸¤å¤§ç±» ç³»ç»Ÿæ€»çº¿ /var/run/dbus/system_bus_socketï¼ˆsystemd1/logind1 å”¯ä¸€ä½¿ç”¨çš„æ€»çº¿ï¼‰ æœåŠ¡åï¼ˆNameï¼‰ æœåŠ¡ç«¯åœ¨æ€»çº¿ä¸Šçš„ IDï¼Œé€šå¸¸æ¯ä¸ªåº”ç”¨ç¨‹åºä¸€ä¸ª org.freedesktop.systemd1ï¼ˆsystemd æœåŠ¡åï¼‰ã€org.freedesktop.login1ï¼ˆlogind æœåŠ¡åï¼‰ å¯¹è±¡ï¼ˆObjectï¼‰ æœåŠ¡å†…éƒ¨çš„åŠŸèƒ½ç»„ç»‡å•å…ƒï¼Œé€šè¿‡å¯¹è±¡è·¯å¾„è¿›è¡Œæ ‡è¯†ã€‚æ¯ä¸ªå¯¹è±¡å¯ä»¥ä»£è¡¨ä¸åŒçš„èµ„æºã€‚ /org/freedesktop/systemd1ï¼ˆsystemd1 æ ¹å¯¹è±¡ï¼‰ã€/org/freedesktop/login1ï¼ˆlogind1 æ ¹å¯¹è±¡ï¼‰ æ¥å£ï¼ˆInterfaceï¼‰ æ¯ä¸ªæ¥å£å®šä¹‰äº†ä¸€ç»„æ–¹æ³•å’Œä¿¡å· org.freedesktop.systemd1.Managerï¼ˆsystemd1 æ ¸å¿ƒæ¥å£ï¼‰ã€org.freedesktop.login1.Managerï¼ˆlogind1 æ ¸å¿ƒæ¥å£ï¼‰ æ–¹æ³•ï¼ˆMethodï¼‰ æ–¹æ³•æ˜¯å¯¹è±¡æ¥å£ä¸­å®šä¹‰çš„å‡½æ•°ï¼Œå¯ä»¥è¢«è¿œç¨‹è°ƒç”¨ã€‚æ–¹æ³•å±äºæŸä¸ªæ¥å£ï¼Œè€Œæ¥å£ç”±å¯¹è±¡å®ç°ã€‚ï¼ˆæœ‰è¯·æ±‚æœ‰è¿”å›ï¼‰ systemd1 çš„ StartUnitï¼ˆå¯åŠ¨ç³»ç»Ÿå•å…ƒï¼Œå¦‚ nginx.serviceï¼‰ã€logind1 çš„ ListSessionsï¼ˆæŸ¥è¯¢æ‰€æœ‰æ´»è·ƒç”¨æˆ·ä¼šè¯ï¼‰ ä¿¡å·ï¼ˆSignalï¼‰ å¯¹è±¡å‘å‡ºçš„å•å‘äº‹ä»¶é€šçŸ¥ï¼Œæ”¯æŒå¤šæ’­ï¼ˆæ— è¿”å›å€¼ï¼‰ systemd1 çš„ UnitActiveChangedï¼ˆå•å…ƒçŠ¶æ€å˜åŒ–ï¼Œå¦‚ nginx ä» inactive å˜ä¸º activeï¼‰ã€logind1 çš„ SessionNewï¼ˆæ–°ç”¨æˆ·ç™»å½•åˆ›å»ºä¼šè¯ï¼‰ å±æ€§ï¼ˆPropertyï¼‰ å¯¹è±¡çš„ ã€ŒçŠ¶æ€æ•°æ®ã€ï¼Œæ”¯æŒè¯»å– / å†™å…¥ / å˜æ›´é€šçŸ¥ systemd1 çš„ ActiveUnitsï¼ˆæ‰€æœ‰æ´»è·ƒç³»ç»Ÿå•å…ƒåˆ—è¡¨ï¼‰ã€logind1 çš„ CanPowerOffï¼ˆå½“å‰ç³»ç»Ÿæ˜¯å¦å…è®¸å…³æœºï¼Œå¸ƒå°”å€¼ï¼‰ å¯ä½¿ç”¨ busctl list æŸ¥çœ‹ç³»ç»Ÿä¸­çš„æ‰€æœ‰ D-Bus å¯¹è±¡ï¼š bash # æ‰€æœ‰ system bus å¯¹è±¡ â€º busctl --system list --no-pager | grep org. org.blueman.Mechanism - - - (activatable) - - - org.bluez 1421 bluetoothd root :1.6 bluetooth.service - - org.bluez.mesh - - - (activatable) - - - org.freedesktop.Avahi 1420 avahi-daemon avahi :1.7 avahi-daemon.service - - org.freedesktop.DBus 1 systemd root - init.scope - - org.freedesktop.Flatpak.SystemHelper - - - (activatable) - - - org.freedesktop.GeoClue2 - - - (activatable) - - - org.freedesktop.PolicyKit1 2216 polkitd polkituser :1.22 polkit.service - - org.freedesktop.RealtimeKit1 2539 rtkit-daemon root :1.41 rtkit-daemon.service - - org.freedesktop.UDisks2 2492 udisksd root :1.31 udisks2.service - - org.freedesktop.home1 - - - (activatable) - - - org.freedesktop.hostname1 - - - (activatable) - - - org.freedesktop.import1 - - - (activatable) - - - org.freedesktop.locale1 - - - (activatable) - - - org.freedesktop.login1 1504 systemd-logind root :1.8 systemd-logind.service - - org.freedesktop.machine1 - - - (activatable) - - - org.freedesktop.network1 1292 systemd-network systemd-network :1.3 systemd-networkd.service - - org.freedesktop.oom1 934 systemd-oomd systemd-oom :1.1 systemd-oomd.service - - org.freedesktop.portable1 - - - (activatable) - - - org.freedesktop.resolve1 1293 systemd-resolve systemd-resolve :1.0 systemd-resolved.service - - org.freedesktop.systemd1 1 systemd root :1.4 init.scope - - org.freedesktop.sysupdate1 - - - (activatable) - - - org.freedesktop.timedate1 - - - (activatable) - - - org.freedesktop.timesync1 1148 systemd-timesyn systemd-timesync :1.2 systemd-timesyncd.service - - org.opensuse.CupsPkHelper.Mechanism - - - (activatable) - - - # æ‰€æœ‰ session bus å¯¹è±¡ â€º busctl --user list --no-pager | grep org. ... org.fcitx.Fcitx-0 76699 fcitx5 ryan :1.284 user@1000.service - - org.fcitx.Fcitx5 76699 fcitx5 ryan :1.282 user@1000.service - - org.freedesktop.DBus 2127 systemd ryan - user@1000.service - - org.freedesktop.FileManager1 - - - (activatable) - - - org.freedesktop.Notifications 3539 .mako-wrapped ryan :1.81 user@1000.service - - org.freedesktop.ReserveDevice1.Audio0 2542 wireplumber ryan :1.50 user@1000.service - - org.freedesktop.ReserveDevice1.Audio1 2542 wireplumber ryan :1.50 user@1000.service - - org.freedesktop.ScreenSaver 2192 niri ryan :1.9 user@1000.service - - org.freedesktop.a11y.Manager 2192 niri ryan :1.13 user@1000.service - - org.freedesktop.impl.portal.PermissionStore 2410 .xdg-permission ryan :1.28 user@1000.service - - org.freedesktop.impl.portal.Secret - - - (activatable) - - - org.freedesktop.impl.portal.desktop.gnome - - - (activatable) - - - org.freedesktop.impl.portal.desktop.gtk 2475 .xdg-desktop-po ryan :1.33 user@1000.service - - org.freedesktop.portal.Desktop 2350 .xdg-desktop-po ryan :1.26 user@1000.service - - org.freedesktop.portal.Documents 2428 .xdg-document-p ryan :1.30 user@1000.service - - org.freedesktop.portal.Fcitx 76699 fcitx5 ryan :1.283 user@1000.service - - org.freedesktop.portal.Flatpak - - - (activatable)","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:5:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#42-å…³é”®æ¦‚å¿µ"},{"categories":["tech"],"content":" 4.3 ç³»ç»Ÿæ€»çº¿ä¸ä¼šè¯æ€»çº¿ æ€»çº¿ç±»å‹ ä½œç”¨åœºæ™¯ å…¸å‹ç”¨é€” è¿è¡Œç”¨æˆ· ç³»ç»Ÿæ€»çº¿ï¼ˆSystem Busï¼‰ ç³»ç»Ÿçº§æœåŠ¡é€šä¿¡ systemd1 å•å…ƒç®¡ç†ï¼ˆå¯åŠ¨ / åœæ­¢æœåŠ¡ï¼‰ã€logind1 ç”¨æˆ·ä¼šè¯ / ç”µæºæ§åˆ¶ï¼ˆå…³æœº / é‡å¯ï¼‰ rootï¼ˆç‰¹æƒï¼‰ ä¼šè¯æ€»çº¿ï¼ˆSession Busï¼‰ å•ä¸ªç”¨æˆ·ä¼šè¯å†…çš„åº”ç”¨é€šä¿¡ æ¡Œé¢åº”ç”¨äº¤äº’ï¼ˆå¦‚çª—å£åˆ‡æ¢ã€é€šçŸ¥ï¼‰ å½“å‰ç™»å½•ç”¨æˆ· ","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:5:3","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#43-ç³»ç»Ÿæ€»çº¿ä¸ä¼šè¯æ€»çº¿"},{"categories":["tech"],"content":" 4.4 D-Bus çš„ä¸‰ç±»è§’è‰² æ€»çº¿å®ˆæŠ¤è¿›ç¨‹ï¼ˆdbus-daemonï¼‰ æ¶æ„çš„ ã€Œä¸­æ¢ã€ï¼Œæ¯ä¸ªæ€»çº¿å¯¹åº”ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œæ ¸å¿ƒèŒè´£ï¼š ç®¡ç†è¿›ç¨‹çš„è¿æ¥ï¼ˆå¦‚éªŒè¯ æ™®é€šç”¨æˆ· æ˜¯å¦æœ‰æƒè°ƒç”¨ logind1 çš„ PowerOff æ–¹æ³•ï¼‰ï¼› è·¯ç”±æ¶ˆæ¯ï¼ˆå°†å®¢æˆ·ç«¯è¯·æ±‚çš„ ã€Œå¯åŠ¨ nginx æœåŠ¡ã€ è½¬å‘ç»™ systemd1ï¼‰ï¼› ç»´æŠ¤æœåŠ¡æ³¨å†Œè¡¨ï¼ˆè®°å½• org.freedesktop.login1 ä¸ logind è¿›ç¨‹çš„æ˜ å°„å…³ç³»ï¼‰ã€‚ æœåŠ¡ç«¯ï¼ˆServiceï¼‰ æä¾›åŠŸèƒ½çš„è¿›ç¨‹ï¼ˆå¦‚ systemd è¿›ç¨‹ã€logind è¿›ç¨‹ï¼‰ï¼Œæ ¸å¿ƒæ“ä½œï¼š å‘æ€»çº¿æ³¨å†Œ ã€ŒæœåŠ¡åã€ï¼ˆsystemd1 æ³¨å†Œ org.freedesktop.systemd1ï¼Œlogind1 æ³¨å†Œorg.freedesktop.login1ï¼Œå‡ä¸ºå”¯ä¸€æ ‡è¯†ï¼‰ï¼› æš´éœ² ã€Œå¯¹è±¡ã€ å’Œ ã€Œæ¥å£ã€ï¼ˆå¦‚ systemd1 æš´éœ² /org/freedesktop/systemd1 å¯¹è±¡ä¸org.freedesktop.systemd1.Manager æ¥å£ï¼‰ï¼Œä¾›å®¢æˆ·ç«¯è°ƒç”¨ã€‚ å®¢æˆ·ç«¯ï¼ˆClientï¼‰ è°ƒç”¨æœåŠ¡çš„è¿›ç¨‹ï¼ˆå¦‚ systemctl å‘½ä»¤ã€æ¡Œé¢ç”µæºèœå•ï¼‰ï¼Œæ ¸å¿ƒæ“ä½œï¼š è¿æ¥ç³»ç»Ÿæ€»çº¿åï¼Œé€šè¿‡æœåŠ¡åï¼ˆå¦‚ org.freedesktop.login1ï¼‰æ‰¾åˆ° logind æœåŠ¡ï¼› è°ƒç”¨æœåŠ¡ç«¯æš´éœ²çš„æ–¹æ³•ï¼ˆå¦‚é€šè¿‡ logind1 çš„ ListSessions æŸ¥è¯¢å½“å‰ç”¨æˆ·ä¼šè¯ï¼‰ï¼Œæˆ–è®¢é˜…ä¿¡å·ï¼ˆå¦‚ç›‘å¬ systemd1 çš„ UnitActiveChanged å•å…ƒçŠ¶æ€å˜åŒ–ï¼‰ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:5:4","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#44-d-bus-çš„ä¸‰ç±»è§’è‰²"},{"categories":["tech"],"content":" 4.5 å¸¸è§æ“ä½œç¤ºä¾‹ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸€äº›å‘½ä»¤æ¥æ¼”ç¤º D-Bus æ€»çº¿çš„ç”¨é€”ï¼š bash # æ¨¡æ‹Ÿ `systemctl status dbus` çš„åŠŸèƒ½ busctl --system --json=pretty call \\ org.freedesktop.systemd1 \\ /org/freedesktop/systemd1/unit/dbus_2eservice \\ org.freedesktop.DBus.Properties GetAll s org.freedesktop.systemd1.Unit # æ¨¡æ‹Ÿ `systemctl stop sshd` sudo gdbus call --system \\ --dest org.freedesktop.systemd1 \\ --object-path /org/freedesktop/systemd1 \\ --method org.freedesktop.systemd1.Manager.StopUnit \\ \"sshd.service\" \"replace\" # æ¨¡æ‹Ÿ `systemctl start sshd` sudo gdbus call --system \\ --dest org.freedesktop.systemd1 \\ --object-path /org/freedesktop/systemd1 \\ --method org.freedesktop.systemd1.Manager.StartUnit \\ \"sshd.service\" \"replace\" # æ¨¡æ‹Ÿ `notify-send \"The Summary\" \"Hereâ€™s the body of the notification\"` nix shell nixpkgs#glib gdbus call --session \\ --dest org.freedesktop.Notifications \\ --object-path /org/freedesktop/Notifications \\ --method org.freedesktop.Notifications.Notify \\ my_app_name \\ 42 \\ gtk-dialog-info \\ \"The Summary\" \\ \"Hereâ€™s the body of the notification\" \\ [] \\ {} \\ 5000 # è·å–å½“å‰æ—¶åŒº busctl get-property org.freedesktop.timedate1 /org/freedesktop/timedate1 \\ org.freedesktop.timedate1 Timezone # æŸ¥è¯¢ä¸»æœºå busctl get-property org.freedesktop.hostname1 /org/freedesktop/hostname1 \\ org.freedesktop.hostname1 Hostname ","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:5:5","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#45-å¸¸è§æ“ä½œç¤ºä¾‹"},{"categories":["tech"],"content":" 4.6 è°ƒè¯•ä¸ç›‘æ§å‘½ä»¤ bash # çœ‹ systemctl ä¸ systemd çš„å®Œæ•´äº¤äº’ï¼ˆmethod-call + signalï¼‰ sudo busctl monitor --system | grep 'org.freedesktop.systemd1' # æˆ–è€…ä½¿ç”¨ --match è¿‡æ»¤ï¼Œä½†è¿™éœ€è¦æå‰çŸ¥é“ interface çš„å…¨å sudo busctl monitor --match='interface=org.freedesktop.systemd1.Manager' # è·Ÿ busctl monitor åŠŸèƒ½å‡ ä¹å®Œå…¨ä¸€è‡´ï¼Œä¹Ÿå¯é€šè¿‡ match rule è¿‡æ»¤ sudo dbus-monitor --system \"interface='org.freedesktop.systemd1.Manager'\" # gdbus åªç›‘å¬ signalsï¼Œåªèƒ½ç”¨æ¥è°ƒè¯•ã€ŒæœåŠ¡æœ‰æ²¡æœ‰æ­£ç¡®å‘å‡º signalã€ sudo gdbus monitor --system -d org.freedesktop.systemd1.Manager ","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:5:6","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#46-è°ƒè¯•ä¸ç›‘æ§å‘½ä»¤"},{"categories":["tech"],"content":" 4.7 D-Bus çš„æƒé™ç®¡æ§ 4.7.1 D-Bus çš„åŸç”Ÿæƒé™ç®¡æ§æœºåˆ¶D-Bus æœ¬èº«å…·å¤‡å¤šå±‚æƒé™ç®¡æ§èƒ½åŠ›ï¼Œä»æ€»çº¿æ¥å…¥ã€æ¶ˆæ¯è·¯ç”±åˆ°æ•æ„Ÿæ“ä½œæˆæƒï¼Œå½¢æˆäº†ç³»ç»Ÿçº§çš„åŸºç¡€å®‰å…¨ä¿éšœï¼Œæ ¸å¿ƒæœºåˆ¶åŒ…æ‹¬ï¼š æ€»çº¿é…ç½®æ–‡ä»¶ï¼ˆé™æ€è§„åˆ™ç®¡æ§ï¼‰ é€šè¿‡ XML é…ç½®æ–‡ä»¶å®šä¹‰ç»†ç²’åº¦è®¿é—®è§„åˆ™ï¼Œå®ç°å¯¹ ã€Œè°èƒ½è®¿é—®å“ªäº›æœåŠ¡ / æ–¹æ³•ã€ çš„é™æ€é™åˆ¶ã€‚ä¾‹å¦‚ï¼š ç³»ç»Ÿæ€»çº¿çš„æœåŠ¡çº§è§„åˆ™ï¼ˆå¦‚ /etc/dbus-1/system.d/org.freedesktop.login1.confï¼‰å¯é™åˆ¶æ™®é€šç”¨æˆ·è°ƒç”¨ org.freedesktop.login1.Manager.PowerOffï¼ˆå…³æœºæ–¹æ³•ï¼‰ï¼› å…¨å±€è§„åˆ™ï¼ˆå¦‚ /etc/dbus-1/system.confï¼‰å¯é™å®šä»… root æˆ– dbus ç»„ç”¨æˆ·è®¿é—®org.freedesktop.systemd1ï¼ˆsystemd æœåŠ¡ï¼‰çš„æ ¸å¿ƒæ¥å£ã€‚ è§„åˆ™éµå¾ª ã€Œdeny ä¼˜å…ˆçº§é«˜äº allowã€æœåŠ¡çº§è§„åˆ™é«˜äºå…¨å±€è§„åˆ™ã€ çš„é€»è¾‘ï¼Œä»æ€»çº¿å±‚é¢ç›´æ¥æ‹¦æˆªæœªæˆæƒè¯·æ±‚ã€‚ PolicyKitï¼ˆåŠ¨æ€æˆæƒç®¡æ§ï¼‰ é’ˆå¯¹é™æ€è§„åˆ™æ— æ³•è¦†ç›–çš„åŠ¨æ€åœºæ™¯ï¼ˆå¦‚æ™®é€šç”¨æˆ·ä¸´æ—¶éœ€è¦æ‰§è¡Œæ•æ„Ÿæ“ä½œï¼‰ï¼ŒD-Bus é›†æˆ PolicyKitï¼ˆç°ç§° polkitï¼‰å®ç°åŠ¨æ€æˆæƒã€‚ç³»ç»ŸæœåŠ¡ï¼ˆå¦‚ logind1ã€systemd1ï¼‰ä¼šåœ¨/run/current-system/sw/share/polkit-1/actions/ï¼ˆNixOS ä¸­ï¼‰æˆ–/run/current-system/sw/share/polkit-1/actions/ï¼ˆNixOSï¼‰æˆ–/usr/share/polkit-1/actions/ï¼ˆä¼ ç»Ÿå‘è¡Œç‰ˆä¸­ï¼‰å®šä¹‰ â€œå¯æˆæƒåŠ¨ä½œâ€ï¼Œä¾‹å¦‚org.freedesktop.login1.power-offï¼ˆå¯¹åº” logind1 çš„å…³æœºæ–¹æ³•ï¼‰ï¼š æ™®é€šç”¨æˆ·è°ƒç”¨æ—¶ï¼Œä¼šè§¦å‘è®¤è¯æµç¨‹ï¼ˆå¦‚è¾“å…¥ç®¡ç†å‘˜å¯†ç ï¼‰ï¼Œè®¤è¯é€šè¿‡åä¸´æ—¶è·å¾—æˆæƒï¼› æ´»è·ƒæ§åˆ¶å°ç”¨æˆ·å¯ç›´æ¥æˆæƒï¼Œæ— éœ€é¢å¤–éªŒè¯ï¼Œå…¼é¡¾å®‰å…¨æ€§ä¸æ˜“ç”¨æ€§ã€‚ è¿æ¥å±‚åŸºç¡€éš”ç¦» D-Bus æ€»çº¿å¥—æ¥å­—ï¼ˆå¦‚ç³»ç»Ÿæ€»çº¿ /var/run/dbus/system_bus_socketï¼‰é»˜è®¤ä»…å¼€æ”¾ root å’Œdbus ç»„ç”¨æˆ·çš„è¯»å†™æƒé™ï¼Œæ™®é€šè¿›ç¨‹éœ€é€šè¿‡ dbus-daemon è®¤è¯åæ‰èƒ½å»ºç«‹è¿æ¥ã€‚åŒæ—¶ï¼Œæ¯ä¸ªè¿æ¥ä¼šè¢«åˆ†é…å”¯ä¸€ IDï¼ˆå¦‚ :1.42ï¼‰ï¼Œå¹¶ä¸è¿›ç¨‹çš„ PID/UID/GID ç»‘å®šï¼Œé˜²æ­¢èº«ä»½ä¼ªé€ ä¸æœªæˆæƒæ¥å…¥ã€‚ 4.7.2 Flatpak å¯¹ D-Bus æƒé™çš„ç»†ç²’åº¦ç®¡æ§åœ¨ç°ä»£ Linux æ¡Œé¢ä¸­ï¼Œè‹¥éœ€å°†å•†ä¸šè½¯ä»¶ç­‰éä¿¡ä»»åº”ç”¨è¿è¡Œåœ¨æ²™ç®±ä¸­ï¼ŒåŒæ—¶ä¿éšœ ã€Œå¿…è¦ D-Bus äº¤äº’ä¸ä¸­æ–­ã€è¶Šæƒè®¿é—®è¢«é˜»æ–­ã€ï¼ŒFlatpak é‡‡ç”¨ ã€Œåº•å±‚æ²™ç®±éš”ç¦» + ä¸Šå±‚ä»£ç†è¿‡æ»¤ã€ çš„åŒå±‚æ–¹æ¡ˆ â€”â€” å…¶ä¸­ bubblewrap æ˜¯ Flatpak ä¾èµ–çš„åº•å±‚æ²™ç®±å·¥å…·ï¼Œè´Ÿè´£ç¯å¢ƒéš”ç¦»ï¼›xdg-dbus-proxy æ˜¯ä¸Šå±‚è¿‡æ»¤ç»„ä»¶ï¼Œè´Ÿè´£ D-Bus ç»†ç²’åº¦ç®¡æ§ï¼Œä¸¤è€…ååŒå®ç°å®Œæ•´å®‰å…¨éš”ç¦»ï¼š 4.7.2.1 åº•å±‚åŸºç¡€éš”ç¦»ï¼šbubblewrap çš„ â€œsocket éšè—ä¸ä»£ç†æŒ‚è½½â€Flatpak ä»¥ bubblewrapï¼ˆç®€ç§° bwrapï¼‰ä¸ºåº•å±‚æ²™ç®±åŸºç¡€ï¼Œåˆ©ç”¨å…¶ bind mount å’Œuser namespace èƒ½åŠ›å®Œæˆç¯å¢ƒåˆå§‹åŒ–ï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯åˆ‡æ–­æ²™ç®±åº”ç”¨ä¸å®¿ä¸» D-Bus æ€»çº¿çš„ç›´æ¥è”ç³»ï¼š éšè—å®¿ä¸» socketï¼šbubblewrap ä¼šå±è”½å®¿ä¸»çš„ D-Bus æ€»çº¿å¥—æ¥å­—ï¼ˆå¦‚ä¸å°†/var/run/dbus/system_bus_socket æŒ‚è½½è¿›æ²™ç®±ï¼‰ï¼Œé¿å…åº”ç”¨ç»•è¿‡ç®¡æ§ç›´æ¥è®¿é—®å®¿ä¸»æ€»çº¿ï¼› æŒ‚è½½ä»£ç† socketï¼šåŒæ—¶ï¼Œbubblewrap ä¼šå°† xdg-dbus-proxy åœ¨å®¿ä¸»ä¾§é¢„å…ˆåˆ›å»ºçš„ ç§æœ‰ä»£ç† socketï¼Œé€šè¿‡ bind mount æŒ‚è½½åˆ°æ²™ç®±å†…çš„é»˜è®¤ D-Bus socket è·¯å¾„ï¼ˆå¦‚æ²™ç®±å†…çš„/var/run/dbus/system_bus_socketï¼‰ã€‚ æ­¤æ—¶æ²™ç®±åº”ç”¨æ„ŸçŸ¥åˆ°çš„ ã€ŒD-Bus æ€»çº¿ã€ï¼Œå®é™…æ˜¯ xdg-dbus-proxy æä¾›çš„ä»£ç†æ¥å£ï¼Œæ— æ³•ç›´æ¥æ¥è§¦å®¿ä¸»çœŸå®æ€»çº¿ã€‚ 4.7.2.2 ä¸Šå±‚è§„åˆ™è¿‡æ»¤ï¼šxdg-dbus-proxy çš„ â€œç™½åå•æ ¡éªŒâ€xdg-dbus-proxy ä½œä¸º Flatpak å†…ç½®çš„ D-Bus ä»£ç†ç»„ä»¶ï¼Œä¼šéšæ²™ç®±åº”ç”¨å¯åŠ¨ï¼ŒåŠ è½½ Flatpak æ ¹æ®åº”ç”¨æƒé™å£°æ˜è‡ªåŠ¨ç”Ÿæˆçš„è¿‡æ»¤è§„åˆ™ï¼ˆç²’åº¦è¿œç»†äº D-Bus åŸç”Ÿé™æ€é…ç½®ï¼‰ï¼Œä¾‹å¦‚ï¼š bash --see=NAME Set 'see' policy for NAME --talk=NAME Set 'talk' policy for NAME --own=NAME Set 'own' policy for NAME --call=NAME=RULE Set RULE for calls on NAME --broadcast=NAME=RULE Set RULE for broadcasts from NAME TODO è¿™äº›è§„åˆ™å¯ç²¾ç¡®åˆ° ã€ŒæœåŠ¡å + æ¥å£ + æ–¹æ³• + å¯¹è±¡è·¯å¾„ã€ï¼Œå¼¥è¡¥ D-Bus åŸç”Ÿé…ç½®åœ¨æ²™ç®±åœºæ™¯ä¸‹ ã€ŒåŠ¨æ€æ€§ä¸è¶³ã€ç²’åº¦è¾ƒç²—ã€ çš„å±€é™ã€‚ 4.7.2.3 æ¶ˆæ¯æµè½¬ï¼šä»£ç†çš„ â€œæ ¡éªŒ - è½¬å‘â€ é€»è¾‘æ²™ç®±åº”ç”¨æ— éœ€ä¿®æ”¹ä»£ç ï¼Œä¼šé»˜è®¤è¿æ¥æ²™ç®±å†…çš„ ã€Œä»£ç† socketã€ï¼Œæ‰€æœ‰ D-Bus æ¶ˆæ¯ï¼ˆæ–¹æ³•è°ƒç”¨ã€ä¿¡å·è®¢é˜…ï¼‰å‡éœ€ç»è¿‡ xdg-dbus-proxy çš„æ ¡éªŒï¼š è‹¥ç›®æ ‡æœåŠ¡ / æ–¹æ³•åœ¨ç™½åå•å†…ï¼ˆå¦‚ org.freedesktop.portal.FileChooser.OpenFileï¼‰ï¼Œä»£ç†ä¼šå°†æ¶ˆæ¯è½¬å‘è‡³å®¿ä¸» D-Bus æ€»çº¿ï¼Œå¹¶æŠŠè¿”å›ç»“æœå›ä¼ åº”ç”¨ï¼› è‹¥ç›®æ ‡ä¸åœ¨ç™½åå•å†…ï¼ˆå¦‚ org.freedesktop.login1.Manager.PowerOffï¼‰ï¼Œä»£ç†ç›´æ¥è¿”å›AccessDenied é”™è¯¯ï¼Œä¸å‘å®¿ä¸»æ€»çº¿è½¬å‘ä»»ä½•æ¶ˆæ¯ï¼Œå½»åº•é˜»æ–­è¶Šæƒè®¿é—®ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:5:7","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#47-d-bus-çš„æƒé™ç®¡æ§"},{"categories":["tech"],"content":" 4.7 D-Bus çš„æƒé™ç®¡æ§ 4.7.1 D-Bus çš„åŸç”Ÿæƒé™ç®¡æ§æœºåˆ¶D-Bus æœ¬èº«å…·å¤‡å¤šå±‚æƒé™ç®¡æ§èƒ½åŠ›ï¼Œä»æ€»çº¿æ¥å…¥ã€æ¶ˆæ¯è·¯ç”±åˆ°æ•æ„Ÿæ“ä½œæˆæƒï¼Œå½¢æˆäº†ç³»ç»Ÿçº§çš„åŸºç¡€å®‰å…¨ä¿éšœï¼Œæ ¸å¿ƒæœºåˆ¶åŒ…æ‹¬ï¼š æ€»çº¿é…ç½®æ–‡ä»¶ï¼ˆé™æ€è§„åˆ™ç®¡æ§ï¼‰ é€šè¿‡ XML é…ç½®æ–‡ä»¶å®šä¹‰ç»†ç²’åº¦è®¿é—®è§„åˆ™ï¼Œå®ç°å¯¹ ã€Œè°èƒ½è®¿é—®å“ªäº›æœåŠ¡ / æ–¹æ³•ã€ çš„é™æ€é™åˆ¶ã€‚ä¾‹å¦‚ï¼š ç³»ç»Ÿæ€»çº¿çš„æœåŠ¡çº§è§„åˆ™ï¼ˆå¦‚ /etc/dbus-1/system.d/org.freedesktop.login1.confï¼‰å¯é™åˆ¶æ™®é€šç”¨æˆ·è°ƒç”¨ org.freedesktop.login1.Manager.PowerOffï¼ˆå…³æœºæ–¹æ³•ï¼‰ï¼› å…¨å±€è§„åˆ™ï¼ˆå¦‚ /etc/dbus-1/system.confï¼‰å¯é™å®šä»… root æˆ– dbus ç»„ç”¨æˆ·è®¿é—®org.freedesktop.systemd1ï¼ˆsystemd æœåŠ¡ï¼‰çš„æ ¸å¿ƒæ¥å£ã€‚ è§„åˆ™éµå¾ª ã€Œdeny ä¼˜å…ˆçº§é«˜äº allowã€æœåŠ¡çº§è§„åˆ™é«˜äºå…¨å±€è§„åˆ™ã€ çš„é€»è¾‘ï¼Œä»æ€»çº¿å±‚é¢ç›´æ¥æ‹¦æˆªæœªæˆæƒè¯·æ±‚ã€‚ PolicyKitï¼ˆåŠ¨æ€æˆæƒç®¡æ§ï¼‰ é’ˆå¯¹é™æ€è§„åˆ™æ— æ³•è¦†ç›–çš„åŠ¨æ€åœºæ™¯ï¼ˆå¦‚æ™®é€šç”¨æˆ·ä¸´æ—¶éœ€è¦æ‰§è¡Œæ•æ„Ÿæ“ä½œï¼‰ï¼ŒD-Bus é›†æˆ PolicyKitï¼ˆç°ç§° polkitï¼‰å®ç°åŠ¨æ€æˆæƒã€‚ç³»ç»ŸæœåŠ¡ï¼ˆå¦‚ logind1ã€systemd1ï¼‰ä¼šåœ¨/run/current-system/sw/share/polkit-1/actions/ï¼ˆNixOS ä¸­ï¼‰æˆ–/run/current-system/sw/share/polkit-1/actions/ï¼ˆNixOSï¼‰æˆ–/usr/share/polkit-1/actions/ï¼ˆä¼ ç»Ÿå‘è¡Œç‰ˆä¸­ï¼‰å®šä¹‰ â€œå¯æˆæƒåŠ¨ä½œâ€ï¼Œä¾‹å¦‚org.freedesktop.login1.power-offï¼ˆå¯¹åº” logind1 çš„å…³æœºæ–¹æ³•ï¼‰ï¼š æ™®é€šç”¨æˆ·è°ƒç”¨æ—¶ï¼Œä¼šè§¦å‘è®¤è¯æµç¨‹ï¼ˆå¦‚è¾“å…¥ç®¡ç†å‘˜å¯†ç ï¼‰ï¼Œè®¤è¯é€šè¿‡åä¸´æ—¶è·å¾—æˆæƒï¼› æ´»è·ƒæ§åˆ¶å°ç”¨æˆ·å¯ç›´æ¥æˆæƒï¼Œæ— éœ€é¢å¤–éªŒè¯ï¼Œå…¼é¡¾å®‰å…¨æ€§ä¸æ˜“ç”¨æ€§ã€‚ è¿æ¥å±‚åŸºç¡€éš”ç¦» D-Bus æ€»çº¿å¥—æ¥å­—ï¼ˆå¦‚ç³»ç»Ÿæ€»çº¿ /var/run/dbus/system_bus_socketï¼‰é»˜è®¤ä»…å¼€æ”¾ root å’Œdbus ç»„ç”¨æˆ·çš„è¯»å†™æƒé™ï¼Œæ™®é€šè¿›ç¨‹éœ€é€šè¿‡ dbus-daemon è®¤è¯åæ‰èƒ½å»ºç«‹è¿æ¥ã€‚åŒæ—¶ï¼Œæ¯ä¸ªè¿æ¥ä¼šè¢«åˆ†é…å”¯ä¸€ IDï¼ˆå¦‚ :1.42ï¼‰ï¼Œå¹¶ä¸è¿›ç¨‹çš„ PID/UID/GID ç»‘å®šï¼Œé˜²æ­¢èº«ä»½ä¼ªé€ ä¸æœªæˆæƒæ¥å…¥ã€‚ 4.7.2 Flatpak å¯¹ D-Bus æƒé™çš„ç»†ç²’åº¦ç®¡æ§åœ¨ç°ä»£ Linux æ¡Œé¢ä¸­ï¼Œè‹¥éœ€å°†å•†ä¸šè½¯ä»¶ç­‰éä¿¡ä»»åº”ç”¨è¿è¡Œåœ¨æ²™ç®±ä¸­ï¼ŒåŒæ—¶ä¿éšœ ã€Œå¿…è¦ D-Bus äº¤äº’ä¸ä¸­æ–­ã€è¶Šæƒè®¿é—®è¢«é˜»æ–­ã€ï¼ŒFlatpak é‡‡ç”¨ ã€Œåº•å±‚æ²™ç®±éš”ç¦» + ä¸Šå±‚ä»£ç†è¿‡æ»¤ã€ çš„åŒå±‚æ–¹æ¡ˆ â€”â€” å…¶ä¸­ bubblewrap æ˜¯ Flatpak ä¾èµ–çš„åº•å±‚æ²™ç®±å·¥å…·ï¼Œè´Ÿè´£ç¯å¢ƒéš”ç¦»ï¼›xdg-dbus-proxy æ˜¯ä¸Šå±‚è¿‡æ»¤ç»„ä»¶ï¼Œè´Ÿè´£ D-Bus ç»†ç²’åº¦ç®¡æ§ï¼Œä¸¤è€…ååŒå®ç°å®Œæ•´å®‰å…¨éš”ç¦»ï¼š 4.7.2.1 åº•å±‚åŸºç¡€éš”ç¦»ï¼šbubblewrap çš„ â€œsocket éšè—ä¸ä»£ç†æŒ‚è½½â€Flatpak ä»¥ bubblewrapï¼ˆç®€ç§° bwrapï¼‰ä¸ºåº•å±‚æ²™ç®±åŸºç¡€ï¼Œåˆ©ç”¨å…¶ bind mount å’Œuser namespace èƒ½åŠ›å®Œæˆç¯å¢ƒåˆå§‹åŒ–ï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯åˆ‡æ–­æ²™ç®±åº”ç”¨ä¸å®¿ä¸» D-Bus æ€»çº¿çš„ç›´æ¥è”ç³»ï¼š éšè—å®¿ä¸» socketï¼šbubblewrap ä¼šå±è”½å®¿ä¸»çš„ D-Bus æ€»çº¿å¥—æ¥å­—ï¼ˆå¦‚ä¸å°†/var/run/dbus/system_bus_socket æŒ‚è½½è¿›æ²™ç®±ï¼‰ï¼Œé¿å…åº”ç”¨ç»•è¿‡ç®¡æ§ç›´æ¥è®¿é—®å®¿ä¸»æ€»çº¿ï¼› æŒ‚è½½ä»£ç† socketï¼šåŒæ—¶ï¼Œbubblewrap ä¼šå°† xdg-dbus-proxy åœ¨å®¿ä¸»ä¾§é¢„å…ˆåˆ›å»ºçš„ ç§æœ‰ä»£ç† socketï¼Œé€šè¿‡ bind mount æŒ‚è½½åˆ°æ²™ç®±å†…çš„é»˜è®¤ D-Bus socket è·¯å¾„ï¼ˆå¦‚æ²™ç®±å†…çš„/var/run/dbus/system_bus_socketï¼‰ã€‚ æ­¤æ—¶æ²™ç®±åº”ç”¨æ„ŸçŸ¥åˆ°çš„ ã€ŒD-Bus æ€»çº¿ã€ï¼Œå®é™…æ˜¯ xdg-dbus-proxy æä¾›çš„ä»£ç†æ¥å£ï¼Œæ— æ³•ç›´æ¥æ¥è§¦å®¿ä¸»çœŸå®æ€»çº¿ã€‚ 4.7.2.2 ä¸Šå±‚è§„åˆ™è¿‡æ»¤ï¼šxdg-dbus-proxy çš„ â€œç™½åå•æ ¡éªŒâ€xdg-dbus-proxy ä½œä¸º Flatpak å†…ç½®çš„ D-Bus ä»£ç†ç»„ä»¶ï¼Œä¼šéšæ²™ç®±åº”ç”¨å¯åŠ¨ï¼ŒåŠ è½½ Flatpak æ ¹æ®åº”ç”¨æƒé™å£°æ˜è‡ªåŠ¨ç”Ÿæˆçš„è¿‡æ»¤è§„åˆ™ï¼ˆç²’åº¦è¿œç»†äº D-Bus åŸç”Ÿé™æ€é…ç½®ï¼‰ï¼Œä¾‹å¦‚ï¼š bash --see=NAME Set 'see' policy for NAME --talk=NAME Set 'talk' policy for NAME --own=NAME Set 'own' policy for NAME --call=NAME=RULE Set RULE for calls on NAME --broadcast=NAME=RULE Set RULE for broadcasts from NAME TODO è¿™äº›è§„åˆ™å¯ç²¾ç¡®åˆ° ã€ŒæœåŠ¡å + æ¥å£ + æ–¹æ³• + å¯¹è±¡è·¯å¾„ã€ï¼Œå¼¥è¡¥ D-Bus åŸç”Ÿé…ç½®åœ¨æ²™ç®±åœºæ™¯ä¸‹ ã€ŒåŠ¨æ€æ€§ä¸è¶³ã€ç²’åº¦è¾ƒç²—ã€ çš„å±€é™ã€‚ 4.7.2.3 æ¶ˆæ¯æµè½¬ï¼šä»£ç†çš„ â€œæ ¡éªŒ - è½¬å‘â€ é€»è¾‘æ²™ç®±åº”ç”¨æ— éœ€ä¿®æ”¹ä»£ç ï¼Œä¼šé»˜è®¤è¿æ¥æ²™ç®±å†…çš„ ã€Œä»£ç† socketã€ï¼Œæ‰€æœ‰ D-Bus æ¶ˆæ¯ï¼ˆæ–¹æ³•è°ƒç”¨ã€ä¿¡å·è®¢é˜…ï¼‰å‡éœ€ç»è¿‡ xdg-dbus-proxy çš„æ ¡éªŒï¼š è‹¥ç›®æ ‡æœåŠ¡ / æ–¹æ³•åœ¨ç™½åå•å†…ï¼ˆå¦‚ org.freedesktop.portal.FileChooser.OpenFileï¼‰ï¼Œä»£ç†ä¼šå°†æ¶ˆæ¯è½¬å‘è‡³å®¿ä¸» D-Bus æ€»çº¿ï¼Œå¹¶æŠŠè¿”å›ç»“æœå›ä¼ åº”ç”¨ï¼› è‹¥ç›®æ ‡ä¸åœ¨ç™½åå•å†…ï¼ˆå¦‚ org.freedesktop.login1.Manager.PowerOffï¼‰ï¼Œä»£ç†ç›´æ¥è¿”å›AccessDenied é”™è¯¯ï¼Œä¸å‘å®¿ä¸»æ€»çº¿è½¬å‘ä»»ä½•æ¶ˆæ¯ï¼Œå½»åº•é˜»æ–­è¶Šæƒè®¿é—®ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:5:7","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#471-d-bus-çš„åŸç”Ÿæƒé™ç®¡æ§æœºåˆ¶"},{"categories":["tech"],"content":" 4.7 D-Bus çš„æƒé™ç®¡æ§ 4.7.1 D-Bus çš„åŸç”Ÿæƒé™ç®¡æ§æœºåˆ¶D-Bus æœ¬èº«å…·å¤‡å¤šå±‚æƒé™ç®¡æ§èƒ½åŠ›ï¼Œä»æ€»çº¿æ¥å…¥ã€æ¶ˆæ¯è·¯ç”±åˆ°æ•æ„Ÿæ“ä½œæˆæƒï¼Œå½¢æˆäº†ç³»ç»Ÿçº§çš„åŸºç¡€å®‰å…¨ä¿éšœï¼Œæ ¸å¿ƒæœºåˆ¶åŒ…æ‹¬ï¼š æ€»çº¿é…ç½®æ–‡ä»¶ï¼ˆé™æ€è§„åˆ™ç®¡æ§ï¼‰ é€šè¿‡ XML é…ç½®æ–‡ä»¶å®šä¹‰ç»†ç²’åº¦è®¿é—®è§„åˆ™ï¼Œå®ç°å¯¹ ã€Œè°èƒ½è®¿é—®å“ªäº›æœåŠ¡ / æ–¹æ³•ã€ çš„é™æ€é™åˆ¶ã€‚ä¾‹å¦‚ï¼š ç³»ç»Ÿæ€»çº¿çš„æœåŠ¡çº§è§„åˆ™ï¼ˆå¦‚ /etc/dbus-1/system.d/org.freedesktop.login1.confï¼‰å¯é™åˆ¶æ™®é€šç”¨æˆ·è°ƒç”¨ org.freedesktop.login1.Manager.PowerOffï¼ˆå…³æœºæ–¹æ³•ï¼‰ï¼› å…¨å±€è§„åˆ™ï¼ˆå¦‚ /etc/dbus-1/system.confï¼‰å¯é™å®šä»… root æˆ– dbus ç»„ç”¨æˆ·è®¿é—®org.freedesktop.systemd1ï¼ˆsystemd æœåŠ¡ï¼‰çš„æ ¸å¿ƒæ¥å£ã€‚ è§„åˆ™éµå¾ª ã€Œdeny ä¼˜å…ˆçº§é«˜äº allowã€æœåŠ¡çº§è§„åˆ™é«˜äºå…¨å±€è§„åˆ™ã€ çš„é€»è¾‘ï¼Œä»æ€»çº¿å±‚é¢ç›´æ¥æ‹¦æˆªæœªæˆæƒè¯·æ±‚ã€‚ PolicyKitï¼ˆåŠ¨æ€æˆæƒç®¡æ§ï¼‰ é’ˆå¯¹é™æ€è§„åˆ™æ— æ³•è¦†ç›–çš„åŠ¨æ€åœºæ™¯ï¼ˆå¦‚æ™®é€šç”¨æˆ·ä¸´æ—¶éœ€è¦æ‰§è¡Œæ•æ„Ÿæ“ä½œï¼‰ï¼ŒD-Bus é›†æˆ PolicyKitï¼ˆç°ç§° polkitï¼‰å®ç°åŠ¨æ€æˆæƒã€‚ç³»ç»ŸæœåŠ¡ï¼ˆå¦‚ logind1ã€systemd1ï¼‰ä¼šåœ¨/run/current-system/sw/share/polkit-1/actions/ï¼ˆNixOS ä¸­ï¼‰æˆ–/run/current-system/sw/share/polkit-1/actions/ï¼ˆNixOSï¼‰æˆ–/usr/share/polkit-1/actions/ï¼ˆä¼ ç»Ÿå‘è¡Œç‰ˆä¸­ï¼‰å®šä¹‰ â€œå¯æˆæƒåŠ¨ä½œâ€ï¼Œä¾‹å¦‚org.freedesktop.login1.power-offï¼ˆå¯¹åº” logind1 çš„å…³æœºæ–¹æ³•ï¼‰ï¼š æ™®é€šç”¨æˆ·è°ƒç”¨æ—¶ï¼Œä¼šè§¦å‘è®¤è¯æµç¨‹ï¼ˆå¦‚è¾“å…¥ç®¡ç†å‘˜å¯†ç ï¼‰ï¼Œè®¤è¯é€šè¿‡åä¸´æ—¶è·å¾—æˆæƒï¼› æ´»è·ƒæ§åˆ¶å°ç”¨æˆ·å¯ç›´æ¥æˆæƒï¼Œæ— éœ€é¢å¤–éªŒè¯ï¼Œå…¼é¡¾å®‰å…¨æ€§ä¸æ˜“ç”¨æ€§ã€‚ è¿æ¥å±‚åŸºç¡€éš”ç¦» D-Bus æ€»çº¿å¥—æ¥å­—ï¼ˆå¦‚ç³»ç»Ÿæ€»çº¿ /var/run/dbus/system_bus_socketï¼‰é»˜è®¤ä»…å¼€æ”¾ root å’Œdbus ç»„ç”¨æˆ·çš„è¯»å†™æƒé™ï¼Œæ™®é€šè¿›ç¨‹éœ€é€šè¿‡ dbus-daemon è®¤è¯åæ‰èƒ½å»ºç«‹è¿æ¥ã€‚åŒæ—¶ï¼Œæ¯ä¸ªè¿æ¥ä¼šè¢«åˆ†é…å”¯ä¸€ IDï¼ˆå¦‚ :1.42ï¼‰ï¼Œå¹¶ä¸è¿›ç¨‹çš„ PID/UID/GID ç»‘å®šï¼Œé˜²æ­¢èº«ä»½ä¼ªé€ ä¸æœªæˆæƒæ¥å…¥ã€‚ 4.7.2 Flatpak å¯¹ D-Bus æƒé™çš„ç»†ç²’åº¦ç®¡æ§åœ¨ç°ä»£ Linux æ¡Œé¢ä¸­ï¼Œè‹¥éœ€å°†å•†ä¸šè½¯ä»¶ç­‰éä¿¡ä»»åº”ç”¨è¿è¡Œåœ¨æ²™ç®±ä¸­ï¼ŒåŒæ—¶ä¿éšœ ã€Œå¿…è¦ D-Bus äº¤äº’ä¸ä¸­æ–­ã€è¶Šæƒè®¿é—®è¢«é˜»æ–­ã€ï¼ŒFlatpak é‡‡ç”¨ ã€Œåº•å±‚æ²™ç®±éš”ç¦» + ä¸Šå±‚ä»£ç†è¿‡æ»¤ã€ çš„åŒå±‚æ–¹æ¡ˆ â€”â€” å…¶ä¸­ bubblewrap æ˜¯ Flatpak ä¾èµ–çš„åº•å±‚æ²™ç®±å·¥å…·ï¼Œè´Ÿè´£ç¯å¢ƒéš”ç¦»ï¼›xdg-dbus-proxy æ˜¯ä¸Šå±‚è¿‡æ»¤ç»„ä»¶ï¼Œè´Ÿè´£ D-Bus ç»†ç²’åº¦ç®¡æ§ï¼Œä¸¤è€…ååŒå®ç°å®Œæ•´å®‰å…¨éš”ç¦»ï¼š 4.7.2.1 åº•å±‚åŸºç¡€éš”ç¦»ï¼šbubblewrap çš„ â€œsocket éšè—ä¸ä»£ç†æŒ‚è½½â€Flatpak ä»¥ bubblewrapï¼ˆç®€ç§° bwrapï¼‰ä¸ºåº•å±‚æ²™ç®±åŸºç¡€ï¼Œåˆ©ç”¨å…¶ bind mount å’Œuser namespace èƒ½åŠ›å®Œæˆç¯å¢ƒåˆå§‹åŒ–ï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯åˆ‡æ–­æ²™ç®±åº”ç”¨ä¸å®¿ä¸» D-Bus æ€»çº¿çš„ç›´æ¥è”ç³»ï¼š éšè—å®¿ä¸» socketï¼šbubblewrap ä¼šå±è”½å®¿ä¸»çš„ D-Bus æ€»çº¿å¥—æ¥å­—ï¼ˆå¦‚ä¸å°†/var/run/dbus/system_bus_socket æŒ‚è½½è¿›æ²™ç®±ï¼‰ï¼Œé¿å…åº”ç”¨ç»•è¿‡ç®¡æ§ç›´æ¥è®¿é—®å®¿ä¸»æ€»çº¿ï¼› æŒ‚è½½ä»£ç† socketï¼šåŒæ—¶ï¼Œbubblewrap ä¼šå°† xdg-dbus-proxy åœ¨å®¿ä¸»ä¾§é¢„å…ˆåˆ›å»ºçš„ ç§æœ‰ä»£ç† socketï¼Œé€šè¿‡ bind mount æŒ‚è½½åˆ°æ²™ç®±å†…çš„é»˜è®¤ D-Bus socket è·¯å¾„ï¼ˆå¦‚æ²™ç®±å†…çš„/var/run/dbus/system_bus_socketï¼‰ã€‚ æ­¤æ—¶æ²™ç®±åº”ç”¨æ„ŸçŸ¥åˆ°çš„ ã€ŒD-Bus æ€»çº¿ã€ï¼Œå®é™…æ˜¯ xdg-dbus-proxy æä¾›çš„ä»£ç†æ¥å£ï¼Œæ— æ³•ç›´æ¥æ¥è§¦å®¿ä¸»çœŸå®æ€»çº¿ã€‚ 4.7.2.2 ä¸Šå±‚è§„åˆ™è¿‡æ»¤ï¼šxdg-dbus-proxy çš„ â€œç™½åå•æ ¡éªŒâ€xdg-dbus-proxy ä½œä¸º Flatpak å†…ç½®çš„ D-Bus ä»£ç†ç»„ä»¶ï¼Œä¼šéšæ²™ç®±åº”ç”¨å¯åŠ¨ï¼ŒåŠ è½½ Flatpak æ ¹æ®åº”ç”¨æƒé™å£°æ˜è‡ªåŠ¨ç”Ÿæˆçš„è¿‡æ»¤è§„åˆ™ï¼ˆç²’åº¦è¿œç»†äº D-Bus åŸç”Ÿé™æ€é…ç½®ï¼‰ï¼Œä¾‹å¦‚ï¼š bash --see=NAME Set 'see' policy for NAME --talk=NAME Set 'talk' policy for NAME --own=NAME Set 'own' policy for NAME --call=NAME=RULE Set RULE for calls on NAME --broadcast=NAME=RULE Set RULE for broadcasts from NAME TODO è¿™äº›è§„åˆ™å¯ç²¾ç¡®åˆ° ã€ŒæœåŠ¡å + æ¥å£ + æ–¹æ³• + å¯¹è±¡è·¯å¾„ã€ï¼Œå¼¥è¡¥ D-Bus åŸç”Ÿé…ç½®åœ¨æ²™ç®±åœºæ™¯ä¸‹ ã€ŒåŠ¨æ€æ€§ä¸è¶³ã€ç²’åº¦è¾ƒç²—ã€ çš„å±€é™ã€‚ 4.7.2.3 æ¶ˆæ¯æµè½¬ï¼šä»£ç†çš„ â€œæ ¡éªŒ - è½¬å‘â€ é€»è¾‘æ²™ç®±åº”ç”¨æ— éœ€ä¿®æ”¹ä»£ç ï¼Œä¼šé»˜è®¤è¿æ¥æ²™ç®±å†…çš„ ã€Œä»£ç† socketã€ï¼Œæ‰€æœ‰ D-Bus æ¶ˆæ¯ï¼ˆæ–¹æ³•è°ƒç”¨ã€ä¿¡å·è®¢é˜…ï¼‰å‡éœ€ç»è¿‡ xdg-dbus-proxy çš„æ ¡éªŒï¼š è‹¥ç›®æ ‡æœåŠ¡ / æ–¹æ³•åœ¨ç™½åå•å†…ï¼ˆå¦‚ org.freedesktop.portal.FileChooser.OpenFileï¼‰ï¼Œä»£ç†ä¼šå°†æ¶ˆæ¯è½¬å‘è‡³å®¿ä¸» D-Bus æ€»çº¿ï¼Œå¹¶æŠŠè¿”å›ç»“æœå›ä¼ åº”ç”¨ï¼› è‹¥ç›®æ ‡ä¸åœ¨ç™½åå•å†…ï¼ˆå¦‚ org.freedesktop.login1.Manager.PowerOffï¼‰ï¼Œä»£ç†ç›´æ¥è¿”å›AccessDenied é”™è¯¯ï¼Œä¸å‘å®¿ä¸»æ€»çº¿è½¬å‘ä»»ä½•æ¶ˆæ¯ï¼Œå½»åº•é˜»æ–­è¶Šæƒè®¿é—®ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:5:7","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#472-flatpak-å¯¹-d-bus-æƒé™çš„ç»†ç²’åº¦ç®¡æ§"},{"categories":["tech"],"content":" 4.7 D-Bus çš„æƒé™ç®¡æ§ 4.7.1 D-Bus çš„åŸç”Ÿæƒé™ç®¡æ§æœºåˆ¶D-Bus æœ¬èº«å…·å¤‡å¤šå±‚æƒé™ç®¡æ§èƒ½åŠ›ï¼Œä»æ€»çº¿æ¥å…¥ã€æ¶ˆæ¯è·¯ç”±åˆ°æ•æ„Ÿæ“ä½œæˆæƒï¼Œå½¢æˆäº†ç³»ç»Ÿçº§çš„åŸºç¡€å®‰å…¨ä¿éšœï¼Œæ ¸å¿ƒæœºåˆ¶åŒ…æ‹¬ï¼š æ€»çº¿é…ç½®æ–‡ä»¶ï¼ˆé™æ€è§„åˆ™ç®¡æ§ï¼‰ é€šè¿‡ XML é…ç½®æ–‡ä»¶å®šä¹‰ç»†ç²’åº¦è®¿é—®è§„åˆ™ï¼Œå®ç°å¯¹ ã€Œè°èƒ½è®¿é—®å“ªäº›æœåŠ¡ / æ–¹æ³•ã€ çš„é™æ€é™åˆ¶ã€‚ä¾‹å¦‚ï¼š ç³»ç»Ÿæ€»çº¿çš„æœåŠ¡çº§è§„åˆ™ï¼ˆå¦‚ /etc/dbus-1/system.d/org.freedesktop.login1.confï¼‰å¯é™åˆ¶æ™®é€šç”¨æˆ·è°ƒç”¨ org.freedesktop.login1.Manager.PowerOffï¼ˆå…³æœºæ–¹æ³•ï¼‰ï¼› å…¨å±€è§„åˆ™ï¼ˆå¦‚ /etc/dbus-1/system.confï¼‰å¯é™å®šä»… root æˆ– dbus ç»„ç”¨æˆ·è®¿é—®org.freedesktop.systemd1ï¼ˆsystemd æœåŠ¡ï¼‰çš„æ ¸å¿ƒæ¥å£ã€‚ è§„åˆ™éµå¾ª ã€Œdeny ä¼˜å…ˆçº§é«˜äº allowã€æœåŠ¡çº§è§„åˆ™é«˜äºå…¨å±€è§„åˆ™ã€ çš„é€»è¾‘ï¼Œä»æ€»çº¿å±‚é¢ç›´æ¥æ‹¦æˆªæœªæˆæƒè¯·æ±‚ã€‚ PolicyKitï¼ˆåŠ¨æ€æˆæƒç®¡æ§ï¼‰ é’ˆå¯¹é™æ€è§„åˆ™æ— æ³•è¦†ç›–çš„åŠ¨æ€åœºæ™¯ï¼ˆå¦‚æ™®é€šç”¨æˆ·ä¸´æ—¶éœ€è¦æ‰§è¡Œæ•æ„Ÿæ“ä½œï¼‰ï¼ŒD-Bus é›†æˆ PolicyKitï¼ˆç°ç§° polkitï¼‰å®ç°åŠ¨æ€æˆæƒã€‚ç³»ç»ŸæœåŠ¡ï¼ˆå¦‚ logind1ã€systemd1ï¼‰ä¼šåœ¨/run/current-system/sw/share/polkit-1/actions/ï¼ˆNixOS ä¸­ï¼‰æˆ–/run/current-system/sw/share/polkit-1/actions/ï¼ˆNixOSï¼‰æˆ–/usr/share/polkit-1/actions/ï¼ˆä¼ ç»Ÿå‘è¡Œç‰ˆä¸­ï¼‰å®šä¹‰ â€œå¯æˆæƒåŠ¨ä½œâ€ï¼Œä¾‹å¦‚org.freedesktop.login1.power-offï¼ˆå¯¹åº” logind1 çš„å…³æœºæ–¹æ³•ï¼‰ï¼š æ™®é€šç”¨æˆ·è°ƒç”¨æ—¶ï¼Œä¼šè§¦å‘è®¤è¯æµç¨‹ï¼ˆå¦‚è¾“å…¥ç®¡ç†å‘˜å¯†ç ï¼‰ï¼Œè®¤è¯é€šè¿‡åä¸´æ—¶è·å¾—æˆæƒï¼› æ´»è·ƒæ§åˆ¶å°ç”¨æˆ·å¯ç›´æ¥æˆæƒï¼Œæ— éœ€é¢å¤–éªŒè¯ï¼Œå…¼é¡¾å®‰å…¨æ€§ä¸æ˜“ç”¨æ€§ã€‚ è¿æ¥å±‚åŸºç¡€éš”ç¦» D-Bus æ€»çº¿å¥—æ¥å­—ï¼ˆå¦‚ç³»ç»Ÿæ€»çº¿ /var/run/dbus/system_bus_socketï¼‰é»˜è®¤ä»…å¼€æ”¾ root å’Œdbus ç»„ç”¨æˆ·çš„è¯»å†™æƒé™ï¼Œæ™®é€šè¿›ç¨‹éœ€é€šè¿‡ dbus-daemon è®¤è¯åæ‰èƒ½å»ºç«‹è¿æ¥ã€‚åŒæ—¶ï¼Œæ¯ä¸ªè¿æ¥ä¼šè¢«åˆ†é…å”¯ä¸€ IDï¼ˆå¦‚ :1.42ï¼‰ï¼Œå¹¶ä¸è¿›ç¨‹çš„ PID/UID/GID ç»‘å®šï¼Œé˜²æ­¢èº«ä»½ä¼ªé€ ä¸æœªæˆæƒæ¥å…¥ã€‚ 4.7.2 Flatpak å¯¹ D-Bus æƒé™çš„ç»†ç²’åº¦ç®¡æ§åœ¨ç°ä»£ Linux æ¡Œé¢ä¸­ï¼Œè‹¥éœ€å°†å•†ä¸šè½¯ä»¶ç­‰éä¿¡ä»»åº”ç”¨è¿è¡Œåœ¨æ²™ç®±ä¸­ï¼ŒåŒæ—¶ä¿éšœ ã€Œå¿…è¦ D-Bus äº¤äº’ä¸ä¸­æ–­ã€è¶Šæƒè®¿é—®è¢«é˜»æ–­ã€ï¼ŒFlatpak é‡‡ç”¨ ã€Œåº•å±‚æ²™ç®±éš”ç¦» + ä¸Šå±‚ä»£ç†è¿‡æ»¤ã€ çš„åŒå±‚æ–¹æ¡ˆ â€”â€” å…¶ä¸­ bubblewrap æ˜¯ Flatpak ä¾èµ–çš„åº•å±‚æ²™ç®±å·¥å…·ï¼Œè´Ÿè´£ç¯å¢ƒéš”ç¦»ï¼›xdg-dbus-proxy æ˜¯ä¸Šå±‚è¿‡æ»¤ç»„ä»¶ï¼Œè´Ÿè´£ D-Bus ç»†ç²’åº¦ç®¡æ§ï¼Œä¸¤è€…ååŒå®ç°å®Œæ•´å®‰å…¨éš”ç¦»ï¼š 4.7.2.1 åº•å±‚åŸºç¡€éš”ç¦»ï¼šbubblewrap çš„ â€œsocket éšè—ä¸ä»£ç†æŒ‚è½½â€Flatpak ä»¥ bubblewrapï¼ˆç®€ç§° bwrapï¼‰ä¸ºåº•å±‚æ²™ç®±åŸºç¡€ï¼Œåˆ©ç”¨å…¶ bind mount å’Œuser namespace èƒ½åŠ›å®Œæˆç¯å¢ƒåˆå§‹åŒ–ï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯åˆ‡æ–­æ²™ç®±åº”ç”¨ä¸å®¿ä¸» D-Bus æ€»çº¿çš„ç›´æ¥è”ç³»ï¼š éšè—å®¿ä¸» socketï¼šbubblewrap ä¼šå±è”½å®¿ä¸»çš„ D-Bus æ€»çº¿å¥—æ¥å­—ï¼ˆå¦‚ä¸å°†/var/run/dbus/system_bus_socket æŒ‚è½½è¿›æ²™ç®±ï¼‰ï¼Œé¿å…åº”ç”¨ç»•è¿‡ç®¡æ§ç›´æ¥è®¿é—®å®¿ä¸»æ€»çº¿ï¼› æŒ‚è½½ä»£ç† socketï¼šåŒæ—¶ï¼Œbubblewrap ä¼šå°† xdg-dbus-proxy åœ¨å®¿ä¸»ä¾§é¢„å…ˆåˆ›å»ºçš„ ç§æœ‰ä»£ç† socketï¼Œé€šè¿‡ bind mount æŒ‚è½½åˆ°æ²™ç®±å†…çš„é»˜è®¤ D-Bus socket è·¯å¾„ï¼ˆå¦‚æ²™ç®±å†…çš„/var/run/dbus/system_bus_socketï¼‰ã€‚ æ­¤æ—¶æ²™ç®±åº”ç”¨æ„ŸçŸ¥åˆ°çš„ ã€ŒD-Bus æ€»çº¿ã€ï¼Œå®é™…æ˜¯ xdg-dbus-proxy æä¾›çš„ä»£ç†æ¥å£ï¼Œæ— æ³•ç›´æ¥æ¥è§¦å®¿ä¸»çœŸå®æ€»çº¿ã€‚ 4.7.2.2 ä¸Šå±‚è§„åˆ™è¿‡æ»¤ï¼šxdg-dbus-proxy çš„ â€œç™½åå•æ ¡éªŒâ€xdg-dbus-proxy ä½œä¸º Flatpak å†…ç½®çš„ D-Bus ä»£ç†ç»„ä»¶ï¼Œä¼šéšæ²™ç®±åº”ç”¨å¯åŠ¨ï¼ŒåŠ è½½ Flatpak æ ¹æ®åº”ç”¨æƒé™å£°æ˜è‡ªåŠ¨ç”Ÿæˆçš„è¿‡æ»¤è§„åˆ™ï¼ˆç²’åº¦è¿œç»†äº D-Bus åŸç”Ÿé™æ€é…ç½®ï¼‰ï¼Œä¾‹å¦‚ï¼š bash --see=NAME Set 'see' policy for NAME --talk=NAME Set 'talk' policy for NAME --own=NAME Set 'own' policy for NAME --call=NAME=RULE Set RULE for calls on NAME --broadcast=NAME=RULE Set RULE for broadcasts from NAME TODO è¿™äº›è§„åˆ™å¯ç²¾ç¡®åˆ° ã€ŒæœåŠ¡å + æ¥å£ + æ–¹æ³• + å¯¹è±¡è·¯å¾„ã€ï¼Œå¼¥è¡¥ D-Bus åŸç”Ÿé…ç½®åœ¨æ²™ç®±åœºæ™¯ä¸‹ ã€ŒåŠ¨æ€æ€§ä¸è¶³ã€ç²’åº¦è¾ƒç²—ã€ çš„å±€é™ã€‚ 4.7.2.3 æ¶ˆæ¯æµè½¬ï¼šä»£ç†çš„ â€œæ ¡éªŒ - è½¬å‘â€ é€»è¾‘æ²™ç®±åº”ç”¨æ— éœ€ä¿®æ”¹ä»£ç ï¼Œä¼šé»˜è®¤è¿æ¥æ²™ç®±å†…çš„ ã€Œä»£ç† socketã€ï¼Œæ‰€æœ‰ D-Bus æ¶ˆæ¯ï¼ˆæ–¹æ³•è°ƒç”¨ã€ä¿¡å·è®¢é˜…ï¼‰å‡éœ€ç»è¿‡ xdg-dbus-proxy çš„æ ¡éªŒï¼š è‹¥ç›®æ ‡æœåŠ¡ / æ–¹æ³•åœ¨ç™½åå•å†…ï¼ˆå¦‚ org.freedesktop.portal.FileChooser.OpenFileï¼‰ï¼Œä»£ç†ä¼šå°†æ¶ˆæ¯è½¬å‘è‡³å®¿ä¸» D-Bus æ€»çº¿ï¼Œå¹¶æŠŠè¿”å›ç»“æœå›ä¼ åº”ç”¨ï¼› è‹¥ç›®æ ‡ä¸åœ¨ç™½åå•å†…ï¼ˆå¦‚ org.freedesktop.login1.Manager.PowerOffï¼‰ï¼Œä»£ç†ç›´æ¥è¿”å›AccessDenied é”™è¯¯ï¼Œä¸å‘å®¿ä¸»æ€»çº¿è½¬å‘ä»»ä½•æ¶ˆæ¯ï¼Œå½»åº•é˜»æ–­è¶Šæƒè®¿é—®ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:5:7","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#4721-åº•å±‚åŸºç¡€éš”ç¦»bubblewrap-çš„-socket-éšè—ä¸ä»£ç†æŒ‚è½½"},{"categories":["tech"],"content":" 4.7 D-Bus çš„æƒé™ç®¡æ§ 4.7.1 D-Bus çš„åŸç”Ÿæƒé™ç®¡æ§æœºåˆ¶D-Bus æœ¬èº«å…·å¤‡å¤šå±‚æƒé™ç®¡æ§èƒ½åŠ›ï¼Œä»æ€»çº¿æ¥å…¥ã€æ¶ˆæ¯è·¯ç”±åˆ°æ•æ„Ÿæ“ä½œæˆæƒï¼Œå½¢æˆäº†ç³»ç»Ÿçº§çš„åŸºç¡€å®‰å…¨ä¿éšœï¼Œæ ¸å¿ƒæœºåˆ¶åŒ…æ‹¬ï¼š æ€»çº¿é…ç½®æ–‡ä»¶ï¼ˆé™æ€è§„åˆ™ç®¡æ§ï¼‰ é€šè¿‡ XML é…ç½®æ–‡ä»¶å®šä¹‰ç»†ç²’åº¦è®¿é—®è§„åˆ™ï¼Œå®ç°å¯¹ ã€Œè°èƒ½è®¿é—®å“ªäº›æœåŠ¡ / æ–¹æ³•ã€ çš„é™æ€é™åˆ¶ã€‚ä¾‹å¦‚ï¼š ç³»ç»Ÿæ€»çº¿çš„æœåŠ¡çº§è§„åˆ™ï¼ˆå¦‚ /etc/dbus-1/system.d/org.freedesktop.login1.confï¼‰å¯é™åˆ¶æ™®é€šç”¨æˆ·è°ƒç”¨ org.freedesktop.login1.Manager.PowerOffï¼ˆå…³æœºæ–¹æ³•ï¼‰ï¼› å…¨å±€è§„åˆ™ï¼ˆå¦‚ /etc/dbus-1/system.confï¼‰å¯é™å®šä»… root æˆ– dbus ç»„ç”¨æˆ·è®¿é—®org.freedesktop.systemd1ï¼ˆsystemd æœåŠ¡ï¼‰çš„æ ¸å¿ƒæ¥å£ã€‚ è§„åˆ™éµå¾ª ã€Œdeny ä¼˜å…ˆçº§é«˜äº allowã€æœåŠ¡çº§è§„åˆ™é«˜äºå…¨å±€è§„åˆ™ã€ çš„é€»è¾‘ï¼Œä»æ€»çº¿å±‚é¢ç›´æ¥æ‹¦æˆªæœªæˆæƒè¯·æ±‚ã€‚ PolicyKitï¼ˆåŠ¨æ€æˆæƒç®¡æ§ï¼‰ é’ˆå¯¹é™æ€è§„åˆ™æ— æ³•è¦†ç›–çš„åŠ¨æ€åœºæ™¯ï¼ˆå¦‚æ™®é€šç”¨æˆ·ä¸´æ—¶éœ€è¦æ‰§è¡Œæ•æ„Ÿæ“ä½œï¼‰ï¼ŒD-Bus é›†æˆ PolicyKitï¼ˆç°ç§° polkitï¼‰å®ç°åŠ¨æ€æˆæƒã€‚ç³»ç»ŸæœåŠ¡ï¼ˆå¦‚ logind1ã€systemd1ï¼‰ä¼šåœ¨/run/current-system/sw/share/polkit-1/actions/ï¼ˆNixOS ä¸­ï¼‰æˆ–/run/current-system/sw/share/polkit-1/actions/ï¼ˆNixOSï¼‰æˆ–/usr/share/polkit-1/actions/ï¼ˆä¼ ç»Ÿå‘è¡Œç‰ˆä¸­ï¼‰å®šä¹‰ â€œå¯æˆæƒåŠ¨ä½œâ€ï¼Œä¾‹å¦‚org.freedesktop.login1.power-offï¼ˆå¯¹åº” logind1 çš„å…³æœºæ–¹æ³•ï¼‰ï¼š æ™®é€šç”¨æˆ·è°ƒç”¨æ—¶ï¼Œä¼šè§¦å‘è®¤è¯æµç¨‹ï¼ˆå¦‚è¾“å…¥ç®¡ç†å‘˜å¯†ç ï¼‰ï¼Œè®¤è¯é€šè¿‡åä¸´æ—¶è·å¾—æˆæƒï¼› æ´»è·ƒæ§åˆ¶å°ç”¨æˆ·å¯ç›´æ¥æˆæƒï¼Œæ— éœ€é¢å¤–éªŒè¯ï¼Œå…¼é¡¾å®‰å…¨æ€§ä¸æ˜“ç”¨æ€§ã€‚ è¿æ¥å±‚åŸºç¡€éš”ç¦» D-Bus æ€»çº¿å¥—æ¥å­—ï¼ˆå¦‚ç³»ç»Ÿæ€»çº¿ /var/run/dbus/system_bus_socketï¼‰é»˜è®¤ä»…å¼€æ”¾ root å’Œdbus ç»„ç”¨æˆ·çš„è¯»å†™æƒé™ï¼Œæ™®é€šè¿›ç¨‹éœ€é€šè¿‡ dbus-daemon è®¤è¯åæ‰èƒ½å»ºç«‹è¿æ¥ã€‚åŒæ—¶ï¼Œæ¯ä¸ªè¿æ¥ä¼šè¢«åˆ†é…å”¯ä¸€ IDï¼ˆå¦‚ :1.42ï¼‰ï¼Œå¹¶ä¸è¿›ç¨‹çš„ PID/UID/GID ç»‘å®šï¼Œé˜²æ­¢èº«ä»½ä¼ªé€ ä¸æœªæˆæƒæ¥å…¥ã€‚ 4.7.2 Flatpak å¯¹ D-Bus æƒé™çš„ç»†ç²’åº¦ç®¡æ§åœ¨ç°ä»£ Linux æ¡Œé¢ä¸­ï¼Œè‹¥éœ€å°†å•†ä¸šè½¯ä»¶ç­‰éä¿¡ä»»åº”ç”¨è¿è¡Œåœ¨æ²™ç®±ä¸­ï¼ŒåŒæ—¶ä¿éšœ ã€Œå¿…è¦ D-Bus äº¤äº’ä¸ä¸­æ–­ã€è¶Šæƒè®¿é—®è¢«é˜»æ–­ã€ï¼ŒFlatpak é‡‡ç”¨ ã€Œåº•å±‚æ²™ç®±éš”ç¦» + ä¸Šå±‚ä»£ç†è¿‡æ»¤ã€ çš„åŒå±‚æ–¹æ¡ˆ â€”â€” å…¶ä¸­ bubblewrap æ˜¯ Flatpak ä¾èµ–çš„åº•å±‚æ²™ç®±å·¥å…·ï¼Œè´Ÿè´£ç¯å¢ƒéš”ç¦»ï¼›xdg-dbus-proxy æ˜¯ä¸Šå±‚è¿‡æ»¤ç»„ä»¶ï¼Œè´Ÿè´£ D-Bus ç»†ç²’åº¦ç®¡æ§ï¼Œä¸¤è€…ååŒå®ç°å®Œæ•´å®‰å…¨éš”ç¦»ï¼š 4.7.2.1 åº•å±‚åŸºç¡€éš”ç¦»ï¼šbubblewrap çš„ â€œsocket éšè—ä¸ä»£ç†æŒ‚è½½â€Flatpak ä»¥ bubblewrapï¼ˆç®€ç§° bwrapï¼‰ä¸ºåº•å±‚æ²™ç®±åŸºç¡€ï¼Œåˆ©ç”¨å…¶ bind mount å’Œuser namespace èƒ½åŠ›å®Œæˆç¯å¢ƒåˆå§‹åŒ–ï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯åˆ‡æ–­æ²™ç®±åº”ç”¨ä¸å®¿ä¸» D-Bus æ€»çº¿çš„ç›´æ¥è”ç³»ï¼š éšè—å®¿ä¸» socketï¼šbubblewrap ä¼šå±è”½å®¿ä¸»çš„ D-Bus æ€»çº¿å¥—æ¥å­—ï¼ˆå¦‚ä¸å°†/var/run/dbus/system_bus_socket æŒ‚è½½è¿›æ²™ç®±ï¼‰ï¼Œé¿å…åº”ç”¨ç»•è¿‡ç®¡æ§ç›´æ¥è®¿é—®å®¿ä¸»æ€»çº¿ï¼› æŒ‚è½½ä»£ç† socketï¼šåŒæ—¶ï¼Œbubblewrap ä¼šå°† xdg-dbus-proxy åœ¨å®¿ä¸»ä¾§é¢„å…ˆåˆ›å»ºçš„ ç§æœ‰ä»£ç† socketï¼Œé€šè¿‡ bind mount æŒ‚è½½åˆ°æ²™ç®±å†…çš„é»˜è®¤ D-Bus socket è·¯å¾„ï¼ˆå¦‚æ²™ç®±å†…çš„/var/run/dbus/system_bus_socketï¼‰ã€‚ æ­¤æ—¶æ²™ç®±åº”ç”¨æ„ŸçŸ¥åˆ°çš„ ã€ŒD-Bus æ€»çº¿ã€ï¼Œå®é™…æ˜¯ xdg-dbus-proxy æä¾›çš„ä»£ç†æ¥å£ï¼Œæ— æ³•ç›´æ¥æ¥è§¦å®¿ä¸»çœŸå®æ€»çº¿ã€‚ 4.7.2.2 ä¸Šå±‚è§„åˆ™è¿‡æ»¤ï¼šxdg-dbus-proxy çš„ â€œç™½åå•æ ¡éªŒâ€xdg-dbus-proxy ä½œä¸º Flatpak å†…ç½®çš„ D-Bus ä»£ç†ç»„ä»¶ï¼Œä¼šéšæ²™ç®±åº”ç”¨å¯åŠ¨ï¼ŒåŠ è½½ Flatpak æ ¹æ®åº”ç”¨æƒé™å£°æ˜è‡ªåŠ¨ç”Ÿæˆçš„è¿‡æ»¤è§„åˆ™ï¼ˆç²’åº¦è¿œç»†äº D-Bus åŸç”Ÿé™æ€é…ç½®ï¼‰ï¼Œä¾‹å¦‚ï¼š bash --see=NAME Set 'see' policy for NAME --talk=NAME Set 'talk' policy for NAME --own=NAME Set 'own' policy for NAME --call=NAME=RULE Set RULE for calls on NAME --broadcast=NAME=RULE Set RULE for broadcasts from NAME TODO è¿™äº›è§„åˆ™å¯ç²¾ç¡®åˆ° ã€ŒæœåŠ¡å + æ¥å£ + æ–¹æ³• + å¯¹è±¡è·¯å¾„ã€ï¼Œå¼¥è¡¥ D-Bus åŸç”Ÿé…ç½®åœ¨æ²™ç®±åœºæ™¯ä¸‹ ã€ŒåŠ¨æ€æ€§ä¸è¶³ã€ç²’åº¦è¾ƒç²—ã€ çš„å±€é™ã€‚ 4.7.2.3 æ¶ˆæ¯æµè½¬ï¼šä»£ç†çš„ â€œæ ¡éªŒ - è½¬å‘â€ é€»è¾‘æ²™ç®±åº”ç”¨æ— éœ€ä¿®æ”¹ä»£ç ï¼Œä¼šé»˜è®¤è¿æ¥æ²™ç®±å†…çš„ ã€Œä»£ç† socketã€ï¼Œæ‰€æœ‰ D-Bus æ¶ˆæ¯ï¼ˆæ–¹æ³•è°ƒç”¨ã€ä¿¡å·è®¢é˜…ï¼‰å‡éœ€ç»è¿‡ xdg-dbus-proxy çš„æ ¡éªŒï¼š è‹¥ç›®æ ‡æœåŠ¡ / æ–¹æ³•åœ¨ç™½åå•å†…ï¼ˆå¦‚ org.freedesktop.portal.FileChooser.OpenFileï¼‰ï¼Œä»£ç†ä¼šå°†æ¶ˆæ¯è½¬å‘è‡³å®¿ä¸» D-Bus æ€»çº¿ï¼Œå¹¶æŠŠè¿”å›ç»“æœå›ä¼ åº”ç”¨ï¼› è‹¥ç›®æ ‡ä¸åœ¨ç™½åå•å†…ï¼ˆå¦‚ org.freedesktop.login1.Manager.PowerOffï¼‰ï¼Œä»£ç†ç›´æ¥è¿”å›AccessDenied é”™è¯¯ï¼Œä¸å‘å®¿ä¸»æ€»çº¿è½¬å‘ä»»ä½•æ¶ˆæ¯ï¼Œå½»åº•é˜»æ–­è¶Šæƒè®¿é—®ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:5:7","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#4722-ä¸Šå±‚è§„åˆ™è¿‡æ»¤xdg-dbus-proxy-çš„-ç™½åå•æ ¡éªŒ"},{"categories":["tech"],"content":" 4.7 D-Bus çš„æƒé™ç®¡æ§ 4.7.1 D-Bus çš„åŸç”Ÿæƒé™ç®¡æ§æœºåˆ¶D-Bus æœ¬èº«å…·å¤‡å¤šå±‚æƒé™ç®¡æ§èƒ½åŠ›ï¼Œä»æ€»çº¿æ¥å…¥ã€æ¶ˆæ¯è·¯ç”±åˆ°æ•æ„Ÿæ“ä½œæˆæƒï¼Œå½¢æˆäº†ç³»ç»Ÿçº§çš„åŸºç¡€å®‰å…¨ä¿éšœï¼Œæ ¸å¿ƒæœºåˆ¶åŒ…æ‹¬ï¼š æ€»çº¿é…ç½®æ–‡ä»¶ï¼ˆé™æ€è§„åˆ™ç®¡æ§ï¼‰ é€šè¿‡ XML é…ç½®æ–‡ä»¶å®šä¹‰ç»†ç²’åº¦è®¿é—®è§„åˆ™ï¼Œå®ç°å¯¹ ã€Œè°èƒ½è®¿é—®å“ªäº›æœåŠ¡ / æ–¹æ³•ã€ çš„é™æ€é™åˆ¶ã€‚ä¾‹å¦‚ï¼š ç³»ç»Ÿæ€»çº¿çš„æœåŠ¡çº§è§„åˆ™ï¼ˆå¦‚ /etc/dbus-1/system.d/org.freedesktop.login1.confï¼‰å¯é™åˆ¶æ™®é€šç”¨æˆ·è°ƒç”¨ org.freedesktop.login1.Manager.PowerOffï¼ˆå…³æœºæ–¹æ³•ï¼‰ï¼› å…¨å±€è§„åˆ™ï¼ˆå¦‚ /etc/dbus-1/system.confï¼‰å¯é™å®šä»… root æˆ– dbus ç»„ç”¨æˆ·è®¿é—®org.freedesktop.systemd1ï¼ˆsystemd æœåŠ¡ï¼‰çš„æ ¸å¿ƒæ¥å£ã€‚ è§„åˆ™éµå¾ª ã€Œdeny ä¼˜å…ˆçº§é«˜äº allowã€æœåŠ¡çº§è§„åˆ™é«˜äºå…¨å±€è§„åˆ™ã€ çš„é€»è¾‘ï¼Œä»æ€»çº¿å±‚é¢ç›´æ¥æ‹¦æˆªæœªæˆæƒè¯·æ±‚ã€‚ PolicyKitï¼ˆåŠ¨æ€æˆæƒç®¡æ§ï¼‰ é’ˆå¯¹é™æ€è§„åˆ™æ— æ³•è¦†ç›–çš„åŠ¨æ€åœºæ™¯ï¼ˆå¦‚æ™®é€šç”¨æˆ·ä¸´æ—¶éœ€è¦æ‰§è¡Œæ•æ„Ÿæ“ä½œï¼‰ï¼ŒD-Bus é›†æˆ PolicyKitï¼ˆç°ç§° polkitï¼‰å®ç°åŠ¨æ€æˆæƒã€‚ç³»ç»ŸæœåŠ¡ï¼ˆå¦‚ logind1ã€systemd1ï¼‰ä¼šåœ¨/run/current-system/sw/share/polkit-1/actions/ï¼ˆNixOS ä¸­ï¼‰æˆ–/run/current-system/sw/share/polkit-1/actions/ï¼ˆNixOSï¼‰æˆ–/usr/share/polkit-1/actions/ï¼ˆä¼ ç»Ÿå‘è¡Œç‰ˆä¸­ï¼‰å®šä¹‰ â€œå¯æˆæƒåŠ¨ä½œâ€ï¼Œä¾‹å¦‚org.freedesktop.login1.power-offï¼ˆå¯¹åº” logind1 çš„å…³æœºæ–¹æ³•ï¼‰ï¼š æ™®é€šç”¨æˆ·è°ƒç”¨æ—¶ï¼Œä¼šè§¦å‘è®¤è¯æµç¨‹ï¼ˆå¦‚è¾“å…¥ç®¡ç†å‘˜å¯†ç ï¼‰ï¼Œè®¤è¯é€šè¿‡åä¸´æ—¶è·å¾—æˆæƒï¼› æ´»è·ƒæ§åˆ¶å°ç”¨æˆ·å¯ç›´æ¥æˆæƒï¼Œæ— éœ€é¢å¤–éªŒè¯ï¼Œå…¼é¡¾å®‰å…¨æ€§ä¸æ˜“ç”¨æ€§ã€‚ è¿æ¥å±‚åŸºç¡€éš”ç¦» D-Bus æ€»çº¿å¥—æ¥å­—ï¼ˆå¦‚ç³»ç»Ÿæ€»çº¿ /var/run/dbus/system_bus_socketï¼‰é»˜è®¤ä»…å¼€æ”¾ root å’Œdbus ç»„ç”¨æˆ·çš„è¯»å†™æƒé™ï¼Œæ™®é€šè¿›ç¨‹éœ€é€šè¿‡ dbus-daemon è®¤è¯åæ‰èƒ½å»ºç«‹è¿æ¥ã€‚åŒæ—¶ï¼Œæ¯ä¸ªè¿æ¥ä¼šè¢«åˆ†é…å”¯ä¸€ IDï¼ˆå¦‚ :1.42ï¼‰ï¼Œå¹¶ä¸è¿›ç¨‹çš„ PID/UID/GID ç»‘å®šï¼Œé˜²æ­¢èº«ä»½ä¼ªé€ ä¸æœªæˆæƒæ¥å…¥ã€‚ 4.7.2 Flatpak å¯¹ D-Bus æƒé™çš„ç»†ç²’åº¦ç®¡æ§åœ¨ç°ä»£ Linux æ¡Œé¢ä¸­ï¼Œè‹¥éœ€å°†å•†ä¸šè½¯ä»¶ç­‰éä¿¡ä»»åº”ç”¨è¿è¡Œåœ¨æ²™ç®±ä¸­ï¼ŒåŒæ—¶ä¿éšœ ã€Œå¿…è¦ D-Bus äº¤äº’ä¸ä¸­æ–­ã€è¶Šæƒè®¿é—®è¢«é˜»æ–­ã€ï¼ŒFlatpak é‡‡ç”¨ ã€Œåº•å±‚æ²™ç®±éš”ç¦» + ä¸Šå±‚ä»£ç†è¿‡æ»¤ã€ çš„åŒå±‚æ–¹æ¡ˆ â€”â€” å…¶ä¸­ bubblewrap æ˜¯ Flatpak ä¾èµ–çš„åº•å±‚æ²™ç®±å·¥å…·ï¼Œè´Ÿè´£ç¯å¢ƒéš”ç¦»ï¼›xdg-dbus-proxy æ˜¯ä¸Šå±‚è¿‡æ»¤ç»„ä»¶ï¼Œè´Ÿè´£ D-Bus ç»†ç²’åº¦ç®¡æ§ï¼Œä¸¤è€…ååŒå®ç°å®Œæ•´å®‰å…¨éš”ç¦»ï¼š 4.7.2.1 åº•å±‚åŸºç¡€éš”ç¦»ï¼šbubblewrap çš„ â€œsocket éšè—ä¸ä»£ç†æŒ‚è½½â€Flatpak ä»¥ bubblewrapï¼ˆç®€ç§° bwrapï¼‰ä¸ºåº•å±‚æ²™ç®±åŸºç¡€ï¼Œåˆ©ç”¨å…¶ bind mount å’Œuser namespace èƒ½åŠ›å®Œæˆç¯å¢ƒåˆå§‹åŒ–ï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯åˆ‡æ–­æ²™ç®±åº”ç”¨ä¸å®¿ä¸» D-Bus æ€»çº¿çš„ç›´æ¥è”ç³»ï¼š éšè—å®¿ä¸» socketï¼šbubblewrap ä¼šå±è”½å®¿ä¸»çš„ D-Bus æ€»çº¿å¥—æ¥å­—ï¼ˆå¦‚ä¸å°†/var/run/dbus/system_bus_socket æŒ‚è½½è¿›æ²™ç®±ï¼‰ï¼Œé¿å…åº”ç”¨ç»•è¿‡ç®¡æ§ç›´æ¥è®¿é—®å®¿ä¸»æ€»çº¿ï¼› æŒ‚è½½ä»£ç† socketï¼šåŒæ—¶ï¼Œbubblewrap ä¼šå°† xdg-dbus-proxy åœ¨å®¿ä¸»ä¾§é¢„å…ˆåˆ›å»ºçš„ ç§æœ‰ä»£ç† socketï¼Œé€šè¿‡ bind mount æŒ‚è½½åˆ°æ²™ç®±å†…çš„é»˜è®¤ D-Bus socket è·¯å¾„ï¼ˆå¦‚æ²™ç®±å†…çš„/var/run/dbus/system_bus_socketï¼‰ã€‚ æ­¤æ—¶æ²™ç®±åº”ç”¨æ„ŸçŸ¥åˆ°çš„ ã€ŒD-Bus æ€»çº¿ã€ï¼Œå®é™…æ˜¯ xdg-dbus-proxy æä¾›çš„ä»£ç†æ¥å£ï¼Œæ— æ³•ç›´æ¥æ¥è§¦å®¿ä¸»çœŸå®æ€»çº¿ã€‚ 4.7.2.2 ä¸Šå±‚è§„åˆ™è¿‡æ»¤ï¼šxdg-dbus-proxy çš„ â€œç™½åå•æ ¡éªŒâ€xdg-dbus-proxy ä½œä¸º Flatpak å†…ç½®çš„ D-Bus ä»£ç†ç»„ä»¶ï¼Œä¼šéšæ²™ç®±åº”ç”¨å¯åŠ¨ï¼ŒåŠ è½½ Flatpak æ ¹æ®åº”ç”¨æƒé™å£°æ˜è‡ªåŠ¨ç”Ÿæˆçš„è¿‡æ»¤è§„åˆ™ï¼ˆç²’åº¦è¿œç»†äº D-Bus åŸç”Ÿé™æ€é…ç½®ï¼‰ï¼Œä¾‹å¦‚ï¼š bash --see=NAME Set 'see' policy for NAME --talk=NAME Set 'talk' policy for NAME --own=NAME Set 'own' policy for NAME --call=NAME=RULE Set RULE for calls on NAME --broadcast=NAME=RULE Set RULE for broadcasts from NAME TODO è¿™äº›è§„åˆ™å¯ç²¾ç¡®åˆ° ã€ŒæœåŠ¡å + æ¥å£ + æ–¹æ³• + å¯¹è±¡è·¯å¾„ã€ï¼Œå¼¥è¡¥ D-Bus åŸç”Ÿé…ç½®åœ¨æ²™ç®±åœºæ™¯ä¸‹ ã€ŒåŠ¨æ€æ€§ä¸è¶³ã€ç²’åº¦è¾ƒç²—ã€ çš„å±€é™ã€‚ 4.7.2.3 æ¶ˆæ¯æµè½¬ï¼šä»£ç†çš„ â€œæ ¡éªŒ - è½¬å‘â€ é€»è¾‘æ²™ç®±åº”ç”¨æ— éœ€ä¿®æ”¹ä»£ç ï¼Œä¼šé»˜è®¤è¿æ¥æ²™ç®±å†…çš„ ã€Œä»£ç† socketã€ï¼Œæ‰€æœ‰ D-Bus æ¶ˆæ¯ï¼ˆæ–¹æ³•è°ƒç”¨ã€ä¿¡å·è®¢é˜…ï¼‰å‡éœ€ç»è¿‡ xdg-dbus-proxy çš„æ ¡éªŒï¼š è‹¥ç›®æ ‡æœåŠ¡ / æ–¹æ³•åœ¨ç™½åå•å†…ï¼ˆå¦‚ org.freedesktop.portal.FileChooser.OpenFileï¼‰ï¼Œä»£ç†ä¼šå°†æ¶ˆæ¯è½¬å‘è‡³å®¿ä¸» D-Bus æ€»çº¿ï¼Œå¹¶æŠŠè¿”å›ç»“æœå›ä¼ åº”ç”¨ï¼› è‹¥ç›®æ ‡ä¸åœ¨ç™½åå•å†…ï¼ˆå¦‚ org.freedesktop.login1.Manager.PowerOffï¼‰ï¼Œä»£ç†ç›´æ¥è¿”å›AccessDenied é”™è¯¯ï¼Œä¸å‘å®¿ä¸»æ€»çº¿è½¬å‘ä»»ä½•æ¶ˆæ¯ï¼Œå½»åº•é˜»æ–­è¶Šæƒè®¿é—®ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:5:7","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#4723-æ¶ˆæ¯æµè½¬ä»£ç†çš„-æ ¡éªŒ---è½¬å‘-é€»è¾‘"},{"categories":["tech"],"content":" æ€»ç»“æœ¬æ–‡æ·±å…¥æ¢è®¨äº† systemd æ ¸å¿ƒåŠŸèƒ½åŠå…¶ç”Ÿæ€ç³»ç»Ÿï¼Œä»æœåŠ¡ç®¡ç†åˆ°å„ä¸ªä¸“é—¨åŒ–ç»„ä»¶ï¼š systemd æ ¸å¿ƒåŠŸèƒ½ï¼šä½œä¸º PID 1 çš„æœåŠ¡ç®¡ç†å™¨ï¼Œä¸“æ³¨äºæœåŠ¡ç®¡ç†ã€ä¾èµ–å…³ç³»ç®¡ç†ã€èµ„æºæ§åˆ¶å’Œç³»ç»ŸçŠ¶æ€ç®¡ç† systemd ç”Ÿæ€ç³»ç»ŸæœåŠ¡ï¼šåŒ…æ‹¬æ—¥å¿—ç®¡ç†ï¼ˆjournaldï¼‰ã€å†…å­˜ç®¡ç†ï¼ˆoomdï¼‰ã€DNS è§£æ ï¼ˆresolvedï¼‰ã€æ—¶é—´åŒæ­¥ï¼ˆtimesyncdï¼‰ã€è®¾å¤‡ç®¡ç†ï¼ˆudevdï¼‰ç­‰ è®¾å¤‡ç®¡ç†ï¼šudev è§„åˆ™å’Œè®¾å¤‡æƒé™åˆ†é…ï¼Œé€šè¿‡ systemd-udevd ç¡®ä¿ç¡¬ä»¶è®¾å¤‡æ­£ç¡®è¯†åˆ«å’Œè®¿é—® D-Bus ç³»ç»Ÿæ€»çº¿ï¼šè¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ï¼Œæ”¯æŒç³»ç»ŸæœåŠ¡å’Œæ¡Œé¢åº”ç”¨çš„äº¤äº’ è™½ç„¶ systemd çš„äº‰è®®ä¸€ç›´å­˜åœ¨ï¼Œä½†ä¸å¯å¦è®¤çš„æ˜¯ï¼Œå®ƒç¡®å®è®©ç³»ç»Ÿç®¡ç†å˜å¾—æ›´åŠ ç»Ÿä¸€å’Œé«˜æ•ˆã€‚æŒæ¡äº†è¿™äº›ç»„ä»¶çš„ä½¿ç”¨æ–¹æ³•ï¼Œä½ åœ¨é¢å¯¹å„ç§ç³»ç»Ÿé—®é¢˜æ—¶å°±ä¸ä¼šé‚£ä¹ˆæ‰‹è¶³æ— æªäº†ã€‚ ä¸‹ä¸€ç¯‡æ–‡ç« æˆ‘ä»¬ä¼šèŠèŠæ¡Œé¢ä¼šè¯å’Œå›¾å½¢æ¸²æŸ“ï¼Œçœ‹çœ‹ç”¨æˆ·ç™»å½•åç³»ç»Ÿæ˜¯å¦‚ä½•æŠŠæ¼‚äº®çš„æ¡Œé¢å‘ˆç°ç»™ä½ çš„ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-2-systemd-services/:6:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Systemd","D-Bus"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†","uri":"/posts/linux-desktop-2-systemd-services/#æ€»ç»“"},{"categories":["tech"],"content":"æ·±å…¥è§£æ Linux æ¡Œé¢ç³»ç»Ÿçš„å¯åŠ¨æµç¨‹ã€å®‰å…¨æ¡†æ¶å’Œæ•…éšœæ’æŸ¥æ–¹æ³•ï¼ŒåŒ…æ‹¬ UEFIã€GRUBã€systemd ç­‰å…³é”®ç»„ä»¶","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/"},{"categories":["tech"],"content":" AI åˆ›ä½œå£°æ˜ï¼šæœ¬ç³»åˆ—æ–‡ç« ç”±ç¬”è€…å€ŸåŠ© ChatGPT, Kimi K2, è±†åŒ…å’Œ Cursor ç­‰ AI å·¥å…·åˆ›ä½œï¼Œæœ‰å¾ˆå¤§ç¯‡å¹…çš„å†…å®¹å®Œå…¨ç”± AI åœ¨æˆ‘çš„æŒ‡å¯¼ä¸‹ç”Ÿæˆã€‚å¦‚æœ‰é”™è¯¯ï¼Œè¿˜è¯·æŒ‡æ­£ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:0:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#"},{"categories":["tech"],"content":" å‰è¨€æœ¬æ–‡å°†ç®€è¦ä»‹ç» Linux æ¡Œé¢ç³»ç»Ÿçš„å¯åŠ¨æœºåˆ¶ï¼Œä» UEFI å¼•å¯¼åˆ°å†…æ ¸åŠ è½½ï¼Œä» initramfs åˆ° systemd æœåŠ¡å¯åŠ¨ï¼Œå†åˆ°æ¡Œé¢ç¯å¢ƒåŠ è½½ã€‚åŒæ—¶è¿˜ä¼šæ¢è®¨ç³»ç»Ÿçš„å®‰å…¨æ¡†æ¶ï¼Œäº†è§£ PAMã€PolicyKit ç­‰ç»„ä»¶å¦‚ä½•ä¿æŠ¤ç³»ç»Ÿå®‰å…¨ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:1:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#å‰è¨€"},{"categories":["tech"],"content":" 1. ç³»ç»Ÿå¯åŠ¨æµç¨‹","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:2:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#1-ç³»ç»Ÿå¯åŠ¨æµç¨‹"},{"categories":["tech"],"content":" å¯åŠ¨çš„å››ä¸ªå…³é”®é˜¶æ®µLinux æ¡Œé¢ç³»ç»Ÿçš„å¯åŠ¨è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªä¸»è¦é˜¶æ®µï¼š å›ºä»¶é˜¶æ®µï¼šUEFI å›ºä»¶åˆå§‹åŒ–ç¡¬ä»¶ å¼•å¯¼åŠ è½½å™¨é˜¶æ®µï¼šåŠ è½½å†…æ ¸å’Œ initramfs å†…æ ¸é˜¶æ®µï¼šç¡¬ä»¶æ¢æµ‹å’Œé©±åŠ¨åŠ è½½ initramfs é˜¶æ®µï¼šå‡†å¤‡æ ¹æ–‡ä»¶ç³»ç»Ÿ ç”¨æˆ·ç©ºé—´é˜¶æ®µï¼šsystemd æ¥ç®¡ç³»ç»Ÿç®¡ç† ","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:2:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#å¯åŠ¨çš„å››ä¸ªå…³é”®é˜¶æ®µ"},{"categories":["tech"],"content":" UEFIï¼šç³»ç»Ÿå¯åŠ¨çš„èµ·ç‚¹ç°ä»£ç³»ç»Ÿæ™®éä½¿ç”¨ UEFI å›ºä»¶ ä»£æ›¿ BIOSã€‚UEFI åˆå§‹åŒ–ç¡¬ä»¶åï¼Œä» EFI System Partition (ESP) ä¸­åŠ è½½å¯åŠ¨ç®¡ç†å™¨ã€‚ NixOS é»˜è®¤ä½¿ç”¨ grubï¼Œå¯ç”¨ Secure Boot(lanzaboote) æ—¶éœ€æ”¹ç”¨systemd-boot. systemd-boot çš„å…¨å±€é…ç½®æ˜¯ /boot/loader/loader.confï¼Œå…·ä½“çš„å¯åŠ¨é¡¹é…ç½®éœ€è¦åˆ†ç±»è®¨è®ºï¼š Type 1ï¼šæ‰‹åŠ¨é…ç½® ï¼ˆBoot Loader Specification Type #1ï¼‰ é…ç½®æ–¹å¼ï¼š/loader/entries/*.confï¼Œä½äº EFI ç³»ç»Ÿåˆ†åŒºï¼ˆESPï¼‰æˆ– Extended Boot Loader Partitionï¼ˆXBOOTLDRï¼‰ä¸‹ ç‰¹ç‚¹ï¼š å¯è‡ªå®šä¹‰å¯åŠ¨é¡¹åç§°ã€å†…æ ¸å‚æ•°ã€initrd ç­‰ æè¿° Linux å†…æ ¸åŠå…¶ initrdï¼Œä¹Ÿå¯ä»¥æè¿°ä»»æ„ EFI å¯æ‰§è¡Œæ–‡ä»¶ åŒ…æ‹¬ fallback / rescue å†…æ ¸ ç¤ºä¾‹ï¼š ini title NixOS Linux linux /vmlinuz-linux initrd /initrd-linux.img options root=UUID=xxxx rw Type 2ï¼šç»Ÿä¸€å†…æ ¸é•œåƒ ï¼ˆBoot Loader Specification Type #2ï¼‰ é…ç½®æ–¹å¼ï¼šå°† EFI æ ¼å¼çš„ UKI é•œåƒæ”¾åœ¨ ESP åˆ†åŒºçš„ /EFI/Linux/ ä¸‹å³å¯ å·¥ä½œåŸç†ï¼š systemd-boot åœ¨å¯åŠ¨æ—¶æ‰«æ ESP çš„ /EFI/Linux/ ç›®å½• systemd-boot ä¼šè‡ªåŠ¨å°†æ‰«æåˆ°çš„å†…æ ¸é•œåƒæ·»åŠ åˆ°å¯åŠ¨èœå•ï¼Œæ— éœ€å•ç‹¬çš„ .conf æ–‡ä»¶ ç‰¹ç‚¹ï¼š å…é…ç½®ï¼Œè‡ªåŠ¨å‡ºç°åœ¨å¯åŠ¨èœå•ä¸­ vmlinuz-linux, initrd è·Ÿ cmdline ç­‰ä¿¡æ¯è¢«ç»Ÿä¸€æ‰“åŒ…æˆä¸€ä¸ª EFI é•œåƒï¼Œä¸€ä¸ªé•œåƒå°±åŒ…å«äº†ç³»ç»Ÿå¯åŠ¨éœ€è¦çš„æ‰€æœ‰æ•°æ®ï¼Œæ›´æ–¹é¢ç®€æ´ã€‚ å…¶ä»–è‡ªåŠ¨è¯†åˆ«çš„å¯åŠ¨é¡¹ Microsoft Windows EFI boot managerï¼ˆå¦‚æœå·²å®‰è£…ï¼‰ Apple macOS boot managerï¼ˆå¦‚æœå·²å®‰è£…ï¼‰ EFI Shell å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆå¦‚æœå·²å®‰è£…ï¼‰ ã€ŒReboot Into Firmware Interfaceã€é€‰é¡¹ï¼ˆå¦‚æœ UEFI å›ºä»¶æ”¯æŒï¼‰ Secure Boot å˜é‡æ³¨å†Œï¼ˆå¦‚æœå›ºä»¶å¤„äº setup æ¨¡å¼ï¼Œä¸” ESP æä¾›äº†ç›¸å…³æ–‡ä»¶ï¼‰ å¸¸ç”¨å‘½ä»¤ï¼š efibootmgr -vï¼šæŸ¥çœ‹ / ä¿®æ”¹å›ºä»¶å¯åŠ¨é¡ºåº bootctl statusï¼šæ£€æŸ¥ systemd-boot å®‰è£…ä¸ ESP çŠ¶æ€ bootctl listï¼šåˆ—å‡ºå¯åŠ¨æ¡ç›® ukify inspect /boot/EFI/Linux/nixos-xxx.efi: æŸ¥çœ‹ efi é•œåƒä¸­åŒ…å«çš„ä¿¡æ¯ ç¤ºä¾‹ï¼š bash # æŸ¥çœ‹å›ºä»¶å¯åŠ¨é¡ºåº $ nix run nixpkgs#efibootmgr -v BootCurrent: 0000 Timeout: 0 seconds BootOrder: 0000,0004 Boot0000* NixOS HD(1,GPT,34286f3b-d4df-456d-bf7a-eb67f2bf1a72,0x1000,0x12b000)/EFI\\BOOT\\BOOTX64.EFI ... Boot0004* Windows Boot Manager HD(1,GPT,34286f3b-d4df-456d-bf7a-eb67f2bf1a72,0x1000,0x12b000)/\\EFI\\Microsoft\\Boot\\bootmgfw.efi0000424f # æ£€æŸ¥ systemd-boot å®‰è£…ä¸ ESP çŠ¶æ€ $ bootctl status System: Firmware: UEFI 2.80 (American Megatrends 5.27) Firmware Arch: x64 Secure Boot: enabled (user) TPM2 Support: yes Measured UKI: yes Boot into FW: supported Current Boot Loader: Product: systemd-boot 257.7 Features: âœ“ Boot counting âœ“ Menu timeout control âœ“ One-shot menu timeout control âœ“ Default entry control âœ“ One-shot entry control âœ“ Support for XBOOTLDR partition âœ“ Support for passing random seed to OS âœ“ Load drop-in drivers âœ“ Support Type #1 sort-key field âœ“ Support @saved pseudo-entry âœ“ Support Type #1 devicetree field âœ“ Enroll SecureBoot keys âœ“ Retain SHIM protocols âœ“ Menu can be disabled âœ“ Multi-Profile UKIs are supported âœ“ Boot loader set partition information Partition: /dev/disk/by-partuuid/34286f3b-d4df-456d-bf7a-eb67f2bf1a72 Loader: â””â”€EFI/BOOT/BOOTX64.EFI Current Entry: nixos-generation-848-jattq2uvv2snrigcxtdcxelgaawdb3s6lar3ualze77id46h5adq.efi ... Available Boot Loaders on ESP: ESP: /boot (/dev/disk/by-partuuid/34286f3b-d4df-456d-bf7a-eb67f2bf1a72) File: â”œâ”€/EFI/systemd/systemd-bootx64.efi (systemd-boot 257.7) â””â”€/EFI/BOOT/BOOTX64.EFI (systemd-boot 257.7) ... Default Boot Loader Entry: type: Boot Loader Specification Type #2 (.efi) title: NixOS Xantusia 25.11.20250830.d7600c7 (Linux 6.16.4) (Generation 848, 2025-09-01) id: nixos-generation-848-jattq2uvv2snrigcxtdcxelgaawdb3s6lar3ualze77id46h5adq.efi source: /boot//EFI/Linux/nixos-generation-848-jattq2uvv2snrigcxtdcxelgaawdb3s6lar3ualze77id46h5adq.efi (on the EFI System Partition) sort-key: lanza version: Generation 848, 2025-09-01 linux: /boot//EFI/Linux/nixos-generation-848-jattq2uvv2snrigcxtdcxelgaawdb3s6lar3ualze77id46h5adq.efi options: init=/nix/store/gaj3sp3hrzjhp59bvyxhc8flg5s6iimg-nixos-system-ai-25.11.20250830.d7600c7/init nvidia-drm.fbdev=1 root=fstab loglevel=4 lsm=landlock,yama,bpf nvidia-drm.modeset=1 nvidia-drm.fbdev=1 nvidia.NVreg_PreserveVideoMemoryAllocations=1 nvidia.NVreg_OpenRmEnableUnsupportedGpus=1 # æŸ¥çœ‹ä¸Šè¿°å¯åŠ¨é¡¹ä¸­ uki efi æ–‡ä»¶çš„å†…å®¹ $ nix shell nixpkgs#systemdUkify $ ukify inspect /boot/EFI/Linux/nixos-generation-848-jattq2uvv2snrigcxtdcxelgaawdb3s6lar3ualze77id46h5adq.efi .osrel: size: 141 bytes sha256: e486dea4910eb9262efc47464f533f96093293d37c3d25feb954c098865a4be6 text: ID=lanza PRETTY_NAME=NixOS Xantusia 25.11.20250830.d7600c7 (Linux 6.16.4) (Generation 848, 2025-09-01) VERSION_ID=Generation 848, 2025-09-01 # å¯åŠ¨å†…æ ¸æ—¶ä½¿ç”¨çš„å†…æ ¸å‘½ä»¤è¡Œå‚æ•° .cmdline: size: 284 bytes sha256: 7f94ffed08359eb1d2749176eba57e085","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:2:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#uefiç³»ç»Ÿå¯åŠ¨çš„èµ·ç‚¹"},{"categories":["tech"],"content":" initramfs é˜¶æ®µinitramfsï¼ˆInitial RAM File Systemï¼‰æ˜¯ä¸€ä¸ªä¸´æ—¶çš„æ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œåœ¨çœŸæ­£çš„æ ¹æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ä¹‹å‰æä¾›å¿…è¦çš„åŠŸèƒ½ã€‚å®ƒåœ¨å¯åŠ¨é˜¶æ®µè¢«åŠ è½½åˆ° RAM ä¸­å¹¶è¢«æŒ‚è½½ä¸ºæ ¹ç›®å½•ã€‚ initramfs é˜¶æ®µçš„ä¸»è¦èŒè´£ï¼š ç¡¬ä»¶æ£€æµ‹ä¸é©±åŠ¨åŠ è½½ï¼š æ£€æµ‹å­˜å‚¨è®¾å¤‡ï¼ˆSATAã€NVMeã€USB ç­‰ï¼‰ åŠ è½½å¿…è¦çš„å­˜å‚¨é©±åŠ¨æ¨¡å— è¯†åˆ«ç½‘ç»œè®¾å¤‡ï¼ˆå¦‚æœéœ€è¦ç½‘ç»œå¯åŠ¨ï¼‰ å­˜å‚¨è®¾å¤‡å‡†å¤‡ï¼š è§£å¯† LUKS åŠ å¯†åˆ†åŒº æ¿€æ´» LVM é€»è¾‘å· å¤„ç† RAID é˜µåˆ— æŒ‚è½½ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿ æ ¹æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ï¼š æ ¹æ®å†…æ ¸å‚æ•° root= æ‰¾åˆ°æ ¹åˆ†åŒº æŒ‚è½½æ ¹æ–‡ä»¶ç³»ç»Ÿåˆ° /new_root æ‰§è¡Œ switch_root åˆ‡æ¢åˆ°çœŸæ­£çš„æ ¹æ–‡ä»¶ç³»ç»Ÿ å¯åŠ¨ç”¨æˆ·ç©ºé—´ï¼š æ‰§è¡Œ /sbin/initï¼ˆé€šå¸¸æ˜¯ systemdï¼‰ åœ¨ NixOS ä¸­ï¼Œinit ç¨‹åºæ˜¯ /nix/store ä¸­çš„ä¸€ä¸ª Shell è„šæœ¬ï¼Œå®ƒé¦–å…ˆå®Œæˆä¸€äº›å¿…è¦çš„åˆå§‹åŒ–å·¥ä½œï¼Œä¹‹åæ‰å¯åŠ¨ systemd. å¸¸è§æ•…éšœä¸æ’æŸ¥ï¼š æ‰¾ä¸åˆ°æ ¹åˆ†åŒºï¼šæ£€æŸ¥ cat /proc/cmdline çš„ root= å‚æ•°ä¸ blkid è¾“å‡ºæ˜¯å¦ä¸€è‡´ ç¼ºå°‘é©±åŠ¨æ¨¡å—ï¼šç¡®ä¿ NixOS é…ç½®åŒ…å«æ‰€éœ€æ¨¡å—ï¼šboot.initrd.kernelModules = [ \"nvme\" \"dm_mod\" ]; LUKS è§£å¯†å¤±è´¥ï¼šæ£€æŸ¥å¯†ç è¾“å…¥æˆ–å¯†é’¥æ–‡ä»¶é…ç½® LVM æ¿€æ´»å¤±è´¥ï¼šç¡®è®¤ LVM é…ç½®å’Œå·ç»„çŠ¶æ€ æ’æŸ¥æ­¥éª¤ï¼š ç¼–è¾‘å†…æ ¸ cmdlineï¼Œæ·»åŠ  init=/bin/sh æˆ– break=mount è¿›å…¥ initramfs shell è¿è¡Œ lsblkã€blkid ç¡®è®¤è®¾å¤‡ æŸ¥çœ‹ dmesg ä¸­çš„ç£ç›˜æˆ– LVM é”™è¯¯ æ£€æŸ¥ /proc/cmdline ä¸­çš„å¯åŠ¨å‚æ•° ","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:2:3","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#initramfs-é˜¶æ®µ"},{"categories":["tech"],"content":" 2. å¯åŠ¨æ•…éšœæ’æŸ¥","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:3:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#2-å¯åŠ¨æ•…éšœæ’æŸ¥"},{"categories":["tech"],"content":" å¯åŠ¨æ•…éšœæ’æŸ¥æµç¨‹flowchart LR A[ç³»ç»Ÿæ— æ³•å¯åŠ¨] --\u003e B{èƒ½å¦è¿›å…¥ UEFI/BIOS?} B --\u003e|å¦| C[ç¡¬ä»¶é—®é¢˜æ£€æŸ¥ç”µæºã€å†…å­˜ã€CPU] B --\u003e|æ˜¯| D{èƒ½å¦çœ‹åˆ°å¯åŠ¨èœå•?} D --\u003e|å¦| E[å¼•å¯¼åŠ è½½å™¨é—®é¢˜æ£€æŸ¥ ESP åˆ†åŒºå’Œå¯åŠ¨é¡¹] D --\u003e|æ˜¯| F{èƒ½å¦é€‰æ‹©å¯åŠ¨é¡¹?} F --\u003e|å¦| G[å¯åŠ¨é¡¹é…ç½®é”™è¯¯æ£€æŸ¥ bootctl é…ç½®] F --\u003e|æ˜¯| H{å†…æ ¸èƒ½å¦åŠ è½½?} H --\u003e|å¦| I[å†…æ ¸æˆ– initramfs é—®é¢˜æ£€æŸ¥å†…æ ¸å‚æ•°å’Œé©±åŠ¨] H --\u003e|æ˜¯| J{èƒ½å¦è¿›å…¥ initramfs?} J --\u003e|å¦| K[initramfs é—®é¢˜æ£€æŸ¥æ ¹åˆ†åŒºå’Œæ–‡ä»¶ç³»ç»Ÿ] J --\u003e|æ˜¯| L{èƒ½å¦æŒ‚è½½æ ¹åˆ†åŒº?} L --\u003e|å¦| M[æ–‡ä»¶ç³»ç»Ÿæˆ–åŠ å¯†é—®é¢˜æ£€æŸ¥ LUKS å’Œ LVM] L --\u003e|æ˜¯| N{systemd èƒ½å¦å¯åŠ¨?} N --\u003e|å¦| O[ç”¨æˆ·ç©ºé—´é—®é¢˜æ£€æŸ¥ systemd æœåŠ¡] N --\u003e|æ˜¯| P[å¯åŠ¨æˆåŠŸ] ","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:3:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#å¯åŠ¨æ•…éšœæ’æŸ¥æµç¨‹"},{"categories":["tech"],"content":" å¸¸è§å¯åŠ¨é—®é¢˜ï¼šç—‡çŠ¶ä¸è§£å†³æ–¹æ¡ˆåœ¨ç³»ç»Ÿå¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šé‡åˆ°å„ç§é—®é¢˜ã€‚ä»¥ä¸‹æ˜¯æŒ‰å¯åŠ¨é˜¶æ®µåˆ†ç±»çš„å¸¸è§é—®é¢˜åŠæ’æŸ¥æ–¹æ³•ï¼š 2.2.1 å›ºä»¶å’Œå¼•å¯¼åŠ è½½å™¨é—®é¢˜é—®é¢˜ç—‡çŠ¶ï¼š ç³»ç»Ÿæ— æ³•å¯åŠ¨ï¼Œåœç•™åœ¨å›ºä»¶ç•Œé¢ æ˜¾ç¤º â€œNo bootable deviceâ€ é”™è¯¯ å¯åŠ¨èœå•ä¸æ˜¾ç¤ºæˆ–æ˜¾ç¤ºå¼‚å¸¸ æ’æŸ¥æ­¥éª¤ï¼š ä½¿ç”¨ USB å¯åŠ¨ç›˜è¿›å…¥ LiveOS, è¿›è¡Œå¦‚ä¸‹æ£€æŸ¥ï¼š bash # æ£€æŸ¥ UEFI è®¾ç½® efibootmgr -v # æ£€æŸ¥ ESP åˆ†åŒºçŠ¶æ€ bootctl status # éªŒè¯å¯åŠ¨é¡¹é…ç½® bootctl list 2.2.2 å†…æ ¸å’Œ initramfs é—®é¢˜é—®é¢˜ç—‡çŠ¶ï¼š å†…æ ¸ panic æˆ–æ— æ³•åŠ è½½ initramfs é˜¶æ®µå¡ä½ æ‰¾ä¸åˆ°æ ¹åˆ†åŒº æ’æŸ¥æ­¥éª¤ï¼š bash # è¿›å…¥ initramfs shell è¿›è¡Œè°ƒè¯• # åœ¨å†…æ ¸å‚æ•°ä¸­æ·»åŠ ï¼šinit=/bin/sh æˆ– break=mount # æ£€æŸ¥è®¾å¤‡è¯†åˆ« lsblk blkid # æŸ¥çœ‹å†…æ ¸æ—¥å¿— dmesg | grep -i error # æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿå®Œæ•´æ€§ fsck /dev/sdX ","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:3:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#å¸¸è§å¯åŠ¨é—®é¢˜ç—‡çŠ¶ä¸è§£å†³æ–¹æ¡ˆ"},{"categories":["tech"],"content":" å¸¸è§å¯åŠ¨é—®é¢˜ï¼šç—‡çŠ¶ä¸è§£å†³æ–¹æ¡ˆåœ¨ç³»ç»Ÿå¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šé‡åˆ°å„ç§é—®é¢˜ã€‚ä»¥ä¸‹æ˜¯æŒ‰å¯åŠ¨é˜¶æ®µåˆ†ç±»çš„å¸¸è§é—®é¢˜åŠæ’æŸ¥æ–¹æ³•ï¼š 2.2.1 å›ºä»¶å’Œå¼•å¯¼åŠ è½½å™¨é—®é¢˜é—®é¢˜ç—‡çŠ¶ï¼š ç³»ç»Ÿæ— æ³•å¯åŠ¨ï¼Œåœç•™åœ¨å›ºä»¶ç•Œé¢ æ˜¾ç¤º â€œNo bootable deviceâ€ é”™è¯¯ å¯åŠ¨èœå•ä¸æ˜¾ç¤ºæˆ–æ˜¾ç¤ºå¼‚å¸¸ æ’æŸ¥æ­¥éª¤ï¼š ä½¿ç”¨ USB å¯åŠ¨ç›˜è¿›å…¥ LiveOS, è¿›è¡Œå¦‚ä¸‹æ£€æŸ¥ï¼š bash # æ£€æŸ¥ UEFI è®¾ç½® efibootmgr -v # æ£€æŸ¥ ESP åˆ†åŒºçŠ¶æ€ bootctl status # éªŒè¯å¯åŠ¨é¡¹é…ç½® bootctl list 2.2.2 å†…æ ¸å’Œ initramfs é—®é¢˜é—®é¢˜ç—‡çŠ¶ï¼š å†…æ ¸ panic æˆ–æ— æ³•åŠ è½½ initramfs é˜¶æ®µå¡ä½ æ‰¾ä¸åˆ°æ ¹åˆ†åŒº æ’æŸ¥æ­¥éª¤ï¼š bash # è¿›å…¥ initramfs shell è¿›è¡Œè°ƒè¯• # åœ¨å†…æ ¸å‚æ•°ä¸­æ·»åŠ ï¼šinit=/bin/sh æˆ– break=mount # æ£€æŸ¥è®¾å¤‡è¯†åˆ« lsblk blkid # æŸ¥çœ‹å†…æ ¸æ—¥å¿— dmesg | grep -i error # æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿå®Œæ•´æ€§ fsck /dev/sdX ","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:3:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#221-å›ºä»¶å’Œå¼•å¯¼åŠ è½½å™¨é—®é¢˜"},{"categories":["tech"],"content":" å¸¸è§å¯åŠ¨é—®é¢˜ï¼šç—‡çŠ¶ä¸è§£å†³æ–¹æ¡ˆåœ¨ç³»ç»Ÿå¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šé‡åˆ°å„ç§é—®é¢˜ã€‚ä»¥ä¸‹æ˜¯æŒ‰å¯åŠ¨é˜¶æ®µåˆ†ç±»çš„å¸¸è§é—®é¢˜åŠæ’æŸ¥æ–¹æ³•ï¼š 2.2.1 å›ºä»¶å’Œå¼•å¯¼åŠ è½½å™¨é—®é¢˜é—®é¢˜ç—‡çŠ¶ï¼š ç³»ç»Ÿæ— æ³•å¯åŠ¨ï¼Œåœç•™åœ¨å›ºä»¶ç•Œé¢ æ˜¾ç¤º â€œNo bootable deviceâ€ é”™è¯¯ å¯åŠ¨èœå•ä¸æ˜¾ç¤ºæˆ–æ˜¾ç¤ºå¼‚å¸¸ æ’æŸ¥æ­¥éª¤ï¼š ä½¿ç”¨ USB å¯åŠ¨ç›˜è¿›å…¥ LiveOS, è¿›è¡Œå¦‚ä¸‹æ£€æŸ¥ï¼š bash # æ£€æŸ¥ UEFI è®¾ç½® efibootmgr -v # æ£€æŸ¥ ESP åˆ†åŒºçŠ¶æ€ bootctl status # éªŒè¯å¯åŠ¨é¡¹é…ç½® bootctl list 2.2.2 å†…æ ¸å’Œ initramfs é—®é¢˜é—®é¢˜ç—‡çŠ¶ï¼š å†…æ ¸ panic æˆ–æ— æ³•åŠ è½½ initramfs é˜¶æ®µå¡ä½ æ‰¾ä¸åˆ°æ ¹åˆ†åŒº æ’æŸ¥æ­¥éª¤ï¼š bash # è¿›å…¥ initramfs shell è¿›è¡Œè°ƒè¯• # åœ¨å†…æ ¸å‚æ•°ä¸­æ·»åŠ ï¼šinit=/bin/sh æˆ– break=mount # æ£€æŸ¥è®¾å¤‡è¯†åˆ« lsblk blkid # æŸ¥çœ‹å†…æ ¸æ—¥å¿— dmesg | grep -i error # æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿå®Œæ•´æ€§ fsck /dev/sdX ","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:3:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#222-å†…æ ¸å’Œ-initramfs-é—®é¢˜"},{"categories":["tech"],"content":" å¯åŠ¨æ€§èƒ½ä¼˜åŒ– 2.3.1 å¯åŠ¨æ—¶é—´åˆ†æ bash # ä½¿ç”¨ systemd-analyze åˆ†æå¯åŠ¨æ—¶é—´ systemd-analyze systemd-analyze blame systemd-analyze critical-chain # ç”Ÿæˆå¯åŠ¨æ—¶é—´æŠ¥å‘Š systemd-analyze plot \u003e boot-time.svg è¿™äº›å·¥å…·å¯ä»¥å¸®åŠ©ä½ åˆ†æç³»ç»Ÿå¯åŠ¨æ€§èƒ½ï¼š systemd-analyze æ˜¾ç¤ºæ€»å¯åŠ¨æ—¶é—´ï¼ŒåŒ…æ‹¬å†…æ ¸å’Œç”¨æˆ·ç©ºé—´çš„å¯åŠ¨è€—æ—¶ systemd-analyze blame æŒ‰è€—æ—¶æ’åºæ˜¾ç¤ºå„æœåŠ¡å¯åŠ¨æ—¶é—´ï¼Œæ‰¾å‡ºæœ€è€—æ—¶çš„æœåŠ¡ systemd-analyze critical-chain æ˜¾ç¤ºå…³é”®è·¯å¾„åˆ†æï¼Œæ‰¾å‡ºé˜»å¡å¯åŠ¨çš„æœåŠ¡é“¾ systemd-analyze plot ç”Ÿæˆå¯åŠ¨æ—¶é—´å›¾è¡¨ï¼Œå¯è§†åŒ–å„æœåŠ¡çš„å¯åŠ¨é¡ºåºå’Œè€—æ—¶ è¯†åˆ«åˆ°å¯åŠ¨é˜¶æ®µçš„æ€§èƒ½ç“¶é¢ˆåï¼Œå°±èƒ½æ®æ­¤ä¼˜åŒ–æœåŠ¡ä¾èµ–å…³ç³»ï¼ŒåŠ å¿«å¯åŠ¨é€Ÿåº¦ã€‚ 2.3.2 å¯åŠ¨ä¼˜åŒ–ç­–ç•¥ä¼˜åŒ–å¯åŠ¨é€Ÿåº¦å¯ä»¥ä»å¤šä¸ªå±‚é¢å…¥æ‰‹ï¼š ç¡¬ä»¶å±‚é¢ ä½¿ç”¨ SSD å­˜å‚¨æ˜¯æœ€ç›´æ¥æœ‰æ•ˆçš„ä¼˜åŒ–æ–¹æ³•ã€‚å›ºæ€ç¡¬ç›˜çš„éšæœºè¯»å†™æ€§èƒ½è¿œè¶…æœºæ¢°ç¡¬ç›˜ï¼Œèƒ½æ˜¾è‘—å‡å°‘æ–‡ä»¶ç³»ç»Ÿè®¿é—®å»¶è¿Ÿã€‚å¯åŠ¨æ—¶é—´é€šå¸¸å¯å‡å°‘ 50-80%ï¼Œç‰¹åˆ«æ˜¯å¯¹äºå¤§é‡å°æ–‡ä»¶è¯»å–çš„åœºæ™¯ã€‚é€‚ç”¨äºæ‰€æœ‰ç³»ç»Ÿï¼Œç‰¹åˆ«æ˜¯å¯åŠ¨æ—¶é—´è¾ƒé•¿çš„ç³»ç»Ÿã€‚ å†…æ ¸å±‚é¢ å¯ç”¨å†…æ ¸å¹¶è¡Œåˆå§‹åŒ–å¯ä»¥æå‡å¯åŠ¨é€Ÿåº¦ã€‚ç°ä»£å†…æ ¸æ”¯æŒå¹¶è¡Œåˆå§‹åŒ–ç¡¬ä»¶è®¾å¤‡ï¼Œå‡å°‘ä¸²è¡Œç­‰å¾…æ—¶é—´ã€‚é€šè¿‡å†…æ ¸å‚æ•°å¦‚ initcall_debug å’Œ acpi=noirq ç­‰å¯ä»¥ä¼˜åŒ–å¯åŠ¨æµç¨‹ï¼Œå‡å°‘ç¡¬ä»¶åˆå§‹åŒ–æ—¶é—´ã€‚ æœåŠ¡å±‚é¢ ä¼˜åŒ– systemd æœåŠ¡ä¾èµ–å…³ç³»å¯ä»¥å‡å°‘å¯åŠ¨å»¶è¿Ÿã€‚å‡å°‘ä¸å¿…è¦çš„æœåŠ¡ä¾èµ–ï¼Œé¿å…ä¸²è¡Œå¯åŠ¨é€ æˆçš„å»¶è¿Ÿã€‚ä½¿ç”¨ systemctl list-dependencies åˆ†æä¾èµ–å…³ç³»ï¼Œç§»é™¤ä¸å¿…è¦çš„ä¾èµ–ï¼Œå‡å°‘æœåŠ¡å¯åŠ¨ç­‰å¾…æ—¶é—´ï¼Œ æå‡å¹¶è¡Œå¯åŠ¨æ•ˆç‡ã€‚ å¯åŠ¨æµç¨‹ ä½¿ç”¨ UKIï¼ˆç»Ÿä¸€å†…æ ¸é•œåƒï¼‰å¯ä»¥å‡å°‘å¯åŠ¨æ­¥éª¤ã€‚å°†å†…æ ¸ã€initramfsã€cmdline æ‰“åŒ…æˆå•ä¸ª EFI æ–‡ä»¶ï¼Œ å‡å°‘å¯åŠ¨æ­¥éª¤å’Œæ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€‚å‡å°‘æ–‡ä»¶ç³»ç»ŸæŒ‚è½½æ¬¡æ•°ï¼Œç®€åŒ–å¯åŠ¨æµç¨‹ã€‚åœ¨ NixOS ä¸­é€šè¿‡boot.loader.systemd-boot.enable å’Œ boot.loader.efi.canTouchEfiVariables å¯ç”¨ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:3:3","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#å¯åŠ¨æ€§èƒ½ä¼˜åŒ–"},{"categories":["tech"],"content":" å¯åŠ¨æ€§èƒ½ä¼˜åŒ– 2.3.1 å¯åŠ¨æ—¶é—´åˆ†æ bash # ä½¿ç”¨ systemd-analyze åˆ†æå¯åŠ¨æ—¶é—´ systemd-analyze systemd-analyze blame systemd-analyze critical-chain # ç”Ÿæˆå¯åŠ¨æ—¶é—´æŠ¥å‘Š systemd-analyze plot \u003e boot-time.svg è¿™äº›å·¥å…·å¯ä»¥å¸®åŠ©ä½ åˆ†æç³»ç»Ÿå¯åŠ¨æ€§èƒ½ï¼š systemd-analyze æ˜¾ç¤ºæ€»å¯åŠ¨æ—¶é—´ï¼ŒåŒ…æ‹¬å†…æ ¸å’Œç”¨æˆ·ç©ºé—´çš„å¯åŠ¨è€—æ—¶ systemd-analyze blame æŒ‰è€—æ—¶æ’åºæ˜¾ç¤ºå„æœåŠ¡å¯åŠ¨æ—¶é—´ï¼Œæ‰¾å‡ºæœ€è€—æ—¶çš„æœåŠ¡ systemd-analyze critical-chain æ˜¾ç¤ºå…³é”®è·¯å¾„åˆ†æï¼Œæ‰¾å‡ºé˜»å¡å¯åŠ¨çš„æœåŠ¡é“¾ systemd-analyze plot ç”Ÿæˆå¯åŠ¨æ—¶é—´å›¾è¡¨ï¼Œå¯è§†åŒ–å„æœåŠ¡çš„å¯åŠ¨é¡ºåºå’Œè€—æ—¶ è¯†åˆ«åˆ°å¯åŠ¨é˜¶æ®µçš„æ€§èƒ½ç“¶é¢ˆåï¼Œå°±èƒ½æ®æ­¤ä¼˜åŒ–æœåŠ¡ä¾èµ–å…³ç³»ï¼ŒåŠ å¿«å¯åŠ¨é€Ÿåº¦ã€‚ 2.3.2 å¯åŠ¨ä¼˜åŒ–ç­–ç•¥ä¼˜åŒ–å¯åŠ¨é€Ÿåº¦å¯ä»¥ä»å¤šä¸ªå±‚é¢å…¥æ‰‹ï¼š ç¡¬ä»¶å±‚é¢ ä½¿ç”¨ SSD å­˜å‚¨æ˜¯æœ€ç›´æ¥æœ‰æ•ˆçš„ä¼˜åŒ–æ–¹æ³•ã€‚å›ºæ€ç¡¬ç›˜çš„éšæœºè¯»å†™æ€§èƒ½è¿œè¶…æœºæ¢°ç¡¬ç›˜ï¼Œèƒ½æ˜¾è‘—å‡å°‘æ–‡ä»¶ç³»ç»Ÿè®¿é—®å»¶è¿Ÿã€‚å¯åŠ¨æ—¶é—´é€šå¸¸å¯å‡å°‘ 50-80%ï¼Œç‰¹åˆ«æ˜¯å¯¹äºå¤§é‡å°æ–‡ä»¶è¯»å–çš„åœºæ™¯ã€‚é€‚ç”¨äºæ‰€æœ‰ç³»ç»Ÿï¼Œç‰¹åˆ«æ˜¯å¯åŠ¨æ—¶é—´è¾ƒé•¿çš„ç³»ç»Ÿã€‚ å†…æ ¸å±‚é¢ å¯ç”¨å†…æ ¸å¹¶è¡Œåˆå§‹åŒ–å¯ä»¥æå‡å¯åŠ¨é€Ÿåº¦ã€‚ç°ä»£å†…æ ¸æ”¯æŒå¹¶è¡Œåˆå§‹åŒ–ç¡¬ä»¶è®¾å¤‡ï¼Œå‡å°‘ä¸²è¡Œç­‰å¾…æ—¶é—´ã€‚é€šè¿‡å†…æ ¸å‚æ•°å¦‚ initcall_debug å’Œ acpi=noirq ç­‰å¯ä»¥ä¼˜åŒ–å¯åŠ¨æµç¨‹ï¼Œå‡å°‘ç¡¬ä»¶åˆå§‹åŒ–æ—¶é—´ã€‚ æœåŠ¡å±‚é¢ ä¼˜åŒ– systemd æœåŠ¡ä¾èµ–å…³ç³»å¯ä»¥å‡å°‘å¯åŠ¨å»¶è¿Ÿã€‚å‡å°‘ä¸å¿…è¦çš„æœåŠ¡ä¾èµ–ï¼Œé¿å…ä¸²è¡Œå¯åŠ¨é€ æˆçš„å»¶è¿Ÿã€‚ä½¿ç”¨ systemctl list-dependencies åˆ†æä¾èµ–å…³ç³»ï¼Œç§»é™¤ä¸å¿…è¦çš„ä¾èµ–ï¼Œå‡å°‘æœåŠ¡å¯åŠ¨ç­‰å¾…æ—¶é—´ï¼Œ æå‡å¹¶è¡Œå¯åŠ¨æ•ˆç‡ã€‚ å¯åŠ¨æµç¨‹ ä½¿ç”¨ UKIï¼ˆç»Ÿä¸€å†…æ ¸é•œåƒï¼‰å¯ä»¥å‡å°‘å¯åŠ¨æ­¥éª¤ã€‚å°†å†…æ ¸ã€initramfsã€cmdline æ‰“åŒ…æˆå•ä¸ª EFI æ–‡ä»¶ï¼Œ å‡å°‘å¯åŠ¨æ­¥éª¤å’Œæ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€‚å‡å°‘æ–‡ä»¶ç³»ç»ŸæŒ‚è½½æ¬¡æ•°ï¼Œç®€åŒ–å¯åŠ¨æµç¨‹ã€‚åœ¨ NixOS ä¸­é€šè¿‡boot.loader.systemd-boot.enable å’Œ boot.loader.efi.canTouchEfiVariables å¯ç”¨ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:3:3","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#231-å¯åŠ¨æ—¶é—´åˆ†æ"},{"categories":["tech"],"content":" å¯åŠ¨æ€§èƒ½ä¼˜åŒ– 2.3.1 å¯åŠ¨æ—¶é—´åˆ†æ bash # ä½¿ç”¨ systemd-analyze åˆ†æå¯åŠ¨æ—¶é—´ systemd-analyze systemd-analyze blame systemd-analyze critical-chain # ç”Ÿæˆå¯åŠ¨æ—¶é—´æŠ¥å‘Š systemd-analyze plot \u003e boot-time.svg è¿™äº›å·¥å…·å¯ä»¥å¸®åŠ©ä½ åˆ†æç³»ç»Ÿå¯åŠ¨æ€§èƒ½ï¼š systemd-analyze æ˜¾ç¤ºæ€»å¯åŠ¨æ—¶é—´ï¼ŒåŒ…æ‹¬å†…æ ¸å’Œç”¨æˆ·ç©ºé—´çš„å¯åŠ¨è€—æ—¶ systemd-analyze blame æŒ‰è€—æ—¶æ’åºæ˜¾ç¤ºå„æœåŠ¡å¯åŠ¨æ—¶é—´ï¼Œæ‰¾å‡ºæœ€è€—æ—¶çš„æœåŠ¡ systemd-analyze critical-chain æ˜¾ç¤ºå…³é”®è·¯å¾„åˆ†æï¼Œæ‰¾å‡ºé˜»å¡å¯åŠ¨çš„æœåŠ¡é“¾ systemd-analyze plot ç”Ÿæˆå¯åŠ¨æ—¶é—´å›¾è¡¨ï¼Œå¯è§†åŒ–å„æœåŠ¡çš„å¯åŠ¨é¡ºåºå’Œè€—æ—¶ è¯†åˆ«åˆ°å¯åŠ¨é˜¶æ®µçš„æ€§èƒ½ç“¶é¢ˆåï¼Œå°±èƒ½æ®æ­¤ä¼˜åŒ–æœåŠ¡ä¾èµ–å…³ç³»ï¼ŒåŠ å¿«å¯åŠ¨é€Ÿåº¦ã€‚ 2.3.2 å¯åŠ¨ä¼˜åŒ–ç­–ç•¥ä¼˜åŒ–å¯åŠ¨é€Ÿåº¦å¯ä»¥ä»å¤šä¸ªå±‚é¢å…¥æ‰‹ï¼š ç¡¬ä»¶å±‚é¢ ä½¿ç”¨ SSD å­˜å‚¨æ˜¯æœ€ç›´æ¥æœ‰æ•ˆçš„ä¼˜åŒ–æ–¹æ³•ã€‚å›ºæ€ç¡¬ç›˜çš„éšæœºè¯»å†™æ€§èƒ½è¿œè¶…æœºæ¢°ç¡¬ç›˜ï¼Œèƒ½æ˜¾è‘—å‡å°‘æ–‡ä»¶ç³»ç»Ÿè®¿é—®å»¶è¿Ÿã€‚å¯åŠ¨æ—¶é—´é€šå¸¸å¯å‡å°‘ 50-80%ï¼Œç‰¹åˆ«æ˜¯å¯¹äºå¤§é‡å°æ–‡ä»¶è¯»å–çš„åœºæ™¯ã€‚é€‚ç”¨äºæ‰€æœ‰ç³»ç»Ÿï¼Œç‰¹åˆ«æ˜¯å¯åŠ¨æ—¶é—´è¾ƒé•¿çš„ç³»ç»Ÿã€‚ å†…æ ¸å±‚é¢ å¯ç”¨å†…æ ¸å¹¶è¡Œåˆå§‹åŒ–å¯ä»¥æå‡å¯åŠ¨é€Ÿåº¦ã€‚ç°ä»£å†…æ ¸æ”¯æŒå¹¶è¡Œåˆå§‹åŒ–ç¡¬ä»¶è®¾å¤‡ï¼Œå‡å°‘ä¸²è¡Œç­‰å¾…æ—¶é—´ã€‚é€šè¿‡å†…æ ¸å‚æ•°å¦‚ initcall_debug å’Œ acpi=noirq ç­‰å¯ä»¥ä¼˜åŒ–å¯åŠ¨æµç¨‹ï¼Œå‡å°‘ç¡¬ä»¶åˆå§‹åŒ–æ—¶é—´ã€‚ æœåŠ¡å±‚é¢ ä¼˜åŒ– systemd æœåŠ¡ä¾èµ–å…³ç³»å¯ä»¥å‡å°‘å¯åŠ¨å»¶è¿Ÿã€‚å‡å°‘ä¸å¿…è¦çš„æœåŠ¡ä¾èµ–ï¼Œé¿å…ä¸²è¡Œå¯åŠ¨é€ æˆçš„å»¶è¿Ÿã€‚ä½¿ç”¨ systemctl list-dependencies åˆ†æä¾èµ–å…³ç³»ï¼Œç§»é™¤ä¸å¿…è¦çš„ä¾èµ–ï¼Œå‡å°‘æœåŠ¡å¯åŠ¨ç­‰å¾…æ—¶é—´ï¼Œ æå‡å¹¶è¡Œå¯åŠ¨æ•ˆç‡ã€‚ å¯åŠ¨æµç¨‹ ä½¿ç”¨ UKIï¼ˆç»Ÿä¸€å†…æ ¸é•œåƒï¼‰å¯ä»¥å‡å°‘å¯åŠ¨æ­¥éª¤ã€‚å°†å†…æ ¸ã€initramfsã€cmdline æ‰“åŒ…æˆå•ä¸ª EFI æ–‡ä»¶ï¼Œ å‡å°‘å¯åŠ¨æ­¥éª¤å’Œæ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€‚å‡å°‘æ–‡ä»¶ç³»ç»ŸæŒ‚è½½æ¬¡æ•°ï¼Œç®€åŒ–å¯åŠ¨æµç¨‹ã€‚åœ¨ NixOS ä¸­é€šè¿‡boot.loader.systemd-boot.enable å’Œ boot.loader.efi.canTouchEfiVariables å¯ç”¨ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:3:3","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#232-å¯åŠ¨ä¼˜åŒ–ç­–ç•¥"},{"categories":["tech"],"content":" 3. ç³»ç»Ÿå®‰å…¨æ¡†æ¶ï¼šè®¤è¯ã€æˆæƒä¸å¯†é’¥ç®¡ç†ç°ä»£ Linux æ¡Œé¢ç³»ç»Ÿçš„å®‰å…¨æ¶æ„ç”±å¤šä¸ªç›¸äº’åä½œçš„ç»„ä»¶æ„æˆï¼ŒåŒ…æ‹¬ PAMï¼ˆè®¤è¯ï¼‰ã€PolicyKitï¼ˆæˆæƒï¼‰ã€ä»¥åŠæ¡Œé¢ç¯å¢ƒæä¾›çš„å¯†é’¥ç®¡ç†æœåŠ¡ã€‚è¿™äº›ç»„ä»¶å…±åŒæ„å»ºäº†ä¸€ä¸ªå¤šå±‚æ¬¡çš„å®‰å…¨é˜²æŠ¤ä½“ç³»ï¼Œæ—¢ä¿è¯äº†ç³»ç»Ÿçš„å®‰å…¨æ€§ï¼Œåˆæä¾›äº†è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒã€‚ NOTE: æ³¨æ„ PAM ä¸ PolicyKit çš„è®¾è®¡ç›®çš„éƒ½æ˜¯ä¸ºæ™®é€šç”¨æˆ·æä¾›æƒé™æå‡æ‰‹æ®µã€‚å¯¹ root ç”¨æˆ·è€Œè¨€ï¼Œè¿™äº›æ¡†æ¶çš„é™åˆ¶å¾ˆå°‘æˆ–å‡ ä¹ä¸å­˜åœ¨ã€‚å¦‚æœä½ å¸Œæœ›é™åˆ¶æ•´ä¸ªç³»ç»Ÿå…¨å±€çš„æƒé™ï¼ˆåŒ…æ‹¬ root ç”¨æˆ·ï¼‰ï¼Œ åº”è¯¥è€ƒè™‘ SELinux/AppArmor ç­‰å¼ºåˆ¶è®¿é—®æ§åˆ¶æ¡†æ¶ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:4:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#3-ç³»ç»Ÿå®‰å…¨æ¡†æ¶è®¤è¯æˆæƒä¸å¯†é’¥ç®¡ç†"},{"categories":["tech"],"content":" 3.1 PAM - å¯æ’æ‹”è®¤è¯æ¨¡å—PAMï¼ˆPluggable Authentication Modulesï¼‰ æ˜¯ Linux çš„ç»Ÿä¸€è®¤è¯æ¡†æ¶ï¼Œä¸ºç³»ç»Ÿä¸­çš„å„ç§ç¨‹åº ï¼ˆå¦‚ loginã€sudoã€sshdã€gdm ç­‰ï¼‰æä¾›æ ‡å‡†åŒ–çš„è®¤è¯æ¥å£ã€‚å€ŸåŠ© PAMï¼Œç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶çµæ´»æ§åˆ¶è®¤è¯ç­–ç•¥ï¼Œè€Œæ— éœ€ä¿®æ”¹åº”ç”¨ç¨‹åºæœ¬èº«ã€‚å®ƒæ”¯æŒå¤šç§è®¤è¯æ–¹å¼ï¼ˆå¯†ç ã€æŒ‡çº¹ã€æ™ºèƒ½å¡ã€åŒå› å­éªŒè¯ç­‰ï¼‰ï¼Œæ˜¯ç°ä»£ Linux å®‰å…¨ä½“ç³»çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ã€‚ 3.1.1 å·¥ä½œåŸç†ä¸é…ç½®ç»“æ„PAM é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œå°†è®¤è¯æµç¨‹åˆ†ä¸ºå››ä¸ªé˜¶æ®µã€‚åº”ç”¨ç¨‹åºé€šè¿‡è°ƒç”¨ç›¸åº”çš„ PAM æ¥å£è§¦å‘è¿™äº›é˜¶æ®µï¼Œ ç³»ç»Ÿæ ¹æ® /etc/pam.d/ ä¸‹çš„é…ç½®æ–‡ä»¶æ‰§è¡Œç›¸åº”çš„æ¨¡å—ï¼ˆ.so æ–‡ä»¶ï¼‰ã€‚ ï¼ˆ1ï¼‰é…ç½®æ–‡ä»¶è¯­æ³• https://linux.die.net/man/5/pam.d æ¯è¡Œçš„åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š text \u003ctype\u003e \u003ccontrol\u003e \u003cmodule\u003e [arguments] typeï¼šè¡¨ç¤ºé˜¶æ®µç±»å‹ controlï¼šå®šä¹‰è¯¥æ¨¡å—çš„æ‰§è¡Œç­–ç•¥ moduleï¼šå…·ä½“çš„ PAM æ¨¡å—è·¯å¾„ï¼ˆæˆ–åç§°ï¼‰ argumentsï¼šä¼ é€’ç»™æ¨¡å—çš„å‚æ•° ï¼ˆ2ï¼‰å››ä¸ªè®¤è¯é˜¶æ®µ é˜¶æ®µç±»å‹ è°ƒç”¨å‡½æ•° ä¸»è¦ä½œç”¨ auth pam_authenticate() éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œé€šå¸¸ä¼šæç¤ºç”¨æˆ·è¾“å‡ºå¯†ç æˆ–æŒ‡çº¹ä»¥å®ŒæˆéªŒè¯ account pam_acct_mgmt() æ£€æŸ¥è´¦æˆ·çŠ¶æ€ï¼ˆè¿‡æœŸã€é”å®šç­‰ï¼‰ password pam_chauthtok() å¤„ç†å¯†ç ä¿®æ”¹ session pam_open_session() / pam_close_session() å»ºç«‹å’Œæ¸…ç†ç”¨æˆ·ä¼šè¯ ï¼ˆ3ï¼‰æ§åˆ¶æ ‡å¿—ï¼ˆcontrolï¼‰ æ ‡å¿— å«ä¹‰ è¡Œä¸ºè¯´æ˜ required å¿…é¡»æˆåŠŸï¼Œå¤±è´¥ä¸ä¼šç«‹å³ç»ˆæ­¢ï¼Œä½†æœ€ç»ˆç»“æœä¼šå¤±è´¥ æ— è®ºæˆåŠŸå¤±è´¥ï¼Œéƒ½ä¼šç»§ç»­æ‰§è¡Œåç»­æ¨¡å—ã€‚æœ€ç»ˆåªè¦æœ‰ä¸€ä¸ª required å¤±è´¥ï¼Œæ•´ä¸ªè®¤è¯å°±å¤±è´¥ã€‚ requisite å¿…é¡»æˆåŠŸï¼Œå¤±è´¥ç«‹å³ç»ˆæ­¢å¹¶è¿”å›å¤±è´¥ å¤±è´¥ç«‹å³è¿”å›ï¼Œä¸å†æ‰§è¡Œåç»­æ¨¡å—ã€‚ sufficient æˆåŠŸåˆ™ç«‹å³é€šè¿‡è®¤è¯ï¼ˆè·³è¿‡æ‰€æœ‰åç»­æ¨¡å—ï¼‰ï¼›å¤±è´¥åˆ™ç»§ç»­ç”±åç»­æ¨¡å—è¿›è¡Œè®¤è¯ è‹¥å‰é¢æ²¡æœ‰ required å¤±è´¥ï¼Œåˆ™æˆåŠŸç›´æ¥é€šè¿‡ï¼›å¦åˆ™å¤±è´¥ä¸å½±å“åç»­ã€‚ optional å¯é€‰æ¨¡å—ï¼Œç»“æœé€šå¸¸è¢«å¿½ç•¥ æ— è®ºæˆåŠŸå¤±è´¥ï¼Œå¯¹æœ€ç»ˆç»“æœæ— ç›´æ¥å½±å“ï¼Œé™¤éæ˜¯æ ˆä¸­å”¯ä¸€çš„æ¨¡å—ã€‚ include åŒ…å«å¦ä¸€ä¸ªæ–‡ä»¶çš„é…ç½® å°†æŒ‡å®šæ–‡ä»¶çš„é…ç½®å†…å®¹åŒ…å«è¿›æ¥ï¼Œé€šå¸¸ç”¨äºå¤ç”¨é€šç”¨é…ç½®ï¼ˆå¦‚ system-authï¼‰ã€‚ substack è°ƒç”¨å­æ ˆ ç±»ä¼¼ includeï¼Œä½†å­æ ˆçš„å¤±è´¥ä¸å½±å“ä¸»æ ˆï¼ˆå³å­æ ˆåªèƒ½è·³è¿‡å…¶è‡ªèº«çš„åç»­æ­¥éª¤ï¼‰ï¼Œé™¤éä¸»æ ˆä¸­å¦æœ‰è®¾ç½®ã€‚ ï¼ˆ4ï¼‰å¸¸ç”¨æ¨¡å—ç¤ºä¾‹ bash pam_unix.so # åŸºäº /etc/passwd ä¸ /etc/shadow çš„æ ‡å‡†å¯†ç è®¤è¯ pam_google_authenticator.so # åŒå› å­è®¤è¯ï¼ˆTOTPï¼‰ pam_fprintd.so # æŒ‡çº¹è®¤è¯ pam_ldap.so # LDAP é›†ä¸­å¼è®¤è¯ pam_gnome_keyring.so # GNOME å¯†é’¥ç¯é›†æˆ pam_limits.so # ç”¨æˆ·èµ„æºé™åˆ¶ pam_deny.so # æ‹’ç»æ‰€æœ‰è®¤è¯è¯·æ±‚ 3.1.2 æ‰§è¡Œæµç¨‹ç¤ºä¾‹ä»¥ /etc/pam.d/sudo ä¸ºä¾‹ï¼š bash #%PAM-1.0 auth sufficient pam_rootok.so auth sufficient pam_timestamp.so auth required pam_wheel.so use_uid auth required pam_unix.so nullok try_first_pass å„æ¨¡å—çš„æ‰§è¡Œé¡ºåºå¦‚ä¸‹ï¼š æ‰§è¡Œ pam_rootok.so (sufficient)ï¼š æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦ä¸º rootã€‚ å¦‚æœæˆåŠŸï¼šPAM è®¤è¯æµç¨‹ç«‹å³æˆåŠŸï¼Œå¹¶è·³è¿‡åç»­æ‰€æœ‰ auth æ¨¡å—ã€‚ç”¨æˆ·ç›´æ¥è·å¾— sudo æƒé™ã€‚ å¦‚æœå¤±è´¥ï¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªæ¨¡å—ã€‚ æ‰§è¡Œ pam_timestamp.so (sufficient)ï¼š æ£€æŸ¥æ˜¯å¦å­˜åœ¨æœ‰æ•ˆçš„æ—¶é—´æˆ³æ–‡ä»¶ï¼ˆé»˜è®¤ä¸º 5 åˆ†é’Ÿå†…ï¼‰ã€‚ å¦‚æœæˆåŠŸï¼šPAM è®¤è¯æµç¨‹ç«‹å³æˆåŠŸï¼Œå¹¶è·³è¿‡åç»­æ‰€æœ‰ auth æ¨¡å—ã€‚ç”¨æˆ·å…å¯†ç è·å¾— sudo æƒé™ã€‚ å¦‚æœå¤±è´¥ï¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªæ¨¡å—ã€‚ æ‰§è¡Œ pam_wheel.so (required)ï¼š æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦åœ¨ wheel ç»„ï¼ˆæˆ– sudo ç»„ï¼Œå–å†³äºé…ç½®ï¼‰ä¸­ã€‚ æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½å¿…é¡»ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ª required æ¨¡å—ã€‚ä½†å…¶ç»“æœä¼šè¢«è®°å½•ä¸‹æ¥ã€‚ æ‰§è¡Œ pam_unix.so (required)ï¼š ä½¿ç”¨ nullok å’Œ try_first_pass å‚æ•°è¿›è¡Œå¯†ç éªŒè¯ã€‚ nullokï¼šå…è®¸ç©ºå¯†ç è´¦æˆ·ç™»å½•ã€‚ try_first_passï¼šå°è¯•ä½¿ç”¨å‰é¢æ¨¡å—ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰æä¾›çš„å¯†ç ã€‚å¯¹äº sudoï¼Œè¿™é€šå¸¸æŒ‡ä¹‹å‰ sudo æˆåŠŸæ—¶ç¼“å­˜çš„å¯†ç ã€‚ å¦‚æœå¯†ç æ­£ç¡®ï¼šæ­¤æ¨¡å—æˆåŠŸã€‚ å¦‚æœå¯†ç é”™è¯¯ï¼šæ­¤æ¨¡å—å¤±è´¥ã€‚ æœ€ç»ˆç»“æœåˆ¤å®šï¼š åœ¨æ‰€æœ‰ required æ¨¡å—æ‰§è¡Œå®Œæ¯•åï¼ŒPAM ä¼šæ£€æŸ¥å®ƒä»¬çš„ç»“æœã€‚ å¦‚æœä»»ä½•ä¸€ä¸ª required æ¨¡å—ï¼ˆpam_wheel.so æˆ– pam_unix.soï¼‰å¤±è´¥ï¼Œæ•´ä¸ªè®¤è¯æµç¨‹å¤±è´¥ã€‚ åªæœ‰å½“æ‰€æœ‰ required æ¨¡å—éƒ½æˆåŠŸæ—¶ï¼Œè®¤è¯æ‰æœ€ç»ˆæˆåŠŸã€‚ å¸¸ç”¨æ¨¡å—åŠå…¶å‚æ•°è¯´æ˜ï¼š pam_unix.so å‚æ•° (ç”¨äºå¯†ç éªŒè¯) è¿™æ˜¯æœ€æ ¸å¿ƒçš„å¯†ç è®¤è¯æ¨¡å—ï¼Œå¸¸è§äº auth å’Œ password ç±»å‹ã€‚ nullokï¼šå…è®¸ç©ºå¯†ç è´¦æˆ·é€šè¿‡è®¤è¯ã€‚å¦‚æœä¸åŠ æ­¤å‚æ•°ï¼Œç©ºå¯†ç è´¦æˆ·å°†æ— æ³•ç™»å½•ã€‚ try_first_passï¼šåœ¨æç¤ºç”¨æˆ·è¾“å…¥å¯†ç å‰ï¼Œå…ˆå°è¯•ä½¿ç”¨ä¹‹å‰æ ˆä¸­å·²ç¼“å­˜çš„å¯†ç ï¼ˆä¾‹å¦‚ï¼Œç”±pam_timestamp.so æˆ– pam_kwallet.so æä¾›çš„ï¼‰ã€‚ use_authtokï¼šå¼ºåˆ¶ä½¿ç”¨ä¹‹å‰æ ˆä¸­å·²ç¼“å­˜çš„å¯†ç ï¼Œå¦‚æœä¸å­˜åœ¨ç¼“å­˜å¯†ç ï¼Œåˆ™ç›´æ¥å¤±è´¥ã€‚å®ƒæ¯”try_first_pass æ›´ä¸¥æ ¼ï¼Œé€šå¸¸ç”¨åœ¨ä¿®æ”¹å¯†ç çš„ password æ¨¡å—æ ˆä¸­ï¼Œä»¥ç¡®ä¿ç”¨æˆ·è¾“å…¥çš„æ˜¯æ—§å¯†ç ã€‚ shadowï¼šä½¿ç”¨ /etc/shadow æ–‡ä»¶è¿›è¡Œå¯†ç éªŒè¯ï¼ˆç°ä»£ç³»ç»Ÿé»˜è®¤å¯ç”¨ï¼‰ã€‚ pam_timestamp.so å‚æ•° (ç”¨äºæ—¶é—´æˆ³è®¤è¯) å¸¸ç”¨äº sudoï¼Œå®ç°å…å¯†ç æ“ä½œã€‚ timestamp_timeout=600ï¼šè®¾ç½®æ—¶é—´æˆ³çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’ã€‚é»˜è®¤æ˜¯ 300 (5åˆ†é’Ÿ)ã€‚ pam_wheel.so å‚æ•° (ç”¨äºç»„æˆå‘˜èµ„æ ¼æ£€æŸ¥) ç”¨äºé™åˆ¶åªæœ‰ç‰¹å®šç»„çš„ç”¨æˆ·æ‰èƒ½ä½¿ç”¨ su æˆ– sudoã€‚ use_uidï¼šæ£€æŸ¥å‘èµ·è¯·æ±‚çš„åŸå§‹ç”¨æˆ· IDï¼Œè€Œä¸æ˜¯å½“å‰ç”¨æˆ· IDï¼ˆåœ¨ sudo åœºæ™¯ä¸‹å¾ˆé‡è¦ï¼‰ã€‚ group=adminsï¼šæŒ‡å®šæ£€æŸ¥çš„ç»„åï¼Œé»˜è®¤æ˜¯ wheelã€‚ pam_gnome_keyring.so å‚æ•° (ç”¨äºä¼šè¯ç®¡ç†) è¿™ä¸ªæ¨¡å—ä¸ sudo çš„è®¤è¯æµç¨‹æ— å…³ï¼Œä¸»è¦ç”¨äºç”¨æˆ·ç™»å½•æ—¶è§£é”å¯†é’¥ç¯ã€‚ auto_startï¼šåœ¨ä¼šè¯å¯åŠ¨æ—¶ï¼Œå¦‚æœç”¨æˆ·å¯†ç ä¸å¯†é’¥ç¯å¯†ç ç›¸åŒï¼Œåˆ™è‡ªåŠ¨è§£é”å¯†é’¥ç¯ã€‚ å…¸å‹åº”ç”¨åœºæ™¯ï¼šåœ¨ /etc/pam.d/gdm-password æˆ– /etc/pam.d/login çš„ auth å’Œsession éƒ¨åˆ†ã€‚ bash # åœ¨ /etc/pam.d/gdm-password ä¸­ auth optional pam_gnome_keyring.so session optional pam_gnome_keyring.so auto_start 3.1.3 åº”ç”¨ç¨‹åºä¸ PAM çš„äº¤äº’ç¨‹åºé€šè¿‡ pam_start() æŒ‡å®šæœåŠ¡åï¼Œç³»ç»Ÿæ®æ­¤åŠ è½½å¯¹åº”çš„é…ç½®æ–‡ä»¶ã€‚ ç¨‹åº æœåŠ¡å é…ç½®æ–‡ä»¶ åŠŸèƒ½ login \"login\" /etc/pam.d/login æ§åˆ¶å°ç™»å½• gdm \"gdm\" /etc/pam.d/gdm GNOME ç™»å½•ç•Œé¢ sudo \"sudo\" /etc/pam.d/sudo ææƒå‘½ä»¤ sshd \"sshd\" /etc/pam.d/sshd SSH ç™»å½• greetd \"greetd\" /etc/pam.d/greetd è½»é‡æ˜¾ç¤ºç®¡ç†å™¨ ä¸€ä¸ªå…¸å‹çš„è°ƒç”¨é¡ºåºå¦‚ä¸‹ï¼ˆä»¥ sudo ä¸ºä¾‹ï¼‰ï¼š c pam_start(\"sudo\", user, \u0026conv, \u0026pamh); // åˆå§‹åŒ– PAM pam_authenticate(pamh, 0); // èº«ä»½éªŒè¯ pam_acct_mgmt(pamh, 0); // è´¦æˆ·æ£€æŸ¥ pam_open_session(pamh, 0); // æ‰“å¼€ä¼šè¯ // æ‰§è¡Œç”¨æˆ·å‘½ä»¤ pam_close_session(pamh, 0); // å…³é—­ä¼šè¯ pam_end(pamh, PAM_SUCCESS); // é‡Šæ”¾èµ„æº å¦‚ä¸‹æ˜¯ä¸€ä¸ªç”¨æˆ·ç™»å½•æµç¨‹çš„ PAM è°ƒç”¨ç¤ºä¾‹ï¼š c #include \u003cstdio.h\u003e #include \u003cstdlib.h\u003e #include \u003csecurity/pam_appl.h\u003e #include \u003csecurity/pam_misc.h\u003e static void log_result(pam_handle_t *pamh, int ret, const char *step) { if (ret == PAM_SUCCESS) { printf(\"[âœ“] %s æˆåŠŸ\\n\", step); } else { fprintf(stderr, \"[âœ—] %s å¤±è´¥: %sï¼ˆè¿”å›ç  %dï¼‰\\n\", step, pam_strerror(pamh, ret), ret); } } int main(int argc, char *argv[]) { pam_handle_t *p","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:4:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#31-pam---å¯æ’æ‹”è®¤è¯æ¨¡å—"},{"categories":["tech"],"content":" 3.1 PAM - å¯æ’æ‹”è®¤è¯æ¨¡å—PAMï¼ˆPluggable Authentication Modulesï¼‰ æ˜¯ Linux çš„ç»Ÿä¸€è®¤è¯æ¡†æ¶ï¼Œä¸ºç³»ç»Ÿä¸­çš„å„ç§ç¨‹åº ï¼ˆå¦‚ loginã€sudoã€sshdã€gdm ç­‰ï¼‰æä¾›æ ‡å‡†åŒ–çš„è®¤è¯æ¥å£ã€‚å€ŸåŠ© PAMï¼Œç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶çµæ´»æ§åˆ¶è®¤è¯ç­–ç•¥ï¼Œè€Œæ— éœ€ä¿®æ”¹åº”ç”¨ç¨‹åºæœ¬èº«ã€‚å®ƒæ”¯æŒå¤šç§è®¤è¯æ–¹å¼ï¼ˆå¯†ç ã€æŒ‡çº¹ã€æ™ºèƒ½å¡ã€åŒå› å­éªŒè¯ç­‰ï¼‰ï¼Œæ˜¯ç°ä»£ Linux å®‰å…¨ä½“ç³»çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ã€‚ 3.1.1 å·¥ä½œåŸç†ä¸é…ç½®ç»“æ„PAM é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œå°†è®¤è¯æµç¨‹åˆ†ä¸ºå››ä¸ªé˜¶æ®µã€‚åº”ç”¨ç¨‹åºé€šè¿‡è°ƒç”¨ç›¸åº”çš„ PAM æ¥å£è§¦å‘è¿™äº›é˜¶æ®µï¼Œ ç³»ç»Ÿæ ¹æ® /etc/pam.d/ ä¸‹çš„é…ç½®æ–‡ä»¶æ‰§è¡Œç›¸åº”çš„æ¨¡å—ï¼ˆ.so æ–‡ä»¶ï¼‰ã€‚ ï¼ˆ1ï¼‰é…ç½®æ–‡ä»¶è¯­æ³• https://linux.die.net/man/5/pam.d æ¯è¡Œçš„åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š text [arguments] typeï¼šè¡¨ç¤ºé˜¶æ®µç±»å‹ controlï¼šå®šä¹‰è¯¥æ¨¡å—çš„æ‰§è¡Œç­–ç•¥ moduleï¼šå…·ä½“çš„ PAM æ¨¡å—è·¯å¾„ï¼ˆæˆ–åç§°ï¼‰ argumentsï¼šä¼ é€’ç»™æ¨¡å—çš„å‚æ•° ï¼ˆ2ï¼‰å››ä¸ªè®¤è¯é˜¶æ®µ é˜¶æ®µç±»å‹ è°ƒç”¨å‡½æ•° ä¸»è¦ä½œç”¨ auth pam_authenticate() éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œé€šå¸¸ä¼šæç¤ºç”¨æˆ·è¾“å‡ºå¯†ç æˆ–æŒ‡çº¹ä»¥å®ŒæˆéªŒè¯ account pam_acct_mgmt() æ£€æŸ¥è´¦æˆ·çŠ¶æ€ï¼ˆè¿‡æœŸã€é”å®šç­‰ï¼‰ password pam_chauthtok() å¤„ç†å¯†ç ä¿®æ”¹ session pam_open_session() / pam_close_session() å»ºç«‹å’Œæ¸…ç†ç”¨æˆ·ä¼šè¯ ï¼ˆ3ï¼‰æ§åˆ¶æ ‡å¿—ï¼ˆcontrolï¼‰ æ ‡å¿— å«ä¹‰ è¡Œä¸ºè¯´æ˜ required å¿…é¡»æˆåŠŸï¼Œå¤±è´¥ä¸ä¼šç«‹å³ç»ˆæ­¢ï¼Œä½†æœ€ç»ˆç»“æœä¼šå¤±è´¥ æ— è®ºæˆåŠŸå¤±è´¥ï¼Œéƒ½ä¼šç»§ç»­æ‰§è¡Œåç»­æ¨¡å—ã€‚æœ€ç»ˆåªè¦æœ‰ä¸€ä¸ª required å¤±è´¥ï¼Œæ•´ä¸ªè®¤è¯å°±å¤±è´¥ã€‚ requisite å¿…é¡»æˆåŠŸï¼Œå¤±è´¥ç«‹å³ç»ˆæ­¢å¹¶è¿”å›å¤±è´¥ å¤±è´¥ç«‹å³è¿”å›ï¼Œä¸å†æ‰§è¡Œåç»­æ¨¡å—ã€‚ sufficient æˆåŠŸåˆ™ç«‹å³é€šè¿‡è®¤è¯ï¼ˆè·³è¿‡æ‰€æœ‰åç»­æ¨¡å—ï¼‰ï¼›å¤±è´¥åˆ™ç»§ç»­ç”±åç»­æ¨¡å—è¿›è¡Œè®¤è¯ è‹¥å‰é¢æ²¡æœ‰ required å¤±è´¥ï¼Œåˆ™æˆåŠŸç›´æ¥é€šè¿‡ï¼›å¦åˆ™å¤±è´¥ä¸å½±å“åç»­ã€‚ optional å¯é€‰æ¨¡å—ï¼Œç»“æœé€šå¸¸è¢«å¿½ç•¥ æ— è®ºæˆåŠŸå¤±è´¥ï¼Œå¯¹æœ€ç»ˆç»“æœæ— ç›´æ¥å½±å“ï¼Œé™¤éæ˜¯æ ˆä¸­å”¯ä¸€çš„æ¨¡å—ã€‚ include åŒ…å«å¦ä¸€ä¸ªæ–‡ä»¶çš„é…ç½® å°†æŒ‡å®šæ–‡ä»¶çš„é…ç½®å†…å®¹åŒ…å«è¿›æ¥ï¼Œé€šå¸¸ç”¨äºå¤ç”¨é€šç”¨é…ç½®ï¼ˆå¦‚ system-authï¼‰ã€‚ substack è°ƒç”¨å­æ ˆ ç±»ä¼¼ includeï¼Œä½†å­æ ˆçš„å¤±è´¥ä¸å½±å“ä¸»æ ˆï¼ˆå³å­æ ˆåªèƒ½è·³è¿‡å…¶è‡ªèº«çš„åç»­æ­¥éª¤ï¼‰ï¼Œé™¤éä¸»æ ˆä¸­å¦æœ‰è®¾ç½®ã€‚ ï¼ˆ4ï¼‰å¸¸ç”¨æ¨¡å—ç¤ºä¾‹ bash pam_unix.so # åŸºäº /etc/passwd ä¸ /etc/shadow çš„æ ‡å‡†å¯†ç è®¤è¯ pam_google_authenticator.so # åŒå› å­è®¤è¯ï¼ˆTOTPï¼‰ pam_fprintd.so # æŒ‡çº¹è®¤è¯ pam_ldap.so # LDAP é›†ä¸­å¼è®¤è¯ pam_gnome_keyring.so # GNOME å¯†é’¥ç¯é›†æˆ pam_limits.so # ç”¨æˆ·èµ„æºé™åˆ¶ pam_deny.so # æ‹’ç»æ‰€æœ‰è®¤è¯è¯·æ±‚ 3.1.2 æ‰§è¡Œæµç¨‹ç¤ºä¾‹ä»¥ /etc/pam.d/sudo ä¸ºä¾‹ï¼š bash #%PAM-1.0 auth sufficient pam_rootok.so auth sufficient pam_timestamp.so auth required pam_wheel.so use_uid auth required pam_unix.so nullok try_first_pass å„æ¨¡å—çš„æ‰§è¡Œé¡ºåºå¦‚ä¸‹ï¼š æ‰§è¡Œ pam_rootok.so (sufficient)ï¼š æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦ä¸º rootã€‚ å¦‚æœæˆåŠŸï¼šPAM è®¤è¯æµç¨‹ç«‹å³æˆåŠŸï¼Œå¹¶è·³è¿‡åç»­æ‰€æœ‰ auth æ¨¡å—ã€‚ç”¨æˆ·ç›´æ¥è·å¾— sudo æƒé™ã€‚ å¦‚æœå¤±è´¥ï¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªæ¨¡å—ã€‚ æ‰§è¡Œ pam_timestamp.so (sufficient)ï¼š æ£€æŸ¥æ˜¯å¦å­˜åœ¨æœ‰æ•ˆçš„æ—¶é—´æˆ³æ–‡ä»¶ï¼ˆé»˜è®¤ä¸º 5 åˆ†é’Ÿå†…ï¼‰ã€‚ å¦‚æœæˆåŠŸï¼šPAM è®¤è¯æµç¨‹ç«‹å³æˆåŠŸï¼Œå¹¶è·³è¿‡åç»­æ‰€æœ‰ auth æ¨¡å—ã€‚ç”¨æˆ·å…å¯†ç è·å¾— sudo æƒé™ã€‚ å¦‚æœå¤±è´¥ï¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªæ¨¡å—ã€‚ æ‰§è¡Œ pam_wheel.so (required)ï¼š æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦åœ¨ wheel ç»„ï¼ˆæˆ– sudo ç»„ï¼Œå–å†³äºé…ç½®ï¼‰ä¸­ã€‚ æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½å¿…é¡»ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ª required æ¨¡å—ã€‚ä½†å…¶ç»“æœä¼šè¢«è®°å½•ä¸‹æ¥ã€‚ æ‰§è¡Œ pam_unix.so (required)ï¼š ä½¿ç”¨ nullok å’Œ try_first_pass å‚æ•°è¿›è¡Œå¯†ç éªŒè¯ã€‚ nullokï¼šå…è®¸ç©ºå¯†ç è´¦æˆ·ç™»å½•ã€‚ try_first_passï¼šå°è¯•ä½¿ç”¨å‰é¢æ¨¡å—ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰æä¾›çš„å¯†ç ã€‚å¯¹äº sudoï¼Œè¿™é€šå¸¸æŒ‡ä¹‹å‰ sudo æˆåŠŸæ—¶ç¼“å­˜çš„å¯†ç ã€‚ å¦‚æœå¯†ç æ­£ç¡®ï¼šæ­¤æ¨¡å—æˆåŠŸã€‚ å¦‚æœå¯†ç é”™è¯¯ï¼šæ­¤æ¨¡å—å¤±è´¥ã€‚ æœ€ç»ˆç»“æœåˆ¤å®šï¼š åœ¨æ‰€æœ‰ required æ¨¡å—æ‰§è¡Œå®Œæ¯•åï¼ŒPAM ä¼šæ£€æŸ¥å®ƒä»¬çš„ç»“æœã€‚ å¦‚æœä»»ä½•ä¸€ä¸ª required æ¨¡å—ï¼ˆpam_wheel.so æˆ– pam_unix.soï¼‰å¤±è´¥ï¼Œæ•´ä¸ªè®¤è¯æµç¨‹å¤±è´¥ã€‚ åªæœ‰å½“æ‰€æœ‰ required æ¨¡å—éƒ½æˆåŠŸæ—¶ï¼Œè®¤è¯æ‰æœ€ç»ˆæˆåŠŸã€‚ å¸¸ç”¨æ¨¡å—åŠå…¶å‚æ•°è¯´æ˜ï¼š pam_unix.so å‚æ•° (ç”¨äºå¯†ç éªŒè¯) è¿™æ˜¯æœ€æ ¸å¿ƒçš„å¯†ç è®¤è¯æ¨¡å—ï¼Œå¸¸è§äº auth å’Œ password ç±»å‹ã€‚ nullokï¼šå…è®¸ç©ºå¯†ç è´¦æˆ·é€šè¿‡è®¤è¯ã€‚å¦‚æœä¸åŠ æ­¤å‚æ•°ï¼Œç©ºå¯†ç è´¦æˆ·å°†æ— æ³•ç™»å½•ã€‚ try_first_passï¼šåœ¨æç¤ºç”¨æˆ·è¾“å…¥å¯†ç å‰ï¼Œå…ˆå°è¯•ä½¿ç”¨ä¹‹å‰æ ˆä¸­å·²ç¼“å­˜çš„å¯†ç ï¼ˆä¾‹å¦‚ï¼Œç”±pam_timestamp.so æˆ– pam_kwallet.so æä¾›çš„ï¼‰ã€‚ use_authtokï¼šå¼ºåˆ¶ä½¿ç”¨ä¹‹å‰æ ˆä¸­å·²ç¼“å­˜çš„å¯†ç ï¼Œå¦‚æœä¸å­˜åœ¨ç¼“å­˜å¯†ç ï¼Œåˆ™ç›´æ¥å¤±è´¥ã€‚å®ƒæ¯”try_first_pass æ›´ä¸¥æ ¼ï¼Œé€šå¸¸ç”¨åœ¨ä¿®æ”¹å¯†ç çš„ password æ¨¡å—æ ˆä¸­ï¼Œä»¥ç¡®ä¿ç”¨æˆ·è¾“å…¥çš„æ˜¯æ—§å¯†ç ã€‚ shadowï¼šä½¿ç”¨ /etc/shadow æ–‡ä»¶è¿›è¡Œå¯†ç éªŒè¯ï¼ˆç°ä»£ç³»ç»Ÿé»˜è®¤å¯ç”¨ï¼‰ã€‚ pam_timestamp.so å‚æ•° (ç”¨äºæ—¶é—´æˆ³è®¤è¯) å¸¸ç”¨äº sudoï¼Œå®ç°å…å¯†ç æ“ä½œã€‚ timestamp_timeout=600ï¼šè®¾ç½®æ—¶é—´æˆ³çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’ã€‚é»˜è®¤æ˜¯ 300 (5åˆ†é’Ÿ)ã€‚ pam_wheel.so å‚æ•° (ç”¨äºç»„æˆå‘˜èµ„æ ¼æ£€æŸ¥) ç”¨äºé™åˆ¶åªæœ‰ç‰¹å®šç»„çš„ç”¨æˆ·æ‰èƒ½ä½¿ç”¨ su æˆ– sudoã€‚ use_uidï¼šæ£€æŸ¥å‘èµ·è¯·æ±‚çš„åŸå§‹ç”¨æˆ· IDï¼Œè€Œä¸æ˜¯å½“å‰ç”¨æˆ· IDï¼ˆåœ¨ sudo åœºæ™¯ä¸‹å¾ˆé‡è¦ï¼‰ã€‚ group=adminsï¼šæŒ‡å®šæ£€æŸ¥çš„ç»„åï¼Œé»˜è®¤æ˜¯ wheelã€‚ pam_gnome_keyring.so å‚æ•° (ç”¨äºä¼šè¯ç®¡ç†) è¿™ä¸ªæ¨¡å—ä¸ sudo çš„è®¤è¯æµç¨‹æ— å…³ï¼Œä¸»è¦ç”¨äºç”¨æˆ·ç™»å½•æ—¶è§£é”å¯†é’¥ç¯ã€‚ auto_startï¼šåœ¨ä¼šè¯å¯åŠ¨æ—¶ï¼Œå¦‚æœç”¨æˆ·å¯†ç ä¸å¯†é’¥ç¯å¯†ç ç›¸åŒï¼Œåˆ™è‡ªåŠ¨è§£é”å¯†é’¥ç¯ã€‚ å…¸å‹åº”ç”¨åœºæ™¯ï¼šåœ¨ /etc/pam.d/gdm-password æˆ– /etc/pam.d/login çš„ auth å’Œsession éƒ¨åˆ†ã€‚ bash # åœ¨ /etc/pam.d/gdm-password ä¸­ auth optional pam_gnome_keyring.so session optional pam_gnome_keyring.so auto_start 3.1.3 åº”ç”¨ç¨‹åºä¸ PAM çš„äº¤äº’ç¨‹åºé€šè¿‡ pam_start() æŒ‡å®šæœåŠ¡åï¼Œç³»ç»Ÿæ®æ­¤åŠ è½½å¯¹åº”çš„é…ç½®æ–‡ä»¶ã€‚ ç¨‹åº æœåŠ¡å é…ç½®æ–‡ä»¶ åŠŸèƒ½ login \"login\" /etc/pam.d/login æ§åˆ¶å°ç™»å½• gdm \"gdm\" /etc/pam.d/gdm GNOME ç™»å½•ç•Œé¢ sudo \"sudo\" /etc/pam.d/sudo ææƒå‘½ä»¤ sshd \"sshd\" /etc/pam.d/sshd SSH ç™»å½• greetd \"greetd\" /etc/pam.d/greetd è½»é‡æ˜¾ç¤ºç®¡ç†å™¨ ä¸€ä¸ªå…¸å‹çš„è°ƒç”¨é¡ºåºå¦‚ä¸‹ï¼ˆä»¥ sudo ä¸ºä¾‹ï¼‰ï¼š c pam_start(\"sudo\", user, \u0026conv, \u0026pamh); // åˆå§‹åŒ– PAM pam_authenticate(pamh, 0); // èº«ä»½éªŒè¯ pam_acct_mgmt(pamh, 0); // è´¦æˆ·æ£€æŸ¥ pam_open_session(pamh, 0); // æ‰“å¼€ä¼šè¯ // æ‰§è¡Œç”¨æˆ·å‘½ä»¤ pam_close_session(pamh, 0); // å…³é—­ä¼šè¯ pam_end(pamh, PAM_SUCCESS); // é‡Šæ”¾èµ„æº å¦‚ä¸‹æ˜¯ä¸€ä¸ªç”¨æˆ·ç™»å½•æµç¨‹çš„ PAM è°ƒç”¨ç¤ºä¾‹ï¼š c #include #include #include #include static void log_result(pam_handle_t *pamh, int ret, const char *step) { if (ret == PAM_SUCCESS) { printf(\"[âœ“] %s æˆåŠŸ\\n\", step); } else { fprintf(stderr, \"[âœ—] %s å¤±è´¥: %sï¼ˆè¿”å›ç  %dï¼‰\\n\", step, pam_strerror(pamh, ret), ret); } } int main(int argc, char *argv[]) { pam_handle_t *p","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:4:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#311-å·¥ä½œåŸç†ä¸é…ç½®ç»“æ„"},{"categories":["tech"],"content":" 3.1 PAM - å¯æ’æ‹”è®¤è¯æ¨¡å—PAMï¼ˆPluggable Authentication Modulesï¼‰ æ˜¯ Linux çš„ç»Ÿä¸€è®¤è¯æ¡†æ¶ï¼Œä¸ºç³»ç»Ÿä¸­çš„å„ç§ç¨‹åº ï¼ˆå¦‚ loginã€sudoã€sshdã€gdm ç­‰ï¼‰æä¾›æ ‡å‡†åŒ–çš„è®¤è¯æ¥å£ã€‚å€ŸåŠ© PAMï¼Œç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶çµæ´»æ§åˆ¶è®¤è¯ç­–ç•¥ï¼Œè€Œæ— éœ€ä¿®æ”¹åº”ç”¨ç¨‹åºæœ¬èº«ã€‚å®ƒæ”¯æŒå¤šç§è®¤è¯æ–¹å¼ï¼ˆå¯†ç ã€æŒ‡çº¹ã€æ™ºèƒ½å¡ã€åŒå› å­éªŒè¯ç­‰ï¼‰ï¼Œæ˜¯ç°ä»£ Linux å®‰å…¨ä½“ç³»çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ã€‚ 3.1.1 å·¥ä½œåŸç†ä¸é…ç½®ç»“æ„PAM é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œå°†è®¤è¯æµç¨‹åˆ†ä¸ºå››ä¸ªé˜¶æ®µã€‚åº”ç”¨ç¨‹åºé€šè¿‡è°ƒç”¨ç›¸åº”çš„ PAM æ¥å£è§¦å‘è¿™äº›é˜¶æ®µï¼Œ ç³»ç»Ÿæ ¹æ® /etc/pam.d/ ä¸‹çš„é…ç½®æ–‡ä»¶æ‰§è¡Œç›¸åº”çš„æ¨¡å—ï¼ˆ.so æ–‡ä»¶ï¼‰ã€‚ ï¼ˆ1ï¼‰é…ç½®æ–‡ä»¶è¯­æ³• https://linux.die.net/man/5/pam.d æ¯è¡Œçš„åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š text [arguments] typeï¼šè¡¨ç¤ºé˜¶æ®µç±»å‹ controlï¼šå®šä¹‰è¯¥æ¨¡å—çš„æ‰§è¡Œç­–ç•¥ moduleï¼šå…·ä½“çš„ PAM æ¨¡å—è·¯å¾„ï¼ˆæˆ–åç§°ï¼‰ argumentsï¼šä¼ é€’ç»™æ¨¡å—çš„å‚æ•° ï¼ˆ2ï¼‰å››ä¸ªè®¤è¯é˜¶æ®µ é˜¶æ®µç±»å‹ è°ƒç”¨å‡½æ•° ä¸»è¦ä½œç”¨ auth pam_authenticate() éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œé€šå¸¸ä¼šæç¤ºç”¨æˆ·è¾“å‡ºå¯†ç æˆ–æŒ‡çº¹ä»¥å®ŒæˆéªŒè¯ account pam_acct_mgmt() æ£€æŸ¥è´¦æˆ·çŠ¶æ€ï¼ˆè¿‡æœŸã€é”å®šç­‰ï¼‰ password pam_chauthtok() å¤„ç†å¯†ç ä¿®æ”¹ session pam_open_session() / pam_close_session() å»ºç«‹å’Œæ¸…ç†ç”¨æˆ·ä¼šè¯ ï¼ˆ3ï¼‰æ§åˆ¶æ ‡å¿—ï¼ˆcontrolï¼‰ æ ‡å¿— å«ä¹‰ è¡Œä¸ºè¯´æ˜ required å¿…é¡»æˆåŠŸï¼Œå¤±è´¥ä¸ä¼šç«‹å³ç»ˆæ­¢ï¼Œä½†æœ€ç»ˆç»“æœä¼šå¤±è´¥ æ— è®ºæˆåŠŸå¤±è´¥ï¼Œéƒ½ä¼šç»§ç»­æ‰§è¡Œåç»­æ¨¡å—ã€‚æœ€ç»ˆåªè¦æœ‰ä¸€ä¸ª required å¤±è´¥ï¼Œæ•´ä¸ªè®¤è¯å°±å¤±è´¥ã€‚ requisite å¿…é¡»æˆåŠŸï¼Œå¤±è´¥ç«‹å³ç»ˆæ­¢å¹¶è¿”å›å¤±è´¥ å¤±è´¥ç«‹å³è¿”å›ï¼Œä¸å†æ‰§è¡Œåç»­æ¨¡å—ã€‚ sufficient æˆåŠŸåˆ™ç«‹å³é€šè¿‡è®¤è¯ï¼ˆè·³è¿‡æ‰€æœ‰åç»­æ¨¡å—ï¼‰ï¼›å¤±è´¥åˆ™ç»§ç»­ç”±åç»­æ¨¡å—è¿›è¡Œè®¤è¯ è‹¥å‰é¢æ²¡æœ‰ required å¤±è´¥ï¼Œåˆ™æˆåŠŸç›´æ¥é€šè¿‡ï¼›å¦åˆ™å¤±è´¥ä¸å½±å“åç»­ã€‚ optional å¯é€‰æ¨¡å—ï¼Œç»“æœé€šå¸¸è¢«å¿½ç•¥ æ— è®ºæˆåŠŸå¤±è´¥ï¼Œå¯¹æœ€ç»ˆç»“æœæ— ç›´æ¥å½±å“ï¼Œé™¤éæ˜¯æ ˆä¸­å”¯ä¸€çš„æ¨¡å—ã€‚ include åŒ…å«å¦ä¸€ä¸ªæ–‡ä»¶çš„é…ç½® å°†æŒ‡å®šæ–‡ä»¶çš„é…ç½®å†…å®¹åŒ…å«è¿›æ¥ï¼Œé€šå¸¸ç”¨äºå¤ç”¨é€šç”¨é…ç½®ï¼ˆå¦‚ system-authï¼‰ã€‚ substack è°ƒç”¨å­æ ˆ ç±»ä¼¼ includeï¼Œä½†å­æ ˆçš„å¤±è´¥ä¸å½±å“ä¸»æ ˆï¼ˆå³å­æ ˆåªèƒ½è·³è¿‡å…¶è‡ªèº«çš„åç»­æ­¥éª¤ï¼‰ï¼Œé™¤éä¸»æ ˆä¸­å¦æœ‰è®¾ç½®ã€‚ ï¼ˆ4ï¼‰å¸¸ç”¨æ¨¡å—ç¤ºä¾‹ bash pam_unix.so # åŸºäº /etc/passwd ä¸ /etc/shadow çš„æ ‡å‡†å¯†ç è®¤è¯ pam_google_authenticator.so # åŒå› å­è®¤è¯ï¼ˆTOTPï¼‰ pam_fprintd.so # æŒ‡çº¹è®¤è¯ pam_ldap.so # LDAP é›†ä¸­å¼è®¤è¯ pam_gnome_keyring.so # GNOME å¯†é’¥ç¯é›†æˆ pam_limits.so # ç”¨æˆ·èµ„æºé™åˆ¶ pam_deny.so # æ‹’ç»æ‰€æœ‰è®¤è¯è¯·æ±‚ 3.1.2 æ‰§è¡Œæµç¨‹ç¤ºä¾‹ä»¥ /etc/pam.d/sudo ä¸ºä¾‹ï¼š bash #%PAM-1.0 auth sufficient pam_rootok.so auth sufficient pam_timestamp.so auth required pam_wheel.so use_uid auth required pam_unix.so nullok try_first_pass å„æ¨¡å—çš„æ‰§è¡Œé¡ºåºå¦‚ä¸‹ï¼š æ‰§è¡Œ pam_rootok.so (sufficient)ï¼š æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦ä¸º rootã€‚ å¦‚æœæˆåŠŸï¼šPAM è®¤è¯æµç¨‹ç«‹å³æˆåŠŸï¼Œå¹¶è·³è¿‡åç»­æ‰€æœ‰ auth æ¨¡å—ã€‚ç”¨æˆ·ç›´æ¥è·å¾— sudo æƒé™ã€‚ å¦‚æœå¤±è´¥ï¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªæ¨¡å—ã€‚ æ‰§è¡Œ pam_timestamp.so (sufficient)ï¼š æ£€æŸ¥æ˜¯å¦å­˜åœ¨æœ‰æ•ˆçš„æ—¶é—´æˆ³æ–‡ä»¶ï¼ˆé»˜è®¤ä¸º 5 åˆ†é’Ÿå†…ï¼‰ã€‚ å¦‚æœæˆåŠŸï¼šPAM è®¤è¯æµç¨‹ç«‹å³æˆåŠŸï¼Œå¹¶è·³è¿‡åç»­æ‰€æœ‰ auth æ¨¡å—ã€‚ç”¨æˆ·å…å¯†ç è·å¾— sudo æƒé™ã€‚ å¦‚æœå¤±è´¥ï¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªæ¨¡å—ã€‚ æ‰§è¡Œ pam_wheel.so (required)ï¼š æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦åœ¨ wheel ç»„ï¼ˆæˆ– sudo ç»„ï¼Œå–å†³äºé…ç½®ï¼‰ä¸­ã€‚ æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½å¿…é¡»ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ª required æ¨¡å—ã€‚ä½†å…¶ç»“æœä¼šè¢«è®°å½•ä¸‹æ¥ã€‚ æ‰§è¡Œ pam_unix.so (required)ï¼š ä½¿ç”¨ nullok å’Œ try_first_pass å‚æ•°è¿›è¡Œå¯†ç éªŒè¯ã€‚ nullokï¼šå…è®¸ç©ºå¯†ç è´¦æˆ·ç™»å½•ã€‚ try_first_passï¼šå°è¯•ä½¿ç”¨å‰é¢æ¨¡å—ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰æä¾›çš„å¯†ç ã€‚å¯¹äº sudoï¼Œè¿™é€šå¸¸æŒ‡ä¹‹å‰ sudo æˆåŠŸæ—¶ç¼“å­˜çš„å¯†ç ã€‚ å¦‚æœå¯†ç æ­£ç¡®ï¼šæ­¤æ¨¡å—æˆåŠŸã€‚ å¦‚æœå¯†ç é”™è¯¯ï¼šæ­¤æ¨¡å—å¤±è´¥ã€‚ æœ€ç»ˆç»“æœåˆ¤å®šï¼š åœ¨æ‰€æœ‰ required æ¨¡å—æ‰§è¡Œå®Œæ¯•åï¼ŒPAM ä¼šæ£€æŸ¥å®ƒä»¬çš„ç»“æœã€‚ å¦‚æœä»»ä½•ä¸€ä¸ª required æ¨¡å—ï¼ˆpam_wheel.so æˆ– pam_unix.soï¼‰å¤±è´¥ï¼Œæ•´ä¸ªè®¤è¯æµç¨‹å¤±è´¥ã€‚ åªæœ‰å½“æ‰€æœ‰ required æ¨¡å—éƒ½æˆåŠŸæ—¶ï¼Œè®¤è¯æ‰æœ€ç»ˆæˆåŠŸã€‚ å¸¸ç”¨æ¨¡å—åŠå…¶å‚æ•°è¯´æ˜ï¼š pam_unix.so å‚æ•° (ç”¨äºå¯†ç éªŒè¯) è¿™æ˜¯æœ€æ ¸å¿ƒçš„å¯†ç è®¤è¯æ¨¡å—ï¼Œå¸¸è§äº auth å’Œ password ç±»å‹ã€‚ nullokï¼šå…è®¸ç©ºå¯†ç è´¦æˆ·é€šè¿‡è®¤è¯ã€‚å¦‚æœä¸åŠ æ­¤å‚æ•°ï¼Œç©ºå¯†ç è´¦æˆ·å°†æ— æ³•ç™»å½•ã€‚ try_first_passï¼šåœ¨æç¤ºç”¨æˆ·è¾“å…¥å¯†ç å‰ï¼Œå…ˆå°è¯•ä½¿ç”¨ä¹‹å‰æ ˆä¸­å·²ç¼“å­˜çš„å¯†ç ï¼ˆä¾‹å¦‚ï¼Œç”±pam_timestamp.so æˆ– pam_kwallet.so æä¾›çš„ï¼‰ã€‚ use_authtokï¼šå¼ºåˆ¶ä½¿ç”¨ä¹‹å‰æ ˆä¸­å·²ç¼“å­˜çš„å¯†ç ï¼Œå¦‚æœä¸å­˜åœ¨ç¼“å­˜å¯†ç ï¼Œåˆ™ç›´æ¥å¤±è´¥ã€‚å®ƒæ¯”try_first_pass æ›´ä¸¥æ ¼ï¼Œé€šå¸¸ç”¨åœ¨ä¿®æ”¹å¯†ç çš„ password æ¨¡å—æ ˆä¸­ï¼Œä»¥ç¡®ä¿ç”¨æˆ·è¾“å…¥çš„æ˜¯æ—§å¯†ç ã€‚ shadowï¼šä½¿ç”¨ /etc/shadow æ–‡ä»¶è¿›è¡Œå¯†ç éªŒè¯ï¼ˆç°ä»£ç³»ç»Ÿé»˜è®¤å¯ç”¨ï¼‰ã€‚ pam_timestamp.so å‚æ•° (ç”¨äºæ—¶é—´æˆ³è®¤è¯) å¸¸ç”¨äº sudoï¼Œå®ç°å…å¯†ç æ“ä½œã€‚ timestamp_timeout=600ï¼šè®¾ç½®æ—¶é—´æˆ³çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’ã€‚é»˜è®¤æ˜¯ 300 (5åˆ†é’Ÿ)ã€‚ pam_wheel.so å‚æ•° (ç”¨äºç»„æˆå‘˜èµ„æ ¼æ£€æŸ¥) ç”¨äºé™åˆ¶åªæœ‰ç‰¹å®šç»„çš„ç”¨æˆ·æ‰èƒ½ä½¿ç”¨ su æˆ– sudoã€‚ use_uidï¼šæ£€æŸ¥å‘èµ·è¯·æ±‚çš„åŸå§‹ç”¨æˆ· IDï¼Œè€Œä¸æ˜¯å½“å‰ç”¨æˆ· IDï¼ˆåœ¨ sudo åœºæ™¯ä¸‹å¾ˆé‡è¦ï¼‰ã€‚ group=adminsï¼šæŒ‡å®šæ£€æŸ¥çš„ç»„åï¼Œé»˜è®¤æ˜¯ wheelã€‚ pam_gnome_keyring.so å‚æ•° (ç”¨äºä¼šè¯ç®¡ç†) è¿™ä¸ªæ¨¡å—ä¸ sudo çš„è®¤è¯æµç¨‹æ— å…³ï¼Œä¸»è¦ç”¨äºç”¨æˆ·ç™»å½•æ—¶è§£é”å¯†é’¥ç¯ã€‚ auto_startï¼šåœ¨ä¼šè¯å¯åŠ¨æ—¶ï¼Œå¦‚æœç”¨æˆ·å¯†ç ä¸å¯†é’¥ç¯å¯†ç ç›¸åŒï¼Œåˆ™è‡ªåŠ¨è§£é”å¯†é’¥ç¯ã€‚ å…¸å‹åº”ç”¨åœºæ™¯ï¼šåœ¨ /etc/pam.d/gdm-password æˆ– /etc/pam.d/login çš„ auth å’Œsession éƒ¨åˆ†ã€‚ bash # åœ¨ /etc/pam.d/gdm-password ä¸­ auth optional pam_gnome_keyring.so session optional pam_gnome_keyring.so auto_start 3.1.3 åº”ç”¨ç¨‹åºä¸ PAM çš„äº¤äº’ç¨‹åºé€šè¿‡ pam_start() æŒ‡å®šæœåŠ¡åï¼Œç³»ç»Ÿæ®æ­¤åŠ è½½å¯¹åº”çš„é…ç½®æ–‡ä»¶ã€‚ ç¨‹åº æœåŠ¡å é…ç½®æ–‡ä»¶ åŠŸèƒ½ login \"login\" /etc/pam.d/login æ§åˆ¶å°ç™»å½• gdm \"gdm\" /etc/pam.d/gdm GNOME ç™»å½•ç•Œé¢ sudo \"sudo\" /etc/pam.d/sudo ææƒå‘½ä»¤ sshd \"sshd\" /etc/pam.d/sshd SSH ç™»å½• greetd \"greetd\" /etc/pam.d/greetd è½»é‡æ˜¾ç¤ºç®¡ç†å™¨ ä¸€ä¸ªå…¸å‹çš„è°ƒç”¨é¡ºåºå¦‚ä¸‹ï¼ˆä»¥ sudo ä¸ºä¾‹ï¼‰ï¼š c pam_start(\"sudo\", user, \u0026conv, \u0026pamh); // åˆå§‹åŒ– PAM pam_authenticate(pamh, 0); // èº«ä»½éªŒè¯ pam_acct_mgmt(pamh, 0); // è´¦æˆ·æ£€æŸ¥ pam_open_session(pamh, 0); // æ‰“å¼€ä¼šè¯ // æ‰§è¡Œç”¨æˆ·å‘½ä»¤ pam_close_session(pamh, 0); // å…³é—­ä¼šè¯ pam_end(pamh, PAM_SUCCESS); // é‡Šæ”¾èµ„æº å¦‚ä¸‹æ˜¯ä¸€ä¸ªç”¨æˆ·ç™»å½•æµç¨‹çš„ PAM è°ƒç”¨ç¤ºä¾‹ï¼š c #include #include #include #include static void log_result(pam_handle_t *pamh, int ret, const char *step) { if (ret == PAM_SUCCESS) { printf(\"[âœ“] %s æˆåŠŸ\\n\", step); } else { fprintf(stderr, \"[âœ—] %s å¤±è´¥: %sï¼ˆè¿”å›ç  %dï¼‰\\n\", step, pam_strerror(pamh, ret), ret); } } int main(int argc, char *argv[]) { pam_handle_t *p","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:4:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#1é…ç½®æ–‡ä»¶è¯­æ³•"},{"categories":["tech"],"content":" 3.1 PAM - å¯æ’æ‹”è®¤è¯æ¨¡å—PAMï¼ˆPluggable Authentication Modulesï¼‰ æ˜¯ Linux çš„ç»Ÿä¸€è®¤è¯æ¡†æ¶ï¼Œä¸ºç³»ç»Ÿä¸­çš„å„ç§ç¨‹åº ï¼ˆå¦‚ loginã€sudoã€sshdã€gdm ç­‰ï¼‰æä¾›æ ‡å‡†åŒ–çš„è®¤è¯æ¥å£ã€‚å€ŸåŠ© PAMï¼Œç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶çµæ´»æ§åˆ¶è®¤è¯ç­–ç•¥ï¼Œè€Œæ— éœ€ä¿®æ”¹åº”ç”¨ç¨‹åºæœ¬èº«ã€‚å®ƒæ”¯æŒå¤šç§è®¤è¯æ–¹å¼ï¼ˆå¯†ç ã€æŒ‡çº¹ã€æ™ºèƒ½å¡ã€åŒå› å­éªŒè¯ç­‰ï¼‰ï¼Œæ˜¯ç°ä»£ Linux å®‰å…¨ä½“ç³»çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ã€‚ 3.1.1 å·¥ä½œåŸç†ä¸é…ç½®ç»“æ„PAM é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œå°†è®¤è¯æµç¨‹åˆ†ä¸ºå››ä¸ªé˜¶æ®µã€‚åº”ç”¨ç¨‹åºé€šè¿‡è°ƒç”¨ç›¸åº”çš„ PAM æ¥å£è§¦å‘è¿™äº›é˜¶æ®µï¼Œ ç³»ç»Ÿæ ¹æ® /etc/pam.d/ ä¸‹çš„é…ç½®æ–‡ä»¶æ‰§è¡Œç›¸åº”çš„æ¨¡å—ï¼ˆ.so æ–‡ä»¶ï¼‰ã€‚ ï¼ˆ1ï¼‰é…ç½®æ–‡ä»¶è¯­æ³• https://linux.die.net/man/5/pam.d æ¯è¡Œçš„åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š text [arguments] typeï¼šè¡¨ç¤ºé˜¶æ®µç±»å‹ controlï¼šå®šä¹‰è¯¥æ¨¡å—çš„æ‰§è¡Œç­–ç•¥ moduleï¼šå…·ä½“çš„ PAM æ¨¡å—è·¯å¾„ï¼ˆæˆ–åç§°ï¼‰ argumentsï¼šä¼ é€’ç»™æ¨¡å—çš„å‚æ•° ï¼ˆ2ï¼‰å››ä¸ªè®¤è¯é˜¶æ®µ é˜¶æ®µç±»å‹ è°ƒç”¨å‡½æ•° ä¸»è¦ä½œç”¨ auth pam_authenticate() éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œé€šå¸¸ä¼šæç¤ºç”¨æˆ·è¾“å‡ºå¯†ç æˆ–æŒ‡çº¹ä»¥å®ŒæˆéªŒè¯ account pam_acct_mgmt() æ£€æŸ¥è´¦æˆ·çŠ¶æ€ï¼ˆè¿‡æœŸã€é”å®šç­‰ï¼‰ password pam_chauthtok() å¤„ç†å¯†ç ä¿®æ”¹ session pam_open_session() / pam_close_session() å»ºç«‹å’Œæ¸…ç†ç”¨æˆ·ä¼šè¯ ï¼ˆ3ï¼‰æ§åˆ¶æ ‡å¿—ï¼ˆcontrolï¼‰ æ ‡å¿— å«ä¹‰ è¡Œä¸ºè¯´æ˜ required å¿…é¡»æˆåŠŸï¼Œå¤±è´¥ä¸ä¼šç«‹å³ç»ˆæ­¢ï¼Œä½†æœ€ç»ˆç»“æœä¼šå¤±è´¥ æ— è®ºæˆåŠŸå¤±è´¥ï¼Œéƒ½ä¼šç»§ç»­æ‰§è¡Œåç»­æ¨¡å—ã€‚æœ€ç»ˆåªè¦æœ‰ä¸€ä¸ª required å¤±è´¥ï¼Œæ•´ä¸ªè®¤è¯å°±å¤±è´¥ã€‚ requisite å¿…é¡»æˆåŠŸï¼Œå¤±è´¥ç«‹å³ç»ˆæ­¢å¹¶è¿”å›å¤±è´¥ å¤±è´¥ç«‹å³è¿”å›ï¼Œä¸å†æ‰§è¡Œåç»­æ¨¡å—ã€‚ sufficient æˆåŠŸåˆ™ç«‹å³é€šè¿‡è®¤è¯ï¼ˆè·³è¿‡æ‰€æœ‰åç»­æ¨¡å—ï¼‰ï¼›å¤±è´¥åˆ™ç»§ç»­ç”±åç»­æ¨¡å—è¿›è¡Œè®¤è¯ è‹¥å‰é¢æ²¡æœ‰ required å¤±è´¥ï¼Œåˆ™æˆåŠŸç›´æ¥é€šè¿‡ï¼›å¦åˆ™å¤±è´¥ä¸å½±å“åç»­ã€‚ optional å¯é€‰æ¨¡å—ï¼Œç»“æœé€šå¸¸è¢«å¿½ç•¥ æ— è®ºæˆåŠŸå¤±è´¥ï¼Œå¯¹æœ€ç»ˆç»“æœæ— ç›´æ¥å½±å“ï¼Œé™¤éæ˜¯æ ˆä¸­å”¯ä¸€çš„æ¨¡å—ã€‚ include åŒ…å«å¦ä¸€ä¸ªæ–‡ä»¶çš„é…ç½® å°†æŒ‡å®šæ–‡ä»¶çš„é…ç½®å†…å®¹åŒ…å«è¿›æ¥ï¼Œé€šå¸¸ç”¨äºå¤ç”¨é€šç”¨é…ç½®ï¼ˆå¦‚ system-authï¼‰ã€‚ substack è°ƒç”¨å­æ ˆ ç±»ä¼¼ includeï¼Œä½†å­æ ˆçš„å¤±è´¥ä¸å½±å“ä¸»æ ˆï¼ˆå³å­æ ˆåªèƒ½è·³è¿‡å…¶è‡ªèº«çš„åç»­æ­¥éª¤ï¼‰ï¼Œé™¤éä¸»æ ˆä¸­å¦æœ‰è®¾ç½®ã€‚ ï¼ˆ4ï¼‰å¸¸ç”¨æ¨¡å—ç¤ºä¾‹ bash pam_unix.so # åŸºäº /etc/passwd ä¸ /etc/shadow çš„æ ‡å‡†å¯†ç è®¤è¯ pam_google_authenticator.so # åŒå› å­è®¤è¯ï¼ˆTOTPï¼‰ pam_fprintd.so # æŒ‡çº¹è®¤è¯ pam_ldap.so # LDAP é›†ä¸­å¼è®¤è¯ pam_gnome_keyring.so # GNOME å¯†é’¥ç¯é›†æˆ pam_limits.so # ç”¨æˆ·èµ„æºé™åˆ¶ pam_deny.so # æ‹’ç»æ‰€æœ‰è®¤è¯è¯·æ±‚ 3.1.2 æ‰§è¡Œæµç¨‹ç¤ºä¾‹ä»¥ /etc/pam.d/sudo ä¸ºä¾‹ï¼š bash #%PAM-1.0 auth sufficient pam_rootok.so auth sufficient pam_timestamp.so auth required pam_wheel.so use_uid auth required pam_unix.so nullok try_first_pass å„æ¨¡å—çš„æ‰§è¡Œé¡ºåºå¦‚ä¸‹ï¼š æ‰§è¡Œ pam_rootok.so (sufficient)ï¼š æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦ä¸º rootã€‚ å¦‚æœæˆåŠŸï¼šPAM è®¤è¯æµç¨‹ç«‹å³æˆåŠŸï¼Œå¹¶è·³è¿‡åç»­æ‰€æœ‰ auth æ¨¡å—ã€‚ç”¨æˆ·ç›´æ¥è·å¾— sudo æƒé™ã€‚ å¦‚æœå¤±è´¥ï¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªæ¨¡å—ã€‚ æ‰§è¡Œ pam_timestamp.so (sufficient)ï¼š æ£€æŸ¥æ˜¯å¦å­˜åœ¨æœ‰æ•ˆçš„æ—¶é—´æˆ³æ–‡ä»¶ï¼ˆé»˜è®¤ä¸º 5 åˆ†é’Ÿå†…ï¼‰ã€‚ å¦‚æœæˆåŠŸï¼šPAM è®¤è¯æµç¨‹ç«‹å³æˆåŠŸï¼Œå¹¶è·³è¿‡åç»­æ‰€æœ‰ auth æ¨¡å—ã€‚ç”¨æˆ·å…å¯†ç è·å¾— sudo æƒé™ã€‚ å¦‚æœå¤±è´¥ï¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªæ¨¡å—ã€‚ æ‰§è¡Œ pam_wheel.so (required)ï¼š æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦åœ¨ wheel ç»„ï¼ˆæˆ– sudo ç»„ï¼Œå–å†³äºé…ç½®ï¼‰ä¸­ã€‚ æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½å¿…é¡»ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ª required æ¨¡å—ã€‚ä½†å…¶ç»“æœä¼šè¢«è®°å½•ä¸‹æ¥ã€‚ æ‰§è¡Œ pam_unix.so (required)ï¼š ä½¿ç”¨ nullok å’Œ try_first_pass å‚æ•°è¿›è¡Œå¯†ç éªŒè¯ã€‚ nullokï¼šå…è®¸ç©ºå¯†ç è´¦æˆ·ç™»å½•ã€‚ try_first_passï¼šå°è¯•ä½¿ç”¨å‰é¢æ¨¡å—ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰æä¾›çš„å¯†ç ã€‚å¯¹äº sudoï¼Œè¿™é€šå¸¸æŒ‡ä¹‹å‰ sudo æˆåŠŸæ—¶ç¼“å­˜çš„å¯†ç ã€‚ å¦‚æœå¯†ç æ­£ç¡®ï¼šæ­¤æ¨¡å—æˆåŠŸã€‚ å¦‚æœå¯†ç é”™è¯¯ï¼šæ­¤æ¨¡å—å¤±è´¥ã€‚ æœ€ç»ˆç»“æœåˆ¤å®šï¼š åœ¨æ‰€æœ‰ required æ¨¡å—æ‰§è¡Œå®Œæ¯•åï¼ŒPAM ä¼šæ£€æŸ¥å®ƒä»¬çš„ç»“æœã€‚ å¦‚æœä»»ä½•ä¸€ä¸ª required æ¨¡å—ï¼ˆpam_wheel.so æˆ– pam_unix.soï¼‰å¤±è´¥ï¼Œæ•´ä¸ªè®¤è¯æµç¨‹å¤±è´¥ã€‚ åªæœ‰å½“æ‰€æœ‰ required æ¨¡å—éƒ½æˆåŠŸæ—¶ï¼Œè®¤è¯æ‰æœ€ç»ˆæˆåŠŸã€‚ å¸¸ç”¨æ¨¡å—åŠå…¶å‚æ•°è¯´æ˜ï¼š pam_unix.so å‚æ•° (ç”¨äºå¯†ç éªŒè¯) è¿™æ˜¯æœ€æ ¸å¿ƒçš„å¯†ç è®¤è¯æ¨¡å—ï¼Œå¸¸è§äº auth å’Œ password ç±»å‹ã€‚ nullokï¼šå…è®¸ç©ºå¯†ç è´¦æˆ·é€šè¿‡è®¤è¯ã€‚å¦‚æœä¸åŠ æ­¤å‚æ•°ï¼Œç©ºå¯†ç è´¦æˆ·å°†æ— æ³•ç™»å½•ã€‚ try_first_passï¼šåœ¨æç¤ºç”¨æˆ·è¾“å…¥å¯†ç å‰ï¼Œå…ˆå°è¯•ä½¿ç”¨ä¹‹å‰æ ˆä¸­å·²ç¼“å­˜çš„å¯†ç ï¼ˆä¾‹å¦‚ï¼Œç”±pam_timestamp.so æˆ– pam_kwallet.so æä¾›çš„ï¼‰ã€‚ use_authtokï¼šå¼ºåˆ¶ä½¿ç”¨ä¹‹å‰æ ˆä¸­å·²ç¼“å­˜çš„å¯†ç ï¼Œå¦‚æœä¸å­˜åœ¨ç¼“å­˜å¯†ç ï¼Œåˆ™ç›´æ¥å¤±è´¥ã€‚å®ƒæ¯”try_first_pass æ›´ä¸¥æ ¼ï¼Œé€šå¸¸ç”¨åœ¨ä¿®æ”¹å¯†ç çš„ password æ¨¡å—æ ˆä¸­ï¼Œä»¥ç¡®ä¿ç”¨æˆ·è¾“å…¥çš„æ˜¯æ—§å¯†ç ã€‚ shadowï¼šä½¿ç”¨ /etc/shadow æ–‡ä»¶è¿›è¡Œå¯†ç éªŒè¯ï¼ˆç°ä»£ç³»ç»Ÿé»˜è®¤å¯ç”¨ï¼‰ã€‚ pam_timestamp.so å‚æ•° (ç”¨äºæ—¶é—´æˆ³è®¤è¯) å¸¸ç”¨äº sudoï¼Œå®ç°å…å¯†ç æ“ä½œã€‚ timestamp_timeout=600ï¼šè®¾ç½®æ—¶é—´æˆ³çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’ã€‚é»˜è®¤æ˜¯ 300 (5åˆ†é’Ÿ)ã€‚ pam_wheel.so å‚æ•° (ç”¨äºç»„æˆå‘˜èµ„æ ¼æ£€æŸ¥) ç”¨äºé™åˆ¶åªæœ‰ç‰¹å®šç»„çš„ç”¨æˆ·æ‰èƒ½ä½¿ç”¨ su æˆ– sudoã€‚ use_uidï¼šæ£€æŸ¥å‘èµ·è¯·æ±‚çš„åŸå§‹ç”¨æˆ· IDï¼Œè€Œä¸æ˜¯å½“å‰ç”¨æˆ· IDï¼ˆåœ¨ sudo åœºæ™¯ä¸‹å¾ˆé‡è¦ï¼‰ã€‚ group=adminsï¼šæŒ‡å®šæ£€æŸ¥çš„ç»„åï¼Œé»˜è®¤æ˜¯ wheelã€‚ pam_gnome_keyring.so å‚æ•° (ç”¨äºä¼šè¯ç®¡ç†) è¿™ä¸ªæ¨¡å—ä¸ sudo çš„è®¤è¯æµç¨‹æ— å…³ï¼Œä¸»è¦ç”¨äºç”¨æˆ·ç™»å½•æ—¶è§£é”å¯†é’¥ç¯ã€‚ auto_startï¼šåœ¨ä¼šè¯å¯åŠ¨æ—¶ï¼Œå¦‚æœç”¨æˆ·å¯†ç ä¸å¯†é’¥ç¯å¯†ç ç›¸åŒï¼Œåˆ™è‡ªåŠ¨è§£é”å¯†é’¥ç¯ã€‚ å…¸å‹åº”ç”¨åœºæ™¯ï¼šåœ¨ /etc/pam.d/gdm-password æˆ– /etc/pam.d/login çš„ auth å’Œsession éƒ¨åˆ†ã€‚ bash # åœ¨ /etc/pam.d/gdm-password ä¸­ auth optional pam_gnome_keyring.so session optional pam_gnome_keyring.so auto_start 3.1.3 åº”ç”¨ç¨‹åºä¸ PAM çš„äº¤äº’ç¨‹åºé€šè¿‡ pam_start() æŒ‡å®šæœåŠ¡åï¼Œç³»ç»Ÿæ®æ­¤åŠ è½½å¯¹åº”çš„é…ç½®æ–‡ä»¶ã€‚ ç¨‹åº æœåŠ¡å é…ç½®æ–‡ä»¶ åŠŸèƒ½ login \"login\" /etc/pam.d/login æ§åˆ¶å°ç™»å½• gdm \"gdm\" /etc/pam.d/gdm GNOME ç™»å½•ç•Œé¢ sudo \"sudo\" /etc/pam.d/sudo ææƒå‘½ä»¤ sshd \"sshd\" /etc/pam.d/sshd SSH ç™»å½• greetd \"greetd\" /etc/pam.d/greetd è½»é‡æ˜¾ç¤ºç®¡ç†å™¨ ä¸€ä¸ªå…¸å‹çš„è°ƒç”¨é¡ºåºå¦‚ä¸‹ï¼ˆä»¥ sudo ä¸ºä¾‹ï¼‰ï¼š c pam_start(\"sudo\", user, \u0026conv, \u0026pamh); // åˆå§‹åŒ– PAM pam_authenticate(pamh, 0); // èº«ä»½éªŒè¯ pam_acct_mgmt(pamh, 0); // è´¦æˆ·æ£€æŸ¥ pam_open_session(pamh, 0); // æ‰“å¼€ä¼šè¯ // æ‰§è¡Œç”¨æˆ·å‘½ä»¤ pam_close_session(pamh, 0); // å…³é—­ä¼šè¯ pam_end(pamh, PAM_SUCCESS); // é‡Šæ”¾èµ„æº å¦‚ä¸‹æ˜¯ä¸€ä¸ªç”¨æˆ·ç™»å½•æµç¨‹çš„ PAM è°ƒç”¨ç¤ºä¾‹ï¼š c #include #include #include #include static void log_result(pam_handle_t *pamh, int ret, const char *step) { if (ret == PAM_SUCCESS) { printf(\"[âœ“] %s æˆåŠŸ\\n\", step); } else { fprintf(stderr, \"[âœ—] %s å¤±è´¥: %sï¼ˆè¿”å›ç  %dï¼‰\\n\", step, pam_strerror(pamh, ret), ret); } } int main(int argc, char *argv[]) { pam_handle_t *p","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:4:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#2å››ä¸ªè®¤è¯é˜¶æ®µ"},{"categories":["tech"],"content":" 3.1 PAM - å¯æ’æ‹”è®¤è¯æ¨¡å—PAMï¼ˆPluggable Authentication Modulesï¼‰ æ˜¯ Linux çš„ç»Ÿä¸€è®¤è¯æ¡†æ¶ï¼Œä¸ºç³»ç»Ÿä¸­çš„å„ç§ç¨‹åº ï¼ˆå¦‚ loginã€sudoã€sshdã€gdm ç­‰ï¼‰æä¾›æ ‡å‡†åŒ–çš„è®¤è¯æ¥å£ã€‚å€ŸåŠ© PAMï¼Œç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶çµæ´»æ§åˆ¶è®¤è¯ç­–ç•¥ï¼Œè€Œæ— éœ€ä¿®æ”¹åº”ç”¨ç¨‹åºæœ¬èº«ã€‚å®ƒæ”¯æŒå¤šç§è®¤è¯æ–¹å¼ï¼ˆå¯†ç ã€æŒ‡çº¹ã€æ™ºèƒ½å¡ã€åŒå› å­éªŒè¯ç­‰ï¼‰ï¼Œæ˜¯ç°ä»£ Linux å®‰å…¨ä½“ç³»çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ã€‚ 3.1.1 å·¥ä½œåŸç†ä¸é…ç½®ç»“æ„PAM é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œå°†è®¤è¯æµç¨‹åˆ†ä¸ºå››ä¸ªé˜¶æ®µã€‚åº”ç”¨ç¨‹åºé€šè¿‡è°ƒç”¨ç›¸åº”çš„ PAM æ¥å£è§¦å‘è¿™äº›é˜¶æ®µï¼Œ ç³»ç»Ÿæ ¹æ® /etc/pam.d/ ä¸‹çš„é…ç½®æ–‡ä»¶æ‰§è¡Œç›¸åº”çš„æ¨¡å—ï¼ˆ.so æ–‡ä»¶ï¼‰ã€‚ ï¼ˆ1ï¼‰é…ç½®æ–‡ä»¶è¯­æ³• https://linux.die.net/man/5/pam.d æ¯è¡Œçš„åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š text [arguments] typeï¼šè¡¨ç¤ºé˜¶æ®µç±»å‹ controlï¼šå®šä¹‰è¯¥æ¨¡å—çš„æ‰§è¡Œç­–ç•¥ moduleï¼šå…·ä½“çš„ PAM æ¨¡å—è·¯å¾„ï¼ˆæˆ–åç§°ï¼‰ argumentsï¼šä¼ é€’ç»™æ¨¡å—çš„å‚æ•° ï¼ˆ2ï¼‰å››ä¸ªè®¤è¯é˜¶æ®µ é˜¶æ®µç±»å‹ è°ƒç”¨å‡½æ•° ä¸»è¦ä½œç”¨ auth pam_authenticate() éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œé€šå¸¸ä¼šæç¤ºç”¨æˆ·è¾“å‡ºå¯†ç æˆ–æŒ‡çº¹ä»¥å®ŒæˆéªŒè¯ account pam_acct_mgmt() æ£€æŸ¥è´¦æˆ·çŠ¶æ€ï¼ˆè¿‡æœŸã€é”å®šç­‰ï¼‰ password pam_chauthtok() å¤„ç†å¯†ç ä¿®æ”¹ session pam_open_session() / pam_close_session() å»ºç«‹å’Œæ¸…ç†ç”¨æˆ·ä¼šè¯ ï¼ˆ3ï¼‰æ§åˆ¶æ ‡å¿—ï¼ˆcontrolï¼‰ æ ‡å¿— å«ä¹‰ è¡Œä¸ºè¯´æ˜ required å¿…é¡»æˆåŠŸï¼Œå¤±è´¥ä¸ä¼šç«‹å³ç»ˆæ­¢ï¼Œä½†æœ€ç»ˆç»“æœä¼šå¤±è´¥ æ— è®ºæˆåŠŸå¤±è´¥ï¼Œéƒ½ä¼šç»§ç»­æ‰§è¡Œåç»­æ¨¡å—ã€‚æœ€ç»ˆåªè¦æœ‰ä¸€ä¸ª required å¤±è´¥ï¼Œæ•´ä¸ªè®¤è¯å°±å¤±è´¥ã€‚ requisite å¿…é¡»æˆåŠŸï¼Œå¤±è´¥ç«‹å³ç»ˆæ­¢å¹¶è¿”å›å¤±è´¥ å¤±è´¥ç«‹å³è¿”å›ï¼Œä¸å†æ‰§è¡Œåç»­æ¨¡å—ã€‚ sufficient æˆåŠŸåˆ™ç«‹å³é€šè¿‡è®¤è¯ï¼ˆè·³è¿‡æ‰€æœ‰åç»­æ¨¡å—ï¼‰ï¼›å¤±è´¥åˆ™ç»§ç»­ç”±åç»­æ¨¡å—è¿›è¡Œè®¤è¯ è‹¥å‰é¢æ²¡æœ‰ required å¤±è´¥ï¼Œåˆ™æˆåŠŸç›´æ¥é€šè¿‡ï¼›å¦åˆ™å¤±è´¥ä¸å½±å“åç»­ã€‚ optional å¯é€‰æ¨¡å—ï¼Œç»“æœé€šå¸¸è¢«å¿½ç•¥ æ— è®ºæˆåŠŸå¤±è´¥ï¼Œå¯¹æœ€ç»ˆç»“æœæ— ç›´æ¥å½±å“ï¼Œé™¤éæ˜¯æ ˆä¸­å”¯ä¸€çš„æ¨¡å—ã€‚ include åŒ…å«å¦ä¸€ä¸ªæ–‡ä»¶çš„é…ç½® å°†æŒ‡å®šæ–‡ä»¶çš„é…ç½®å†…å®¹åŒ…å«è¿›æ¥ï¼Œé€šå¸¸ç”¨äºå¤ç”¨é€šç”¨é…ç½®ï¼ˆå¦‚ system-authï¼‰ã€‚ substack è°ƒç”¨å­æ ˆ ç±»ä¼¼ includeï¼Œä½†å­æ ˆçš„å¤±è´¥ä¸å½±å“ä¸»æ ˆï¼ˆå³å­æ ˆåªèƒ½è·³è¿‡å…¶è‡ªèº«çš„åç»­æ­¥éª¤ï¼‰ï¼Œé™¤éä¸»æ ˆä¸­å¦æœ‰è®¾ç½®ã€‚ ï¼ˆ4ï¼‰å¸¸ç”¨æ¨¡å—ç¤ºä¾‹ bash pam_unix.so # åŸºäº /etc/passwd ä¸ /etc/shadow çš„æ ‡å‡†å¯†ç è®¤è¯ pam_google_authenticator.so # åŒå› å­è®¤è¯ï¼ˆTOTPï¼‰ pam_fprintd.so # æŒ‡çº¹è®¤è¯ pam_ldap.so # LDAP é›†ä¸­å¼è®¤è¯ pam_gnome_keyring.so # GNOME å¯†é’¥ç¯é›†æˆ pam_limits.so # ç”¨æˆ·èµ„æºé™åˆ¶ pam_deny.so # æ‹’ç»æ‰€æœ‰è®¤è¯è¯·æ±‚ 3.1.2 æ‰§è¡Œæµç¨‹ç¤ºä¾‹ä»¥ /etc/pam.d/sudo ä¸ºä¾‹ï¼š bash #%PAM-1.0 auth sufficient pam_rootok.so auth sufficient pam_timestamp.so auth required pam_wheel.so use_uid auth required pam_unix.so nullok try_first_pass å„æ¨¡å—çš„æ‰§è¡Œé¡ºåºå¦‚ä¸‹ï¼š æ‰§è¡Œ pam_rootok.so (sufficient)ï¼š æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦ä¸º rootã€‚ å¦‚æœæˆåŠŸï¼šPAM è®¤è¯æµç¨‹ç«‹å³æˆåŠŸï¼Œå¹¶è·³è¿‡åç»­æ‰€æœ‰ auth æ¨¡å—ã€‚ç”¨æˆ·ç›´æ¥è·å¾— sudo æƒé™ã€‚ å¦‚æœå¤±è´¥ï¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªæ¨¡å—ã€‚ æ‰§è¡Œ pam_timestamp.so (sufficient)ï¼š æ£€æŸ¥æ˜¯å¦å­˜åœ¨æœ‰æ•ˆçš„æ—¶é—´æˆ³æ–‡ä»¶ï¼ˆé»˜è®¤ä¸º 5 åˆ†é’Ÿå†…ï¼‰ã€‚ å¦‚æœæˆåŠŸï¼šPAM è®¤è¯æµç¨‹ç«‹å³æˆåŠŸï¼Œå¹¶è·³è¿‡åç»­æ‰€æœ‰ auth æ¨¡å—ã€‚ç”¨æˆ·å…å¯†ç è·å¾— sudo æƒé™ã€‚ å¦‚æœå¤±è´¥ï¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªæ¨¡å—ã€‚ æ‰§è¡Œ pam_wheel.so (required)ï¼š æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦åœ¨ wheel ç»„ï¼ˆæˆ– sudo ç»„ï¼Œå–å†³äºé…ç½®ï¼‰ä¸­ã€‚ æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½å¿…é¡»ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ª required æ¨¡å—ã€‚ä½†å…¶ç»“æœä¼šè¢«è®°å½•ä¸‹æ¥ã€‚ æ‰§è¡Œ pam_unix.so (required)ï¼š ä½¿ç”¨ nullok å’Œ try_first_pass å‚æ•°è¿›è¡Œå¯†ç éªŒè¯ã€‚ nullokï¼šå…è®¸ç©ºå¯†ç è´¦æˆ·ç™»å½•ã€‚ try_first_passï¼šå°è¯•ä½¿ç”¨å‰é¢æ¨¡å—ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰æä¾›çš„å¯†ç ã€‚å¯¹äº sudoï¼Œè¿™é€šå¸¸æŒ‡ä¹‹å‰ sudo æˆåŠŸæ—¶ç¼“å­˜çš„å¯†ç ã€‚ å¦‚æœå¯†ç æ­£ç¡®ï¼šæ­¤æ¨¡å—æˆåŠŸã€‚ å¦‚æœå¯†ç é”™è¯¯ï¼šæ­¤æ¨¡å—å¤±è´¥ã€‚ æœ€ç»ˆç»“æœåˆ¤å®šï¼š åœ¨æ‰€æœ‰ required æ¨¡å—æ‰§è¡Œå®Œæ¯•åï¼ŒPAM ä¼šæ£€æŸ¥å®ƒä»¬çš„ç»“æœã€‚ å¦‚æœä»»ä½•ä¸€ä¸ª required æ¨¡å—ï¼ˆpam_wheel.so æˆ– pam_unix.soï¼‰å¤±è´¥ï¼Œæ•´ä¸ªè®¤è¯æµç¨‹å¤±è´¥ã€‚ åªæœ‰å½“æ‰€æœ‰ required æ¨¡å—éƒ½æˆåŠŸæ—¶ï¼Œè®¤è¯æ‰æœ€ç»ˆæˆåŠŸã€‚ å¸¸ç”¨æ¨¡å—åŠå…¶å‚æ•°è¯´æ˜ï¼š pam_unix.so å‚æ•° (ç”¨äºå¯†ç éªŒè¯) è¿™æ˜¯æœ€æ ¸å¿ƒçš„å¯†ç è®¤è¯æ¨¡å—ï¼Œå¸¸è§äº auth å’Œ password ç±»å‹ã€‚ nullokï¼šå…è®¸ç©ºå¯†ç è´¦æˆ·é€šè¿‡è®¤è¯ã€‚å¦‚æœä¸åŠ æ­¤å‚æ•°ï¼Œç©ºå¯†ç è´¦æˆ·å°†æ— æ³•ç™»å½•ã€‚ try_first_passï¼šåœ¨æç¤ºç”¨æˆ·è¾“å…¥å¯†ç å‰ï¼Œå…ˆå°è¯•ä½¿ç”¨ä¹‹å‰æ ˆä¸­å·²ç¼“å­˜çš„å¯†ç ï¼ˆä¾‹å¦‚ï¼Œç”±pam_timestamp.so æˆ– pam_kwallet.so æä¾›çš„ï¼‰ã€‚ use_authtokï¼šå¼ºåˆ¶ä½¿ç”¨ä¹‹å‰æ ˆä¸­å·²ç¼“å­˜çš„å¯†ç ï¼Œå¦‚æœä¸å­˜åœ¨ç¼“å­˜å¯†ç ï¼Œåˆ™ç›´æ¥å¤±è´¥ã€‚å®ƒæ¯”try_first_pass æ›´ä¸¥æ ¼ï¼Œé€šå¸¸ç”¨åœ¨ä¿®æ”¹å¯†ç çš„ password æ¨¡å—æ ˆä¸­ï¼Œä»¥ç¡®ä¿ç”¨æˆ·è¾“å…¥çš„æ˜¯æ—§å¯†ç ã€‚ shadowï¼šä½¿ç”¨ /etc/shadow æ–‡ä»¶è¿›è¡Œå¯†ç éªŒè¯ï¼ˆç°ä»£ç³»ç»Ÿé»˜è®¤å¯ç”¨ï¼‰ã€‚ pam_timestamp.so å‚æ•° (ç”¨äºæ—¶é—´æˆ³è®¤è¯) å¸¸ç”¨äº sudoï¼Œå®ç°å…å¯†ç æ“ä½œã€‚ timestamp_timeout=600ï¼šè®¾ç½®æ—¶é—´æˆ³çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’ã€‚é»˜è®¤æ˜¯ 300 (5åˆ†é’Ÿ)ã€‚ pam_wheel.so å‚æ•° (ç”¨äºç»„æˆå‘˜èµ„æ ¼æ£€æŸ¥) ç”¨äºé™åˆ¶åªæœ‰ç‰¹å®šç»„çš„ç”¨æˆ·æ‰èƒ½ä½¿ç”¨ su æˆ– sudoã€‚ use_uidï¼šæ£€æŸ¥å‘èµ·è¯·æ±‚çš„åŸå§‹ç”¨æˆ· IDï¼Œè€Œä¸æ˜¯å½“å‰ç”¨æˆ· IDï¼ˆåœ¨ sudo åœºæ™¯ä¸‹å¾ˆé‡è¦ï¼‰ã€‚ group=adminsï¼šæŒ‡å®šæ£€æŸ¥çš„ç»„åï¼Œé»˜è®¤æ˜¯ wheelã€‚ pam_gnome_keyring.so å‚æ•° (ç”¨äºä¼šè¯ç®¡ç†) è¿™ä¸ªæ¨¡å—ä¸ sudo çš„è®¤è¯æµç¨‹æ— å…³ï¼Œä¸»è¦ç”¨äºç”¨æˆ·ç™»å½•æ—¶è§£é”å¯†é’¥ç¯ã€‚ auto_startï¼šåœ¨ä¼šè¯å¯åŠ¨æ—¶ï¼Œå¦‚æœç”¨æˆ·å¯†ç ä¸å¯†é’¥ç¯å¯†ç ç›¸åŒï¼Œåˆ™è‡ªåŠ¨è§£é”å¯†é’¥ç¯ã€‚ å…¸å‹åº”ç”¨åœºæ™¯ï¼šåœ¨ /etc/pam.d/gdm-password æˆ– /etc/pam.d/login çš„ auth å’Œsession éƒ¨åˆ†ã€‚ bash # åœ¨ /etc/pam.d/gdm-password ä¸­ auth optional pam_gnome_keyring.so session optional pam_gnome_keyring.so auto_start 3.1.3 åº”ç”¨ç¨‹åºä¸ PAM çš„äº¤äº’ç¨‹åºé€šè¿‡ pam_start() æŒ‡å®šæœåŠ¡åï¼Œç³»ç»Ÿæ®æ­¤åŠ è½½å¯¹åº”çš„é…ç½®æ–‡ä»¶ã€‚ ç¨‹åº æœåŠ¡å é…ç½®æ–‡ä»¶ åŠŸèƒ½ login \"login\" /etc/pam.d/login æ§åˆ¶å°ç™»å½• gdm \"gdm\" /etc/pam.d/gdm GNOME ç™»å½•ç•Œé¢ sudo \"sudo\" /etc/pam.d/sudo ææƒå‘½ä»¤ sshd \"sshd\" /etc/pam.d/sshd SSH ç™»å½• greetd \"greetd\" /etc/pam.d/greetd è½»é‡æ˜¾ç¤ºç®¡ç†å™¨ ä¸€ä¸ªå…¸å‹çš„è°ƒç”¨é¡ºåºå¦‚ä¸‹ï¼ˆä»¥ sudo ä¸ºä¾‹ï¼‰ï¼š c pam_start(\"sudo\", user, \u0026conv, \u0026pamh); // åˆå§‹åŒ– PAM pam_authenticate(pamh, 0); // èº«ä»½éªŒè¯ pam_acct_mgmt(pamh, 0); // è´¦æˆ·æ£€æŸ¥ pam_open_session(pamh, 0); // æ‰“å¼€ä¼šè¯ // æ‰§è¡Œç”¨æˆ·å‘½ä»¤ pam_close_session(pamh, 0); // å…³é—­ä¼šè¯ pam_end(pamh, PAM_SUCCESS); // é‡Šæ”¾èµ„æº å¦‚ä¸‹æ˜¯ä¸€ä¸ªç”¨æˆ·ç™»å½•æµç¨‹çš„ PAM è°ƒç”¨ç¤ºä¾‹ï¼š c #include #include #include #include static void log_result(pam_handle_t *pamh, int ret, const char *step) { if (ret == PAM_SUCCESS) { printf(\"[âœ“] %s æˆåŠŸ\\n\", step); } else { fprintf(stderr, \"[âœ—] %s å¤±è´¥: %sï¼ˆè¿”å›ç  %dï¼‰\\n\", step, pam_strerror(pamh, ret), ret); } } int main(int argc, char *argv[]) { pam_handle_t *p","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:4:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#3æ§åˆ¶æ ‡å¿—control"},{"categories":["tech"],"content":" 3.1 PAM - å¯æ’æ‹”è®¤è¯æ¨¡å—PAMï¼ˆPluggable Authentication Modulesï¼‰ æ˜¯ Linux çš„ç»Ÿä¸€è®¤è¯æ¡†æ¶ï¼Œä¸ºç³»ç»Ÿä¸­çš„å„ç§ç¨‹åº ï¼ˆå¦‚ loginã€sudoã€sshdã€gdm ç­‰ï¼‰æä¾›æ ‡å‡†åŒ–çš„è®¤è¯æ¥å£ã€‚å€ŸåŠ© PAMï¼Œç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶çµæ´»æ§åˆ¶è®¤è¯ç­–ç•¥ï¼Œè€Œæ— éœ€ä¿®æ”¹åº”ç”¨ç¨‹åºæœ¬èº«ã€‚å®ƒæ”¯æŒå¤šç§è®¤è¯æ–¹å¼ï¼ˆå¯†ç ã€æŒ‡çº¹ã€æ™ºèƒ½å¡ã€åŒå› å­éªŒè¯ç­‰ï¼‰ï¼Œæ˜¯ç°ä»£ Linux å®‰å…¨ä½“ç³»çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ã€‚ 3.1.1 å·¥ä½œåŸç†ä¸é…ç½®ç»“æ„PAM é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œå°†è®¤è¯æµç¨‹åˆ†ä¸ºå››ä¸ªé˜¶æ®µã€‚åº”ç”¨ç¨‹åºé€šè¿‡è°ƒç”¨ç›¸åº”çš„ PAM æ¥å£è§¦å‘è¿™äº›é˜¶æ®µï¼Œ ç³»ç»Ÿæ ¹æ® /etc/pam.d/ ä¸‹çš„é…ç½®æ–‡ä»¶æ‰§è¡Œç›¸åº”çš„æ¨¡å—ï¼ˆ.so æ–‡ä»¶ï¼‰ã€‚ ï¼ˆ1ï¼‰é…ç½®æ–‡ä»¶è¯­æ³• https://linux.die.net/man/5/pam.d æ¯è¡Œçš„åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š text [arguments] typeï¼šè¡¨ç¤ºé˜¶æ®µç±»å‹ controlï¼šå®šä¹‰è¯¥æ¨¡å—çš„æ‰§è¡Œç­–ç•¥ moduleï¼šå…·ä½“çš„ PAM æ¨¡å—è·¯å¾„ï¼ˆæˆ–åç§°ï¼‰ argumentsï¼šä¼ é€’ç»™æ¨¡å—çš„å‚æ•° ï¼ˆ2ï¼‰å››ä¸ªè®¤è¯é˜¶æ®µ é˜¶æ®µç±»å‹ è°ƒç”¨å‡½æ•° ä¸»è¦ä½œç”¨ auth pam_authenticate() éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œé€šå¸¸ä¼šæç¤ºç”¨æˆ·è¾“å‡ºå¯†ç æˆ–æŒ‡çº¹ä»¥å®ŒæˆéªŒè¯ account pam_acct_mgmt() æ£€æŸ¥è´¦æˆ·çŠ¶æ€ï¼ˆè¿‡æœŸã€é”å®šç­‰ï¼‰ password pam_chauthtok() å¤„ç†å¯†ç ä¿®æ”¹ session pam_open_session() / pam_close_session() å»ºç«‹å’Œæ¸…ç†ç”¨æˆ·ä¼šè¯ ï¼ˆ3ï¼‰æ§åˆ¶æ ‡å¿—ï¼ˆcontrolï¼‰ æ ‡å¿— å«ä¹‰ è¡Œä¸ºè¯´æ˜ required å¿…é¡»æˆåŠŸï¼Œå¤±è´¥ä¸ä¼šç«‹å³ç»ˆæ­¢ï¼Œä½†æœ€ç»ˆç»“æœä¼šå¤±è´¥ æ— è®ºæˆåŠŸå¤±è´¥ï¼Œéƒ½ä¼šç»§ç»­æ‰§è¡Œåç»­æ¨¡å—ã€‚æœ€ç»ˆåªè¦æœ‰ä¸€ä¸ª required å¤±è´¥ï¼Œæ•´ä¸ªè®¤è¯å°±å¤±è´¥ã€‚ requisite å¿…é¡»æˆåŠŸï¼Œå¤±è´¥ç«‹å³ç»ˆæ­¢å¹¶è¿”å›å¤±è´¥ å¤±è´¥ç«‹å³è¿”å›ï¼Œä¸å†æ‰§è¡Œåç»­æ¨¡å—ã€‚ sufficient æˆåŠŸåˆ™ç«‹å³é€šè¿‡è®¤è¯ï¼ˆè·³è¿‡æ‰€æœ‰åç»­æ¨¡å—ï¼‰ï¼›å¤±è´¥åˆ™ç»§ç»­ç”±åç»­æ¨¡å—è¿›è¡Œè®¤è¯ è‹¥å‰é¢æ²¡æœ‰ required å¤±è´¥ï¼Œåˆ™æˆåŠŸç›´æ¥é€šè¿‡ï¼›å¦åˆ™å¤±è´¥ä¸å½±å“åç»­ã€‚ optional å¯é€‰æ¨¡å—ï¼Œç»“æœé€šå¸¸è¢«å¿½ç•¥ æ— è®ºæˆåŠŸå¤±è´¥ï¼Œå¯¹æœ€ç»ˆç»“æœæ— ç›´æ¥å½±å“ï¼Œé™¤éæ˜¯æ ˆä¸­å”¯ä¸€çš„æ¨¡å—ã€‚ include åŒ…å«å¦ä¸€ä¸ªæ–‡ä»¶çš„é…ç½® å°†æŒ‡å®šæ–‡ä»¶çš„é…ç½®å†…å®¹åŒ…å«è¿›æ¥ï¼Œé€šå¸¸ç”¨äºå¤ç”¨é€šç”¨é…ç½®ï¼ˆå¦‚ system-authï¼‰ã€‚ substack è°ƒç”¨å­æ ˆ ç±»ä¼¼ includeï¼Œä½†å­æ ˆçš„å¤±è´¥ä¸å½±å“ä¸»æ ˆï¼ˆå³å­æ ˆåªèƒ½è·³è¿‡å…¶è‡ªèº«çš„åç»­æ­¥éª¤ï¼‰ï¼Œé™¤éä¸»æ ˆä¸­å¦æœ‰è®¾ç½®ã€‚ ï¼ˆ4ï¼‰å¸¸ç”¨æ¨¡å—ç¤ºä¾‹ bash pam_unix.so # åŸºäº /etc/passwd ä¸ /etc/shadow çš„æ ‡å‡†å¯†ç è®¤è¯ pam_google_authenticator.so # åŒå› å­è®¤è¯ï¼ˆTOTPï¼‰ pam_fprintd.so # æŒ‡çº¹è®¤è¯ pam_ldap.so # LDAP é›†ä¸­å¼è®¤è¯ pam_gnome_keyring.so # GNOME å¯†é’¥ç¯é›†æˆ pam_limits.so # ç”¨æˆ·èµ„æºé™åˆ¶ pam_deny.so # æ‹’ç»æ‰€æœ‰è®¤è¯è¯·æ±‚ 3.1.2 æ‰§è¡Œæµç¨‹ç¤ºä¾‹ä»¥ /etc/pam.d/sudo ä¸ºä¾‹ï¼š bash #%PAM-1.0 auth sufficient pam_rootok.so auth sufficient pam_timestamp.so auth required pam_wheel.so use_uid auth required pam_unix.so nullok try_first_pass å„æ¨¡å—çš„æ‰§è¡Œé¡ºåºå¦‚ä¸‹ï¼š æ‰§è¡Œ pam_rootok.so (sufficient)ï¼š æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦ä¸º rootã€‚ å¦‚æœæˆåŠŸï¼šPAM è®¤è¯æµç¨‹ç«‹å³æˆåŠŸï¼Œå¹¶è·³è¿‡åç»­æ‰€æœ‰ auth æ¨¡å—ã€‚ç”¨æˆ·ç›´æ¥è·å¾— sudo æƒé™ã€‚ å¦‚æœå¤±è´¥ï¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªæ¨¡å—ã€‚ æ‰§è¡Œ pam_timestamp.so (sufficient)ï¼š æ£€æŸ¥æ˜¯å¦å­˜åœ¨æœ‰æ•ˆçš„æ—¶é—´æˆ³æ–‡ä»¶ï¼ˆé»˜è®¤ä¸º 5 åˆ†é’Ÿå†…ï¼‰ã€‚ å¦‚æœæˆåŠŸï¼šPAM è®¤è¯æµç¨‹ç«‹å³æˆåŠŸï¼Œå¹¶è·³è¿‡åç»­æ‰€æœ‰ auth æ¨¡å—ã€‚ç”¨æˆ·å…å¯†ç è·å¾— sudo æƒé™ã€‚ å¦‚æœå¤±è´¥ï¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªæ¨¡å—ã€‚ æ‰§è¡Œ pam_wheel.so (required)ï¼š æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦åœ¨ wheel ç»„ï¼ˆæˆ– sudo ç»„ï¼Œå–å†³äºé…ç½®ï¼‰ä¸­ã€‚ æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½å¿…é¡»ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ª required æ¨¡å—ã€‚ä½†å…¶ç»“æœä¼šè¢«è®°å½•ä¸‹æ¥ã€‚ æ‰§è¡Œ pam_unix.so (required)ï¼š ä½¿ç”¨ nullok å’Œ try_first_pass å‚æ•°è¿›è¡Œå¯†ç éªŒè¯ã€‚ nullokï¼šå…è®¸ç©ºå¯†ç è´¦æˆ·ç™»å½•ã€‚ try_first_passï¼šå°è¯•ä½¿ç”¨å‰é¢æ¨¡å—ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰æä¾›çš„å¯†ç ã€‚å¯¹äº sudoï¼Œè¿™é€šå¸¸æŒ‡ä¹‹å‰ sudo æˆåŠŸæ—¶ç¼“å­˜çš„å¯†ç ã€‚ å¦‚æœå¯†ç æ­£ç¡®ï¼šæ­¤æ¨¡å—æˆåŠŸã€‚ å¦‚æœå¯†ç é”™è¯¯ï¼šæ­¤æ¨¡å—å¤±è´¥ã€‚ æœ€ç»ˆç»“æœåˆ¤å®šï¼š åœ¨æ‰€æœ‰ required æ¨¡å—æ‰§è¡Œå®Œæ¯•åï¼ŒPAM ä¼šæ£€æŸ¥å®ƒä»¬çš„ç»“æœã€‚ å¦‚æœä»»ä½•ä¸€ä¸ª required æ¨¡å—ï¼ˆpam_wheel.so æˆ– pam_unix.soï¼‰å¤±è´¥ï¼Œæ•´ä¸ªè®¤è¯æµç¨‹å¤±è´¥ã€‚ åªæœ‰å½“æ‰€æœ‰ required æ¨¡å—éƒ½æˆåŠŸæ—¶ï¼Œè®¤è¯æ‰æœ€ç»ˆæˆåŠŸã€‚ å¸¸ç”¨æ¨¡å—åŠå…¶å‚æ•°è¯´æ˜ï¼š pam_unix.so å‚æ•° (ç”¨äºå¯†ç éªŒè¯) è¿™æ˜¯æœ€æ ¸å¿ƒçš„å¯†ç è®¤è¯æ¨¡å—ï¼Œå¸¸è§äº auth å’Œ password ç±»å‹ã€‚ nullokï¼šå…è®¸ç©ºå¯†ç è´¦æˆ·é€šè¿‡è®¤è¯ã€‚å¦‚æœä¸åŠ æ­¤å‚æ•°ï¼Œç©ºå¯†ç è´¦æˆ·å°†æ— æ³•ç™»å½•ã€‚ try_first_passï¼šåœ¨æç¤ºç”¨æˆ·è¾“å…¥å¯†ç å‰ï¼Œå…ˆå°è¯•ä½¿ç”¨ä¹‹å‰æ ˆä¸­å·²ç¼“å­˜çš„å¯†ç ï¼ˆä¾‹å¦‚ï¼Œç”±pam_timestamp.so æˆ– pam_kwallet.so æä¾›çš„ï¼‰ã€‚ use_authtokï¼šå¼ºåˆ¶ä½¿ç”¨ä¹‹å‰æ ˆä¸­å·²ç¼“å­˜çš„å¯†ç ï¼Œå¦‚æœä¸å­˜åœ¨ç¼“å­˜å¯†ç ï¼Œåˆ™ç›´æ¥å¤±è´¥ã€‚å®ƒæ¯”try_first_pass æ›´ä¸¥æ ¼ï¼Œé€šå¸¸ç”¨åœ¨ä¿®æ”¹å¯†ç çš„ password æ¨¡å—æ ˆä¸­ï¼Œä»¥ç¡®ä¿ç”¨æˆ·è¾“å…¥çš„æ˜¯æ—§å¯†ç ã€‚ shadowï¼šä½¿ç”¨ /etc/shadow æ–‡ä»¶è¿›è¡Œå¯†ç éªŒè¯ï¼ˆç°ä»£ç³»ç»Ÿé»˜è®¤å¯ç”¨ï¼‰ã€‚ pam_timestamp.so å‚æ•° (ç”¨äºæ—¶é—´æˆ³è®¤è¯) å¸¸ç”¨äº sudoï¼Œå®ç°å…å¯†ç æ“ä½œã€‚ timestamp_timeout=600ï¼šè®¾ç½®æ—¶é—´æˆ³çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’ã€‚é»˜è®¤æ˜¯ 300 (5åˆ†é’Ÿ)ã€‚ pam_wheel.so å‚æ•° (ç”¨äºç»„æˆå‘˜èµ„æ ¼æ£€æŸ¥) ç”¨äºé™åˆ¶åªæœ‰ç‰¹å®šç»„çš„ç”¨æˆ·æ‰èƒ½ä½¿ç”¨ su æˆ– sudoã€‚ use_uidï¼šæ£€æŸ¥å‘èµ·è¯·æ±‚çš„åŸå§‹ç”¨æˆ· IDï¼Œè€Œä¸æ˜¯å½“å‰ç”¨æˆ· IDï¼ˆåœ¨ sudo åœºæ™¯ä¸‹å¾ˆé‡è¦ï¼‰ã€‚ group=adminsï¼šæŒ‡å®šæ£€æŸ¥çš„ç»„åï¼Œé»˜è®¤æ˜¯ wheelã€‚ pam_gnome_keyring.so å‚æ•° (ç”¨äºä¼šè¯ç®¡ç†) è¿™ä¸ªæ¨¡å—ä¸ sudo çš„è®¤è¯æµç¨‹æ— å…³ï¼Œä¸»è¦ç”¨äºç”¨æˆ·ç™»å½•æ—¶è§£é”å¯†é’¥ç¯ã€‚ auto_startï¼šåœ¨ä¼šè¯å¯åŠ¨æ—¶ï¼Œå¦‚æœç”¨æˆ·å¯†ç ä¸å¯†é’¥ç¯å¯†ç ç›¸åŒï¼Œåˆ™è‡ªåŠ¨è§£é”å¯†é’¥ç¯ã€‚ å…¸å‹åº”ç”¨åœºæ™¯ï¼šåœ¨ /etc/pam.d/gdm-password æˆ– /etc/pam.d/login çš„ auth å’Œsession éƒ¨åˆ†ã€‚ bash # åœ¨ /etc/pam.d/gdm-password ä¸­ auth optional pam_gnome_keyring.so session optional pam_gnome_keyring.so auto_start 3.1.3 åº”ç”¨ç¨‹åºä¸ PAM çš„äº¤äº’ç¨‹åºé€šè¿‡ pam_start() æŒ‡å®šæœåŠ¡åï¼Œç³»ç»Ÿæ®æ­¤åŠ è½½å¯¹åº”çš„é…ç½®æ–‡ä»¶ã€‚ ç¨‹åº æœåŠ¡å é…ç½®æ–‡ä»¶ åŠŸèƒ½ login \"login\" /etc/pam.d/login æ§åˆ¶å°ç™»å½• gdm \"gdm\" /etc/pam.d/gdm GNOME ç™»å½•ç•Œé¢ sudo \"sudo\" /etc/pam.d/sudo ææƒå‘½ä»¤ sshd \"sshd\" /etc/pam.d/sshd SSH ç™»å½• greetd \"greetd\" /etc/pam.d/greetd è½»é‡æ˜¾ç¤ºç®¡ç†å™¨ ä¸€ä¸ªå…¸å‹çš„è°ƒç”¨é¡ºåºå¦‚ä¸‹ï¼ˆä»¥ sudo ä¸ºä¾‹ï¼‰ï¼š c pam_start(\"sudo\", user, \u0026conv, \u0026pamh); // åˆå§‹åŒ– PAM pam_authenticate(pamh, 0); // èº«ä»½éªŒè¯ pam_acct_mgmt(pamh, 0); // è´¦æˆ·æ£€æŸ¥ pam_open_session(pamh, 0); // æ‰“å¼€ä¼šè¯ // æ‰§è¡Œç”¨æˆ·å‘½ä»¤ pam_close_session(pamh, 0); // å…³é—­ä¼šè¯ pam_end(pamh, PAM_SUCCESS); // é‡Šæ”¾èµ„æº å¦‚ä¸‹æ˜¯ä¸€ä¸ªç”¨æˆ·ç™»å½•æµç¨‹çš„ PAM è°ƒç”¨ç¤ºä¾‹ï¼š c #include #include #include #include static void log_result(pam_handle_t *pamh, int ret, const char *step) { if (ret == PAM_SUCCESS) { printf(\"[âœ“] %s æˆåŠŸ\\n\", step); } else { fprintf(stderr, \"[âœ—] %s å¤±è´¥: %sï¼ˆè¿”å›ç  %dï¼‰\\n\", step, pam_strerror(pamh, ret), ret); } } int main(int argc, char *argv[]) { pam_handle_t *p","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:4:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#4å¸¸ç”¨æ¨¡å—ç¤ºä¾‹"},{"categories":["tech"],"content":" 3.1 PAM - å¯æ’æ‹”è®¤è¯æ¨¡å—PAMï¼ˆPluggable Authentication Modulesï¼‰ æ˜¯ Linux çš„ç»Ÿä¸€è®¤è¯æ¡†æ¶ï¼Œä¸ºç³»ç»Ÿä¸­çš„å„ç§ç¨‹åº ï¼ˆå¦‚ loginã€sudoã€sshdã€gdm ç­‰ï¼‰æä¾›æ ‡å‡†åŒ–çš„è®¤è¯æ¥å£ã€‚å€ŸåŠ© PAMï¼Œç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶çµæ´»æ§åˆ¶è®¤è¯ç­–ç•¥ï¼Œè€Œæ— éœ€ä¿®æ”¹åº”ç”¨ç¨‹åºæœ¬èº«ã€‚å®ƒæ”¯æŒå¤šç§è®¤è¯æ–¹å¼ï¼ˆå¯†ç ã€æŒ‡çº¹ã€æ™ºèƒ½å¡ã€åŒå› å­éªŒè¯ç­‰ï¼‰ï¼Œæ˜¯ç°ä»£ Linux å®‰å…¨ä½“ç³»çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ã€‚ 3.1.1 å·¥ä½œåŸç†ä¸é…ç½®ç»“æ„PAM é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œå°†è®¤è¯æµç¨‹åˆ†ä¸ºå››ä¸ªé˜¶æ®µã€‚åº”ç”¨ç¨‹åºé€šè¿‡è°ƒç”¨ç›¸åº”çš„ PAM æ¥å£è§¦å‘è¿™äº›é˜¶æ®µï¼Œ ç³»ç»Ÿæ ¹æ® /etc/pam.d/ ä¸‹çš„é…ç½®æ–‡ä»¶æ‰§è¡Œç›¸åº”çš„æ¨¡å—ï¼ˆ.so æ–‡ä»¶ï¼‰ã€‚ ï¼ˆ1ï¼‰é…ç½®æ–‡ä»¶è¯­æ³• https://linux.die.net/man/5/pam.d æ¯è¡Œçš„åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š text [arguments] typeï¼šè¡¨ç¤ºé˜¶æ®µç±»å‹ controlï¼šå®šä¹‰è¯¥æ¨¡å—çš„æ‰§è¡Œç­–ç•¥ moduleï¼šå…·ä½“çš„ PAM æ¨¡å—è·¯å¾„ï¼ˆæˆ–åç§°ï¼‰ argumentsï¼šä¼ é€’ç»™æ¨¡å—çš„å‚æ•° ï¼ˆ2ï¼‰å››ä¸ªè®¤è¯é˜¶æ®µ é˜¶æ®µç±»å‹ è°ƒç”¨å‡½æ•° ä¸»è¦ä½œç”¨ auth pam_authenticate() éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œé€šå¸¸ä¼šæç¤ºç”¨æˆ·è¾“å‡ºå¯†ç æˆ–æŒ‡çº¹ä»¥å®ŒæˆéªŒè¯ account pam_acct_mgmt() æ£€æŸ¥è´¦æˆ·çŠ¶æ€ï¼ˆè¿‡æœŸã€é”å®šç­‰ï¼‰ password pam_chauthtok() å¤„ç†å¯†ç ä¿®æ”¹ session pam_open_session() / pam_close_session() å»ºç«‹å’Œæ¸…ç†ç”¨æˆ·ä¼šè¯ ï¼ˆ3ï¼‰æ§åˆ¶æ ‡å¿—ï¼ˆcontrolï¼‰ æ ‡å¿— å«ä¹‰ è¡Œä¸ºè¯´æ˜ required å¿…é¡»æˆåŠŸï¼Œå¤±è´¥ä¸ä¼šç«‹å³ç»ˆæ­¢ï¼Œä½†æœ€ç»ˆç»“æœä¼šå¤±è´¥ æ— è®ºæˆåŠŸå¤±è´¥ï¼Œéƒ½ä¼šç»§ç»­æ‰§è¡Œåç»­æ¨¡å—ã€‚æœ€ç»ˆåªè¦æœ‰ä¸€ä¸ª required å¤±è´¥ï¼Œæ•´ä¸ªè®¤è¯å°±å¤±è´¥ã€‚ requisite å¿…é¡»æˆåŠŸï¼Œå¤±è´¥ç«‹å³ç»ˆæ­¢å¹¶è¿”å›å¤±è´¥ å¤±è´¥ç«‹å³è¿”å›ï¼Œä¸å†æ‰§è¡Œåç»­æ¨¡å—ã€‚ sufficient æˆåŠŸåˆ™ç«‹å³é€šè¿‡è®¤è¯ï¼ˆè·³è¿‡æ‰€æœ‰åç»­æ¨¡å—ï¼‰ï¼›å¤±è´¥åˆ™ç»§ç»­ç”±åç»­æ¨¡å—è¿›è¡Œè®¤è¯ è‹¥å‰é¢æ²¡æœ‰ required å¤±è´¥ï¼Œåˆ™æˆåŠŸç›´æ¥é€šè¿‡ï¼›å¦åˆ™å¤±è´¥ä¸å½±å“åç»­ã€‚ optional å¯é€‰æ¨¡å—ï¼Œç»“æœé€šå¸¸è¢«å¿½ç•¥ æ— è®ºæˆåŠŸå¤±è´¥ï¼Œå¯¹æœ€ç»ˆç»“æœæ— ç›´æ¥å½±å“ï¼Œé™¤éæ˜¯æ ˆä¸­å”¯ä¸€çš„æ¨¡å—ã€‚ include åŒ…å«å¦ä¸€ä¸ªæ–‡ä»¶çš„é…ç½® å°†æŒ‡å®šæ–‡ä»¶çš„é…ç½®å†…å®¹åŒ…å«è¿›æ¥ï¼Œé€šå¸¸ç”¨äºå¤ç”¨é€šç”¨é…ç½®ï¼ˆå¦‚ system-authï¼‰ã€‚ substack è°ƒç”¨å­æ ˆ ç±»ä¼¼ includeï¼Œä½†å­æ ˆçš„å¤±è´¥ä¸å½±å“ä¸»æ ˆï¼ˆå³å­æ ˆåªèƒ½è·³è¿‡å…¶è‡ªèº«çš„åç»­æ­¥éª¤ï¼‰ï¼Œé™¤éä¸»æ ˆä¸­å¦æœ‰è®¾ç½®ã€‚ ï¼ˆ4ï¼‰å¸¸ç”¨æ¨¡å—ç¤ºä¾‹ bash pam_unix.so # åŸºäº /etc/passwd ä¸ /etc/shadow çš„æ ‡å‡†å¯†ç è®¤è¯ pam_google_authenticator.so # åŒå› å­è®¤è¯ï¼ˆTOTPï¼‰ pam_fprintd.so # æŒ‡çº¹è®¤è¯ pam_ldap.so # LDAP é›†ä¸­å¼è®¤è¯ pam_gnome_keyring.so # GNOME å¯†é’¥ç¯é›†æˆ pam_limits.so # ç”¨æˆ·èµ„æºé™åˆ¶ pam_deny.so # æ‹’ç»æ‰€æœ‰è®¤è¯è¯·æ±‚ 3.1.2 æ‰§è¡Œæµç¨‹ç¤ºä¾‹ä»¥ /etc/pam.d/sudo ä¸ºä¾‹ï¼š bash #%PAM-1.0 auth sufficient pam_rootok.so auth sufficient pam_timestamp.so auth required pam_wheel.so use_uid auth required pam_unix.so nullok try_first_pass å„æ¨¡å—çš„æ‰§è¡Œé¡ºåºå¦‚ä¸‹ï¼š æ‰§è¡Œ pam_rootok.so (sufficient)ï¼š æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦ä¸º rootã€‚ å¦‚æœæˆåŠŸï¼šPAM è®¤è¯æµç¨‹ç«‹å³æˆåŠŸï¼Œå¹¶è·³è¿‡åç»­æ‰€æœ‰ auth æ¨¡å—ã€‚ç”¨æˆ·ç›´æ¥è·å¾— sudo æƒé™ã€‚ å¦‚æœå¤±è´¥ï¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªæ¨¡å—ã€‚ æ‰§è¡Œ pam_timestamp.so (sufficient)ï¼š æ£€æŸ¥æ˜¯å¦å­˜åœ¨æœ‰æ•ˆçš„æ—¶é—´æˆ³æ–‡ä»¶ï¼ˆé»˜è®¤ä¸º 5 åˆ†é’Ÿå†…ï¼‰ã€‚ å¦‚æœæˆåŠŸï¼šPAM è®¤è¯æµç¨‹ç«‹å³æˆåŠŸï¼Œå¹¶è·³è¿‡åç»­æ‰€æœ‰ auth æ¨¡å—ã€‚ç”¨æˆ·å…å¯†ç è·å¾— sudo æƒé™ã€‚ å¦‚æœå¤±è´¥ï¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªæ¨¡å—ã€‚ æ‰§è¡Œ pam_wheel.so (required)ï¼š æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦åœ¨ wheel ç»„ï¼ˆæˆ– sudo ç»„ï¼Œå–å†³äºé…ç½®ï¼‰ä¸­ã€‚ æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½å¿…é¡»ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ª required æ¨¡å—ã€‚ä½†å…¶ç»“æœä¼šè¢«è®°å½•ä¸‹æ¥ã€‚ æ‰§è¡Œ pam_unix.so (required)ï¼š ä½¿ç”¨ nullok å’Œ try_first_pass å‚æ•°è¿›è¡Œå¯†ç éªŒè¯ã€‚ nullokï¼šå…è®¸ç©ºå¯†ç è´¦æˆ·ç™»å½•ã€‚ try_first_passï¼šå°è¯•ä½¿ç”¨å‰é¢æ¨¡å—ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰æä¾›çš„å¯†ç ã€‚å¯¹äº sudoï¼Œè¿™é€šå¸¸æŒ‡ä¹‹å‰ sudo æˆåŠŸæ—¶ç¼“å­˜çš„å¯†ç ã€‚ å¦‚æœå¯†ç æ­£ç¡®ï¼šæ­¤æ¨¡å—æˆåŠŸã€‚ å¦‚æœå¯†ç é”™è¯¯ï¼šæ­¤æ¨¡å—å¤±è´¥ã€‚ æœ€ç»ˆç»“æœåˆ¤å®šï¼š åœ¨æ‰€æœ‰ required æ¨¡å—æ‰§è¡Œå®Œæ¯•åï¼ŒPAM ä¼šæ£€æŸ¥å®ƒä»¬çš„ç»“æœã€‚ å¦‚æœä»»ä½•ä¸€ä¸ª required æ¨¡å—ï¼ˆpam_wheel.so æˆ– pam_unix.soï¼‰å¤±è´¥ï¼Œæ•´ä¸ªè®¤è¯æµç¨‹å¤±è´¥ã€‚ åªæœ‰å½“æ‰€æœ‰ required æ¨¡å—éƒ½æˆåŠŸæ—¶ï¼Œè®¤è¯æ‰æœ€ç»ˆæˆåŠŸã€‚ å¸¸ç”¨æ¨¡å—åŠå…¶å‚æ•°è¯´æ˜ï¼š pam_unix.so å‚æ•° (ç”¨äºå¯†ç éªŒè¯) è¿™æ˜¯æœ€æ ¸å¿ƒçš„å¯†ç è®¤è¯æ¨¡å—ï¼Œå¸¸è§äº auth å’Œ password ç±»å‹ã€‚ nullokï¼šå…è®¸ç©ºå¯†ç è´¦æˆ·é€šè¿‡è®¤è¯ã€‚å¦‚æœä¸åŠ æ­¤å‚æ•°ï¼Œç©ºå¯†ç è´¦æˆ·å°†æ— æ³•ç™»å½•ã€‚ try_first_passï¼šåœ¨æç¤ºç”¨æˆ·è¾“å…¥å¯†ç å‰ï¼Œå…ˆå°è¯•ä½¿ç”¨ä¹‹å‰æ ˆä¸­å·²ç¼“å­˜çš„å¯†ç ï¼ˆä¾‹å¦‚ï¼Œç”±pam_timestamp.so æˆ– pam_kwallet.so æä¾›çš„ï¼‰ã€‚ use_authtokï¼šå¼ºåˆ¶ä½¿ç”¨ä¹‹å‰æ ˆä¸­å·²ç¼“å­˜çš„å¯†ç ï¼Œå¦‚æœä¸å­˜åœ¨ç¼“å­˜å¯†ç ï¼Œåˆ™ç›´æ¥å¤±è´¥ã€‚å®ƒæ¯”try_first_pass æ›´ä¸¥æ ¼ï¼Œé€šå¸¸ç”¨åœ¨ä¿®æ”¹å¯†ç çš„ password æ¨¡å—æ ˆä¸­ï¼Œä»¥ç¡®ä¿ç”¨æˆ·è¾“å…¥çš„æ˜¯æ—§å¯†ç ã€‚ shadowï¼šä½¿ç”¨ /etc/shadow æ–‡ä»¶è¿›è¡Œå¯†ç éªŒè¯ï¼ˆç°ä»£ç³»ç»Ÿé»˜è®¤å¯ç”¨ï¼‰ã€‚ pam_timestamp.so å‚æ•° (ç”¨äºæ—¶é—´æˆ³è®¤è¯) å¸¸ç”¨äº sudoï¼Œå®ç°å…å¯†ç æ“ä½œã€‚ timestamp_timeout=600ï¼šè®¾ç½®æ—¶é—´æˆ³çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’ã€‚é»˜è®¤æ˜¯ 300 (5åˆ†é’Ÿ)ã€‚ pam_wheel.so å‚æ•° (ç”¨äºç»„æˆå‘˜èµ„æ ¼æ£€æŸ¥) ç”¨äºé™åˆ¶åªæœ‰ç‰¹å®šç»„çš„ç”¨æˆ·æ‰èƒ½ä½¿ç”¨ su æˆ– sudoã€‚ use_uidï¼šæ£€æŸ¥å‘èµ·è¯·æ±‚çš„åŸå§‹ç”¨æˆ· IDï¼Œè€Œä¸æ˜¯å½“å‰ç”¨æˆ· IDï¼ˆåœ¨ sudo åœºæ™¯ä¸‹å¾ˆé‡è¦ï¼‰ã€‚ group=adminsï¼šæŒ‡å®šæ£€æŸ¥çš„ç»„åï¼Œé»˜è®¤æ˜¯ wheelã€‚ pam_gnome_keyring.so å‚æ•° (ç”¨äºä¼šè¯ç®¡ç†) è¿™ä¸ªæ¨¡å—ä¸ sudo çš„è®¤è¯æµç¨‹æ— å…³ï¼Œä¸»è¦ç”¨äºç”¨æˆ·ç™»å½•æ—¶è§£é”å¯†é’¥ç¯ã€‚ auto_startï¼šåœ¨ä¼šè¯å¯åŠ¨æ—¶ï¼Œå¦‚æœç”¨æˆ·å¯†ç ä¸å¯†é’¥ç¯å¯†ç ç›¸åŒï¼Œåˆ™è‡ªåŠ¨è§£é”å¯†é’¥ç¯ã€‚ å…¸å‹åº”ç”¨åœºæ™¯ï¼šåœ¨ /etc/pam.d/gdm-password æˆ– /etc/pam.d/login çš„ auth å’Œsession éƒ¨åˆ†ã€‚ bash # åœ¨ /etc/pam.d/gdm-password ä¸­ auth optional pam_gnome_keyring.so session optional pam_gnome_keyring.so auto_start 3.1.3 åº”ç”¨ç¨‹åºä¸ PAM çš„äº¤äº’ç¨‹åºé€šè¿‡ pam_start() æŒ‡å®šæœåŠ¡åï¼Œç³»ç»Ÿæ®æ­¤åŠ è½½å¯¹åº”çš„é…ç½®æ–‡ä»¶ã€‚ ç¨‹åº æœåŠ¡å é…ç½®æ–‡ä»¶ åŠŸèƒ½ login \"login\" /etc/pam.d/login æ§åˆ¶å°ç™»å½• gdm \"gdm\" /etc/pam.d/gdm GNOME ç™»å½•ç•Œé¢ sudo \"sudo\" /etc/pam.d/sudo ææƒå‘½ä»¤ sshd \"sshd\" /etc/pam.d/sshd SSH ç™»å½• greetd \"greetd\" /etc/pam.d/greetd è½»é‡æ˜¾ç¤ºç®¡ç†å™¨ ä¸€ä¸ªå…¸å‹çš„è°ƒç”¨é¡ºåºå¦‚ä¸‹ï¼ˆä»¥ sudo ä¸ºä¾‹ï¼‰ï¼š c pam_start(\"sudo\", user, \u0026conv, \u0026pamh); // åˆå§‹åŒ– PAM pam_authenticate(pamh, 0); // èº«ä»½éªŒè¯ pam_acct_mgmt(pamh, 0); // è´¦æˆ·æ£€æŸ¥ pam_open_session(pamh, 0); // æ‰“å¼€ä¼šè¯ // æ‰§è¡Œç”¨æˆ·å‘½ä»¤ pam_close_session(pamh, 0); // å…³é—­ä¼šè¯ pam_end(pamh, PAM_SUCCESS); // é‡Šæ”¾èµ„æº å¦‚ä¸‹æ˜¯ä¸€ä¸ªç”¨æˆ·ç™»å½•æµç¨‹çš„ PAM è°ƒç”¨ç¤ºä¾‹ï¼š c #include #include #include #include static void log_result(pam_handle_t *pamh, int ret, const char *step) { if (ret == PAM_SUCCESS) { printf(\"[âœ“] %s æˆåŠŸ\\n\", step); } else { fprintf(stderr, \"[âœ—] %s å¤±è´¥: %sï¼ˆè¿”å›ç  %dï¼‰\\n\", step, pam_strerror(pamh, ret), ret); } } int main(int argc, char *argv[]) { pam_handle_t *p","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:4:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#312-æ‰§è¡Œæµç¨‹ç¤ºä¾‹"},{"categories":["tech"],"content":" 3.1 PAM - å¯æ’æ‹”è®¤è¯æ¨¡å—PAMï¼ˆPluggable Authentication Modulesï¼‰ æ˜¯ Linux çš„ç»Ÿä¸€è®¤è¯æ¡†æ¶ï¼Œä¸ºç³»ç»Ÿä¸­çš„å„ç§ç¨‹åº ï¼ˆå¦‚ loginã€sudoã€sshdã€gdm ç­‰ï¼‰æä¾›æ ‡å‡†åŒ–çš„è®¤è¯æ¥å£ã€‚å€ŸåŠ© PAMï¼Œç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶çµæ´»æ§åˆ¶è®¤è¯ç­–ç•¥ï¼Œè€Œæ— éœ€ä¿®æ”¹åº”ç”¨ç¨‹åºæœ¬èº«ã€‚å®ƒæ”¯æŒå¤šç§è®¤è¯æ–¹å¼ï¼ˆå¯†ç ã€æŒ‡çº¹ã€æ™ºèƒ½å¡ã€åŒå› å­éªŒè¯ç­‰ï¼‰ï¼Œæ˜¯ç°ä»£ Linux å®‰å…¨ä½“ç³»çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ã€‚ 3.1.1 å·¥ä½œåŸç†ä¸é…ç½®ç»“æ„PAM é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œå°†è®¤è¯æµç¨‹åˆ†ä¸ºå››ä¸ªé˜¶æ®µã€‚åº”ç”¨ç¨‹åºé€šè¿‡è°ƒç”¨ç›¸åº”çš„ PAM æ¥å£è§¦å‘è¿™äº›é˜¶æ®µï¼Œ ç³»ç»Ÿæ ¹æ® /etc/pam.d/ ä¸‹çš„é…ç½®æ–‡ä»¶æ‰§è¡Œç›¸åº”çš„æ¨¡å—ï¼ˆ.so æ–‡ä»¶ï¼‰ã€‚ ï¼ˆ1ï¼‰é…ç½®æ–‡ä»¶è¯­æ³• https://linux.die.net/man/5/pam.d æ¯è¡Œçš„åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š text [arguments] typeï¼šè¡¨ç¤ºé˜¶æ®µç±»å‹ controlï¼šå®šä¹‰è¯¥æ¨¡å—çš„æ‰§è¡Œç­–ç•¥ moduleï¼šå…·ä½“çš„ PAM æ¨¡å—è·¯å¾„ï¼ˆæˆ–åç§°ï¼‰ argumentsï¼šä¼ é€’ç»™æ¨¡å—çš„å‚æ•° ï¼ˆ2ï¼‰å››ä¸ªè®¤è¯é˜¶æ®µ é˜¶æ®µç±»å‹ è°ƒç”¨å‡½æ•° ä¸»è¦ä½œç”¨ auth pam_authenticate() éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œé€šå¸¸ä¼šæç¤ºç”¨æˆ·è¾“å‡ºå¯†ç æˆ–æŒ‡çº¹ä»¥å®ŒæˆéªŒè¯ account pam_acct_mgmt() æ£€æŸ¥è´¦æˆ·çŠ¶æ€ï¼ˆè¿‡æœŸã€é”å®šç­‰ï¼‰ password pam_chauthtok() å¤„ç†å¯†ç ä¿®æ”¹ session pam_open_session() / pam_close_session() å»ºç«‹å’Œæ¸…ç†ç”¨æˆ·ä¼šè¯ ï¼ˆ3ï¼‰æ§åˆ¶æ ‡å¿—ï¼ˆcontrolï¼‰ æ ‡å¿— å«ä¹‰ è¡Œä¸ºè¯´æ˜ required å¿…é¡»æˆåŠŸï¼Œå¤±è´¥ä¸ä¼šç«‹å³ç»ˆæ­¢ï¼Œä½†æœ€ç»ˆç»“æœä¼šå¤±è´¥ æ— è®ºæˆåŠŸå¤±è´¥ï¼Œéƒ½ä¼šç»§ç»­æ‰§è¡Œåç»­æ¨¡å—ã€‚æœ€ç»ˆåªè¦æœ‰ä¸€ä¸ª required å¤±è´¥ï¼Œæ•´ä¸ªè®¤è¯å°±å¤±è´¥ã€‚ requisite å¿…é¡»æˆåŠŸï¼Œå¤±è´¥ç«‹å³ç»ˆæ­¢å¹¶è¿”å›å¤±è´¥ å¤±è´¥ç«‹å³è¿”å›ï¼Œä¸å†æ‰§è¡Œåç»­æ¨¡å—ã€‚ sufficient æˆåŠŸåˆ™ç«‹å³é€šè¿‡è®¤è¯ï¼ˆè·³è¿‡æ‰€æœ‰åç»­æ¨¡å—ï¼‰ï¼›å¤±è´¥åˆ™ç»§ç»­ç”±åç»­æ¨¡å—è¿›è¡Œè®¤è¯ è‹¥å‰é¢æ²¡æœ‰ required å¤±è´¥ï¼Œåˆ™æˆåŠŸç›´æ¥é€šè¿‡ï¼›å¦åˆ™å¤±è´¥ä¸å½±å“åç»­ã€‚ optional å¯é€‰æ¨¡å—ï¼Œç»“æœé€šå¸¸è¢«å¿½ç•¥ æ— è®ºæˆåŠŸå¤±è´¥ï¼Œå¯¹æœ€ç»ˆç»“æœæ— ç›´æ¥å½±å“ï¼Œé™¤éæ˜¯æ ˆä¸­å”¯ä¸€çš„æ¨¡å—ã€‚ include åŒ…å«å¦ä¸€ä¸ªæ–‡ä»¶çš„é…ç½® å°†æŒ‡å®šæ–‡ä»¶çš„é…ç½®å†…å®¹åŒ…å«è¿›æ¥ï¼Œé€šå¸¸ç”¨äºå¤ç”¨é€šç”¨é…ç½®ï¼ˆå¦‚ system-authï¼‰ã€‚ substack è°ƒç”¨å­æ ˆ ç±»ä¼¼ includeï¼Œä½†å­æ ˆçš„å¤±è´¥ä¸å½±å“ä¸»æ ˆï¼ˆå³å­æ ˆåªèƒ½è·³è¿‡å…¶è‡ªèº«çš„åç»­æ­¥éª¤ï¼‰ï¼Œé™¤éä¸»æ ˆä¸­å¦æœ‰è®¾ç½®ã€‚ ï¼ˆ4ï¼‰å¸¸ç”¨æ¨¡å—ç¤ºä¾‹ bash pam_unix.so # åŸºäº /etc/passwd ä¸ /etc/shadow çš„æ ‡å‡†å¯†ç è®¤è¯ pam_google_authenticator.so # åŒå› å­è®¤è¯ï¼ˆTOTPï¼‰ pam_fprintd.so # æŒ‡çº¹è®¤è¯ pam_ldap.so # LDAP é›†ä¸­å¼è®¤è¯ pam_gnome_keyring.so # GNOME å¯†é’¥ç¯é›†æˆ pam_limits.so # ç”¨æˆ·èµ„æºé™åˆ¶ pam_deny.so # æ‹’ç»æ‰€æœ‰è®¤è¯è¯·æ±‚ 3.1.2 æ‰§è¡Œæµç¨‹ç¤ºä¾‹ä»¥ /etc/pam.d/sudo ä¸ºä¾‹ï¼š bash #%PAM-1.0 auth sufficient pam_rootok.so auth sufficient pam_timestamp.so auth required pam_wheel.so use_uid auth required pam_unix.so nullok try_first_pass å„æ¨¡å—çš„æ‰§è¡Œé¡ºåºå¦‚ä¸‹ï¼š æ‰§è¡Œ pam_rootok.so (sufficient)ï¼š æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦ä¸º rootã€‚ å¦‚æœæˆåŠŸï¼šPAM è®¤è¯æµç¨‹ç«‹å³æˆåŠŸï¼Œå¹¶è·³è¿‡åç»­æ‰€æœ‰ auth æ¨¡å—ã€‚ç”¨æˆ·ç›´æ¥è·å¾— sudo æƒé™ã€‚ å¦‚æœå¤±è´¥ï¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªæ¨¡å—ã€‚ æ‰§è¡Œ pam_timestamp.so (sufficient)ï¼š æ£€æŸ¥æ˜¯å¦å­˜åœ¨æœ‰æ•ˆçš„æ—¶é—´æˆ³æ–‡ä»¶ï¼ˆé»˜è®¤ä¸º 5 åˆ†é’Ÿå†…ï¼‰ã€‚ å¦‚æœæˆåŠŸï¼šPAM è®¤è¯æµç¨‹ç«‹å³æˆåŠŸï¼Œå¹¶è·³è¿‡åç»­æ‰€æœ‰ auth æ¨¡å—ã€‚ç”¨æˆ·å…å¯†ç è·å¾— sudo æƒé™ã€‚ å¦‚æœå¤±è´¥ï¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªæ¨¡å—ã€‚ æ‰§è¡Œ pam_wheel.so (required)ï¼š æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦åœ¨ wheel ç»„ï¼ˆæˆ– sudo ç»„ï¼Œå–å†³äºé…ç½®ï¼‰ä¸­ã€‚ æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½å¿…é¡»ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ª required æ¨¡å—ã€‚ä½†å…¶ç»“æœä¼šè¢«è®°å½•ä¸‹æ¥ã€‚ æ‰§è¡Œ pam_unix.so (required)ï¼š ä½¿ç”¨ nullok å’Œ try_first_pass å‚æ•°è¿›è¡Œå¯†ç éªŒè¯ã€‚ nullokï¼šå…è®¸ç©ºå¯†ç è´¦æˆ·ç™»å½•ã€‚ try_first_passï¼šå°è¯•ä½¿ç”¨å‰é¢æ¨¡å—ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰æä¾›çš„å¯†ç ã€‚å¯¹äº sudoï¼Œè¿™é€šå¸¸æŒ‡ä¹‹å‰ sudo æˆåŠŸæ—¶ç¼“å­˜çš„å¯†ç ã€‚ å¦‚æœå¯†ç æ­£ç¡®ï¼šæ­¤æ¨¡å—æˆåŠŸã€‚ å¦‚æœå¯†ç é”™è¯¯ï¼šæ­¤æ¨¡å—å¤±è´¥ã€‚ æœ€ç»ˆç»“æœåˆ¤å®šï¼š åœ¨æ‰€æœ‰ required æ¨¡å—æ‰§è¡Œå®Œæ¯•åï¼ŒPAM ä¼šæ£€æŸ¥å®ƒä»¬çš„ç»“æœã€‚ å¦‚æœä»»ä½•ä¸€ä¸ª required æ¨¡å—ï¼ˆpam_wheel.so æˆ– pam_unix.soï¼‰å¤±è´¥ï¼Œæ•´ä¸ªè®¤è¯æµç¨‹å¤±è´¥ã€‚ åªæœ‰å½“æ‰€æœ‰ required æ¨¡å—éƒ½æˆåŠŸæ—¶ï¼Œè®¤è¯æ‰æœ€ç»ˆæˆåŠŸã€‚ å¸¸ç”¨æ¨¡å—åŠå…¶å‚æ•°è¯´æ˜ï¼š pam_unix.so å‚æ•° (ç”¨äºå¯†ç éªŒè¯) è¿™æ˜¯æœ€æ ¸å¿ƒçš„å¯†ç è®¤è¯æ¨¡å—ï¼Œå¸¸è§äº auth å’Œ password ç±»å‹ã€‚ nullokï¼šå…è®¸ç©ºå¯†ç è´¦æˆ·é€šè¿‡è®¤è¯ã€‚å¦‚æœä¸åŠ æ­¤å‚æ•°ï¼Œç©ºå¯†ç è´¦æˆ·å°†æ— æ³•ç™»å½•ã€‚ try_first_passï¼šåœ¨æç¤ºç”¨æˆ·è¾“å…¥å¯†ç å‰ï¼Œå…ˆå°è¯•ä½¿ç”¨ä¹‹å‰æ ˆä¸­å·²ç¼“å­˜çš„å¯†ç ï¼ˆä¾‹å¦‚ï¼Œç”±pam_timestamp.so æˆ– pam_kwallet.so æä¾›çš„ï¼‰ã€‚ use_authtokï¼šå¼ºåˆ¶ä½¿ç”¨ä¹‹å‰æ ˆä¸­å·²ç¼“å­˜çš„å¯†ç ï¼Œå¦‚æœä¸å­˜åœ¨ç¼“å­˜å¯†ç ï¼Œåˆ™ç›´æ¥å¤±è´¥ã€‚å®ƒæ¯”try_first_pass æ›´ä¸¥æ ¼ï¼Œé€šå¸¸ç”¨åœ¨ä¿®æ”¹å¯†ç çš„ password æ¨¡å—æ ˆä¸­ï¼Œä»¥ç¡®ä¿ç”¨æˆ·è¾“å…¥çš„æ˜¯æ—§å¯†ç ã€‚ shadowï¼šä½¿ç”¨ /etc/shadow æ–‡ä»¶è¿›è¡Œå¯†ç éªŒè¯ï¼ˆç°ä»£ç³»ç»Ÿé»˜è®¤å¯ç”¨ï¼‰ã€‚ pam_timestamp.so å‚æ•° (ç”¨äºæ—¶é—´æˆ³è®¤è¯) å¸¸ç”¨äº sudoï¼Œå®ç°å…å¯†ç æ“ä½œã€‚ timestamp_timeout=600ï¼šè®¾ç½®æ—¶é—´æˆ³çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’ã€‚é»˜è®¤æ˜¯ 300 (5åˆ†é’Ÿ)ã€‚ pam_wheel.so å‚æ•° (ç”¨äºç»„æˆå‘˜èµ„æ ¼æ£€æŸ¥) ç”¨äºé™åˆ¶åªæœ‰ç‰¹å®šç»„çš„ç”¨æˆ·æ‰èƒ½ä½¿ç”¨ su æˆ– sudoã€‚ use_uidï¼šæ£€æŸ¥å‘èµ·è¯·æ±‚çš„åŸå§‹ç”¨æˆ· IDï¼Œè€Œä¸æ˜¯å½“å‰ç”¨æˆ· IDï¼ˆåœ¨ sudo åœºæ™¯ä¸‹å¾ˆé‡è¦ï¼‰ã€‚ group=adminsï¼šæŒ‡å®šæ£€æŸ¥çš„ç»„åï¼Œé»˜è®¤æ˜¯ wheelã€‚ pam_gnome_keyring.so å‚æ•° (ç”¨äºä¼šè¯ç®¡ç†) è¿™ä¸ªæ¨¡å—ä¸ sudo çš„è®¤è¯æµç¨‹æ— å…³ï¼Œä¸»è¦ç”¨äºç”¨æˆ·ç™»å½•æ—¶è§£é”å¯†é’¥ç¯ã€‚ auto_startï¼šåœ¨ä¼šè¯å¯åŠ¨æ—¶ï¼Œå¦‚æœç”¨æˆ·å¯†ç ä¸å¯†é’¥ç¯å¯†ç ç›¸åŒï¼Œåˆ™è‡ªåŠ¨è§£é”å¯†é’¥ç¯ã€‚ å…¸å‹åº”ç”¨åœºæ™¯ï¼šåœ¨ /etc/pam.d/gdm-password æˆ– /etc/pam.d/login çš„ auth å’Œsession éƒ¨åˆ†ã€‚ bash # åœ¨ /etc/pam.d/gdm-password ä¸­ auth optional pam_gnome_keyring.so session optional pam_gnome_keyring.so auto_start 3.1.3 åº”ç”¨ç¨‹åºä¸ PAM çš„äº¤äº’ç¨‹åºé€šè¿‡ pam_start() æŒ‡å®šæœåŠ¡åï¼Œç³»ç»Ÿæ®æ­¤åŠ è½½å¯¹åº”çš„é…ç½®æ–‡ä»¶ã€‚ ç¨‹åº æœåŠ¡å é…ç½®æ–‡ä»¶ åŠŸèƒ½ login \"login\" /etc/pam.d/login æ§åˆ¶å°ç™»å½• gdm \"gdm\" /etc/pam.d/gdm GNOME ç™»å½•ç•Œé¢ sudo \"sudo\" /etc/pam.d/sudo ææƒå‘½ä»¤ sshd \"sshd\" /etc/pam.d/sshd SSH ç™»å½• greetd \"greetd\" /etc/pam.d/greetd è½»é‡æ˜¾ç¤ºç®¡ç†å™¨ ä¸€ä¸ªå…¸å‹çš„è°ƒç”¨é¡ºåºå¦‚ä¸‹ï¼ˆä»¥ sudo ä¸ºä¾‹ï¼‰ï¼š c pam_start(\"sudo\", user, \u0026conv, \u0026pamh); // åˆå§‹åŒ– PAM pam_authenticate(pamh, 0); // èº«ä»½éªŒè¯ pam_acct_mgmt(pamh, 0); // è´¦æˆ·æ£€æŸ¥ pam_open_session(pamh, 0); // æ‰“å¼€ä¼šè¯ // æ‰§è¡Œç”¨æˆ·å‘½ä»¤ pam_close_session(pamh, 0); // å…³é—­ä¼šè¯ pam_end(pamh, PAM_SUCCESS); // é‡Šæ”¾èµ„æº å¦‚ä¸‹æ˜¯ä¸€ä¸ªç”¨æˆ·ç™»å½•æµç¨‹çš„ PAM è°ƒç”¨ç¤ºä¾‹ï¼š c #include #include #include #include static void log_result(pam_handle_t *pamh, int ret, const char *step) { if (ret == PAM_SUCCESS) { printf(\"[âœ“] %s æˆåŠŸ\\n\", step); } else { fprintf(stderr, \"[âœ—] %s å¤±è´¥: %sï¼ˆè¿”å›ç  %dï¼‰\\n\", step, pam_strerror(pamh, ret), ret); } } int main(int argc, char *argv[]) { pam_handle_t *p","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:4:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#313-åº”ç”¨ç¨‹åºä¸-pam-çš„äº¤äº’"},{"categories":["tech"],"content":" 3.1 PAM - å¯æ’æ‹”è®¤è¯æ¨¡å—PAMï¼ˆPluggable Authentication Modulesï¼‰ æ˜¯ Linux çš„ç»Ÿä¸€è®¤è¯æ¡†æ¶ï¼Œä¸ºç³»ç»Ÿä¸­çš„å„ç§ç¨‹åº ï¼ˆå¦‚ loginã€sudoã€sshdã€gdm ç­‰ï¼‰æä¾›æ ‡å‡†åŒ–çš„è®¤è¯æ¥å£ã€‚å€ŸåŠ© PAMï¼Œç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶çµæ´»æ§åˆ¶è®¤è¯ç­–ç•¥ï¼Œè€Œæ— éœ€ä¿®æ”¹åº”ç”¨ç¨‹åºæœ¬èº«ã€‚å®ƒæ”¯æŒå¤šç§è®¤è¯æ–¹å¼ï¼ˆå¯†ç ã€æŒ‡çº¹ã€æ™ºèƒ½å¡ã€åŒå› å­éªŒè¯ç­‰ï¼‰ï¼Œæ˜¯ç°ä»£ Linux å®‰å…¨ä½“ç³»çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ã€‚ 3.1.1 å·¥ä½œåŸç†ä¸é…ç½®ç»“æ„PAM é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œå°†è®¤è¯æµç¨‹åˆ†ä¸ºå››ä¸ªé˜¶æ®µã€‚åº”ç”¨ç¨‹åºé€šè¿‡è°ƒç”¨ç›¸åº”çš„ PAM æ¥å£è§¦å‘è¿™äº›é˜¶æ®µï¼Œ ç³»ç»Ÿæ ¹æ® /etc/pam.d/ ä¸‹çš„é…ç½®æ–‡ä»¶æ‰§è¡Œç›¸åº”çš„æ¨¡å—ï¼ˆ.so æ–‡ä»¶ï¼‰ã€‚ ï¼ˆ1ï¼‰é…ç½®æ–‡ä»¶è¯­æ³• https://linux.die.net/man/5/pam.d æ¯è¡Œçš„åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š text [arguments] typeï¼šè¡¨ç¤ºé˜¶æ®µç±»å‹ controlï¼šå®šä¹‰è¯¥æ¨¡å—çš„æ‰§è¡Œç­–ç•¥ moduleï¼šå…·ä½“çš„ PAM æ¨¡å—è·¯å¾„ï¼ˆæˆ–åç§°ï¼‰ argumentsï¼šä¼ é€’ç»™æ¨¡å—çš„å‚æ•° ï¼ˆ2ï¼‰å››ä¸ªè®¤è¯é˜¶æ®µ é˜¶æ®µç±»å‹ è°ƒç”¨å‡½æ•° ä¸»è¦ä½œç”¨ auth pam_authenticate() éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œé€šå¸¸ä¼šæç¤ºç”¨æˆ·è¾“å‡ºå¯†ç æˆ–æŒ‡çº¹ä»¥å®ŒæˆéªŒè¯ account pam_acct_mgmt() æ£€æŸ¥è´¦æˆ·çŠ¶æ€ï¼ˆè¿‡æœŸã€é”å®šç­‰ï¼‰ password pam_chauthtok() å¤„ç†å¯†ç ä¿®æ”¹ session pam_open_session() / pam_close_session() å»ºç«‹å’Œæ¸…ç†ç”¨æˆ·ä¼šè¯ ï¼ˆ3ï¼‰æ§åˆ¶æ ‡å¿—ï¼ˆcontrolï¼‰ æ ‡å¿— å«ä¹‰ è¡Œä¸ºè¯´æ˜ required å¿…é¡»æˆåŠŸï¼Œå¤±è´¥ä¸ä¼šç«‹å³ç»ˆæ­¢ï¼Œä½†æœ€ç»ˆç»“æœä¼šå¤±è´¥ æ— è®ºæˆåŠŸå¤±è´¥ï¼Œéƒ½ä¼šç»§ç»­æ‰§è¡Œåç»­æ¨¡å—ã€‚æœ€ç»ˆåªè¦æœ‰ä¸€ä¸ª required å¤±è´¥ï¼Œæ•´ä¸ªè®¤è¯å°±å¤±è´¥ã€‚ requisite å¿…é¡»æˆåŠŸï¼Œå¤±è´¥ç«‹å³ç»ˆæ­¢å¹¶è¿”å›å¤±è´¥ å¤±è´¥ç«‹å³è¿”å›ï¼Œä¸å†æ‰§è¡Œåç»­æ¨¡å—ã€‚ sufficient æˆåŠŸåˆ™ç«‹å³é€šè¿‡è®¤è¯ï¼ˆè·³è¿‡æ‰€æœ‰åç»­æ¨¡å—ï¼‰ï¼›å¤±è´¥åˆ™ç»§ç»­ç”±åç»­æ¨¡å—è¿›è¡Œè®¤è¯ è‹¥å‰é¢æ²¡æœ‰ required å¤±è´¥ï¼Œåˆ™æˆåŠŸç›´æ¥é€šè¿‡ï¼›å¦åˆ™å¤±è´¥ä¸å½±å“åç»­ã€‚ optional å¯é€‰æ¨¡å—ï¼Œç»“æœé€šå¸¸è¢«å¿½ç•¥ æ— è®ºæˆåŠŸå¤±è´¥ï¼Œå¯¹æœ€ç»ˆç»“æœæ— ç›´æ¥å½±å“ï¼Œé™¤éæ˜¯æ ˆä¸­å”¯ä¸€çš„æ¨¡å—ã€‚ include åŒ…å«å¦ä¸€ä¸ªæ–‡ä»¶çš„é…ç½® å°†æŒ‡å®šæ–‡ä»¶çš„é…ç½®å†…å®¹åŒ…å«è¿›æ¥ï¼Œé€šå¸¸ç”¨äºå¤ç”¨é€šç”¨é…ç½®ï¼ˆå¦‚ system-authï¼‰ã€‚ substack è°ƒç”¨å­æ ˆ ç±»ä¼¼ includeï¼Œä½†å­æ ˆçš„å¤±è´¥ä¸å½±å“ä¸»æ ˆï¼ˆå³å­æ ˆåªèƒ½è·³è¿‡å…¶è‡ªèº«çš„åç»­æ­¥éª¤ï¼‰ï¼Œé™¤éä¸»æ ˆä¸­å¦æœ‰è®¾ç½®ã€‚ ï¼ˆ4ï¼‰å¸¸ç”¨æ¨¡å—ç¤ºä¾‹ bash pam_unix.so # åŸºäº /etc/passwd ä¸ /etc/shadow çš„æ ‡å‡†å¯†ç è®¤è¯ pam_google_authenticator.so # åŒå› å­è®¤è¯ï¼ˆTOTPï¼‰ pam_fprintd.so # æŒ‡çº¹è®¤è¯ pam_ldap.so # LDAP é›†ä¸­å¼è®¤è¯ pam_gnome_keyring.so # GNOME å¯†é’¥ç¯é›†æˆ pam_limits.so # ç”¨æˆ·èµ„æºé™åˆ¶ pam_deny.so # æ‹’ç»æ‰€æœ‰è®¤è¯è¯·æ±‚ 3.1.2 æ‰§è¡Œæµç¨‹ç¤ºä¾‹ä»¥ /etc/pam.d/sudo ä¸ºä¾‹ï¼š bash #%PAM-1.0 auth sufficient pam_rootok.so auth sufficient pam_timestamp.so auth required pam_wheel.so use_uid auth required pam_unix.so nullok try_first_pass å„æ¨¡å—çš„æ‰§è¡Œé¡ºåºå¦‚ä¸‹ï¼š æ‰§è¡Œ pam_rootok.so (sufficient)ï¼š æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦ä¸º rootã€‚ å¦‚æœæˆåŠŸï¼šPAM è®¤è¯æµç¨‹ç«‹å³æˆåŠŸï¼Œå¹¶è·³è¿‡åç»­æ‰€æœ‰ auth æ¨¡å—ã€‚ç”¨æˆ·ç›´æ¥è·å¾— sudo æƒé™ã€‚ å¦‚æœå¤±è´¥ï¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªæ¨¡å—ã€‚ æ‰§è¡Œ pam_timestamp.so (sufficient)ï¼š æ£€æŸ¥æ˜¯å¦å­˜åœ¨æœ‰æ•ˆçš„æ—¶é—´æˆ³æ–‡ä»¶ï¼ˆé»˜è®¤ä¸º 5 åˆ†é’Ÿå†…ï¼‰ã€‚ å¦‚æœæˆåŠŸï¼šPAM è®¤è¯æµç¨‹ç«‹å³æˆåŠŸï¼Œå¹¶è·³è¿‡åç»­æ‰€æœ‰ auth æ¨¡å—ã€‚ç”¨æˆ·å…å¯†ç è·å¾— sudo æƒé™ã€‚ å¦‚æœå¤±è´¥ï¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªæ¨¡å—ã€‚ æ‰§è¡Œ pam_wheel.so (required)ï¼š æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦åœ¨ wheel ç»„ï¼ˆæˆ– sudo ç»„ï¼Œå–å†³äºé…ç½®ï¼‰ä¸­ã€‚ æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½å¿…é¡»ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ª required æ¨¡å—ã€‚ä½†å…¶ç»“æœä¼šè¢«è®°å½•ä¸‹æ¥ã€‚ æ‰§è¡Œ pam_unix.so (required)ï¼š ä½¿ç”¨ nullok å’Œ try_first_pass å‚æ•°è¿›è¡Œå¯†ç éªŒè¯ã€‚ nullokï¼šå…è®¸ç©ºå¯†ç è´¦æˆ·ç™»å½•ã€‚ try_first_passï¼šå°è¯•ä½¿ç”¨å‰é¢æ¨¡å—ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰æä¾›çš„å¯†ç ã€‚å¯¹äº sudoï¼Œè¿™é€šå¸¸æŒ‡ä¹‹å‰ sudo æˆåŠŸæ—¶ç¼“å­˜çš„å¯†ç ã€‚ å¦‚æœå¯†ç æ­£ç¡®ï¼šæ­¤æ¨¡å—æˆåŠŸã€‚ å¦‚æœå¯†ç é”™è¯¯ï¼šæ­¤æ¨¡å—å¤±è´¥ã€‚ æœ€ç»ˆç»“æœåˆ¤å®šï¼š åœ¨æ‰€æœ‰ required æ¨¡å—æ‰§è¡Œå®Œæ¯•åï¼ŒPAM ä¼šæ£€æŸ¥å®ƒä»¬çš„ç»“æœã€‚ å¦‚æœä»»ä½•ä¸€ä¸ª required æ¨¡å—ï¼ˆpam_wheel.so æˆ– pam_unix.soï¼‰å¤±è´¥ï¼Œæ•´ä¸ªè®¤è¯æµç¨‹å¤±è´¥ã€‚ åªæœ‰å½“æ‰€æœ‰ required æ¨¡å—éƒ½æˆåŠŸæ—¶ï¼Œè®¤è¯æ‰æœ€ç»ˆæˆåŠŸã€‚ å¸¸ç”¨æ¨¡å—åŠå…¶å‚æ•°è¯´æ˜ï¼š pam_unix.so å‚æ•° (ç”¨äºå¯†ç éªŒè¯) è¿™æ˜¯æœ€æ ¸å¿ƒçš„å¯†ç è®¤è¯æ¨¡å—ï¼Œå¸¸è§äº auth å’Œ password ç±»å‹ã€‚ nullokï¼šå…è®¸ç©ºå¯†ç è´¦æˆ·é€šè¿‡è®¤è¯ã€‚å¦‚æœä¸åŠ æ­¤å‚æ•°ï¼Œç©ºå¯†ç è´¦æˆ·å°†æ— æ³•ç™»å½•ã€‚ try_first_passï¼šåœ¨æç¤ºç”¨æˆ·è¾“å…¥å¯†ç å‰ï¼Œå…ˆå°è¯•ä½¿ç”¨ä¹‹å‰æ ˆä¸­å·²ç¼“å­˜çš„å¯†ç ï¼ˆä¾‹å¦‚ï¼Œç”±pam_timestamp.so æˆ– pam_kwallet.so æä¾›çš„ï¼‰ã€‚ use_authtokï¼šå¼ºåˆ¶ä½¿ç”¨ä¹‹å‰æ ˆä¸­å·²ç¼“å­˜çš„å¯†ç ï¼Œå¦‚æœä¸å­˜åœ¨ç¼“å­˜å¯†ç ï¼Œåˆ™ç›´æ¥å¤±è´¥ã€‚å®ƒæ¯”try_first_pass æ›´ä¸¥æ ¼ï¼Œé€šå¸¸ç”¨åœ¨ä¿®æ”¹å¯†ç çš„ password æ¨¡å—æ ˆä¸­ï¼Œä»¥ç¡®ä¿ç”¨æˆ·è¾“å…¥çš„æ˜¯æ—§å¯†ç ã€‚ shadowï¼šä½¿ç”¨ /etc/shadow æ–‡ä»¶è¿›è¡Œå¯†ç éªŒè¯ï¼ˆç°ä»£ç³»ç»Ÿé»˜è®¤å¯ç”¨ï¼‰ã€‚ pam_timestamp.so å‚æ•° (ç”¨äºæ—¶é—´æˆ³è®¤è¯) å¸¸ç”¨äº sudoï¼Œå®ç°å…å¯†ç æ“ä½œã€‚ timestamp_timeout=600ï¼šè®¾ç½®æ—¶é—´æˆ³çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’ã€‚é»˜è®¤æ˜¯ 300 (5åˆ†é’Ÿ)ã€‚ pam_wheel.so å‚æ•° (ç”¨äºç»„æˆå‘˜èµ„æ ¼æ£€æŸ¥) ç”¨äºé™åˆ¶åªæœ‰ç‰¹å®šç»„çš„ç”¨æˆ·æ‰èƒ½ä½¿ç”¨ su æˆ– sudoã€‚ use_uidï¼šæ£€æŸ¥å‘èµ·è¯·æ±‚çš„åŸå§‹ç”¨æˆ· IDï¼Œè€Œä¸æ˜¯å½“å‰ç”¨æˆ· IDï¼ˆåœ¨ sudo åœºæ™¯ä¸‹å¾ˆé‡è¦ï¼‰ã€‚ group=adminsï¼šæŒ‡å®šæ£€æŸ¥çš„ç»„åï¼Œé»˜è®¤æ˜¯ wheelã€‚ pam_gnome_keyring.so å‚æ•° (ç”¨äºä¼šè¯ç®¡ç†) è¿™ä¸ªæ¨¡å—ä¸ sudo çš„è®¤è¯æµç¨‹æ— å…³ï¼Œä¸»è¦ç”¨äºç”¨æˆ·ç™»å½•æ—¶è§£é”å¯†é’¥ç¯ã€‚ auto_startï¼šåœ¨ä¼šè¯å¯åŠ¨æ—¶ï¼Œå¦‚æœç”¨æˆ·å¯†ç ä¸å¯†é’¥ç¯å¯†ç ç›¸åŒï¼Œåˆ™è‡ªåŠ¨è§£é”å¯†é’¥ç¯ã€‚ å…¸å‹åº”ç”¨åœºæ™¯ï¼šåœ¨ /etc/pam.d/gdm-password æˆ– /etc/pam.d/login çš„ auth å’Œsession éƒ¨åˆ†ã€‚ bash # åœ¨ /etc/pam.d/gdm-password ä¸­ auth optional pam_gnome_keyring.so session optional pam_gnome_keyring.so auto_start 3.1.3 åº”ç”¨ç¨‹åºä¸ PAM çš„äº¤äº’ç¨‹åºé€šè¿‡ pam_start() æŒ‡å®šæœåŠ¡åï¼Œç³»ç»Ÿæ®æ­¤åŠ è½½å¯¹åº”çš„é…ç½®æ–‡ä»¶ã€‚ ç¨‹åº æœåŠ¡å é…ç½®æ–‡ä»¶ åŠŸèƒ½ login \"login\" /etc/pam.d/login æ§åˆ¶å°ç™»å½• gdm \"gdm\" /etc/pam.d/gdm GNOME ç™»å½•ç•Œé¢ sudo \"sudo\" /etc/pam.d/sudo ææƒå‘½ä»¤ sshd \"sshd\" /etc/pam.d/sshd SSH ç™»å½• greetd \"greetd\" /etc/pam.d/greetd è½»é‡æ˜¾ç¤ºç®¡ç†å™¨ ä¸€ä¸ªå…¸å‹çš„è°ƒç”¨é¡ºåºå¦‚ä¸‹ï¼ˆä»¥ sudo ä¸ºä¾‹ï¼‰ï¼š c pam_start(\"sudo\", user, \u0026conv, \u0026pamh); // åˆå§‹åŒ– PAM pam_authenticate(pamh, 0); // èº«ä»½éªŒè¯ pam_acct_mgmt(pamh, 0); // è´¦æˆ·æ£€æŸ¥ pam_open_session(pamh, 0); // æ‰“å¼€ä¼šè¯ // æ‰§è¡Œç”¨æˆ·å‘½ä»¤ pam_close_session(pamh, 0); // å…³é—­ä¼šè¯ pam_end(pamh, PAM_SUCCESS); // é‡Šæ”¾èµ„æº å¦‚ä¸‹æ˜¯ä¸€ä¸ªç”¨æˆ·ç™»å½•æµç¨‹çš„ PAM è°ƒç”¨ç¤ºä¾‹ï¼š c #include #include #include #include static void log_result(pam_handle_t *pamh, int ret, const char *step) { if (ret == PAM_SUCCESS) { printf(\"[âœ“] %s æˆåŠŸ\\n\", step); } else { fprintf(stderr, \"[âœ—] %s å¤±è´¥: %sï¼ˆè¿”å›ç  %dï¼‰\\n\", step, pam_strerror(pamh, ret), ret); } } int main(int argc, char *argv[]) { pam_handle_t *p","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:4:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#314-æ¨¡å—é—´çš„æ•°æ®ä¼ é€’"},{"categories":["tech"],"content":" 3.1 PAM - å¯æ’æ‹”è®¤è¯æ¨¡å—PAMï¼ˆPluggable Authentication Modulesï¼‰ æ˜¯ Linux çš„ç»Ÿä¸€è®¤è¯æ¡†æ¶ï¼Œä¸ºç³»ç»Ÿä¸­çš„å„ç§ç¨‹åº ï¼ˆå¦‚ loginã€sudoã€sshdã€gdm ç­‰ï¼‰æä¾›æ ‡å‡†åŒ–çš„è®¤è¯æ¥å£ã€‚å€ŸåŠ© PAMï¼Œç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶çµæ´»æ§åˆ¶è®¤è¯ç­–ç•¥ï¼Œè€Œæ— éœ€ä¿®æ”¹åº”ç”¨ç¨‹åºæœ¬èº«ã€‚å®ƒæ”¯æŒå¤šç§è®¤è¯æ–¹å¼ï¼ˆå¯†ç ã€æŒ‡çº¹ã€æ™ºèƒ½å¡ã€åŒå› å­éªŒè¯ç­‰ï¼‰ï¼Œæ˜¯ç°ä»£ Linux å®‰å…¨ä½“ç³»çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ã€‚ 3.1.1 å·¥ä½œåŸç†ä¸é…ç½®ç»“æ„PAM é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œå°†è®¤è¯æµç¨‹åˆ†ä¸ºå››ä¸ªé˜¶æ®µã€‚åº”ç”¨ç¨‹åºé€šè¿‡è°ƒç”¨ç›¸åº”çš„ PAM æ¥å£è§¦å‘è¿™äº›é˜¶æ®µï¼Œ ç³»ç»Ÿæ ¹æ® /etc/pam.d/ ä¸‹çš„é…ç½®æ–‡ä»¶æ‰§è¡Œç›¸åº”çš„æ¨¡å—ï¼ˆ.so æ–‡ä»¶ï¼‰ã€‚ ï¼ˆ1ï¼‰é…ç½®æ–‡ä»¶è¯­æ³• https://linux.die.net/man/5/pam.d æ¯è¡Œçš„åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š text [arguments] typeï¼šè¡¨ç¤ºé˜¶æ®µç±»å‹ controlï¼šå®šä¹‰è¯¥æ¨¡å—çš„æ‰§è¡Œç­–ç•¥ moduleï¼šå…·ä½“çš„ PAM æ¨¡å—è·¯å¾„ï¼ˆæˆ–åç§°ï¼‰ argumentsï¼šä¼ é€’ç»™æ¨¡å—çš„å‚æ•° ï¼ˆ2ï¼‰å››ä¸ªè®¤è¯é˜¶æ®µ é˜¶æ®µç±»å‹ è°ƒç”¨å‡½æ•° ä¸»è¦ä½œç”¨ auth pam_authenticate() éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œé€šå¸¸ä¼šæç¤ºç”¨æˆ·è¾“å‡ºå¯†ç æˆ–æŒ‡çº¹ä»¥å®ŒæˆéªŒè¯ account pam_acct_mgmt() æ£€æŸ¥è´¦æˆ·çŠ¶æ€ï¼ˆè¿‡æœŸã€é”å®šç­‰ï¼‰ password pam_chauthtok() å¤„ç†å¯†ç ä¿®æ”¹ session pam_open_session() / pam_close_session() å»ºç«‹å’Œæ¸…ç†ç”¨æˆ·ä¼šè¯ ï¼ˆ3ï¼‰æ§åˆ¶æ ‡å¿—ï¼ˆcontrolï¼‰ æ ‡å¿— å«ä¹‰ è¡Œä¸ºè¯´æ˜ required å¿…é¡»æˆåŠŸï¼Œå¤±è´¥ä¸ä¼šç«‹å³ç»ˆæ­¢ï¼Œä½†æœ€ç»ˆç»“æœä¼šå¤±è´¥ æ— è®ºæˆåŠŸå¤±è´¥ï¼Œéƒ½ä¼šç»§ç»­æ‰§è¡Œåç»­æ¨¡å—ã€‚æœ€ç»ˆåªè¦æœ‰ä¸€ä¸ª required å¤±è´¥ï¼Œæ•´ä¸ªè®¤è¯å°±å¤±è´¥ã€‚ requisite å¿…é¡»æˆåŠŸï¼Œå¤±è´¥ç«‹å³ç»ˆæ­¢å¹¶è¿”å›å¤±è´¥ å¤±è´¥ç«‹å³è¿”å›ï¼Œä¸å†æ‰§è¡Œåç»­æ¨¡å—ã€‚ sufficient æˆåŠŸåˆ™ç«‹å³é€šè¿‡è®¤è¯ï¼ˆè·³è¿‡æ‰€æœ‰åç»­æ¨¡å—ï¼‰ï¼›å¤±è´¥åˆ™ç»§ç»­ç”±åç»­æ¨¡å—è¿›è¡Œè®¤è¯ è‹¥å‰é¢æ²¡æœ‰ required å¤±è´¥ï¼Œåˆ™æˆåŠŸç›´æ¥é€šè¿‡ï¼›å¦åˆ™å¤±è´¥ä¸å½±å“åç»­ã€‚ optional å¯é€‰æ¨¡å—ï¼Œç»“æœé€šå¸¸è¢«å¿½ç•¥ æ— è®ºæˆåŠŸå¤±è´¥ï¼Œå¯¹æœ€ç»ˆç»“æœæ— ç›´æ¥å½±å“ï¼Œé™¤éæ˜¯æ ˆä¸­å”¯ä¸€çš„æ¨¡å—ã€‚ include åŒ…å«å¦ä¸€ä¸ªæ–‡ä»¶çš„é…ç½® å°†æŒ‡å®šæ–‡ä»¶çš„é…ç½®å†…å®¹åŒ…å«è¿›æ¥ï¼Œé€šå¸¸ç”¨äºå¤ç”¨é€šç”¨é…ç½®ï¼ˆå¦‚ system-authï¼‰ã€‚ substack è°ƒç”¨å­æ ˆ ç±»ä¼¼ includeï¼Œä½†å­æ ˆçš„å¤±è´¥ä¸å½±å“ä¸»æ ˆï¼ˆå³å­æ ˆåªèƒ½è·³è¿‡å…¶è‡ªèº«çš„åç»­æ­¥éª¤ï¼‰ï¼Œé™¤éä¸»æ ˆä¸­å¦æœ‰è®¾ç½®ã€‚ ï¼ˆ4ï¼‰å¸¸ç”¨æ¨¡å—ç¤ºä¾‹ bash pam_unix.so # åŸºäº /etc/passwd ä¸ /etc/shadow çš„æ ‡å‡†å¯†ç è®¤è¯ pam_google_authenticator.so # åŒå› å­è®¤è¯ï¼ˆTOTPï¼‰ pam_fprintd.so # æŒ‡çº¹è®¤è¯ pam_ldap.so # LDAP é›†ä¸­å¼è®¤è¯ pam_gnome_keyring.so # GNOME å¯†é’¥ç¯é›†æˆ pam_limits.so # ç”¨æˆ·èµ„æºé™åˆ¶ pam_deny.so # æ‹’ç»æ‰€æœ‰è®¤è¯è¯·æ±‚ 3.1.2 æ‰§è¡Œæµç¨‹ç¤ºä¾‹ä»¥ /etc/pam.d/sudo ä¸ºä¾‹ï¼š bash #%PAM-1.0 auth sufficient pam_rootok.so auth sufficient pam_timestamp.so auth required pam_wheel.so use_uid auth required pam_unix.so nullok try_first_pass å„æ¨¡å—çš„æ‰§è¡Œé¡ºåºå¦‚ä¸‹ï¼š æ‰§è¡Œ pam_rootok.so (sufficient)ï¼š æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦ä¸º rootã€‚ å¦‚æœæˆåŠŸï¼šPAM è®¤è¯æµç¨‹ç«‹å³æˆåŠŸï¼Œå¹¶è·³è¿‡åç»­æ‰€æœ‰ auth æ¨¡å—ã€‚ç”¨æˆ·ç›´æ¥è·å¾— sudo æƒé™ã€‚ å¦‚æœå¤±è´¥ï¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªæ¨¡å—ã€‚ æ‰§è¡Œ pam_timestamp.so (sufficient)ï¼š æ£€æŸ¥æ˜¯å¦å­˜åœ¨æœ‰æ•ˆçš„æ—¶é—´æˆ³æ–‡ä»¶ï¼ˆé»˜è®¤ä¸º 5 åˆ†é’Ÿå†…ï¼‰ã€‚ å¦‚æœæˆåŠŸï¼šPAM è®¤è¯æµç¨‹ç«‹å³æˆåŠŸï¼Œå¹¶è·³è¿‡åç»­æ‰€æœ‰ auth æ¨¡å—ã€‚ç”¨æˆ·å…å¯†ç è·å¾— sudo æƒé™ã€‚ å¦‚æœå¤±è´¥ï¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªæ¨¡å—ã€‚ æ‰§è¡Œ pam_wheel.so (required)ï¼š æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦åœ¨ wheel ç»„ï¼ˆæˆ– sudo ç»„ï¼Œå–å†³äºé…ç½®ï¼‰ä¸­ã€‚ æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½å¿…é¡»ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ª required æ¨¡å—ã€‚ä½†å…¶ç»“æœä¼šè¢«è®°å½•ä¸‹æ¥ã€‚ æ‰§è¡Œ pam_unix.so (required)ï¼š ä½¿ç”¨ nullok å’Œ try_first_pass å‚æ•°è¿›è¡Œå¯†ç éªŒè¯ã€‚ nullokï¼šå…è®¸ç©ºå¯†ç è´¦æˆ·ç™»å½•ã€‚ try_first_passï¼šå°è¯•ä½¿ç”¨å‰é¢æ¨¡å—ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰æä¾›çš„å¯†ç ã€‚å¯¹äº sudoï¼Œè¿™é€šå¸¸æŒ‡ä¹‹å‰ sudo æˆåŠŸæ—¶ç¼“å­˜çš„å¯†ç ã€‚ å¦‚æœå¯†ç æ­£ç¡®ï¼šæ­¤æ¨¡å—æˆåŠŸã€‚ å¦‚æœå¯†ç é”™è¯¯ï¼šæ­¤æ¨¡å—å¤±è´¥ã€‚ æœ€ç»ˆç»“æœåˆ¤å®šï¼š åœ¨æ‰€æœ‰ required æ¨¡å—æ‰§è¡Œå®Œæ¯•åï¼ŒPAM ä¼šæ£€æŸ¥å®ƒä»¬çš„ç»“æœã€‚ å¦‚æœä»»ä½•ä¸€ä¸ª required æ¨¡å—ï¼ˆpam_wheel.so æˆ– pam_unix.soï¼‰å¤±è´¥ï¼Œæ•´ä¸ªè®¤è¯æµç¨‹å¤±è´¥ã€‚ åªæœ‰å½“æ‰€æœ‰ required æ¨¡å—éƒ½æˆåŠŸæ—¶ï¼Œè®¤è¯æ‰æœ€ç»ˆæˆåŠŸã€‚ å¸¸ç”¨æ¨¡å—åŠå…¶å‚æ•°è¯´æ˜ï¼š pam_unix.so å‚æ•° (ç”¨äºå¯†ç éªŒè¯) è¿™æ˜¯æœ€æ ¸å¿ƒçš„å¯†ç è®¤è¯æ¨¡å—ï¼Œå¸¸è§äº auth å’Œ password ç±»å‹ã€‚ nullokï¼šå…è®¸ç©ºå¯†ç è´¦æˆ·é€šè¿‡è®¤è¯ã€‚å¦‚æœä¸åŠ æ­¤å‚æ•°ï¼Œç©ºå¯†ç è´¦æˆ·å°†æ— æ³•ç™»å½•ã€‚ try_first_passï¼šåœ¨æç¤ºç”¨æˆ·è¾“å…¥å¯†ç å‰ï¼Œå…ˆå°è¯•ä½¿ç”¨ä¹‹å‰æ ˆä¸­å·²ç¼“å­˜çš„å¯†ç ï¼ˆä¾‹å¦‚ï¼Œç”±pam_timestamp.so æˆ– pam_kwallet.so æä¾›çš„ï¼‰ã€‚ use_authtokï¼šå¼ºåˆ¶ä½¿ç”¨ä¹‹å‰æ ˆä¸­å·²ç¼“å­˜çš„å¯†ç ï¼Œå¦‚æœä¸å­˜åœ¨ç¼“å­˜å¯†ç ï¼Œåˆ™ç›´æ¥å¤±è´¥ã€‚å®ƒæ¯”try_first_pass æ›´ä¸¥æ ¼ï¼Œé€šå¸¸ç”¨åœ¨ä¿®æ”¹å¯†ç çš„ password æ¨¡å—æ ˆä¸­ï¼Œä»¥ç¡®ä¿ç”¨æˆ·è¾“å…¥çš„æ˜¯æ—§å¯†ç ã€‚ shadowï¼šä½¿ç”¨ /etc/shadow æ–‡ä»¶è¿›è¡Œå¯†ç éªŒè¯ï¼ˆç°ä»£ç³»ç»Ÿé»˜è®¤å¯ç”¨ï¼‰ã€‚ pam_timestamp.so å‚æ•° (ç”¨äºæ—¶é—´æˆ³è®¤è¯) å¸¸ç”¨äº sudoï¼Œå®ç°å…å¯†ç æ“ä½œã€‚ timestamp_timeout=600ï¼šè®¾ç½®æ—¶é—´æˆ³çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’ã€‚é»˜è®¤æ˜¯ 300 (5åˆ†é’Ÿ)ã€‚ pam_wheel.so å‚æ•° (ç”¨äºç»„æˆå‘˜èµ„æ ¼æ£€æŸ¥) ç”¨äºé™åˆ¶åªæœ‰ç‰¹å®šç»„çš„ç”¨æˆ·æ‰èƒ½ä½¿ç”¨ su æˆ– sudoã€‚ use_uidï¼šæ£€æŸ¥å‘èµ·è¯·æ±‚çš„åŸå§‹ç”¨æˆ· IDï¼Œè€Œä¸æ˜¯å½“å‰ç”¨æˆ· IDï¼ˆåœ¨ sudo åœºæ™¯ä¸‹å¾ˆé‡è¦ï¼‰ã€‚ group=adminsï¼šæŒ‡å®šæ£€æŸ¥çš„ç»„åï¼Œé»˜è®¤æ˜¯ wheelã€‚ pam_gnome_keyring.so å‚æ•° (ç”¨äºä¼šè¯ç®¡ç†) è¿™ä¸ªæ¨¡å—ä¸ sudo çš„è®¤è¯æµç¨‹æ— å…³ï¼Œä¸»è¦ç”¨äºç”¨æˆ·ç™»å½•æ—¶è§£é”å¯†é’¥ç¯ã€‚ auto_startï¼šåœ¨ä¼šè¯å¯åŠ¨æ—¶ï¼Œå¦‚æœç”¨æˆ·å¯†ç ä¸å¯†é’¥ç¯å¯†ç ç›¸åŒï¼Œåˆ™è‡ªåŠ¨è§£é”å¯†é’¥ç¯ã€‚ å…¸å‹åº”ç”¨åœºæ™¯ï¼šåœ¨ /etc/pam.d/gdm-password æˆ– /etc/pam.d/login çš„ auth å’Œsession éƒ¨åˆ†ã€‚ bash # åœ¨ /etc/pam.d/gdm-password ä¸­ auth optional pam_gnome_keyring.so session optional pam_gnome_keyring.so auto_start 3.1.3 åº”ç”¨ç¨‹åºä¸ PAM çš„äº¤äº’ç¨‹åºé€šè¿‡ pam_start() æŒ‡å®šæœåŠ¡åï¼Œç³»ç»Ÿæ®æ­¤åŠ è½½å¯¹åº”çš„é…ç½®æ–‡ä»¶ã€‚ ç¨‹åº æœåŠ¡å é…ç½®æ–‡ä»¶ åŠŸèƒ½ login \"login\" /etc/pam.d/login æ§åˆ¶å°ç™»å½• gdm \"gdm\" /etc/pam.d/gdm GNOME ç™»å½•ç•Œé¢ sudo \"sudo\" /etc/pam.d/sudo ææƒå‘½ä»¤ sshd \"sshd\" /etc/pam.d/sshd SSH ç™»å½• greetd \"greetd\" /etc/pam.d/greetd è½»é‡æ˜¾ç¤ºç®¡ç†å™¨ ä¸€ä¸ªå…¸å‹çš„è°ƒç”¨é¡ºåºå¦‚ä¸‹ï¼ˆä»¥ sudo ä¸ºä¾‹ï¼‰ï¼š c pam_start(\"sudo\", user, \u0026conv, \u0026pamh); // åˆå§‹åŒ– PAM pam_authenticate(pamh, 0); // èº«ä»½éªŒè¯ pam_acct_mgmt(pamh, 0); // è´¦æˆ·æ£€æŸ¥ pam_open_session(pamh, 0); // æ‰“å¼€ä¼šè¯ // æ‰§è¡Œç”¨æˆ·å‘½ä»¤ pam_close_session(pamh, 0); // å…³é—­ä¼šè¯ pam_end(pamh, PAM_SUCCESS); // é‡Šæ”¾èµ„æº å¦‚ä¸‹æ˜¯ä¸€ä¸ªç”¨æˆ·ç™»å½•æµç¨‹çš„ PAM è°ƒç”¨ç¤ºä¾‹ï¼š c #include #include #include #include static void log_result(pam_handle_t *pamh, int ret, const char *step) { if (ret == PAM_SUCCESS) { printf(\"[âœ“] %s æˆåŠŸ\\n\", step); } else { fprintf(stderr, \"[âœ—] %s å¤±è´¥: %sï¼ˆè¿”å›ç  %dï¼‰\\n\", step, pam_strerror(pamh, ret), ret); } } int main(int argc, char *argv[]) { pam_handle_t *p","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:4:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#315-è°ƒè¯•ä¸æ•…éšœæ’æŸ¥"},{"categories":["tech"],"content":" 3.1 PAM - å¯æ’æ‹”è®¤è¯æ¨¡å—PAMï¼ˆPluggable Authentication Modulesï¼‰ æ˜¯ Linux çš„ç»Ÿä¸€è®¤è¯æ¡†æ¶ï¼Œä¸ºç³»ç»Ÿä¸­çš„å„ç§ç¨‹åº ï¼ˆå¦‚ loginã€sudoã€sshdã€gdm ç­‰ï¼‰æä¾›æ ‡å‡†åŒ–çš„è®¤è¯æ¥å£ã€‚å€ŸåŠ© PAMï¼Œç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶çµæ´»æ§åˆ¶è®¤è¯ç­–ç•¥ï¼Œè€Œæ— éœ€ä¿®æ”¹åº”ç”¨ç¨‹åºæœ¬èº«ã€‚å®ƒæ”¯æŒå¤šç§è®¤è¯æ–¹å¼ï¼ˆå¯†ç ã€æŒ‡çº¹ã€æ™ºèƒ½å¡ã€åŒå› å­éªŒè¯ç­‰ï¼‰ï¼Œæ˜¯ç°ä»£ Linux å®‰å…¨ä½“ç³»çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ã€‚ 3.1.1 å·¥ä½œåŸç†ä¸é…ç½®ç»“æ„PAM é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œå°†è®¤è¯æµç¨‹åˆ†ä¸ºå››ä¸ªé˜¶æ®µã€‚åº”ç”¨ç¨‹åºé€šè¿‡è°ƒç”¨ç›¸åº”çš„ PAM æ¥å£è§¦å‘è¿™äº›é˜¶æ®µï¼Œ ç³»ç»Ÿæ ¹æ® /etc/pam.d/ ä¸‹çš„é…ç½®æ–‡ä»¶æ‰§è¡Œç›¸åº”çš„æ¨¡å—ï¼ˆ.so æ–‡ä»¶ï¼‰ã€‚ ï¼ˆ1ï¼‰é…ç½®æ–‡ä»¶è¯­æ³• https://linux.die.net/man/5/pam.d æ¯è¡Œçš„åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š text [arguments] typeï¼šè¡¨ç¤ºé˜¶æ®µç±»å‹ controlï¼šå®šä¹‰è¯¥æ¨¡å—çš„æ‰§è¡Œç­–ç•¥ moduleï¼šå…·ä½“çš„ PAM æ¨¡å—è·¯å¾„ï¼ˆæˆ–åç§°ï¼‰ argumentsï¼šä¼ é€’ç»™æ¨¡å—çš„å‚æ•° ï¼ˆ2ï¼‰å››ä¸ªè®¤è¯é˜¶æ®µ é˜¶æ®µç±»å‹ è°ƒç”¨å‡½æ•° ä¸»è¦ä½œç”¨ auth pam_authenticate() éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œé€šå¸¸ä¼šæç¤ºç”¨æˆ·è¾“å‡ºå¯†ç æˆ–æŒ‡çº¹ä»¥å®ŒæˆéªŒè¯ account pam_acct_mgmt() æ£€æŸ¥è´¦æˆ·çŠ¶æ€ï¼ˆè¿‡æœŸã€é”å®šç­‰ï¼‰ password pam_chauthtok() å¤„ç†å¯†ç ä¿®æ”¹ session pam_open_session() / pam_close_session() å»ºç«‹å’Œæ¸…ç†ç”¨æˆ·ä¼šè¯ ï¼ˆ3ï¼‰æ§åˆ¶æ ‡å¿—ï¼ˆcontrolï¼‰ æ ‡å¿— å«ä¹‰ è¡Œä¸ºè¯´æ˜ required å¿…é¡»æˆåŠŸï¼Œå¤±è´¥ä¸ä¼šç«‹å³ç»ˆæ­¢ï¼Œä½†æœ€ç»ˆç»“æœä¼šå¤±è´¥ æ— è®ºæˆåŠŸå¤±è´¥ï¼Œéƒ½ä¼šç»§ç»­æ‰§è¡Œåç»­æ¨¡å—ã€‚æœ€ç»ˆåªè¦æœ‰ä¸€ä¸ª required å¤±è´¥ï¼Œæ•´ä¸ªè®¤è¯å°±å¤±è´¥ã€‚ requisite å¿…é¡»æˆåŠŸï¼Œå¤±è´¥ç«‹å³ç»ˆæ­¢å¹¶è¿”å›å¤±è´¥ å¤±è´¥ç«‹å³è¿”å›ï¼Œä¸å†æ‰§è¡Œåç»­æ¨¡å—ã€‚ sufficient æˆåŠŸåˆ™ç«‹å³é€šè¿‡è®¤è¯ï¼ˆè·³è¿‡æ‰€æœ‰åç»­æ¨¡å—ï¼‰ï¼›å¤±è´¥åˆ™ç»§ç»­ç”±åç»­æ¨¡å—è¿›è¡Œè®¤è¯ è‹¥å‰é¢æ²¡æœ‰ required å¤±è´¥ï¼Œåˆ™æˆåŠŸç›´æ¥é€šè¿‡ï¼›å¦åˆ™å¤±è´¥ä¸å½±å“åç»­ã€‚ optional å¯é€‰æ¨¡å—ï¼Œç»“æœé€šå¸¸è¢«å¿½ç•¥ æ— è®ºæˆåŠŸå¤±è´¥ï¼Œå¯¹æœ€ç»ˆç»“æœæ— ç›´æ¥å½±å“ï¼Œé™¤éæ˜¯æ ˆä¸­å”¯ä¸€çš„æ¨¡å—ã€‚ include åŒ…å«å¦ä¸€ä¸ªæ–‡ä»¶çš„é…ç½® å°†æŒ‡å®šæ–‡ä»¶çš„é…ç½®å†…å®¹åŒ…å«è¿›æ¥ï¼Œé€šå¸¸ç”¨äºå¤ç”¨é€šç”¨é…ç½®ï¼ˆå¦‚ system-authï¼‰ã€‚ substack è°ƒç”¨å­æ ˆ ç±»ä¼¼ includeï¼Œä½†å­æ ˆçš„å¤±è´¥ä¸å½±å“ä¸»æ ˆï¼ˆå³å­æ ˆåªèƒ½è·³è¿‡å…¶è‡ªèº«çš„åç»­æ­¥éª¤ï¼‰ï¼Œé™¤éä¸»æ ˆä¸­å¦æœ‰è®¾ç½®ã€‚ ï¼ˆ4ï¼‰å¸¸ç”¨æ¨¡å—ç¤ºä¾‹ bash pam_unix.so # åŸºäº /etc/passwd ä¸ /etc/shadow çš„æ ‡å‡†å¯†ç è®¤è¯ pam_google_authenticator.so # åŒå› å­è®¤è¯ï¼ˆTOTPï¼‰ pam_fprintd.so # æŒ‡çº¹è®¤è¯ pam_ldap.so # LDAP é›†ä¸­å¼è®¤è¯ pam_gnome_keyring.so # GNOME å¯†é’¥ç¯é›†æˆ pam_limits.so # ç”¨æˆ·èµ„æºé™åˆ¶ pam_deny.so # æ‹’ç»æ‰€æœ‰è®¤è¯è¯·æ±‚ 3.1.2 æ‰§è¡Œæµç¨‹ç¤ºä¾‹ä»¥ /etc/pam.d/sudo ä¸ºä¾‹ï¼š bash #%PAM-1.0 auth sufficient pam_rootok.so auth sufficient pam_timestamp.so auth required pam_wheel.so use_uid auth required pam_unix.so nullok try_first_pass å„æ¨¡å—çš„æ‰§è¡Œé¡ºåºå¦‚ä¸‹ï¼š æ‰§è¡Œ pam_rootok.so (sufficient)ï¼š æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦ä¸º rootã€‚ å¦‚æœæˆåŠŸï¼šPAM è®¤è¯æµç¨‹ç«‹å³æˆåŠŸï¼Œå¹¶è·³è¿‡åç»­æ‰€æœ‰ auth æ¨¡å—ã€‚ç”¨æˆ·ç›´æ¥è·å¾— sudo æƒé™ã€‚ å¦‚æœå¤±è´¥ï¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªæ¨¡å—ã€‚ æ‰§è¡Œ pam_timestamp.so (sufficient)ï¼š æ£€æŸ¥æ˜¯å¦å­˜åœ¨æœ‰æ•ˆçš„æ—¶é—´æˆ³æ–‡ä»¶ï¼ˆé»˜è®¤ä¸º 5 åˆ†é’Ÿå†…ï¼‰ã€‚ å¦‚æœæˆåŠŸï¼šPAM è®¤è¯æµç¨‹ç«‹å³æˆåŠŸï¼Œå¹¶è·³è¿‡åç»­æ‰€æœ‰ auth æ¨¡å—ã€‚ç”¨æˆ·å…å¯†ç è·å¾— sudo æƒé™ã€‚ å¦‚æœå¤±è´¥ï¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªæ¨¡å—ã€‚ æ‰§è¡Œ pam_wheel.so (required)ï¼š æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦åœ¨ wheel ç»„ï¼ˆæˆ– sudo ç»„ï¼Œå–å†³äºé…ç½®ï¼‰ä¸­ã€‚ æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½å¿…é¡»ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ª required æ¨¡å—ã€‚ä½†å…¶ç»“æœä¼šè¢«è®°å½•ä¸‹æ¥ã€‚ æ‰§è¡Œ pam_unix.so (required)ï¼š ä½¿ç”¨ nullok å’Œ try_first_pass å‚æ•°è¿›è¡Œå¯†ç éªŒè¯ã€‚ nullokï¼šå…è®¸ç©ºå¯†ç è´¦æˆ·ç™»å½•ã€‚ try_first_passï¼šå°è¯•ä½¿ç”¨å‰é¢æ¨¡å—ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰æä¾›çš„å¯†ç ã€‚å¯¹äº sudoï¼Œè¿™é€šå¸¸æŒ‡ä¹‹å‰ sudo æˆåŠŸæ—¶ç¼“å­˜çš„å¯†ç ã€‚ å¦‚æœå¯†ç æ­£ç¡®ï¼šæ­¤æ¨¡å—æˆåŠŸã€‚ å¦‚æœå¯†ç é”™è¯¯ï¼šæ­¤æ¨¡å—å¤±è´¥ã€‚ æœ€ç»ˆç»“æœåˆ¤å®šï¼š åœ¨æ‰€æœ‰ required æ¨¡å—æ‰§è¡Œå®Œæ¯•åï¼ŒPAM ä¼šæ£€æŸ¥å®ƒä»¬çš„ç»“æœã€‚ å¦‚æœä»»ä½•ä¸€ä¸ª required æ¨¡å—ï¼ˆpam_wheel.so æˆ– pam_unix.soï¼‰å¤±è´¥ï¼Œæ•´ä¸ªè®¤è¯æµç¨‹å¤±è´¥ã€‚ åªæœ‰å½“æ‰€æœ‰ required æ¨¡å—éƒ½æˆåŠŸæ—¶ï¼Œè®¤è¯æ‰æœ€ç»ˆæˆåŠŸã€‚ å¸¸ç”¨æ¨¡å—åŠå…¶å‚æ•°è¯´æ˜ï¼š pam_unix.so å‚æ•° (ç”¨äºå¯†ç éªŒè¯) è¿™æ˜¯æœ€æ ¸å¿ƒçš„å¯†ç è®¤è¯æ¨¡å—ï¼Œå¸¸è§äº auth å’Œ password ç±»å‹ã€‚ nullokï¼šå…è®¸ç©ºå¯†ç è´¦æˆ·é€šè¿‡è®¤è¯ã€‚å¦‚æœä¸åŠ æ­¤å‚æ•°ï¼Œç©ºå¯†ç è´¦æˆ·å°†æ— æ³•ç™»å½•ã€‚ try_first_passï¼šåœ¨æç¤ºç”¨æˆ·è¾“å…¥å¯†ç å‰ï¼Œå…ˆå°è¯•ä½¿ç”¨ä¹‹å‰æ ˆä¸­å·²ç¼“å­˜çš„å¯†ç ï¼ˆä¾‹å¦‚ï¼Œç”±pam_timestamp.so æˆ– pam_kwallet.so æä¾›çš„ï¼‰ã€‚ use_authtokï¼šå¼ºåˆ¶ä½¿ç”¨ä¹‹å‰æ ˆä¸­å·²ç¼“å­˜çš„å¯†ç ï¼Œå¦‚æœä¸å­˜åœ¨ç¼“å­˜å¯†ç ï¼Œåˆ™ç›´æ¥å¤±è´¥ã€‚å®ƒæ¯”try_first_pass æ›´ä¸¥æ ¼ï¼Œé€šå¸¸ç”¨åœ¨ä¿®æ”¹å¯†ç çš„ password æ¨¡å—æ ˆä¸­ï¼Œä»¥ç¡®ä¿ç”¨æˆ·è¾“å…¥çš„æ˜¯æ—§å¯†ç ã€‚ shadowï¼šä½¿ç”¨ /etc/shadow æ–‡ä»¶è¿›è¡Œå¯†ç éªŒè¯ï¼ˆç°ä»£ç³»ç»Ÿé»˜è®¤å¯ç”¨ï¼‰ã€‚ pam_timestamp.so å‚æ•° (ç”¨äºæ—¶é—´æˆ³è®¤è¯) å¸¸ç”¨äº sudoï¼Œå®ç°å…å¯†ç æ“ä½œã€‚ timestamp_timeout=600ï¼šè®¾ç½®æ—¶é—´æˆ³çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’ã€‚é»˜è®¤æ˜¯ 300 (5åˆ†é’Ÿ)ã€‚ pam_wheel.so å‚æ•° (ç”¨äºç»„æˆå‘˜èµ„æ ¼æ£€æŸ¥) ç”¨äºé™åˆ¶åªæœ‰ç‰¹å®šç»„çš„ç”¨æˆ·æ‰èƒ½ä½¿ç”¨ su æˆ– sudoã€‚ use_uidï¼šæ£€æŸ¥å‘èµ·è¯·æ±‚çš„åŸå§‹ç”¨æˆ· IDï¼Œè€Œä¸æ˜¯å½“å‰ç”¨æˆ· IDï¼ˆåœ¨ sudo åœºæ™¯ä¸‹å¾ˆé‡è¦ï¼‰ã€‚ group=adminsï¼šæŒ‡å®šæ£€æŸ¥çš„ç»„åï¼Œé»˜è®¤æ˜¯ wheelã€‚ pam_gnome_keyring.so å‚æ•° (ç”¨äºä¼šè¯ç®¡ç†) è¿™ä¸ªæ¨¡å—ä¸ sudo çš„è®¤è¯æµç¨‹æ— å…³ï¼Œä¸»è¦ç”¨äºç”¨æˆ·ç™»å½•æ—¶è§£é”å¯†é’¥ç¯ã€‚ auto_startï¼šåœ¨ä¼šè¯å¯åŠ¨æ—¶ï¼Œå¦‚æœç”¨æˆ·å¯†ç ä¸å¯†é’¥ç¯å¯†ç ç›¸åŒï¼Œåˆ™è‡ªåŠ¨è§£é”å¯†é’¥ç¯ã€‚ å…¸å‹åº”ç”¨åœºæ™¯ï¼šåœ¨ /etc/pam.d/gdm-password æˆ– /etc/pam.d/login çš„ auth å’Œsession éƒ¨åˆ†ã€‚ bash # åœ¨ /etc/pam.d/gdm-password ä¸­ auth optional pam_gnome_keyring.so session optional pam_gnome_keyring.so auto_start 3.1.3 åº”ç”¨ç¨‹åºä¸ PAM çš„äº¤äº’ç¨‹åºé€šè¿‡ pam_start() æŒ‡å®šæœåŠ¡åï¼Œç³»ç»Ÿæ®æ­¤åŠ è½½å¯¹åº”çš„é…ç½®æ–‡ä»¶ã€‚ ç¨‹åº æœåŠ¡å é…ç½®æ–‡ä»¶ åŠŸèƒ½ login \"login\" /etc/pam.d/login æ§åˆ¶å°ç™»å½• gdm \"gdm\" /etc/pam.d/gdm GNOME ç™»å½•ç•Œé¢ sudo \"sudo\" /etc/pam.d/sudo ææƒå‘½ä»¤ sshd \"sshd\" /etc/pam.d/sshd SSH ç™»å½• greetd \"greetd\" /etc/pam.d/greetd è½»é‡æ˜¾ç¤ºç®¡ç†å™¨ ä¸€ä¸ªå…¸å‹çš„è°ƒç”¨é¡ºåºå¦‚ä¸‹ï¼ˆä»¥ sudo ä¸ºä¾‹ï¼‰ï¼š c pam_start(\"sudo\", user, \u0026conv, \u0026pamh); // åˆå§‹åŒ– PAM pam_authenticate(pamh, 0); // èº«ä»½éªŒè¯ pam_acct_mgmt(pamh, 0); // è´¦æˆ·æ£€æŸ¥ pam_open_session(pamh, 0); // æ‰“å¼€ä¼šè¯ // æ‰§è¡Œç”¨æˆ·å‘½ä»¤ pam_close_session(pamh, 0); // å…³é—­ä¼šè¯ pam_end(pamh, PAM_SUCCESS); // é‡Šæ”¾èµ„æº å¦‚ä¸‹æ˜¯ä¸€ä¸ªç”¨æˆ·ç™»å½•æµç¨‹çš„ PAM è°ƒç”¨ç¤ºä¾‹ï¼š c #include #include #include #include static void log_result(pam_handle_t *pamh, int ret, const char *step) { if (ret == PAM_SUCCESS) { printf(\"[âœ“] %s æˆåŠŸ\\n\", step); } else { fprintf(stderr, \"[âœ—] %s å¤±è´¥: %sï¼ˆè¿”å›ç  %dï¼‰\\n\", step, pam_strerror(pamh, ret), ret); } } int main(int argc, char *argv[]) { pam_handle_t *p","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:4:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#1æµ‹è¯•ä¸éªŒè¯"},{"categories":["tech"],"content":" 3.1 PAM - å¯æ’æ‹”è®¤è¯æ¨¡å—PAMï¼ˆPluggable Authentication Modulesï¼‰ æ˜¯ Linux çš„ç»Ÿä¸€è®¤è¯æ¡†æ¶ï¼Œä¸ºç³»ç»Ÿä¸­çš„å„ç§ç¨‹åº ï¼ˆå¦‚ loginã€sudoã€sshdã€gdm ç­‰ï¼‰æä¾›æ ‡å‡†åŒ–çš„è®¤è¯æ¥å£ã€‚å€ŸåŠ© PAMï¼Œç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶çµæ´»æ§åˆ¶è®¤è¯ç­–ç•¥ï¼Œè€Œæ— éœ€ä¿®æ”¹åº”ç”¨ç¨‹åºæœ¬èº«ã€‚å®ƒæ”¯æŒå¤šç§è®¤è¯æ–¹å¼ï¼ˆå¯†ç ã€æŒ‡çº¹ã€æ™ºèƒ½å¡ã€åŒå› å­éªŒè¯ç­‰ï¼‰ï¼Œæ˜¯ç°ä»£ Linux å®‰å…¨ä½“ç³»çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ã€‚ 3.1.1 å·¥ä½œåŸç†ä¸é…ç½®ç»“æ„PAM é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œå°†è®¤è¯æµç¨‹åˆ†ä¸ºå››ä¸ªé˜¶æ®µã€‚åº”ç”¨ç¨‹åºé€šè¿‡è°ƒç”¨ç›¸åº”çš„ PAM æ¥å£è§¦å‘è¿™äº›é˜¶æ®µï¼Œ ç³»ç»Ÿæ ¹æ® /etc/pam.d/ ä¸‹çš„é…ç½®æ–‡ä»¶æ‰§è¡Œç›¸åº”çš„æ¨¡å—ï¼ˆ.so æ–‡ä»¶ï¼‰ã€‚ ï¼ˆ1ï¼‰é…ç½®æ–‡ä»¶è¯­æ³• https://linux.die.net/man/5/pam.d æ¯è¡Œçš„åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š text [arguments] typeï¼šè¡¨ç¤ºé˜¶æ®µç±»å‹ controlï¼šå®šä¹‰è¯¥æ¨¡å—çš„æ‰§è¡Œç­–ç•¥ moduleï¼šå…·ä½“çš„ PAM æ¨¡å—è·¯å¾„ï¼ˆæˆ–åç§°ï¼‰ argumentsï¼šä¼ é€’ç»™æ¨¡å—çš„å‚æ•° ï¼ˆ2ï¼‰å››ä¸ªè®¤è¯é˜¶æ®µ é˜¶æ®µç±»å‹ è°ƒç”¨å‡½æ•° ä¸»è¦ä½œç”¨ auth pam_authenticate() éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œé€šå¸¸ä¼šæç¤ºç”¨æˆ·è¾“å‡ºå¯†ç æˆ–æŒ‡çº¹ä»¥å®ŒæˆéªŒè¯ account pam_acct_mgmt() æ£€æŸ¥è´¦æˆ·çŠ¶æ€ï¼ˆè¿‡æœŸã€é”å®šç­‰ï¼‰ password pam_chauthtok() å¤„ç†å¯†ç ä¿®æ”¹ session pam_open_session() / pam_close_session() å»ºç«‹å’Œæ¸…ç†ç”¨æˆ·ä¼šè¯ ï¼ˆ3ï¼‰æ§åˆ¶æ ‡å¿—ï¼ˆcontrolï¼‰ æ ‡å¿— å«ä¹‰ è¡Œä¸ºè¯´æ˜ required å¿…é¡»æˆåŠŸï¼Œå¤±è´¥ä¸ä¼šç«‹å³ç»ˆæ­¢ï¼Œä½†æœ€ç»ˆç»“æœä¼šå¤±è´¥ æ— è®ºæˆåŠŸå¤±è´¥ï¼Œéƒ½ä¼šç»§ç»­æ‰§è¡Œåç»­æ¨¡å—ã€‚æœ€ç»ˆåªè¦æœ‰ä¸€ä¸ª required å¤±è´¥ï¼Œæ•´ä¸ªè®¤è¯å°±å¤±è´¥ã€‚ requisite å¿…é¡»æˆåŠŸï¼Œå¤±è´¥ç«‹å³ç»ˆæ­¢å¹¶è¿”å›å¤±è´¥ å¤±è´¥ç«‹å³è¿”å›ï¼Œä¸å†æ‰§è¡Œåç»­æ¨¡å—ã€‚ sufficient æˆåŠŸåˆ™ç«‹å³é€šè¿‡è®¤è¯ï¼ˆè·³è¿‡æ‰€æœ‰åç»­æ¨¡å—ï¼‰ï¼›å¤±è´¥åˆ™ç»§ç»­ç”±åç»­æ¨¡å—è¿›è¡Œè®¤è¯ è‹¥å‰é¢æ²¡æœ‰ required å¤±è´¥ï¼Œåˆ™æˆåŠŸç›´æ¥é€šè¿‡ï¼›å¦åˆ™å¤±è´¥ä¸å½±å“åç»­ã€‚ optional å¯é€‰æ¨¡å—ï¼Œç»“æœé€šå¸¸è¢«å¿½ç•¥ æ— è®ºæˆåŠŸå¤±è´¥ï¼Œå¯¹æœ€ç»ˆç»“æœæ— ç›´æ¥å½±å“ï¼Œé™¤éæ˜¯æ ˆä¸­å”¯ä¸€çš„æ¨¡å—ã€‚ include åŒ…å«å¦ä¸€ä¸ªæ–‡ä»¶çš„é…ç½® å°†æŒ‡å®šæ–‡ä»¶çš„é…ç½®å†…å®¹åŒ…å«è¿›æ¥ï¼Œé€šå¸¸ç”¨äºå¤ç”¨é€šç”¨é…ç½®ï¼ˆå¦‚ system-authï¼‰ã€‚ substack è°ƒç”¨å­æ ˆ ç±»ä¼¼ includeï¼Œä½†å­æ ˆçš„å¤±è´¥ä¸å½±å“ä¸»æ ˆï¼ˆå³å­æ ˆåªèƒ½è·³è¿‡å…¶è‡ªèº«çš„åç»­æ­¥éª¤ï¼‰ï¼Œé™¤éä¸»æ ˆä¸­å¦æœ‰è®¾ç½®ã€‚ ï¼ˆ4ï¼‰å¸¸ç”¨æ¨¡å—ç¤ºä¾‹ bash pam_unix.so # åŸºäº /etc/passwd ä¸ /etc/shadow çš„æ ‡å‡†å¯†ç è®¤è¯ pam_google_authenticator.so # åŒå› å­è®¤è¯ï¼ˆTOTPï¼‰ pam_fprintd.so # æŒ‡çº¹è®¤è¯ pam_ldap.so # LDAP é›†ä¸­å¼è®¤è¯ pam_gnome_keyring.so # GNOME å¯†é’¥ç¯é›†æˆ pam_limits.so # ç”¨æˆ·èµ„æºé™åˆ¶ pam_deny.so # æ‹’ç»æ‰€æœ‰è®¤è¯è¯·æ±‚ 3.1.2 æ‰§è¡Œæµç¨‹ç¤ºä¾‹ä»¥ /etc/pam.d/sudo ä¸ºä¾‹ï¼š bash #%PAM-1.0 auth sufficient pam_rootok.so auth sufficient pam_timestamp.so auth required pam_wheel.so use_uid auth required pam_unix.so nullok try_first_pass å„æ¨¡å—çš„æ‰§è¡Œé¡ºåºå¦‚ä¸‹ï¼š æ‰§è¡Œ pam_rootok.so (sufficient)ï¼š æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦ä¸º rootã€‚ å¦‚æœæˆåŠŸï¼šPAM è®¤è¯æµç¨‹ç«‹å³æˆåŠŸï¼Œå¹¶è·³è¿‡åç»­æ‰€æœ‰ auth æ¨¡å—ã€‚ç”¨æˆ·ç›´æ¥è·å¾— sudo æƒé™ã€‚ å¦‚æœå¤±è´¥ï¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªæ¨¡å—ã€‚ æ‰§è¡Œ pam_timestamp.so (sufficient)ï¼š æ£€æŸ¥æ˜¯å¦å­˜åœ¨æœ‰æ•ˆçš„æ—¶é—´æˆ³æ–‡ä»¶ï¼ˆé»˜è®¤ä¸º 5 åˆ†é’Ÿå†…ï¼‰ã€‚ å¦‚æœæˆåŠŸï¼šPAM è®¤è¯æµç¨‹ç«‹å³æˆåŠŸï¼Œå¹¶è·³è¿‡åç»­æ‰€æœ‰ auth æ¨¡å—ã€‚ç”¨æˆ·å…å¯†ç è·å¾— sudo æƒé™ã€‚ å¦‚æœå¤±è´¥ï¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªæ¨¡å—ã€‚ æ‰§è¡Œ pam_wheel.so (required)ï¼š æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦åœ¨ wheel ç»„ï¼ˆæˆ– sudo ç»„ï¼Œå–å†³äºé…ç½®ï¼‰ä¸­ã€‚ æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½å¿…é¡»ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ª required æ¨¡å—ã€‚ä½†å…¶ç»“æœä¼šè¢«è®°å½•ä¸‹æ¥ã€‚ æ‰§è¡Œ pam_unix.so (required)ï¼š ä½¿ç”¨ nullok å’Œ try_first_pass å‚æ•°è¿›è¡Œå¯†ç éªŒè¯ã€‚ nullokï¼šå…è®¸ç©ºå¯†ç è´¦æˆ·ç™»å½•ã€‚ try_first_passï¼šå°è¯•ä½¿ç”¨å‰é¢æ¨¡å—ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰æä¾›çš„å¯†ç ã€‚å¯¹äº sudoï¼Œè¿™é€šå¸¸æŒ‡ä¹‹å‰ sudo æˆåŠŸæ—¶ç¼“å­˜çš„å¯†ç ã€‚ å¦‚æœå¯†ç æ­£ç¡®ï¼šæ­¤æ¨¡å—æˆåŠŸã€‚ å¦‚æœå¯†ç é”™è¯¯ï¼šæ­¤æ¨¡å—å¤±è´¥ã€‚ æœ€ç»ˆç»“æœåˆ¤å®šï¼š åœ¨æ‰€æœ‰ required æ¨¡å—æ‰§è¡Œå®Œæ¯•åï¼ŒPAM ä¼šæ£€æŸ¥å®ƒä»¬çš„ç»“æœã€‚ å¦‚æœä»»ä½•ä¸€ä¸ª required æ¨¡å—ï¼ˆpam_wheel.so æˆ– pam_unix.soï¼‰å¤±è´¥ï¼Œæ•´ä¸ªè®¤è¯æµç¨‹å¤±è´¥ã€‚ åªæœ‰å½“æ‰€æœ‰ required æ¨¡å—éƒ½æˆåŠŸæ—¶ï¼Œè®¤è¯æ‰æœ€ç»ˆæˆåŠŸã€‚ å¸¸ç”¨æ¨¡å—åŠå…¶å‚æ•°è¯´æ˜ï¼š pam_unix.so å‚æ•° (ç”¨äºå¯†ç éªŒè¯) è¿™æ˜¯æœ€æ ¸å¿ƒçš„å¯†ç è®¤è¯æ¨¡å—ï¼Œå¸¸è§äº auth å’Œ password ç±»å‹ã€‚ nullokï¼šå…è®¸ç©ºå¯†ç è´¦æˆ·é€šè¿‡è®¤è¯ã€‚å¦‚æœä¸åŠ æ­¤å‚æ•°ï¼Œç©ºå¯†ç è´¦æˆ·å°†æ— æ³•ç™»å½•ã€‚ try_first_passï¼šåœ¨æç¤ºç”¨æˆ·è¾“å…¥å¯†ç å‰ï¼Œå…ˆå°è¯•ä½¿ç”¨ä¹‹å‰æ ˆä¸­å·²ç¼“å­˜çš„å¯†ç ï¼ˆä¾‹å¦‚ï¼Œç”±pam_timestamp.so æˆ– pam_kwallet.so æä¾›çš„ï¼‰ã€‚ use_authtokï¼šå¼ºåˆ¶ä½¿ç”¨ä¹‹å‰æ ˆä¸­å·²ç¼“å­˜çš„å¯†ç ï¼Œå¦‚æœä¸å­˜åœ¨ç¼“å­˜å¯†ç ï¼Œåˆ™ç›´æ¥å¤±è´¥ã€‚å®ƒæ¯”try_first_pass æ›´ä¸¥æ ¼ï¼Œé€šå¸¸ç”¨åœ¨ä¿®æ”¹å¯†ç çš„ password æ¨¡å—æ ˆä¸­ï¼Œä»¥ç¡®ä¿ç”¨æˆ·è¾“å…¥çš„æ˜¯æ—§å¯†ç ã€‚ shadowï¼šä½¿ç”¨ /etc/shadow æ–‡ä»¶è¿›è¡Œå¯†ç éªŒè¯ï¼ˆç°ä»£ç³»ç»Ÿé»˜è®¤å¯ç”¨ï¼‰ã€‚ pam_timestamp.so å‚æ•° (ç”¨äºæ—¶é—´æˆ³è®¤è¯) å¸¸ç”¨äº sudoï¼Œå®ç°å…å¯†ç æ“ä½œã€‚ timestamp_timeout=600ï¼šè®¾ç½®æ—¶é—´æˆ³çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’ã€‚é»˜è®¤æ˜¯ 300 (5åˆ†é’Ÿ)ã€‚ pam_wheel.so å‚æ•° (ç”¨äºç»„æˆå‘˜èµ„æ ¼æ£€æŸ¥) ç”¨äºé™åˆ¶åªæœ‰ç‰¹å®šç»„çš„ç”¨æˆ·æ‰èƒ½ä½¿ç”¨ su æˆ– sudoã€‚ use_uidï¼šæ£€æŸ¥å‘èµ·è¯·æ±‚çš„åŸå§‹ç”¨æˆ· IDï¼Œè€Œä¸æ˜¯å½“å‰ç”¨æˆ· IDï¼ˆåœ¨ sudo åœºæ™¯ä¸‹å¾ˆé‡è¦ï¼‰ã€‚ group=adminsï¼šæŒ‡å®šæ£€æŸ¥çš„ç»„åï¼Œé»˜è®¤æ˜¯ wheelã€‚ pam_gnome_keyring.so å‚æ•° (ç”¨äºä¼šè¯ç®¡ç†) è¿™ä¸ªæ¨¡å—ä¸ sudo çš„è®¤è¯æµç¨‹æ— å…³ï¼Œä¸»è¦ç”¨äºç”¨æˆ·ç™»å½•æ—¶è§£é”å¯†é’¥ç¯ã€‚ auto_startï¼šåœ¨ä¼šè¯å¯åŠ¨æ—¶ï¼Œå¦‚æœç”¨æˆ·å¯†ç ä¸å¯†é’¥ç¯å¯†ç ç›¸åŒï¼Œåˆ™è‡ªåŠ¨è§£é”å¯†é’¥ç¯ã€‚ å…¸å‹åº”ç”¨åœºæ™¯ï¼šåœ¨ /etc/pam.d/gdm-password æˆ– /etc/pam.d/login çš„ auth å’Œsession éƒ¨åˆ†ã€‚ bash # åœ¨ /etc/pam.d/gdm-password ä¸­ auth optional pam_gnome_keyring.so session optional pam_gnome_keyring.so auto_start 3.1.3 åº”ç”¨ç¨‹åºä¸ PAM çš„äº¤äº’ç¨‹åºé€šè¿‡ pam_start() æŒ‡å®šæœåŠ¡åï¼Œç³»ç»Ÿæ®æ­¤åŠ è½½å¯¹åº”çš„é…ç½®æ–‡ä»¶ã€‚ ç¨‹åº æœåŠ¡å é…ç½®æ–‡ä»¶ åŠŸèƒ½ login \"login\" /etc/pam.d/login æ§åˆ¶å°ç™»å½• gdm \"gdm\" /etc/pam.d/gdm GNOME ç™»å½•ç•Œé¢ sudo \"sudo\" /etc/pam.d/sudo ææƒå‘½ä»¤ sshd \"sshd\" /etc/pam.d/sshd SSH ç™»å½• greetd \"greetd\" /etc/pam.d/greetd è½»é‡æ˜¾ç¤ºç®¡ç†å™¨ ä¸€ä¸ªå…¸å‹çš„è°ƒç”¨é¡ºåºå¦‚ä¸‹ï¼ˆä»¥ sudo ä¸ºä¾‹ï¼‰ï¼š c pam_start(\"sudo\", user, \u0026conv, \u0026pamh); // åˆå§‹åŒ– PAM pam_authenticate(pamh, 0); // èº«ä»½éªŒè¯ pam_acct_mgmt(pamh, 0); // è´¦æˆ·æ£€æŸ¥ pam_open_session(pamh, 0); // æ‰“å¼€ä¼šè¯ // æ‰§è¡Œç”¨æˆ·å‘½ä»¤ pam_close_session(pamh, 0); // å…³é—­ä¼šè¯ pam_end(pamh, PAM_SUCCESS); // é‡Šæ”¾èµ„æº å¦‚ä¸‹æ˜¯ä¸€ä¸ªç”¨æˆ·ç™»å½•æµç¨‹çš„ PAM è°ƒç”¨ç¤ºä¾‹ï¼š c #include #include #include #include static void log_result(pam_handle_t *pamh, int ret, const char *step) { if (ret == PAM_SUCCESS) { printf(\"[âœ“] %s æˆåŠŸ\\n\", step); } else { fprintf(stderr, \"[âœ—] %s å¤±è´¥: %sï¼ˆè¿”å›ç  %dï¼‰\\n\", step, pam_strerror(pamh, ret), ret); } } int main(int argc, char *argv[]) { pam_handle_t *p","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:4:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#2æ£€æŸ¥æ¨¡å—ä¸ä¾èµ–"},{"categories":["tech"],"content":" 3.1 PAM - å¯æ’æ‹”è®¤è¯æ¨¡å—PAMï¼ˆPluggable Authentication Modulesï¼‰ æ˜¯ Linux çš„ç»Ÿä¸€è®¤è¯æ¡†æ¶ï¼Œä¸ºç³»ç»Ÿä¸­çš„å„ç§ç¨‹åº ï¼ˆå¦‚ loginã€sudoã€sshdã€gdm ç­‰ï¼‰æä¾›æ ‡å‡†åŒ–çš„è®¤è¯æ¥å£ã€‚å€ŸåŠ© PAMï¼Œç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶çµæ´»æ§åˆ¶è®¤è¯ç­–ç•¥ï¼Œè€Œæ— éœ€ä¿®æ”¹åº”ç”¨ç¨‹åºæœ¬èº«ã€‚å®ƒæ”¯æŒå¤šç§è®¤è¯æ–¹å¼ï¼ˆå¯†ç ã€æŒ‡çº¹ã€æ™ºèƒ½å¡ã€åŒå› å­éªŒè¯ç­‰ï¼‰ï¼Œæ˜¯ç°ä»£ Linux å®‰å…¨ä½“ç³»çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ã€‚ 3.1.1 å·¥ä½œåŸç†ä¸é…ç½®ç»“æ„PAM é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œå°†è®¤è¯æµç¨‹åˆ†ä¸ºå››ä¸ªé˜¶æ®µã€‚åº”ç”¨ç¨‹åºé€šè¿‡è°ƒç”¨ç›¸åº”çš„ PAM æ¥å£è§¦å‘è¿™äº›é˜¶æ®µï¼Œ ç³»ç»Ÿæ ¹æ® /etc/pam.d/ ä¸‹çš„é…ç½®æ–‡ä»¶æ‰§è¡Œç›¸åº”çš„æ¨¡å—ï¼ˆ.so æ–‡ä»¶ï¼‰ã€‚ ï¼ˆ1ï¼‰é…ç½®æ–‡ä»¶è¯­æ³• https://linux.die.net/man/5/pam.d æ¯è¡Œçš„åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š text [arguments] typeï¼šè¡¨ç¤ºé˜¶æ®µç±»å‹ controlï¼šå®šä¹‰è¯¥æ¨¡å—çš„æ‰§è¡Œç­–ç•¥ moduleï¼šå…·ä½“çš„ PAM æ¨¡å—è·¯å¾„ï¼ˆæˆ–åç§°ï¼‰ argumentsï¼šä¼ é€’ç»™æ¨¡å—çš„å‚æ•° ï¼ˆ2ï¼‰å››ä¸ªè®¤è¯é˜¶æ®µ é˜¶æ®µç±»å‹ è°ƒç”¨å‡½æ•° ä¸»è¦ä½œç”¨ auth pam_authenticate() éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œé€šå¸¸ä¼šæç¤ºç”¨æˆ·è¾“å‡ºå¯†ç æˆ–æŒ‡çº¹ä»¥å®ŒæˆéªŒè¯ account pam_acct_mgmt() æ£€æŸ¥è´¦æˆ·çŠ¶æ€ï¼ˆè¿‡æœŸã€é”å®šç­‰ï¼‰ password pam_chauthtok() å¤„ç†å¯†ç ä¿®æ”¹ session pam_open_session() / pam_close_session() å»ºç«‹å’Œæ¸…ç†ç”¨æˆ·ä¼šè¯ ï¼ˆ3ï¼‰æ§åˆ¶æ ‡å¿—ï¼ˆcontrolï¼‰ æ ‡å¿— å«ä¹‰ è¡Œä¸ºè¯´æ˜ required å¿…é¡»æˆåŠŸï¼Œå¤±è´¥ä¸ä¼šç«‹å³ç»ˆæ­¢ï¼Œä½†æœ€ç»ˆç»“æœä¼šå¤±è´¥ æ— è®ºæˆåŠŸå¤±è´¥ï¼Œéƒ½ä¼šç»§ç»­æ‰§è¡Œåç»­æ¨¡å—ã€‚æœ€ç»ˆåªè¦æœ‰ä¸€ä¸ª required å¤±è´¥ï¼Œæ•´ä¸ªè®¤è¯å°±å¤±è´¥ã€‚ requisite å¿…é¡»æˆåŠŸï¼Œå¤±è´¥ç«‹å³ç»ˆæ­¢å¹¶è¿”å›å¤±è´¥ å¤±è´¥ç«‹å³è¿”å›ï¼Œä¸å†æ‰§è¡Œåç»­æ¨¡å—ã€‚ sufficient æˆåŠŸåˆ™ç«‹å³é€šè¿‡è®¤è¯ï¼ˆè·³è¿‡æ‰€æœ‰åç»­æ¨¡å—ï¼‰ï¼›å¤±è´¥åˆ™ç»§ç»­ç”±åç»­æ¨¡å—è¿›è¡Œè®¤è¯ è‹¥å‰é¢æ²¡æœ‰ required å¤±è´¥ï¼Œåˆ™æˆåŠŸç›´æ¥é€šè¿‡ï¼›å¦åˆ™å¤±è´¥ä¸å½±å“åç»­ã€‚ optional å¯é€‰æ¨¡å—ï¼Œç»“æœé€šå¸¸è¢«å¿½ç•¥ æ— è®ºæˆåŠŸå¤±è´¥ï¼Œå¯¹æœ€ç»ˆç»“æœæ— ç›´æ¥å½±å“ï¼Œé™¤éæ˜¯æ ˆä¸­å”¯ä¸€çš„æ¨¡å—ã€‚ include åŒ…å«å¦ä¸€ä¸ªæ–‡ä»¶çš„é…ç½® å°†æŒ‡å®šæ–‡ä»¶çš„é…ç½®å†…å®¹åŒ…å«è¿›æ¥ï¼Œé€šå¸¸ç”¨äºå¤ç”¨é€šç”¨é…ç½®ï¼ˆå¦‚ system-authï¼‰ã€‚ substack è°ƒç”¨å­æ ˆ ç±»ä¼¼ includeï¼Œä½†å­æ ˆçš„å¤±è´¥ä¸å½±å“ä¸»æ ˆï¼ˆå³å­æ ˆåªèƒ½è·³è¿‡å…¶è‡ªèº«çš„åç»­æ­¥éª¤ï¼‰ï¼Œé™¤éä¸»æ ˆä¸­å¦æœ‰è®¾ç½®ã€‚ ï¼ˆ4ï¼‰å¸¸ç”¨æ¨¡å—ç¤ºä¾‹ bash pam_unix.so # åŸºäº /etc/passwd ä¸ /etc/shadow çš„æ ‡å‡†å¯†ç è®¤è¯ pam_google_authenticator.so # åŒå› å­è®¤è¯ï¼ˆTOTPï¼‰ pam_fprintd.so # æŒ‡çº¹è®¤è¯ pam_ldap.so # LDAP é›†ä¸­å¼è®¤è¯ pam_gnome_keyring.so # GNOME å¯†é’¥ç¯é›†æˆ pam_limits.so # ç”¨æˆ·èµ„æºé™åˆ¶ pam_deny.so # æ‹’ç»æ‰€æœ‰è®¤è¯è¯·æ±‚ 3.1.2 æ‰§è¡Œæµç¨‹ç¤ºä¾‹ä»¥ /etc/pam.d/sudo ä¸ºä¾‹ï¼š bash #%PAM-1.0 auth sufficient pam_rootok.so auth sufficient pam_timestamp.so auth required pam_wheel.so use_uid auth required pam_unix.so nullok try_first_pass å„æ¨¡å—çš„æ‰§è¡Œé¡ºåºå¦‚ä¸‹ï¼š æ‰§è¡Œ pam_rootok.so (sufficient)ï¼š æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦ä¸º rootã€‚ å¦‚æœæˆåŠŸï¼šPAM è®¤è¯æµç¨‹ç«‹å³æˆåŠŸï¼Œå¹¶è·³è¿‡åç»­æ‰€æœ‰ auth æ¨¡å—ã€‚ç”¨æˆ·ç›´æ¥è·å¾— sudo æƒé™ã€‚ å¦‚æœå¤±è´¥ï¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªæ¨¡å—ã€‚ æ‰§è¡Œ pam_timestamp.so (sufficient)ï¼š æ£€æŸ¥æ˜¯å¦å­˜åœ¨æœ‰æ•ˆçš„æ—¶é—´æˆ³æ–‡ä»¶ï¼ˆé»˜è®¤ä¸º 5 åˆ†é’Ÿå†…ï¼‰ã€‚ å¦‚æœæˆåŠŸï¼šPAM è®¤è¯æµç¨‹ç«‹å³æˆåŠŸï¼Œå¹¶è·³è¿‡åç»­æ‰€æœ‰ auth æ¨¡å—ã€‚ç”¨æˆ·å…å¯†ç è·å¾— sudo æƒé™ã€‚ å¦‚æœå¤±è´¥ï¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªæ¨¡å—ã€‚ æ‰§è¡Œ pam_wheel.so (required)ï¼š æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦åœ¨ wheel ç»„ï¼ˆæˆ– sudo ç»„ï¼Œå–å†³äºé…ç½®ï¼‰ä¸­ã€‚ æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½å¿…é¡»ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ª required æ¨¡å—ã€‚ä½†å…¶ç»“æœä¼šè¢«è®°å½•ä¸‹æ¥ã€‚ æ‰§è¡Œ pam_unix.so (required)ï¼š ä½¿ç”¨ nullok å’Œ try_first_pass å‚æ•°è¿›è¡Œå¯†ç éªŒè¯ã€‚ nullokï¼šå…è®¸ç©ºå¯†ç è´¦æˆ·ç™»å½•ã€‚ try_first_passï¼šå°è¯•ä½¿ç”¨å‰é¢æ¨¡å—ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰æä¾›çš„å¯†ç ã€‚å¯¹äº sudoï¼Œè¿™é€šå¸¸æŒ‡ä¹‹å‰ sudo æˆåŠŸæ—¶ç¼“å­˜çš„å¯†ç ã€‚ å¦‚æœå¯†ç æ­£ç¡®ï¼šæ­¤æ¨¡å—æˆåŠŸã€‚ å¦‚æœå¯†ç é”™è¯¯ï¼šæ­¤æ¨¡å—å¤±è´¥ã€‚ æœ€ç»ˆç»“æœåˆ¤å®šï¼š åœ¨æ‰€æœ‰ required æ¨¡å—æ‰§è¡Œå®Œæ¯•åï¼ŒPAM ä¼šæ£€æŸ¥å®ƒä»¬çš„ç»“æœã€‚ å¦‚æœä»»ä½•ä¸€ä¸ª required æ¨¡å—ï¼ˆpam_wheel.so æˆ– pam_unix.soï¼‰å¤±è´¥ï¼Œæ•´ä¸ªè®¤è¯æµç¨‹å¤±è´¥ã€‚ åªæœ‰å½“æ‰€æœ‰ required æ¨¡å—éƒ½æˆåŠŸæ—¶ï¼Œè®¤è¯æ‰æœ€ç»ˆæˆåŠŸã€‚ å¸¸ç”¨æ¨¡å—åŠå…¶å‚æ•°è¯´æ˜ï¼š pam_unix.so å‚æ•° (ç”¨äºå¯†ç éªŒè¯) è¿™æ˜¯æœ€æ ¸å¿ƒçš„å¯†ç è®¤è¯æ¨¡å—ï¼Œå¸¸è§äº auth å’Œ password ç±»å‹ã€‚ nullokï¼šå…è®¸ç©ºå¯†ç è´¦æˆ·é€šè¿‡è®¤è¯ã€‚å¦‚æœä¸åŠ æ­¤å‚æ•°ï¼Œç©ºå¯†ç è´¦æˆ·å°†æ— æ³•ç™»å½•ã€‚ try_first_passï¼šåœ¨æç¤ºç”¨æˆ·è¾“å…¥å¯†ç å‰ï¼Œå…ˆå°è¯•ä½¿ç”¨ä¹‹å‰æ ˆä¸­å·²ç¼“å­˜çš„å¯†ç ï¼ˆä¾‹å¦‚ï¼Œç”±pam_timestamp.so æˆ– pam_kwallet.so æä¾›çš„ï¼‰ã€‚ use_authtokï¼šå¼ºåˆ¶ä½¿ç”¨ä¹‹å‰æ ˆä¸­å·²ç¼“å­˜çš„å¯†ç ï¼Œå¦‚æœä¸å­˜åœ¨ç¼“å­˜å¯†ç ï¼Œåˆ™ç›´æ¥å¤±è´¥ã€‚å®ƒæ¯”try_first_pass æ›´ä¸¥æ ¼ï¼Œé€šå¸¸ç”¨åœ¨ä¿®æ”¹å¯†ç çš„ password æ¨¡å—æ ˆä¸­ï¼Œä»¥ç¡®ä¿ç”¨æˆ·è¾“å…¥çš„æ˜¯æ—§å¯†ç ã€‚ shadowï¼šä½¿ç”¨ /etc/shadow æ–‡ä»¶è¿›è¡Œå¯†ç éªŒè¯ï¼ˆç°ä»£ç³»ç»Ÿé»˜è®¤å¯ç”¨ï¼‰ã€‚ pam_timestamp.so å‚æ•° (ç”¨äºæ—¶é—´æˆ³è®¤è¯) å¸¸ç”¨äº sudoï¼Œå®ç°å…å¯†ç æ“ä½œã€‚ timestamp_timeout=600ï¼šè®¾ç½®æ—¶é—´æˆ³çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’ã€‚é»˜è®¤æ˜¯ 300 (5åˆ†é’Ÿ)ã€‚ pam_wheel.so å‚æ•° (ç”¨äºç»„æˆå‘˜èµ„æ ¼æ£€æŸ¥) ç”¨äºé™åˆ¶åªæœ‰ç‰¹å®šç»„çš„ç”¨æˆ·æ‰èƒ½ä½¿ç”¨ su æˆ– sudoã€‚ use_uidï¼šæ£€æŸ¥å‘èµ·è¯·æ±‚çš„åŸå§‹ç”¨æˆ· IDï¼Œè€Œä¸æ˜¯å½“å‰ç”¨æˆ· IDï¼ˆåœ¨ sudo åœºæ™¯ä¸‹å¾ˆé‡è¦ï¼‰ã€‚ group=adminsï¼šæŒ‡å®šæ£€æŸ¥çš„ç»„åï¼Œé»˜è®¤æ˜¯ wheelã€‚ pam_gnome_keyring.so å‚æ•° (ç”¨äºä¼šè¯ç®¡ç†) è¿™ä¸ªæ¨¡å—ä¸ sudo çš„è®¤è¯æµç¨‹æ— å…³ï¼Œä¸»è¦ç”¨äºç”¨æˆ·ç™»å½•æ—¶è§£é”å¯†é’¥ç¯ã€‚ auto_startï¼šåœ¨ä¼šè¯å¯åŠ¨æ—¶ï¼Œå¦‚æœç”¨æˆ·å¯†ç ä¸å¯†é’¥ç¯å¯†ç ç›¸åŒï¼Œåˆ™è‡ªåŠ¨è§£é”å¯†é’¥ç¯ã€‚ å…¸å‹åº”ç”¨åœºæ™¯ï¼šåœ¨ /etc/pam.d/gdm-password æˆ– /etc/pam.d/login çš„ auth å’Œsession éƒ¨åˆ†ã€‚ bash # åœ¨ /etc/pam.d/gdm-password ä¸­ auth optional pam_gnome_keyring.so session optional pam_gnome_keyring.so auto_start 3.1.3 åº”ç”¨ç¨‹åºä¸ PAM çš„äº¤äº’ç¨‹åºé€šè¿‡ pam_start() æŒ‡å®šæœåŠ¡åï¼Œç³»ç»Ÿæ®æ­¤åŠ è½½å¯¹åº”çš„é…ç½®æ–‡ä»¶ã€‚ ç¨‹åº æœåŠ¡å é…ç½®æ–‡ä»¶ åŠŸèƒ½ login \"login\" /etc/pam.d/login æ§åˆ¶å°ç™»å½• gdm \"gdm\" /etc/pam.d/gdm GNOME ç™»å½•ç•Œé¢ sudo \"sudo\" /etc/pam.d/sudo ææƒå‘½ä»¤ sshd \"sshd\" /etc/pam.d/sshd SSH ç™»å½• greetd \"greetd\" /etc/pam.d/greetd è½»é‡æ˜¾ç¤ºç®¡ç†å™¨ ä¸€ä¸ªå…¸å‹çš„è°ƒç”¨é¡ºåºå¦‚ä¸‹ï¼ˆä»¥ sudo ä¸ºä¾‹ï¼‰ï¼š c pam_start(\"sudo\", user, \u0026conv, \u0026pamh); // åˆå§‹åŒ– PAM pam_authenticate(pamh, 0); // èº«ä»½éªŒè¯ pam_acct_mgmt(pamh, 0); // è´¦æˆ·æ£€æŸ¥ pam_open_session(pamh, 0); // æ‰“å¼€ä¼šè¯ // æ‰§è¡Œç”¨æˆ·å‘½ä»¤ pam_close_session(pamh, 0); // å…³é—­ä¼šè¯ pam_end(pamh, PAM_SUCCESS); // é‡Šæ”¾èµ„æº å¦‚ä¸‹æ˜¯ä¸€ä¸ªç”¨æˆ·ç™»å½•æµç¨‹çš„ PAM è°ƒç”¨ç¤ºä¾‹ï¼š c #include #include #include #include static void log_result(pam_handle_t *pamh, int ret, const char *step) { if (ret == PAM_SUCCESS) { printf(\"[âœ“] %s æˆåŠŸ\\n\", step); } else { fprintf(stderr, \"[âœ—] %s å¤±è´¥: %sï¼ˆè¿”å›ç  %dï¼‰\\n\", step, pam_strerror(pamh, ret), ret); } } int main(int argc, char *argv[]) { pam_handle_t *p","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:4:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#3æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—"},{"categories":["tech"],"content":" 3.1 PAM - å¯æ’æ‹”è®¤è¯æ¨¡å—PAMï¼ˆPluggable Authentication Modulesï¼‰ æ˜¯ Linux çš„ç»Ÿä¸€è®¤è¯æ¡†æ¶ï¼Œä¸ºç³»ç»Ÿä¸­çš„å„ç§ç¨‹åº ï¼ˆå¦‚ loginã€sudoã€sshdã€gdm ç­‰ï¼‰æä¾›æ ‡å‡†åŒ–çš„è®¤è¯æ¥å£ã€‚å€ŸåŠ© PAMï¼Œç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶çµæ´»æ§åˆ¶è®¤è¯ç­–ç•¥ï¼Œè€Œæ— éœ€ä¿®æ”¹åº”ç”¨ç¨‹åºæœ¬èº«ã€‚å®ƒæ”¯æŒå¤šç§è®¤è¯æ–¹å¼ï¼ˆå¯†ç ã€æŒ‡çº¹ã€æ™ºèƒ½å¡ã€åŒå› å­éªŒè¯ç­‰ï¼‰ï¼Œæ˜¯ç°ä»£ Linux å®‰å…¨ä½“ç³»çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ã€‚ 3.1.1 å·¥ä½œåŸç†ä¸é…ç½®ç»“æ„PAM é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œå°†è®¤è¯æµç¨‹åˆ†ä¸ºå››ä¸ªé˜¶æ®µã€‚åº”ç”¨ç¨‹åºé€šè¿‡è°ƒç”¨ç›¸åº”çš„ PAM æ¥å£è§¦å‘è¿™äº›é˜¶æ®µï¼Œ ç³»ç»Ÿæ ¹æ® /etc/pam.d/ ä¸‹çš„é…ç½®æ–‡ä»¶æ‰§è¡Œç›¸åº”çš„æ¨¡å—ï¼ˆ.so æ–‡ä»¶ï¼‰ã€‚ ï¼ˆ1ï¼‰é…ç½®æ–‡ä»¶è¯­æ³• https://linux.die.net/man/5/pam.d æ¯è¡Œçš„åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š text [arguments] typeï¼šè¡¨ç¤ºé˜¶æ®µç±»å‹ controlï¼šå®šä¹‰è¯¥æ¨¡å—çš„æ‰§è¡Œç­–ç•¥ moduleï¼šå…·ä½“çš„ PAM æ¨¡å—è·¯å¾„ï¼ˆæˆ–åç§°ï¼‰ argumentsï¼šä¼ é€’ç»™æ¨¡å—çš„å‚æ•° ï¼ˆ2ï¼‰å››ä¸ªè®¤è¯é˜¶æ®µ é˜¶æ®µç±»å‹ è°ƒç”¨å‡½æ•° ä¸»è¦ä½œç”¨ auth pam_authenticate() éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œé€šå¸¸ä¼šæç¤ºç”¨æˆ·è¾“å‡ºå¯†ç æˆ–æŒ‡çº¹ä»¥å®ŒæˆéªŒè¯ account pam_acct_mgmt() æ£€æŸ¥è´¦æˆ·çŠ¶æ€ï¼ˆè¿‡æœŸã€é”å®šç­‰ï¼‰ password pam_chauthtok() å¤„ç†å¯†ç ä¿®æ”¹ session pam_open_session() / pam_close_session() å»ºç«‹å’Œæ¸…ç†ç”¨æˆ·ä¼šè¯ ï¼ˆ3ï¼‰æ§åˆ¶æ ‡å¿—ï¼ˆcontrolï¼‰ æ ‡å¿— å«ä¹‰ è¡Œä¸ºè¯´æ˜ required å¿…é¡»æˆåŠŸï¼Œå¤±è´¥ä¸ä¼šç«‹å³ç»ˆæ­¢ï¼Œä½†æœ€ç»ˆç»“æœä¼šå¤±è´¥ æ— è®ºæˆåŠŸå¤±è´¥ï¼Œéƒ½ä¼šç»§ç»­æ‰§è¡Œåç»­æ¨¡å—ã€‚æœ€ç»ˆåªè¦æœ‰ä¸€ä¸ª required å¤±è´¥ï¼Œæ•´ä¸ªè®¤è¯å°±å¤±è´¥ã€‚ requisite å¿…é¡»æˆåŠŸï¼Œå¤±è´¥ç«‹å³ç»ˆæ­¢å¹¶è¿”å›å¤±è´¥ å¤±è´¥ç«‹å³è¿”å›ï¼Œä¸å†æ‰§è¡Œåç»­æ¨¡å—ã€‚ sufficient æˆåŠŸåˆ™ç«‹å³é€šè¿‡è®¤è¯ï¼ˆè·³è¿‡æ‰€æœ‰åç»­æ¨¡å—ï¼‰ï¼›å¤±è´¥åˆ™ç»§ç»­ç”±åç»­æ¨¡å—è¿›è¡Œè®¤è¯ è‹¥å‰é¢æ²¡æœ‰ required å¤±è´¥ï¼Œåˆ™æˆåŠŸç›´æ¥é€šè¿‡ï¼›å¦åˆ™å¤±è´¥ä¸å½±å“åç»­ã€‚ optional å¯é€‰æ¨¡å—ï¼Œç»“æœé€šå¸¸è¢«å¿½ç•¥ æ— è®ºæˆåŠŸå¤±è´¥ï¼Œå¯¹æœ€ç»ˆç»“æœæ— ç›´æ¥å½±å“ï¼Œé™¤éæ˜¯æ ˆä¸­å”¯ä¸€çš„æ¨¡å—ã€‚ include åŒ…å«å¦ä¸€ä¸ªæ–‡ä»¶çš„é…ç½® å°†æŒ‡å®šæ–‡ä»¶çš„é…ç½®å†…å®¹åŒ…å«è¿›æ¥ï¼Œé€šå¸¸ç”¨äºå¤ç”¨é€šç”¨é…ç½®ï¼ˆå¦‚ system-authï¼‰ã€‚ substack è°ƒç”¨å­æ ˆ ç±»ä¼¼ includeï¼Œä½†å­æ ˆçš„å¤±è´¥ä¸å½±å“ä¸»æ ˆï¼ˆå³å­æ ˆåªèƒ½è·³è¿‡å…¶è‡ªèº«çš„åç»­æ­¥éª¤ï¼‰ï¼Œé™¤éä¸»æ ˆä¸­å¦æœ‰è®¾ç½®ã€‚ ï¼ˆ4ï¼‰å¸¸ç”¨æ¨¡å—ç¤ºä¾‹ bash pam_unix.so # åŸºäº /etc/passwd ä¸ /etc/shadow çš„æ ‡å‡†å¯†ç è®¤è¯ pam_google_authenticator.so # åŒå› å­è®¤è¯ï¼ˆTOTPï¼‰ pam_fprintd.so # æŒ‡çº¹è®¤è¯ pam_ldap.so # LDAP é›†ä¸­å¼è®¤è¯ pam_gnome_keyring.so # GNOME å¯†é’¥ç¯é›†æˆ pam_limits.so # ç”¨æˆ·èµ„æºé™åˆ¶ pam_deny.so # æ‹’ç»æ‰€æœ‰è®¤è¯è¯·æ±‚ 3.1.2 æ‰§è¡Œæµç¨‹ç¤ºä¾‹ä»¥ /etc/pam.d/sudo ä¸ºä¾‹ï¼š bash #%PAM-1.0 auth sufficient pam_rootok.so auth sufficient pam_timestamp.so auth required pam_wheel.so use_uid auth required pam_unix.so nullok try_first_pass å„æ¨¡å—çš„æ‰§è¡Œé¡ºåºå¦‚ä¸‹ï¼š æ‰§è¡Œ pam_rootok.so (sufficient)ï¼š æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦ä¸º rootã€‚ å¦‚æœæˆåŠŸï¼šPAM è®¤è¯æµç¨‹ç«‹å³æˆåŠŸï¼Œå¹¶è·³è¿‡åç»­æ‰€æœ‰ auth æ¨¡å—ã€‚ç”¨æˆ·ç›´æ¥è·å¾— sudo æƒé™ã€‚ å¦‚æœå¤±è´¥ï¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªæ¨¡å—ã€‚ æ‰§è¡Œ pam_timestamp.so (sufficient)ï¼š æ£€æŸ¥æ˜¯å¦å­˜åœ¨æœ‰æ•ˆçš„æ—¶é—´æˆ³æ–‡ä»¶ï¼ˆé»˜è®¤ä¸º 5 åˆ†é’Ÿå†…ï¼‰ã€‚ å¦‚æœæˆåŠŸï¼šPAM è®¤è¯æµç¨‹ç«‹å³æˆåŠŸï¼Œå¹¶è·³è¿‡åç»­æ‰€æœ‰ auth æ¨¡å—ã€‚ç”¨æˆ·å…å¯†ç è·å¾— sudo æƒé™ã€‚ å¦‚æœå¤±è´¥ï¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªæ¨¡å—ã€‚ æ‰§è¡Œ pam_wheel.so (required)ï¼š æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦åœ¨ wheel ç»„ï¼ˆæˆ– sudo ç»„ï¼Œå–å†³äºé…ç½®ï¼‰ä¸­ã€‚ æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½å¿…é¡»ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ª required æ¨¡å—ã€‚ä½†å…¶ç»“æœä¼šè¢«è®°å½•ä¸‹æ¥ã€‚ æ‰§è¡Œ pam_unix.so (required)ï¼š ä½¿ç”¨ nullok å’Œ try_first_pass å‚æ•°è¿›è¡Œå¯†ç éªŒè¯ã€‚ nullokï¼šå…è®¸ç©ºå¯†ç è´¦æˆ·ç™»å½•ã€‚ try_first_passï¼šå°è¯•ä½¿ç”¨å‰é¢æ¨¡å—ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰æä¾›çš„å¯†ç ã€‚å¯¹äº sudoï¼Œè¿™é€šå¸¸æŒ‡ä¹‹å‰ sudo æˆåŠŸæ—¶ç¼“å­˜çš„å¯†ç ã€‚ å¦‚æœå¯†ç æ­£ç¡®ï¼šæ­¤æ¨¡å—æˆåŠŸã€‚ å¦‚æœå¯†ç é”™è¯¯ï¼šæ­¤æ¨¡å—å¤±è´¥ã€‚ æœ€ç»ˆç»“æœåˆ¤å®šï¼š åœ¨æ‰€æœ‰ required æ¨¡å—æ‰§è¡Œå®Œæ¯•åï¼ŒPAM ä¼šæ£€æŸ¥å®ƒä»¬çš„ç»“æœã€‚ å¦‚æœä»»ä½•ä¸€ä¸ª required æ¨¡å—ï¼ˆpam_wheel.so æˆ– pam_unix.soï¼‰å¤±è´¥ï¼Œæ•´ä¸ªè®¤è¯æµç¨‹å¤±è´¥ã€‚ åªæœ‰å½“æ‰€æœ‰ required æ¨¡å—éƒ½æˆåŠŸæ—¶ï¼Œè®¤è¯æ‰æœ€ç»ˆæˆåŠŸã€‚ å¸¸ç”¨æ¨¡å—åŠå…¶å‚æ•°è¯´æ˜ï¼š pam_unix.so å‚æ•° (ç”¨äºå¯†ç éªŒè¯) è¿™æ˜¯æœ€æ ¸å¿ƒçš„å¯†ç è®¤è¯æ¨¡å—ï¼Œå¸¸è§äº auth å’Œ password ç±»å‹ã€‚ nullokï¼šå…è®¸ç©ºå¯†ç è´¦æˆ·é€šè¿‡è®¤è¯ã€‚å¦‚æœä¸åŠ æ­¤å‚æ•°ï¼Œç©ºå¯†ç è´¦æˆ·å°†æ— æ³•ç™»å½•ã€‚ try_first_passï¼šåœ¨æç¤ºç”¨æˆ·è¾“å…¥å¯†ç å‰ï¼Œå…ˆå°è¯•ä½¿ç”¨ä¹‹å‰æ ˆä¸­å·²ç¼“å­˜çš„å¯†ç ï¼ˆä¾‹å¦‚ï¼Œç”±pam_timestamp.so æˆ– pam_kwallet.so æä¾›çš„ï¼‰ã€‚ use_authtokï¼šå¼ºåˆ¶ä½¿ç”¨ä¹‹å‰æ ˆä¸­å·²ç¼“å­˜çš„å¯†ç ï¼Œå¦‚æœä¸å­˜åœ¨ç¼“å­˜å¯†ç ï¼Œåˆ™ç›´æ¥å¤±è´¥ã€‚å®ƒæ¯”try_first_pass æ›´ä¸¥æ ¼ï¼Œé€šå¸¸ç”¨åœ¨ä¿®æ”¹å¯†ç çš„ password æ¨¡å—æ ˆä¸­ï¼Œä»¥ç¡®ä¿ç”¨æˆ·è¾“å…¥çš„æ˜¯æ—§å¯†ç ã€‚ shadowï¼šä½¿ç”¨ /etc/shadow æ–‡ä»¶è¿›è¡Œå¯†ç éªŒè¯ï¼ˆç°ä»£ç³»ç»Ÿé»˜è®¤å¯ç”¨ï¼‰ã€‚ pam_timestamp.so å‚æ•° (ç”¨äºæ—¶é—´æˆ³è®¤è¯) å¸¸ç”¨äº sudoï¼Œå®ç°å…å¯†ç æ“ä½œã€‚ timestamp_timeout=600ï¼šè®¾ç½®æ—¶é—´æˆ³çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’ã€‚é»˜è®¤æ˜¯ 300 (5åˆ†é’Ÿ)ã€‚ pam_wheel.so å‚æ•° (ç”¨äºç»„æˆå‘˜èµ„æ ¼æ£€æŸ¥) ç”¨äºé™åˆ¶åªæœ‰ç‰¹å®šç»„çš„ç”¨æˆ·æ‰èƒ½ä½¿ç”¨ su æˆ– sudoã€‚ use_uidï¼šæ£€æŸ¥å‘èµ·è¯·æ±‚çš„åŸå§‹ç”¨æˆ· IDï¼Œè€Œä¸æ˜¯å½“å‰ç”¨æˆ· IDï¼ˆåœ¨ sudo åœºæ™¯ä¸‹å¾ˆé‡è¦ï¼‰ã€‚ group=adminsï¼šæŒ‡å®šæ£€æŸ¥çš„ç»„åï¼Œé»˜è®¤æ˜¯ wheelã€‚ pam_gnome_keyring.so å‚æ•° (ç”¨äºä¼šè¯ç®¡ç†) è¿™ä¸ªæ¨¡å—ä¸ sudo çš„è®¤è¯æµç¨‹æ— å…³ï¼Œä¸»è¦ç”¨äºç”¨æˆ·ç™»å½•æ—¶è§£é”å¯†é’¥ç¯ã€‚ auto_startï¼šåœ¨ä¼šè¯å¯åŠ¨æ—¶ï¼Œå¦‚æœç”¨æˆ·å¯†ç ä¸å¯†é’¥ç¯å¯†ç ç›¸åŒï¼Œåˆ™è‡ªåŠ¨è§£é”å¯†é’¥ç¯ã€‚ å…¸å‹åº”ç”¨åœºæ™¯ï¼šåœ¨ /etc/pam.d/gdm-password æˆ– /etc/pam.d/login çš„ auth å’Œsession éƒ¨åˆ†ã€‚ bash # åœ¨ /etc/pam.d/gdm-password ä¸­ auth optional pam_gnome_keyring.so session optional pam_gnome_keyring.so auto_start 3.1.3 åº”ç”¨ç¨‹åºä¸ PAM çš„äº¤äº’ç¨‹åºé€šè¿‡ pam_start() æŒ‡å®šæœåŠ¡åï¼Œç³»ç»Ÿæ®æ­¤åŠ è½½å¯¹åº”çš„é…ç½®æ–‡ä»¶ã€‚ ç¨‹åº æœåŠ¡å é…ç½®æ–‡ä»¶ åŠŸèƒ½ login \"login\" /etc/pam.d/login æ§åˆ¶å°ç™»å½• gdm \"gdm\" /etc/pam.d/gdm GNOME ç™»å½•ç•Œé¢ sudo \"sudo\" /etc/pam.d/sudo ææƒå‘½ä»¤ sshd \"sshd\" /etc/pam.d/sshd SSH ç™»å½• greetd \"greetd\" /etc/pam.d/greetd è½»é‡æ˜¾ç¤ºç®¡ç†å™¨ ä¸€ä¸ªå…¸å‹çš„è°ƒç”¨é¡ºåºå¦‚ä¸‹ï¼ˆä»¥ sudo ä¸ºä¾‹ï¼‰ï¼š c pam_start(\"sudo\", user, \u0026conv, \u0026pamh); // åˆå§‹åŒ– PAM pam_authenticate(pamh, 0); // èº«ä»½éªŒè¯ pam_acct_mgmt(pamh, 0); // è´¦æˆ·æ£€æŸ¥ pam_open_session(pamh, 0); // æ‰“å¼€ä¼šè¯ // æ‰§è¡Œç”¨æˆ·å‘½ä»¤ pam_close_session(pamh, 0); // å…³é—­ä¼šè¯ pam_end(pamh, PAM_SUCCESS); // é‡Šæ”¾èµ„æº å¦‚ä¸‹æ˜¯ä¸€ä¸ªç”¨æˆ·ç™»å½•æµç¨‹çš„ PAM è°ƒç”¨ç¤ºä¾‹ï¼š c #include #include #include #include static void log_result(pam_handle_t *pamh, int ret, const char *step) { if (ret == PAM_SUCCESS) { printf(\"[âœ“] %s æˆåŠŸ\\n\", step); } else { fprintf(stderr, \"[âœ—] %s å¤±è´¥: %sï¼ˆè¿”å›ç  %dï¼‰\\n\", step, pam_strerror(pamh, ret), ret); } } int main(int argc, char *argv[]) { pam_handle_t *p","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:4:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#4è·Ÿè¸ªè°ƒç”¨è¡Œä¸º"},{"categories":["tech"],"content":" 3.1 PAM - å¯æ’æ‹”è®¤è¯æ¨¡å—PAMï¼ˆPluggable Authentication Modulesï¼‰ æ˜¯ Linux çš„ç»Ÿä¸€è®¤è¯æ¡†æ¶ï¼Œä¸ºç³»ç»Ÿä¸­çš„å„ç§ç¨‹åº ï¼ˆå¦‚ loginã€sudoã€sshdã€gdm ç­‰ï¼‰æä¾›æ ‡å‡†åŒ–çš„è®¤è¯æ¥å£ã€‚å€ŸåŠ© PAMï¼Œç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶çµæ´»æ§åˆ¶è®¤è¯ç­–ç•¥ï¼Œè€Œæ— éœ€ä¿®æ”¹åº”ç”¨ç¨‹åºæœ¬èº«ã€‚å®ƒæ”¯æŒå¤šç§è®¤è¯æ–¹å¼ï¼ˆå¯†ç ã€æŒ‡çº¹ã€æ™ºèƒ½å¡ã€åŒå› å­éªŒè¯ç­‰ï¼‰ï¼Œæ˜¯ç°ä»£ Linux å®‰å…¨ä½“ç³»çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ã€‚ 3.1.1 å·¥ä½œåŸç†ä¸é…ç½®ç»“æ„PAM é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œå°†è®¤è¯æµç¨‹åˆ†ä¸ºå››ä¸ªé˜¶æ®µã€‚åº”ç”¨ç¨‹åºé€šè¿‡è°ƒç”¨ç›¸åº”çš„ PAM æ¥å£è§¦å‘è¿™äº›é˜¶æ®µï¼Œ ç³»ç»Ÿæ ¹æ® /etc/pam.d/ ä¸‹çš„é…ç½®æ–‡ä»¶æ‰§è¡Œç›¸åº”çš„æ¨¡å—ï¼ˆ.so æ–‡ä»¶ï¼‰ã€‚ ï¼ˆ1ï¼‰é…ç½®æ–‡ä»¶è¯­æ³• https://linux.die.net/man/5/pam.d æ¯è¡Œçš„åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š text [arguments] typeï¼šè¡¨ç¤ºé˜¶æ®µç±»å‹ controlï¼šå®šä¹‰è¯¥æ¨¡å—çš„æ‰§è¡Œç­–ç•¥ moduleï¼šå…·ä½“çš„ PAM æ¨¡å—è·¯å¾„ï¼ˆæˆ–åç§°ï¼‰ argumentsï¼šä¼ é€’ç»™æ¨¡å—çš„å‚æ•° ï¼ˆ2ï¼‰å››ä¸ªè®¤è¯é˜¶æ®µ é˜¶æ®µç±»å‹ è°ƒç”¨å‡½æ•° ä¸»è¦ä½œç”¨ auth pam_authenticate() éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œé€šå¸¸ä¼šæç¤ºç”¨æˆ·è¾“å‡ºå¯†ç æˆ–æŒ‡çº¹ä»¥å®ŒæˆéªŒè¯ account pam_acct_mgmt() æ£€æŸ¥è´¦æˆ·çŠ¶æ€ï¼ˆè¿‡æœŸã€é”å®šç­‰ï¼‰ password pam_chauthtok() å¤„ç†å¯†ç ä¿®æ”¹ session pam_open_session() / pam_close_session() å»ºç«‹å’Œæ¸…ç†ç”¨æˆ·ä¼šè¯ ï¼ˆ3ï¼‰æ§åˆ¶æ ‡å¿—ï¼ˆcontrolï¼‰ æ ‡å¿— å«ä¹‰ è¡Œä¸ºè¯´æ˜ required å¿…é¡»æˆåŠŸï¼Œå¤±è´¥ä¸ä¼šç«‹å³ç»ˆæ­¢ï¼Œä½†æœ€ç»ˆç»“æœä¼šå¤±è´¥ æ— è®ºæˆåŠŸå¤±è´¥ï¼Œéƒ½ä¼šç»§ç»­æ‰§è¡Œåç»­æ¨¡å—ã€‚æœ€ç»ˆåªè¦æœ‰ä¸€ä¸ª required å¤±è´¥ï¼Œæ•´ä¸ªè®¤è¯å°±å¤±è´¥ã€‚ requisite å¿…é¡»æˆåŠŸï¼Œå¤±è´¥ç«‹å³ç»ˆæ­¢å¹¶è¿”å›å¤±è´¥ å¤±è´¥ç«‹å³è¿”å›ï¼Œä¸å†æ‰§è¡Œåç»­æ¨¡å—ã€‚ sufficient æˆåŠŸåˆ™ç«‹å³é€šè¿‡è®¤è¯ï¼ˆè·³è¿‡æ‰€æœ‰åç»­æ¨¡å—ï¼‰ï¼›å¤±è´¥åˆ™ç»§ç»­ç”±åç»­æ¨¡å—è¿›è¡Œè®¤è¯ è‹¥å‰é¢æ²¡æœ‰ required å¤±è´¥ï¼Œåˆ™æˆåŠŸç›´æ¥é€šè¿‡ï¼›å¦åˆ™å¤±è´¥ä¸å½±å“åç»­ã€‚ optional å¯é€‰æ¨¡å—ï¼Œç»“æœé€šå¸¸è¢«å¿½ç•¥ æ— è®ºæˆåŠŸå¤±è´¥ï¼Œå¯¹æœ€ç»ˆç»“æœæ— ç›´æ¥å½±å“ï¼Œé™¤éæ˜¯æ ˆä¸­å”¯ä¸€çš„æ¨¡å—ã€‚ include åŒ…å«å¦ä¸€ä¸ªæ–‡ä»¶çš„é…ç½® å°†æŒ‡å®šæ–‡ä»¶çš„é…ç½®å†…å®¹åŒ…å«è¿›æ¥ï¼Œé€šå¸¸ç”¨äºå¤ç”¨é€šç”¨é…ç½®ï¼ˆå¦‚ system-authï¼‰ã€‚ substack è°ƒç”¨å­æ ˆ ç±»ä¼¼ includeï¼Œä½†å­æ ˆçš„å¤±è´¥ä¸å½±å“ä¸»æ ˆï¼ˆå³å­æ ˆåªèƒ½è·³è¿‡å…¶è‡ªèº«çš„åç»­æ­¥éª¤ï¼‰ï¼Œé™¤éä¸»æ ˆä¸­å¦æœ‰è®¾ç½®ã€‚ ï¼ˆ4ï¼‰å¸¸ç”¨æ¨¡å—ç¤ºä¾‹ bash pam_unix.so # åŸºäº /etc/passwd ä¸ /etc/shadow çš„æ ‡å‡†å¯†ç è®¤è¯ pam_google_authenticator.so # åŒå› å­è®¤è¯ï¼ˆTOTPï¼‰ pam_fprintd.so # æŒ‡çº¹è®¤è¯ pam_ldap.so # LDAP é›†ä¸­å¼è®¤è¯ pam_gnome_keyring.so # GNOME å¯†é’¥ç¯é›†æˆ pam_limits.so # ç”¨æˆ·èµ„æºé™åˆ¶ pam_deny.so # æ‹’ç»æ‰€æœ‰è®¤è¯è¯·æ±‚ 3.1.2 æ‰§è¡Œæµç¨‹ç¤ºä¾‹ä»¥ /etc/pam.d/sudo ä¸ºä¾‹ï¼š bash #%PAM-1.0 auth sufficient pam_rootok.so auth sufficient pam_timestamp.so auth required pam_wheel.so use_uid auth required pam_unix.so nullok try_first_pass å„æ¨¡å—çš„æ‰§è¡Œé¡ºåºå¦‚ä¸‹ï¼š æ‰§è¡Œ pam_rootok.so (sufficient)ï¼š æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦ä¸º rootã€‚ å¦‚æœæˆåŠŸï¼šPAM è®¤è¯æµç¨‹ç«‹å³æˆåŠŸï¼Œå¹¶è·³è¿‡åç»­æ‰€æœ‰ auth æ¨¡å—ã€‚ç”¨æˆ·ç›´æ¥è·å¾— sudo æƒé™ã€‚ å¦‚æœå¤±è´¥ï¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªæ¨¡å—ã€‚ æ‰§è¡Œ pam_timestamp.so (sufficient)ï¼š æ£€æŸ¥æ˜¯å¦å­˜åœ¨æœ‰æ•ˆçš„æ—¶é—´æˆ³æ–‡ä»¶ï¼ˆé»˜è®¤ä¸º 5 åˆ†é’Ÿå†…ï¼‰ã€‚ å¦‚æœæˆåŠŸï¼šPAM è®¤è¯æµç¨‹ç«‹å³æˆåŠŸï¼Œå¹¶è·³è¿‡åç»­æ‰€æœ‰ auth æ¨¡å—ã€‚ç”¨æˆ·å…å¯†ç è·å¾— sudo æƒé™ã€‚ å¦‚æœå¤±è´¥ï¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªæ¨¡å—ã€‚ æ‰§è¡Œ pam_wheel.so (required)ï¼š æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦åœ¨ wheel ç»„ï¼ˆæˆ– sudo ç»„ï¼Œå–å†³äºé…ç½®ï¼‰ä¸­ã€‚ æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½å¿…é¡»ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ª required æ¨¡å—ã€‚ä½†å…¶ç»“æœä¼šè¢«è®°å½•ä¸‹æ¥ã€‚ æ‰§è¡Œ pam_unix.so (required)ï¼š ä½¿ç”¨ nullok å’Œ try_first_pass å‚æ•°è¿›è¡Œå¯†ç éªŒè¯ã€‚ nullokï¼šå…è®¸ç©ºå¯†ç è´¦æˆ·ç™»å½•ã€‚ try_first_passï¼šå°è¯•ä½¿ç”¨å‰é¢æ¨¡å—ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰æä¾›çš„å¯†ç ã€‚å¯¹äº sudoï¼Œè¿™é€šå¸¸æŒ‡ä¹‹å‰ sudo æˆåŠŸæ—¶ç¼“å­˜çš„å¯†ç ã€‚ å¦‚æœå¯†ç æ­£ç¡®ï¼šæ­¤æ¨¡å—æˆåŠŸã€‚ å¦‚æœå¯†ç é”™è¯¯ï¼šæ­¤æ¨¡å—å¤±è´¥ã€‚ æœ€ç»ˆç»“æœåˆ¤å®šï¼š åœ¨æ‰€æœ‰ required æ¨¡å—æ‰§è¡Œå®Œæ¯•åï¼ŒPAM ä¼šæ£€æŸ¥å®ƒä»¬çš„ç»“æœã€‚ å¦‚æœä»»ä½•ä¸€ä¸ª required æ¨¡å—ï¼ˆpam_wheel.so æˆ– pam_unix.soï¼‰å¤±è´¥ï¼Œæ•´ä¸ªè®¤è¯æµç¨‹å¤±è´¥ã€‚ åªæœ‰å½“æ‰€æœ‰ required æ¨¡å—éƒ½æˆåŠŸæ—¶ï¼Œè®¤è¯æ‰æœ€ç»ˆæˆåŠŸã€‚ å¸¸ç”¨æ¨¡å—åŠå…¶å‚æ•°è¯´æ˜ï¼š pam_unix.so å‚æ•° (ç”¨äºå¯†ç éªŒè¯) è¿™æ˜¯æœ€æ ¸å¿ƒçš„å¯†ç è®¤è¯æ¨¡å—ï¼Œå¸¸è§äº auth å’Œ password ç±»å‹ã€‚ nullokï¼šå…è®¸ç©ºå¯†ç è´¦æˆ·é€šè¿‡è®¤è¯ã€‚å¦‚æœä¸åŠ æ­¤å‚æ•°ï¼Œç©ºå¯†ç è´¦æˆ·å°†æ— æ³•ç™»å½•ã€‚ try_first_passï¼šåœ¨æç¤ºç”¨æˆ·è¾“å…¥å¯†ç å‰ï¼Œå…ˆå°è¯•ä½¿ç”¨ä¹‹å‰æ ˆä¸­å·²ç¼“å­˜çš„å¯†ç ï¼ˆä¾‹å¦‚ï¼Œç”±pam_timestamp.so æˆ– pam_kwallet.so æä¾›çš„ï¼‰ã€‚ use_authtokï¼šå¼ºåˆ¶ä½¿ç”¨ä¹‹å‰æ ˆä¸­å·²ç¼“å­˜çš„å¯†ç ï¼Œå¦‚æœä¸å­˜åœ¨ç¼“å­˜å¯†ç ï¼Œåˆ™ç›´æ¥å¤±è´¥ã€‚å®ƒæ¯”try_first_pass æ›´ä¸¥æ ¼ï¼Œé€šå¸¸ç”¨åœ¨ä¿®æ”¹å¯†ç çš„ password æ¨¡å—æ ˆä¸­ï¼Œä»¥ç¡®ä¿ç”¨æˆ·è¾“å…¥çš„æ˜¯æ—§å¯†ç ã€‚ shadowï¼šä½¿ç”¨ /etc/shadow æ–‡ä»¶è¿›è¡Œå¯†ç éªŒè¯ï¼ˆç°ä»£ç³»ç»Ÿé»˜è®¤å¯ç”¨ï¼‰ã€‚ pam_timestamp.so å‚æ•° (ç”¨äºæ—¶é—´æˆ³è®¤è¯) å¸¸ç”¨äº sudoï¼Œå®ç°å…å¯†ç æ“ä½œã€‚ timestamp_timeout=600ï¼šè®¾ç½®æ—¶é—´æˆ³çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’ã€‚é»˜è®¤æ˜¯ 300 (5åˆ†é’Ÿ)ã€‚ pam_wheel.so å‚æ•° (ç”¨äºç»„æˆå‘˜èµ„æ ¼æ£€æŸ¥) ç”¨äºé™åˆ¶åªæœ‰ç‰¹å®šç»„çš„ç”¨æˆ·æ‰èƒ½ä½¿ç”¨ su æˆ– sudoã€‚ use_uidï¼šæ£€æŸ¥å‘èµ·è¯·æ±‚çš„åŸå§‹ç”¨æˆ· IDï¼Œè€Œä¸æ˜¯å½“å‰ç”¨æˆ· IDï¼ˆåœ¨ sudo åœºæ™¯ä¸‹å¾ˆé‡è¦ï¼‰ã€‚ group=adminsï¼šæŒ‡å®šæ£€æŸ¥çš„ç»„åï¼Œé»˜è®¤æ˜¯ wheelã€‚ pam_gnome_keyring.so å‚æ•° (ç”¨äºä¼šè¯ç®¡ç†) è¿™ä¸ªæ¨¡å—ä¸ sudo çš„è®¤è¯æµç¨‹æ— å…³ï¼Œä¸»è¦ç”¨äºç”¨æˆ·ç™»å½•æ—¶è§£é”å¯†é’¥ç¯ã€‚ auto_startï¼šåœ¨ä¼šè¯å¯åŠ¨æ—¶ï¼Œå¦‚æœç”¨æˆ·å¯†ç ä¸å¯†é’¥ç¯å¯†ç ç›¸åŒï¼Œåˆ™è‡ªåŠ¨è§£é”å¯†é’¥ç¯ã€‚ å…¸å‹åº”ç”¨åœºæ™¯ï¼šåœ¨ /etc/pam.d/gdm-password æˆ– /etc/pam.d/login çš„ auth å’Œsession éƒ¨åˆ†ã€‚ bash # åœ¨ /etc/pam.d/gdm-password ä¸­ auth optional pam_gnome_keyring.so session optional pam_gnome_keyring.so auto_start 3.1.3 åº”ç”¨ç¨‹åºä¸ PAM çš„äº¤äº’ç¨‹åºé€šè¿‡ pam_start() æŒ‡å®šæœåŠ¡åï¼Œç³»ç»Ÿæ®æ­¤åŠ è½½å¯¹åº”çš„é…ç½®æ–‡ä»¶ã€‚ ç¨‹åº æœåŠ¡å é…ç½®æ–‡ä»¶ åŠŸèƒ½ login \"login\" /etc/pam.d/login æ§åˆ¶å°ç™»å½• gdm \"gdm\" /etc/pam.d/gdm GNOME ç™»å½•ç•Œé¢ sudo \"sudo\" /etc/pam.d/sudo ææƒå‘½ä»¤ sshd \"sshd\" /etc/pam.d/sshd SSH ç™»å½• greetd \"greetd\" /etc/pam.d/greetd è½»é‡æ˜¾ç¤ºç®¡ç†å™¨ ä¸€ä¸ªå…¸å‹çš„è°ƒç”¨é¡ºåºå¦‚ä¸‹ï¼ˆä»¥ sudo ä¸ºä¾‹ï¼‰ï¼š c pam_start(\"sudo\", user, \u0026conv, \u0026pamh); // åˆå§‹åŒ– PAM pam_authenticate(pamh, 0); // èº«ä»½éªŒè¯ pam_acct_mgmt(pamh, 0); // è´¦æˆ·æ£€æŸ¥ pam_open_session(pamh, 0); // æ‰“å¼€ä¼šè¯ // æ‰§è¡Œç”¨æˆ·å‘½ä»¤ pam_close_session(pamh, 0); // å…³é—­ä¼šè¯ pam_end(pamh, PAM_SUCCESS); // é‡Šæ”¾èµ„æº å¦‚ä¸‹æ˜¯ä¸€ä¸ªç”¨æˆ·ç™»å½•æµç¨‹çš„ PAM è°ƒç”¨ç¤ºä¾‹ï¼š c #include #include #include #include static void log_result(pam_handle_t *pamh, int ret, const char *step) { if (ret == PAM_SUCCESS) { printf(\"[âœ“] %s æˆåŠŸ\\n\", step); } else { fprintf(stderr, \"[âœ—] %s å¤±è´¥: %sï¼ˆè¿”å›ç  %dï¼‰\\n\", step, pam_strerror(pamh, ret), ret); } } int main(int argc, char *argv[]) { pam_handle_t *p","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:4:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#5å¸¸è§é—®é¢˜"},{"categories":["tech"],"content":" 3.2 PolicyKit - ç»†ç²’åº¦çš„ç³»ç»Ÿæƒé™ç®¡ç†PolicyKitï¼ˆç°ç§° polkitï¼‰æ˜¯ä¸€ä¸ªç”¨äºæ§åˆ¶ç³»ç»Ÿçº§æƒé™çš„æ¡†æ¶ï¼Œå®ƒæä¾›äº†ä¸€ç§æ¯”ä¼ ç»Ÿ Unix æƒé™æ›´ç»†ç²’åº¦çš„æˆæƒæœºåˆ¶ã€‚åœ¨ç°ä»£ Linux æ¡Œé¢ç³»ç»Ÿä¸­ï¼ŒPolicyKit å…è®¸éç‰¹æƒç”¨æˆ·æ‰§è¡ŒæŸäº›éœ€è¦ç‰¹æƒçš„ç³»ç»Ÿæ“ä½œ ï¼ˆå¦‚å…³æœºã€é‡å¯ã€æŒ‚è½½è®¾å¤‡ã€ä¿®æ”¹ç³»ç»Ÿæ—¶é—´ç­‰ï¼‰ï¼Œè€Œæ— éœ€è·å–å®Œæ•´çš„ root æƒé™ã€‚ 3.2.1 PolicyKit çš„æ ¸å¿ƒæ¦‚å¿µé…ç½®æ–‡ä»¶è·¯å¾„ï¼š /etc/polkit-1/ï¼šNixOS å£°æ˜å¼é…ç½®ä¸­å®šä¹‰çš„è‡ªå®šä¹‰è§„åˆ™ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰ /run/current-system/sw/share/polkit-1/ï¼ˆNixOSï¼‰æˆ– /usr/share/polkit-1/ï¼ˆä¼ ç»Ÿå‘è¡Œç‰ˆï¼‰ï¼šè½¯ä»¶åŒ…æä¾›çš„é»˜è®¤è§„åˆ™ ä¸Šè¿°æ–‡ä»¶å¤¹ä¸­åˆåŒ…å«ä¸¤ç±»é…ç½®ï¼š åŠ¨ä½œï¼ˆActionsï¼‰ å®šä¹‰åœ¨é…ç½®æ–‡ä»¶å¤¹çš„ actions ç›®å½•ä¸­çš„ XML æ–‡ä»¶ï¼ˆå¦‚ /etc/polkit-1/actions/ï¼‰ï¼Œæè¿°å¯æˆæƒçš„æ“ä½œã€‚æ¯ä¸ªåŠ¨ä½œéƒ½æœ‰å”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œå¦‚ org.freedesktop.login1.power-off è¡¨ç¤ºå…³æœºæ“ä½œã€‚ è§„åˆ™ï¼ˆRulesï¼‰ JavaScript æ–‡ä»¶ï¼Œå®šä¹‰æˆæƒå†³ç­–é€»è¾‘ï¼Œä½äºä¸Šè¿°é…ç½®æ–‡ä»¶å¤¹çš„ rules.d/ ç›®å½•ä¸­ï¼ˆå¦‚/etc/polkit-1/rules.d/ï¼‰ã€‚è§„åˆ™å†³å®šäº†åœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ˜¯å¦æˆæƒæŸä¸ªæ“ä½œã€‚åœ¨ NixOS ä¸­ï¼Œæ¨èä½¿ç”¨å£°æ˜å¼é…ç½®è€Œéç›´æ¥ä¿®æ”¹ /etc ç›®å½•ã€‚ èº«ä»½è®¤è¯ä»£ç†ï¼ˆAuthentication Agentsï¼‰ï¼šæ¡Œé¢ç¯å¢ƒæä¾›çš„å›¾å½¢ç•Œé¢ç»„ä»¶ï¼Œç”¨äºåœ¨ç”¨æˆ·éœ€è¦èº«ä»½éªŒè¯æ—¶å¼¹å‡ºè®¤è¯å¯¹è¯æ¡†ã€‚ä¾‹å¦‚ï¼Œå½“æ™®é€šç”¨æˆ·å°è¯•å…³æœºæ—¶ï¼Œè®¤è¯ä»£ç†ä¼šæç¤ºè¾“å…¥ç®¡ç†å‘˜å¯†ç ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ Niri çª—å£ç®¡ç†å™¨ï¼Œå®ƒçš„ Nix Flake å¯ç”¨äº† pokit-kde-agent-1 ä½œä¸ºå…¶ Authentication Agent, é…ç½®å‚è§sodiboo/niri-flake. 3.2.2 PolicyKit çš„å·¥ä½œåŸç†å½“åº”ç”¨ç¨‹åºè¯·æ±‚æ‰§è¡Œéœ€è¦ç‰¹æƒçš„æ“ä½œæ—¶ï¼Œç³»ç»ŸæœåŠ¡ä¼šè¯¢é—® PolicyKit æ˜¯å¦æˆæƒã€‚PolicyKit çš„è¯„ä¼°è¿‡ç¨‹å¦‚ä¸‹ï¼š èº«ä»½è¯†åˆ«ï¼šç¡®å®šè¯·æ±‚è€…çš„èº«ä»½ï¼ˆç”¨æˆ·ã€ç»„ã€ä¼šè¯ç­‰ï¼‰ è§„åˆ™åŒ¹é…ï¼šæ£€æŸ¥æ˜¯å¦æœ‰é€‚ç”¨çš„è§„åˆ™æ–‡ä»¶ æƒé™è¯„ä¼°ï¼šæ ¹æ®è§„åˆ™è¿”å›ä»¥ä¸‹ç»“æœä¹‹ä¸€ï¼š yesï¼šç›´æ¥å…è®¸ï¼Œæ— éœ€è®¤è¯ noï¼šç›´æ¥æ‹’ç» auth_selfï¼šéœ€è¦ç”¨æˆ·è‡ªå·±è®¤è¯ï¼ˆè¾“å…¥å½“å‰ç”¨æˆ·å¯†ç ï¼‰ auth_adminï¼šéœ€è¦ç®¡ç†å‘˜è®¤è¯ï¼ˆè¾“å…¥ root å¯†ç ï¼‰ auth_self_keep/auth_admin_keepï¼šè®¤è¯ååœ¨ä¸€æ®µæ—¶é—´å†…ä¿æŒæˆæƒ 3.2.3 PolicyKit çš„é…ç½®ç¤ºä¾‹åœ¨ä¼ ç»Ÿçš„ Linux å‘è¡Œç‰ˆä¸­ï¼Œç®¡ç†å‘˜å¯ä»¥é€šè¿‡åˆ›å»ºè‡ªå®šä¹‰è§„åˆ™æ¥ä¿®æ”¹é»˜è®¤è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œå…è®¸ wheel ç»„çš„ç”¨æˆ·æ— éœ€å¯†ç å³å¯å…³æœºï¼š javascript // /etc/polkit-1/rules.d/10-shutdown.rules polkit.addRule(function (action, subject) { if (action.id == \"org.freedesktop.login1.power-off\" \u0026\u0026 subject.isInGroup(\"wheel\")) { return polkit.Result.YES } }) NixOS ä¸­çš„é…ç½®æ–¹æ³•ï¼šåœ¨ NixOS ä¸­ï¼Œæ¨èä½¿ç”¨å£°æ˜å¼é…ç½®è€Œéç›´æ¥ä¿®æ”¹ /etc ç›®å½•ã€‚å¯ä»¥é€šè¿‡security.polkit é…ç½®é¡¹æ¥ç®¡ç† PolicyKit è§„åˆ™ï¼š nix # configuration.nix { security.polkit.enable = true; # æ·»åŠ è‡ªå®šä¹‰è§„åˆ™ security.polkit.extraConfig = '' polkit.addRule(function(action, subject) { if (action.id == \"org.freedesktop.login1.power-off\" \u0026\u0026 subject.isInGroup(\"wheel\")) { return polkit.Result.YES; } }); ''; } 3.2.4 PolicyKit ä¸ D-Bus çš„é›†æˆPolicyKit ä¸ D-Bus æ·±åº¦é›†æˆï¼Œä¸º D-Bus æœåŠ¡æä¾›åŠ¨æ€æˆæƒæœºåˆ¶ã€‚è®¸å¤šç³»ç»ŸæœåŠ¡ï¼ˆå¦‚ systemdã€NetworkManagerã€udisks ç­‰ï¼‰éƒ½ä½¿ç”¨ PolicyKit æ¥æ§åˆ¶å¯¹å…¶ D-Bus æ¥å£çš„è®¿é—®ã€‚å½“å®¢æˆ·ç«¯é€šè¿‡ D-Bus è°ƒç”¨éœ€è¦ç‰¹æƒçš„æ–¹æ³•æ—¶ï¼ŒæœåŠ¡ä¼šè°ƒç”¨ PolicyKit è¿›è¡Œæˆæƒæ£€æŸ¥ã€‚ PolicyKit è°ƒè¯•ä¸»è¦æ¶‰åŠæœåŠ¡çŠ¶æ€æ£€æŸ¥ã€æƒé™æµ‹è¯•å’Œè§„åˆ™éªŒè¯ã€‚å¸¸ç”¨çš„è°ƒè¯•æ–¹æ³•åŒ…æ‹¬ï¼š æœåŠ¡çŠ¶æ€æ£€æŸ¥ï¼šéªŒè¯ PolicyKit å®ˆæŠ¤è¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€ æƒé™æµ‹è¯•ï¼šä½¿ç”¨ pkcheck å·¥å…·æµ‹è¯•ç‰¹å®šæ“ä½œçš„æˆæƒæƒ…å†µ æ—¥å¿—åˆ†æï¼šæŸ¥çœ‹ PolicyKit çš„æˆæƒå†³ç­–æ—¥å¿— è§„åˆ™éªŒè¯ï¼šæ£€æŸ¥å½“å‰ç”Ÿæ•ˆçš„ PolicyKit è§„åˆ™é…ç½® å…·ä½“çš„è°ƒè¯•å‘½ä»¤è¯·å‚è€ƒ 3.5.3 æ•…éšœæ’æŸ¥ ç« èŠ‚ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:4:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#32-policykit---ç»†ç²’åº¦çš„ç³»ç»Ÿæƒé™ç®¡ç†"},{"categories":["tech"],"content":" 3.2 PolicyKit - ç»†ç²’åº¦çš„ç³»ç»Ÿæƒé™ç®¡ç†PolicyKitï¼ˆç°ç§° polkitï¼‰æ˜¯ä¸€ä¸ªç”¨äºæ§åˆ¶ç³»ç»Ÿçº§æƒé™çš„æ¡†æ¶ï¼Œå®ƒæä¾›äº†ä¸€ç§æ¯”ä¼ ç»Ÿ Unix æƒé™æ›´ç»†ç²’åº¦çš„æˆæƒæœºåˆ¶ã€‚åœ¨ç°ä»£ Linux æ¡Œé¢ç³»ç»Ÿä¸­ï¼ŒPolicyKit å…è®¸éç‰¹æƒç”¨æˆ·æ‰§è¡ŒæŸäº›éœ€è¦ç‰¹æƒçš„ç³»ç»Ÿæ“ä½œ ï¼ˆå¦‚å…³æœºã€é‡å¯ã€æŒ‚è½½è®¾å¤‡ã€ä¿®æ”¹ç³»ç»Ÿæ—¶é—´ç­‰ï¼‰ï¼Œè€Œæ— éœ€è·å–å®Œæ•´çš„ root æƒé™ã€‚ 3.2.1 PolicyKit çš„æ ¸å¿ƒæ¦‚å¿µé…ç½®æ–‡ä»¶è·¯å¾„ï¼š /etc/polkit-1/ï¼šNixOS å£°æ˜å¼é…ç½®ä¸­å®šä¹‰çš„è‡ªå®šä¹‰è§„åˆ™ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰ /run/current-system/sw/share/polkit-1/ï¼ˆNixOSï¼‰æˆ– /usr/share/polkit-1/ï¼ˆä¼ ç»Ÿå‘è¡Œç‰ˆï¼‰ï¼šè½¯ä»¶åŒ…æä¾›çš„é»˜è®¤è§„åˆ™ ä¸Šè¿°æ–‡ä»¶å¤¹ä¸­åˆåŒ…å«ä¸¤ç±»é…ç½®ï¼š åŠ¨ä½œï¼ˆActionsï¼‰ å®šä¹‰åœ¨é…ç½®æ–‡ä»¶å¤¹çš„ actions ç›®å½•ä¸­çš„ XML æ–‡ä»¶ï¼ˆå¦‚ /etc/polkit-1/actions/ï¼‰ï¼Œæè¿°å¯æˆæƒçš„æ“ä½œã€‚æ¯ä¸ªåŠ¨ä½œéƒ½æœ‰å”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œå¦‚ org.freedesktop.login1.power-off è¡¨ç¤ºå…³æœºæ“ä½œã€‚ è§„åˆ™ï¼ˆRulesï¼‰ JavaScript æ–‡ä»¶ï¼Œå®šä¹‰æˆæƒå†³ç­–é€»è¾‘ï¼Œä½äºä¸Šè¿°é…ç½®æ–‡ä»¶å¤¹çš„ rules.d/ ç›®å½•ä¸­ï¼ˆå¦‚/etc/polkit-1/rules.d/ï¼‰ã€‚è§„åˆ™å†³å®šäº†åœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ˜¯å¦æˆæƒæŸä¸ªæ“ä½œã€‚åœ¨ NixOS ä¸­ï¼Œæ¨èä½¿ç”¨å£°æ˜å¼é…ç½®è€Œéç›´æ¥ä¿®æ”¹ /etc ç›®å½•ã€‚ èº«ä»½è®¤è¯ä»£ç†ï¼ˆAuthentication Agentsï¼‰ï¼šæ¡Œé¢ç¯å¢ƒæä¾›çš„å›¾å½¢ç•Œé¢ç»„ä»¶ï¼Œç”¨äºåœ¨ç”¨æˆ·éœ€è¦èº«ä»½éªŒè¯æ—¶å¼¹å‡ºè®¤è¯å¯¹è¯æ¡†ã€‚ä¾‹å¦‚ï¼Œå½“æ™®é€šç”¨æˆ·å°è¯•å…³æœºæ—¶ï¼Œè®¤è¯ä»£ç†ä¼šæç¤ºè¾“å…¥ç®¡ç†å‘˜å¯†ç ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ Niri çª—å£ç®¡ç†å™¨ï¼Œå®ƒçš„ Nix Flake å¯ç”¨äº† pokit-kde-agent-1 ä½œä¸ºå…¶ Authentication Agent, é…ç½®å‚è§sodiboo/niri-flake. 3.2.2 PolicyKit çš„å·¥ä½œåŸç†å½“åº”ç”¨ç¨‹åºè¯·æ±‚æ‰§è¡Œéœ€è¦ç‰¹æƒçš„æ“ä½œæ—¶ï¼Œç³»ç»ŸæœåŠ¡ä¼šè¯¢é—® PolicyKit æ˜¯å¦æˆæƒã€‚PolicyKit çš„è¯„ä¼°è¿‡ç¨‹å¦‚ä¸‹ï¼š èº«ä»½è¯†åˆ«ï¼šç¡®å®šè¯·æ±‚è€…çš„èº«ä»½ï¼ˆç”¨æˆ·ã€ç»„ã€ä¼šè¯ç­‰ï¼‰ è§„åˆ™åŒ¹é…ï¼šæ£€æŸ¥æ˜¯å¦æœ‰é€‚ç”¨çš„è§„åˆ™æ–‡ä»¶ æƒé™è¯„ä¼°ï¼šæ ¹æ®è§„åˆ™è¿”å›ä»¥ä¸‹ç»“æœä¹‹ä¸€ï¼š yesï¼šç›´æ¥å…è®¸ï¼Œæ— éœ€è®¤è¯ noï¼šç›´æ¥æ‹’ç» auth_selfï¼šéœ€è¦ç”¨æˆ·è‡ªå·±è®¤è¯ï¼ˆè¾“å…¥å½“å‰ç”¨æˆ·å¯†ç ï¼‰ auth_adminï¼šéœ€è¦ç®¡ç†å‘˜è®¤è¯ï¼ˆè¾“å…¥ root å¯†ç ï¼‰ auth_self_keep/auth_admin_keepï¼šè®¤è¯ååœ¨ä¸€æ®µæ—¶é—´å†…ä¿æŒæˆæƒ 3.2.3 PolicyKit çš„é…ç½®ç¤ºä¾‹åœ¨ä¼ ç»Ÿçš„ Linux å‘è¡Œç‰ˆä¸­ï¼Œç®¡ç†å‘˜å¯ä»¥é€šè¿‡åˆ›å»ºè‡ªå®šä¹‰è§„åˆ™æ¥ä¿®æ”¹é»˜è®¤è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œå…è®¸ wheel ç»„çš„ç”¨æˆ·æ— éœ€å¯†ç å³å¯å…³æœºï¼š javascript // /etc/polkit-1/rules.d/10-shutdown.rules polkit.addRule(function (action, subject) { if (action.id == \"org.freedesktop.login1.power-off\" \u0026\u0026 subject.isInGroup(\"wheel\")) { return polkit.Result.YES } }) NixOS ä¸­çš„é…ç½®æ–¹æ³•ï¼šåœ¨ NixOS ä¸­ï¼Œæ¨èä½¿ç”¨å£°æ˜å¼é…ç½®è€Œéç›´æ¥ä¿®æ”¹ /etc ç›®å½•ã€‚å¯ä»¥é€šè¿‡security.polkit é…ç½®é¡¹æ¥ç®¡ç† PolicyKit è§„åˆ™ï¼š nix # configuration.nix { security.polkit.enable = true; # æ·»åŠ è‡ªå®šä¹‰è§„åˆ™ security.polkit.extraConfig = '' polkit.addRule(function(action, subject) { if (action.id == \"org.freedesktop.login1.power-off\" \u0026\u0026 subject.isInGroup(\"wheel\")) { return polkit.Result.YES; } }); ''; } 3.2.4 PolicyKit ä¸ D-Bus çš„é›†æˆPolicyKit ä¸ D-Bus æ·±åº¦é›†æˆï¼Œä¸º D-Bus æœåŠ¡æä¾›åŠ¨æ€æˆæƒæœºåˆ¶ã€‚è®¸å¤šç³»ç»ŸæœåŠ¡ï¼ˆå¦‚ systemdã€NetworkManagerã€udisks ç­‰ï¼‰éƒ½ä½¿ç”¨ PolicyKit æ¥æ§åˆ¶å¯¹å…¶ D-Bus æ¥å£çš„è®¿é—®ã€‚å½“å®¢æˆ·ç«¯é€šè¿‡ D-Bus è°ƒç”¨éœ€è¦ç‰¹æƒçš„æ–¹æ³•æ—¶ï¼ŒæœåŠ¡ä¼šè°ƒç”¨ PolicyKit è¿›è¡Œæˆæƒæ£€æŸ¥ã€‚ PolicyKit è°ƒè¯•ä¸»è¦æ¶‰åŠæœåŠ¡çŠ¶æ€æ£€æŸ¥ã€æƒé™æµ‹è¯•å’Œè§„åˆ™éªŒè¯ã€‚å¸¸ç”¨çš„è°ƒè¯•æ–¹æ³•åŒ…æ‹¬ï¼š æœåŠ¡çŠ¶æ€æ£€æŸ¥ï¼šéªŒè¯ PolicyKit å®ˆæŠ¤è¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€ æƒé™æµ‹è¯•ï¼šä½¿ç”¨ pkcheck å·¥å…·æµ‹è¯•ç‰¹å®šæ“ä½œçš„æˆæƒæƒ…å†µ æ—¥å¿—åˆ†æï¼šæŸ¥çœ‹ PolicyKit çš„æˆæƒå†³ç­–æ—¥å¿— è§„åˆ™éªŒè¯ï¼šæ£€æŸ¥å½“å‰ç”Ÿæ•ˆçš„ PolicyKit è§„åˆ™é…ç½® å…·ä½“çš„è°ƒè¯•å‘½ä»¤è¯·å‚è€ƒ 3.5.3 æ•…éšœæ’æŸ¥ ç« èŠ‚ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:4:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#321-policykit-çš„æ ¸å¿ƒæ¦‚å¿µ"},{"categories":["tech"],"content":" 3.2 PolicyKit - ç»†ç²’åº¦çš„ç³»ç»Ÿæƒé™ç®¡ç†PolicyKitï¼ˆç°ç§° polkitï¼‰æ˜¯ä¸€ä¸ªç”¨äºæ§åˆ¶ç³»ç»Ÿçº§æƒé™çš„æ¡†æ¶ï¼Œå®ƒæä¾›äº†ä¸€ç§æ¯”ä¼ ç»Ÿ Unix æƒé™æ›´ç»†ç²’åº¦çš„æˆæƒæœºåˆ¶ã€‚åœ¨ç°ä»£ Linux æ¡Œé¢ç³»ç»Ÿä¸­ï¼ŒPolicyKit å…è®¸éç‰¹æƒç”¨æˆ·æ‰§è¡ŒæŸäº›éœ€è¦ç‰¹æƒçš„ç³»ç»Ÿæ“ä½œ ï¼ˆå¦‚å…³æœºã€é‡å¯ã€æŒ‚è½½è®¾å¤‡ã€ä¿®æ”¹ç³»ç»Ÿæ—¶é—´ç­‰ï¼‰ï¼Œè€Œæ— éœ€è·å–å®Œæ•´çš„ root æƒé™ã€‚ 3.2.1 PolicyKit çš„æ ¸å¿ƒæ¦‚å¿µé…ç½®æ–‡ä»¶è·¯å¾„ï¼š /etc/polkit-1/ï¼šNixOS å£°æ˜å¼é…ç½®ä¸­å®šä¹‰çš„è‡ªå®šä¹‰è§„åˆ™ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰ /run/current-system/sw/share/polkit-1/ï¼ˆNixOSï¼‰æˆ– /usr/share/polkit-1/ï¼ˆä¼ ç»Ÿå‘è¡Œç‰ˆï¼‰ï¼šè½¯ä»¶åŒ…æä¾›çš„é»˜è®¤è§„åˆ™ ä¸Šè¿°æ–‡ä»¶å¤¹ä¸­åˆåŒ…å«ä¸¤ç±»é…ç½®ï¼š åŠ¨ä½œï¼ˆActionsï¼‰ å®šä¹‰åœ¨é…ç½®æ–‡ä»¶å¤¹çš„ actions ç›®å½•ä¸­çš„ XML æ–‡ä»¶ï¼ˆå¦‚ /etc/polkit-1/actions/ï¼‰ï¼Œæè¿°å¯æˆæƒçš„æ“ä½œã€‚æ¯ä¸ªåŠ¨ä½œéƒ½æœ‰å”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œå¦‚ org.freedesktop.login1.power-off è¡¨ç¤ºå…³æœºæ“ä½œã€‚ è§„åˆ™ï¼ˆRulesï¼‰ JavaScript æ–‡ä»¶ï¼Œå®šä¹‰æˆæƒå†³ç­–é€»è¾‘ï¼Œä½äºä¸Šè¿°é…ç½®æ–‡ä»¶å¤¹çš„ rules.d/ ç›®å½•ä¸­ï¼ˆå¦‚/etc/polkit-1/rules.d/ï¼‰ã€‚è§„åˆ™å†³å®šäº†åœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ˜¯å¦æˆæƒæŸä¸ªæ“ä½œã€‚åœ¨ NixOS ä¸­ï¼Œæ¨èä½¿ç”¨å£°æ˜å¼é…ç½®è€Œéç›´æ¥ä¿®æ”¹ /etc ç›®å½•ã€‚ èº«ä»½è®¤è¯ä»£ç†ï¼ˆAuthentication Agentsï¼‰ï¼šæ¡Œé¢ç¯å¢ƒæä¾›çš„å›¾å½¢ç•Œé¢ç»„ä»¶ï¼Œç”¨äºåœ¨ç”¨æˆ·éœ€è¦èº«ä»½éªŒè¯æ—¶å¼¹å‡ºè®¤è¯å¯¹è¯æ¡†ã€‚ä¾‹å¦‚ï¼Œå½“æ™®é€šç”¨æˆ·å°è¯•å…³æœºæ—¶ï¼Œè®¤è¯ä»£ç†ä¼šæç¤ºè¾“å…¥ç®¡ç†å‘˜å¯†ç ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ Niri çª—å£ç®¡ç†å™¨ï¼Œå®ƒçš„ Nix Flake å¯ç”¨äº† pokit-kde-agent-1 ä½œä¸ºå…¶ Authentication Agent, é…ç½®å‚è§sodiboo/niri-flake. 3.2.2 PolicyKit çš„å·¥ä½œåŸç†å½“åº”ç”¨ç¨‹åºè¯·æ±‚æ‰§è¡Œéœ€è¦ç‰¹æƒçš„æ“ä½œæ—¶ï¼Œç³»ç»ŸæœåŠ¡ä¼šè¯¢é—® PolicyKit æ˜¯å¦æˆæƒã€‚PolicyKit çš„è¯„ä¼°è¿‡ç¨‹å¦‚ä¸‹ï¼š èº«ä»½è¯†åˆ«ï¼šç¡®å®šè¯·æ±‚è€…çš„èº«ä»½ï¼ˆç”¨æˆ·ã€ç»„ã€ä¼šè¯ç­‰ï¼‰ è§„åˆ™åŒ¹é…ï¼šæ£€æŸ¥æ˜¯å¦æœ‰é€‚ç”¨çš„è§„åˆ™æ–‡ä»¶ æƒé™è¯„ä¼°ï¼šæ ¹æ®è§„åˆ™è¿”å›ä»¥ä¸‹ç»“æœä¹‹ä¸€ï¼š yesï¼šç›´æ¥å…è®¸ï¼Œæ— éœ€è®¤è¯ noï¼šç›´æ¥æ‹’ç» auth_selfï¼šéœ€è¦ç”¨æˆ·è‡ªå·±è®¤è¯ï¼ˆè¾“å…¥å½“å‰ç”¨æˆ·å¯†ç ï¼‰ auth_adminï¼šéœ€è¦ç®¡ç†å‘˜è®¤è¯ï¼ˆè¾“å…¥ root å¯†ç ï¼‰ auth_self_keep/auth_admin_keepï¼šè®¤è¯ååœ¨ä¸€æ®µæ—¶é—´å†…ä¿æŒæˆæƒ 3.2.3 PolicyKit çš„é…ç½®ç¤ºä¾‹åœ¨ä¼ ç»Ÿçš„ Linux å‘è¡Œç‰ˆä¸­ï¼Œç®¡ç†å‘˜å¯ä»¥é€šè¿‡åˆ›å»ºè‡ªå®šä¹‰è§„åˆ™æ¥ä¿®æ”¹é»˜è®¤è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œå…è®¸ wheel ç»„çš„ç”¨æˆ·æ— éœ€å¯†ç å³å¯å…³æœºï¼š javascript // /etc/polkit-1/rules.d/10-shutdown.rules polkit.addRule(function (action, subject) { if (action.id == \"org.freedesktop.login1.power-off\" \u0026\u0026 subject.isInGroup(\"wheel\")) { return polkit.Result.YES } }) NixOS ä¸­çš„é…ç½®æ–¹æ³•ï¼šåœ¨ NixOS ä¸­ï¼Œæ¨èä½¿ç”¨å£°æ˜å¼é…ç½®è€Œéç›´æ¥ä¿®æ”¹ /etc ç›®å½•ã€‚å¯ä»¥é€šè¿‡security.polkit é…ç½®é¡¹æ¥ç®¡ç† PolicyKit è§„åˆ™ï¼š nix # configuration.nix { security.polkit.enable = true; # æ·»åŠ è‡ªå®šä¹‰è§„åˆ™ security.polkit.extraConfig = '' polkit.addRule(function(action, subject) { if (action.id == \"org.freedesktop.login1.power-off\" \u0026\u0026 subject.isInGroup(\"wheel\")) { return polkit.Result.YES; } }); ''; } 3.2.4 PolicyKit ä¸ D-Bus çš„é›†æˆPolicyKit ä¸ D-Bus æ·±åº¦é›†æˆï¼Œä¸º D-Bus æœåŠ¡æä¾›åŠ¨æ€æˆæƒæœºåˆ¶ã€‚è®¸å¤šç³»ç»ŸæœåŠ¡ï¼ˆå¦‚ systemdã€NetworkManagerã€udisks ç­‰ï¼‰éƒ½ä½¿ç”¨ PolicyKit æ¥æ§åˆ¶å¯¹å…¶ D-Bus æ¥å£çš„è®¿é—®ã€‚å½“å®¢æˆ·ç«¯é€šè¿‡ D-Bus è°ƒç”¨éœ€è¦ç‰¹æƒçš„æ–¹æ³•æ—¶ï¼ŒæœåŠ¡ä¼šè°ƒç”¨ PolicyKit è¿›è¡Œæˆæƒæ£€æŸ¥ã€‚ PolicyKit è°ƒè¯•ä¸»è¦æ¶‰åŠæœåŠ¡çŠ¶æ€æ£€æŸ¥ã€æƒé™æµ‹è¯•å’Œè§„åˆ™éªŒè¯ã€‚å¸¸ç”¨çš„è°ƒè¯•æ–¹æ³•åŒ…æ‹¬ï¼š æœåŠ¡çŠ¶æ€æ£€æŸ¥ï¼šéªŒè¯ PolicyKit å®ˆæŠ¤è¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€ æƒé™æµ‹è¯•ï¼šä½¿ç”¨ pkcheck å·¥å…·æµ‹è¯•ç‰¹å®šæ“ä½œçš„æˆæƒæƒ…å†µ æ—¥å¿—åˆ†æï¼šæŸ¥çœ‹ PolicyKit çš„æˆæƒå†³ç­–æ—¥å¿— è§„åˆ™éªŒè¯ï¼šæ£€æŸ¥å½“å‰ç”Ÿæ•ˆçš„ PolicyKit è§„åˆ™é…ç½® å…·ä½“çš„è°ƒè¯•å‘½ä»¤è¯·å‚è€ƒ 3.5.3 æ•…éšœæ’æŸ¥ ç« èŠ‚ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:4:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#322-policykit-çš„å·¥ä½œåŸç†"},{"categories":["tech"],"content":" 3.2 PolicyKit - ç»†ç²’åº¦çš„ç³»ç»Ÿæƒé™ç®¡ç†PolicyKitï¼ˆç°ç§° polkitï¼‰æ˜¯ä¸€ä¸ªç”¨äºæ§åˆ¶ç³»ç»Ÿçº§æƒé™çš„æ¡†æ¶ï¼Œå®ƒæä¾›äº†ä¸€ç§æ¯”ä¼ ç»Ÿ Unix æƒé™æ›´ç»†ç²’åº¦çš„æˆæƒæœºåˆ¶ã€‚åœ¨ç°ä»£ Linux æ¡Œé¢ç³»ç»Ÿä¸­ï¼ŒPolicyKit å…è®¸éç‰¹æƒç”¨æˆ·æ‰§è¡ŒæŸäº›éœ€è¦ç‰¹æƒçš„ç³»ç»Ÿæ“ä½œ ï¼ˆå¦‚å…³æœºã€é‡å¯ã€æŒ‚è½½è®¾å¤‡ã€ä¿®æ”¹ç³»ç»Ÿæ—¶é—´ç­‰ï¼‰ï¼Œè€Œæ— éœ€è·å–å®Œæ•´çš„ root æƒé™ã€‚ 3.2.1 PolicyKit çš„æ ¸å¿ƒæ¦‚å¿µé…ç½®æ–‡ä»¶è·¯å¾„ï¼š /etc/polkit-1/ï¼šNixOS å£°æ˜å¼é…ç½®ä¸­å®šä¹‰çš„è‡ªå®šä¹‰è§„åˆ™ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰ /run/current-system/sw/share/polkit-1/ï¼ˆNixOSï¼‰æˆ– /usr/share/polkit-1/ï¼ˆä¼ ç»Ÿå‘è¡Œç‰ˆï¼‰ï¼šè½¯ä»¶åŒ…æä¾›çš„é»˜è®¤è§„åˆ™ ä¸Šè¿°æ–‡ä»¶å¤¹ä¸­åˆåŒ…å«ä¸¤ç±»é…ç½®ï¼š åŠ¨ä½œï¼ˆActionsï¼‰ å®šä¹‰åœ¨é…ç½®æ–‡ä»¶å¤¹çš„ actions ç›®å½•ä¸­çš„ XML æ–‡ä»¶ï¼ˆå¦‚ /etc/polkit-1/actions/ï¼‰ï¼Œæè¿°å¯æˆæƒçš„æ“ä½œã€‚æ¯ä¸ªåŠ¨ä½œéƒ½æœ‰å”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œå¦‚ org.freedesktop.login1.power-off è¡¨ç¤ºå…³æœºæ“ä½œã€‚ è§„åˆ™ï¼ˆRulesï¼‰ JavaScript æ–‡ä»¶ï¼Œå®šä¹‰æˆæƒå†³ç­–é€»è¾‘ï¼Œä½äºä¸Šè¿°é…ç½®æ–‡ä»¶å¤¹çš„ rules.d/ ç›®å½•ä¸­ï¼ˆå¦‚/etc/polkit-1/rules.d/ï¼‰ã€‚è§„åˆ™å†³å®šäº†åœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ˜¯å¦æˆæƒæŸä¸ªæ“ä½œã€‚åœ¨ NixOS ä¸­ï¼Œæ¨èä½¿ç”¨å£°æ˜å¼é…ç½®è€Œéç›´æ¥ä¿®æ”¹ /etc ç›®å½•ã€‚ èº«ä»½è®¤è¯ä»£ç†ï¼ˆAuthentication Agentsï¼‰ï¼šæ¡Œé¢ç¯å¢ƒæä¾›çš„å›¾å½¢ç•Œé¢ç»„ä»¶ï¼Œç”¨äºåœ¨ç”¨æˆ·éœ€è¦èº«ä»½éªŒè¯æ—¶å¼¹å‡ºè®¤è¯å¯¹è¯æ¡†ã€‚ä¾‹å¦‚ï¼Œå½“æ™®é€šç”¨æˆ·å°è¯•å…³æœºæ—¶ï¼Œè®¤è¯ä»£ç†ä¼šæç¤ºè¾“å…¥ç®¡ç†å‘˜å¯†ç ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ Niri çª—å£ç®¡ç†å™¨ï¼Œå®ƒçš„ Nix Flake å¯ç”¨äº† pokit-kde-agent-1 ä½œä¸ºå…¶ Authentication Agent, é…ç½®å‚è§sodiboo/niri-flake. 3.2.2 PolicyKit çš„å·¥ä½œåŸç†å½“åº”ç”¨ç¨‹åºè¯·æ±‚æ‰§è¡Œéœ€è¦ç‰¹æƒçš„æ“ä½œæ—¶ï¼Œç³»ç»ŸæœåŠ¡ä¼šè¯¢é—® PolicyKit æ˜¯å¦æˆæƒã€‚PolicyKit çš„è¯„ä¼°è¿‡ç¨‹å¦‚ä¸‹ï¼š èº«ä»½è¯†åˆ«ï¼šç¡®å®šè¯·æ±‚è€…çš„èº«ä»½ï¼ˆç”¨æˆ·ã€ç»„ã€ä¼šè¯ç­‰ï¼‰ è§„åˆ™åŒ¹é…ï¼šæ£€æŸ¥æ˜¯å¦æœ‰é€‚ç”¨çš„è§„åˆ™æ–‡ä»¶ æƒé™è¯„ä¼°ï¼šæ ¹æ®è§„åˆ™è¿”å›ä»¥ä¸‹ç»“æœä¹‹ä¸€ï¼š yesï¼šç›´æ¥å…è®¸ï¼Œæ— éœ€è®¤è¯ noï¼šç›´æ¥æ‹’ç» auth_selfï¼šéœ€è¦ç”¨æˆ·è‡ªå·±è®¤è¯ï¼ˆè¾“å…¥å½“å‰ç”¨æˆ·å¯†ç ï¼‰ auth_adminï¼šéœ€è¦ç®¡ç†å‘˜è®¤è¯ï¼ˆè¾“å…¥ root å¯†ç ï¼‰ auth_self_keep/auth_admin_keepï¼šè®¤è¯ååœ¨ä¸€æ®µæ—¶é—´å†…ä¿æŒæˆæƒ 3.2.3 PolicyKit çš„é…ç½®ç¤ºä¾‹åœ¨ä¼ ç»Ÿçš„ Linux å‘è¡Œç‰ˆä¸­ï¼Œç®¡ç†å‘˜å¯ä»¥é€šè¿‡åˆ›å»ºè‡ªå®šä¹‰è§„åˆ™æ¥ä¿®æ”¹é»˜è®¤è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œå…è®¸ wheel ç»„çš„ç”¨æˆ·æ— éœ€å¯†ç å³å¯å…³æœºï¼š javascript // /etc/polkit-1/rules.d/10-shutdown.rules polkit.addRule(function (action, subject) { if (action.id == \"org.freedesktop.login1.power-off\" \u0026\u0026 subject.isInGroup(\"wheel\")) { return polkit.Result.YES } }) NixOS ä¸­çš„é…ç½®æ–¹æ³•ï¼šåœ¨ NixOS ä¸­ï¼Œæ¨èä½¿ç”¨å£°æ˜å¼é…ç½®è€Œéç›´æ¥ä¿®æ”¹ /etc ç›®å½•ã€‚å¯ä»¥é€šè¿‡security.polkit é…ç½®é¡¹æ¥ç®¡ç† PolicyKit è§„åˆ™ï¼š nix # configuration.nix { security.polkit.enable = true; # æ·»åŠ è‡ªå®šä¹‰è§„åˆ™ security.polkit.extraConfig = '' polkit.addRule(function(action, subject) { if (action.id == \"org.freedesktop.login1.power-off\" \u0026\u0026 subject.isInGroup(\"wheel\")) { return polkit.Result.YES; } }); ''; } 3.2.4 PolicyKit ä¸ D-Bus çš„é›†æˆPolicyKit ä¸ D-Bus æ·±åº¦é›†æˆï¼Œä¸º D-Bus æœåŠ¡æä¾›åŠ¨æ€æˆæƒæœºåˆ¶ã€‚è®¸å¤šç³»ç»ŸæœåŠ¡ï¼ˆå¦‚ systemdã€NetworkManagerã€udisks ç­‰ï¼‰éƒ½ä½¿ç”¨ PolicyKit æ¥æ§åˆ¶å¯¹å…¶ D-Bus æ¥å£çš„è®¿é—®ã€‚å½“å®¢æˆ·ç«¯é€šè¿‡ D-Bus è°ƒç”¨éœ€è¦ç‰¹æƒçš„æ–¹æ³•æ—¶ï¼ŒæœåŠ¡ä¼šè°ƒç”¨ PolicyKit è¿›è¡Œæˆæƒæ£€æŸ¥ã€‚ PolicyKit è°ƒè¯•ä¸»è¦æ¶‰åŠæœåŠ¡çŠ¶æ€æ£€æŸ¥ã€æƒé™æµ‹è¯•å’Œè§„åˆ™éªŒè¯ã€‚å¸¸ç”¨çš„è°ƒè¯•æ–¹æ³•åŒ…æ‹¬ï¼š æœåŠ¡çŠ¶æ€æ£€æŸ¥ï¼šéªŒè¯ PolicyKit å®ˆæŠ¤è¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€ æƒé™æµ‹è¯•ï¼šä½¿ç”¨ pkcheck å·¥å…·æµ‹è¯•ç‰¹å®šæ“ä½œçš„æˆæƒæƒ…å†µ æ—¥å¿—åˆ†æï¼šæŸ¥çœ‹ PolicyKit çš„æˆæƒå†³ç­–æ—¥å¿— è§„åˆ™éªŒè¯ï¼šæ£€æŸ¥å½“å‰ç”Ÿæ•ˆçš„ PolicyKit è§„åˆ™é…ç½® å…·ä½“çš„è°ƒè¯•å‘½ä»¤è¯·å‚è€ƒ 3.5.3 æ•…éšœæ’æŸ¥ ç« èŠ‚ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:4:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#323-policykit-çš„é…ç½®ç¤ºä¾‹"},{"categories":["tech"],"content":" 3.2 PolicyKit - ç»†ç²’åº¦çš„ç³»ç»Ÿæƒé™ç®¡ç†PolicyKitï¼ˆç°ç§° polkitï¼‰æ˜¯ä¸€ä¸ªç”¨äºæ§åˆ¶ç³»ç»Ÿçº§æƒé™çš„æ¡†æ¶ï¼Œå®ƒæä¾›äº†ä¸€ç§æ¯”ä¼ ç»Ÿ Unix æƒé™æ›´ç»†ç²’åº¦çš„æˆæƒæœºåˆ¶ã€‚åœ¨ç°ä»£ Linux æ¡Œé¢ç³»ç»Ÿä¸­ï¼ŒPolicyKit å…è®¸éç‰¹æƒç”¨æˆ·æ‰§è¡ŒæŸäº›éœ€è¦ç‰¹æƒçš„ç³»ç»Ÿæ“ä½œ ï¼ˆå¦‚å…³æœºã€é‡å¯ã€æŒ‚è½½è®¾å¤‡ã€ä¿®æ”¹ç³»ç»Ÿæ—¶é—´ç­‰ï¼‰ï¼Œè€Œæ— éœ€è·å–å®Œæ•´çš„ root æƒé™ã€‚ 3.2.1 PolicyKit çš„æ ¸å¿ƒæ¦‚å¿µé…ç½®æ–‡ä»¶è·¯å¾„ï¼š /etc/polkit-1/ï¼šNixOS å£°æ˜å¼é…ç½®ä¸­å®šä¹‰çš„è‡ªå®šä¹‰è§„åˆ™ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰ /run/current-system/sw/share/polkit-1/ï¼ˆNixOSï¼‰æˆ– /usr/share/polkit-1/ï¼ˆä¼ ç»Ÿå‘è¡Œç‰ˆï¼‰ï¼šè½¯ä»¶åŒ…æä¾›çš„é»˜è®¤è§„åˆ™ ä¸Šè¿°æ–‡ä»¶å¤¹ä¸­åˆåŒ…å«ä¸¤ç±»é…ç½®ï¼š åŠ¨ä½œï¼ˆActionsï¼‰ å®šä¹‰åœ¨é…ç½®æ–‡ä»¶å¤¹çš„ actions ç›®å½•ä¸­çš„ XML æ–‡ä»¶ï¼ˆå¦‚ /etc/polkit-1/actions/ï¼‰ï¼Œæè¿°å¯æˆæƒçš„æ“ä½œã€‚æ¯ä¸ªåŠ¨ä½œéƒ½æœ‰å”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œå¦‚ org.freedesktop.login1.power-off è¡¨ç¤ºå…³æœºæ“ä½œã€‚ è§„åˆ™ï¼ˆRulesï¼‰ JavaScript æ–‡ä»¶ï¼Œå®šä¹‰æˆæƒå†³ç­–é€»è¾‘ï¼Œä½äºä¸Šè¿°é…ç½®æ–‡ä»¶å¤¹çš„ rules.d/ ç›®å½•ä¸­ï¼ˆå¦‚/etc/polkit-1/rules.d/ï¼‰ã€‚è§„åˆ™å†³å®šäº†åœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ˜¯å¦æˆæƒæŸä¸ªæ“ä½œã€‚åœ¨ NixOS ä¸­ï¼Œæ¨èä½¿ç”¨å£°æ˜å¼é…ç½®è€Œéç›´æ¥ä¿®æ”¹ /etc ç›®å½•ã€‚ èº«ä»½è®¤è¯ä»£ç†ï¼ˆAuthentication Agentsï¼‰ï¼šæ¡Œé¢ç¯å¢ƒæä¾›çš„å›¾å½¢ç•Œé¢ç»„ä»¶ï¼Œç”¨äºåœ¨ç”¨æˆ·éœ€è¦èº«ä»½éªŒè¯æ—¶å¼¹å‡ºè®¤è¯å¯¹è¯æ¡†ã€‚ä¾‹å¦‚ï¼Œå½“æ™®é€šç”¨æˆ·å°è¯•å…³æœºæ—¶ï¼Œè®¤è¯ä»£ç†ä¼šæç¤ºè¾“å…¥ç®¡ç†å‘˜å¯†ç ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ Niri çª—å£ç®¡ç†å™¨ï¼Œå®ƒçš„ Nix Flake å¯ç”¨äº† pokit-kde-agent-1 ä½œä¸ºå…¶ Authentication Agent, é…ç½®å‚è§sodiboo/niri-flake. 3.2.2 PolicyKit çš„å·¥ä½œåŸç†å½“åº”ç”¨ç¨‹åºè¯·æ±‚æ‰§è¡Œéœ€è¦ç‰¹æƒçš„æ“ä½œæ—¶ï¼Œç³»ç»ŸæœåŠ¡ä¼šè¯¢é—® PolicyKit æ˜¯å¦æˆæƒã€‚PolicyKit çš„è¯„ä¼°è¿‡ç¨‹å¦‚ä¸‹ï¼š èº«ä»½è¯†åˆ«ï¼šç¡®å®šè¯·æ±‚è€…çš„èº«ä»½ï¼ˆç”¨æˆ·ã€ç»„ã€ä¼šè¯ç­‰ï¼‰ è§„åˆ™åŒ¹é…ï¼šæ£€æŸ¥æ˜¯å¦æœ‰é€‚ç”¨çš„è§„åˆ™æ–‡ä»¶ æƒé™è¯„ä¼°ï¼šæ ¹æ®è§„åˆ™è¿”å›ä»¥ä¸‹ç»“æœä¹‹ä¸€ï¼š yesï¼šç›´æ¥å…è®¸ï¼Œæ— éœ€è®¤è¯ noï¼šç›´æ¥æ‹’ç» auth_selfï¼šéœ€è¦ç”¨æˆ·è‡ªå·±è®¤è¯ï¼ˆè¾“å…¥å½“å‰ç”¨æˆ·å¯†ç ï¼‰ auth_adminï¼šéœ€è¦ç®¡ç†å‘˜è®¤è¯ï¼ˆè¾“å…¥ root å¯†ç ï¼‰ auth_self_keep/auth_admin_keepï¼šè®¤è¯ååœ¨ä¸€æ®µæ—¶é—´å†…ä¿æŒæˆæƒ 3.2.3 PolicyKit çš„é…ç½®ç¤ºä¾‹åœ¨ä¼ ç»Ÿçš„ Linux å‘è¡Œç‰ˆä¸­ï¼Œç®¡ç†å‘˜å¯ä»¥é€šè¿‡åˆ›å»ºè‡ªå®šä¹‰è§„åˆ™æ¥ä¿®æ”¹é»˜è®¤è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œå…è®¸ wheel ç»„çš„ç”¨æˆ·æ— éœ€å¯†ç å³å¯å…³æœºï¼š javascript // /etc/polkit-1/rules.d/10-shutdown.rules polkit.addRule(function (action, subject) { if (action.id == \"org.freedesktop.login1.power-off\" \u0026\u0026 subject.isInGroup(\"wheel\")) { return polkit.Result.YES } }) NixOS ä¸­çš„é…ç½®æ–¹æ³•ï¼šåœ¨ NixOS ä¸­ï¼Œæ¨èä½¿ç”¨å£°æ˜å¼é…ç½®è€Œéç›´æ¥ä¿®æ”¹ /etc ç›®å½•ã€‚å¯ä»¥é€šè¿‡security.polkit é…ç½®é¡¹æ¥ç®¡ç† PolicyKit è§„åˆ™ï¼š nix # configuration.nix { security.polkit.enable = true; # æ·»åŠ è‡ªå®šä¹‰è§„åˆ™ security.polkit.extraConfig = '' polkit.addRule(function(action, subject) { if (action.id == \"org.freedesktop.login1.power-off\" \u0026\u0026 subject.isInGroup(\"wheel\")) { return polkit.Result.YES; } }); ''; } 3.2.4 PolicyKit ä¸ D-Bus çš„é›†æˆPolicyKit ä¸ D-Bus æ·±åº¦é›†æˆï¼Œä¸º D-Bus æœåŠ¡æä¾›åŠ¨æ€æˆæƒæœºåˆ¶ã€‚è®¸å¤šç³»ç»ŸæœåŠ¡ï¼ˆå¦‚ systemdã€NetworkManagerã€udisks ç­‰ï¼‰éƒ½ä½¿ç”¨ PolicyKit æ¥æ§åˆ¶å¯¹å…¶ D-Bus æ¥å£çš„è®¿é—®ã€‚å½“å®¢æˆ·ç«¯é€šè¿‡ D-Bus è°ƒç”¨éœ€è¦ç‰¹æƒçš„æ–¹æ³•æ—¶ï¼ŒæœåŠ¡ä¼šè°ƒç”¨ PolicyKit è¿›è¡Œæˆæƒæ£€æŸ¥ã€‚ PolicyKit è°ƒè¯•ä¸»è¦æ¶‰åŠæœåŠ¡çŠ¶æ€æ£€æŸ¥ã€æƒé™æµ‹è¯•å’Œè§„åˆ™éªŒè¯ã€‚å¸¸ç”¨çš„è°ƒè¯•æ–¹æ³•åŒ…æ‹¬ï¼š æœåŠ¡çŠ¶æ€æ£€æŸ¥ï¼šéªŒè¯ PolicyKit å®ˆæŠ¤è¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€ æƒé™æµ‹è¯•ï¼šä½¿ç”¨ pkcheck å·¥å…·æµ‹è¯•ç‰¹å®šæ“ä½œçš„æˆæƒæƒ…å†µ æ—¥å¿—åˆ†æï¼šæŸ¥çœ‹ PolicyKit çš„æˆæƒå†³ç­–æ—¥å¿— è§„åˆ™éªŒè¯ï¼šæ£€æŸ¥å½“å‰ç”Ÿæ•ˆçš„ PolicyKit è§„åˆ™é…ç½® å…·ä½“çš„è°ƒè¯•å‘½ä»¤è¯·å‚è€ƒ 3.5.3 æ•…éšœæ’æŸ¥ ç« èŠ‚ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:4:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#324-policykit-ä¸-d-bus-çš„é›†æˆ"},{"categories":["tech"],"content":" 3.3 æ¡Œé¢å¯†é’¥ç®¡ç†ç°ä»£ Linux æ¡Œé¢ç¯å¢ƒæä¾›äº†ç»Ÿä¸€çš„å¯†é’¥ç®¡ç†æœåŠ¡ï¼Œç”¨äºå®‰å…¨å­˜å‚¨ç”¨æˆ·çš„å¯†ç ã€è¯ä¹¦ã€å¯†é’¥ç­‰æ•æ„Ÿä¿¡æ¯ã€‚ GNOME Keyring å’Œ KDE Wallet åˆ†åˆ«æ˜¯ GNOME å’Œ KDE æ¡Œé¢ç¯å¢ƒçš„å¯†é’¥ç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œå®ƒä»¬é€šè¿‡åŠ å¯†å­˜å‚¨å’Œè‡ªåŠ¨è§£é”æœºåˆ¶ï¼Œä¸ºç”¨æˆ·æä¾›äº†ä¾¿æ·è€Œå®‰å…¨çš„å¯†ç ç®¡ç†ä½“éªŒã€‚ GNOME Keyring å’Œ KDE Wallet éƒ½å®ç°äº†æ ‡å‡†çš„Secrets API, å¯ä»¥æ ¹æ®éœ€è¦ä»»é€‰ä¸€ä¸ªä½¿ç”¨ã€‚ä¸è¿‡æ®æˆ‘è§‚å¯Ÿå¤§éƒ¨åˆ†çª—å£ç®¡ç†å™¨çš„ç”¨æˆ·éƒ½æ˜¯ç”¨çš„ GNOME Keyring. 3.3.1 å¯†é’¥ç®¡ç†ç³»ç»Ÿæ¶æ„GNOME Keyring æ¶æ„ï¼š å¯†é’¥ç¯ï¼ˆKeyringï¼‰ï¼šåŠ å¯†çš„å­˜å‚¨å®¹å™¨ï¼Œæ¯ä¸ªå¯†é’¥ç¯æœ‰ç‹¬ç«‹çš„å¯†ç  å¯†é’¥ç¯å®ˆæŠ¤è¿›ç¨‹ï¼ˆgnome-keyring-daemonï¼‰ï¼šç®¡ç†å¯†é’¥ç¯çš„ç”Ÿå‘½å‘¨æœŸå’Œè®¿é—®æ§åˆ¶ APIï¼šGnome åŸç”Ÿæ”¯æŒ org.freedesktop.secrets DBus API, ç›®å‰æµè¡Œçš„ secrets å®¢æˆ·ç«¯åº“ libsecret ä¹Ÿæ˜¯ gnome å¼€å‘çš„ã€‚ PAM é›†æˆï¼šé€šè¿‡ pam_gnome_keyring.so å®ç°ç™»å½•æ—¶è‡ªåŠ¨è§£é” KDE Wallet æ¶æ„ï¼š KWalletManagerï¼šå›¾å½¢ç•Œé¢ç®¡ç†å·¥å…· kwalletdï¼šé’±åŒ…å®ˆæŠ¤è¿›ç¨‹ APIï¼šKDE Wallet ä» 5.97.0 ï¼ˆ2022 å¹´ 8 æœˆï¼‰å¼€å§‹æ”¯æŒorg.freedesktop.secrets DBus API, å› æ­¤å¯ä»¥ç›´æ¥é€šè¿‡ libsecret å¾€ KDE Wallet ä¸­å­˜å– passwords ç­‰ secret. PAM é›†æˆï¼šé€šè¿‡ pam_kwallet.so å®ç°è‡ªåŠ¨è§£é” æ ¸å¿ƒç»„ä»¶è·¯å¾„ï¼š bash # GNOME Keyring ç»„ä»¶ï¼ˆNixOS ä¸­ä½äº nix storeï¼‰ /run/current-system/sw/bin/gnome-keyring-daemon /run/current-system/sw/lib/libsecret-1.so /run/current-system/sw/lib/security/pam_gnome_keyring.so # KDE Wallet ç»„ä»¶ï¼ˆNixOS ä¸­ä½äº nix storeï¼‰ /run/current-system/sw/bin/kwalletd5 /run/current-system/sw/bin/kwalletmanager5 /run/current-system/sw/lib/security/pam_kwallet.so # é…ç½®æ–‡ä»¶ä½ç½® ~/.local/share/keyrings/ # GNOME å¯†é’¥ç¯å­˜å‚¨ç›®å½• ~/.local/share/kwalletd/ # KDE é’±åŒ…æ–‡ä»¶å­˜å‚¨ç›®å½• ~/.config/kwalletrc # KDE é’±åŒ…é…ç½®æ–‡ä»¶ 3.3.2 å¯†é’¥ç¯ç±»å‹ä¸ç”¨é€” å¯†é’¥ç¯ç±»å‹ ç”¨é€” è§£é”æ—¶æœº login ç™»å½•å¯†é’¥ç¯ï¼Œå­˜å‚¨ç”¨æˆ·å¯†ç  ç”¨æˆ·ç™»å½•æ—¶è‡ªåŠ¨è§£é” default é»˜è®¤å¯†é’¥ç¯ï¼Œå­˜å‚¨åº”ç”¨å¯†ç  é¦–æ¬¡è®¿é—®æ—¶è§£é” session ä¼šè¯å¯†é’¥ç¯ï¼Œä¸´æ—¶å­˜å‚¨ ä¼šè¯å¼€å§‹æ—¶åˆ›å»º crypto åŠ å¯†å¯†é’¥ç¯ï¼Œå­˜å‚¨è¯ä¹¦å’Œç§é’¥ æŒ‰éœ€è§£é” 3.3.3 é’±åŒ…åˆ›å»ºä¸ç®¡ç†å›¾å½¢ç•Œé¢ç®¡ç†ï¼š bash # GNOME å¯†é’¥ç¯ç®¡ç†å™¨ seahorse # KDE é’±åŒ…ç®¡ç†å™¨ kwalletmanager5 é€šè¿‡å›¾å½¢ç•Œé¢å¯ä»¥ï¼š åˆ›å»ºæ–°çš„å¯†é’¥ç¯/é’±åŒ… è®¾ç½®å¯†ç å’ŒåŠ å¯†ç®—æ³• ç®¡ç†å­˜å‚¨çš„å¯†ç å’Œè¯ä¹¦ é…ç½®è‡ªåŠ¨è§£é”ç­–ç•¥ å¤‡ä»½å’Œæ¢å¤å¯†é’¥ç¯ åŸºæœ¬å‘½ä»¤è¡Œæ“ä½œï¼š bash # ä½¿ç”¨ secret-tool ç®¡ç† GNOME Keyring secret-tool store --label=\"My Password\" application myapp secret-tool lookup application myapp # ä½¿ç”¨ kwallet-query ç®¡ç† KDE Wallet kwallet-query --write password \"MyApp\" \"username\" \"password\" kwallet-query --read password \"MyApp\" \"username\" 3.3.4 åº”ç”¨ç¨‹åºé›†æˆå¸¸è§åº”ç”¨ç¨‹åºé›†æˆï¼š VSCodeï¼š è‡ªåŠ¨é›†æˆç³»ç»Ÿå¯†é’¥ç®¡ç†æœåŠ¡ å­˜å‚¨ Git å‡­æ®ã€æ‰©å±•è®¾ç½®ç­‰æ•æ„Ÿä¿¡æ¯ é€šè¿‡ git credential.helper é…ç½®è‡ªåŠ¨ä½¿ç”¨ GitHub CLIï¼š bash # é…ç½® GitHub CLI ä½¿ç”¨ç³»ç»Ÿå¯†é’¥ç®¡ç† gh auth login --web # å‡­æ®ä¼šè‡ªåŠ¨å­˜å‚¨åˆ°ç³»ç»Ÿå¯†é’¥ç¯ä¸­ æµè§ˆå™¨é›†æˆï¼š Firefoxã€Chrome ç­‰ç°ä»£æµè§ˆå™¨æ”¯æŒç³»ç»Ÿå¯†é’¥ç®¡ç† ç½‘ç«™å¯†ç è‡ªåŠ¨ä¿å­˜åˆ°å¯†é’¥ç¯/é’±åŒ…ä¸­ è·¨è®¾å¤‡åŒæ­¥ï¼ˆå¦‚æœå¯ç”¨ï¼‰ API é›†æˆç¤ºä¾‹ï¼š libsecret API 3.3.5 é…ç½®ä¸ä¼˜åŒ–NixOS é…ç½®ç¤ºä¾‹ï¼š nix # configuration.nix # å¯ç”¨ GNOME Keyring services.gnome.gnome-keyring.enable = true; # GNOME Keyring GUI å®¢æˆ·ç«¯ programs.seahorse.enable = true; # å¯ç”¨ PAM é›†æˆ security.pam.services.login.enableGnomeKeyring = true; ","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:4:3","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#33-æ¡Œé¢å¯†é’¥ç®¡ç†"},{"categories":["tech"],"content":" 3.3 æ¡Œé¢å¯†é’¥ç®¡ç†ç°ä»£ Linux æ¡Œé¢ç¯å¢ƒæä¾›äº†ç»Ÿä¸€çš„å¯†é’¥ç®¡ç†æœåŠ¡ï¼Œç”¨äºå®‰å…¨å­˜å‚¨ç”¨æˆ·çš„å¯†ç ã€è¯ä¹¦ã€å¯†é’¥ç­‰æ•æ„Ÿä¿¡æ¯ã€‚ GNOME Keyring å’Œ KDE Wallet åˆ†åˆ«æ˜¯ GNOME å’Œ KDE æ¡Œé¢ç¯å¢ƒçš„å¯†é’¥ç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œå®ƒä»¬é€šè¿‡åŠ å¯†å­˜å‚¨å’Œè‡ªåŠ¨è§£é”æœºåˆ¶ï¼Œä¸ºç”¨æˆ·æä¾›äº†ä¾¿æ·è€Œå®‰å…¨çš„å¯†ç ç®¡ç†ä½“éªŒã€‚ GNOME Keyring å’Œ KDE Wallet éƒ½å®ç°äº†æ ‡å‡†çš„Secrets API, å¯ä»¥æ ¹æ®éœ€è¦ä»»é€‰ä¸€ä¸ªä½¿ç”¨ã€‚ä¸è¿‡æ®æˆ‘è§‚å¯Ÿå¤§éƒ¨åˆ†çª—å£ç®¡ç†å™¨çš„ç”¨æˆ·éƒ½æ˜¯ç”¨çš„ GNOME Keyring. 3.3.1 å¯†é’¥ç®¡ç†ç³»ç»Ÿæ¶æ„GNOME Keyring æ¶æ„ï¼š å¯†é’¥ç¯ï¼ˆKeyringï¼‰ï¼šåŠ å¯†çš„å­˜å‚¨å®¹å™¨ï¼Œæ¯ä¸ªå¯†é’¥ç¯æœ‰ç‹¬ç«‹çš„å¯†ç  å¯†é’¥ç¯å®ˆæŠ¤è¿›ç¨‹ï¼ˆgnome-keyring-daemonï¼‰ï¼šç®¡ç†å¯†é’¥ç¯çš„ç”Ÿå‘½å‘¨æœŸå’Œè®¿é—®æ§åˆ¶ APIï¼šGnome åŸç”Ÿæ”¯æŒ org.freedesktop.secrets DBus API, ç›®å‰æµè¡Œçš„ secrets å®¢æˆ·ç«¯åº“ libsecret ä¹Ÿæ˜¯ gnome å¼€å‘çš„ã€‚ PAM é›†æˆï¼šé€šè¿‡ pam_gnome_keyring.so å®ç°ç™»å½•æ—¶è‡ªåŠ¨è§£é” KDE Wallet æ¶æ„ï¼š KWalletManagerï¼šå›¾å½¢ç•Œé¢ç®¡ç†å·¥å…· kwalletdï¼šé’±åŒ…å®ˆæŠ¤è¿›ç¨‹ APIï¼šKDE Wallet ä» 5.97.0 ï¼ˆ2022 å¹´ 8 æœˆï¼‰å¼€å§‹æ”¯æŒorg.freedesktop.secrets DBus API, å› æ­¤å¯ä»¥ç›´æ¥é€šè¿‡ libsecret å¾€ KDE Wallet ä¸­å­˜å– passwords ç­‰ secret. PAM é›†æˆï¼šé€šè¿‡ pam_kwallet.so å®ç°è‡ªåŠ¨è§£é” æ ¸å¿ƒç»„ä»¶è·¯å¾„ï¼š bash # GNOME Keyring ç»„ä»¶ï¼ˆNixOS ä¸­ä½äº nix storeï¼‰ /run/current-system/sw/bin/gnome-keyring-daemon /run/current-system/sw/lib/libsecret-1.so /run/current-system/sw/lib/security/pam_gnome_keyring.so # KDE Wallet ç»„ä»¶ï¼ˆNixOS ä¸­ä½äº nix storeï¼‰ /run/current-system/sw/bin/kwalletd5 /run/current-system/sw/bin/kwalletmanager5 /run/current-system/sw/lib/security/pam_kwallet.so # é…ç½®æ–‡ä»¶ä½ç½® ~/.local/share/keyrings/ # GNOME å¯†é’¥ç¯å­˜å‚¨ç›®å½• ~/.local/share/kwalletd/ # KDE é’±åŒ…æ–‡ä»¶å­˜å‚¨ç›®å½• ~/.config/kwalletrc # KDE é’±åŒ…é…ç½®æ–‡ä»¶ 3.3.2 å¯†é’¥ç¯ç±»å‹ä¸ç”¨é€” å¯†é’¥ç¯ç±»å‹ ç”¨é€” è§£é”æ—¶æœº login ç™»å½•å¯†é’¥ç¯ï¼Œå­˜å‚¨ç”¨æˆ·å¯†ç  ç”¨æˆ·ç™»å½•æ—¶è‡ªåŠ¨è§£é” default é»˜è®¤å¯†é’¥ç¯ï¼Œå­˜å‚¨åº”ç”¨å¯†ç  é¦–æ¬¡è®¿é—®æ—¶è§£é” session ä¼šè¯å¯†é’¥ç¯ï¼Œä¸´æ—¶å­˜å‚¨ ä¼šè¯å¼€å§‹æ—¶åˆ›å»º crypto åŠ å¯†å¯†é’¥ç¯ï¼Œå­˜å‚¨è¯ä¹¦å’Œç§é’¥ æŒ‰éœ€è§£é” 3.3.3 é’±åŒ…åˆ›å»ºä¸ç®¡ç†å›¾å½¢ç•Œé¢ç®¡ç†ï¼š bash # GNOME å¯†é’¥ç¯ç®¡ç†å™¨ seahorse # KDE é’±åŒ…ç®¡ç†å™¨ kwalletmanager5 é€šè¿‡å›¾å½¢ç•Œé¢å¯ä»¥ï¼š åˆ›å»ºæ–°çš„å¯†é’¥ç¯/é’±åŒ… è®¾ç½®å¯†ç å’ŒåŠ å¯†ç®—æ³• ç®¡ç†å­˜å‚¨çš„å¯†ç å’Œè¯ä¹¦ é…ç½®è‡ªåŠ¨è§£é”ç­–ç•¥ å¤‡ä»½å’Œæ¢å¤å¯†é’¥ç¯ åŸºæœ¬å‘½ä»¤è¡Œæ“ä½œï¼š bash # ä½¿ç”¨ secret-tool ç®¡ç† GNOME Keyring secret-tool store --label=\"My Password\" application myapp secret-tool lookup application myapp # ä½¿ç”¨ kwallet-query ç®¡ç† KDE Wallet kwallet-query --write password \"MyApp\" \"username\" \"password\" kwallet-query --read password \"MyApp\" \"username\" 3.3.4 åº”ç”¨ç¨‹åºé›†æˆå¸¸è§åº”ç”¨ç¨‹åºé›†æˆï¼š VSCodeï¼š è‡ªåŠ¨é›†æˆç³»ç»Ÿå¯†é’¥ç®¡ç†æœåŠ¡ å­˜å‚¨ Git å‡­æ®ã€æ‰©å±•è®¾ç½®ç­‰æ•æ„Ÿä¿¡æ¯ é€šè¿‡ git credential.helper é…ç½®è‡ªåŠ¨ä½¿ç”¨ GitHub CLIï¼š bash # é…ç½® GitHub CLI ä½¿ç”¨ç³»ç»Ÿå¯†é’¥ç®¡ç† gh auth login --web # å‡­æ®ä¼šè‡ªåŠ¨å­˜å‚¨åˆ°ç³»ç»Ÿå¯†é’¥ç¯ä¸­ æµè§ˆå™¨é›†æˆï¼š Firefoxã€Chrome ç­‰ç°ä»£æµè§ˆå™¨æ”¯æŒç³»ç»Ÿå¯†é’¥ç®¡ç† ç½‘ç«™å¯†ç è‡ªåŠ¨ä¿å­˜åˆ°å¯†é’¥ç¯/é’±åŒ…ä¸­ è·¨è®¾å¤‡åŒæ­¥ï¼ˆå¦‚æœå¯ç”¨ï¼‰ API é›†æˆç¤ºä¾‹ï¼š libsecret API 3.3.5 é…ç½®ä¸ä¼˜åŒ–NixOS é…ç½®ç¤ºä¾‹ï¼š nix # configuration.nix # å¯ç”¨ GNOME Keyring services.gnome.gnome-keyring.enable = true; # GNOME Keyring GUI å®¢æˆ·ç«¯ programs.seahorse.enable = true; # å¯ç”¨ PAM é›†æˆ security.pam.services.login.enableGnomeKeyring = true; ","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:4:3","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#331-å¯†é’¥ç®¡ç†ç³»ç»Ÿæ¶æ„"},{"categories":["tech"],"content":" 3.3 æ¡Œé¢å¯†é’¥ç®¡ç†ç°ä»£ Linux æ¡Œé¢ç¯å¢ƒæä¾›äº†ç»Ÿä¸€çš„å¯†é’¥ç®¡ç†æœåŠ¡ï¼Œç”¨äºå®‰å…¨å­˜å‚¨ç”¨æˆ·çš„å¯†ç ã€è¯ä¹¦ã€å¯†é’¥ç­‰æ•æ„Ÿä¿¡æ¯ã€‚ GNOME Keyring å’Œ KDE Wallet åˆ†åˆ«æ˜¯ GNOME å’Œ KDE æ¡Œé¢ç¯å¢ƒçš„å¯†é’¥ç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œå®ƒä»¬é€šè¿‡åŠ å¯†å­˜å‚¨å’Œè‡ªåŠ¨è§£é”æœºåˆ¶ï¼Œä¸ºç”¨æˆ·æä¾›äº†ä¾¿æ·è€Œå®‰å…¨çš„å¯†ç ç®¡ç†ä½“éªŒã€‚ GNOME Keyring å’Œ KDE Wallet éƒ½å®ç°äº†æ ‡å‡†çš„Secrets API, å¯ä»¥æ ¹æ®éœ€è¦ä»»é€‰ä¸€ä¸ªä½¿ç”¨ã€‚ä¸è¿‡æ®æˆ‘è§‚å¯Ÿå¤§éƒ¨åˆ†çª—å£ç®¡ç†å™¨çš„ç”¨æˆ·éƒ½æ˜¯ç”¨çš„ GNOME Keyring. 3.3.1 å¯†é’¥ç®¡ç†ç³»ç»Ÿæ¶æ„GNOME Keyring æ¶æ„ï¼š å¯†é’¥ç¯ï¼ˆKeyringï¼‰ï¼šåŠ å¯†çš„å­˜å‚¨å®¹å™¨ï¼Œæ¯ä¸ªå¯†é’¥ç¯æœ‰ç‹¬ç«‹çš„å¯†ç  å¯†é’¥ç¯å®ˆæŠ¤è¿›ç¨‹ï¼ˆgnome-keyring-daemonï¼‰ï¼šç®¡ç†å¯†é’¥ç¯çš„ç”Ÿå‘½å‘¨æœŸå’Œè®¿é—®æ§åˆ¶ APIï¼šGnome åŸç”Ÿæ”¯æŒ org.freedesktop.secrets DBus API, ç›®å‰æµè¡Œçš„ secrets å®¢æˆ·ç«¯åº“ libsecret ä¹Ÿæ˜¯ gnome å¼€å‘çš„ã€‚ PAM é›†æˆï¼šé€šè¿‡ pam_gnome_keyring.so å®ç°ç™»å½•æ—¶è‡ªåŠ¨è§£é” KDE Wallet æ¶æ„ï¼š KWalletManagerï¼šå›¾å½¢ç•Œé¢ç®¡ç†å·¥å…· kwalletdï¼šé’±åŒ…å®ˆæŠ¤è¿›ç¨‹ APIï¼šKDE Wallet ä» 5.97.0 ï¼ˆ2022 å¹´ 8 æœˆï¼‰å¼€å§‹æ”¯æŒorg.freedesktop.secrets DBus API, å› æ­¤å¯ä»¥ç›´æ¥é€šè¿‡ libsecret å¾€ KDE Wallet ä¸­å­˜å– passwords ç­‰ secret. PAM é›†æˆï¼šé€šè¿‡ pam_kwallet.so å®ç°è‡ªåŠ¨è§£é” æ ¸å¿ƒç»„ä»¶è·¯å¾„ï¼š bash # GNOME Keyring ç»„ä»¶ï¼ˆNixOS ä¸­ä½äº nix storeï¼‰ /run/current-system/sw/bin/gnome-keyring-daemon /run/current-system/sw/lib/libsecret-1.so /run/current-system/sw/lib/security/pam_gnome_keyring.so # KDE Wallet ç»„ä»¶ï¼ˆNixOS ä¸­ä½äº nix storeï¼‰ /run/current-system/sw/bin/kwalletd5 /run/current-system/sw/bin/kwalletmanager5 /run/current-system/sw/lib/security/pam_kwallet.so # é…ç½®æ–‡ä»¶ä½ç½® ~/.local/share/keyrings/ # GNOME å¯†é’¥ç¯å­˜å‚¨ç›®å½• ~/.local/share/kwalletd/ # KDE é’±åŒ…æ–‡ä»¶å­˜å‚¨ç›®å½• ~/.config/kwalletrc # KDE é’±åŒ…é…ç½®æ–‡ä»¶ 3.3.2 å¯†é’¥ç¯ç±»å‹ä¸ç”¨é€” å¯†é’¥ç¯ç±»å‹ ç”¨é€” è§£é”æ—¶æœº login ç™»å½•å¯†é’¥ç¯ï¼Œå­˜å‚¨ç”¨æˆ·å¯†ç  ç”¨æˆ·ç™»å½•æ—¶è‡ªåŠ¨è§£é” default é»˜è®¤å¯†é’¥ç¯ï¼Œå­˜å‚¨åº”ç”¨å¯†ç  é¦–æ¬¡è®¿é—®æ—¶è§£é” session ä¼šè¯å¯†é’¥ç¯ï¼Œä¸´æ—¶å­˜å‚¨ ä¼šè¯å¼€å§‹æ—¶åˆ›å»º crypto åŠ å¯†å¯†é’¥ç¯ï¼Œå­˜å‚¨è¯ä¹¦å’Œç§é’¥ æŒ‰éœ€è§£é” 3.3.3 é’±åŒ…åˆ›å»ºä¸ç®¡ç†å›¾å½¢ç•Œé¢ç®¡ç†ï¼š bash # GNOME å¯†é’¥ç¯ç®¡ç†å™¨ seahorse # KDE é’±åŒ…ç®¡ç†å™¨ kwalletmanager5 é€šè¿‡å›¾å½¢ç•Œé¢å¯ä»¥ï¼š åˆ›å»ºæ–°çš„å¯†é’¥ç¯/é’±åŒ… è®¾ç½®å¯†ç å’ŒåŠ å¯†ç®—æ³• ç®¡ç†å­˜å‚¨çš„å¯†ç å’Œè¯ä¹¦ é…ç½®è‡ªåŠ¨è§£é”ç­–ç•¥ å¤‡ä»½å’Œæ¢å¤å¯†é’¥ç¯ åŸºæœ¬å‘½ä»¤è¡Œæ“ä½œï¼š bash # ä½¿ç”¨ secret-tool ç®¡ç† GNOME Keyring secret-tool store --label=\"My Password\" application myapp secret-tool lookup application myapp # ä½¿ç”¨ kwallet-query ç®¡ç† KDE Wallet kwallet-query --write password \"MyApp\" \"username\" \"password\" kwallet-query --read password \"MyApp\" \"username\" 3.3.4 åº”ç”¨ç¨‹åºé›†æˆå¸¸è§åº”ç”¨ç¨‹åºé›†æˆï¼š VSCodeï¼š è‡ªåŠ¨é›†æˆç³»ç»Ÿå¯†é’¥ç®¡ç†æœåŠ¡ å­˜å‚¨ Git å‡­æ®ã€æ‰©å±•è®¾ç½®ç­‰æ•æ„Ÿä¿¡æ¯ é€šè¿‡ git credential.helper é…ç½®è‡ªåŠ¨ä½¿ç”¨ GitHub CLIï¼š bash # é…ç½® GitHub CLI ä½¿ç”¨ç³»ç»Ÿå¯†é’¥ç®¡ç† gh auth login --web # å‡­æ®ä¼šè‡ªåŠ¨å­˜å‚¨åˆ°ç³»ç»Ÿå¯†é’¥ç¯ä¸­ æµè§ˆå™¨é›†æˆï¼š Firefoxã€Chrome ç­‰ç°ä»£æµè§ˆå™¨æ”¯æŒç³»ç»Ÿå¯†é’¥ç®¡ç† ç½‘ç«™å¯†ç è‡ªåŠ¨ä¿å­˜åˆ°å¯†é’¥ç¯/é’±åŒ…ä¸­ è·¨è®¾å¤‡åŒæ­¥ï¼ˆå¦‚æœå¯ç”¨ï¼‰ API é›†æˆç¤ºä¾‹ï¼š libsecret API 3.3.5 é…ç½®ä¸ä¼˜åŒ–NixOS é…ç½®ç¤ºä¾‹ï¼š nix # configuration.nix # å¯ç”¨ GNOME Keyring services.gnome.gnome-keyring.enable = true; # GNOME Keyring GUI å®¢æˆ·ç«¯ programs.seahorse.enable = true; # å¯ç”¨ PAM é›†æˆ security.pam.services.login.enableGnomeKeyring = true; ","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:4:3","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#332-å¯†é’¥ç¯ç±»å‹ä¸ç”¨é€”"},{"categories":["tech"],"content":" 3.3 æ¡Œé¢å¯†é’¥ç®¡ç†ç°ä»£ Linux æ¡Œé¢ç¯å¢ƒæä¾›äº†ç»Ÿä¸€çš„å¯†é’¥ç®¡ç†æœåŠ¡ï¼Œç”¨äºå®‰å…¨å­˜å‚¨ç”¨æˆ·çš„å¯†ç ã€è¯ä¹¦ã€å¯†é’¥ç­‰æ•æ„Ÿä¿¡æ¯ã€‚ GNOME Keyring å’Œ KDE Wallet åˆ†åˆ«æ˜¯ GNOME å’Œ KDE æ¡Œé¢ç¯å¢ƒçš„å¯†é’¥ç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œå®ƒä»¬é€šè¿‡åŠ å¯†å­˜å‚¨å’Œè‡ªåŠ¨è§£é”æœºåˆ¶ï¼Œä¸ºç”¨æˆ·æä¾›äº†ä¾¿æ·è€Œå®‰å…¨çš„å¯†ç ç®¡ç†ä½“éªŒã€‚ GNOME Keyring å’Œ KDE Wallet éƒ½å®ç°äº†æ ‡å‡†çš„Secrets API, å¯ä»¥æ ¹æ®éœ€è¦ä»»é€‰ä¸€ä¸ªä½¿ç”¨ã€‚ä¸è¿‡æ®æˆ‘è§‚å¯Ÿå¤§éƒ¨åˆ†çª—å£ç®¡ç†å™¨çš„ç”¨æˆ·éƒ½æ˜¯ç”¨çš„ GNOME Keyring. 3.3.1 å¯†é’¥ç®¡ç†ç³»ç»Ÿæ¶æ„GNOME Keyring æ¶æ„ï¼š å¯†é’¥ç¯ï¼ˆKeyringï¼‰ï¼šåŠ å¯†çš„å­˜å‚¨å®¹å™¨ï¼Œæ¯ä¸ªå¯†é’¥ç¯æœ‰ç‹¬ç«‹çš„å¯†ç  å¯†é’¥ç¯å®ˆæŠ¤è¿›ç¨‹ï¼ˆgnome-keyring-daemonï¼‰ï¼šç®¡ç†å¯†é’¥ç¯çš„ç”Ÿå‘½å‘¨æœŸå’Œè®¿é—®æ§åˆ¶ APIï¼šGnome åŸç”Ÿæ”¯æŒ org.freedesktop.secrets DBus API, ç›®å‰æµè¡Œçš„ secrets å®¢æˆ·ç«¯åº“ libsecret ä¹Ÿæ˜¯ gnome å¼€å‘çš„ã€‚ PAM é›†æˆï¼šé€šè¿‡ pam_gnome_keyring.so å®ç°ç™»å½•æ—¶è‡ªåŠ¨è§£é” KDE Wallet æ¶æ„ï¼š KWalletManagerï¼šå›¾å½¢ç•Œé¢ç®¡ç†å·¥å…· kwalletdï¼šé’±åŒ…å®ˆæŠ¤è¿›ç¨‹ APIï¼šKDE Wallet ä» 5.97.0 ï¼ˆ2022 å¹´ 8 æœˆï¼‰å¼€å§‹æ”¯æŒorg.freedesktop.secrets DBus API, å› æ­¤å¯ä»¥ç›´æ¥é€šè¿‡ libsecret å¾€ KDE Wallet ä¸­å­˜å– passwords ç­‰ secret. PAM é›†æˆï¼šé€šè¿‡ pam_kwallet.so å®ç°è‡ªåŠ¨è§£é” æ ¸å¿ƒç»„ä»¶è·¯å¾„ï¼š bash # GNOME Keyring ç»„ä»¶ï¼ˆNixOS ä¸­ä½äº nix storeï¼‰ /run/current-system/sw/bin/gnome-keyring-daemon /run/current-system/sw/lib/libsecret-1.so /run/current-system/sw/lib/security/pam_gnome_keyring.so # KDE Wallet ç»„ä»¶ï¼ˆNixOS ä¸­ä½äº nix storeï¼‰ /run/current-system/sw/bin/kwalletd5 /run/current-system/sw/bin/kwalletmanager5 /run/current-system/sw/lib/security/pam_kwallet.so # é…ç½®æ–‡ä»¶ä½ç½® ~/.local/share/keyrings/ # GNOME å¯†é’¥ç¯å­˜å‚¨ç›®å½• ~/.local/share/kwalletd/ # KDE é’±åŒ…æ–‡ä»¶å­˜å‚¨ç›®å½• ~/.config/kwalletrc # KDE é’±åŒ…é…ç½®æ–‡ä»¶ 3.3.2 å¯†é’¥ç¯ç±»å‹ä¸ç”¨é€” å¯†é’¥ç¯ç±»å‹ ç”¨é€” è§£é”æ—¶æœº login ç™»å½•å¯†é’¥ç¯ï¼Œå­˜å‚¨ç”¨æˆ·å¯†ç  ç”¨æˆ·ç™»å½•æ—¶è‡ªåŠ¨è§£é” default é»˜è®¤å¯†é’¥ç¯ï¼Œå­˜å‚¨åº”ç”¨å¯†ç  é¦–æ¬¡è®¿é—®æ—¶è§£é” session ä¼šè¯å¯†é’¥ç¯ï¼Œä¸´æ—¶å­˜å‚¨ ä¼šè¯å¼€å§‹æ—¶åˆ›å»º crypto åŠ å¯†å¯†é’¥ç¯ï¼Œå­˜å‚¨è¯ä¹¦å’Œç§é’¥ æŒ‰éœ€è§£é” 3.3.3 é’±åŒ…åˆ›å»ºä¸ç®¡ç†å›¾å½¢ç•Œé¢ç®¡ç†ï¼š bash # GNOME å¯†é’¥ç¯ç®¡ç†å™¨ seahorse # KDE é’±åŒ…ç®¡ç†å™¨ kwalletmanager5 é€šè¿‡å›¾å½¢ç•Œé¢å¯ä»¥ï¼š åˆ›å»ºæ–°çš„å¯†é’¥ç¯/é’±åŒ… è®¾ç½®å¯†ç å’ŒåŠ å¯†ç®—æ³• ç®¡ç†å­˜å‚¨çš„å¯†ç å’Œè¯ä¹¦ é…ç½®è‡ªåŠ¨è§£é”ç­–ç•¥ å¤‡ä»½å’Œæ¢å¤å¯†é’¥ç¯ åŸºæœ¬å‘½ä»¤è¡Œæ“ä½œï¼š bash # ä½¿ç”¨ secret-tool ç®¡ç† GNOME Keyring secret-tool store --label=\"My Password\" application myapp secret-tool lookup application myapp # ä½¿ç”¨ kwallet-query ç®¡ç† KDE Wallet kwallet-query --write password \"MyApp\" \"username\" \"password\" kwallet-query --read password \"MyApp\" \"username\" 3.3.4 åº”ç”¨ç¨‹åºé›†æˆå¸¸è§åº”ç”¨ç¨‹åºé›†æˆï¼š VSCodeï¼š è‡ªåŠ¨é›†æˆç³»ç»Ÿå¯†é’¥ç®¡ç†æœåŠ¡ å­˜å‚¨ Git å‡­æ®ã€æ‰©å±•è®¾ç½®ç­‰æ•æ„Ÿä¿¡æ¯ é€šè¿‡ git credential.helper é…ç½®è‡ªåŠ¨ä½¿ç”¨ GitHub CLIï¼š bash # é…ç½® GitHub CLI ä½¿ç”¨ç³»ç»Ÿå¯†é’¥ç®¡ç† gh auth login --web # å‡­æ®ä¼šè‡ªåŠ¨å­˜å‚¨åˆ°ç³»ç»Ÿå¯†é’¥ç¯ä¸­ æµè§ˆå™¨é›†æˆï¼š Firefoxã€Chrome ç­‰ç°ä»£æµè§ˆå™¨æ”¯æŒç³»ç»Ÿå¯†é’¥ç®¡ç† ç½‘ç«™å¯†ç è‡ªåŠ¨ä¿å­˜åˆ°å¯†é’¥ç¯/é’±åŒ…ä¸­ è·¨è®¾å¤‡åŒæ­¥ï¼ˆå¦‚æœå¯ç”¨ï¼‰ API é›†æˆç¤ºä¾‹ï¼š libsecret API 3.3.5 é…ç½®ä¸ä¼˜åŒ–NixOS é…ç½®ç¤ºä¾‹ï¼š nix # configuration.nix # å¯ç”¨ GNOME Keyring services.gnome.gnome-keyring.enable = true; # GNOME Keyring GUI å®¢æˆ·ç«¯ programs.seahorse.enable = true; # å¯ç”¨ PAM é›†æˆ security.pam.services.login.enableGnomeKeyring = true; ","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:4:3","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#333-é’±åŒ…åˆ›å»ºä¸ç®¡ç†"},{"categories":["tech"],"content":" 3.3 æ¡Œé¢å¯†é’¥ç®¡ç†ç°ä»£ Linux æ¡Œé¢ç¯å¢ƒæä¾›äº†ç»Ÿä¸€çš„å¯†é’¥ç®¡ç†æœåŠ¡ï¼Œç”¨äºå®‰å…¨å­˜å‚¨ç”¨æˆ·çš„å¯†ç ã€è¯ä¹¦ã€å¯†é’¥ç­‰æ•æ„Ÿä¿¡æ¯ã€‚ GNOME Keyring å’Œ KDE Wallet åˆ†åˆ«æ˜¯ GNOME å’Œ KDE æ¡Œé¢ç¯å¢ƒçš„å¯†é’¥ç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œå®ƒä»¬é€šè¿‡åŠ å¯†å­˜å‚¨å’Œè‡ªåŠ¨è§£é”æœºåˆ¶ï¼Œä¸ºç”¨æˆ·æä¾›äº†ä¾¿æ·è€Œå®‰å…¨çš„å¯†ç ç®¡ç†ä½“éªŒã€‚ GNOME Keyring å’Œ KDE Wallet éƒ½å®ç°äº†æ ‡å‡†çš„Secrets API, å¯ä»¥æ ¹æ®éœ€è¦ä»»é€‰ä¸€ä¸ªä½¿ç”¨ã€‚ä¸è¿‡æ®æˆ‘è§‚å¯Ÿå¤§éƒ¨åˆ†çª—å£ç®¡ç†å™¨çš„ç”¨æˆ·éƒ½æ˜¯ç”¨çš„ GNOME Keyring. 3.3.1 å¯†é’¥ç®¡ç†ç³»ç»Ÿæ¶æ„GNOME Keyring æ¶æ„ï¼š å¯†é’¥ç¯ï¼ˆKeyringï¼‰ï¼šåŠ å¯†çš„å­˜å‚¨å®¹å™¨ï¼Œæ¯ä¸ªå¯†é’¥ç¯æœ‰ç‹¬ç«‹çš„å¯†ç  å¯†é’¥ç¯å®ˆæŠ¤è¿›ç¨‹ï¼ˆgnome-keyring-daemonï¼‰ï¼šç®¡ç†å¯†é’¥ç¯çš„ç”Ÿå‘½å‘¨æœŸå’Œè®¿é—®æ§åˆ¶ APIï¼šGnome åŸç”Ÿæ”¯æŒ org.freedesktop.secrets DBus API, ç›®å‰æµè¡Œçš„ secrets å®¢æˆ·ç«¯åº“ libsecret ä¹Ÿæ˜¯ gnome å¼€å‘çš„ã€‚ PAM é›†æˆï¼šé€šè¿‡ pam_gnome_keyring.so å®ç°ç™»å½•æ—¶è‡ªåŠ¨è§£é” KDE Wallet æ¶æ„ï¼š KWalletManagerï¼šå›¾å½¢ç•Œé¢ç®¡ç†å·¥å…· kwalletdï¼šé’±åŒ…å®ˆæŠ¤è¿›ç¨‹ APIï¼šKDE Wallet ä» 5.97.0 ï¼ˆ2022 å¹´ 8 æœˆï¼‰å¼€å§‹æ”¯æŒorg.freedesktop.secrets DBus API, å› æ­¤å¯ä»¥ç›´æ¥é€šè¿‡ libsecret å¾€ KDE Wallet ä¸­å­˜å– passwords ç­‰ secret. PAM é›†æˆï¼šé€šè¿‡ pam_kwallet.so å®ç°è‡ªåŠ¨è§£é” æ ¸å¿ƒç»„ä»¶è·¯å¾„ï¼š bash # GNOME Keyring ç»„ä»¶ï¼ˆNixOS ä¸­ä½äº nix storeï¼‰ /run/current-system/sw/bin/gnome-keyring-daemon /run/current-system/sw/lib/libsecret-1.so /run/current-system/sw/lib/security/pam_gnome_keyring.so # KDE Wallet ç»„ä»¶ï¼ˆNixOS ä¸­ä½äº nix storeï¼‰ /run/current-system/sw/bin/kwalletd5 /run/current-system/sw/bin/kwalletmanager5 /run/current-system/sw/lib/security/pam_kwallet.so # é…ç½®æ–‡ä»¶ä½ç½® ~/.local/share/keyrings/ # GNOME å¯†é’¥ç¯å­˜å‚¨ç›®å½• ~/.local/share/kwalletd/ # KDE é’±åŒ…æ–‡ä»¶å­˜å‚¨ç›®å½• ~/.config/kwalletrc # KDE é’±åŒ…é…ç½®æ–‡ä»¶ 3.3.2 å¯†é’¥ç¯ç±»å‹ä¸ç”¨é€” å¯†é’¥ç¯ç±»å‹ ç”¨é€” è§£é”æ—¶æœº login ç™»å½•å¯†é’¥ç¯ï¼Œå­˜å‚¨ç”¨æˆ·å¯†ç  ç”¨æˆ·ç™»å½•æ—¶è‡ªåŠ¨è§£é” default é»˜è®¤å¯†é’¥ç¯ï¼Œå­˜å‚¨åº”ç”¨å¯†ç  é¦–æ¬¡è®¿é—®æ—¶è§£é” session ä¼šè¯å¯†é’¥ç¯ï¼Œä¸´æ—¶å­˜å‚¨ ä¼šè¯å¼€å§‹æ—¶åˆ›å»º crypto åŠ å¯†å¯†é’¥ç¯ï¼Œå­˜å‚¨è¯ä¹¦å’Œç§é’¥ æŒ‰éœ€è§£é” 3.3.3 é’±åŒ…åˆ›å»ºä¸ç®¡ç†å›¾å½¢ç•Œé¢ç®¡ç†ï¼š bash # GNOME å¯†é’¥ç¯ç®¡ç†å™¨ seahorse # KDE é’±åŒ…ç®¡ç†å™¨ kwalletmanager5 é€šè¿‡å›¾å½¢ç•Œé¢å¯ä»¥ï¼š åˆ›å»ºæ–°çš„å¯†é’¥ç¯/é’±åŒ… è®¾ç½®å¯†ç å’ŒåŠ å¯†ç®—æ³• ç®¡ç†å­˜å‚¨çš„å¯†ç å’Œè¯ä¹¦ é…ç½®è‡ªåŠ¨è§£é”ç­–ç•¥ å¤‡ä»½å’Œæ¢å¤å¯†é’¥ç¯ åŸºæœ¬å‘½ä»¤è¡Œæ“ä½œï¼š bash # ä½¿ç”¨ secret-tool ç®¡ç† GNOME Keyring secret-tool store --label=\"My Password\" application myapp secret-tool lookup application myapp # ä½¿ç”¨ kwallet-query ç®¡ç† KDE Wallet kwallet-query --write password \"MyApp\" \"username\" \"password\" kwallet-query --read password \"MyApp\" \"username\" 3.3.4 åº”ç”¨ç¨‹åºé›†æˆå¸¸è§åº”ç”¨ç¨‹åºé›†æˆï¼š VSCodeï¼š è‡ªåŠ¨é›†æˆç³»ç»Ÿå¯†é’¥ç®¡ç†æœåŠ¡ å­˜å‚¨ Git å‡­æ®ã€æ‰©å±•è®¾ç½®ç­‰æ•æ„Ÿä¿¡æ¯ é€šè¿‡ git credential.helper é…ç½®è‡ªåŠ¨ä½¿ç”¨ GitHub CLIï¼š bash # é…ç½® GitHub CLI ä½¿ç”¨ç³»ç»Ÿå¯†é’¥ç®¡ç† gh auth login --web # å‡­æ®ä¼šè‡ªåŠ¨å­˜å‚¨åˆ°ç³»ç»Ÿå¯†é’¥ç¯ä¸­ æµè§ˆå™¨é›†æˆï¼š Firefoxã€Chrome ç­‰ç°ä»£æµè§ˆå™¨æ”¯æŒç³»ç»Ÿå¯†é’¥ç®¡ç† ç½‘ç«™å¯†ç è‡ªåŠ¨ä¿å­˜åˆ°å¯†é’¥ç¯/é’±åŒ…ä¸­ è·¨è®¾å¤‡åŒæ­¥ï¼ˆå¦‚æœå¯ç”¨ï¼‰ API é›†æˆç¤ºä¾‹ï¼š libsecret API 3.3.5 é…ç½®ä¸ä¼˜åŒ–NixOS é…ç½®ç¤ºä¾‹ï¼š nix # configuration.nix # å¯ç”¨ GNOME Keyring services.gnome.gnome-keyring.enable = true; # GNOME Keyring GUI å®¢æˆ·ç«¯ programs.seahorse.enable = true; # å¯ç”¨ PAM é›†æˆ security.pam.services.login.enableGnomeKeyring = true; ","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:4:3","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#334-åº”ç”¨ç¨‹åºé›†æˆ"},{"categories":["tech"],"content":" 3.3 æ¡Œé¢å¯†é’¥ç®¡ç†ç°ä»£ Linux æ¡Œé¢ç¯å¢ƒæä¾›äº†ç»Ÿä¸€çš„å¯†é’¥ç®¡ç†æœåŠ¡ï¼Œç”¨äºå®‰å…¨å­˜å‚¨ç”¨æˆ·çš„å¯†ç ã€è¯ä¹¦ã€å¯†é’¥ç­‰æ•æ„Ÿä¿¡æ¯ã€‚ GNOME Keyring å’Œ KDE Wallet åˆ†åˆ«æ˜¯ GNOME å’Œ KDE æ¡Œé¢ç¯å¢ƒçš„å¯†é’¥ç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œå®ƒä»¬é€šè¿‡åŠ å¯†å­˜å‚¨å’Œè‡ªåŠ¨è§£é”æœºåˆ¶ï¼Œä¸ºç”¨æˆ·æä¾›äº†ä¾¿æ·è€Œå®‰å…¨çš„å¯†ç ç®¡ç†ä½“éªŒã€‚ GNOME Keyring å’Œ KDE Wallet éƒ½å®ç°äº†æ ‡å‡†çš„Secrets API, å¯ä»¥æ ¹æ®éœ€è¦ä»»é€‰ä¸€ä¸ªä½¿ç”¨ã€‚ä¸è¿‡æ®æˆ‘è§‚å¯Ÿå¤§éƒ¨åˆ†çª—å£ç®¡ç†å™¨çš„ç”¨æˆ·éƒ½æ˜¯ç”¨çš„ GNOME Keyring. 3.3.1 å¯†é’¥ç®¡ç†ç³»ç»Ÿæ¶æ„GNOME Keyring æ¶æ„ï¼š å¯†é’¥ç¯ï¼ˆKeyringï¼‰ï¼šåŠ å¯†çš„å­˜å‚¨å®¹å™¨ï¼Œæ¯ä¸ªå¯†é’¥ç¯æœ‰ç‹¬ç«‹çš„å¯†ç  å¯†é’¥ç¯å®ˆæŠ¤è¿›ç¨‹ï¼ˆgnome-keyring-daemonï¼‰ï¼šç®¡ç†å¯†é’¥ç¯çš„ç”Ÿå‘½å‘¨æœŸå’Œè®¿é—®æ§åˆ¶ APIï¼šGnome åŸç”Ÿæ”¯æŒ org.freedesktop.secrets DBus API, ç›®å‰æµè¡Œçš„ secrets å®¢æˆ·ç«¯åº“ libsecret ä¹Ÿæ˜¯ gnome å¼€å‘çš„ã€‚ PAM é›†æˆï¼šé€šè¿‡ pam_gnome_keyring.so å®ç°ç™»å½•æ—¶è‡ªåŠ¨è§£é” KDE Wallet æ¶æ„ï¼š KWalletManagerï¼šå›¾å½¢ç•Œé¢ç®¡ç†å·¥å…· kwalletdï¼šé’±åŒ…å®ˆæŠ¤è¿›ç¨‹ APIï¼šKDE Wallet ä» 5.97.0 ï¼ˆ2022 å¹´ 8 æœˆï¼‰å¼€å§‹æ”¯æŒorg.freedesktop.secrets DBus API, å› æ­¤å¯ä»¥ç›´æ¥é€šè¿‡ libsecret å¾€ KDE Wallet ä¸­å­˜å– passwords ç­‰ secret. PAM é›†æˆï¼šé€šè¿‡ pam_kwallet.so å®ç°è‡ªåŠ¨è§£é” æ ¸å¿ƒç»„ä»¶è·¯å¾„ï¼š bash # GNOME Keyring ç»„ä»¶ï¼ˆNixOS ä¸­ä½äº nix storeï¼‰ /run/current-system/sw/bin/gnome-keyring-daemon /run/current-system/sw/lib/libsecret-1.so /run/current-system/sw/lib/security/pam_gnome_keyring.so # KDE Wallet ç»„ä»¶ï¼ˆNixOS ä¸­ä½äº nix storeï¼‰ /run/current-system/sw/bin/kwalletd5 /run/current-system/sw/bin/kwalletmanager5 /run/current-system/sw/lib/security/pam_kwallet.so # é…ç½®æ–‡ä»¶ä½ç½® ~/.local/share/keyrings/ # GNOME å¯†é’¥ç¯å­˜å‚¨ç›®å½• ~/.local/share/kwalletd/ # KDE é’±åŒ…æ–‡ä»¶å­˜å‚¨ç›®å½• ~/.config/kwalletrc # KDE é’±åŒ…é…ç½®æ–‡ä»¶ 3.3.2 å¯†é’¥ç¯ç±»å‹ä¸ç”¨é€” å¯†é’¥ç¯ç±»å‹ ç”¨é€” è§£é”æ—¶æœº login ç™»å½•å¯†é’¥ç¯ï¼Œå­˜å‚¨ç”¨æˆ·å¯†ç  ç”¨æˆ·ç™»å½•æ—¶è‡ªåŠ¨è§£é” default é»˜è®¤å¯†é’¥ç¯ï¼Œå­˜å‚¨åº”ç”¨å¯†ç  é¦–æ¬¡è®¿é—®æ—¶è§£é” session ä¼šè¯å¯†é’¥ç¯ï¼Œä¸´æ—¶å­˜å‚¨ ä¼šè¯å¼€å§‹æ—¶åˆ›å»º crypto åŠ å¯†å¯†é’¥ç¯ï¼Œå­˜å‚¨è¯ä¹¦å’Œç§é’¥ æŒ‰éœ€è§£é” 3.3.3 é’±åŒ…åˆ›å»ºä¸ç®¡ç†å›¾å½¢ç•Œé¢ç®¡ç†ï¼š bash # GNOME å¯†é’¥ç¯ç®¡ç†å™¨ seahorse # KDE é’±åŒ…ç®¡ç†å™¨ kwalletmanager5 é€šè¿‡å›¾å½¢ç•Œé¢å¯ä»¥ï¼š åˆ›å»ºæ–°çš„å¯†é’¥ç¯/é’±åŒ… è®¾ç½®å¯†ç å’ŒåŠ å¯†ç®—æ³• ç®¡ç†å­˜å‚¨çš„å¯†ç å’Œè¯ä¹¦ é…ç½®è‡ªåŠ¨è§£é”ç­–ç•¥ å¤‡ä»½å’Œæ¢å¤å¯†é’¥ç¯ åŸºæœ¬å‘½ä»¤è¡Œæ“ä½œï¼š bash # ä½¿ç”¨ secret-tool ç®¡ç† GNOME Keyring secret-tool store --label=\"My Password\" application myapp secret-tool lookup application myapp # ä½¿ç”¨ kwallet-query ç®¡ç† KDE Wallet kwallet-query --write password \"MyApp\" \"username\" \"password\" kwallet-query --read password \"MyApp\" \"username\" 3.3.4 åº”ç”¨ç¨‹åºé›†æˆå¸¸è§åº”ç”¨ç¨‹åºé›†æˆï¼š VSCodeï¼š è‡ªåŠ¨é›†æˆç³»ç»Ÿå¯†é’¥ç®¡ç†æœåŠ¡ å­˜å‚¨ Git å‡­æ®ã€æ‰©å±•è®¾ç½®ç­‰æ•æ„Ÿä¿¡æ¯ é€šè¿‡ git credential.helper é…ç½®è‡ªåŠ¨ä½¿ç”¨ GitHub CLIï¼š bash # é…ç½® GitHub CLI ä½¿ç”¨ç³»ç»Ÿå¯†é’¥ç®¡ç† gh auth login --web # å‡­æ®ä¼šè‡ªåŠ¨å­˜å‚¨åˆ°ç³»ç»Ÿå¯†é’¥ç¯ä¸­ æµè§ˆå™¨é›†æˆï¼š Firefoxã€Chrome ç­‰ç°ä»£æµè§ˆå™¨æ”¯æŒç³»ç»Ÿå¯†é’¥ç®¡ç† ç½‘ç«™å¯†ç è‡ªåŠ¨ä¿å­˜åˆ°å¯†é’¥ç¯/é’±åŒ…ä¸­ è·¨è®¾å¤‡åŒæ­¥ï¼ˆå¦‚æœå¯ç”¨ï¼‰ API é›†æˆç¤ºä¾‹ï¼š libsecret API 3.3.5 é…ç½®ä¸ä¼˜åŒ–NixOS é…ç½®ç¤ºä¾‹ï¼š nix # configuration.nix # å¯ç”¨ GNOME Keyring services.gnome.gnome-keyring.enable = true; # GNOME Keyring GUI å®¢æˆ·ç«¯ programs.seahorse.enable = true; # å¯ç”¨ PAM é›†æˆ security.pam.services.login.enableGnomeKeyring = true; ","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:4:3","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#335-é…ç½®ä¸ä¼˜åŒ–"},{"categories":["tech"],"content":" 3.4 å®‰å…¨æ•…éšœæ’æŸ¥ 3.4.1 è®¤è¯é—®é¢˜æ’æŸ¥å¸¸è§è®¤è¯å¤±è´¥åœºæ™¯ï¼š ç”¨æˆ·æ— æ³•ç™»å½• æ£€æŸ¥ PAM é…ç½®æ˜¯å¦æ­£ç¡® æŸ¥çœ‹è®¤è¯æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯ éªŒè¯ç”¨æˆ·è´¦æˆ·çŠ¶æ€å’Œå¯†ç  sudo æƒé™é—®é¢˜ ç¡®è®¤ç”¨æˆ·åœ¨æ­£ç¡®çš„ç”¨æˆ·ç»„ä¸­ æ£€æŸ¥ sudoers é…ç½® éªŒè¯ PAM è®¤è¯æµç¨‹ SSH ç™»å½•å¤±è´¥ æ£€æŸ¥ SSH æœåŠ¡çŠ¶æ€ æŸ¥çœ‹ SSH è®¤è¯æ—¥å¿— éªŒè¯ç½‘ç»œè¿æ¥å’Œé˜²ç«å¢™è®¾ç½® 3.4.2 æƒé™ç®¡ç†é—®é¢˜æ’æŸ¥PolicyKit æƒé™é—®é¢˜ï¼š æ— æ³•å…³æœº/é‡å¯ï¼šæ£€æŸ¥ PolicyKit è§„åˆ™é…ç½®å’Œç”¨æˆ·ç»„æƒé™ æ— æ³•æŒ‚è½½è®¾å¤‡ï¼šæ£€æŸ¥ udisks2 æœåŠ¡å’Œ PolicyKit é›†æˆ æ— æ³•ä¿®æ”¹ç³»ç»Ÿæ—¶é—´ï¼šæ£€æŸ¥æ—¶é—´åŒæ­¥æœåŠ¡æƒé™å’Œç”¨æˆ·ç»„è®¾ç½® 3.4.3 å¯†é’¥ç®¡ç†é—®é¢˜æ’æŸ¥GNOME Keyring é—®é¢˜ï¼š æ£€æŸ¥å¯†é’¥ç¯å®ˆæŠ¤è¿›ç¨‹æ˜¯å¦æ­£å¸¸è¿è¡Œ éªŒè¯ PAM é›†æˆæ˜¯å¦æ­£ç¡®é…ç½® æŸ¥çœ‹å¯†é’¥ç¯çŠ¶æ€å’Œè‡ªåŠ¨è§£é”è®¾ç½® KDE Wallet é—®é¢˜ï¼š æ£€æŸ¥é’±åŒ…å®ˆæŠ¤è¿›ç¨‹çŠ¶æ€ éªŒè¯é’±åŒ…é…ç½®å’Œè®¿é—®æƒé™ æµ‹è¯•é’±åŒ…çš„è¯»å†™åŠŸèƒ½ å…·ä½“çš„è°ƒè¯•å‘½ä»¤å’Œæ’æŸ¥æ­¥éª¤è¯·å‚è€ƒ 3.5.3 æ•…éšœæ’æŸ¥ ç« èŠ‚ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:4:4","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#34-å®‰å…¨æ•…éšœæ’æŸ¥"},{"categories":["tech"],"content":" 3.4 å®‰å…¨æ•…éšœæ’æŸ¥ 3.4.1 è®¤è¯é—®é¢˜æ’æŸ¥å¸¸è§è®¤è¯å¤±è´¥åœºæ™¯ï¼š ç”¨æˆ·æ— æ³•ç™»å½• æ£€æŸ¥ PAM é…ç½®æ˜¯å¦æ­£ç¡® æŸ¥çœ‹è®¤è¯æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯ éªŒè¯ç”¨æˆ·è´¦æˆ·çŠ¶æ€å’Œå¯†ç  sudo æƒé™é—®é¢˜ ç¡®è®¤ç”¨æˆ·åœ¨æ­£ç¡®çš„ç”¨æˆ·ç»„ä¸­ æ£€æŸ¥ sudoers é…ç½® éªŒè¯ PAM è®¤è¯æµç¨‹ SSH ç™»å½•å¤±è´¥ æ£€æŸ¥ SSH æœåŠ¡çŠ¶æ€ æŸ¥çœ‹ SSH è®¤è¯æ—¥å¿— éªŒè¯ç½‘ç»œè¿æ¥å’Œé˜²ç«å¢™è®¾ç½® 3.4.2 æƒé™ç®¡ç†é—®é¢˜æ’æŸ¥PolicyKit æƒé™é—®é¢˜ï¼š æ— æ³•å…³æœº/é‡å¯ï¼šæ£€æŸ¥ PolicyKit è§„åˆ™é…ç½®å’Œç”¨æˆ·ç»„æƒé™ æ— æ³•æŒ‚è½½è®¾å¤‡ï¼šæ£€æŸ¥ udisks2 æœåŠ¡å’Œ PolicyKit é›†æˆ æ— æ³•ä¿®æ”¹ç³»ç»Ÿæ—¶é—´ï¼šæ£€æŸ¥æ—¶é—´åŒæ­¥æœåŠ¡æƒé™å’Œç”¨æˆ·ç»„è®¾ç½® 3.4.3 å¯†é’¥ç®¡ç†é—®é¢˜æ’æŸ¥GNOME Keyring é—®é¢˜ï¼š æ£€æŸ¥å¯†é’¥ç¯å®ˆæŠ¤è¿›ç¨‹æ˜¯å¦æ­£å¸¸è¿è¡Œ éªŒè¯ PAM é›†æˆæ˜¯å¦æ­£ç¡®é…ç½® æŸ¥çœ‹å¯†é’¥ç¯çŠ¶æ€å’Œè‡ªåŠ¨è§£é”è®¾ç½® KDE Wallet é—®é¢˜ï¼š æ£€æŸ¥é’±åŒ…å®ˆæŠ¤è¿›ç¨‹çŠ¶æ€ éªŒè¯é’±åŒ…é…ç½®å’Œè®¿é—®æƒé™ æµ‹è¯•é’±åŒ…çš„è¯»å†™åŠŸèƒ½ å…·ä½“çš„è°ƒè¯•å‘½ä»¤å’Œæ’æŸ¥æ­¥éª¤è¯·å‚è€ƒ 3.5.3 æ•…éšœæ’æŸ¥ ç« èŠ‚ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:4:4","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#341-è®¤è¯é—®é¢˜æ’æŸ¥"},{"categories":["tech"],"content":" 3.4 å®‰å…¨æ•…éšœæ’æŸ¥ 3.4.1 è®¤è¯é—®é¢˜æ’æŸ¥å¸¸è§è®¤è¯å¤±è´¥åœºæ™¯ï¼š ç”¨æˆ·æ— æ³•ç™»å½• æ£€æŸ¥ PAM é…ç½®æ˜¯å¦æ­£ç¡® æŸ¥çœ‹è®¤è¯æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯ éªŒè¯ç”¨æˆ·è´¦æˆ·çŠ¶æ€å’Œå¯†ç  sudo æƒé™é—®é¢˜ ç¡®è®¤ç”¨æˆ·åœ¨æ­£ç¡®çš„ç”¨æˆ·ç»„ä¸­ æ£€æŸ¥ sudoers é…ç½® éªŒè¯ PAM è®¤è¯æµç¨‹ SSH ç™»å½•å¤±è´¥ æ£€æŸ¥ SSH æœåŠ¡çŠ¶æ€ æŸ¥çœ‹ SSH è®¤è¯æ—¥å¿— éªŒè¯ç½‘ç»œè¿æ¥å’Œé˜²ç«å¢™è®¾ç½® 3.4.2 æƒé™ç®¡ç†é—®é¢˜æ’æŸ¥PolicyKit æƒé™é—®é¢˜ï¼š æ— æ³•å…³æœº/é‡å¯ï¼šæ£€æŸ¥ PolicyKit è§„åˆ™é…ç½®å’Œç”¨æˆ·ç»„æƒé™ æ— æ³•æŒ‚è½½è®¾å¤‡ï¼šæ£€æŸ¥ udisks2 æœåŠ¡å’Œ PolicyKit é›†æˆ æ— æ³•ä¿®æ”¹ç³»ç»Ÿæ—¶é—´ï¼šæ£€æŸ¥æ—¶é—´åŒæ­¥æœåŠ¡æƒé™å’Œç”¨æˆ·ç»„è®¾ç½® 3.4.3 å¯†é’¥ç®¡ç†é—®é¢˜æ’æŸ¥GNOME Keyring é—®é¢˜ï¼š æ£€æŸ¥å¯†é’¥ç¯å®ˆæŠ¤è¿›ç¨‹æ˜¯å¦æ­£å¸¸è¿è¡Œ éªŒè¯ PAM é›†æˆæ˜¯å¦æ­£ç¡®é…ç½® æŸ¥çœ‹å¯†é’¥ç¯çŠ¶æ€å’Œè‡ªåŠ¨è§£é”è®¾ç½® KDE Wallet é—®é¢˜ï¼š æ£€æŸ¥é’±åŒ…å®ˆæŠ¤è¿›ç¨‹çŠ¶æ€ éªŒè¯é’±åŒ…é…ç½®å’Œè®¿é—®æƒé™ æµ‹è¯•é’±åŒ…çš„è¯»å†™åŠŸèƒ½ å…·ä½“çš„è°ƒè¯•å‘½ä»¤å’Œæ’æŸ¥æ­¥éª¤è¯·å‚è€ƒ 3.5.3 æ•…éšœæ’æŸ¥ ç« èŠ‚ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:4:4","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#342-æƒé™ç®¡ç†é—®é¢˜æ’æŸ¥"},{"categories":["tech"],"content":" 3.4 å®‰å…¨æ•…éšœæ’æŸ¥ 3.4.1 è®¤è¯é—®é¢˜æ’æŸ¥å¸¸è§è®¤è¯å¤±è´¥åœºæ™¯ï¼š ç”¨æˆ·æ— æ³•ç™»å½• æ£€æŸ¥ PAM é…ç½®æ˜¯å¦æ­£ç¡® æŸ¥çœ‹è®¤è¯æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯ éªŒè¯ç”¨æˆ·è´¦æˆ·çŠ¶æ€å’Œå¯†ç  sudo æƒé™é—®é¢˜ ç¡®è®¤ç”¨æˆ·åœ¨æ­£ç¡®çš„ç”¨æˆ·ç»„ä¸­ æ£€æŸ¥ sudoers é…ç½® éªŒè¯ PAM è®¤è¯æµç¨‹ SSH ç™»å½•å¤±è´¥ æ£€æŸ¥ SSH æœåŠ¡çŠ¶æ€ æŸ¥çœ‹ SSH è®¤è¯æ—¥å¿— éªŒè¯ç½‘ç»œè¿æ¥å’Œé˜²ç«å¢™è®¾ç½® 3.4.2 æƒé™ç®¡ç†é—®é¢˜æ’æŸ¥PolicyKit æƒé™é—®é¢˜ï¼š æ— æ³•å…³æœº/é‡å¯ï¼šæ£€æŸ¥ PolicyKit è§„åˆ™é…ç½®å’Œç”¨æˆ·ç»„æƒé™ æ— æ³•æŒ‚è½½è®¾å¤‡ï¼šæ£€æŸ¥ udisks2 æœåŠ¡å’Œ PolicyKit é›†æˆ æ— æ³•ä¿®æ”¹ç³»ç»Ÿæ—¶é—´ï¼šæ£€æŸ¥æ—¶é—´åŒæ­¥æœåŠ¡æƒé™å’Œç”¨æˆ·ç»„è®¾ç½® 3.4.3 å¯†é’¥ç®¡ç†é—®é¢˜æ’æŸ¥GNOME Keyring é—®é¢˜ï¼š æ£€æŸ¥å¯†é’¥ç¯å®ˆæŠ¤è¿›ç¨‹æ˜¯å¦æ­£å¸¸è¿è¡Œ éªŒè¯ PAM é›†æˆæ˜¯å¦æ­£ç¡®é…ç½® æŸ¥çœ‹å¯†é’¥ç¯çŠ¶æ€å’Œè‡ªåŠ¨è§£é”è®¾ç½® KDE Wallet é—®é¢˜ï¼š æ£€æŸ¥é’±åŒ…å®ˆæŠ¤è¿›ç¨‹çŠ¶æ€ éªŒè¯é’±åŒ…é…ç½®å’Œè®¿é—®æƒé™ æµ‹è¯•é’±åŒ…çš„è¯»å†™åŠŸèƒ½ å…·ä½“çš„è°ƒè¯•å‘½ä»¤å’Œæ’æŸ¥æ­¥éª¤è¯·å‚è€ƒ 3.5.3 æ•…éšœæ’æŸ¥ ç« èŠ‚ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:4:4","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#343-å¯†é’¥ç®¡ç†é—®é¢˜æ’æŸ¥"},{"categories":["tech"],"content":" 3.5 å®‰å…¨ç»„ä»¶é›†æˆä¸æœ€ä½³å®è·µ 3.5.1 ç»„ä»¶åä½œæµç¨‹ç°ä»£ Linux æ¡Œé¢çš„å®‰å…¨ç»„ä»¶åä½œæµç¨‹ï¼š ç”¨æˆ·ç™»å½•ï¼šPAM éªŒè¯ç”¨æˆ·èº«ä»½ å¯†é’¥ç¯è§£é”ï¼šPAM æ¨¡å—è‡ªåŠ¨è§£é”ç”¨æˆ·å¯†é’¥ç¯/é’±åŒ… åº”ç”¨å¯åŠ¨ï¼šåº”ç”¨ç¨‹åºé€šè¿‡ libsecret/KWallet API è®¿é—®å­˜å‚¨çš„å¯†ç  ç‰¹æƒæ“ä½œï¼šPolicyKit æ§åˆ¶éœ€è¦ç‰¹æƒçš„ç³»ç»Ÿæ“ä½œ ä¼šè¯ç»“æŸï¼šå¯†é’¥ç¯/é’±åŒ…è‡ªåŠ¨é”å®š 3.5.2 å®‰å…¨æœ€ä½³å®è·µå¯†é’¥ç®¡ç†ï¼š ä½¿ç”¨å¼ºå¯†ç ä¿æŠ¤å¯†é’¥ç¯/é’±åŒ… å®šæœŸå¤‡ä»½å¯†é’¥ç¯æ–‡ä»¶ é¿å…åœ¨è„šæœ¬ä¸­ç¡¬ç¼–ç å¯†ç  ä½¿ç”¨åº”ç”¨ç¨‹åºä¸“ç”¨çš„å¯†é’¥ç¯ è®¤è¯é…ç½®ï¼š bash # å¯ç”¨åŒå› å­è®¤è¯ auth required pam_google_authenticator.so auth required pam_unix.so # é…ç½®å¯†ç ç­–ç•¥ password required pam_cracklib.so retry=3 minlen=8 difok=3 password required pam_unix.so use_authtok æƒé™ç®¡ç†ï¼š javascript // PolicyKit è§„åˆ™ç¤ºä¾‹ï¼šé™åˆ¶ç‰¹å®šæ“ä½œ polkit.addRule(function (action, subject) { if (action.id == \"org.freedesktop.login1.power-off\" \u0026\u0026 subject.user == \"guest\") { return polkit.Result.NO } }) 3.5.3 æ•…éšœæ’æŸ¥PAM è®¤è¯è°ƒè¯•ï¼š bash nix shell nixpkgs#pamtester # æµ‹è¯• PAM é…ç½® pamtester login $USER authenticate pamtester sudo $USER authenticate # æŸ¥çœ‹ PAM é…ç½® cat /etc/pam.d/login cat /etc/pam.d/greetd cat /etc/pam.d/sudo # æ£€æŸ¥ PAM æ¨¡å— ldd /run/current-system/sw/lib/security/pam_unix.so ldd /run/current-system/sw/lib/security/pam_gnome_keyring.so # æŸ¥çœ‹è®¤è¯æ—¥å¿— journalctl -t login -f journalctl -t greetd -f journalctl -t sshd -f journalctl -t sudo # éªŒè¯ç¨‹åºä¸é…ç½®çš„å¯¹åº”å…³ç³» strace -e trace=pam_start login 2\u003e\u00261 | grep pam_start strace -e trace=openat login 2\u003e\u00261 | grep pam.d PolicyKit æƒé™è°ƒè¯•ï¼š bash # æ£€æŸ¥ PolicyKit æœåŠ¡çŠ¶æ€ systemctl status polkit # æµ‹è¯•ç‰¹å®šæƒé™ pkcheck --action-id org.freedesktop.login1.power-off --process $$ --allow-user-interaction # æŸ¥çœ‹ PolicyKit æ—¥å¿— journalctl -u polkit -f # æŸ¥çœ‹ PolicyKit åŠ¨ä½œå®šä¹‰ ls -la /run/current-system/sw/share/polkit-1/actions/ # æŸ¥çœ‹å½“å‰ç”Ÿæ•ˆçš„ PolicyKit è§„åˆ™ ls -la /etc/polkit-1/rules.d/ å¯†é’¥ç®¡ç†è°ƒè¯•ï¼š bash # GNOME Keyring æ£€æŸ¥ ps aux | grep gnome-keyring seahorse # GNOME Keyring GUI # KDE Wallet æ£€æŸ¥ ps aux | grep kwalletd kwalletmanager5 # KDE Wallet GUI kwallet-query kdewallet --list-entries # ç³»ç»Ÿæ—¥å¿—æ£€æŸ¥ sudo journalctl -u systemd-logind è°ƒè¯•æŠ€å·§ï¼š ä½¿ç”¨ strace è·Ÿè¸ªåº”ç”¨ç¨‹åºçš„å¯†é’¥è®¿é—® é€šè¿‡ journalctl æŸ¥çœ‹è®¤è¯å’Œæˆæƒæ—¥å¿— ä½¿ç”¨ pamtester æµ‹è¯• PAM é…ç½® é€šè¿‡ pkcheck æµ‹è¯• PolicyKit æƒé™ é€šè¿‡ç†è§£è¿™äº›å®‰å…¨ç»„ä»¶çš„åä½œæœºåˆ¶ï¼Œç”¨æˆ·å¯ä»¥æ›´å¥½åœ°é…ç½®å’Œç®¡ç† Linux æ¡Œé¢çš„å®‰å…¨ç­–ç•¥ï¼Œåœ¨ä¿è¯å®‰å…¨æ€§çš„åŒæ—¶æä¾›è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:4:5","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#35-å®‰å…¨ç»„ä»¶é›†æˆä¸æœ€ä½³å®è·µ"},{"categories":["tech"],"content":" 3.5 å®‰å…¨ç»„ä»¶é›†æˆä¸æœ€ä½³å®è·µ 3.5.1 ç»„ä»¶åä½œæµç¨‹ç°ä»£ Linux æ¡Œé¢çš„å®‰å…¨ç»„ä»¶åä½œæµç¨‹ï¼š ç”¨æˆ·ç™»å½•ï¼šPAM éªŒè¯ç”¨æˆ·èº«ä»½ å¯†é’¥ç¯è§£é”ï¼šPAM æ¨¡å—è‡ªåŠ¨è§£é”ç”¨æˆ·å¯†é’¥ç¯/é’±åŒ… åº”ç”¨å¯åŠ¨ï¼šåº”ç”¨ç¨‹åºé€šè¿‡ libsecret/KWallet API è®¿é—®å­˜å‚¨çš„å¯†ç  ç‰¹æƒæ“ä½œï¼šPolicyKit æ§åˆ¶éœ€è¦ç‰¹æƒçš„ç³»ç»Ÿæ“ä½œ ä¼šè¯ç»“æŸï¼šå¯†é’¥ç¯/é’±åŒ…è‡ªåŠ¨é”å®š 3.5.2 å®‰å…¨æœ€ä½³å®è·µå¯†é’¥ç®¡ç†ï¼š ä½¿ç”¨å¼ºå¯†ç ä¿æŠ¤å¯†é’¥ç¯/é’±åŒ… å®šæœŸå¤‡ä»½å¯†é’¥ç¯æ–‡ä»¶ é¿å…åœ¨è„šæœ¬ä¸­ç¡¬ç¼–ç å¯†ç  ä½¿ç”¨åº”ç”¨ç¨‹åºä¸“ç”¨çš„å¯†é’¥ç¯ è®¤è¯é…ç½®ï¼š bash # å¯ç”¨åŒå› å­è®¤è¯ auth required pam_google_authenticator.so auth required pam_unix.so # é…ç½®å¯†ç ç­–ç•¥ password required pam_cracklib.so retry=3 minlen=8 difok=3 password required pam_unix.so use_authtok æƒé™ç®¡ç†ï¼š javascript // PolicyKit è§„åˆ™ç¤ºä¾‹ï¼šé™åˆ¶ç‰¹å®šæ“ä½œ polkit.addRule(function (action, subject) { if (action.id == \"org.freedesktop.login1.power-off\" \u0026\u0026 subject.user == \"guest\") { return polkit.Result.NO } }) 3.5.3 æ•…éšœæ’æŸ¥PAM è®¤è¯è°ƒè¯•ï¼š bash nix shell nixpkgs#pamtester # æµ‹è¯• PAM é…ç½® pamtester login $USER authenticate pamtester sudo $USER authenticate # æŸ¥çœ‹ PAM é…ç½® cat /etc/pam.d/login cat /etc/pam.d/greetd cat /etc/pam.d/sudo # æ£€æŸ¥ PAM æ¨¡å— ldd /run/current-system/sw/lib/security/pam_unix.so ldd /run/current-system/sw/lib/security/pam_gnome_keyring.so # æŸ¥çœ‹è®¤è¯æ—¥å¿— journalctl -t login -f journalctl -t greetd -f journalctl -t sshd -f journalctl -t sudo # éªŒè¯ç¨‹åºä¸é…ç½®çš„å¯¹åº”å…³ç³» strace -e trace=pam_start login 2\u003e\u00261 | grep pam_start strace -e trace=openat login 2\u003e\u00261 | grep pam.d PolicyKit æƒé™è°ƒè¯•ï¼š bash # æ£€æŸ¥ PolicyKit æœåŠ¡çŠ¶æ€ systemctl status polkit # æµ‹è¯•ç‰¹å®šæƒé™ pkcheck --action-id org.freedesktop.login1.power-off --process $$ --allow-user-interaction # æŸ¥çœ‹ PolicyKit æ—¥å¿— journalctl -u polkit -f # æŸ¥çœ‹ PolicyKit åŠ¨ä½œå®šä¹‰ ls -la /run/current-system/sw/share/polkit-1/actions/ # æŸ¥çœ‹å½“å‰ç”Ÿæ•ˆçš„ PolicyKit è§„åˆ™ ls -la /etc/polkit-1/rules.d/ å¯†é’¥ç®¡ç†è°ƒè¯•ï¼š bash # GNOME Keyring æ£€æŸ¥ ps aux | grep gnome-keyring seahorse # GNOME Keyring GUI # KDE Wallet æ£€æŸ¥ ps aux | grep kwalletd kwalletmanager5 # KDE Wallet GUI kwallet-query kdewallet --list-entries # ç³»ç»Ÿæ—¥å¿—æ£€æŸ¥ sudo journalctl -u systemd-logind è°ƒè¯•æŠ€å·§ï¼š ä½¿ç”¨ strace è·Ÿè¸ªåº”ç”¨ç¨‹åºçš„å¯†é’¥è®¿é—® é€šè¿‡ journalctl æŸ¥çœ‹è®¤è¯å’Œæˆæƒæ—¥å¿— ä½¿ç”¨ pamtester æµ‹è¯• PAM é…ç½® é€šè¿‡ pkcheck æµ‹è¯• PolicyKit æƒé™ é€šè¿‡ç†è§£è¿™äº›å®‰å…¨ç»„ä»¶çš„åä½œæœºåˆ¶ï¼Œç”¨æˆ·å¯ä»¥æ›´å¥½åœ°é…ç½®å’Œç®¡ç† Linux æ¡Œé¢çš„å®‰å…¨ç­–ç•¥ï¼Œåœ¨ä¿è¯å®‰å…¨æ€§çš„åŒæ—¶æä¾›è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:4:5","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#351-ç»„ä»¶åä½œæµç¨‹"},{"categories":["tech"],"content":" 3.5 å®‰å…¨ç»„ä»¶é›†æˆä¸æœ€ä½³å®è·µ 3.5.1 ç»„ä»¶åä½œæµç¨‹ç°ä»£ Linux æ¡Œé¢çš„å®‰å…¨ç»„ä»¶åä½œæµç¨‹ï¼š ç”¨æˆ·ç™»å½•ï¼šPAM éªŒè¯ç”¨æˆ·èº«ä»½ å¯†é’¥ç¯è§£é”ï¼šPAM æ¨¡å—è‡ªåŠ¨è§£é”ç”¨æˆ·å¯†é’¥ç¯/é’±åŒ… åº”ç”¨å¯åŠ¨ï¼šåº”ç”¨ç¨‹åºé€šè¿‡ libsecret/KWallet API è®¿é—®å­˜å‚¨çš„å¯†ç  ç‰¹æƒæ“ä½œï¼šPolicyKit æ§åˆ¶éœ€è¦ç‰¹æƒçš„ç³»ç»Ÿæ“ä½œ ä¼šè¯ç»“æŸï¼šå¯†é’¥ç¯/é’±åŒ…è‡ªåŠ¨é”å®š 3.5.2 å®‰å…¨æœ€ä½³å®è·µå¯†é’¥ç®¡ç†ï¼š ä½¿ç”¨å¼ºå¯†ç ä¿æŠ¤å¯†é’¥ç¯/é’±åŒ… å®šæœŸå¤‡ä»½å¯†é’¥ç¯æ–‡ä»¶ é¿å…åœ¨è„šæœ¬ä¸­ç¡¬ç¼–ç å¯†ç  ä½¿ç”¨åº”ç”¨ç¨‹åºä¸“ç”¨çš„å¯†é’¥ç¯ è®¤è¯é…ç½®ï¼š bash # å¯ç”¨åŒå› å­è®¤è¯ auth required pam_google_authenticator.so auth required pam_unix.so # é…ç½®å¯†ç ç­–ç•¥ password required pam_cracklib.so retry=3 minlen=8 difok=3 password required pam_unix.so use_authtok æƒé™ç®¡ç†ï¼š javascript // PolicyKit è§„åˆ™ç¤ºä¾‹ï¼šé™åˆ¶ç‰¹å®šæ“ä½œ polkit.addRule(function (action, subject) { if (action.id == \"org.freedesktop.login1.power-off\" \u0026\u0026 subject.user == \"guest\") { return polkit.Result.NO } }) 3.5.3 æ•…éšœæ’æŸ¥PAM è®¤è¯è°ƒè¯•ï¼š bash nix shell nixpkgs#pamtester # æµ‹è¯• PAM é…ç½® pamtester login $USER authenticate pamtester sudo $USER authenticate # æŸ¥çœ‹ PAM é…ç½® cat /etc/pam.d/login cat /etc/pam.d/greetd cat /etc/pam.d/sudo # æ£€æŸ¥ PAM æ¨¡å— ldd /run/current-system/sw/lib/security/pam_unix.so ldd /run/current-system/sw/lib/security/pam_gnome_keyring.so # æŸ¥çœ‹è®¤è¯æ—¥å¿— journalctl -t login -f journalctl -t greetd -f journalctl -t sshd -f journalctl -t sudo # éªŒè¯ç¨‹åºä¸é…ç½®çš„å¯¹åº”å…³ç³» strace -e trace=pam_start login 2\u003e\u00261 | grep pam_start strace -e trace=openat login 2\u003e\u00261 | grep pam.d PolicyKit æƒé™è°ƒè¯•ï¼š bash # æ£€æŸ¥ PolicyKit æœåŠ¡çŠ¶æ€ systemctl status polkit # æµ‹è¯•ç‰¹å®šæƒé™ pkcheck --action-id org.freedesktop.login1.power-off --process $$ --allow-user-interaction # æŸ¥çœ‹ PolicyKit æ—¥å¿— journalctl -u polkit -f # æŸ¥çœ‹ PolicyKit åŠ¨ä½œå®šä¹‰ ls -la /run/current-system/sw/share/polkit-1/actions/ # æŸ¥çœ‹å½“å‰ç”Ÿæ•ˆçš„ PolicyKit è§„åˆ™ ls -la /etc/polkit-1/rules.d/ å¯†é’¥ç®¡ç†è°ƒè¯•ï¼š bash # GNOME Keyring æ£€æŸ¥ ps aux | grep gnome-keyring seahorse # GNOME Keyring GUI # KDE Wallet æ£€æŸ¥ ps aux | grep kwalletd kwalletmanager5 # KDE Wallet GUI kwallet-query kdewallet --list-entries # ç³»ç»Ÿæ—¥å¿—æ£€æŸ¥ sudo journalctl -u systemd-logind è°ƒè¯•æŠ€å·§ï¼š ä½¿ç”¨ strace è·Ÿè¸ªåº”ç”¨ç¨‹åºçš„å¯†é’¥è®¿é—® é€šè¿‡ journalctl æŸ¥çœ‹è®¤è¯å’Œæˆæƒæ—¥å¿— ä½¿ç”¨ pamtester æµ‹è¯• PAM é…ç½® é€šè¿‡ pkcheck æµ‹è¯• PolicyKit æƒé™ é€šè¿‡ç†è§£è¿™äº›å®‰å…¨ç»„ä»¶çš„åä½œæœºåˆ¶ï¼Œç”¨æˆ·å¯ä»¥æ›´å¥½åœ°é…ç½®å’Œç®¡ç† Linux æ¡Œé¢çš„å®‰å…¨ç­–ç•¥ï¼Œåœ¨ä¿è¯å®‰å…¨æ€§çš„åŒæ—¶æä¾›è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:4:5","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#352-å®‰å…¨æœ€ä½³å®è·µ"},{"categories":["tech"],"content":" 3.5 å®‰å…¨ç»„ä»¶é›†æˆä¸æœ€ä½³å®è·µ 3.5.1 ç»„ä»¶åä½œæµç¨‹ç°ä»£ Linux æ¡Œé¢çš„å®‰å…¨ç»„ä»¶åä½œæµç¨‹ï¼š ç”¨æˆ·ç™»å½•ï¼šPAM éªŒè¯ç”¨æˆ·èº«ä»½ å¯†é’¥ç¯è§£é”ï¼šPAM æ¨¡å—è‡ªåŠ¨è§£é”ç”¨æˆ·å¯†é’¥ç¯/é’±åŒ… åº”ç”¨å¯åŠ¨ï¼šåº”ç”¨ç¨‹åºé€šè¿‡ libsecret/KWallet API è®¿é—®å­˜å‚¨çš„å¯†ç  ç‰¹æƒæ“ä½œï¼šPolicyKit æ§åˆ¶éœ€è¦ç‰¹æƒçš„ç³»ç»Ÿæ“ä½œ ä¼šè¯ç»“æŸï¼šå¯†é’¥ç¯/é’±åŒ…è‡ªåŠ¨é”å®š 3.5.2 å®‰å…¨æœ€ä½³å®è·µå¯†é’¥ç®¡ç†ï¼š ä½¿ç”¨å¼ºå¯†ç ä¿æŠ¤å¯†é’¥ç¯/é’±åŒ… å®šæœŸå¤‡ä»½å¯†é’¥ç¯æ–‡ä»¶ é¿å…åœ¨è„šæœ¬ä¸­ç¡¬ç¼–ç å¯†ç  ä½¿ç”¨åº”ç”¨ç¨‹åºä¸“ç”¨çš„å¯†é’¥ç¯ è®¤è¯é…ç½®ï¼š bash # å¯ç”¨åŒå› å­è®¤è¯ auth required pam_google_authenticator.so auth required pam_unix.so # é…ç½®å¯†ç ç­–ç•¥ password required pam_cracklib.so retry=3 minlen=8 difok=3 password required pam_unix.so use_authtok æƒé™ç®¡ç†ï¼š javascript // PolicyKit è§„åˆ™ç¤ºä¾‹ï¼šé™åˆ¶ç‰¹å®šæ“ä½œ polkit.addRule(function (action, subject) { if (action.id == \"org.freedesktop.login1.power-off\" \u0026\u0026 subject.user == \"guest\") { return polkit.Result.NO } }) 3.5.3 æ•…éšœæ’æŸ¥PAM è®¤è¯è°ƒè¯•ï¼š bash nix shell nixpkgs#pamtester # æµ‹è¯• PAM é…ç½® pamtester login $USER authenticate pamtester sudo $USER authenticate # æŸ¥çœ‹ PAM é…ç½® cat /etc/pam.d/login cat /etc/pam.d/greetd cat /etc/pam.d/sudo # æ£€æŸ¥ PAM æ¨¡å— ldd /run/current-system/sw/lib/security/pam_unix.so ldd /run/current-system/sw/lib/security/pam_gnome_keyring.so # æŸ¥çœ‹è®¤è¯æ—¥å¿— journalctl -t login -f journalctl -t greetd -f journalctl -t sshd -f journalctl -t sudo # éªŒè¯ç¨‹åºä¸é…ç½®çš„å¯¹åº”å…³ç³» strace -e trace=pam_start login 2\u003e\u00261 | grep pam_start strace -e trace=openat login 2\u003e\u00261 | grep pam.d PolicyKit æƒé™è°ƒè¯•ï¼š bash # æ£€æŸ¥ PolicyKit æœåŠ¡çŠ¶æ€ systemctl status polkit # æµ‹è¯•ç‰¹å®šæƒé™ pkcheck --action-id org.freedesktop.login1.power-off --process $$ --allow-user-interaction # æŸ¥çœ‹ PolicyKit æ—¥å¿— journalctl -u polkit -f # æŸ¥çœ‹ PolicyKit åŠ¨ä½œå®šä¹‰ ls -la /run/current-system/sw/share/polkit-1/actions/ # æŸ¥çœ‹å½“å‰ç”Ÿæ•ˆçš„ PolicyKit è§„åˆ™ ls -la /etc/polkit-1/rules.d/ å¯†é’¥ç®¡ç†è°ƒè¯•ï¼š bash # GNOME Keyring æ£€æŸ¥ ps aux | grep gnome-keyring seahorse # GNOME Keyring GUI # KDE Wallet æ£€æŸ¥ ps aux | grep kwalletd kwalletmanager5 # KDE Wallet GUI kwallet-query kdewallet --list-entries # ç³»ç»Ÿæ—¥å¿—æ£€æŸ¥ sudo journalctl -u systemd-logind è°ƒè¯•æŠ€å·§ï¼š ä½¿ç”¨ strace è·Ÿè¸ªåº”ç”¨ç¨‹åºçš„å¯†é’¥è®¿é—® é€šè¿‡ journalctl æŸ¥çœ‹è®¤è¯å’Œæˆæƒæ—¥å¿— ä½¿ç”¨ pamtester æµ‹è¯• PAM é…ç½® é€šè¿‡ pkcheck æµ‹è¯• PolicyKit æƒé™ é€šè¿‡ç†è§£è¿™äº›å®‰å…¨ç»„ä»¶çš„åä½œæœºåˆ¶ï¼Œç”¨æˆ·å¯ä»¥æ›´å¥½åœ°é…ç½®å’Œç®¡ç† Linux æ¡Œé¢çš„å®‰å…¨ç­–ç•¥ï¼Œåœ¨ä¿è¯å®‰å…¨æ€§çš„åŒæ—¶æä¾›è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:4:5","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#353-æ•…éšœæ’æŸ¥"},{"categories":["tech"],"content":" æ€»ç»“ä» UEFI åˆ° systemdï¼Œä» PAM åˆ° PolicyKitï¼Œæœ¬æ–‡è¯¦ç»†ä»‹ç»äº† Linux æ¡Œé¢ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶çš„æ ¸å¿ƒç»„ä»¶ã€‚ ä¸‹ä¸€ç¯‡æ–‡ç« å°†æ·±å…¥æ¢è®¨ systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†ï¼ŒåŒ…æ‹¬ D-Bus ç³»ç»Ÿæ€»çº¿ã€æ—¥å¿—ç³»ç»Ÿå’Œè®¾å¤‡ç®¡ç†ç­‰æ ¸å¿ƒåŠŸèƒ½ï¼Œè¿™äº›ç»„ä»¶ä¸ºæ¡Œé¢ç¯å¢ƒæä¾›äº†å¼ºå¤§çš„åŸºç¡€è®¾æ–½æ”¯æŒã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:5:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#æ€»ç»“"},{"categories":["tech"],"content":" å¿«é€Ÿå‚è€ƒ","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:6:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#å¿«é€Ÿå‚è€ƒ"},{"categories":["tech"],"content":" å¸¸ç”¨å¯åŠ¨æ’æŸ¥å‘½ä»¤ bash # å¯åŠ¨æ—¶é—´åˆ†æ systemd-analyze systemd-analyze blame systemd-analyze critical-chain # å¼•å¯¼åŠ è½½å™¨æ£€æŸ¥ bootctl status bootctl list efibootmgr -v # å†…æ ¸å’Œç¡¬ä»¶ä¿¡æ¯ dmesg | grep -i error lspci -k lsusb lsblk # è¿›å…¥æ•‘æ´æ¨¡å¼ # åœ¨å†…æ ¸å‚æ•°ä¸­æ·»åŠ ï¼šinit=/bin/sh æˆ– break=mount ","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:6:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#å¸¸ç”¨å¯åŠ¨æ’æŸ¥å‘½ä»¤"},{"categories":["tech"],"content":" å¸¸ç”¨å®‰å…¨æ’æŸ¥å‘½ä»¤å®‰å…¨ç›¸å…³çš„è°ƒè¯•å‘½ä»¤è¯·å‚è€ƒ 3.5.3 æ•…éšœæ’æŸ¥ ç« èŠ‚ï¼Œè¯¥ç« èŠ‚æä¾›äº†å®Œæ•´çš„ PAMã€PolicyKit å’Œå¯†é’¥ç®¡ç†è°ƒè¯•å‘½ä»¤ã€‚ ","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:6:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#å¸¸ç”¨å®‰å…¨æ’æŸ¥å‘½ä»¤"},{"categories":["tech"],"content":" é‡è¦é…ç½®æ–‡ä»¶ä½ç½® bash # å¯åŠ¨ç›¸å…³ /boot/loader/loader.conf # systemd-boot å…¨å±€é…ç½® /boot/EFI/Linux/ # UKI é•œåƒä½ç½® /etc/pam.d/ # PAM é…ç½®æ–‡ä»¶ /etc/polkit-1/ # PolicyKit é…ç½® # å¯†é’¥ç®¡ç† ~/.local/share/keyrings/ # GNOME Keyring å­˜å‚¨ ~/.local/share/kwalletd/ # KDE Wallet å­˜å‚¨ ~/.config/kwalletrc # KDE Wallet é…ç½® ","date":"2025-10-19","objectID":"/posts/linux-desktop-1-boot-security/:6:3","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop","Boot","Security","UEFI","GRUB","Systemd"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶","uri":"/posts/linux-desktop-1-boot-security/#é‡è¦é…ç½®æ–‡ä»¶ä½ç½®"},{"categories":["tech"],"content":" AI åˆ›ä½œå£°æ˜ï¼šæœ¬ç³»åˆ—æ–‡ç« ç”±ç¬”è€…å€ŸåŠ© ChatGPT, Kimi K2, è±†åŒ…å’Œ Cursor ç­‰ AI å·¥å…·åˆ›ä½œï¼Œæœ‰å¾ˆå¤§ç¯‡å¹…çš„å†…å®¹å®Œå…¨ç”± AI åœ¨æˆ‘çš„æŒ‡å¯¼ä¸‹ç”Ÿæˆã€‚å¦‚æœ‰é”™è¯¯ï¼Œè¿˜è¯·æŒ‡æ­£ã€‚ ","date":"2025-09-09","objectID":"/posts/linux-desktop-explained/:0:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆé›¶ï¼‰ - ç»„ä»¶æ¦‚è§ˆ","uri":"/posts/linux-desktop-explained/#"},{"categories":["tech"],"content":" å®šä½ä¸ç›®æ ‡Linux æ¡Œé¢åŒ…å«äº†ç›¸å½“å¤šçš„ç³»ç»Ÿç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶ç»„åˆå½¢æˆäº†ä¸€ä¸ªç²¾å¯†çš„ç³»ç»Ÿï¼Œå®ƒä»¬å…±åŒç®¡ç†ç€ä»ç¡¬ä»¶è®¾å¤‡åˆ°ç”¨æˆ·ä¼šè¯çš„æ–¹æ–¹é¢é¢ã€‚ å³ä½¿æˆ‘å·²ç»æœ‰ä¸ƒå…«å¹´çš„ Linux ä½¿ç”¨ç»éªŒï¼Œåœ¨é‡åˆ°ç³»ç»Ÿçš„å„ç§å¤§å°æ¯›ç—…æ—¶ï¼Œè¿˜æ˜¯å¸¸å¸¸è§‰å¾—é—®é¢˜çš„å®šä½è·Ÿè§£å†³å¾ˆæ˜¯è‰°éš¾ã€‚å€˜è‹¥æˆ‘ä»¬èƒ½åƒåº–ä¸é‚£æ ·\"ç›®æ— å…¨ç‰›\"ï¼Œå¯¹æ•´ä¸ªç³»ç»Ÿçš„æ¶æ„äº†å¦‚æŒ‡æŒï¼Œåœ¨å®šä½é—®é¢˜æ—¶é¡ºç€éª¨èŠ‚ç­‹è„‰ä¸‹åˆ€ï¼Œé‚£è§£å†³èµ·é—®é¢˜æ¥è‡ªç„¶ä¹Ÿå°†æ¸¸åˆƒæœ‰ä½™ã€‚ è€Œè¿™å°±æ˜¯è¿™ä¸ªç³»åˆ—æ–‡ç« çš„ç›®çš„â€”â€”æ­å»ºèµ·ä¸€å¹… Linux æ¡Œé¢ç³»ç»Ÿçš„å®Œæ•´ã€Œè§£ç‰›å›¾ã€ã€‚ æœ¬ç³»åˆ—é¢å‘å·²ç»æœ‰ä¸€å®š Linux æ¡Œé¢ä½¿ç”¨ç»éªŒçš„è¯»è€…ã€‚æˆ‘ä»¬ç”¨ä¸€æ¡ä»ã€Œå¼€æœºã€åˆ°ã€ŒAPP è¿è¡Œã€å†åˆ°ã€Œå…³æœº/ æ–­ç”µã€çš„å®Œæ•´æ—¶é—´çº¿ä¸ºè½´ï¼Œæ·±å…¥è®²è§£æ¯ä¸€æ­¥å‘ç”Ÿäº†ä»€ä¹ˆã€å“ªé‡Œèƒ½çœ‹åˆ°è¯æ®ï¼ˆæ—¥å¿— / è®¾å¤‡èŠ‚ç‚¹ / Dâ€‘Bus ä¿¡å·ï¼‰ã€å¯é€šè¿‡å“ªäº›å‘½ä»¤æ’æŸ¥éªŒè¯ï¼Œä»¥åŠå¸¸è§é—®é¢˜çš„ä¿®å¤æ€è·¯ã€‚ æœ¬æ–‡ä½œä¸ºç³»åˆ—æ¦‚è§ˆï¼Œä¸»è¦èµ·å¯¼èˆªå’Œæ¶æ„æ¢³ç†çš„ä½œç”¨ï¼Œå¸®åŠ©è¯»è€…å»ºç«‹æ•´ä½“è®¤çŸ¥æ¡†æ¶ã€‚ ","date":"2025-09-09","objectID":"/posts/linux-desktop-explained/:1:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆé›¶ï¼‰ - ç»„ä»¶æ¦‚è§ˆ","uri":"/posts/linux-desktop-explained/#å®šä½ä¸ç›®æ ‡"},{"categories":["tech"],"content":" æ–‡ç« ç³»åˆ—å¯¼èˆª","date":"2025-09-09","objectID":"/posts/linux-desktop-explained/:2:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆé›¶ï¼‰ - ç»„ä»¶æ¦‚è§ˆ","uri":"/posts/linux-desktop-explained/#æ–‡ç« ç³»åˆ—å¯¼èˆª"},{"categories":["tech"],"content":" ğŸ“‹ Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶æ¶µç›–å†…å®¹ï¼š ç³»ç»Ÿå¯åŠ¨æµç¨‹ï¼šä» UEFI å›ºä»¶åˆ° systemd ç”¨æˆ·ç©ºé—´çš„å®Œæ•´å¯åŠ¨è¿‡ç¨‹ï¼ŒåŒ…æ‹¬ systemd-boot é…ç½®ã€UKI ç»Ÿä¸€å†…æ ¸é•œåƒã€initramfs é˜¶æ®µè¯¦è§£ å®‰å…¨æ¡†æ¶æ·±åº¦è§£æï¼šPAM è®¤è¯æœºåˆ¶ã€PolicyKit æƒé™ç®¡ç†ã€GNOME Keyring å¯†é’¥ç®¡ç†ï¼Œä»¥åŠå„ç»„ä»¶é—´çš„åä½œå…³ç³» ","date":"2025-09-09","objectID":"/posts/linux-desktop-explained/:2:1","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆé›¶ï¼‰ - ç»„ä»¶æ¦‚è§ˆ","uri":"/posts/linux-desktop-explained/#-linux-æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ä¸€---ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶"},{"categories":["tech"],"content":" âš™ï¸ Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†æ¶µç›–å†…å®¹ï¼š systemd æ ¸å¿ƒåŠŸèƒ½ï¼šæœåŠ¡ç®¡ç†ã€ä¾èµ–å…³ç³»ã€å¹¶è¡Œå¯åŠ¨ã€å•å…ƒç±»å‹é…ç½®å’Œç”Ÿå‘½å‘¨æœŸç®¡ç† systemd ç”Ÿæ€ç³»ç»ŸæœåŠ¡ï¼šç€é‡ä»‹ç» systemd-journald æ—¥å¿—ç³»ç»Ÿã€systemd-oomd å†…å­˜ç®¡ç†ã€systemd-resolved DNS è§£æã€systemd-timesyncd æ—¶é—´åŒæ­¥ è®¾å¤‡ç®¡ç†ï¼šudev è§„åˆ™ç³»ç»Ÿã€systemd-udevd ç”¨æˆ·ç©ºé—´å®ç°ã€è®¾å¤‡æƒé™åˆ†é…å’Œæ•…éšœæ’æŸ¥ D-Bus ç³»ç»Ÿæ€»çº¿ï¼šè¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ã€æƒé™ç®¡æ§ã€Flatpak æ²™ç›’ç¯å¢ƒä¸‹çš„ D-Bus ä»£ç†è¿‡æ»¤ æœåŠ¡ç®¡ç†æœ€ä½³å®è·µï¼šæœåŠ¡é…ç½®ä¼˜åŒ–ã€ä¾èµ–å…³ç³»ç®¡ç†ã€æ€§èƒ½è°ƒä¼˜ ","date":"2025-09-09","objectID":"/posts/linux-desktop-explained/:2:2","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆé›¶ï¼‰ - ç»„ä»¶æ¦‚è§ˆ","uri":"/posts/linux-desktop-explained/#-linux-æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—äºŒ---systemd-å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç†"},{"categories":["tech"],"content":" ğŸ–¥ï¸ Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“æ¶µç›–å†…å®¹ï¼š ç”¨æˆ·ä¼šè¯ç®¡ç†ï¼šç™»å½•æµç¨‹è¯¦è§£ã€systemd-logind ä¼šè¯æ§åˆ¶ã€seat æ¦‚å¿µå’Œå¤šç”¨æˆ·åœºæ™¯ Wayland å›¾å½¢æ¶æ„ï¼šä¸ X11 çš„æ·±åº¦å¯¹æ¯”ã€å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¨¡å‹ã€åè®®æ‰©å±•å’Œå®‰å…¨æ€§ä¼˜åŠ¿ å›¾å½¢æ¸²æŸ“æ ˆï¼šDRM/KMS æ˜¾ç¤ºç®¡ç†ã€Mesa é©±åŠ¨ã€EGL/GBM æ¥å£ã€OpenGL/Vulkan æ¸²æŸ“ç®¡çº¿ è¾“å…¥å¤„ç†ç³»ç»Ÿï¼šlibinput äº‹ä»¶å¤„ç†ã€evdev å†…æ ¸æ¥å£ã€æ‰‹åŠ¿è¯†åˆ«ã€å¤šç‚¹è§¦æ§æ”¯æŒ è®¾å¤‡è®¿é—®æ§åˆ¶ï¼šACL æƒé™åˆ†é…ã€GPU è®¾å¤‡ç®¡ç†ã€è¾“å…¥è®¾å¤‡æƒé™ã€systemd-logind é›†æˆ åº”ç”¨ç¨‹åºæ¶æ„ï¼šå¯åŠ¨æµç¨‹ã€å›¾å½¢é©±åŠ¨é€‰æ‹©ã€å·¥å…·åŒ…æ”¯æŒï¼ˆGTK/Qt/SDLï¼‰ã€æ¸²æŸ“å™¨ä¼˜åŒ– åº”ç”¨å…¼å®¹æ€§ï¼šWayland/XWayland å…¼å®¹æ€§ã€æ²™ç›’åŒ–åº”ç”¨ï¼ˆFlatpakï¼‰ã€æ€§èƒ½è°ƒä¼˜ ","date":"2025-09-09","objectID":"/posts/linux-desktop-explained/:2:3","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆé›¶ï¼‰ - ç»„ä»¶æ¦‚è§ˆ","uri":"/posts/linux-desktop-explained/#-linux-æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ä¸‰---æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“"},{"categories":["tech"],"content":" ğŸµ Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå››ï¼‰ - å¤šåª’ä½“å¤„ç†ä¸ä¸­æ–‡æ”¯æŒæ¶µç›–å†…å®¹ï¼š PipeWire ç»Ÿä¸€å¤šåª’ä½“æ¶æ„ï¼šéŸ³é¢‘è§†é¢‘å¤„ç†ã€å±å¹•å…±äº«ã€å…¼å®¹å±‚ï¼ˆPulseAudio/JACK/ALSAï¼‰ è§†é¢‘å¤„ç†ä¸å±å¹•å…±äº«ï¼šWayland screen-capture åè®®ã€ç¡¬ä»¶åŠ é€Ÿã€DMA-BUF ä¼ é€’ã€æƒé™ç®¡ç† éŸ³é¢‘å¤„ç†æµç¨‹ï¼šä½å»¶è¿Ÿé…ç½®ã€éŸ³é¢‘è·¯ç”±æ§åˆ¶ã€è®¾å¤‡ç®¡ç†å’Œæ€§èƒ½ä¼˜åŒ– å­—ä½“æ¸²æŸ“ç³»ç»Ÿï¼šfontconfig é…ç½®ã€CJK å­—ä½“ç®¡ç†ã€æ¸²æŸ“å‚æ•°ä¼˜åŒ–ã€å­—ä½“åŒ¹é…è§„åˆ™ ä¸­æ–‡è¾“å…¥æ³•ï¼šfcitx5 æ¡†æ¶ã€Wayland text-input åè®®ã€XWayland å…¼å®¹æ€§ã€æ··åˆç¯å¢ƒç®¡ç† ","date":"2025-09-09","objectID":"/posts/linux-desktop-explained/:2:4","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆé›¶ï¼‰ - ç»„ä»¶æ¦‚è§ˆ","uri":"/posts/linux-desktop-explained/#-linux-æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—å››---å¤šåª’ä½“å¤„ç†ä¸ä¸­æ–‡æ”¯æŒ"},{"categories":["tech"],"content":" ğŸŒ Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäº”ï¼‰ - ç½‘ç»œæ¶µç›–å†…å®¹ï¼š ç½‘ç»œè¿æ¥ä¸ç®¡ç†ï¼šä»ç¡¬ä»¶é©±åŠ¨åˆ°åº”ç”¨å±‚çš„å®Œæ•´åè®®æ ˆï¼Œsystemd-networkd å’Œ iwd çš„ç°ä»£ç½‘ç»œç®¡ç† IPv4/IPv6 åŒæ ˆæŠ€æœ¯ï¼šåœ°å€åˆ†é…æœºåˆ¶ã€è·¯ç”±è¡¨ç®¡ç†ã€åè®®ä¼˜å…ˆçº§é…ç½®ã€åŒæ ˆéªŒè¯æ–¹æ³• é˜²ç«å¢™ä¸ç½‘ç»œå®‰å…¨ï¼šnftables ç°ä»£é˜²ç«å¢™ã€NAT é…ç½®ã€ç«¯å£è½¬å‘ã€æµé‡æ§åˆ¶è§„åˆ™ è™šæ‹Ÿç½‘ç»œæŠ€æœ¯ï¼šTUN/TAP æ¥å£ã€VPN è¿æ¥ç®¡ç†ï¼ˆWireGuardï¼‰ã€æ¡¥æ¥ç½‘ç»œã€å®¹å™¨ç½‘ç»œ ç½‘ç»œæ€§èƒ½ä¼˜åŒ–ï¼šå†…æ ¸å‚æ•°è°ƒä¼˜ã€TCP æ‹¥å¡æ§åˆ¶ï¼ˆBBRï¼‰ã€è¿æ¥è·Ÿè¸ªä¼˜åŒ–ã€ç½‘ç»œç›‘æ§åˆ†æ é«˜çº§ç½‘ç»œé…ç½®ï¼šå¤šç½‘å¡ç»‘å®šã€VLAN é…ç½®ã€ç½‘ç»œå‘½åç©ºé—´ã€ç½‘ç»œæ•…éšœè¯Šæ–­ ","date":"2025-09-09","objectID":"/posts/linux-desktop-explained/:2:5","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆé›¶ï¼‰ - ç»„ä»¶æ¦‚è§ˆ","uri":"/posts/linux-desktop-explained/#-linux-æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—äº”---ç½‘ç»œ"},{"categories":["tech"],"content":" ğŸ”„ Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå…­ï¼‰ - ç³»ç»Ÿå…³æœºä¸ç”µæºç®¡ç†æ¶µç›–å†…å®¹ï¼š ç³»ç»Ÿå…³æœºæµç¨‹è¯¦è§£ï¼šä»‹ç»å®Œæ•´å…³æœºè¿‡ç¨‹ï¼Œä»ç”¨æˆ·ä¼šè¯æ¸…ç†åˆ°ç¡¬ä»¶å…³æœºçš„æ¯ä¸ªæ­¥éª¤ ç”µæºç®¡ç†åŠŸèƒ½ï¼šä¼‘çœ ï¼ˆHibernateï¼‰å’ŒæŒ‚èµ·ï¼ˆSuspendï¼‰çš„é…ç½®ã€å·¥ä½œåŸç†å’Œæ•…éšœæ’æŸ¥ å…³æœºæ•…éšœæ’æŸ¥ï¼šæœåŠ¡åœæ­¢è¶…æ—¶ã€æ–‡ä»¶ç³»ç»Ÿå¸è½½å¤±è´¥ã€è®¾å¤‡ç¹å¿™ç­‰é—®é¢˜çš„è¯Šæ–­å’Œè§£å†³ å®æˆ˜æ•…éšœæ¡ˆä¾‹ï¼šæ¡Œé¢ç¯å¢ƒå¯åŠ¨å¤±è´¥ã€åº”ç”¨å´©æºƒã€ç½‘ç»œå¼‚å¸¸ã€ç³»ç»Ÿå…³æœºå¡ä½ç­‰ç»¼åˆé—®é¢˜ ç³»ç»ŸåŒ–æ’æŸ¥æ–¹æ³•ï¼šæ—¥å¿—åˆ†æã€é€å±‚æ’æŸ¥ã€å·¥å…·ä½¿ç”¨æŠ€å·§ã€æœ€ä½³å®è·µæ€»ç»“ ç”µæºç®¡ç†ä¼˜åŒ–ï¼šè‡ªåŠ¨æŒ‚èµ·é…ç½®ã€å®šæ—¶ä¼‘çœ è®¾ç½®ã€åŠŸè€—ä¼˜åŒ–ã€ç¡¬ä»¶å…¼å®¹æ€§å¤„ç† ","date":"2025-09-09","objectID":"/posts/linux-desktop-explained/:2:6","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆé›¶ï¼‰ - ç»„ä»¶æ¦‚è§ˆ","uri":"/posts/linux-desktop-explained/#-linux-æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—å…­---ç³»ç»Ÿå…³æœºä¸ç”µæºç®¡ç†"},{"categories":["tech"],"content":" æŠ€æœ¯æ ˆè¯´æ˜æœ¬ç³»åˆ—æ–‡ç« åŸºäºä»¥ä¸‹ç°ä»£ Linux æ¡Œé¢æŠ€æœ¯æ ˆï¼š å¼•å¯¼ç³»ç»Ÿï¼šUEFI + systemd-boot åˆå§‹åŒ–ç³»ç»Ÿï¼šsystemd æ˜¾ç¤ºåè®®ï¼šWayland éŸ³é¢‘ç³»ç»Ÿï¼šPipeWire ç½‘ç»œç®¡ç†ï¼šsystemd-networkd + iwd é˜²ç«å¢™ï¼šnftables è¾“å…¥æ³•ï¼šfcitx5 å­—ä½“ç³»ç»Ÿï¼šfontconfig å‘è¡Œç‰ˆï¼šä¸»è¦åŸºäº NixOSï¼ŒåŒæ—¶è¡¥å……è¯´æ˜ä¸ä¼ ç»Ÿå‘è¡Œç‰ˆçš„å·®å¼‚ æŠ€æœ¯é€‰æ‹©è¯´æ˜ï¼š systemd-bootï¼šç›¸æ¯” GRUB æ›´ç®€æ´ï¼Œæ”¯æŒ UKI å’Œ Secure Bootï¼Œå¯åŠ¨é€Ÿåº¦æ›´å¿« Waylandï¼šç›¸æ¯” X11 æ›´å®‰å…¨ã€æ€§èƒ½æ›´å¥½ PipeWireï¼šç»Ÿä¸€çš„å¤šåª’ä½“å¤„ç†æ¡†æ¶ï¼Œç›¸æ¯” PulseAudio å»¶è¿Ÿæ›´ä½ï¼Œæ”¯æŒç»Ÿä¸€å¤„ç†éŸ³é¢‘è·Ÿè§†é¢‘ systemd-networkd + iwdï¼šç›¸æ¯” NetworkManager + wpa_supplicant æ›´ç°ä»£ã€æ›´è½»é‡ nftablesï¼šç›¸æ¯” iptables è¯­æ³•æ›´ç®€æ´ï¼Œæ€§èƒ½æ›´å¥½ fcitx5ï¼šç›¸æ¯” ibus å¯¹ Wayland æ”¯æŒæ›´å¥½ï¼Œé…ç½®æ›´çµæ´» è™½ç„¶ä»¥ NixOS ä¸ºä¾‹ï¼Œä½†æ¶‰åŠçš„æ ¸å¿ƒæ¦‚å¿µã€é…ç½®æ–¹æ³•å’Œæ•…éšœæ’æŸ¥æŠ€å·§åŒæ ·é€‚ç”¨äºå…¶ä»–ç°ä»£ Linux å‘è¡Œç‰ˆ ï¼ˆå¦‚ Arch Linuxã€Fedoraã€Ubuntu ç­‰ï¼‰ã€‚ ","date":"2025-09-09","objectID":"/posts/linux-desktop-explained/:3:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆé›¶ï¼‰ - ç»„ä»¶æ¦‚è§ˆ","uri":"/posts/linux-desktop-explained/#æŠ€æœ¯æ ˆè¯´æ˜"},{"categories":["tech"],"content":" æ€»ç»“Linux æ¡Œé¢ç³»ç»Ÿè™½å¤æ‚ï¼Œä½†æ¯ä¸ªç»„ä»¶éƒ½æœ‰æ˜ç¡®ä½œç”¨å’Œé€»è¾‘å…³ç³»ã€‚ å¸Œæœ›è¿™ä»½å®Œæ•´çš„\"è§£ç‰›å›¾\"èƒ½æˆä¸ºä½ æ¢ç´¢ Linux æ¡Œé¢ä¸–ç•Œçš„æœ‰åŠ›å·¥å…·ï¼Œè®©ä½ çš„ Linux ä¹‹æ—…æ›´åŠ é¡ºç•…ä¸æ„‰å¿«ã€‚ ","date":"2025-09-09","objectID":"/posts/linux-desktop-explained/:4:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆé›¶ï¼‰ - ç»„ä»¶æ¦‚è§ˆ","uri":"/posts/linux-desktop-explained/#æ€»ç»“"},{"categories":["tech"],"content":" å‚è€ƒ Understanding Linux Desktop Components: Display Servers, Compositors, Window Managers, and Desktop Environments ","date":"2025-09-09","objectID":"/posts/linux-desktop-explained/:5:0","series":["Linux æ¡Œé¢ç³»ç»Ÿ"],"tags":["Linux","Desktop"],"title":"Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆé›¶ï¼‰ - ç»„ä»¶æ¦‚è§ˆ","uri":"/posts/linux-desktop-explained/#å‚è€ƒ"},{"categories":["tech","life"],"content":" å‰è¨€ä»Šå¹´ 1 æœˆåº•è¾èŒåï¼Œåœ¨å®¶è¿‡äº†ä¸ªå¹´ï¼Œæ¥ç€åœ¨ä¸Šæµ·ã€å¼ å®¶ç•Œã€é‡åº†ã€è‹å·ã€å—äº¬ç©äº†ä¸€åœˆï¼Œ4 æœˆä¸­æ—¬æ‰å›æ·±åœ³å¼€å§‹æ‰¾å·¥ä½œã€‚æœ¬æ¥çœ‹åˆ° 6 æœˆå°±æ˜¯ KubeCon China 2025ï¼Œè¿˜ä¸å¤ªç¡®å®šè‡ªå·±åˆ°æ—¶å€™ä¼šä¸ä¼šæœ‰æ—¶é—´å»ã€‚ä¸è¿‡å¾ˆå¹¸è¿ï¼Œæœ€åç¡®å®š offer çš„å…¬å¸éå¸¸é‡è§†æŠ€æœ¯ï¼Œleader åœ¨é¢è¯•çš„æ—¶å€™å°±è¯´çœ‹åˆ°æˆ‘åšå®¢é‡Œå†™äº† KubeCon çš„ç»å†ï¼Œå…¬å¸éå¸¸é¼“åŠ±å‚åŠ è¿™ç§æŠ€æœ¯äº¤æµæ´»åŠ¨ï¼Œå»æŠ¥ä¸ª Talk ä¹Ÿå®Œå…¨å¯ä»¥ï¼Œå…¬å¸æŠ¥é”€æ‰€æœ‰è´¹ç”¨ã€‚ äºæ˜¯æˆ‘åœ¨å…¥èŒè¿˜æ²¡æ»¡ä¸€ä¸ªæœˆçš„æ—¶å€™ï¼Œå°±ç›´æ¥å…¬è´¹å‡ºå·®å»é¦™æ¸¯ KubeCon China 2025 ç©äº†ä¸€åœˆï¼ˆ ä¹Ÿé—®è¿‡åŒäº‹ä»¬æ˜¯å¦æœ‰æƒ³æ³•ï¼Œä½†ç§ç§åŸå› æœ€åè¿˜æ˜¯åªæœ‰æˆ‘ä¸€ä¸ªäººå‚åŠ äº†ï¼ˆæ‚² ","date":"2025-06-15","objectID":"/posts/kubecon-china-2025/:1:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Cloud-Native","Kubernetes","AI","LLM","OpenTelemetry"],"title":"KubeCon China 2025 è§é—»","uri":"/posts/kubecon-china-2025/#å‰è¨€"},{"categories":["tech","life"],"content":" TL;DRç®€å•çš„è¯´ï¼Œä»Šå¹´çš„ KubeCon China å‡ ä¹å…¨éƒ½æ˜¯èŠ AI on Kubernetes çš„ï¼Œæ„Ÿè§‰éƒ½å¯ä»¥æ”¹åå« CloudNative AI Con äº†ã€‚ ä»Šå¹´ KubeCon China åªæœ‰ä¸¤å¤©ï¼ŒTalks æ˜æ˜¾æ¯”å»å¹´å°‘äº†å¾ˆå¤šï¼Œå‡ ä¹åªæœ‰å»å¹´çš„ä¸€åŠï¼Œæ‰€ä»¥æˆ‘ä¹Ÿåœ¨çº¿ä¸Šçœ‹äº†è®¸å¤š KubeCon Europe 2025 çš„ Talks ä½œä¸ºè¡¥å……ã€‚ æ€»çš„æ¥è¯´æˆ‘ä»Šå¹´çš„æ„Ÿè§‰æ˜¯ï¼š Kubernetes å·²ç»æˆä¸ºä¸€ä¸ªç›¸å½“æˆç†Ÿçš„åŸºåº§ï¼Œä»»ä½•å¯ä»¥åœ¨ K8s ä¸Šè·‘çš„ä¸œè¥¿æœ€ç»ˆéƒ½ä¼šè¢«æ¬åˆ° K8s ä¸Šè·‘ ï¼ˆ AI è®© CloudNative ç¤¾åŒºç„•å‘äº†æ–°ç”Ÿï¼Œå›´ç»• AI åœ¨è¿‡å»ä¸¤å¹´é—´æ¶Œç°äº†è®¸å¤šæ–°çš„ CloudNative é¡¹ç›®ã€‚AI è¯é¢˜å·²ç»æˆä¸ºäº† KubeCon ç»å¯¹çš„ä¸»æ—‹å¾‹ã€‚ AI éƒ¨ç½²éƒ¨åˆ†ä¸»è¦åœ¨è®¨è®º AI æ¨ç†ï¼Œå…³é”®æŠ€æœ¯ç‚¹ï¼šåˆ†å¸ƒå¼æ¨ç†ã€æ‰©ç¼©å®¹ä¸ LLM-Aware çš„è´Ÿè½½å‡è¡¡ä»¥åŠ AI æ¨¡å‹åˆ†å‘ AIOps ä¹Ÿæœ‰å¥½å‡ ä¸ªè®¨è®ºï¼Œç®€å•çš„ç”¨æ³•å°±æ˜¯ ChatBotï¼Œå¤æ‚ç‚¹çš„ä¼šå°è¯•ä½¿ç”¨ Multi-Agent å®Œæˆæ›´å¤æ‚çš„ä»»åŠ¡ï¼ˆæ¯”å¦‚äº‘æˆæœ¬åˆ†æä¼˜åŒ–ï¼‰ã€‚ å¿«æ‰‹å°è¯•åœ¨è¶…å¤§è§„æ¨¡é›†ç¾¤ä¸­åˆ©ç”¨ Logs/Metrcis ä¸ºæ¯ä¸ªæœåŠ¡è®­ç»ƒä¸€ä¸ªæ¨¡å‹ç”¨äºåŠ¨æ€è°ƒæ•´ HPAï¼Œå®ç° SLA ä¸æˆæœ¬çš„å¹³è¡¡ï¼ˆå¦‚æœæˆ‘è®°é”™äº†æ¦‚ä¸è´Ÿè´£ hhhï¼‰ã€‚ OpenTelemetry æ—¥æ¸æˆç†Ÿï¼Œå·²ç»å¾ˆæ¥è¿‘å®ƒç»Ÿä¸€ Logs/Traces/Metrics ä¸‰å¤§ Signals çš„ç›®æ ‡äº†ã€‚ ç›®å‰å·²ç»å‡ºç°äº† Uptrace ä¹‹ç±»çš„å¤§ä¸€ç»Ÿè§‚æµ‹å¹³å°ï¼Œå……åˆ†åˆ©ç”¨äº† OTel çš„æ ‡ç­¾æ¥å…³è” Logs/Traces. å½“å‰çš„æœ€ä½³å®è·µæ˜¯ï¼Œåœ¨ Infra å±‚é¢ä»ç„¶ä½¿ç”¨ä¼ ç»Ÿæ–¹å¼é‡‡é›† Logs ä¸ Metricsï¼Œè€Œåœ¨ APP å±‚é¢åˆ™æ”¹ç”± OTel ç»Ÿä¸€é‡‡é›†æ‰€æœ‰ Logs, Traces ä¸ Metricsï¼ŒOTel ä¼šé€šè¿‡ Span ID æŠŠè¿™äº›æ•°æ®å…³è”èµ·æ¥ï¼Œ è€Œä¸”æ ‡ç­¾è¯­ä¹‰å®Œå…¨ä¸€è‡´ã€‚ WASM ä»åœ¨æ¢å¯»è‡ªå·±çš„åº”ç”¨åœºæ™¯ï¼Œä»Šå¹´ä»‹ç»çš„åœºæ™¯ä¸»è¦æ˜¯åœ¨è¾¹ç¼˜ä¾§è·‘å°æ¨¡å‹ã€‚ KubeCon China 2025 ä¸ KubeCon Europe 2025 çš„è§†é¢‘åˆ—è¡¨å¦‚ä¸‹ï¼š KubeCon + CloudNativeCon China 2025 (Hong Kong) - Youtube KubeCon + CloudNativeCon Europe 2025(London) - Youtube è§†é¢‘ç›¸å…³çš„ PPT å¯ä»¥åœ¨è¿™é‡Œä¸‹è½½ï¼ˆNOTE: ä¸æ˜¯æ‰€æœ‰ Talks éƒ½ä¼šä¸Šä¼  PDFï¼‰ï¼š KubeCon + CloudNativeCon China 2025 - Schedule KubeCon + CloudNativeCon Europe 2025 - Schedule æ¥ä¸‹æ¥æˆ‘ä¼šæŠŠæˆ‘å¬è¿‡çš„ä¸€äº›æ¯”è¾ƒæœ‰æ„æ€çš„å†…å®¹åˆ† Topic å¤§æ¦‚ä»‹ç»ä¸‹ï¼Œä¹Ÿä¼šé™„ä¸Šå¯¹åº”çš„è§†é¢‘è·Ÿå¯èƒ½çš„ PPT é“¾æ¥ã€‚ ","date":"2025-06-15","objectID":"/posts/kubecon-china-2025/:2:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Cloud-Native","Kubernetes","AI","LLM","OpenTelemetry"],"title":"KubeCon China 2025 è§é—»","uri":"/posts/kubecon-china-2025/#tldr"},{"categories":["tech","life"],"content":" Talks","date":"2025-06-15","objectID":"/posts/kubecon-china-2025/:3:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Cloud-Native","Kubernetes","AI","LLM","OpenTelemetry"],"title":"KubeCon China 2025 è§é—»","uri":"/posts/kubecon-china-2025/#talks"},{"categories":["tech","life"],"content":" å¤§ä¸€ç»Ÿçš„ LLM æ¨ç†è§£å†³æ–¹æ¡ˆIntroducing AIBrix: Cost-Effective and Scalable Kubernetes Control Plane for VLLM - Jiaxin Shan \u0026 Liguang Xie, ByteDance AIBrix æ˜¯ä¸€æ•´å¥—åœ¨ K8s ä¸Šè·‘ LLM åˆ†å¸ƒå¼æ¨ç†çš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒåŒ…å«äº†ï¼š åˆ†å¸ƒå¼æ¨ç†çš„éƒ¨ç½² LLM æ‰©ç¼©å®¹ LLM è¯·æ±‚è·¯ç”±ï¼ˆè´Ÿè½½å‡è¡¡ï¼‰ åˆ†å¸ƒå¼ KV ç¼“å­˜ ä¸»è¦æ˜¯ä¸­å¿ƒåŒ–å­˜å‚¨è¿™äº›æ•°æ®ï¼Œå‡å°‘å¯¹ HBM æ˜¾å­˜çš„ä½¿ç”¨ï¼Œé™ä½æ˜¾å­˜éœ€æ±‚ã€‚ LoRa çš„åŠ¨æ€åŠ è½½ â€¦ ä»£ç ï¼š https://github.com/vllm-project/aibrix AIBrix ç›®å‰æ”¾åœ¨äº† vllm-project é¡¹ç›®ä¸‹ï¼Œstars ä¹Ÿä¸å°‘ï¼Œæ„Ÿè§‰é¡¹ç›®è¿˜æ˜¯æŒºå¥åº·çš„ï¼Œå€¼å¾—å…³æ³¨ã€‚ ","date":"2025-06-15","objectID":"/posts/kubecon-china-2025/:3:1","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Cloud-Native","Kubernetes","AI","LLM","OpenTelemetry"],"title":"KubeCon China 2025 è§é—»","uri":"/posts/kubecon-china-2025/#å¤§ä¸€ç»Ÿçš„-llm-æ¨ç†è§£å†³æ–¹æ¡ˆ"},{"categories":["tech","life"],"content":" åˆ†å¸ƒå¼ LLM æ¨ç†çš„éƒ¨ç½²More Than Model Sharding: LWS \u0026 Distributed Inference - Peter Pan \u0026 Nicole Li, DaoCloud \u0026 Shane Wang, Intel å…¨åœºæœ€æœ‰æ„æ€çš„ Talks ä¹‹ä¸€ï¼Œå¤§æ¦‚ä»‹ç»äº†åˆ†å¸ƒå¼æ¨ç†çš„æ¶æ„ã€ä¼˜åŒ–ç‚¹ï¼Œä»¥åŠ LWS çš„ä¼˜ç‚¹ä¸ç”¨æ³•ã€‚ ä»£ç ï¼š https://github.com/kubernetes-sigs/lws ç®€å•çš„è¯´ LWS æ˜¯ä¸€ä¸ªä¸“é—¨ä¸º LLM åˆ†å¸ƒå¼æ¨ç†çš„éƒ¨ç½²è€Œè®¾è®¡çš„ CRD, ä¸»è¦æ˜¯æ”¯æŒäº† LLM ä»»åŠ¡çš„åˆ†ç»„è°ƒåº¦ã€‚ NOTE: çœ‹ issue AIBrix è¿˜æœ‰è·Ÿ LWS ç»“åˆä½¿ç”¨çš„å¯èƒ½æ€§ï¼ˆç”šè‡³å¯èƒ½è¢«å®˜æ–¹æ”¯æŒï¼‰:https://github.com/vllm-project/aibrix/issues/843#issuecomment-2728305020 ","date":"2025-06-15","objectID":"/posts/kubecon-china-2025/:3:2","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Cloud-Native","Kubernetes","AI","LLM","OpenTelemetry"],"title":"KubeCon China 2025 è§é—»","uri":"/posts/kubecon-china-2025/#åˆ†å¸ƒå¼-llm-æ¨ç†çš„éƒ¨ç½²"},{"categories":["tech","life"],"content":" LLM æ‰©ç¼©å®¹ä¸è´Ÿè½½å‡è¡¡ KubeCon EU 2025 - Optimizing Metrics Collection \u0026 Serving When Autoscaling LLM Workloads è®²å¾—æŒºé£è¶£ï¼Œä¸è¿‡å¯èƒ½æˆ‘å¯¹è¿™å—æ¯”è¾ƒç†Ÿæ‚‰ï¼ŒåŸºæœ¬èƒ½çŒœåˆ°å°±æ˜¯è‡ªå®šä¹‰ä¸šåŠ¡ metrics + ç”¨ KEDA åš custom metrics based scalingï¼Œæ‰€ä»¥å°±åªæ˜¯ç®€å•çœ‹äº†çœ‹ã€‚ KubeCon EU 2025 - Keynote: LLM-Aware Load Balancing in Kubernetes: A New Era of Efficiency - Clayton Coleman, Distinguished Engineer, Google \u0026 Jiaxin Shan, Software Engineer, Bytedance å¾ˆæœ‰æ„æ€ï¼ŒLLM çš„è¯·æ±‚è·Ÿä¼ ç»Ÿçš„ API è¯·æ±‚åŒºåˆ«éå¸¸å¤§ï¼Œä¸»è¦ç‚¹åœ¨äºï¼š input é•¿åº¦åŒºåˆ«å°±éå¸¸å¤§ï¼Œæœ‰çš„è¯·æ±‚ input å¾ˆç®€å•ï¼Œç›¸å¯¹å°±å¾ˆè½»é‡ï¼Œè€Œæœ‰çš„å¯èƒ½ç›´æ¥ä¸¢ä¸€ä»½ PDF æˆ–è€…åˆ«çš„è¶…é•¿æ–‡æœ¬è¾“å…¥ã€‚è¾“å‡ºä¹ŸåŒæ ·å¦‚æ­¤ï¼Œå¦‚æœç”¨æˆ·æ˜ç¡®è¦æ±‚æ·±åº¦æ¨ç†ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¤§é‡æ€§èƒ½æ¶ˆè€—ã€‚ ä¸åŒæœºå™¨å¯èƒ½ä¼šä½¿ç”¨ä¸åŒçš„ GPU ç±»å‹ï¼Œè€Œè¿™äº› GPU çš„æ€§èƒ½å„å¼‚ã€‚ åœ¨ä¸€ä¸ªæ”¯æŒå¤šæ¨¡å‹çš„å¹³å°ä¸Šï¼Œä¸åŒæ¨¡å‹çš„é«˜ä½å³°æœŸä¹Ÿå­˜åœ¨æ¯”è¾ƒæ˜æ˜¾çš„åŒºåˆ«ã€‚ ä¸Šé¢è¿™äº›ç‰¹å¾å¯¼è‡´ä¼ ç»Ÿçš„è´Ÿè½½å‡è¡¡ç­–ç•¥å®Œå…¨å¤±æ•ˆã€‚ è§£å†³æ–¹æ¡ˆ: https://github.com/kubernetes-sigs/gateway-api-inference-extension ","date":"2025-06-15","objectID":"/posts/kubecon-china-2025/:3:3","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Cloud-Native","Kubernetes","AI","LLM","OpenTelemetry"],"title":"KubeCon China 2025 è§é—»","uri":"/posts/kubecon-china-2025/#llm-æ‰©ç¼©å®¹ä¸è´Ÿè½½å‡è¡¡"},{"categories":["tech","life"],"content":" AI æ¨¡å‹åˆ†å‘AI Model Distribution Challenges and Best Practices å‡ ä½å¼€å‘è€…èŠæ€ä¹ˆåœ¨é›†ç¾¤é‡Œåˆ†å‘æ•°ç™¾ GB å¤§å°çš„ LLM æ¨¡å‹ï¼Œä¸šç•Œç›®å‰çš„æ‰‹æ®µï¼š dragonfly juicefs oci model spec + oci volume (k8s 1.33+) ","date":"2025-06-15","objectID":"/posts/kubecon-china-2025/:3:4","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Cloud-Native","Kubernetes","AI","LLM","OpenTelemetry"],"title":"KubeCon China 2025 è§é—»","uri":"/posts/kubecon-china-2025/#ai-æ¨¡å‹åˆ†å‘"},{"categories":["tech","life"],"content":" å¯è§‚æµ‹æ€§ Antipatterns in Observability: Lessons Learned and How OpenTelemetry Solves Them - Steve Flanders, Splunk è¿™ä½ä¹Ÿè®²å¾—æŒºæœ‰æ„æ€ï¼Œè€Œä¸”æœ‰å¹²è´§ã€‚ä»–åˆ—ä¸¾çš„å¯è§‚æµ‹æ€§æ–¹é¢çš„ Antipatterns æœ‰ Telemetry Data IncompleteInstrumentation - éœ€è¦å¼•å…¥zero-code çš„ otel sdk å®ç°è‡ªåŠ¨æ•°æ®é‡‡é›† metrcis/logs/metrics ä¸‰ç±» signals ä¸ä¸€å®šéƒ½é»˜è®¤å¯ç”¨ï¼Œå…·ä½“å¾—çœ‹å¯¹åº”çš„ agent å®ç°æƒ…å†µ åœ¨ k8s ä¸­å»ºè®®åŒæ—¶ç¦ç”¨å°†æ—¥å¿—è¾“å‡ºåˆ° stdout çš„åŠŸèƒ½ä»¥åŠä¼ ç»Ÿçš„ç»™ prometheus pull çš„ /metrics ç«¯ç‚¹ï¼Œç”± otel agent å…¨æƒè´Ÿè´£ App-level ä¸‰å¤§ä¿¡å·çš„å¤„ç†ã€‚daemonset æ¨¡å¼çš„ otel ï¼ˆæˆ–è€… vector/fluentbitï¼‰åˆ™ä¸»è¦ç”¨äºé‡‡é›† sidecar/k8s ç­‰ Infra-level çš„æ—¥å¿—ã€‚ Over-Instrumentation - éœ€è¦åœ¨ otel-collector å±‚è¿‡æ»¤ç²¾ç®€æŒ‡æ ‡ï¼Œå†å‘é€åˆ°å¯¹åº”çš„åç«¯å­˜å‚¨ã€‚ Inconsistent Naming Conventions - å…¨ç›˜æ›¿æ¢ä¸º OpenTelemetry æ–¹æ¡ˆï¼Œå³å¯äº«å—ç»Ÿä¸€çš„å‘½åã€‚ Observability Platform Vendor Lock-in - åªé€‰ç”¨æ”¯æŒ OTel æ ‡å‡†çš„å¹³å°å¹¶ä½¿ç”¨ Otel å‘½åè§„èŒƒã€‚ Tool Sprawl - ä½¿ç”¨å¤§ä¸€ç»Ÿçš„è§‚æµ‹å¹³å°ï¼Œå¦‚ Uptrace, æ”¯æŒè‡ªåŠ¨å…³è” Logs ä¸ Traces. Underestimating Scalability Requirements - ä½¿ç”¨ OTel é‡‡é›†ä¿¡å·ï¼Œå¹¶é€‰ç”¨å¯æ‹“å±•æ€§å¥½çš„åç«¯å­˜å‚¨ï¼Œå¦‚ VictoriaMetrics. Company Culture Silos and Lack of Collaboration Lack of Ownership \u0026 Accountability KubeCon EU 2025 - From Logs To Insights: Real-time Conversational Troubleshooting for Kubernetes With GenAI - Tiago Reichert \u0026 Lucas Duarte, AWS å¼€åœºçš„ OnCall å°å“å°±å¾ˆçœŸå®â€¦ ä¸è¿‡ pod pending 1 åˆ†é’Ÿå°±ç”µè¯å‘Šè­¦æœ‰ç‚¹å¤¸å¼ äº†â€¦ æ¼”å®Œå°å“æ‰å¼€å§‹è®²æ­£å¼å†…å®¹ï¼Œå¤§ä½“ä¸Šå°±æ˜¯æŠŠæ—¥å¿—ç”¨ embed æ¨¡å‹ç¼–ç åå­˜åœ¨ OpenSearch é‡Œåš RAGï¼Œè¿˜ç»™äº† ChatBot k8s readonly çš„æƒé™ï¼ˆban æ‰äº† secrets accessï¼‰ï¼Œç„¶åé€šè¿‡ Deepseek/Claude é—®ç­”æ¥è§£å†³é—®é¢˜ã€‚ ä»£ç : https://github.com/aws-samples/sample-eks-troubleshooting-rag-chatbot Portrait Service: AI-Driven PB-Scale Data Mining for Cost Optimization and Stability Enhancement - Yuji Liu \u0026 Zhiheng Sun, Kuaishou è®²å¿«æ‰‹æ€ä¹ˆåœ¨ 20 ä¸‡å°æœºå™¨çš„è¶…å¤§è§„æ¨¡é›†ç¾¤ä¸Šåšç¨³å®šæ€§ç®¡ç†ä¸æ€§èƒ½ä¼˜åŒ–ã€‚ ä»‹ç»å¾—æ¯”è¾ƒæµ…ï¼Œå¤§æ¦‚å°±æ˜¯ä¼šæ”¶é›†é›†ç¾¤ä¸­éå¸¸å¤šçš„ä¿¡æ¯ï¼Œç”¨ä¸€å¥—å¤§æ•°æ®ç³»ç»ŸæŒç»­å¤„ç†ï¼Œå†ä¸¢ç»™åé¢è®­ç»ƒä¸“ç”¨æ¨¡å‹ï¼Œæ¯ä¸ªæœåŠ¡éƒ½å¯èƒ½æœ‰ä¸€ä¸ªä¸“é—¨çš„èµ„æºä¼˜åŒ–æ¨¡å‹ï¼Œç”¨å®ƒæ¥åšæœ€ç»ˆçš„èµ„æºä¼˜åŒ–ã€‚ è¿™ä¸€å¥—å¯èƒ½å¤ªé‡äº†ï¼Œå¯ä»¥å€Ÿé‰´ï¼Œä½†æ˜¯åœ¨æˆ‘ç›®å‰çš„å·¥ä½œåœºæ™¯ä¸­ä¸å¤ªæœ‰ç”¨ï¼ˆè§„æ¨¡å¤ªå°ï¼‰ã€‚ ","date":"2025-06-15","objectID":"/posts/kubecon-china-2025/:3:5","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Cloud-Native","Kubernetes","AI","LLM","OpenTelemetry"],"title":"KubeCon China 2025 è§é—»","uri":"/posts/kubecon-china-2025/#å¯è§‚æµ‹æ€§"},{"categories":["tech","life"],"content":" Service Mesh Revolutionizing Sidecarless Service Mesh With eBPF - Zhonghu Xu \u0026 Muyang Tian, Huawei ä¸»è¦å°±è®² Huawei è‡ªå·±æçš„ Kmeshï¼Œæœ‰æ¯”è¾ƒè¯¦ç»†çš„è®²åº•å±‚çš„å®ç°æ¶æ„ï¼ˆå…¶å®è·Ÿå»å¹´ KubeCon å¬è¿‡çš„å†…å®¹å‡ ä¹ä¸€æ ·ï¼‰ã€‚ ç®€å•è®²å°±æ˜¯ Ambient Mode é€šè¿‡ istio-cniï¼ˆåº•å±‚æ˜¯ iptablesï¼‰å°†æµé‡æ‹¦æˆªåˆ°ç”¨æˆ·æ€çš„ ztunnel è¿›è¡Œ L4 æµé‡å¤„ç†ï¼Œè€Œ Kmesh ä½¿ç”¨ eBPF åœ¨å†…æ ¸å±‚å®ç°äº†è¿™äº› L4 çš„åŠŸèƒ½ã€‚å¦å¤–è¿˜ç®€å•ä»‹ç»äº† Cilium Service Meshï¼Œæ˜¯ä¸€ä¸ª Per-Node çš„ Proxyï¼Œä¸»è¦ç¼ºç‚¹æ˜¯å¿…é¡»ç”¨ Cilium ç½‘ç»œæ’ä»¶ï¼Œä»¥åŠå®ƒçš„ CRD è¿‡äºåŸå§‹ï¼Œä½¿ç”¨å¤æ‚ã€‚ Kmesh ä¹Ÿå°è¯•ç”¨ eBPF å®ç°äº† HTTP åè®®çš„è§£æï¼Œä½†æ˜¯è¿™éœ€è¦å¯¹å†…æ ¸æ‰“è¡¥ä¸ï¼Œä»£ä»·æ¯”è¾ƒé«˜ã€‚ KubeCon EU 2025 - Choosing a Service Mesh - Alex McMenemy \u0026 Dimple Thoomkuzhy, Compare the Market è™½ç„¶æˆ‘æ¥è§¦è¿‡çš„åŸºæœ¬éƒ½ç”¨çš„ Istioï¼Œä¸è¿‡çœ‹çœ‹åˆ«äººæ€ä¹ˆåšé€‰æ‹©æ€»æ²¡åå¤„ KubeCon EU 2025 - Navigating the Maze of Multi-Cluster Istio: Lessons Learned at Scale - Pamela Hernandez, BlackRock Istio å¤šé›†ç¾¤åœ¨æŒºå¤šå¤§å…¬å¸æœ‰åº”ç”¨ï¼Œä¹‹å‰é¢è¯•å°±è¢«é—®åˆ°è¿‡ï¼Œå¯ä»¥ç©ç©çœ‹ã€‚ KubeCon EU 2025 - A Service Mesh Benchmark You Can Trust - Denis Jannot, solo.io åšä¸€ä¸ªå¥½çš„ Benchmark å¯¹æ¯”è¿˜æŒºè´¹æ—¶é—´è´¹ç²¾åŠ›çš„ï¼Œè¿˜æ˜¯ç›´æ¥çœ‹äººå®¶ç»™çš„ç»“æœæœ€æ–¹ä¾¿ï¼ˆ ","date":"2025-06-15","objectID":"/posts/kubecon-china-2025/:3:6","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Cloud-Native","Kubernetes","AI","LLM","OpenTelemetry"],"title":"KubeCon China 2025 è§é—»","uri":"/posts/kubecon-china-2025/#service-mesh"},{"categories":["tech","life"],"content":" Ingress-NginxThe Next Steps for Ingress-NGINX and the Ingate Project - Jintao Zhang, Kong Inc. Ingress-NGINX ç»ˆäºè¦å¯¿ç»ˆæ­£å¯äº†ï¼Œå®ƒçš„ç»§ä»»è€…å« InGateï¼Œä¸è¿‡ InGate ç›®å‰è¿˜å‡ ä¹æ˜¯ä¸ªç©ºå£³ï¼ˆ ä»£ç  https://github.com/kubernetes-sigs/ingate ","date":"2025-06-15","objectID":"/posts/kubecon-china-2025/:3:7","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Cloud-Native","Kubernetes","AI","LLM","OpenTelemetry"],"title":"KubeCon China 2025 è§é—»","uri":"/posts/kubecon-china-2025/#ingress-nginx"},{"categories":["tech","life"],"content":" å®‰å…¨æ€§Keynote: Who Owns Your Pod? Observing and Blocking Unwanted Behavior at eBay With eBPF ä¸»è¦å°±ä»‹ç» cilium å®¶çš„ tetragon, ä¸€ä¸ªåŸºäº eBPF çš„ K8S å®‰å…¨å·¥å…·ï¼Œè·Ÿ apparmor æ„Ÿè§‰ä¼šæœ‰ç‚¹ç±»ä¼¼ï¼Œä½†æ˜¯èƒ½åšåˆ°æ›´ç²¾ç»†çš„æƒé™ç®¡ç†ã€‚ æœ‹å‹è·Ÿæˆ‘ Argue è¿™ç§å·¥å…·ä¸æ˜¯å¾ˆæœ‰å¿…è¦ï¼Œåº”è¯¥ç”¨ GitOps æµç¨‹ï¼Œç„¶åå°†å®‰å…¨æ£€æŸ¥å‰ç½®åœ¨ CICD æµæ°´çº¿ä¸­ã€‚ ","date":"2025-06-15","objectID":"/posts/kubecon-china-2025/:3:8","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Cloud-Native","Kubernetes","AI","LLM","OpenTelemetry"],"title":"KubeCon China 2025 è§é—»","uri":"/posts/kubecon-china-2025/#å®‰å…¨æ€§"},{"categories":["tech","life"],"content":" äº‘æˆæœ¬åˆ†æä¸ä¼˜åŒ–KubeCon EU 2025 - Autonomous Al Agents for Cloud Cost Analysis - Ilya Lyamkin, Spotify å®ç°ä¸€ä¸ªä¼šè‡ªåŠ¨åš Planï¼Œç¼–å†™ SQL ä¸ Python è¿›è¡Œäº‘æˆæœ¬åˆ†æçš„ Multi-Agent ç³»ç»Ÿï¼Œå¾ˆæœ‰å‚è€ƒä»·å€¼ã€‚ ","date":"2025-06-15","objectID":"/posts/kubecon-china-2025/:3:9","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Cloud-Native","Kubernetes","AI","LLM","OpenTelemetry"],"title":"KubeCon China 2025 è§é—»","uri":"/posts/kubecon-china-2025/#äº‘æˆæœ¬åˆ†æä¸ä¼˜åŒ–"},{"categories":["tech","life"],"content":" WASM ç›¸å…³Keynote: An Optimized Linux Stack for GenAI Workloads - Michael Yuan, WasmEdge è®²æ€ä¹ˆç”¨ WasmEdge + LlamaEdge åœ¨è¾¹ç¼˜è®¾å¤‡ä¸Šè·‘ LLM å°æ¨¡å‹ï¼Œè¿˜æ˜¯æŒºæœ‰æ„æ€çš„ã€‚ ","date":"2025-06-15","objectID":"/posts/kubecon-china-2025/:3:10","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Cloud-Native","Kubernetes","AI","LLM","OpenTelemetry"],"title":"KubeCon China 2025 è§é—»","uri":"/posts/kubecon-china-2025/#wasm-ç›¸å…³"},{"categories":["tech","life"],"content":" å¦‚ä½•æ­å»ºä¸€ä¸ª AI å·¥ä½œæµKubeCon EU 2025 - Tutorial: Build, Operate, and Use a Multi-Tenant AI Cluster Based Entirely on Open Source é•¿åº¦è¶…è¿‡ä¸€ä¸ªå°æ—¶çš„æ•™ç¨‹ï¼ŒIBM å‡ºå“ã€‚è£…äº†ä¸€å †ä¸œè¥¿ï¼ŒåŒ…æ‹¬ Kueue, Kubeflow, PyTorch, Ray, vLLM, and Autopilot ","date":"2025-06-15","objectID":"/posts/kubecon-china-2025/:3:11","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Cloud-Native","Kubernetes","AI","LLM","OpenTelemetry"],"title":"KubeCon China 2025 è§é—»","uri":"/posts/kubecon-china-2025/#å¦‚ä½•æ­å»ºä¸€ä¸ª-ai-å·¥ä½œæµ"},{"categories":["tech","life"],"content":" Non-Techå‚åŠ  KubeCon å…¶å®ä¸ä»…ä»…æ˜¯å¬ä¸€å¬è¿‡å»ä¸€å¹´æŠ€æœ¯æ–¹é¢çš„å˜åŒ–ä¸è¿›å±•ï¼Œè¿˜æœ‰ä¸ªå¾ˆé‡è¦çš„ç›®çš„æ˜¯è·Ÿå„ä¸ªæ–¹å‘çš„å¼€å‘è€…ä»¬ Social, ä¹Ÿå¯ä»¥è¯´æ˜¯æŸç§å¤§å‹ç½‘å‹è§é¢ä¼šï¼ˆ ä»Šå¹´æ‹‰åˆ°äº† @scruelt, @ox-warrior ç­‰å‡ ä½æœ‹å‹ä¸€èµ·å» KubeCon ç©ï¼Œç„¶ååœ¨ä¼šåœºåˆé™†ç»­è·Ÿ@cookie, @rizumu, @ayakaneko ä»¥åŠ @dotnetfx35 è§é¢é—²èŠçæ‰¯äº†ä¸€æ³¢ï¼Œæ”¶è·äº† @rizumu è·Ÿ @ayakaneko ç”¨ 3D æ‰“å°æœºæ‰“å°çš„ Kubernetes è·Ÿ Go å°é¥¼å¹²å„ä¸€æšï¼Œé¡ºä¾¿ä¼ æ•™äº† NixOSï¼ˆ é¢åŸºæˆåŠŸï¼é¡ºä¾¿ä¼ æ•™ NixOS æ‹¿åˆ°çš„ K8s/Go å°é¥¼å¹²ä»¥åŠ Istio å†°ç®±è´´ Day 2 ä¸Šåˆå‘ç°æ²¡å•¥æƒ³å¬çš„ï¼Œå‘ç°æœ‰ä¸ª Peer Group Meeting å‚åŠ ï¼Œä¸è¿‡éœ€è¦å…ˆ sign up. è·Ÿ@scruelt ä¸€èµ·å»æŠ¥äº†åï¼Œæœ¬æ¥è¿˜æ‹…å¿ƒåªæå‰ 20 åˆ†é’Ÿ sign up ä¼šä¸ä¼šæ²¡æœºä¼šäº†ï¼Œç»“æœåˆ°ä¼šè®®å®¤å‘ç°åªæœ‰ 3 ä¸ª mentors åœ¨åœºï¼Œäºæ˜¯å°±æˆ‘ä»¬ä¿©è·Ÿä»–ä»¬éšä¾¿é—²èŠ emmm ä¸‰ä½ mentors åˆ†åˆ«æ˜¯ Nate Waddington ï¼ˆHead of Mentorship \u0026 Documentatio, Canadaï¼‰ï¼ŒKohei Otaï¼ˆCNCF Ambassador, Japanï¼‰ä»¥åŠ Amit DSouzaï¼ˆco-founder of Odyssey Cloud, Australiaï¼‰ï¼Œå¦å¤–èŠåˆ°åŠé€”ä¸€ä½ Cisico çš„è€å“¥ä¹ŸåŠ å…¥äº†è¿›æ¥ã€‚ åŸºæœ¬å°±æ˜¯é—²èŠï¼Œ@scruelt å£è¯­æ¯”æˆ‘å¥½ï¼Œè€Œä¸”åˆšè¾èŒä¹Ÿæœ‰è®¸å¤šé—®é¢˜æƒ³é—®ï¼Œç»å¤§éƒ¨åˆ†è¯é¢˜éƒ½æ˜¯ä»–æå‡ºæ¥çš„ã€‚æˆ‘å› ä¸ºæœ€è¿‘è¯¸äº‹çš†é¡ºï¼Œåè€Œæ²¡å•¥æƒ³é—®çš„ã€‚ è¿›äº† Peer Group Meeting å‘ç°åªæœ‰ Mentors hhh æœ€åå°±æ”¾äº›å›¾å§ã€‚ æ¬¢è¿å…‰ä¸´ KubeCon China 2025 å…ˆé¢†ä¸ª T æ¤å˜¿å˜¿ èŒ¶æ­‡æ—¶é—´ SUSE çš„æ¯›ç»’ç©å…·å¥½æƒ³è¦ï¼ å¤§ SUSE ä¸Šä¸€åªå° SUSE ç”¨ tetragon é™åˆ¶æ–‡ä»¶è®¿é—® LWS çš„ Talkï¼Œåœ¨è®² PD åˆ†ç¦» Switch åº—åœ¨å®£ä¼  Miku Boxing ç´¯è®¡æœ‰ä¸‰ä¸ªæœ‹å‹ KubeCon æœŸé—´åœ¨è¿™é‡Œä¹°äº† Switch 2ï¼Œå®ƒè¿™æ³¢è¡€èµš æˆ‘çš„æ‰€æœ‰'æˆ˜åˆ©å“' hhh ç™»æœºäº†ï¼Œå†è§æ·±åœ³ è¿™æ˜¯æˆ‘ç¬¬å‡ æ¬¡åé£æœºæ¥ç€ï¼Ÿ æ€»ä¹‹ç©å¾—å¾ˆå¼€å¿ƒï¼Œæ˜å¹´å†è§ï¼ ","date":"2025-06-15","objectID":"/posts/kubecon-china-2025/:4:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Cloud-Native","Kubernetes","AI","LLM","OpenTelemetry"],"title":"KubeCon China 2025 è§é—»","uri":"/posts/kubecon-china-2025/#non-tech"},{"categories":["life","tech"],"content":" å‰è¨€ç›¸æ¯”è·Œå®•èµ·ä¼çš„ 2023 å¹´, 2024 å¹´æˆ‘å°‘äº†ä¸€äº›ç„¦è™‘ä¸å†…è€—, èŠ±åœ¨æŠ€æœ¯ä¸Šçš„æ—¶é—´ä¹Ÿå°‘äº†ä¸å°‘. æˆ‘å°†å¤§é‡çš„ç²¾åŠ›è½¬ç§»åˆ°äº†å¾’æ­¥æ—…è¡Œä¸Š, äº«å—äº†è¯¸å¤šæ—…è¡Œçš„å¿«ä¹. å¯èƒ½å› ä¸º 23 å¹´å†™çš„å¤ªå¤šï¼Œ24 å¹´å°‘äº†äº›åˆ›ä½œçš„çƒ­æƒ…ï¼Œä¹Ÿå› æ­¤è¿™ä»½å¹´ç»ˆä¸€ç›´æ‹–ç€ã€‚æœ¬æ¥æƒ³æ•ˆä»¿å»å¹´çš„é£æ ¼è¿‡ä¸€éä¸€æ•´å¹´ä¸­æ¯”è¾ƒæœ‰æ„ä¹‰çš„äº‹æƒ…ï¼Œä½†æ˜¯ä¸å¤ªèƒ½ä¸‹æ‰‹ã€‚ ä¸è¿‡ï¼Œæ€»å¾—å†™ç‚¹ä»€ä¹ˆç»™è¿™ä¸€å¹´ç”»ä¸Šä¸€ä¸ªå¥å·ï¼Œä»Šå¤©æ€»ç®—äº¤å·®äº†. ","date":"2025-01-07","objectID":"/posts/2024-summary/:1:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"æˆ‘çš„ 2024 - ç¨³ä¸­æ±‚è¿›ã€çƒ­çˆ±ç”Ÿæ´»","uri":"/posts/2024-summary/#å‰è¨€"},{"categories":["life","tech"],"content":" 2024 å¹´ Highlights","date":"2025-01-07","objectID":"/posts/2024-summary/:2:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"æˆ‘çš„ 2024 - ç¨³ä¸­æ±‚è¿›ã€çƒ­çˆ±ç”Ÿæ´»","uri":"/posts/2024-summary/#2024-å¹´-highlights"},{"categories":["life","tech"],"content":" 1. æ—…è¡Œä¸å¾’æ­¥2024 å¹´è·Ÿ 2023 å¹´æœ€å¤§çš„å˜åŒ–, æ˜¯æˆ‘ 3 æœˆä»½æŠ½æ—¶é—´åŠäº†æ¸¯æ¾³é€šè¡Œè¯è·ŸæŠ¤ç…§, åœ¨é¦™æ¸¯è·Ÿå†…åœ°å®Œæˆäº†å¤šæ¬¡å¾’æ­¥æ—…è¡Œ, ä»Šå¹´çš„æœ€åä¸€å¤©ä¹Ÿæ˜¯åœ¨é¦™æ¸¯ç»´å¤šåˆ©äºšæ¸¯çš„çƒŸèŠ±ä¸­åº¦è¿‡çš„. è¿™ç¯‡æ–‡ç« çš„å°é¢å›¾å°±æ˜¯é¦™æ¸¯ç»´å¤šåˆ©äºšæ¸¯çš„è·¨å¹´çƒŸèŠ±(å› ä¸ºè‡ªå·±æ‹æ‘„çš„è§’åº¦ä¸å¤ªå¥½, æ‰€ä»¥ç½‘ä¸Šæ‰¾äº†è¿™å¼ å›¾). æˆ‘åœ¨ 2024 å¹´çš„å¾’æ­¥æ—…è¡Œä¸ City Walk è®°å½•å¦‚ä¸‹: 3/30 - SRE å°ç»„ç¬¬ä¸€æ¬¡ä»¥æˆ·å¤–è¿åŠ¨çš„å½¢å¼è¿›è¡Œå›¢å»ºï¼Œä¸€èµ·çˆ¬äº†å‡¤å‡°å±±ï¼ˆé²²é¹å¾„ï¼‰ 4/4 - è·Ÿæˆ‘å¦¹ä¸€èµ·é€›äº†ä»™æ¹–æ¤ç‰©å›­ï¼Œå¾ˆå¤šå¥‡èŠ±å¼‚è‰ï¼Œå¦å¤–å›ç¨‹æ„å¤–çˆ¬ä¸Šäº†æ¢§æ¡å±±ï¼Œç»™æˆ‘ä¿©éƒ½ç´¯åäº†ï¼Œ å½“ç„¶ä¹Ÿå¾ˆå¼€å¿ƒ 4/14 - ç¬¬ä¸€æ¬¡å»é¦™æ¸¯ç©ï¼Œä»ç»´å¤šåˆ©äºšæ¸¯æ²¿ç€æµ·å²¸çº¿ä¸€è·¯å¾’æ­¥åˆ°åšå°¼åœ°åŸï¼Œç„¶åååœ°é“å›å®¶ï¼Œæµ·å²¸çº¿å¾ˆç¾ï¼Œé¦™æ¸¯ä¹Ÿæœ‰ç‹¬ç‰¹çš„é£åœŸäººæƒ…åœ¨ è§£é”æˆå°± - ç¬¬ä¸€æ¬¡å‡ºå¢ƒä¸­å›½å¤§é™† 5/2 ~ 5/3 - å•äººåˆ·äº†ä¸€éé¦™æ¸¯éº¦é‡Œæµ©å¾„äºŒæ®µï¼Œä»åŒ—æ½­å‡¹ç®¡ç†ç«™ä¸‹è½¦å¼€å§‹å¾’æ­¥ï¼Œæ²¿ç€éº¦ç†æµ©å¾„äºŒæ®µåˆèµ°å›åˆ°åŒ—æ½­å‡¹ç«™ï¼Œç®—æ˜¯ç¯çº¿ï¼Œå¤§æ¦‚ 20 åˆ° 30 å…¬é‡Œçš„æ ·å­ï¼Œä¸­é—´åœ¨è¥¿æ¹¾æ‘ç§Ÿå¸ç¯·éœ²è¥äº†ä¸€æ™šä¸Š è§£é”æˆå°± - ç¬¬ä¸€æ¬¡éœ²è¥ã€ç¬¬ä¸€æ¬¡åœ¨å±±æ—é‡Œå­¤èº«èµ¶å¤œè·¯ ä¸çŸ¥é“æ˜¯è°ï¼Œåœ¨ç‰›ç²ªä¸Šæ’é²œèŠ± emmm è¿™ä¸€æ®µé£æ™¯ç»èµï¼Œå…¨ç¨‹æœ€ä½³ï¼ 5/18 - 5/19 - å•äººèƒŒç€ 17 å…¬æ–¤çš„èƒŒåŒ…é‡è£…å¾’æ­¥éº¦ç†æµ©å¾„ä¸‰æ®µï¼Œä¸­é—´è¿˜è§£é”äº†ä¸€äº›æ”¯çº¿ï¼Œå…¨ç¨‹èµ°äº† 14 å…¬é‡Œï¼Œèµ°èµ°åœåœè¿‘ 8 ä¸ªå°æ—¶ï¼ˆä½“åŠ›ä¸å¤Ÿæ‰€ä»¥èµ°å¾—å¾ˆæ…¢ï¼‰ï¼Œå¤œé—´åœ¨æ°´æµªçªè¥åœ°éœ²è¥äº†ä¸€æ™šä¸Š è§£é”æˆå°± - ç¬¬ä¸€æ¬¡é‡è£…å¾’æ­¥ å±±é¡¶ç»§ç»­å‰è¡Œï¼Œè¿œæ–¹åŸå¸‚ç¯ç«é€šæ˜ æ¸…æ™¨ 7 ç‚¹å¤šï¼Œè§£å†³å«ç”Ÿé—®é¢˜ï¼Œé¡ºä¾¿éšå¤„èµ°èµ°ï¼Œå‘ç°è¥åœ°æ ‡ç‰Œ 5/25 - ç»§ç»­å•äººå¾’æ­¥éº¦å¾„å››æ®µï¼Œåä¹å·´ 299X è·¯åˆ°å¤§æµªçªç«™ä¸‹è½¦å¼€å§‹å¾’æ­¥ï¼Œä»å››æ®µèµ·ç‚¹å‡ºå‘çš„æ—¶é—´ä¸º 13:20ï¼Œåˆ°è¾¾å¤§è€å±±éš§é“ç«™æ—¶å·²ç»æ˜¯ 22:20, å…¨ç¨‹å·®ä¸å¤š 9 ä¸ªå°æ—¶ï¼Œè¶…è¿‡ 21 å…¬é‡Œï¼ŒèƒŒçš„è¿˜æ˜¯ 16kg çš„é‡è£…èƒŒåŒ… è§£é”æˆå°± - ç¬¬ä¸€æ¬¡é‡è£…å¾’æ­¥è¶…è¿‡ 20 å…¬é‡Œï¼Œåˆ°ç›®å‰ä¸ºæ­¢çš„äººç”Ÿå·…å³°äº† è¿™åº”è¯¥æ˜¯å››æ®µé£æ™¯æœ€å¥½çš„ä¸€æ®µ, å¯æƒœé›¾å¤ªå¤§ 6/22 - 6/23 - å¾’æ­¥è‡³é“…çŸ¿å³è¥åœ°éœ²è¥ è§£é”æˆå°± - è¿™æ¬¡å¸¦äº†å¡å¼ç‚‰æ°”ç½è·Ÿç‚Šå…·ï¼Œç¬¬ä¸€æ¬¡æˆ·å¤–åšé¥­ï¼Œå¾ˆé¦™ 6/29 - ä¸åŒäº‹å››äººç»„å›¢éº¦ç†æµ©å¾„ä¸€äºŒæ®µå¾’æ­¥ ä»åŒ—æ½­å‡¹åç©¿ï¼Œä¸€è·¯èµ°åˆ°ä¸‡å®œæ°´åº“ä¸œåï¼Œå› ä¸ºè®¡åˆ’å•æ—¥å¾’æ­¥ï¼Œè¿™æ¬¡åªèƒŒäº† 30 å‡å°åŒ…ï¼Œè¿åŠ¨é‡ç›¸æ¯”ä¹‹å‰å‡ æ¬¡å¹¶ä¸å¤§ è§£é”æˆå°± - ç¬¬ä¸€æ¬¡ä¸åŒäº‹ç»„å›¢é•¿è·ç¦»å¾’æ­¥ã€ç¬¬ä¸€æ¬¡å¤§é›¨ä¸­å¾’æ­¥ï¼ˆæœ‰é£é™©ï¼Œä¸å»ºè®®å†’é›¨ä¸Šå±±ï¼‰ 08/03 - è·Ÿè€å¦¹ä¸€èµ·åœ¨é¦™æ¸¯ç»´å¤šåˆ©äºšæ¸¯æ²¿æµ·æ¼«æ­¥ï¼Œäººæ¯”ä¹‹å‰äº”ä¸€å‡æœŸå°‘äº†å¤ªå¤šï¼Œä½“éªŒéå¸¸å¥½ï¼å¯ä»¥æ‚ é—²åœ°æ…¢æ…¢èµ°ï¼Œæ‹ç…§ï¼ŒèŠå¤© 8/21 - 8/23 - åœ¨é¦™æ¸¯å‚åŠ ä¸ºæœŸä¸‰å¤©çš„ KubeCon China 2024, é¡ºä¾¿è·Ÿç€æœ‹å‹é€›é¦™æ¸¯ ä¸»ä¼šåœºè¿‡å…ï¼Œæµ·æ™¯ä¸é”™çš„ å†°é•‡é¥®æ–™ä¹Ÿå¯ä»¥éšä¾¿å–ï¼Œå¥½å“‡ å¥½å¤šçš„ CNCF è´´çº¸ï¼Œå¯ä»¥éšä¾¿æ‹¿ï¼Œæˆ‘ç»™åŒäº‹ä¹Ÿå¸¦äº†ä¸€äº› é¦™æ¸¯å¤œæ™¯ï¼Œç›¸å½“ç¹åå“ª Linus å’±çš„åˆå½± 10/18 - 10/19 - å…¬å¸å›¢å»ºï¼Œåœ¨æƒ å·ä¸œæ±Ÿç©çš®åˆ’è‰‡ï¼Œ18 å…¬é‡Œï¼ŒæŒºæ„‰å¿« è·ŸåŒäº‹åˆ’çš®åˆ’è‰‡ æ±Ÿè¾¹æ”¾ç‚¹çƒŸèŠ±ï¼Œä¸å¾—ä¸è¯´å…¬å¸æ˜¯ä¼šç©çš„ 10/26 - 10/27 - è·ŸåŒäº‹æ­¦åŠŸå±±å¾’æ­¥ï¼Œ10/25 æå‰ä¸‹ç­åé«˜é“åˆ°é•¿æ²™ä¼‘æ¯ï¼Œ10/26 æ—©ä¸Šåé«˜é“åˆ°èä¹¡å†å«è½¦é€åˆ°æ­¦åŠŸå±±ä¸‹å¼€å§‹å¾’æ­¥ã€‚æˆ‘ä»¬æ˜¯åç©¿ï¼Œç¬¬ä¸€å¤©å¾’æ­¥åˆ°äº‘ä¸­å³°å®¢æ ˆä½å®¿ï¼Œç¬¬äºŒå¤©ä¸Šåˆç»§ç»­å¾’æ­¥åˆ°æ­¦åŠŸå±±å¤§é—¨å£ï¼Œä¸­é—´ä¹˜äº†ä¸¤æ®µä¸‹å±±ç´¢é“ã€‚ä¸¤å¤©æ­¦åŠŸå±±éƒ½èµ·å¤§é›¾ï¼Œæ²¡çœ‹åˆ°æ—¥å‡ºï¼Œè§†é‡ä¹Ÿå·®äº†è®¸å¤šï¼Œä½†äº‘æµ·ä¹Ÿè¿˜ç®—ä¸é”™ï¼Œåœ¨å±±è„Šçº¿ä¸Šèµ°ï¼Œä¸¤è¾¹éƒ½æ˜¯æ‚¬å´–ï¼Œè€Œä¸”è¿˜å¥½å¤§çš„é£ï¼Œè¿˜æ˜¯æœ‰ç‚¹åˆºæ¿€çš„ 10/27 å‡Œæ™¨, å–ç€çƒ­æ°´æ¬£èµæ—©æ™¨å››äº”ç‚¹çš„å±±æ™¯ 10/27 å¿«æ¸…æ™¨å…­ç‚¹äº†ï¼Œå¯¹é¢å±±ä¸Šçš„æ—©é¤å«å–å£°éš”è¿™ä¹ˆè¿œéƒ½å¬å¾—åˆ° 10/27 ä»äº‘ä¸­å³°å®¢æ ˆå†æ¬¡å‡ºå‘ 11/23 - SRE å°ç»„æ·±åœ³æ¢…æ—ç™»å±±å¾’æ­¥, è·¯ç¨‹å¤§æ¦‚ 14 å…¬é‡Œ, æ—©ä¸Š 9 ç‚¹ 30 ä»æ¢…æ—æ°´åº“å¤§åå‡ºå‘ï¼Œä¸‹åˆ 14 ç‚¹ 50 åˆ°ç»ˆç‚¹, å…¨ç¨‹ 5 ä¸ªå¤šå°æ—¶ 11/24 - åˆ°é¦™æ¸¯æ‹›å•†å±€ç å¤´çœ‹æµ·å—èˆ°(075 ä¸¤æ –æ”»å‡»èˆ°), ä¸è¿‡æ²¡æ‹¿åˆ°é—¨ç¥¨ä¸Šèˆ¹å‚è§‚ 11/30 - é™ªæœ‹å‹é¦™æ¸¯åŠé“¶è¡Œå¡, é¡ºä¾¿åœ¨çš‡åå¤§é“è·Ÿç»´å¤šåˆ©äºšæ¸¯ä¸€ç›´ City Walk åˆ°æ™šä¸Šä¹ç‚¹ æ²¿ç€çš‡åå¤§é“èµ°åˆ°äº†ä¸€æ¡å¸‚é›†å°è¡—ï¼ŒèŠ‚æ—¥æ°›å›´æµ“åš K11 å•†åœºæµ·è¾¹çš„åœ£è¯æ ‘å¸ƒæ™¯ï¼Œå¥½å¤šäººæ‹ç…§ ç»´æ¸¯æ¸¡è½®ä¸Šå›å¤´ï¼Œèƒ½çœ‹åˆ°æ ‡å¿—æ€§çš„æ‘©å¤©è½® 12/31 - 2024 å¹´æœ€åä¸€å¤©, åœ¨é¦™æ¸¯ City Walk, æ™šä¸Šåˆ°ç»´å¤šåˆ©äºšæ¸¯çœ‹è·¨å¹´çƒŸèŠ±ï¼Œäººå±±äººæµ·ï¼Œå¾ˆæœ‰æ°›å›´ æˆ‘æ‹çš„çƒŸèŠ±ï¼Œä½ç½®ä¸å¥½æ•ˆæœå·®æŒºå¤š æˆ‘æ‹çš„çƒŸèŠ± - 2 æˆ‘æ‹çš„çƒŸèŠ± - 3 å…³äºé¦™æ¸¯å¾’æ­¥æ—…è¡Œçš„ç»†èŠ‚, æˆ‘ä¹‹å‰ä¸“é—¨å†™è¿‡ç¯‡æ–‡ç« , æœ‰å…´è¶£çš„å¯ä»¥çœ‹çœ‹: 2024 å¹´é¦™æ¸¯å¾’æ­¥æ—…è¡Œè®°å½•ï¼ˆä¸€ï¼‰ - This Cute World æ€»çš„æ¥è¯´, æˆ‘ 2024 å¹´çš„è¿åŠ¨é‡è¿œè¶… 2023 å¹´, è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å¼€å§‹. ","date":"2025-01-07","objectID":"/posts/2024-summary/:2:1","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"æˆ‘çš„ 2024 - ç¨³ä¸­æ±‚è¿›ã€çƒ­çˆ±ç”Ÿæ´»","uri":"/posts/2024-summary/#1-æ—…è¡Œä¸å¾’æ­¥"},{"categories":["life","tech"],"content":" 2. ä¸šä½™æŠ€æœ¯ä»Šå¹´ä¸šä½™æŠ€æœ¯ä¸Šçš„è¿›å±•æ¯”è¾ƒç¬¦åˆå»å¹´åº•çš„æœŸæœ›. é¦–å…ˆæ˜¯åœ¨æˆ‘ Homelab ä¸Šæ›´æ·±å…¥åœ°ä½¿ç”¨äº† NixOS ç³»ç»Ÿ, å…¶æ¬¡ä¹Ÿå‘è¡¨äº†ä¸€äº›ä¸é”™çš„ NixOS æ–‡ç« , è¿˜ç»™ Nixpkgs æäº†ä¸€äº› PR, å¦å¤–å»å¹´åšçš„å‡ ä¸ª Nix ç›¸å…³å¼€æºé¡¹ç›®çš„ stars ä¹ŸæŒç»­å¢é•¿. å…¶æ¬¡æ˜¯åœ¨ Linux ç³»ç»Ÿç¼–ç¨‹è·Ÿ Rust è¯­è¨€æ–¹é¢å–å¾—äº†ä¸é”™çš„è¿›å±•, å­¦ä¹ è¿™äº›æŠ€æœ¯çš„è¿‡ç¨‹ä¸­, å¯¹è¿‡å»é‡åˆ°çš„è®¸å¤š Linux ç³»ç»Ÿæ•…éšœä¹Ÿæœ‰äº†æ›´æ·±çš„ç†è§£. ç®—æ˜¯å¹´åº•ä¸¤ä¸ªæœˆæœ€æœ‰ä»·å€¼çš„æŠ€æœ¯çªç ´. 2024 å¹´æˆ‘å†™è¿‡çš„ä¸€äº›æŠ€æœ¯æ–‡ç« : ä¸ªäººæ•°æ®å®‰å…¨ä¸å®Œå…¨æŒ‡å— è¿™æ˜¯æˆ‘ 2023 å¹´ 5 æœˆå¼€å§‹çš„ä¸€ä¸ªé•¿æœŸè®¡åˆ’ï¼Œåˆ° 2024 å¹´ä¸­æ—¶è¿™ä»½è®¡åˆ’åŸºæœ¬è½åœ°ï¼Œå†™äº†è¿™ç¯‡åšå®¢æ€»ç»“æˆ‘å½“å‰çš„æ–¹æ¡ˆã€‚ Kubernetes é›†ç¾¤ä¼¸ç¼©ç»„ä»¶ - Karpenter è¿™ç¯‡æ–‡ç« æ¥è‡ªæˆ‘è¿‡å»å‡ å¹´å·¥ä½œä¸­å¯¹ Karpenter çš„ç ”ç©¶ä¸æ”¹é€ ç»éªŒ. KubeCon China 2024 ä¹‹æ—… å‚åŠ  KubeCon China 2024 çš„ä¸€äº›æ„Ÿå—, æŠ€æœ¯è·Ÿæ—…è¡Œç»“åˆçš„ä¸€ç¯‡æ–‡ç« . OS as Code - æˆ‘çš„ NixOS ä½¿ç”¨ä½“ä¼š åœ¨çŸ¥ä¹ä¸Šå›ç­”äº†ä¸€ä¸ªå…³äº NixOS çš„é—®é¢˜å†™çš„æ–‡ç« , è‹±æ–‡ç‰ˆè¿˜å¾—åˆ°äº† NixOS å®˜æ–¹çš„æ¨ç‰¹è½¬å‘. NixOS åœ¨ Lichee Pi 4A ä¸Šæ˜¯å¦‚ä½•å¯åŠ¨çš„ è¿™ç¯‡å®é™…æ˜¯ 23 å¹´çš„å­˜è´§. 24 å¹´æˆ‘å†™çš„æ–‡ç« ç›¸è¾ƒ 23 å¹´å°‘äº†ä¸å°‘, ä¸è¿‡æ•´ä½“è´¨é‡æ˜¯æœ‰æ‰€æé«˜çš„. è€ƒè™‘åˆ° 24 å¹´æˆ‘åœ¨æ—…è¡Œå¾’æ­¥ä»¥åŠå…³å¿ƒå®¶äººä¸ŠèŠ±äº†è®¸å¤šæ—¶é—´, è¿™ä¸ªæˆç»©ä¹Ÿå¯ä»¥æ¥å—. æœ€åå†å¯¹æ¯”ä¸‹ä» 2024 å¹´ 12 æœˆ 31 æ—¥åˆ°ç°åœ¨ï¼Œæˆ‘çš„ GitHub Metrics ç»Ÿè®¡æ•°æ®ï¼š 2023/12/31 GitHub ç»Ÿè®¡æ•°æ® 2025/01/01 GitHub ç»Ÿè®¡æ•°æ® 2024 å¹´æˆ‘æ²¡æœ‰å¼€ä»€ä¹ˆæ–°çš„é¡¹ç›®, ä¸Šè¿°æˆç»©åŸºæœ¬éƒ½æ˜¯ 2023 å¹´çš„æ—§é¡¹ç›® Stars ç¨³æ­¥å¢é•¿å¸¦æ¥çš„. ","date":"2025-01-07","objectID":"/posts/2024-summary/:2:2","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"æˆ‘çš„ 2024 - ç¨³ä¸­æ±‚è¿›ã€çƒ­çˆ±ç”Ÿæ´»","uri":"/posts/2024-summary/#2-ä¸šä½™æŠ€æœ¯"},{"categories":["life","tech"],"content":" 3. å·¥ä½œå·¥ä½œä¸Š, 2024 ä¹Ÿä»ç„¶æ˜¯æŒ‰éƒ¨å°±ç­çš„ä¸€å¹´, æˆ‘æœ‰åšä¸€äº›æ–°æŠ€æœ¯çš„å°è¯•, ä½†æ€»ä½“æ¥è¯´å˜åŒ–ä¸å¤š. ä¸å¾€å¹´ä¸åŒçš„æ˜¯, ä»Šå¹´åœ¨å·¥ä½œä¸Šé‡åˆ°çš„æ›´å¤šæ˜¯æŠ€æœ¯ä¹‹å¤–çš„é—®é¢˜. ä¸€äº›å›¢é˜Ÿåä½œã€æ²Ÿé€šã€ç®¡ç†ç­‰é—®é¢˜, è®©æˆ‘è®¤è¯†åˆ°äº†å…¬å¸ä¸å„ä¸ªå›¢é˜Ÿçš„å¦ä¸€é¢, ä»¥åŠäººçš„å¤æ‚æ€§. å•çº¯ä»å·¥ä½œå†…å®¹çš„è§’åº¦çœ‹, å·¥ä½œè¶Šæ¥è¶Šå¾—å¿ƒåº”æ‰‹, ç›¸å¯¹çš„ä¹Ÿå°±è¶Šæ¥è¶Šéš¾ä»¥æ¿€å‘æˆ‘çš„å…´è¶£ä¸åŠ¨åŠ›, å¯¹ ADHDer è€Œè¨€è¦æŒ‰éƒ¨å°±ç­åœ°æŠŠè¿™ç±»å·¥ä½œåšå¥½, æŒ‘æˆ˜å¾ˆå¤§. æ€»ä¹‹å¤šæ–¹å› ç´ å½±å“ä¸‹, æˆ‘åœ¨ 24 å¹´åº•ä¸æƒ³å¹²äº†, é‚å‘ leader æå‡ºäº†è¾èŒ, ç›®å‰å·²ç»ç¡®å®š last day æ˜¯ 2025 å¹´ 1 æœˆåº•, æ­£åœ¨äº¤æ¥å·¥ä½œä¸­. æˆ‘ 2021 å¹´å…¥èŒè¿™å®¶å…¬å¸, åˆ°ç¦»å¼€å¤§æ¦‚æ˜¯ 3 å¹´é›¶ 10 ä¸ªæœˆ, ä¸€æ®µè¯´é•¿ä¸é•¿è¯´çŸ­ä¸çŸ­çš„æ—¶å…‰. è¿™æ˜¯æˆ‘ä»ä¸šç”Ÿæ¶¯çš„ç¬¬äºŒä»½å·¥ä½œ, å›è¿‡å¤´çœ‹, 21 å¹´åˆšå…¥èŒæ—¶æˆ‘è¿˜æ˜¯èŒæ–°ä¸€ä¸ª, åšäº‹æƒ…éƒ½å¾ˆå°å¿ƒç¿¼ç¿¼, å½“æ—¶æˆ‘å¯¹å…¬å¸çš„è¯„ä»·æ˜¯ æ¢¦å¹»èˆ¬çš„å¾…é‡ï¼Œä¸é™é‡çš„ä¸‰é¤ä¾›åº”ï¼Œçª—æ˜å‡ å‡€çš„è½åœ°çª—å·¥ä½ï¼Œè¿™ä¸€åˆ‡éƒ½åƒæ˜¯åœ¨åšæ¢¦ è¿˜æœ‰ 22 å¹´åˆå‘è¿‡çš„æ¨æ–‡ä¹Ÿæ˜¯ç›¸å½“æ­£é¢çš„: æ–°åŠå…¬åŒºçœŸå¥½å‘ï½ å€¼æ­¤è‰¯è¾°ç¾æ™¯ï¼Œå¥½æƒ³æ•´ä¸ªæ¦»æ¦»ç±³åå«ï¼Œååœ¨è§’è½çš„è½åœ°çª—è¾¹å·¥ä½œğŸ¤£ é‚£ç§ä½¿ç”¨å…¬å…±è®¾æ–½å·¥ï¼ˆmoï¼‰ä½œï¼ˆyuï¼‰çš„ä¹è¶£ï¼Œä»¥åŠå¹³å¸¸å·¥ä½è§ä¸åˆ°çš„æ™¯è‰²äº¤ç›¸è¾‰æ˜ ï¼Œæ˜¯ä¸å¤ªå¥½è¡¨è¿°çš„å¥‡å¦™ä½“éªŒ pic.twitter.com/FASffzw8N3 â€” ryan4yin | æ–¼æ¸…æ¨‚ (@ryan4yin) January 17, 2022 ä»å…¥èŒä¸€ç›´åˆ° 24 å¹´ä¸ŠåŠå¹´, æˆ‘åœ¨è¿™é‡Œçš„å·¥ä½œä½“éªŒéƒ½æ˜¯å¾ˆä¸é”™çš„. åªèƒ½è¯´å¾ˆæ„Ÿæ…¨å§, ä¸‰å¹´å¤šçš„æ—¶é—´, æˆ‘åœ¨è¿™é‡Œå­¦åˆ°äº†å¾ˆå¤š. æˆ‘å¾ˆæ„Ÿè°¢æˆ‘çš„ä¸¤ä»» leader, ä»–ä»¬éƒ½ç»™æˆ‘äº†å¾ˆå¤šæœºä¼š, è®©æˆ‘èƒ½å¤Ÿåœ¨å·¥ä½œä¸­ä¸æ–­æˆé•¿. ä¹Ÿå¾ˆæ„Ÿè°¢ SRE çš„å…¶ä»–åŒäº‹, åœ¨æˆ‘é‡åˆ°å›°éš¾æ—¶ç»™äºˆäº†æˆ‘å¾ˆå¤šå¸®åŠ©. åä¼šæœ‰æœŸ! ","date":"2025-01-07","objectID":"/posts/2024-summary/:2:3","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"æˆ‘çš„ 2024 - ç¨³ä¸­æ±‚è¿›ã€çƒ­çˆ±ç”Ÿæ´»","uri":"/posts/2024-summary/#3-å·¥ä½œ"},{"categories":["life","tech"],"content":" 4. é˜…è¯»2024 å¹´æˆ‘åœ¨é˜…è¯»æ–¹é¢, æœ€å¤§çš„äº®ç‚¹åº”è¯¥æ˜¯ç»ˆäºè¯»å®Œäº†ã€ŠLinux/Unix ç³»ç»Ÿç¼–ç¨‹æ‰‹å†Œï¼ˆä¸Šå†Œï¼‰ã€‹, å¹¶ä¸”ä½¿ç”¨ Rust åšäº†ä¸å°‘ä¹ é¢˜. 2024 å¹´å®Œæ•´çš„å·²è¯»ä¹¦ç›®: ã€Šæˆ·å¤–æ—…è¡Œç»ˆææŒ‡å—ï¼šåŸºç¡€è£…å¤‡ã€éœ²è¥æŠ€èƒ½ã€äº¤é€šæ–¹å¼ã€é¥®é£Ÿã€ç¯å¢ƒå’Œæ€¥æ•‘ã€‹ï¼šå†…å®¹å¾ˆå¤šï¼Œä½†éƒ½æ¯”è¾ƒå…¥é—¨çº§ï¼Œå¥½å¤„æ˜¯å›¾å¾ˆå¤šï¼Œè¯»ç€å¾ˆè½»æ¾ï¼Œå‡ ä¸ªå°æ—¶å°±èƒ½èµ°é©¬è§‚èŠ±å…¨è¿‡ä¸€éã€‚ Programming Kubernetes - Developing Cloud Native Applications: 2022 å¹´å¼€å§‹è¯»çš„ä¹¦ï¼Œä½†å½“æ—¶æ²¡å•¥å…´è¶£ã€‚æœ€è¿‘åœ¨ç…§çŒ«ç”»è™å†™ karpenter providerï¼Œæœ‰äº†äº›ç¼–ç¨‹ç»éªŒååˆå¯¹å®ƒäº§ç”Ÿäº†å…´è¶£ã€‚ä¹¦ä¸åšï¼ŒèŠ±äº†ä¸‰ä¸ªå°æ—¶èµ°é©¬è§‚èŠ±å…¨è¯»äº†ä¸€éï¼Œä»£ç å†…å®¹å¤§éƒ½è·³è¿‡äº†ï¼ˆä¸å°‘ä¹Ÿè¿‡æ—¶äº†ï¼Œè­¬å¦‚è¿˜åœ¨ä»‹ç» depï¼‰ï¼Œåšäº†äº›ç¬”è®°ã€‚æŒºæœ‰å¸®åŠ©ï¼Œå¸®æˆ‘ç³»ç»Ÿåœ°æ¢³ç†äº†æœ€è¿‘æŠ˜è…¾ karpenter å­¦åˆ°çš„ operator ç¼–ç¨‹ç›¸å…³çŸ¥è¯†ã€‚ èµ°å‡ºè’é‡ 2021 å¹´ 2 æœˆè¯»æ­¤ä¹¦çš„è¯„ä»·ï¼šã€Œæ²¡è¯»ä¹¦çš„å†…å®¹å‰ï¼Œæˆ‘å®Œå…¨æ²¡é¢„æ–™åˆ°ä½œè€…çš„äººç”Ÿæ›¾å¦‚æ­¤ä¸å ªã€‚ æœ€è¿‘åˆšç¦»èŒï¼Œæ¯•ä¸šåçš„ç¬¬ä¸€ä»½å·¥ä½œå°±è¿™æ ·ç»“æŸäº†ã€‚å¿ƒé‡Œå¥½å¤šæƒ³æ³•ï¼Œä¹Ÿå¥½æƒ³å¤šçœ‹çœ‹è¿™ä¸ªä¸–ç•Œã€‚ å—¯ï¼Œæœ‰ç‚¹æƒ³æ¥ä¸Šä¸€æ¬¡å¾’æ­¥æ—…è¡Œäº†å“ˆå“ˆã€‚ã€ 2024 å¹´ 7 æœˆé‡è¯»è¯„ä»·ï¼šã€Œä»Šå¹´æˆ‘çˆ±ä¸Šäº†å¾’æ­¥ï¼Œé‡è¯»æ­¤ä¹¦ï¼Œåˆæœ‰æ–°çŸ¥ã€‚æˆ‘æƒ³å¾’æ­¥ä¹Ÿç±»ä¼¼è·‘æ­¥ï¼Œä¹Ÿå­˜åœ¨æ‘ä¸Šæ˜¥æ ‘æ‰€è¨€çš„è·‘è€…è“è°ƒã€‚ä»Šå¹´å·²ç»åœ¨é¦™æ¸¯éº¦ç†æµ©å¾„ä¸Šå®Œæˆäº† 5 æ¬¡å¾’æ­¥ï¼Œè¶Šå‘ä¸Šç˜¾ã€‚æˆ‘æƒ³æˆ‘ä¹Ÿè¯¥å¸¦è€å¦¹ä½“éªŒä¸‹ï¼Œè§å±±è§æ°´è§è‡ªæˆ‘ã€‚ã€ Linux/Unix ç³»ç»Ÿç¼–ç¨‹æ‰‹å†Œï¼ˆä¸Šå†Œï¼‰ æœªè¯»å®Œä¹¦ç›®: ã€ŠEducated - A Memoirï¼ˆä¸­æ–‡åï¼šä½ å½“åƒé¸Ÿé£å¾€ä½ çš„å±±ï¼‰ã€‹ Linux/Unix ç³»ç»Ÿç¼–ç¨‹æ‰‹å†Œï¼ˆä¸‹å†Œï¼‰ ã€Šè¿™æ‰æ˜¯å¿ƒç†å­¦ - çœ‹ç©¿ä¼ªç§‘å­¦çš„æ‰¹åˆ¤æ€§æ€ç»´ ç¬¬ 11 ç‰ˆã€‹ å¹´åˆå®šçš„ç›®æ ‡æ˜¯æ¯æœˆä¸€æœ¬ä¹¦, ä½†å®é™…ä¸Šåªè¯»å®Œäº† 4 æœ¬, 25 å¹´å†æ¥å†å‰å§! ","date":"2025-01-07","objectID":"/posts/2024-summary/:2:4","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"æˆ‘çš„ 2024 - ç¨³ä¸­æ±‚è¿›ã€çƒ­çˆ±ç”Ÿæ´»","uri":"/posts/2024-summary/#4-é˜…è¯»"},{"categories":["life","tech"],"content":" 2025 å¹´å±•æœ›æˆ‘åœ¨å»å¹´å¹´ç»ˆæ€»ç»“çš„æ–‡æœ«å†™äº†, æˆ‘å¯¹è‡ªå·± 2024 å¹´çš„æœŸè®¸æ˜¯ã€Œå·¥ä½œä¸ä¸šä½™çˆ±å¥½ä¸Šç¨³ä¸­æ±‚è¿›ï¼Œç”Ÿæ´»ä¸Šé”»ç‚¼å¥½èº«ä½“ã€å¤šå…³å¿ƒå®¶äººã€ï¼Œæ„Ÿè§‰ç¡®å®åº”éªŒäº†ã€‚ç”±è¡·åœ°å–œæ¬¢ä¸æ„Ÿè°¢è¿™ä¸€å¹´æ¥ä¹è§‚ã€å¼€æœ—ã€ç§¯æçš„è‡ªå·±ï¼Œ ä¹Ÿæ„Ÿè°¢èº«è¾¹çš„äº²äººã€æœ‹å‹ã€åŒäº‹. äººçš„ä¸€ç”Ÿ, å°¤å…¶æ˜¯ ADHDer çš„ä¸€ç”Ÿè¦æ€ä¹ˆè¿‡æ‰èƒ½æ‹¥æœ‰é²œæ´»ã€å¿«ä¹ä¸”å……å®çš„äººç”Ÿ? æˆ‘ä»¬å¤©ç”Ÿåªæœ‰åœ¨è‡ªå·±å–œæ¬¢çš„äº‹æƒ…ä¸Šæ‰èƒ½æ‘†è„±æ‹–å»¶ç—‡å¹¶è·å¾—è¶³å¤Ÿçš„ä¸“æ³¨åŠ›, è¿™å°±æ³¨å®šäº†æˆ‘ä»¬æ— æ³•é€‚åº”ã€Œç¨³å®šã€æ¯ç‡¥ã€çš„å·¥ä½œä¸ç”Ÿæ´». 2025 å¹´, æˆ‘ä¸æ€¥ç€æ‰¾ä¸‹ä¸€ä»½å·¥ä½œ, è®¡åˆ’å…ˆ gap å‡ ä¸ªæœˆ, è°ƒæ•´ä¸‹è‡ªå·±çš„å¿ƒæ€, é‡æ–°å®¡è§†è‡ªå·±çš„èŒä¸šç”Ÿæ¶¯, ä»¥åŠæœªæ¥çš„è§„åˆ’. ä¸–ç•Œé‚£ä¹ˆå¤§, æˆ‘æƒ³å»çœ‹çœ‹, ä¹Ÿè®¸åœ¨æ—…è¡Œä¸­èƒ½æ‰¾åˆ°ä¸€äº›ç­”æ¡ˆ. å› æ­¤, æˆ‘ç»™è‡ªå·±å®šçš„ 2025 å¹´ç›®æ ‡æ˜¯: æ·±å…¥æµ…å‡º Linux, å¾’æ­¥ä¸­å›½ã€å¾’æ­¥ä¸–ç•Œ ä½œä¸ºä¸€åä»æœªå‡ºè¿‡å›½çš„ IT å†œæ°‘å·¥, æˆ‘å¯¹ä¸–ç•Œä¸Šå…¶ä»–å›½å®¶çš„è®¤è¯†ä»…ä»…åœç•™åœ¨ä¹¦æœ¬ä¸å„ç§ç½‘ç»œèµ„æ–™ä¸Š. ä¸ºäº†èƒ½å¤Ÿäº²çœ¼è§è¯†ä¸‹ä¸­å›½ä»¥å¤–çš„ä¸–ç•Œ, æˆ‘è®¡åˆ’åœ¨ 2025 å¹´å¼€å§‹èµ°å‡ºå›½é—¨, äº²èº«ä½“éªŒä¸åŒå›½å®¶çš„æ–‡åŒ–ä¸é£æ™¯. æˆ‘å·²ç»åŠå¥½äº†æ—¥æœ¬ç­¾è¯, æ­£åœ¨åŠéŸ©å›½ç­¾è¯, æ‰“ç®—å…ˆå»è¿™ä¸¤ä¸ªå›½å®¶å¾’æ­¥æ—…è¡Œ. å¦‚æœç­¾è¯é¡ºåˆ©çš„è¯, æˆ‘åœ¨æ—¥éŸ©ä¹‹åè¿˜æƒ³å»å°¼æ³Šå°”ã€é©¬æ¥è¥¿äºšã€æ¾³æ´²è·Ÿæ¬§æ´²æ—…è¡Œ. ä½†è¿™ä¸ªå¹¶æ²¡æœ‰é‚£ä¹ˆæ€¥, å¦‚æœ 2025 å¹´ gap çš„è¿™å‡ ä¸ªæœˆä¸å¤Ÿç”¨çš„è¯, æœªæ¥è¿˜æœ‰å¾ˆå¤šæœºä¼š. é™¤äº†å»å›½å¤–æ—…è¡Œæ»¡è¶³æˆ‘å¯¹ã€Œå¤–å›½ã€çš„å¥½å¥‡å¿ƒ, æˆ‘ä¹Ÿå¾ˆæƒ³åœ¨ 2025 å¹´å»äº²çœ¼è§è¯ 960 ä¸‡å¹³æ–¹å…¬é‡Œçš„ä¸­å›½å¤§åœ°, äº²çœ¼çœ‹çœ‹è¿™ç‰‡åœŸåœ°ä¸Šçš„é¬¼æ–§ç¥å·¥. ä¸è¿‡æš‚æ—¶è¿˜æ²¡æœ‰å¾ˆæ˜ç¡®çš„è®¡åˆ’, ä¸­å›½çš„é£æ™¯å¤ªå¤šå¤ªç¾, ä¹Ÿè®¸æˆ‘ä¼šå…ˆå»é’æµ·, åˆæˆ–è€…æ˜¯å¹¿è¥¿? è·¯è¿˜å¾ˆé•¿, 2025 å¹´, è®©æˆ‘ç”¨åŒè„šå»ä¸ˆé‡è¿™ä¸ªä¸–ç•Œï½ Carpe Diem. Seize The Day, Boys. Make Your Lives Extraordinary. â€“ ã€Šæ­»äº¡è¯—ç¤¾ã€‹ ","date":"2025-01-07","objectID":"/posts/2024-summary/:3:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"æˆ‘çš„ 2024 - ç¨³ä¸­æ±‚è¿›ã€çƒ­çˆ±ç”Ÿæ´»","uri":"/posts/2024-summary/#2025-å¹´å±•æœ›"},{"categories":["tech"],"content":" å‰è¨€å¾ˆæ—©å°±æœ‰äº†è§£åˆ°ä»Šå¹´çš„ KubeCon China ä¼šåœ¨é¦™æ¸¯ä¸¾åŠï¼Œè™½ç„¶æœ‰äº›å…´è¶£ï¼Œä½†æˆ‘æœ€åˆæ˜¯æœ‰è¢« KubeCon é«˜æ˜‚çš„é—¨ç¥¨ä»·æ ¼åŠé€€äº†çš„ã€‚ æœ‰æ—¶å€™ä¸å¾—ä¸ç›¸ä¿¡è¿æ°”çš„é­”åŠ›ï¼Œæœºç¼˜å·§åˆä¹‹ä¸‹ï¼Œæˆ‘ä»æœ‹å‹ @Kev å¤„å¾—çŸ¥äº† KubeCon çš„ã€Œæœ€ç»ˆç”¨æˆ·é—¨ç¥¨è®¡åˆ’ã€å¹¶å€Ÿæ­¤ 0 å…ƒè´­äº†é—¨ç¥¨ï¼Œåˆé‚€ä¸Šäº† 0xFFFF ç¤¾åŒº çš„@Chever-John @0xdeadbeef @èŒ—æ´› ä¸‰ä½æœ‹å‹ä¸€èµ·å‚åŠ ï¼Œåœ¨é¦™æ¸¯ç§Ÿäº†ä¸ª airbnb ä½å®¿ï¼ŒæœŸé—´ä¹Ÿé€›äº†é¦™æ¸¯åŸå¸‚ä¸­çš„ä¸å°‘åœ°æ–¹ï¼Œæ”¶è·é¢‡ä¸°ã€‚ å…¶å®æœ¬æ¥ä¹Ÿå°è¯•è¿‡é‚€è¯·å…¶ä»–è®¤è¯†çš„æœ‹å‹åŒäº‹ï¼Œä½†éƒ½å› ä¸ºç§ç§åŸå› æ— æ³•å‚åŠ ï¼Œç•¥æ„Ÿé—æ†¾ã€‚ ","date":"2024-08-27","objectID":"/posts/kubecon-china-2024/:1:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Cloud-Native","Kubernetes","MultiCloud","å¤šäº‘","æœåŠ¡ç½‘æ ¼","Istio"],"title":"KubeCon China 2024 ä¹‹æ—…","uri":"/posts/kubecon-china-2024/#å‰è¨€"},{"categories":["tech"],"content":" TL;DRæœ¬æ–‡å¤šå›¾ï¼Œä¹ŸæŒºå¤šæŠ€æœ¯æ— å…³çš„å†…å®¹ï¼Œä¸ºäº†æ–¹ä¾¿æƒ³äº†è§£æŠ€æœ¯çš„æœ‹å‹ï¼Œæˆ‘å…ˆåšä¸ªå¤§è‡´çš„æ€»ç»“ã€‚ ä» KubeCon å›æ¥åæˆ‘åˆå¬äº†äº› CNCF å…¶ä»–çš„ä¼šè®®è§†é¢‘ï¼Œå…¶ä¸­æ¯”è¾ƒæœ‰å°è±¡çš„æ˜¯è¿™å‡ ä¸ªï¼š Keynote: Cloud Native in its Next Decade - KubeCon Europe 2024: èŠäº† CloudNative çš„æœªæ¥ï¼Œç»“è®ºè·Ÿè¿™æ¬¡åœ¨ KubeCon China ç°åœºå¬åˆ°çš„å†…å®¹ç±»ä¼¼ã€‚ Another Choice for Istio Multi-Cluster \u0026 Multi-Network Deployment Model - KubeCon Europe 2024: æåˆ°äº† Istio å¤šé›†ç¾¤æ–¹æ¡ˆçš„ç—›ç‚¹ï¼Œä»‹ç»äº†ä¸­å›½ç§»åŠ¨çš„è§£å†³æ–¹æ¡ˆã€‚æˆ‘ä¸€ç›´æœ‰æƒ³å°è¯•å¤šé›†ç¾¤æ–¹æ¡ˆï¼Œä½†ä¸€ç›´æ‹…å¿ƒ hold ä¸ä½è€Œä¸æ•¢ä¸‹æ‰‹ï¼Œè¿™ä¸ªè§†é¢‘ç»™äº†æˆ‘ä¸€äº›å¯å‘ã€‚ DRA in KubeVirt: Overcoming Challenges \u0026 Implementing Changes - KubeCon Europe 2024: DRA ä¹Ÿæ˜¯ K8s ä¸­çš„æ–° APIï¼Œè¿™é‡Œä»‹ç»å¦‚ä½•åœ¨ kubevirt ä¸­ä½¿ç”¨ DRA è§£å†³ä¸€äº›é—®é¢˜ã€‚ä»è¿™é‡Œèƒ½æ„Ÿè§‰åˆ° K8s è¿™å‡ å¹´è¿˜æ˜¯å¼„äº†ä¸å°‘æ–°ä¸œè¥¿çš„ã€‚ ç»“åˆ KubeCon China ä¸‰å¤©çš„ç»å†ï¼Œä»¥åŠä¸Šé¢è¿™äº›è§†é¢‘çš„å†…å®¹ï¼Œæˆ‘å¤§æ¦‚çš„æ„Ÿè§‰æ˜¯ï¼š ï¼ˆå‡ ä¹ï¼‰æ‰€æœ‰èŠç½‘ç»œçš„äººéƒ½åœ¨èŠ eBPF, Envoy, Gateway API. Istio çš„ Ambient Mode å¸å¼•äº†å¾ˆå¤šæ›¾ç»å› ä¸º sidecar æ€§èƒ½é—®é¢˜è€Œæ”¾å¼ƒä½¿ç”¨æœåŠ¡ç½‘æ ¼çš„å…¬å¸ã€‚ Karmada å¤šé›†ç¾¤ç®¡ç†æ–¹æ¡ˆåœ¨è®¸å¤šå…¬å¸å¾—åˆ°äº†å®é™…åº”ç”¨ï¼ŒæŒºå¤šè®²è¿™ä¸ªçš„ã€‚ AI ä¸ WASM æ–¹é¢çš„æ¼”è®²ä¹Ÿæœ‰ä¸å°‘ï¼Œä½†æ„Ÿè§‰æœ‰äº›æ— è¶£ï¼Œå¯èƒ½æ˜¯æˆ‘å¯¹è¿™æ–¹é¢ä¸å¤ªæ„Ÿå…´è¶£ã€‚ è”šæ¥æ±½è½¦ã€ä¸­å›½ç§»åŠ¨ç­‰å…¬å¸æ­£åœ¨å°è¯•å°† K8s åº”ç”¨åœ¨è¾¹ç¼˜è®¡ç®—åœºæ™¯ï¼ˆæ™ºèƒ½æ±½è½¦ã€é€šä¿¡åŸºç«™ï¼‰ï¼Œä½†è¿™äº›ç¦»æ™®é€šäº’è”ç½‘å…¬å¸æœ‰ç‚¹è¿œã€‚ äº‘åŸç”Ÿçš„æœªæ¥åå¹´ä¼šå˜æˆä»€ä¹ˆæ ·ï¼Ÿ Kubernetes, Service Mesh ç­‰è¿‡å»åå¹´çš„æ–°å…´æŠ€æœ¯ï¼Œç°åœ¨å·²ç»æˆä¸ºäº†ã€ŒBoring but useful infrastructrueã€ï¼Œå®ƒä»¬å°†æ˜¯å…¶ä»–äº‘åŸç”ŸæŠ€æœ¯æ½®æµçš„åŸºçŸ³ï¼Œè¢«å¹¿æ³›åº”ç”¨ï¼Œä½†è‡ªèº«ä¸ä¼šå†æœ‰å¤ªå¤šçš„å˜åŒ–ã€‚ AI, eBPF, WASM, Rust ç­‰æŠ€æœ¯ä¹Ÿå°†åœ¨æœªæ¥åå¹´èµ°å‘æˆç†Ÿï¼Œå–ä»£ Kubernetes å½“å‰çš„åœ°ä½ã€‚ KubeCon China 2024 çš„ä¼šè®®è§†é¢‘å°†ä¼šé™†ç»­è¢«æ·»åŠ åˆ°å¦‚ä¸‹è¿™ä¸ª Youtube Playlist ä¸­ï¼Œæœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥ä¸€è§‚ï¼š KubeCon + CloudNativeCon + Open Source Summit + AI_dev China 2024 - Youtube è§†é¢‘ç›¸å…³çš„ PPT å¯ä»¥åœ¨è¿™é‡Œä¸‹è½½ï¼š KubeCon China 2024 - Schedule ","date":"2024-08-27","objectID":"/posts/kubecon-china-2024/:2:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Cloud-Native","Kubernetes","MultiCloud","å¤šäº‘","æœåŠ¡ç½‘æ ¼","Istio"],"title":"KubeCon China 2024 ä¹‹æ—…","uri":"/posts/kubecon-china-2024/#tldr"},{"categories":["tech"],"content":" æŠ€æœ¯è¿™æ¬¡æˆ‘ä¸»è¦å…³æ³¨çš„æ˜¯ Istioã€Gateway API ç›¸å…³çš„è®®é¢˜ï¼Œæœ€è¿‘åœ¨ç ”ç©¶ Istio çš„ Ambient Modeï¼Œå› æ­¤å¸Œæœ›èƒ½å¤Ÿä»ä¼šè®®ä¸­äº†è§£åˆ°æ›´å¤šçš„å®ç°ç»†èŠ‚ä¸å…¶ä¸­çš„æƒè¡¡ã€‚ ä¸‰å¤©ä¸‹æ¥å¬åˆ°çš„å†…å®¹ä¹Ÿå¾ˆå¥½çš„æ»¡è¶³äº†æˆ‘çš„æœŸå¾…ï¼ŒIstio / Envoy Gateway / Ingress Controller çš„å‡ ä½æ ¸å¿ƒè´¡çŒ®è€…åˆ†äº«äº†å¾ˆå¤šè¿™äº›é¡¹ç›®çš„æœ€æ–°è¿›å±•ï¼Œå®ç°ç»†èŠ‚ï¼Œä»¥åŠæœªæ¥çš„å‘å±•æ–¹å‘ã€‚ Ambient Mode åœ¨æœ€è¿‘ beta äº†ï¼Œæ˜¯æˆ‘å…³æ³¨çš„é‡ç‚¹ï¼Œæ€»ç»“ä¸‹ç›®å‰äº†è§£åˆ°çš„å‡ ä¸ªå…³é”®ç‚¹ï¼š istio/ztunnel: ä¸€ä¸ª userspace çš„ l4 proxyï¼Œä»…æ”¯æŒå¤„ç† L4 æµé‡ã€‚ ztunnel ä¼šåˆ†åˆ«ä¸ä¸Šæ¸¸å’Œä¸‹æ¸¸å»ºç«‹è¿æ¥ï¼Œå¯¼è‡´ A \u003c=\u003e B ä¹‹é—´çš„ä¸€ä¸ªè¿æ¥ä¼šå˜æˆ A \u003c=\u003e ztunnel \u003c=\u003e ztunnel \u003c=\u003e B ä¸‰ä¸ªè¿æ¥ï¼Œè¿™ä¹Ÿä¼šå¸¦æ¥æ€§èƒ½å¼€é”€ã€‚ å› ä¸ºæ‰€æœ‰æµé‡éƒ½ç»ç”± ztunnel è½¬å‘ï¼Œæ›´æ–° ztunnel ä¼šå¯¼è‡´çŸ­æš‚çš„æµé‡ä¸­æ–­ã€‚æ„Ÿè§‰æ¯”è¾ƒå¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯é‡‡ç”¨ recreate çš„æ›´æ–°ç­–ç•¥ + æ»šåŠ¨æ›´æ–°èŠ‚ç‚¹ç»„ä¸‹çš„æ‰€æœ‰èŠ‚ç‚¹æ¥æ›´æ–° ztunnel. ztunnel ä½¿ç”¨çš„ HBONE åè®®å¼ºåˆ¶å¯ç”¨ mTLSï¼Œæ— æ³•å…³é—­ï¼Œå¯¹äºä¸è¦æ±‚å®‰å…¨æ€§çš„åœºæ™¯ä¼šå¸¦æ¥é¢å¤–çš„æ€§èƒ½å¼€é”€ã€‚ istio/proxy: åŸºäº envoy çš„ l7 proxyï¼Œåœ¨ ambient mode ä¸‹å®ƒè¢«å•ç‹¬éƒ¨ç½²ä¸ºä¸€ä¸ª waypoint, ç”¨äºå¤„ç† L7 æµé‡ã€‚ waypoint æ¶æ„ä¸‹ proxy ä¸ä¸Šä¸‹æ¸¸ Pod å¾ˆå¯èƒ½åœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œè¿™ä¼šå¯¼è‡´æ¯” sidecar æ¨¡å¼å¤šä¸€æ¬¡ç½‘ç»œè·³è½¬ï¼Œå¯èƒ½å¸¦æ¥æ€§èƒ½æŸè€—ï¼Œä»¥åŠè·¨ Zone æµé‡ä¸Šæ¶¨ã€‚ waypoint ä¸ sidecar éƒ½æ˜¯ envoyï¼Œå®ƒæ˜¯é€šè¿‡å‡å°‘ envoy å®¹å™¨çš„æ•°é‡æ¥è¾¾åˆ°å‡å°‘èµ„æºæ¶ˆè€—çš„ç›®çš„ã€‚ ä»¥åŠä¸€äº›å…¶ä»–æ–¹æ¡ˆï¼š kmesh: æ¶æ„ç±»ä¼¼ Ambient Modeï¼Œç‰¹ç‚¹æ˜¯å®Œå…¨ä½¿ç”¨ eBPF æ¥å®ç° L4 proxyï¼Œå¥½å¤„æ˜¯ eBPF ç›´æ¥åœ¨å†…æ ¸ç©ºé—´ä¿®æ”¹ç½‘ç»œåŒ…ï¼Œä¸éœ€è¦ä¸ä¸Šä¸‹æ¸¸åˆ†åˆ«å»ºç«‹è¿æ¥ã€‚å› æ­¤æ€§èƒ½æ›´å¥½ï¼Œè€Œä¸” eBPF ç¨‹åºæ›´æ–°ä¸ä¼šä¸­æ–­æµé‡ã€‚ cilium service mesh: ç‰¹ç‚¹æ˜¯ per-node proxyï¼Œl7 çš„ envoy proxy è¿è¡Œåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šï¼Œè€Œä¸æ˜¯åƒ waypoint ä¸€æ ·å•ç‹¬é€šè¿‡ deployment éƒ¨ç½²ã€‚ä½†ä¹Ÿå­˜åœ¨ä¸€äº›é—®é¢˜ï¼š per-node proxy æ— æ³•çµæ´»åœ°è°ƒæ•´èµ„æºå ç”¨ï¼Œå¯èƒ½ä¼šå¯¼è‡´èµ„æºæµªè´¹ã€‚ åŒä¸€èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰æµé‡éƒ½ç”±åŒä¸€ envoy proxy å¤„ç†ï¼Œæ— æ³•å®ç° waypoint é‚£æ ·çš„ namespace çº§åˆ«çš„æµé‡éš”ç¦»ã€‚ ä¸ cilium cni å¼ºç»‘å®šï¼Œå¿…é¡»ä½¿ç”¨ cilium cni æ‰èƒ½ä½¿ç”¨ cilium service mesh. æ®è¯´ä½¿ç”¨èµ·æ¥è¾ƒä¸ºå¤æ‚ï¼Ÿ æ€»ä½“è€Œè¨€ï¼ŒKubeCon æ˜¯ä¸€æ¬¡äº†è§£è¡Œä¸šå‰æ²¿æŠ€æœ¯åŠ¨æ€ã€è·Ÿé¡¹ç›®å¼€å‘è€…åŠå…¶ä»–è¡Œä¸šå†…çš„æŠ€æœ¯äººé¢å¯¹é¢è®¤è¯†äº¤æµçš„å¥½æœºä¼šï¼Œå¯ä»¥å¸®åŠ©è‡ªå·±æå‡æŠ€æœ¯è§†é‡ï¼Œç»´æŒæŠ€æœ¯çƒ­æƒ…ä¸åŠ¨åŠ›ï¼Œä¸è‡³äºå±€é™åœ¨å…¬å¸ä¸šåŠ¡ä¸­é—­é—¨é€ è½¦ã€‚ ","date":"2024-08-27","objectID":"/posts/kubecon-china-2024/:3:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Cloud-Native","Kubernetes","MultiCloud","å¤šäº‘","æœåŠ¡ç½‘æ ¼","Istio"],"title":"KubeCon China 2024 ä¹‹æ—…","uri":"/posts/kubecon-china-2024/#æŠ€æœ¯"},{"categories":["tech"],"content":" è¡Œç¨‹","date":"2024-08-27","objectID":"/posts/kubecon-china-2024/:4:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Cloud-Native","Kubernetes","MultiCloud","å¤šäº‘","æœåŠ¡ç½‘æ ¼","Istio"],"title":"KubeCon China 2024 ä¹‹æ—…","uri":"/posts/kubecon-china-2024/#è¡Œç¨‹"},{"categories":["tech"],"content":" ä½å®¿å› ä¸ºè¦åœ¨é¦™æ¸¯å‘†ä¸‰å¤©ï¼Œè¡£é£Ÿä½è¡Œæ˜¯å¿…é¡»è¦è€ƒè™‘çš„äº‹æƒ…ã€‚è¿™æ–¹é¢æˆ‘æ‹‰ä¸Šçš„å‡ ä½æœ‹å‹éƒ½æ¯”è¾ƒæœ‰æ—…è¡Œä½å®¿çš„ç»éªŒï¼Œæˆ‘ä»¬æœ€ååœ¨é¦™æ¸¯æ‰¾äº†ä¸ªç¦»ä¼šåœºä¸è¿œçš„ airbnb ä½å®¿ï¼Œæœ€ç»ˆçš„ä½“éªŒä¹Ÿæ˜¯ç›¸å½“ä¸é”™ã€‚æˆ¿é—´å¹²å‡€æ•´æ´æœ‰æ ¼è°ƒï¼Œè™½ç„¶æˆ‘è§‰å¾—ç¨å¾®æœ‰ç‚¹å°äº†ï¼Œä½†æœ‹å‹è¯´è¿™ä¸ªç©ºé—´åœ¨é¦™æ¸¯éƒ½æ˜¯ä¸€å®¶ä¸‰å››å£ä½çš„æ ‡å‡†ï¼Œå·²ç»åŠæ‰“åŒä»·ä½çš„é…’åº—äº†ã€‚ ","date":"2024-08-27","objectID":"/posts/kubecon-china-2024/:4:1","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Cloud-Native","Kubernetes","MultiCloud","å¤šäº‘","æœåŠ¡ç½‘æ ¼","Istio"],"title":"KubeCon China 2024 ä¹‹æ—…","uri":"/posts/kubecon-china-2024/#ä½å®¿"},{"categories":["tech"],"content":" Day 1è™½ç„¶ææ—©å®šäº†ä½å®¿ï¼Œåšäº†ç‚¹åŠŸè¯¾ï¼Œä½†ç¬¬ä¸€å¤©å°±å‡ºäº†é—®é¢˜â€”â€”æ·±åœ³è¿™è¾¹ä¸€ç›´ä¸‹é›¨å¯¼è‡´ @Chever-John çš„é£æœºç›´æ¥è¢«å–æ¶ˆï¼Œæ”¹è®¢äº†å¦ä¸€è¶Ÿèˆªç­ä¹Ÿæ™šç‚¹ã€‚è™½ç„¶æ­£ç‚¹åˆ°è¾¾äº†ä¼šåœºï¼Œä½†ä»–ä¸€æ™šä¸Šå°±ç¡äº†ä¿©å°æ—¶ï¼Œåœ¨æ·±åœ³å®šçš„å‰ä¸€æ™šçš„é…’åº—ä¹Ÿæ²¡ä½æˆï¼Œç¬¬ä¸€å¤©çœ‹ä»–æ•´ä¸ªäººéƒ½å¬å¾—è¿·è¿·ç³Šç³Šçš„ã€‚ä¸è¿‡æ²¡äº‹ï¼Œè‡³å°‘æˆ‘å¬äº†ä¸ªçˆ½ è¯´å›æ­£é¢˜ï¼Œåˆ°äº†ä¼šåœºé¢†å®Œèƒ¸ç‰Œï¼Œæˆ‘ä»¬å°±å¼€å§‹äº†ä¸ºæœŸä¸‰å¤©çš„ KubeCon China ä¹‹æ—…ã€‚ å…·ä½“çš„æŠ€æœ¯å†…å®¹å·²ç»åœ¨å‰æ–‡æ€»ç»“è¿‡äº†ï¼Œè¿™é‡Œä¸»è¦å°±è´´äº›ç…§ç‰‡å§ã€‚ ä¸»ä¼šåœºè¿‡å…ï¼Œæµ·æ™¯ä¸é”™çš„ å»å„ä¼šè®®å®¤çš„è¿‡é“ï¼Œé…’åº—çš„æœåŠ¡å¾ˆåˆ°ä½ åˆä¼‘èŒ¶æ­‡ï¼Œåƒé¥±å–è¶³ å†°é•‡é¥®æ–™ä¹Ÿå¯ä»¥éšä¾¿å–ï¼Œå¥½å“‡ å‡ ä½å¤§ä½¬èŠ Istio ä¸ Gateway API çš„æœªæ¥ ç„¶åæ™šä¸Š@èŒ—æ´›å¸¦ç€æˆ‘ä»¬é€›äº†é¦™æ¸¯çš„è¯šå“ä¹¦åº—ï¼Œä¹¦åº—å¥½å‡ å±‚ï¼Œä½†æ„Ÿå…´è¶£çš„ä¹¦ä¸å¤šã€‚åé¢åˆé€›äº†å¥½å¤šç”µå­å•†åŸã€äºŒæ¬¡å…ƒå‘¨è¾¹åº—ï¼Œæˆ‘ç®—æ˜¯å¼€äº†çœ¼ç•Œã€‚ ã€Šæˆ‘æ¨çš„å­©å­ã€‹ å¦ä¸€æœ¬ å¥½å¤šäºŒæ¬¡å…ƒé’¢ç´è°±ï¼Œæœ‰ã€Šå››æœˆæ˜¯æˆ‘çš„è°è¨€ã€‹ ä¸çŸ¥é“é€›åˆ°äº†å“ªï¼Œåˆ°å¤„éƒ½æ˜¯äºŒæ¬¡å…ƒå‘¨è¾¹ è½»å°è¯´ä¹¦åº— 1 è½»å°è¯´ä¹¦åº— 2 è½»å°è¯´ä¹¦åº— 3 ç¬¬ä¸€å¤©å°±å·®ä¸å¤šæ˜¯è¿™æ ·ï¼Œå¬äº†ç‚¹æŠ€æœ¯ï¼Œæ™šä¸Šé€›äº†é€›é¦™æ¸¯ï¼Œå›å»ä¼‘æ¯ã€‚ ","date":"2024-08-27","objectID":"/posts/kubecon-china-2024/:4:2","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Cloud-Native","Kubernetes","MultiCloud","å¤šäº‘","æœåŠ¡ç½‘æ ¼","Istio"],"title":"KubeCon China 2024 ä¹‹æ—…","uri":"/posts/kubecon-china-2024/#day-1"},{"categories":["tech"],"content":" Day 2 å¥½å¤šçš„ CNCF è´´çº¸ï¼Œå¯ä»¥éšä¾¿æ‹¿ï¼Œæˆ‘ç»™åŒäº‹ä¹Ÿå¸¦äº†ä¸€äº› æˆ‘æ”¶è·çš„ CNCF è´´çº¸ é¦–å…ˆæ˜¯å¬äº†åä¸ºçš„æ¼”è®²ï¼Œä»‹ç»äº† Kmesh çš„æ–¹æ¡ˆåˆ›æ–°ï¼ŒæŠ€æœ¯ç»†èŠ‚è®²å¾—å¾ˆèµã€‚æƒ³çœ‹ PPT ä¸è§†é¢‘è¯·ç§»æ­¥ç”¨å†…æ ¸åŸç”Ÿæ— è¾¹è½¦æ¶æ„å½»åº•æ”¹å˜æœåŠ¡ç½‘æ ¼ - Xin Liu, Huawei Technologies Co., Ltd. åä¸ºä»‹ç» Kmesh ä»‹ç» Kmesh å¦‚ä½•å€ŸåŠ© eBPF å®ç°çƒ­æ›´æ–°ä¸ä¸­æ–­è¿æ¥ è¿˜å¬äº†æ™‹æ¶›è€å¸ˆçš„åå¹´äº‘åŸç”Ÿä¹‹æ—…ï¼šå®¹å™¨æŠ€æœ¯å’ŒKubernetesç”Ÿæ€ç³»ç»Ÿçš„æ¼”å˜ - Jintao Zhang, Kong Inc. æ™‹æ¶›ä¸æ„§æ˜¯è¡Œä¸šè€å°†ï¼Œè¿™ä¹ˆæ—©å°±å¼€å§‹ç© Docker äº† ç„¶åæ™šä¸Šæˆ‘ä»¬éšä¾¿èµ°äº†èµ°é€›äº†é€›ï¼Œçœ‹äº†çœ‹é¦™æ¸¯æµ·è¾¹å¤œæ™¯ã€‚ é¦™æ¸¯å¤œæ™¯ï¼Œç›¸å½“ç¹åå“ª ç¯çº¢é…’ç»¿ï¼Œæ¸¸äººå¦‚ç»‡ è·¯ä¸Šç¢°åˆ°äº†ã€Šå•†åŠ¡å°ä¹¦é¦†ã€‹ ","date":"2024-08-27","objectID":"/posts/kubecon-china-2024/:4:3","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Cloud-Native","Kubernetes","MultiCloud","å¤šäº‘","æœåŠ¡ç½‘æ ¼","Istio"],"title":"KubeCon China 2024 ä¹‹æ—…","uri":"/posts/kubecon-china-2024/#day-2"},{"categories":["tech"],"content":" Day 3ç¬¬ä¸‰å¤©æ—©ä¸Šæ˜¯æˆ‘è¿™æ¬¡æœ€æœŸå¾…çš„ï¼ŒLinus çš„è®¿è°ˆï¼Œè§åˆ°äº†æœ¬äººï¼Œè¿™æ¬¡è¡Œç¨‹ä¹Ÿåœ†æ»¡äº†ã€‚ Linus ç¬¬ä¸‰å¤©æ²¡ä»€ä¹ˆæˆ‘ç‰¹åˆ«æ„Ÿå…´è¶£çš„è¯é¢˜ï¼Œå¬å®Œ Linus çš„è®¿è°ˆåéšä¾¿é€›äº†é€›ï¼Œè·Ÿå‡ ä½ æœ‹å‹åˆäº†ä¸ªå½±ï¼Œå°±æ­åœ°é“å›å®¶äº†ã€‚ å’±çš„åˆå½± å’±çš„ PC ä¸é²¨é²¨åˆå½± å¦å¤–æœ‹å‹å¬äº†ä¸ª TiDB çš„æ¼”è®²ï¼Œçœ‹ PPT æ˜¯æœ‰ç‚¹æ„æ€çš„å“ˆå“ˆã€‚ TiDB ä»¥åŠåœ¨é¡¹ç›®å±•å…ä¸‰å¤©é€›ä¸‹æ¥ï¼Œæˆ‘å¸†å¸ƒè¢‹é¢†äº†å››ä¸ªï¼ŒTæ¤é¢†äº†ä¸‰ä»¶ï¼Œè¿˜æœ‰åˆ«çš„å°ç¤¼å“ä¸€å †ï¼Œåƒçš„å–çš„éƒ½ä¸ç”¨è¯´äº†ï¼Œç®¡å¤Ÿã€‚å¦å¤–çœ‹ç½‘ä¸Šä¸å°‘ä¿¡æ¯è¯´é¦™æ¸¯çš„æœåŠ¡ä¸šæ€åº¦å¾ˆå·®ï¼Œä½†è¿™å®¶é…’åº—å¯èƒ½æ˜Ÿçº§æ¯”è¾ƒé«˜ï¼Œä½“éªŒè¿˜æ˜¯ç›¸å½“åˆ°ä½çš„ã€‚ æ€»ä¹‹ï¼Œä½“éªŒç›¸å½“ä¸é”™çš„ï¼Œæœ‰æœºä¼šçš„è¯æ˜å¹´è¿˜æ¥ï¼Love you, KubeCon China \u0026 Hong Kongï¼ ","date":"2024-08-27","objectID":"/posts/kubecon-china-2024/:4:4","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Cloud-Native","Kubernetes","MultiCloud","å¤šäº‘","æœåŠ¡ç½‘æ ¼","Istio"],"title":"KubeCon China 2024 ä¹‹æ—…","uri":"/posts/kubecon-china-2024/#day-3"},{"categories":["tech"],"content":" å‰è¨€Kubernetes å…·æœ‰éå¸¸ä¸°å¯Œçš„åŠ¨æ€ä¼¸ç¼©èƒ½åŠ›ï¼Œè¿™ä½“ç°åœ¨å¤šä¸ªå±‚é¢ï¼š Workloads çš„ä¼¸ç¼©ï¼šé€šè¿‡ Horizontal Pod Autoscalerï¼ˆHPAï¼‰å’Œ Vertical Pod Autoscalerï¼ˆVPAï¼‰ç­‰èµ„æºï¼Œå¯ä»¥æ ¹æ®èµ„æºä½¿ç”¨æƒ…å†µè‡ªåŠ¨è°ƒæ•´ Pod çš„æ•°é‡å’Œèµ„æºé…ç½®ã€‚ ç›¸å…³é¡¹ç›®ï¼š metrics-server: é‡‡é›†æŒ‡æ ‡æ•°æ®ä¾› HPA ä½¿ç”¨ KEDA: ç”¨äºæ”¯æŒæ›´å¤šçš„æŒ‡æ ‡æ•°æ®æºä¸è§¦å‘æ–¹å¼ kubernetes/autoscaler: æä¾› VPA åŠŸèƒ½ Nodes çš„ä¼¸ç¼©ï¼šæ ¹æ®é›†ç¾¤çš„è´Ÿè½½æƒ…å†µï¼Œå¯ä»¥è‡ªåŠ¨å¢åŠ æˆ–å‡å°‘ Nodes çš„æ•°é‡ï¼Œä»¥é€‚åº”è´Ÿè½½çš„å˜åŒ–ã€‚ ç›¸å…³é¡¹ç›®ï¼š kubernetes/autoscaler: ç›®å‰æœ€æµè¡Œçš„ Node ä¼¸ç¼©æ–¹æ¡ˆï¼Œæ”¯æŒç»å¤§å¤šæ•°äº‘å‚å•†ã€‚ karpenter: AWS æç»™ CNCF çš„ä¸€ä¸ªæ–°å…´ Node ä¼¸ç¼©æ–¹æ¡ˆï¼Œç›®å‰ä»…æ”¯æŒ AWS/Azureï¼Œä½†åŸºäºå…¶æ ¸å¿ƒåº“å¯ä»¥å¾ˆå®¹æ˜“åœ°æ‰©å±•æ”¯æŒå…¶ä»–äº‘å‚å•†ã€‚ æœ¬æ–‡ä¸»è¦ä»‹ç»æ–°å…´ Node ä¼¸ç¼©ä¸ç®¡ç†æ–¹æ¡ˆ Karpenter çš„ä¼˜åŠ¿ã€åº”ç”¨åœºæ™¯åŠä½¿ç”¨æ–¹æ³•ã€‚ ","date":"2024-07-10","objectID":"/posts/kubernetes-cluster-autoscaling-1-karpenter/:1:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Cloud-Native","Kubernetes","MultiCloud","å¤šäº‘","è‡ªåŠ¨æ‰©ç¼©å®¹","Karpenter","Cluster-Autoscaler"],"title":"Kubernetes é›†ç¾¤ä¼¸ç¼©ç»„ä»¶ - Karpenter","uri":"/posts/kubernetes-cluster-autoscaling-1-karpenter/#å‰è¨€"},{"categories":["tech"],"content":" Karpenter ç®€ä»‹Karpenter é¡¹ç›®ç”± AWS äº 2020 å¹´åˆ›å»ºï¼Œå…¶ç›®æ ‡æ˜¯è§£å†³ AWS ç”¨æˆ·åœ¨ EKS ä¸Šä½¿ç”¨ Cluster Autoscaler åšé›†ç¾¤ä¼¸ç¼©æ—¶é‡åˆ°çš„ä¸€äº›é—®é¢˜ã€‚åœ¨ç»å†äº†å‡ å¹´å‘å±•åï¼ŒKarpenter äº 2023 å¹´åº•è¢«æçŒ®ç»™ CNCFï¼ˆkubernetes/org#4258ï¼‰ï¼Œæˆä¸ºç›®å‰ ï¼ˆ2024/07/10ï¼‰å”¯äºŒçš„å®˜æ–¹ Node ä¼¸ç¼©æ–¹æ¡ˆä¹‹ä¸€ã€‚ æˆ‘äº 2022 å¹´ 4 æœˆåœ¨åš Spark ç¦»çº¿è®¡ç®—å¹³å°æ”¹é€ çš„æ—¶å€™å°è¯•äº† Karpenter v0.8.2ï¼Œå‘ç°å®ƒçš„ç¡®æ¯” Cluster Autoscaler æ›´å¥½ç”¨ï¼Œå¹¶åœ¨éšåçš„ä¸¤å¹´ä¸­é€æ¸å°†å®ƒæ¨å¹¿åˆ°äº†æ›´å¤šçš„é¡¹ç›®ä¸­ã€‚ç›®å‰æˆ‘å¸åœ¨ AWS äº‘å¹³å°ä¸Šæ‰€æœ‰çš„ç¦»çº¿è®¡ç®—ä»»åŠ¡ä¸å¤§éƒ¨åˆ†åœ¨çº¿æœåŠ¡éƒ½æ˜¯ä½¿ç”¨ Karpenter è¿›è¡Œçš„é›†ç¾¤ä¼¸ç¼©ã€‚å¦å¤–æˆ‘è¿˜ä¸º karpenter é€‚é…äº† K3s ä¸ DigitalOcean äº‘å¹³å°ç”¨äºä¸€äº›ç‰¹æ®Šä¸šåŠ¡ï¼Œä½“éªŒè‰¯å¥½ã€‚ Karpenter å®˜æ–¹ç›®å‰åªæœ‰ AWS ä¸ Azure ä¸¤ä¸ªäº‘å¹³å°çš„å®ç°ï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰åœ¨è¿™ä¸¤ä¸ªå¹³å°ä¸Š karpenter æ‰èƒ½å¼€ç®±å³ç”¨ã€‚ä½†è€ƒè™‘åˆ°å®ƒåœ¨æ˜“ç”¨æ€§ä¸æˆæœ¬æ–¹é¢çš„ä¼˜åŠ¿ä»¥åŠåœ¨å¯æ‹“å±•æ€§ã€æ ‡å‡†åŒ–æ–¹é¢çš„åŠªåŠ›ï¼Œæˆ‘å¯¹å®ƒçš„æœªæ¥å‘å±•æŒä¹è§‚æ€åº¦ã€‚ ","date":"2024-07-10","objectID":"/posts/kubernetes-cluster-autoscaling-1-karpenter/:2:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Cloud-Native","Kubernetes","MultiCloud","å¤šäº‘","è‡ªåŠ¨æ‰©ç¼©å®¹","Karpenter","Cluster-Autoscaler"],"title":"Kubernetes é›†ç¾¤ä¼¸ç¼©ç»„ä»¶ - Karpenter","uri":"/posts/kubernetes-cluster-autoscaling-1-karpenter/#karpenter-ç®€ä»‹"},{"categories":["tech"],"content":" Karpenter ä¸ Cluster Autoscaler çš„å¯¹æ¯”Cluster Autoscaler æ˜¯ç›®å‰ç¤¾åŒºæœ€æµè¡Œçš„ Node ä¼¸ç¼©æ–¹æ¡ˆï¼ŒåŸºæœ¬æ‰€æœ‰äº‘å‚å•†çš„ Kubernetes æœåŠ¡é»˜è®¤éƒ½ä¼šé›†æˆå®ƒã€‚ Karpenter ä¸ Cluster Autoscaler çš„è®¾è®¡ç†å¿µä¸å®ç°æ–¹å¼æœ‰å¾ˆå¤§çš„ä¸åŒã€‚ Cluster Autoscaler æ˜¯ Kubernetes å¹³å°ä¸Šæ—©æœŸçš„é›†ç¾¤ä¼¸ç¼©æ–¹æ¡ˆï¼Œä¹Ÿæ˜¯ç›®å‰æœ€æµè¡Œçš„æ–¹æ¡ˆã€‚ä½†å®ƒåšçš„äº‹æƒ…æ¯”è¾ƒæœ‰é™ï¼Œæœ€å¤§çš„é—®é¢˜æ˜¯å®ƒæœ¬èº«å¹¶ä¸ç›´æ¥ç®¡ç†é›†ç¾¤çš„èŠ‚ç‚¹ï¼Œè€Œæ˜¯å€ŸåŠ©äº‘å‚å•†çš„ä¼¸ç¼©ç»„ ï¼ˆAutoScaling Groupï¼‰æˆ–èŠ‚ç‚¹æ± ï¼ˆNode Poolï¼‰æ¥é—´æ¥åœ°æ§åˆ¶èŠ‚ç‚¹ï¼ˆäº‘æœåŠ¡å™¨ï¼‰çš„æ•°é‡ã€‚è¿™æ ·çš„è®¾è®¡å¯¼è‡´äº†ä¸€äº›é—®é¢˜ï¼š éƒ¨ç½²ä¸ç»´æŠ¤æ¯”è¾ƒç¹çï¼šéœ€è¦å…ˆåœ¨äº‘å‚å•†çš„æ§åˆ¶å°ä¸Šåˆ›å»ºå¥½ä¼¸ç¼©ç»„æˆ–èŠ‚ç‚¹æ± ï¼Œç„¶åå†åœ¨ Kubernetes é›†ç¾¤ä¸Šéƒ¨ç½² Cluster Autoscalerï¼Œå¹¶å°†ä¼¸ç¼©ç»„æˆ–èŠ‚ç‚¹æ± çš„åç§°ç­‰ä¿¡æ¯å¡«å†™åˆ° Cluster Autoscaler çš„é…ç½®æ–‡ä»¶ä¸­ã€‚å¢åˆ èŠ‚ç‚¹æ± æ—¶ä¹Ÿéœ€è¦èµ°ä¸€éè¿™ä¸ªæµç¨‹ã€‚ èƒ½åŠ›å—é™äºäº‘å‚å•†çš„ä¼¸ç¼©ç»„æˆ–èŠ‚ç‚¹æ± æœåŠ¡ï¼šå¦‚æœäº‘å‚å•†çš„ä¼¸ç¼©ç»„æˆ–èŠ‚ç‚¹æ± æœåŠ¡ä¸æ”¯æŒæŸäº›åŠŸèƒ½ï¼Œé‚£ä¹ˆ Cluster Autoscaler ä¹Ÿæ— æ³•ä½¿ç”¨è¿™äº›åŠŸèƒ½ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼ŒAWS EKS çš„ Node Group åŠŸèƒ½éå¸¸éš¾ç”¨ï¼Œæ¯›ç—…ä¸€å¤§å †ã€‚ä½†å¦‚æœè¦ç”¨ Cluster Autoscalerï¼Œä½ å°±æ²¡å¾—é€‰ï¼ŒNode Group å†éš¾ç”¨ä¹Ÿåªèƒ½å¿ç€ã€‚ è€Œ Karpenter åˆ™å®Œå…¨ä»é›¶å¼€å§‹å®ç°äº†ä¸€å¥—èŠ‚ç‚¹ç®¡ç†ç³»ç»Ÿï¼Œå®ƒç›´æ¥ç®¡ç†æ‰€æœ‰èŠ‚ç‚¹ï¼ˆäº‘æœåŠ¡å™¨ï¼Œå¦‚ AWS EC2ï¼‰ï¼Œè´Ÿè´£èŠ‚ç‚¹çš„åˆ›å»ºã€åˆ é™¤ã€ä¿®æ”¹ç­‰æ“ä½œã€‚ ç›¸è¾ƒ Cluster Autoscaler, Karpenter çš„ä¼˜åŠ¿ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š å£°æ˜å¼åœ°å®šä¹‰èŠ‚ç‚¹æ± : Karpenter æä¾›äº†ä¸€å¥— CRD æ¥å®šä¹‰èŠ‚ç‚¹æ± ï¼Œç”¨æˆ·åªéœ€è¦ç¼–å†™å¥½ Yaml é…ç½®éƒ¨ç½²åˆ°é›†ç¾¤ä¸­ï¼ŒKarpenter å°±ä¼šæ ¹æ®é…ç½®è‡ªåŠ¨ç”³è¯·ä¸ç®¡ç†èŠ‚ç‚¹ã€‚è¿™æ¯” Cluster Autoscaler çš„é…ç½®è¦æ–¹ä¾¿å¾—å¤šã€‚ ä»¥ AWS ä¸ºä¾‹ï¼Œä½ ç®€å•åœ°æ”¹å‡ è¡Œ Yaml é…ç½®ï¼Œå°±å¯ä»¥ä¿®æ”¹æ‰èŠ‚ç‚¹æ± çš„å®ä¾‹ç±»å‹ã€AMI é•œåƒã€æ•°é‡ä¸Šä¸‹é™ã€ç£ç›˜å¤§å°ã€èŠ‚ç‚¹ Labels è·Ÿ Taintsã€EC2 Tags ç­‰ä¿¡æ¯ã€‚ å€ŸåŠ© Flux æˆ– ArgoCD ç­‰ GitOps å·¥å…·ï¼Œä½ è¿˜å¯ä»¥å®ç°è‡ªåŠ¨åŒ–çš„èŠ‚ç‚¹æ± ç®¡ç†ä»¥åŠé…ç½®çš„ç‰ˆæœ¬æ§åˆ¶ã€‚ æˆæœ¬æ„ŸçŸ¥çš„èŠ‚ç‚¹ç®¡ç†ï¼šKarpenter ä¸ä»…è´Ÿè´£èŠ‚ç‚¹æ•°é‡çš„ä¼¸ç¼©ï¼Œå®ƒè¿˜èƒ½æ ¹æ®èŠ‚ç‚¹çš„è§„æ ¼ã€è´Ÿè½½æƒ…å†µã€æˆæœ¬ç­‰å› ç´ æ¥é€‰æ‹©æœ€ä¼˜çš„èŠ‚ç‚¹ç±»å‹ï¼Œä»¥è¾¾æˆæˆæœ¬ã€æ€§èƒ½ã€ç¨³å®šæ€§ä¹‹é—´çš„å¹³è¡¡ã€‚ - å…·ä½“è€Œè¨€ï¼ŒKarpenter åœ¨æˆæœ¬ä¼˜åŒ–æ–¹é¢å…·æœ‰è¿™äº› Cluster Autoscaler ä¸å…·å¤‡çš„åŠŸèƒ½ï¼š Spot/On-Demand å®ä¾‹è°ƒæ•´: åœ¨ AWS ä¸Šï¼ŒKarpenter å¯ä»¥è®¾ç½®ä¸ºä¼˜å…ˆä½¿ç”¨ Spot å®ä¾‹ï¼Œå¹¶åœ¨ç”³è¯·ä¸åˆ° Spot å®ä¾‹æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ° On-Demand å®ä¾‹ï¼Œä»è€Œå¤§å¤§é™ä½æˆæœ¬ã€‚ å¤šèŠ‚ç‚¹ç±»å‹æ”¯æŒ: Karpenter æ”¯æŒåœ¨åŒä¸€ä¸ªé›†ç¾¤ä¸­ä½¿ç”¨å¤šç§ä¸åŒè§„æ ¼çš„èŠ‚ç‚¹ï¼Œå¹¶ä¸”æ”¯æŒæ§åˆ¶ä¸åŒå®ä¾‹ç±»å‹çš„ä¼˜å…ˆçº§ã€æ•°é‡æˆ–å æ¯”ï¼Œä»¥æ»¡è¶³ä¸åŒçš„ä¸šåŠ¡éœ€æ±‚ã€‚ èŠ‚ç‚¹æ›¿æ¢ç­–ç•¥ï¼šKarpenter æ”¯æŒçµæ´»çš„èŠ‚ç‚¹æ›¿æ¢ç­–ç•¥ï¼Œå¯ä»¥é€šè¿‡ Yaml æ§åˆ¶æ¯ä¸ªèŠ‚ç‚¹æ± çš„èŠ‚ç‚¹æ›¿æ¢æ¡ä»¶ã€é¢‘ç‡ã€æ¯”ä¾‹ç­‰å‚æ•°ï¼Œä»¥é¿å…å› èŠ‚ç‚¹æ›¿æ¢å¯¼è‡´çš„æœåŠ¡ä¸å¯ç”¨ã€‚ èŠ‚ç‚¹çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼šKarpenter æ”¯æŒå®šä¹‰èŠ‚ç‚¹çš„ç”Ÿå‘½å‘¨æœŸç­–ç•¥ï¼Œå¯ä»¥æ ¹æ®èŠ‚ç‚¹çš„å¹´é¾„ã€è´Ÿè½½ã€æˆæœ¬ç­‰å› ç´ æ¥å†³å®šèŠ‚ç‚¹çš„ç»­ç§Ÿã€ä¸‹çº¿ã€é”€æ¯ç­‰æ“ä½œã€‚è€Œ Cluster Autoscaler åªèƒ½æ§åˆ¶èŠ‚ç‚¹çš„æ•°é‡ï¼Œå®ƒä¸ç›´æ¥ç®¡ç†èŠ‚ç‚¹ï¼Œä¹Ÿå°±åšä¸åˆ°æ­¤ç±»èŠ‚ç‚¹çš„ç²¾ç»†ç®¡ç†ã€‚ ä¸»åŠ¨ä¼˜åŒ–ï¼šKarpenter æ”¯æŒä¸»åŠ¨æ ¹æ®è´Ÿè½½æƒ…å†µä½¿ç”¨ä¸åŒå®ä¾‹ç±»å‹çš„èŠ‚ç‚¹æ›¿æ¢é«˜é£é™©èŠ‚ç‚¹ï¼Œæˆ–åˆå¹¶ä½è´Ÿè½½èŠ‚ç‚¹ï¼Œä»¥èŠ‚çœæˆæœ¬ã€‚ Pod ç²¾ç»†åŒ–è°ƒåº¦ï¼šKarpenter æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªè°ƒåº¦å™¨ï¼Œå®ƒèƒ½æ ¹æ® Pod çš„èµ„æºéœ€æ±‚ã€ä¼˜å…ˆçº§ã€Node Affinityã€Topology Spread Constraints ç­‰å› ç´ æ¥ç”³è¯·èŠ‚ç‚¹å¹¶ä¸»åŠ¨å°† Pod è°ƒåº¦åˆ°è¯¥èŠ‚ç‚¹ä¸Šã€‚è€Œ Cluster Autoscaler åªèƒ½æ§åˆ¶èŠ‚ç‚¹çš„æ•°é‡ï¼Œå¹¶æ— è°ƒåº¦èƒ½åŠ›ã€‚ å¿«é€Ÿã€é«˜æ•ˆï¼šå› ä¸º Karpenter ç›´æ¥åˆ›å»ºã€åˆ é™¤èŠ‚ç‚¹ï¼Œå¹¶ä¸”ä¸»åŠ¨è°ƒåº¦ Podï¼Œæ‰€ä»¥å®ƒçš„ä¼¸ç¼©é€Ÿåº¦ä¸æ•ˆç‡è¦æ¯” Cluster Autoscaler é«˜å¾ˆå¤šã€‚è¿™æ˜¯å› ä¸º Karpenter èƒ½å¿«é€Ÿè·çŸ¥èŠ‚ç‚¹åˆ›å»ºã€åˆ é™¤ã€åŠ å…¥é›†ç¾¤æ˜¯å¦æˆåŠŸï¼Œè€Œ Cluster Autoscaler åªèƒ½è¢«åŠ¨åœ°ç­‰å¾…äº‘å‚å•†çš„ä¼¸ç¼©ç»„æˆ–èŠ‚ç‚¹æ± æœåŠ¡å®Œæˆè¿™äº›æ“ä½œï¼Œå®ƒæ— æ³•ä¸»åŠ¨æ„ŸçŸ¥èŠ‚ç‚¹çš„çŠ¶æ€ã€‚ æ€»ä¹‹ï¼Œä¸ªäººçš„ä½¿ç”¨ä½“éªŒä¸Šï¼ŒKarpenter åŠæ‰“äº† Cluster Autoscaler. ","date":"2024-07-10","objectID":"/posts/kubernetes-cluster-autoscaling-1-karpenter/:3:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Cloud-Native","Kubernetes","MultiCloud","å¤šäº‘","è‡ªåŠ¨æ‰©ç¼©å®¹","Karpenter","Cluster-Autoscaler"],"title":"Kubernetes é›†ç¾¤ä¼¸ç¼©ç»„ä»¶ - Karpenter","uri":"/posts/kubernetes-cluster-autoscaling-1-karpenter/#karpenter-ä¸-cluster-autoscaler-çš„å¯¹æ¯”"},{"categories":["tech"],"content":" Karpenter çš„ä½¿ç”¨è¿™éƒ¨åˆ†å»ºè®®ç›´æ¥é˜…è¯»å®˜æ–¹æ–‡æ¡£Karpenter - Just-in-time Nodes for Any Kubernetes Cluster. ","date":"2024-07-10","objectID":"/posts/kubernetes-cluster-autoscaling-1-karpenter/:4:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Cloud-Native","Kubernetes","MultiCloud","å¤šäº‘","è‡ªåŠ¨æ‰©ç¼©å®¹","Karpenter","Cluster-Autoscaler"],"title":"Kubernetes é›†ç¾¤ä¼¸ç¼©ç»„ä»¶ - Karpenter","uri":"/posts/kubernetes-cluster-autoscaling-1-karpenter/#karpenter-çš„ä½¿ç”¨"},{"categories":["tech"],"content":" é€‚é…å…¶ä»– Kubernetes å‘è¡Œç‰ˆä¸äº‘æœåŠ¡å•†å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Proxmox VE, Aliyun ç­‰å…¶ä»–äº‘å¹³å°ï¼Œæˆ–è€…ä½¿ç”¨çš„æ˜¯ K3s, Kubeadm ç­‰éæ‰˜ç®¡ Kubernetes å‘è¡Œç‰ˆï¼Œé‚£ä¹ˆä½ å°±éœ€è¦è‡ªå·±é€‚é… Karpenter äº†ã€‚ Karpenter å®˜æ–¹ç›®å‰å¹¶æœªæä¾›è¯¦ç»†çš„é€‚é…æ–‡æ¡£ï¼Œç¤¾åŒºå»ºè®®ä»¥ç”¨äºæµ‹è¯•çš„Kwok Provider ä¸ºå‚è€ƒï¼Œè‡ªè¡Œå®ç°ã€‚Kwok æ˜¯ä¸€ä¸ªæç®€çš„ Karpenter Provider å®ç°ï¼Œæ›´å¤æ‚çš„åŠŸèƒ½ä¹Ÿå¯ä»¥å‚è€ƒ AWS ä¸ Azure çš„å®ç°ã€‚ å›½å†…äº‘æœåŠ¡æ–¹é¢, ç›®å‰å·²ç»æœ‰äººåšäº† Aliyun çš„é€‚é…ï¼Œé¡¹ç›®åœ°å€å¦‚ä¸‹ï¼š karpenter-provider-aliyun å¯¹äºä¸ªäºº Homelab ç©å®¶æ¥è¯´ï¼Œä½¿ç”¨ Proxmox VE + K3s è¿™ä¸ªç»„åˆçš„ç”¨æˆ·åº”è¯¥ä¼šæ¯”è¾ƒå¤šã€‚æˆ‘ä¸ªäººç›®å‰æ­£åœ¨å°è¯•ä¸ºè¿™ä¸ªç»„åˆé€‚é… Karpenterï¼Œå¸Œæœ›èƒ½å¤Ÿåœ¨æœªæ¥çš„æ–‡ç« ä¸­åˆ†äº«ä¸€äº›ç»éªŒã€‚é¡¹ç›®åœ°å€å¦‚ä¸‹ï¼š ryan4yin/karpenter-provider-proxmox: å› ä¸ºæˆ‘å·²ç»æ¢äº† KubeVirt, è¿™ä¸ªé¡¹ç›®ç¼ºä¹å¼€å‘åŠ¨åŠ›,æš‚æ—¶æç½®,å¹¶æ”¹ä¸ºç§æœ‰ä»“åº“äº†â€¦ ","date":"2024-07-10","objectID":"/posts/kubernetes-cluster-autoscaling-1-karpenter/:5:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Cloud-Native","Kubernetes","MultiCloud","å¤šäº‘","è‡ªåŠ¨æ‰©ç¼©å®¹","Karpenter","Cluster-Autoscaler"],"title":"Kubernetes é›†ç¾¤ä¼¸ç¼©ç»„ä»¶ - Karpenter","uri":"/posts/kubernetes-cluster-autoscaling-1-karpenter/#é€‚é…å…¶ä»–-kubernetes-å‘è¡Œç‰ˆä¸äº‘æœåŠ¡å•†"},{"categories":["tech"],"content":" Karpenter ä¸ Cluster APICluster API (CAPI) æ˜¯ Kubernetes ç¤¾åŒºæä¾›çš„ä¸€ä¸ªç”¨äºç®¡ç†å¤šé›†ç¾¤çš„é¡¹ç›®ï¼Œä»ä»‹ç»ä¸Šçœ‹ï¼Œå®ƒè·Ÿ Karpenter å¥½åƒæ²¡å•¥äº¤é›†ã€‚ä½†å¦‚æœä½ æœ‰çœŸæ­£äº†è§£ä½¿ç”¨è¿‡ CAPI çš„è¯ï¼Œä½ ä¼šå‘ç° Karpenter ä¸ CAPI æœ‰ä¸€äº›åŠŸèƒ½ä¸Šçš„é‡å ï¼š CAPI çš„ Infrastructure Provider ä¸“é—¨è´Ÿè´£å¤„ç†äº‘å‚å•†ç›¸å…³é€»è¾‘çš„ç»„ä»¶ã€‚Karpenter çš„æ ‡å‡†å®ç°å†…ä¹ŸåŒ…å«äº† cloud provider ç›¸å…³ä»£ç ï¼Œè¿˜æä¾›äº† NodeClass è¿™ä¸ª CRD ç”¨äºè®¾å®šäº‘æœåŠ¡å™¨ç›¸å…³çš„å‚æ•°ã€‚ Cluster API Bootstrap Provider (CABP) è´Ÿè´£å°†äº‘æœåŠ¡å™¨åˆå§‹åŒ–ä¸º Kubernetes Nodeï¼Œå®é™…ä¸Šå°±æ˜¯ç”Ÿæˆå¯¹åº”çš„ cloud-init user data. Karpenter çš„ NodeClass å®ç°ä¸­åŒæ ·ä¹ŸåŒ…å«äº† user data çš„ç”Ÿæˆé€»è¾‘ã€‚ Cluster API çš„ç›®æ ‡æ˜¯å¤šé›†ç¾¤ç®¡ç†ï¼Œå¹¶ä¸”å®ƒçš„è®¾è®¡ä¸Šå°† Bootstrap, ControlPlane è·Ÿ Infrastructure ä¸‰ä¸ªéƒ¨åˆ†åˆ†ç¦»å‡ºæ¥äº†ï¼Œå¥½å¤„æ˜¯æ–¹ä¾¿å„äº‘å‚å•†ã€å„ Kubernetes å‘è¡Œç‰ˆçš„æ¥å…¥ï¼Œä½†ä¹Ÿå¯¼è‡´äº†å®ƒçš„æ¶æ„æ¯”è¾ƒå¤æ‚ã€å‡ºé—®é¢˜æ’æŸ¥èµ·æ¥ä¼šæ¯”è¾ƒéº»çƒ¦ã€‚ å†å²æ¡ˆä¾‹ï¼šIstio æ›¾ç»å°±é‡‡ç”¨äº†å¾®æœåŠ¡æ¶æ„ï¼Œç»“æœå› ä¸ºæ€§èƒ½å·®ã€ç»´æŠ¤éš¾åº¦é«˜è¢«ä¸å°‘äººå–·ï¼Œåæ¥æ‰æ”¹æˆäº†å•ä½“ç»“æ„ã€‚ è€Œ Karpenter åˆ™æ˜¯ä¸€ä¸ªå•ä½“åº”ç”¨ï¼Œå®ƒçš„æ ¸å¿ƒåŠŸèƒ½è¢«ä»¥ Go Library çš„å½¢å¼å‘å¸ƒï¼Œç”¨æˆ·éœ€è¦åŸºäºè¿™ä¸ªåº“æ¥å®ç°è‡ªå·±çš„äº‘å¹³å°é€‚é…ã€‚è¿™æ ·çš„è®¾è®¡ä½¿å¾— Karpenter çš„æ¶æ„ç®€å•ã€æ˜“äºç»´æŠ¤ã€‚ä½†è¿™ä¹Ÿæ„å‘³ç€ Karpenter çš„å¯æ‰©å±•æ€§ã€é€šç”¨æ€§ä¸å¦‚ Cluster API. ä»ç»“æœæ¥çœ‹ï¼Œç°åœ¨ Cluster API çš„ç”Ÿæ€ç›¸å½“ä¸°å¯Œï¼Œä»Provider Implementations - Cluster API Docs èƒ½çœ‹åˆ°å·²ç»æœ‰äº†å¾ˆå¤šäº‘å‚å•†ã€å‘è¡Œç‰ˆçš„é€‚é…. è€Œ Karpenter 2023 å¹´åº•æ‰æç»™ CNCFï¼Œç›®å‰åªæœ‰ AWS ä¸ Azure çš„å®ç°ï¼Œæœªæ¥å‘å±•è¿˜æœ‰å¾…è§‚å¯Ÿã€‚ é‚£ä¹ˆæœ‰æ²¡æœ‰å¯èƒ½ç»“åˆä¸¤è€…çš„ä¼˜åŠ¿å‘¢ï¼ŸKubernetes ç¤¾åŒºå…¶å®å°±æœ‰ç±»ä¼¼çš„å°è¯•ï¼š Cluster API Karpenter Feature Group Notes Karpenter Provider Cluster API Open Questions elmiko/karpenter-provider-cluster-api ä¸Šé¢è¿™ä¸ªå®éªŒæ€§è´¨çš„é¡¹ç›®å°è¯•ä½¿ç”¨ Karpenter ä½œä¸º Cluster API çš„ Node Autoscalerï¼Œå–ä»£æ‰ç°åœ¨çš„ Cluster Autoscaler. æˆ‘ç›®å‰å¯¹ Cluster API æœ‰äº›å…´è¶£ï¼Œä½†æ„Ÿè§‰å®ƒè¿˜æ˜¯å¤æ‚äº†ç‚¹ã€‚æˆ‘æ›´æƒ³è¯•è¯•åœ¨ Karpenter çš„å®ç°ä¸­å¤ç”¨ Cluster API å„ä¸ª Provider çš„ä»£ç ï¼Œå¿«é€Ÿé€‚é…å…¶ä»–äº‘å‚å•†ä¸ Kubernetes å‘è¡Œç‰ˆã€‚ ","date":"2024-07-10","objectID":"/posts/kubernetes-cluster-autoscaling-1-karpenter/:6:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Cloud-Native","Kubernetes","MultiCloud","å¤šäº‘","è‡ªåŠ¨æ‰©ç¼©å®¹","Karpenter","Cluster-Autoscaler"],"title":"Kubernetes é›†ç¾¤ä¼¸ç¼©ç»„ä»¶ - Karpenter","uri":"/posts/kubernetes-cluster-autoscaling-1-karpenter/#karpenter-ä¸-cluster-api"},{"categories":["tech"],"content":" å‚è€ƒèµ„æ–™ Cluster Autoscaling - Kubernetes Official Docs ","date":"2024-07-10","objectID":"/posts/kubernetes-cluster-autoscaling-1-karpenter/:7:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Cloud-Native","Kubernetes","MultiCloud","å¤šäº‘","è‡ªåŠ¨æ‰©ç¼©å®¹","Karpenter","Cluster-Autoscaler"],"title":"Kubernetes é›†ç¾¤ä¼¸ç¼©ç»„ä»¶ - Karpenter","uri":"/posts/kubernetes-cluster-autoscaling-1-karpenter/#å‚è€ƒèµ„æ–™"},{"categories":["life"],"content":" ç¼˜èµ·åœ¨ 2023 å¹´å¹´åº¦æ€»ç»“ä¸­ï¼Œæˆ‘ç»™ 2024 å¹´å®šä¸‹çš„ç›®æ ‡æ˜¯ã€Œå·¥ä½œä¸ä¸šä½™çˆ±å¥½ä¸Šç¨³ä¸­æ±‚è¿›ï¼Œç”Ÿæ´»ä¸Šé”»ç‚¼å¥½èº«ä½“ã€å¤šå…³å¿ƒå®¶äººã€ï¼Œä¸ºæ­¤ä»Šå¹´æˆ‘åšäº†è®¸å¤šæ—…è¡Œçš„å‡†å¤‡ã€‚ åœ¨æ·±åœ³å‘†äº†å¿«äº”å¹´ï¼ŒæŒºé•¿æ—¶é—´é‡Œä¸€ç›´å°†è‡ªå·±å±€é™åœ¨æŠ€æœ¯ä¸å·¥ä½œä¸­ï¼Œå°‘æœ‰æ—¶é—´å»å…³æ³¨å‘¨å›´çš„ä¸–ç•Œâ€”â€”ç”Ÿå­˜å·²å±ä¸æ˜“ï¼Œæ²¡æœ‰å¤šä½™çš„ç²¾åŠ›å»å…³å¿ƒå…¶ä»–äº‹æƒ…ã€‚2023 å¹´æ˜¯ä¸€ä¸ªåˆ†ç•Œç‚¹ï¼Œå·¥ä½œä¸Šè¶Šæ¥è¶Šå¾—å¿ƒåº”æ‰‹ï¼Œæ‰‹å¤´ä¹Ÿä¸å†ç´§å¼ ï¼Œä¸ªäººç²¾åŠ›è·Ÿä¸šä½™æ—¶é—´å¾—ä»¥è§£æ”¾ï¼Œæˆ‘è‡ªç„¶å¼€å§‹è¿½æ±‚æ›´å¤šçš„ç”Ÿæ´»ä½“éªŒã€‚ è¯´æ˜¯è¦é”»ç‚¼èº«ä½“ï¼Œå¤šæ—…æ¸¸ï¼Œä½†ä¹Ÿæ²¡å•¥æ˜ç¡®çš„è®¡åˆ’ï¼Œåªæ˜¯æƒ³ç€è¯¥å‡ºå›½èµ°ä¸€èµ°å¼€å¼€çœ¼ç•Œï¼Œäºæ˜¯ 3 æœˆä»½åˆ°å‡ºå…¥å¢ƒç®¡ç†å±€æå®šäº†æŠ¤ç…§è·Ÿæ¸¯æ¾³é€šè¡Œè¯ã€‚ é¦™æ¸¯ç¦»æ·±åœ³è¿‘å¾—å¾ˆï¼Œè‡ªç„¶å°±æƒ³ç€å…ˆå»é¦™æ¸¯å¤šèµ°èµ°ï¼Œè¿™æ˜¯ç¼˜èµ·ã€‚ è€Œè¿™ä»¶äº‹æƒ…åæ¥çš„å‘å±•ï¼Œç°åœ¨å›çœ‹èµ·æ¥ï¼Œè·Ÿæˆ‘å½“åˆæŠ˜è…¾ NixOS æˆ–ç”µå­ç”µè·¯çš„æ•…äº‹å¦‚å‡ºä¸€è¾™ï¼Œå¤§æ¦‚æ€§æ ¼ä½¿ç„¶å§å“ˆå“ˆã€‚ ç®€å•æ€»ç»“ä¸‹å‘¢ï¼Œå°±æ˜¯ 4 æœˆä»½å»é¦™æ¸¯æµ·è¾¹å¾’æ­¥äº†ä¸€å¤©ï¼Œä»ç»´å¤šåˆ©äºšæ¸¯æ²¿ç€æµ·å²¸çº¿ä¸€è·¯èµ°åˆ°åšå°¼åœ°åŸï¼Œç„¶åå°±çˆ±ä¸Šäº†è¿™ç§åœ¨æµ·è¾¹å¾’æ­¥çš„æ„Ÿè§‰ï¼Œå›æ¥åä¹Ÿä¸€ç›´å¿µå¿µä¸å¿˜ï¼ŒæŸ¥äº†è®¸å¤šé¦™æ¸¯å¾’æ­¥è·¯çº¿çš„èµ„æ–™ã€‚ äº”ä¸€å‡æœŸçš„æ—¶å€™è·Ÿç€å°çº¢ä¹¦å’Œ Bilibili ä¸Šçš„æ”»ç•¥ï¼Œå¾’æ­¥äº†é¦™æ¸¯éº¦ç†æµ©å¾„ç¬¬ä¸€æ®µçš„éƒ¨åˆ†ä»¥åŠç¬¬äºŒæ®µå…¨ç¨‹ã€‚å› ä¸ºå‡†å¤‡ä¸è¶³ï¼Œä¸¾ç€æ‰‹æœºèµ°äº†ä¸€ä¸ªå°æ—¶å¤œè·¯ï¼Œå¹¶ä¸”åœ¨è¥¿æ¹¾æ‘è¥åœ°ç§Ÿå¸ç¯·éœ²è¥äº†ä¸€æ™šä¸Šã€‚è¿™æ¬¡ä½“éªŒåˆè®©æˆ‘è¿·ä¸Šäº†å¤œé—´å¾’æ­¥è·Ÿéœ²è¥ã€‚ä¸€å›å®¶å°±æŸ¥å„ç§å¾’æ­¥éœ²è¥è£…å¤‡ï¼Œç–¯ç‹‚ä¸‹å•ï¼Œæ”¶äº†ä¸€å¤§å †å¿«é€’ï¼ŒèŠ±æ‰äº†ä¸€ä¸‡å¤š RMBâ€¦ æ¥ç€å°±æ˜¯ 5 æœˆ 18 æ—¥ï¼ŒèƒŒä¸Šæˆ‘ 65L çš„é‡è£…èƒŒåŒ…ï¼Œæ€»é‡é‡å¤§æ¦‚æœ‰ 17 kgï¼Œä»æ·±åœ³ååœ°é“ + å¤§å·´ç›´è¾¾åŒ—æ½­å‡¹ï¼Œçˆ¬äº†ä¸€ééº¦ç†æµ©å¾„ä¸‰æ®µï¼Œå¤œé—´åœ¨æ°´æµªçªè¥åœ°éœ²è¥ä¸€æ™šï¼Œç¬¬äºŒå¤©ä¸€æ—©ç›´æ¥æ‰“é“å›åºœã€‚æœ¬æ¥è®¡åˆ’æ˜¯å‘¨æœ«ä¸¤å¤©åˆ·å®Œä¸‰å››æ®µï¼Œç”šè‡³æœ‰ä½™åŠ›å†èµ°å®Œç¬¬äº”æ®µçš„ã€‚ä½†æ˜¯æˆ‘æ˜¾ç„¶é«˜ä¼°äº†è‡ªå·±çš„ä½“åŠ›ï¼Œè€Œä¸”èƒŒç€ 17 kg çš„é‡è£…èƒŒåŒ…ï¼Œè¿™ä¹Ÿä¸æ˜¯ä¸€ä»¶è½»æ¾çš„äº‹æƒ…ã€‚ ä¼‘æ¯äº†ä¸€å‘¨åï¼Œåœ¨ 5 æœˆ 25 æ—¥ï¼Œæˆ‘åˆå®Œæˆäº†éº¦ç†æµ©å¾„ç¬¬å››æ®µçš„å¾’æ­¥ã€‚è¿™æ¬¡å‡ºå‘å‰æ ¹æ®ä¸Šæ¬¡çš„ç»éªŒç²¾ç®€äº†è£…å¤‡ï¼ŒèƒŒåŒ…é‡é‡åº”è¯¥è½»äº†å¤§æ¦‚ 1kgï¼Œä½†ä»æ—§æœ‰ 16kgã€‚å››æ®µæ˜¯éº¦å¾„éš¾åº¦æœ€é«˜çš„ä¸€æ®µï¼Œè€Œä¸”ç»ˆç‚¹åŸºç»´å°”è¥åœ°ä¸æ¥å—ä¸ªäººé¢„çº¦ï¼Œåˆå¯¼èˆªå¾’æ­¥åˆ°å¤§è€å±±éš§é“ç«™ä¹˜ä¹å·´ 74X è·¯è‡³å¹¿ç¦é‚¨ä¸‹è½¦ï¼Œå†æ­¥è¡Œåˆ°åœ°é“ç«™ä¹˜è½¦åˆ°ç½—æ¹–å£å²¸å›å®¶ï¼Œåˆ°è¾¾è½¦ç«™æ—¶å·²ç»æ˜¯ 22:20ã€‚å…¨ç¨‹å·®ä¸å¤š 9 ä¸ªå°æ—¶ï¼Œæ­¥è¡Œè¶…è¿‡ 21 å…¬é‡Œï¼Œæ˜¯æˆ‘ç›®å‰çš„äººç”Ÿå·…å³°ã€‚ ä»¥ä¸Šå°±æ˜¯æˆ‘åˆ°ç›®å‰ä¸ºæ­¢çš„é¦™æ¸¯å¾’æ­¥ç»å†ï¼Œç›®å‰å¯¹é‡è£…å¾’æ­¥å…´è¶£æµ“åšï¼Œè®¡åˆ’ä»Šå¹´å…ˆæŠŠéº¦ç†æµ©å¾„å…¨ç¨‹èµ°å®Œï¼Œ ç§¯ç´¯ç»éªŒï¼Œåç»­å†çœ‹çœ‹é¦™æ¸¯è·Ÿå›½å†…å¤–çš„å…¶ä»–å¾’æ­¥è·¯çº¿ã€‚ ","date":"2024-05-21","objectID":"/posts/hong-kong-travel-notes-in-2024/:1:0","series":["å¾’æ­¥æ—…è¡Œ"],"tags":["Travel","æ—…æ¸¸","Backpacking","é‡è£…å¾’æ­¥","Hiking","å¾’æ­¥","Hong Kong","é¦™æ¸¯","MacLehose Trail","éº¦ç†æµ©å¾„"],"title":"2024 å¹´é¦™æ¸¯å¾’æ­¥æ—…è¡Œè®°å½•ï¼ˆä¸€ï¼‰","uri":"/posts/hong-kong-travel-notes-in-2024/#ç¼˜èµ·"},{"categories":["life"],"content":" ä¸€ã€ä»ç»´å¤šåˆ©äºšæ¸¯åˆ°åšå°¼åœ°åŸ æ—¶é—´ï¼š2024-04-14 è¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡å‡ºå¢ƒæ¸¸ï¼Œæ•´ä¸ªè¡Œç¨‹éƒ½æ˜¯ä¸´æ—¶èµ·æ„ï¼Œæ²¡æœ‰åšä»»ä½•å‡†å¤‡ï¼Œå³ä½¿æ˜¯è¿‡äº†ç½—æ¹–å£å²¸ï¼Œç«™åœ¨ä¸œé“çº¿åœ°é“ä¸Šçš„æ—¶å€™ï¼Œæˆ‘å¯¹æ•´ä¸ªè¡Œç¨‹ä¹Ÿå¹¶æ— å¤ªå¤šæœŸå¾…ï¼Œå¿ƒé‡Œæƒ³ç€æ— éæ˜¯ä¸åŒçš„äººä¸ç‰©ï¼Œæ— ç”šç‰¹æ®Šçš„ã€‚ä½†æ€»å¾—å‡ºå»èµ°èµ°ï¼Œçœ‹çœ‹å¤§é™†ä¹‹å¤–ç©¶ç«Ÿæ˜¯ä¸ªä»€ä¹ˆæ ·å­ï¼Œæ‰€ä»¥å°±è¿™ä¹ˆéšæ„åœ°æ¥åˆ°äº†é¦™æ¸¯ã€‚ å…·ä½“æœ‰å¤šéšæ„å‘¢ï¼Ÿå°±è¿™ä¹ˆè¯´ï¼Œè¿‡äº†å£å²¸æ²¡å¤šä¹…ï¼Œæ‰‹æœºå°±æ²¡ä¿¡å·äº†ï¼Œæˆ‘è¿™æ‰æ„è¯†åˆ°é¦™æ¸¯ç»ˆå½’ä¸æ˜¯å¤§é™†ï¼Œæ…Œå¾—æˆ‘åˆå‡ºç«™å†å¾€å›åï¼Œåœ¨ç½—æ¹–å£å²¸è¿ä¸Šç½‘ç»œå¼€äº†ä¸ªæ¼«æ¸¸è·Ÿæµé‡åŒ…ï¼Œè¿™æ‰ç®—æ˜¯æ­£å¼å¼€å§‹äº†æˆ‘çš„é¦™æ¸¯ä¹‹æ—…ã€‚ æœ€åˆæœŸå¾…ç”šå°‘ï¼Œä½†ç°å®å¸¸å¸¸è¶…å‡ºæˆ‘çš„æƒ³è±¡ã€‚åœ¨é¦™æ¸¯å¾’æ­¥çš„ä¸€æ—¥ï¼Œæˆ‘åˆ‡å®æ„Ÿå—åˆ°äº†æ›´å®½å¹¿æ›´å¤šå…ƒåŒ–çš„ä¸–ç•Œï¼Œè¿™æ˜¯åœ¨å¤§é™†å¢ƒå†…æ— æ³•ä½“ä¼šåˆ°çš„ã€‚ åˆšä¸Šä¸œé“çº¿ç”šè‡³åˆšå‡ºåœ°é“ç«™çš„æ—¶å€™ï¼Œæˆ‘å¯¹è‡ªå·±å·²ç»å‡ºå¢ƒè¿™ä¸€ç‚¹å°šæ— å®æ„Ÿï¼Œå› ä¸ºé¦™æ¸¯çš„åœ°é“è·Ÿæ·±åœ³å®åœ¨å¤ªåƒäº†ï¼Œä¸è®ºæ˜¯åœ°é“è½¦å¢çš„è®¾è®¡è¿˜æ˜¯è½¦ç«™çš„å»ºç­‘é£æ ¼ã€å¹²å‡€æ•´æ´çš„ç¨‹åº¦ï¼Œéƒ½è·Ÿæ·±åœ³éå¸¸ç›¸ä¼¼ã€‚ åé¢è·Ÿæœ‹å‹èŠèµ·æ¥ï¼Œæ‰çŸ¥é“å›½å†…æ·±åœ³åœ°é“è·Ÿé¦™æ¸¯åœ°é“æ˜¯æœ‰åˆä½œå…³ç³»çš„ï¼Œå¾ˆå¤šæŠ€æœ¯æœ€åˆéƒ½æ¥è‡ªé¦™æ¸¯ï¼Œç®—æ˜¯ä¸€è„‰ç›¸æ‰¿äº†ã€‚ åœ¨å»å¾€ç»´å¤šåˆ©äºšæ¸¯çš„è·¯ä¸Šï¼Œçœ‹åˆ°é¦™æ¸¯å¤šçš„åŒå±‚å·´å£«ã€éšå¤„çš„ç¹ä½“å­—è·Ÿè‹±æ–‡æ ‡è¯†ï¼Œæ‰é€æ¸æ„Ÿè§‰åˆ°è¿™é‡Œç¡®å®æ˜¯ä¸ªä¸åŒçš„åœ°æ–¹ã€‚ å‡ºäº†ä¼šå±•åœ°é“ç«™ï¼Œå¾€ç»´å¤šåˆ©äºšæ¸¯å»çš„è·¯ä¸Š è·¯ä¸Šé‡åˆ°çš„æ•ç¯·è§‚å…‰å¤§å·´ æ¥ç€å°±åˆ°äº†ç»´æ¸¯çš„æµ·è¾¹æ­¥é“ï¼Œæµ·æ™¯å¾ˆç¾ï¼Œä¸¤å²¸éƒ½æ˜¯é«˜æ¥¼å¤§å¦ï¼Œæµ·ä¸Šæœ‰å¾ˆå¤šæ¸¸èˆ¹ï¼Œè¿˜æœ‰å¾ˆå¤šé’“é±¼çš„äººã€‚ æµ·è¾¹ ä¸¤å²¸éƒ½æŒºç¹å å¤§æµ·ä¸é«˜è€¸çš„å¤§æ¥¼ é’“é±¼ä½¬ ä»å¦ä¸€ä¸ªè§’åº¦çœ‹é’“é±¼ä½¬ æ¥ç€æˆ‘æ„è¯†åˆ°ï¼Œä»æˆ‘ä½å¤„å¯å…¨ç¨‹åœ°é“ç›´è¾¾ç»´æ¸¯ï¼Œåä¸ªåœ°é“å†æµ…æµ…èµ°å‡ æ­¥è·¯å°±èƒ½çœ‹åˆ°è¿™ä¹ˆæ¼‚äº®çš„æµ·æ™¯ï¼Œè¿™ä¸æ¯”å»æ·±åœ³å¤§é¹åŠå²›æ–¹ä¾¿å¤šäº†ï¼æˆ‘ä¸ºæ­¤å…´å¥‹èµ·æ¥ã€‚è¿™é£æ™¯åŠæ‰“æ·±åœ³æ¹¾ï¼Œä½†æ·±åœ³æ¹¾æ­¥é“ä¸Šçš„äººç”šè‡³æ¯”ç»´æ¸¯è¿˜å¤šï¼Œåªèƒ½è¯´æ·±åœ³äººçœŸçš„å¤ªå¤šäº†â€¦ è¡¥å……ï¼šå¬è¯´æ·±åœ³æ¹¾ä»¥å‰çœŸçš„æ˜¯æµ·è¾¹ï¼Œä½†å¡«æµ·é€ è·¯ä½¿å®ƒæˆäº†ç°åœ¨çš„çƒ‚æ³¥æ»© æ²¿ç€æµ·å²¸çº¿ç»§ç»­èµ°ï¼Œæ¸æ¸å‘ç°äººç¾¤é‡Œå¤–å›½æ¸¸å®¢ç›¸å½“çš„å¤šï¼Œç²—ç•¥ä¼°ç®—è¶…è¿‡ä¸€åŠæ˜¯å¤–å›½äººï¼Œè¿™è®©æˆ‘æ„Ÿå—åˆ°äº†é¦™æ¸¯çš„å›½é™…åŒ–æ°›å›´ã€‚ è£¹å¤´å·¾çš„å¥³æ¸¸å®¢åœ¨è‡ªæ‹ï¼Œæœ‰ç‚¹å¼‚åŸŸé£æƒ… å¤–å›½æ¸¸å®¢ä»¬éŸ³ç®±æ­Œä¸€æ”¾ï¼Œå°±åœ°è·³èµ·äº†èˆæ¥ æµ·è¾¹è¿˜æœ‰å¾ˆå¤šç»†èŠ‚å€¼å¾—ä¸€çœ‹ã€‚ æµ·å²¸ä¸Šçš„å¾®è§‚å»ºç­‘ï¼ŒæŒºæœ‰æ„æ€ å¤©æ˜Ÿå°è½®çš„æ¸¯å£ï¼Œä¼‘æ¯ã€èˆè¹ˆçš„äººæŒºå¤š å¤©æ˜Ÿå°è½® æ‘©å¤©è½®æ—çš„å°æ‘Šè´©ï¼Œè¿™å°æ‘©æ‰˜è½¦æ¯”è¾ƒæœ‰å¹´ä»£æ„Ÿäº†... ç»´å¤šåˆ©äºšæ¸¯çš„å…è´¹ WiFi åœ¨ç»´æ¸¯é€—ç•™ç©è€äº†ä¸€ä¸ªå°æ—¶ï¼Œä¹°äº†ç‚¹é¢åŒ…å½“åˆé¤åƒäº†ï¼Œç„¶åå°±æ²¿ç€æµ·è¾¹æ­¥é“ç»§ç»­å¾€å‰èµ°ï¼Œä¹Ÿæ²¡å•¥æ˜ç¡®çš„ç›®çš„åœ°ï¼Œåæ­£ç´¯äº†å°±å›å®¶ã€‚ç»´æ¸¯çš„äººå¾ˆå¤šï¼Œä½†å‡ºäº†ç»´æ¸¯åæ­¥é“ä¸Šäººå°±å°‘äº†å¾ˆå¤šï¼Œèµ°åœ¨è¿™æ ·çš„è·¯ä¸Šçœ‹ç€é£æ™¯ï¼Œç›¸å½“é—²é€‚ã€‚ æµ·ä¸åŸå¸‚ æ²¿ç€æµ·å²¸çº¿ç»§ç»­èµ°ï¼Œé˜³å…‰æ­£å¥½ æ³¢å…‰æ½‹æ»Ÿ å……æ»¡æ¶‚é¸¦çš„è½¬è§’ï¼Œæœ‰äººåœ¨æ‹ç…§ ä¼¼æ˜¯åºŸå¼ƒçš„å°ç å¤´ è¢«æ”¹é€ æˆæ¸¸ç©åœ°ç‚¹çš„ç å¤´ æµ·è¾¹æ­¥é“ä¸Šçš„å°åº—ï¼Œå°å¥³å­©åœ¨é€‰å†°æ£’ é¦™æ¸¯çš„å®å®è½¦ æ‚ é—²ã€è½»å¿«åœ°éšèµ°éšåœï¼Œå¤§æ¦‚ä¸€ä¸ªåŠå°æ—¶åï¼Œåˆ°è¾¾äº†æ­¥é“çš„ç»ˆç‚¹â€”â€”åšå°¼åœ°åŸï¼Œæˆ‘è¿˜æœ‰ç‚¹å¤±æœ›ï¼Œè¿™æ­¥é“å±…ç„¶å°±è¿™ä¹ˆæ²¡äº†ã€‚åªå¥½æ‰è½¬æ–¹å‘å¾€åŸå¸‚å†…èµ°ï¼Œå¸‚å†…å€’ä¹Ÿåˆ«æœ‰ä¸€ç•ªé£æ™¯ã€‚ å¤©å¿«é»‘äº†ï¼Œæ²¿è¡—å•†åº—äº®èµ·äº†ç¯ç‰Œ è¿™å®¶åº—é—¨å£äººæŒºå¤šï¼Œæˆ–è®¸å‘³é“ä¸é”™ï¼Ÿ åœ¨å¸‚å†…é€›äº†é€›ï¼Œç¡®è®¤äº†é¦™æ¸¯å„ç§åº—é“ºçš„ç‰¹ç‚¹æ˜¯å°è€Œç¾ï¼Œå„ç§åº—é“ºéƒ½éå¸¸å°ï¼Œä½†å¼„å¾—æ¯”è¾ƒç²¾è‡´ï¼Œèƒ½çœ‹å¾—å‡ºèŠ±äº†å¿ƒæ€ã€‚ç›¸å¯¹è€Œè¨€æ·±åœ³çš„å•†åœºåº—é“ºå°±å¤§æ°”å¾ˆå¤šäº†ï¼Œä½†ä¹Ÿç¼ºäº†é¦™æ¸¯è¿™äº›åº—é“ºçš„ç§ç§ç»†èŠ‚ã€‚ ç©å¾—å°½å…´ï¼Œåˆæ‰¾äº†å®¶åº—åƒé¥±å–è¶³ï¼Œæ‰“é“å›åºœã€‚ åšå°¼åœ°åŸåœ°é“ç«™ï¼Œå›å®¶å•¦ è¿™ä¸€è¶Ÿä¸‹æ¥ï¼Œæˆ‘çš„æ„Ÿè§‰æ˜¯ï¼Œé¦™æ¸¯ç¡®å®æ˜¯å›½é™…åŒ–å¤§éƒ½å¸‚ï¼Œè·Ÿæ·±åœ³çš„æ°”æ¯å¾ˆä¸ä¸€æ ·ï¼Œæµ·è¾¹éšå¤„å¯è§çš„é…’å§ï¼Œ æ¯”ä¾‹éå¸¸é«˜çš„å¤–å›½æ¸¸å®¢è·Ÿåœ¨é¦™æ¸¯å·¥ä½œçš„å¤–å›½äººï¼Œè®©æˆ‘æ„Ÿè§‰åˆ°äº†ä¸€ç§å›½é™…åŒ–çš„æ°›å›´ã€‚è‡³äºåŸå¸‚çš„ç¹åç¨‹åº¦ï¼Œè·Ÿæ·±åœ³å„æœ‰åƒç§‹ã€‚ ","date":"2024-05-21","objectID":"/posts/hong-kong-travel-notes-in-2024/:2:0","series":["å¾’æ­¥æ—…è¡Œ"],"tags":["Travel","æ—…æ¸¸","Backpacking","é‡è£…å¾’æ­¥","Hiking","å¾’æ­¥","Hong Kong","é¦™æ¸¯","MacLehose Trail","éº¦ç†æµ©å¾„"],"title":"2024 å¹´é¦™æ¸¯å¾’æ­¥æ—…è¡Œè®°å½•ï¼ˆä¸€ï¼‰","uri":"/posts/hong-kong-travel-notes-in-2024/#ä¸€ä»ç»´å¤šåˆ©äºšæ¸¯åˆ°åšå°¼åœ°åŸ"},{"categories":["life"],"content":" äºŒã€éº¦ç†æµ©å¾„ç¬¬ä¸€äºŒæ®µ æˆ‘çš„è·¯çº¿ï¼ˆæŠ„äº†è¿‘è·¯ï¼‰ - Google Earth Map é£Ÿé«“çŸ¥å‘³ï¼Œåœ¨é¦™æ¸¯æµ·è¾¹å¾’æ­¥ä¸€æ—¥åï¼Œæˆ‘å¯¹é¦™æ¸¯å¾’æ­¥æ¥äº†å…´è¶£ï¼Œä¸€ç›´ç…ç€æœºä¼šå†æ¥ä¸€æ¬¡ã€‚ åˆ°äº†äº”ä¸€å‡æœŸï¼Œæˆ‘ç»ˆäºæœ‰äº†æœºä¼šï¼Œéšä¾¿åœ¨å°çº¢ä¹¦ä¸ŠæŸ¥äº†äº›èµ„æ–™ï¼Œå‘ç°éº¦ç†æµ©å¾„ä¸€äºŒæ®µæŒºæœ‰åï¼Œè¿˜èƒ½éœ²è¥ï¼Œäºæ˜¯å°±å†³å®šæ˜¯å®ƒäº†ã€‚ çœ‹å¤©æ°”é¢„æŠ¥æœ€è¿‘å‡ å¤©éƒ½æœ‰é›¨ï¼Œäº”ä¸€é‚£å¤©ä¸‹å¾—æ¯”è¾ƒå¤§æ²¡å‡ºé—¨ï¼Œé¡ºä¾¿å°±ä¹°äº†è¿ªå¡ä¾¬å†²é”‹è¡£ã€å†²é”‹è£¤ã€é€Ÿå¹² T æ¤ã€å¤§å·æ°´æ¯ï¼Œæƒ³ç€æ˜å¤©å°±ç®—æœ‰é›¨ä¹Ÿè¦å»ã€‚ å¹¸è€Œå¤©å…¬ä½œç¾ï¼Œç¬¬äºŒå¤©å¤©æ°”è½¬é˜´ï¼Œä¸Šåˆä¸œè¥¿åˆ°è´§ï¼Œåˆåšäº†å¤§åŠå¤©å‡†å¤‡æ‰å‡ºé—¨ã€‚å› ä¸ºè®¡åˆ’æ˜¯è¿ç»­æ­¥è¡Œä¸¤å¤©ï¼Œæ‰€ä»¥è·Ÿç€å°çº¢ä¹¦ä¸Šçš„é¦™æ¸¯æ—…æ¸¸æ”»ç•¥ï¼Œåƒçš„ç©¿çš„ç”¨çš„éƒ½å¸¦äº†æŒºå¤šã€‚ ä¸‹åˆå‡ºå¢ƒï¼Œé¦–å…ˆä¹°äº† OPPO 9.9 å…ƒçš„é¦™æ¸¯æµé‡åŒ…ï¼ˆäº”ä¸€ç‰¹æƒ ï¼‰ï¼Œç„¶åååœ°é“åˆ°æ·±æ°´åŸ—ï¼ˆbÃ¹ï¼‰åœ°é“ç«™æ•´äº†å¼ å…«è¾¾é€šï¼Œ200 æ¸¯å¸ï¼Œå…¶ä¸­ 50 å—æŠ¼é‡‘ã€‚å¦å¤–è€ƒè™‘åˆ°ä»¥åä¼šå¸¸å»é¦™æ¸¯ï¼Œåˆå¤šå……äº† 100 å—ã€‚ é¦™æ¸¯åœ°é“ æ·±æ°´åŸ—ï¼ˆåŒåŸ ï¼‰åŠå…«è¾¾é€šå®ä½“å¡ï¼Œå› ä¸ºè®¡åˆ’å¸¸æ¥é¦™æ¸¯ç© æ¥ç€å°±æ˜¯å„ç§åœ°å›¾å¯¼èˆªï¼Œé¦–å…ˆåå°å·´åˆ°è¥¿è´¡ç å¤´ï¼Œç„¶åæŸ¥åŠå¤©å¯¼èˆªï¼Œåä¹å·´ 94 è·¯åˆ°éº¦ç†æµ©å¾„èµ·ç‚¹ã€‚ å°å·´è¦å«åœè½¦æ‰åœï¼ŒçœŸçš„ I äººï¼ˆå†…å‘ï¼‰å¤©æ•Œï¼Œå†³å®šä»¥åå°½é‡é€‰ä¹å·´ï¼Œä¸‹ä¸€ç«™å‰æŒ‰ä¸ª Stop ï¼ˆé¦™æ¸¯äººç§°æ€é’Ÿï¼‰è¿™ç§æ‰é€‚åˆ I äººã€‚ ä¹˜å°å·´åˆ°è¾¾è¥¿è´¡ ä¹˜ä¸Šä¹å·´ 94 è·¯å»å¾€éº¦ç†æµ©å¾„èµ·ç‚¹ è·¯è¾¹æµ·æ¹¾ å¯¼èˆªæœ¬æ¥æ˜¯è¯´ååˆ°éº¦ç†æµ©å¤«äººåº¦å‡æ‘ç«™ï¼Œä½†æˆ‘ä¸€ä¸‹æ²¡æ³¨æ„å°±åè¿‡äº†ï¼Œç„¶åä¸‹è½¦æ—¶ç¬¬ä¸€æ¬¡ã€Œæ€é’Ÿã€ä¸ç†Ÿæ‚‰ï¼Œåˆè¿‡äº†ä¸€ç«™æ‰æŒ‰åˆ° Stopï¼Œç»“æœå°±æ˜¯åœ¨ã€ŒåŒ—æ½­å‡¹ç®¡ç†ç«™ã€æ‰ä¸‹è½¦ï¼ˆ16:34ï¼‰ï¼Œç„¶åå¾€å›èµ°äº†åŠä¸ªå°æ—¶æ‰åˆ°ã€Œéº¦ç†æµ©å¾„èµ·ç‚¹ã€ï¼ˆ17:09ï¼‰ã€‚ åè¿‡äº†ç«™ï¼Œåœ¨åŒ—æ½­å‡¹ç®¡ç†å¤„ä¸‹è½¦ è·¯ä¸Šå‡ ä¹æ²¡äººï¼Œé£æ™¯å¾ˆå¥½ï¼Œå¾ˆå®‰é™ éº¦ç†æµ©å¤«äººæ¸¡å‡æ‘ å¤šèµ°äº†åŠä¸ªå°æ—¶å…¬è·¯æ‰åˆ°è¾¾éº¦å¾„èµ·ç‚¹ï¼Œè·¯ä¸Šä½“éªŒå¾ˆå¥½ï¼Œä¸»è¦æ˜¯è¿œç¦»åŸå¸‚ï¼Œå¾ˆå®‰é™ ä»ã€Œéº¦ç†æµ©å¾„èµ·ç‚¹ã€å¾€ä¸‡å®œæ°´åº“çš„è·¯ä¸Šï¼ˆå¤§ç½‘ä»”è·¯ï¼‰çœ‹åˆ°å¾ˆå¤šå‡ºç§Ÿè½¦æ¥æ¥å¾€å¾€ï¼Œè”æƒ³åˆ°ä¹‹å‰æŸ¥çš„æ”»ç•¥ï¼Œ å°±çŸ¥é“è¿™äº›å‡ºç§Ÿè½¦æ˜¯ä¸ºäº†æ¥é€å¾’æ­¥çš„äººã€‚æˆ‘æ˜¯å•äººå¾’æ­¥ï¼Œä¸ºäº†çœ 150 çš„æ‰“è½¦è´¹ï¼Œå°±é€‰æ‹©äº†åä¹å·´åˆ°èµ·ç‚¹ç„¶åæ­¥è¡Œã€‚ è·¯ä¸Šæ ‡ç‰Œ è·¯ä¸Šå¾ˆå¤šçƒ§çƒ¤ç‚¹ï¼Œè²Œä¼¼æ˜¯æ”¿åºœä¿®å»ºçš„ï¼Œå¯ä»¥å…è´¹ç”¨ï¼Œä½†æ²¡é‡åˆ°è¿‡äººåœ¨ç”¨è¿™äº›çƒ§çƒ¤ç‚¹ï¼Œå¯èƒ½å­£èŠ‚æˆ–å¤©æ°”åŸå› ï¼Ÿ åˆ°è¾¾ä¸‡å®œæ°´åº“å²”è·¯å£æ—¶å·²ç»æ˜¯ 17:26 äº†ï¼Œèµ°ç¬¬ä¸€æ®µæ™šä¸Šè‚¯å®šåˆ°ä¸äº†æˆ‘çš„ç›®æ ‡åœ°å€ã€Œå’¸ç”°æ¹¾ã€ï¼Œè€Œä¸”æˆ‘äº†è§£åˆ°çš„æ˜¯äºŒæ®µé£æ™¯æœ€å¥½ã€‚ä¸€ç•ªå¿ƒç†æ–—äº‰åï¼Œæˆ‘ç›´æ¥èµ°äº†å·¦è¾¹çš„è·¯çº¿ï¼Œç»•è¿‡éº¦å¾„ä¸€æ®µï¼Œç›´æ¥èµ°åˆ°è¥¿æ¹¾äº­èµ°äºŒæ®µçš„è·¯çº¿ã€‚ åˆ°è¾¾ä¸‡å®œæ°´åº“å²”è·¯å£ï¼Œå¾€å³æ˜¯æ­£ç»éº¦å¾„ï¼Œä¸è¿‡æ¯”è¾ƒæ™šäº†ï¼Œæˆ‘æŠ„è¿‘è·¯èµ°äº†å·¦è¾¹ã€‚ ä¸‡å®œæ°´åº“ ä¸€è·¯ä¸Šä¾æ—§é‡ä¸åˆ°äººï¼Œè¿œç¦»åŸå¸‚è·Ÿäººç¾¤çš„æ„Ÿè§‰å¾ˆå¥‡å¦™ é£æ™¯å¾ˆä¸é”™ ç…ä¸€çœ¼è·¯è¾¹åœ°å›¾çœ‹çœ‹æˆ‘åœ¨å“ª æŠ„è¿‘è·¯åˆ°è¾¾è¥¿æ¹¾äº­ï¼Œä»éº¦å¾„èµ·ç‚¹ç®—ç”¨äº†ä¸€ä¸ªåŠå°æ—¶ æ²¿ç€å¤§è·¯èµ°äº†æ•´æ•´ä¸€ä¸ªå°æ—¶æ‰åˆ°è¥¿æ¹¾äº­ï¼Œä¸ºäº†çœä¸ªå‡ºç§Ÿè½¦è´¹æˆ‘ä¹Ÿæ˜¯æ‹¼äº†ã€‚ä¸è¿‡å€’ä¹Ÿä¸ç®—äºï¼Œè¿™ä¸¤ä¸ªå°æ—¶çš„è·¯ä¸Šé£æ™¯ç›¸å½“ä¸é”™ï¼Œè€Œä¸”æ²¡é‡åˆ°å‡ ä¸ªäººï¼Œä½“éªŒéå¸¸æ£’ï¼æœ‰ç§æˆ‘å¾ˆå–œæ¬¢çš„å­¤ç‹¬æ„Ÿã€‚ è¿™æ—¶å·²ç»æ˜¯ 18:34ï¼Œå¤©è‰²å·²ç»å¿«é»‘äº†ï¼Œæˆ‘æœ‰ç‚¹æ…Œï¼Œåˆšå¥½æœ‰è¾†å‡ºç§Ÿé€äººåˆ°è¿™ï¼Œæˆ‘å‘å¸æœºé—®è·¯ï¼Œä»–å¥½å¿ƒåœ°å¸®æˆ‘æŒ‡äº†è·¯ã€‚ä»è¿™é‡Œå¼€å§‹æ‰æ˜¯å±±è·¯ï¼Œå‰é¢ä¸¤ä¸ªå°æ—¶ä¸€ç›´èµ°åœ¨å¤§é©¬è·¯ä¸Šï¼Œè€Œä¸”æˆ‘çš„è„šåœ¨èµ°äº†ä¸¤ä¸ªå°æ—¶åå·²ç»å¾ˆç—›äº†ã€‚ æ¥ç€å°±æ‰‹æœºæ‰“ç€ç¯ï¼Œä¸€ç›´èµ°åˆ° 19:10 æ‰åˆ°è¥¿æ¹¾æ‘ã€‚ èµ°å°è·¯ä¸‹å±±åˆ°è¥¿æ¹¾æ‘ èµ°åˆ° M30 æ ‡è·æŸ±ï¼ˆæ¯ 500 ç±³ä¸€ä¸ªï¼‰æ—¶å¤©å·²ç»é»‘äº† å¿«åˆ°è¥¿æ¹¾æ‘äº†ï¼Œè·¯è¾¹å¼€å§‹å‡ºç°è·¯ç¯ çœ‹åˆ°ç¬¬ä¸€ä¸ªç§Ÿå¸ç¯·çš„åº—ï¼Œç«‹é©¬å°±æ•´äº†å¥—å¸ç¯·ã€‚æŠ¼é‡‘ 300 ç§Ÿä¸€æ™š 200ï¼Œè·Ÿå›½å†…æ¯”å¯èƒ½å¾ˆè´µï¼Œä½†è·Ÿé¦™æ¸¯åŠ³åŠ¨èŠ‚æœŸé—´ 1300+ çš„æ—…é¦†æ¯”å·²ç»æ€§ä»·æ¯”çˆ†æ£šäº†ï¼ æˆ‘ä¹‹å‰çš„ç›®æ ‡æ˜¯åˆ°å’¸æ°´æ¹¾ç§Ÿå¸éœ²è¥ç¯·ï¼Œä½†åˆ°è¥¿æ¹¾æ‘çš„æ—¶å€™å¤©å·²ç»å®Œå…¨é»‘äº†ï¼Œè€Œä¸”ä¸€è·¯å¿ƒæƒŠèƒ†æˆ˜åœ°è¿ç»­èµ¶äº†ä¸‰ä¸ªå°æ—¶è·¯åæˆ‘ä¹Ÿç´¯å¾—ä¸è¡Œäº†ï¼Œåœ¨å¾€è¥¿æ¹¾æ‘çš„è·¯ä¸Šæˆ‘å°±ä¸€ç›´æ†§æ†¬ç€è¥¿æ¹¾æ‘æ€»è¯¥èƒ½æ‰¾åˆ°åœ°æ–¹ä½ï¼Œä¸‡å¹¸å®ƒæ²¡è®©æˆ‘å¤±æœ›ã€‚ ç»ˆäºåˆ°äº†ï¼Œç§Ÿäº†ä¸ªå¸ç¯·éœ²è¥ï¼Œ200 æ¸¯å¸ä¸€æ™šï¼Œå› ä¸ºæ¸¯å¸ä¸å¤Ÿä»˜äº†äººæ°‘å¸ æˆ‘çš„å¸ç¯· æœ¬æ¥æƒ³åƒå£çƒ­ä¹çš„ï¼Œä½†çœ‹åˆ°åº—é‡Œ 55 æ¸¯å¸èµ·æ­¥çš„é¢é£Ÿï¼Œæˆ‘è¿˜æ˜¯å†³å®šåƒç‚¹è‡ªå·±çš„èƒ½é‡æ£’å½“æ™šé¤ã€‚ æ´—æ¾¡æ”¶è´¹ 30ï¼Œä½†äººå¤ªå¤šäº†ï¼Œæˆ‘å°±æ²¡æ´—ã€‚æ™šä¸Šæµ·æµªå£°ã€æ—è¾¹å¸ç¯·é‡Œäººçš„è¯´è¯å£°ç­‰ï¼Œç¯å¢ƒå˜åŒ–å¤ªå¤§ï¼Œç¡ä¸ç€ï¼Œå°è¯´çœ‹åˆ°å‡Œæ™¨ä¸‰ç‚¹ï¼Œç„¶åè·‘å»æµ·æ»©ä¸Šå¬äº†å¬æµ·æµªå£°ï¼Œå›æ¥çš„è·¯ä¸Šä¸€è·¯è¢«æ‘æ°‘å®¶çš„ç‹—ç‹‚å ï¼ŒæƒŠå‡ºæˆ‘ä¸€å£°å†·æ±—ï¼Œä¸‡å¹¸æˆ‘è¿˜æ‡‚ç‚¹è¿™ç§åœºé¢çš„å¤„ç†æ–¹å¼ï¼Œç›¯ç€ç‹—çœ‹ï¼Œæ…¢æ…¢åé€€ã€‚å³ä½¿èµ°å¾—è¿œäº†ï¼Œæˆ‘è¿˜æ˜¯ä¸€æ­¥ä¸‰å›å¤´ï¼Œç½®åˆ°å›åˆ°è¥åœ°æŠŠé—¨å…³ä¸Šæ‰æ¾äº†ä¸€å£æ°”ã€‚å¹¶ä¸”æ˜ç™½ä¸€ä¸ªé“ç† â€”â€” æ™šä¸Šè¿˜æ˜¯ä¸è¦è¿™ä¹ˆè·³è„±çš„å¥½â€¦ è¥¿æ¹¾æ‘æ‰‹æœºä¿¡å·æŒºå¥½ï¼Œä½†ç”¨çš„äººå¤ªå¤šå¸¦å®½ä¸å¤Ÿï¼Œå¾ˆå¤šç«™ç‚¹æ€ä¹ˆåˆ·éƒ½åˆ·ä¸å‡ºæ¥â€¦ æƒ³èµ· 21 å¹´çœ‹è¿‡çš„ã€Šèµ°å‡ºè’é‡ã€‹ï¼Œè®²çš„æ˜¯é€šè¿‡å¾’æ­¥è‡ªæˆ‘æ•‘èµçš„æ•…äº‹ï¼Œæ‰“ç®—ç¿»å‡ºæ¥è¯»ä¸€è¯»ä½†ç½‘ç»œé—®é¢˜æ ¹æœ¬åˆ·ä¸å‡ºæ¥ã€‚ ç„¶åè¿·ç³Šç¡åˆ°äº†æ—©ä¸Š 7 ç‚¹ï¼Œå‡ºå¸ç¯·å‘ç°æˆ‘è¿™ä¸ªè¥åœ°äººéƒ½èµ°å·®ä¸å¤šäº†ã€‚æƒ³æ´—æ¼±ä½†æ„è¯†åˆ°æˆ‘å¸¦äº†ç‰™åˆ·å´æ²¡å¸¦ç‰™è†â€¦å› ä¸ºæœ€åˆæ˜¯æ‰“ç®—ä½æ—…é¦†çš„ï¼Œè° TM çŸ¥é“å±…ç„¶æ²¡æ‰¾åˆ°ä¸ªä¾¿å®œæ—…é¦†ï¼Œé¦™æ¸¯çš„ç‰©ä»·å¤ª TM ç¦»è°±äº†ï¼Œ é€¼å¾—æˆ‘è¿å¤œèµ¶è·¯åˆ°è¿™é‡Œæ¥ä½å¸ç¯·ã€‚ å•æ‰€ä¹Ÿæ²¡ä¸Šï¼Œæ—©é¤çœ‹å¤ªè´µäº†ä¹Ÿæ²¡åƒï¼Œä¹°äº†ç“¶ 0.6L çš„æ°´ï¼ˆ20 æ¸¯å¸ï¼‰ï¼Œ07:24 ç›´æ¥å‡ºå‘äº†ï¼Œæ—©é¤ä»ç„¶æ˜¯èƒ½é‡æ£’é…æ°´ã€‚ ç¬¬äºŒå¤©ä¸€æ—©ä»è¥¿æ¹¾æ‘å‡ºå‘ã€‚ è¥¿æ¹¾æ‘å‡ºå‘ç‚¹ - M31 æ ‡è·æŸ± æ²¡èµ°å‡ æ­¥å°±çœ‹åˆ°äº†è¥¿æ¹¾è¥åœ°ï¼ŒåŸæ¥è¥¿æ¹¾æ‘è¿‡æ¥æ²¡å‡ æ­¥å°±æ˜¯è¥¿æ¹¾è¥åœ°ï¼Œåƒåœ¾å¥½å¤šâ€¦ è¥¿æ¹¾è¥åœ° è¥¿æ¹¾è¥åœ°è¿™æœ‰é»„è‰²æ ‡ç‰Œï¼Œå†™ç€é‡çŒªå‡ºæ²¡ã€‚æœ‹å‹ä¹Ÿæé†’è¿‡æˆ‘ï¼Œè¯´å®ƒä»¬ä¸å’¬äººï¼Œä½†å¦‚æœä½ åŒ…é‡Œæœ‰åƒçš„ï¼Œå®ƒä»¬ä¼šå¼„åä½ çš„åŒ…ã€‚ è¿‡äº†è¥¿æ¹¾è¥åœ°åˆå¼€å§‹çˆ¬å±±ã€‚ è¿‡äº†è¥¿æ¹¾è¥åœ°å¼€å§‹ä¸Šå±±ï¼Œè¿™å¼ å›¾æ¼‚äº® å›æœ›è¥¿æ¹¾è¥åœ° å±±ä¸Šæµ·æ™¯ç‹¬å¥½ 07:58 åˆ°è¾¾æˆ‘å°è±¡ä¸­å…¨ç¨‹é£æ™¯æœ€èµçš„åœ°æ–¹ â€”â€” æ¥è¿‘å’¸ç”°æ¹¾æ²™æ»©çš„ä¸€æ®µæ­¥é“ã€‚ è¿™ä¸€æ®µé£æ™¯ç»èµï¼Œå…¨ç¨‹æœ€ä½³ï¼ è¿™æ®µå±±è·¯ä¹Ÿå¾ˆæœ‰å‘³é“ 08:15 åˆ°è¾¾å’¸ç”°æ¹¾æ²™æ»©ï¼Œè¿™é‡Œäººå¾ˆå¤šï¼Œå¸ç¯·ä¹Ÿå¾ˆå¤šã€‚ä»è¿™é‡Œå¼€å§‹æ¥ç€æ˜¯å¾€èµ¤å¾„å»ï¼Œé’»çš„å°±æ˜¯å±±è·¯äº†ï¼Œè¿™ä¸€æ®µä¸æ˜¯æµ·æ™¯ï¼Œä½†ä¹Ÿåˆ«æœ‰éŸµå‘³ã€‚ çœ‹åˆ°äº†å’¸ç”°æ¹¾ å’¸ç”°æ¹¾çš„ç‹¬æœ¨æ¡¥ 10:00 åˆ°è¾¾èµ¤å¾„ï¼Œè¿™ä¸€å¤„æ°´æ¹¾é£æ™¯ä¹Ÿå¾ˆç¾ï¼åœ¨è¿™é‡Œç©äº†å¾ˆä¹…ã€‚ åœ¨èµ¤å¾„ä¼‘æ¯ 10:30 åˆ°è¾¾èµ¤å¾„å…¬å•è§£å†³äº†ä¸‹ä¸ªäººå«ç”Ÿé—®é¢˜ã€‚æ„å¤–å‘ç°èµ¤å¾„å…¬å•ä¸ªåˆ«æ¶‚é¸¦å¾ˆå¯çˆ±ï¼éšæ‰‹ä¸€æ‹ã€‚ èµ¤å¾„å…¬å•çš„ç®€ç¬”ç”» æ¥ç€æ˜¯ä»èµ¤å¾„å¾€åŒ—æ½­å‡¹çš„è·¯ï¼ŒåŒæ ·æ˜¯èµ·èµ·ä¼ä¼ã€‚ ç»§ç»­å¾€åŒ—æ½­å‡¹èµ°ï¼Œå·¦ä¾§æŒ‡è·¯ç‰Œ è·¯ä¸Šé‡åˆ°ä¸€æ³¡æ’ç€é²œèŠ±çš„ç‰›ç²ªï¼Œå¾ˆæœ‰æ„æ€ï¼Œå‰é¢çš„å¥³ç”Ÿè¹²ä¸‹æ‹ç…§ï¼Œæå¾—æˆ‘å·®ç‚¹ä»¥ä¸ºèŠ±æ˜¯å¥¹æ’çš„â€¦ ä¸€è·¯ä¸Šå†æ€ä¹ˆé™¡å³­çš„æ­¥é“ä¸Šéƒ½èƒ½çœ‹å¾—åˆ°ç‰›ç²ªï¼ŒæŒºåŸç”Ÿæ€çš„å“ˆå“ˆã€‚ç”šè‡³å›å»è·¯ä¸Šåœ¨è¥¿è´¡ç å¤´æ±½è½¦ç«™éƒ½çœ‹åˆ°äº†ä¸¤å¤´ç‰›åœ¨ç»¿åŒ–å¸¦ä¸Šåƒè‰ã€‚ ä¸çŸ¥é“æ˜¯è°ï¼Œåœ¨ç‰›ç²ªä¸Šæ’é²œèŠ± emmm æ¥ç€ä¸€è·¯ä¸Šæ”€ï¼Œè„šè¸å·²ç»é…¸ç—›å¾—ä¸è¡Œï¼Œéå¸¸ç—›è‹¦ã€‚æœ‰ä¸€æ®µç´¯åˆ°ç›´æ¥ååœ¨åœ°ä¸Šçœ‹äº† 20 åˆ†é’Ÿã€Šèµ°å‡ºè’é‡ã€‹ã€‚ åˆ°è¾¾ M044 æŸ±å­ä¸Šçš„ç®€ç¬”ç”» 11:57 åˆ°è¾¾éº¦å¾„äºŒæ®µçš„ç»ˆç‚¹ï¼Œèµ°ä¸åŠ¨äº†ã€‚ åˆ°è¾¾ç»ˆç‚¹çš„å…¬å• ç»ˆç‚¹çš„æŒ‡ç¤ºç‰Œ åˆåä¹å·´ 94 è·¯å›è¥¿è´¡å¸‚åŒºï¼Œæ¥å»éƒ½æ˜¯è¿™è¶Ÿè½¦ï¼Œä»ã€ŒåŒ—æ½­å‡¹ç®¡ç†ç«™ã€ä¸‹è½¦åˆä»ã€ŒåŒ—æ½­å‡¹ã€ä¸Šè½¦ï¼Œå‡ ä¹æ˜¯å›´ç€è¿™ä¸€ç‰‡èµ°äº†åˆšå¥½ä¸€åœˆã€‚ åˆåä¹å·´ 94 è·¯å›è¥¿è´¡å¸‚åŒº 12:30 åˆ°è¥¿è´¡å¸‚åŒºï¼Œé¥¿å¾—ä¸è¡Œï¼Œæ‰¾ä¸€åœˆåƒé¥­çš„åœ°å„¿å‘ç°ï¼Œéº¦å½“åŠ³å±…ç„¶æ˜¯æœ€å®æƒ çš„â€”â€”å› ä¸ºå®ƒä»·æ ¼è·Ÿå›½å†…å·®ä¸å¤šã€‚äºæ˜¯æäº†ä¸€é¡¿éº¦å½“åŠ³ï¼Œå‘ç°å…¬å¸æœ‰ç‚¹äº‹ï¼Œå› ä¸ºä»Šå¤©æˆ‘ Oncallï¼Œé¡ºä¾¿æ‹¿å‡º MacBook å¤„ç†äº†ä¸‹å…¬å¸çš„äº‹ã€‚æ˜¯çš„æ²¡é”™ï¼Œæˆ‘èƒŒåŒ…é‡Œè¿˜æœ‰ä¸€å° 1.4kg çš„ MacBook Proï¼ŒçœŸæ˜¯è¦äº†è€å‘½ã€‚ åˆ°è¾¾å¸‚åŒºï¼Œé¥¿å¾—ä¸è¡Œåˆ°å¤„æ‰¾åƒçš„ å‘ç°éº¦å½“åŠ³æ˜¯æœ€å®æƒ çš„ï¼Œè·Ÿæ·±åœ³å·®ä¸å¤šä»·ã€‚é¡ºä¾¿å¤„ç†ä¸ª Oncall... ç´¯å¾—ä¸è¡Œï¼Œæ˜¨æ™šåˆæ²¡æ´—æ¾¡ï¼Œä¸€è·¯ä¸Šç–¯ç‹‚å‡ºæ±—ï¼Œæµ‘èº«æ°”å‘³æ¯”è¾ƒæ„Ÿäººã€‚åƒå®Œé¥­éšä¾¿é€›äº†é€›ï¼Œå°±æ‰“é“å›åºœäº†ã€‚ä»è¥¿è´¡åä¹å·´ 299x è·¯åˆ°æ²™ç”°ç«™ï¼Œç„¶åè½¬ä¹˜ä¸œé“çº¿åˆ°ç½—æ¹–å£å²¸ï¼Œå†åæ·±åœ³åœ°é“å›å®¶ã€‚ è¿™å®¶åº—è£…ä¿®æœ‰ç‚¹æ„æ€ ç†å‘åº—ï¼Œé¦™æ¸¯ç‰©ä»·... è¿™å‡ å®¶åº—é¢æ¯”è¾ƒæœ‰å¹´ä»£æ„Ÿ è¥¿è´¡ç å¤´ æ€»çš„æ¥è¯´ï¼Œé¦™æ¸¯è¥¿è´¡è¿™å—å¼€å‘å¾—æ›´å¥½ï¼Œæ­¥é“å¾ˆå¤šï¼ŒåŸç”Ÿæ€çš„åŒæ—¶è·¯çº¿ä¹Ÿè¶³å¤Ÿæˆç†Ÿï¼Œè€Œä¸”è¿‡æ¥æ¯”æ·±åœ³å¤§é¹åŠå²›æ›´æ–¹ä¾¿ï¼ŒæœŸå¾…ä¸‹æ¬¡å†æ¥ã€‚ æŸ¥æ”»ç•¥æœ€æœ‰ç”¨çš„å‡ ä¸ª APPï¼š Bilibili -é¦™æ¸¯éº¦ç†æµ©å¾„ ä¸€äºŒæ®µæœ€å…¨æ”»ç•¥ã€‚æ”¯çº¿ç ´è¾¹æ´²ï¼Œèšºè›‡å°–ä¸€å¹¶çŒ®ä¸Š - å‘ç°çš„æœ€è¯¦ç»†çš„æ”»ç•¥ï¼Œç›¸å½“ç”¨å¿ƒ å°çº¢ä¹¦ - è®¸å¤šæœ‰ç”¨çš„ä¿¡æ¯ ","date":"2024-05-21","objectID":"/posts/hong-kong-travel-notes-in-2024/:3:0","series":["å¾’æ­¥æ—…è¡Œ"],"tags":["Travel","æ—…æ¸¸","Backpacking","é‡è£…å¾’æ­¥","Hiking","å¾’æ­¥","Hong Kong","é¦™æ¸¯","MacLehose Trail","éº¦ç†æµ©å¾„"],"title":"2024 å¹´é¦™æ¸¯å¾’æ­¥æ—…è¡Œè®°å½•ï¼ˆä¸€ï¼‰","uri":"/posts/hong-kong-travel-notes-in-2024/#äºŒéº¦ç†æµ©å¾„ç¬¬ä¸€äºŒæ®µ"},{"categories":["life"],"content":" ä¸‰ã€éº¦ç†æµ©å¾„ç¬¬ä¸‰æ®µä¸Šæ¬¡å¾’æ­¥èµ°å®Œéº¦ç†æµ©å¾„äºŒæ®µåå°±æœ‰ç‚¹ä¸Šå¤´äº†ï¼Œåˆšå›åˆ°å®¶ç´¯å¾—ä¸è¡Œï¼Œè„šéƒ½è¦åºŸäº†ï¼Œä½†éš”å¤©è¿˜æƒ³æ‰¾ä¸ªæ­¥é“èµ°èµ°ã€‚å¦å¤–å°±æ˜¯è¿™ä¸¤æ¬¡å¾’æ­¥éƒ½å¤ªéšæ„ï¼Œç¼ºä¹ç™»å±±æ–ã€ç™»å±±é‹ã€èƒŒåŒ…ç­‰ä¸“ä¸šè£…å¤‡ï¼Œè€Œä¸”éœ²è¥è¿˜æ˜¯ç§Ÿçš„äººå®¶å¸ç¯·ï¼Œæ¥ç€å°±æ˜¯çœ‹å„ç§å¾’æ­¥æ•™ç¨‹æ”»ç•¥ï¼Œç–¯ç‹‚ä¹°ä¹°ä¹°ã€‚ ä¹°çš„ä¸€å †è£…å¤‡é™†ç»­åˆ°è´§ï¼Œåœ¨å®¶è¯•ç”¨äº†å¥½å‡ å¤©ï¼Œæ¯”å¦‚è¯´ç©¿ç™»å±±é‹ä¸Šç­ã€ç©ºè°ƒå¼€ 16 åº¦åœ¨å®¤å†…æ­å¸ç¯·éœ²è¥ã€åºŠä¸Šé“ºè›‹å·¢å«ç›–ç¡è¢‹ã€æ™šé¤åƒè‡ªçƒ­ç±³é¥­ï¼Œç­‰ç­‰ä¸ä¸€è€Œè¶³ emmm è¯•ç”¨éœ²è¥é”…å…·ã€ç‚‰å­ä»¥åŠé£Ÿç‰© è¯•ç”¨äº†å¥½å‡ å¤©å¸ç¯·ï¼ˆå®¤å†…éœ²è¥ emmmï¼‰ ç›®å‰çš„æ‰€æœ‰è£…å¤‡ï¼Œç®—ä¸Šæ²¡æ‹è¿›æ¥çš„è¡£ç‰©ï¼Œæ€»é‡é‡å¤§æ¦‚ 14kg æ¥ç€ 5 æœˆ 18 è·Ÿ 19 ä¸¤æ—¥åˆæ˜¯ä¸ªç©ºé—²çš„å‘¨æœ«ï¼Œè¿™æ¬¡åšè¶³äº†å‡†å¤‡ï¼Œè®¡åˆ’ä¸¤å¤©èµ°å®Œéº¦ç†æµ©å¾„ä¸‰å››æ®µã€‚ æ•´ç†èƒŒåŒ…æ—¶ï¼Œæ„è¯†åˆ°æ°”ç½å¾ˆéš¾å¤„ç†ï¼Œå¸¦ç€ä¸Šåœ°é“ã€è¿‡æµ·å…³ï¼Œæ„Ÿè§‰éƒ½ä¸å¤ªè¡Œï¼Œåœ¨é¦™æ¸¯æˆ‘ä¹Ÿä¸çŸ¥é“æ˜¯å¦å¥½ä¹°ï¼Œæ‰€ä»¥æŠŠé”…å…·è·Ÿç‚‰å­éƒ½è¸¢å‡ºäº†èƒŒåŒ…ï¼Œåªå¸¦äº†ä¸¤ç›’æµ·åº•æè‡ªçƒ­ç±³é¥­è·Ÿä¸€äº›èƒ½é‡èƒ¶ã€å‹ç¼©é¥¼å¹²ä»¥åŠé›¶é£Ÿã€‚å¦å¤–æ°´å¸¦å¾—ç›¸å½“å……è¶³ï¼Œ3L æ°´è¢‹ + 600ml å°æ°´æ¯ï¼Œå…‰æ°´å°±æœ‰ 3.6kg. å¤§çº¦ 9 ç‚¹å¤šå‡ºå‘ï¼Œé¦–å…ˆæ˜¯ä¹˜ä¸œé“çº¿åˆ°æ²™ç”°ç«™ï¼Œè½¬ç¨‹ä¹å·´ 299x è·¯åˆ°éº¦è¾¹ç«™ï¼Œå†è½¬ä¹˜ 94 è·¯åˆ°éº¦å¾„ä¸‰æ®µçš„èµ·ç‚¹ã€‚ éº¦è¾¹ç«™ç­‰ä¹å·´ 94 è·¯ åœ¨äºŒæ®µç»ˆç‚¹è§£å†³å®Œä¸ªäººå«ç”Ÿé—®é¢˜ï¼Œçƒ­äº†ä¸ªèº«ï¼Œé¡ºä¾¿å¸®ä¸€æ‰¹åç©¿éº¦å¾„äºŒæ®µçš„å¤§é™†äººåˆäº†ä¸ªå½±ï¼Œæ¥ç€å°±å¼€å§‹ä¸Šå±±ã€‚ ä¸‰æ®µä¸€å¼€å§‹å°±æ˜¯æ€¥æ”€ï¼Œè·¯é¢å¾ˆé™¡ï¼Œè€Œä¸”é€éœ²ç€ä¸€è‚¡å¹´ä¹…å¤±ä¿®çš„å‘³é“ï¼Œè·¯å†µæ¯”ä¸€äºŒæ®µå·®è¿œäº†ã€‚ éº¦å¾„ä¸‰æ®µ-å¼€å¤´çš„æ€¥æ”€è·¯æ®µ ä¸‰æ®µçš„äººæµé‡ç›¸æ¯”äºŒæ®µé‚£æ˜¯æ–­å´–å¼ä¸‹é™ï¼Œå‡ ä¹ä¾å±±é‡ä¸åˆ°äººï¼Œæœ‰ä¸€ç§è¿œç¦»äººä¸–çš„å­¤ç‹¬æ„Ÿã€‚æœ‰çš„äººå¯èƒ½ä¼šå–œæ¬¢çƒ­é—¹ï¼Œä½†æˆ‘æ°æ°ç›¸åï¼Œç›¸å½“äº«å—è¿™ç§å­¤ç‹¬æ„Ÿã€‚ ä¸Šå‡å¤ªå¿«ï¼Œæˆ‘åˆè´Ÿé‡ 17 å…¬æ–¤ï¼Œæ²¡çˆ¬å‡ æ­¥å°±ç´¯åˆ°è¦ä¼‘æ¯ï¼Œç”šè‡³æœ‰ç‚¹æ€€ç–‘ä»Šå¤©èƒ½ä¸èƒ½èµ°å®Œä¸‰æ®µã€‚ä½†è¾›è‹¦å¸¦æ¥çš„æ”¶è·ä¹ŸæŒºå¤§ï¼Œè¶Šå¾€ä¸Šçˆ¬ï¼Œé£æ™¯è¶Šç¾ï¼Œå±±æ™¯ä¸æµ·æ™¯äº¤ç›¸è¾‰æ˜ ï¼Œè®©äººå¿ƒæ—·ç¥æ€¡ã€‚ é£æ™¯å¾ˆä¸é”™ å±±è·¯ å±±è·¯ä¸Šç¾ç¾è‡ªæ‹ ç»§ç»­æ€¥æ”€ åœ¨å±±é¡¶è¿˜è§£é”äº†ä¸€äº›éšè—æ”¯çº¿ï¼Œå› ä¸ºèµ°çš„äººå°‘ï¼ŒçŒæœ¨ä¸›èŒ‚ç››ï¼Œç™»å±±æ–å‡ ä¹æ²¡æ³•ç”¨ï¼Œè¿™æ—¶å€™å°±å¾ˆåº†å¹¸æˆ‘ç©¿äº†é•¿è¢–ç´§èº«è¿åŠ¨æ‰“åº•è¡£è£¤ï¼Œä¸ç„¶èµ°è¿™ç§è·¯å°è…¿éš¾å…æŒ‚å½©ã€‚ æ¥ç€å°±æ˜¯ä¸‹é™ã€‚ å¼€å§‹ä¸‹é™ å±±æ°´å…±é•¿å¤©ä¸€è‰² Me - å‘ç°çœ¼é•œç¡®å®å˜è‰²äº†æ¬¸ ä¸‹é™è·¯æ®µèµ°å®Œï¼Œåˆ°è¾¾å¶‚ä¸Šè¥åœ°è·Ÿå£«å¤šåº—ã€‚ è¿™é‡Œå†å¾€å‰å°±æ˜¯éšœä¸Šå£«å¤šåº— éº¦å¾„è·¯æ ‡ - M61 åˆå¼€å§‹ä¸Šå‡ï¼Œä¸è¿‡è·Ÿä¸‰æ®µèµ·å§‹çš„é‚£æ®µæ¯”èµ·æ¥ï¼Œè¿™æ®µè·¯è¿˜ç®—å¹³ç¼“ã€‚æ¥ç€æˆ‘é«˜å…´æ²¡å¤šä¹…ï¼Œå°±åˆ°äº†ä¸€æ®µç›¸å½“é™¡å³­ï¼Œå‡ ä¹æ²¡æœ‰å°é˜¶çš„è·¯æ®µã€‚ ä¸Šå‡ï¼Œæ²¡æœ‰å°é˜¶çš„é™¡å¡ ä¸€å°æ®µå¹³è·¯ åä¸‹ä¼‘æ¯ä¸€ä¼šå„¿ï¼Œé¡ºä¾¿è‡ªæ‹ä¸€ä¸ª åˆäºŒåå¤šåˆ†é’Ÿåï¼Œç´¯å¾—ä¸è¡Œï¼Œå¯»ä¸ªåœ°åä¸‹ï¼Œé¡ºä¾¿å›å¤´çœ‹çœ‹ã€‚ å›æœ› ç»§ç»­èµ°ï¼Œæ²¡å¤šä¹…å°±åˆ°äº† 17 ç‚¹ï¼Œå¤©å¼€å§‹é»‘äº†ï¼Œæˆ‘ä¹Ÿæå‰ç¿»å‡ºäº†å¤´ç¯å‡†å¤‡ç€éšæ—¶æ‰“å¼€ã€‚ ç»§ç»­èµ° æ™šä¸Š 7 ç‚¹ï¼Œå¤©å¼€å§‹é»‘äº† åˆ°è¾¾å±±é¡¶ï¼Œå·²ç»æ‰“å¼€äº†å¤´ç¯ å±±é¡¶ç»§ç»­å‰è¡Œï¼Œè¿œæ–¹åŸå¸‚ç¯ç«é€šæ˜ é‡åˆ°çš„è½»è£…å¤œçˆ¬å›¢ï¼Œåº”è¯¥æ˜¯é¦™æ¸¯å­¦ç”Ÿï¼Œè€Œé‡è£…å¾’æ­¥çš„æˆ‘å·²ç»ç²¾ç–²åŠ›ç«­ï¼Œä¸€é˜¶é˜¶æ¥¼æ¢¯åœ°è¹’è·šä¸‹é™ï¼Œè¢«å¾ˆå¿«è¶…è¶Š åˆ°è¾¾ M68ï¼Œç¦»ä¸‰æ®µç»ˆç‚¹è¿‘äº†ï¼Œå…¨èº«æ— ä¸€å¤„ä¸ç–¼ï¼ŒçœŸçœŸæ˜¯è¡Œç™¾é‡Œè€…åŠä¹åï¼Œæœ€åè¿™ä¸€å…¬é‡Œè·¯ç›¸å½“æŠ˜ç£¨äºº åˆ°è¾¾ä¸‰æ®µç»ˆç‚¹ï¼Œæ¥æ°´ã€è‡ªçƒ­ç±³é¥­å½“æ™šé¤ï¼Œä¼‘æ¯äº†ä¸€ä¸ªå¤šå°æ—¶ã€‚ å¾ˆæƒ³ç›´æ¥å›å®¶ï¼Œä½†å¯¼èˆªå‘ç°æ°´æµªçªè¥åœ°åªå·® 500 ç±³äº†ï¼Œå†…å¿ƒå¤©äººäº¤æˆ˜åç»§ç»­å¾€è¥åœ°è¿›å‘ ç»§ç»­å¤œè¡Œ è·¯æ ‡ 500 ç±³èµ°äº†æˆ‘ 25 åˆ†é’Ÿï¼Œä¸­é—´è¿˜æœ‰ä¸€æ®µé™¡å¡ åˆ°è¾¾è¥åœ°å¼€å§‹æ­å¸ç¯·ï¼Œè¥åœ°å¾ˆç©ºæ—·ï¼Œåªæœ‰æˆ‘è·Ÿå¦ä¸€ä¼™äººéœ²è¥ã€‚ 18 å·è¿™ä¸€å¤©ä¸‹æ¥ä¸€å…±èµ°äº† 33582 æ­¥ï¼Œè€Œä¸”èƒŒç€åä¸ƒå…«å…¬æ–¤çˆ¬ä¸Šçˆ¬ä¸‹ï¼Œæœ€åä¸¤ä¸‰å…¬é‡Œå®Œå…¨æ˜¯å’¬ç€ç‰™æ‹¼å‘½çˆ¬çš„ã€‚ æ…¢ååæ­å¸ç¯·ï¼ŒèŠ±äº†åŠå°æ—¶æ‰æå®š ç¬¬äºŒæ—¥æ—©ä¸Š 6 ç‚¹é†’æ¥ 7 ç‚¹å¤šï¼Œåœ¨æµåŠ¨å•æ‰€è§£å†³å®Œå«ç”Ÿé—®é¢˜ï¼Œåœ¨è¥åœ°é€›äº†ä¸€åœˆæ²¡æ‰¾åˆ°æ°´æºï¼Œåªå¥½æ‹¿æŠ˜å æ°´æ¡¶åœ¨æµåŠ¨å•æ‰€çš„æ´—æ‰‹æ± æ¥äº†ç‚¹æ°´æ´—è„¸é¡ºä¾¿æ“¦èº«ä½“ã€‚ éšå¤„èµ°èµ°ï¼Œå‘ç°è¥åœ°æ ‡ç‰Œ æ—©é¤éšä¾¿åƒäº†ç‚¹ä¸œè¥¿ï¼Œæ¥ç€å°±æ”¶æ‹¾å¸ç¯·æ‰“ç®—å›å®¶ï¼Œå‘ç°æ”¶æ‹¾èµ·æ¥è¿˜æŒºè´¹åŠ²ï¼Œæ…¢æ…¢ååå¼„äº†ä¹Ÿå¤§æ¦‚ 40 åˆ†é’Ÿï¼Œè€Œä¸”å‘ç°è›‹å·¢å«ä¸‹é¢æœ‰è·Ÿæ¯›æ¯›è™«ï¼Œå¸ç¯·å†…è¿˜æœ‰å¥½å‡ åªèš‚èšï¼Œè¿˜å‘ç°ä¸€åªè·³èš¤ï¼Œå¦å¤–å†…å¸å¤–é¢ä¹Ÿçˆ¬äº†æ ¹çœ‹ç€å°±å¾ˆæ¯’çš„æ¯›æ¯›è™«â€¦ è›‹å·¢å«ä¸‹çš„æ¯›æ¯›è™«ã€å¸ç¯·å†…çš„è·³èš¤å¤§æ¦‚æ˜¯æ˜¨æ™šæ­å¸ç¯·æ—¶ï¼ŒæŠŠä¸œè¥¿æ”¾åœ¨ä¸€ä¸ªçŸ³å¢©ä¸Šï¼Œä»çŸ³å¢©ä¸Šçˆ¬ä¸Šæ¥çš„ï¼Œ èš‚èšå¯èƒ½æ˜¯ä»å†…å¸çš„å­”æ´çˆ¬è¿›æ¥çš„ã€‚æ€»ä¹‹å®ƒä»¬å“å¾—æˆ‘æ”¶æ‹¾ä¸œè¥¿çš„æ—¶å€™æ£€æŸ¥äº†ä¸€éåˆä¸€éï¼Œç”Ÿæ€•ç¢°åˆ°è™«å­æˆ–è€…æŠŠè™«å­æ”¶æ‹¾è¿›äº†è¡Œæä¸­ã€‚ å›å®¶è·¯ä¸Šï¼Œå–æ°´ç‚¹ åœ¨è½¦ç«™ç­‰è½¦ æ€»çš„æ¥è¯´ï¼Œè®¡åˆ’ä¸¤æ—¥éº¦ç†æµ©å¾„å¾’æ­¥ï¼Œå®é™…åª 18 å·èµ°å®Œéº¦å¾„ä¸‰æ®µå°±ç²¾ç–²åŠ›å°½äº†ï¼Œç¬¬äºŒæ—¥æ—©ä¸Šç›´æ¥æ‰“é“å›åºœã€‚ä»äºŒæ®µèµ·ç‚¹èµ°åˆ°ç»ˆç‚¹ï¼Œç”¨æ—¶ 12:45 - 20:30ï¼Œåœ¨äº¤ç•Œå¤„åƒæ™šé¥­ã€ä¼‘æ¯äº† 1 ä¸ªå°æ—¶ã€‚ä¹‹åä» 21:50 - 22:15 èµ°åˆ°æ°´æµªçªè¥åœ°ï¼Œåˆ° 22:50 æ‰æ­å¥½å¸ç¯·ã€‚è¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡é‡è£…å¾’æ­¥ï¼Œç§¯ç´¯äº†å®è´µçš„ç»éªŒï¼Œä¹Ÿå‘ç°äº†è®¸å¤šé—®é¢˜ï¼Œä¸‹æ¬¡å†å¾’æ­¥éº¦ç†æµ©å¾„è‚¯å®šèƒ½æ›´å¾—å¿ƒåº”æ‰‹äº†~ åªçˆ¬å®Œç¬¬ä¸‰æ®µå°±ç²¾ç–²åŠ›å°½ï¼Œæˆ‘åˆ†æäº†ä¸»è¦æœ‰è¿™å‡ ä¸ªåŸå› ï¼š ä½“åŠ›ä¸å¤Ÿï¼Œè¿˜éœ€è¦å¤šåŠ é”»ç‚¼ ç¬¬ä¸€æ¬¡é‡è£…å¾’æ­¥ï¼Œè£…å¤‡ä¸å¤Ÿç²¾ç‚¼ï¼Œä¸€å…±å¾—æœ‰åä¸ƒå…«å…¬æ–¤ï¼Œå…¶ä¸­æœ‰è®¸å¤šä¸œè¥¿å®Œå…¨æ²¡ç”¨ä¸Šã€‚ å¸¦äº†è¿‡å¤šé£Ÿç‰©ï¼Œå¯ä»¥æ›´ç²¾ç®€ã€‚ ","date":"2024-05-21","objectID":"/posts/hong-kong-travel-notes-in-2024/:4:0","series":["å¾’æ­¥æ—…è¡Œ"],"tags":["Travel","æ—…æ¸¸","Backpacking","é‡è£…å¾’æ­¥","Hiking","å¾’æ­¥","Hong Kong","é¦™æ¸¯","MacLehose Trail","éº¦ç†æµ©å¾„"],"title":"2024 å¹´é¦™æ¸¯å¾’æ­¥æ—…è¡Œè®°å½•ï¼ˆä¸€ï¼‰","uri":"/posts/hong-kong-travel-notes-in-2024/#ä¸‰éº¦ç†æµ©å¾„ç¬¬ä¸‰æ®µ"},{"categories":["life"],"content":" å››ã€éº¦ç†æµ©å¾„ç¬¬å››æ®µå¾’æ­¥å®Œç¬¬ä¸‰æ®µåï¼Œä¼‘æ¯æ²¡ä¸€å‘¨ï¼Œåˆæ˜¯å‘¨æœ«ï¼Œå‘¨äº”ä¸‹ç­åèµ¶ç´§è·‘å»ç»­ç­¾äº†é¦™æ¸¯ç­¾è¯ï¼Œç²¾ç®€äº†ä¸€ç•ªè£…å¤‡ï¼Œå‘¨å…­ä¸Šåˆå°±å†æ¬¡å‡ºå‘å¾’æ­¥ç¬¬å››æ®µäº†ã€‚ è¿™æ¬¡å‡ºå‘å‰æ ¹æ®ä¸Šæ¬¡çš„ç»éªŒç²¾ç®€äº†è£…å¤‡ï¼Œæ€»æ€»é‡åº”è¯¥è½»äº†å¤§æ¦‚ 1kgï¼Œä½†ä»æ—§æœ‰ 16kgã€‚ä¸»è¦å˜åŒ–ï¼š å»æ‰äº†æŠ˜å æ¡Œè·ŸæŠ˜å å‡³ï¼šä¸Šæ¬¡å¸¦äº†æ²¡ç”¨ä¸Šï¼Œåƒé¥­éƒ½æ˜¯åœ¨è¥åœ°æˆ–è€…çƒ§çƒ¤ç‚¹ï¼Œè·¯ä¸Šè¡¥å……èƒ½é‡éƒ½æ˜¯ç›´æ¥æ‹¿å‡ºé›¶é£Ÿæˆ–èƒ½é‡èƒ¶éšä¾¿å•ƒä¸¤å£ï¼Œéƒ½ç”¨ä¸ä¸Šå®ƒä»¬ã€‚ è‡ªçƒ­ç±³é¥­ä¹Ÿä»ä¸¤ç›’æ”¹æˆäº†ä¸€ç›’ï¼šå› ä¸ºè®¡åˆ’å°±å¾’æ­¥ä¸€å¤©ç„¶åéœ²è¥ï¼Œç¬¬äºŒå¤©å›å®¶ã€‚åªæ™šä¸Šä¼‘æ¯çš„æ—¶å€™æ¥é¡¿çƒ­ä¹çš„å°± OK äº†ã€‚ å››æ®µæ˜¯éº¦å¾„éš¾åº¦æœ€é«˜çš„ä¸€æ®µï¼Œè€Œä¸”ç»ˆç‚¹åŸºç»´å°”è¥åœ°ä¸æ¥å—ä¸ªäººé¢„çº¦ï¼Œåªæ¥å—å›¢ä½“é¢„çº¦ã€‚ä½†æˆ‘è¿˜æ˜¯æŠ±ç€ä¾¥å¹¸å¿ƒç†èƒŒç€é‡è£…èƒŒåŒ…å»äº†ï¼Œæƒ³ç€è·¯ä¸Šæ€»ä¸ä¼šåªæœ‰è¿™ä¸€ä¸ªè¥åœ°å§ï¼ˆåé¢çš„ç»å†è¯æ˜æˆ‘æœ‰ç‚¹é²è½äº†ï¼‰ã€‚ æ—©é¥­åƒå¾—é¥±é¥±çš„ï¼Œåˆæ´—äº†æ¾¡ã€ä¼‘æ¯äº†ä¼šå„¿æ¶ˆæ¶ˆé£Ÿï¼Œç„¶å 10 ç‚¹å·¦å³å°±ä»å®¶é‡Œå‡ºå‘äº†ã€‚ æ·±åœ³åœ°é“ä¸€å·çº¿ä¸Šï¼Œæˆ‘æ»´èƒŒåŒ… 12:13ï¼Œé¦™æ¸¯æ²™ç”°æ±½è½¦ç«™ï¼Œæ’é˜Ÿä¸Šä¹å·´ 299X è·¯ åˆ°è¾¾å¤§æµªçªç«™ï¼Œé£æ™¯å¾ˆå¥½ å»å¾€å››æ®µèµ·ç‚¹è·¯ä¸Šï¼Œç¾ç¾è‡ªæ‹ çƒ§çƒ¤ç‚¹ä¸æµ·æ¹¾ï¼Œä»¥åŠè¿œæ–¹çš„åŸå¸‚ èµ°äº†çº¦ååˆ†é’Ÿåˆ°è¾¾ä¸‰æ®µç»ˆç‚¹ï¼Œåœ¨è¿™é‡Œç”¨ç›´é¥®æ°´æœºå°† 3L æ°´è¢‹çŒæ»¡ï¼Œç„¶åå–å‡ºç™»å±±æ–å°±å‡ºå‘äº†ã€‚ é¦–å…ˆæ˜¯åˆ°è¾¾ä¸Šæ¬¡éœ²è¥è¿‡çš„æ°´æµªçªè¥åœ°ï¼Œç„¶åæ²¿ç€å¤§è·¯ç»§ç»­ä¸Šå±±ï¼Œè·¯ä¸Šæ²¡äººã€‚ å¼€å§‹ç™»å±±ä¸ä¹…ï¼Œå‘ç°èµ·é›¾äº† æ²¿å¤§è·¯åˆ°è¾¾å±±é¡¶åï¼Œæ˜¯æ²¿ç€é»„æ³¥å°è·¯ä¸‹å±±ã€‚è¿™ä¸¤å¤©ä¸‹é›¨ï¼Œè·¯é¢æ³¥æ³æ¹¿æ»‘ï¼Œæˆ‘åˆèƒŒç€ä¸ª 16kg çš„é‡è£…èƒŒåŒ…ï¼Œèµ°èµ·æ¥æœ‰ç‚¹éš¾åº¦ã€‚è¿˜å¥½æœ‰ç™»å±±æ–ï¼Œå€’ä¸ç”¨æ€•æ»‘å€’ã€‚ é»„æ³¥è·¯ï¼Œè¿™ä¸¤å¤©ä¸‹é›¨ï¼Œè·¯é¢æ¹¿æ»‘ï¼Œè¿˜å¥½æœ‰ç™»å±±æ– ç»†ç«¹æ— å²”è·¯å£ èµ°é»„æ³¥è·¯ä¸‹å®Œå±±ï¼Œæ¥ç€åˆæ˜¯æ²¿ç€çŸ³é˜¶è·¯å¼€å§‹ç™»å±±ï¼ŒçŸ³é˜¶ä¹Ÿæœ‰ç‚¹æ¹¿æ»‘ã€‚ çŸ³é˜¶ï¼Œè·¯é¢æ¹¿æ¶¦ ç™»å±±æ²¡å¤šä¹…ï¼Œå°±é‡åˆ°äº†é›¾æ°”ï¼Œæ¥ç€é›¾å°±è¶Šæ¥è¶Šæµ“ã€‚ ç™»å±±è·¯ä¸Šä¹Ÿå¼€å§‹æœ‰é›¾äº† è·Ÿå±±è·¯ä¸Šçš„é›¾æ¥ä¸ªåˆç…§ é›¾æ°”åŠ é‡ å› ä¸ºé›¾æ°”è·Ÿæ±—æ°´ï¼Œå¤´å‘å·²ç»æ¹¿äº† ä¸‹å®Œä¸€åº§å°å±±åˆå¼€å§‹ç™»å¦ä¸€åº§ï¼Œè·¯è¾¹å¥½å¤šæ£•å¶ åˆåˆ°è¾¾ä¸€åº§å±±é¡¶ï¼Œåœ¨è¿™é‡Œä¼‘æ¯äº†ä¸€é˜µå­ï¼Œåƒäº†ç‚¹ä¸œè¥¿ï¼Œæ¥ç€çªç„¶æƒ³åˆ°æˆ‘å‡ºå‘æ—¶æ²¡æ‹‰ä¼¸ï¼Œæƒ³ç€è¡¥æ•‘ä¸€ä¸‹ï¼Œ å°±åœ¨è¿™é‡Œåšäº†ä¸ªæ‹‰ä¼¸ã€‚ ä¸­é—´è¿˜é‡åˆ°ä½å¤–å›½å¥³å£«èƒŒç€ä¸ªå¾ˆå°çš„è·‘æ­¥èƒŒåŒ…çˆ¬ä¸Šæ¥ï¼Œä¹Ÿä¼‘æ¯äº†ä¸€ä¼šå„¿å–äº†å£æ°´ï¼Œå¾€å¦ä¸€è¾¹å»äº†ï¼Œå¾ˆå¿«æ¶ˆå¤±åœ¨äº†é›¾ä¸­ã€‚ åˆ°è¾¾å±±é¡¶ï¼Œé›¾ç›¸å½“çš„é‡ åœ¨å±±é¡¶ä¼‘æ¯äº†ä¸€ä¼šå„¿ï¼Œåƒäº†ç‚¹ä¸œè¥¿ å¥½é‡çš„é›¾å•Šï¼Œå•¥éƒ½çœ‹ä¸æ¸… ä¼‘æ¯å¥½äº†å¼€å§‹ä¸‹å±±ï¼Œæ²¡å¤šä¹…å°±åˆ°äº†å››æ®µé£æ™¯æœ€å¥½çš„ä¸€æ®µï¼Œå› ä¸ºæµ“é›¾æ²¡è¿œæ™¯çœ‹æ²¡ï¼Œå¦‚æœæ²¡é›¾è¿™é‡Œè§†é‡ä¼šæ˜¯å¾ˆå¼€é˜”çš„ã€‚ è¿™åº”è¯¥æ˜¯å››æ®µé£æ™¯æœ€å¥½çš„ä¸€æ®µ è·Ÿæµ“é›¾æ¥ä¸ªåˆç…§ ç»§ç»­å‰è¡Œï¼Œåˆ°è¾¾æ˜‚å¹³è¥åœ°ï¼Œè¿™é‡Œæ˜¯ä¸€å—å±±é¡¶å¹³åŸè‰åœ°ï¼Œæµ“é›¾ä¸‹ä¹Ÿæœ‰ç‚¹æ„å¢ƒã€‚èµ°ç€èµ°ç€æ—è¾¹é›¾ä¸­å‡ºæ¥ä¸€åªç‹—è·Ÿä¸€ä¸ªäººï¼Œè¯´èµ·æ¥è¿™è·¯çº¿ä¸ŠæŒºå¤šäººé›ç‹—çš„ï¼Œä»Šå¤©é‡åˆ°ä¸¤ä¸‰æ³¢äº†ã€‚ æ˜‚å¹³ï¼Œå±±é¡¶å¹³åŸè‰åœ° M88 æ ‡è·æŸ± å› ä¸ºé˜´å¤©ï¼Œä¸‹ç»†é›¨ï¼Œåˆè¿™ä¹ˆå¤§é›¾ï¼Œå¤©é»‘å¾—å¾ˆå¿«ï¼Œ17 ç‚¹åå¤©å°±æœ‰ç‚¹çœ‹ä¸æ¸…è·¯é¢äº†ï¼Œå¼€å§‹éœ€è¦ç¯å…‰ã€‚å¤´ç¯åœ¨åŒ…é‡Œæ‡’å¾—æ‹¿å‡ºæ¥ï¼Œå°±æŠŠèƒŒåŒ…èƒŒå¸¦ä¸Šçš„æ‰‹ç”µå¤¹åˆ°è…°é—´åˆ«ç€çš„ä¾¿æºåå«ä¸Šç…§äº®è·¯é¢ï¼Œè¿˜åˆ«è¯´ï¼Œæ•ˆæœä¸é”™ã€‚ 17:12 äº†ï¼Œèµ°æ ‘æ—è·¯å·²ç»éœ€è¦å€ŸåŠ©ç¯å…‰ 17:40ï¼Œå¤©é»‘å·®ä¸å¤šäº†ï¼Œå…ˆä¼‘æ¯ä¸€ä¼šå„¿ å¯èƒ½å› ä¸ºä¸‹é›¨ï¼Œè·¯ä¸ŠæŒºå¤šç™è›¤èŸ† åˆ° 20:10 å·¦å³ï¼Œç»ˆäºåˆ°è¾¾åŸºç»´å°”è¥åœ°ï¼Œå¬åˆ°äº†æœ‰äººå£°ï¼Œä¹Ÿçœ‹åˆ°äº†ç¯å…‰ã€‚ä¸€ç•ªè°ƒæŸ¥ç¡®è®¤äº†è·Ÿä¹‹å‰äº†è§£åˆ°çš„ä¸€æ ·ï¼Œè¿™é‡Œä¸æ¥å—ä¸ªäººéœ²è¥ã€‚åœ°å›¾ä¸Šå¾€å‰çœ‹ä¹Ÿæ²¡éœ²è¥ç‚¹ï¼Œæˆ‘æœ‰ç‚¹æ…Œäº†ï¼Œä½†æ€»ä¹‹å…ˆåˆ°å››æ®µç»ˆç‚¹ç§ç§å§ã€‚èµ°åˆ°ç»ˆç‚¹å‘ç°å°±æ˜¯åŸºç»´å°”è¥åœ°ä¸‹å±±çš„å¤§æ°´æ³¥è·¯é¢ï¼Œæ—¢ç„¶æœ‰å¤§è·¯ï¼Œé‚£å°±èƒ½æ²¿ç€å®ƒå›åˆ°åŸå¸‚ï¼Œè¿™æ ·æƒ³ç€ç»ˆäºæœ‰äº†ä¸€ç‚¹å®‰å…¨æ„Ÿã€‚ 20:27ï¼Œæ²¿ç€å¤§é©¬è·¯ä¸‹å±± ä¸‹äº†ä¸ªå±±å¡åå®åœ¨ç´¯å¾—ä¸è¡Œï¼ŒæŠŠä¾¿æºåå«ä¸€é“ºå°±åä¸‹ä¼‘æ¯äº†ï¼Œå°è¯•ç”¨é«˜å¾·åœ°å›¾å¯¼èˆªï¼Œä½†ä¿¡å·æœ‰ç‚¹å·®ï¼Œä¸€ç›´è½¬ä¸å‡ºæ¥ã€‚ ç„¶åä¸€è¾†è½¦ä»å±±ä¸‹å¼€ä¸Šæ¥ï¼Œçœ‹åˆ°æˆ‘ç˜«ååœ¨è·¯è¾¹ï¼Œåœä¸‹æ¥é—®æˆ‘è¦å»å“ªï¼Œäº†è§£æ¸…æ¥šæƒ…å†µååˆç»™æˆ‘æŒ‡è·¯ï¼Œè¿˜è¯´è¿™é‡Œå¾’æ­¥ä¸‹å»è¦ä¸€ä¸ªå¤šå°æ—¶ï¼Œè·¯ä¸Šæ²¡è·¯ç¯ï¼Œé—®æˆ‘è¡Œä¸è¡Œï¼Œè¦ä¸è¦ä»–é€æˆ‘å»è½¦ç«™ã€‚ æ‰‹æœºä¸€ç›´æ²¡ä¿¡å·ï¼Œæˆ‘ä¸€å¼€å§‹æ˜¯æœ‰ç‚¹å¿ƒåŠ¨çš„ï¼Œä½†ä¸æƒ³éº»çƒ¦åˆ«äººï¼Œåˆšå¥½æ‰‹æœºç»ˆäºåŠ è½½å‡ºäº†å¯¼èˆªï¼Œæˆ‘å¯¹ç…§äº†ä¸‹è·Ÿä»–æŒ‡çš„è·¯æ˜¯åŒä¸€ä¸ªæ–¹å‘ï¼Œå°±å©‰æ‹’äº†ä»–ï¼Œå¹¶ç»™ä»–å±•ç¤ºæˆ‘çš„æ‰‹ç”µç­’è¡¨ç¤ºæˆ‘ä¸æ‹…å¿ƒèµ°å¤œè·¯ã€‚ é«˜å¾·åœ°å›¾ç»™çš„æ•™æˆ‘å…ˆå¾’æ­¥åˆ°å¤§è€å±±éš§é“ç«™ä¹˜ä¹å·´ 74X è·¯è‡³å¹¿ç¦é‚¨ä¸‹è½¦ï¼Œå†æ­¥è¡Œåˆ°åœ°é“ç«™ä¹˜è½¦åˆ°ç½—æ¹–å£å²¸ã€‚ ä½†å®ƒç»™çš„å¾’æ­¥è·¯çº¿æœ‰å‘ï¼Œæˆ‘è·Ÿç€å¯¼èˆªè¶Šèµ°å°±è¶Šè’å‡‰ï¼Œå…¬è·¯è·¯é¢å¼€å‰ï¼Œé•¿æ»¡è’è‰ï¼Œæ¥ç€å°±ç›´æ¥æ²¡å…¬è·¯äº†ã€‚æˆ‘æ…Œäº†ï¼Œä»”ç»†ç¡®è®¤æ‰æ„è¯†åˆ°å®ƒæ•™æˆ‘å¾€è‰ä¸›é‡Œé’»ï¼Œä»”ç»†çœ‹è‰ä¸›é‡Œè¿˜çœŸæœ‰æ¡è·¯â€¦ ä½†è¿™æ¡å°è·¯æ˜¾ç„¶å·²ç»åŠè’åºŸï¼Œè‰æœ¨æ—ç«‹ï¼Œä¸ä»”ç»†çœ‹å‡ ä¹åˆ†è¾¨ä¸å‡ºè·¯çº¿ï¼Œè®©äººå¿ä¸ä½æ€€ç–‘è¿™æ¡è·¯çœŸçš„èƒ½èµ°å—ï¼Ÿä¸ä¼šèµ°åˆ°ä¸€åŠæˆæ–­å¤´è·¯å§ã€‚ è¿˜å¥½è¿™æ¡çŒæœ¨ä¸›è¿‘æœŸæœ‰äººèµ°è¿‡ï¼Œæ²¿é€”è‰æœ¨æœ‰æ˜æ˜¾è¢«äººè¶Ÿè¿‡ï¼Œæ²¿é€”çŒæœ¨ä¸Šå¶å°”è¿˜æ‰äº†å¾ˆå¹²å‡€æ˜¾çœ¼çš„é£˜å¸¦ï¼Œ æ˜æ˜¾æ‰æ‰ä¸Šå»æ²¡å¤šä¹…ï¼Œè¿™ç»™æˆ‘å¢åŠ äº†ä¸€ç‚¹å¯¹å®ƒçš„ä¿¡å¿ƒã€‚ é’»çŒæœ¨ä¸›ï¼Œä¸­é—´è¿˜è¿‡äº†æ¡æºªæµï¼Œæ¥ç€åˆæ˜¯ä¸Šå±±ï¼Œå¥½èµ°çš„å±±è·¯æ²¡èµ°å¤šè¿œï¼Œæ¥ç€åˆæ˜¯åœ¨å±±ä¸Šé’»æ›´æ·±çš„çŒæœ¨ä¸›ï¼Œæˆ‘è¶Šæ¥è¶Šæ…Œâ€”â€”è¿™çœŸçš„æ˜¯ä¸‹å±±çš„è·¯å—ï¼ŸåŒæ—¶æˆ‘ä¹Ÿæœ‰ç‚¹æ‹…å¿ƒè¢«çŒæœ¨é®æŒ¡çš„è·¯é¢ä¼šæœ‰è›‡ï¼Œä½†ç°åœ¨å·²ç»å¾ˆæ™šäº†ï¼Œä¸‹å±±å¿ƒåˆ‡çš„æˆ‘æ²¡æ—¶é—´é¡¾è™‘è¿™äº›ï¼Œä¸€è·¯æ€¥è¡Œã€‚ çŒæœ¨é’»äº†æ²¡å¤šä¹…å°±å¼€å§‹ä¸‹å±±è·¯ï¼Œè€Œä¸”èƒ½çœ‹åˆ°å±±ä¸‹æ˜äº®çš„é«˜é€Ÿå…¬è·¯è·ŸåŸå¸‚å¤œæ™¯äº†ï¼Œè¿™è®©æˆ‘æ”¾å¿ƒäº†ä¸€ç‚¹â€”â€”è‡³å°‘ç¡®å®æ˜¯åœ¨ä¸‹å±±æœåŸå¸‚é‡Œå»ã€‚ä½†è¿™ä¸‹å±±è·¯å¯ä¸å¥½èµ°ï¼Œå‡ ä¹æ˜¯é’»ç€çŒæœ¨ä¸›æ—èµ°ç›´çº¿ä¸‹é™ï¼Œè€Œä¸”æ˜¯åŸç”Ÿåœ°å½¢ï¼Œéå¸¸çš„é™¡ï¼Œå³ä½¿æœ‰ç™»å±±æ–çš„è¾…åŠ©ï¼Œä¹Ÿæ‘”äº†å¥½å¤šè·¤ï¼Œè¿˜å¥½è‰æœ¨çŒæœ¨æ¯”è¾ƒå¯†ï¼Œæœ‰æ•ˆå‡ç¼“äº†æ‘”å€’çš„å†²å‡»ï¼Œ ä¹Ÿé¿å…æˆ‘æ»šä¸‹å±±ã€‚ ä¸‹å±±è·¯æ²¡èµ°å¤šä¹…ï¼Œæˆ‘çªç„¶å‘ç°è…°åŒ…é‡Œçš„æ°´æ¯è·Ÿå¤¹ç€çš„æŠ˜å åå«éƒ½ä¸è§äº†ï¼Œæ˜¾ç„¶æ˜¯åœ¨å‰é¢å‡ æ¬¡æ‘”è·¤çš„æ—¶å€™æ‰äº†ï¼Œä¸è¿‡ä¹Ÿå°±ä¸‰å››åå—é’±ï¼Œä¸ç®¡äº†ï¼Œç»§ç»­å‘ä¸‹ã€‚ ä¸‹å±±è·¯ä»¿ä½›æ²¡æœ‰å°½å¤´ï¼Œä¸‡å¹¸é€”ä¸­å‘ç°åº•ä¸‹çš„å±±å³é‡Œæœ‰å¥½å‡ ç‰‡äº®å…‰ï¼Œä¸€å¼€å§‹æ€€ç–‘æ˜¯å±±é‡ŒåºŸå¼ƒçš„æˆ¿å­ï¼Œå‰é¢è¶Ÿè¿™æ¡è·¯çš„æ—…æ¸¸é˜Ÿåœ¨æˆ¿å­é‡Œéœ²è¥ï¼Œè¿™ä¹Ÿç»™äº†æˆ‘å¸Œæœ›â€”â€”æˆ–è®¸èƒ½æœ‰äººç»™ç‚¹å¸®åŠ©è·Ÿä¸€å£åƒçš„ï¼Œä¸€èµ·éœ²è¥ä¹Ÿä¸é”™ã€‚ åˆ°ä¹ç‚¹åŠå·¦å³ç»ˆäºä¸‹åˆ°å±±è„šçš„æ—¶å€™ï¼Œå‘ç°æ˜¯ä¸ªç”µç«™ä¹‹ç±»çš„å»ºç­‘ï¼Œå‘¨å›´è¿˜æœ‰ç›‘æ§è­¦ç¤ºï¼ŒæŒºå¤±æœ›çš„ã€‚ä¸è¿‡åˆ°è¿™é‡Œåˆæ˜¯å¤§è·¯äº†ï¼Œä¹Ÿèƒ½å¾ˆæ˜æ˜¾å¬åˆ°ä¸è¿œå¤„è½¦è¾†æ¥å¾€çš„å£°éŸ³ï¼Œæ‚¬ç€çš„å¿ƒæ€»ç®—æ”¾äº†ä¸‹æ¥ã€‚ è€ƒè™‘åˆ°æ‰‹è¡¨å¿«æ²¡ç”µäº†ï¼Œå…ˆæŠŠç™»å±±è®°å½•åœäº†ï¼Œæ˜¾ç¤ºä»Šå¤©å¾’æ­¥äº†æ¥è¿‘ 21 å…¬é‡Œï¼ŒçœŸæ˜¯ç´¯åˆ°å¤Ÿå‘›ã€‚ OPPO å¥åº· - æ—¥è¡Œå››ä¸‡æ­¥ ç™»å±± 21 å…¬é‡Œ åœ¨è·¯è¾¹æ‰¾äº†ä¸ªåœ°åç€ä¼‘æ¯ï¼Œæƒ³åˆ°å› ä¸ºé’»çŒæœ¨æ—ã€æ‘”è·¤ã€ä¸€è·¯å‰§çƒˆè¿åŠ¨ç–¯ç‹‚å‡ºæ±—ï¼ŒåŠ ä¹‹ä»Šå¤©åˆä¸‹å°é›¨ï¼Œèº«ä¸Šéƒ½æ˜¯å„ç§å°å¶å­ã€æœ¨æ£ã€æ±—æ°´ã€æ²¾äº†å¶å­ä¸Šçš„é›¨æ°´ï¼Œè¿™ä¸ªæ ·å­å¯ä¸å¥½ä¸Šè½¦è§äººã€‚è§å‘¨å›´ä¹Ÿæ²¡äººï¼Œæˆ‘ç›´æ¥æŠŠè¡£æœéƒ½è„±æ‰ï¼Œæ¢äº†èº«å¹²å‡€çš„ã€‚ ç™»å±±é‹é‡Œä¹Ÿæ¹¿é€äº†ï¼Œåˆšåˆšé’»æ—å­å¯¼è‡´çŸ³å­å¶å­å°æœ¨æ£é›¨æ°´ä¹Ÿè¿›å»äº†ä¸å°‘ï¼Œä¹Ÿæ¢äº†å¤‡ç”¨çš„æ²™æ»©é‹ã€‚æ¢é‹æ—¶ä¸çŸ¥é“å“ªè·‘å‡ºæ¥åªèš‚èŸ¥åœ¨æˆ‘è„šé¢ä¸Šçˆ¬ï¼Œèµ¶ç´§ç»™æ‹”æ‰ä¸¢äº†ï¼ˆä¹Ÿå¾ˆåº†å¹¸æˆ‘ä¸€ç›´ç©¿è¿åŠ¨ç´§èº«å†…è¡£è£¤ï¼Œä¸ç„¶è¿™ä¸€è¶ŸçŒæœ¨ä¸›å¾’æ­¥ä¸‹æ¥ï¼Œå°è…¿åˆ®ä¼¤ä¸è¯´ï¼Œè¿˜å¯èƒ½è¢«èš‚èŸ¥ç­‰å„ç§è™«å­å®å’¬ï¼‰ã€‚ è¡£æœé‹å­æ¢å¥½ååˆä¼‘æ¯äº†æŒºä¹…ï¼Œç„¶åæ²¿ç€å¤§è·¯èµ°äº†å¯èƒ½åå¤šäºŒååˆ†é’Ÿï¼Œæ‰ç»ˆäºåˆ°äº†å±±è„šï¼Œè¿œè¿œçœ‹åˆ°ä¸è¿œå¤„å°±æœ‰ä¸ªå…¬äº¤ç«™ï¼Œå†æ¬¡å¯¼èˆªä¸€ä¸‹ï¼Œç¡®è®¤å®ƒå°±æ˜¯å¤§è€å±±éš§é“ç«™ã€‚ åˆ°è¾¾è½¦ç«™å·²ç»æ˜¯ 22:20 äº†ï¼Œä¹˜ä¹å·´ 74X è·¯åˆ°å¹¿ç¦é‚¨ä¸‹è½¦ï¼Œå†æ­¥è¡Œåˆ°åœ°é“ç«™ä¹˜è½¦åˆ°ç½—æ¹–å£å²¸ã€è¿‡å…³ã€å†ä¹˜ä¸€å·çº¿æ—¶å·²ç» 23:40ï¼Œè¿™ä¸ªç‚¹å±…ç„¶è¿˜æœ‰ä¸€è¶Ÿæœ«ç­è½¦ã€‚æœ€ååˆ°å®¶å·²ç»è¿‡äº† 0 ç‚¹ï¼Œé¥¿å¾—ä¸è¡Œæå®Œå¤œå®µã€ä¼‘æ¯ã€å†æ´—æ¾¡ï¼Œæåˆ°ä¸¤ä¸‰ç‚¹æ‰ç¡è§‰ã€‚ 22:37ï¼Œåœ¨ä¹˜ä¹å·´ 74X è·¯å¾€å¹¿ç¦é‚¨çš„è·¯ä¸Šï¼Œé¦™æ¸¯åŸå¸‚å¤œæ™¯ ä¸‹è½¦ï¼Œæ­¥è¡Œå‰å¾€åœ°é“ç«™ 22:52ï¼Œåˆ°è¾¾å¤§åŸ”å¢Ÿåœ°é“ç«™ 22:57ï¼Œç­‰åœ°é“ä¸­ æ€»çš„æ¥è¯´è¿™æ¬¡å¾’æ­¥è·ç¦»çœŸçš„æ˜¯åˆ°ç›®å‰ä¸ºæ­¢çš„äººç”Ÿå·…å³°äº†ï¼Œå¦å¤–è¿™æ¬¡ä¸‹å±±è·¯çº¿ä¹Ÿæ˜¯æˆ‘èµ°è¿‡æœ€é™©çš„ä¸€æ¬¡ï¼Œæœ‰ç‚¹åˆºæ¿€è·Ÿåæ€•ï¼Œé«˜å¾·åœ°å›¾å‘æˆ‘å•Šã€‚ ","date":"2024-05-21","objectID":"/posts/hong-kong-travel-notes-in-2024/:5:0","series":["å¾’æ­¥æ—…è¡Œ"],"tags":["Travel","æ—…æ¸¸","Backpacking","é‡è£…å¾’æ­¥","Hiking","å¾’æ­¥","Hong Kong","é¦™æ¸¯","MacLehose Trail","éº¦ç†æµ©å¾„"],"title":"2024 å¹´é¦™æ¸¯å¾’æ­¥æ—…è¡Œè®°å½•ï¼ˆä¸€ï¼‰","uri":"/posts/hong-kong-travel-notes-in-2024/#å››éº¦ç†æµ©å¾„ç¬¬å››æ®µ"},{"categories":["life"],"content":" è£…å¤‡æ€»ç»“ ä¸åº”è¯¥å¸¦çš„è£…å¤‡ï¼š æŠ˜å æ¡Œè·ŸæŠ˜å å‡³ï¼š æ²æµ´éœ²ï¼šè®¸å¤šè¥åœ°æ²¡æ´—æ¾¡çš„åœ°æ–¹ï¼Œæ“¦èº«ä½“ä¹Ÿç”¨ä¸ä¸Šæ²æµ´éœ²ï¼Œå¸¦è¿™ä¸ªä¸å¦‚å¸¦ç‚¹æ¹¿å·¾ã€‚ æ´—æ´ç²¾ï¼šåŒç†ï¼Œå°±å‡ å¤©å¾’æ­¥ï¼Œç”¨çº¸å·¾æ“¦ä¸€æ“¦å°±è¡Œï¼Œå›å®¶åå†ç”¨æ´—æ´ç²¾æ¸…ç†ä¸€éä¸è¿Ÿã€‚ å¤ªé˜³èƒ½ç”µæ¿ï¼šä¸‰å¤©ä»¥å†…ï¼Œä¸€ä¸ª 30000 mah çš„ç”µæºå®Œå…¨å¤Ÿç”¨ã€‚å¦‚æœ 3-6 å¤©ï¼Œè¿˜ä¸å¦‚å¸¦ä¸¤ä¸ªç§»åŠ¨ç”µæºã€‚ç›®å‰æ ¹æœ¬æ²¡æœ‰å¾’æ­¥è¶…è¿‡ä¸€å‘¨çš„è®¡åˆ’ï¼Œæ‰€ä»¥è¿™ä¸ªä¹Ÿæ²¡å¿…è¦å¸¦ã€‚ ä¿æ¸©æ¯ã€é¤å…·ã€ç‚‰å­ï¼šç°åœ¨æ˜¯å¤å­£ï¼Œé¦™æ¸¯æŒºæ¸©æš–ï¼Œæˆ‘å…¨ç¨‹é èƒ½é‡èƒ¶è·Ÿå‹ç¼©é¥¼å¹²ç»´æŒä½“åŠ›ï¼Œæ™šé¥­åƒè‡ªçƒ­ç±³é¥­ï¼Œç”¨ä¸ä¸Šè¿™äº›è£…å¤‡ã€‚å…¶å®ä¸»è¦æ˜¯æ°”ç½ä¸å¥½å¸¦ï¼Œæ‹…å¿ƒè¢«æµ·å…³æŸ¥æ‰£ã€‚ èµ·äº†é‡å¤§ä½œç”¨çš„è£…å¤‡ï¼š æ›¦é€”ç¬¬ä¸‰ä»£ 7075 ç™»å±±æ–ï¼šé“åˆé‡‘æœ¬èº«å¤Ÿè½»ï¼Œå°†éƒ¨åˆ†è…¿éƒ¨è´Ÿé‡è½¬ç§»åˆ°ä¸ŠåŠèº«ï¼Œå‡è½»äº†è…¿éƒ¨çš„è´Ÿæ‹…ï¼Œ åœ¨é‡è£…å¾’æ­¥æ—¶èƒ½èµ·åˆ°ä¿æŠ¤è†ç›–ã€æå‡ç¨³å®šæ€§ã€å»¶é•¿è¡Œèµ°æ—¶é—´çš„ä½œç”¨ã€‚ ç›®å‰å‘ç°çš„ç¼ºç‚¹ï¼š ä½¿ç”¨æ—¶ç™»å±±æ–ä¸­éƒ¨ä¼šå…±æŒ¯ï¼Œå£°éŸ³ç¨å¾®æœ‰ç‚¹åµï¼Œä¸è¿‡é—®é¢˜ä¸å¤§ã€‚ ä¸€æ¬¡ä¸‹é›¨å¾’æ­¥åæ”¾äº†ä¸€å¤©å¤šï¼Œå°±å‘ç°æ–å°–å‘¨å›´ç”Ÿé”ˆäº†ï¼Œçœ‹æ¥æ˜¯ç”¨çš„ææ–™ä¸å¤Ÿå¥½ï¼ˆæ¯•ç«Ÿæ˜¯ä¸åˆ° 60 å—é’±ä¸€æ ¹ï¼Œè¿˜è¦å•¥è‡ªè¡Œè½¦ï¼‰ã€‚ æŒªå®¢äº‘å¾„ 65L å¾’æ­¥èƒŒåŒ…ï¼šå¤Ÿå¤§ï¼Œå¸¦èƒŒè´Ÿç³»ç»Ÿï¼Œéå¸¸å¥½ç”¨ã€‚ ç›®å‰å‘ç°çš„ç¼ºç‚¹ï¼š è…°å°çš„å¸¦å­ä¼šæ»‘åŠ¨ï¼Œè¡Œèµ°ä¹…äº†å°±ä¼šæ¾æ‰ï¼Œéœ€è¦é‡æ–°æ‰‹åŠ¨è°ƒæ•´ã€‚è¿™ä¸ªå¾ˆçƒ¦ï¼Œèµ°ç€èµ°ç€è‚©éƒ¨å—åŠ›å°±è¶Šæ¥è¶Šå¤§ï¼Œè€Œä¸”è¡Œèµ°çš„æ—¶å€™è°ƒæ•´å¸¦å­æ¾ç´§ä¹Ÿå¾ˆä¸æ–¹ä¾¿ã€‚ æŒªå®¢ 3L æ°´è¢‹ã€600ml æ°´æ¯ï¼šå–æ°´ï¼Œå¿…å¤‡ è¿ªå¡ä¾¬ MH100 ç™»å±±é‹ï¼šå¥½çš„ç¡¬åº•ç™»å±±é‹ï¼Œé˜²æ»‘ã€é˜²æ°´ã€é˜²ç£¨æŸï¼Œèƒ½ä¿æŠ¤è„šéƒ¨ï¼Œæä¾›è¶³å¤Ÿçš„æ”¯æ’‘ï¼Œ å‡å°‘è„šéƒ¨ç–²åŠ³ã€‚ æŒªå®¢å¤å­£ä¿¡å°ç¡è¢‹ï¼šå³ä½¿æ˜¯ç°åœ¨å¤å­£ï¼Œå±±ä¸Šçš„è¥åœ°ï¼ˆæ°´æµªçªï¼‰æ™šä¸Šè¿˜æ˜¯æœ‰ç‚¹å†·çš„ï¼Œç›–ä¸€ä¸ªå¤å­£ç¡è¢‹åˆšåˆšå¥½ã€‚ èƒ½é‡èƒ¶ã€ç›ä¸¸ã€å‹ç¼©é¥¼å¹²ã€é›¶é£Ÿï¼šå¸®åŠ©ä¿æŒä½“åŠ›ã€‚èƒ½é‡èƒ¶æ¢å¤ä½“åŠ›ä½†é¥¿å¾—å¿«ï¼Œå‹ç¼©é¥¼å¹²èƒ½ç»´æŒé¥±è…¹æ„Ÿï¼Œé›¶é£Ÿèƒ½æä¾›å£æ„Ÿã€‚ èƒ½é‡èƒ¶è·Ÿç›ä¸¸éå¸¸æœ‰ç”¨ï¼ æŠ˜å æ°´æ¡¶ã€é€Ÿå¹²æ¯›å·¾ï¼šæ‰“æ°´æ´—å¤´æ´—æ¾¡æ´—è¡£å¿…å¤‡ï¼ï¼ˆè¥åœ°æ²¡æ´—æ¾¡çš„åœ°æ–¹ï¼Œç”¨æ¹¿æ¯›å·¾æ“¦æ“¦èº«ä½“ï¼Œä¹ŸOKï¼Œ æ“¦å®Œèˆ’æœå¤ªå¤šäº†ï¼‰ è¿åŠ¨é€Ÿå¹²å¥—è£…ï¼ˆç´§èº«é€Ÿå¹²æ‰“åº•è¡£è£¤é•¿è¢– + çŸ­è¢–çŸ­è£¤ + è–„å¤–å¥—ï¼‰ï¼šé˜²æ­¢èšŠè™«å®å’¬ã€é€Ÿå¹²ã€é˜²æ™’ã€é˜²é£ï¼Œé’»ä¸ªçŒæœ¨ä¸›ä¹Ÿä¸æƒ§ï¼Œæˆ‘æ„¿ç§°ä¹‹ä¸ºå¾’æ­¥å¿…å¤‡ï¼ é€Ÿå¹²æ±—å¸¦ï¼šå¸æ±—ï¼Œé˜²æ­¢æ±—æ°´æµå…¥çœ¼ç›ï¼Œè€Œä¸”é€Ÿå¹²æ¬¾æ¯”æ£‰åˆ¶å“å¼ºå¤šäº†ï¼Œè’¸å‘å¾ˆå¿«ã€‚ å˜è‰²é˜²é£çœ¼é•œï¼šé˜²é£é˜²æ™’ã€é˜²é›¨ã€é˜²é£æ²™èšŠè™«ã€‚ä¸ç®¡æ˜¯ç™½å¤©ä¹Ÿæ˜¯å¤œé—´å¾’æ­¥ï¼Œéƒ½å¾ˆå®ç”¨ï¼ ä¿é²œè¢‹ï¼šä¸€æ—¶åŠä¼šå„¿æ²¡åƒå®Œçš„é£Ÿç‰©ï¼Œç”¨è¿™ä¸ªè£…éå¸¸æ–¹ä¾¿ã€‚ ä¸€æ¬¡æ€§å†…è£¤ã€è¢œå­ï¼šç”¨å®Œå³æŠ›ï¼Œä¸ç”¨æ´—ï¼Œæ–¹ä¾¿å¾—å¾ˆã€‚ ç¥ç« A20 æ‰‹ç”µç­’ï¼šä¸€å¼€å§‹è§‰å¾—å¥½åƒæ²¡å•¥ç”¨ï¼Œæ¯•ç«Ÿå·²ç»æœ‰å¤´ç¯äº†ï¼Œç»“æœå‘ç°æ™šä¸Šæ­å¸ç¯·ã€åœ¨è¥åœ°é€›é€›ï¼Œè¿™ä¸ªå¾ˆå¥½ç”¨ä¹Ÿå¾ˆæœ‰å¿…è¦ã€‚ 30000 mah ç§»åŠ¨ç”µæºï¼ˆ111Whï¼‰ï¼šæ˜¾ç„¶è¿™ä¸ªèµ·äº†å¤§ä½œç”¨ï¼Œç”¨å®Œä¸€å¤©åˆ°å›å®¶çš„æ—¶å€™ï¼Œè¿˜æœ‰ 70% ç”µé‡ï¼Œ å®ƒå¤§æ¦‚èƒ½é¡¶ä¸‰å¤©ï¼Œ650g çš„é‡é‡ç‰©æœ‰æ‰€å€¼ã€‚ å¤§æ¦‚ä¸¤å¹´å‰ä¹°çš„ï¼Œæœ€è¿‘æŸ¥äº†ä¸‹ï¼Œæœ‰ä¸ªåˆ«èƒ½é‡å¯†åº¦æ›´é«˜çš„ç”µæºï¼Œä½†å¸‚é¢ä¸Šå¤§éƒ¨åˆ†ç”µæºçš„èƒ½é‡å¯†åº¦éƒ½è·Ÿè¿™å·®ä¸å¤šï¼Œæ²¡æœ‰å¤ªå¤§çš„æå‡ã€‚ æ›¦é€”æŠ˜å åå«ï¼šè¡Œèµ°è·¯ä¸Šç´¯äº†ï¼Œéšæ—¶åä¸‹ä¼‘æ¯ï¼Œè¿™ä¸ªå¾ˆæœ‰ç”¨ã€‚ æœ¬æ¥æ˜¯æ‰“ç®—ç”¨æŠ˜å å‡³çš„ï¼Œä½†æŠ˜å å‡³æ”¶çº³è¿˜æ˜¯éº»çƒ¦è®¸å¤šï¼Œè€Œä¸”å®ƒå»ºè®®æ‰¿é‡ 75Kgï¼Œæˆ‘èƒŒç€ä¸ªæ¥è¿‘ 20 å…¬æ–¤çš„åŒ…ï¼Œå¾ˆæ€•ä¸€å±è‚¡ç»™ååäº†ã€‚ ä¸æ˜¯å¾ˆæ»¡æ„çš„è£…å¤‡ Warsun W81s å¤´ç¯ï¼šç”¨äº†ä¸¤ä¸ªåŠå°æ—¶å°±æ²¡ç”µäº†ï¼Œè€Œä¸”è¿˜ä¸èƒ½æ¢ç”µæ± ï¼åé¢å»éœ²è¥åœ°ç‚¹çš„è·¯ä¸Šåªèƒ½æ‰‹ä¸¾æ‰‹ç”µç­’åŒæ—¶è¿˜è¦ç”¨ç™»å±±æ–ï¼Œå¾ˆä¸æ–¹ä¾¿ã€‚å¿…é¡»å¾—æ¢ä¸ªç”µæ± å¯æ›´æ¢çš„å¤´ç¯ï¼Œæœ€å¥½æ˜¯èƒ½ç”¨ 18650 ç”µæ± ï¼ ä¸‹å•äº†è€æœ— B71 è½¬è§’æ‰‹ç”µç­’ã€ä¸çŸ¥åçš„ä¸‡å‘æ‰‹ç”µç­’ U å‹å¤¹ï¼ˆå½“æ‰‹ç”µè…°å¤¹ç”¨ï¼‰ã€å€é‡çš„æœ€é«˜å¯†åº¦ 18650 ç”µæ± è·Ÿ 21700 ç”µæ± ã€‚è¿™æ ·è½¬è§’æ‰‹ç”µ + ç›´è§’æ‰‹ç”µ + æ‰‹ç”µè…°å¤¹ + å¤‡ç”¨ç”µæ± ç»„åˆï¼Œèƒ½åº”å¯¹ä»»ä½•å¤šæ—¥é•¿çº¿å¾’æ­¥çš„å¤œè¡Œæƒ…å†µäº† é˜²æ™’è¢–å¥—è„–å¥—ï¼šç©¿äº†é•¿è¢–ç´§èº«è¡£çš„æƒ…å†µä¸‹è¢–å¥—æ„Ÿè§‰å°±æ²¡å•¥å¿…è¦äº†ï¼Œè„–å¥—å¯ä»¥ä¿ç•™ä¸€ä¸ªã€‚ è¿ªå¡ä¾¬ MH500 å†²é”‹è¡£ + æ™®é€šé›¨è£¤ï¼šå åœ°æ–¹ï¼Œè€Œä¸”ä¹ŸæŒºé‡ï¼Œè¿™æ¬¡æ²¡æ´¾ä¸Šç”¨åœºã€‚ä½†è€ƒè™‘åˆ°ä¸‡ä¸€ä¸‹å¤§é›¨åˆ®å¤§é£ï¼Œè¿™ä¿©è¿˜æ˜¯å¾—å¸¦ä¸Šã€‚å¤§é£å¤©æ°”ä¸‹é›¨æŠ«ç”¨å¤„ä¸å¤§ï¼Œåªèƒ½é å†²é”‹è¡£ã€‚ æ€¥æ•‘åŒ…ï¼šæœ‰ 400gï¼Œæ„Ÿè§‰å¤ªé‡äº†ï¼Œä¸‹æ¬¡å¯ä»¥ç²¾ç®€ä¸€ä¸‹ã€‚ ç‰§é«˜ç¬›é›¨æŠ«å¤©å¹•ï¼šè‡³å°‘åœ¨é¦™æ¸¯ç”¨è¿™ä¸œè¥¿ï¼Œæœ‰ç‚¹å¤ªçƒ­äº†ï¼Œè€Œä¸”æˆ‘ä¹°çš„è¿™ä¸ªæ²¡æœ‰è…°å¸¦ï¼ŒèƒŒéƒ¨ä¹Ÿæ²¡æœ‰åŠ é•¿ï¼Œç°åœ¨çœ‹åº”è¯¥ä¹°ä¸‰å³°å‡ºçš„é‚£ä¸ªä¼šå¥½å¾ˆå¤šã€‚ è¿™æ¬¡æ²¡å¸¦ï¼Œä½†å‘è§‰åº”è¯¥è¡¥å……çš„è£…å¤‡ èƒ½æ”¾æ°´æ¯ã€è¯ä»¶ã€æ‰‹æœºçš„è…°åŒ…ï¼šèƒŒåŒ…è…°å°ä¼šæŒ¡ä½è£¤å­å£è¢‹ï¼Œè…°å°çš„å£è¢‹ä¹Ÿæ²¡æ³•æ”¾æ‰‹æœºï¼Œè¿™ä¸ªæ—¶å€™è…°åŒ…å°±éå¸¸æœ‰ç”¨äº†ã€‚ é©±èšŠæ°´ï¼šé©±èšŠé©±è™«ï¼Œä¸€æ˜¯é˜²æ­¢å®å’¬ï¼ŒäºŒæ˜¯é˜²æ­¢èšŠè™«è¿›å…¥å¸ç¯·ï¼Œæˆ‘è¿˜æŒºæ€•å°è™«å­çš„ã€‚ æ¹¿å·¾ï¼šä¸€äº›è¥åœ°æ·¡æ°´ä¸å¤ªå¥½è·å¾—ï¼ˆæ¯”å¦‚æ°´æµªçªè¥åœ°ï¼Œæˆ‘è¿™æ¬¡æ˜¯ç”¨äº†æ°´è¢‹é‡Œçš„é¥®æ°´æ“¦èº«ä½“â€¦ï¼‰ï¼Œè¿™æ—¶å€™æ¹¿å·¾å°±éå¸¸æœ‰ç”¨äº†ï¼Œå¯ä»¥ç”¨æ¥ç®€å•æ¸…ç†ä¸‹èº«ä½“ã€‚ çŸ­æ¬¾é›ªå¥—ï¼šé˜²æ­¢å„ç§ç¢çŸ³ã€æ ‘æã€è‰å¶è¿›å…¥é‹å­ï¼Œä¿æŠ¤è„šéƒ¨ã€‚ç”¨çŸ­æ¬¾æ˜¯å› ä¸ºç´§èº«è¿åŠ¨è£¤å·²ç»æä¾›äº†ä¿æŠ¤è…¿éƒ¨çš„åŠŸèƒ½ï¼Œé•¿æ¬¾é›ªå¥—å°±æ˜¾å¾—å¤šä½™äº†ï¼ˆä¸‹é›¨å¦å½“åˆ«è®ºï¼‰ã€‚ TODOs: éœ€è¦ç»ƒä¹ ä¸‹é›¨æŠ« + èƒŒåŒ…çš„ä½¿ç”¨æ–¹å¼ï¼Œè¿™æ¬¡è·¯ä¸Šä¸‹é›¨ç‚¹ï¼Œæ‰‹å¿™è„šä¹±åœ°ç©¿ä¸Šï¼ŒæåŠå¤©éƒ½ç›–ä¸ä½èƒŒåŒ…ã€‚ å­¦ä¹ ä¸‹é›¨å¤©å¦‚ä½•å¿«é€Ÿæ”¶æ‹¾å¸ç¯·ï¼Œè¿™æ¬¡æ”¶æ‹¾éƒ½èŠ±äº†åŠä¸ªå¤šå°æ—¶ï¼Œè¦æ˜¯ä¸‹å¤§é›¨å¤§æ¦‚å¸ç¯·è·Ÿä¸œè¥¿å¾—å…¨ææ¹¿äº†ã€‚ å¦‚ä½•é€‰æ‹©æ‰è¥åœ°ç‚¹ï¼Ÿè¿™æ¬¡é€‰åœ¨äº†æ ‘ä¸‹çš„è‰åœ°ï¼Œç»“æœæ°å¥½æ˜¯å°‘æœ‰äººæ‰è¥çš„ä¸€å—ï¼Œè™«å­ç‰¹åˆ«å¤šï¼ˆæ¯›æ¯›è™«ã€è·³èš¤ã€èš‚èšã€èœ˜è››ï¼Œç­‰ç­‰â€¦ï¼‰ã€‚ ç™»å±±æ–çš„æ‰‹æŸ„ç³»å¸¦å¦‚ä½•æ‹†å¸æ¸…æ´—ï¼Œä»¥åŠå¦‚ä½•è°ƒæ•´é•¿çŸ­ã€‚èµ°å®Œä¸€è¶Ÿç³»å¸¦éƒ½è¢«æ±—æ°´æµ¸æ¹¿äº†ï¼Œè€Œä¸”æœ‰ç‚¹é•¿äº†ã€‚ å†å¤ä¹ ä¸€éç™»å±±æ–ä½¿ç”¨æ–¹æ³•ï¼Œè¿™æ¬¡å‘ç°ç™»å±±æ–èµ·äº†å¤§ç”¨ï¼Œè€Œä¸”ç»è¿‡ä¸€å¤©çš„é«˜å¼ºåº¦ä½¿ç”¨ï¼Œç»éªŒä¹Ÿä¸°å¯Œäº†ï¼Œç°åœ¨å†å›å¤´è¡¥å……ä¸‹ç†è®ºçŸ¥è¯†ï¼Œåº”è¯¥ä¼šæœ‰æ›´æ·±çš„ä½“ä¼šã€‚ å­¦ä¹ ä¼ç»³ã€æ€¥æ•‘åŒ…çš„ä½¿ç”¨æ–¹æ³•ï¼Œç»å¸¸å¾’æ­¥çš„è¯ï¼Œå‡ºäº†æ„å¤–ä¸ä¼šç”¨å°±å°´å°¬äº†ã€‚ ç°åœ¨å·²ç»çˆ±ä¸Šäº†å¾’æ­¥è¿™ç§è¿åŠ¨æ–¹å¼ï¼ŒèŠ±é’±æŠ˜ç£¨è‡ªå·±æ¯«ä¸æ‰‹è½¯ï¼ˆ ","date":"2024-05-21","objectID":"/posts/hong-kong-travel-notes-in-2024/:6:0","series":["å¾’æ­¥æ—…è¡Œ"],"tags":["Travel","æ—…æ¸¸","Backpacking","é‡è£…å¾’æ­¥","Hiking","å¾’æ­¥","Hong Kong","é¦™æ¸¯","MacLehose Trail","éº¦ç†æµ©å¾„"],"title":"2024 å¹´é¦™æ¸¯å¾’æ­¥æ—…è¡Œè®°å½•ï¼ˆä¸€ï¼‰","uri":"/posts/hong-kong-travel-notes-in-2024/#è£…å¤‡æ€»ç»“"},{"categories":["life"],"content":" å‚è€ƒèµ„æ–™å¦‚ä¸‹æ˜¯æˆ‘è¿‘æœŸå‘ç°çš„ä¸€äº›é«˜è´¨é‡å¾’æ­¥ç›¸å…³èµ„æ–™ï¼Œå¯¹æˆ‘æœ‰æŒºå¤§å¸®åŠ©ï¼š æ¯”è£…å¤‡æ¨èæ›´é‡è¦çš„æˆ·å¤–çŸ¥è¯†ï¼šé‡è£…å¾’æ­¥å…¥å‘æŒ‡å—ï¼Œå­¦åˆ°æŒºå¤šæ–° æˆ·å¤–è£…å¤‡è¶…çº§æŒ‡å— - çŸ¥ä¹ä¸“æ : ä¸€ä½æˆ·å¤–é«˜ç©çš„ä¸“æ ï¼Œæ·±å…¥æµ…å‡ºåœ°è®²è§£äº†è®¸å¤šé‡è£…å¾’æ­¥è£…å¤‡ï¼ˆåŒ…æ‹¬ç”¨è¯ï¼‰çš„è®¾è®¡åŸç†ã€ä½¿ç”¨æ–¹æ³•ã€é€‰è´­ç­–ç•¥ç­‰ç­‰ï¼Œéå¸¸æœ‰ç”¨ï¼ æˆ·å¤–è¿™ 7 ç§å¸¸è§çš„åœ°å½¢ï¼Œç™»å±±æ–çš„ä½¿ç”¨æ–¹æ³•ä¹Ÿå„ä¸ç›¸åŒ - Bilibili: è¿™ä½ UP ä¸»å‡ºäº†è®¸å¤šç®€çŸ­çš„è§†é¢‘è®²è§£å„ç§æˆ·å¤–æŠ€å·§ï¼Œéå¸¸å®ç”¨ï¼Œå°¤å…¶æ˜¯è¿™ä¸ªè®²è§£ç™»å±±æ–ç”¨æ³•çš„è§†é¢‘ã€‚ 35ä½åŒ»ç”ŸæŠ•ç¥¨ï¼šå®¶ä¸­å¸¸å¤‡ä»€ä¹ˆè¯ï¼Ÿç«Ÿç„¶æœ‰ä¸€ä¸ªå¾·ä¸é…ä½ï¼- å“”å“©å“”å“©ï¼š å¸¸ç”¨è¯æŒ‡å—ï¼Œç»“åˆæˆ·å¤–èƒŒåŒ…æ‰“åŒ…ä¸è£…å¤‡æ£€æŸ¥æ¸…å• - 1.22 åŒ»ç–—æ•‘æ´ä¸é˜²æŠ¤ç”¨å“ çš„å†…å®¹é€‰æ‹©è¯å“ï¼Œéå¸¸å®ç”¨ã€‚ ä¸€å€‹äººçš„éº¥ç†æµ©å¾‘: åŒ…å«è¯¦ç»†çš„éº¦ç†æµ©å¾‘å…¨ç¨‹è·¯çº¿ã€æ”¿åºœè¥åœ°ã€æ°´æºã€äº¤é€šç­‰ä¿¡æ¯ï¼Œéå¸¸å®ç”¨ã€‚ éœ²ç‡Ÿåœ°é» - é¦™æ¸¯æ¸”å†œè‡ªç„¶æŠ¤ç†ç½²: åŒ…å«é¦™æ¸¯å…¨éƒ¨ 41 ä¸ªæ”¿åºœè¥åœ°çš„ä»‹ç»ã€‚ ","date":"2024-05-21","objectID":"/posts/hong-kong-travel-notes-in-2024/:7:0","series":["å¾’æ­¥æ—…è¡Œ"],"tags":["Travel","æ—…æ¸¸","Backpacking","é‡è£…å¾’æ­¥","Hiking","å¾’æ­¥","Hong Kong","é¦™æ¸¯","MacLehose Trail","éº¦ç†æµ©å¾„"],"title":"2024 å¹´é¦™æ¸¯å¾’æ­¥æ—…è¡Œè®°å½•ï¼ˆä¸€ï¼‰","uri":"/posts/hong-kong-travel-notes-in-2024/#å‚è€ƒèµ„æ–™"},{"categories":["tech"],"content":" æœ¬æ–‡æœ€åˆå‘è¡¨äº å¦‚ä½•è¯„ä»·NixOS? - çŸ¥ä¹ï¼Œè§‰å¾—æ¯”è¾ƒæœ‰ä»·å€¼æ‰€ä»¥å†æ¬è¿åˆ°æˆ‘çš„åšå®¢ã€‚ æˆ‘ 23 å¹´ 4 æœˆå¼€å§‹ç”¨ NixOS ä¹‹å‰çœ‹è¿‡ï¼ˆå¦‚ä½•è¯„ä»·NixOS? - çŸ¥ä¹ï¼‰ è¿™ä¸ªé—®ç­”ï¼Œå‡ ä¸ªé«˜èµå›ç­”éƒ½ä»ä¸åŒæ–¹é¢ç»™å‡ºäº†å¾ˆæœ‰æ„ä¹‰çš„è¯„ä»·ï¼Œä¹Ÿæ˜¯å¸å¼•æˆ‘å…¥å‘çš„åŸå› ä¹‹ä¸€ã€‚ ç°åœ¨æ˜¯ 2024 å¹´ 2 æœˆï¼Œè·ç¦»æˆ‘å…¥å‘ NixOS åˆšå¥½ 10 ä¸ªæœˆï¼Œæˆ‘å½“åˆå†™çš„æ–°æ‰‹ç¬”è®°å·²ç»è·å¾—äº†å¤§é‡å¥½è¯„ä¸ä¸å°‘çš„èµåŠ©ï¼Œå¹¶æˆä¸ºäº†æ•´ä¸ªç¤¾åŒºæœ€å—æ¬¢è¿çš„å…¥é—¨æ•™ç¨‹ä¹‹ä¸€ã€‚è‡ª 2023 å¹´ 6 æœˆæˆ‘ä¸ºå®ƒä¸“é—¨åˆ›å»ºä¸€ä¸ª GitHub ä»“åº“ä¸å•ç‹¬çš„æ–‡æ¡£ç«™ç‚¹ä»¥æ¥ï¼Œå®ƒå·²ç»è·å¾—äº† 1189 ä¸ª starsï¼Œé™¤æˆ‘ä¹‹å¤–è¿˜æœ‰ 37 ä½è¯»è€…ç»™å®ƒæäº† PRï¼š NixOS ä¸ Flakes - ä¸€ä»½éå®˜æ–¹çš„æ–°æ‰‹æŒ‡å— NixOS \u0026 Flakes Book é‚£ä¹ˆä½œä¸ºä¸€åå·²ç»æ·±åº¦ä½¿ç”¨ NixOS ä½œä¸ºä¸»åŠ›æ¡Œé¢ç³»ç»Ÿæ¥è¿‘ 10 ä¸ªæœˆçš„ç†Ÿæ‰‹ï¼Œæˆ‘åœ¨è¿™é‡Œä¹Ÿä»å¦ä¸€ä¸ªè§’åº¦æ¥åˆ†äº«ä¸‹æˆ‘çš„å…¥å‘ä½“ä¼šã€‚ æ³¨æ„ï¼Œè¿™ç¯‡æ–‡ç« ä¸æ˜¯ NixOS å…¥é—¨æ•™ç¨‹ï¼Œæƒ³çœ‹æ•™ç¨‹è¯·ç§»æ­¥ä¸Šé¢ç»™çš„é“¾æ¥ã€‚ ","date":"2024-02-21","objectID":"/posts/my-experience-of-nixos/:0:0","series":["NixOS ä¸ Nix Flakes"],"tags":["NixOS","Nix","Flakes","Linux","DevOps"],"title":"OS as Code - æˆ‘çš„ NixOS ä½¿ç”¨ä½“ä¼š","uri":"/posts/my-experience-of-nixos/#"},{"categories":["tech"],"content":" Nixpkgs ä¸­çš„åŒ…å¤ªå°‘ï¼Ÿå…ˆæ¾„æ¸…ä¸‹ä¸€ç‚¹ï¼ŒNixOS çš„åŒ…éå¸¸å¤šï¼ŒRepository statistics çš„åŒ…ä»“åº“ç»Ÿè®¡æ•°æ®å¦‚ä¸‹ï¼š ä¸Šé¢è¿™ä¸ª Nixpkgs çš„åŒ…æ•°é‡ç¡®å®æœ‰æŒºå¤šæ°´åˆ†â€”â€”Nixpkgs è¿˜æ‰“åŒ…äº†è®¸å¤šç¼–ç¨‹è¯­è¨€çš„ Librariesï¼ˆè²Œä¼¼æŒºå¤š Haskell äººç”¨ nix å½“è¯­è¨€åŒ…ç®¡ç†å™¨ç”¨ï¼‰ï¼Œæ¯”å¦‚Haskell Packages(18000+),R Packages(27000+),Emacs Packages(6000+) ï¼Œä½†å³ä½¿æŠŠå®ƒä»¬å»æ‰å Nixpkgs çš„åŒ…æ•°é‡ä¹Ÿæœ‰å¤§çº¦ 40000+ï¼Œè™½ç„¶é€Šè‰²äº AURï¼Œä½†è¿™ä¸ªæ•°é‡å†æ€ä¹ˆç®—ä¹Ÿè·Ÿã€ŒåŒ…å¤ªå°‘ã€è¿™ä¸ªæè¿°æ‰¯ä¸ä¸Šå…³ç³»ã€‚ åŒ…ä»“åº“è¿™é‡Œä¹Ÿæ˜¯ NixOS è·Ÿ Arch ä¸å¤ªåŒçš„åœ°æ–¹ï¼ŒArch çš„å®˜æ–¹åŒ…ä»“åº“æ”¶å½•å¾ˆä¸¥æ ¼ï¼Œç›¸å¯¹çš„ AUR ç”Ÿæ€ç›¸å½“ç¹è£ã€‚ä½†ä»»ä½•äººéƒ½èƒ½å¾€ AUR ä¸Šä¼ å†…å®¹ï¼Œè™½ç„¶æœ‰ä¸€ä¸ªæŠ•ç¥¨æœºåˆ¶èµ·åˆ°ä¸€å®šå®¡æ ¸ä½œç”¨ï¼Œä½†ä¸ªäººæ„Ÿè§‰è¿™ä¸ªé™åˆ¶å¤ªæ¾æ•£äº†ã€‚ è€Œ NixOS å°±å¾ˆä¸ä¸€æ ·äº†ï¼Œå®ƒçš„å®˜æ–¹åŒ…ä»“åº“ Nixpkgs å¾ˆä¹äºæ¥å—æ–°åŒ…ï¼Œæƒ³ä¸º Nixpkgs æä¸ª PR åŠ åŒ…æˆ–åŠŸèƒ½ç›¸å¯¹å…¶ä»–å‘è¡Œç‰ˆè€Œè¨€è¦ç®€å•è®¸å¤šï¼Œè¿™æ˜¯ Nixpkgs çš„åŒ…æ•°é‡è¿™ä¹ˆå¤šçš„é‡è¦åŸå› ï¼ˆGitHub æ˜¾ç¤º Nixpkgs æœ‰ 5000+ å†å²è´¡çŒ®è€…ï¼Œè¿™å¾ˆå¤¸å¼ äº†ï¼‰ã€‚ Nixpkgs ä»“åº“çš„æ›´æ–°æµç¨‹ç›¸å¯¹ AUR ä¹Ÿä¸¥æ ¼è®¸å¤šï¼ŒPR é€šå¸¸éƒ½éœ€è¦é€šè¿‡ä¸€ç³»åˆ—çš„ GitHub Actions æµ‹è¯• + Maintainer Review + Ofborg æ£€æŸ¥ä¸è‡ªåŠ¨æ„å»ºæµ‹è¯•åæ‰èƒ½è¢«åˆå¹¶ï¼ŒNixpkgs ä¹Ÿé¼“åŠ±ç»´æŠ¤è€…ä¸ºè‡ªå·±çš„åŒ…æ·»åŠ æµ‹è¯•ï¼ˆåŒ…çš„ doCheck é»˜è®¤ä¸º trueï¼‰ï¼Œè¿™äº›ä¸¾æªéƒ½æå‡äº† Nixpkgs çš„åŒ…è´¨é‡ã€‚ NixOS å…¶å®ä¹Ÿæœ‰ä¸ªä¸ AUR(Arch User Repository) ç±»ä¼¼çš„ NURï¼ˆNix User Repositoryï¼‰ï¼Œä½†å› ä¸º Nixpkgs çš„å®½æ¾ï¼ŒNUR åè€Œæ²¡å•¥å†…å®¹ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼ŒQQ èƒ½ç›´æ¥ä» Nixpkgs å®˜æ–¹åŒ…ä»“åº“ä¸‹è½½ä½¿ç”¨ï¼Œè€Œåœ¨ Arch ä¸Šä½ å¾—ç”¨ AUR æˆ–è€… archlinux-cn. è¿™ç®—æ˜¯å„æœ‰ä¼˜åŠ¿å§ã€‚NixOS è¢«äººå–·åŒ…å°‘ï¼Œä¸»è¦æ˜¯å› ä¸ºå®ƒä¸éµå¾ª FHS æ ‡å‡†ï¼Œå¯¼è‡´å¤§éƒ¨åˆ†ç½‘ä¸Šä¸‹è½½çš„ Linux ç¨‹åºéƒ½ä¸èƒ½ç›´æ¥åœ¨ NixOS ä¸Šè¿è¡Œã€‚è¿™å½“ç„¶æœ‰è§£å†³æ–¹æ¡ˆï¼Œæˆ‘å»ºè®®æ˜¯é¦–å…ˆçœ‹çœ‹ Nixpkgs ä¸­æ˜¯å¦å·²ç»æœ‰è¿™ä¸ªåŒ…äº†ï¼Œæœ‰çš„è¯ç›´æ¥ç”¨å°±è¡Œã€‚å¦‚æœæ²¡æœ‰ï¼Œå†å°è¯•ä¸€äº›ç¤¾åŒºçš„è§£å†³æ–¹æ¡ˆï¼Œæˆ–è€…è‡ªå·±ç»™æ‰“ä¸ªåŒ…ã€‚ ç”¨ NixOS çš„è¯è‡ªå·±æ‰“åŒ…ç¨‹åºæ˜¯ä¸å¯é¿å…çš„ï¼Œå› ä¸ºå³ä½¿ Nixpkgs ä¸­å·²ç»æœ‰äº†è¿™ä¹ˆå¤šåŒ…ï¼Œä½†å®ƒä»ç„¶ä¸å¯èƒ½æ°¸è¿œ 100% åŒ¹é…ä½ çš„éœ€æ±‚ï¼Œæ€»æœ‰ä½ æƒ³ç”¨ä½† Nixpkgs è·Ÿ NUR é‡Œè¾¹éƒ½æ²¡æœ‰çš„åŒ…ï¼Œåœ¨ NixOS ä¸Šä½ å¸¸å¸¸å¿…é¡»è¦ç»™ä½ çš„åŒ…å†™ä¸ªæ‰“åŒ…è„šæœ¬ï¼Œæ‰èƒ½ä½¿å®ƒåœ¨ NixOS ä¸Šæ­£å¸¸è¿è¡Œã€‚ å¦å¤–å³ä½¿æœ‰äº›ç¨‹åºæœ¬èº«ç¡®å®èƒ½åœ¨ NixOS ä¸Šæ— ç—›è¿è¡Œï¼Œä½†ä¸ºäº†åšåˆ°å¯å¤ç°ï¼ŒNixOS ç”¨æˆ·é€šå¸¸ä¹Ÿä¼šé€‰æ‹©è‡ªå·±æ‰‹åŠ¨ç»™å®ƒæ‰“ä¸ªåŒ…ã€‚ OKï¼Œé—²è¯è¯´å®Œï¼Œä¸‹é¢è¿›å…¥æ­£é¢˜ã€‚ é¦–å…ˆï¼ŒNixOS æ¯”ä¼ ç»Ÿå‘è¡Œç‰ˆå¤æ‚å¾ˆå¤šï¼Œä¹Ÿå­˜åœ¨éå¸¸å¤šçš„å†å²é—ç•™é—®é¢˜ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œå®ƒçš„å®˜æ–¹æ–‡æ¡£çƒ‚åˆ°é€¼å¾—æˆ‘ä¸€ä¸ªåˆšå­¦ NixOS çš„æ–°æ‰‹è‡ªå·±è¾¹å­¦è¾¹å†™å…¥é—¨æ–‡æ¡£ã€‚åœ¨æˆ‘ç”¨è‡ªå·±çš„æ¸£æ¸£è‹±è¯­æŠŠç¬”è®°ç¿»è¯‘äº†ä¸€éå‘åˆ° reddit ï¼ˆNixOS \u0026 Nix Flakes - A Guide for Beginnersï¼‰ åï¼Œå±…ç„¶è¿˜è·å¾—äº†è®¸å¤šè€å¤–çš„å¤§é‡å¥½è¯„ï¼ˆç»è¿‡è¿™ä¹ˆé•¿æ—¶é—´çš„æŒç»­è¿­ä»£ï¼Œç°åœ¨ç”šè‡³å·²ç»å˜æˆäº†ç¤¾åŒºæœ€å—æ¬¢è¿çš„æ–°æ‰‹æ•™ç¨‹ä¹‹ä¸€ï¼‰ï¼Œè¿™ä¾§é¢ä¹Ÿè¯´æ˜å®˜æ–¹æ–‡æ¡£åˆ°åº•æœ‰å¤šçƒ‚ã€‚ ","date":"2024-02-21","objectID":"/posts/my-experience-of-nixos/:1:0","series":["NixOS ä¸ Nix Flakes"],"tags":["NixOS","Nix","Flakes","Linux","DevOps"],"title":"OS as Code - æˆ‘çš„ NixOS ä½¿ç”¨ä½“ä¼š","uri":"/posts/my-experience-of-nixos/#is-nixpkgs-lacking-packages"},{"categories":["tech"],"content":" NixOS å€¼ä¸å€¼å¾—å­¦ï¼ŸNixOS å€¼ä¸å€¼å¾—å­¦æˆ–è€…è¯´æŠ•å…¥äº§å‡ºæ¯”æ˜¯å¦å¤Ÿé«˜ï¼Ÿåœ¨æˆ‘çœ‹æ¥ï¼Œè¿™å½’æ ¹ç»“åº•æ˜¯ä¸ªè§„æ¨¡é—®é¢˜ã€‚ è¿™é‡Œçš„è§„æ¨¡ï¼Œä¸€æ˜¯æŒ‡ä½ å¯¹ Linux ç³»ç»Ÿæ‰€åšçš„è‡ªå®šä¹‰å†…å®¹çš„è§„æ¨¡ï¼ŒäºŒæ˜¯æŒ‡ä½ ç³»ç»Ÿæ›´æ–°çš„é¢‘ç¹ç¨‹åº¦ï¼Œä¸‰æ˜¯æŒ‡ä½  Linux æœºå™¨çš„æ•°é‡ã€‚ ä¸‹é¢æˆ‘ä»ä¸ªäººç»å†çš„è§’åº¦æ¥è®²ä¸‹æˆ‘ä»¥å‰ç”¨ Arch Linuxã€Ubuntu ç­‰ä¼ ç»Ÿå‘è¡Œç‰ˆçš„ä½“éªŒï¼Œä»¥åŠæˆ‘ä¸ºä»€ä¹ˆé€‰æ‹©äº† NixOSï¼ŒNixOS åˆä¸ºæˆ‘å¸¦æ¥äº†ä»€ä¹ˆæ ·çš„æ”¹å˜ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œä»¥å‰æˆ‘ç”¨ Deepin Ubuntu æ—¶æˆ‘åŸºæœ¬æ²¡å¯¹ç³»ç»Ÿåšè¿‡ä»€ä¹ˆæ·±å…¥å®šåˆ¶ï¼Œä¸€æ˜¯æ‹…å¿ƒæŠŠç³»ç»Ÿå¼„å‡ºé—®é¢˜ä¿®å¤èµ·æ¥å¤´ç–¼ï¼ŒäºŒæ˜¯å¦‚æœä¸é¢å¤–å†™ä¸€ä»½æ–‡æ¡£æˆ–è„šæœ¬è®°å½•ä¸‹æ­¥éª¤çš„è¯ï¼Œæˆ‘åšçš„æ‰€æœ‰å®šåˆ¶éƒ½æ˜¯é»‘ç›’ä¸”ä¸å¯è¿ç§»çš„ï¼Œä¸€ä¸ªæœˆåæˆ‘å°±å…¨å¿˜äº†ï¼Œåªèƒ½æˆ˜æˆ˜å…¢å…¢åœ°æŒç»­ç»´æŠ¤è¿™ä¸ªéšç€æˆ‘çš„ä½¿ç”¨è€Œè¶Šæ¥è¶Šé»‘ç›’ã€çŠ¶æ€è¶Šæ¥è¶Šæ··æ²Œçš„ç³»ç»Ÿã€‚ å¦‚æœç”¨çš„æ˜¯ Arch è¿™ç§æ»šåŠ¨å‘è¡Œç‰ˆè¿˜å¥½ï¼Œç³»ç»Ÿä¸€ç‚¹ç‚¹å¢é‡æ›´æ–°ï¼Œé‡åˆ°çš„ä¸€èˆ¬éƒ½æ˜¯å°é—®é¢˜ã€‚è€Œå¯¹ Ubuntu Deepin è¿™ç§ï¼ŒåŸåœ°å‡çº§åªå‡ºå°é—®é¢˜æ˜¯å¾ˆå°‘è§çš„ï¼Œè¿™åŸºæœ¬å°±æ„å‘³ç€æˆ‘å¿…é¡»åœ¨æŸä¸ªæ—¶é—´ç‚¹ï¼Œåœ¨æ–°ç‰ˆæœ¬çš„ Ubuntu ä¸ŠæŠŠæˆ‘ä»¥å‰åšè¿‡çš„å®šåˆ¶å†å…¨éƒ¨é‡åšä¸€éï¼Œæ›´å…³é”®çš„æ˜¯ï¼Œæˆ‘éå¸¸æœ‰å¯èƒ½å·²ç»å¿˜äº†æˆ‘ä»¥å‰åšäº†ä»€ä¹ˆï¼Œè¿™å°±æ„å‘³ç€æˆ‘å¾—èŠ±æ›´å¤šçš„æ—¶é—´å»ç ”ç©¶æˆ‘çš„ç³»ç»Ÿç¯å¢ƒé‡Œåˆ°åº•éƒ½æœ‰äº›å•¥ä¸œè¥¿ï¼Œæ˜¯æ€ä¹ˆå®‰è£…é…ç½®çš„ï¼Œè¿™ç§é‡å¤åŠ³åŠ¨éå¸¸ç—›è‹¦ã€‚ æ€»ä¹‹å¾ˆæ˜¾ç„¶çš„ä¸€ç‚¹æ˜¯ï¼Œæˆ‘å¯¹ç³»ç»Ÿåšçš„å®šåˆ¶è¶Šå¤šè¶Šå¤æ‚ï¼Œè¿ç§»åˆ°æ–°ç‰ˆæœ¬çš„éš¾åº¦å°±è¶Šå¤§ã€‚ æˆ‘æƒ³ä¹Ÿæ­£æ˜¯å› ä¸ºè¿™ä¸€ç‚¹ï¼ŒArchã€Gentooã€Fedora è¿™ç§æ»šåŠ¨å‘è¡Œç‰ˆæ‰åœ¨ Linux çˆ±å¥½è€…åœˆå­ä¸­å¦‚æ­¤å—æ¬¢è¿ï¼Œå–œæ¬¢å®šåˆ¶è‡ªå·±ç³»ç»Ÿçš„ Linux ç”¨æˆ·ä¹Ÿå¤§éƒ½ä½¿ç”¨è¿™ç±»æ»šåŠ¨å‘è¡Œç‰ˆã€‚ é‚£ä¹ˆ Archã€Fedora å°±èƒ½å½»åº•è§£å†³é—®é¢˜äº†ä¹ˆï¼Ÿæ˜¾ç„¶å¹¶ä¸æ˜¯ã€‚é¦–å…ˆå®ƒä»¬çš„æ›´æ–°é¢‘ç‡æ¯”è¾ƒé«˜ï¼Œè¿™ä»£è¡¨ç€ä½ ä¼šæ›´å®¹æ˜“æŠŠä½ çš„ç³»ç»Ÿæå‡ºç‚¹æ¯›ç—…æ¥ã€‚å½“ç„¶è¿™å…¶å®æ˜¯ä¸ªå°é—®é¢˜ï¼Œç°åœ¨ Linux ç¤¾åŒºè°è¿˜æ²¡æ•´ä¸Šä¸ª btrfs / zfs æ–‡ä»¶ç³»ç»Ÿå¿«ç…§å•Šï¼Œå‡ºé—®é¢˜å›æ»šå¿«ç…§å°±è¡Œã€‚å®ƒä»¬æœ€æ ¹æœ¬çš„é—®é¢˜æ˜¯ï¼š ä½ çš„ Arch ç³»ç»Ÿç¯å¢ƒã€æ–‡ä»¶ç³»ç»Ÿå¿«ç…§ã€æˆ–è€…è™šæ‹Ÿæœºå¿«ç…§ï¼Œå®ƒä»¬ä»ç„¶æ˜¯ä¸ªé»‘ç›’ï¼Œä»ç„¶ä¼šéšç€ä½ çš„æŒç»­ä½¿ç”¨è€Œè¶Šæ¥è¶Šæ··æ²Œï¼Œä¹Ÿå¹¶ä¸åŒ…å«å¦‚ä½•ä»é›¶æ„å»ºè¿™ä¸ªç¯å¢ƒçš„ã€ŒçŸ¥è¯†ã€ï¼Œæ˜¯ä¸å¯è§£é‡Šçš„ã€‚ æˆ‘åœ¨å·¥ä½œä¸­å°±è§åˆ°è¿‡ä¸€äº›ã€Œç¥–ä¼ è™šæ‹Ÿæœºå¿«ç…§ã€æˆ–ã€Œç¥–ä¼ äº‘æœåŠ¡å™¨å¿«ç…§ã€ï¼Œæ²¡äººçŸ¥é“è¿™ä¸ªç¯å¢ƒæ˜¯æ€ä¹ˆæ­å»ºçš„ï¼Œæ¯ä¸€ä»»æ¥æ‰‹çš„äººéƒ½åªèƒ½ç»§ç»­å¾€ä¸Šå  Buffï¼Œç„¶åå†æŠŠè¿™ä¸ªå®šæ—¶ç‚¸å¼¹ä¼ ç»™ä¸‹ä¸€ä»»ã€‚è¿™å°±åƒé‚£ä¸ªè½®æµå¾€ä¸€ä¸ªæ°´æ¯é‡ŒåŠ æ°´çš„æ¸¸æˆï¼Œæœ€ååœ¨è°åŠ æ°´çš„æ—¶å€™æº¢å‡ºæ¥äº†ï¼Œé‚£å°±ç®—ä»–å€’éœ‰ã€‚ Arch å®è´¨è¦æ±‚ä½ æŒç»­è·Ÿç€å®ƒçš„æ›´æ–°èµ°ï¼Œè¿™æ„å‘³ç€ä½ å¿…é¡»è¦æŒç»­æ›´æ–°ç»´æŠ¤å®ƒã€‚ å¦‚æœä½ æŠŠæœºå™¨æ”¾äº†ä¸€å¹´åŠè½½è·‘å¾—å¾ˆç¨³å®šï¼Œç„¶åä½ æƒ³è¦æ›´æ–°ä¸€ä¸‹ï¼Œé‚£å‡ºé—®é¢˜çš„é£é™©ä¼šç›¸å½“é«˜ã€‚å¦‚æœä½ å› æ­¤è€Œå†³å®šå¼„å°æœ€æ–°ç‰ˆæœ¬çš„ Arch æœºå™¨å†æŠŠæ—§ç¯å¢ƒè¿˜åŸå‡ºæ¥ï¼Œé‚£å°±åˆå›åˆ°äº†ä¹‹å‰çš„é—®é¢˜â€”â€”ä½ å¾—æƒ³åŠæ³•ä»æ—§ç¯å¢ƒä¸­è¿˜åŸå‡ºä½ çš„å®šåˆ¶æµç¨‹ï¼Œè¿™ä¹Ÿä¸æ˜¯ä¸ªå¥½å·®äº‹ã€‚ å¿«ç…§ä¸å½“å‰ç¡¬ä»¶ç¯å¢ƒå¼ºç›¸å…³ï¼Œç›´æ¥åœ¨ä¸åŒç¡¬ä»¶çš„æœºå™¨ä¸Šä½¿ç”¨å¾ˆå®¹æ˜“é‡åˆ°å„ç§å¥‡æ€ªçš„é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸œè¥¿ä¸å¯è¿ç§»ã€‚ å¿«ç…§æ˜¯ä¸€å †åºå¤§çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®ƒçš„ä½“ç§¯éå¸¸å¤§ï¼Œè¿™ä½¿å¾—å¤‡ä»½ä¸åˆ†äº«å®ƒçš„æˆæœ¬é«˜æ˜‚ã€‚ Docker èƒ½è§£å†³ä¸Šè¿°é—®é¢˜ä¸­çš„ä¸€éƒ¨åˆ†ã€‚é¦–å…ˆå®ƒçš„å®¹å™¨é•œåƒå¯ç”± Dockerfile å®Œå…¨æè¿°ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒæ˜¯å¯è§£é‡Šçš„ï¼Œæ­¤å¤–å®¹å™¨é•œåƒèƒ½åœ¨ä¸åŒç¯å¢ƒä¸­å¤ç°å‡ºå®Œå…¨ä¸€è‡´çš„ç¯å¢ƒï¼Œè¿™è¡¨æ˜å®ƒæ˜¯å¯è¿ç§»çš„ã€‚å¯¹äºæœåŠ¡å™¨ç¯å¢ƒï¼Œå°†åº”ç”¨ç¨‹åºå…¨éƒ½è·‘åœ¨å®¹å™¨ä¸­ï¼Œå®¿ä¸»æœºåªè´Ÿè´£è·‘å®¹å™¨ï¼Œè¿™ç§æ¶æ„ä½¿å¾—ä½ åªéœ€è¦ç»´æŠ¤æœ€åŸºç¡€çš„ç³»ç»Ÿç¯å¢ƒï¼Œä»¥åŠä¸€äº› Dockerfile è·Ÿ yaml æ–‡ä»¶ï¼Œè¿™æå¤§åœ°é™ä½äº†ç³»ç»Ÿçš„ç»´æŠ¤æˆæœ¬ï¼Œä»è€Œæˆä¸ºäº† DevOps çš„é¦–é€‰ã€‚ ä½† Docker å®¹å™¨æŠ€æœ¯æ˜¯ä¸“ä¸ºåº”ç”¨ç¨‹åºæä¾›ä¸€è‡´çš„è¿è¡Œç¯å¢ƒè€Œè®¾è®¡çš„ï¼Œåœ¨è™šæ‹Ÿæœºã€æ¡Œé¢ç¯å¢ƒç­‰åœºæ™¯ä¸‹å®ƒå¹¶ä¸é€‚ç”¨ï¼ˆå½“ç„¶ä½ éè¦è¿™ä¹ˆå¼„ä¹Ÿä¸æ˜¯ä¸è¡Œï¼Œå¾ˆéº»çƒ¦å°±æ˜¯äº†ï¼‰ã€‚æ­¤å¤– Dockerfile ä»æ—§ä¾èµ–ä½ æ‰€ç¼–å†™çš„å„ç§è„šæœ¬ã€å‘½ä»¤æ¥æ„å»ºé•œåƒï¼Œè¿™äº›è„šæœ¬ã€å‘½ä»¤éƒ½éœ€è¦ä½ è‡ªå·±ç»´æŠ¤ï¼Œå…¶è¿è¡Œç»“æœçš„å¯å¤ç°èƒ½åŠ›ä¹Ÿå®Œå…¨çœ‹ä½ è‡ªå·±çš„æ°´å¹³ã€‚ å¦‚æœä½ å› ä¸ºè¿™äº›ç»´æŠ¤éš¾é¢˜è€Œé€‰æ‹©æç®€ç­–ç•¥â€”â€”å°½å¯èƒ½å°‘åœ°å®šåˆ¶ä»»ä½•æ¡Œé¢ç³»ç»Ÿä¸è™šæ‹Ÿæœºç¯å¢ƒï¼Œèƒ½ç”¨é»˜è®¤çš„å°±ç”¨é»˜è®¤â€”â€”è¿™å°±æ˜¯æ¢åˆ° NixOS ä¹‹å‰çš„æˆ‘ã€‚ä¸ºäº†é™ä½ç³»ç»Ÿç»´æŠ¤éš¾åº¦ï¼Œæˆ‘ä»¥å‰ä½¿ç”¨ Deepin Manjaro EndeavourOS çš„è¿‡ç¨‹ä¸­ï¼ŒåŸºæœ¬æ²¡å¯¹ç³»ç»Ÿé…ç½®åšä»»ä½•å¤§å˜åŠ¨ã€‚ä½œä¸ºä¸€å SRE/DevOpsï¼Œæˆ‘åœ¨å·¥ä½œä¸­å°±å·²ç»è¸©äº†å¤Ÿå¤šçš„ç¯å¢ƒé—®é¢˜çš„å‘ï¼Œå†™è…»å†™çƒ¦å„ç§å®‰è£…è„šæœ¬ã€Ansible é…ç½®äº†ï¼Œä¸šä½™å®Œå…¨ä¸æƒ³æè¿™äº›å¹ºè›¾å­ã€‚ ä½†å¦‚æœä½ æ˜¯ä¸ªå–œæ¬¢å®šåˆ¶ä¸æ·±å…¥ç ”ç©¶ç³»ç»Ÿç»†èŠ‚çš„æå®¢ï¼Œéšç€ä½ å¯¹ç³»ç»Ÿæ‰€åšçš„å®šåˆ¶è¶Šæ¥è¶Šå¤šï¼Œè¶Šæ¥è¶Šå¤æ‚ï¼Œ æˆ–è€…ä½  Homelab ä¸äº‘ä¸Šçš„ Linux æœºå™¨è¶Šæ¥è¶Šå¤šï¼Œä½ ä¸€å®šä¼šåœ¨æŸä¸ªæ—¶é—´ç‚¹å¼€å§‹ç¼–å†™å„ç§éƒ¨ç½²æµç¨‹çš„æ–‡æ¡£ã€éƒ¨ç½²è„šæœ¬æˆ–ä½¿ç”¨ä¸€äº›è‡ªåŠ¨åŒ–å·¥å…·å¸®è‡ªå·±å®Œæˆä¸€äº›ç¹ççš„å·¥ä½œã€‚ æ–‡æ¡£å°±ä¸ç”¨è¯´äº†ï¼Œè¿™ä¸ªæ˜¾ç„¶å¾ˆå®¹æ˜“è¿‡æ—¶ï¼Œæ²¡å•¥å¤§ç”¨ã€‚å¦‚æœä½ é€‰æ‹©è‡ªå·±å†™è‡ªåŠ¨åŒ–è„šæœ¬æˆ–é€‰ç”¨è‡ªåŠ¨åŒ–å·¥å…·ï¼Œ å®ƒçš„é…ç½®ä¼šè¶Šæ¥è¶Šå¤æ‚ï¼Œè€Œä¸”ç³»ç»Ÿæ›´æ–°ç»å¸¸ä¼šç ´åæ‰å…¶ä¸­ä¸€äº›åŠŸèƒ½ï¼Œéœ€è¦ä½ æ‰‹åŠ¨ä¿®å¤ã€‚æ­¤å¤–å®ƒè¿˜é«˜åº¦ä¾èµ–ä½ å½“å‰çš„ç³»ç»Ÿç¯å¢ƒï¼Œå½“ä½ æŸå¤©è£…äº†å°æ–°æœºå™¨ç„¶åä¿¡å¿ƒæ»¡æ»¡åœ°ç”¨å®ƒéƒ¨ç½²ç¯å¢ƒæ—¶ï¼Œå¤§æ¦‚ç‡ä¼šé‡åˆ°å„ç§ç¯å¢ƒä¸ä¸€è‡´å¯¼è‡´çš„é”™è¯¯éœ€è¦æ‰‹åŠ¨è§£å†³ã€‚è¿˜æœ‰ä¸€ç‚¹æ˜¯ï¼Œä½ å†™çš„è„šæœ¬å¤§æ¦‚ç‡å¹¶æ²¡æœ‰ä»”ç»†è€ƒé‡æŠ½è±¡ã€æ¨¡å—åŒ–ã€é”™è¯¯å¤„ç†ç­‰å†…å®¹ï¼Œè¿™ä¹Ÿä¼šå¯¼è‡´éšç€è§„æ¨¡çš„æ‰©å¤§ï¼Œç»´æŠ¤å®ƒå˜å¾—è¶Šæ¥è¶Šç—›è‹¦ã€‚ ç„¶åä½ å‘ç°äº† NixOSï¼Œå®ƒæœ‰ä»€ä¹ˆå£°æ˜å¼çš„é…ç½®ï¼Œä½ ä»”ç»†çœ‹äº†ä¸‹å®ƒçš„å®ç°ï¼Œå“¦è¿™å£°æ˜å¼çš„é…ç½®ï¼Œä¸å°±æ˜¯æŠŠä¸€å † bash è„šæœ¬å°è£…äº†ä¸‹ï¼Œå¯¹ç”¨æˆ·åªæä¾›äº†ä¸€å¥—ç®€æ´å¹²å‡€çš„ api ä¹ˆï¼Œå®ƒå®é™…å¹²çš„æ´»ä¸è·Ÿæˆ‘è‡ªå·±è¿™å‡ å¹´å†™çš„ä¸€å †è„šæœ¬ä¸€æ¨¡ä¸€æ ·ï¼Ÿå¥½åƒæ²¡å•¥æ–°é²œçš„ã€‚ å—¯æ¥ç€ä½ è¯•ç”¨äº†ä¸€ä¸‹ï¼Œå‘ç° NixOS çš„è¿™å¥—ç³»ç»Ÿå®šåˆ¶è„šæœ¬éƒ½å­˜åœ¨ä¸€ä¸ªå« Nixpkgs çš„ä»“åº“ä¸­ï¼Œæœ‰æ•°åƒäººåœ¨æŒç»­ç»´æŠ¤å®ƒï¼Œå‡ åå¹´ç§¯ç´¯ä¸‹æ¥å·²ç»æ‹¥æœ‰äº†ä¸€å¥—éå¸¸ä¸°å¯Œã€ä¹Ÿæ¯”è¾ƒç¨³å®šçš„å£°æ˜å¼æŠ½è±¡ã€æ¨¡å—ç³»ç»Ÿã€ç±»å‹ç³»ç»Ÿã€ä¸“ä¸ºè¿™å¥—è¶…å¤§å‹çš„è½¯ä»¶åŒ…ä»“åº“ä¸ NixOS ç³»ç»Ÿé…ç½®è€Œå¼€å‘çš„å¤§è§„æ¨¡ CI ç³»ç»Ÿ Hydraã€ä»¥åŠé€æ¸å½¢æˆçš„èƒ½æ»¡è¶³æ•°åƒäººåä½œæ›´æ–°è¿™å¥—å¤æ‚é…ç½®çš„ç¤¾åŒºè¿è¥æ¨¡å¼ã€‚ ä½ ç«‹é©¬å­¦ä¹  nix è¯­è¨€ï¼Œç„¶ååŠ¨æ‰‹æŠŠè¿™å¥—ç»´æŠ¤äº† N å¹´çš„è„šæœ¬æ”¹å†™æˆ NixOS é…ç½®ã€‚ è¶Šå†™å°±å¯¹å®ƒè¶Šæ»¡æ„ï¼Œæ”¹é€ åçš„é…ç½®ç¼©æ°´äº†ç›¸å½“å¤šï¼Œç»´æŠ¤éš¾åº¦ç›´çº¿ä¸‹é™ã€‚ å¾ˆå¤§éƒ¨åˆ†ä»¥å‰è‡ªå·±ç”¨å„ç§è„šæœ¬è·Ÿå·¥å…·å®ç°çš„åŠŸèƒ½ï¼Œéƒ½è¢« Nixpkgs å°è£…å¥½äº†ï¼Œåªéœ€è¦ enable ä¸€ä¸‹å†ä¼ å‡ ä¸ªå…³é”®å‚æ•°ï¼Œå°±èƒ½æ— ç—›è¿è¡Œã€‚nixpkgs ä¸­çš„è„šæœ¬éƒ½æœ‰ä¸“é—¨çš„ maintainer ç»´æŠ¤æ›´æ–°ï¼Œä»»ä½•å‘ç°äº†é—®é¢˜çš„ç”¨æˆ·ä¹Ÿå¯ä»¥æä¸ª PR ä¿®ä¸‹é—®é¢˜ï¼Œåœ¨æ²¡ç»è¿‡ CI ä¸ staging unstable ç­‰å¥½å‡ ä¸ªé˜¶æ®µçš„å¹¿æ³›éªŒè¯å‰ï¼Œæ›´æ–°ä¹Ÿä¸ä¼šè¿›å…¥ stable. ä¸Šé¢æ‰€è¯´çš„ä½ ï¼Œå—¯å°±æ˜¯æˆ‘è‡ªå·±ã€‚ ç°åœ¨å›æƒ³ä¸‹æˆ‘å½“åˆå°±ä¸ºäº†ç”¨ systemd è·‘ä¸ªç®€å•çš„å°å·¥å…·è€Œè·Ÿ systemd ç–¯ç‹‚ææ–—çš„åœºæ™¯ï¼Œæ³ªç›®â€¦ è¦æ˜¯æˆ‘å½“åˆå°±æ‡‚ NixOSâ€¦ ","date":"2024-02-21","objectID":"/posts/my-experience-of-nixos/:2:0","series":["NixOS ä¸ Nix Flakes"],"tags":["NixOS","Nix","Flakes","Linux","DevOps"],"title":"OS as Code - æˆ‘çš„ NixOS ä½¿ç”¨ä½“ä¼š","uri":"/posts/my-experience-of-nixos/#is-nixos-worth-learning"},{"categories":["tech"],"content":" NixOS çš„å£°æ˜å¼é…ç½® - OS as Codeæœ‰è¿‡ä¸€å®šç¼–ç¨‹ç»éªŒçš„äººéƒ½åº”è¯¥çŸ¥é“æŠ½è±¡ä¸æ¨¡å—åŒ–çš„é‡è¦æ€§ï¼Œå¤æ‚ç¨‹åº¦è¶Šé«˜çš„åœºæ™¯ï¼ŒæŠ½è±¡ä¸æ¨¡å—åŒ–å¸¦æ¥çš„æ”¶ç›Šå°±è¶Šé«˜ã€‚Terraformã€Kubernetes ç”šè‡³ Spring Boot çš„æµè¡Œéƒ½ä½“ç°äº†è¿™ä¸€ç‚¹ã€‚NixOS çš„å£°æ˜å¼é…ç½®ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå®ƒå°†åº•å±‚çš„å®ç°ç»†èŠ‚éƒ½å°è£…èµ·æ¥äº†ï¼Œå¹¶ä¸”è¿™äº›åº•å±‚å°è£…å¤§éƒ½æœ‰ç¤¾åŒºè´Ÿè´£æ›´æ–°ç»´æŠ¤ï¼Œè¿˜æœ‰ PR Reviewã€CI ä¸å¤šé˜¶æ®µçš„æµ‹è¯•éªŒè¯ç¡®ä¿å…¶å¯é æ€§ï¼Œè¿™æå¤§åœ°é™ä½äº†æˆ‘çš„å¿ƒæ™ºè´Ÿæ‹…ï¼Œä»è€Œè§£æ”¾äº†æˆ‘çš„ç”Ÿäº§åŠ›ã€‚å®ƒçš„å¯å¤ç°èƒ½åŠ›åˆ™å…é™¤äº†æˆ‘çš„åé¡¾ä¹‹å¿§ï¼Œè®©æˆ‘ä¸å†æ‹…å¿ƒæåç³»ç»Ÿã€‚ NixOS æ„å»ºåœ¨ Nix å‡½æ•°å¼åŒ…ç®¡ç†å™¨è¿™ä¸Šï¼Œå®ƒçš„è®¾è®¡ç†å¿µæ¥è‡ª Eelco Dolstra çš„è®ºæ–‡ The Purely Functional Software Deployment Modelï¼ˆçº¯å‡½æ•°å¼è½¯ä»¶éƒ¨ç½²æ¨¡å‹ï¼‰ï¼Œçº¯å‡½æ•°å¼æ˜¯æŒ‡å®ƒæ²¡æœ‰å‰¯ä½œç”¨ï¼Œ å°±ç±»ä¼¼æ•°å­¦å‡½æ•° $y = f(x)$ï¼ŒåŒæ ·çš„ NixOS é…ç½®æ–‡ä»¶ï¼ˆå³è¾“å…¥å‚æ•° $x$ ï¼‰æ€»æ˜¯èƒ½å¾—åˆ°åŒæ ·çš„ NixOS ç³»ç»Ÿç¯å¢ƒï¼ˆå³è¾“å‡º $y$ï¼‰ã€‚ è¿™ä¹Ÿå°±æ˜¯è¯´ NixOS çš„é…ç½®å£°æ˜äº†æ•´ä¸ªç³»ç»Ÿå®Œæ•´çš„çŠ¶æ€ï¼ŒOS as Codeï¼ åªè¦ä½  NixOS ç³»ç»Ÿçš„è¿™ä»½æºä»£ç æ²¡ä¸¢ï¼Œå¯¹å®ƒè¿›è¡Œä¿®æ”¹ã€å®¡æŸ¥ï¼Œå°†æºä»£ç åˆ†äº«ç»™åˆ«äººï¼Œæˆ–è€…ä»åˆ«äººçš„æºä»£ç ä¸­å€Ÿé‰´ä¸€äº›è‡ªå·±æƒ³è¦çš„åŠŸèƒ½ï¼Œéƒ½æ˜¯éå¸¸å®¹æ˜“çš„ã€‚ä½ ç®€å•çš„æŠ„ç‚¹å…¶ä»– NixOS ç”¨æˆ·çš„ç³»ç»Ÿé…ç½®å°±èƒ½å¾ˆç¡®å®šè‡ªå·±å°†å¾—åˆ°åŒæ ·çš„ç¯å¢ƒã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œä½ æŠ„å…¶ä»– Arch/Ubuntu ç­‰ä¼ ç»Ÿå‘è¡Œç‰ˆç”¨æˆ·çš„é…ç½®å°±è¦éº»çƒ¦çš„å¤šï¼Œè¦è€ƒè™‘å„ç§ç‰ˆæœ¬åŒºåˆ«ã€ç¯å¢ƒåŒºåˆ«ï¼Œä¸ç¡®å®šæ€§å¾ˆé«˜ã€‚ ","date":"2024-02-21","objectID":"/posts/my-experience-of-nixos/:3:0","series":["NixOS ä¸ Nix Flakes"],"tags":["NixOS","Nix","Flakes","Linux","DevOps"],"title":"OS as Code - æˆ‘çš„ NixOS ä½¿ç”¨ä½“ä¼š","uri":"/posts/my-experience-of-nixos/#nixos-declarative-configuration"},{"categories":["tech"],"content":" NixOS çš„å­¦ä¹ æˆæœ¬NixOS çš„å…¥é—¨é—¨æ§›ç›¸å¯¹è¾ƒé«˜ï¼Œä¹Ÿä¸é€‚åˆä»æ¥æ²¡æ¥è§¦è¿‡ Linux ä¸ç¼–ç¨‹çš„å°ç™½ï¼Œè¿™æ˜¯å› ä¸ºå®ƒçš„è®¾è®¡ç†å¿µä¸ä¼ ç»Ÿ Linux å‘è¡Œç‰ˆæœ‰å¾ˆå¤§ä¸åŒã€‚ä½†è¿™ä¹Ÿæ˜¯å®ƒçš„ä¼˜åŠ¿æ‰€åœ¨ï¼Œè·¨è¿‡é‚£é“é—¨æ§›ï¼Œä½ ä¼šå‘ç°ä¸€ç‰‡æ–°å¤©åœ°ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼ŒNixOS ç”¨æˆ·ç¿» Nixpkgs ä¸­çš„å®ç°æºç å®é™…æ˜¯æ¯ä¸ªç”¨æˆ·çš„åŸºæœ¬æŠ€èƒ½ï¼Œç»™ Nixpkgs æ PR åŠ åŠŸèƒ½ã€åŠ åŒ…æˆ–è€…ä¿® Bug çš„ NixOS ç”¨æˆ·ä¹Ÿç›¸å½“å¸¸è§ã€‚ è¿™æ—¢æ˜¯ä½¿æ–°ç”¨æˆ·æœ›è€Œå´æ­¥çš„æ‹¦è·¯ä¹‹è™ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ç»™é€‰æ‹©äº† NixOS çš„ Linux ç”¨æˆ·æä¾›çš„è¿›é˜¶ä¹‹æ¢¯ã€‚ æƒ³è±¡ä¸‹å¤§éƒ¨åˆ† Arch ç”¨æˆ·ï¼ˆæ¯”å¦‚ä»¥å‰çš„æˆ‘ï¼‰å¯èƒ½ç”¨äº†å¥½å‡ å¹´ Archï¼Œä½†æ ¹æœ¬ä¸äº†è§£ Arch åº•å±‚çš„å®ç°ç»†èŠ‚ï¼Œæ²¡æ‰“è¿‡è‡ªå·±çš„åŒ…ã€‚è€Œ NixOS èƒ½è®©ç¿»æºç æˆä¸ºå¸¸æ€ï¼Œå®é™…ä¹Ÿè¯´æ˜ç†è§£å®ƒçš„å®ç°ç»†èŠ‚å¹¶ä¸éš¾ã€‚æˆ‘ä»ä¸¤ä¸ªæ–¹é¢æ¥è¯´æ˜è¿™ä¸€ç‚¹ã€‚ ç¬¬ä¸€ï¼ŒNix æ˜¯ä¸€é—¨ç›¸å½“ç®€å•çš„è¯­è¨€ï¼Œè¯­æ³•è§„åˆ™ç›¸å½“å°‘ï¼Œæ¯” Java Python è¿™ç§é€šç”¨è¯­è¨€ç®€å•äº†å¤ªå¤šã€‚å› æ­¤æœ‰ä¸€å®šç¼–ç¨‹ç»éªŒçš„å·¥ç¨‹å¸ˆèƒ½èŠ±ä¸¤ä¸‰ä¸ªå°æ—¶å°±å®Œæ•´è¿‡ä¸€éå®ƒçš„è¯­æ³•ã€‚å†å¤šèŠ±ä¸€ç‚¹æ—¶é—´ï¼Œè¯»äº›å¸¸è§ Nix ä»£ç å°±æ²¡å•¥éš¾åº¦äº†ã€‚ ç¬¬äºŒï¼ŒNixOS è‰¯å¥½çš„å£°æ˜å¼æŠ½è±¡ä¸æ¨¡å—åŒ–ç³»ç»Ÿï¼Œå°† OS åˆ†æˆäº†è®¸å¤šå±‚æ¥å®ç°ï¼Œä½¿ç”¨æˆ·åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œ æ—¢å¯ä»¥åªå…³æ³¨å½“å‰è¿™ä¸€å±‚æŠ½è±¡æ¥å£ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©å†æ·±å…¥åˆ°ä¸‹ä¸€å±‚æŠ½è±¡æ¥æ›´è‡ªç”±åœ°å®ç°è‡ªå·±æƒ³è¦çš„åŠŸèƒ½ï¼ˆè¿™ç§é€‰æ‹©çš„æƒåˆ©ï¼Œå®é™…ä¹Ÿç»™äº†ç”¨æˆ·æœºä¼šå»æ¸è¿›å¼åœ°ç†è§£ NixOS æœ¬èº«ï¼‰ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œæ–°æ‰‹ç”¨æˆ·åªè¦æ‡‚æœ€ä¸Šå±‚çš„æŠ½è±¡å°±æ­£å¸¸ä½¿ç”¨ NixOSã€‚å½“ä½ æœ‰äº†ä¸€ç‚¹ä½¿ç”¨ç»éªŒï¼Œæƒ³å®ç°äº›è‡ªå®šä¹‰éœ€æ±‚ï¼ŒæŒ–ä¸‹æ·±æŒ–ä¸€å±‚æŠ½è±¡ï¼ˆæ¯”å¦‚è¯´ç›´æ¥é€šè¿‡ systemd çš„å£°æ˜å¼å‚æ•°è‡ªå®šä¹‰ä¸€äº›æ“ä½œï¼‰é€šå¸¸å°±è¶³å¤Ÿäº†ã€‚å¦‚æœä½ å·²ç»æ˜¯ä¸ª NixOS ç†Ÿæ‰‹ï¼Œæƒ³æ›´æå®¢ä¸€ç‚¹ï¼Œå°±å¯ä»¥å†ç»§ç»­å¾€ä¸‹æŒ–ã€‚ æ€»ä¹‹å› ä¸ºä¸Šé¢è¿™ä¸¤ç‚¹ï¼Œç†è§£ Nixpkgs ä¸­çš„æºç æˆ–è€…ä½¿ç”¨ Nix è¯­è¨€è‡ªå·±æ‰“å‡ ä¸ªåŒ…å¹¶ä¸éš¾ï¼Œå¯ä»¥è¯´æ¯ä¸ªæœ‰ä¸€å®šç»éªŒçš„ NixOS ç”¨æˆ·åŒæ—¶ä¹Ÿä¼šæ˜¯ NixOS æ‰“åŒ…äººã€‚ ","date":"2024-02-21","objectID":"/posts/my-experience-of-nixos/:4:0","series":["NixOS ä¸ Nix Flakes"],"tags":["NixOS","Nix","Flakes","Linux","DevOps"],"title":"OS as Code - æˆ‘çš„ NixOS ä½¿ç”¨ä½“ä¼š","uri":"/posts/my-experience-of-nixos/#nixos-learning-curve"},{"categories":["tech"],"content":" NixOS çš„å–ç‚¹ï¼Ÿæˆ‘ä»¬çœ‹äº†è®¸å¤šäººæåˆ° NixOS çš„ä¼˜ç‚¹ï¼Œä¸Šé¢æˆ‘ä¹Ÿæåˆ°äº†ä¸å°‘ã€‚Nix çš„åœˆå¤–äººå¬å¾—æ¯”è¾ƒå¤šçš„å¯èƒ½ä¸»è¦æ˜¯å®ƒè§£å†³äº†ä¾èµ–å†²çªé—®é¢˜ï¼Œèƒ½éšæ—¶å›æ»šï¼Œå¼ºå¤§çš„å¯å¤ç°èƒ½åŠ›ã€‚å¦‚æœä½ æœ‰å®é™…ä½¿ç”¨è¿‡ NixOSï¼Œé‚£ä½ ä¹Ÿåº”è¯¥çŸ¥é“ NixOS çš„è¿™äº›ä¼˜åŠ¿ï¼š NixOS çš„ Flakes ç‰¹æ€§ä½¿ä½ èƒ½å°†ç³»ç»Ÿé”å®šåœ¨ä¸€ä¸ªç‰¹å®šçš„çŠ¶æ€ï¼Œä½ å¯ä»¥åœ¨ä»»ä½•æƒ³æ›´æ–°çš„æ—¶å€™æ‰æ›´æ–°å®ƒï¼Œå³ä½¿æœ‰ä¸ªä¸€å¹´åŠè½½ä¸æ›´æ–°ä¹Ÿå®Œå…¨æ²¡æ¯›ç—…ã€‚NixOS ä¸ä¼šå¼ºè¿«ä½ é¢‘ç¹æ›´æ–°ç³»ç»Ÿï¼Œä½ å¯ä»¥é€‰æ‹©æ˜¯å¦è¿™ä¹ˆåšã€‚å› ä¸ºç³»ç»Ÿçš„çŠ¶æ€å¯ä»¥å®Œå…¨ä»ä½ çš„ NixOS é…ç½®ä¸­æ¨æ–­å‡ºæ¥ï¼Œæ‰€ä»¥ä»æ—§ç‰ˆæœ¬å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ä¹Ÿå®¹æ˜“å¾ˆå¤šã€‚ æœ‰çš„é€‰æ€»æ˜¯å¥½çš„ï¼Œæˆ‘ä¸å–œæ¬¢è¢«å¼ºè¿«é¢‘ç¹æ›´æ–°ï¼ˆå³ä½¿æˆ‘å®é™…æ›´æ–°è¿˜æŒºé¢‘ç¹çš„ï¼‰ï¼Œå…¬å¸é‡Œçš„ç³»ç»Ÿç®¡ç†å‘˜æˆ–è€… DevOps å°±æ›´æ˜¯å¦‚æ­¤äº†ã€‚ ç³»ç»Ÿæ›´æ–°å…·æœ‰ç±»ä¼¼æ•°æ®åº“äº‹åŠ¡çš„åŸå­åŒ–ç‰¹æ€§ï¼Œè¿™æ„å‘³ç€ä½ çš„ç³»ç»Ÿæ›´æ–°è¦ä¹ˆæˆåŠŸè¦ä¹ˆå¤±è´¥ï¼Œï¼ˆä¸€èˆ¬ï¼‰ ä¸ä¼šå‡ºç°ä¸­é—´çŠ¶æ€ã€‚ NixOS çš„å£°æ˜å¼é…ç½®å®é™…å®ç°äº† OS as Codeï¼Œè¿™ä½¿å¾—è¿™äº›é…ç½®éå¸¸ä¾¿äºåˆ†äº«ã€‚ç›´æ¥åœ¨ GitHub ä¸Šä»å…¶ä»– NixOS ç”¨æˆ·é‚£é‡Œ Copy éœ€è¦çš„ä»£ç åˆ°ä½ çš„ç³»ç»Ÿé…ç½®ä¸­ï¼Œä½ å°±èƒ½å¾—åˆ°ä¸€ä¸ªä¸€æ¨¡ä¸€æ ·çš„åŠŸèƒ½ã€‚æ–°æ‰‹ç”¨æˆ·ä¹Ÿèƒ½å¾ˆå®¹æ˜“åœ°ä»åˆ«äººçš„é…ç½®ä¸­å­¦åˆ°å¾ˆå¤šä¸œè¥¿ã€‚ è¿™ä¹Ÿæ˜¯è¿‘å‡ å¹´ GitHub ä¸ reddit r/unixporn ä¸Šä½¿ç”¨ NixOS åšæ¡Œé¢ ricing çš„ç”¨æˆ·è¶Šæ¥è¶Šå¤šçš„åŸå› ã€‚ å£°æ˜å¼é…ç½®ä¸ºç”¨æˆ·æä¾›äº†é«˜åº¦ä¾¿æ·çš„ç³»ç»Ÿè‡ªå®šä¹‰èƒ½åŠ›ï¼Œé€šè¿‡æ”¹å‡ è¡Œé…ç½®ï¼Œå°±å¯ä»¥å¿«é€Ÿæ›´æ¢ç³»ç»Ÿçš„å„ç§ç»„ä»¶ã€‚ ç­‰ç­‰ è¿™äº›éƒ½æ˜¯ NixOS çš„å–ç‚¹ï¼Œå…¶ä¸­ä¸€äº›ç‰¹æ€§ç°åœ¨åœ¨ä¼ ç»Ÿå‘è¡Œç‰ˆä¸Šä¹Ÿèƒ½å®ç°ï¼ŒFedora Silverblue ç­‰æ–°å…´çš„ä¸å¯å˜å‘è¡Œç‰ˆä¹Ÿåœ¨è¿™äº›æ–¹é¢æœ‰äº›ä¸é”™çš„åˆ›æ–°ã€‚ä½†èƒ½è§£å†³æ‰€æœ‰è¿™äº›é—®é¢˜çš„ç³»ç»Ÿï¼Œç›®å‰åªæœ‰ NixOSï¼ˆä»¥åŠæ›´å°ä¼—çš„ Guix. æ®Guix çš„ README æ‰€è¨€ï¼Œå®ƒåŒæ ·åŸºäº Nix åŒ…ç®¡ç†å™¨ï¼‰ã€‚ ","date":"2024-02-21","objectID":"/posts/my-experience-of-nixos/:5:0","series":["NixOS ä¸ Nix Flakes"],"tags":["NixOS","Nix","Flakes","Linux","DevOps"],"title":"OS as Code - æˆ‘çš„ NixOS ä½¿ç”¨ä½“ä¼š","uri":"/posts/my-experience-of-nixos/#nixos-advantages"},{"categories":["tech"],"content":" NixOS çš„ç¼ºç‚¹ä¸å†å²å€ºåŠ¡è‡ª NixOS é¡¹ç›®åˆ›å»ºè‡³ä»ŠäºŒåå¤šå¹´æ¥ï¼ŒNix åŒ…ç®¡ç†å™¨ä¸ NixOS æ“ä½œç³»ç»Ÿä¸€ç›´æ˜¯éå¸¸å°ä¼—çš„æŠ€æœ¯ï¼Œå°¤å…¶æ˜¯åœ¨å›½å†…ï¼ŒçŸ¥é“å®ƒä»¬å­˜åœ¨çš„äººéƒ½æ˜¯å°‘æ•° Linux æå®¢ï¼Œæ›´åˆ«è¯´ä½¿ç”¨å®ƒä»¬äº†ã€‚ NixOS å¾ˆç‰¹æ®Šï¼Œå¾ˆå¼ºå¤§ï¼Œä½†å¦ä¸€æ–¹é¢å®ƒä¹Ÿæœ‰ç€ç›¸å½“å¤šçš„å†å²å€ºåŠ¡ï¼Œæ¯”å¦‚è¯´ï¼š æ–‡æ¡£æ··ä¹±ä¸è¯´äººè¯ Flakes ç‰¹æ€§ä½¿ NixOS çœŸæ­£æ»¡è¶³äº†å®ƒä¸€ç›´å®£ç§°çš„å¯å¤ç°èƒ½åŠ›ï¼Œä½†ä» 2021 å¹´æ­£å¼å‘å¸ƒåˆ°ç°åœ¨ 2024 å¹´ï¼Œå®ƒä»æ—§å¤„åœ¨å®éªŒçŠ¶æ€ã€‚ Nix çš„ CLI å¤„åœ¨æ¢ä»£æœŸï¼Œæ–°ç‰ˆæœ¬çš„ CLI ä¼˜é›…å¾ˆå¤šï¼Œä½†å…¶å®ç°ç›®å‰ä¸ Flakes ç‰¹æ€§å¼ºç»‘å®šï¼Œå¯¼è‡´ä¸¤é¡¹åŠŸèƒ½éƒ½éš¾ä»¥ stableï¼Œç”šè‡³è¿˜é˜»ç¢äº†è®¸å¤šå…¶ä»–ç‰¹æ€§çš„å¼€å‘å·¥ä½œã€‚ æ¨¡å—ç³»ç»Ÿçš„ç¼ºé™·ä¸ Nix é”™è¯¯å¤„ç†æ–¹é¢çš„ä¸è¶³ï¼Œå¯¼è‡´é•¿æœŸä»¥æ¥å®ƒçš„æŠ¥é”™ä¿¡æ¯ç›¸å½“éšæ™¦ï¼Œä»¤äººæŠ“ç‹‚ Nix è¯­è¨€å¤ªè¿‡ç®€å•å¯¼è‡´ Nixpkgs ä¸­å¤§é‡ä½¿ç”¨ Bash è„šæœ¬ï¼Œä»¥åŠ Nix è¯­è¨€çš„å¤§å¤šæ•°ç‰¹æ€§éƒ½å®Œå…¨æ˜¯ä½¿ç”¨ C++ å®ç°çš„ï¼Œä» Nix è¯­è¨€çš„è§’åº¦çœ‹è¿™å¾ˆé»‘ç›’ã€‚ NixOS çš„å¤§é‡å®ç°ç»†èŠ‚éšè—åœ¨ Nixpkgs æºç ä¸­ï¼Œæ¯”å¦‚è¯´è½¯ä»¶åŒ…çš„åˆ†ç±»ã€derivation æœ‰å“ªäº›å±æ€§å¯è¢« overrideã€‚ Nixpkgs é•¿æœŸä¸€ç›´ä½¿ç”¨æ–‡ä»¶å¤¹æ¥å¯¹è½¯ä»¶åŒ…è¿›è¡Œåˆ†ç±»ï¼Œæ²¡æœ‰ä»»ä½•æŸ¥çœ‹æºç ä¹‹å¤–çš„æ‰‹æ®µæ¥åˆ†ç±»æŸ¥è¯¢å…¶ä¸­çš„è½¯ä»¶åŒ…ã€‚ Nixpkgs ä¸­çš„æ‰€æœ‰ derivation ç›¸å…³ä¿¡æ¯ï¼Œç›®å‰ä¹Ÿåªèƒ½é€šè¿‡æŸ¥çœ‹æºç æ¥äº†è§£ã€‚ https://nixos.wiki ç«™ç‚¹ç»´æŠ¤è€…è·‘è·¯ï¼Œå®˜æ–¹åˆé•¿æœŸæœªæä¾›æ›¿ä»£å“ï¼Œå¯¼è‡´ NixOS çš„æ–‡æ¡£åœ¨æœ¬æ¥å°±å¾ˆçƒ‚çš„åŸºç¡€ä¸Šåˆé›ªä¸ŠåŠ éœœã€‚ Nix/NixOS è¿‘æ¥å¿«é€Ÿå¢é•¿çš„ç”¨æˆ·ç¾¤ä½“ï¼Œä½¿å¾—å®ƒçš„ç¤¾åŒºè¿è¥æ¨¡å¼ä¹Ÿé¢ä¸´ç€æŒ‘æˆ˜ â€¦ è¿™ä¸€å †å†å²å€ºæ˜¯ NixOS ä¸€ç›´æ²¡èƒ½å¾—åˆ°æ›´å¹¿æ³›ä½¿ç”¨çš„ä¸»è¦åŸå› ã€‚ä½†è¿™äº›é—®é¢˜ä¹Ÿæ˜¯ NixOS æœªæ¥çš„æœºä¼šï¼Œç¤¾åŒºç›®å‰æ­£åœ¨ç§¯æè§£å†³è¿™äº›é—®é¢˜ï¼Œæˆ‘å¾ˆæœŸå¾…çœ‹åˆ°è¿™äº›é—®é¢˜è¢«è§£å†³åï¼Œ NixOS å°†ä¼šæœ‰æ€æ ·çš„å‘å±•ã€‚ ","date":"2024-02-21","objectID":"/posts/my-experience-of-nixos/:6:0","series":["NixOS ä¸ Nix Flakes"],"tags":["NixOS","Nix","Flakes","Linux","DevOps"],"title":"OS as Code - æˆ‘çš„ NixOS ä½¿ç”¨ä½“ä¼š","uri":"/posts/my-experience-of-nixos/#nixos-disadvantages"},{"categories":["tech"],"content":" NixOS çš„æœªæ¥è°ä¹Ÿä¸ä¼šå¯¹ä¸€é¡¹æ²¡å‰é€”çš„æŠ€æœ¯æ„Ÿå…´è¶£ï¼Œé‚£ä¹ˆ NixOS çš„æœªæ¥å¦‚ä½•å‘¢ï¼Ÿæˆ‘æ˜¯å¦çœ‹å¥½å®ƒï¼Ÿè¿™é‡Œæˆ‘å°è¯•ä½¿ç”¨ä¸€äº›æ•°æ®æ¥è¯´æ˜æˆ‘å¯¹ NixOS çš„æœªæ¥çš„çœ‹æ³•ã€‚ é¦–å…ˆçœ‹ Nixpkgs é¡¹ç›®ï¼Œå®ƒå­˜å‚¨äº† NixOS æ‰€æœ‰çš„è½¯ä»¶åŒ…åŠ NixOS è‡ªèº«çš„å®ç°ä»£ç ï¼š ä¸Šå›¾èƒ½çœ‹åˆ°ä» 2021 å¹´å¼€å§‹ Nixpkgs é¡¹ç›®çš„æ´»è·ƒåº¦å¼€å§‹æŒç»­ä¸Šå‡ï¼ŒTop 6 è´¡çŒ®è€…ä¸­æœ‰ 3 ä½éƒ½æ˜¯ 2021 å¹´ä¹‹åå¼€å§‹å¤§é‡æäº¤ä»£ç ï¼Œä½ ç‚¹è¿› GitHub çœ‹ï¼Œèƒ½çœ‹åˆ° Top 10 è´¡çŒ®è€…ä¸­æœ‰ 5 ä½éƒ½æ˜¯ 2021 å¹´ä¹‹ååŠ å…¥ç¤¾åŒºçš„ï¼ˆæ–°å¢çš„ @NickCao ä¸ @figsoda éƒ½æ˜¯ NixOS ä¸­æ–‡ç¤¾åŒºèµ„æ·±ç”¨æˆ·ï¼‰ã€‚ å†çœ‹çœ‹ Nix åŒ…ç®¡ç†å™¨çš„æäº¤è®°å½•ï¼Œå®ƒæ˜¯ NixOS çš„åº•å±‚æŠ€æœ¯ï¼š ä¸Šå›¾æ˜¾ç¤º Nix é¡¹ç›®çš„æ´»è·ƒåº¦åœ¨ 2020 å¹´æ˜æ˜¾ä¸Šå‡ï¼ŒTop 6 è´¡çŒ®è€…ä¸­æœ‰ 5 ä½éƒ½æ˜¯åœ¨ 2020 å¹´ä¹‹åæ‰å¼€å§‹å¤§é‡è´¡çŒ®ä»£ç çš„ã€‚ å†çœ‹çœ‹ Google Trends ä¸­ NixOS è¿™ä¸ªå…³é”®è¯çš„æœç´¢çƒ­åº¦ï¼š è¿™ä¸ªå›¾æ˜¾ç¤º NixOS çš„æœç´¢çƒ­åº¦æœ‰å‡ ä¸ªæ˜æ˜¾çš„ä¸Šå‡æ—¶é—´ç‚¹ï¼š 2021 å¹´ 12 å¹´ è¿™å¤§æ¦‚ç‡æ˜¯å› ä¸ºåœ¨ 2021 å¹´ 11 æœˆNix 2.4 å‘å¸ƒäº†ï¼Œå®ƒå¸¦æ¥äº†å®éªŒæ€§çš„ Flakes ç‰¹æ€§ä¸æ–°ç‰ˆ CLIï¼ŒFlakes ä½¿å¾— NixOS çš„å¯å¤ç°èƒ½åŠ›å¾—åˆ°äº†æå¤§çš„æå‡ï¼Œæ–° CLI ä¹Ÿæ›´ç¬¦åˆç”¨æˆ·ç›´è§‰ã€‚ 2023 å¹´ 6 æœˆ æœ€é‡è¦çš„åŸå› åº”è¯¥æ˜¯ï¼ŒYoutube ä¸Š Linux ç›¸å…³çš„çƒ­é—¨é¢‘é“åœ¨è¿™ä¸ªæ—¶é—´ç‚¹æ¨å‡ºäº†å¥½å‡ ä¸ªå…³äº NixOS çš„è§†é¢‘ï¼Œæˆªè‡³ 2024-02-23ï¼ŒYoutube ä¸Šæ’­æ”¾é‡æœ€é«˜çš„ä¸‰ä¸ª NixOS ç›¸å…³è§†é¢‘éƒ½æ˜¯åœ¨ 2023-06 ~ 2023-07 è¿™ä¸ªæ—¶é—´æ®µæ¨å‡ºçš„ï¼Œå®ƒä»¬çš„æ’­æ”¾é‡ä¹‹å’Œè¶…è¿‡äº† 130 ä¸‡ã€‚ China çš„å…´è¶£æŒ‡æ•°åœ¨è¿‘æœŸæœ€é«˜ï¼Œè¿™å¯èƒ½æ˜¯å› ä¸ºå›½å†…çš„ç”¨æˆ·ç¾¤ä¸€ç›´å¾ˆå°‘ï¼Œç„¶åæˆ‘åœ¨ 6 æœˆä»½å‘å¸ƒäº†NixOS ä¸ Flakes - ä¸€ä»½éå®˜æ–¹çš„æ–°æ‰‹æŒ‡å—ï¼Œ å¹¶ä¸”åœ¨ ç§‘æŠ€çˆ±å¥½è€…å‘¨åˆŠ ç­‰æ¸ é“åšäº†äº›æ¨å¹¿ï¼Œå¯¼è‡´ NixOS çš„ç›¸å¯¹æŒ‡æ•°å‡ºç°æ˜æ˜¾ä¸Šå‡ã€‚ 2024 å¹´ 1 æœˆ è¿™ä¸ªæˆ‘ç›®å‰ä¸å¤ªç¡®å®šåŸå› ã€‚ å†çœ‹çœ‹ Nix/NixOS ç¤¾åŒºä» 2022 å¹´å¯ç”¨çš„å¹´åº¦ç”¨æˆ·è°ƒæŸ¥ã€‚ 2022 Nix Survey Resultsï¼Œ æ ¹æ®å…¶ä¸­æ•°æ®è®¡ç®—å¯å¾—å‡ºï¼š 74.5% çš„ç”¨æˆ·æ˜¯åœ¨ä¸‰å¹´å†…å¼€å§‹ä½¿ç”¨ Nix/NixOS çš„ã€‚ å…³äºå¦‚ä½•æ‹“å±• Nixpkgs çš„è°ƒæŸ¥ä¸­ï¼Œ36.7% çš„ç”¨æˆ·ä½¿ç”¨ Flakes ç‰¹æ€§æ‹“å±• Nixpkgsï¼Œä»…æ¬¡äºä¼ ç»Ÿçš„ overlays. Nix Community Survey 2023 Resultsï¼Œ ç®€å•è®¡ç®—å¯å¾—å‡ºï¼Œ 54.1% çš„ç”¨æˆ·æ˜¯åœ¨ä¸‰å¹´å†…å¼€å§‹ä½¿ç”¨ Nix/NixOS çš„ã€‚ å…³äºå¦‚ä½•æ‹“å±• Nixpkgs çš„è°ƒæŸ¥ä¸­ï¼Œä½¿ç”¨ Flakes ç‰¹æ€§çš„ç”¨æˆ·å æ¯”ä¸º 49.2%ï¼Œè¶…è¿‡äº†ä¼ ç»Ÿçš„ Overlays. å…³äºå®éªŒç‰¹æ€§çš„è°ƒæŸ¥ä¸­ï¼Œä½¿ç”¨ Flakes ç‰¹æ€§çš„ç”¨æˆ·å æ¯”å·²ç»è¾¾åˆ°äº† 59.1%. 2024-04-12 æ›´æ–°ï¼šNixCon 2024 ä¹Ÿæœ‰ä¸€ä¸ªæ¼”è®²æä¾›äº† Nix ç¤¾åŒºçš„å„ç§å†å²æ•°æ®ï¼šNix, State of the Union - NixCon 2024 å¦å¤– GitHub çš„Octoverse 2023 ä¹Ÿéš¾å¾—åœ°æäº†ä¸€å˜´ Nixpkgs: Developers see benefits to combining packages and containerization. As we noted earlier, 4.3 million repositories used Docker in 2023. \u003e On the other side of the coin, Linux distribution NixOS/nixpkgs has been on the top list of open source projects by contributor for the last two years. è¿™äº›æ•°æ®ä¸æˆ‘ä»¬å‰é¢æåˆ°çš„ Nixpkgs ä¸ Nix é¡¹ç›®çš„æ´»è·ƒåº¦ç›¸ç¬¦ï¼Œéƒ½æ˜¾ç¤º Nix/NixOS ç¤¾åŒºåœ¨ 2021 å¹´ä¹‹åå¼€å§‹è¿…é€Ÿå¢é•¿å£®å¤§ã€‚ ç»“åˆä¸Šé¢è¿™äº›æ•°æ®çœ‹ï¼Œæˆ‘å¯¹ NixOS çš„æœªæ¥æŒå¾ˆä¹è§‚çš„æ€åº¦ã€‚ ","date":"2024-02-21","objectID":"/posts/my-experience-of-nixos/:7:0","series":["NixOS ä¸ Nix Flakes"],"tags":["NixOS","Nix","Flakes","Linux","DevOps"],"title":"OS as Code - æˆ‘çš„ NixOS ä½¿ç”¨ä½“ä¼š","uri":"/posts/my-experience-of-nixos/#nixos-future"},{"categories":["tech"],"content":" æ€»ç»“ä»å†³å®šå…¥å‘ NixOS åˆ°ç°åœ¨ï¼ŒçŸ­çŸ­ 10 ä¸ªæœˆï¼Œæˆ‘åœ¨ Linux ä¸Šå–å¾—çš„æ”¶è·è¿œè¶…è¿‡å»ä¸‰å¹´ã€‚æˆ‘å·²ç»åœ¨ PC ä¸Šå°è¯•äº†éå¸¸å¤šçš„æ–°æŠ€æœ¯æ–°å·¥å…·ï¼Œæˆ‘çš„ Homelab å†…å®¹ä¹Ÿä¸°å¯Œäº†éå¸¸å¤šï¼ˆæˆ‘ç›®å‰å·²ç»æœ‰äº†åå¤šå° NixOS ä¸»æœºï¼‰ï¼Œæˆ‘å¯¹ Linux ç³»ç»Ÿç»“æ„çš„äº†è§£ä¹Ÿè¶Šæ¥è¶Šæ·±åˆ»ã€‚ å…‰æ˜¯è¿™å‡ ç‚¹æ”¶è·ï¼Œå°±å®Œå…¨å€¼å›ç¥¨ä»·äº†ï¼Œæ¬¢è¿å…¥å‘ NixOS~ ","date":"2024-02-21","objectID":"/posts/my-experience-of-nixos/:8:0","series":["NixOS ä¸ Nix Flakes"],"tags":["NixOS","Nix","Flakes","Linux","DevOps"],"title":"OS as Code - æˆ‘çš„ NixOS ä½¿ç”¨ä½“ä¼š","uri":"/posts/my-experience-of-nixos/#conclusion"},{"categories":["tech"],"content":" é›¶ã€å‰è¨€åœ¨æ¥è§¦ç”µè„‘ä»¥æ¥å¾ˆé•¿çš„ä¸€æ®µæ—¶é—´é‡Œï¼Œæˆ‘éƒ½æ²¡æ€ä¹ˆåœ¨æ„è‡ªå·±çš„æ•°æ®å®‰å…¨ã€‚æ¯”å¦‚è¯´ï¼š é•¿æœŸä½¿ç”¨ä¸€ä¸ªæ²¡æœ‰ passphrase ä¿æŠ¤çš„ SSH å¯†é’¥ï¼ˆRSA 2048 ä½ï¼‰ï¼Œä¸ºäº†æ–¹ä¾¿æˆ‘è¿˜æŠŠå®ƒå­˜åˆ°äº† onedrive é‡Œï¼Œè€Œä¸”åœ¨å„ç§éœ€è¦è®¿é—® GitHub/Gitee æˆ– SSH æƒé™çš„è™šæ‹Ÿæœºè·Ÿ PC ä¸Šä¼ æ¥ä¼ å»ã€‚ Homelab è·Ÿæ¡Œé¢ PC éƒ½ä»æ¥æ²¡å¼€è¿‡å…¨ç›˜åŠ å¯†ã€‚ åœ¨ 2022 å¹´æˆ‘çš„ Homelab åæ‰äº†ä¸¤å—å›½äº§å›ºæ€ç¡¬ç›˜ï¼ˆé˜¿æ–¯åŠ ç‰¹è·Ÿå…‰å¨å¼ˆ Pro å„ä¸€æ ¹ï¼‰ï¼Œéƒ½æ˜¯ç³»ç»Ÿä¸€å¯åŠ¨å°±æŒ‚ï¼Œæ²¡æ³•æ‰‹åŠ¨ç£ç›˜æ ¼å¼åŒ–ï¼Œèµ°å”®åç›´æ¥è¢«äº¬ä¸œæ¢è´§äº†ã€‚å› ä¸ºæˆ‘çš„æ•°æ®æ˜¯æ˜æ–‡å­˜å‚¨çš„ï¼Œè¿™å¾ˆå¯èƒ½å¯¼è‡´æˆ‘çš„ä¸ªäººæ•°æ®æ³„éœ²â€¦ å‡ ä¸ªå¯†ç åœ¨å„ç§ç«™ç‚¹ä¸Šé‡å¤ä½¿ç”¨ï¼Œå…¶ä¸­é‡è¦è´¦å·çš„éšæœºå¯†ç è¿˜æ˜¯æˆ‘åœ¨åå¤šå¹´å‰ç”¨ lastpass ç”Ÿæˆçš„ï¼Œåˆ°å¤„ç”¨äº†è¿™ä¹ˆå¤šå¹´ï¼Œå¾ˆéš¾è¯´è¿™äº›å¯†ç æœ‰æ²¡æœ‰æ³„éœ²ï¼ˆlastpass è¿‘å‡ å¹´çˆ†å‡ºçš„æ³„æ¼äº‹æ•…å°±ä¸å°‘â€¦ï¼‰ GitHub, Google, Jetbrains ç­‰è´¦å·çš„ Backup Code è¢«æˆ‘æ˜æ–‡å­˜å‚¨åˆ°äº†ç™¾åº¦äº‘ç›˜ï¼Œä¸­é—´å‘ç°ç™¾åº¦äº‘ç›˜å®‰å…¨æ€§å¤ªå·®åˆè½¬å­˜åˆ°äº† OneDriveï¼Œä½†ä¸€ç›´æ˜¯æ˜æ–‡å­˜å‚¨ï¼Œä»æ¥æ²¡åŠ è¿‡å¯†ã€‚ ä¸€äº›é“¶è¡Œè´¦å·ä¹‹ç±»çš„éšæœºå¯†ç ï¼Œå› ä¸ºæ‹…å¿ƒé—å¿˜ï¼Œé•¿æœŸè¢«æˆ‘ä¿å­˜åœ¨ä¸€ä»½å°è±¡ç¬”è®°çš„ç¬”è®°é‡Œï¼Œä¹Ÿæ˜¯æ˜æ–‡å­˜å‚¨ï¼Œä»…åšäº†äº›ç®€å•çš„å†…å®¹æ›¿æ¢ï¼Œè¦çŒœå‡ºçœŸæ­£çš„å¯†ç æ„Ÿè§‰å¹¶ä¸æ˜¯å¾ˆéš¾ã€‚ ä»¥å‰ä¹Ÿæœ‰è¿‡å› ä¸ºå¯¹ Git æ“ä½œä¸ç†Ÿæ‚‰æˆ–è€…ç²—å¿ƒå¤§æ„ï¼Œåœ¨å…¬å¼€ä»“åº“ä¸­æäº¤äº†ä¸€äº›åŒ…å«æ•æ„Ÿä¿¡æ¯çš„ commitï¼Œæ¯”å¦‚è¯´ SSH å¯†é’¥ã€å¯†ç ç­‰ç­‰ï¼Œæœ‰çš„ç”šè‡³å¾ˆé•¿æ—¶é—´éƒ½æ²¡å‘ç°ã€‚ ç°åœ¨åœ¨ IT è¡Œä¸šå·¥ä½œäº†å‡ å¹´ï¼Œä»æˆ‘å½“ä¸‹çš„ç»éªŒæ¥çœ‹ï¼Œä¼ä¸šåå°çš„ç®¡ç†å‘˜å¦‚æœçœŸæœ‰å…´è¶£ï¼ŒæŸ¥çœ‹ç”¨æˆ·çš„æ•°æ®çœŸçš„æ˜¯å¾ˆç®€å•çš„ä¸€ä»¶äº‹ï¼Œè‡³å°‘å›½å†…å¤§éƒ¨åˆ†å…¬å¸çš„ç”¨æˆ·æ•°æ®ï¼Œéƒ½ä¸ä¼šåšéå¸¸ä¸¥æ ¼çš„æ•°æ®åŠ å¯†ä¸æƒé™ç®¡æ§ã€‚å°±ç®—çœŸæœ‰åŠ å¯†ï¼Œé‚£ä¹Ÿå¾ˆå°‘æ˜¯ç”¨æˆ·çº§åˆ«çš„ï¼Œå¯¹è¿ç»´äººå‘˜æˆ–å¼€å‘äººå‘˜è€Œè¨€è¿™äº›æ•°æ®ä»æ—§ä¸æœªåŠ å¯†æ— å¼‚ã€‚å¯¹ç³»ç»Ÿåšæ¯”è¾ƒå¤§çš„è¿­ä»£æ—¶ï¼ŒæŠŠå°éƒ¨åˆ†ç”¨æˆ·æ•°æ®å¯¼å…¥åˆ°æµ‹è¯•ç¯å¢ƒè¿›è¡Œæµ‹è¯•ä¹Ÿæ˜¯æŒºå¸¸è§çš„åšæ³•â€¦ æ€»ä¹‹å¯¹æˆ‘è€Œè¨€ï¼Œè¿™äº›å®‰å…¨éšæ‚£åœ¨è¿‡å»å¹¶ä¸ç®—å¤§é—®é¢˜ï¼Œæ¯•ç«Ÿæˆ‘ GitHub, Google ç­‰è´¦å·é‡Œä¹Ÿæ²¡å•¥é‡è¦æ•°æ®ï¼Œé“¶è¡Œå¡é‡Œä¹Ÿæ²¡å‡ åˆ†é’±ã€‚ ä½†éšç€æˆ‘ä¸ªäººæ•°æ®çš„ç§¯ç´¯ä¸åœ¨ GitHub, Google ä¸Šçš„æ´»åŠ¨è¶Šæ¥è¶Šå¤šã€é“¶è¡Œå¡é‡Œ Money çš„å¢åŠ ï¼ˆç‹—å¤´ï¼‰ï¼Œè¿™äº›æ•°æ®çš„ä»·å€¼ä¹Ÿè¶Šæ¥è¶Šå¤§ã€‚æ¯”å¦‚è¯´å¦‚æœæˆ‘çš„ GitHub ç§é’¥æ³„æ¼ï¼Œä»“åº“è¢«ç¯¡æ”¹ç”šè‡³åˆ é™¤ï¼Œä»¥å‰æˆ‘ GitHub ä¸Šæ²¡å•¥æ•°æ®ä¹Ÿæ²¡å•¥ stars å½“ç„¶æ— æ‰€è°“ï¼Œä½†ç°åœ¨æˆ‘å·²ç»æ— æ³•å¿å—ä¸¢å¤± GitHub ä¸¤åƒå¤šä¸ª stars çš„é£é™©äº†ã€‚ åœ¨ 2022 å¹´çš„æ—¶å€™æˆ‘å› ä¸ºå¯¹åŒºå—é“¾çš„å…´è¶£é¡ºä¾¿å­¦ä¹ äº†ä¸€ç‚¹åº”ç”¨å¯†ç å­¦ï¼Œäº†è§£äº†ä¸€äº›å¯†ç å­¦çš„åŸºç¡€çŸ¥è¯†ï¼Œ ç„¶åå¹´åº•åˆç»å†äº†å‡ æ¬¡å¯èƒ½çš„æ•°æ®æ³„æ¼ï¼Œè¿™ä½¿æˆ‘æ„è¯†åˆ°æˆ‘çš„ä¸ªäººæ•°æ®å®‰å…¨å·²ç»æ˜¯ä¸€ä¸ªä¸å¯å¿½è§†çš„é—®é¢˜ã€‚å› æ­¤ï¼Œä¸ºäº†é¿å… GitHub ç§é’¥æ³„æ¼ã€åŒºå—é“¾é’±åŒ…åŠ©è®°è¯æ³„æ¼ã€ä¸ªäººéšç§æ³„æ¼ç­‰å¯èƒ½ï¼Œæˆ‘åœ¨ 2023 å¹´ 5 æœˆåšäº†å…¨é¢å¼ºåŒ–ä¸ªäººæ•°æ®å®‰å…¨çš„å†³å®šï¼Œå¹¶åœ¨ 0XFFFF ç¤¾åŒºå‘äº†ç¯‡å¸–å­å¾æ±‚æ„è§â€”â€”å­¦ä¹ å¹¶å¼ºåŒ–ä¸ªäººçš„æ•°æ®å®‰å…¨æ€§ï¼ˆæŒç»­æ›´æ–°ï¼‰ã€‚ ç°åœ¨å¤§åŠå¹´è¿‡å»ï¼Œæˆ‘å·²ç»åœ¨ä¸ªäººæ•°æ®å®‰å…¨ä¸Šåšäº†è®¸å¤šå·¥ä½œï¼Œç›®å‰ç®—æ˜¯è¾¾åˆ°äº†ä¸€ä¸ªæ¯”è¾ƒä¸é”™çš„çŠ¶æ€ã€‚ æˆ‘çš„ä¸ªäººæ•°æ®å®‰å…¨æ–¹æ¡ˆï¼Œæœ‰ä¸¤ä¸ªæ ¸å¿ƒçš„æŒ‡å¯¼æ€æƒ³ï¼š é›¶ä¿¡ä»»ï¼šä¸ä¿¡ä»»ä»»ä½•äº‘æœåŠ¡æä¾›å•†ã€æœ¬åœ°ç¡¬ç›˜ã€ç½‘ç»œç­‰çš„å¯é æ€§ä¸å®‰å…¨æ€§ï¼Œå› æ­¤ä»»ä½•æ•°æ®çš„è½ç›˜ã€ç½‘ç»œä¼ è¾“éƒ½åº”è¯¥åŠ å¯†ï¼Œä»»ä½•æ•°æ®éƒ½åº”è¯¥æœ‰å¤šä¸ªå‰¯æœ¬ï¼ˆæœ¬åœ°ä¸äº‘ç«¯ï¼‰ã€‚ åŸºäºè¿™ä¸€ç‚¹ï¼Œåº”è¯¥å°½å¯èƒ½ä½¿ç”¨ç»è¿‡å¹¿æ³›éªŒè¯çš„å¼€æºå·¥å…·ï¼Œå› ä¸ºå¼€æºå·¥å…·çš„å®‰å…¨æ€§æ›´å®¹æ˜“è¢«éªŒè¯ï¼Œ ä¹Ÿé¿å…è¢«ä¾›åº”å•†ç»‘æ¶ã€‚ Serverless: å°½å¯èƒ½åˆ©ç”¨å·²æœ‰çš„å„ç§äº‘æœåŠ¡æˆ– Git ä¹‹ç±»çš„åˆ†å¸ƒå¼å­˜å‚¨å·¥å…·æ¥å­˜å‚¨æ•°æ®ã€ç®¡ç†æ•°æ®ç‰ˆæœ¬ã€‚ å®é™…ä¸Šæˆ‘ä¸ªäººæœ€è¿‘ä¸‰å››å¹´éƒ½æ²¡ç»´æŠ¤è¿‡ä»»ä½•ä¸ªäººçš„å…¬ç½‘æœåŠ¡å™¨ï¼Œè¿™ä¸ªåšå®¢ä»¥åŠå»å¹´æ­å»ºçš„ NixOS æ–‡æ¡£ç«™å…¨éƒ½æ˜¯ç”¨çš„ Vercel å…è´¹é™æ€ç«™ç‚¹æœåŠ¡ï¼Œå„ç§æ•°æ®ä¹Ÿå…¨éƒ½ä¼˜å…ˆé€‰ç”¨ Git åšå­˜å‚¨ä¸ç‰ˆæœ¬ç®¡ç†ã€‚ æˆ‘ Homelab ç®—åŠ›ä¸é”™ï¼Œä½†æ¯æ¬¡å¾€å…¶ä¸­æ·»åŠ ä¸€ä¸ªæœåŠ¡å‰ï¼Œæˆ‘éƒ½ä¼šè€ƒè™‘ä¸‹è¿™æ˜¯å¦æœ‰å¿…è¦ï¼Œæ˜¯å¦èƒ½ä½¿ç”¨å·²æœ‰çš„å·¥å…·å®Œæˆè¿™äº›å·¥ä½œã€‚æ¯•ç«Ÿè·‘çš„æœåŠ¡è¶Šå¤šï¼Œç»´æŠ¤æˆæœ¬è¶Šé«˜ï¼Œå®‰å…¨éšæ‚£ä¹Ÿè¶Šå¤šã€‚ è¿™ç¯‡æ–‡ç« è®°å½•ä¸‹æˆ‘æ‰€åšçš„ç›¸å…³è°ƒç ”å·¥ä½œã€æˆ‘åœ¨è¿™å¤§åŠå¹´çš„å®è·µè¿‡ç¨‹ä¸­é€æ¸æ‘¸ç´¢å‡ºçš„ä¸ªäººæ•°æ®å®‰å…¨æ–¹æ¡ˆä»¥åŠæœªæ¥å¯èƒ½çš„æ”¹è¿›æ–¹å‘ã€‚ æ³¨æ„è¿™é‡Œä»‹ç»çš„å¹¶ä¸æ˜¯ä»€ä¹ˆèƒ½ä¸€è¹´è€Œå°±è·å¾—è¶…é«˜å®‰å…¨æ€§çš„å‚»ç“œå¼æ–¹æ¡ˆï¼Œå®ƒéœ€è¦ä½ éœ€è¦ä½ æœ‰ä¸€å®šçš„æŠ€æœ¯èƒŒæ™¯è·Ÿæ—¶é—´æŠ•å…¥ï¼Œæ˜¯ä¸€ä¸ªé•¿æœŸçš„å­¦ä¹ ã€å®è·µä¸æ–¹æ¡ˆè¿­ä»£çš„è¿‡ç¨‹ã€‚å¦å¤–å¦‚æœä½ é”™è¯¯åœ°ä½¿ç”¨äº†æœ¬æ–‡ä¸­ä»‹ç»çš„å·¥å…·æˆ–æ–¹æ¡ˆï¼Œå¯èƒ½åè€Œä¼šé™ä½ä½ çš„æ•°æ®å®‰å…¨æ€§ï¼Œç”±æ­¤äº§ç”Ÿçš„ä»»ä½•æŸå¤±ä¸é£é™©çš†ç”±ä½ è‡ªå·±æ‰¿æ‹…ã€‚ ","date":"2024-01-30","objectID":"/posts/an-incomplete-guide-to-data-security/:1:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["å®‰å…¨","å¯†ç å­¦","Linux","SSH","PGP","å¯†ç ç®¡ç†","LUKS","å…¨ç›˜åŠ å¯†","é›¶ä¿¡ä»»","rclone"],"title":"ä¸ªäººæ•°æ®å®‰å…¨ä¸å®Œå…¨æŒ‡å—","uri":"/posts/an-incomplete-guide-to-data-security/#é›¶å‰è¨€"},{"categories":["tech"],"content":" ä¸€ã€ä¸ªäººæ•°æ®å®‰å…¨åŒ…å«å“ªäº›éƒ¨åˆ†ï¼Ÿæ•°æ®å®‰å…¨å¤§æ¦‚æœ‰è¿™äº›æ–¹é¢ï¼š ä¿éšœæ•°æ®ä¸ä¼šæ³„æ¼â€”â€”ä¹Ÿå°±æ˜¯åŠ å¯† ä¿éšœæ•°æ®ä¸ä¼šä¸¢å¤±â€”â€”ä¹Ÿå°±æ˜¯å¤‡ä»½ å°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œæˆ‘çš„æ•°æ®å®‰å…¨ä¸»è¦è€ƒè™‘ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š SSH å¯†é’¥ç®¡ç† å„ç§ç½‘ç«™ã€APP çš„è´¦å·å¯†ç ç®¡ç† ç¾éš¾æ¢å¤ç›¸å…³çš„æ•°æ®å­˜å‚¨ä¸ç®¡ç† æ¯”å¦‚è¯´ GitHub, Twitter, Google ç­‰é‡è¦è´¦å·çš„äºŒæ¬¡è®¤è¯æ¢å¤ä»£ç ã€è´¦å·æ•°æ®å¤‡ä»½ç­‰ï¼Œæ—¥å¸¸éƒ½ä¸éœ€è¦ç”¨åˆ°ï¼Œä½†éå¸¸é‡è¦ï¼Œå»ºè®®ç¦»çº¿åŠ å¯†å­˜å‚¨ éœ€è¦åœ¨å¤šç«¯è®¿é—®çš„é‡è¦ä¸ªäººæ•°æ® æ¯”å¦‚è¯´ä¸ªäººç¬”è®°ã€å›¾ç‰‡ã€è§†é¢‘ç­‰æ•°æ®ï¼Œè¿™äº›æ•°æ®å…·æœ‰ç§å¯†æ€§ï¼Œä½†åˆéœ€è¦åœ¨å¤šç«¯è®¿é—®ã€‚å¯å€ŸåŠ©æ”¯æŒå°†æ•°æ®åŠ å¯†å­˜å‚¨åˆ°äº‘ç«¯çš„å·¥å…·æ¥å®ç° ä¸ªäººç”µè„‘èˆ‡ Homelab çš„æ•°æ®å®‰å…¨ä¸ç¾éš¾æ¢å¤ æˆ‘ä¸»è¦ä½¿ç”¨ macOS ä¸ NixOSï¼Œå› æ­¤ä¸»è¦è€ƒè™‘çš„æ˜¯è¿™ä¸¤ä¸ªç³»ç»Ÿçš„æ•°æ®å®‰å…¨ä¸ç¾éš¾æ¢å¤ ä¸‹é¢å°±åˆ†åˆ«å°±è¿™å‡ ä¸ªéƒ¨åˆ†å±•å¼€è®¨è®ºã€‚ ","date":"2024-01-30","objectID":"/posts/an-incomplete-guide-to-data-security/:2:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["å®‰å…¨","å¯†ç å­¦","Linux","SSH","PGP","å¯†ç ç®¡ç†","LUKS","å…¨ç›˜åŠ å¯†","é›¶ä¿¡ä»»","rclone"],"title":"ä¸ªäººæ•°æ®å®‰å…¨ä¸å®Œå…¨æŒ‡å—","uri":"/posts/an-incomplete-guide-to-data-security/#ä¸€ä¸ªäººæ•°æ®å®‰å…¨åŒ…å«å“ªäº›éƒ¨åˆ†"},{"categories":["tech"],"content":" äºŒã€æ˜¯å¦éœ€è¦ä½¿ç”¨ YubiKey ç­‰ç¡¬ä»¶å¯†é’¥ï¼Ÿç¡¬ä»¶å¯†é’¥çš„å¥½å¤„æ˜¯å¯ä»¥é˜²æ­¢å¯†é’¥æ³„æ¼ï¼Œä½† YubiKey åœ¨å›½å†…æ— å®˜æ–¹è´­ä¹°æ¸ é“ï¼Œè€Œä¸”ä»·æ ¼ä¸è²ï¼Œåªä¹°ä¸€ä¸ª YubiKey çš„è¯è¿˜å­˜åœ¨ä¸¢å¤±çš„é£é™©ã€‚ å¦ä¸€æ–¹é¢å…¶å®åŸºäºç°ä»£å¯†ç å­¦ç®—æ³•çš„è½¯ä»¶å¯†é’¥å®‰å…¨æ€§å¯¹æˆ‘è€Œè¨€æ˜¯è¶³å¤Ÿçš„ï¼Œè€Œä¸”è½¯ä»¶å¯†é’¥çš„ä½¿ç”¨æ›´åŠ æ–¹ä¾¿ã€‚æˆ–è®¸åœ¨æœªæ¥ï¼Œæˆ‘ä¼šè€ƒè™‘ä½¿ç”¨canokey-coreã€OpenSKã€solokey ç­‰å¼€æºæ–¹æ¡ˆ DIY å‡ ä¸ªç¡¬ä»¶å¯†é’¥ï¼Œä½†ç›®å‰æˆ‘å¹¶ä¸è§‰å¾—æœ‰è¿™å¿…è¦ã€‚ ","date":"2024-01-30","objectID":"/posts/an-incomplete-guide-to-data-security/:3:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["å®‰å…¨","å¯†ç å­¦","Linux","SSH","PGP","å¯†ç ç®¡ç†","LUKS","å…¨ç›˜åŠ å¯†","é›¶ä¿¡ä»»","rclone"],"title":"ä¸ªäººæ•°æ®å®‰å…¨ä¸å®Œå…¨æŒ‡å—","uri":"/posts/an-incomplete-guide-to-data-security/#äºŒæ˜¯å¦éœ€è¦ä½¿ç”¨-yubikey-ç­‰ç¡¬ä»¶å¯†é’¥"},{"categories":["tech"],"content":" ä¸‰ã€SSH å¯†é’¥ç®¡ç†","date":"2024-01-30","objectID":"/posts/an-incomplete-guide-to-data-security/:4:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["å®‰å…¨","å¯†ç å­¦","Linux","SSH","PGP","å¯†ç ç®¡ç†","LUKS","å…¨ç›˜åŠ å¯†","é›¶ä¿¡ä»»","rclone"],"title":"ä¸ªäººæ•°æ®å®‰å…¨ä¸å®Œå…¨æŒ‡å—","uri":"/posts/an-incomplete-guide-to-data-security/#ä¸‰ssh-å¯†é’¥ç®¡ç†"},{"categories":["tech"],"content":" 2.1 SSH å¯†é’¥çš„ç”Ÿæˆæˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯ç›´æ¥ä½¿ç”¨ ssh-keygen å‘½ä»¤ç”Ÿæˆ SSH å¯†é’¥å¯¹ï¼ŒOpenSSH ç›®å‰ä¸»è¦æ”¯æŒä¸¤ç§å¯†é’¥ç®—æ³•ï¼š RSA: ç›®å‰ä½ åœ¨ç½‘ä¸Šçœ‹åˆ°çš„å¤§éƒ¨åˆ†æ•™ç¨‹éƒ½æ˜¯ä½¿ç”¨çš„ RSA 2048 ä½å¯†é’¥ï¼Œä½†å…¶ç ´è§£é£é™©åœ¨ä¸æ–­æå‡ï¼Œç›®å‰ä»…æ¨èä½¿ç”¨ 3072 ä½åŠä»¥ä¸Šçš„ RSA å¯†é’¥ã€‚ ED25519: è¿™æ˜¯å¯†ç å­¦å®¶ Dan Bernstein è®¾è®¡çš„ä¸€ç§æ–°çš„ç­¾åç®—æ³•ï¼Œå…¶å®‰å…¨æ€§ä¸ RSA 3072 ä½å¯†é’¥ç›¸å½“ï¼Œä½†å…¶ç­¾åé€Ÿåº¦æ›´å¿«ï¼Œä¸”å¯†é’¥æ›´çŸ­ï¼Œå› æ­¤ç›®å‰æ¨èä½¿ç”¨ ED25519 å¯†é’¥ã€‚ ","date":"2024-01-30","objectID":"/posts/an-incomplete-guide-to-data-security/:4:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["å®‰å…¨","å¯†ç å­¦","Linux","SSH","PGP","å¯†ç ç®¡ç†","LUKS","å…¨ç›˜åŠ å¯†","é›¶ä¿¡ä»»","rclone"],"title":"ä¸ªäººæ•°æ®å®‰å…¨ä¸å®Œå…¨æŒ‡å—","uri":"/posts/an-incomplete-guide-to-data-security/#21-ssh-å¯†é’¥çš„ç”Ÿæˆ"},{"categories":["tech"],"content":" 2.2 SSH å¯†é’¥çš„å®‰å…¨æ€§RSA è·Ÿ ED25519 éƒ½æ˜¯è¢«å¹¿æ³›ä½¿ç”¨çš„å¯†ç å­¦ç®—æ³•ï¼Œå…¶å®‰å…¨æ€§éƒ½æ˜¯ç»è¿‡ä¸¥æ ¼éªŒè¯çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æ”¾å¿ƒä½¿ç”¨ã€‚ä½†ä¸ºäº†åœ¨å¯†é’¥æ³„æ¼çš„æƒ…å†µä¸‹ï¼Œèƒ½å¤Ÿå°½å¯èƒ½å‡å°‘æŸå¤±ï¼Œå¼ºçƒˆå»ºè®®ç»™ä¸ªäººä½¿ç”¨çš„å¯†é’¥æ·»åŠ  passphrase ä¿æŠ¤ã€‚ é‚£è¿™ä¸ª passphrase ä¿æŠ¤åˆ°åº•æœ‰å¤šå®‰å…¨å‘¢ï¼Ÿ æœ‰ä¸€äº›å¯†ç å­¦çŸ¥è¯†çš„äººåº”è¯¥çŸ¥é“ï¼Œpassphrase ä¿æŠ¤çš„å®ç°åŸç†é€šå¸¸æ˜¯ï¼šé€šè¿‡ KDF ç®—æ³•ï¼ˆæˆ–è€…å«æ…¢å“ˆå¸Œç®—æ³•ã€å¯†ç å“ˆå¸Œç®—æ³•ï¼‰å°†ç”¨æˆ·è¾“å…¥çš„ passphrase å­—ç¬¦ä¸²è½¬æ¢æˆä¸€ä¸ªäºŒè¿›åˆ¶å¯¹ç§°å¯†é’¥ï¼Œç„¶åå†ç”¨è¿™ä¸ªå¯†é’¥åŠ è§£å¯†å…·ä½“çš„æ•°æ®ã€‚ å› æ­¤ï¼Œä½¿ç”¨ passphrase åŠ å¯†ä¿æŠ¤çš„ SSH Key çš„å®‰å…¨æ€§ï¼Œå–å†³äºï¼š passphrase çš„å¤æ‚åº¦ï¼Œè¿™å¯¹åº”å…¶é•¿åº¦ã€å­—ç¬¦é›†ã€æ˜¯å¦åŒ…å«ç‰¹æ®Šå­—ç¬¦ç­‰ã€‚è¿™ç”±æˆ‘ä»¬è‡ªå·±æ§åˆ¶ã€‚ æ‰€ä½¿ç”¨çš„ KDF ç®—æ³•çš„å®‰å…¨æ€§ã€‚è¿™ç”± OpenSSH çš„å®ç°å†³å®šã€‚ é‚£ä¹ˆï¼ŒOpenSSH çš„ passphrase æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿæ˜¯å¦è¶³å¤Ÿå®‰å…¨ï¼Ÿ æˆ‘é¦–å…ˆ Google äº†ä¸‹ï¼Œæ‰¾åˆ°ä¸€äº›ç›¸å…³çš„æ–‡ç« ï¼ˆæ³¨æ„å¦‚ä¸‹æ–‡ç« å†…å®¹ä¸å…¶æ—¶é—´ç‚¹ç›¸å…³ï¼ŒOpenSSH çš„æ–°ç‰ˆæœ¬ä¼šæœ‰äº›å˜åŒ–ï¼‰ï¼š (2018)The default OpenSSH key encryption is worse than plaintext: OpenSSH é»˜è®¤çš„ SSH RSA å¯†é’¥æ ¼å¼ç›´æ¥ä½¿ç”¨ MD5 æ¥æ´¾ç”Ÿå‡ºç”¨äº AES åŠ å¯†çš„å¯¹ç§°å¯†é’¥ï¼Œå†ç”¨è¿™ä¸ªå¯†é’¥åŠ å¯†ä½ çš„ RSA ç§é’¥ï¼Œè¿™æ„å‘³ç€å®ƒçš„ç ´è§£é€Ÿåº¦å°†ä¼šç›¸å½“çš„å¿«ã€‚ (2021)Password security of encrypted SSH private key: How to read round number or costfactor of bcrypt: è¿™é‡Œæœ‰ä¸ªè€å“¥åœ¨å›ç­”ä¸­ç®€å•æ¨ç®—äº†ä¸‹ï¼Œä»¥è¯´æ˜ä»–è®¤ä¸º OpenSSH é»˜è®¤çš„ passphrase åŠ å¯†ç›¸å½“å®‰å…¨ã€‚ åœ¨ OpenSSH release notes ä¸­æœç´¢ passphrase è·Ÿ kdf ä¸¤ä¸ªå…³é”®å­—ï¼Œæ‰¾åˆ°äº›å…³é”®ä¿¡æ¯å¦‚ä¸‹ï¼š text OpenSSH 9.4/9.4p1 (2023-08-10) * ssh-keygen(1): increase the default work factor (rounds) for the bcrypt KDF used to derive symmetric encryption keys for passphrase protected key files by 50%. ---------------------------------- OpenSSH 6.5/6.5p1 (2014-01-30) * Add a new private key format that uses a bcrypt KDF to better protect keys at rest. This format is used unconditionally for Ed25519 keys, but may be requested when generating or saving existing keys of other types via the -o ssh-keygen(1) option. We intend to make the new format the default in the near future. Details of the new format are in the PROTOCOL.key file. æ—¶é—´é˜¶æ®µ (OpenSSH ç‰ˆæœ¬) ssh-keygen é»˜è®¤å¯†é’¥ç±»å‹ ssh-keygen é»˜è®¤å¯†é’¥é•¿åº¦ ç§é’¥ KDF ç®—æ³• (å¸¦ passphrase æ—¶) é»˜è®¤/ä¸»è¦ KEX ç®—æ³• é»˜è®¤/ä¸»è¦å¯¹ç§°åŠ å¯†ç®—æ³• OpenSSH 4.x (çº¦2005 - 2008) RSA 2048 ä½ (RSA, è‡ª 4.0 èµ·) åŸºäº MD5 (OpenSSL PEM æ ¼å¼) diffie-hellman-group1-sha1, diffie-hellman-group-exchange-sha1 AES-CBC (æ›´æ™®é), 3DES-CBC; HMAC-SHA1 OpenSSH 5.x (çº¦2009 - 2013) RSA 2048 ä½ (RSA) åŸºäº MD5 (OpenSSL PEM æ ¼å¼) ecdh-sha2-nistp256 ç­‰ ECDH ç³»åˆ—å¼•å…¥ (è‡ª 5.7), DH ä»å¸¸è§ AES-CTR (è‡ª 5.2 èµ·ä¼˜å…ˆäº CBC), AES-CBC; HMAC-SHA1 OpenSSH 6.x (çº¦2014 - 2015) RSA (Ed25519 äº 6.5 å¼•å…¥) 2048 ä½ (RSA) bcrypt_pbkdf (æ–°æ ¼å¼, è‡ª 6.5; Ed25519 é»˜è®¤, RSA éœ€ -o) curve25519-sha256 (è‡ª 6.5 èµ·å¼•å…¥å¹¶ä¼˜å…ˆ), ECDH ç³»åˆ— chacha20-poly1305@openssh.com (è‡ª 6.5), AES-GCM (è‡ª ~6.2); CBC æ¨¡å¼äº 6.7 é»˜è®¤ç¦ç”¨ OpenSSH 7.x (çº¦2015 - 2018) RSA 2048 ä½ (RSA) bcrypt_pbkdf (è‡ª 7.8 èµ·æ‰€æœ‰æ–°å¯†é’¥é»˜è®¤) curve25519-sha256, ECDH ç³»åˆ—; diffie-hellman-group1-sha1 äº 7.0 ç¦ç”¨; rsa-sha2-256/512 ç­¾å (è‡ª 7.2) chacha20-poly1305, AES-GCM (AEAD ä¼˜å…ˆ); 3DES-CBC ä»å®¢æˆ·ç«¯é»˜è®¤ç§»é™¤ (7.4) OpenSSH 8.x (çº¦2019 - 2021) RSA (Ed25519 é€æ¸æµè¡Œ) 3072 ä½ (RSA, è‡ª 8.0 èµ·) bcrypt_pbkdf curve25519-sha256, ECDH ç³»åˆ—; ssh-rsa (SHA1 ç­¾å) äº 8.8 ç¦ç”¨ä¸»æœºè®¤è¯; Ed25519 ç­¾åä¼˜å…ˆ (è‡ª 8.5) chacha20-poly1305, AES-GCM OpenSSH 9.x (çº¦2022 - è‡³ä»Š) Ed25519 (è‡ª 9.5 èµ·) 256 ä½ (Ed25519); 3072 ä½ (è‹¥é€‰ RSA) bcrypt_pbkdf PQC æ··åˆ KEX: sntrup761x25519-sha512@openssh.com (è‡ª 9.0 é»˜è®¤); mlkem768x25519-sha256 (è‡ª 9.9 é»˜è®¤æä¾›); Terrapin ç¼“è§£ (9.6) chacha20-poly1305, AES-GCM OpenSSH 10.0 (é¢„è®¡ 2025å¹´4æœˆ) Ed25519 256 ä½ (Ed25519); 3072 ä½ (è‹¥é€‰ RSA) bcrypt_pbkdf mlkem768x25519-sha256 (PQC KEX é»˜è®¤); æœåŠ¡å™¨ç«¯é»˜è®¤ç¦ç”¨æœ‰é™åŸŸ DH (modp); DSA å®Œå…¨ç§»é™¤ chacha20-poly1305 (æœ€ä¼˜å…ˆ), AES-GCM (ä¼˜å…ˆäº AES-CTR) æ‰€ä»¥ä» 2014 å¹´ 1 æœˆå‘å¸ƒçš„ OpenSSH 6.5 å¼€å§‹ï¼Œæ‰å¯ä½¿ç”¨ ed25519 å¯†é’¥ï¼Œå®ƒçš„ passphrase é»˜è®¤ä½¿ç”¨ bcrypt_pbkdf ç”Ÿæˆçš„ã€‚è€Œå¯¹äº RSA ç±»å‹çš„å¯†é’¥ï¼Œä¸€ç›´åˆ° 2018-08-24 å‘å¸ƒçš„ OpenSSH 7.8 æ‰ä» MD5 æ”¹åˆ° bctypt_pbkdf. å³ä½¿ 2023-08-10 å‘å¸ƒçš„ 9.4 ç‰ˆæœ¬å¢åŠ äº†é»˜è®¤çš„ bcrypt KDF rounds æ¬¡æ•°ï¼Œå®ƒçš„å®‰å…¨æ€§ä»ç„¶å¾ˆå€¼å¾—æ€€ç–‘ã€‚bcrypt æœ¬èº«çš„å®‰å…¨æ€§å°±è¶Šæ¥è¶Šå·®ï¼Œç°ä»£åŒ–çš„åŠ å¯†å·¥å…·åŸºæœ¬éƒ½å·²ç»å‡çº§åˆ°äº† scrypt ç”šè‡³ argon2. å› æ­¤è¦æƒ³æå‡å®‰å…¨æ€§ï¼Œæœ€å¥½æ˜¯èƒ½æ›´æ¢æ›´ç°ä»£çš„ KDF ç®—æ³•ï¼Œæˆ–è€…è‡³å°‘å¢åŠ  bcrypt_pbkdf çš„ rounds æ•°é‡ã€‚ æˆ‘è¿›ä¸€æ­¥çœ‹äº† man ssh-keygen çš„æ–‡æ¡£ï¼Œæ²¡æ‰¾åˆ°ä»»ä½•ä¿®æ”¹ KDF ç®—æ³•çš„å‚æ•°ï¼Œä¸è¿‡èƒ½é€šè¿‡ -a å‚æ•°æ¥ä¿®æ”¹ KDF çš„ rounds æ•°é‡ï¼ŒOpeSSh 9.4 çš„ man ä¿¡æ¯ä¸­å†™äº†é»˜è®¤ä½¿ç”¨ 16 rounds. æˆ‘ä»¬å†äº†è§£ä¸‹ ssh-keygen é»˜è®¤å‚æ•°ï¼Œåœ¨ release note ä¸­æˆ‘è¿›ä¸€æ­¥æ‰¾åˆ°è¿™ä¸ªï¼š text OpenSSH 9.5/9.5p1 (2023-10-04) Potentially incompatible changes -------------------------------- * ssh-keygen(1): generate Ed25519 keys by default. Ed25519 public keys are very convenient due to their small size. Ed25519 keys are specified in RFC 8709 and OpenSSH has supported them since version 6.5 (January 2014). ä¹Ÿå°±æ˜¯è¯´ä» 2023-10-04 å‘å¸ƒçš„ 9.5 å¼€å§‹ï¼ŒOpenSSH æ‰é»˜è®¤ä½¿ç”¨ ED25519ã€‚ å†çœ‹ä¸‹å„ä¸»æµæ“ä½œç³»ç»Ÿä¸ OpenSSH çš„å¯¹åº”å…³ç³»ï¼š OS Distro Version Year å¤§è‡´çš„ OpenSSH ç‰ˆæœ¬ Ubuntu (LTS) Ubuntu 18.04 LTS 2018 OpenSSH 7.6p1 Ubuntu 20.04 L","date":"2024-01-30","objectID":"/posts/an-incomplete-guide-to-data-security/:4:2","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["å®‰å…¨","å¯†ç å­¦","Linux","SSH","PGP","å¯†ç ç®¡ç†","LUKS","å…¨ç›˜åŠ å¯†","é›¶ä¿¡ä»»","rclone"],"title":"ä¸ªäººæ•°æ®å®‰å…¨ä¸å®Œå…¨æŒ‡å—","uri":"/posts/an-incomplete-guide-to-data-security/#22-ssh-å¯†é’¥çš„å®‰å…¨æ€§"},{"categories":["tech"],"content":" 2.3 SSH å¯†é’¥çš„åˆ†ç±»ç®¡ç†åœ¨æ‰€æœ‰æœºå™¨ä¸Šä½¿ç”¨åŒä¸€ä¸ª SSH å¯†é’¥ï¼Œè¿™æ˜¯æˆ‘è¿‡å»çš„åšæ³•ï¼Œä½†è¿™æ ·åšæœ‰å‡ ä¸ªé—®é¢˜ï¼š ä¸€æ—¦æŸå°æœºå™¨çš„å¯†é’¥æ³„æ¼ï¼Œé‚£ä¹ˆå°±éœ€è¦é‡æ–°ç”Ÿæˆå¹¶æ›¿æ¢æ‰€æœ‰æœºå™¨ä¸Šçš„å¯†é’¥ï¼Œè¿™å¾ˆéº»çƒ¦ã€‚ å¯†é’¥éœ€è¦é€šè¿‡å„ç§æ–¹å¼ä¼ è¾“åˆ°å„ä¸ªæœºå™¨ä¸Šï¼Œè¿™ä¹Ÿå­˜åœ¨æ³„æ¼çš„é£é™©ã€‚ å› æ­¤ï¼Œæˆ‘ç°åœ¨çš„åšæ³•æ˜¯ï¼š å¯¹æ‰€æœ‰æ¡Œé¢ç”µè„‘è·Ÿç¬”è®°æœ¬ï¼Œéƒ½åœ¨å…¶æœ¬åœ°ç”Ÿæˆä¸€ä¸ªä¸“ç”¨çš„ SSH å¯†é’¥é…ç½®åˆ° GitHub è·Ÿå¸¸ç”¨çš„æœåŠ¡å™¨ä¸Šã€‚è¿™ä¸ª SSH ç§é’¥æ°¸è¿œä¸ä¼šç¦»å¼€è¿™å°æœºå™¨ã€‚ å¯¹äºä¸€äº›ç›¸å¯¹ä¸é‡è¦çš„ Homelab æœåŠ¡å™¨ï¼Œé¢å¤–ç”Ÿæˆä¸€ä¸ªä¸“ç”¨çš„ SSH å¯†é’¥ï¼Œé…ç½®åˆ°è¿™äº›æœåŠ¡å™¨ä¸Šã€‚åœ¨ä¸€äº›è·³æ¿æœºè·Ÿæµ‹è¯•æœºä¸Šä¼šé…ç½®è¿™ä¸ªå¯†é’¥æ–¹ä¾¿æµ‹è¯•ä¸ç™»å½•åˆ°å…¶ä»–æœºå™¨ã€‚ ä¸Šè¿°æ‰€æœ‰ SSH å¯†é’¥éƒ½æ·»åŠ äº† passphrase ä¿æŠ¤ï¼Œä¸”ä½¿ç”¨äº† bcrypt 256 rounds ç”ŸæˆåŠ å¯†å¯†é’¥ã€‚ æˆ‘é€šè¿‡è¿™ç§æ–¹å¼ç¼©å°äº†é£é™©èŒƒå›´ï¼Œå³ä½¿æŸå°æœºå™¨çš„å¯†é’¥æ³„æ¼ï¼Œä¹Ÿåªéœ€è¦é‡æ–°ç”Ÿæˆå¹¶æ›¿æ¢è¿™å°æœºå™¨ä¸Šçš„å¯†é’¥å³å¯ã€‚ æœ€åå†è¯´æ˜ä¸€ç‚¹ï¼šOpenSSH å¯†é’¥å¹¶ä¸æ˜¯ç”Ÿæˆä¸€æ¬¡ç„¶åå°±å¯ä»¥é«˜æ•æ— å¿§äº†ï¼Œä¸ºäº†ç¡®ä¿è¶³å¤Ÿå®‰å…¨æ€§ï¼Œä¹Ÿå¿…é¡»éš”å‡ å¹´æ›´æ¢ä¸€æ¬¡æ–°å¯†é’¥ã€‚ ","date":"2024-01-30","objectID":"/posts/an-incomplete-guide-to-data-security/:4:3","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["å®‰å…¨","å¯†ç å­¦","Linux","SSH","PGP","å¯†ç ç®¡ç†","LUKS","å…¨ç›˜åŠ å¯†","é›¶ä¿¡ä»»","rclone"],"title":"ä¸ªäººæ•°æ®å®‰å…¨ä¸å®Œå…¨æŒ‡å—","uri":"/posts/an-incomplete-guide-to-data-security/#23-ssh-å¯†é’¥çš„åˆ†ç±»ç®¡ç†"},{"categories":["tech"],"content":" 2.4 SSH CA - æ›´å®‰å…¨åˆç†çš„ SSH å¯†é’¥ç®¡ç†æ–¹æ¡ˆï¼Ÿæœåˆ°äº›èµ„æ–™ï¼š SSH è¯ä¹¦ç™»å½•æ•™ç¨‹ TODO å¾…ç ”ç©¶ã€‚ ","date":"2024-01-30","objectID":"/posts/an-incomplete-guide-to-data-security/:4:4","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["å®‰å…¨","å¯†ç å­¦","Linux","SSH","PGP","å¯†ç ç®¡ç†","LUKS","å…¨ç›˜åŠ å¯†","é›¶ä¿¡ä»»","rclone"],"title":"ä¸ªäººæ•°æ®å®‰å…¨ä¸å®Œå…¨æŒ‡å—","uri":"/posts/an-incomplete-guide-to-data-security/#24-ssh-ca---æ›´å®‰å…¨åˆç†çš„-ssh-å¯†é’¥ç®¡ç†æ–¹æ¡ˆ"},{"categories":["tech"],"content":" å››ã€ä¸ªäººçš„è´¦å·å¯†ç ç®¡ç†æˆ‘æ›¾ç»å¤§é‡ä½¿ç”¨äº† Chrome/Firefox è‡ªå¸¦çš„å¯†ç å­˜å‚¨åŠŸèƒ½ï¼Œä½†ç”¨åˆ°ç°åœ¨å…¶å®ä¹Ÿå‘ç°äº†å®ƒä»¬çš„è®¸å¤šå¼Šç«¯ã€‚æœ‰åŒäº‹æ¨å´‡ 1Password çš„ä½¿ç”¨ä½“éªŒï¼Œå®ƒçš„è‡ªåŠ¨å¡«å……è·ŸåŒç«™ç‚¹çš„å¤šå¯†ç ç®¡ç†ç¡®å®åšå¾—éå¸¸ä¼˜ç§€ï¼Œä½†ä¸€æ˜¯è¦æ”¶è´¹ï¼ŒäºŒæ˜¯å®ƒæ˜¯å•†ä¸šçš„åœ¨çº¿æ–¹æ¡ˆï¼ŒåŸºäºé›¶ä¿¡ä»»åŸåˆ™ï¼Œæˆ‘ä¸å¤ªæƒ³ä½¿ç”¨è¿™ç§æ–¹æ¡ˆã€‚ ä½œä¸ºå¼€æºçˆ±å¥½è€…ï¼Œæˆ‘æœ€è¿‘æ‰¾åˆ°äº†ä¸€ä¸ªéå¸¸é€‚åˆæˆ‘è‡ªå·±çš„æ–¹æ¡ˆï¼špassword-store. è¿™å¥—æ–¹æ¡ˆä½¿ç”¨ gpg åŠ å¯†è´¦å·å¯†ç ï¼Œæ¯ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªè´¦å·å¯†ç ï¼Œé€šè¿‡æ–‡ä»¶æ ‘æ¥ç»„ç»‡ä¸åŒ¹é…è´¦å·å¯†ç ä¸ APP/ç«™ç‚¹çš„å¯¹åº”å…³ç³»ï¼Œå¹¶ä¸”ç”Ÿæ€å®Œå–„ï¼Œå¯¹ firefox/chrome/android/ios çš„æ”¯æŒéƒ½æŒºå¥½ã€‚ ç¼ºç‚¹æ˜¯ç”¨ GPG åŠ å¯†ï¼Œä¸Šæ‰‹æœ‰ç‚¹éš¾åº¦ï¼Œä½†å¯¹å’±æ¥è¯´å®Œå…¨å¯ä»¥æ¥å—ã€‚ æˆ‘åœ¨æœ€è¿‘ä½¿ç”¨ pass-import ä» firefox/chrome ä¸­å¯¼å…¥äº†æˆ‘å½“å‰æ‰€æœ‰çš„è´¦å·å¯†ç ï¼Œå¹¶å¯¹æ‰€æœ‰çš„é‡è¦è´¦å·å¯†ç è¿›è¡Œäº†ä¸€æ¬¡å…¨é¢çš„æ›´æ–°ï¼Œä¸€å…±æ”¹äº†äºŒä¸‰åä¸ªè´¦å·ï¼Œå…¨éƒ¨é‡‡ç”¨äº†éšæœºå¯†ç ã€‚ å½“å‰çš„å­˜å‚¨åŒæ­¥ä¸å¤šç«¯ä½¿ç”¨æ–¹å¼ï¼š pass çš„åŠ å¯†æ•°æ®ä½¿ç”¨ GitHub ç§æœ‰ä»“åº“å­˜å‚¨ï¼Œpass åŸç”Ÿæ”¯æŒåŸºäº Git çš„å­˜å‚¨æ–¹æ¡ˆã€‚ å› ä¸ºæ•°æ®å…¨éƒ½æ˜¯ä½¿ç”¨ ECC Curve 25519 GPG åŠ å¯†çš„ï¼Œå³ä½¿ä»“åº“å†…å®¹æ³„æ¼ï¼Œæ•°æ®çš„å®‰å…¨æ€§ä»ç„¶æœ‰ä¿éšœã€‚ åœ¨æµè§ˆå™¨ä¸ç§»åŠ¨ç«¯ï¼Œåˆ™åˆ†åˆ«ä½¿ç”¨è¿™äº›å®¢æˆ·ç«¯æ¥è¯»å†™ pass ä¸­çš„å¯†ç ï¼š Android: https://github.com/android-password-store/Android-Password-Store IOSï¼š https://github.com/mssun/passforios Brosers(Chrome/Firefox): https://github.com/browserpass/browserpass-extension åŸºæ–¼é›è›‹ä¸æ”¾åœ¨åŒä¸€å€‹ç±ƒå­è£çš„åŸå‰‡ï¼Œotp/mfa çš„å‹•æ…‹å¯†ç¢¼å‰‡ä½¿ç”¨ google authenticator ä¿å­˜èˆ‡å¤šç«¯åŒæ­¥ï¼Œä¸¦ç•™æœ‰ä¸€ä»½é›¢ç·šå‚™ä»½ç”¨æ–¼ç½é›£æ¢å¾©ã€‚ç™»éŒ„ Google è³¬è™Ÿç›®å‰éœ€è¦æˆ‘ Android æ‰‹æ©Ÿæˆ–çŸ­ä¿¡é©—è­‰ï¼Œå› æ­¤å®‰å…¨æ€§ç¬¦åˆæˆ‘çš„éœ€æ±‚ã€‚ æˆ‘çš„è¯¦ç»† pass é…ç½®è§ryan4yin/nix-config/password-store. å…¶ä»–ç›¸å…³èµ„æ–™ï¼š awesome-password-store https://github.com/gopasspw/gopass: reimplement in go, with more features. é‡åˆ°è¿‡çš„ä¸€äº›é—®é¢˜ä¸è§£æ³•ï¼š passforios - Merge conflicts ","date":"2024-01-30","objectID":"/posts/an-incomplete-guide-to-data-security/:5:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["å®‰å…¨","å¯†ç å­¦","Linux","SSH","PGP","å¯†ç ç®¡ç†","LUKS","å…¨ç›˜åŠ å¯†","é›¶ä¿¡ä»»","rclone"],"title":"ä¸ªäººæ•°æ®å®‰å…¨ä¸å®Œå…¨æŒ‡å—","uri":"/posts/an-incomplete-guide-to-data-security/#å››ä¸ªäººçš„è´¦å·å¯†ç ç®¡ç†"},{"categories":["tech"],"content":" 3.1 pass ä½¿ç”¨çš„ GPG å¤Ÿå®‰å…¨ä¹ˆï¼ŸGnuPG æ˜¯ä¸€ä¸ªå¾ˆæœ‰å†å²ï¼Œè€Œä¸”ä½¿ç”¨å¹¿æ³›çš„åŠ å¯†å·¥å…·ï¼Œä½†å®ƒçš„å®‰å…¨æ€§å¦‚ä½•å‘¢ï¼Ÿ æˆ‘æ‰¾åˆ°äº›ç›¸å…³æ–‡æ¡£ï¼š 2021å¹´ï¼Œç”¨æ›´ç°ä»£çš„æ–¹æ³•ä½¿ç”¨PGPï¼ˆä¸Šï¼‰ Predictable, Passphrase-Derived PGP Keys OpenPGP - The almost perfect key pair ç®€å•æ€»ç»“ä¸‹ï¼ŒGnuPG çš„æ¯ä¸ª secret key éƒ½æ˜¯éšæœºç”Ÿæˆçš„ï¼Œäº’ç›¸ä¹‹é—´æ²¡æœ‰å…³è”ï¼ˆå³ä¸åƒåŒºå—é“¾é’±åŒ…é‚£æ ·å…·æœ‰ç¡®å®šæ€§ï¼‰ã€‚ç”Ÿæˆå‡ºçš„ key è¢«ä½¿ç”¨ passphrase åŠ å¯†ä¿å­˜ï¼Œæ¯æ¬¡ä½¿ç”¨æ—¶éƒ½éœ€è¦è¾“å…¥ passphrase è§£å¯†ã€‚ é‚£ä¹ˆè¿˜æ˜¯ä¹‹å‰åœ¨è°ƒç ” OpenSSH æ—¶æˆ‘ä»¬æåˆ°çš„é—®é¢˜ï¼šå®ƒä½¿ç”¨çš„ KDF ç®—æ³•ä¸å‚æ•°æ˜¯å¦è¶³å¤Ÿå®‰å…¨ï¼Ÿ OpenPGP æ ‡å‡†å®šä¹‰äº†String-to-Key (S2K) ç®—æ³•ç”¨äºä» passphrase ç”Ÿæˆå¯¹ç§°åŠ å¯†å¯†é’¥ï¼ŒGnuPG éµå¾ªè¯¥è§„èŒƒï¼Œå¹¶ä¸”æä¾›äº†ç›¸å…³çš„å‚æ•°é…ç½®é€‰é¡¹ï¼Œç›¸å…³å‚æ•°çš„æ–‡æ¡£OpenPGP protocol specific options å†…å®¹å¦‚ä¸‹ï¼š text --s2k-cipher-algo name Use name as the cipher algorithm for symmetric encryption with a passphrase if --personal-cipher-preferences and --cipher-algo are not given. The default is AES-128. --s2k-digest-algo name Use name as the digest algorithm used to mangle the passphrases for symmetric encryption. The default is SHA-1. --s2k-mode n Selects how passphrases for symmetric encryption are mangled. If n is 0 a plain passphrase (which is in general not recommended) will be used, a 1 adds a salt (which should not be used) to the passphrase and a 3 (the default) iterates the whole process a number of times (see --s2k-count). --s2k-count n Specify how many times the passphrases mangling for symmetric encryption is repeated. This value may range between 1024 and 65011712 inclusive. The default is inquired from gpg-agent. Note that not all values in the 1024-65011712 range are legal and if an illegal value is selected, GnuPG will round up to the nearest legal value. This option is only meaningful if --s2k-mode is set to the default of 3. é»˜è®¤ä»æ—§ä½¿ç”¨ AES-128 åš passphrase åœºæ™¯ä¸‹çš„å¯¹ç§°åŠ å¯†ï¼Œæ•°æ®ç­¾åè¿˜æ˜¯ç”¨çš„ SHA-1ï¼Œè¿™ä¿©éƒ½å·²ç»ä¸å¤ªå®‰å…¨äº†ï¼Œå°¤å…¶æ˜¯ SHA-1ï¼Œå·²ç»è¢«è¯æ˜å­˜åœ¨å®‰å…¨é—®é¢˜ã€‚å› æ­¤ï¼Œä½¿ç”¨é»˜è®¤å‚æ•°ç”Ÿæˆçš„ GPG å¯†é’¥ï¼Œå…¶å®‰å…¨æ€§æ˜¯ä¸å¤Ÿçš„ã€‚ ä¸ºäº†è·å¾—æœ€ä½³å®‰å…¨æ€§ï¼Œæˆ‘ä»¬éœ€è¦ï¼š ä½¿ç”¨å¦‚ä¸‹å‚æ•°ç”Ÿæˆ GPG å¯†é’¥ï¼š text gpg --s2k-mode 3 --s2k-count 65011712 --s2k-digest-algo SHA512 --s2k-cipher-algo AES256 ... åŠ å¯†ã€ç­¾åã€è®¤è¯éƒ½ä½¿ç”¨ä¸åŒçš„å¯†é’¥ï¼Œæ¯ä¸ªå¯†é’¥åªç”¨äºç‰¹å®šçš„åœºæ™¯ï¼Œè¿™æ ·å³ä½¿æŸä¸ªå¯†é’¥æ³„æ¼ï¼Œä¹Ÿä¸ä¼šå½±å“å…¶ä»–åœºæ™¯çš„å®‰å…¨æ€§ã€‚ ä¸ºäº†åœ¨å…¨å±€ä½¿ç”¨è¿™äº›å‚æ•°ï¼Œå¯ä»¥å°†å®ƒä»¬æ·»åŠ åˆ°ä½ çš„ ~/.gnupg/gpg.conf é…ç½®æ–‡ä»¶ä¸­ã€‚ è¯¦è§æˆ‘çš„ gpg é…ç½®ryan4yin/nix-config/gpg ","date":"2024-01-30","objectID":"/posts/an-incomplete-guide-to-data-security/:5:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["å®‰å…¨","å¯†ç å­¦","Linux","SSH","PGP","å¯†ç ç®¡ç†","LUKS","å…¨ç›˜åŠ å¯†","é›¶ä¿¡ä»»","rclone"],"title":"ä¸ªäººæ•°æ®å®‰å…¨ä¸å®Œå…¨æŒ‡å—","uri":"/posts/an-incomplete-guide-to-data-security/#31-pass-ä½¿ç”¨çš„-gpg-å¤Ÿå®‰å…¨ä¹ˆ"},{"categories":["tech"],"content":" äº”ã€è·¨å¹³å°çš„åŠ å¯†å¤‡ä»½åŒæ­¥å·¥å…·çš„é€‰æ‹©æˆ‘æ—¥å¸¸åŒæ—¶åœ¨ä½¿ç”¨ macOS ä¸ NixOSï¼Œå› æ­¤ä¸è®ºæ˜¯éœ€è¦ç¦»çº¿å­˜å‚¨çš„ç¾éš¾æ¢å¤æ•°æ®ï¼Œè¿˜æ˜¯éœ€è¦åœ¨å¤šç«¯è®¿é—®çš„ä¸ªäººæ•°æ®ï¼Œéƒ½éœ€è¦ä¸€ä¸ªè·¨å¹³å°çš„åŠ å¯†å¤‡ä»½ä¸åŒæ­¥å·¥å…·ã€‚ å‰é¢æåˆ°çš„ pass ä½¿ç”¨ GnuPG è¿›è¡Œæ–‡ä»¶çº§åˆ«çš„åŠ å¯†ï¼Œä½†åœ¨å¾ˆå¤šåœºæ™¯ä¸‹è¿™ä¸å¤ªé€‚ç”¨ï¼Œè€Œä¸” GPG æœ¬èº«ä¹Ÿå¤ªé‡äº†ï¼Œè¿˜ä¸€å †å†å²é—ç•™é—®é¢˜ï¼Œæˆ‘ä¸å¤ªå–œæ¬¢ã€‚ ä¸ºäº†å…¶ä»–æ•°æ®å¤‡ä»½ä¸åŒæ­¥çš„éœ€è¦ï¼Œæˆ‘éœ€è¦ä¸€ä¸ªè·¨å¹³å°çš„åŠ å¯†å·¥å…·ï¼Œç›®å‰è°ƒç ”åˆ°æœ‰å¦‚ä¸‹è¿™äº›ï¼š æ–‡ä»¶çº§åˆ«çš„åŠ å¯† è¿™ä¸ªæœ‰å¾ˆå¤šç°æˆçš„ç°ä»£åŠ å¯†å·¥å…·ï¼Œæ¯”å¦‚ age/sops, éƒ½æŒºä¸é”™ï¼Œä½†æ˜¯é’ˆå¯¹å¤§é‡æ–‡ä»¶çš„æƒ…å†µä¸‹ä½¿ç”¨æ¯”è¾ƒç¹çã€‚ å…¨ç›˜åŠ å¯†ï¼Œæˆ–è€…æ”¯æŒé€šè¿‡ FUSE æ¨¡æ‹Ÿæ–‡ä»¶ç³»ç»Ÿ é¦–å…ˆ LUKS å°±ä¸ç”¨è€ƒè™‘äº†ï¼Œå®ƒåŸºæœ¬åªåœ¨ Linux ä¸Šèƒ½ç”¨ã€‚ è·¨å¹³å°ä¸”æ¯”è¾ƒæ´»è·ƒçš„é¡¹ç›®ä¸­ï¼Œæˆ‘æ‰¾åˆ°äº† rclone ä¸ restic è¿™ä¸¤ä¸ªé¡¹ç›®ï¼Œéƒ½æ”¯æŒäº‘åŒæ­¥ï¼Œå„æœ‰ä¼˜ç¼ºç‚¹ã€‚ restic ç›¸å¯¹ rclone çš„ä¼˜åŠ¿ï¼Œä¸»è¦æ˜¯å¤©ç„¶æ”¯æŒå¢é‡ snapshots çš„åŠŸèƒ½ï¼Œå¯ä»¥ä¿å­˜å¤‡ä»½çš„å†å²å¿«ç…§ï¼Œå¹¶è®¾ç½®çµæ´»çš„å†å²å¿«ç…§ä¿å­˜ç­–ç•¥ã€‚è¿™å¯¹å¯èƒ½æœ‰å›æ»šéœ€æ±‚çš„æ•°æ®è€Œè¨€æ˜¯å¾ˆé‡è¦çš„ã€‚æ¯”å¦‚è¯´ PVE è™šæ‹Ÿæœºå¿«ç…§çš„å¤‡ä»½ï¼Œæœ‰äº† restic æˆ‘ä»¬å°±ä¸å†éœ€è¦ä¾èµ– PVE è‡ªèº«å­±å¼±çš„å¿«ç…§ä¿ç•™åŠŸèƒ½ï¼Œå…¨äº¤ç»™ restic å®ç°å°±è¡Œã€‚ å¤šç«¯åŠ å¯†åŒæ­¥ ä¸Šé¢æåˆ°çš„ rclone ä¸ restic éƒ½æ”¯æŒå„ç§äº‘å­˜å‚¨ï¼Œå› æ­¤éƒ½æ˜¯ä¸é”™çš„å¤šç«¯åŠ å¯†åŒæ­¥å·¥å…·ã€‚ æœ€æµè¡Œçš„å¼€æºæ•°æ®åŒæ­¥å·¥å…·è²Œä¼¼æ˜¯ synthingï¼Œä½†å®ƒå¯¹åŠ å¯†çš„æ”¯æŒè¿˜ä¸å¤Ÿå®Œå–„ï¼Œæš‚ä¸è€ƒè™‘ã€‚ è¿›ä¸€æ­¥è°ƒç ”åï¼Œæˆ‘é€‰æ‹©äº† age, rclone ä¸ restic ä½œä¸ºæˆ‘çš„è·¨å¹³å°åŠ å¯†å¤‡ä»½ä¸åŒæ­¥å·¥å…·ã€‚è¿™ä¸‰ä¸ªå·¥å…·éƒ½æ¯”è¾ƒæ´»è·ƒï¼Œstars å¾ˆé«˜ï¼Œä½¿ç”¨çš„ä¹Ÿéƒ½æ˜¯æ¯”è¾ƒç°ä»£çš„å¯†ç å­¦ç®—æ³•ï¼š age: å¯¹äºå¯¹ç§°åŠ å¯†çš„åœºæ™¯ï¼Œä½¿ç”¨ ChaCha20-Poly1305 AEAD åŠ å¯†æ–¹æ¡ˆï¼Œå¯¹ç§°åŠ å¯†å¯†é’¥ä½¿ç”¨ scrypt KDF ç®—æ³•ç”Ÿæˆã€‚ rclone: ä½¿ç”¨åŸºäº XSalsa20-Poly1305 çš„ AEAD åŠ å¯†æ–¹æ¡ˆï¼Œkey é€šè¿‡ scrypt KDF ç®—æ³•ç”Ÿæˆï¼Œå¹¶ä¸”é»˜è®¤ä¼šåŠ ç›ã€‚ restic: ä½¿ç”¨ AES-256-CTR åŠ å¯†ï¼Œä½¿ç”¨ Poly1305-AES è®¤è¯æ•°æ®ï¼Œkey é€šè¿‡ scrypt KDF ç®—æ³•ç”Ÿæˆã€‚ å¯¹äº Nix ç›¸å…³çš„ secrets é…ç½®ï¼Œæˆ‘ä½¿ç”¨äº† age çš„ä¸€ä¸ªé€‚é…åº“ agenix å®Œæˆå…¶è‡ªåŠ¨åŠ è§£å¯†é…ç½®ï¼Œå¹¶å°†ç›¸å…³çš„åŠ å¯†æ•°æ®ä¿å­˜åœ¨æˆ‘çš„ GitHub ç§æœ‰ä»“åº“ä¸­ã€‚è¯¦è§ ryan4yin/nix-config/secrets. å…³äºè¿™ä¸ªä»“åº“çš„è¯¦ç»†åŠ è§£å¯†æ–¹æ³•ï¼Œåœ¨åé¢ç¬¬å…«èŠ‚ã€Œæ¡Œé¢ç”µè„‘çš„æ•°æ®å®‰å…¨ã€ä¸­ä¼šä»‹ç»ã€‚ ","date":"2024-01-30","objectID":"/posts/an-incomplete-guide-to-data-security/:6:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["å®‰å…¨","å¯†ç å­¦","Linux","SSH","PGP","å¯†ç ç®¡ç†","LUKS","å…¨ç›˜åŠ å¯†","é›¶ä¿¡ä»»","rclone"],"title":"ä¸ªäººæ•°æ®å®‰å…¨ä¸å®Œå…¨æŒ‡å—","uri":"/posts/an-incomplete-guide-to-data-security/#äº”è·¨å¹³å°çš„åŠ å¯†å¤‡ä»½åŒæ­¥å·¥å…·çš„é€‰æ‹©"},{"categories":["tech"],"content":" å…­ã€ç¾éš¾æ¢å¤ç›¸å…³çš„æ•°æ®å­˜å‚¨ä¸ç®¡ç†ç›¸å…³æ•°æ®åŒ…æ‹¬ï¼šGitHub, Twitter, Google ç­‰é‡è¦è´¦å·çš„äºŒæ¬¡è®¤è¯æ¢å¤ä»£ç ã€è´¦å·æ•°æ®å¤‡ä»½ã€PGP ä¸»å¯†é’¥ä¸åŠé”€è¯ä¹¦ç­‰ç­‰ã€‚ è¿™äº›æ•°æ®æ—¥å¸¸éƒ½ä¸éœ€è¦ç”¨åˆ°ï¼Œä½†åœ¨è´¦å·æˆ–ä¸¤æ­¥éªŒè¯è®¾å¤‡ä¸¢å¤±æ—¶å°±éè¦ä½¿ç”¨åˆ°å…¶ä¸­çš„æ•°æ®æ‰èƒ½æ‰¾å›è´¦å·æˆ–åŠé”€æŸä¸ªè¯ä¹¦ï¼Œæ˜¯éå¸¸é‡è¦çš„æ•°æ®ã€‚ æˆ‘ç›®å‰çš„ç­–ç•¥æ˜¯ï¼šä½¿ç”¨ rclone + 1024bits éšæœºå¯†ç åŠ å¯†å­˜å‚¨åˆ°ä¸¤ä¸ª U ç›˜ä¸­ï¼ˆåŒå‰¯æœ¬ï¼‰ï¼Œæ”¾åœ¨ä¸åŒçš„åœ°æ–¹ï¼Œå¹¶ä¸”æ¯éš”åŠå¹´åˆ°ä¸€å¹´æ£€æŸ¥ä¸€éæ•°æ®ã€‚ å¯¹åº”çš„ rclone è§£å¯†é…ç½®æœ¬èº«ä¹Ÿè®¾ç½®äº†æ¯”è¾ƒå¼ºçš„ passphrase ä¿æŠ¤ï¼Œå¹¶é€šè¿‡æˆ‘çš„ secrets ç§æœ‰ Git ä»“åº“å¤šç«¯åŠ å¯†åŒæ­¥ã€‚ ","date":"2024-01-30","objectID":"/posts/an-incomplete-guide-to-data-security/:7:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["å®‰å…¨","å¯†ç å­¦","Linux","SSH","PGP","å¯†ç ç®¡ç†","LUKS","å…¨ç›˜åŠ å¯†","é›¶ä¿¡ä»»","rclone"],"title":"ä¸ªäººæ•°æ®å®‰å…¨ä¸å®Œå…¨æŒ‡å—","uri":"/posts/an-incomplete-guide-to-data-security/#å…­ç¾éš¾æ¢å¤ç›¸å…³çš„æ•°æ®å­˜å‚¨ä¸ç®¡ç†"},{"categories":["tech"],"content":" ä¸ƒã€éœ€è¦åœ¨å¤šç«¯è®¿é—®çš„é‡è¦ä¸ªäººæ•°æ®ç›¸å…³æ•°æ®åŒ…æ‹¬ï¼šä¸ªäººç¬”è®°ã€é‡è¦çš„ç…§ç‰‡ã€å½•éŸ³ã€è§†é¢‘ã€ç­‰ç­‰ã€‚ å› ä¸ºæ—¥å¸¸å°±éœ€è¦åœ¨å¤šç«¯è®¿é—®ï¼Œå› æ­¤æ˜¾ç„¶ä¸èƒ½ç¦»çº¿å­˜å‚¨ã€‚ ","date":"2024-01-30","objectID":"/posts/an-incomplete-guide-to-data-security/:8:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["å®‰å…¨","å¯†ç å­¦","Linux","SSH","PGP","å¯†ç ç®¡ç†","LUKS","å…¨ç›˜åŠ å¯†","é›¶ä¿¡ä»»","rclone"],"title":"ä¸ªäººæ•°æ®å®‰å…¨ä¸å®Œå…¨æŒ‡å—","uri":"/posts/an-incomplete-guide-to-data-security/#ä¸ƒéœ€è¦åœ¨å¤šç«¯è®¿é—®çš„é‡è¦ä¸ªäººæ•°æ®"},{"categories":["tech"],"content":" 1. ä¸ªäººç¬”è®°ä¸åŒ…å«ä¸ªäººéšç§çš„ç¬”è®°ï¼Œæˆ‘ç›´æ¥ç”¨å…¬å¼€ GitHub ä»“åº“ [ryan4yin/knowledge] (https://github.com/ryan4yin/knowledge/) å­˜å‚¨äº†ï¼Œä¸éœ€è¦åŠ å¯†ã€‚ å¯¹äºä¸ä¾¿å…¬å¼€çš„ä¸ªäººç¬”è®°ï¼Œæœ‰è¿™äº›è€ƒè™‘ï¼š æˆ‘çš„ä¸ªäººç¬”è®°ç›®å‰ä¸»è¦æ˜¯åœ¨ç§»åŠ¨ç«¯ç¼–è¾‘ï¼Œå› æ­¤æ”¯æŒ Android/iOS çš„å®¢æˆ·ç«¯æ˜¯å¿…é¡»çš„ã€‚ è¦èƒ½æ”¯æŒ Markdown/Orgmode ç­‰é€šç”¨çš„çº¯æ–‡æœ¬æ ¼å¼ï¼Œçº¯æ–‡æœ¬æ ¼å¼æ›´å®¹æ˜“ç¼–å†™ä¸åˆ†æï¼Œè€Œé€šç”¨æ ¼å¼åˆ™å¯ä»¥é¿å…è¢«å¹³å°ç»‘å®šã€‚ å› ä¸ºä¸»è¦æ˜¯ç§»åŠ¨ç«¯ç¼–è¾‘ï¼Œå…¶å®ä¸éœ€è¦å¤šå¤æ‚çš„åŠŸèƒ½ã€‚ ä»¥åå¯èƒ½ä¼šå¸Œæœ›åœ¨æ¡Œé¢ç«¯åšå¯Œæ–‡æœ¬ç¼–è¾‘ï¼Œä½†ç›®å‰è¿˜æ²¡è¿™ç§ç§äººç¬”è®°çš„éœ€æ±‚ã€‚ å¸Œæœ›å…·æœ‰ç±»ä¼¼ Git çš„åˆ†å¸ƒå¼å­˜å‚¨ä¸åŒæ­¥ã€ç¬”è®°ç‰ˆæœ¬ç®¡ç†åŠŸèƒ½ï¼Œå¦‚æœèƒ½ç›´æ¥ä½¿ç”¨ Git é‚£è‚¯å®šæ˜¯æœ€å¥½çš„ã€‚ ç«¯åˆ°ç«¯çš„åŠ å¯†å­˜å‚¨ä¸åŒæ­¥ å¦‚æœæœ‰ç±»ä¼¼ Git çš„ Diff åŠŸèƒ½å°±æ›´å¥½äº†ã€‚ æˆ‘ä¸€å¼€å§‹è€ƒè™‘ç›´æ¥ä½¿ç”¨åŸºäº Git ä»“åº“çš„æ–¹æ¡ˆï¼Œèƒ½è·å¾— Git çš„æ‰€æœ‰åŠŸèƒ½ï¼ŒåŒæ—¶è¿˜é¿å…é¢å¤–è‡ªå»ºä¸€ä¸ªç¬”è®°æœåŠ¡ã€‚æ‰¾åˆ°ä¸ª GitJournal ï¼Œæ•°æ®å­˜åœ¨ GitHub ç§æœ‰ä»“åº“ç”¨äº†ä¸€ä¸ªæœˆï¼ŒåŠŸèƒ½ä¸å¤ªå¤šä½†å¤Ÿç”¨ã€‚ä½†å‘ç°å®ƒé¡¹ç›®ä¸å’‹æ´»è·ƒï¼ŒåŸºäº SSH åè®®çš„ Git åŒæ­¥åœ¨å¤§ä»“åº“ä¸Šä¹Ÿæœ‰äº›æ¯›ç—…ï¼Œè€Œä¸”æ•°æ®æ˜æ–‡å­˜åœ¨ Git ä»“åº“é‡Œï¼Œå®‰å…¨æ€§ç›¸å¯¹å·®ä¸€äº›ã€‚ å¦å¤–æ‰¾åˆ°ä¸ª git-crypt èƒ½åœ¨ Git ä¸Šåšä¸€å±‚é€æ˜åŠ å¯†ï¼Œä½†æ²¡æ‰¾åˆ°æ”¯æŒå®ƒçš„ç§»åŠ¨ç«¯ APPï¼Œè€Œä¸”é¡¹ç›®ä¹Ÿä¸å’‹æ´»è·ƒã€‚ åœ¨ https://github.com/topics/note-taking ä¸‹çœ‹äº†äº›æµè¡Œé¡¹ç›®ï¼Œä¸»è¦æœ‰è¿™äº›ï¼š Joplin æ”¯æŒ S3/WebDAV ç­‰å¤šç§åè®®åŒæ­¥æ•°æ®ï¼Œæ”¯æŒç«¯åˆ°ç«¯åŠ å¯† Outline ç­‰ Wiki ç³»ç»Ÿ å®ƒç›´æ¥å°±æ˜¯ä¸ª Web æœåŠ¡ï¼Œä¸»è¦é¢å‘å…¬å¼€çš„ Wikiï¼Œä¸é€‚åˆç§äººç¬”è®° Logseq/Obsidian ç­‰åŒé“¾ç¬”è®°è½¯ä»¶ï¼ˆå…¶ä¸­ Obsidian æ˜¯é—­æºè½¯ä»¶ï¼‰ éƒ½æ˜¯åŸºäºæœ¬åœ°æ–‡ä»¶çš„ç¬”è®°ç³»ç»Ÿï¼Œä¹Ÿæ²¡åŠ å¯†å·¥å…·ï¼Œéœ€è¦å€ŸåŠ©å…¶ä»–å·¥å…·å®ç°æ•°æ®åŠ å¯†ä¸åŒæ­¥ å…¶ä¸­ Logseq æ˜¯å¤§çº²æµï¼Œä¸€åˆ‡çš†åˆ—è¡¨ã€‚è€Œ Obsidian æ˜¯æ–‡æ¡£æµï¼Œæ¯”è¾ƒè´´è¿‘ä¼ ç»Ÿçš„æ–‡æ¡£ç¼–è¾‘ä½“éªŒã€‚ Obsidian è·Ÿ Logseq çš„ Sync åŠŸèƒ½éƒ½æ˜¯æŒ‰æœˆæ”¶è´¹ï¼Œç›¸å½“çš„è´µã€‚ç¤¾åŒºæœ‰é€šè¿‡ Git åŒæ­¥çš„æ–¹æ¡ˆï¼Œä½†éƒ½å¾ˆ trickkï¼Œä¹Ÿä¸ç¨³å®šã€‚ AppFlowy/Affine/apitable ç­‰ Notion æ›¿ä»£å“ éƒ½æ˜¯å¯Œæ–‡æœ¬ç¼–è¾‘ï¼Œä¸é€‚åˆç§»åŠ¨ç«¯è®¾å¤‡ åœ¨ç§»åŠ¨ç«¯ä½¿ç”¨ Synthing æˆ– Git ç­‰ç¬¬ä¸‰æ–¹å·¥å…·åŒæ­¥ç¬”è®°æ•°æ®ï¼Œéƒ½å¾ˆéº»çƒ¦ï¼Œè€Œä¸”å®‰å…¨æ€§ä¹Ÿä¸å¤Ÿã€‚å› æ­¤ç›®å‰çœ‹åœ¨ç§»åŠ¨ç«¯ä¹Ÿèƒ½ç”¨å¾—èˆ’æœçš„è¯ï¼Œæœ€ç¨³å¦¥çš„é€‰æ‹©æ˜¯ç¬¬ä¸€ç±»ç¬”è®° APPï¼Œç®€å•è¯•ç”¨åæˆ‘é€‰æ‹©äº†æœ€æµè¡Œçš„ Joplin. ","date":"2024-01-30","objectID":"/posts/an-incomplete-guide-to-data-security/:8:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["å®‰å…¨","å¯†ç å­¦","Linux","SSH","PGP","å¯†ç ç®¡ç†","LUKS","å…¨ç›˜åŠ å¯†","é›¶ä¿¡ä»»","rclone"],"title":"ä¸ªäººæ•°æ®å®‰å…¨ä¸å®Œå…¨æŒ‡å—","uri":"/posts/an-incomplete-guide-to-data-security/#1-ä¸ªäººç¬”è®°"},{"categories":["tech"],"content":" 2. ç…§ç‰‡ã€è§†é¢‘ç­‰å…¶ä»–ä¸ªäººæ•°æ® Homelab ä¸­çš„ Windows-NAS-Serverï¼Œä¸¤ä¸ª 4TB çš„ç¡¬ç›˜ï¼Œé€šè¿‡ SMB å±€åŸŸç½‘å…±äº«ï¼Œå…¬ç½‘æ‰€æœ‰å®¢æˆ·ç«¯ ï¼ˆåŒ…æ‹¬ç§»åŠ¨ç«¯ï¼‰éƒ½èƒ½é€šè¿‡ tailscale + rclone æµç•…è®¿é—®ã€‚ éƒ¨åˆ†é‡è¦çš„æ•°æ®å†é€šè¿‡ rclone åŠ å¯†å¤‡ä»½ä¸€ä»½åˆ°äº‘ç«¯ï¼Œå¯é€‰é¡¹æœ‰ï¼š é’äº‘å¯¹è±¡å­˜å‚¨ ä¸ä¸ƒç‰›äº‘å¯¹è±¡å­˜å‚¨ Kodoï¼Œå®ƒä»¬éƒ½æœ‰æ¯æœˆ 10GB çš„å…è´¹å­˜å‚¨ç©ºé—´ï¼Œä»¥åŠ 1GB-10GB çš„å…è´¹å¤–ç½‘æµé‡ã€‚ é˜¿é‡Œäº‘ OSS ä¹Ÿèƒ½å…è´¹å­˜ 5GB æ•°æ®ä»¥åŠæ¯æœˆ 5GB çš„å¤–ç½‘æµé‡ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ã€‚ ","date":"2024-01-30","objectID":"/posts/an-incomplete-guide-to-data-security/:8:2","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["å®‰å…¨","å¯†ç å­¦","Linux","SSH","PGP","å¯†ç ç®¡ç†","LUKS","å…¨ç›˜åŠ å¯†","é›¶ä¿¡ä»»","rclone"],"title":"ä¸ªäººæ•°æ®å®‰å…¨ä¸å®Œå…¨æŒ‡å—","uri":"/posts/an-incomplete-guide-to-data-security/#2-ç…§ç‰‡è§†é¢‘ç­‰å…¶ä»–ä¸ªäººæ•°æ®"},{"categories":["tech"],"content":" å…«ã€æ¡Œé¢ç”µè„‘èˆ‡ Homelab çš„æ•°æ®å®‰å…¨æˆ‘çš„æ¡Œé¢ç”µè„‘éƒ½æ˜¯ macOS ä¸ NixOSï¼ŒHomlab è™šæ‹Ÿæœºä¹Ÿå·²ç» all in NixOSï¼Œå¦å¤–æˆ‘ç›®å‰æ²¡æœ‰ä»»ä½•äº‘ä¸ŠæœåŠ¡å™¨ã€‚ å¦å¤–è™½ç„¶ä¹Ÿæœ‰ä¸¤å° Windows è™šæ‹Ÿæœºï¼Œä½†æå°‘å¯¹å®ƒä»¬åšå•¥æ”¹åŠ¨ï¼Œåªè¦åšå¥½è™šæ‹Ÿæœºå¿«ç…§çš„å¤‡ä»½å°± OK äº†ã€‚ å¯¹äº NixOS æ¡Œé¢ç³»ç»Ÿä¸ Homelab è™šæ‹Ÿæœºï¼Œæˆ‘å½“å‰çš„æ–¹æ¡ˆå¦‚ä¸‹ï¼š æ¡Œé¢ä¸»æœº å¯ç”¨ LUKS2 å…¨ç›˜åŠ å¯† + Secure Bootï¼Œåœ¨ç³»ç»Ÿå¯åŠ¨é˜¶æ®µéœ€è¦è¾“å…¥ passphrase è§£å¯† NixOS ç³»ç»Ÿç›˜æ‰èƒ½æ­£å¸¸è¿›å…¥ç³»ç»Ÿã€‚ LUKS2 çš„ passphrase ä¸ºä¸€ä¸ªæ¯”è¾ƒé•¿çš„å¯†ç å­¦éšæœºå­—ç¬¦ä¸²ã€‚ LUKS2 çš„æ‰€æœ‰å®‰å…¨è®¾ç½®å…¨æ‹‰åˆ°èƒ½æ¥å—çš„æœ€é«˜ï¼ˆæ¯”è¾ƒé‡è¦çš„æ˜¯ --iter-timeï¼Œè®¡ç®—å‡º unlock key çš„ç”¨æ—¶ï¼Œé»˜è®¤ 2sï¼Œå®‰å…¨èµ·è§å’±è®¾ç½®æˆäº† 5sï¼‰ text cryptsetup --type luks2 --cipher aes-xts-plain64 --hash sha512 --iter-time 5000 --key-size 256 --pbkdf argon2id --use-urandom --verify-passphrase luksFormat device LUKS2 ä½¿ç”¨çš„ argon2id æ˜¯æ¯” scrypt æ›´å¼ºçš„ KDF ç®—æ³•ï¼Œå…¶å®‰å…¨æ€§æ˜¯è¶³å¤Ÿçš„ã€‚ æ¡Œé¢ä¸»æ©Ÿä½¿ç”¨ tmpfs ä½œä¸ºæ ¹ç›®å½•ï¼Œæ‰€æœ‰æœªæ˜ç¡®å£°æ˜æŒä¹…åŒ–çš„æ•°æ®ï¼Œéƒ½ä¼šåœ¨æ¯æ¬¡é‡å¯åè¢«æ¸…ç©ºï¼Œè¿™å¼ºåˆ¶æˆ‘å»äº†è§£è‡ªå·±è£…çš„æ¯ä¸ªè½¯ä»¶éƒ½å­˜äº†å“ªäº›æ•°æ®ï¼Œæ˜¯å¦éœ€è¦æŒä¹…åŒ–ï¼Œä½¿æ•´ä¸ªç³»ç»Ÿæ›´ç™½ç›’ï¼Œæå‡äº†æ•´ä¸ªç³»ç»Ÿçš„ç¯å¢ƒå¯ä¿¡åº¦ã€‚ Homelab Proxmox VE ç‰©ç†æœºå…¨éƒ¨é‡è£…ä¸º NixOSï¼Œå¯ç”¨ LUKS å…¨ç›˜åŠ å¯†ä¸ btrfs + zstd å‹ç¼©ï¼Œä¹°å‡ ä¸ªä¾¿å®œçš„ U ç›˜ç”¨äºè‡ªåŠ¨è§£å¯†ï¼ˆæ³¨æ„è§£å¯†å¯†é’¥çš„ç¦»çº¿åŠ å¯†å¤‡ä»½ï¼‰ã€‚ä½¿ç”¨ K3s + KubeVirt ç®¡ç† QEMU/KVM è™šæ‹Ÿæœºã€‚ Secrets èªªæ˜ é‡è¦çš„é€šç”¨ secretsï¼Œéƒ½åŠ å¯†ä¿å­˜åœ¨æˆ‘çš„ secrets ç§æœ‰ä»“åº“ä¸­ï¼Œåœ¨éƒ¨ç½²æˆ‘çš„ nix-config æ—¶ä½¿ç”¨ä¸»æœºæœ¬åœ°çš„ SSH ç³»ç»Ÿç§é’¥è‡ªåŠ¨è§£å¯†ã€‚ ä¹Ÿå°±æ˜¯è¯´è¦åœ¨ä¸€å°æ–°ç”µè„‘ï¼ˆä¸è«–æ˜¯æ¡Œé¢ä¸»æ©Ÿé‚„æ˜¯ NixOS è™›æ“¬æ©Ÿï¼‰ä¸ŠæˆåŠŸéƒ¨ç½²æˆ‘çš„ nix-config é…ç½®ï¼Œéœ€è¦çš„å‡†å¤‡æµç¨‹ï¼š æœ¬åœ°ç”Ÿæˆä¸€ä¸ªæ–°çš„ ssh keyï¼Œå°†å…¬é’¥é…ç½®åˆ° GitHubï¼Œå¹¶ ssh-add è¿™ä¸ªæ–°çš„ç§é’¥ï¼Œä½¿å…¶èƒ½å¤Ÿè®¿é—®åˆ°æˆ‘çš„ç§æœ‰ secrets ä»“åº“ã€‚ å°†æ–°ä¸»æœºçš„ç³»ç»Ÿå…¬é’¥ /etc/ssh/ssh_host_ed25519_key.pub å‘é€åˆ°ä¸€å°æ—§çš„å¯è§£å¯† secrets ä»“åº“æ•°æ®çš„ä¸»æœºä¸Šã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨åˆ™å…ˆç”¨ sudo ssh-keygen -A ç”Ÿæˆã€‚ åœ¨æ—§ä¸»æœºä¸Šï¼Œå°†æ”¶åˆ°çš„æ–°ä¸»æœºå…¬é’¥æ·»åŠ åˆ° secrets ä»“åº“çš„ secrets.nix é…ç½®æ–‡ä»¶ä¸­ï¼Œå¹¶ä½¿ç”¨ agenix å‘½ä»¤ rekey æ‰€æœ‰ secrets æ•°æ®ï¼Œç„¶å commit \u0026 pushã€‚ ç°åœ¨æ–°ä¸»æœºå°±èƒ½å¤Ÿé€šè¿‡ nixos-rebuild switch æˆ– darwin-rebuild switch æˆåŠŸéƒ¨ç½²æˆ‘çš„ nix-config äº†ï¼Œagenix ä¼šè‡ªåŠ¨ä½¿ç”¨æ–°ä¸»æœºçš„ç³»ç»Ÿç§é’¥/etc/ssh/ssh_host_ed25519_key è§£å¯† secrets ä»“åº“ä¸­çš„æ•°æ®å¹¶å®Œæˆéƒ¨ç½²å·¥ä½œã€‚ è¿™ä»½ secrets é…ç½®åœ¨ macOS è·Ÿ NixOS ä¸Šé€šç”¨ï¼Œä¹Ÿä¸ CPU æ¶æ„æ— å…³ï¼Œagenix åœ¨è¿™ä¸¤ä¸ªç³»ç»Ÿä¸Šéƒ½èƒ½æ­£å¸¸å·¥ä½œã€‚ åŸºäºå®‰å…¨æ€§è€ƒè™‘ï¼Œå¯¹ secrets è¿›è¡Œåˆ†ç±»ç®¡ç†ä¸åŠ å¯†ï¼š æ¡Œé¢ç”µè„‘èƒ½è§£å¯†æ‰€æœ‰çš„ secrets Homelab ä¸­çš„è·³æ¿æœºåªèƒ½è§£å¯† Homelab ç›¸å…³çš„æ‰€æœ‰ secrets å…¶ä»–æ‰€æœ‰çš„ NixOS è™šæ‹Ÿæœºåªèƒ½è§£å¯†åŒç±»åˆ«çš„ secretsï¼Œæ¯”å¦‚ä¸€å°ç›‘æ§æœºåªèƒ½è§£å¯†ç›‘æ§ç›¸å…³çš„ secrets. å¯¹äº macOSï¼Œå®ƒæœ¬èº«çš„ç£ç›˜å®‰å…¨æˆ‘æ„Ÿè§‰å°±å·²ç»åšå¾—å¾ˆ OK äº†ï¼Œè€Œä¸”å®ƒèƒ½æ”¹çš„ä¸œè¥¿ä¹Ÿæ¯”è¾ƒæœ‰é™ã€‚æˆ‘çš„å®‰å…¨è®¾ç½®å¦‚ä¸‹ï¼š å¯ç”¨ macOS çš„å…¨ç›˜åŠ å¯†åŠŸèƒ½ å¸¸ç”¨çš„ secrets çš„éƒ¨ç½²ä¸ä½¿ç”¨æ–¹å¼ï¼Œä¸å‰é¢ NixOS çš„æè¿°å®Œå…¨ä¸€è‡´ ","date":"2024-01-30","objectID":"/posts/an-incomplete-guide-to-data-security/:9:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["å®‰å…¨","å¯†ç å­¦","Linux","SSH","PGP","å¯†ç ç®¡ç†","LUKS","å…¨ç›˜åŠ å¯†","é›¶ä¿¡ä»»","rclone"],"title":"ä¸ªäººæ•°æ®å®‰å…¨ä¸å®Œå…¨æŒ‡å—","uri":"/posts/an-incomplete-guide-to-data-security/#å…«æ¡Œé¢ç”µè„‘èˆ‡-homelab-çš„æ•°æ®å®‰å…¨"},{"categories":["tech"],"content":" macOS/NixOS æ•°æ®çš„ç¾éš¾æ¢å¤ï¼Ÿåœ¨ä½¿ç”¨ nix-darwin è·Ÿ NixOS çš„æƒ…å†µä¸‹ï¼Œæ•´ä¸ª macOS/NixOS çš„ç³»ç»Ÿç¯å¢ƒéƒ½æ˜¯é€šè¿‡æˆ‘çš„ryan4yin/nix-config å£°æ˜å¼é…ç½®çš„ï¼Œå› æ­¤æ¡Œé¢ç”µè„‘çš„ç¾éš¾æ¢å¤æ ¹æœ¬ä¸æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚ åªéœ€è¦ç®€å•çš„å‡ è¡Œå‘½ä»¤å°±èƒ½åœ¨ä¸€ä¸ªå…¨æ–°çš„ç³»ç»Ÿä¸Šæ¢å¤å‡ºæˆ‘çš„ macOS / NixOS æ¡Œé¢ç¯å¢ƒï¼Œæ‰€æœ‰å¯†é’¥ä¹Ÿä¼šç”± agenix è‡ªåŠ¨è§£å¯†å¹¶æ”¾ç½®åˆ°æ­£ç¡®çš„ä½ç½®ã€‚ è¦è¯´æœ‰æ¢å¤éš¾é¢˜çš„ï¼Œä¹Ÿå°±æ˜¯ä¸€äº›ä¸ªäººæ•°æ®äº†ï¼Œè¿™éƒ¨åˆ†å·²ç»åœ¨å‰é¢ç¬¬ä¸ƒå°èŠ‚ä»‹ç»è¿‡äº†ï¼Œç”¨ rclone/restic å°±è¡Œã€‚ ","date":"2024-01-30","objectID":"/posts/an-incomplete-guide-to-data-security/:9:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["å®‰å…¨","å¯†ç å­¦","Linux","SSH","PGP","å¯†ç ç®¡ç†","LUKS","å…¨ç›˜åŠ å¯†","é›¶ä¿¡ä»»","rclone"],"title":"ä¸ªäººæ•°æ®å®‰å…¨ä¸å®Œå…¨æŒ‡å—","uri":"/posts/an-incomplete-guide-to-data-security/#macosnixos-æ•°æ®çš„ç¾éš¾æ¢å¤"},{"categories":["tech"],"content":" ä¹ã€æ€»ç»“ä¸‹æˆ‘çš„æ•°æ®å­˜åœ¨äº†å“ªäº›åœ°æ–¹ secrets ç§æœ‰ä»“åº“: å®ƒä¼šè¢«æˆ‘çš„ nix-config è‡ªåŠ¨æ‹‰å–å¹¶éƒ¨ç½²åˆ°æ‰€æœ‰ä¸»åŠ›ç”µè„‘ä¸Šï¼ŒåŒ…å«äº† homelab ssh key, GPG subkey, ä»¥åŠå…¶ä»–ä¸€äº›é‡è¦çš„ secrets. å®ƒé€šè¿‡æˆ‘æ‰€æœ‰æ¡Œé¢ç”µè„‘çš„ /etc/ssh/ssh_host_ed25519_key.pub å…¬é’¥åŠ å¯†ï¼Œåœ¨éƒ¨ç½²æ—¶è‡ªåŠ¨ä½¿ç”¨å¯¹åº”çš„ç§é’¥è§£å¯†ã€‚ æ­¤å¤–è¯¥ä»“åº“è¿˜æ·»åŠ äº†ä¸€ä¸ªç¾éš¾æ¢å¤ç”¨çš„å…¬é’¥ï¼Œç¡®ä¿åœ¨æˆ‘æ‰€æœ‰æ¡Œé¢ç”µè„‘éƒ½ä¸¢å¤±çš„æç«¯æƒ…å†µä¸‹ï¼Œä»å¯é€šè¿‡å¯¹åº”çš„ç¾éš¾æ¢å¤ç§é’¥è§£å¯†æ­¤ä»“åº“çš„æ•°æ®ã€‚è¯¥ç§é’¥åœ¨ä½¿ç”¨ age åŠ å¯†åï¼ˆæ³¨ï¼šæœªä½¿ç”¨ rclone åŠ å¯†ï¼‰ä¸æˆ‘å…¶ä»–çš„ç¾éš¾æ¢å¤æ•°æ®ä¿å­˜åœ¨ä¸€èµ·ã€‚ password-store: æˆ‘çš„ç§äººè´¦å·å¯†ç å­˜å‚¨åº“ï¼Œé€šè¿‡ pass å‘½ä»¤è¡Œå·¥å…·ç®¡ç†ï¼Œä½¿ç”¨ GPG åŠ å¯†ï¼ŒGPG å¯†é’¥å¤‡ä»½è¢«é€šè¿‡ age/agenix åŠ å¯†ä¿å­˜åœ¨ä¸Šè¿° secrets ä»“åº“ä¸­ã€‚ ç”±äº GnuPG è‡ªèº«å¯¼å‡ºçš„å¯†é’¥å¤‡ä»½æ•°æ®å®‰å…¨æ€§æ¬ ä½³ï¼Œå› æ­¤æˆ‘ä½¿ç”¨äº† age + passphrase å¯¹å…¶è¿›è¡Œäº†äºŒæ¬¡å¯¹ç§°åŠ å¯†ï¼Œç„¶åå†é€šè¿‡ agenix åŠ å¯†ï¼ˆç¬¬ä¸‰æ¬¡åŠ å¯†ï¼Œä½¿ç”¨éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼‰ä¿å­˜åœ¨ secrets ä»“åº“ä¸­ã€‚è¿™ä¿éšœäº†å³ä½¿æˆ‘çš„ GPG å¯†é’¥åœ¨æˆ‘æ‰€æœ‰çš„æ¡Œé¢ç”µè„‘ä¸Šéƒ½å­˜åœ¨ï¼Œä½†å®‰å…¨æ€§ä»æ—§å¾ˆå¤Ÿã€‚ rclone åŠ å¯†çš„å¤‡ä»½ U ç›˜ï¼ˆåŒå‰¯æœ¬ï¼‰ï¼šç¦»çº¿ä¿å­˜ä¸€äº›é‡è¦çš„æ•°æ®ã€‚å…¶é…ç½®æ–‡ä»¶è¢«åŠ å¯†ä¿å­˜åœ¨ secrets ä»“åº“ä¸­ï¼Œå…¶é…ç½®æ–‡ä»¶çš„è§£å¯†å¯†ç è¢«åŠ å¯†ä¿å­˜åœ¨ password-store ä»“åº“ä¸­ã€‚ è¿™å¥—æ–¹æ¡ˆçš„å¤§éƒ¨åˆ†éƒ¨ç½²å·¥ä½œéƒ½æ˜¯ç”±æˆ‘çš„ Nix é…ç½®è‡ªåŠ¨å®Œæˆçš„ï¼Œæ•´ä¸ªæµç¨‹çš„è‡ªåŠ¨åŒ–ç¨‹åº¦å¾ˆé«˜ï¼Œæ‰€ä»¥è¿™å¥—æ–¹æ¡ˆå¸¦ç»™æˆ‘çš„é¢å¤–è´Ÿæ‹…å¹¶ä¸å¤§ã€‚ secrets è¿™ä¸ªç§æœ‰ä»“åº“æ˜¯æ•´ä¸ªæ–¹æ¡ˆçš„æ ¸å¿ƒï¼Œå®ƒåŒ…å«äº†æ‰€æœ‰é‡è¦æ•°æ®ï¼ˆpassword-store/rclone/â€¦ï¼‰çš„è§£å¯†å¯†é’¥ã€‚å¦‚æœå®ƒä¸¢å¤±äº†ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„æ•°æ®éƒ½æ— æ³•è§£å¯†ã€‚ ä½†å¥½åœ¨ Git ä»“åº“æœ¬èº«æ˜¯åˆ†å¸ƒå¼çš„ï¼Œæˆ‘æ‰€æœ‰çš„æ¡Œé¢ç”µè„‘ä¸Šéƒ½æœ‰å¯¹åº”çš„å®Œæ•´å¤‡ä»½ï¼Œæˆ‘çš„ç¾éš¾æ¢å¤å­˜å‚¨ä¸­ä¹Ÿä¼šå®šæœŸå¤‡ä»½ä¸€ä»½ secrets/password-store ä¸¤ä¸ªä»“åº“çš„æ•°æ®è¿‡å»ä»¥é¿å…ä¸¢å¤±ã€‚ å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸ºäº†é¿å…å¾ªç¯ä¾èµ–ï¼Œsecrets ä¸ password-store è¿™ä¸¤ä¸ªä»“åº“çš„å¤‡ä»½ä¸åº”è¯¥ä½¿ç”¨ rclone å†æ¬¡åŠ å¯†ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨ age å¯¹ç§°åŠ å¯†ã€‚è¿™æ ·åªè¦æˆ‘è¿˜è®°å¾— age çš„è§£å¯†å¯†ç ã€gpg å¯†é’¥çš„ passphrase ç­‰å°‘æ•°å‡ ä¸ªå¯†ç ï¼Œå°±èƒ½é¡ºç€æ•´æ¡é“¾è·¯è§£å¯†å‡ºæ‰€æœ‰çš„æ•°æ®ã€‚ ","date":"2024-01-30","objectID":"/posts/an-incomplete-guide-to-data-security/:10:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["å®‰å…¨","å¯†ç å­¦","Linux","SSH","PGP","å¯†ç ç®¡ç†","LUKS","å…¨ç›˜åŠ å¯†","é›¶ä¿¡ä»»","rclone"],"title":"ä¸ªäººæ•°æ®å®‰å…¨ä¸å®Œå…¨æŒ‡å—","uri":"/posts/an-incomplete-guide-to-data-security/#ä¹æ€»ç»“ä¸‹æˆ‘çš„æ•°æ®å­˜åœ¨äº†å“ªäº›åœ°æ–¹"},{"categories":["tech"],"content":" åã€è¿™å¥—æ–¹æ¡ˆä¸‹éœ€è¦è®°å¿†å‡ ä¸ªå¯†ç ï¼Ÿè¿™äº›å¯†ç è¯¥å¦‚ä½•è®¾è®¡ï¼Ÿç»å¤§éƒ¨åˆ†å¯†ç éƒ½å»ºè®®è®¾ç½®ä¸ºåŒ…å«å¤§å°å†™è·Ÿéƒ¨åˆ†ç‰¹æ®Šå­—ç¬¦çš„å¯†ç å­¦éšæœºå­—ç¬¦ä¸²ï¼Œé€šè¿‡ pass åŠ å¯†ä¿å­˜ä¸å¤šç«¯åŒæ­¥ä¸è‡ªåŠ¨å¡«å……ï¼Œä¸éœ€è¦é¢å¤–è®°å¿†ã€‚è€ƒè™‘åˆ°æˆ‘ä»¬åŸºæœ¬ä¸ä¼šéœ€è¦æ‰‹åŠ¨è¾“å…¥è¿™äº›å¯†ç ï¼Œå› æ­¤å®ƒä»¬çš„é•¿åº¦å¯ä»¥è®¾ç½®å¾—æ¯”è¾ƒé•¿ï¼Œæ¯”å¦‚ 16-24 ä½ï¼ˆä¸ä½¿ç”¨æ›´é•¿å¯†ç çš„åŸå› æ˜¯ï¼Œè®¸å¤šç«™ç‚¹æˆ– APP éƒ½é™åˆ¶äº†å¯†ç é•¿åº¦ï¼Œè¿™ç§é•¿åº¦ä¸‹ä½¿ç”¨ passphrase å•è¯ç»„çš„å®‰å…¨æ€§ç›¸å¯¹ä¼šå·®ä¸€ç‚¹ï¼Œå› æ­¤ä¹Ÿä¸æ¨èï¼‰ã€‚ å†é€šè¿‡ä¸€äº›åˆç†çš„å¯†ç å¤ç”¨æ‰‹æ®µï¼Œå¯ä»¥å°†éœ€è¦è®°å¿†çš„å¯†ç æ•°é‡é™åˆ° 3 - 5 ä¸ªï¼Œå¹¶ä¸”ç¡®ä¿æ—¥å¸¸éƒ½ä¼šè¾“å…¥ï¼Œé¿å…é—å¿˜ã€‚ ä¸è¿‡è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œå°±æ˜¯ SSH å¯†é’¥ã€GPG å¯†é’¥ã€ç³»ç»Ÿç™»å½•å¯†ç è¿™ä¸‰ä¸ªå¯†ç æœ€å¥½ä¸è¦è®¾æˆä¸€æ ·ã€‚å‰é¢æˆ‘ä»¬å·²ç»åšäº†åˆ†æï¼Œè¿™ä¸‰ä¸ª passphrase çš„åŠ å¯†å¼ºåº¦åŒºåˆ«å¾ˆå¤§ï¼Œè®¾æˆä¸€æ ·çš„è¯ï¼Œä½¿ç”¨ bcrypt çš„ SSH å¯†é’¥å°†ä¼šæˆä¸ºæ•´ä¸ªæ–¹æ¡ˆçš„çŸ­æ¿ã€‚ è€Œå…³äºå¯†ç å†…å®¹çš„è®¾è®¡ï¼Œè¿™ä¸ªå‡ æ ¸å¿ƒ passphrase çš„é•¿åº¦éƒ½æ˜¯ä¸å—é™çš„ï¼Œæœ‰ä¸¤ä¸ªæ€è·¯ï¼ˆæ³¨æ„ä¸è¦åœ¨å¯†ç ä¸­åŒ…å«ä»»ä½•ä¸ªäººä¿¡æ¯ï¼‰ï¼š ä½¿ç”¨ç”±ä¸€ä¸ªä¸ªå•è¯ç»„æˆçš„è¾ƒé•¿çš„ passphraseï¼Œæ¯”å¦‚don't-do-evil_I-promise-this-would-become-not-a-dark-corner è¿™æ ·çš„ã€‚ ä½¿ç”¨å­—æ¯å¤§å°å†™åŠ æ•°å­—ã€ç‰¹æ®Šå­—ç¬¦ç»„æˆçš„å¯†ç å­¦éšæœºå­—ç¬¦ä¸²ï¼Œæ¯”å¦‚ fsD!.*v_F*sdn-zFkJM)nQ è¿™æ ·çš„ã€‚ ç¬¬ä¸€ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯ï¼Œè¿™äº›å•è¯éƒ½æ˜¯å¸¸ç”¨å•è¯ï¼Œè®°å¿†èµ·æ¥ä¼šæ¯”è¾ƒå®¹æ˜“ï¼Œè€Œä¸”ä¹Ÿä¸å®¹æ˜“è¾“é”™ã€‚ ç¬¬äºŒç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯ï¼Œå¯†ç å­¦éšæœºå­—ç¬¦ä¸²å¯ä»¥ä»¥æ›´çŸ­çš„é•¿åº¦è¾¾åˆ°ä¸ç¬¬ä¸€ç§æ–¹å¼ç›¸å½“çš„å®‰å…¨æ€§ã€‚ä½†å®ƒçš„ç¼ºç‚¹ä¹Ÿæ¯”è¾ƒæ˜æ˜¾â€”â€”å®¹æ˜“è¾“é”™ï¼Œè€Œä¸”è®°å¿†èµ·æ¥ä¹Ÿä¸å®¹æ˜“ã€‚ ä¸¤ç§æ–¹å¼æ˜¯éƒ½å¯ä»¥ï¼Œå¦‚æœä½ é€‰æ‹©ç¬¬äºŒç§æ–¹å¼ï¼Œå¯ä»¥ä¸“é—¨ç¼–äº›å°æ•…äº‹æ¥é€šè¿‡è”æƒ³è®°å¿†å®ƒä»¬ï¼Œhint ä¸­ä¹Ÿèƒ½åŠ ä¸Šæ•…äº‹ä¸­çš„ä¸€äº›ä¸å¯†ç å†…å®¹æ— ç›´æ¥å…³è”çš„å…³é”®å­—å¸®åŠ©å›å¿†ã€‚æ¯•ç«Ÿäººç±»æ“…é•¿è®°å¿†æ•…äº‹ï¼Œä½†ä¸æ“…é•¿è®°å¿†éšæœºå­—ç¬¦ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä¸Šé¢çš„å¯†ç  fsD!.*v_F*sdn-zFkJM)nQï¼Œå¯ä»¥æ‰¾å‡ºè¿™ä¹ˆäº›è”æƒ³ï¼š fs: ã€Œä½›è¯´ã€è¿™é¦–æ­Œé‡Œé¢çš„æ­Œè¯ D!: å¤´æ–‡å­—D! .*: åœ°é¢ä¸Šçš„å…‰æ–‘(.)ï¼Œå¤©ä¸Šçš„æ˜Ÿå…‰(*) v_: å˜´å·´å¼ å¼€ï¼ˆvï¼‰ç¡å¾—å¾ˆé¦™çš„æ ·å­ï¼Œå£æ°´éƒ½æµåˆ°åœ°ä¸Šäº†(_) F*sdn: F*ck è½¯ä»¶å®šä¹‰ç½‘ç»œ(sdn) zFkJM: åœ¨æ”¿åºœï¼ˆzfï¼‰å¤§é—¨å£ï¼ˆkï¼‰ï¼Œçœ‹(k) è§äº† Jack Ma (JM) åœ¨è·³è„±yièˆâ€¦ )nQ: å®é™çš„å¤å¤œï¼Œå‡‰é£ä¹ ä¹ ï¼Œå¤©ä¸Šä¸€è½®å¼¯æœˆï¼Œä½ (n)é—®(Q)æˆ‘ï¼Œå½“ä¸‹è¿™ä¸€åˆ»æ˜¯å¦è¶³å¤Ÿ æŠŠä¸Šé¢è¿™äº›è”æƒ³ä¸²èµ·æ¥ï¼Œå°±æ˜¯ä¸€ä¸ªæ€€æ—§ã€é›·äººã€ç»“å°¾åˆæœ‰ç‚¹æ¸©é¦¨çš„æ— å˜å¤´å°æ•…äº‹äº†ï¼Œè‚¯å®šèƒ½ä»¤ä½ è‡ªå·±å°è±¡æ·±åˆ»ã€‚æ•…äº‹å†™å¾—å¤Ÿç¦»è°±çš„è¯ï¼Œä½ å¯èƒ½æƒ³å¿˜éƒ½å¿˜ä¸æ‰äº†ã€‚ æ€»ä¹‹å°±æ˜¯ç”¨è¿™ç§æ–¹å¼ï¼Œç„¶åæŠŠå¯†ç ä¸­çš„æ¯ä¸ªå­—ç¬¦éƒ½ä¸æ•…äº‹ä¸­çš„æŸä¸ªå…³é”®å­—è”ç³»èµ·æ¥ï¼Œè¿™æ ·å°±èƒ½å¾ˆå®¹æ˜“åœ°è®°ä½è¿™ä¸ªå¯†ç äº†ã€‚å¦‚æœä½ å¯¹æ·±å…¥å­¦ä¹ å¦‚ä½•è®°å¿†è¿™ç±»å¤æ‚çš„ä¸œè¥¿æ„Ÿå…´è¶£ï¼Œå¯ä»¥çœ‹çœ‹è¿™æœ¬æˆ‘æœ€æƒ³è¦çš„è®°å¿†é­”æ³•ä¹¦. æœ€åä¸€ç‚¹ï¼Œå°±æ˜¯å®šæœŸæ›´æ–°ä¸€éè¿™äº›å¯†ç ã€SSH å¯†é’¥ã€GPG å¯†é’¥ã€‚æ‰€æœ‰æ•°æ®çš„åŠ å¯†å®‰å…¨æ€§éƒ½æ˜¯éšç€æ—¶é—´æ¨ç§»è€Œé™ä½çš„ï¼Œæ›¾ç»å®‰å…¨çš„å¯†ç å­¦ç®—æ³•åœ¨æœªæ¥ä¹Ÿå¯èƒ½ä¼šå˜å¾—ä¸å†å®‰å…¨ï¼ˆè¿™æ–¹é¢ MD5, SHA-1 éƒ½æ˜¯å¾ˆå¥½çš„ä¾‹å­ï¼‰ï¼Œå› æ­¤å®šæœŸæ›´æ–°è¿™äº›å¯†ç è·Ÿå¯†é’¥æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚ å‡ ä¸ªæ ¸å¿ƒå¯†ç æ›´æ–°èµ·æ¥ä¼šç®€å•äº›ï¼Œå¯ä»¥è€ƒè™‘æ¯å¹´æ›´æ–°ä¸€éï¼Œè€Œå¯†é’¥å¯ä»¥è€ƒè™‘æ¯ä¸¤ä¸‰å¹´æ›´æ–°ä¸€éï¼ˆæ—¶é—´å‡­æ„Ÿè§‰è¯´çš„å“ˆï¼Œæ²¡æœ‰åšè®ºè¯ï¼‰ã€‚å…¶ä»–å¯†ç å¯†é’¥åˆ™å¯ä»¥æ ¹æ®æ•°æ®çš„é‡è¦æ€§æ¥å†³å®šæ›´æ–°é¢‘ç‡ã€‚ ","date":"2024-01-30","objectID":"/posts/an-incomplete-guide-to-data-security/:11:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["å®‰å…¨","å¯†ç å­¦","Linux","SSH","PGP","å¯†ç ç®¡ç†","LUKS","å…¨ç›˜åŠ å¯†","é›¶ä¿¡ä»»","rclone"],"title":"ä¸ªäººæ•°æ®å®‰å…¨ä¸å®Œå…¨æŒ‡å—","uri":"/posts/an-incomplete-guide-to-data-security/#åè¿™å¥—æ–¹æ¡ˆä¸‹éœ€è¦è®°å¿†å‡ ä¸ªå¯†ç è¿™äº›å¯†ç è¯¥å¦‚ä½•è®¾è®¡"},{"categories":["tech"],"content":" åä¸€ã€ä¸ºäº†è½åœ°è¿™å¥—æ–¹æ¡ˆï¼Œæˆ‘åšäº†å“ªäº›å·¥ä½œï¼Ÿå‰é¢å·²ç»åŸºæœ¬éƒ½æåˆ°äº†ï¼Œè¿™é‡Œå†æ€»ç»“ä¸‹ï¼š é‡æ–°ç”Ÿæˆäº†æ‰€æœ‰çš„ SSH Keyï¼Œå¢å¼ºäº† passphrase å¼ºåº¦ï¼Œbcrypt rounds å¢åŠ åˆ° 256ï¼Œé€šè¿‡ssh-add ä½¿ç”¨ï¼Œåªéœ€è¦åœ¨ç³»ç»Ÿå¯åŠ¨åè¾“å…¥ä¸€æ¬¡å¯†ç å³å¯ï¼Œä¹Ÿä¸éº»çƒ¦ã€‚ é‡æ–°ç”Ÿæˆäº†æ‰€æœ‰çš„ PGP Keyï¼Œä¸»å¯†é’¥ç¦»çº¿åŠ å¯†å­˜å‚¨ï¼Œæœ¬åœ°åªä¿ç•™äº†åŠ å¯†ã€ç­¾åã€è®¤è¯ä¸‰ä¸ª PGP å­å¯†é’¥ã€‚ é‡æ–°ç”Ÿæˆäº†æ‰€æœ‰é‡è¦è´¦å·çš„å¯†ç ï¼Œå…¨éƒ¨ä½¿ç”¨éšæœºå¯†ç ï¼Œä¸€å…±æ”¹äº†äºŒä¸‰åä¸ªè´¦å·ã€‚è€ƒè™‘åˆ°æ—§çš„ backup code å¯èƒ½å·²ç»æ³„æ¼ï¼Œæˆ‘ä¹Ÿé‡æ–°ç”Ÿæˆäº†æ‰€æœ‰é‡è¦è´¦å·çš„ backup code. é‡è£… NixOSï¼Œä½¿ç”¨ LUKS2 åšå…¨ç›˜åŠ å¯†ï¼Œå¯ç”¨ Secure Boot. åŒæ—¶ä½¿ç”¨ tmpfs ä½œä¸ºæ ¹ç›®å½•ï¼Œæ‰€æœ‰æœªæ˜ç¡®å£°æ˜æŒä¹…åŒ–çš„æ•°æ®ï¼Œéƒ½ä¼šåœ¨æ¯æ¬¡é‡å¯åè¢«æ¸…ç©ºã€‚ ä½¿ç”¨ nix-darwin ä¸ home-manager é‡æ–°å£°æ˜å¼åœ°é…ç½®äº†æˆ‘çš„ä¸¤å° MacBook Proï¼ˆIntel è·Ÿ Apple Silicon å„ä¸€å°ï¼‰ï¼Œä¸æˆ‘çš„ NixOS å…±ç”¨äº†è®¸å¤šé…ç½®ï¼Œæœ€å¤§ç¨‹åº¦ä¸Šä¿æŒäº†æ‰€æœ‰æ¡Œé¢ç”µè„‘çš„å¼€å‘ç¯å¢ƒä¸€è‡´æ€§ï¼Œä¹Ÿç¡®ä¿äº†æˆ‘å§‹ç»ˆèƒ½å¿«é€Ÿåœ°åœ¨ä¸€å°æ–°ç”µè„‘ä¸Šéƒ¨ç½²æˆ‘çš„æ•´ä¸ªå¼€å‘ç¯å¢ƒã€‚ æ³¨é”€å°è±¡ç¬”è®°è´¦å·ï¼Œä½¿ç”¨ evernote-backup è·Ÿ evernote2md ä¸¤ä¸ªå·¥å…·å°†ä¸ªäººçš„ç§å¯†ç¬”è®°é·ç§»åˆ°äº† Joplin + OneDrive ä¸Šï¼ŒHomelab ä¸­è¨­äº†é€šé restic å®šæœŸè‡ªå‹•åŠ å¯†å‚™ä»½ OneDrive ä¸­çš„ Joplin æ•¸æ“šã€‚ æ¯”è¾ƒæœ‰ä»·å€¼çš„ GitHub ä»“åº“ï¼Œéƒ½è®¾ç½®äº†ç¦æ­¢ force push ä¸»åˆ†æ”¯ï¼Œå¹¶ä¸”æ·»åŠ äº† GitHub action è‡ªåŠ¨åŒæ­¥åˆ°å›½å†… Gitee. All in NixOSï¼Œå°† Homelab ä¸­çš„ PVE å…¨éƒ¨ä½¿ç”¨ NixOS + K3s + KubeVirt æ›¿æ¢ã€‚ä»åé»‘ç›’ä¸”å¯å¤ç°æ€§å·®çš„ Ubuntuã€Debian, Proxmox VE, OpenWRT ç­‰ VM å…¨é¢æ›¿æ¢æˆæ›´ç™½ç›’ä¸”å¯å¤ç°æ€§å¼ºçš„ NixOSã€KubeVirtï¼Œæå‡æˆ‘å¯¹å†…ç½‘ç¯å¢ƒçš„æŒæ§åº¦ï¼Œè¿›è€Œæå‡å†…ç½‘å®‰å…¨æ€§ã€‚ ","date":"2024-01-30","objectID":"/posts/an-incomplete-guide-to-data-security/:12:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["å®‰å…¨","å¯†ç å­¦","Linux","SSH","PGP","å¯†ç ç®¡ç†","LUKS","å…¨ç›˜åŠ å¯†","é›¶ä¿¡ä»»","rclone"],"title":"ä¸ªäººæ•°æ®å®‰å…¨ä¸å®Œå…¨æŒ‡å—","uri":"/posts/an-incomplete-guide-to-data-security/#åä¸€ä¸ºäº†è½åœ°è¿™å¥—æ–¹æ¡ˆæˆ‘åšäº†å“ªäº›å·¥ä½œ"},{"categories":["tech"],"content":" åäºŒã€ç¾éš¾æ¢å¤é¢„æ¡ˆè¿™é‡Œè€ƒè™‘æˆ‘çš„ GPG å­å¯†é’¥æ³„æ¼äº†ã€pass å¯†ç ä»“åº“æ³„æ¼äº†ç­‰å„ç§æƒ…å†µä¸‹çš„ç¾éš¾æ¢å¤æµç¨‹ã€‚ TODO åç»­å†æ…¢æ…¢è¡¥å……ã€‚ ","date":"2024-01-30","objectID":"/posts/an-incomplete-guide-to-data-security/:13:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["å®‰å…¨","å¯†ç å­¦","Linux","SSH","PGP","å¯†ç ç®¡ç†","LUKS","å…¨ç›˜åŠ å¯†","é›¶ä¿¡ä»»","rclone"],"title":"ä¸ªäººæ•°æ®å®‰å…¨ä¸å®Œå…¨æŒ‡å—","uri":"/posts/an-incomplete-guide-to-data-security/#åäºŒç¾éš¾æ¢å¤é¢„æ¡ˆ"},{"categories":["tech"],"content":" åä¸‰ã€æœªæ¥å¯èƒ½çš„æ”¹è¿›æ–¹å‘ç›®å‰æˆ‘çš„ä¸»è¦ä¸ªäººæ•°æ®åŸºæœ¬éƒ½å·²ç»é€šè¿‡ä¸Šè¿°æ–¹æ¡ˆè¿›è¡Œäº†å®‰å…¨ç®¡ç†ã€‚ä½†è¿˜æœ‰è¿™äº›æ–¹é¢å¯ä»¥è¿›ä¸€æ­¥æ”¹è¿›ï¼š é’ˆå¯¹ Homelab çš„è™šæ‹Ÿæœºå¿«ç…§å¤‡ä»½ï¼Œä»æˆ‘æ—§çš„åŸºäº rclone + crontab çš„æ˜æ–‡å¤‡ä»½æ–¹æ¡ˆï¼Œåˆ‡æ¢åˆ°äº†åŸºäº restic çš„åŠ å¯†å¤‡ä»½æ–¹æ¡ˆã€‚ æ‰‹æœºç«¯çš„ç…§ç‰‡è§†é¢‘è™½ç„¶å·²ç»åœ¨ä¸Šé¢è®¾è®¡å¥½äº†å¤‡ä»½åŒæ­¥æ–¹æ¡ˆï¼Œä½†ä»æœªå®æ–½ã€‚è€ƒè™‘ä½¿ç”¨ roundsync åŠ å¯†å¤‡ä»½åˆ°äº‘ç«¯ï¼Œå®ç°å¤šç«¯è®¿é—®ã€‚ è¿›ä¸€æ­¥å­¦ä¹ ä¸‹ appamor, bubblewrap ç­‰ Linux ä¸‹çš„å®‰å…¨é™åˆ¶æ–¹æ¡ˆï¼Œå°è¯•åº”ç”¨åœ¨æˆ‘çš„ NixOS PC ä¸Šã€‚ å½“å‰æˆæœnix-config/hardening Git æäº¤æ˜¯å¦å¯ä»¥ä½¿ç”¨ GnuPG ç­¾åï¼Œç›®å‰æ²¡è¿™ä¹ˆåšä¸»è¦æ˜¯è§‰å¾— PGP è¿™ä¸ªä¸œè¥¿å¤ªé‡äº†ï¼Œç›®å‰æˆ‘ä¹Ÿåªåœ¨ pass ä¸Šç”¨äº†å®ƒï¼Œè€Œä¸”è¿˜åœ¨ç ”ç©¶ç”¨ age å–ä»£å®ƒã€‚ å°è¯•é€šè¿‡ hashcat,wifi-cracking ç­‰æ‰‹æ®µç ´è§£è‡ªå·±çš„é‡è¦å¯†ç ã€SSH å¯†é’¥ã€GPG å¯†é’¥ç­‰æ•°æ®ï¼Œè¯„ä¼°å…¶å®‰å…¨æ€§ã€‚ ä½¿ç”¨ä¸€äº›æµè¡Œçš„æ¸—é€æµ‹è¯•å·¥å…·æµ‹è¯•æˆ‘çš„ Homelab ä¸å†…ç½‘ç¯å¢ƒï¼Œè¯„ä¼°å…¶å®‰å…¨æ€§ã€‚ å®‰å…¨æ€»æ˜¯ç›¸å¯¹çš„ï¼Œè€Œä¸”å…¶ä¸­æ¶‰åŠçš„çŸ¥è¯†ç‚¹ä¸å°‘ï¼Œæˆ‘ 2022 å¹´å­¦äº†å¯†ç å­¦ç®—æ˜¯ä¸ºæ­¤æ‰“ä¸‹äº†ä¸ªä¸é”™çš„åŸºç¡€ï¼Œ ä½†ç›®å‰çœ‹å‰å¤´è¿˜æœ‰æŒºå¤šçŸ¥è¯†ç‚¹åœ¨ç­‰å¾…ç€æˆ‘ã€‚æˆ‘ç›®å‰ä»ç„¶æ‰“ç®—ä»¥æ¯”è¾ƒ casual çš„å¿ƒæ€å»æŒç»­æ¨è¿›è¿™ä»¶äº‹æƒ…ï¼Œä»€ä¹ˆæ—¶å€™å…´è¶£æ¥äº†å°±æ¨è¿›ä¸€ç‚¹ç‚¹ã€‚ è¿™å¥—æ–¹æ¡ˆä¹Ÿå¯èƒ½å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œæ¬¢è¿å¤§å®¶å®¡é˜…æŒ‡æ­£ã€‚ ","date":"2024-01-30","objectID":"/posts/an-incomplete-guide-to-data-security/:14:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["å®‰å…¨","å¯†ç å­¦","Linux","SSH","PGP","å¯†ç ç®¡ç†","LUKS","å…¨ç›˜åŠ å¯†","é›¶ä¿¡ä»»","rclone"],"title":"ä¸ªäººæ•°æ®å®‰å…¨ä¸å®Œå…¨æŒ‡å—","uri":"/posts/an-incomplete-guide-to-data-security/#åä¸‰æœªæ¥å¯èƒ½çš„æ”¹è¿›æ–¹å‘"},{"categories":["tech"],"content":" æ–‡ç« æ˜¯ 2023-08-07 å†™çš„ï¼Œåé¢å°±å®Œå…¨å¿˜æ‰è¿™å›äº‹äº†ï¼Œä»Šå¤©å¶ç„¶ç¿»åˆ°å®ƒæ‰æƒ³èµ·è¦æ•´ç†å‘å¸ƒä¸‹â€¦æ‰€ä»¥æ³¨æ„æ–‡ç« ä¸­çš„æ—¶é—´çº¿æ˜¯ 2023 å¹´ 8 æœˆã€‚ ","date":"2024-01-29","objectID":"/posts/how-nixos-start-on-licheepi4a/:0:0","series":["NixOS ä¸ Nix Flakes"],"tags":["Linux","NixOS","LicheePi4A","Embedded","U-Boot","RISC-V"],"title":"NixOS åœ¨ Lichee Pi 4A ä¸Šæ˜¯å¦‚ä½•å¯åŠ¨çš„","uri":"/posts/how-nixos-start-on-licheepi4a/#"},{"categories":["tech"],"content":" é›¶ã€å‰è¨€æˆ‘ä»ä»Šå¹´ 5 æœˆä»½åˆæ”¶åˆ°äº†å†…æµ‹æ¿çš„ Lichee Pi 4Aï¼Œè¿™æ˜¯å½“ä¸‹æ€§èƒ½æœ€é«˜çš„ RISC-V å¼€å‘æ¿ä¹‹ä¸€ï¼Œä¸è¿‡å½“æ—¶æ²¡æ€ä¹ˆæŠ˜è…¾ã€‚ 6 æœˆåˆçš„æ—¶å€™æˆ‘å¼€å§‹å°è¯•åœ¨ Orange Pi 5 ä¸Šè¿è¡Œ NixOSï¼Œåœ¨NixOS on ARM çš„ Matrix ç¾¤ç»„ ä¸­å¾—åˆ°äº†ä¿„ç½—æ–¯è€å“¥ @K900 çš„å¸®åŠ©ï¼Œæ²¡è´¹å¤šå¤§åŠ²å°±æˆåŠŸäº†ï¼Œä¸€å…±å°±æŠ˜è…¾äº†ä¸‰å¤©ã€‚ äºæ˜¯æˆ‘æ¥ç€å°è¯•åœ¨ Lichee Pi 4A ä¸Šè¿è¡Œ NixOSï¼Œå› ä¸ºå·²ç»æ‹¥æœ‰äº† Orange Pi 5 ä¸Šçš„æŠ˜è…¾ç»éªŒï¼Œæˆ‘ä»¥ä¸ºè¿™æ¬¡ä¼šå¾ˆé¡ºåˆ©ã€‚ä½†æ˜¯å®é™…éš¾åº¦è¿œè¿œè¶…å‡ºäº†æˆ‘çš„é¢„æœŸï¼Œæˆ‘ä» 6 æœˆ 13 å·å¼€å§‹æ–­æ–­ç»­ç»­æŠ˜è…¾åˆ° 7 æœˆ 3 å·ï¼Œæ¥è§¦äº†å¤§é‡çš„æ–°ä¸œè¥¿ï¼ŒåŒ…æ‹¬ U-Bootã€OpenSBIã€SPL Flashã€RISCV Boot Flows ç­‰ç­‰ï¼Œè¿˜å‚è€ƒäº† @chainsx çš„ Fedora for Lichee Pi 4A æ–¹æ¡ˆï¼Œè¯·æ•™äº† @NickCao è®¸å¤š NixOS ç›¸å…³çš„é—®é¢˜ï¼Œ@revy å¸®æˆ‘ä¿®äº†å¥½å‡ ä¸ª revyos/thead-kernel åœ¨æ ‡å‡†å·¥å…·é“¾ä¸Šç¼–è¯‘çš„ bugï¼ŒæœŸé—´ä¹Ÿè¯·æ•™è¿‡ @HougeLangley ä»–æŠ˜è…¾ Lichee Pi 4A çš„ç»éªŒã€‚æˆ‘åœ¨ä»˜å‡ºäº†è¿™ä¹ˆå¤šçš„åŠªåŠ›åï¼Œæ‰æœ€ç»ˆæˆåŠŸç¼–è¯‘å‡ºäº† NixOS çš„ç³»ç»Ÿé•œåƒï¼ˆåŒ…å« boot è·Ÿ rootfs ä¸¤ä¸ªåˆ†åŒºï¼‰ã€‚ ä½†æ˜¯ï¼ç°åœ¨è¦è¯´ã€Œä½†æ˜¯ã€äº†ã€‚ é•œåƒæ˜¯æœ‰äº†ï¼Œç³»ç»Ÿå´æ— æ³•å¯åŠ¨â€¦æ‰¾äº†å„ç§èµ„æ–™ä¹Ÿæ²¡è§£å†³ï¼Œä¹Ÿæ²¡å¥½æ„æ€éº»çƒ¦å„ä½å¤§ä½¬ï¼Œæå¾—æœ‰ç‚¹å¿ƒç°æ„å†·ï¼Œå°±å…ˆæŠŠè¿™éƒ¨åˆ†å·¥ä½œæ”¾ä¸‹äº†ã€‚ æ¥ç€å°±éš”äº†ä¸€ä¸ªå¤šæœˆæ²¡ç¢° Lichee Pi 4Aï¼Œç›´åˆ° 8 æœˆ 5 å·ï¼Œå¤–å›½å‹äºº @JayDeLux åœ¨Mainline Linux for RISC-V TG ç¾¤ç»„ä¸­è¯¢é—®æˆ‘ NixOS ç§»æ¤å·¥ä½œçš„è¿›å±•å¦‚ä½•ï¼ˆä¹‹å‰æœ‰åœ¨ç¾¤é‡Œæè¿‡æˆ‘åœ¨å°è¯•ç§»æ¤ï¼‰ï¼Œæˆ‘æ‰å†³å®šå†æ¬¡å°è¯•ä¸€ä¸‹ã€‚ åœ¨ä¹‹å‰å·¥ä½œçš„åŸºç¡€ä¸Šä¸€ç•ªéªšæ“ä½œåï¼Œæˆ‘åœ¨ 8 æœˆ 6 å·æ™šä¸Šç»ˆäºæˆåŠŸå¯åŠ¨äº† NixOSï¼Œè¿™æ¬¡æ„å¤–çš„é¡ºåˆ©ï¼Œåç»­ä¹ŸæˆåŠŸé€šè¿‡ä¸€ä»½ Nix Flake é…ç½®ç¼–è¯‘å‡ºäº†å¯ç”¨çš„ NixOS é•œåƒã€‚ æœ€ç»ˆæˆæœï¼šhttps://github.com/ryan4yin/nixos-licheepi4a æ•´ä¸ªæŠ˜è…¾è¿‡ç¨‹ç›¸å½“æ›²æŠ˜ï¼Œè™½ç„¶æœ€ç»ˆè¾¾æˆäº†ç›®æ ‡ï¼Œä½†æ˜¯æœŸé—´é­å—çš„æŠ˜ç£¨ä¹ŸçœŸçš„ä¸å°‘ã€‚æ€»çš„æ¥è¯´ä»ç„¶æ˜¯ä¸€æ¬¡å¾ˆæœ‰è¶£çš„ç»å†ï¼Œæ—¢å­¦åˆ°äº†è®¸å¤šæ–°æŠ€æœ¯çŸ¥è¯†ã€è®¤è¯†äº†äº›æœ‰è¶£çš„å¤–å›½å‹äººï¼ˆ@JayDeLux ç”šè‡³è¿˜ç»™æˆ‘æ‰“äº† $50 ç¾åˆ€è¡¨ç¤ºæ„Ÿè°¢ï¼‰ï¼Œä¹Ÿè·Ÿ @HougeLangley ã€@chainsx ã€@Rabenda(revy) ç­‰å„ä½å¤§ä½¬æ··äº†ä¸ªè„¸ç†Ÿã€‚ è¿™ç¯‡æ–‡ç« å°±æ˜¯è®°å½•ä¸‹æˆ‘åœ¨è¿™ä¸ªæŠ˜è…¾è¿‡ç¨‹ä¸­å­¦åˆ°çš„æ‰€æœ‰çŸ¥è¯†ï¼Œä»¥é£¨è¯»è€…ï¼ŒåŒæ—¶ä¹Ÿæ¢³ç†ä¸€ä¸‹è‡ªå·±çš„æ”¶è·ã€‚ æœ¬æ–‡çš„å†™ä½œæ€è·¯æ˜¯è‡ªé¡¶å‘ä¸‹çš„ï¼Œå…ˆä» NixOS é•œåƒçš„ boot åˆ†åŒºé…ç½®ã€å¯åŠ¨è„šæœ¬å¼€å§‹åˆ†æï¼Œè¿‡æ¸¡åˆ°å®é™…çš„å¯åŠ¨æ—¥å¿—ï¼Œå†æ¥ç»­åˆ†æä¸‹åç»­çš„å¯åŠ¨æµç¨‹ã€‚NixOS åˆ†æå®Œäº†åï¼Œå†çœ‹çœ‹ä¸ RISC-V ç›¸å…³çš„ç¡¬ä»¶å›ºä»¶ä¸ bootloader éƒ¨åˆ†è¦å¦‚ä½•ä¸ NixOS ååŒå·¥ä½œï¼Œä½¿å¾— NixOS èƒ½å¤Ÿåœ¨ Lichee Pi 4A ä¸Šæ­£å¸¸å¯åŠ¨ã€‚ ","date":"2024-01-29","objectID":"/posts/how-nixos-start-on-licheepi4a/:1:0","series":["NixOS ä¸ Nix Flakes"],"tags":["Linux","NixOS","LicheePi4A","Embedded","U-Boot","RISC-V"],"title":"NixOS åœ¨ Lichee Pi 4A ä¸Šæ˜¯å¦‚ä½•å¯åŠ¨çš„","uri":"/posts/how-nixos-start-on-licheepi4a/#é›¶å‰è¨€"},{"categories":["tech"],"content":" ä¸€ã€åŸºç¡€çŸ¥è¯†ä»‹ç»","date":"2024-01-29","objectID":"/posts/how-nixos-start-on-licheepi4a/:2:0","series":["NixOS ä¸ Nix Flakes"],"tags":["Linux","NixOS","LicheePi4A","Embedded","U-Boot","RISC-V"],"title":"NixOS åœ¨ Lichee Pi 4A ä¸Šæ˜¯å¦‚ä½•å¯åŠ¨çš„","uri":"/posts/how-nixos-start-on-licheepi4a/#ä¸€åŸºç¡€çŸ¥è¯†ä»‹ç»"},{"categories":["tech"],"content":" 1. Lichee Pi 4A ä»‹ç»LicheePi 4A æ˜¯å½“å‰å¸‚é¢ä¸Šæ€§èƒ½æœ€é«˜çš„ RISC-V Linux å¼€å‘æ¿ä¹‹ä¸€ï¼Œå®ƒä»¥ TH1520 ä¸ºä¸»æ§æ ¸å¿ƒ ï¼ˆ4xC910@1.85Gï¼Œ RV64GCVï¼Œ4TOPS@int8 NPUï¼Œ 50GFLOP GPUï¼‰ï¼Œæ¿è½½æœ€å¤§ 16GB 64bit LPDDR4Xï¼Œ128GB eMMCï¼Œæ”¯æŒ HDMI+MIPI åŒ4K æ˜¾ç¤ºè¾“å‡ºï¼Œæ”¯æŒ 4K æ‘„åƒå¤´æ¥å…¥ï¼ŒåŒåƒå…†ç½‘å£ï¼ˆå…¶ä¸­ä¸€ä¸ªæ”¯æŒPOEä¾›ç”µï¼‰å’Œ 4 ä¸ª USB3.0 æ¥å£ï¼Œå¤šç§éŸ³é¢‘è¾“å…¥è¾“å‡ºï¼ˆç”±ä¸“ç”¨ C906 æ ¸å¿ƒå¤„ç†ï¼‰ã€‚ ä»¥ä¸Šæ¥è‡ª Lichee Pi 4A å®˜æ–¹æ–‡æ¡£Lichee Pi 4A - Sipeed Wiki. æ€»ä¹‹å®ƒæ˜¯æˆ‘æ‰‹ä¸Šæ€§èƒ½æœ€é«˜çš„ RISC-V å¼€å‘æ¿ã€‚ LicheePi 4A å®˜æ–¹ä¸»è¦æ”¯æŒ RevyOSâ€”â€” ä¸€æ¬¾é’ˆå¯¹ T-Head èŠ¯ç‰‡ç”Ÿæ€çš„ Debian ä¼˜åŒ–å®šåˆ¶å‘è¡Œç‰ˆã€‚æ ¹æ®çŒ´å“¥ï¼ˆ@HougeLangleyï¼‰æ–‡ç« ä»‹ç»ï¼Œå®ƒä¹Ÿæ˜¯ç›®å‰å”¯ä¸€ä¸”ç¡®å®èƒ½å¤Ÿå¯ç”¨ Lichee Pi 4A æ¿è½½ GPU çš„å‘è¡Œç‰ˆï¼Œ ","date":"2024-01-29","objectID":"/posts/how-nixos-start-on-licheepi4a/:2:1","series":["NixOS ä¸ Nix Flakes"],"tags":["Linux","NixOS","LicheePi4A","Embedded","U-Boot","RISC-V"],"title":"NixOS åœ¨ Lichee Pi 4A ä¸Šæ˜¯å¦‚ä½•å¯åŠ¨çš„","uri":"/posts/how-nixos-start-on-licheepi4a/#1-lichee-pi-4a-ä»‹ç»"},{"categories":["tech"],"content":" 2. NixOS ä»‹ç»è¿™ä¸ªæ„Ÿè§‰å°±ä¸ç”¨å¤šè¯´äº†ï¼Œæˆ‘åœ¨è¿™å‡ ä¸ªæœˆå·²ç»ç»™ NixOS å†™äº†éå¸¸å¤šçš„æ–‡å­—äº†ï¼Œæ„Ÿå…´è¶£è¯·ç›´æ¥ç§»æ­¥ryan4yin/nixos-and-flakes-book. åœ¨ 4 æœˆä»½æ¥è§¦äº† NixOS åï¼Œæˆ‘æˆäº† NixOS é“ç²‰ã€‚ä½œä¸ºä¸€åé“ç²‰ï¼Œæˆ‘å½“ç„¶æƒ³æŠŠæˆ‘æ‰‹ä¸Šçš„æ‰€æœ‰æ€§èƒ½å¥½ç‚¹çš„æ¿å­éƒ½è£…ä¸Š NixOSï¼ŒLichee Pi 4A è‡ªç„¶ä¹Ÿä¸ä¾‹å¤–ã€‚ æˆ‘ç›®å‰ä¸»è¦å®Œæˆäº†ä¸¤å—æ¿å­çš„ NixOS ç§»æ¤å·¥ä½œï¼Œä¸€å—æ˜¯ Orange Pi 5ï¼Œå¦ä¸€å—å°±æ˜¯ Lichee Pi 4Aã€‚ Orange Pi 5 æ˜¯ ARM64 æ¶æ„çš„ï¼Œåˆšå¥½ä¹Ÿé‡åˆ°äº†æ‹¥æœ‰è¯¥æ¿å­çš„ NixOS ç”¨æˆ· @K900ï¼Œåœ¨ä»–çš„å¸®åŠ©ä¸‹æˆ‘å¾ˆé¡ºåˆ©åœ°å°±å®Œæˆäº†ç§»æ¤å·¥ä½œã€‚ è€Œ Lichee Pi 4A å°±æ¯”è¾ƒæ›²æŠ˜ï¼Œä¹Ÿæ¯”è¾ƒæœ‰è¯é¢˜æ€§ã€‚æ‰€ä»¥æ‰æœ‰äº†è¿™ç¯‡æ–‡ç« ã€‚ ","date":"2024-01-29","objectID":"/posts/how-nixos-start-on-licheepi4a/:2:2","series":["NixOS ä¸ Nix Flakes"],"tags":["Linux","NixOS","LicheePi4A","Embedded","U-Boot","RISC-V"],"title":"NixOS åœ¨ Lichee Pi 4A ä¸Šæ˜¯å¦‚ä½•å¯åŠ¨çš„","uri":"/posts/how-nixos-start-on-licheepi4a/#2-nixos-ä»‹ç»"},{"categories":["tech"],"content":" äºŒã€ç§»æ¤æ€è·¯ä¸€ä¸ªå®Œæ•´çš„åµŒå…¥å¼ Linux ç³»ç»Ÿï¼Œé€šå¸¸åŒ…å«äº† U-Bootã€kernelã€è®¾å¤‡æ ‘ä»¥åŠæ ¹æ–‡ä»¶ç³»ç»Ÿï¼ˆrootfsï¼‰å››ä¸ªéƒ¨åˆ†ã€‚ å…¶ä¸­ U-Bootï¼Œkernel è·Ÿè®¾å¤‡æ ‘ï¼Œéƒ½æ˜¯ä¸ç¡¬ä»¶ç›¸å…³çš„ï¼Œéœ€è¦é’ˆå¯¹ä¸åŒçš„ç¡¬ä»¶è¿›è¡Œå®šåˆ¶ã€‚è€Œ rootfs çš„å¤§éƒ¨åˆ†å†…å®¹ï¼ˆæ¯”å¦‚è¯´ NixOS ç³»ç»Ÿçš„ rootfs æœ¬èº«ï¼‰ï¼Œéƒ½æ˜¯ä¸ç¡¬ä»¶æ— å…³çš„ï¼Œå¯ä»¥é€šç”¨ã€‚ æˆ‘çš„ç§»æ¤æ€è·¯æ˜¯ï¼Œä» LicheePi4A å®˜æ–¹ä½¿ç”¨çš„ RevyOS ä¸­æ‹¿å‡ºè·Ÿç¡¬ä»¶ç›¸å…³çš„éƒ¨åˆ†ï¼ˆä¹Ÿå°±æ˜¯ U-Boot, kernel è·Ÿè®¾å¤‡æ ‘è¿™ä¸‰ä¸ªï¼‰ï¼Œå†ç»“åˆä¸Šè·Ÿç¡¬ä»¶æ— å…³çš„ NixOS rootfsï¼Œç»„åˆæˆä¸€ä¸ªå®Œæ•´çš„ã€å¯åœ¨ LicheePi4A ä¸Šæ­£å¸¸å¯åŠ¨è¿è¡Œçš„ NixOS ç³»ç»Ÿã€‚ RevyOS é’ˆå¯¹ LicheePi4A å®šåˆ¶çš„å‡ ä¸ªé¡¹ç›®æºç å¦‚ä¸‹ï¼š https://github.com/revyos/thead-kernel.git https://github.com/revyos/thead-u-boot.git https://github.com/revyos/thead-opensbi.git æ€è·¯å¾ˆæ¸…æ™°ï¼Œä½†å› ä¸º NixOS æœ¬èº«çš„ç‰¹æ®Šæ€§ï¼Œå®é™…æ“ä½œèµ·æ¥ï¼Œç°æœ‰çš„ Gentoo, Arch Linux, Fedora çš„ç§»æ¤ä»“åº“ä»£ç å…¨éƒ½æ— æ³•ç›´æ¥ä½¿ç”¨ï¼Œéœ€è¦åšçš„å·¥ä½œè¿˜æ˜¯ä¸å°‘çš„ã€‚ ","date":"2024-01-29","objectID":"/posts/how-nixos-start-on-licheepi4a/:3:0","series":["NixOS ä¸ Nix Flakes"],"tags":["Linux","NixOS","LicheePi4A","Embedded","U-Boot","RISC-V"],"title":"NixOS åœ¨ Lichee Pi 4A ä¸Šæ˜¯å¦‚ä½•å¯åŠ¨çš„","uri":"/posts/how-nixos-start-on-licheepi4a/#äºŒç§»æ¤æ€è·¯"},{"categories":["tech"],"content":" ä¸‰ã€NixOS å¯åŠ¨æµç¨‹åˆ†æè¦åšç§»æ¤ï¼Œé¦–å…ˆå°±è¦äº†è§£ NixOS ç³»ç»Ÿæœ¬èº«çš„æ–‡ä»¶æ ‘ç»“æ„ä»¥åŠç³»ç»Ÿå¯åŠ¨æµç¨‹ï¼Œææ˜ç™½å®ƒè·Ÿ Arch Linux, Fedora ç­‰å…¶ä»–å‘è¡Œç‰ˆçš„åŒºåˆ«ï¼Œè¿™æ ·æ‰å¥½å‚è€ƒå…¶ä»–å‘è¡Œç‰ˆçš„ç§»æ¤å·¥ä½œï¼Œææ˜ç™½è¯¥å¦‚ä½•å…¥æ‰‹ã€‚ ","date":"2024-01-29","objectID":"/posts/how-nixos-start-on-licheepi4a/:4:0","series":["NixOS ä¸ Nix Flakes"],"tags":["Linux","NixOS","LicheePi4A","Embedded","U-Boot","RISC-V"],"title":"NixOS åœ¨ Lichee Pi 4A ä¸Šæ˜¯å¦‚ä½•å¯åŠ¨çš„","uri":"/posts/how-nixos-start-on-licheepi4a/#ä¸‰nixos-å¯åŠ¨æµç¨‹åˆ†æ"},{"categories":["tech"],"content":" 1. Bootloader é…ç½®ä¸ç³»ç»Ÿæ–‡ä»¶æ ‘åˆ†æè¿™é‡Œæ–¹ä¾¿èµ·è§ï¼Œæˆ‘ç›´æ¥ä½¿ç”¨æˆ‘è‡ªå·±ä¸º LicheePi4A æ„å»ºå¥½çš„ NixOS é•œåƒè¿›è¡Œåˆ†æã€‚é¦–å…ˆå‚ç…§ryan4yin/nixos-licheepi4a çš„ README ä¸‹è½½è§£å‹é•œåƒï¼Œå†ä½¿ç”¨ losetup è·Ÿ mount ç›´æ¥æŒ‚è½½é•œåƒä¸­çš„å„åˆ†åŒºè¿›è¡Œåˆæ­¥åˆ†æï¼š bash # è§£å‹é•œåƒ â€º mv nixos-licheepi4a-sd-image-*-riscv64-linux.img.zst nixos-lp4a.img.zst â€º zstd -d nixos-lp4a.img.zst # å°† img æ–‡ä»¶ä½œä¸ºè™šæ‹Ÿ loop è®¾å¤‡è¿æ¥åˆ°ç³»ç»Ÿä¸­ â€º sudo losetup --find --partscan nixos-lp4a.img # æŸ¥çœ‹æŒ‚è½½çš„ loop è®¾å¤‡ â€º lsblk | grep loop loop0 7:0 0 1.9G 0 loop â”œâ”€loop0p1 259:8 0 200M 0 part â””â”€loop0p2 259:9 0 1.7G 0 part # åˆ†åˆ«æŒ‚è½½é•œåƒä¸­çš„ boot è·Ÿ rootfs åˆ†åŒº â€º mkdir boot root â€º sudo mount /dev/loop0p1 boot â€º sudo mount /dev/loop0p2 root # æŸ¥çœ‹ boot åˆ†åŒºå†…å®¹ â€º ls boot/ â•­â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® â”‚ # â”‚ name â”‚ type â”‚ size â”‚ modified â”‚ â”œâ”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ 0 â”‚ boot/extlinux â”‚ dir â”‚ 4.1 KB â”‚ 44 years ago â”‚ â”‚ 1 â”‚ boot/fw_dynamic.bin â”‚ file â”‚ 85.9 KB â”‚ 24 years ago â”‚ â”‚ 2 â”‚ boot/light_aon_fpga.bin â”‚ file â”‚ 50.3 KB â”‚ 24 years ago â”‚ â”‚ 3 â”‚ boot/light_c906_audio.bin â”‚ file â”‚ 16.4 KB â”‚ 24 years ago â”‚ â”‚ 4 â”‚ boot/nixos â”‚ dir â”‚ 4.1 KB â”‚ 44 years ago â”‚ â•°â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯ # æŸ¥çœ‹ root åˆ†åŒºå†…å®¹ â€º ls root/ â•­â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® â”‚ # â”‚ name â”‚ type â”‚ size â”‚ modified â”‚ â”œâ”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ 0 â”‚ root/boot â”‚ dir â”‚ 4.1 KB â”‚ 54 years ago â”‚ â”‚ 1 â”‚ root/lost+found â”‚ dir â”‚ 16.4 KB â”‚ 54 years ago â”‚ â”‚ 2 â”‚ root/nix â”‚ dir â”‚ 4.1 KB â”‚ 54 years ago â”‚ â”‚ 3 â”‚ root/nix-path-registration â”‚ file â”‚ 242.0 KB â”‚ 54 years ago â”‚ â•°â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯ å¯ä»¥çœ‹åˆ° NixOS æ•´ä¸ªæ ¹ç›®å½•ï¼ˆ/rootï¼‰ä¸‹ä¸€å…±å°±å››ä¸ªæ–‡ä»¶å¤¹ï¼Œå…¶ä¸­çœŸæ­£ä¿å­˜æœ‰ç³»ç»Ÿæ•°æ®çš„æ–‡ä»¶å¤¹åªæœ‰/boot è·Ÿ /nix è¿™ä¸¤ä¸ªï¼Œè¿™ä¸ä¼ ç»Ÿçš„ Linux å‘è¡Œç‰ˆå¤§ç›¸å¾„åº­ã€‚æœ‰ä¸€ç‚¹ Linux ä½¿ç”¨ç»éªŒçš„æœ‹å‹éƒ½åº”è¯¥æ¸…æ¥šï¼Œä¼ ç»Ÿçš„ Linux å‘è¡Œç‰ˆéµå¾ª UNIX ç³»ç»Ÿçš„FHS æ ‡å‡†ï¼Œæ ¹ç›®å½•ä¸‹ä¼šæœ‰å¾ˆå¤šæ–‡ä»¶å¤¹ï¼Œæ¯”å¦‚/binã€/etcã€/homeã€/libã€/optã€/rootã€/sbinã€/srvã€/tmpã€/usrã€/var ç­‰ç­‰ã€‚ é‚£ NixOS å®ƒè¿™ä¹ˆç©ï¼ŒçœŸçš„èƒ½æ­£å¸¸å¯åŠ¨ä¹ˆï¼Ÿè¿™å°±æ˜¯æˆ‘åœ¨æ„å»ºå‡ºé•œåƒåå´å‘ç°æ— æ³•åœ¨ LicheePi 4A ä¸Šå¯åŠ¨æ—¶ï¼Œæœ€å…ˆäº§ç”Ÿçš„ç–‘é—®ã€‚åœ¨è¯¢é—® @chainsx è·Ÿ @revy ç³»ç»Ÿæ— æ³•å¯åŠ¨çš„è§£å†³æ€è·¯çš„æ—¶å€™ï¼Œä»–ä»¬ä¹Ÿä¸€è„¸æ‡µé€¼ï¼Œè§‰å¾—è¿™ä¸ªæ–‡ä»¶æ ‘æœ‰ç‚¹å¥‡è‘©ï¼Œå¾ˆæ€€ç–‘æ˜¯æˆ‘æ„å»ºæµç¨‹æœ‰é—®é¢˜å¯¼è‡´æ–‡ä»¶æ ‘ä¸å®Œæ•´ã€‚ ä½†å®é™…ä¸Š NixOS å°±æ˜¯è¿™ä¹ˆç©çš„ï¼Œå®ƒ rootfs ä¸­æ‰€æœ‰çš„æ•°æ®å…¨éƒ½å­˜æ”¾åœ¨ /nix/store è¿™ä¸ªç›®å½•ä¸‹å¹¶ä¸”è¢«æŒ‚è½½ä¸ºåªè¯»ï¼Œå…¶ä»–çš„æ–‡ä»¶å¤¹ä»¥åŠå…¶ä¸­çš„æ–‡ä»¶éƒ½æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºçš„ã€‚è¿™æ˜¯å®ƒå®ç°å£°æ˜å¼ç³»ç»Ÿé…ç½®ã€å¯å›æ»šæ›´æ–°ã€å¯å¹¶è¡Œå®‰è£…å¤šä¸ªç‰ˆæœ¬çš„è½¯ä»¶åŒ…ç­‰ç­‰ç‰¹æ€§çš„åŸºç¡€ã€‚ ä¸‹é¢ç»§ç»­åˆ†æï¼Œå…ˆä»”ç»†çœ‹ä¸‹ /boot çš„å†…å®¹ï¼š bash â€º tree boot boot â”œâ”€â”€ extlinux â”‚Â â””â”€â”€ extlinux.conf â”œâ”€â”€ fw_dynamic.bin â”œâ”€â”€ light_aon_fpga.bin â”œâ”€â”€ light_c906_audio.bin â””â”€â”€ nixos â”œâ”€â”€ 2n6fjh4lhzaswbyacaf72zmz6mdsmm8l-initrd-k-riscv64-unknown-linux-gnu-initrd â”œâ”€â”€ l18cz7jd37n35dwyf8wc8divm46k7sdf-k-riscv64-unknown-linux-gnu-dtbs â”‚Â â”œâ”€â”€ sifive â”‚Â â”‚Â â””â”€â”€ hifive-unleashed-a00.dtb â”‚Â â””â”€â”€ thead â”‚Â â”œâ”€â”€ fire-emu-crash.dtb â”‚Â â”œâ”€â”€ fire-emu.dtb â”‚Â â”œâ”€â”€ ...... (çœç•¥) â”‚Â â”œâ”€â”€ light-fm-emu-audio.dtb â”‚Â â”œâ”€â”€ light-fm-emu-dsi0-hdmi.dtb â”‚Â â”œâ”€â”€ light-fm-emu-dsp.dtb â”‚Â â”œâ”€â”€ light-fm-emu-gpu.dtb â”‚Â â”œâ”€â”€ light-fm-emu-hdmi.dtb â”‚Â â”œâ”€â”€ light-lpi4a-ddr2G.dtb â”‚Â â””â”€â”€ light_mpw.dtb â””â”€â”€ l18cz7jd37n35dwyf8wc8divm46k7sdf-k-riscv64-unknown-linux-gnu-Image 6 directories, 64 files å¯ä»¥çœ‹åˆ°ï¼š å®ƒä½¿ç”¨ /boot/extlinux/extlinux.conf ä½œä¸º U-Boot çš„å¯åŠ¨é¡¹é…ç½®ï¼Œæ®U-Boot å®˜æ–¹çš„ Distro æ–‡æ¡£ æ‰€è¨€ï¼Œè¿™æ˜¯ U-Boot çš„æ ‡å‡†é…ç½®æ–‡ä»¶ã€‚ å¦å¤–è¿˜æœ‰ä¸€äº› xxx.bin æ–‡ä»¶ï¼Œè¿™äº›æ˜¯ä¸€äº›ç¡¬ä»¶å›ºä»¶ï¼Œå…¶ä¸­çš„ light_c906_audio.bin æ˜¾ç„¶æ˜¯ç„é“ 906 è¿™ä¸ª IP æ ¸çš„éŸ³é¢‘å›ºä»¶ï¼Œå…¶ä»–çš„åé¢å†ç ”ç©¶ã€‚ NixOS çš„ initrd, dtbs ä»¥åŠ Image æ–‡ä»¶éƒ½æ˜¯åœ¨ /boot/nixos ä¸‹ï¼Œè¿™ä¸‰ä¸ªæ–‡ä»¶ä¹Ÿéƒ½æ˜¯è·Ÿ Linux çš„å¯åŠ¨ç›¸å…³çš„ï¼Œç°åœ¨ä¸ç”¨ç®¡å®ƒä»¬ï¼Œä¸‹ä¸€æ­¥ä¼šåˆ†æã€‚ å†çœ‹ä¸‹ /boot/extlinux/extlinux.conf çš„å†…å®¹ï¼š bash â€º cat boot/extlinux/extlinux.conf # Generated file, all changes will be lost on nixos-rebuild! # Change this to e.g. nixos-42 to temporarily boot to an older configuration. DEFAULT nixos-default MENU TITLE ------------------------------------------------------------ TIMEOUT 50 LABEL nixos-default MENU LABEL NixOS - Default LINUX ../nixos/l18cz7jd37n35dwyf8wc8divm46k7sdf-k-riscv64-unknown-linux-gnu-Image INITRD ../nixos/2n6fjh4lhzaswbyacaf72zmz6mdsmm8l-initrd-k-riscv64-unknown-linux-gnu-initrd APPEND init=/nix/store/71wh9lvf94i1jcd6qpqw228fy5s8fv24-nixos-system-lp4a-23.05.20230806.240472b/init console=ttyS0,115200 root=UUID=14e19a7b-0ae0-484d-9d54-43bd6fdc20c7 rootfstype=ext4 rootwait rw earlycon clk_ignore_unused eth=$ethaddr rootrwoptions=rw,noatime rootrwreset=yes loglevel=4 FDT ../nixos/l18cz7jd37n35dwyf8wc8divm46k7sdf-k-riscv64-unknown-linux-gnu-dtb","date":"2024-01-29","objectID":"/posts/how-nixos-start-on-licheepi4a/:4:1","series":["NixOS ä¸ Nix Flakes"],"tags":["Linux","NixOS","LicheePi4A","Embedded","U-Boot","RISC-V"],"title":"NixOS åœ¨ Lichee Pi 4A ä¸Šæ˜¯å¦‚ä½•å¯åŠ¨çš„","uri":"/posts/how-nixos-start-on-licheepi4a/#1-bootloader-é…ç½®ä¸ç³»ç»Ÿæ–‡ä»¶æ ‘åˆ†æ"},{"categories":["tech"],"content":" 2. å®é™…å¯åŠ¨æ—¥å¿—åˆ†æä¸ºäº†æ–¹ä¾¿åç»­å†…å®¹çš„ç†è§£ï¼Œå…ˆçœ‹ä¸‹ NixOS ç³»ç»Ÿåœ¨ LicheePi 4A ä¸Šçš„å®é™…å¯åŠ¨æ—¥å¿—æ˜¯ä¸ªå¾ˆä¸é”™çš„é€‰æ‹©ã€‚ æŒ‰æˆ‘é¡¹ç›®ä¸­çš„ README æ­£å¸¸çƒ§å½•å¥½ç³»ç»Ÿåï¼Œä½¿ç”¨ USB è½¬ä¸²å£å·¥å…·è¿æ¥åˆ° LicheePi 4A çš„ UART0 ä¸²å£ï¼Œç„¶åå¯åŠ¨ç³»ç»Ÿï¼Œå°±èƒ½çœ‹åˆ° NixOS çš„å¯åŠ¨æ—¥å¿—ã€‚ æ¥çº¿ç¤ºä¾‹ï¼š LicheePi4A UART è°ƒè¯•æ¥çº¿ - æ­£é¢ LicheePi4A UART è°ƒè¯•æ¥çº¿ - åé¢ æ¥å¥½çº¿åä½¿ç”¨ minicom æŸ¥çœ‹æ—¥å¿—ï¼š bash â€º ls /dev/ttyUSB0 â•­â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® â”‚ # â”‚ name â”‚ type â”‚ size â”‚ modified â”‚ â”œâ”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ 0 â”‚ /dev/ttyUSB0 â”‚ char device â”‚ 0 B â”‚ 6 minutes ago â”‚ â•°â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯ â€º minicom -d /dev/ttyusb0 -b 115200 ä¸€ä¸ªæ­£å¸¸çš„å¯åŠ¨æ—¥å¿—ç¤ºä¾‹å¦‚ä¸‹ï¼š text Welcome to minicom 2.8 brom_ver 8 [APP][E] protocol_connect failed, exit. OpenSBI v0.9 ____ _____ ____ _____ / __ \\ / ____| _ \\_ _| | | | |_ __ ___ _ __ | (___ | |_) || | | | | | '_ \\ / _ \\ '_ \\ \\___ \\| _ \u003c | | | |__| | |_) | __/ | | |____) | |_) || |_ \\____/| .__/ \\___|_| |_|_____/|____/_____| | | |_| Platform Name : T-HEAD Light Lichee Pi 4A configuration for 8GB DDR board Platform Features : mfdeleg Platform HART Count : 4 Platform IPI Device : clint Platform Timer Device : clint Platform Console Device : uart8250 Platform HSM Device : --- Platform SysReset Device : thead_reset Firmware Base : 0x0 Firmware Size : 132 KB Runtime SBI Version : 0.3 Domain0 Name : root Domain0 Boot HART : 0 Domain0 HARTs : 0*,1*,2*,3* Domain0 Region00 : 0x000000ffdc000000-0x000000ffdc00ffff (I) Domain0 Region01 : 0x0000000000000000-0x000000000003ffff () Domain0 Region02 : 0x0000000000000000-0xffffffffffffffff (R,W,X) Domain0 Next Address : 0x0000000000200000 Domain0 Next Arg1 : 0x0000000001f00000 Domain0 Next Mode : S-mode Domain0 SysReset : yes Boot HART ID : 0 Boot HART Domain : root Boot HART ISA : rv64imafdcvsux Boot HART Features : scounteren,mcounteren,time Boot HART PMP Count : 0 Boot HART PMP Granularity : 0 Boot HART PMP Address Bits: 0 Boot HART MHPM Count : 16 Boot HART MHPM Count : 16 Boot HART MIDELEG : 0x0000000000000222 Boot HART MEDELEG : 0x000000000000b109 [ 0.000000] Linux version 5.10.113 (nixbld@localhost) (riscv64-unknown-linux-gnu-gcc (GCC) 13.1.0, GN0 [ 0.000000] OF: fdt: Ignoring memory range 0x0 - 0x200000 [ 0.000000] earlycon: uart0 at MMIO32 0x000000ffe7014000 (options '115200n8') [ 0.000000] printk: bootconsole [uart0] enabled [ 2.292495] (NULL device *): failed to find vdmabuf_reserved_memory node [ 2.453953] spi-nor spi0.0: unrecognized JEDEC id bytes: ff ff ff ff ff ff [ 2.460971] dw_spi_mmio ffe700c000.spi: cs1 \u003e= max 1 [ 2.466001] spi_master spi0: spi_device register error /soc/spi@ffe700c000/spidev@1 [ 2.497453] sdhci-dwcmshc ffe70a0000.sd: can't request region for resource [mem 0xffef014064-0xffef01] [ 2.509014] misc vhost-vdmabuf: failed to find vdmabuf_reserved_memory node [ 3.386036] debugfs: File 'SDOUT' in directory 'dapm' already present! [ 3.392692] debugfs: File 'Playback' in directory 'dapm' already present! [ 3.399524] debugfs: File 'Capture' in directory 'dapm' already present! [ 3.406262] debugfs: File 'Playback' in directory 'dapm' already present! [ 3.413067] debugfs: File 'Capture' in directory 'dapm' already present! [ 3.425466] aw87519_pa 5-0058: aw87519_parse_dt: no reset gpio provided failed [ 3.432752] aw87519_pa 5-0058: aw87519_i2c_probe: failed to parse device tree node \u003c\u003c\u003c NixOS Stage 1 \u003e\u003e\u003e running udev... Starting systemd-udevd version 253.6 kbd_mode: KDSKBMODE: Inappropriate ioctl for device Gstarting device mapper and LVM... checking /dev/disk/by-label/NIXOS_SD... fsck (busybox 1.36.1) [fsck.ext4 (1) -- /mnt-root/] fsck.ext4 -a /dev/disk/by-label/NIXOS_SD NIXOS_SD: recovering journal NIXOS_SD: clean, 148061/248000 files, 818082/984159 blocks mounting /dev/disk/by-label/NIXOS_SD on /... \u003c\u003c\u003c NixOS Stage 2 \u003e\u003e\u003e running activation script... setting up /etc... ++ /nix/store/2w8nachmhqvbjswrrsdia5cx1afxxx60-util-linux-riscv64-unknown-linux-gnu-2.38.1-bin/bin/findm/ + rootPart=/dev/disk/by-label/NIXOS_SD ++ lsblk -npo PKNAME /dev/disk/by-label/NIXOS_SD + bootDevice=/dev/mmcblk1 ++ lsblk -npo MAJ:MIN /dev/disk/by-label/NIX","date":"2024-01-29","objectID":"/posts/how-nixos-start-on-licheepi4a/:4:2","series":["NixOS ä¸ Nix Flakes"],"tags":["Linux","NixOS","LicheePi4A","Embedded","U-Boot","RISC-V"],"title":"NixOS åœ¨ Lichee Pi 4A ä¸Šæ˜¯å¦‚ä½•å¯åŠ¨çš„","uri":"/posts/how-nixos-start-on-licheepi4a/#2-å®é™…å¯åŠ¨æ—¥å¿—åˆ†æ"},{"categories":["tech"],"content":" 3. init ç¨‹åºåˆ†ææœ‰äº†ä¸Šé¢è¿™äº›ä¿¡æ¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¯”è¾ƒå®¹æ˜“åœ°ç†è§£ init è¿™ä¸ªç¨‹åºäº†ï¼Œå®ƒä¸»è¦å¯¹åº”å‰é¢æ—¥å¿—ä¸­çš„ NixOS Stage 2ï¼Œå³åœ¨çœŸæ­£æŒ‚è½½æ ¹æ–‡ä»¶ç³»ç»Ÿä¹‹åï¼Œæ‰§è¡Œçš„ç¬¬ä¸€ä¸ªç”¨æˆ·æ€ç¨‹åºã€‚ åœ¨ NixOS ä¸­è¿™ä¸ª init ç¨‹åºå®é™…ä¸Šæ˜¯ä¸€ä¸ª shell è„šæœ¬ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ cat æˆ–è€… vim æ¥æŸ¥çœ‹å®ƒçš„å†…å®¹ï¼š bash â€º cat /nix/store/a5gnycsy3cq4ix2k8624649zj8xqzkxc-nixos-system-nixos-23.05.20230624.3ef8b37/init #! /nix/store/91hllz70n1b0qkb0r9iw1bg9xzx66a3b-bash-5.2-p15-riscv64-unknown-linux-gnu/bin/bash systemConfig=/nix/store/71wh9lvf94i1jcd6qpqw228fy5s8fv24-nixos-system-lp4a-23.05.20230806.240472b export HOME=/root PATH=\"/nix/store/fifbf1h3i83jvan2vkk7xm4fraq7drm7-coreutils-riscv64-unknown-linux-gnu-9.1/bin:/nix/store/2w8nachmhqvbjswrrsdia5cx1afxxx60-util-linux-riscv64-unknown-linux-gnu-2.38.1-bin/bin\" if [ \"${IN_NIXOS_SYSTEMD_STAGE1:-}\" != true ]; then # Process the kernel command line. for o in $(\u003c/proc/cmdline); do case $o in boot.debugtrace) # Show each command. set -x ;; esac done # Print a greeting. echo echo -e \"\\e[1;32m\u003c\u003c\u003c NixOS Stage 2 \u003e\u003e\u003e\\e[0m\" echo # Normally, stage 1 mounts the root filesystem read/writable. # However, in some environments, stage 2 is executed directly, and the # root is read-only. So make it writable here. if [ -z \"$container\" ]; then mount -n -o remount,rw none / fi fi # Likewise, stage 1 mounts /proc, /dev and /sys, so if we don't have a # stage 1, we need to do that here. if [ ! -e /proc/1 ]; then specialMount() { local device=\"$1\" local mountPoint=\"$2\" local options=\"$3\" local fsType=\"$4\" # We must not overwrite this mount because it's bind-mounted # from stage 1's /run if [ \"${IN_NIXOS_SYSTEMD_STAGE1:-}\" = true ] \u0026\u0026 [ \"${mountPoint}\" = /run ]; then return fi install -m 0755 -d \"$mountPoint\" mount -n -t \"$fsType\" -o \"$options\" \"$device\" \"$mountPoint\" } source /nix/store/vn0sga6rn69vkdbs0d2njh0aig7zmzi6-mounts.sh fi if [ \"${IN_NIXOS_SYSTEMD_STAGE1:-}\" = true ]; then echo \"booting system configuration ${systemConfig}\" else echo \"booting system configuration $systemConfig\" \u003e /dev/kmsg fi # Make /nix/store a read-only bind mount to enforce immutability of # the Nix store. Note that we can't use \"chown root:nixbld\" here # because users/groups might not exist yet. # Silence chown/chmod to fail gracefully on a readonly filesystem # like squashfs. chown -f 0:30000 /nix/store chmod -f 1775 /nix/store if [ -n \"1\" ]; then if ! [[ \"$(findmnt --noheadings --output OPTIONS /nix/store)\" =~ ro(,|$) ]]; then if [ -z \"$container\" ]; then mount --bind /nix/store /nix/store else mount --rbind /nix/store /nix/store fi mount -o remount,ro,bind /nix/store fi fi if [ \"${IN_NIXOS_SYSTEMD_STAGE1:-}\" != true ]; then # Use /etc/resolv.conf supplied by systemd-nspawn, if applicable. if [ -n \"\" ] \u0026\u0026 [ -e /etc/resolv.conf ]; then resolvconf -m 1000 -a host \u003c/etc/resolv.conf fi # Log the script output to /dev/kmsg or /run/log/stage-2-init.log. # Only at this point are all the necessary prerequisites ready for these commands. exec {logOutFd}\u003e\u00261 {logErrFd}\u003e\u00262 if test -w /dev/kmsg; then exec \u003e \u003e(tee -i /proc/self/fd/\"$logOutFd\" | while read -r line; do if test -n \"$line\"; then echo \"\u003c7\u003estage-2-init: $line\" \u003e /dev/kmsg fi done) 2\u003e\u00261 else mkdir -p /run/log exec \u003e \u003e(tee -i /run/log/stage-2-init.log) 2\u003e\u00261 fi fi # Required by the activation script install -m 0755 -d /etc /etc/nixos install -m 01777 -d /tmp # Run the script that performs all configuration activation that does # not have to be done at boot time. echo \"running activation script...\" $systemConfig/activate # Record the boot configuration. ln -sfn \"$systemConfig\" /run/booted-system # Run any user-specified commands. /nix/store/91hllz70n1b0qkb0r9iw1bg9xzx66a3b-bash-5.2-p15-riscv64-unknown-linux-gnu/bin/bash /nix/store/cmvnjz39iq4bx4cq3lvri2jj0sjq5h24-local-cmds # Ensure systemd doesn't try to populate /etc, by forcing its first-boot # heuristic off. It doesn't matter what's in /etc/machine-id for this purpose, # and systemd will immediately fill in the file when it starts, so just # creating it is enough. This `: \u003e\u003e` pattern avoids forking and avoids changing # the mtime if the file already exists. : \u003e\u003e /etc/machine-id","date":"2024-01-29","objectID":"/posts/how-nixos-start-on-licheepi4a/:4:3","series":["NixOS ä¸ Nix Flakes"],"tags":["Linux","NixOS","LicheePi4A","Embedded","U-Boot","RISC-V"],"title":"NixOS åœ¨ Lichee Pi 4A ä¸Šæ˜¯å¦‚ä½•å¯åŠ¨çš„","uri":"/posts/how-nixos-start-on-licheepi4a/#3-init-ç¨‹åºåˆ†æ"},{"categories":["tech"],"content":" 4. activate ç¨‹åºåˆ†æå‰é¢çš„ init ç¨‹åºå…¶å®æ²¡å¹²å•¥ï¼Œæ ¹æ®æˆ‘ä»¬çœ‹è¿‡çš„å¯åŠ¨æ—¥å¿—ï¼Œå¤§éƒ¨åˆ†çš„åŠŸèƒ½åº”è¯¥éƒ½æ˜¯åœ¨$systemConfig/activate è¿™ä¸ªç¨‹åºä¸­å®Œæˆçš„ã€‚ å†çœ‹çœ‹å…¶ä¸­çš„ $systemConfig/activate çš„å†…å®¹ï¼Œå®ƒåŒæ ·æ˜¯ä¸€ä¸ª shell è„šæœ¬ï¼Œç›´æ¥ cat/vim æŸ¥çœ‹ä¸‹ï¼š bash â€º cat root/nix/store/71wh9lvf94i1jcd6qpqw228fy5s8fv24-nixos-system-lp4a-23.05.20230806.240472b/activate #!/nix/store/91hllz70n1b0qkb0r9iw1bg9xzx66a3b-bash-5.2-p15-riscv64-unknown-linux-gnu/bin/bash systemConfig='/nix/store/71wh9lvf94i1jcd6qpqw228fy5s8fv24-nixos-system-lp4a-23.05.20230806.240472b' export PATH=/empty for i in /nix/store/fifbf1h3i83jvan2vkk7xm4fraq7drm7-coreutils-riscv64-unknown-linux-gnu-9.1 /nix/store/x3hfwbwcqgl9zpqrk8kvm3p2kjns9asm-gnugrep-riscv64-unknown-linux-gnu-3.7 /nix/store/qn0yhj5d7r432rdh1885cn40gz184ww9-findutils-riscv64-unknown-linux-gnu-4.9.0 /nix/store/slwk77dzar2l1c4h9fikdw93ig4wdfy1-getent-glibc-riscv64-unknown-linux-gnu-2.37-8 /nix/store/yrf57f5h1rwmf3q70msx35a2p9f0rsjr-glibc-riscv64-unknown-linux-gnu-2.37-8-bin /nix/store/9al8xczxbm72i5q63n91fli5rynrfprl-shadow-riscv64-unknown-linux-gnu-4.13 /nix/store/2imxx6v9xhy8mbbx9q1r2d991m81inar-net-tools-riscv64-unknown-linux-gnu-2.10 /nix/store/2w8nachmhqvbjswrrsdia5cx1afxxx60-util-linux-riscv64-unknown-linux-gnu-2.38.1-bin; do PATH=$PATH:$i/bin:$i/sbin done _status=0 trap \"_status=1 _localstatus=\\$?\" ERR # Ensure a consistent umask. umask 0022 #### Activation script snippet specialfs: _localstatus=0 specialMount() { local device=\"$1\" local mountPoint=\"$2\" local options=\"$3\" local fsType=\"$4\" if mountpoint -q \"$mountPoint\"; then local options=\"remount,$options\" else mkdir -m 0755 -p \"$mountPoint\" fi mount -t \"$fsType\" -o \"$options\" \"$device\" \"$mountPoint\" } source /nix/store/vn0sga6rn69vkdbs0d2njh0aig7zmzi6-mounts.sh if (( _localstatus \u003e 0 )); then printf \"Activation script snippet '%s' failed (%s)\\n\" \"specialfs\" \"$_localstatus\" fi #### Activation script snippet binfmt: _localstatus=0 mkdir -p -m 0755 /run/binfmt if (( _localstatus \u003e 0 )); then printf \"Activation script snippet '%s' failed (%s)\\n\" \"binfmt\" \"$_localstatus\" fi #### Activation script snippet stdio: _localstatus=0 if (( _localstatus \u003e 0 )); then printf \"Activation script snippet '%s' failed (%s)\\n\" \"stdio\" \"$_localstatus\" fi #### Activation script snippet binsh: _localstatus=0 # Create the required /bin/sh symlink; otherwise lots of things # (notably the system() function) won't work. mkdir -m 0755 -p /bin ln -sfn \"/nix/store/4y83vxk3mfk216d1jjfjgckkxwrbassi-bash-interactive-5.2-p15-riscv64-unknown-linux-gnu/bin/sh\" /bin/.sh.tmp mv /bin/.sh.tmp /bin/sh # atomically replace /bin/sh if (( _localstatus \u003e 0 )); then printf \"Activation script snippet '%s' failed (%s)\\n\" \"binsh\" \"$_localstatus\" fi #### Activation script snippet check-manual-docbook: _localstatus=0 if [[ $(cat /nix/store/xzgmgymf510dicgppghq27lrh9fjpxfi-options-used-docbook) = 1 ]]; then echo -e \"\\e[31;1mwarning\\e[0m: This configuration contains option documentation in docbook.\" \\ \"Support for docbook is deprecated and will be removed after NixOS 23.05.\" \\ \"See nix-store --read-log /nix/store/n232fhpqqqnlfjl0rj59xxms419glja2-options.json.drv\" fi if (( _localstatus \u003e 0 )); then printf \"Activation script snippet '%s' failed (%s)\\n\" \"check-manual-docbook\" \"$_localstatus\" fi #### Activation script snippet domain: _localstatus=0 if (( _localstatus \u003e 0 )); then printf \"Activation script snippet '%s' failed (%s)\\n\" \"domain\" \"$_localstatus\" fi #### Activation script snippet users: _localstatus=0 install -m 0700 -d /root install -m 0755 -d /home /nix/store/6fap9xv6snx5fr2m7m804v4gc23pb1jh-perl-riscv64-unknown-linux-gnu-5.36.0-env/bin/perl \\ -w /nix/store/gx91fdp4a099jpfwdkbdw2imvl3lalsk-update-users-groups.pl /nix/store/1zj6fk93qkqd3z8n34s4r40xnby2ci21-users-groups.json if (( _localstatus \u003e 0 )); then printf \"Activation script snippet '%s' failed (%s)\\n\" \"users\" \"$_localstatus\" fi #### Activation script snippet groups: _localstatus=0 if (( _localstatus \u003e 0 )); then printf \"Activation script snippet '%s' failed (%s)\\n\" \"groups\" \"$_localstatus\" fi #### Activation script snippet etc:","date":"2024-01-29","objectID":"/posts/how-nixos-start-on-licheepi4a/:4:4","series":["NixOS ä¸ Nix Flakes"],"tags":["Linux","NixOS","LicheePi4A","Embedded","U-Boot","RISC-V"],"title":"NixOS åœ¨ Lichee Pi 4A ä¸Šæ˜¯å¦‚ä½•å¯åŠ¨çš„","uri":"/posts/how-nixos-start-on-licheepi4a/#4-activate-ç¨‹åºåˆ†æ"},{"categories":["tech"],"content":" å››ã€ç¡¬ä»¶é©±åŠ¨éƒ¨åˆ†NixOS è¦èƒ½åœ¨ LicheePi 4A ä¸Šæ­£å¸¸å¯åŠ¨ï¼Œè¿˜éœ€è¦æœ‰ç¡¬ä»¶å›ºä»¶çš„æ”¯æŒï¼Œå› æ­¤å…‰äº†è§£ NixOS çš„å¯åŠ¨æµç¨‹è¿˜ä¸å¤Ÿï¼Œè¿˜éœ€è¦äº†è§£ç¡¬ä»¶å›ºä»¶çš„å¯åŠ¨æµç¨‹ã€‚è¿™é‡Œç®€è¦ä»‹ç»ä¸‹ Linux åœ¨ RISC-V ä¸Šçš„å¯åŠ¨æµç¨‹ã€‚ ","date":"2024-01-29","objectID":"/posts/how-nixos-start-on-licheepi4a/:5:0","series":["NixOS ä¸ Nix Flakes"],"tags":["Linux","NixOS","LicheePi4A","Embedded","U-Boot","RISC-V"],"title":"NixOS åœ¨ Lichee Pi 4A ä¸Šæ˜¯å¦‚ä½•å¯åŠ¨çš„","uri":"/posts/how-nixos-start-on-licheepi4a/#å››ç¡¬ä»¶é©±åŠ¨éƒ¨åˆ†"},{"categories":["tech"],"content":" 1. u-bootï¼Œu-boot-splï¼Œu-boot-tpl çš„å…³ç³»U-Boot æ˜¯åµŒå…¥å¼é¢†åŸŸæœ€å¸¸ç”¨çš„ bootloaderï¼Œ å¯¹äºä¸€èˆ¬åµŒå…¥å¼ç³»ç»Ÿè€Œè¨€åªéœ€è¦ä¸€ä¸ª u-boot ä½œä¸º bootloader å³å¯ï¼Œä½†å…¥ä»Šçš„åµŒå…¥å¼ IC å·²ç»è½¬å‘ SOC ç‰‡ä¸Šç³»ç»Ÿï¼Œå…¶å†…éƒ¨ä¸ä»…ä»…æ˜¯ä¸€é¢— CPU æ ¸ï¼Œè¿˜å¯èƒ½åŒ…å«å„ç§å„æ ·çš„å…¶ä»– IPï¼Œå› è€Œç›¸å…³çš„ä¸Šå±‚è½¯ä»¶ä¹Ÿéœ€è¦é’ˆå¯¹æ€§çš„åˆ’åˆ†ä¸åŒçš„åŠŸèƒ½åŸŸï¼Œæ“ä½œåŸŸï¼Œå®‰å…¨åŸŸç­‰ä¸Šå±‚åº”ç”¨ã€‚ä¸ºäº†æ”¯æŒè¿™äº›å¤æ‚è€Œç¢ç‰‡åŒ–çš„åº”ç”¨éœ€æ±‚ï¼Œåˆæˆ–è€…å› ä¸º SRAM å¤ªå°ä»¥è‡´æ— æ³•æ”¾ä¸‹æ•´ä¸ª bootloaderï¼ŒSOC çš„ Boot é˜¶æ®µè¡ç”Ÿå‡ºäº†å¤šçº§ BootLoaderï¼Œu-boot ä¸ºæ­¤å®šä¹‰äº†äºŒä¸‰çº§åŠ è½½å™¨: splï¼šSecondary Program Loaderï¼ŒäºŒçº§åŠ è½½å™¨ tplï¼šTertiary Program Loaderï¼Œä¸‰çº§åŠ è½½å™¨ spl å’Œ tpl èµ° u-boot å®Œå…¨ç›¸åŒçš„ boot æµç¨‹ï¼Œä¸è¿‡åœ¨ spl å’Œ tpl ä¸­å¤§å¤šæ•°é©±åŠ¨å’ŒåŠŸèƒ½è¢«å»é™¤äº†ï¼Œ æ ¹æ®éœ€è¦åªä¿ç•™ä¸€éƒ¨åˆ† spl å’Œ tpl éœ€è¦çš„åŠŸèƒ½ï¼Œé€šè¿‡ CONFIG_SPL_BUILD å’Œ CONFIG_TPL_BUILD æ§åˆ¶ï¼›ä¸€èˆ¬åªç”¨ spl å°±è¶³å¤Ÿäº†ï¼Œspl å®Œæˆ ddr åˆå§‹åŒ–ï¼Œå¹¶å®Œæˆä¸€äº›å¤–è®¾é©±åŠ¨åˆå§‹åŒ–ï¼Œæ¯”å¦‚ usbï¼Œemmcï¼Œ ä»¥æ­¤ä»å…¶ä»–å¤–å›´è®¾å¤‡åŠ è½½ u-bootï¼Œä½†æ˜¯å¦‚æœå¯¹äºå°ç³»ç»Ÿ spl è¿˜æ˜¯å¤ªå¤§äº†ï¼Œåˆ™å¯ä»¥ç»§ç»­åŠ å…¥ tplï¼Œtpl åªåš ddr ç­‰çš„ç‰¹å®šåˆå§‹åŒ–ä¿è¯ä»£ç ä½“ç§¯æå°ï¼Œä»¥æ­¤å†æ¬¡ä»æŒ‡å®šä½ç½®åŠ è½½ splï¼Œspl å†å»åŠ è½½ u-bootã€‚ LicheePi4A å°±ä½¿ç”¨äº†äºŒçº§åŠ è½½å™¨ï¼Œå®ƒç”šè‡³å†™æ­»äº† eMMC çš„åˆ†åŒºè¡¨ï¼Œè¦æ±‚æˆ‘ä»¬ä½¿ç”¨ fastboot å¾€å¯¹åº”çš„åˆ†åŒºå†™å…¥ u-boot-spl.binï¼Œå®˜æ–¹ç»™å‡ºçš„å‘½ä»¤å¦‚ä¸‹ï¼š bash # flash u-boot into spl partition sudo fastboot flash ram u-boot-with-spl.bin sudo fastboot reboot # flash uboot partition sudo fastboot flash uboot u-boot-with-spl.bin ","date":"2024-01-29","objectID":"/posts/how-nixos-start-on-licheepi4a/:5:1","series":["NixOS ä¸ Nix Flakes"],"tags":["Linux","NixOS","LicheePi4A","Embedded","U-Boot","RISC-V"],"title":"NixOS åœ¨ Lichee Pi 4A ä¸Šæ˜¯å¦‚ä½•å¯åŠ¨çš„","uri":"/posts/how-nixos-start-on-licheepi4a/#1-u-bootu-boot-splu-boot-tpl-çš„å…³ç³»"},{"categories":["tech"],"content":" 2. RISC-V çš„å¯åŠ¨æµç¨‹ç½‘ä¸Šæ‰¾åˆ°çš„ä¸€ä¸ªå›¾ï¼Œæ¶‰åŠåˆ°ä¸€äº› RISC-V æŒ‡ä»¤é›†ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼š RISCV å¼€å‘ç‰ˆå½“å‰çš„å¼•å¯¼æµç¨‹ æ ¹æ®æˆ‘ä»¬å‰é¢çš„ NixOS å¯åŠ¨æ—¥å¿—ï¼Œè·Ÿè¿™ä¸ªå›¾è¿˜æ˜¯æ¯”è¾ƒåŒ¹é…çš„ï¼Œä½†æˆ‘ä»¬æ²¡è§‚å¯Ÿåˆ°ä»»ä½• U-Boot æ—¥å¿—ï¼Œæœ‰å¯èƒ½æ˜¯å› ä¸º U-Boot æ²¡å¼€æ—¥å¿—ï¼Œæš‚æ—¶ä¸æ‰“ç®—ç»†ç©¶ã€‚ ","date":"2024-01-29","objectID":"/posts/how-nixos-start-on-licheepi4a/:5:2","series":["NixOS ä¸ Nix Flakes"],"tags":["Linux","NixOS","LicheePi4A","Embedded","U-Boot","RISC-V"],"title":"NixOS åœ¨ Lichee Pi 4A ä¸Šæ˜¯å¦‚ä½•å¯åŠ¨çš„","uri":"/posts/how-nixos-start-on-licheepi4a/#2-risc-v-çš„å¯åŠ¨æµç¨‹"},{"categories":["tech"],"content":" 3. OpenSBIå‰é¢çš„ NixOS å¯åŠ¨æ—¥å¿—è·Ÿå¯åŠ¨æµç¨‹å›¾ä¸­éƒ½å‡ºç°äº† OpenSBIï¼Œé‚£ä¹ˆ OpenSBI æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä¸ºä»€ä¹ˆ ARM å¼€å‘ç‰ˆçš„å¯åŠ¨æµç¨‹ä¸­æ²¡æœ‰è¿™ä¹ˆä¸ªç©æ„å„¿ï¼Ÿ æŸ¥äº†ä¸‹èµ„æ–™ï¼Œå¤§æ¦‚æ˜¯è¯´å› ä¸º RISC-V æ˜¯ä¸€ä¸ªå¼€æ”¾æŒ‡ä»¤é›†ï¼Œä»»ä½•äººéƒ½å¯ä»¥åŸºäº RISC-V å¼€å‘è‡ªå·±çš„å®šåˆ¶æŒ‡ä»¤é›†ï¼Œæˆ–è€…å®šåˆ¶ IC å¸ƒå±€ã€‚è¿™æ˜¾ç„¶å­˜åœ¨å¾ˆæ˜æ˜¾çš„ç¢ç‰‡åŒ–é—®é¢˜ã€‚OpenSBI å°±æ˜¯ä¸ºäº†é¿å…æ­¤é—®é¢˜è€Œè®¾è®¡çš„ï¼Œ å®ƒæä¾›äº†ä¸€ä¸ªæ ‡å‡†çš„æ¥å£ï¼Œå³ Supervisor Binary Interface, SBI. ä¸Šå±‚ç³»ç»Ÿåªéœ€è¦é€‚é… SBI å°±å¯ä»¥äº†ï¼Œä¸éœ€è¦å…³å¿ƒåº•å±‚ç¡¬ä»¶çš„ç»†èŠ‚ã€‚IC å¼€å‘å•†ä¹Ÿåªéœ€è¦å®ç° SBI çš„æ¥å£ï¼Œå°±å¯ä»¥è®©ä»»ä½•é€‚é…äº† SBI çš„ä¸Šå±‚ç³»ç»Ÿèƒ½åœ¨å…¶ç¡¬ä»¶å¹³å°ä¸Šæ­£å¸¸è¿è¡Œã€‚ è€Œ OpenSBI åˆ™æ˜¯ SBI æ ‡å‡†çš„ä¸€ä¸ªå¼€æºå®ç°ï¼ŒIC å¼€å‘å•†åªéœ€è¦å°† OpenSBI ç§»æ¤åˆ°è‡ªå·±çš„ç¡¬ä»¶å¹³å°ä¸Šå³å¯æ”¯æŒ SBI æ ‡å‡†ã€‚ è€Œ ARM è·Ÿ X86 ç­‰æŒ‡ä»¤é›†åˆ™æ˜¯å°é—­çš„ï¼Œä¸å…è®¸å…¶ä»–å…¬å¸ä¿®æ”¹ä¸æ‹“å±•å…¶æŒ‡ä»¤é›†ï¼Œå› æ­¤ä¸å­˜åœ¨ç¢ç‰‡åŒ–çš„é—®é¢˜ï¼Œä¹Ÿå°±ä¸éœ€è¦ OpenSBI è¿™æ ·çš„ä¸œè¥¿ã€‚ ","date":"2024-01-29","objectID":"/posts/how-nixos-start-on-licheepi4a/:5:3","series":["NixOS ä¸ Nix Flakes"],"tags":["Linux","NixOS","LicheePi4A","Embedded","U-Boot","RISC-V"],"title":"NixOS åœ¨ Lichee Pi 4A ä¸Šæ˜¯å¦‚ä½•å¯åŠ¨çš„","uri":"/posts/how-nixos-start-on-licheepi4a/#3-opensbi"},{"categories":["tech"],"content":" 4. fw_dynamic.bin è·Ÿ u-boot-spl.bin ä¸¤ä¸ªæ–‡ä»¶ fw_dynamic.bin: æˆ‘ä»¬ NixOS é•œåƒçš„ /boot ä¸­å°±æœ‰è¿™ä¸ªå›ºä»¶ï¼Œå®ƒæ˜¯ OpenSBI çš„ç¼–è¯‘äº§ç‰©ã€‚ RevyOS çš„å®šåˆ¶ OpenSBI æ„å»ºæ–¹æ³•ï¼šhttps://github.com/revyos/thead-opensbi/blob/lpi4a/.github/workflows/build.yml u-boot-spl.bin: è¿™ä¸ªæ–‡ä»¶æ˜¯ u-boot çš„ç¼–è¯‘äº§ç‰©ï¼Œå®ƒæ˜¯äºŒçº§åŠ è½½å™¨ã€‚ RevyOS çš„å®šåˆ¶ u-boot æ„å»ºæ–¹æ³•ï¼šhttps://github.com/revyos/thead-u-boot/blob/lpi4a/.github/workflows/build.yml ","date":"2024-01-29","objectID":"/posts/how-nixos-start-on-licheepi4a/:5:4","series":["NixOS ä¸ Nix Flakes"],"tags":["Linux","NixOS","LicheePi4A","Embedded","U-Boot","RISC-V"],"title":"NixOS åœ¨ Lichee Pi 4A ä¸Šæ˜¯å¦‚ä½•å¯åŠ¨çš„","uri":"/posts/how-nixos-start-on-licheepi4a/#4-fw_dynamicbin-è·Ÿ-u-boot-splbin-ä¸¤ä¸ªæ–‡ä»¶"},{"categories":["tech"],"content":" 5. T-Head å®˜æ–¹çš„ç¼–è¯‘å·¥å…·é“¾å› ä¸ºå†å²åŸå› ï¼ŒTH1520 è®¾è®¡æ—¶è²Œä¼¼ RVV è¿˜æ²¡å‡ºæ­£å¼çš„è§„èŒƒï¼Œå› æ­¤å®ƒä½¿ç”¨äº†ä¸€äº›éæ ‡å‡†çš„æŒ‡ä»¤é›†ï¼ŒGCC å®˜æ–¹è²Œä¼¼å®£ç§°äº†æ°¸è¿œä¸ä¼šæ”¯æŒè¿™äº›æŒ‡ä»¤é›†â€¦ï¼ˆä¸ªäººç†è§£ï¼Œå¯èƒ½æœ‰è¯¯å“ˆï¼‰ å› æ­¤ä¸ºäº†è·å¾—æœ€ä½³æ€§èƒ½ï¼ŒLicheePi4A å®˜æ–¹æ–‡æ¡£å»ºè®®ä½¿ç”¨ T-Head æä¾›çš„å·¥å…·é“¾ç¼–è¯‘æ•´ä¸ªç³»ç»Ÿã€‚ ä½†æˆ‘åœ¨ç ”ç©¶äº† NixOS çš„å·¥å…·é“¾å®ç°ï¼Œä»¥åŠå’¨è¯¢äº† @NickCao åï¼Œç¡®è®¤äº†åœ¨ NixOS ä¸Šè¿™å‡ ä¹æ˜¯ä¸å¯è¡Œçš„ã€‚NixOS å› ä¸ºä¸éµå¾ª FHS æ ‡å‡†ï¼Œå®ƒå¯¹ GCC ç­‰å·¥å…·é“¾åšäº†éå¸¸å¤šçš„é­”æ”¹ï¼Œè¦åœ¨ NixOS ä¸Šä½¿ç”¨ T-Head çš„å·¥å…·é“¾ï¼Œå°±è¦ä½¿è¿™ä¸€å †é­”æ”¹çš„ä¸œè¥¿åœ¨ T-Head çš„å·¥å…·é“¾ä¸Šä¹Ÿèƒ½ Workï¼Œè¿™ä¸ªå·¥ä½œé‡å¾ˆå¤§ï¼Œä¹Ÿå¾ˆæœ‰æŠ€æœ¯éš¾åº¦ã€‚ æ‰€ä»¥æœ€ç»ˆé€‰æ‹©äº†ç”¨ NixOS çš„æ ‡å‡†å·¥å…·é“¾ç¼–è¯‘ç³»ç»Ÿï¼Œ@revy è€å¸ˆä¹Ÿä¸ºæ­¤å¸®æˆ‘åšäº†äº›é€‚é…å·¥ä½œï¼Œè§£å†³äº†ä¸€äº›æ ‡å‡†å·¥å…·é“¾ä¸Šçš„ç¼–è¯‘é—®é¢˜ã€‚ Issue åŒºä¹Ÿæœ‰äººæåˆ°äº†è¿™ä¸ªé—®é¢˜ï¼ŒRevy è€å¸ˆä¹Ÿå¸®åŠ©è¡¥å……äº†äº›ç›¸å…³ä¿¡æ¯ï¼šhttps://github.com/ryan4yin/nixos-licheepi4a/issues/14 ","date":"2024-01-29","objectID":"/posts/how-nixos-start-on-licheepi4a/:5:5","series":["NixOS ä¸ Nix Flakes"],"tags":["Linux","NixOS","LicheePi4A","Embedded","U-Boot","RISC-V"],"title":"NixOS åœ¨ Lichee Pi 4A ä¸Šæ˜¯å¦‚ä½•å¯åŠ¨çš„","uri":"/posts/how-nixos-start-on-licheepi4a/#5-t-head-å®˜æ–¹çš„ç¼–è¯‘å·¥å…·é“¾"},{"categories":["tech"],"content":" äº”ã€æˆ‘æ˜¯å¦‚ä½•æ„å»ºå‡ºä¸€ä¸ªå¯ä»¥åœ¨ LicheePi 4A ä¸Šè¿è¡Œçš„ NixOS é•œåƒçš„åˆ°è¿™é‡Œï¼ŒNixOS åœ¨ LicheePI4A ä¸Šå¯åŠ¨çš„æ•´ä¸ªæµç¨‹å°±åŸºæœ¬è®²æ¸…æ¥šäº†ï¼Œ NixOS è·Ÿå…¶ä»–ä¼ ç»Ÿå‘è¡Œç‰ˆåœ¨å¯åŠ¨æµç¨‹ä¸­æœ€å¤§çš„åŒºåˆ«æ˜¯å®ƒè‡ªå®šä¹‰äº†ä¸€ä¸ª init è„šæœ¬ï¼Œåœ¨å¯åŠ¨ systemd ä¹‹å‰ï¼Œå®ƒä¼šå…ˆæ‰§è¡Œè¿™ä¸ªè„šæœ¬è¿›è¡Œæ–‡ä»¶ç³»ç»Ÿçš„åˆå§‹åŒ–æ“ä½œï¼Œå‡†å¤‡å¥½æœ€åŸºç¡€çš„ FHS ç›®å½•ç»“æ„ï¼Œä½¿å¾—åç»­çš„ systemd ä»¥åŠå…¶ä»–æœåŠ¡èƒ½æ­£å¸¸å¯åŠ¨ã€‚æ­£æ˜¯å› ä¸ºè¿™ä¸ª init è„šæœ¬ï¼ŒNixOS æ‰èƒ½åœ¨ä»…æœ‰ /boot ä¸ /nix è¿™ä¸¤ä¸ªç›®å½•çš„æƒ…å†µä¸‹æ­£å¸¸å¯åŠ¨æ•´ä¸ªç³»ç»Ÿã€‚ NixOS æ•°æ®çš„é›†ä¸­åŒ–åªè¯»å­˜å‚¨ä½¿æ›´å¤šçš„éªšæ“ä½œæˆä¸ºå¯èƒ½ï¼Œæ¯”å¦‚ç›´æ¥ä½¿ç”¨ tmpfs ä½œä¸ºæ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œå°†éœ€è¦æŒä¹…åŒ–çš„ç›®å½•æŒ‚è½½åˆ°å¤–éƒ¨å­˜å‚¨è®¾å¤‡ä¸Šï¼Œè¿™æ ·æ¯æ¬¡é‡å¯ç³»ç»Ÿæ—¶ï¼Œæ‰€æœ‰é¢„æœŸä¹‹å¤–çš„ä¸´æ—¶æ•°æ®éƒ½ä¼šè¢«æ¸…ç©ºï¼Œè¿›ä¸€æ­¥ä¿è¯äº†ç³»ç»Ÿçš„å¯å¤ç°æ€§ä¸å®‰å…¨æ€§ã€‚å¦‚æœä½ æœ‰ç³»ç»Ÿæ´ç™–ï¼Œè€Œä¸”æœ‰å…´è¶£æŠ˜è…¾ï¼Œé‚£å°±å¿«æ¥çœ‹çœ‹ @LanTian å†™çš„NixOS ç³»åˆ—ï¼ˆå››ï¼‰ï¼šã€Œæ— çŠ¶æ€ã€æ“ä½œç³»ç»Ÿ å§~ æœ€ç»ˆåœ¨ LicheePi4A æˆåŠŸå¯åŠ¨åçš„ç™»å½•çš„æˆªå›¾ï¼š NixOS æˆåŠŸå¯åŠ¨ é‚£ä¹ˆåŸºäºæˆ‘ä»¬åˆ°ç›®å‰ä¸ºæ­¢å­¦åˆ°çš„çŸ¥è¯†ï¼Œè¦å¦‚ä½•æ„å»ºå‡ºä¸€ä¸ªå¯ä»¥åœ¨ LicheePi 4A ä¸Šè¿è¡Œçš„ NixOS é•œåƒå‘¢ï¼Ÿ è¿™ä¸ªè®²èµ·æ¥å°±å¾ˆè´¹æ—¶é—´äº†ï¼Œæ¶‰åŠåˆ°äº† NixOS çš„äº¤å‰ç¼–è¯‘ç³»ç»Ÿï¼Œå†…æ ¸ override,flakes,é•œåƒæ„å»ºç­‰ç­‰ï¼Œè¦å±•å¼€è®²çš„è¯ä¹Ÿæ˜¯ä¸‹ä¸€ç¯‡æ–‡ç« äº†ï¼Œæœ‰å…´è¶£çš„å¯ä»¥ç›´æ¥çœ‹æˆ‘çš„ NixOS on LicheePi4A ä»“åº“ï¼šhttps://github.com/ryan4yin/nixos-licheepi4a. ç®€å•çš„è¯´ï¼ŒNixOS è·Ÿä¼ ç»Ÿ Linux å‘è¡Œç‰ˆçš„ç³»ç»Ÿé•œåƒæ„å»ºæ€è·¯æ˜¯ä¸€è‡´çš„ï¼Œä½†å› ä¸ºå…¶å£°æ˜å¼ä¸å¯å¤ç°æ€§çš„ç‰¹ç‚¹ï¼Œå®é™…å®ç°æ—¶å‡ºç°äº†éå¸¸å¤§çš„åŒºåˆ«ã€‚ä»¥æˆ‘çš„é¡¹ç›®ä»“åº“ä¸ºä¾‹ï¼Œæ•´ä¸ªé¡¹ç›®å®Œå…¨ä½¿ç”¨ Nix è¯­è¨€å£°æ˜å¼ç¼–å†™ï¼ˆå†…åµŒäº†éƒ¨åˆ† Shell è„šæœ¬â€¦ï¼‰ï¼Œè€Œä¸”è¿™ä»½é…ç½®ä¹Ÿå¯ç”¨äºç³»ç»Ÿåç»­çš„æŒç»­å£°æ˜å¼æ›´æ–°éƒ¨ç½²ï¼ˆæˆ‘è¿˜ç»™å‡ºäº†ä¸€ä¸ª demoï¼‰ã€‚ æœ€åï¼Œå†æ¨èä¸€æ³¢æˆ‘çš„ NixOS å…¥é—¨æŒ‡å—ï¼šryan4yin/nixos-and-flakes-bookï¼Œ å¯¹ NixOS æ„Ÿå…´è¶£çš„è¯»è€…ä»¬ï¼Œå¿«è¿›æˆ‘ç¢—é‡Œæ¥ï¼ˆ ","date":"2024-01-29","objectID":"/posts/how-nixos-start-on-licheepi4a/:6:0","series":["NixOS ä¸ Nix Flakes"],"tags":["Linux","NixOS","LicheePi4A","Embedded","U-Boot","RISC-V"],"title":"NixOS åœ¨ Lichee Pi 4A ä¸Šæ˜¯å¦‚ä½•å¯åŠ¨çš„","uri":"/posts/how-nixos-start-on-licheepi4a/#äº”æˆ‘æ˜¯å¦‚ä½•æ„å»ºå‡ºä¸€ä¸ªå¯ä»¥åœ¨-licheepi-4a-ä¸Šè¿è¡Œçš„-nixos-é•œåƒçš„"},{"categories":["tech"],"content":" å‚è€ƒ Systemd Stage 1 - NixCon NA 2024 - California LicheePi 4A â€”â€” è¿™ä¸ªå°æ¿æœ‰ç‚¹æ„æ€ï¼ˆç¬¬ä¸€éƒ¨åˆ†ï¼‰ - HougeLangley Analyzing the Linux boot process - By Alison Chaiken OpenSBI Platform Firmwares An Introduction to RISC-V Boot flow: Overview, Blob vs Blobfree standards åŸºäº qemu-riscv ä» 0 å¼€å§‹æ„å»ºåµŒå…¥å¼ linux ç³»ç»Ÿ ch5-1. ä»€ä¹ˆæ˜¯å¤šçº§ BootLoader ä¸ opensbi(ä¸Š)Â¶ Using the initial RAM disk (initrd) - kernel.org Differences Between vmlinux, vmlinuz, vmlinux.bin, zimage, and bzimage U-Boot å®˜æ–¹çš„ Distro æ–‡æ¡£ ","date":"2024-01-29","objectID":"/posts/how-nixos-start-on-licheepi4a/:7:0","series":["NixOS ä¸ Nix Flakes"],"tags":["Linux","NixOS","LicheePi4A","Embedded","U-Boot","RISC-V"],"title":"NixOS åœ¨ Lichee Pi 4A ä¸Šæ˜¯å¦‚ä½•å¯åŠ¨çš„","uri":"/posts/how-nixos-start-on-licheepi4a/#å‚è€ƒ"},{"categories":["life","tech"],"content":" é—²è¨€ç¢è¯­å•Šå‘€ï¼Œåˆåˆ°äº†ä¸€å¹´ä¸€åº¦çš„ä¼ ç»ŸèŠ‚ç›®â€”â€”å¹´ç»ˆæ€»ç»“æ—¶é—´ã€‚ ","date":"2023-12-31","objectID":"/posts/2023-summary/:1:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"æˆ‘çš„ 2023 - è®¤è¯†æ›´å¤šæœ‰è¶£çš„äººï¼Œè§è¯†æ›´å®½å¹¿çš„ä¸–ç•Œ","uri":"/posts/2023-summary/#é—²è¨€ç¢è¯­"},{"categories":["life","tech"],"content":" 2023 å¹´æµæ°´è´¦è¿˜æ˜¯è·Ÿå»å¹´ä¸€æ ·ï¼Œå…ˆç®€å•è¿‡ä¸€ä¸‹æˆ‘ 2023 å¹´çš„æµæ°´è´¦ï¼ˆåŸºæœ¬éƒ½æ‘˜æŠ„è‡ªæˆ‘çš„ /historyï¼Œç±»ä¼¼æ—¥è®°ï¼Ÿï¼‰ï¼š 1 æœˆ å†ä¸€æ¬¡å®Œæˆäº†å…¬å¸ K8s é›†ç¾¤ä¸€å¹´ä¸€åº¦çš„å‡çº§ï¼Œè™½ç„¶ä»ç„¶æœ‰æ¯”è¾ƒå¤§çš„å‹åŠ›ï¼Œä½†è¿™æ¬¡çš„è¿‡ç¨‹ç›¸å½“é¡ºåˆ©ã€‚ ç„¶åå°±æ˜¯æœ‹å‹çº¦é¥­ï¼Œç©è€ï¼Œå›å®¶è¿‡æ˜¥èŠ‚ã€‚ 2 æœˆ å»¶ç»­å»å¹´åº•å¼€å§‹å¯¹åµŒå…¥å¼ç¡¬ä»¶çš„å…´è¶£ï¼Œç»§ç»­æŠ˜è…¾ stm32 / orange pi 5 / esp32 ç­‰åµŒå…¥å¼ç¡¬ä»¶ã€‚ ç”¨ STM32 ç‚¹äº®äº† TFT æ¶²æ™¶å±ï¼Œä»¥åŠæå®šäº†ä½¿ç”¨ printf æ‰“å°æ—¥å¿—åˆ°ä¸²å£ -ryan4yin/learn-stm32f103c8t6 ç ”ç©¶åœ¨ orangepi5(rk3558s) ä¸Šç”¨ npu è·‘ AI ä»»åŠ¡ï¼Œå†™äº†ç‚¹ç¬”è®°demos_rk3588 æŠ˜è…¾ Proxmox VE é›†ç¾¤ ä¸»åŠ›èŠ‚ç‚¹ UM560 å›ºæ€ç¿»è½¦äº†ï¼Œæ˜¯æ‰ç”¨äº†ä¸‰ä¸ªæœˆçš„ Asgard 512G SSDï¼Œé¢—ç²’æ˜¯é•¿æ±Ÿå­˜å‚¨çš„ã€‚èµ°äº¬ä¸œå”®åäº†ã€‚ï¼ˆä¸Šæ¬¡ç¿»è½¦æ˜¯ 2022-11-02 ç‚¸äº†æ ¹å…‰å¨å¼ˆ Pro 1Tï¼Œè¿™ä¹Ÿæ²¡éš”å¤šä¹…å•Šâ€¦ï¼‰ 2022-11-02 ç¿»è½¦è®°å½• - ç³»ç»Ÿæ— æ³•å¯åŠ¨ 2023-02-03 ç¿»è½¦è®°å½• - ç³»ç»Ÿèƒ½å¯åŠ¨ä½†æ˜¯æ–‡ä»¶æŸå ç ”ç©¶ Homelab å¤‡ä»½ä¸æ•°æ®åŒæ­¥æ–¹æ¡ˆï¼Œå†™äº†ç‚¹ç¬”è®°æ•°æ®å¤‡ä»½ä¸åŒæ­¥ç­–ç•¥ å‘å¸ƒæ–‡ç« EE å…¥é—¨ï¼ˆäºŒï¼‰ - ä½¿ç”¨ ESP32 + SPI æ˜¾ç¤ºå±ç»˜å›¾ã€æ˜¾ç¤ºå›¾ç‰‡ã€è·‘è´ªåƒè›‡ ç®€å•ç©äº†ç© Stable-Diffusion-WebUI è·Ÿ sd-webui-controlnetï¼ŒæŠ„äº†äº›ç½‘ä¸Šçš„æç¤ºè¯ï¼Œæ•ˆæœç¡®å®å¾ˆæƒŠè‰³ã€‚ä¸è¿‡ç©äº†ä¸€æ³¢å°±æ²¡å•¥å…´è¶£äº†ï¼Œä¸å¤ªæƒ³èŠ±å¾ˆå¤šç²¾åŠ›å»æŠ˜è…¾å®ƒã€‚ 3 æœˆ ç”Ÿæ´»ä¸Š è¯»å®Œäº†ã€ŒThe Moon and Sixpenceã€ è·Ÿæœ‹å‹åˆ°æ¸¸æ³³é¦†æ¸¸æ³³ï¼Œç®—æ˜¯å¼€å¹´ä»¥æ¥æœ€å‰§çƒˆçš„ä¸€æ¬¡è¿åŠ¨â€¦ è·ŸåŒäº‹ä»¬çº¦ç€ä¸€èµ·ç©¿è¶Šäº†ä¸œè¥¿å†²æµ·å²¸çº¿ï¼Œè¿™æ˜¯æˆ‘ç¬¬ä¸‰æ¬¡èµ°è¿™æ¡çº¿ï¼Œé£æ™¯ä»æ—§å¾ˆç¾ï¼Œå½“ç„¶ä¹Ÿèµ°å¾—æŒºç´¯â€¦ ä¹°äº†å—å†²æµªè®­ç»ƒå¹³è¡¡æ¿ï¼Œç»ƒä¹ äº†ä¸€æ®µæ—¶é—´ï¼ŒæŒºæœ‰æ„æ€ã€‚ ä¸šä½™æŠ€æœ¯ä¸Š ä»æ—§æ˜¯æŠ˜è…¾å„ç§åµŒå…¥å¼è®¾å¤‡ï¼Œæ–°å…¥æ‰‹äº† Sipeed MAIX-III AXera-Pi AX620Aï¼ˆçˆ±èŠ¯æ´¾ï¼‰+ Maix M0s MCU, é‡ç«é²ç­çŒ« 0ï¼Œè”æç³– Nano 9Kã€M1s Dockã€Longan Nano ç­‰ä¸€å †å¤§å°å¼€å‘æ¿ï¼ŒæŠ˜è…¾å„ç§ Linux ç¼–è¯‘ã€åµŒå…¥å¼å¼€å‘çš„å†…å®¹ã€‚ è¢« Copilot X å°å°éœ‡æ’¼äº†ä¸‹ï¼ŒèŠ±äº† 100 ç¾åˆ€ä¹°äº†ä¸ª 1 å¹´çš„è®¢é˜…ï¼Œä»·æ ¼ä¸è´µï¼Œå¸Œæœ›èƒ½åˆ‡å®å¸®æˆ‘æå‡å†™ä»£ç çš„æ•ˆç‡ã€‚ å‘äº†ç¯‡æ–°åšå®¢ï¼šLinux ä¸Šçš„ WireGuard ç½‘ç»œåˆ†æï¼ˆä¸€ï¼‰ è¯»äº†ä¸€ç‚¹Linux Device Drivers Development 2nd Edition 4 æœˆ åœ¨ä¸šä½™çˆ±å¥½ä¸ŠæŠ•å…¥çš„ç²¾åŠ›è¶Šæ¥è¶Šå¤šï¼Œå·¥ä½œä¸Šç›¸å¯¹çš„è¶Šæ¥è¶Šæ‡ˆæ€ ï¼Œæ„Ÿè§‰ç¢°åˆ°äº†ç“¶é¢ˆï¼Œä½†æä¸æ˜ç™½è¯¥æ€ä¹ˆè§£å†³ã€‚ å¬äº† wd ä½¬çš„å»ºè®®æ•´äº†ä¸ªè¾¾å°”ä¼˜ A87Pro å¤©ç©ºè½´ v3ï¼Œä¸€ç•ªä½“éªŒè¿™ä¸ªå¤©ç©ºè½´ v3 æ‰‹æ„Ÿç¡®å®è´¼çˆ½ã€å£°éŸ³ä¹Ÿå°ï¼Œæ„Ÿè§‰å¯èƒ½æœ‰ç‚¹ç±»ä¼¼é™ç”µå®¹äº†ï¼ˆè™½ç„¶æˆ‘æ²¡ç”¨è¿‡é™ç”µå®¹ emmmï¼‰ã€‚ æˆ‘æ¯•ä¸šä»¥æ¥å°± 19 å¹´è·Ÿ 20 å¹´åˆ†åˆ«ä¹°è¿‡ä¸¤æŠŠ IKBC çš„èŒ¶è½´è·Ÿçº¢è½´ï¼ŒèŒ¶è½´æ”¾å®¶é‡Œäº†ï¼Œçº¢è½´ä¸€ç›´æ”¾åœ¨å…¬å¸ç”¨ã€‚å½“æ—¶å›½äº§è½´æ„Ÿè§‰è¿˜ä¸å¤ªå‡ºåï¼Œä½†æ˜¯ç°åœ¨æˆ‘èŠé”®ç›˜çš„æœ‹å‹éƒ½çœ‹ä¸ä¸Š cherry è½´äº†ï¼Œç½‘ä¸Šæœäº†ä¸‹ cherry è½´ä¹Ÿæœ‰å„ç§å“æ§ä¸‹é™ã€è½´å¿ƒä¸ç¨³ã€æ‚éŸ³å¤§çš„è¯Ÿç—…ã€‚ ç»“åˆæœ‹å‹æ¨èï¼Œå¦å¤–çœ‹åˆ° v2ex ä¸ŠèŠé”®ç›˜çš„æœ‹å‹ä¹Ÿæœ‰è¯´å¤©ç©ºè½´ v3 å¥½ç”¨çš„ï¼Œè¿˜åœ¨çŸ¥ä¹ä¸Šä¹Ÿçœ‹åˆ°æœ‰äººè¯´è¿™ä¸ªè½´ä¸é”™ï¼Œäºæ˜¯å°±æŒ‰æºä¸ä½å¿ƒæ€ä¸‹å•äº†ã€‚åˆ°æ‰‹ç¡®å®å¾ˆæƒŠè‰³ï¼Œç”šè‡³è®©æˆ‘å†ä¸€æ¬¡å–œæ¬¢ä¸Šäº†æ‰“å­—çš„æ„Ÿè§‰ï¼æ‰“äº†å‡ ç¯‡å°é¹¤ç»ƒä¹ ç¾¤çš„èµ›æ–‡äº«å—è¿™ç§é£˜é€¸çš„ feel~ æäº†ä¸ª chatglm-6b int4 é‡åŒ–ç‰ˆï¼Œæœ¬åœ°ç”¨æˆ‘çš„æ‹¯æ•‘è€…ç¬”è®°æœ¬ï¼ˆ16G RAM + RTX3070 8Gï¼‰ç©äº†ä¸‹ï¼Œ å“åº”é€Ÿåº¦æ„Ÿè§‰å¯ä»¥ï¼Œç¡®å®æœ‰ä¸€å®šçš„ä¸Šä¸‹æ–‡è”æƒ³èƒ½åŠ›ï¼Œç®€å•çš„é—®é¢˜ä¹Ÿèƒ½è§£ç­”ï¼Œä½†æ˜¯æœ‰ç‚¹ä¸èªæ˜çš„æ ·å­ï¼Œå†…å®¹æŠ•æ¯’æ¯”è¾ƒä¸¥é‡ã€‚ ç© AI è”æƒ³åˆ°æ·˜åƒåœ¾æ˜¾å¡ï¼Œçœ‹å—¨äº†å°±ç›´æ¥æ•´äº†å¥—æ–°ä¸»æœºæ–°æ˜¾ç¤ºå™¨ï¼ˆæˆ‘çš„ç¬¬ä¸€å° PC ä¸»æœºï¼Œä»¥å‰åªä¹°è¿‡ç¬”è®°æœ¬ç”µè„‘ï¼‰ï¼Œç»ç’ƒä¾§é€æœºç®±ï¼ŒRTX 4090ï¼ŒåŒæ°´å†·ï¼Œ32 å¯¸ 4K æ˜¾ç¤ºå™¨ã€‚ç»„è£…äº†å¤§åŠå¤œï¼Œåé¢åˆæŠ˜è…¾äº†å¥½å‡ å¤©ï¼Œæœºç®±ç›´æ¥å½“æ‰‹åŠå±•ç¤ºæŸœäº†ï¼Œæ•ˆæœç›¸å½“æƒŠè‰³ï¼ç¼ºç‚¹ä¸€æ˜¯å¥—ä¸‹æ¥è²Œä¼¼èŠ±äº†ä¸¤ä¸‡å¤šï¼Œ ç½ªé­ç¥¸é¦–æ˜¯ RTX4090â€¦ ä¸»æœºé…ç½® æœºç®±å±•ç¤º æœºç®±å±•ç¤º å»å¬äº†ä¸ª Live Houseï¼Œä¹é˜Ÿå«è¿æ˜¥å½’ï¼Œé’å²›çš„ä¹é˜Ÿï¼Œä¸è¿‡å‰é¢è®¸å¤šæ­Œæˆ‘éƒ½è§‰å¾—ä¸€èˆ¬èˆ¬ï¼Œä¸»å”±å”±åŠŸä¹Ÿå·®äº†ç‚¹ï¼Œå…¨é æ¶å­é¼“è´æ–¯çƒ˜æ‰˜ã€‚ä¸è¿‡æœ«å°¾å‡ é¦–æ­Œè¿˜æŒºå¥½å¬çš„ã€‚ å¤©ä¾æ‰‹åŠåˆ°è´§ï¼Œå¾ˆé£’ï½ æ´›å¤©ä¾ ç§˜å¢ƒèŠ±åº­ å¸¸æœæ‰‹åŠ æ–°ä¸»æœºè£…äº†ä¸ª Endeavour OS é‡åˆ°äº›å¥‡æ€ªçš„é—®é¢˜ï¼Œä¸€æ€’ä¹‹ä¸‹å†³å®šæ¢ OSï¼Œåˆšå¥½æœ‹å‹æåˆ°äº† NixOSï¼Œ å¬è¯´è¿‡è¿™ç©æ„å„¿èƒ½åšåˆ°ã€Œå¯å¤ç°ã€ï¼Œç›´æ¥å°±åœ¨ Homelab é‡Œå¼€äº†ä¸ª NixOS è™šæ‹Ÿæœºå¼€å§‹æŠ˜è…¾ï¼Œç”±æ­¤å¼€å§‹äº†æˆ‘çš„ NixOS ä¹‹æ—…ã€‚ ç”¨æ–°ä¸»æœºè¯•ç©äº†ç±³å¿½æ‚ çš„æ–°æ¸¸æˆã€Œæ˜Ÿç©¹é“é“ã€ï¼Œè¿˜æ˜¯ç†Ÿæ‚‰çš„ç”»é£è·Ÿ UIï¼Œåˆ¶ä½œè´¨é‡ä¹Ÿå¾ˆé«˜ï¼Œå›åˆå¼å¯¹æˆ˜çš„ç©æ³•æˆ‘æœ¬ä»¥ä¸ºä¼šæ¯ç‡¥ï¼Œä¸è¿‡ä¹Ÿè¿˜ OKã€‚æœ€é‡è¦æ˜¯ 4090 ç”»è´¨å¤Ÿé«˜ï¼Œå¾ˆå¤šå¯çˆ±çš„è§’è‰²ï¼Œæ¸¸æˆçš„åŠ¨ç”»è·Ÿå‰§æƒ…ä¹Ÿéƒ½å¾ˆåœ¨çº¿ï¼Œæ€»ä½“å¾ˆ Nice! ç”¨æ–°ä¸»æœºè¿ Quest 2 æ‰“ VR æ¸¸æˆï¼Œå‘ç°åšè¿‡å‚æ•°ä¼˜åŒ–åï¼ŒRTX4090 è·‘ beta saberï¼ŒQuest 2 çš„ç”»è´¨å‚æ•°å…¨è°ƒåˆ°æœ€é«˜ï¼Œ 5K 120 å¸§æ— å‹åŠ›ï¼Œç›¸å½“æµç•…ã€‚ ç”¨ RTX4090 ç© Cyperpunk 2077ï¼Œé¡¶é…å…‰è¿½ç”»è´¨ï¼ˆå«å•¥ onedriveï¼‰è´¼æ£’ï¼ŒçœŸçš„éå¸¸è¿˜åŸçœŸå®ç¯å¢ƒï¼Œåœ¨ GeForce Experience ä¸Šè°ƒäº†ä¸ªå•¥ä¼˜åŒ–å‚æ•°åï¼Œ4K å·®ä¸å¤šèƒ½ç¨³å®šåœ¨ 100 å¸§ï¼Œçœ‹åŠå¤©é£æ™¯ã€‚ 5 æœˆ æœˆåˆï¼Œåœ¨è™šæ‹Ÿæœºé‡ŒæŠ˜è…¾äº†å¤§åŠä¸ªæœˆ NixOS åï¼ŒæˆåŠŸåœ°ç”¨å‡ æ¡ç®€å•çš„å‘½ä»¤ï¼Œåœ¨æˆ‘çš„æ–°ä¸»æœºä¸Šå¤ç°äº†æ•´ä¸ª NixOS ç¯å¢ƒï¼Œé‚£ä¸€åˆ»çœŸçš„è¶…çº§å¼€å¿ƒï¼ŒåŠä¸ªæœˆçš„åŠªåŠ›ç»ˆäºå¾—åˆ°äº†å›æŠ¥ï¼ åœ¨æ–°ä¸»æœºä¸ŠæˆåŠŸå¤ç°å‡ºæˆ‘çš„ NixOS ç¯å¢ƒåï¼Œç´§æ¥ç€å‘å¸ƒäº†æˆ‘çš„ç³»ç»Ÿé…ç½®ryan4yin/nix-config/v0.0.2) ä»¥åŠè¿™å¤§åŠä¸ªæœˆçš„å­¦ä¹ ç¬”è®°NixOS ä¸ Nix Flakes æ–°æ‰‹å…¥é—¨ï¼Œ ç„¶åäº‹æƒ…å°±å˜å¾—è¶Šæ¥è¶Šæœ‰è¶£èµ·æ¥äº†ï¼éšç€è¯»è€…çš„åé¦ˆä»¥åŠæˆ‘å¯¹å®ƒçš„ä¸æ–­è¿­ä»£ï¼Œè¿™ä»½å­¦ä¹ ç¬”è®°é€æ¸è†¨èƒ€æˆä¸€ç¯‡ä¸€ä¸‡å¤šå­—çš„åšæ–‡ï¼Œå¹¶ä¸”æœ‰äº†ä¸­è‹±åŒè¯­ï¼Œç„¶ååˆè½¬å˜æˆä¸€æœ¬å¼€æºä¹¦è—‰nixos-and-flakes-bookï¼Œåœ¨ NixOS å›½é™…ç¤¾åŒºè·å¾—äº†å¤§é‡å¥½è¯„ï¼å®ƒç»™æˆ‘å¸¦æ¥äº†å·¨å¤§çš„æˆå°±æ„Ÿä»¥åŠç¤¾åŒºå‚ä¸æ„Ÿã€‚ NixOS \u0026 Flakes Book çš„éƒ¨åˆ†è¯„è®º - Reddit NixOS \u0026 Flakes Book çš„éƒ¨åˆ†è¯„è®º - Discourse ä¸ GitHub NixOS \u0026 Flakes Book çš„éƒ¨åˆ†è¯„è®º - Discord åœ¨ NixOS ä¸Šå°è¯•äº† i3 ä¸ Hyprland ä¸¤ä¸ªçª—å£ç®¡ç†å™¨ï¼Œå¹¶ä¸”ä½¿ç”¨ agenix ç®¡ç†äº†ç³»ç»Ÿä¸­çš„æ•æ„Ÿä¿¡æ¯ï¼Œæ¯”å¦‚å¯†ç ã€ç§é’¥ã€wireguard é…ç½®ç­‰ã€‚ agenix ç¡®å® OKï¼Œä½†å®ƒçº¯ bash è„šæœ¬å®ç°çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œä½“éªŒå¤ªå·®äº†ï¼Œé”™è¯¯ä¿¡æ¯ä¸€å›¢ç³Ÿï¼Œè§£å†³é”™è¯¯å…¨é è‡ªå·±æ‘¸ç´¢ã€‚ 6 æœˆ ç«‹äº†ä¸ª flag - æŠŠ NixOS ç§»ç¨™åˆ°æˆ‘æ‰‹ä¸Šçš„ä¸¤å—å¼€å‘ç‰ˆä¸Šè·‘èµ·æ¥ï¼Œä¸€å— ARM64 æ¶æ„çš„ Orange Pi 5ï¼Œä»¥åŠå¦ä¸€å— RISC-V æ¶æ„çš„ LicheePi 4A. èŠ±äº†å¥½å‡ å¤©æ—¶é—´ç ”ç©¶ï¼Œåœ¨ä¿„ç½—æ–¯ç½‘å‹çš„è€å¿ƒå¸®åŠ©ä¸‹ï¼Œç»ˆäºåœ¨ 6/4 æ™šä¸Šåœ¨ Orange Pi 5 ä¸ŠæŠŠ NixOS è·‘èµ·æ¥äº†ï¼Œè¿˜æŒºæœ‰æˆå°±æ„Ÿçš„ï¼ˆè™½ç„¶ç°åœ¨ä¹Ÿä¸çŸ¥é“æ‹¿è¿™æ¿å­ç”¨æ¥å¹²å•¥â€¦ï¼‰ ä¹‹åæ–­æ–­ç»­ç»­æŠ˜è…¾äº†ä¸€ä¸ªæœˆçš„ NixOS on LicheePi 4Aï¼Œè¯•äº†å¾ˆå¤šæ–¹æ¡ˆï¼Œè¿˜è¯·æ•™äº†HougeLangleyã€@nickcaoã€@chainsx ç­‰å¤§ä½¬ï¼Œå­¦ä¼šäº†å¾ˆå¤š Linux ç›¸å…³çš„ä¸œè¥¿ï¼Œè´¹å°½åƒè¾›ä¸‡è‹¦ç»ˆäºæˆåŠŸæŠŠ rootfs ç¼–è¯‘å‡ºæ¥äº†ï¼Œä½†æ­»æ´»å¼•å¯¼ä¸æˆåŠŸã€‚æ„Ÿè§‰æ˜¯ uboot-spl è·Ÿ boot åˆ†åŒºè¿™ä¸¤ä¸ªåœ°æ–¹çš„å†…å®¹æœ‰é—®é¢˜ï¼Œä½†ä¸çŸ¥é“æ€ä¹ˆè§£å†³ï¼Œç´¯è§‰ä¸çˆ±ã€‚ æ”¶åˆ°ä¸€å°æ¥è‡ª 2018 å¹´çš„æˆ‘åœ¨ futureme.org å‘é€çš„é‚®ä»¶ï¼Œå›æƒ³èµ·æ¥ï¼Œå½“æ—¶æˆ‘æ˜¯çœŸè¿·èŒ«å“ªã€‚ 2018 å¹´å†™ç»™ 5 å¹´åçš„æˆ‘çš„é‚®ä»¶ å—è¯»è€…è¯„è®ºå¯å‘ï¼Œå°†ä¹‹å‰çš„ NixOS ç¬”è®°åšæˆäº†ä¸€ä¸ªå•ç‹¬çš„æ–‡æ¡£ç«™ç‚¹ + GitHub ä»“åº“ï¼Œnixos-and-flakes-bookï¼Œä¹Ÿå¯¹å…¶å†…å®¹åšäº†å¤§é‡æ›´æ–°ï¼Œç”¨ ChatGPT 3.5 å…¨é¢ä¼˜åŒ–äº†è‹±æ–‡å†…å®¹ï¼Œé˜…è¯»ä½“éªŒå¤§å¤§æå‡ï¼ˆè‹±æ–‡è‹¦æ‰‹é»˜é»˜è·¯è¿‡â€¦ï¼‰ NixOS \u0026 Flakes Book 7 æœˆ NixOS ç³»ç»Ÿé…ç½® ryan4yin/nix-config è¿­ä»£ï¼š æŠŠåŠå…¬ç”µè„‘ Macbook Pro 2020 é‡è£äº†ä¸€éç³»çµ±ï¼Œæ–°ç³»ç»Ÿç’°å¢ƒå®Œå…¨é€šé nix-darwin å®‰è£ç®¡ç†ï¼Œ å°±é€£å¤§éƒ¨åˆ†çš„ macOS ç³»çµ±é…ç½®ä¹Ÿå®Œå…¨å£°æ˜å¼ç®¡ç†äº†ã€‚è‡³æ­¤ï¼Œæˆ‘çš„å¸¸ç”¨ç”µè„‘ç¯å¢ƒï¼ˆNixOS+macOSï¼‰ å…¨éƒ¨éƒ½ä½¿ç”¨åŒä¸€ä»½ nix é…ç½®ç®¡ç†èµ·æ¥äº†ï¼Œæ„Ÿè¦ºéå¸¸é¦™ï¼ Linux ä¸ macOS éƒ½ä½¿ç”¨äº†åŒä¸€ä»½å°é¹¤éŸ³å½¢çš„ rime é…ç½®ï¼Œç°åœ¨è¾“å…¥æ³•çš„è·¨å¹³å°ä½“éªŒä¹Ÿå®Œå…¨ä¸€è‡´äº†ï¼Œéå¸¸æ£’ï¼ nixpkgs å¯¹ macOS çš„æ”¯æŒæœ‰é™ï¼Œå› æ­¤å¸¸ç”¨çš„ GUI ç¨‹åºéƒ½é€šè¿‡ nix-darwin è°ƒç”¨ homebrew è¿›è¡Œå®‰è£…ç®¡ç†ã€‚ æ‰€æœ‰å‘½ä»¤è¡Œå·¥å…·çš„ä¸»é¢˜ï¼Œå…¨éƒ¨ç»Ÿä¸€ä¸ºäº†catppuccin-mocha. å£çº¸æ–‡ä»¶å¤ªå¤§äº†ï¼Œå°†å®ƒä»¬æ‹†åˆ†åˆ°å•ç‹¬çš„ä»“åº“ä¸­ï¼Œæ–¹ä¾¿ç®¡ç†ã€‚åŒæ—¶è¿˜æ·»åŠ äº†éšæœºåˆ‡æ¢å£çº¸çš„åŠŸèƒ½ã€‚ æ·»åŠ äº†ä¸‰å°åœ¨ Proxmox VE ä¸Šè¿è¡Œçš„ NixOS è™šæ‹Ÿæœºï¼Œå¹¶ä¸”å°è¯•ç”¨å®ƒä»¬ç»„å»º NixOS çš„åˆ†å¸ƒå¼æ„å»ºé›†ç¾¤ï¼ŒæŒºæœ‰æ„æ€ã€‚ å‘ç°ä¹‹å‰ç”¨çš„ alacritty åŠŸèƒ½æœ‰é™ï¼Œäºæ˜¯å°†ä¸»åŠ›ç»ˆç«¯æ¢æˆäº† kittyï¼Œwezterm ä½œä¸ºå¤‡ç”¨é€‰æ‹©ï¼Œ è€Œ alacritty å°±åŸºæœ¬ä¸ä½¿ç”¨äº†ã€‚ ä¸»åŠ›ç¼–","date":"2023-12-31","objectID":"/posts/2023-summary/:2:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"æˆ‘çš„ 2023 - è®¤è¯†æ›´å¤šæœ‰è¶£çš„äººï¼Œè§è¯†æ›´å®½å¹¿çš„ä¸–ç•Œ","uri":"/posts/2023-summary/#2023-å¹´æµæ°´è´¦"},{"categories":["life","tech"],"content":" 2023 å¹´ Highlights","date":"2023-12-31","objectID":"/posts/2023-summary/:3:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"æˆ‘çš„ 2023 - è®¤è¯†æ›´å¤šæœ‰è¶£çš„äººï¼Œè§è¯†æ›´å®½å¹¿çš„ä¸–ç•Œ","uri":"/posts/2023-summary/#2023-å¹´-highlights"},{"categories":["life","tech"],"content":" 1. ä¸šä½™æŠ€æœ¯æŠ€æœ¯æ–¹é¢æˆ‘ä»Šå¹´çš„è¿›å±•è¿˜æ˜¯æŒºå¤§çš„ï¼Œå¯è·Ÿå»å¹´å†™çš„å±•æœ›å‡ ä¹æ²¡å•¥å…³è”ï¼Œäººç”Ÿæ€»æ˜¯å……æ»¡äº†æ„å¤–å“ˆå“ˆâ€¦ ä»Šå¹´çš„ä¸»è¦æŠ€æœ¯æˆå°±åŸºæœ¬å®Œå…¨é›†ä¸­åœ¨ NixOS è¿™ä¸€å—ï¼Œæ–°å»ºçš„å‡ ä¸ªé¡¹ç›®éƒ½æ”¶åˆ°äº†æŒºå¤š stars è·Ÿå¥½è¯„ã€‚ æˆªæ­¢ 2023/12/31ï¼Œæˆ‘ stars æ¯”è¾ƒé«˜çš„å‡ ä¸ªé¡¹ç›®å¦‚ä¸‹ï¼š ryan4yin/nixos-and-flakes-book: è¿™æœ¬å¼€æºå°ä¹¦çš„ä»“åº“äº 2023/6/23 åˆ›å»ºï¼Œç›®å‰è·å¾—äº† 15 ä¸ª issuesï¼Œ24 ä½è´¡çŒ®è€…ï¼Œ43 ä¸ª forksï¼Œ923 ä¸ª starsï¼Œä»¥åŠ 4 ä½å›½å¤–è¯»è€…çš„å…±è®¡ $80 é›¶èŠ±é’±èµåŠ©ã€‚ æ˜¯æˆ‘ç›®å‰ stars æ•°æœ€é«˜çš„é¡¹ç›® å®ƒçš„æ–‡æ¡£ç«™ç›®å‰ç¨³å®šåœ¨æ¯å¤© 150 UV ryan4yin/knowledge: è¿™ä»½ä¸ªäººç¬”è®°æˆ‘ä» 2019 å¹´å·¥ä½œå¼€å§‹å†™ï¼Œç›®å‰æœ‰äº† 38 ä¸ª forksï¼Œ363 ä¸ª stars. ryan4yin/nix-config: è¿™ä»½ NixOS ç³»ç»Ÿé…ç½®ä»“åº“äº 2023/4/23 åˆ›å»ºï¼Œç›®å‰è·å¾—äº† 6 ä½è´¡çŒ®è€…ï¼Œ23 ä¸ª forksï¼Œä»¥åŠ 297 ä¸ª stars. ryan4yin/nix-darwin-kickstarter: æˆ‘äº 2023/7/19 åˆ›å»ºçš„ä¸€ä¸ª Nix-Darwin æ¨¡æ¿ä»“åº“ï¼Œç›®å‰ 133 stars. ryan4yin/nixos-rk3588: è¿™æ˜¯æˆ‘åœ¨ 2023/6/4 åˆ›å»ºçš„ä¸€ä¸ª NixOS ç§»æ¤é¡¹ç›®ï¼Œç›®å‰æ”¯æŒäº†ä¸‰å— RK3588 å¼€å‘æ¿ï¼Œè·å¾—äº† 2 ä½è´¡çŒ®è€…ï¼Œ9 ä¸ª forksï¼Œ11 ä¸ª issuesï¼Œä»¥åŠ 49 stars. ryan4yin/nixos-licheepi4a: åŒæ ·æ˜¯ä¸€ä¸ª NixOS ç§»æ¤é¡¹ç›®ï¼Œä½†ç›®æ ‡æ˜¯åŸºäº RISC-V æŒ‡ä»¤é›†çš„ LicheePi 4A å¼€å‘æ¿ã€‚ç›®å‰è·å¾—äº† 3 ä½è´¡çŒ®è€…ä¸ 23 starsï¼Œå…¶ä¸­ä¸€ä½è´¡çŒ®è€…è¿˜èµåŠ©äº† $50 ç»™æˆ‘ã€‚ è¿™ä¸ªé¡¹ç›®æ–­æ–­ç»­ç»­èŠ±äº†ä¸¤ä¸ªæœˆæ‰æå®šï¼Œç”¨æ—¶è¿œè¶…é¢„æ–™â€¦ä¸è¿‡æˆåŠŸåè·å¾—çš„æˆå°±æ„Ÿä¹Ÿæ˜¯å·¨å¤§çš„ï¼ å¯¹æ¯”ä¸‹ä» 2023 å¹´ 1 æœˆ 1 æ—¥åˆ°ç°åœ¨ï¼Œæˆ‘çš„ GitHub Metrics ç»Ÿè®¡æ•°æ®ï¼š 2023/01/01 GitHub ç»Ÿè®¡æ•°æ® 2023/12/31 GitHub ç»Ÿè®¡æ•°æ® å‡ ä¸ªå…³é”®æŒ‡æ ‡çš„å˜åŒ–ï¼š Stars: 312 =\u003e 2072, æ¶¨å¹… 564%. Followers: 152 =\u003e 468, æ¶¨å¹… 208%. Forkers: 97 =\u003e 203, æ¶¨å¹… 109%. Watchers: 39 =\u003e 102, æ¶¨å¹… 161%. åœ¨æŠ˜è…¾ NixOS çš„è¿‡ç¨‹ä¸­æˆ‘å†™çš„å…¥é—¨æŒ‡å— ï¼ˆnixos-and-flakes-bookï¼‰è·å¾—äº†å›½å†…å¤–ç¤¾åŒºçš„å¤§é‡å¥½è¯„ï¼Œå…¶ä»–é¡¹ç›®ä¹Ÿå„æœ‰æ–©è·ï¼›å¦å¤–è®¤è¯†äº†å¥½å‡ ä½å›½å†…å¤–çš„ NixOS èµ„æ·±ç”¨æˆ·ã€å¼€æºé¡¹ç›®ä½œè€…ä»¥åŠåµŒå…¥å¼å¼€å‘è€…ï¼Œè¿˜æ”¶åˆ°äº†ä¸€äº›å¤–å›½è¯»è€…çš„æ‰“èµã€‚ è¿™äº›æˆç»©ç»™æˆ‘å¸¦æ¥äº†å·¨å¤§çš„æˆå°±æ„Ÿä»¥åŠç¤¾åŒºå‚ä¸æ„Ÿï¼Œä¹Ÿå®Œå…¨å¥‘åˆäº†æˆ‘å¹´åˆç»™è‡ªå·±çš„æœŸè®¸â€”â€”ã€Œè®¤è¯†æ›´å¤šæœ‰è¶£çš„äººï¼Œè§è¯†ä¸‹æ›´å®½å¹¿çš„ä¸–ç•Œã€ã€‚ ä»Šå¹´ä¸ä»…ç»™ AstroNvim, ESP-IDF ç­‰çŸ¥åé¡¹ç›®è´¡çŒ®äº†å°‘è®¸ä»£ç ï¼Œç”šè‡³è¿˜åˆ›é€ äº†è¿™ä¹ˆå¤šä¸ªå—æ¬¢è¿çš„æ–°é¡¹ç›®ã€æ”¶åˆ°äº†å‡ åä¸ª PRã€‚ä¹‹å‰å®šçš„ç»™ä¸€äº›å¼€æºé¡¹ç›®è´¡çŒ®ä»£ç çš„ç›®æ ‡ï¼Œå®Œå…¨æ˜¯è¶…é¢å®Œæˆäº†ã€‚ åœ¨æŠ˜è…¾ä¸Š NixOS åï¼Œå¹´ä¸­çš„æ—¶å€™åˆé¡ºå¸¦å°† VSCode å½»åº•æ¢æˆäº† Zellij + Neovimï¼Œç”šè‡³å¹´åº•åˆå¼€å§‹æŠ˜è…¾ Guix ç³»ç»Ÿã€Emacs ç¼–è¾‘å™¨ï¼Œä»¥åŠ nushell ç­‰æ–°é²œç©æ„å„¿ã€‚ æ€»çš„æ¥è¯´ï¼Œä¸šä½™æŠ€æœ¯ä»Šå¹´æåˆ°è¿™ä¸ªç¨‹åº¦ï¼Œç›¸æ¯”å»å¹´ï¼Œèƒ½ç§°å¾—ä¸Šæ˜¯ã€Œä¼˜ç§€ã€ã€ã€Œè¶…å‡ºé¢„æœŸã€ã€‚ è¦è¯´æˆ‘åœ¨ææŠ€æœ¯è¿™æ–¹é¢æœ‰å•¥è¯€çªå¯åˆ†äº«çš„è¯ï¼Œé‚£åº”è¯¥å°±æ˜¯ Learning by Teachingï¼Œæˆ‘ GitHub ä¸Šç›®å‰ stars æœ€é«˜çš„ä¸¤ä¸ªé¡¹ç›®ï¼ˆNixOS \u0026 Flakes Book ä»¥åŠ knowledgeï¼‰ä»¥åŠè¿™ä¸ªåšå®¢ç«™ç‚¹å°±æ˜¯æˆ‘åœ¨è·µè¡Œå®ƒæœ€å¥½çš„è¯æ˜ï¼Œè€Œå®ƒä»¬è·å¾—çš„è¯„è®ºã€ starsã€ä»¥åŠé›¶èŠ±é’±èµåŠ©ï¼Œåˆ™è¯æ˜äº†å®ƒçš„ä»·å€¼ã€‚ ","date":"2023-12-31","objectID":"/posts/2023-summary/:3:1","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"æˆ‘çš„ 2023 - è®¤è¯†æ›´å¤šæœ‰è¶£çš„äººï¼Œè§è¯†æ›´å®½å¹¿çš„ä¸–ç•Œ","uri":"/posts/2023-summary/#1-ä¸šä½™æŠ€æœ¯"},{"categories":["life","tech"],"content":" 2. å·¥ä½œå·¥ä½œä¸Šåªèƒ½è¯´é©¬é©¬è™è™ï¼Œä¸ŠåŠå¹´ä¸šä½™åœ¨ NixOS ä¸Šåšçš„æˆæœå¾—åˆ°äº†éå¸¸å¤šçš„è®¤å¯ï¼Œç›¸å½“æœ‰æˆå°±æ„Ÿï¼ŒèŠ±äº†å¤§é‡çš„ç²¾åŠ›åœ¨ NixOS ä¸Šï¼Œä¹Ÿåˆ›å»ºäº†è®¸å¤šç›¸å…³é¡¹ç›®ã€‚ä½†å¦ä¸€æ–¹é¢ï¼Œç²¾åŠ›å°±è¿™ä¹ˆå¤šï¼Œæˆ‘ä¹Ÿä¸€ç›´åšä¸åˆ°å¹³è¡¡å¥½å·¥ä½œä¸ç”Ÿæ´»/ä¸šä½™çˆ±å¥½ï¼Œå…¶ç»“æœå°±æ˜¯é‚£æ®µæ—¶é—´æ²¡å•¥å¿ƒæ€åœ¨å·¥ä½œä¸Šï¼ŒæŠŠå·¥ä½œæå¾—ä¸€å›¢ç³Ÿã€‚å½“æ—¶è§‰å¾—è‡ªå·±è¿›å…¥äº†ä¸€ä¸ªç“¶é¢ˆæœŸï¼Œåœ¨å·¥ä½œä¸Šæ‰¾ä¸åˆ°ä»€ä¹ˆæˆå°±æ„Ÿï¼Œä¸šä½™çˆ±å¥½è™½ç„¶åšå‡ºäº†ä¸é”™çš„æˆç»©ï¼Œä½†åˆä¸èƒ½é è¿™ä¸ªåƒé¥­ã€‚ åœ¨æŠ˜è…¾ä¸šä½™çˆ±å¥½æœŸé—´ï¼Œä¸€ç§æ‰¾ä¸åˆ°æ–¹å‘çš„ç„¦è™‘æ„Ÿä¸€ç›´è¦ç»•ç€æˆ‘ï¼Œæœ‰è·Ÿä¸€äº›æœ‹å‹ã€åŒäº‹æ²Ÿé€šè¿‡è¿™ä¸ªé—®é¢˜ï¼Œ ä½†å¤§é“ç†è°éƒ½æ‡‚ï¼ŒçœŸè¦åšèµ·æ¥åˆæ˜¯å¦ä¸€å›äº‹äº†ã€‚ å› ä¸ºä¸šä½™æäº†äº›åµŒå…¥å¼ç¡¬ä»¶æ„Ÿè§‰æœ‰æ„æ€ï¼Œä¹Ÿæœ‰éšçº¦è€ƒè™‘è¿‡è½¬è¡Œæç¡¬ä»¶ï¼Œä½†åªæ˜¯äº›ç²—æµ…çš„æƒ³æ³•ã€‚åˆ° 8 æœˆä»½çš„æ—¶å€™ï¼Œåšçš„å‡ ä¸ª NixOS é¡¹ç›®æ”¶åˆ°äº›èµåŠ©ï¼Œè®©æˆ‘å¯èƒ½æœ‰ç‚¹å¼‚æƒ³å¤©å¼€ï¼Ÿäº†è§£äº†äº›ã€Œå¦‚ä½•é€šè¿‡å¼€æºé¡¹ç›®å…»æ´»è‡ªå·±ã€ç±»ä¼¼çš„ä¿¡æ¯ï¼Œ8 æœˆä¸­ä¸‹æ—¬çš„æ—¶å€™åœ¨è‹æ´‹çš„æŠ˜è…¾ç¾¤é‡Œæåˆ°è¿™ä¸ªæƒ³æ³•ï¼Œè¢«æ´‹å“¥æ³¼äº†å†·æ°´ emmm å†·é™ä¸‹æ¥åå›æƒ³ï¼Œæ´‹å“¥è¯´çš„æŒºåœ¨ç†çš„ï¼Œé å¼€æºç”¨çˆ±å‘ç”µçœŸèƒ½å…»æ´»è‡ªå·±çš„å‡¤æ¯›éºŸè§’ï¼Œå¦‚æœä¸“é—¨å¾€å•†ä¸šé¡¹ç›®çš„æ–¹å‘åšï¼Œåˆæ²¡äº†é‚£ä»½æŠ˜è…¾çš„å¿«ä¹äº†ã€‚ 8 æœˆåº•çš„æ—¶å€™ï¼Œè‹æ´‹çš„æŠ˜è…¾ç¾¤é‡Œå‘èµ·ä¸€åœºè‡ªæˆ‘ä»‹ç»æ´»åŠ¨ï¼Œè¯»äº†è®¸å¤šç¾¤å‹çš„è‡ªæˆ‘ä»‹ç»ï¼Œå¾ˆæœ‰æ„Ÿè§¦ï¼Œäºæ˜¯åŸºäºæˆ‘è‡ªå·±åœ¨ç¾¤é‡Œå‘çš„è‡ªæˆ‘ä»‹ç»è°ƒæ•´æ‰©å†™ï¼Œæˆæœå°±æ˜¯è¿™ç¯‡äººç”Ÿå·²è¿‡å››åˆ†ä¹‹ä¸€ã€‚ å½“æ—¶æ–‡ç« å®Œæˆåå‘å‡ºæ¥ï¼ŒçœŸè§‰å¾—è‡ªå·±æƒ³æ˜ç™½ä¸å°‘ï¼Œä¹Ÿè·Ÿé¢†å¯¼åŒäº‹åšäº†äº›æ²Ÿé€šï¼Œå·¥ä½œä¸ŠçŠ¶æ€æœ‰æ‰€å¥½è½¬ã€‚ä½†è¿˜æ˜¯å¾ˆéš¾é›†ä¸­æ³¨æ„åŠ›ï¼Œåˆ†å¿ƒçš„æƒ…å†µä»ç„¶ç›¸å½“ä¸¥é‡ã€‚ä¹Ÿå°è¯•äº†é€šè¿‡ç•ªèŒ„é’Ÿä¹‹ç±»çš„æ–¹å¼æ¥æé«˜å·¥ä½œæ•ˆç‡ï¼Œä½†æ•ˆæœä¸ä½³ã€‚å½“æ—¶æœ‰ç‚¹è®¤å‘½äº†ï¼Œæƒ³ç€äººç”Ÿå¯èƒ½å°±æ˜¯è¿™æ ·æ°¸è¿œåœ¨è¿™æ ·æœªçŸ¥çš„é“è·¯ä¸Šçš„æŒ£æ‰ç€å‰è¿›ï¼Œä¹Ÿæœ‰ç—›è‹¦ï¼Œä¹Ÿæœ‰å¿«ä¹ã€‚ è½¬æŠ˜ç‚¹æ˜¯å›½åº†å‰è·Ÿæœ‹å‹æäº†å˜´æ„Ÿè§‰è‡ªå·±æœ‰ ADHDï¼Œå›½åº†åå°±è¢«@å’©å’©å‚¬ä¿ƒå»çœ‹å¿ƒç†åŒ»ç”Ÿï¼Œä¹‹åå°±ç¡®è¯Šäº† ADHD å¹¶å¼€å§‹æœè¯ã€‚ç¡®è¯Šè®©æˆ‘çš„å¿ƒæ€å‡ºç°å·¨å¤§çš„æ”¹å˜ï¼Œä¸šä½™çˆ±å¥½å› æ­¤æ”¾ä¸‹äº†ä¸€ä¸ªå¤šæœˆã€‚è€Œæœè¯åˆ™å¸®åŠ©æˆ‘æ‰­è½¬äº†å·¥ä½œçŠ¶æ€ï¼Œæˆ‘çš„ä¸“æ³¨èƒ½åŠ›æœ‰äº†è´¨çš„æå‡ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»Šå¹´æœ€å¤§çš„æ”¶è·ä¹‹ä¸€ã€‚ æ€»ä½“ä¸Šï¼Œæˆ‘ä»Šå¹´çš„å·¥ä½œåšå¾—æ¯”å»å¹´å·®ï¼Œå°¤å…¶æ˜¯ä¸ŠåŠå¹´ï¼Œæ€»ä½“ä¸Šåªèƒ½ç®—ã€ŒåŠæ ¼ã€å§ã€‚ ","date":"2023-12-31","objectID":"/posts/2023-summary/:3:2","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"æˆ‘çš„ 2023 - è®¤è¯†æ›´å¤šæœ‰è¶£çš„äººï¼Œè§è¯†æ›´å®½å¹¿çš„ä¸–ç•Œ","uri":"/posts/2023-summary/#2-å·¥ä½œ"},{"categories":["life","tech"],"content":" 3. ç”Ÿæ´» 3.1. ç¡®è¯Š ADHD ä»¥åŠæ²»ç–—å‰æ–‡æäº†ï¼Œæˆ‘ä»Šå¹´ç¡®è¯Šäº† ADHDï¼Œè¿™æ˜¯æˆ‘ä»Šå¹´æœ€å¤§çš„æ”¶è·ä¹‹ä¸€ã€‚å®ƒè®©æˆ‘ææ˜ç™½äº†ï¼ŒåŸæ¥æˆ‘ä¸€ç›´å­˜åœ¨çš„æ³¨æ„åŠ›é—®é¢˜ï¼Œå¹¶ä¸æ˜¯ä»€ä¹ˆäººæ ¼ç¼ºé™·æˆ–è€…æ„å¿—åŠ›ä¸å¤Ÿï¼Œè€Œæ˜¯ä¸€ç§æœ‰æŒºå¤šäººéƒ½å­˜åœ¨çš„åŠŸèƒ½å¤±è°ƒï¼ˆdisorderï¼‰ï¼Œ å¯ä»¥é€šè¿‡è¯ç‰©ç­‰æ–¹å¼æ²»ç–—ç¼“è§£ã€‚ è€ƒè™‘åˆ° ADHD çš„é—ä¼ ç‰¹æ€§ï¼Œè·Ÿå¦¹å¦¹ã€çˆ¶æ¯ä¸€ç•ªæ²Ÿé€šåï¼Œå¸¦æˆ‘å¦¹æ¥æ·±åœ³çœ‹åŒ»ç”Ÿï¼Œç¡®è¯Šäº† ADHD ä»¥åŠæŠ‘éƒç—‡ã€‚è¯´çœŸçš„ï¼Œæˆ‘ä¸€ç›´çŸ¥é“æˆ‘å¦¹å¦¹æƒ…ç»ªæ¯”è¾ƒæ•æ„Ÿï¼Œä½†ä»æ²¡æƒ³è¿‡æ˜¯å› ä¸ºæŠ‘éƒç—‡ã€‚ è¿™ä¹‹åï¼Œé™¤äº†å·¥ä½œå¤–ï¼Œæˆ‘å¤§éƒ¨åˆ†çš„ç²¾åŠ›éƒ½èŠ±åœ¨äº†å…³å¿ƒå®¶äººã€è¿åŠ¨ã€å­¦ä¹ å¿ƒç†å­¦ç­‰äº‹æƒ…ä¸Šã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸æ˜æ˜¾çš„è½¬å˜ï¼Œæˆ‘è·Ÿæˆ‘å¦¹çš„å…³ç³»æ›´å¥½äº†ï¼Œå¦å¤–æŒç»­å¥½å‡ ä¸ªæœˆçš„æ²»ç–—è·Ÿæ¯ä¸ªæœˆå¸¦å¥¹åœ¨æ·±åœ³æ•£æ•£å¿ƒï¼Œå¥¹çš„æƒ…ç»ªä¹Ÿæœ‰äº†å¾ˆå¤§çš„æ”¹å–„ã€‚ 3.2. å‚ä¸å…¬ç›Šæ´»åŠ¨å› ç¼˜é™…ä¼šè·Ÿ @Manjusaka_Lee ä»¥åŠå¦ä¸€ä½æœ‹å‹èŠåˆ°äº†å…¬ç›Šï¼Œ å½“æ—¶åœ¨å·¥ä½œä¸Šç¼ºä¹åŠ¨åŠ›ï¼Œæƒ³åœ¨å…¶ä»–çš„äº‹æƒ…ä¸Šæ‰¾æ‰¾æ„Ÿè§‰ï¼Œå…¬ç›Šæœ¬èº«ä¹Ÿæ˜¯ä¸€ä»¶å¾ˆæœ‰æ„ä¹‰çš„äº‹æƒ…ï¼Œé‚£æ®µæ—¶é—´å­¦ä¹ äº†è§£äº†è®¸å¤šå…¬ç›Šèµ„æ–™ï¼Œå‚åŠ äº†ä¸€äº›å…¬ç›Šä¼šå±•ä¸ææ¬¾æ´»åŠ¨ï¼Œè¿˜ä¸€åº¦è€ƒè™‘åšå¿—æ„¿è€…ã€‚ ä»Šå¹´ç®—æ˜¯è¿ˆå‡ºäº†å‚ä¸å…¬ç›Šæ´»åŠ¨çš„ç¬¬ä¸€æ­¥ï¼Œè¿™æ‹“å±•äº†æˆ‘çš„è§†é‡ï¼Œè®©æˆ‘æ›´åŠ äº†è§£äº†ç¤¾ä¼šã€‚åœ¨å­¦ä¹ äº†è§£å…¬ç›ŠæœŸé—´ä¹Ÿç»“è¯†äº†ä¸€äº›å¿—åŒé“åˆçš„æœ‹å‹ï¼Œè¿™ä¹ŸæŒºç¬¦åˆæˆ‘å»å¹´ç»™è‡ªå·±çš„æœŸè®¸â€”â€”ã€Œè®¤è¯†æ›´å¤šæœ‰è¶£çš„äººï¼Œè§è¯†ä¸‹æ›´å®½å¹¿çš„ä¸–ç•Œã€ã€‚ åšäº‹æƒ…ï¼Œæœ€éš¾çš„å°±æ˜¯ä» 0 åˆ° 1ï¼Œå› æ­¤ä»Šå¹´çš„è¿™ä¸€è¿›å±•å°±æ˜¾å¾—å°¤ä¸ºå¯è´µï¼Œç§°å¾—ä¸Šæ˜¯ã€Œä¼˜ç§€ã€ã€‚ 3.3. é˜…è¯»ä¸å†™ä½œé¦–å…ˆæ˜¯æˆ‘ 2023 å¹´çš„è¯»ä¹¦è®°å½•ï¼š 2023-03-09 - The Moon and Sixpence ä½ æ˜¯è¦åœ°ä¸Šçš„å…­ä¾¿å£«ï¼Œè¿˜æ˜¯è¦å¤©ä¸Šçš„æœˆäº®ï¼Ÿ 2023-08-31 -How to Do Great Work - Paul Graham é»‘å®¢ä¸ç”»å®¶ä¸€ç¯‡ä¸¤ä¸‡å¤šå­—çš„é•¿æ–‡ï¼Œä¹Ÿç®—æ˜¯ä¸€æœ¬å°ä¹¦äº†å§ï¼Œå¹²è´§æ»¡æ»¡ã€‚ 2023-09-29 - ã€Šè¢«è®¨åŒçš„å‹‡æ°”ã€‹ ä¸€æœ¬é€šè¿‡å¯¹è¯çš„å½¢å¼è®²è¿°é˜¿å‹’å¾·å¿ƒç†å­¦çš„ä¹¦ï¼Œè¿™é—¨å¿ƒç†å­¦ä¸ç°ä»£ç§‘å­¦å¿ƒç†å­¦ä¸åŒï¼Œå®ƒæ›´åå‘å“²å­¦ã€‚ 2023-10-08 - ã€Šå«é­‚ï¼š1768 å¹´ä¸­å›½å¦–æœ¯å¤§ææ…Œã€‹ ä» 1768 å¹´çš„å«é­‚æ¡ˆå‡ºå‘ï¼Œåˆ†æäº†ä¹¾éš†æ—¶æœŸçš„ä¸­å›½ç¤¾ä¼šçš„è®¸å¤šæ–¹é¢ã€‚æ¯”å¦‚å› å„ç§åŸå› å¯¼è‡´äººå£è¿‡åº¦å¢é•¿ã€äººå‡èµ„æºå‡å°‘ã€ç¤¾ä¼šçŸ›ç›¾æ¿€åŒ–å¯¼è‡´çš„æ™®éææ…Œï¼Œä»¥åŠå®˜åƒšå›ä¸»åˆ¶çš„è¿ä½œæœºåˆ¶ã€å­˜åœ¨çš„é—®é¢˜ã€‚æ­¤ä¹¦ä»¥å²ä¸ºé‰´ï¼Œèƒ½å¸®åŠ©æˆ‘ä»¬ç†è§£ç°ä»£ä¸­å›½æ”¿æ²»ä¸ä¸­å›½ç¤¾ä¼šçš„ä¸€äº›åŸºæœ¬é—®é¢˜ã€‚ 2023-10-17 - ã€Šåˆ†å¿ƒä¸æ˜¯æˆ‘çš„é”™ã€‹ ä»‹ç» ADHD çš„ä¸€æœ¬ä¹¦ï¼Œåˆ—ä¸¾äº†å¾ˆå¤š ADHD æ¡ˆä¾‹ï¼Œä¹Ÿç»™å‡ºäº†è¯Šç–—å»ºè®®ï¼Œå¯¹æˆ‘ç›¸å½“æœ‰ç”¨ï¼ ä»¥åŠä¸€äº›æœªè¯»å®Œçš„ä¹¦ï¼š ã€Šè¿™æ‰æ˜¯å¿ƒç†å­¦ - çœ‹ç©¿ä¼ªç§‘å­¦çš„æ‰¹åˆ¤æ€§æ€ç»´ ç¬¬ 11 ç‰ˆã€‹ Psychology and Life, 20th edition, by Richard J. Gerrig The Great Gatsby - 10/41 ã€Šå¤æ‚ - æ¢…æ‹‰å°¼ ç±³æ­‡å°”ã€‹ Linux Device Driver Development - Second Edition: Linux é©±åŠ¨ç¼–ç¨‹å…¥é—¨ï¼Œ2022 å¹´å‡ºçš„æ–°ä¹¦ï¼ŒåŸºäº Linux 5.10ï¼Œamazon ä¸Šè¯„ä»·ä¸é”™ï¼Œç›®å‰åªæœ‰è‹±æ–‡ç‰ˆï¼Œå†™çš„å¾ˆå¥½ï¼Œå¯¹æ–°æ‰‹å¾ˆå‹å¥½ã€‚ 2023 å¹´æˆ‘è¯»çš„ä¹¦ç±æ•°é‡ä¸å¤šï¼Œæ²¡è¾¾æˆæ¯æœˆè¯»ä¸€æœ¬ä¹¦çš„ç›®æ ‡ã€‚è€Œå†™ä½œæ–¹é¢ï¼Œç®—ä¸Šè¿™ç¯‡æ€»ç»“ï¼Œä»Šå¹´æˆ‘ä¸€å…±å†™äº† 9 ç¯‡åšæ–‡ï¼Œä¹Ÿæ²¡è¾¾æˆæ¯æœˆå†™ä¸€ç¯‡çš„ç›®æ ‡ã€‚ ä½†é‰´äºæˆ‘ä»Šå¹´å†™äº†ä¸€æœ¬æŒºå—æ¬¢è¿çš„å°ä¹¦NixOS \u0026 Flakes Bookï¼Œå®ƒå¾—åˆ°äº† NixOS ç¤¾åŒºè¯¸å¤šå¥½è¯„ï¼Œè¿˜åœ¨ 10 æœˆä»½ä¸Šäº† Hacker News çƒ­æ¦œï¼Œç”šè‡³è¢«å®˜æ–¹æ–‡æ¡£nix.dev åˆ—å…¥æ¨èé˜…è¯»ï¼Œæˆ‘å§‘ä¸”å°†ä»Šå¹´ã€Œé˜…è¯»ä¸å†™ä½œã€è¿™ä¸€é¡¹çš„è¯„åˆ†å®šä¸ºã€Œè¶…å‡ºæœŸå¾…ã€ï¼ 3.4. å…¶ä»– è¿åŠ¨æ–¹é¢ä¹å–„å¯é™ˆï¼Œç©¿è¶Šäº†ä¸€æ¬¡ä¸œè¥¿å†²æµ·å²¸çº¿ï¼Œæ¸¸äº†å‡ æ¬¡æ³³ï¼Œ12 æœˆåˆæ™¨è·‘äº†ä¸€å‘¨ä½†å› ä¸ºæ˜¯ç©ºè…¹è·‘ï¼Œ èƒƒç‚ç»™è·‘çŠ¯äº†ï¼Œå°±æ²¡å†è·‘äº†ã€‚ä½“é‡å…¨å¹´éƒ½åœ¨ 60kg æ³¢åŠ¨ï¼Œæ²¡å•¥å˜åŒ–ã€‚ ç»™æˆ‘è€çˆ¸å…¨æ¬¾ä¹°äº†æˆ‘ä»¬å…¨å®¶çš„ç¬¬ä¸€è¾†å°è½¿è½¦ï¼ˆè‡ªå·±æ²¡ä¹°ï¼Œä¸€æ˜¯å¤©å¤©ååœ°é“ç”¨ä¸åˆ°ï¼ŒäºŒæ˜¯æˆ‘å¯¹è½¦ä¹Ÿç¼ºä¹å…´è¶£ï¼‰ã€‚ è®¡åˆ’å¼€å§‹ç»™çˆ¶æ¯çº¦å¹´åº¦ä½“æ£€ï¼Œå¾…å®æ–½ã€‚ 3.5. æ€»ç»“ç”Ÿæ´»ä¸Šä»Šå¹´è¾¾æˆäº†è¿™ä¹ˆå¤šæœ‰æ„ä¹‰çš„æˆå°±ï¼ˆç¡®è¯Š ADHDã€å°†æ›´å¤šç²¾åŠ›èŠ±åœ¨å…³å¿ƒå®¶äººä¸Šã€å‚ä¸å…¬ç›Šæ´»åŠ¨ã€ç»™å®¶é‡Œä¹°è½¦ç­‰ç­‰ï¼‰ï¼Œæˆ‘ç»™è‡ªå·±çš„è¯„ä»·å½“ç„¶æ˜¯ã€Œä¼˜ç§€ã€ã€‚ ","date":"2023-12-31","objectID":"/posts/2023-summary/:3:3","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"æˆ‘çš„ 2023 - è®¤è¯†æ›´å¤šæœ‰è¶£çš„äººï¼Œè§è¯†æ›´å®½å¹¿çš„ä¸–ç•Œ","uri":"/posts/2023-summary/#3-ç”Ÿæ´»"},{"categories":["life","tech"],"content":" 3. ç”Ÿæ´» 3.1. ç¡®è¯Š ADHD ä»¥åŠæ²»ç–—å‰æ–‡æäº†ï¼Œæˆ‘ä»Šå¹´ç¡®è¯Šäº† ADHDï¼Œè¿™æ˜¯æˆ‘ä»Šå¹´æœ€å¤§çš„æ”¶è·ä¹‹ä¸€ã€‚å®ƒè®©æˆ‘ææ˜ç™½äº†ï¼ŒåŸæ¥æˆ‘ä¸€ç›´å­˜åœ¨çš„æ³¨æ„åŠ›é—®é¢˜ï¼Œå¹¶ä¸æ˜¯ä»€ä¹ˆäººæ ¼ç¼ºé™·æˆ–è€…æ„å¿—åŠ›ä¸å¤Ÿï¼Œè€Œæ˜¯ä¸€ç§æœ‰æŒºå¤šäººéƒ½å­˜åœ¨çš„åŠŸèƒ½å¤±è°ƒï¼ˆdisorderï¼‰ï¼Œ å¯ä»¥é€šè¿‡è¯ç‰©ç­‰æ–¹å¼æ²»ç–—ç¼“è§£ã€‚ è€ƒè™‘åˆ° ADHD çš„é—ä¼ ç‰¹æ€§ï¼Œè·Ÿå¦¹å¦¹ã€çˆ¶æ¯ä¸€ç•ªæ²Ÿé€šåï¼Œå¸¦æˆ‘å¦¹æ¥æ·±åœ³çœ‹åŒ»ç”Ÿï¼Œç¡®è¯Šäº† ADHD ä»¥åŠæŠ‘éƒç—‡ã€‚è¯´çœŸçš„ï¼Œæˆ‘ä¸€ç›´çŸ¥é“æˆ‘å¦¹å¦¹æƒ…ç»ªæ¯”è¾ƒæ•æ„Ÿï¼Œä½†ä»æ²¡æƒ³è¿‡æ˜¯å› ä¸ºæŠ‘éƒç—‡ã€‚ è¿™ä¹‹åï¼Œé™¤äº†å·¥ä½œå¤–ï¼Œæˆ‘å¤§éƒ¨åˆ†çš„ç²¾åŠ›éƒ½èŠ±åœ¨äº†å…³å¿ƒå®¶äººã€è¿åŠ¨ã€å­¦ä¹ å¿ƒç†å­¦ç­‰äº‹æƒ…ä¸Šã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸æ˜æ˜¾çš„è½¬å˜ï¼Œæˆ‘è·Ÿæˆ‘å¦¹çš„å…³ç³»æ›´å¥½äº†ï¼Œå¦å¤–æŒç»­å¥½å‡ ä¸ªæœˆçš„æ²»ç–—è·Ÿæ¯ä¸ªæœˆå¸¦å¥¹åœ¨æ·±åœ³æ•£æ•£å¿ƒï¼Œå¥¹çš„æƒ…ç»ªä¹Ÿæœ‰äº†å¾ˆå¤§çš„æ”¹å–„ã€‚ 3.2. å‚ä¸å…¬ç›Šæ´»åŠ¨å› ç¼˜é™…ä¼šè·Ÿ @Manjusaka_Lee ä»¥åŠå¦ä¸€ä½æœ‹å‹èŠåˆ°äº†å…¬ç›Šï¼Œ å½“æ—¶åœ¨å·¥ä½œä¸Šç¼ºä¹åŠ¨åŠ›ï¼Œæƒ³åœ¨å…¶ä»–çš„äº‹æƒ…ä¸Šæ‰¾æ‰¾æ„Ÿè§‰ï¼Œå…¬ç›Šæœ¬èº«ä¹Ÿæ˜¯ä¸€ä»¶å¾ˆæœ‰æ„ä¹‰çš„äº‹æƒ…ï¼Œé‚£æ®µæ—¶é—´å­¦ä¹ äº†è§£äº†è®¸å¤šå…¬ç›Šèµ„æ–™ï¼Œå‚åŠ äº†ä¸€äº›å…¬ç›Šä¼šå±•ä¸ææ¬¾æ´»åŠ¨ï¼Œè¿˜ä¸€åº¦è€ƒè™‘åšå¿—æ„¿è€…ã€‚ ä»Šå¹´ç®—æ˜¯è¿ˆå‡ºäº†å‚ä¸å…¬ç›Šæ´»åŠ¨çš„ç¬¬ä¸€æ­¥ï¼Œè¿™æ‹“å±•äº†æˆ‘çš„è§†é‡ï¼Œè®©æˆ‘æ›´åŠ äº†è§£äº†ç¤¾ä¼šã€‚åœ¨å­¦ä¹ äº†è§£å…¬ç›ŠæœŸé—´ä¹Ÿç»“è¯†äº†ä¸€äº›å¿—åŒé“åˆçš„æœ‹å‹ï¼Œè¿™ä¹ŸæŒºç¬¦åˆæˆ‘å»å¹´ç»™è‡ªå·±çš„æœŸè®¸â€”â€”ã€Œè®¤è¯†æ›´å¤šæœ‰è¶£çš„äººï¼Œè§è¯†ä¸‹æ›´å®½å¹¿çš„ä¸–ç•Œã€ã€‚ åšäº‹æƒ…ï¼Œæœ€éš¾çš„å°±æ˜¯ä» 0 åˆ° 1ï¼Œå› æ­¤ä»Šå¹´çš„è¿™ä¸€è¿›å±•å°±æ˜¾å¾—å°¤ä¸ºå¯è´µï¼Œç§°å¾—ä¸Šæ˜¯ã€Œä¼˜ç§€ã€ã€‚ 3.3. é˜…è¯»ä¸å†™ä½œé¦–å…ˆæ˜¯æˆ‘ 2023 å¹´çš„è¯»ä¹¦è®°å½•ï¼š 2023-03-09 - The Moon and Sixpence ä½ æ˜¯è¦åœ°ä¸Šçš„å…­ä¾¿å£«ï¼Œè¿˜æ˜¯è¦å¤©ä¸Šçš„æœˆäº®ï¼Ÿ 2023-08-31 -How to Do Great Work - Paul Graham é»‘å®¢ä¸ç”»å®¶ä¸€ç¯‡ä¸¤ä¸‡å¤šå­—çš„é•¿æ–‡ï¼Œä¹Ÿç®—æ˜¯ä¸€æœ¬å°ä¹¦äº†å§ï¼Œå¹²è´§æ»¡æ»¡ã€‚ 2023-09-29 - ã€Šè¢«è®¨åŒçš„å‹‡æ°”ã€‹ ä¸€æœ¬é€šè¿‡å¯¹è¯çš„å½¢å¼è®²è¿°é˜¿å‹’å¾·å¿ƒç†å­¦çš„ä¹¦ï¼Œè¿™é—¨å¿ƒç†å­¦ä¸ç°ä»£ç§‘å­¦å¿ƒç†å­¦ä¸åŒï¼Œå®ƒæ›´åå‘å“²å­¦ã€‚ 2023-10-08 - ã€Šå«é­‚ï¼š1768 å¹´ä¸­å›½å¦–æœ¯å¤§ææ…Œã€‹ ä» 1768 å¹´çš„å«é­‚æ¡ˆå‡ºå‘ï¼Œåˆ†æäº†ä¹¾éš†æ—¶æœŸçš„ä¸­å›½ç¤¾ä¼šçš„è®¸å¤šæ–¹é¢ã€‚æ¯”å¦‚å› å„ç§åŸå› å¯¼è‡´äººå£è¿‡åº¦å¢é•¿ã€äººå‡èµ„æºå‡å°‘ã€ç¤¾ä¼šçŸ›ç›¾æ¿€åŒ–å¯¼è‡´çš„æ™®éææ…Œï¼Œä»¥åŠå®˜åƒšå›ä¸»åˆ¶çš„è¿ä½œæœºåˆ¶ã€å­˜åœ¨çš„é—®é¢˜ã€‚æ­¤ä¹¦ä»¥å²ä¸ºé‰´ï¼Œèƒ½å¸®åŠ©æˆ‘ä»¬ç†è§£ç°ä»£ä¸­å›½æ”¿æ²»ä¸ä¸­å›½ç¤¾ä¼šçš„ä¸€äº›åŸºæœ¬é—®é¢˜ã€‚ 2023-10-17 - ã€Šåˆ†å¿ƒä¸æ˜¯æˆ‘çš„é”™ã€‹ ä»‹ç» ADHD çš„ä¸€æœ¬ä¹¦ï¼Œåˆ—ä¸¾äº†å¾ˆå¤š ADHD æ¡ˆä¾‹ï¼Œä¹Ÿç»™å‡ºäº†è¯Šç–—å»ºè®®ï¼Œå¯¹æˆ‘ç›¸å½“æœ‰ç”¨ï¼ ä»¥åŠä¸€äº›æœªè¯»å®Œçš„ä¹¦ï¼š ã€Šè¿™æ‰æ˜¯å¿ƒç†å­¦ - çœ‹ç©¿ä¼ªç§‘å­¦çš„æ‰¹åˆ¤æ€§æ€ç»´ ç¬¬ 11 ç‰ˆã€‹ Psychology and Life, 20th edition, by Richard J. Gerrig The Great Gatsby - 10/41 ã€Šå¤æ‚ - æ¢…æ‹‰å°¼ ç±³æ­‡å°”ã€‹ Linux Device Driver Development - Second Edition: Linux é©±åŠ¨ç¼–ç¨‹å…¥é—¨ï¼Œ2022 å¹´å‡ºçš„æ–°ä¹¦ï¼ŒåŸºäº Linux 5.10ï¼Œamazon ä¸Šè¯„ä»·ä¸é”™ï¼Œç›®å‰åªæœ‰è‹±æ–‡ç‰ˆï¼Œå†™çš„å¾ˆå¥½ï¼Œå¯¹æ–°æ‰‹å¾ˆå‹å¥½ã€‚ 2023 å¹´æˆ‘è¯»çš„ä¹¦ç±æ•°é‡ä¸å¤šï¼Œæ²¡è¾¾æˆæ¯æœˆè¯»ä¸€æœ¬ä¹¦çš„ç›®æ ‡ã€‚è€Œå†™ä½œæ–¹é¢ï¼Œç®—ä¸Šè¿™ç¯‡æ€»ç»“ï¼Œä»Šå¹´æˆ‘ä¸€å…±å†™äº† 9 ç¯‡åšæ–‡ï¼Œä¹Ÿæ²¡è¾¾æˆæ¯æœˆå†™ä¸€ç¯‡çš„ç›®æ ‡ã€‚ ä½†é‰´äºæˆ‘ä»Šå¹´å†™äº†ä¸€æœ¬æŒºå—æ¬¢è¿çš„å°ä¹¦NixOS \u0026 Flakes Bookï¼Œå®ƒå¾—åˆ°äº† NixOS ç¤¾åŒºè¯¸å¤šå¥½è¯„ï¼Œè¿˜åœ¨ 10 æœˆä»½ä¸Šäº† Hacker News çƒ­æ¦œï¼Œç”šè‡³è¢«å®˜æ–¹æ–‡æ¡£nix.dev åˆ—å…¥æ¨èé˜…è¯»ï¼Œæˆ‘å§‘ä¸”å°†ä»Šå¹´ã€Œé˜…è¯»ä¸å†™ä½œã€è¿™ä¸€é¡¹çš„è¯„åˆ†å®šä¸ºã€Œè¶…å‡ºæœŸå¾…ã€ï¼ 3.4. å…¶ä»– è¿åŠ¨æ–¹é¢ä¹å–„å¯é™ˆï¼Œç©¿è¶Šäº†ä¸€æ¬¡ä¸œè¥¿å†²æµ·å²¸çº¿ï¼Œæ¸¸äº†å‡ æ¬¡æ³³ï¼Œ12 æœˆåˆæ™¨è·‘äº†ä¸€å‘¨ä½†å› ä¸ºæ˜¯ç©ºè…¹è·‘ï¼Œ èƒƒç‚ç»™è·‘çŠ¯äº†ï¼Œå°±æ²¡å†è·‘äº†ã€‚ä½“é‡å…¨å¹´éƒ½åœ¨ 60kg æ³¢åŠ¨ï¼Œæ²¡å•¥å˜åŒ–ã€‚ ç»™æˆ‘è€çˆ¸å…¨æ¬¾ä¹°äº†æˆ‘ä»¬å…¨å®¶çš„ç¬¬ä¸€è¾†å°è½¿è½¦ï¼ˆè‡ªå·±æ²¡ä¹°ï¼Œä¸€æ˜¯å¤©å¤©ååœ°é“ç”¨ä¸åˆ°ï¼ŒäºŒæ˜¯æˆ‘å¯¹è½¦ä¹Ÿç¼ºä¹å…´è¶£ï¼‰ã€‚ è®¡åˆ’å¼€å§‹ç»™çˆ¶æ¯çº¦å¹´åº¦ä½“æ£€ï¼Œå¾…å®æ–½ã€‚ 3.5. æ€»ç»“ç”Ÿæ´»ä¸Šä»Šå¹´è¾¾æˆäº†è¿™ä¹ˆå¤šæœ‰æ„ä¹‰çš„æˆå°±ï¼ˆç¡®è¯Š ADHDã€å°†æ›´å¤šç²¾åŠ›èŠ±åœ¨å…³å¿ƒå®¶äººä¸Šã€å‚ä¸å…¬ç›Šæ´»åŠ¨ã€ç»™å®¶é‡Œä¹°è½¦ç­‰ç­‰ï¼‰ï¼Œæˆ‘ç»™è‡ªå·±çš„è¯„ä»·å½“ç„¶æ˜¯ã€Œä¼˜ç§€ã€ã€‚ ","date":"2023-12-31","objectID":"/posts/2023-summary/:3:3","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"æˆ‘çš„ 2023 - è®¤è¯†æ›´å¤šæœ‰è¶£çš„äººï¼Œè§è¯†æ›´å®½å¹¿çš„ä¸–ç•Œ","uri":"/posts/2023-summary/#31-ç¡®è¯Š-adhd-ä»¥åŠæ²»ç–—"},{"categories":["life","tech"],"content":" 3. ç”Ÿæ´» 3.1. ç¡®è¯Š ADHD ä»¥åŠæ²»ç–—å‰æ–‡æäº†ï¼Œæˆ‘ä»Šå¹´ç¡®è¯Šäº† ADHDï¼Œè¿™æ˜¯æˆ‘ä»Šå¹´æœ€å¤§çš„æ”¶è·ä¹‹ä¸€ã€‚å®ƒè®©æˆ‘ææ˜ç™½äº†ï¼ŒåŸæ¥æˆ‘ä¸€ç›´å­˜åœ¨çš„æ³¨æ„åŠ›é—®é¢˜ï¼Œå¹¶ä¸æ˜¯ä»€ä¹ˆäººæ ¼ç¼ºé™·æˆ–è€…æ„å¿—åŠ›ä¸å¤Ÿï¼Œè€Œæ˜¯ä¸€ç§æœ‰æŒºå¤šäººéƒ½å­˜åœ¨çš„åŠŸèƒ½å¤±è°ƒï¼ˆdisorderï¼‰ï¼Œ å¯ä»¥é€šè¿‡è¯ç‰©ç­‰æ–¹å¼æ²»ç–—ç¼“è§£ã€‚ è€ƒè™‘åˆ° ADHD çš„é—ä¼ ç‰¹æ€§ï¼Œè·Ÿå¦¹å¦¹ã€çˆ¶æ¯ä¸€ç•ªæ²Ÿé€šåï¼Œå¸¦æˆ‘å¦¹æ¥æ·±åœ³çœ‹åŒ»ç”Ÿï¼Œç¡®è¯Šäº† ADHD ä»¥åŠæŠ‘éƒç—‡ã€‚è¯´çœŸçš„ï¼Œæˆ‘ä¸€ç›´çŸ¥é“æˆ‘å¦¹å¦¹æƒ…ç»ªæ¯”è¾ƒæ•æ„Ÿï¼Œä½†ä»æ²¡æƒ³è¿‡æ˜¯å› ä¸ºæŠ‘éƒç—‡ã€‚ è¿™ä¹‹åï¼Œé™¤äº†å·¥ä½œå¤–ï¼Œæˆ‘å¤§éƒ¨åˆ†çš„ç²¾åŠ›éƒ½èŠ±åœ¨äº†å…³å¿ƒå®¶äººã€è¿åŠ¨ã€å­¦ä¹ å¿ƒç†å­¦ç­‰äº‹æƒ…ä¸Šã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸æ˜æ˜¾çš„è½¬å˜ï¼Œæˆ‘è·Ÿæˆ‘å¦¹çš„å…³ç³»æ›´å¥½äº†ï¼Œå¦å¤–æŒç»­å¥½å‡ ä¸ªæœˆçš„æ²»ç–—è·Ÿæ¯ä¸ªæœˆå¸¦å¥¹åœ¨æ·±åœ³æ•£æ•£å¿ƒï¼Œå¥¹çš„æƒ…ç»ªä¹Ÿæœ‰äº†å¾ˆå¤§çš„æ”¹å–„ã€‚ 3.2. å‚ä¸å…¬ç›Šæ´»åŠ¨å› ç¼˜é™…ä¼šè·Ÿ @Manjusaka_Lee ä»¥åŠå¦ä¸€ä½æœ‹å‹èŠåˆ°äº†å…¬ç›Šï¼Œ å½“æ—¶åœ¨å·¥ä½œä¸Šç¼ºä¹åŠ¨åŠ›ï¼Œæƒ³åœ¨å…¶ä»–çš„äº‹æƒ…ä¸Šæ‰¾æ‰¾æ„Ÿè§‰ï¼Œå…¬ç›Šæœ¬èº«ä¹Ÿæ˜¯ä¸€ä»¶å¾ˆæœ‰æ„ä¹‰çš„äº‹æƒ…ï¼Œé‚£æ®µæ—¶é—´å­¦ä¹ äº†è§£äº†è®¸å¤šå…¬ç›Šèµ„æ–™ï¼Œå‚åŠ äº†ä¸€äº›å…¬ç›Šä¼šå±•ä¸ææ¬¾æ´»åŠ¨ï¼Œè¿˜ä¸€åº¦è€ƒè™‘åšå¿—æ„¿è€…ã€‚ ä»Šå¹´ç®—æ˜¯è¿ˆå‡ºäº†å‚ä¸å…¬ç›Šæ´»åŠ¨çš„ç¬¬ä¸€æ­¥ï¼Œè¿™æ‹“å±•äº†æˆ‘çš„è§†é‡ï¼Œè®©æˆ‘æ›´åŠ äº†è§£äº†ç¤¾ä¼šã€‚åœ¨å­¦ä¹ äº†è§£å…¬ç›ŠæœŸé—´ä¹Ÿç»“è¯†äº†ä¸€äº›å¿—åŒé“åˆçš„æœ‹å‹ï¼Œè¿™ä¹ŸæŒºç¬¦åˆæˆ‘å»å¹´ç»™è‡ªå·±çš„æœŸè®¸â€”â€”ã€Œè®¤è¯†æ›´å¤šæœ‰è¶£çš„äººï¼Œè§è¯†ä¸‹æ›´å®½å¹¿çš„ä¸–ç•Œã€ã€‚ åšäº‹æƒ…ï¼Œæœ€éš¾çš„å°±æ˜¯ä» 0 åˆ° 1ï¼Œå› æ­¤ä»Šå¹´çš„è¿™ä¸€è¿›å±•å°±æ˜¾å¾—å°¤ä¸ºå¯è´µï¼Œç§°å¾—ä¸Šæ˜¯ã€Œä¼˜ç§€ã€ã€‚ 3.3. é˜…è¯»ä¸å†™ä½œé¦–å…ˆæ˜¯æˆ‘ 2023 å¹´çš„è¯»ä¹¦è®°å½•ï¼š 2023-03-09 - The Moon and Sixpence ä½ æ˜¯è¦åœ°ä¸Šçš„å…­ä¾¿å£«ï¼Œè¿˜æ˜¯è¦å¤©ä¸Šçš„æœˆäº®ï¼Ÿ 2023-08-31 -How to Do Great Work - Paul Graham é»‘å®¢ä¸ç”»å®¶ä¸€ç¯‡ä¸¤ä¸‡å¤šå­—çš„é•¿æ–‡ï¼Œä¹Ÿç®—æ˜¯ä¸€æœ¬å°ä¹¦äº†å§ï¼Œå¹²è´§æ»¡æ»¡ã€‚ 2023-09-29 - ã€Šè¢«è®¨åŒçš„å‹‡æ°”ã€‹ ä¸€æœ¬é€šè¿‡å¯¹è¯çš„å½¢å¼è®²è¿°é˜¿å‹’å¾·å¿ƒç†å­¦çš„ä¹¦ï¼Œè¿™é—¨å¿ƒç†å­¦ä¸ç°ä»£ç§‘å­¦å¿ƒç†å­¦ä¸åŒï¼Œå®ƒæ›´åå‘å“²å­¦ã€‚ 2023-10-08 - ã€Šå«é­‚ï¼š1768 å¹´ä¸­å›½å¦–æœ¯å¤§ææ…Œã€‹ ä» 1768 å¹´çš„å«é­‚æ¡ˆå‡ºå‘ï¼Œåˆ†æäº†ä¹¾éš†æ—¶æœŸçš„ä¸­å›½ç¤¾ä¼šçš„è®¸å¤šæ–¹é¢ã€‚æ¯”å¦‚å› å„ç§åŸå› å¯¼è‡´äººå£è¿‡åº¦å¢é•¿ã€äººå‡èµ„æºå‡å°‘ã€ç¤¾ä¼šçŸ›ç›¾æ¿€åŒ–å¯¼è‡´çš„æ™®éææ…Œï¼Œä»¥åŠå®˜åƒšå›ä¸»åˆ¶çš„è¿ä½œæœºåˆ¶ã€å­˜åœ¨çš„é—®é¢˜ã€‚æ­¤ä¹¦ä»¥å²ä¸ºé‰´ï¼Œèƒ½å¸®åŠ©æˆ‘ä»¬ç†è§£ç°ä»£ä¸­å›½æ”¿æ²»ä¸ä¸­å›½ç¤¾ä¼šçš„ä¸€äº›åŸºæœ¬é—®é¢˜ã€‚ 2023-10-17 - ã€Šåˆ†å¿ƒä¸æ˜¯æˆ‘çš„é”™ã€‹ ä»‹ç» ADHD çš„ä¸€æœ¬ä¹¦ï¼Œåˆ—ä¸¾äº†å¾ˆå¤š ADHD æ¡ˆä¾‹ï¼Œä¹Ÿç»™å‡ºäº†è¯Šç–—å»ºè®®ï¼Œå¯¹æˆ‘ç›¸å½“æœ‰ç”¨ï¼ ä»¥åŠä¸€äº›æœªè¯»å®Œçš„ä¹¦ï¼š ã€Šè¿™æ‰æ˜¯å¿ƒç†å­¦ - çœ‹ç©¿ä¼ªç§‘å­¦çš„æ‰¹åˆ¤æ€§æ€ç»´ ç¬¬ 11 ç‰ˆã€‹ Psychology and Life, 20th edition, by Richard J. Gerrig The Great Gatsby - 10/41 ã€Šå¤æ‚ - æ¢…æ‹‰å°¼ ç±³æ­‡å°”ã€‹ Linux Device Driver Development - Second Edition: Linux é©±åŠ¨ç¼–ç¨‹å…¥é—¨ï¼Œ2022 å¹´å‡ºçš„æ–°ä¹¦ï¼ŒåŸºäº Linux 5.10ï¼Œamazon ä¸Šè¯„ä»·ä¸é”™ï¼Œç›®å‰åªæœ‰è‹±æ–‡ç‰ˆï¼Œå†™çš„å¾ˆå¥½ï¼Œå¯¹æ–°æ‰‹å¾ˆå‹å¥½ã€‚ 2023 å¹´æˆ‘è¯»çš„ä¹¦ç±æ•°é‡ä¸å¤šï¼Œæ²¡è¾¾æˆæ¯æœˆè¯»ä¸€æœ¬ä¹¦çš„ç›®æ ‡ã€‚è€Œå†™ä½œæ–¹é¢ï¼Œç®—ä¸Šè¿™ç¯‡æ€»ç»“ï¼Œä»Šå¹´æˆ‘ä¸€å…±å†™äº† 9 ç¯‡åšæ–‡ï¼Œä¹Ÿæ²¡è¾¾æˆæ¯æœˆå†™ä¸€ç¯‡çš„ç›®æ ‡ã€‚ ä½†é‰´äºæˆ‘ä»Šå¹´å†™äº†ä¸€æœ¬æŒºå—æ¬¢è¿çš„å°ä¹¦NixOS \u0026 Flakes Bookï¼Œå®ƒå¾—åˆ°äº† NixOS ç¤¾åŒºè¯¸å¤šå¥½è¯„ï¼Œè¿˜åœ¨ 10 æœˆä»½ä¸Šäº† Hacker News çƒ­æ¦œï¼Œç”šè‡³è¢«å®˜æ–¹æ–‡æ¡£nix.dev åˆ—å…¥æ¨èé˜…è¯»ï¼Œæˆ‘å§‘ä¸”å°†ä»Šå¹´ã€Œé˜…è¯»ä¸å†™ä½œã€è¿™ä¸€é¡¹çš„è¯„åˆ†å®šä¸ºã€Œè¶…å‡ºæœŸå¾…ã€ï¼ 3.4. å…¶ä»– è¿åŠ¨æ–¹é¢ä¹å–„å¯é™ˆï¼Œç©¿è¶Šäº†ä¸€æ¬¡ä¸œè¥¿å†²æµ·å²¸çº¿ï¼Œæ¸¸äº†å‡ æ¬¡æ³³ï¼Œ12 æœˆåˆæ™¨è·‘äº†ä¸€å‘¨ä½†å› ä¸ºæ˜¯ç©ºè…¹è·‘ï¼Œ èƒƒç‚ç»™è·‘çŠ¯äº†ï¼Œå°±æ²¡å†è·‘äº†ã€‚ä½“é‡å…¨å¹´éƒ½åœ¨ 60kg æ³¢åŠ¨ï¼Œæ²¡å•¥å˜åŒ–ã€‚ ç»™æˆ‘è€çˆ¸å…¨æ¬¾ä¹°äº†æˆ‘ä»¬å…¨å®¶çš„ç¬¬ä¸€è¾†å°è½¿è½¦ï¼ˆè‡ªå·±æ²¡ä¹°ï¼Œä¸€æ˜¯å¤©å¤©ååœ°é“ç”¨ä¸åˆ°ï¼ŒäºŒæ˜¯æˆ‘å¯¹è½¦ä¹Ÿç¼ºä¹å…´è¶£ï¼‰ã€‚ è®¡åˆ’å¼€å§‹ç»™çˆ¶æ¯çº¦å¹´åº¦ä½“æ£€ï¼Œå¾…å®æ–½ã€‚ 3.5. æ€»ç»“ç”Ÿæ´»ä¸Šä»Šå¹´è¾¾æˆäº†è¿™ä¹ˆå¤šæœ‰æ„ä¹‰çš„æˆå°±ï¼ˆç¡®è¯Š ADHDã€å°†æ›´å¤šç²¾åŠ›èŠ±åœ¨å…³å¿ƒå®¶äººä¸Šã€å‚ä¸å…¬ç›Šæ´»åŠ¨ã€ç»™å®¶é‡Œä¹°è½¦ç­‰ç­‰ï¼‰ï¼Œæˆ‘ç»™è‡ªå·±çš„è¯„ä»·å½“ç„¶æ˜¯ã€Œä¼˜ç§€ã€ã€‚ ","date":"2023-12-31","objectID":"/posts/2023-summary/:3:3","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"æˆ‘çš„ 2023 - è®¤è¯†æ›´å¤šæœ‰è¶£çš„äººï¼Œè§è¯†æ›´å®½å¹¿çš„ä¸–ç•Œ","uri":"/posts/2023-summary/#32-å‚ä¸å…¬ç›Šæ´»åŠ¨"},{"categories":["life","tech"],"content":" 3. ç”Ÿæ´» 3.1. ç¡®è¯Š ADHD ä»¥åŠæ²»ç–—å‰æ–‡æäº†ï¼Œæˆ‘ä»Šå¹´ç¡®è¯Šäº† ADHDï¼Œè¿™æ˜¯æˆ‘ä»Šå¹´æœ€å¤§çš„æ”¶è·ä¹‹ä¸€ã€‚å®ƒè®©æˆ‘ææ˜ç™½äº†ï¼ŒåŸæ¥æˆ‘ä¸€ç›´å­˜åœ¨çš„æ³¨æ„åŠ›é—®é¢˜ï¼Œå¹¶ä¸æ˜¯ä»€ä¹ˆäººæ ¼ç¼ºé™·æˆ–è€…æ„å¿—åŠ›ä¸å¤Ÿï¼Œè€Œæ˜¯ä¸€ç§æœ‰æŒºå¤šäººéƒ½å­˜åœ¨çš„åŠŸèƒ½å¤±è°ƒï¼ˆdisorderï¼‰ï¼Œ å¯ä»¥é€šè¿‡è¯ç‰©ç­‰æ–¹å¼æ²»ç–—ç¼“è§£ã€‚ è€ƒè™‘åˆ° ADHD çš„é—ä¼ ç‰¹æ€§ï¼Œè·Ÿå¦¹å¦¹ã€çˆ¶æ¯ä¸€ç•ªæ²Ÿé€šåï¼Œå¸¦æˆ‘å¦¹æ¥æ·±åœ³çœ‹åŒ»ç”Ÿï¼Œç¡®è¯Šäº† ADHD ä»¥åŠæŠ‘éƒç—‡ã€‚è¯´çœŸçš„ï¼Œæˆ‘ä¸€ç›´çŸ¥é“æˆ‘å¦¹å¦¹æƒ…ç»ªæ¯”è¾ƒæ•æ„Ÿï¼Œä½†ä»æ²¡æƒ³è¿‡æ˜¯å› ä¸ºæŠ‘éƒç—‡ã€‚ è¿™ä¹‹åï¼Œé™¤äº†å·¥ä½œå¤–ï¼Œæˆ‘å¤§éƒ¨åˆ†çš„ç²¾åŠ›éƒ½èŠ±åœ¨äº†å…³å¿ƒå®¶äººã€è¿åŠ¨ã€å­¦ä¹ å¿ƒç†å­¦ç­‰äº‹æƒ…ä¸Šã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸æ˜æ˜¾çš„è½¬å˜ï¼Œæˆ‘è·Ÿæˆ‘å¦¹çš„å…³ç³»æ›´å¥½äº†ï¼Œå¦å¤–æŒç»­å¥½å‡ ä¸ªæœˆçš„æ²»ç–—è·Ÿæ¯ä¸ªæœˆå¸¦å¥¹åœ¨æ·±åœ³æ•£æ•£å¿ƒï¼Œå¥¹çš„æƒ…ç»ªä¹Ÿæœ‰äº†å¾ˆå¤§çš„æ”¹å–„ã€‚ 3.2. å‚ä¸å…¬ç›Šæ´»åŠ¨å› ç¼˜é™…ä¼šè·Ÿ @Manjusaka_Lee ä»¥åŠå¦ä¸€ä½æœ‹å‹èŠåˆ°äº†å…¬ç›Šï¼Œ å½“æ—¶åœ¨å·¥ä½œä¸Šç¼ºä¹åŠ¨åŠ›ï¼Œæƒ³åœ¨å…¶ä»–çš„äº‹æƒ…ä¸Šæ‰¾æ‰¾æ„Ÿè§‰ï¼Œå…¬ç›Šæœ¬èº«ä¹Ÿæ˜¯ä¸€ä»¶å¾ˆæœ‰æ„ä¹‰çš„äº‹æƒ…ï¼Œé‚£æ®µæ—¶é—´å­¦ä¹ äº†è§£äº†è®¸å¤šå…¬ç›Šèµ„æ–™ï¼Œå‚åŠ äº†ä¸€äº›å…¬ç›Šä¼šå±•ä¸ææ¬¾æ´»åŠ¨ï¼Œè¿˜ä¸€åº¦è€ƒè™‘åšå¿—æ„¿è€…ã€‚ ä»Šå¹´ç®—æ˜¯è¿ˆå‡ºäº†å‚ä¸å…¬ç›Šæ´»åŠ¨çš„ç¬¬ä¸€æ­¥ï¼Œè¿™æ‹“å±•äº†æˆ‘çš„è§†é‡ï¼Œè®©æˆ‘æ›´åŠ äº†è§£äº†ç¤¾ä¼šã€‚åœ¨å­¦ä¹ äº†è§£å…¬ç›ŠæœŸé—´ä¹Ÿç»“è¯†äº†ä¸€äº›å¿—åŒé“åˆçš„æœ‹å‹ï¼Œè¿™ä¹ŸæŒºç¬¦åˆæˆ‘å»å¹´ç»™è‡ªå·±çš„æœŸè®¸â€”â€”ã€Œè®¤è¯†æ›´å¤šæœ‰è¶£çš„äººï¼Œè§è¯†ä¸‹æ›´å®½å¹¿çš„ä¸–ç•Œã€ã€‚ åšäº‹æƒ…ï¼Œæœ€éš¾çš„å°±æ˜¯ä» 0 åˆ° 1ï¼Œå› æ­¤ä»Šå¹´çš„è¿™ä¸€è¿›å±•å°±æ˜¾å¾—å°¤ä¸ºå¯è´µï¼Œç§°å¾—ä¸Šæ˜¯ã€Œä¼˜ç§€ã€ã€‚ 3.3. é˜…è¯»ä¸å†™ä½œé¦–å…ˆæ˜¯æˆ‘ 2023 å¹´çš„è¯»ä¹¦è®°å½•ï¼š 2023-03-09 - The Moon and Sixpence ä½ æ˜¯è¦åœ°ä¸Šçš„å…­ä¾¿å£«ï¼Œè¿˜æ˜¯è¦å¤©ä¸Šçš„æœˆäº®ï¼Ÿ 2023-08-31 -How to Do Great Work - Paul Graham é»‘å®¢ä¸ç”»å®¶ä¸€ç¯‡ä¸¤ä¸‡å¤šå­—çš„é•¿æ–‡ï¼Œä¹Ÿç®—æ˜¯ä¸€æœ¬å°ä¹¦äº†å§ï¼Œå¹²è´§æ»¡æ»¡ã€‚ 2023-09-29 - ã€Šè¢«è®¨åŒçš„å‹‡æ°”ã€‹ ä¸€æœ¬é€šè¿‡å¯¹è¯çš„å½¢å¼è®²è¿°é˜¿å‹’å¾·å¿ƒç†å­¦çš„ä¹¦ï¼Œè¿™é—¨å¿ƒç†å­¦ä¸ç°ä»£ç§‘å­¦å¿ƒç†å­¦ä¸åŒï¼Œå®ƒæ›´åå‘å“²å­¦ã€‚ 2023-10-08 - ã€Šå«é­‚ï¼š1768 å¹´ä¸­å›½å¦–æœ¯å¤§ææ…Œã€‹ ä» 1768 å¹´çš„å«é­‚æ¡ˆå‡ºå‘ï¼Œåˆ†æäº†ä¹¾éš†æ—¶æœŸçš„ä¸­å›½ç¤¾ä¼šçš„è®¸å¤šæ–¹é¢ã€‚æ¯”å¦‚å› å„ç§åŸå› å¯¼è‡´äººå£è¿‡åº¦å¢é•¿ã€äººå‡èµ„æºå‡å°‘ã€ç¤¾ä¼šçŸ›ç›¾æ¿€åŒ–å¯¼è‡´çš„æ™®éææ…Œï¼Œä»¥åŠå®˜åƒšå›ä¸»åˆ¶çš„è¿ä½œæœºåˆ¶ã€å­˜åœ¨çš„é—®é¢˜ã€‚æ­¤ä¹¦ä»¥å²ä¸ºé‰´ï¼Œèƒ½å¸®åŠ©æˆ‘ä»¬ç†è§£ç°ä»£ä¸­å›½æ”¿æ²»ä¸ä¸­å›½ç¤¾ä¼šçš„ä¸€äº›åŸºæœ¬é—®é¢˜ã€‚ 2023-10-17 - ã€Šåˆ†å¿ƒä¸æ˜¯æˆ‘çš„é”™ã€‹ ä»‹ç» ADHD çš„ä¸€æœ¬ä¹¦ï¼Œåˆ—ä¸¾äº†å¾ˆå¤š ADHD æ¡ˆä¾‹ï¼Œä¹Ÿç»™å‡ºäº†è¯Šç–—å»ºè®®ï¼Œå¯¹æˆ‘ç›¸å½“æœ‰ç”¨ï¼ ä»¥åŠä¸€äº›æœªè¯»å®Œçš„ä¹¦ï¼š ã€Šè¿™æ‰æ˜¯å¿ƒç†å­¦ - çœ‹ç©¿ä¼ªç§‘å­¦çš„æ‰¹åˆ¤æ€§æ€ç»´ ç¬¬ 11 ç‰ˆã€‹ Psychology and Life, 20th edition, by Richard J. Gerrig The Great Gatsby - 10/41 ã€Šå¤æ‚ - æ¢…æ‹‰å°¼ ç±³æ­‡å°”ã€‹ Linux Device Driver Development - Second Edition: Linux é©±åŠ¨ç¼–ç¨‹å…¥é—¨ï¼Œ2022 å¹´å‡ºçš„æ–°ä¹¦ï¼ŒåŸºäº Linux 5.10ï¼Œamazon ä¸Šè¯„ä»·ä¸é”™ï¼Œç›®å‰åªæœ‰è‹±æ–‡ç‰ˆï¼Œå†™çš„å¾ˆå¥½ï¼Œå¯¹æ–°æ‰‹å¾ˆå‹å¥½ã€‚ 2023 å¹´æˆ‘è¯»çš„ä¹¦ç±æ•°é‡ä¸å¤šï¼Œæ²¡è¾¾æˆæ¯æœˆè¯»ä¸€æœ¬ä¹¦çš„ç›®æ ‡ã€‚è€Œå†™ä½œæ–¹é¢ï¼Œç®—ä¸Šè¿™ç¯‡æ€»ç»“ï¼Œä»Šå¹´æˆ‘ä¸€å…±å†™äº† 9 ç¯‡åšæ–‡ï¼Œä¹Ÿæ²¡è¾¾æˆæ¯æœˆå†™ä¸€ç¯‡çš„ç›®æ ‡ã€‚ ä½†é‰´äºæˆ‘ä»Šå¹´å†™äº†ä¸€æœ¬æŒºå—æ¬¢è¿çš„å°ä¹¦NixOS \u0026 Flakes Bookï¼Œå®ƒå¾—åˆ°äº† NixOS ç¤¾åŒºè¯¸å¤šå¥½è¯„ï¼Œè¿˜åœ¨ 10 æœˆä»½ä¸Šäº† Hacker News çƒ­æ¦œï¼Œç”šè‡³è¢«å®˜æ–¹æ–‡æ¡£nix.dev åˆ—å…¥æ¨èé˜…è¯»ï¼Œæˆ‘å§‘ä¸”å°†ä»Šå¹´ã€Œé˜…è¯»ä¸å†™ä½œã€è¿™ä¸€é¡¹çš„è¯„åˆ†å®šä¸ºã€Œè¶…å‡ºæœŸå¾…ã€ï¼ 3.4. å…¶ä»– è¿åŠ¨æ–¹é¢ä¹å–„å¯é™ˆï¼Œç©¿è¶Šäº†ä¸€æ¬¡ä¸œè¥¿å†²æµ·å²¸çº¿ï¼Œæ¸¸äº†å‡ æ¬¡æ³³ï¼Œ12 æœˆåˆæ™¨è·‘äº†ä¸€å‘¨ä½†å› ä¸ºæ˜¯ç©ºè…¹è·‘ï¼Œ èƒƒç‚ç»™è·‘çŠ¯äº†ï¼Œå°±æ²¡å†è·‘äº†ã€‚ä½“é‡å…¨å¹´éƒ½åœ¨ 60kg æ³¢åŠ¨ï¼Œæ²¡å•¥å˜åŒ–ã€‚ ç»™æˆ‘è€çˆ¸å…¨æ¬¾ä¹°äº†æˆ‘ä»¬å…¨å®¶çš„ç¬¬ä¸€è¾†å°è½¿è½¦ï¼ˆè‡ªå·±æ²¡ä¹°ï¼Œä¸€æ˜¯å¤©å¤©ååœ°é“ç”¨ä¸åˆ°ï¼ŒäºŒæ˜¯æˆ‘å¯¹è½¦ä¹Ÿç¼ºä¹å…´è¶£ï¼‰ã€‚ è®¡åˆ’å¼€å§‹ç»™çˆ¶æ¯çº¦å¹´åº¦ä½“æ£€ï¼Œå¾…å®æ–½ã€‚ 3.5. æ€»ç»“ç”Ÿæ´»ä¸Šä»Šå¹´è¾¾æˆäº†è¿™ä¹ˆå¤šæœ‰æ„ä¹‰çš„æˆå°±ï¼ˆç¡®è¯Š ADHDã€å°†æ›´å¤šç²¾åŠ›èŠ±åœ¨å…³å¿ƒå®¶äººä¸Šã€å‚ä¸å…¬ç›Šæ´»åŠ¨ã€ç»™å®¶é‡Œä¹°è½¦ç­‰ç­‰ï¼‰ï¼Œæˆ‘ç»™è‡ªå·±çš„è¯„ä»·å½“ç„¶æ˜¯ã€Œä¼˜ç§€ã€ã€‚ ","date":"2023-12-31","objectID":"/posts/2023-summary/:3:3","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"æˆ‘çš„ 2023 - è®¤è¯†æ›´å¤šæœ‰è¶£çš„äººï¼Œè§è¯†æ›´å®½å¹¿çš„ä¸–ç•Œ","uri":"/posts/2023-summary/#33-é˜…è¯»ä¸å†™ä½œ"},{"categories":["life","tech"],"content":" 3. ç”Ÿæ´» 3.1. ç¡®è¯Š ADHD ä»¥åŠæ²»ç–—å‰æ–‡æäº†ï¼Œæˆ‘ä»Šå¹´ç¡®è¯Šäº† ADHDï¼Œè¿™æ˜¯æˆ‘ä»Šå¹´æœ€å¤§çš„æ”¶è·ä¹‹ä¸€ã€‚å®ƒè®©æˆ‘ææ˜ç™½äº†ï¼ŒåŸæ¥æˆ‘ä¸€ç›´å­˜åœ¨çš„æ³¨æ„åŠ›é—®é¢˜ï¼Œå¹¶ä¸æ˜¯ä»€ä¹ˆäººæ ¼ç¼ºé™·æˆ–è€…æ„å¿—åŠ›ä¸å¤Ÿï¼Œè€Œæ˜¯ä¸€ç§æœ‰æŒºå¤šäººéƒ½å­˜åœ¨çš„åŠŸèƒ½å¤±è°ƒï¼ˆdisorderï¼‰ï¼Œ å¯ä»¥é€šè¿‡è¯ç‰©ç­‰æ–¹å¼æ²»ç–—ç¼“è§£ã€‚ è€ƒè™‘åˆ° ADHD çš„é—ä¼ ç‰¹æ€§ï¼Œè·Ÿå¦¹å¦¹ã€çˆ¶æ¯ä¸€ç•ªæ²Ÿé€šåï¼Œå¸¦æˆ‘å¦¹æ¥æ·±åœ³çœ‹åŒ»ç”Ÿï¼Œç¡®è¯Šäº† ADHD ä»¥åŠæŠ‘éƒç—‡ã€‚è¯´çœŸçš„ï¼Œæˆ‘ä¸€ç›´çŸ¥é“æˆ‘å¦¹å¦¹æƒ…ç»ªæ¯”è¾ƒæ•æ„Ÿï¼Œä½†ä»æ²¡æƒ³è¿‡æ˜¯å› ä¸ºæŠ‘éƒç—‡ã€‚ è¿™ä¹‹åï¼Œé™¤äº†å·¥ä½œå¤–ï¼Œæˆ‘å¤§éƒ¨åˆ†çš„ç²¾åŠ›éƒ½èŠ±åœ¨äº†å…³å¿ƒå®¶äººã€è¿åŠ¨ã€å­¦ä¹ å¿ƒç†å­¦ç­‰äº‹æƒ…ä¸Šã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸æ˜æ˜¾çš„è½¬å˜ï¼Œæˆ‘è·Ÿæˆ‘å¦¹çš„å…³ç³»æ›´å¥½äº†ï¼Œå¦å¤–æŒç»­å¥½å‡ ä¸ªæœˆçš„æ²»ç–—è·Ÿæ¯ä¸ªæœˆå¸¦å¥¹åœ¨æ·±åœ³æ•£æ•£å¿ƒï¼Œå¥¹çš„æƒ…ç»ªä¹Ÿæœ‰äº†å¾ˆå¤§çš„æ”¹å–„ã€‚ 3.2. å‚ä¸å…¬ç›Šæ´»åŠ¨å› ç¼˜é™…ä¼šè·Ÿ @Manjusaka_Lee ä»¥åŠå¦ä¸€ä½æœ‹å‹èŠåˆ°äº†å…¬ç›Šï¼Œ å½“æ—¶åœ¨å·¥ä½œä¸Šç¼ºä¹åŠ¨åŠ›ï¼Œæƒ³åœ¨å…¶ä»–çš„äº‹æƒ…ä¸Šæ‰¾æ‰¾æ„Ÿè§‰ï¼Œå…¬ç›Šæœ¬èº«ä¹Ÿæ˜¯ä¸€ä»¶å¾ˆæœ‰æ„ä¹‰çš„äº‹æƒ…ï¼Œé‚£æ®µæ—¶é—´å­¦ä¹ äº†è§£äº†è®¸å¤šå…¬ç›Šèµ„æ–™ï¼Œå‚åŠ äº†ä¸€äº›å…¬ç›Šä¼šå±•ä¸ææ¬¾æ´»åŠ¨ï¼Œè¿˜ä¸€åº¦è€ƒè™‘åšå¿—æ„¿è€…ã€‚ ä»Šå¹´ç®—æ˜¯è¿ˆå‡ºäº†å‚ä¸å…¬ç›Šæ´»åŠ¨çš„ç¬¬ä¸€æ­¥ï¼Œè¿™æ‹“å±•äº†æˆ‘çš„è§†é‡ï¼Œè®©æˆ‘æ›´åŠ äº†è§£äº†ç¤¾ä¼šã€‚åœ¨å­¦ä¹ äº†è§£å…¬ç›ŠæœŸé—´ä¹Ÿç»“è¯†äº†ä¸€äº›å¿—åŒé“åˆçš„æœ‹å‹ï¼Œè¿™ä¹ŸæŒºç¬¦åˆæˆ‘å»å¹´ç»™è‡ªå·±çš„æœŸè®¸â€”â€”ã€Œè®¤è¯†æ›´å¤šæœ‰è¶£çš„äººï¼Œè§è¯†ä¸‹æ›´å®½å¹¿çš„ä¸–ç•Œã€ã€‚ åšäº‹æƒ…ï¼Œæœ€éš¾çš„å°±æ˜¯ä» 0 åˆ° 1ï¼Œå› æ­¤ä»Šå¹´çš„è¿™ä¸€è¿›å±•å°±æ˜¾å¾—å°¤ä¸ºå¯è´µï¼Œç§°å¾—ä¸Šæ˜¯ã€Œä¼˜ç§€ã€ã€‚ 3.3. é˜…è¯»ä¸å†™ä½œé¦–å…ˆæ˜¯æˆ‘ 2023 å¹´çš„è¯»ä¹¦è®°å½•ï¼š 2023-03-09 - The Moon and Sixpence ä½ æ˜¯è¦åœ°ä¸Šçš„å…­ä¾¿å£«ï¼Œè¿˜æ˜¯è¦å¤©ä¸Šçš„æœˆäº®ï¼Ÿ 2023-08-31 -How to Do Great Work - Paul Graham é»‘å®¢ä¸ç”»å®¶ä¸€ç¯‡ä¸¤ä¸‡å¤šå­—çš„é•¿æ–‡ï¼Œä¹Ÿç®—æ˜¯ä¸€æœ¬å°ä¹¦äº†å§ï¼Œå¹²è´§æ»¡æ»¡ã€‚ 2023-09-29 - ã€Šè¢«è®¨åŒçš„å‹‡æ°”ã€‹ ä¸€æœ¬é€šè¿‡å¯¹è¯çš„å½¢å¼è®²è¿°é˜¿å‹’å¾·å¿ƒç†å­¦çš„ä¹¦ï¼Œè¿™é—¨å¿ƒç†å­¦ä¸ç°ä»£ç§‘å­¦å¿ƒç†å­¦ä¸åŒï¼Œå®ƒæ›´åå‘å“²å­¦ã€‚ 2023-10-08 - ã€Šå«é­‚ï¼š1768 å¹´ä¸­å›½å¦–æœ¯å¤§ææ…Œã€‹ ä» 1768 å¹´çš„å«é­‚æ¡ˆå‡ºå‘ï¼Œåˆ†æäº†ä¹¾éš†æ—¶æœŸçš„ä¸­å›½ç¤¾ä¼šçš„è®¸å¤šæ–¹é¢ã€‚æ¯”å¦‚å› å„ç§åŸå› å¯¼è‡´äººå£è¿‡åº¦å¢é•¿ã€äººå‡èµ„æºå‡å°‘ã€ç¤¾ä¼šçŸ›ç›¾æ¿€åŒ–å¯¼è‡´çš„æ™®éææ…Œï¼Œä»¥åŠå®˜åƒšå›ä¸»åˆ¶çš„è¿ä½œæœºåˆ¶ã€å­˜åœ¨çš„é—®é¢˜ã€‚æ­¤ä¹¦ä»¥å²ä¸ºé‰´ï¼Œèƒ½å¸®åŠ©æˆ‘ä»¬ç†è§£ç°ä»£ä¸­å›½æ”¿æ²»ä¸ä¸­å›½ç¤¾ä¼šçš„ä¸€äº›åŸºæœ¬é—®é¢˜ã€‚ 2023-10-17 - ã€Šåˆ†å¿ƒä¸æ˜¯æˆ‘çš„é”™ã€‹ ä»‹ç» ADHD çš„ä¸€æœ¬ä¹¦ï¼Œåˆ—ä¸¾äº†å¾ˆå¤š ADHD æ¡ˆä¾‹ï¼Œä¹Ÿç»™å‡ºäº†è¯Šç–—å»ºè®®ï¼Œå¯¹æˆ‘ç›¸å½“æœ‰ç”¨ï¼ ä»¥åŠä¸€äº›æœªè¯»å®Œçš„ä¹¦ï¼š ã€Šè¿™æ‰æ˜¯å¿ƒç†å­¦ - çœ‹ç©¿ä¼ªç§‘å­¦çš„æ‰¹åˆ¤æ€§æ€ç»´ ç¬¬ 11 ç‰ˆã€‹ Psychology and Life, 20th edition, by Richard J. Gerrig The Great Gatsby - 10/41 ã€Šå¤æ‚ - æ¢…æ‹‰å°¼ ç±³æ­‡å°”ã€‹ Linux Device Driver Development - Second Edition: Linux é©±åŠ¨ç¼–ç¨‹å…¥é—¨ï¼Œ2022 å¹´å‡ºçš„æ–°ä¹¦ï¼ŒåŸºäº Linux 5.10ï¼Œamazon ä¸Šè¯„ä»·ä¸é”™ï¼Œç›®å‰åªæœ‰è‹±æ–‡ç‰ˆï¼Œå†™çš„å¾ˆå¥½ï¼Œå¯¹æ–°æ‰‹å¾ˆå‹å¥½ã€‚ 2023 å¹´æˆ‘è¯»çš„ä¹¦ç±æ•°é‡ä¸å¤šï¼Œæ²¡è¾¾æˆæ¯æœˆè¯»ä¸€æœ¬ä¹¦çš„ç›®æ ‡ã€‚è€Œå†™ä½œæ–¹é¢ï¼Œç®—ä¸Šè¿™ç¯‡æ€»ç»“ï¼Œä»Šå¹´æˆ‘ä¸€å…±å†™äº† 9 ç¯‡åšæ–‡ï¼Œä¹Ÿæ²¡è¾¾æˆæ¯æœˆå†™ä¸€ç¯‡çš„ç›®æ ‡ã€‚ ä½†é‰´äºæˆ‘ä»Šå¹´å†™äº†ä¸€æœ¬æŒºå—æ¬¢è¿çš„å°ä¹¦NixOS \u0026 Flakes Bookï¼Œå®ƒå¾—åˆ°äº† NixOS ç¤¾åŒºè¯¸å¤šå¥½è¯„ï¼Œè¿˜åœ¨ 10 æœˆä»½ä¸Šäº† Hacker News çƒ­æ¦œï¼Œç”šè‡³è¢«å®˜æ–¹æ–‡æ¡£nix.dev åˆ—å…¥æ¨èé˜…è¯»ï¼Œæˆ‘å§‘ä¸”å°†ä»Šå¹´ã€Œé˜…è¯»ä¸å†™ä½œã€è¿™ä¸€é¡¹çš„è¯„åˆ†å®šä¸ºã€Œè¶…å‡ºæœŸå¾…ã€ï¼ 3.4. å…¶ä»– è¿åŠ¨æ–¹é¢ä¹å–„å¯é™ˆï¼Œç©¿è¶Šäº†ä¸€æ¬¡ä¸œè¥¿å†²æµ·å²¸çº¿ï¼Œæ¸¸äº†å‡ æ¬¡æ³³ï¼Œ12 æœˆåˆæ™¨è·‘äº†ä¸€å‘¨ä½†å› ä¸ºæ˜¯ç©ºè…¹è·‘ï¼Œ èƒƒç‚ç»™è·‘çŠ¯äº†ï¼Œå°±æ²¡å†è·‘äº†ã€‚ä½“é‡å…¨å¹´éƒ½åœ¨ 60kg æ³¢åŠ¨ï¼Œæ²¡å•¥å˜åŒ–ã€‚ ç»™æˆ‘è€çˆ¸å…¨æ¬¾ä¹°äº†æˆ‘ä»¬å…¨å®¶çš„ç¬¬ä¸€è¾†å°è½¿è½¦ï¼ˆè‡ªå·±æ²¡ä¹°ï¼Œä¸€æ˜¯å¤©å¤©ååœ°é“ç”¨ä¸åˆ°ï¼ŒäºŒæ˜¯æˆ‘å¯¹è½¦ä¹Ÿç¼ºä¹å…´è¶£ï¼‰ã€‚ è®¡åˆ’å¼€å§‹ç»™çˆ¶æ¯çº¦å¹´åº¦ä½“æ£€ï¼Œå¾…å®æ–½ã€‚ 3.5. æ€»ç»“ç”Ÿæ´»ä¸Šä»Šå¹´è¾¾æˆäº†è¿™ä¹ˆå¤šæœ‰æ„ä¹‰çš„æˆå°±ï¼ˆç¡®è¯Š ADHDã€å°†æ›´å¤šç²¾åŠ›èŠ±åœ¨å…³å¿ƒå®¶äººä¸Šã€å‚ä¸å…¬ç›Šæ´»åŠ¨ã€ç»™å®¶é‡Œä¹°è½¦ç­‰ç­‰ï¼‰ï¼Œæˆ‘ç»™è‡ªå·±çš„è¯„ä»·å½“ç„¶æ˜¯ã€Œä¼˜ç§€ã€ã€‚ ","date":"2023-12-31","objectID":"/posts/2023-summary/:3:3","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"æˆ‘çš„ 2023 - è®¤è¯†æ›´å¤šæœ‰è¶£çš„äººï¼Œè§è¯†æ›´å®½å¹¿çš„ä¸–ç•Œ","uri":"/posts/2023-summary/#34-å…¶ä»–"},{"categories":["life","tech"],"content":" 3. ç”Ÿæ´» 3.1. ç¡®è¯Š ADHD ä»¥åŠæ²»ç–—å‰æ–‡æäº†ï¼Œæˆ‘ä»Šå¹´ç¡®è¯Šäº† ADHDï¼Œè¿™æ˜¯æˆ‘ä»Šå¹´æœ€å¤§çš„æ”¶è·ä¹‹ä¸€ã€‚å®ƒè®©æˆ‘ææ˜ç™½äº†ï¼ŒåŸæ¥æˆ‘ä¸€ç›´å­˜åœ¨çš„æ³¨æ„åŠ›é—®é¢˜ï¼Œå¹¶ä¸æ˜¯ä»€ä¹ˆäººæ ¼ç¼ºé™·æˆ–è€…æ„å¿—åŠ›ä¸å¤Ÿï¼Œè€Œæ˜¯ä¸€ç§æœ‰æŒºå¤šäººéƒ½å­˜åœ¨çš„åŠŸèƒ½å¤±è°ƒï¼ˆdisorderï¼‰ï¼Œ å¯ä»¥é€šè¿‡è¯ç‰©ç­‰æ–¹å¼æ²»ç–—ç¼“è§£ã€‚ è€ƒè™‘åˆ° ADHD çš„é—ä¼ ç‰¹æ€§ï¼Œè·Ÿå¦¹å¦¹ã€çˆ¶æ¯ä¸€ç•ªæ²Ÿé€šåï¼Œå¸¦æˆ‘å¦¹æ¥æ·±åœ³çœ‹åŒ»ç”Ÿï¼Œç¡®è¯Šäº† ADHD ä»¥åŠæŠ‘éƒç—‡ã€‚è¯´çœŸçš„ï¼Œæˆ‘ä¸€ç›´çŸ¥é“æˆ‘å¦¹å¦¹æƒ…ç»ªæ¯”è¾ƒæ•æ„Ÿï¼Œä½†ä»æ²¡æƒ³è¿‡æ˜¯å› ä¸ºæŠ‘éƒç—‡ã€‚ è¿™ä¹‹åï¼Œé™¤äº†å·¥ä½œå¤–ï¼Œæˆ‘å¤§éƒ¨åˆ†çš„ç²¾åŠ›éƒ½èŠ±åœ¨äº†å…³å¿ƒå®¶äººã€è¿åŠ¨ã€å­¦ä¹ å¿ƒç†å­¦ç­‰äº‹æƒ…ä¸Šã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸æ˜æ˜¾çš„è½¬å˜ï¼Œæˆ‘è·Ÿæˆ‘å¦¹çš„å…³ç³»æ›´å¥½äº†ï¼Œå¦å¤–æŒç»­å¥½å‡ ä¸ªæœˆçš„æ²»ç–—è·Ÿæ¯ä¸ªæœˆå¸¦å¥¹åœ¨æ·±åœ³æ•£æ•£å¿ƒï¼Œå¥¹çš„æƒ…ç»ªä¹Ÿæœ‰äº†å¾ˆå¤§çš„æ”¹å–„ã€‚ 3.2. å‚ä¸å…¬ç›Šæ´»åŠ¨å› ç¼˜é™…ä¼šè·Ÿ @Manjusaka_Lee ä»¥åŠå¦ä¸€ä½æœ‹å‹èŠåˆ°äº†å…¬ç›Šï¼Œ å½“æ—¶åœ¨å·¥ä½œä¸Šç¼ºä¹åŠ¨åŠ›ï¼Œæƒ³åœ¨å…¶ä»–çš„äº‹æƒ…ä¸Šæ‰¾æ‰¾æ„Ÿè§‰ï¼Œå…¬ç›Šæœ¬èº«ä¹Ÿæ˜¯ä¸€ä»¶å¾ˆæœ‰æ„ä¹‰çš„äº‹æƒ…ï¼Œé‚£æ®µæ—¶é—´å­¦ä¹ äº†è§£äº†è®¸å¤šå…¬ç›Šèµ„æ–™ï¼Œå‚åŠ äº†ä¸€äº›å…¬ç›Šä¼šå±•ä¸ææ¬¾æ´»åŠ¨ï¼Œè¿˜ä¸€åº¦è€ƒè™‘åšå¿—æ„¿è€…ã€‚ ä»Šå¹´ç®—æ˜¯è¿ˆå‡ºäº†å‚ä¸å…¬ç›Šæ´»åŠ¨çš„ç¬¬ä¸€æ­¥ï¼Œè¿™æ‹“å±•äº†æˆ‘çš„è§†é‡ï¼Œè®©æˆ‘æ›´åŠ äº†è§£äº†ç¤¾ä¼šã€‚åœ¨å­¦ä¹ äº†è§£å…¬ç›ŠæœŸé—´ä¹Ÿç»“è¯†äº†ä¸€äº›å¿—åŒé“åˆçš„æœ‹å‹ï¼Œè¿™ä¹ŸæŒºç¬¦åˆæˆ‘å»å¹´ç»™è‡ªå·±çš„æœŸè®¸â€”â€”ã€Œè®¤è¯†æ›´å¤šæœ‰è¶£çš„äººï¼Œè§è¯†ä¸‹æ›´å®½å¹¿çš„ä¸–ç•Œã€ã€‚ åšäº‹æƒ…ï¼Œæœ€éš¾çš„å°±æ˜¯ä» 0 åˆ° 1ï¼Œå› æ­¤ä»Šå¹´çš„è¿™ä¸€è¿›å±•å°±æ˜¾å¾—å°¤ä¸ºå¯è´µï¼Œç§°å¾—ä¸Šæ˜¯ã€Œä¼˜ç§€ã€ã€‚ 3.3. é˜…è¯»ä¸å†™ä½œé¦–å…ˆæ˜¯æˆ‘ 2023 å¹´çš„è¯»ä¹¦è®°å½•ï¼š 2023-03-09 - The Moon and Sixpence ä½ æ˜¯è¦åœ°ä¸Šçš„å…­ä¾¿å£«ï¼Œè¿˜æ˜¯è¦å¤©ä¸Šçš„æœˆäº®ï¼Ÿ 2023-08-31 -How to Do Great Work - Paul Graham é»‘å®¢ä¸ç”»å®¶ä¸€ç¯‡ä¸¤ä¸‡å¤šå­—çš„é•¿æ–‡ï¼Œä¹Ÿç®—æ˜¯ä¸€æœ¬å°ä¹¦äº†å§ï¼Œå¹²è´§æ»¡æ»¡ã€‚ 2023-09-29 - ã€Šè¢«è®¨åŒçš„å‹‡æ°”ã€‹ ä¸€æœ¬é€šè¿‡å¯¹è¯çš„å½¢å¼è®²è¿°é˜¿å‹’å¾·å¿ƒç†å­¦çš„ä¹¦ï¼Œè¿™é—¨å¿ƒç†å­¦ä¸ç°ä»£ç§‘å­¦å¿ƒç†å­¦ä¸åŒï¼Œå®ƒæ›´åå‘å“²å­¦ã€‚ 2023-10-08 - ã€Šå«é­‚ï¼š1768 å¹´ä¸­å›½å¦–æœ¯å¤§ææ…Œã€‹ ä» 1768 å¹´çš„å«é­‚æ¡ˆå‡ºå‘ï¼Œåˆ†æäº†ä¹¾éš†æ—¶æœŸçš„ä¸­å›½ç¤¾ä¼šçš„è®¸å¤šæ–¹é¢ã€‚æ¯”å¦‚å› å„ç§åŸå› å¯¼è‡´äººå£è¿‡åº¦å¢é•¿ã€äººå‡èµ„æºå‡å°‘ã€ç¤¾ä¼šçŸ›ç›¾æ¿€åŒ–å¯¼è‡´çš„æ™®éææ…Œï¼Œä»¥åŠå®˜åƒšå›ä¸»åˆ¶çš„è¿ä½œæœºåˆ¶ã€å­˜åœ¨çš„é—®é¢˜ã€‚æ­¤ä¹¦ä»¥å²ä¸ºé‰´ï¼Œèƒ½å¸®åŠ©æˆ‘ä»¬ç†è§£ç°ä»£ä¸­å›½æ”¿æ²»ä¸ä¸­å›½ç¤¾ä¼šçš„ä¸€äº›åŸºæœ¬é—®é¢˜ã€‚ 2023-10-17 - ã€Šåˆ†å¿ƒä¸æ˜¯æˆ‘çš„é”™ã€‹ ä»‹ç» ADHD çš„ä¸€æœ¬ä¹¦ï¼Œåˆ—ä¸¾äº†å¾ˆå¤š ADHD æ¡ˆä¾‹ï¼Œä¹Ÿç»™å‡ºäº†è¯Šç–—å»ºè®®ï¼Œå¯¹æˆ‘ç›¸å½“æœ‰ç”¨ï¼ ä»¥åŠä¸€äº›æœªè¯»å®Œçš„ä¹¦ï¼š ã€Šè¿™æ‰æ˜¯å¿ƒç†å­¦ - çœ‹ç©¿ä¼ªç§‘å­¦çš„æ‰¹åˆ¤æ€§æ€ç»´ ç¬¬ 11 ç‰ˆã€‹ Psychology and Life, 20th edition, by Richard J. Gerrig The Great Gatsby - 10/41 ã€Šå¤æ‚ - æ¢…æ‹‰å°¼ ç±³æ­‡å°”ã€‹ Linux Device Driver Development - Second Edition: Linux é©±åŠ¨ç¼–ç¨‹å…¥é—¨ï¼Œ2022 å¹´å‡ºçš„æ–°ä¹¦ï¼ŒåŸºäº Linux 5.10ï¼Œamazon ä¸Šè¯„ä»·ä¸é”™ï¼Œç›®å‰åªæœ‰è‹±æ–‡ç‰ˆï¼Œå†™çš„å¾ˆå¥½ï¼Œå¯¹æ–°æ‰‹å¾ˆå‹å¥½ã€‚ 2023 å¹´æˆ‘è¯»çš„ä¹¦ç±æ•°é‡ä¸å¤šï¼Œæ²¡è¾¾æˆæ¯æœˆè¯»ä¸€æœ¬ä¹¦çš„ç›®æ ‡ã€‚è€Œå†™ä½œæ–¹é¢ï¼Œç®—ä¸Šè¿™ç¯‡æ€»ç»“ï¼Œä»Šå¹´æˆ‘ä¸€å…±å†™äº† 9 ç¯‡åšæ–‡ï¼Œä¹Ÿæ²¡è¾¾æˆæ¯æœˆå†™ä¸€ç¯‡çš„ç›®æ ‡ã€‚ ä½†é‰´äºæˆ‘ä»Šå¹´å†™äº†ä¸€æœ¬æŒºå—æ¬¢è¿çš„å°ä¹¦NixOS \u0026 Flakes Bookï¼Œå®ƒå¾—åˆ°äº† NixOS ç¤¾åŒºè¯¸å¤šå¥½è¯„ï¼Œè¿˜åœ¨ 10 æœˆä»½ä¸Šäº† Hacker News çƒ­æ¦œï¼Œç”šè‡³è¢«å®˜æ–¹æ–‡æ¡£nix.dev åˆ—å…¥æ¨èé˜…è¯»ï¼Œæˆ‘å§‘ä¸”å°†ä»Šå¹´ã€Œé˜…è¯»ä¸å†™ä½œã€è¿™ä¸€é¡¹çš„è¯„åˆ†å®šä¸ºã€Œè¶…å‡ºæœŸå¾…ã€ï¼ 3.4. å…¶ä»– è¿åŠ¨æ–¹é¢ä¹å–„å¯é™ˆï¼Œç©¿è¶Šäº†ä¸€æ¬¡ä¸œè¥¿å†²æµ·å²¸çº¿ï¼Œæ¸¸äº†å‡ æ¬¡æ³³ï¼Œ12 æœˆåˆæ™¨è·‘äº†ä¸€å‘¨ä½†å› ä¸ºæ˜¯ç©ºè…¹è·‘ï¼Œ èƒƒç‚ç»™è·‘çŠ¯äº†ï¼Œå°±æ²¡å†è·‘äº†ã€‚ä½“é‡å…¨å¹´éƒ½åœ¨ 60kg æ³¢åŠ¨ï¼Œæ²¡å•¥å˜åŒ–ã€‚ ç»™æˆ‘è€çˆ¸å…¨æ¬¾ä¹°äº†æˆ‘ä»¬å…¨å®¶çš„ç¬¬ä¸€è¾†å°è½¿è½¦ï¼ˆè‡ªå·±æ²¡ä¹°ï¼Œä¸€æ˜¯å¤©å¤©ååœ°é“ç”¨ä¸åˆ°ï¼ŒäºŒæ˜¯æˆ‘å¯¹è½¦ä¹Ÿç¼ºä¹å…´è¶£ï¼‰ã€‚ è®¡åˆ’å¼€å§‹ç»™çˆ¶æ¯çº¦å¹´åº¦ä½“æ£€ï¼Œå¾…å®æ–½ã€‚ 3.5. æ€»ç»“ç”Ÿæ´»ä¸Šä»Šå¹´è¾¾æˆäº†è¿™ä¹ˆå¤šæœ‰æ„ä¹‰çš„æˆå°±ï¼ˆç¡®è¯Š ADHDã€å°†æ›´å¤šç²¾åŠ›èŠ±åœ¨å…³å¿ƒå®¶äººä¸Šã€å‚ä¸å…¬ç›Šæ´»åŠ¨ã€ç»™å®¶é‡Œä¹°è½¦ç­‰ç­‰ï¼‰ï¼Œæˆ‘ç»™è‡ªå·±çš„è¯„ä»·å½“ç„¶æ˜¯ã€Œä¼˜ç§€ã€ã€‚ ","date":"2023-12-31","objectID":"/posts/2023-summary/:3:3","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"æˆ‘çš„ 2023 - è®¤è¯†æ›´å¤šæœ‰è¶£çš„äººï¼Œè§è¯†æ›´å®½å¹¿çš„ä¸–ç•Œ","uri":"/posts/2023-summary/#35-æ€»ç»“"},{"categories":["life","tech"],"content":" 4. å„ç§ç«™ç‚¹çš„ç»Ÿè®¡æ•°æ®é¦–å…ˆæ˜¯æˆ‘çš„åšå®¢ç«™ç‚¹ https://thiscute.world/ çš„ç»Ÿè®¡æ•°æ®ï¼š thiscute.world - 2023 å¹´ Google Analytics è®¿é—®ç»Ÿè®¡ thiscute.world - 2023 å¹´ Google Analytics è®¿é—®ç»Ÿè®¡ - æŒ‰å›½å®¶åˆ†ç±» thiscute.world - 2023 å¹´ Google Search ç»Ÿè®¡æ•°æ® å¦å¤–æ˜¯æˆ‘ä»Šå¹´ 6 æœˆä»½æ–°å»ºçš„ NixOS ç¬”è®°ç«™ç‚¹ https://nixos-and-flakes.thiscute.world çš„ç»Ÿè®¡æ•°æ®ï¼ˆå›½å¤–è¯»è€…ç›¸å½“å¤šï¼Œè¿™è·Ÿ stars ä»¥åŠæ”¶åˆ°çš„èµåŠ©æƒ…å†µä¹Ÿæ¯”è¾ƒåŒ¹é…ï¼‰ï¼š NixOS \u0026 Flakes Book - 2023 å¹´ Google Analytics è®¿é—®ç»Ÿè®¡ NixOS \u0026 Flakes Book - 2023 å¹´ Google Analytics è®¿é—®ç»Ÿè®¡ - æŒ‰å›½å®¶åˆ†ç±» NixOS \u0026 Flakes Book - 2023 å¹´ Google Search è®¿é—®ç»Ÿè®¡ ä»¥åŠä¸¤ä¸ªç«™ç‚¹å…¨å¹´åœ¨ Vercel ä¸Šçš„æµé‡ç»Ÿè®¡ï¼ˆæ„Ÿè°¢ Vercel æ¯ä¸ªæœˆçš„ 100G å…è´¹æµé‡ï¼Œç›®å‰çœ‹ç™½å«–é˜¶æ®µæµé‡è¿˜æœ‰æŒºå¤§å¢é•¿ç©ºé—´å“ˆå“ˆï¼‰ï¼š Vercel - 2023 å¹´æµé‡ç»Ÿè®¡ è¿˜æœ‰æ–‡ç« é˜…è¯»æ’è¡Œç»Ÿè®¡ï¼š 2023 å¹´æ–‡ç« é˜…è¯»æ’è¡Œ æ­¤å¤–ï¼Œæˆ‘ä»Šå¹´åœ¨ Twitter(X) ä¸Šæ¯”è¾ƒæ´»è·ƒï¼Œä¹Ÿæ–°å¢äº†ä¸å°‘ç²‰ä¸ï¼š 2023 å¹´ Twitter ç»Ÿè®¡æ•°æ® æœ€åï¼Œæ˜¯ä¸€äº›èµåŠ©å¹³å°ä¸Šæ”¶åˆ°çš„é›¶èŠ±é’±ç»Ÿè®¡ï¼š 2023 å¹´ buymeacoffee æ”¶å…¥ç»Ÿè®¡ 2023 å¹´ patreon æ”¶å…¥ç»Ÿè®¡ 2023 å¹´çˆ±å‘ç”µæ”¶å…¥ç»Ÿè®¡ å¦æœ‰åŠ å¯†è´§å¸ $50 æ²¡æœ‰å¥½çš„ç»Ÿè®¡é¡µé¢ï¼Œå°±ä¸æ”¾æˆªå›¾äº†ã€‚ä»¥åŠéƒ¨åˆ†å›½å¤–è¯»è€…å¸Œæœ›ä½¿ç”¨æˆ‘æœªä½¿ç”¨çš„æ”¯ä»˜æ–¹å¼èµåŠ©ï¼Œæˆ‘æ¯”è¾ƒæ‡’æ²¡æŠ˜è…¾äº†â€¦ ","date":"2023-12-31","objectID":"/posts/2023-summary/:3:4","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"æˆ‘çš„ 2023 - è®¤è¯†æ›´å¤šæœ‰è¶£çš„äººï¼Œè§è¯†æ›´å®½å¹¿çš„ä¸–ç•Œ","uri":"/posts/2023-summary/#4-å„ç§ç«™ç‚¹çš„ç»Ÿè®¡æ•°æ®"},{"categories":["life","tech"],"content":" 2024 å¹´å±•æœ›æˆ‘å½“ä¸‹å·¥ä½œç»´æŒç€ä¸é”™çš„çŠ¶æ€ï¼Œä¸šä½™å…´è¶£ä¸å‡ï¼Œç”Ÿæ´»ä¸Šä¹ŸæŒºæ»¡æ„ã€‚æ‰€ä»¥å…¶å®å¯¹æ˜å¹´åè€Œæ²¡å•¥ç‰¹åˆ«çš„æœŸæœ›ï¼Œä¿æŒç°åœ¨çš„çŠ¶æ€å°±æŒºå¥½çš„ï¼ˆè¿™å¤§æ¦‚å°±æ˜¯ã€Œç°å……ã€å§ emmmï¼‰ ä½†æ€»ä¸èƒ½å› ä¸ºè¿™ä¸ªå°±æ‘†çƒ‚ï¼Œè¿˜æ˜¯è¦ç»™è‡ªå·±å®šä¸€äº›ç›®æ ‡ï¼Œèƒ½å¦è¾¾æˆå°±çœ‹ç¼˜åˆ†äº†ã€‚ ","date":"2023-12-31","objectID":"/posts/2023-summary/:4:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"æˆ‘çš„ 2023 - è®¤è¯†æ›´å¤šæœ‰è¶£çš„äººï¼Œè§è¯†æ›´å®½å¹¿çš„ä¸–ç•Œ","uri":"/posts/2023-summary/#2024-å¹´å±•æœ›"},{"categories":["life","tech"],"content":" 1. ä¸šä½™æŠ€æœ¯éµå¾ªå…´è¶£ä¼˜å…ˆçš„åŸåˆ™ï¼Œç®€å•åˆ—ä¸€ä¸‹ï¼š 2023 å¹´ AIGC é£é€Ÿå‘å±•ï¼Œé¢„æœŸ 2024 å¹´å¾ˆå¤šæ–°å…´çš„ AIGC æŠ€æœ¯å°†ä¼šè½åœ°åˆ°å„ç§äº§å“ä¸­ï¼Œæˆ‘ä¹Ÿå¸Œæœ›èƒ½ç©ä¸€ç©ã€‚ä¸è¿‡è²Œä¼¼å·¥ä½œä¸Šå°±èƒ½ç©å¾—ä¸Šï¼Œæ‰€ä»¥å°±ä¸åˆ—åœ¨è¿™é‡Œäº† emmmm. 2023 å¹´æ—¢ç„¶æ„å¤–åœ°ç‚¹äº®äº† NixOS è·Ÿ Neovim è¿™ä¸¤é¡¹æŠ€èƒ½ç‚¹ï¼Œå¸Œæœ› 2024 å¹´èƒ½æ¥ç€æ·±å…¥å­¦ä¹ ä½¿ç”¨ NixOS ä»¥åŠå‚ä¸ç¤¾åŒºè´¡çŒ®ã€‚ æ“ä½œç³»ç»Ÿï¼ˆARM64 + RISCV64ï¼‰ 2022 å¹´çœ‹äº†ä¸€åŠã€ŠLinux/Unix ç³»ç»Ÿç¼–ç¨‹æ‰‹å†Œ - ä¸Šå†Œã€‹ï¼Œ2023 å…¨å¹´æ²¡åŠ¨è¿™æœ¬ä¹¦ï¼Œ2024 å¹´æ€»è¯¥çœ‹å®Œäº†å§â€¦ MIT6.S081 Operating System Engineering (Fall 2020) ä¹‹å‰å®šäº†ä¸ªç›®æ ‡å­¦ä¸€éä½†å®Œå…¨æ²¡å¼€å§‹ï¼Œ2024 å¹´ç»§ç»­â€¦ ï¼ˆä½ä¼˜å…ˆçº§ï¼‰2024 å¹´æœ‰æœºä¼šçš„è¯ç”¨ Rust è¯­è¨€æ•´ç‚¹æ´» ï¼ˆä½ä¼˜å…ˆçº§ï¼‰2024 å¹´åœ¨ EE ä¸åµŒå…¥å¼æ–¹é¢ï¼Œä¹Ÿå¸Œæœ›èƒ½æ›´æ·±å…¥äº›ï¼Œè®¾è®¡ä¸€ç‚¹è‡ªå·±çš„æ¿å­ç©ç©ï¼Œåšç‚¹æœ‰æ„æ€çš„ä¸œè¥¿ï¼Œæ¯”å¦‚æ— äººæœºå•Šã€æ™ºèƒ½æœºæ¢°è‡‚å•Šå•¥çš„ã€‚ æ€»ç»“ä¸‹ä¸»è¦å°±æ˜¯ä¸‰ä¸ªå­¦ä¹ ç›®æ ‡ï¼šï¼šææ AIGCã€å­¦å­¦æ“ä½œç³»ç»Ÿã€å°è¯•æ›´æ·±å…¥åœ°ä½¿ç”¨ NixOS ä»¥åŠå‚ä¸ç¤¾åŒºè´¡çŒ®. ","date":"2023-12-31","objectID":"/posts/2023-summary/:4:1","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"æˆ‘çš„ 2023 - è®¤è¯†æ›´å¤šæœ‰è¶£çš„äººï¼Œè§è¯†æ›´å®½å¹¿çš„ä¸–ç•Œ","uri":"/posts/2023-summary/#1-ä¸šä½™æŠ€æœ¯-1"},{"categories":["life","tech"],"content":" 2. ä¸šä½™ç”Ÿæ´»ç”Ÿæ´»ä¸Šï¼Œ2024 å¹´å¸Œæœ›èƒ½ï¼š é¦–å…ˆä»ç„¶æ˜¯æ¯å¹´å›ºå®šçš„ç›®æ ‡ï¼šæ¯æœˆè¯»ä¸€æœ¬ä¹¦ã€å†™ä¸€ç¯‡åšå®¢ã€‚ æ–°å¢çš„æ—…æ¸¸ç›®æ ‡ï¼šå¸¦å®¶äººè‡³å°‘å‡ºçœæ—…æ¸¸ä¸‰æ¬¡ã€‚ è¿åŠ¨ï¼š2023 å¹´æ„è¯†åˆ°äº†èº«ä½“å¥åº·çš„é‡è¦æ€§ï¼Œåœ¨ 2024 å¹´æƒ³å¤šå¤šè¿åŠ¨ï¼Œæ™¨è·‘å°±æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ï¼ˆä½†å¯åˆ«ç©ºè…¹æ™¨è·‘ï¼Œèƒƒç‚çŠ¯äº†å¾ˆéš¾å—ï¼‰ã€‚ å­¦å­¦å¿ƒç†å­¦ï¼šè¦å¾€ã€Œä¹…ç—…æˆåŒ»ã€çš„æ–¹å‘å‘å±•äº† emmmm. 2024 å¹´æƒ³å…¥é—¨ä¸ªå¿ƒç†å­¦ï¼Œå¸®æˆ‘æ›´å¥½åœ°ç…§é¡¾è‡ªå·±ã€å…³å¿ƒå®¶äººã€å¤„ç†äººé™…å…³ç³»ã€‚ éŸ³ä¹ï¼šä»Šå¹´ä¹°äº†ä¸ª Quest 3 VR å¤´æ˜¾ï¼Œå®ƒæœ‰ä¸ª AR å¼¹ç´çš„æ¸¸æˆæŒºä¸é”™ï¼Œå¸Œæœ› 2023 å¹´èƒ½å€Ÿæ­¤å­¦ä¼šäº›ç®€å•çš„é’¢ç´æ›²ã€‚ ","date":"2023-12-31","objectID":"/posts/2023-summary/:4:2","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"æˆ‘çš„ 2023 - è®¤è¯†æ›´å¤šæœ‰è¶£çš„äººï¼Œè§è¯†æ›´å®½å¹¿çš„ä¸–ç•Œ","uri":"/posts/2023-summary/#2-ä¸šä½™ç”Ÿæ´»"},{"categories":["life","tech"],"content":" 3. å·¥ä½œ è¿™éƒ¨åˆ†äº 2024-01-13 æ–°å¢ å…¶å®å…¨æ–‡å†™ä¸‹æ¥ï¼ŒåŸºæœ¬å®Œå…¨æ²¡æåˆ°æˆ‘ 2023 å¹´çš„ä¸»è¦å·¥ä½œã€‚ä¸»è¦è¿˜æ˜¯å› ä¸ºå‰é¢æåˆ°çš„ä¸€äº›å¿ƒæ€é—®é¢˜ï¼Œä»¥åŠå·¥ä½œéƒ¨åˆ†ç›¸å¯¹è€Œè¨€æ²¡é‚£ä¹ˆäº®çœ¼ï¼Œæ‰€ä»¥æ²¡æã€‚ ä½†æœ€è¿‘å¹´ç»ˆå˜›ï¼Œå›é¡¾äº†ä¸‹æˆ‘ 2023 å¹´ä¸‹åŠå¹´çš„å·¥ä½œï¼Œä¸»è¦æ˜¯åœ¨ infra å±‚é¢æ”¯æ’‘ AIGC å›¢é˜Ÿï¼ŒæœŸé—´å¼€å¼€å¿ƒå¿ƒåœ°æŠ˜è…¾äº†æŒºå¤š Nvidiaã€PyTorch ä¹‹ç±»çš„æ–°é²œä¸œè¥¿ï¼Œä¹Ÿæ‹¿åˆ°äº†ä¸é”™çš„æˆæœã€‚å¦ä¸€æ–¹é¢åˆäº†è§£åˆ°å·¥ä½œä¸Š 2024 å¹´æˆ‘ä¼šä¸ AIGC å›¢é˜Ÿæ›´æ·±å…¥åœ°åˆä½œï¼Œæ›´æ·±å…¥åœ°æŠ˜è…¾ AIGCã€Nvidia ç”Ÿæ€ã€Pytorch ç›¸å…³çš„ä¸œè¥¿ã€‚ç›®å‰æ„Ÿè§‰è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼Œæ‰€ä»¥æˆ‘å·¥ä½œä¸Šå§‘ä¸”ä¹Ÿç»™è‡ªå·±å®šä¸ªç›®æ ‡å§ï¼šæ—¢å­¦å­¦æ–°é²œçƒ­é—¨çš„ AIGC æ¶¨æ¶¨è§è¯†ï¼Œåˆå€Ÿæ­¤æ›´å¥½åœ°æ”¯æ’‘ AIGC å›¢é˜Ÿï¼ŒWin Win! ","date":"2023-12-31","objectID":"/posts/2023-summary/:4:3","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"æˆ‘çš„ 2023 - è®¤è¯†æ›´å¤šæœ‰è¶£çš„äººï¼Œè§è¯†æ›´å®½å¹¿çš„ä¸–ç•Œ","uri":"/posts/2023-summary/#3-å·¥ä½œ"},{"categories":["life","tech"],"content":" ç»“è¯­2022 å¹´çš„å¹´ç»ˆæ€»ç»“æ–‡æœ«ï¼Œæˆ‘ç»™è‡ªå·± 2023 å¹´çš„æœŸè®¸æ˜¯ã€Œè®¤è¯†æ›´å¤šæœ‰è¶£çš„äººï¼Œè§è¯†ä¸‹æ›´å®½å¹¿çš„ä¸–ç•Œã€ï¼Œæ„Ÿè§‰ç¡®å®åº”éªŒäº†ã€‚ç”±è¡·æ„Ÿè°¢åœ¨ 2023 å¹´ç»™æˆ‘å¸®åŠ©ä¸æ”¯æŒçš„äº²äººã€æœ‹å‹ã€åŒäº‹ï¼Œä»¥åŠåŠªåŠ›æ¢ç´¢æœªçŸ¥çš„æˆ‘è‡ªå·±ï¼ é‚£ä¹ˆåœ¨ 2024 å¹´ï¼Œæˆ‘å¸Œæœ›è‡ªå·±èƒ½å¤Ÿã€Œå·¥ä½œä¸ä¸šä½™çˆ±å¥½ä¸Šç¨³ä¸­æ±‚è¿›ï¼Œç”Ÿæ´»ä¸Šé”»ç‚¼å¥½èº«ä½“ã€å¤šå…³å¿ƒå®¶äººã€~ Carpe Diem. Seize The Day, Boys. Make Your Lives Extraordinary. â€“ ã€Šæ­»äº¡è¯—ç¤¾ã€‹ æ–‡æœ«æ¨èä¸€ä¸ªå¹´ç»ˆå›é¡¾ä¸å±•æœ›çš„å¸®åŠ©æ‰‹å†Œï¼Œæ„Ÿè§‰è®¾è®¡å¾—å¾ˆå¥½ï¼šhttps://yearcompass.com/cn/ ","date":"2023-12-31","objectID":"/posts/2023-summary/:5:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"æˆ‘çš„ 2023 - è®¤è¯†æ›´å¤šæœ‰è¶£çš„äººï¼Œè§è¯†æ›´å®½å¹¿çš„ä¸–ç•Œ","uri":"/posts/2023-summary/#ç»“è¯­"},{"categories":["life"],"content":" æœ¬æ–‡ç¨æœ‰ç‚¹é•¿ï¼Œæ¨èé…åˆæ­Œæ›²ã€Šå¤œç©ºä¸­æœ€äº®çš„æ˜Ÿâ€”â€”é€ƒè·‘è®¡åˆ’ã€‹é£Ÿç”¨ã€‚æˆ‘æ›¾åœ¨æ— æ•°ä¸ªç™½å¤©å¤œæ™šï¼Œå¬ç€è¿™é¦–æ­Œï¼Œæƒ³ç€è‡ªå·±çš„äººç”Ÿï¼Œä¹¦å†™æœ¬æ–‡æ—¶ä¹Ÿä¸ä¾‹å¤–ã€‚ 2023 å¹´ï¼ŒæŒ‰æˆ‘èƒ½é•¿å‘½ç™¾å²æ¥è®¡ç®—ï¼Œæˆ‘å·²ç»èµ°è¿‡äº†å››åˆ†ä¹‹ä¸€çš„äººç”Ÿè·¯ã€‚ å¦‚æœè¦æˆ‘ç”¨ä¸€å¥è¯æ€»ç»“æˆ‘è¿‡å»è¿™å››åˆ†ä¹‹ä¸€çš„äººç”Ÿï¼Œæˆ‘æƒ³ç”¨è¿™å¥è¯—å†åˆé€‚ä¸è¿‡äº†ï¼š ä¸¤å²¸çŒ¿å£°å•¼ä¸ä½ï¼Œè½»èˆŸå·²è¿‡ä¸‡é‡å±±ã€‚ æˆ‘æƒ³å¤§éƒ¨åˆ†äººå‰å››åˆ†ä¹‹ä¸€çš„äººç”Ÿï¼Œä¸»æ—‹å¾‹éƒ½æ˜¯æ±‚å­¦ï¼Œæˆ‘ä¹Ÿä¸ä¾‹å¤–ã€‚ æˆ‘çš„æ±‚å­¦ä¹‹è·¯å¹¶ä¸é¡ºåˆ©ï¼Œå°å­¦åˆä¸­æ—¶æˆ‘ä¸çŸ¥é“è‡ªå·±æƒ³è¦ä»€ä¹ˆï¼Œé«˜ä¸­æ—¶å‹åŠ›å¤ªå¤§å‡ ä¹é€€å­¦ï¼Œå¤§å­¦æ—¶æˆ‘åˆå› ä¸ºè‡ªå·±çš„é—®é¢˜æ— æ³•æ¯•ä¸šã€‚ä½†æ˜¯åœ¨å·¥ä½œåæˆ‘åè€Œé€æ¸å»ºç«‹èµ·äº†è‡ªä¿¡å¿ƒï¼Œå°±åƒæ˜¯çªç„¶è¿›å…¥äº†åº·åº„å¤§é“ã€‚ æœ€è¿‘æˆ‘åˆç»å†äº†è®¸å¤šï¼Œå—åˆ°äº†ä¸€äº›å¯å‘ï¼Œè§‰å¾—åˆ°äº†ä¸€ä¸ªåˆé€‚çš„æ—¶æœºï¼Œå› æ­¤å†™ä¸‹è¿™ç¯‡æ–‡ç« ï¼Œæ—¢æ˜¯è®°å½•æˆ‘çš„è¿‡å»ï¼Œä¹ŸåŒæ—¶æ€è€ƒä¸‹æœªæ¥çš„è·¯è¯¥æ€ä¹ˆèµ°ã€‚ è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯å†™ç»™æˆ‘è‡ªå·±çœ‹çš„ï¼Œä½†å¦‚æœä¹Ÿèƒ½å¸¦ç»™ä½ ä¸€äº›å¯å‘ï¼Œé‚£å°±å†å¥½ä¸è¿‡äº†ã€‚ ","date":"2023-08-19","objectID":"/posts/a-quarter-of-the-way-through-life/:0:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"ä¸¤å²¸çŒ¿å£°å•¼ä¸ä½ï¼Œè½»èˆŸå·²è¿‡ä¸‡é‡å±±â€”â€”æˆ‘çš„å››åˆ†ä¹‹ä¸€äººç”Ÿ","uri":"/posts/a-quarter-of-the-way-through-life/#"},{"categories":["life"],"content":" æˆ‘çš„é«˜ä¸­2015 å¹´ï¼Œæˆ‘é«˜ä¸‰ï¼Œé‚£æ—¶å€™æˆ‘æ˜¯ä¸€ä¸ªç§‘å¹»è¿·ï¼Œå¹¶ä¸”åˆšåˆšç»å†è¿‡ä¸€æ¬¡é€€å­¦é£æ³¢ã€‚ä¸ºä»€ä¹ˆä¼šé—¹å‡ºè¿™æ ·çš„äº‹æƒ…ï¼Ÿç®€å•çš„è¯´å°±æ˜¯å› ä¸ºæˆ‘æŠ—å‹èƒ½åŠ›å·®ï¼Œé«˜ä¸‰å·¨å¤§çš„å‹åŠ›å‹å¾—æˆ‘å–˜ä¸è¿‡æ°”æ¥ï¼Œæˆ‘æƒ³è¦é€ƒé¿ã€‚ å½“æ—¶ç­ä¸»ä»»æ‰¾æˆ‘è°ˆè¯ï¼Œæ€ä¹ˆåŠéƒ½åŠä¸åŠ¨æˆ‘ï¼ŒåŠä¸åŠ¨ä»–å°±å¼€å§‹éª‚ï¼ŒæŠŠæˆ‘éª‚ä¸ªç‹—è¡€æ·‹å¤´ï¼Œè¿™ä¸€éª‚æŠŠæˆ‘ç»™éª‚é†’äº†ï¼Œæˆ‘å› æ­¤å¾—ä»¥åšæŒåˆ°é«˜è€ƒç»“æŸã€‚è‡³ä»Šä»ç„¶ç›¸å½“æ„Ÿè°¢æˆ‘çš„ç­ä¸»ä»»ç‹è€å¸ˆï¼Œä»–éª‚é†’äº†æˆ‘ï¼Œè®©æˆ‘ä¸è‡³äºèµ°ä¸Šå¦ä¸€æ¡æ›´è‰°éš¾çš„è·¯ã€‚ ä½†æ˜¯å³ä½¿å¦‚æ­¤ï¼Œæˆ‘è¿˜æ˜¯æ²¡æœ‰ä»»ä½•åŠ¨åŠ›å»åšæŒå¤‡è€ƒã€‚å½“æ—¶æ•´ä¸ªç­çº§çš„å­¦ä¹ å¼ºåº¦éƒ½è¶Šæ¥è¶Šé«˜ï¼Œåªæœ‰æˆ‘ä»¿ä½›æ´»åœ¨å¦ä¸€ä¸ªä¸–ç•Œã€‚æ•´ä¸ªé«˜ä¸‰ä¸‹å­¦æœŸï¼Œåªæœ‰å„ç§è€ƒè¯•è·Ÿæµ‹éªŒæˆ‘ä¼šè®¤çœŸå®Œæˆï¼Œå…¶ä»–æ—¶é—´æˆ‘éƒ½åœ¨çœ‹å„ç§ä¸å­¦ä¹ æ— å…³çš„ä¹¦ã€‚ æˆ‘è¯»äº†å¾ˆå¤šçš„ä¹¦ã€‚ æˆ‘è¯»åˆ˜æ…ˆæ¬£çš„ã€Šä¸‰ä½“ã€‹ã€å±±ç”°æ­£çºªçš„ã€Šè‰¾è¾¾ã€‹ã€ä¿ç½—Â·å·´å¥‡åŠ å¢çš®çš„ã€Šå‘æ¡å¥³å­©ã€‹è·Ÿã€Šæ‹†èˆ¹å·¥ã€‹ã€ä»¥åŠã€Šç§‘å¹»ä¸–ç•Œã€‹ï¼Œæˆ‘è¯»å·ç«¯åº·æˆçš„ã€Šé›ªå›½ã€‹è·Ÿã€Šåƒåªé¹¤ã€‹ã€æ‘ä¸Šæ˜¥æ ‘çš„ã€Šå½“æˆ‘è°ˆè·‘æ­¥æ—¶æˆ‘è°ˆäº›ä»€ä¹ˆã€‹ï¼Œè¯»å¡å‹’å¾·Â·èƒ¡èµ›å°¼çš„ã€Šè¿½é£ç­çš„äººã€‹ã€é©¬å°”å…‹æ–¯çš„ã€Šç™¾å¹´å­¤ç‹¬ã€‹ï¼Œè¯»æ±Ÿå—çš„ã€Šé¾™æ—ã€‹ã€ä½™ç§‹é›¨çš„ã€Šä¸­å›½æˆå‰§å²ã€‹ã€‚å› ä¸ºå‹åŠ›å¤ªå¤§ï¼Œæˆ‘ç”šè‡³å¼€å§‹å¯¹å“²å­¦ã€ç¦…å®—æ„Ÿå…´è¶£ï¼Œæˆ‘è¯»äº†å¦™è‰å¶Â·èŠ­è´é‡Œçš„ã€ŠåˆºçŒ¬çš„ä¼˜é›…ã€‹ã€ä¹”æ–¯å¦Â·è´¾å¾·çš„ã€Šè‹è²çš„ä¸–ç•Œã€‹ï¼Œæˆ‘ç”šè‡³å¼€å§‹è¯»ã€Šå¿ƒä¹‹é“ã€‹ã€ã€Šå­¦ç¦…æ–¹ä¾¿è°­ã€‹ã€ã€Šæ–°ä¸–ç•Œ : çµæ€§çš„è§‰é†’ã€‹ã€‚ è¯»äº†æ‘ä¸Šæ˜¥æ ‘çš„ã€Šå½“æˆ‘è°ˆè·‘æ­¥æ—¶æˆ‘è°ˆäº›ä»€ä¹ˆã€‹åï¼Œæˆ‘å¼€å§‹æŠŠè·‘æ­¥å½“æˆä¸€ç§å®£æ³„å‹åŠ›çš„æ–¹å¼ï¼Œæˆ‘ç»å¸¸æ™šè‡ªä¹ æ—¶å·å·æºœå»æ“åœºè·‘æ­¥ã€‚è·‘äº†äº”åœˆã€ååœˆã€äºŒååœˆï¼Œè·‘åˆ°æ„Ÿè§‰è„šä¸‹åŠ›é‡åƒé’§ï¼Œå‘¼å¸ç«è¾£è¾£åœ°ç—›ï¼Œè¿™äº›ç—›è‹¦ä¸ä¸é€‚ï¼Œè®©æˆ‘å¿˜è®°äº†é«˜è€ƒçš„å‹åŠ›ã€‚ æˆ‘è¿˜å–œæ¬¢ä¸Šäº†çœ‹æ˜Ÿæ˜Ÿï¼Œç»å¸¸åœ¨æ™šä¸Šç†„ç¯åï¼Œå·å·çˆ¬ä¸Šå®¿èˆå¤©å°ï¼Œç”¨æ‰‹æœºçš„ã€Šæ˜Ÿå›¾ã€‹APPï¼Œå¯»æ‰¾å„ç§æ˜Ÿå®¿ã€å¯»æ‰¾ç‰›éƒç»‡å¥³ã€åŒ—æ–—ä¸ƒæ˜Ÿã€å¤§è§’æ˜Ÿã€çœ‹å¯è§å«æ˜Ÿè¿‡å¢ƒã€‚ æˆ‘è€ƒçš„æ˜¯ç†ç§‘ï¼Œé«˜è€ƒç»“æŸåï¼Œæˆ‘æ‹¿ç½‘ä¸Šçš„ç­”æ¡ˆéšä¾¿ä¼°äº†ä¸ªåˆ†ï¼Œå°½é‡å¾€ä½äº†ä¼°ï¼Œç®—å‡ºäºŒæœ¬éƒ½ä¸å¤Ÿçš„ã€‚ä½†è¿™ä¹Ÿæ²¡å•¥ï¼Œæˆ‘è‡ªè®¤åªèƒ½åšåˆ°è¿™ä¸ªç¨‹åº¦ï¼Œå½“æ—¶çš„æƒ³æ³•å°±æ˜¯å°½äººäº‹ï¼Œå¬å¤©å‘½ã€‚ ç„¶åæ˜¯æµ‘æµ‘å™©å™©åœ°ç­‰å¾…é«˜è€ƒæˆç»©ï¼Œä¸­é—´ä¹Ÿèƒ¡æ€ä¹±æƒ³è¿‡ä¸€äº›è¦ä¸è¦è€ƒè™‘å¤è¯»çš„é—®é¢˜ï¼Œä½†æœ€ç»ˆè¿˜æ˜¯å†³å®šä¸å¤è¯»äº†ï¼Œå› ä¸ºæˆ‘è§‰å¾—æˆ‘ä¸å¯èƒ½å†åšæŒä¸€å¹´äº†ã€‚ æˆ–è®¸æ˜¯å› ä¸ºæˆ‘å¿ƒæ€å¾ˆå¹³ç¨³ï¼ˆå¿ƒå¦‚æ­»ç°ï¼‰ï¼Œè€ƒè¯•æ—¶å‘æŒ¥å¾—å¾ˆå¥½ï¼Œæˆç»©å‡ºæ¥å±…ç„¶è¶…è¿‡äº†ä¸€æœ¬çº¿åå¤šåˆ†ã€‚ ä¹‹åå°±æ˜¯å¡«æŠ¥å¿—æ„¿äº†ï¼Œæˆ‘ä¸çŸ¥é“è‡ªå·±æƒ³å­¦ä»€ä¹ˆï¼Œå¯èƒ½æ˜¯ç”µå­ä¿¡æ¯ï¼Ÿæ¯•ç«Ÿæˆ‘å°æ—¶å€™æŒºå–œæ¬¢æ£é¼“å„ç§ç”µå­è®¾å¤‡ã€‚ å¶ç„¶æƒ³èµ·åœ¨å­¦æ ¡é˜…è§ˆå®¤è¯»æ‚å¿—æ—¶ï¼Œæ›¾è¢«ç§‘å¹»ä¸–ç•Œ 2013 å¹´ 12 æœŸé‡Œæ²–æ°æ­¦å½¦çš„ã€Šåœ¨å›å£°ä¸­é‡å†ã€‹ç»™æ‰“åŠ¨â€”â€”ç”¨è€³æœµã€Œçœ‹è§ã€ä¸–ç•Œå®åœ¨æ˜¯å¤ªå¥‡å¦™äº†ï¼Œæˆ‘å½“æ—¶ç—´ç—´åœ°å¹»æƒ³äº†å¥½å‡ å¤©ã€‚ è¿™æ ·æˆ‘å¼€å§‹è€ƒè™‘é€‰æ‹©å£°å­¦ã€‚ æˆ‘ä»é«˜ä¸­åŒæ¡Œæ¨èçš„ã€Šåˆ€å‰‘ç¥åŸŸã€‹å¼€å§‹æ¥è§¦æ—¥æœ¬çš„ ACG æ–‡åŒ–ï¼Œåæ¥æ¥è§¦åˆ°åˆéŸ³æœªæ¥å’Œæ´›å¤©ä¾ï¼Œå°±å¯¹æ­Œå£°åˆæˆ(singing synthesis)äº§ç”Ÿäº†å¾ˆå¤§çš„å…´è¶£ï¼Œä»”ç»†ä¸€æƒ³å‘ç°è¿™ä¹Ÿåº”è¯¥æ˜¯å£°å­¦çš„èŒƒç•´ï¼Œè¿™ä½¿æˆ‘åšå®šäº†æˆ‘é€‰æ‹©å£°å­¦çš„æƒ³æ³•ã€‚ å®¶é‡Œçˆ¶æ¯éƒ½æ²¡å­¦é—®ï¼Œä»–ä»¬çš„æ„è§å°±æ˜¯å¬æˆ‘çš„ï¼Œäºæ˜¯æˆ‘çš„ç¬¬ä¸€å¿—æ„¿å°±å¡«äº†å®‰å¾½å»ºç­‘å¤§å­¦çš„å£°å­¦ä¸“ä¸šã€‚ å£°å­¦æ˜¯ä¸€ä¸ªéå¸¸å†·é—¨çš„ä¸“ä¸šï¼Œæˆ‘å¾ˆé¡ºåˆ©åœ°è¢«å½•å–äº†ã€‚ å°±è¿™æ ·ï¼Œæˆ‘å¼€å§‹äº†æˆ‘é”™ä½çš„å¤§å­¦ç”Ÿæ´»ï¼Œå¹¶ä¸ºæˆ‘è‡ªå·±è‰ç‡çš„é€‰æ‹©ä»˜å‡ºäº†å·¨å¤§çš„ä»£ä»·ã€‚ ","date":"2023-08-19","objectID":"/posts/a-quarter-of-the-way-through-life/:1:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"ä¸¤å²¸çŒ¿å£°å•¼ä¸ä½ï¼Œè½»èˆŸå·²è¿‡ä¸‡é‡å±±â€”â€”æˆ‘çš„å››åˆ†ä¹‹ä¸€äººç”Ÿ","uri":"/posts/a-quarter-of-the-way-through-life/#æˆ‘çš„é«˜ä¸­"},{"categories":["life"],"content":" æˆ‘çš„å¤§å­¦æˆ‘å‡­ç€è‡ªå·±ç²—æµ…çš„æƒ³è±¡ä¸ä¸€æ—¶çƒ­è¡€ï¼Œå¡«æŠ¥äº†å£°å­¦ä¸“ä¸šï¼Œä½†ç°å®ä¸åŒäºæƒ³è±¡ï¼Œæˆ‘å‘ç°æˆ‘å¹¶ä¸å–œæ¬¢å£°å­¦ä¸“ä¸šã€‚ ä¸€å¼€å§‹ï¼Œåˆ°æ–°çš„å­¦æ ¡ï¼Œæˆ‘æ¥è§¦åˆ°çš„ä¸€åˆ‡éƒ½è®©æˆ‘è§‰å¾—è‡ªå·±å°±åƒæ˜¯åˆ˜å§¥å§¥è¿›å¤§è§‚å›­ï¼Œå¤„å¤„éƒ½æ˜¯æ–°é²œäº‹ç‰©â€”â€”å±±é‡Œçš„å­©å­å‡ºæ¥ï¼Œç¬¬ä¸€æ¬¡å‘ç°å¤§å®¶éƒ½åªè®²æ™®é€šè¯ï¼Œç¬¬ä¸€æ¬¡è§è¯†åˆ°å¹³åŸçš„å¹¿é˜”ï¼Œç¬¬ä¸€æ¬¡è§è¯†åˆ°åŸå¸‚çš„ç¹åï¼Œ ç¬¬ä¸€æ¬¡è§è¯†åˆ°å¤§å­¦çš„è‡ªç”±ã€‚ ä½†æ¸æ¸çš„é—®é¢˜å°±å˜å¾—æ˜æ˜¾äº†ï¼Œæˆ‘å‘ç°å­¦æ ¡æ•™æˆçš„å£°å­¦è¯¾ç¨‹ä¸æˆ‘æƒ³è±¡çš„å®Œå…¨ä¸åŒï¼Œæ•™çš„ä¸œè¥¿è·Ÿå£°å­¦æˆåƒã€å£°éŸ³åˆæˆå‡ ä¹æ¯«æ— å…³è”ï¼Œè€Œä¸”å¤§å­¦ä¹Ÿå¹¶æ²¡æœ‰æˆ‘æƒ³è±¡çš„é‚£èˆ¬ç¥åœ£æ— å¢ï¼Œå®ƒç…§æ ·å­˜åœ¨ç€å„ç§å„æ ·çš„é—®é¢˜ï¼ˆæ¯”å¦‚ä¸€äº›å½¢å¼ä¸»ä¹‰ã€ä¸€äº›æ°´è¯¾ï¼‰ã€‚å¦ä¸€æ–¹é¢æˆ‘åˆšè¿›å¤§å­¦æ—¶ï¼Œä¸ºäº†å¼¥è¡¥è‡ªå·±é«˜ä¸‰çš„é—æ†¾ï¼Œå¦‚åŒè‹¦è¡Œåƒ§ä¸€èˆ¬çš„å­¦ä¹ ï¼Œè€Œè¿™ç§çŠ¶æ€å®Œå…¨æ— æ³•æŒç»­ã€‚ æˆ‘å¾ˆå¿«å°±å‡ºäº†é—®é¢˜ï¼Œè¿™ä»æˆ‘ä»¥å‰å†™è¿‡çš„æ–‡ç« ä¸­å¯è§ä¸€æ–‘ï¼š 2017-03-07 - æˆ‘æ‚£ä¸Šäº†é˜…è¯»ç„¦è™‘ç—‡ 2017-02-06 - å¿½è€Œå‡æœ« å¦å¤–å¤§å­¦æœŸé—´æˆ‘è¿·ä¸Šäº†ç¼–ç¨‹ï¼Œå¼€å§‹è‡ªå­¦å„ç§ç¼–ç¨‹æŠ€æœ¯ï¼Œæœ€å¼€å§‹æ˜¯ Cï¼Œåæ¥æœ‰ä¸€æ¬¡å­¦æ ¡æ ¡å‹ã€åœ¨ç¾å›½å¸¸æ˜¥æ»•è¯»å¤©ä½“ç‰©ç†å­¦åšå£«çš„å­£ç´¢æ¸…å­¦é•¿ï¼ˆç°åœ¨å·²ç»æ˜¯ Professor of Astrophysics äº†ï¼‰å›æ ¡æ¼”è®²ï¼Œè°ˆåˆ°äº†ä»–ä»¬å®éªŒå®¤ç°åœ¨éƒ½ç”¨ Python äº†ï¼ŒMatlab éƒ½æ²¡äººç”¨äº†ï¼Œäºæ˜¯æˆ‘å¼€å§‹å­¦ä¹  Python. åæ¥åˆè·Ÿç€çŸ¥ä¹ä¸Šçš„æ¨èå­¦ä¹ è·¯çº¿å­¦ä¹ è¿‡ SICPã€Linux C ç¼–ç¨‹ç­‰å„ç§å†…å®¹ã€‚ å¤§å­¦å››å¹´ï¼Œå­¦æ ¡å¯¹æˆ‘å¸®åŠ©æœ€å¤§çš„ï¼Œä¸€æ˜¯è®©æˆ‘æ¥è§¦åˆ°äº†æ›´å¤§çš„ä¸–ç•Œï¼ŒäºŒæ˜¯å›¾ä¹¦é¦†è—ä¹¦ä¸°å¯Œï¼Œå°¤å…¶æ˜¯è®¡ç®—æœºç±»ä¹¦ç±ã€‚å››å¹´æ—¶é—´æˆ‘è¯»äº†å¾ˆå¤šå¾ˆå¤šçš„ä¹¦ï¼Œå­¦æ ¡çš„å›¾ä¹¦é¦†æˆäº†æˆ‘æœ€å–œæ¬¢çš„åœ°æ–¹ã€‚ ä½†æˆ‘å§‹ç»ˆæ— æ³•å¹³è¡¡å­¦ä¸šä¸ç¼–ç¨‹ï¼Œæˆ‘å¼€å§‹å½»åº•å¿½ç•¥å­¦ä¸šã€‚ é—®é¢˜æ„ˆæ¼”æ„ˆçƒˆï¼Œå¤§ä¸‰æ—¶æˆ‘å°è¯•è¿‡ç”³è¯·ä¼‘å­¦ï¼Œä½†æ˜¯åˆè¢«åŠä½äº†ã€‚åˆ°å¤§å››ä¸´è¿‘æ¯•ä¸šæ—¶ï¼Œæˆ‘å¿ƒç†é—®é¢˜å·²ç»ç›¸å½“ä¸¥é‡ã€‚å°¤å…¶å› ä¸ºæˆ‘æ€§æ ¼è¿˜æ¯”è¾ƒè½´ï¼Œè§‰å¾—è¿™ä¸ªä¸–ç•Œä¸åº”è¯¥æ˜¯è¿™æ ·çš„ï¼Œä¸æƒ³å­¦çš„è¯¾ç¨‹æˆ‘ä¸€ä¸ªå­—éƒ½ä¸æƒ³çœ‹ï¼Œç›¸å…³çš„è€ƒè¯•æˆ‘è¦ä¹ˆç¼ºè€ƒè¦ä¹ˆäº¤ç™½å·ã€‚ ç»“æœå°±æ˜¯æˆ‘å®Œå…¨æ— æ³•æ¯•ä¸šï¼Œè§‰å¾—å‰é€”ä¸€ç‰‡ç°æš—ï¼Œè§ä¸åˆ°ä»»ä½•å…‰äº®ï¼Œç”šè‡³æ„Ÿè§‰è‡ªå·±è¦å¾—æŠ‘éƒç—‡ï¼Œé‚£æ˜¯æˆ‘è¿™å››åˆ†ä¹‹ä¸€äººç”Ÿä¸­æœ€é»‘æš—çš„æ—¶æœŸã€‚ æŸå¤©è·Ÿåœ¨æ·±åœ³å·¥ä½œçš„åˆä¸­åŒå­¦èŠå¤©ï¼Œä»–è¯´åˆ°æ·±åœ³è¿™æ–¹é¢çš„å…¬å¸æŒºå¤šçš„ï¼Œå»ºè®®æˆ‘è€ƒè™‘ä¸‹ã€‚ äºæ˜¯æˆ‘ä¹°äº†å¼ ç«è½¦ç¥¨ç›´æ¥å°±å¥”å»äº†æ·±åœ³ï¼Œè¿˜å†™ä¸‹äº†é€ƒç¦»æˆ‘çš„å¤§å­¦ï¼Œç°åœ¨å›æƒ³èµ·æ¥ï¼Œå½“æ—¶çš„æƒ³æ³•å¤§æ¦‚æ˜¯ï¼Œã€Œåšä»€ä¹ˆéƒ½å¥½ï¼Œæ€»ä¹‹å†ä¹Ÿä¸æƒ³ç»§ç»­å¾…åœ¨è¿™ä¸ªå¯¹æˆ‘è€Œè¨€æš—æ— å¤©æ—¥çš„åœ°æ–¹äº†ã€‚ã€ åœ¨å­¦æ ¡çš„ç»å†è®©æˆ‘å¯¹å­¦æ ¡äº§ç”Ÿäº†æå¤§çš„åæ„Ÿï¼Œæˆ‘æ‹‰é»‘äº†å­¦æ ¡çš„æ‰€æœ‰è”ç³»æ–¹å¼ã€‚è¿™å®Œå…¨æ˜¯æˆ‘è‡ªå·±çš„é—®é¢˜ï¼Œ æˆ‘çš„å¯¼å‘˜å¯¹æˆ‘å¾ˆå¥½ï¼Œæˆ‘åœ¨å­¦æ ¡ä¹Ÿæœ‰è¿‡è®¸å¤šç¾å¥½çš„å›å¿†ï¼Œä½†æˆ‘å°±æ˜¯å¿ƒç†ä¸Šæ— æ³•æ¥å—å†è·Ÿè¿™ä¸ªåœ°æ–¹æœ‰ä»»ä½•è”ç³»ã€‚ å·¥ä½œåä¹Ÿæœ‰è¿‡å¾ˆå¤šæœ‹å‹è§‰å¾—æˆ‘åº”è¯¥å›å»æŠŠå­¦ä½æ‹¿äº†ï¼Œæ¯æ¬¡æˆ‘éƒ½ä¼šå›ç­”ï¼Œå¦‚æœèƒ½åšåˆ°æˆ‘ä¹Ÿæƒ³ï¼Œä½†æˆ‘çœŸçš„åšä¸åˆ°ï¼Œå†åœ¨å­¦æ ¡å‘†ä¸‹å»æˆ‘çœŸçš„è¦ç–¯æ‰äº†ã€‚è‡³ä»Šæˆ‘ä»ç„¶è§‰å¾—è¿™æ˜¯æˆ‘å½“åˆåšçš„æœ€æ­£ç¡®çš„å†³å®šã€‚ å¯¼å‘˜è”ç³»ä¸ä¸Šæˆ‘ï¼Œå°±è®©åŒå­¦ç»™æˆ‘ä¼ è¯ï¼Œåˆä¸ºæˆ‘ç€æƒ³ç»™æˆ‘åŠç†äº†å»¶æœŸï¼Œä½†åé¢çš„ä¸€å¹´æˆ‘ä¹Ÿä¸€é—¨ç½‘è¯¾éƒ½æ²¡å¬è¿‡ï¼Œåˆä¸€å¹´åï¼Œæˆ‘çš„å­¦å†çŠ¶æ€å°±å˜æˆäº†ç»“ä¸šã€‚ ","date":"2023-08-19","objectID":"/posts/a-quarter-of-the-way-through-life/:2:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"ä¸¤å²¸çŒ¿å£°å•¼ä¸ä½ï¼Œè½»èˆŸå·²è¿‡ä¸‡é‡å±±â€”â€”æˆ‘çš„å››åˆ†ä¹‹ä¸€äººç”Ÿ","uri":"/posts/a-quarter-of-the-way-through-life/#æˆ‘çš„å¤§å­¦"},{"categories":["life"],"content":" æˆ‘çš„æ‰“å·¥äººç”Ÿæ´»æˆ‘åˆä¸­åŒå­¦æ˜¯è¯»ä¹¦ä¸å¥½çš„é‚£ç§ï¼Œé«˜ä¸­å°±ç›´æ¥è¯»äº†æ­¦æœ¯å­¦æ ¡ï¼Œåœ¨æ·±åœ³æ•™è·†æ‹³é“ã€‚æˆ‘è·Ÿä»–ä¸€å¼ åºŠæŒ¤ç€ç¡äº†ä¸‰å¤©ï¼ˆå¾ˆæ„Ÿè°¢ä»–æ„¿æ„ä¸ºæˆ‘åšåˆ°è¿™ä¸ªç¨‹åº¦ï¼‰ï¼ŒæœŸé—´æŠ•äº†å‡ åä»½ç®€å†ã€‚ æˆ‘å¤§å­¦æ—¶è‡ªå­¦æ¶‰çŒè¿‡ Python Java Linuxï¼Œå› æ­¤åç«¯ã€è¿ç»´éƒ½æœ‰æŠ•ï¼Œä½†åªæ”¶åˆ°ä¸€å®¶ Python è‡ªåŠ¨åŒ–è¿ç»´çš„é¢è¯•é‚€è¯·ï¼Œé¢è¯•å¯¹æˆ‘è€Œè¨€éš¾åº¦ä¸é«˜ï¼Œå¾ˆè½»æ˜“å°±é€šè¿‡äº†ï¼Œè¿™å®¶å°åˆ›ä¸šå…¬å¸ä¹Ÿä¸çœ‹å­¦å†ã€‚ä¸çŸ¥è¯¥è¯´æ˜¯è¿æ°”å¥½è¿˜æ˜¯ä¸å¥½ï¼Œæˆ‘ä¹‹åå†ä¹Ÿæ²¡æ”¶åˆ°è¿‡ä»»ä½•é¢è¯•é‚€è¯·ã€‚ å°±è¿™æ ·ï¼Œæˆ‘å¼€å§‹äº†æˆ‘çš„æ‰“å·¥äººç”Ÿæ´»ã€‚ æˆ‘åœ¨ä¸Šå¤§å­¦æ—¶è™½ç„¶è‡ªå­¦äº†è®¸å¤šè®¡ç®—æœºä¸ç¼–ç¨‹çŸ¥è¯†ï¼Œä½†æ˜¯é‚£ä¸ªæ—¶å€™å…¨æ˜¯æˆ‘è‡ªå·±å•å¹²ï¼Œç°å®ä¸­å‡ ä¹æ²¡æ¥è§¦è¿‡å…¶ä»–åš IT çš„äººã€‚å¦ä¸€æ–¹é¢å¤§å­¦è¯»å¾—ä¸€å›¢ç³Ÿï¼Œå› æ­¤åˆšå·¥ä½œæ—¶æˆ‘ç›¸å½“ä¸è‡ªä¿¡ç”šè‡³å¯ä»¥è¯´æ˜¯è‡ªå‘ã€‚åœ¨å·¥ä½œåï¼Œæˆ‘å‘ç°å‘¨å›´éƒ½æ˜¯åŒæ ·åšæŠ€æœ¯çš„äººï¼Œè¿™ç§ä¸€èµ·è§£å†³æŠ€æœ¯é—®é¢˜ã€å®ŒæˆæŠ€æœ¯ç›®æ ‡çš„æ„Ÿè§‰æ˜¯æˆ‘ä»æœªä½“éªŒè¿‡çš„ï¼Œå¦ä¸€æ–¹é¢æˆ‘çš„å·¥ä½œæˆæœä¹Ÿè·å¾—äº†å¤§å®¶çš„è®¤å¯ï¼Œè¿™è®©æˆ‘åœ¨å·¥ä½œæœŸé—´ä¸€ç›´éå¸¸å¼€å¿ƒï¼ˆè™½ç„¶å·¥èµ„çœŸçš„ç›¸å½“ä½ï¼Œè€Œä¸”åŠ ç­å¾ˆä¸¥é‡ã€‚æ¯•ç«Ÿæˆ‘æ²¡å­¦å†ï¼Œå½“æ—¶èƒ½æ‰¾åˆ°ä¸ªå·¥ä½œéƒ½è°¢å¤©è°¢åœ°äº†ï¼‰ã€‚ åœ¨è¿™ç¬¬ä¸€ä»½æ­£å¼å·¥ä½œæœŸé—´ï¼Œæˆ‘å­¦ä¼šäº† Kubernetesã€Istioã€Dockerã€é˜¿é‡Œäº‘ã€Terraform/Pulumiã€Argo Workflows ç­‰äº‘åŸç”ŸæŠ€æœ¯ï¼ŒJenkins ç­‰è‡ªåŠ¨åŒ–è¿ç»´æŠ€æœ¯ï¼Œå†™äº†å¾ˆå¤š Python ä»£ç é”»ç‚¼äº†è‡ªå·±çš„ä»£ç èƒ½åŠ›ï¼Œè¿˜æŠ˜è…¾äº†æ´‹åƒåœ¾æœåŠ¡å™¨ã€ç»„è£…äº†å…¬å¸åŠå…¬ç”µè„‘ï¼Œå·¥ä½œèƒ½åŠ›ä¹Ÿå¾—åˆ°äº†é¢†å¯¼åŒäº‹çš„è®¤å¯ã€‚ æˆ‘å¾ˆæ„Ÿè°¢è¿™å®¶å…¬å¸ï¼Œå®ƒæ˜¯æˆ‘ IT ç”Ÿæ¶¯çš„èµ·ç‚¹ï¼Œåœ¨è¿™é‡Œæˆ‘å­¦åˆ°äº†ä»¤æˆ‘è¶³ä»¥åœ¨ IT è¡Œä¸šç«‹è¶³çš„æŠ€æœ¯ï¼Œä¹Ÿå»ºç«‹èµ·äº†æŠ€æœ¯è‡ªä¿¡ã€‚ä½†å®ƒç»™çš„å·¥èµ„å®åœ¨å¤ªä½äº†ï¼Œè¿˜åŠ ç­ä¸¥é‡ã€ç”»é¥¼å……é¥¥ï¼Œå¾ˆå¤šä¸œè¥¿éƒ½ä¸è§„èŒƒï¼Œå¤„å¤„é€éœ²ç€å°ä½œåŠçš„æ°”æ¯ï¼Œå› æ­¤åœ¨å·¥ä½œäº†ä¸€å¹´é›¶å…«ä¸ªæœˆåï¼Œæˆ‘å†³å®šç¦»èŒã€‚ ç¦»èŒåæˆ‘ä¼‘æ¯äº†ä¸€ä¸ªå¤šæœˆï¼Œç»™è‡ªå·±æ”¾äº†ä¸€ä¸ªé•¿å‡ï¼ŒæœŸé—´ä¹Ÿå†™äº†æˆ‘åœ¨åˆ›ä¸šå…¬å¸åšæŠ€æœ¯ä¸€å¹´å¤šçš„ä¸€ç‚¹ä½“ä¼š è·Ÿ è„šè¸å®åœ°ï¼Œä»°æœ›æ˜Ÿç©ºã€‚ç°åœ¨çœ‹æ¥ï¼Œå½“æ—¶è¿™äº›æ–‡ç« ä¹Ÿæ˜¯å†™å¾—çº¯çœŸåˆå¹¼ç¨šã€‚æˆ–è®¸å†è¿‡å‡ å¹´å›å¤´çœ‹ï¼Œæˆ‘ä¼šè§‰å¾—ç°åœ¨è¿™ç¯‡æ–‡ç« ä¹Ÿçº¯çœŸåˆå¹¼ç¨šï¼Ÿé‚£å°±å†å¥½ä¸è¿‡äº†â€”â€”æˆ‘å¯¹è¿™ä¸ªä¸–ç•Œçš„è®¤çŸ¥åˆæ›´æ­£ç¡®äº†ä¸€ç‚¹ï¼Œæˆ‘å¾—ä»¥å†æ¬¡ä¼˜åŒ–æŒ‡å¯¼æˆ‘è¡ŒåŠ¨çš„ã€Œäººç”Ÿæ¨¡å‹ã€ï¼Œé¿å…åœ¨æœªæ¥å› æ­¤é€ æˆæ›´å¤§çš„é—®é¢˜ï¼ˆç¬‘ ä¹‹åæˆ‘å¼€å§‹æ‰¾å·¥ä½œã€‚æˆ‘å½“æ—¶å¾ˆè‡ªä¿¡åœ°ï¼ˆå…¶å®ä¹Ÿæœ‰ç‚¹å¿å¿‘ï¼‰åœ¨ç®€å†ä¸Šå†™ä¸‹äº†ã€Œæœ¬äººå› å­¦åˆ†ä¸è¶³ï¼Œæœªèƒ½å–å¾—å­¦ä½ã€ï¼Œå®è¯è¯´ï¼Œè¿™å¥è¯å¸®æˆ‘çœå»äº†ä¸å°‘æ— æ„ä¹‰çš„æ²Ÿé€šï¼Œå¤§æ¦‚ 50% çš„å…¬å¸åœ¨ç¡®è®¤äº†æƒ…å†µåä¼šç›´æ¥å¿½ç•¥æˆ‘ã€‚å³ä½¿å¦‚æ­¤ï¼Œæˆ‘ä»ç„¶æ‹¿åˆ°å¥½å‡ ä»½ offerï¼Œä¹Ÿå¾—ä»¥è¿›å…¥ç°åœ¨è¿™å®¶å…¬å¸ï¼ŒèŒä½æ˜¯ SREã€‚ åœ¨æ–°å…¬å¸è¿™å‡ å¹´çš„ç»å†ç›¸å½“ä¸°å¯Œï¼Œæˆ‘ç®€å•æ€»ç»“å¦‚ä¸‹ï¼š 2021 å¹´ï¼š å¹´åˆçš„æœŸè®¸ï¼šæ‹†ç ´ç‰ç¬¼é£å½©å‡¤ï¼Œé¡¿å¼€é‡‘é”èµ°è›Ÿé¾™ã€‚ å·¥ä½œä¸Šæˆ‘çš„å·¥èµ„ç›¸æ¯”ä¹‹å‰ç¿»äº†æ•°å€ï¼Œå·¥ä½œç¯å¢ƒä¹Ÿå¥½äº†å¤ªå¤šã€‚åŒäº‹ä¸­ä¸ä¹ 985 211ã€æµ·å½’ç”šè‡³æ¸…åŒ—çš„å¤§ä½¬ï¼ˆåŒäº‹çš„ title å¯èƒ½ä»£è¡¨ä¸äº†ä»€ä¹ˆï¼Œä½†è¿™ç¡®å®è®©æˆ‘å¾ˆæœ‰æˆå°±æ„Ÿï¼‰ï¼Œè·Ÿä»–ä»¬å­¦åˆ°äº†è®¸å¤šä¸œè¥¿ï¼Œ ç†Ÿæ‚‰äº†å…¨æ–°çš„å·¥ä½œæ–‡åŒ–ï¼ˆOKR ç­‰ï¼‰ï¼Œæ¥è§¦åˆ°äº†æ‹¥æœ‰æ•°åƒä¸‡æ—¥æ´»ã€åå¤šä¸‡ QPS çš„äº‘ä¸Šç³»ç»Ÿæ¶æ„ï¼Œå¹¶ä¸”å®Œæˆäº†å…¶ä¸­æ ¸å¿ƒç»„ä»¶ K8s é›†ç¾¤çš„è¿ç»´å‡çº§å·¥ä½œï¼Œè·å¾—äº†è®¸å¤šç‰›é€¼åŒäº‹ä¸é¢†å¯¼å¯¹æˆ‘ä¸“ä¸šèƒ½åŠ›çš„è®¤å¯ã€‚ ä¸šä½™ç”Ÿæ´»ä¸Šè¢«åŒäº‹å¸¦ç€ç¬¬ä¸€æ¬¡æµ·è¾¹å†²æµªã€çƒ§çƒ¤ï¼Œåˆå¼€å§‹ç©è½®æ»‘ï¼Œè¿˜å­¦ä¸Šäº†æ³¡èŒ¶ã€‚ 2021 å¹´å¹´ç»ˆæ€»ç»“ 2022 å¹´ï¼š å¹´åˆçš„æœŸè®¸ï¼šæ›´ä¸Šä¸€å±‚æ¥¼ å·¥ä½œä¸Šä¸€æ˜¯é€šè¿‡äº†èŒçº§æ™‹å‡ï¼Œä¸å†æ˜¯ SRE èŒæ–°äº†ã€‚äºŒæ˜¯åœ¨æµé‡é“¾è·¯ä¸Šåšäº†å¾ˆå¤šå·¥ä½œï¼Œå¸®å…¬å¸çœäº†å¾ˆå¤šé’±ï¼Œè¿˜å› æ­¤æ‹¿äº†ä¸€ä¸ª Sï¼ˆå…¬å¸æœ€é«˜ç»©æ•ˆï¼‰ï¼Œå¹´ç»ˆå¥–ä¹Ÿå¾ˆä¸°åšã€‚ ä¸šä½™ç”Ÿæ´»ä¸Šåšå‡ºäº†æ›´å¤šçš„æ¢ç´¢ï¼Œå­¦äº†å¾ˆå¤šæ–°æŠ€æœ¯ï¼Œè®¤è¯†äº†å¾ˆå¤šæœ‰è¶£çš„äººï¼ˆ0xffff ç¤¾åŒºï¼‰ï¼Œè¿˜åšæŒå­¦äº†å¥½å‡ ä¸ªæœˆçš„è‹±è¯­ã€‚ 2022 å¹´å¹´ç»ˆæ€»ç»“ 2023 å¹´ï¼ˆè™½ç„¶è¿˜æ²¡è¿‡å®Œï¼‰ï¼š å¹´åˆçš„æœŸè®¸ï¼šè®¤è¯†æ›´å¤šæœ‰è¶£çš„äººï¼Œè§è¯†ä¸‹æ›´å®½å¹¿çš„ä¸–ç•Œ ä»Šå¹´åœ¨å·¥ä½œä¸Šæ²¡æœ‰åšå‡ºå¾ˆå¥½çš„æˆç»©ï¼Œé©¬é©¬è™è™ã€‚æˆ‘æ›´å¤šçš„æŠŠæ—¶é—´æŠ•å…¥åˆ°äº†ä¸šä½™çˆ±å¥½ä¸Šã€‚ ä¸šä½™ç”Ÿæ´»ä¸Šï¼Œæˆ‘åˆæŠ˜è…¾äº†è®¸å¤šæ–°æŠ€æœ¯ï¼ˆMCU å¼€å‘ã€å„ç§ ARM/RISCV å¼€å‘æ¿ã€Homelabã€NixOSï¼‰ï¼Œ å¹¶ä¸”å› æ­¤è®¤è¯†äº†è®¸å¤šåµŒå…¥å¼é¢†åŸŸçš„å¤§ä½¬ã€‚åœ¨æŠ˜è…¾ NixOS çš„è¿‡ç¨‹ä¸­æˆ‘åšçš„å¼€æºé¡¹ç›®ã€å…¥é—¨æŒ‡å—æ›´æ˜¯è·å¾—äº†å›½å†…å¤–ç¤¾åŒºçš„å¤§é‡å¥½è¯„ï¼Œè®¤è¯†äº†å¥½å‡ ä½å¤–å›½æœ‹å‹ï¼Œè¿˜æ”¶åˆ°äº†ä¸€äº›å¤–å›½è¯»è€…çš„æ‰“èµã€‚è¿™å®Œå…¨å¥‘åˆäº†æˆ‘å¹´åˆç»™è‡ªå·±çš„æœŸè®¸ã€‚ æˆ‘ä»Šå¹´å†™ NixOS å…¥é—¨æŒ‡å—çš„ç»å† ä¸¤ä»½å·¥ä½œï¼Œå››å¹´å¤šçš„æ—¶é—´ï¼Œæˆ‘çš„ç»å†å¾ˆéš¾é€šè¿‡ä¸Šé¢è¿™åªè¨€ç‰‡è¯­å°±å®Œå…¨æ¦‚æ‹¬ï¼Œä¸­é—´å½“ç„¶ä¹Ÿæœ‰è¿‡è®¸å¤šæŒ£æ‰ã€è¿·èŒ«ã€è®¸å¤šå¿ƒé…¸è‹¦è¾£ã€‚ä½†å°±å¾—åˆ°çš„ç»“æœæ¥è¯´ï¼Œåœ¨ç¬¬ä¸€å®¶å…¬å¸æˆ‘å­¦åˆ°äº†å¾ˆå¤šå¾ˆå¤šï¼Œæ¥ç€ä»è¿›å…¥æ–°å…¬å¸å¼€å§‹åˆ°ç°åœ¨ï¼Œæˆ‘æ¯ä¸€å¹´å¹´åˆç»™è‡ªå·±çš„æœŸè®¸ï¼Œä¹Ÿéƒ½èƒ½å¦‚çº¦å…‘ç°ã€‚ ç°åœ¨ï¼Œæˆ‘ç›¸ä¿¡åœ¨æ·±åœ³è¿™å››å¹´åªæ˜¯æˆ‘ä¸Šå‡æœŸçš„ç¬¬ä¸€æ­¥ï¼Œè¿™ä¸€æ­¥æˆ‘å®Œæˆäº†è‡ªä¿¡å¿ƒçš„æ„å»ºã€çœ¼ç•Œçš„å¼€æ‹“ã€åŸºç¡€æŠ€æœ¯èƒ½åŠ›çš„ç§¯ç´¯ï¼Œä¹Ÿæ”’ä¸‹äº†èƒ½è®©æˆ‘è¡£é£Ÿæ— å¿§å¥½å‡ å¹´çš„å°‘è®¸è´¢å¯Œï¼ˆå°±åœ¨ä»Šå¤©ï¼Œè¿˜ç»™æˆ‘çˆ¸å…¨æ¬¾ä¹°äº†å®¶é‡Œçš„ç¬¬ä¸€è¾†å°è½¿è½¦ï¼Œä¸€å®¶å­éƒ½å¾ˆå¼€å¿ƒï¼‰ã€‚ä¸‹ä¸€ä¸ªå››å¹´æˆ–è€…äº”å¹´ï¼Œæˆ‘ä¸€å®šèƒ½æ”¶è·æ›´å¤šï¼Œå°±åƒå‡ å¹´å‰æˆ‘ç¬¬ä¸€ä»½å·¥ä½œåˆšç»“æŸï¼Œå¥½æœ‹å‹ @Likenttt é€æˆ‘çš„è¯—ä¸€æ ·ï¼š æ‹†ç ´ç‰ç¬¼é£å½©å‡¤ï¼Œé¡¿å¼€é‡‘é”èµ°è›Ÿé¾™ã€‚ äººç”Ÿè¿˜å¾ˆé•¿ï¼Œæˆ‘æƒ³ä¸€ä¸ªé˜¶æ®µçš„å¤±è´¥ï¼Œå¯èƒ½åªæ˜¯åœ¨æå‰ä¼˜åŒ–æˆ‘å¯¹ä¸–ç•Œçš„è®¤çŸ¥ï¼Œå¸®æˆ‘æå‰å‘ç°å¹¶è§£å†³æˆ‘ã€Œäººç”Ÿæ¨¡å‹ã€ä¸­éšè—çš„é—®é¢˜ï¼Œä¸ºä¸‹ä¸€ä¸ªé˜¶æ®µçš„æˆåŠŸåšé“ºå«ã€‚ ","date":"2023-08-19","objectID":"/posts/a-quarter-of-the-way-through-life/:3:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"ä¸¤å²¸çŒ¿å£°å•¼ä¸ä½ï¼Œè½»èˆŸå·²è¿‡ä¸‡é‡å±±â€”â€”æˆ‘çš„å››åˆ†ä¹‹ä¸€äººç”Ÿ","uri":"/posts/a-quarter-of-the-way-through-life/#æˆ‘çš„æ‰“å·¥äººç”Ÿæ´»"},{"categories":["life"],"content":" æˆ‘çš„æœªæ¥æˆ‘è¿‡å»çš„è¿™å››åˆ†ä¹‹ä¸€äººç”Ÿï¼Œå¾ˆéš¾å¤åˆ»ï¼Œå…¶ä¸­æœ‰å¤ªå¤šçš„è½æ’ã€ç†æƒ³ä¸»ä¹‰è®©æˆ‘é¥±å°è‹¦æœï¼Œå…¶ä¸­çš„è½¬æŠ˜ç‚¹ä¹Ÿæœ‰è®¸å¤šè¿æ°”ä¸æœºé‡çš„æˆåˆ†ã€‚ä½†æˆ‘çš„æœªæ¥æ­£æ˜¯æ„å»ºåœ¨æ­¤ä¹‹ä¸Šã€‚ æœ‰çš„äººå–œæ¬¢ç¨³å®šï¼Œä½†å½“ä»Šå¤§ä¸–ï¼ŒAI é£é€Ÿå‘å±•ã€ä¸­ç¾æ‘©æ“¦ä¸æ–­ã€æ¬§æ´²ä¹Ÿå„ç§éš¾æ°‘ã€å…šäº‰é—®é¢˜ï¼Œå…¨ä¸–ç•Œéƒ½åœ¨å˜åŒ–ï¼ŒçœŸçš„æœ‰ä»€ä¹ˆç»å¯¹ç¨³å®šçš„ä¸œè¥¿å¯ä»¥ä¾é ä¹ˆï¼Ÿä¸–äº‹æ— å¸¸ï¼Œçº·ç¹å¤æ‚ï¼Œæˆ‘èƒ½åšçš„ï¼Œæ˜¯åœ¨æ¥å—è¿™ä»½æ— å¸¸çš„åŒæ—¶ï¼Œä»ç„¶èƒ½ç»´æŒè‡ªé©±åŠ›ï¼Œåœ¨è¿™ä¸ªä¸–ç•Œä¸­æ¢ç´¢å‡ºè‡ªå·±çš„ä¸€ç‰‡å¤©åœ°ã€‚ æœ€è¿‘åœ¨è‹æ´‹çš„æŠ˜è…¾ç¾¤ï¼Œä»å¤§å®¶çš„è‡ªæˆ‘ä»‹ç»é‡Œçœ‹åˆ°äº†å½¢å½¢è‰²è‰²çš„äººç”Ÿï¼Œå¹´é¾„ä» 20+ åˆ° 50+ï¼Œå­¦å†ä»é«˜ä¸­ä¸“ç§‘åˆ°åšå£«ï¼ŒèŒä¸šä»è½¯ç¡¬ä»¶åˆ°ç”µå·¥ã€ç¯å…‰å¸ˆã€å…¨èŒå…¬ç›Šäººã€è§è¯çº¸åª’ä½“æ¶ˆäº¡çš„ç”µè„‘æŠ¥å‰ç¼–è¾‘ï¼Œç”Ÿæ´»åœ°ç‚¹ä¹Ÿéå¸ƒå…¨çƒã€‚æˆ‘ç”šè‡³è¿˜å‘ç°æœ€è¿‘è·Ÿæˆ‘æ·±å…¥äº¤æµè¿‡ NixOS ç›¸å…³æŠ€æœ¯é—®é¢˜çš„ç¾¤å‹ï¼Œåœ¨åå¤šå¹´å‰å°±åšè¿‡æˆ‘å½“æ—¶ä½¿ç”¨æˆ–è€…æ¥è§¦è¿‡çš„äº§å“ï¼Œè€Œé‚£ä¸ªæ—¶å€™æˆ‘è¿˜åœ¨ä¸Šåˆä¸­ç”šè‡³å°å­¦ï¼Œè¿™è®©æˆ‘æ„Ÿåˆ°ååˆ†éœ‡æ’¼ã€‚å…¶ä¸­å¤§éƒ¨ç¾¤å‹çš„å¹´é¾„éƒ½æ¯”æˆ‘å¤§è®¸å¤šï¼Œä»–ä»¬çš„ç»å†ç»™äº†æˆ‘å¾ˆå¤§çš„å¯å‘ï¼Œè®©æˆ‘æ„è¯†åˆ°æˆ‘å¾€å 3/4 çš„äººç”Ÿè¿˜æœ‰å¾ˆå¤šçš„å¯èƒ½ã€‚ å¦å¤–éšç€æˆ‘è¿‘ä¸¤å¹´é€æ¸åœ¨è‡ªå·±çš„ä¸šä½™çˆ±å¥½ä¸Šæœ‰æ‰€å»ºæ ‘ï¼Œæˆ‘ä¹Ÿè¶Šæ¥è¶Šè§‰å¾—å·¥ä½œä½œä¸ºå…»å®¶ç³Šå£çš„æ‰‹æ®µï¼Œç¡®å®å¾ˆé‡è¦ï¼Œä½†å®ƒåªæ˜¯ç”Ÿæ´»çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨å·¥ä½œä¹‹å¤–æˆ‘è¿˜æœ‰è®¸å¤šå¯ä»¥åšçš„äº‹ã€‚ æˆ‘ä¸€ç›´åœ¨è·µè¡Œã€Œå…´è¶£æ˜¯æœ€å¥½çš„è€å¸ˆã€ï¼Œè™½ç„¶å› ä¸ºå¤ªè¿‡å…´è¶£é©±åŠ¨ä»¥åŠä¸€äº›å…¶ä»–åŸå› å¯¼è‡´æˆ‘å¤§å­¦è¯»å¾—æ¯”è¾ƒç³Ÿç³•ï¼Œä½†æ˜¯èƒ½è®©æˆ‘è¾¾æˆç°åœ¨çš„æˆå°±çš„åŒæ ·æ˜¯å…´è¶£ï¼Œè®©æˆ‘æœ€è¿‘å‡ ä¸ªæœˆæ¥è§¦ NixOS å¹¶ä¸”è·å¾—äº†ä¼—å¤šå¥½è¯„ä¸æ„Ÿè°¢çš„åŒæ ·æ˜¯å…´è¶£ã€‚æœ€è¿‘æœ‰æ¨å‹åˆ†äº«äº†ä¸€ç¯‡å¾ˆå®ç”¨çš„é•¿æ–‡How to Do Great Work - Paul Grahamï¼ˆä¸­è¯‘ã€å®ç”¨æŒ‡å—ã€‘Paul Graham ä¸¤ä¸‡å­—æ–°æ–‡ï¼šå¦‚ä½•å–å¾—æ°å‡ºæˆå°± ï¼‰ï¼Œ æˆ‘è¯»äº†ä¸ªå¼€å¤´ï¼Œè¿˜æ²¡çœ‹å®Œï¼Œä½†æ˜¯å‘è§‰å®ƒå¾ˆå¥‘åˆæˆ‘ï¼Œå®ƒä¸æˆ‘çš„ç»å†èƒ½ç›¸äº’å°è¯ï¼Œä¹Ÿå¯¹æˆ‘æœªæ¥çš„è¡ŒåŠ¨å¾ˆæœ‰æŒ‡å¯¼æ„ä¹‰ã€‚å…¶ä¸­æˆ‘ç›®å‰è¯»åˆ°å°è±¡æœ€æ·±åˆ»çš„ä¸€å¥è¯å°±æ˜¯ï¼š The three most powerful motives are curiosity, delight, and the desire to do something impressive. Sometimes they converge, and that combination is the most powerful of all. ä¸‰ä¸ªæœ€å¼ºå¤§çš„å†…åœ¨åŠ¨æœºæ˜¯å¥½å¥‡å¿ƒã€å¿«ä¹å’Œåšå‡ºä»¤äººå°è±¡æ·±åˆ»çš„äº‹æƒ…çš„æ¬²æœ›ï¼Œå½“å®ƒä»¬æ±‡èšåœ¨ä¸€èµ·æ—¶ï¼Œä¼šæˆä¸ºæœ€å¼ºå¤§çš„ç»„åˆã€‚ å†™è¿™ç¯‡æ–‡ç« èŠ±äº†æˆ‘ä¸€æ•´å¤©æ—¶é—´ï¼Œç¬¬äºŒå¤©æˆ‘åˆåšäº†ä¸å°‘ä¿®ä¿®è¡¥è¡¥çš„å·¥ä½œã€‚å†™ä½œæ—¶æˆ‘å›æƒ³äº†å¾ˆå¤šçš„ä¸œè¥¿ï¼Œä¹Ÿç¿»é˜…äº†æˆ‘è‡ªå·±è¿‡å¾€çš„å„ç§æ—¥è®°ã€éšç¬”ï¼Œå¾€äº‹å†å†åœ¨ç›®ã€‚ æˆ‘ç”šè‡³æœ‰ä¸€ç‚¹ä½¿å‘½æ„Ÿï¼Œèƒ½æ„Ÿè§‰åˆ°è¿™æ˜¯ä¸€ä»¶ç›¸å½“æœ‰æ„ä¹‰çš„äº‹æƒ…ã€‚ æ–‡ç« å†™å®Œåï¼Œæˆ‘åˆåå¤è¯»äº†å¥½å¤šéï¼Œè¶Šè¯»æˆ‘è¶Šå–œæ¬¢å®ƒï¼Œè§‰å¾—å®ƒä¼šæˆä¸ºæˆ‘çš„ä¸€ä¸ªäººç”Ÿé‡Œç¨‹ç¢‘ã€‚è¿™ä¸ªé‡Œç¨‹ç¢‘ä¸åªæœ‰çºªå¿µæ„ä¹‰ï¼Œå®ƒæ›´æ˜¯å¯¹æˆ‘æœªæ¥æ–¹å‘çš„æŒ‡å¼•ã€‚è¿ˆè¿‡è¿™ä¸ªé‡Œç¨‹ç¢‘ï¼Œæˆ‘å¯¹ä»æ—§æœªçŸ¥çš„æœªæ¥ï¼Œæœ‰äº†æ›´å¤šçš„æœŸå¾…ã€‚ ","date":"2023-08-19","objectID":"/posts/a-quarter-of-the-way-through-life/:4:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"ä¸¤å²¸çŒ¿å£°å•¼ä¸ä½ï¼Œè½»èˆŸå·²è¿‡ä¸‡é‡å±±â€”â€”æˆ‘çš„å››åˆ†ä¹‹ä¸€äººç”Ÿ","uri":"/posts/a-quarter-of-the-way-through-life/#æˆ‘çš„æœªæ¥"},{"categories":["life"],"content":" åè®°å› ç€ä»Šå¤©å‘ç°æˆ‘è®¤è¯†çš„ç½‘å‹ä¸­å°±æœ‰äººåœ¨æ·±åœ³åšäº†å¤šå¹´å…¨èŒå…¬ç›Šäººï¼Œæˆ‘æƒ³èµ·äº†å»å¹´ 8 æœˆä»½çœ‹è¿‡çš„ã€Šåœ¨å³¡æ±Ÿçš„è½¬å¼¯å¤„â€”â€”é™ˆè¡Œç”²äººç”Ÿç¬”è®°ã€‹ï¼Œä½œè€…ç°åœ¨ä¹Ÿåœ¨æ·±åœ³åšå…¬ç›Šã€‚æˆ‘åˆæŠŠä¹¦ç¿»å‡ºæ¥ç•¥è¯»äº†ä¸€éï¼Œå¾ˆæœ‰äº›æ„Ÿè§¦ã€‚ å¶å°”å›å¿†èµ·è‡ªå·±å½“åˆçš„è‡ªå‘ã€è¿·èŒ«ã€æŒ£æ‰ï¼Œæˆ‘ä¼šæ„è¯†åˆ°ç°åœ¨çš„æˆ‘è™½ç„¶ä¸å†è‡ªå‘ï¼Œä½†ä»ç„¶ä¼šè¿·èŒ«ã€æŒ£æ‰ï¼Œ æ€€ç–‘è‡ªå·±çš„æƒ³æ³•æ˜¯å¦æ­£ç¡®ã€‚ä½†æˆ‘ä¸è§‰å¾—è¿™æ˜¯åäº‹ï¼Œè¿™æ­£è¯´æ˜æˆ‘èµ°åœ¨äº†æ­£ç¡®çš„è·¯ä¸Šã€‚ç»å¸¸ä¼šæœ‰äººè¯´è¦ã€Œèµ°å‡ºèˆ’é€‚åŒºã€ï¼Œæœ‰è¿™ç§è¿·èŒ«ã€æŒ£æ‰çš„æ„Ÿè§‰ï¼Œè¯´æ˜æˆ‘æ­£åœ¨è¿™ä¹ˆåšã€‚ æ­£å› ä¸ºæ›¾ç»ç»å†è¿‡äººç”Ÿçš„ç°æš—æ—¶åˆ»ï¼Œæ‰€ä»¥æˆ‘æ›´å¸Œæœ›è‡ªå·±èƒ½è®°ä½ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯çˆ±çš„ä¸–ç•Œï¼Œè¿™æ­£æ˜¯æˆ‘åšå®¢åŸŸå thiscute.world çš„ç”±æ¥ï¼Œä»Šåæˆ‘ä¹Ÿä¼šç‰¢è®°è¿™ä¸€ç‚¹ã€‚ å…¶å®è¿™æ®µäººç”Ÿæ˜¯æœ€ç¾å¥½çš„ï¼Œä»¥åå¯èƒ½æ²¡æœ‰è¿™ä¹ˆå¥½çš„æ—¥å­äº†ã€‚ â€”â€” v2ex ç½‘å‹çš„è¯„è®ºï¼Œç•™åšè­¦ç¤ºã€‚æœ€è¿‘å‡ å¹´è¿‡å¾—ä¸€å¸†é£é¡ºï¼Œæˆ‘ç¡®å®æ˜¯æœ‰ç‚¹é£˜äº†ï¼Œåº”è¯¥ã€Œå±…å®‰æ€å±ã€ã€‚ æ–‡ç« çš„æœ€åï¼Œæˆ‘æƒ³æˆ‘åº”è¯¥å†æ¬¡æ„Ÿè°¢ï¼Œæ„Ÿè°¢è¿™ä¸€è·¯èµ°æ¥ï¼Œå¸®åŠ©è¿‡æˆ‘çš„è€å¸ˆã€åŒå­¦ã€æœ‹å‹ï¼Œè®¤å¯æˆ‘å·¥ä½œçš„åŒäº‹è·Ÿé¢†å¯¼ï¼Œé¼“åŠ±è¿‡æˆ‘çš„å®¶äººã€æœ‹å‹ã€ç½‘å‹ï¼Œæ„Ÿè°¢ä½ ä»¬ï¼æ²¡æœ‰ä½ ä»¬ï¼Œæˆ‘å¯èƒ½æ—©å°±è¿·å¤±äº†æ–¹å‘ï¼Œæ›´ä¸ä¼šæœ‰ç°åœ¨çš„æˆç»©äº†ã€‚ å››å¹´å¤šå‰ï¼Œæˆ‘ä»å­¦æ ¡ä¸è¾è€Œåˆ«ï¼Œæˆ‘æ¬ æˆ‘çš„å¯¼å‘˜åœ†åœ†å§ä¸€ä¸ªé“æ­‰ï¼Œä¸€ä»½æ„Ÿè°¢ï¼Œä¸€ä¸ªäº¤ä»£ã€‚è¿™æ¬¡ï¼Œæˆ‘ä¹Ÿä¼šä¸€å¹¶è¡¥ä¸Šå·²ç»è¡¥ä¸Šäº†ï¼š äººæ˜¯ç¤¾ä¼šæ€§åŠ¨ç‰©ï¼Œæˆ‘ä»¬äº’ç›¸æˆå°±ã€‚æˆ‘ä»Šåä¹Ÿä¼šäº‰å–äº¤åˆ°æ›´å¤šæœ‰è¶£çš„æœ‹å‹ï¼Œè®¤è¯†æ›´å¤šæœ‰è¶£çš„äººï¼Œè§è¯†è¿™ä¸ªå®½å¹¿ã€å¯çˆ±çš„ä¸–ç•Œã€‚ ","date":"2023-08-19","objectID":"/posts/a-quarter-of-the-way-through-life/:5:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"ä¸¤å²¸çŒ¿å£°å•¼ä¸ä½ï¼Œè½»èˆŸå·²è¿‡ä¸‡é‡å±±â€”â€”æˆ‘çš„å››åˆ†ä¹‹ä¸€äººç”Ÿ","uri":"/posts/a-quarter-of-the-way-through-life/#åè®°"},{"categories":["life"],"content":" è¯„è®ºåŒºæˆ‘ä¹Ÿåœ¨å…¶ä»–å¹³å°åˆ†äº«äº†è¿™ç¯‡æ–‡ç« ï¼Œå…¶ä¸­è¯„è®ºæœ‰äº›ä¸ç¤¼è²Œçš„ judgeï¼ˆç›´æ¥æ— è§†æ‰å°±å¥½ï¼Œæœ‰çš„äººè¿™è¾ˆå­ä¹Ÿå°±å‰©è¿™ç‚¹ä¸œè¥¿äº†ï¼‰ï¼Œä½†ä¹Ÿä¸ä¹å¥½çš„å†…å®¹ã€‚å…¶ä¸­è®¸å¤šçš„ç•™è¨€ç›¸å½“æ²»æ„ˆï¼Œè®©äººå¿ƒé‡Œæš–æš–çš„ï¼Œæœ‰äº›ç•™è¨€è®©æˆ‘ä¼šå¿ƒä¸€ç¬‘ï¼Œè¿™äº›å†…å®¹éƒ½è®©æˆ‘è§‰å¾—ï¼Œèƒ½å¤ŸæŠŠæ–‡ç« åˆ†äº«åˆ°è¿™äº›å¹³å°ï¼Œè®©å¤§å®¶çœ‹åˆ°ï¼ŒçœŸçš„æ˜¯å¤ªå¥½äº†ï¼åœ¨è·Ÿè¯„è®ºåŒºä¸€äº›æœ‹å‹äº¤æµæ—¶ï¼Œä¹Ÿç¢°æ’å‡ºäº†è®¸å¤šæ€æƒ³çš„ç«èŠ±ï¼Œè¿™ä¹Ÿè®©æˆ‘ç›¸å½“å¼€å¿ƒã€‚ ä¸ºç€è®©å¤§å®¶éƒ½èƒ½çœ‹åˆ°å…¶ä¸­å¥½çš„å†…å®¹ï¼Œæˆ‘æŠŠå®ƒä»¬éƒ½åˆ—åœ¨è¿™é‡Œã€‚ 0xffff ç¤¾åŒº: 0xffff è¯„è®ºåŒºçœŸçš„æœ‰å¾ˆå¤šçœŸçŸ¥ç¼è§ï¼Œå¼ºçƒˆæ¨èä¸€è¯»ï¼ v2ex: æœ‰äº›å¾ˆæ²»æ„ˆçš„è¯„è®ºï¼Œä¹Ÿæœ‰ä¸ªåˆ«ä¸å¥½çš„ï¼Œæˆ‘è§‰å¾—è¿™äº›è¯„è®ºéƒ½æŒºæœ‰æ„æ€ã€‚ åšå®¢å›­ å…³äºè¿™äº›ä¸å¥½çš„è¯„è®ºï¼ˆè­¬å¦‚ v2ex ä¸Šæœ‰äººè¯„è®ºæˆ‘æ˜¯åœ¨ã€Œæ— ç—…å‘»åŸã€ï¼Œè¿˜æŒºå¤šäººç‚¹èµã€‚å¦å¤– Twitter ä¸Šæœ‰äººå‘æ¨å–·æˆ‘ã€Œè° TM åœ¨æ„ä½ çš„äººç”Ÿæ€ä¹ˆæ ·ã€ï¼Œæˆ‘è§‰å¾—éƒ½æŒºå¥½ç¬‘çš„ï¼‰ï¼Œæˆ‘æƒ³åœ¨è¿™é‡Œä¸ºä¸€äº›å› æ­¤ä¸å¿«æ„çš„è¯»è€…è§£é‡Šä¸‹ã€‚æˆ‘å…¶å®æ„Ÿè§‰åˆ°ï¼Œåœ¨æˆ‘è‡ªå·±çš„ä½“ç³»èƒ½å¤Ÿè‡ªæ´½åï¼Œçœ‹å¾…è¿™ç±»è¯„è®ºæ—¶æˆ‘æ›´åƒæ˜¯ä¸€ä¸ªæ—è§‚è€…ã€‚æˆ‘ç”šè‡³å®Œå…¨ä¸è§‰å¾—è¿™äº›è¯„è®ºå†’çŠ¯äº†æˆ‘ï¼ˆç¬‘ï¼‰ã€‚è¿™æ ·çš„æ·±å…¥å‰–æè‡ªæˆ‘çš„æ–‡ç« ï¼Œè‚¯å®šä¼šåˆºç—›åˆ°ä¸€äº›è¢«ç”Ÿæ´»ç£¨å»äº†æ£±è§’ï¼Œè¿·å¤±äº†è‡ªå·±çš„äººã€‚è¿™ç§äººåˆ«è¯´è·Ÿæˆ‘å…±æƒ…äº†ï¼Œä»–ä»¬ç”šè‡³ä¸‹æ„è¯†å°±è¦æ”»å‡»æˆ‘ã€åé©³æˆ‘ã€‚ ä»¥å‰çœ‹è¿‡æœ‹å‹æ¨èçš„ä¸€æœ¬å°è¯´ï¼Œé‡Œé¢æœ‰ä¸€å¥è¯æˆ‘å°è±¡å¾ˆæ·±åˆ»ï¼šã€Œæ­£å¦‚çº¯æ°§å¯¹ç”Ÿç‰©æœ‰å®³ï¼Œæ¯«æ— ä¿ç•™çš„çœŸç›¸ï¼Œåªä¼šæŠŠäººçš„ç²¾ç¥å‡»æºƒã€‚ä¸€æ¯”äº”ï¼ˆå››ï¼‰çš„æ°§ä¸æ°®ï¼Œæ‰æ˜¯å¯ä¾›å‘¼å¸çš„ç©ºæ°”ã€‚åŒæ ·ï¼Œå‘¼å¸ç€ä»¥æˆè¨€ç¨€é‡Šçš„å°‘é‡çœŸå®ï¼Œäººæ‰èƒ½ç»´æŒå¥å…¨çš„å¿ƒã€‚ã€ å¯¹è¿™ç§è¢«ä¸–ç•Œçš„çœŸç›¸å‡»æºƒçš„äººï¼Œæˆ‘æ²¡å•¥å¥½è¯´çš„ã€‚ä»¥é“œä¸ºé•œï¼Œå¯ä»¥æ­£è¡£å† ï¼›ä»¥äººä¸ºé•œï¼Œå¯ä»¥æ˜å¾—å¤±ã€‚è¿™äº›è¯„è®ºåœ¨è­¦ç¤ºæˆ‘ï¼Œä¸è¦æˆä¸ºè¿™æ ·çš„äººï¼Œ çœ‹æ¸…ä¸–ç•Œçš„çœŸç›¸åï¼Œä»è¦çƒ­çˆ±ç”Ÿæ´»ã€‚ å¦‚æœè¯´ä½“ç³»è‡ªæ´½æœ‰ç‚¹ä¸å¥½æ‡‚ï¼Œé‚£æˆ‘å¯ä»¥ç”¨ä¸ªç®€å•çš„ç±»æ¯”æ¥è¯´æ˜è¿™ä¸€ç‚¹ï¼šé¢å¯¹è¿™ç§å“å¤´è®ºè¶³ï¼Œæˆ‘è§‰å¾—æˆ‘ç®€ç›´æ˜¯åœ¨å¯¹ç‰›å¼¹ç´ã€‚ç‰›çš„å“å“å«ä¼šè®©æˆ‘æ„Ÿåˆ°ä¸å¼€å¿ƒä¹ˆï¼Ÿæˆ‘æœ‰å¿…è¦è·Ÿç‰›è§£é‡Šæˆ‘å¼¹çš„æ›²å­ä¹ˆï¼Ÿå®ƒå¬ä¸æ‡‚å…³æˆ‘ä½•äº‹ï¼Ÿ ","date":"2023-08-19","objectID":"/posts/a-quarter-of-the-way-through-life/:6:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"ä¸¤å²¸çŒ¿å£°å•¼ä¸ä½ï¼Œè½»èˆŸå·²è¿‡ä¸‡é‡å±±â€”â€”æˆ‘çš„å››åˆ†ä¹‹ä¸€äººç”Ÿ","uri":"/posts/a-quarter-of-the-way-through-life/#è¯„è®ºåŒº"},{"categories":["tech","life"],"content":"æˆ‘æŠ˜è…¾è¿‡è®¸å¤šçš„å°ä¼—æŠ€æœ¯ï¼Œè€Œä»Šå¹´æ–°æŠ˜è…¾çš„ä¸»è¦æœ‰ NixOSã€çª—å£ç®¡ç†å™¨ i3 / hyprlandã€ä»¥åŠ Neovimï¼Œå…¶ä¸­ NixOS æˆ‘ç”šè‡³æŠ˜è…¾åˆ°äº†ä¸€ä¸ªæ–°å¢ƒç•Œâ€”â€”å‡ºäº†ä¸€æœ¬å¸®åŠ©æ–°æ‰‹å…¥é—¨çš„ä¸­è‹±åŒè¯­å¼€æºä¹¦ç±nixos-and-flakes-bookï¼Œè¿˜æäº†å¥½å‡ ä¸ª NixOS ç›¸å…³çš„å¼€æºé¡¹ç›®ï¼ˆæ¯”å¦‚nix-darwin-kickstarter è·Ÿryan4yin/nix-configï¼‰ï¼Œéƒ½æ”¶åˆ°äº†è®¸å¤šå¥½è¯„ã€‚ ç»“åˆæˆ‘è‡ªå·±æŠ˜è…¾è¿™äº›å°ä¼—æŠ€æœ¯çš„ç»å†ï¼Œä»¥åŠæˆ‘ç»å¸¸è¢«é—®åˆ°çš„é—®é¢˜ï¼ˆä¸ºä»€ä¹ˆä½ é€‰æ‹©ç”¨NixOS / Neovim /å°é¹¤éŸ³å½¢ä¸­æ–‡è¾“å…¥æ³•ï¼Ÿå®ƒæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿå®ƒçœŸçš„èƒ½æå‡æ•ˆç‡å—ï¼Ÿç­‰ç­‰ï¼‰ï¼Œæˆ‘æƒ³åœ¨è¿™é‡Œç®€å•è°ˆè°ˆæˆ‘å¯¹å®ƒä»¬çš„çœ‹æ³•ã€‚ ","date":"2023-08-01","objectID":"/posts/why-i-choose-niche-products/:0:0","series":[],"tags":["Vim","Neovim","VSCode","Editor","IDE","Linux","ä¸­æ–‡è¾“å…¥æ³•"],"title":"ä¸ºä»€ä¹ˆæˆ‘æŠ˜è…¾è¿™äº›å°ä¼—æŠ€æœ¯ï¼Ÿ","uri":"/posts/why-i-choose-niche-products/#"},{"categories":["tech","life"],"content":" ä»€ä¹ˆæ˜¯å°ä¼—æŠ€æœ¯ï¼Ÿå°ä¼—ï¼Œæ˜¯ç›¸å¯¹äºå¤§ä¼—è€Œè¨€çš„ã€‚å°ä¼—æŠ€æœ¯ï¼ŒæŒ‡åœ¨è¯¥é¢†åŸŸä¸­ç”¨æˆ·å æ¯”è¾ƒç›¸å¯¹è¾ƒå°çš„æŠ€æœ¯ã€‚ åŸºäºè¿™æ ·çš„å®šä¹‰ï¼Œæˆ‘å¯ä»¥åˆ—ä¸¾å‡ºæˆ‘æ¥è§¦è¿‡çš„ä¸åŒé¢†åŸŸçš„ä¸€äº›å°ä¼—æŠ€æœ¯ï¼š é¢†åŸŸ å°ä¼—æŠ€æœ¯ å¤§ä¼—æŠ€æœ¯ ç¼–è¾‘å™¨ Neovimã€Emacs VSCodeã€PyCharmã€IDEA ä¸­æ–‡è¾“å…¥æ–¹æ¡ˆ åŒæ‹¼ã€å°é¹¤éŸ³å½¢ã€äº”ç¬”ã€äºŒç¬”ã€éƒ‘ç ã€çµå½¢é€Ÿå½± æ™ºèƒ½æ‹¼éŸ³ Linux æ“ä½œç³»ç»Ÿ NixOSã€Gentooã€Arch Linux Ubuntuã€Fedora çª—å£ç®¡ç†å™¨ i3ã€hyprland KDEã€GNOME å¤§å¤šæ•°äººåœ¨ä½¿ç”¨è¿™äº›é¢†åŸŸçš„æŠ€æœ¯æ—¶ï¼Œéƒ½ä¼šé€‰æ‹©å¤§ä¼—æŠ€æœ¯ï¼Œå› ä¸ºå®ƒä»¬çš„å…¥é—¨é—¨æ§›ä½ï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿæ¯”è¾ƒæ–¹ä¾¿ã€‚æˆ‘æ›¾ç»ä¹Ÿæ˜¯è¿™å¤§å¤šæ•°äººä¹‹ä¸€ï¼Œä½†æ˜¯æˆ‘æ¸æ¸å‘ç°ï¼Œè¿™äº›å°ä¼—æŠ€æœ¯ä¹Ÿæœ‰å®ƒä»¬çš„ä¼˜åŠ¿ï¼Œæ‰€ä»¥æˆ‘å¼€å§‹å°è¯•ä½¿ç”¨å®ƒä»¬ï¼Œå¹¶é€æ¸è¿‡æ¸¡åˆ°äº†å®ƒä»¬ã€‚ ","date":"2023-08-01","objectID":"/posts/why-i-choose-niche-products/:1:0","series":[],"tags":["Vim","Neovim","VSCode","Editor","IDE","Linux","ä¸­æ–‡è¾“å…¥æ³•"],"title":"ä¸ºä»€ä¹ˆæˆ‘æŠ˜è…¾è¿™äº›å°ä¼—æŠ€æœ¯ï¼Ÿ","uri":"/posts/why-i-choose-niche-products/#ä»€ä¹ˆæ˜¯å°ä¼—æŠ€æœ¯"},{"categories":["tech","life"],"content":" è¿™äº›å°ä¼—æŠ€æœ¯æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿå°ä¼—æŠ€æœ¯æ˜¾ç„¶å¾—æ‹¥æœ‰ä¸€äº›ä¼˜åŠ¿ï¼Œæ‰èƒ½å¸å¼•åˆ°ä¸€éƒ¨åˆ†ç”¨æˆ·ï¼Œè®©è¿™äº›ç”¨æˆ·é€‰æ‹©å®ƒä»¬è€Œä¸æ˜¯å¤§ä¼—æŠ€æœ¯ã€‚ ä»æˆ‘ä¸ªäººçš„ä½¿ç”¨ç»éªŒæ¥çœ‹ï¼Œæˆ‘ç”¨è¿‡çš„è¿™äº›å°ä¼—æŠ€æœ¯ï¼Œå…·æœ‰ä¸€äº›æ¯”è¾ƒæ˜æ˜¾çš„å…±åŒç‰¹å¾ã€‚ é¦–å…ˆæ˜¯å®ƒä»¬å…±åŒçš„åŠ£åŠ¿ï¼šå…¥é—¨é—¨æ§›æ›´é«˜ï¼Œå…¥é—¨é˜¶æ®µéœ€è¦èŠ±è´¹æ›´å¤šçš„æ—¶é—´å»å­¦ä¹ ã€ç†Ÿæ‚‰ã€‚ è¿™å°±è¿‡æ»¤æ‰äº†å¤§éƒ¨åˆ†ç”¨æˆ·ï¼Œåªæœ‰é‚£äº›å–œæ¬¢æŠ˜è…¾ã€å–œæ¬¢æŒ‘æˆ˜çš„äººæ‰ä¼šå»å°è¯•è¿™äº›å°ä¼—æŠ€æœ¯ã€‚ æ¯”å¦‚è¯´äº”ç¬”è¾“å…¥æ³•ï¼Œå®ƒä»¬çš„å…¥é—¨é—¨æ§›å¾ˆé«˜ï¼Œéœ€è¦èŠ±è´¹å¤§é‡çš„æ—¶é—´å»è®°å¿†å®ƒçš„é”®ä½ç¼–æ’ã€å»ç»ƒä¹ ï¼Œå‰æœŸçš„è¾“å…¥ä½“éªŒä¼šè·Œåˆ°è°·åº•ã€‚è¦æƒ³è¾¾åˆ°ä½ æ›¾ç»æ™ºèƒ½æ‹¼éŸ³çš„è¾“å…¥é€Ÿåº¦ï¼Œæ„Ÿè§‰è‡³å°‘å¾—æ¯å¤©ç»ƒä¹  1 ä¸ªå°æ—¶ï¼ŒæŒç»­ä¸€ä¸ªæœˆï¼ˆè¿™å¾ˆå¯èƒ½è¿˜ä¸å¤Ÿï¼‰ã€‚ å…¶ä»–å½¢ç è¾“å…¥æ³•ä¹Ÿæ˜¯ä¸€æ ·ï¼Œæˆ‘ç”¨çš„å°é¹¤éŸ³å½¢ç®—æ˜¯ä¸€ä¸ªæŠ˜è¡·çš„é€‰æ‹©ï¼Œå®ƒçš„å…¥é—¨é—¨æ§›æ¯”äº”ç¬”ä½ä¸€äº›ï¼Œå­¦ä¼šåä¹Ÿèƒ½è·å¾—ç±»ä¼¼äº”ç¬”çš„è¾“å…¥ä½“éªŒã€‚ å†è¯´è¯´å®ƒä»¬å…±åŒçš„ä¼˜åŠ¿ï¼š å®šåˆ¶ç¨‹åº¦é«˜ï¼šç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚ï¼Œè‡ªç”±åœ°å®šåˆ¶å„ç§åŠŸèƒ½ã€‚ å¼ºçƒˆçš„æŒæ§æ„Ÿã€ç»ä½³çš„ä½¿ç”¨ä½“éªŒï¼šé«˜åº¦çš„è‡ªå®šä¹‰ï¼Œè®©ç”¨æˆ·æ„Ÿè§‰åˆ°è‡ªå·±åœ¨ä½¿ç”¨è¿™äº›æŠ€æœ¯çš„è¿‡ç¨‹ä¸­ï¼Œèƒ½å¤Ÿå®Œå…¨æŒæ§ä¸€åˆ‡ï¼Œä»è€Œå¸¦æ¥ç»ä½³çš„ä½¿ç”¨ä½“éªŒã€‚ ç”¨æˆ·é»æ€§é«˜ã€ç¤¾åŒºæ´»è·ƒï¼šç”¨æˆ·åœ¨ä½¿ç”¨è¿™äº›æŠ€æœ¯çš„è¿‡ç¨‹ä¸­ï¼Œä¼šä¸æ–­åœ°å»æ¢ç´¢ã€å»å­¦ä¹ ã€å»å®šåˆ¶ï¼Œ è¿™ä¼šè®©ç”¨æˆ·å¯¹å®ƒä»¬äº§ç”Ÿå¼ºçƒˆçš„å½’å±æ„Ÿã€‚ ä¹Ÿå› ä¸ºä¸Šé¢è¿™äº›åŸå› ï¼Œç”¨æˆ·ä¸€æ—¦æˆåŠŸå…¥é—¨æŸé¡¹å°ä¼—æŠ€æœ¯ï¼ˆæ¯”å¦‚è¯´å½¢ç è¾“å…¥æ³•ã€Neovim/Emacs ç¼–è¾‘å™¨ï¼‰ï¼Œå°±å¾ˆéš¾å†é€€å›åˆ°æ›¾ç»çš„å¤§ä¼—æ–¹æ¡ˆâ€”â€”ä»–ä»¬ä¼šå‘ç°æ›¾ç»çš„å¤§ä¼—æ–¹æ¡ˆç”¨èµ·æ¥ï¼Œå„ç§ä¸é¡ºæ‰‹ã€ä¸çˆ½å¿«ã€‚ ","date":"2023-08-01","objectID":"/posts/why-i-choose-niche-products/:2:0","series":[],"tags":["Vim","Neovim","VSCode","Editor","IDE","Linux","ä¸­æ–‡è¾“å…¥æ³•"],"title":"ä¸ºä»€ä¹ˆæˆ‘æŠ˜è…¾è¿™äº›å°ä¼—æŠ€æœ¯ï¼Ÿ","uri":"/posts/why-i-choose-niche-products/#è¿™äº›å°ä¼—æŠ€æœ¯æœ‰ä»€ä¹ˆç‰¹ç‚¹"},{"categories":["tech","life"],"content":" æˆ‘ä¸ºä»€ä¹ˆæŠ˜è…¾è¿™äº›å°ä¼—æŠ€æœ¯ï¼Ÿæˆ‘æŠ˜è…¾è¿‡è®¸å¤šå°ä¼—æŠ€æœ¯ï¼Œè€ŒåŸå› ä¸­æœ€å¤§çš„ä¸€éƒ¨åˆ†ï¼Œåº”è¯¥æ˜¯å¥½å¥‡å¿ƒã€‚ä½†å¥½å¥‡å¿ƒåªèƒ½è®©æˆ‘å»å°è¯•ï¼Œè®©æˆ‘ç•™ä¸‹æ¥çš„ï¼Œæ˜¯å®ƒä»¬ä¼˜ç§€çš„ä½¿ç”¨ä½“éªŒã€‚ æ¯”å¦‚è¯´æœ€è¿‘æŠ˜è…¾çš„ Neovim ç¼–è¾‘å™¨ã€Hyprland çª—å£ç®¡ç†å™¨ï¼Œè®©æˆ‘ç•™ä¸‹æ¥ç»§ç»­ä½¿ç”¨å®ƒä»¬çš„åŸå› ï¼Œä¸€æ˜¯ Neovim è·Ÿ Hyprland é…ç½®å¥½äº†ä¹‹åï¼ŒçœŸçš„å¾ˆæ¼‚äº®ï¼è€Œä¸” Neovim é€Ÿåº¦çœŸçš„è¶…å¿«ã€å¤ªå¿«äº†ï¼ä¸€äº›ä»æ²¡æ·±åº¦ä½“éªŒè¿‡ Neovim çš„ VSCode / IDEA ç”¨æˆ·å¯èƒ½ä¼šè§‰å¾—è¿™ç§å¿«ä¸è¿‡å¦‚æ­¤ï¼Œä½†æ˜¯ä¸€æ—¦ä½ çœŸçš„ä½“éªŒè¿‡ï¼Œå°±ä¼šå‘ç°è¿™ç§å¿«çœŸçš„å¾ˆçˆ½ï¼Œå°±åƒæµæµªåœ°çƒ 2 ä¸­å›¾æ’å®‡çš„æ„Ÿå¹ä¸€æ ·ï¼ˆ550W å¤ªå¿«äº†ï¼è¿™é€Ÿåº¦å¤ªå¿«äº†ï¼ï¼‰ äºŒæ˜¯å®é™…å…¥é—¨åï¼Œå‘ç°å®ƒä»¬ç”¨èµ·æ¥å¾ˆçˆ½å¿«ï¼ŒåŸºäºé”®ç›˜çš„äº¤äº’ï¼Œèƒ½å¸¦ç»™æˆ‘å½¢ç è¾“å…¥æ³•çš„é‚£ç§æŒæ§æ„Ÿã€æµç•…æ„Ÿï¼ˆä¼˜é›…ï¼Œå¤ªä¼˜é›…äº† hhhï¼‰ã€‚ æˆ‘çš„ NixOS + Hyprland æ¡Œé¢ æˆ‘çš„ Neovim ç¼–è¾‘å™¨ è€Œæˆ‘æŠ˜è…¾å¹¶ä¸”çˆ±ä¸Š NixOSï¼Œä¹Ÿæ˜¯åŸºäºç±»ä¼¼çš„åŸå› ã€‚æ‹¥æœ‰å£°æ˜å¼ã€å¯å¤ç°ï¼ˆä¸€è‡´çš„è¿è¡Œç¯å¢ƒï¼‰ã€OS as Code ç­‰è¿™äº›ç‰¹ç‚¹çš„ NixOSï¼Œå¯¹äºæœ¬è¿ç»´ç‹—è€Œè¨€ï¼ŒçœŸå°±æ˜¯ç†æƒ³ä¸­çš„æ ·å­ï¼Œè¿™è®©æˆ‘è¿«ä¸åŠå¾…åœ°æƒ³è¦ä½¿ç”¨å®ƒï¼Œå³ä½¿å‘ç°äº†é—®é¢˜ä¹Ÿå¸Œæœ›èƒ½å°½å¿«å®Œå–„å®ƒï¼Œä½¿å®ƒèƒ½å¤Ÿé€‚ç”¨äºæ›´å¤šçš„åœºæ™¯ã€‚ å‰ä¸¤å¤©åœ¨ 4chan ä¸Šçœ‹åˆ°æŸå¤–å›½ç½‘å‹çš„è¿™ä¹ˆä¸€æ®µè¯„è®ºï¼ˆè™½ç„¶è¨€è¯æœ‰ç‚¹åæ¿€ï¼Œä½†æˆ‘è¿˜çœŸæœ‰ç‚¹è®¤åŒâ€¦ï¼‰ï¼š CompletelyÂ andÂ utterlyÂ unacceptable.Â ImagineÂ having aÂ toolÂ thatÂ canâ€™tÂ evenÂ properlyÂ undoÂ anÂ operationÂ andÂ then relyingÂ onÂ itÂ toÂ manageÂ anÂ operatingÂ system.apt,Â pip,Â pm,Â rpm,Â pacman,Â whateverÂ areÂ all aÂ madÂ fuckingÂ joke. ","date":"2023-08-01","objectID":"/posts/why-i-choose-niche-products/:3:0","series":[],"tags":["Vim","Neovim","VSCode","Editor","IDE","Linux","ä¸­æ–‡è¾“å…¥æ³•"],"title":"ä¸ºä»€ä¹ˆæˆ‘æŠ˜è…¾è¿™äº›å°ä¼—æŠ€æœ¯ï¼Ÿ","uri":"/posts/why-i-choose-niche-products/#æˆ‘ä¸ºä»€ä¹ˆæŠ˜è…¾è¿™äº›å°ä¼—æŠ€æœ¯"},{"categories":["tech","life"],"content":" å°ä¼—å·¥å…·æˆ–æŠ€æœ¯èƒ½æå‡æ•ˆç‡å—ï¼Ÿæœ‰è®¸å¤šäººè¯´ï¼ŒNeovim ç¼–è¾‘å™¨ã€i3 çª—å£ç®¡ç†å™¨ã€å½¢ç è¾“å…¥æ³•ç­‰è¿™äº›å°ä¼—å·¥å…·æˆ–æŠ€æœ¯ï¼Œèƒ½æå‡æ•ˆç‡ï¼Œæˆ‘è§‰å¾—è¿™æ˜¯ä¸€ä¸ªè¯¯åŒºã€‚ç›¸åï¼Œå…¶ä¸­è®¸å¤šå·¥å…·æˆ–æŠ€æœ¯ï¼Œå®é™…ä¸Šæ˜¯ä¸€ä¸ªæ—¶é—´é”€é‡‘çªŸï¼Œä½ ä¼šè¢«è‡ªå·±çš„å…´è¶£é©±ä½¿ç€å»ä¸æ–­æ¢ç´¢å®ƒä»¬çš„è¾¹ç•Œã€è°ƒæ•´å®ƒçš„é…ç½®ä½¿å…¶æ›´å¥‘åˆè‡ªå·±çš„éœ€æ±‚ã€‚è¿™å¯¼è‡´è‡³å°‘å‰é¢è¾ƒé•¿ä¸€æ®µä¸Šå‡æœŸï¼Œè¿™äº›æŠ•å…¥çš„æ—¶é—´ä¼šæ¯”ä½ æ•ˆç‡æå‡æ‰€çœä¸‹çš„æ—¶é—´å¤šå¾—å¤šã€‚ æ‰€ä»¥è¯´åˆ°åº•ï¼Œæƒ³ç”¨è¿™äº›æŠ€æœ¯æ¥æå‡æ•ˆç‡å•¥çš„è¿˜æ˜¯ä¸ç”¨æƒ³äº†ã€‚å®ƒèƒ½æå‡ä½ çš„æ•ˆç‡ï¼Œä½†æ˜¯æ¯”è¾ƒæœ‰é™ï¼Œé™¤éä½ å†™ä»£ç /æ–‡æ¡£çš„æ•ˆç‡æ˜¯å—é™äºä½ çš„æ‰‹é€Ÿ emmm å½“ç„¶ä¹Ÿæœ‰äº›ç‰¹æ®Šåœºæ™¯ï¼Œæ¯”å¦‚è¯´æœ‰çš„äººéœ€è¦ç»å¸¸è¾“å…¥äº›ç”Ÿåƒ»å­—ï¼Œè¿™æ—¶å€™æ™ºèƒ½æ‹¼éŸ³å°±æ¯”è¾ƒé¸¡è‚‹äº†ï¼Œäº”ç¬”ç­‰å½¢ç è¾“å…¥æ³•å°±ç¡®å®èƒ½å¤§å¤§æå‡è¾“å…¥æ•ˆç‡ã€‚ æˆ–è€…æœ‰äººä¼šè¯´ï¼Œå®Œå…¨ç†Ÿæ‚‰åï¼Œvim/emacs èƒ½ä½¿ä½ æ›´å®¹æ˜“è¿›å…¥å¿ƒæµçŠ¶æ€ï¼Ÿè¿™ä¸ªä¹Ÿå¾ˆéš¾è¯´å§ã€‚ ","date":"2023-08-01","objectID":"/posts/why-i-choose-niche-products/:4:0","series":[],"tags":["Vim","Neovim","VSCode","Editor","IDE","Linux","ä¸­æ–‡è¾“å…¥æ³•"],"title":"ä¸ºä»€ä¹ˆæˆ‘æŠ˜è…¾è¿™äº›å°ä¼—æŠ€æœ¯ï¼Ÿ","uri":"/posts/why-i-choose-niche-products/#å°ä¼—å·¥å…·æˆ–æŠ€æœ¯èƒ½æå‡æ•ˆç‡å—"},{"categories":["tech","life"],"content":" é‚£æŠ˜è…¾è¿™äº›ä¸œè¥¿ï¼Œåˆ°åº•æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿå¦‚æœä»å¾ˆåŠŸåˆ©çš„è§’åº¦çœ‹çš„è¯ï¼Œç¡®å®å°±æ²¡å•¥å¥½å¤„ï¼Œå°±è·Ÿæ‰“æ¸¸æˆä¸€æ ·ï¼Œå•çº¯åœ¨æ¶ˆé£æ—¶å…‰è€Œå·²ã€‚ è¦è¯´è·Ÿåšäº›æ— èŠçš„äº‹æ¶ˆé£æ—¶å…‰æœ‰å•¥åŒºåˆ«çš„è¯ï¼Œå¤§æ¦‚å°±æ˜¯è¿˜ç¡®å®èƒ½è·å¾—ç‚¹æœ‰ç”¨çš„ä¸œè¥¿ã€‚æ¯”å¦‚æˆ‘ï¼Œé‡åˆ° AstroNvim çš„ bug ï¼Œä¼šæ PR ç»™ä¸Šæ¸¸ä»“åº“ã€‚å‘ç° NixOS çš„æ–‡æ¡£å¾ˆç³Ÿç³•ï¼Œæˆ‘ç›´æ¥è‡ªå·±å†™æ–‡æ¡£å¹¶åˆ†äº«å‡ºæ¥ã€‚å‘ç° NixOS ç¼ºå°‘å¯¹æˆ‘æ‰‹å¤´æŸå—å¼€å‘æ¿çš„æ”¯æŒï¼Œæˆ‘ä¼šè‡ªå·±å°è¯•ç§»æ¤ã€‚å•¥æ—¶å€™å‘ç°æŸå·¥å…·ç¼ºå°‘è‡ªå·±æƒ³è¦çš„åŠŸèƒ½ï¼Œæˆ‘ä¹Ÿå¯èƒ½ç›´æ¥è‡ªå·±å†™ä¸€ä¸ªã€‚ è¿™äº›æŠ˜è…¾è¿‡ç¨‹ä¸­è·å¾—çš„ç»éªŒã€åˆ›å»ºçš„å¼€æºé¡¹ç›®ã€åœ¨ä¸Šæ¸¸ä»“åº“ä¸­ç•™ä¸‹çš„ PR ã€åœ¨ç¤¾åŒºä¸­æ”¶è·çš„æ„Ÿè°¢ï¼Œæ„Ÿè§‰éƒ½æ˜¯æœ‰ä»·å€¼çš„ã€‚å®ƒä¸ä¸€å®šæœ‰å•¥ä¸šåŠ¡ä»·å€¼ï¼Œä½†æ˜¯å®ƒå¥½ç©å•Šï¼Œè¿˜èƒ½äº¤åˆ°æœ‹å‹ï¼Œå¸®åˆ°åˆ«äººï¼Œåœ¨å¼€æºç¤¾åŒºç•™ä¸‹è‡ªå·±çš„ç—•è¿¹ï¼Œè¿™ä¸æ˜¯å¾ˆæœ‰æ„æ€ä¹ˆï¼Ÿ Linus æœ€å¼€å§‹å†™ Linuxï¼Œ ä¹Ÿåªæ˜¯ä¸ºäº†å¥½ç©ï¼ˆJust For Funï¼‰. ","date":"2023-08-01","objectID":"/posts/why-i-choose-niche-products/:5:0","series":[],"tags":["Vim","Neovim","VSCode","Editor","IDE","Linux","ä¸­æ–‡è¾“å…¥æ³•"],"title":"ä¸ºä»€ä¹ˆæˆ‘æŠ˜è…¾è¿™äº›å°ä¼—æŠ€æœ¯ï¼Ÿ","uri":"/posts/why-i-choose-niche-products/#é‚£æŠ˜è…¾è¿™äº›ä¸œè¥¿åˆ°åº•æœ‰ä»€ä¹ˆå¥½å¤„"},{"categories":["tech","life"],"content":" ç»“è¯­ä½ å±•æœ›äººç”Ÿçš„æ—¶å€™ï¼Œä¸å¯èƒ½æŠŠè¿™äº›ç‚¹è¿èµ·æ¥ï¼›åªæœ‰å½“ä½ å›é¡¾äººç”Ÿçš„æ—¶å€™ï¼Œæ‰èƒ½å‘ç°å®ƒä»¬ä¹‹é—´çš„è”ç³»ã€‚æ‰€ä»¥ä½ å¿…é¡»æœ‰ä¿¡å¿ƒï¼Œç›¸ä¿¡è¿™äº›ç‚¹æ€»ä¼šä»¥æŸç§æ–¹å¼ï¼Œå¯¹ä½ çš„æœªæ¥äº§ç”Ÿå½±å“ã€‚ä½ å¿…é¡»ç›¸ä¿¡ä¸€äº›äº‹æƒ…â€”â€”ä½ çš„å‹‡æ°”ã€å‘½è¿ã€äººç”Ÿã€ç¼˜åˆ†ç­‰ç­‰ã€‚è¿™æ ·åšä»æœªä»¤æˆ‘å¤±æœ›ï¼Œåè€Œå†³å®šäº†æˆ‘äººç”Ÿä¸­æ‰€æœ‰ä¸ä¼—ä¸åŒä¹‹å¤„ã€‚ Stay Hungry. Stay Foolish. â€”â€”Youâ€™ve got to find what you love, by Steve Jobs, CEO of Apple Computer ","date":"2023-08-01","objectID":"/posts/why-i-choose-niche-products/:6:0","series":[],"tags":["Vim","Neovim","VSCode","Editor","IDE","Linux","ä¸­æ–‡è¾“å…¥æ³•"],"title":"ä¸ºä»€ä¹ˆæˆ‘æŠ˜è…¾è¿™äº›å°ä¼—æŠ€æœ¯ï¼Ÿ","uri":"/posts/why-i-choose-niche-products/#ç»“è¯­"},{"categories":["tech","life"],"content":" è¯„è®ºåŒºæ–‡æœ«é™„ä¸Šæ¥è‡ªå…¶ä»–è®ºå›çš„è¯„è®ºï¼Œå…¶ä¸­ä¸ä¹ä¸€äº›æœ‰è¶£çš„è§‚ç‚¹ï¼š 0xffff.one: https://0xffff.one/d/1595-wei-shen-me-wo-zhe-teng-zhei-xie v2ex: https://www.v2ex.com/t/961562 ","date":"2023-08-01","objectID":"/posts/why-i-choose-niche-products/:7:0","series":[],"tags":["Vim","Neovim","VSCode","Editor","IDE","Linux","ä¸­æ–‡è¾“å…¥æ³•"],"title":"ä¸ºä»€ä¹ˆæˆ‘æŠ˜è…¾è¿™äº›å°ä¼—æŠ€æœ¯ï¼Ÿ","uri":"/posts/why-i-choose-niche-products/#è¯„è®ºåŒº"},{"categories":["tech"],"content":" 2024-08-30 æ›´æ–°ï¼šæˆ‘å·²ç»ç”¨ aerospace æ›¿ä»£äº† yabai + shkdï¼Œä½“éªŒå¥½äº†å¤ªå¤šï¼Œè€Œä¸”ä¹Ÿä¸ç”¨å…³æ‰ SIP å•¥çš„ï¼Œå¼ºçƒˆæ¨èä¸€ç”¨ã€‚ 2024-01-28 æ›´æ–°ï¼šæ¢äº†æ–° Macbook Pro ä¹‹åï¼Œæˆ‘åˆé‡æ–°æŠŠ yabai è£…ä¸Šäº†ï¼Œç›®å‰ä½“éªŒè¿˜ä¸é”™ï¼Œæ¯” 23 å¹´å¥½äº†ä¸å°‘ã€‚å¦å¤–æˆ‘æ–°çš„é…ç½®å®Œå…¨åŸºäº nix-darwin éƒ¨ç½²ï¼Œå†…å®¹ä¹Ÿæœ‰äº›æ”¹åŠ¨ï¼Œæœ‰å…´è¶£çš„å¯ä»¥çœ‹çœ‹ï¼šryan4yin/nix-config/darwin/wm é™„ä¸Š nix-darwin æ–°æ‰‹èµ·æ­¥æ¨¡æ¿ryan4yin/nix-darwin-kickstarter åœ¨ Linux ä¸Šç”¨äº†ä¸€æ®µæ—¶é—´ i3wm åï¼Œæˆ‘å°±æœ‰ç‚¹å¿å—ä¸äº†å·¥ä½œç”µè„‘çš„æ¡Œé¢ç¯å¢ƒäº†ï¼Œå…¬å¸ç»™é…çš„æ˜¯ Macbook Pro 2020ï¼Œä¸€ç•ªæŸ¥æ‰¾å‘ç° yabai æ¯”è¾ƒç¬¦åˆæˆ‘çš„éœ€æ±‚ï¼Œäºæ˜¯å¼€å§‹äº†æŠ˜è…¾ä¹‹æ—…ã€‚ ","date":"2023-05-22","objectID":"/posts/macos-window-manager-yabai-usage/:0:0","series":[],"tags":["MacOS","çª—å£ç®¡ç†å™¨","Window Manager","yabai"],"title":"MacOS çª—å£ç®¡ç†å™¨ yabai ç©è€ç¬”è®°","uri":"/posts/macos-window-manager-yabai-usage/#"},{"categories":["tech"],"content":" ä½¿ç”¨ä½“éªŒæ€»ç»“æˆ‘çš„ç”µè„‘é…ç½®ä¸º Macbook Pro 2020ï¼Œi5 + 16G RAM + 512G Diskï¼Œæ€§èƒ½å°šå¯ã€‚ ä¸€å¥è¯æ€»ç»“ï¼šä½“éªŒè¿˜ä¸é”™ï¼Œä½†æ˜¯è¿˜ä¸å¤ªæˆç†Ÿï¼ŒBug æ¯”è¾ƒå¤šï¼Œè€Œä¸”æœ‰ç‚¹åƒæ€§èƒ½ï¼Œå®‰è£… yabai åå¶å°”å°±ä¼šå¡é¡¿ä¸€ä¸‹ã€‚ è‡ªåŠ¨åˆ†å± + å¿«æ·é”®è‡ªåŠ¨è°ƒæ•´çª—å£çš„ä½“éªŒè¿˜æ˜¯å¾ˆèˆ’æœçš„ï¼ŒåŠé€€æˆ‘çš„ä¸»è¦æ˜¯å¦‚ä¸‹è¿™äº›é—®é¢˜ï¼š å¯¹æœ‰äº›è½¯ä»¶ï¼Œæ¯”å¦‚ä¼ä¸šå¾®ä¿¡ã€å¾®ä¿¡ã€QQï¼Œè‡ªåŠ¨åˆ†å±åŠŸèƒ½ä¸å¤ªè¡Œï¼Œä¼šå‡ºç°çª—å£é”™ä½ã€‚ å¦‚ä¸‹ä¸¤ä¸ªé—®é¢˜é€¼ç€æˆ‘ä¸€ä¼šå„¿è¿›å…¥å…¨å±æ¨¡å¼ï¼Œä¸€ä¼šå„¿åˆè¦é€€å‡ºå…¨å±ï¼Œç®€ç›´ç¦»è°±ã€‚ å…¨å±ä¸‹ Chrome æœç´¢æ¡†ä¸‹æ–¹çš„æç¤ºæ è¢«ä¼š Chrome æœ¬èº«é®æŒ¡ï¼Œå¿…é¡»é€€å‡ºå…¨å±åŠŸèƒ½æ‰èƒ½çœ‹åˆ°ã€‚ éå…¨å±ä¸‹ï¼ŒChrome é¡µé¢ä¸­çš„è¾“å…¥æ¡†ã€Œè‡ªåŠ¨å¡«å……ã€åŠŸèƒ½ä¼šè¢« Chrome é®æŒ¡ï¼Œå¿…é¡»è¿›å…¥å…¨å±æ¨¡å¼æ‰èƒ½çœ‹åˆ°â€¦ åœ¨å³é”®ä¿®æ”¹ Firefox Bookmark ä¸­æ ‡ç­¾æ—¶ï¼Œå¼¹å‡ºçš„ä¿®æ”¹èœå•ä¼šè¢« Bookmark æ”¶è—å¤¹æœ¬èº«çš„å¼¹çª—é®æŒ¡ï¼Œå¯¼è‡´æœ‰äº›é€‰é¡¹æ— æ³•ç‚¹å‡»åˆ°ã€‚ å¼€å§‹ä½¿ç”¨ yabai åï¼Œç³»ç»Ÿç»å¸¸æ€§åœ°å¡é¡¿ï¼Œæˆ–è€…é£æ‰‡ç‹‚è½¬ï¼Œè¯´æ˜è¿™ç©æ„å„¿æœ‰ç‚¹åƒæ€§èƒ½ã€‚ ","date":"2023-05-22","objectID":"/posts/macos-window-manager-yabai-usage/:1:0","series":[],"tags":["MacOS","çª—å£ç®¡ç†å™¨","Window Manager","yabai"],"title":"MacOS çª—å£ç®¡ç†å™¨ yabai ç©è€ç¬”è®°","uri":"/posts/macos-window-manager-yabai-usage/#ä½¿ç”¨ä½“éªŒæ€»ç»“"},{"categories":["tech"],"content":" å®‰è£…æµç¨‹é¦–å…ˆå‚è€ƒè¿™ç¯‡å®˜æ–¹ WikiDisabling System Integrity Protection å…³é—­ SIPï¼Œç„¶åå‚ç…§å¦‚ä¸‹æµç¨‹å®‰è£… yabai ä¸ skhdã€‚ shell # å®‰è£…yabai brew install koekeishiya/formulae/yabai sudo yabai --install-sa # å¯åŠ¨yabai è¿™æ—¶å€™éœ€è¦æˆæƒè¾…åŠ©åŠŸèƒ½ brew services start yabai # å®‰è£…skhd brew install koekeishiya/formulae/skhd # å¯åŠ¨skhd è¿™æ—¶å€™éœ€è¦æˆæƒè¾…åŠ©åŠŸèƒ½ brew services start skhd ########### ä¸º yabai æ·»åŠ  sudo æƒé™ ########### sudo yabai --load-sa sudo visudo -f /private/etc/sudoers.d/yabai # ç„¶åè¾“å…¥ä»¥ä¸‹å†…å®¹ å…¶ä¸­ \u003cuser\u003e ä¿®æ”¹ä¸ºå½“å‰ mac çš„ç”¨æˆ·å # input the line below into the file you are editing. # replace \u003cyabai\u003e with the path to the yabai binary (output of: which yabai). # replace \u003cuser\u003e with your username (output of: whoami). # replace \u003chash\u003e with the sha256 hash of the yabai binary (output of: shasum -a 256 $(which yabai)). # this hash must be updated manually after running brew upgrade. \u003cuser\u003e ALL=(root) NOPASSWD: sha256:\u003chash\u003e \u003cyabai\u003e --load-sa ä¸Šé¢å°±å®Œæˆäº†å®‰è£…æµç¨‹ï¼Œä½†æ˜¯åˆ°è¿™é‡Œè¿˜ä¸èƒ½ä½¿ç”¨ï¼Œè¿˜éœ€è¦ä¸º skhd ä¸ yabai æ·»åŠ é…ç½®æ–‡ä»¶ï¼Œå¹¶æ·»åŠ è‡ªå®šä¹‰é…ç½®ã€‚ shell # åˆ›å»ºyabaié…ç½®æ–‡ä»¶ touch ~/.yabairc chmod +x ~/.yabairc # åˆ›å»ºskhdé…ç½®æ–‡ä»¶ touch ~/.skhdrc chmod +x ~/.skhdrc # ä¹‹ååœ¨ ~/.yabairc ä¸­æ·»åŠ ä»¥ä¸‹å‘½ä»¤ cat \u003c\u003cEOF \u003e ~/.yabairc #!/usr/bin/env sh # wiki è¦æ±‚åœ¨é…ç½®æœ€å‰é¢åŠ è¿™ä¸ªï¼Œçœ‹èµ·æ¥æ˜¯è·Ÿ sudo æƒé™ç›¸å…³çš„ä¸œè¥¿ sudo yabai --load-sa yabai -m signal --add event=dock_did_restart action=\"sudo yabai --load-sa\" EOF ","date":"2023-05-22","objectID":"/posts/macos-window-manager-yabai-usage/:2:0","series":[],"tags":["MacOS","çª—å£ç®¡ç†å™¨","Window Manager","yabai"],"title":"MacOS çª—å£ç®¡ç†å™¨ yabai ç©è€ç¬”è®°","uri":"/posts/macos-window-manager-yabai-usage/#å®‰è£…æµç¨‹"},{"categories":["tech"],"content":" è‡ªå®šä¹‰ skhd ä¸ yabai é…ç½®è¿™é‡Œé…ç½®çš„ç›®æ ‡æ˜¯ï¼Œå°½é‡ä¸ i3wm çš„é»˜è®¤å¿«æ·é”®ä¿æŒä¸€è‡´ï¼Œå› ä¸ºæˆ‘åœ¨å®¶ç”¨çš„æ˜¯ Linuxï¼Œåªæœ‰åŠå…¬ç”µè„‘æ˜¯ Mac. æˆ‘ç›®å‰çš„ ~/.yabaircï¼Œå®ƒç”¨äºé…ç½® yabai çš„å„ç§è¡Œä¸ºï¼š shell #!/usr/bin/env sh # wiki è¦æ±‚åœ¨é…ç½®æœ€å‰é¢åŠ è¿™ä¸ªï¼Œçœ‹èµ·æ¥æ˜¯è·Ÿ sudo æƒé™ç›¸å…³çš„ä¸œè¥¿ sudo yabai --load-sa yabai -m signal --add event=dock_did_restart action=\"sudo yabai --load-sa\" ## è¾“å‡º debug æ—¥å¿—ï¼Œå‡ºé—®é¢˜æ—¶æ–¹ä¾¿æ’æŸ¥ yabai -m config debug_output on # çª—å£å¹³é“º yabai -m space --layout bsp # é»˜è®¤æ‹†åˆ†è§„åˆ™ first_child second_child yabai -m config window_placement second_child # çª—å£é—´è·è®¾ç½® yabai -m config top_padding 10 yabai -m config bottom_padding 10 yabai -m config left_padding 10 yabai -m config right_padding 10 yabai -m config window_gap 10 # è‡ªåŠ¨å¹³è¡¡æ‰€æœ‰çª—å£å§‹ç»ˆå æ®ç›¸åŒçš„ç©ºé—´ yabai -m config auto_balance off # å¦‚æœç¦ç”¨è‡ªåŠ¨å¹³è¡¡ï¼Œæ­¤é¡¹å±æ€§å®šä¹‰çš„æ˜¯æ–°çª—å£å ç”¨çš„ç©ºé—´é‡ã€‚0.5æ„ä¸ºæ—§çª—å£å ç”¨50% yabai -m config split_ratio 0.50 # é¼ æ ‡ä¿®é¥°é”® æ„æ€å°±æ˜¯æŒ‰ç€è¿™ä¸ªé”®å°±å¯ä»¥ä½¿ç”¨é¼ æ ‡å•ç‹¬ä¿®æ”¹çª—å£å¤§å°äº† yabai -m config mouse_modifier ctrl # ctrl + é¼ æ ‡å·¦é”® ç§»åŠ¨çª—å£ yabai -m config mouse_action1 move # ctrl + é¼ æ ‡å³é”® è°ƒæ•´çª—å£å¤§å° yabai -m config mouse_action2 resize # ç„¦ç‚¹è·Ÿéšé¼ æ ‡ é»˜è®¤off: å…³é—­ autoraise:è‡ªåŠ¨æå‡ autofocus: è‡ªåŠ¨å¯¹ç„¦ yabai -m config focus_follows_mouse autofocus # è®¾ç½®é¼ æ ‡æ˜¯å¦è·Ÿéšå½“å‰æ´»åŠ¨çª—å£ é»˜è®¤ off: å…³é—­ on: å¼€å¯ yabai -m config mouse_follows_focus on # æµ®åŠ¨çª—å£é—®é¢˜åœ¨é¡¶éƒ¨ yabai -m config window_topmost on # ä¿®æ”¹çª—å£é˜´å½± on: æ‰“å¼€ off: å…³é—­ float: åªæ˜¾ç¤ºæµ®åŠ¨çª—å£çš„é˜´å½± yabai -m config window_shadow float # çª—å£é€æ˜åº¦è®¾ç½® yabai -m config window_opacity on # é…ç½®æ´»åŠ¨çª—å£ä¸é€æ˜åº¦ yabai -m config active_window_opacity 0.98 yabai -m config normal_window_opacity 0.9 yabai -m config window_opacity_duration 0.0 # åœ¨æ‰€æœ‰æ˜¾ç¤ºå™¨ä¸Šçš„æ¯ä¸ªç©ºé—´é¡¶éƒ¨æ·»åŠ  0 å¡«å…… åº•éƒ¨æ·»åŠ  0 å¡«å…… yabai -m config external_bar all:0:0 # ================================ è§„åˆ™ ================================ # æ‰“å¼€ç³»ç»Ÿåå¥½è®¾ç½®ï¼Œä¸ä½¿ç”¨å¹³é“ºæ¨¡å¼ yabai -m rule --add app=\"^ç³»ç»Ÿåå¥½è®¾ç½®$\" manage=off yabai -m rule --add app=\"^æé†’äº‹é¡¹$\" manage=off yabai -m rule --add app=\"^å…³äºæœ¬æœº$\" manage=off echo \"yabai configuration loaded..\" å†å°±æ˜¯ ~/.skhdrcï¼Œå®ƒè´Ÿè´£é…ç½®å„ç§å¿«æ·é”®ï¼Œå¦‚ä¸‹æ˜¯æˆ‘çš„é…ç½®: shell # é…ç½®è¯­æ³• : \u003cmodifier\u003e - \u003ckey\u003e : \u003ccommand\u003e # modifier å¯ä»¥æ˜¯å•ä¸ªé”®æ¯”å¦‚ cmd, alt, ctrl, ä¹Ÿå¯ä»¥æ˜¯ç»„åˆé”®æ¯”å¦‚ ctrl + shift, ctrl + alt # ================================ æ‰“å¼€ç»ˆç«¯ ================================ # å¯åŠ¨ç»ˆç«¯ cmd - return : open -a iTerm # å…³é—­å½“å‰çª—å£ï¼Œè¿™ä¸ªä¸éœ€è¦åŠ ï¼ŒmacOS é»˜è®¤æ˜¯ cmd + qï¼Œæˆ‘ Linux ä¹Ÿè¿™ä¹ˆè®¾ç½®çš„ # ================================ çª—å£è®¾ç½® ================================ # =============== ä¸ºäº†é¿å…å¿«æ·é”®å†²çªæ”¹ç”¨äº† ctrl ä½œä¸º modifier ================= # ctrl + e åˆ‡æ¢ä¸ºå¹³é“ºæ¨¡å¼ ctrl - e : yabai -m space --layout bsp # ctrl + s åˆ‡æ¢ä¸ºå †å æ¨¡å¼ ctrl - s : yabai -m space --layout stack # æµ®åŠ¨/ä¸æµ®åŠ¨çª—å£ float ctrl - f : yabai -m window --toggle float # ================================ å¤šæ¡Œé¢é…ç½® ================================ # åˆ›å»ºä¸€ä¸ªæ–°æ¡Œé¢ï¼Œå¹¶æŠŠå½“å‰æ´»åŠ¨çš„çª—å£å‘é€åˆ°æ–°æ¡Œé¢ï¼Œå¹¶ä¸”è‡ªåŠ¨è·³è½¬åˆ°æ–°æ¡Œé¢. éœ€è¦ jq æ”¯æŒ brew install jq shift + cmd - n : yabai -m space --create \u0026\u0026 index=\"$(yabai -m query --spaces --display | jq '.| length')\" \u0026\u0026 yabai -m window --space \"${index}\" \u0026\u0026 yabai -m space --focus \"${index}\" \u0026\u0026 yabai -m space --layout bsp # åœ¨ stack æ¨¡å¼ä¸‹é€šè¿‡æ–¹å‘é”®åˆ‡æ¢çª—å£ ctrl - down : yabai -m window --focus stack.next || yabai -m window --focus south ctrl - up : yabai -m window --focus stack.prev || yabai -m window --focus north # åœ¨ bsp æ¨¡å¼ä¸‹é€šè¿‡æ–¹å‘é”®åˆ‡æ¢çª—å£ cmd - left : yabai -m window --focus west cmd - right : yabai -m window --focus east # åœ¨ 9 ä¸ªæ¡Œé¢ä¹‹é—´åˆ‡æ¢ ctrl - 1 : yabai -m space --focus 1 ctrl - 2 : yabai -m space --focus 2 ctrl - 3 : yabai -m space --focus 3 ctrl - 4 : yabai -m space --focus 4 ctrl - 5 : yabai -m space --focus 5 ctrl - 6 : yabai -m space --focus 6 ctrl - 7 : yabai -m space --focus 7 ctrl - 8 : yabai -m space --focus 8 ctrl - 9 : yabai -m space --focus 9 # å°†çª—å£å‘é€åˆ°æŸä¸ªå…¶ä»–æ¡Œé¢ ctrl + shift - 1 : yabai -m window --space 1 ctrl + shift - 2 : yabai -m window --space 2 ctrl + shift - 3 : yabai -m window --space 3 ctrl + shift - 4 : yabai -m window --space 4 ctrl + shift - 5 : yabai -m window --space 5 ctrl + shift - 6 : yabai -m window --space 6 ctrl + shift - 7 : yabai -m window --space 7 ctrl + shift - 8 : yabai -m window --space 8 ctrl + shift - 9 : yabai -m window --space 9 é…ç½®åŠ å¥½åé‡å¯ yabai ä¸ skhd: shell brew services restart yabai brew services restart skhd ç°åœ¨å°±å¯ä»¥éšä¾¿æ‰“å¼€å‡ ä¸ªç¨‹åºè¯•è¯•ï¼Œæ­£å¸¸æƒ…å†µä¸‹ yabai ä¼šè‡ªåŠ¨å¸®ä½ åˆ†å±ã€‚å†å°è¯•ä¸‹æ·»åŠ å¥½çš„è¿™äº›å¿«æ·é”®ï¼Œçœ‹çœ‹æ˜¯å¦ç”Ÿæ•ˆã€‚ ","date":"2023-05-22","objectID":"/posts/macos-window-manager-yabai-usage/:3:0","series":[],"tags":["MacOS","çª—å£ç®¡ç†å™¨","Window Manager","yabai"],"title":"MacOS çª—å£ç®¡ç†å™¨ yabai ç©è€ç¬”è®°","uri":"/posts/macos-window-manager-yabai-usage/#è‡ªå®šä¹‰-skhd-ä¸-yabai-é…ç½®"},{"categories":["tech"],"content":" é—®é¢˜æ’æŸ¥","date":"2023-05-22","objectID":"/posts/macos-window-manager-yabai-usage/:4:0","series":[],"tags":["MacOS","çª—å£ç®¡ç†å™¨","Window Manager","yabai"],"title":"MacOS çª—å£ç®¡ç†å™¨ yabai ç©è€ç¬”è®°","uri":"/posts/macos-window-manager-yabai-usage/#é—®é¢˜æ’æŸ¥"},{"categories":["tech"],"content":" 1. yabaiå¦‚æœ yabai é…ç½®æ²¡æœ‰ç”Ÿæ•ˆï¼Œæœ‰å¯èƒ½æ˜¯æƒé™é—®é¢˜ï¼Œå¯ä»¥è¯•ä¸‹è¿™ä¸ªå‘½ä»¤é‡å¯ yabai: shell sudo yabai --uninstall-sa; sudo yabai --load-sa; brew services restart yabai å…¶ä»–é—®é¢˜å¯æŸ¥çœ‹ yabai çš„æ—¥å¿—è§£å†³ï¼š é”™è¯¯æ—¥å¿—è·¯å¾„: /usr/local/var/log/yabai/yabai.err.log æ™®é€šæ—¥å¿—è·¯å¾„: /usr/local/var/log/yabai/yabai.out.log ","date":"2023-05-22","objectID":"/posts/macos-window-manager-yabai-usage/:4:1","series":[],"tags":["MacOS","çª—å£ç®¡ç†å™¨","Window Manager","yabai"],"title":"MacOS çª—å£ç®¡ç†å™¨ yabai ç©è€ç¬”è®°","uri":"/posts/macos-window-manager-yabai-usage/#1-yabai"},{"categories":["tech"],"content":" 2. skhdå¦‚æœ skhd é…ç½®æ²¡æœ‰ç”Ÿæ•ˆï¼Œé¦–å…ˆå¯ä»¥æŸ¥çœ‹ skhd çš„æ—¥å¿—: shell cat /usr/local/var/log/skhd/*.log å¦‚æœæ—¥å¿—æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå¯ä»¥åœæ­¢ skhd æœåŠ¡å¹¶æ‰‹åŠ¨å¯åŠ¨å®ƒï¼Œçœ‹çœ‹æ˜¯å¦æœ‰è¾“å‡ºæŠ¥é”™ï¼š shell brew services stop skhd skhd -c ~/.skhdrc æ¯”å¦‚æˆ‘ä¹‹å‰æ”¹é”™äº†é…ç½®ï¼Œæ‰§è¡Œä¸Šè¿°å‘½ä»¤å°±ä¼šæŠ¥é”™ï¼š text #27:7 expected modifier æç¤ºæˆ‘é…ç½®çš„ç¬¬ 27 è¡Œé…ç½®æœ‰é—®é¢˜ï¼Œæˆ‘å°±å»çœ‹äº†ä¸‹ï¼Œå‘ç°æ˜¯æˆ‘æŠŠ cmd - return å†™æˆäº†cmd + returnï¼Œæ”¹æ­£åå† brew services start skhd é‡å¯ skhd å°±å¥½äº†ã€‚ ","date":"2023-05-22","objectID":"/posts/macos-window-manager-yabai-usage/:4:2","series":[],"tags":["MacOS","çª—å£ç®¡ç†å™¨","Window Manager","yabai"],"title":"MacOS çª—å£ç®¡ç†å™¨ yabai ç©è€ç¬”è®°","uri":"/posts/macos-window-manager-yabai-usage/#2-skhd"},{"categories":["tech"],"content":" å †å æ¨¡å¼ä¸‹çš„å¯è§†åŒ–yabai åœ¨å †å æ¨¡å¼ä¸‹çš„å¯è§†åŒ–æ•ˆæœä¸æ˜¯å¾ˆå¥½ï¼Œå¯ä»¥ä½¿ç”¨stackline æ¥æ”¹å–„ä¸€ä¸‹ã€‚ shell # stackline ä¾èµ– hammerspoonï¼Œè¿™æ˜¯ä¸€ä¸ª macOS æ¡Œé¢è‡ªåŠ¨åŒ–å·¥å…· brew install hammerspoon --cask # ç°åœ¨å°† stackline å®‰è£…åˆ° hammerspoon çš„é…ç½®ç›®å½•ä¸­ git clone https://github.com/AdamWagner/stackline.git ~/.hammerspoon/stackline # Make stackline run when hammerspoon launches cd ~/.hammerspoon echo 'stackline = require \"stackline\"' \u003e\u003e init.lua echo 'stackline:init()' \u003e\u003e init.lua ç°åœ¨è¿˜éœ€è¦å®‰è£…ä¸‹ hammerspoon çš„å‘½ä»¤è¡Œå·¥å…· hsï¼Œå®ƒç”¨äºåœ¨è„šæœ¬ä¸­æ‰§è¡Œ stackline æ“ä½œï¼Œå®‰è£…æ–¹æ³•å¦‚ä¸‹ï¼š é¦–å…ˆæœç´¢æ‰“å¼€ Hamerspoon ç¨‹åºï¼Œæˆ–è€…ä½¿ç”¨å‘½ä»¤ open -a \"Hammerspoon\" è¿™é‡Œå¯åŠ¨æ—¶ä¼šç”³è¯·æƒé™ï¼Œéœ€è¦æ‰‹åŠ¨æ‰“å¼€ä¸‹ åŒæ—¶æ³¨æ„å‹¾é€‰ç™»å½•æ—¶è‡ªåŠ¨å¯åŠ¨ åœ¨ä¸‹æ–¹çš„å‘½ä»¤è¾“å‡ºæ ä¸­é”®å…¥ hs.ipc.cliInstall() å†å›è½¦ï¼Œå³å¯å®Œæˆå®‰è£… ç°åœ¨ç¡®è®¤ä¸‹ hs å‘½ä»¤å·²ç»å¯ç”¨ï¼š shell which hs ","date":"2023-05-22","objectID":"/posts/macos-window-manager-yabai-usage/:5:0","series":[],"tags":["MacOS","çª—å£ç®¡ç†å™¨","Window Manager","yabai"],"title":"MacOS çª—å£ç®¡ç†å™¨ yabai ç©è€ç¬”è®°","uri":"/posts/macos-window-manager-yabai-usage/#å †å æ¨¡å¼ä¸‹çš„å¯è§†åŒ–"},{"categories":["tech"],"content":" ä½¿ç”¨æ—¶çš„å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ³• Chrome/WeChat ç­‰ç¨‹åºçš„å¼¹çª—æ— æ³•æ˜¾ç¤º: å°è¯•ä¸‹è¿›å…¥å…¨å±æˆ–è€…é€€å‡ºå…¨å±ï¼Œæ€»æœ‰ä¸€ç§åœºæ™¯ä¸‹å¯ä»¥æ˜¾ç¤ºå¼¹çª—â€¦ â€¦ ","date":"2023-05-22","objectID":"/posts/macos-window-manager-yabai-usage/:6:0","series":[],"tags":["MacOS","çª—å£ç®¡ç†å™¨","Window Manager","yabai"],"title":"MacOS çª—å£ç®¡ç†å™¨ yabai ç©è€ç¬”è®°","uri":"/posts/macos-window-manager-yabai-usage/#ä½¿ç”¨æ—¶çš„å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ³•"},{"categories":["tech"],"content":" å‚è€ƒ mac ä¸‹çš„å¹³é“ºæ¡Œé¢ yabai ä½¿ç”¨ - æœˆé’æ‚  Yabai setup for i3wm users - Krever ","date":"2023-05-22","objectID":"/posts/macos-window-manager-yabai-usage/:7:0","series":[],"tags":["MacOS","çª—å£ç®¡ç†å™¨","Window Manager","yabai"],"title":"MacOS çª—å£ç®¡ç†å™¨ yabai ç©è€ç¬”è®°","uri":"/posts/macos-window-manager-yabai-usage/#å‚è€ƒ"},{"categories":["tech"],"content":"éšç€æ–‡ç« çš„æ›´æ–°ï¼Œæ–‡ç« å†…å®¹é€æ¸å¢å¤šï¼Œä¸ºäº†æ–¹ä¾¿é˜…è¯»ï¼Œæ–‡ç« å†…å®¹å·²ç»è¿ç§»åˆ°å•ç‹¬çš„ç«™ç‚¹: æ–‡æ¡£ç«™: https://nixos-and-flakes.thiscute.world/zh/ GitHub: https://github.com/ryan4yin/nixos-and-flakes-book éå¸¸æ„Ÿè°¢Redditã€æ–‡ç« è¯„è®ºåŒºã€V2EX ä»¥åŠ0xffff.one ç­‰å¹³å°ä¸Šå„ä½æœ‹å‹çš„åé¦ˆã€æ‰¹è¯„ä¸å»ºè®® â¤ï¸ ","date":"2023-05-04","objectID":"/posts/nixos-and-flake-basics/:0:0","series":["NixOS ä¸ Nix Flakes"],"tags":["NixOS","Nix","Flakes","Linux","DevOps"],"title":"NixOS ä¸ Nix Flakes æ–°æ‰‹å…¥é—¨","uri":"/posts/nixos-and-flake-basics/#"},{"categories":["tech"],"content":" é˜…è¯»æ­¤æ–‡ç« éœ€è¦å‰ç½®çŸ¥è¯†ï¼šLinux ç½‘ç»œåŸºç¡€çŸ¥è¯†ã€iptablesã€conntrack æœ¬æ–‡å†…å®¹éƒ¨åˆ†é‡‡ç”¨äº† Copilot æç¤ºå†…å®¹ï¼Œä¹Ÿæœ‰éƒ¨åˆ†å†…å®¹ç”¨äº† ChatGPT å…è´¹ç‰ˆè¿›è¡Œåˆ†æï¼Œç¡®å®éƒ½æ¯”è¾ƒæœ‰å¸®åŠ©ã€‚ æœ€è¿‘å› ä¸ºå·¥ä½œéœ€è¦ç ”ç©¶äº†ä¸€æ³¢ WireGuard åè®®ï¼Œåœ¨è¿™ç¯‡æ–‡ç« ä¸­ç®€å•è®°å½•ä¸‹å¿ƒå¾—ã€‚ ","date":"2023-03-28","objectID":"/posts/wireguard-on-linux/:0:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["WireGuard","VPN","Linux","ç½‘ç»œ","iptables","conntrack"],"title":"Linux ä¸Šçš„ WireGuard ç½‘ç»œåˆ†æï¼ˆä¸€ï¼‰","uri":"/posts/wireguard-on-linux/#"},{"categories":["tech"],"content":" WireGuard æ˜¯ä»€ä¹ˆWireGuard æ˜¯æç®€ä¸»ä¹‰æ€æƒ³ä¸‹çš„ VPN å®ç°ï¼Œè§£å†³äº†å¾ˆå¤šç°å­˜ VPN åè®®å­˜åœ¨çš„é—®é¢˜ã€‚å®ƒäº 2015 å¹´ç”± Jason A. Donenfeld è®¾è®¡å®ç°ï¼Œå› å…¶ä»£ç å®ç°ç®€æ´æ˜“æ‡‚ã€é…ç½®ç®€å•ã€æ€§èƒ½é«˜ã€å®‰å…¨å¼ºåº¦é«˜è€Œå—åˆ°å¹¿æ³›å…³æ³¨ã€‚ WireGuard åœ¨ 2020 å¹´åˆè¿›å…¥ Linux ä¸»çº¿åˆ†æ”¯ï¼Œéšåæˆä¸º Linux 5.6 çš„ä¸€ä¸ªå†…æ ¸æ¨¡å—ï¼Œè¿™ä¹‹åå¾ˆå¿«å°±æ¶Œç°å‡ºè®¸å¤šåŸºäº WireGuard çš„å¼€æºé¡¹ç›®ä¸ç›¸å…³ä¼ä¸šï¼Œå„å¤§è€ç‰Œ VPN æœåŠ¡å•†ä¹Ÿé€æ¸å¼€å§‹æ”¯æŒ WireGuard åè®®ï¼Œå¾ˆå¤šä¼ä¸šä¹Ÿä½¿ç”¨å®ƒæ¥ç»„å»ºä¼ä¸š VPN ç½‘ç»œã€‚ åŸºäº WireGuard çš„æ˜æ˜Ÿå¼€æºé¡¹ç›®ä¸¾ä¾‹ï¼š tailscale: ä¸€å¥—ç®€å•æ˜“ç”¨çš„ WireGuard VPN ç§æœ‰ç½‘ç»œè§£å†³æ–¹æ¡ˆï¼Œå¼ºçƒˆæ¨èï¼ headscale: tailscale æ§åˆ¶æœåŠ¡å™¨çš„å¼€æºå®ç°ï¼Œä½¿ä½ å¯ä»¥è‡ªå»º tailscale æœåŠ¡ã€‚ kilo: åŸºäº WireGuard çš„ Kubernetes å¤šäº‘ç½‘ç»œè§£å†³æ–¹æ¡ˆã€‚ â€¦ é™¤äº†ä¸Šé¢è¿™äº›ï¼Œè¿˜æœ‰å¾ˆå¤šå…¶ä»– WireGuard é¡¹ç›®ï¼Œæœ‰å…´è¶£å¯ä»¥å»awesome-wireguard ä»“åº“çœ‹çœ‹ã€‚ WireGuard æœ¬èº«åªæ˜¯ä¸€ä¸ªç‚¹å¯¹ç‚¹éš§é“åè®®ï¼Œåªæä¾›ç‚¹å¯¹ç‚¹é€šä¿¡çš„èƒ½åŠ›ï¼ˆè¿™ä¹Ÿæ˜¯å…¶æç®€ä¸»ä¹‰æ€æƒ³çš„ä½“ç°ï¼‰ã€‚è€Œå…¶ä»–ç½‘ç»œè·¯ç”±ã€NAT ç©¿è¶Šã€DNS è§£æã€é˜²ç«å¢™ç­–ç•¥ç­‰åŠŸèƒ½éƒ½æ˜¯åŸºäº Linux ç³»ç»Ÿçš„ç°æœ‰å·¥å…·æ¥å®ç°çš„ã€‚ åœ¨è¿™ç¯‡æ–‡ç« é‡Œï¼Œæˆ‘å°†æ­å»ºä¸€ä¸ªç®€å•çš„å•æœåŠ¡å™¨ + å•å®¢æˆ·ç«¯ WireGuard ç½‘ç»œï¼Œç„¶ååˆ†æå®ƒå¦‚ä½•ä½¿ç”¨ Linux ç³»ç»Ÿç°æœ‰çš„å·¥å…·ï¼Œåœ¨ WireGuard éš§é“ä¸Šæ­å»ºå‡ºä¸€ä¸ªå®‰å…¨å¯é çš„è™šæ‹Ÿç½‘ç»œã€‚ æ–‡ç« æµ‹è¯•ç”¨åˆ°çš„æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯å‡ä¸ºè™šæ‹Ÿæœºï¼Œä½¿ç”¨ Ubuntu 20.04 ç³»ç»Ÿï¼Œå†…æ ¸ç‰ˆæœ¬ä¸º 5.15ï¼Œä¹Ÿå°±æ˜¯è¯´éƒ½åŒ…å«äº† wireguard å†…æ ¸æ¨¡å—ã€‚ ","date":"2023-03-28","objectID":"/posts/wireguard-on-linux/:1:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["WireGuard","VPN","Linux","ç½‘ç»œ","iptables","conntrack"],"title":"Linux ä¸Šçš„ WireGuard ç½‘ç»œåˆ†æï¼ˆä¸€ï¼‰","uri":"/posts/wireguard-on-linux/#wireguard-æ˜¯ä»€ä¹ˆ"},{"categories":["tech"],"content":" WireGuard æœåŠ¡ç«¯ç½‘ç»œåˆ†æç®€å•èµ·è§ï¼Œè¿™é‡Œä½¿ç”¨ docker-compose å¯åŠ¨ä¸€ä¸ª WireGuard æœåŠ¡ç«¯ï¼Œä½¿ç”¨çš„é•œåƒæ˜¯linuxserver/docker-wireguardã€‚ é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼Œå†…å®¹å®Œå…¨å‚è€ƒè‡ªæ­¤é•œåƒçš„å®˜æ–¹ READMEï¼š yaml --- version: \"2.1\" services: wireguard: image: lscr.io/linuxserver/wireguard:latest container_name: wireguard cap_add: - NET_ADMIN - SYS_MODULE environment: - PUID=1000 - PGID=1000 - TZ=Etc/UTC - SERVERURL=auto # è‡ªåŠ¨ç¡®å®šæœåŠ¡å™¨çš„å¤–éƒ¨ IP åœ°å€ï¼Œåœ¨ç”Ÿæˆå®¢æˆ·ç«¯é…ç½®æ—¶ä¼šç”¨åˆ° - SERVERPORT=51820 # æœåŠ¡ç«¯ç›‘å¬çš„ç«¯å£å· - PEERS=1 # è‡ªåŠ¨ç”Ÿæˆ 1 ä¸ªå®¢æˆ·ç«¯é…ç½® - PEERDNS=auto # è‡ªåŠ¨ç¡®å®šå®¢æˆ·ç«¯çš„ DNS æœåŠ¡å™¨åœ°å€ï¼ŒåŒæ ·æ˜¯åœ¨ç”Ÿæˆå®¢æˆ·ç«¯é…ç½®æ—¶ä¼šç”¨åˆ° - INTERNAL_SUBNET=10.13.13.0 # WireGuard è™šæ‹Ÿç½‘ç»œçš„ç½‘æ®µ - ALLOWEDIPS=0.0.0.0/0 # è¿™æ¡è§„åˆ™è¡¨ç¤ºå…è®¸è™šæ‹Ÿç½‘ç»œå†…çš„æ‰€æœ‰å®¢æˆ·ç«¯å°†æµé‡å‘é€åˆ°æ­¤èŠ‚ç‚¹ # ä¼—æ‰€å‘¨çŸ¥ï¼ŒNAT ç½‘ç»œéœ€è¦å®šæœŸå‘é€å¿ƒè·³åŒ…æ¥ä¿æŒ NAT è¡¨å†…å®¹ä¸è¿‡æœŸï¼Œä¿—ç§°è¿æ¥ä¿æ´»ã€‚ # è¿™é‡Œè®¾ç½®ä¸º all è¡¨ç¤ºæ‰€æœ‰å®¢æˆ·ç«¯éƒ½å¼€å¯è¿æ¥ä¿æ´»ã€‚ - PERSISTENTKEEPALIVE_PEERS=all - LOG_CONFS=true # å¼€å¯æ—¥å¿— volumes: - ./config:/config - /lib/modules:/lib/modules # å°†å®¿ä¸»æœºçš„å†…æ ¸æ¨¡å—æŒ‚è½½åˆ°å®¹å™¨å†…ï¼Œç”¨äºåŠ è½½ WireGuard å†…æ ¸æ¨¡å— ports: - 51820:51820/udp sysctls: - net.ipv4.conf.all.src_valid_mark=1 restart: unless-stopped å°†ä¸Šé¢çš„é…ç½®æ–‡ä»¶ä¿å­˜ä¸º docker-compose.ymlï¼Œç„¶åé€šè¿‡å¦‚ä¸‹å‘½ä»¤åå°å¯åŠ¨ WireGuard æœåŠ¡ç«¯ï¼š shell docker-compose up -d WireGuard æœåŠ¡ç«¯å¯åŠ¨å¥½äº†ï¼Œç°åœ¨æŸ¥çœ‹ä¸‹æœåŠ¡ç«¯å®¹å™¨çš„æ—¥å¿—ï¼ˆæˆ‘åŠ äº†è¯¦ç»†æ³¨é‡Šè¯´æ˜ï¼‰ï¼š shell $ docker logs wireguard # ...çœç•¥è‹¥å¹²å†…å®¹ .:53 # è¿™å‡ è¡Œæ—¥å¿—æ˜¯å¯åŠ¨ CoreDNSï¼Œä¸ºè™šæ‹Ÿç½‘ç»œæä¾›é»˜è®¤çš„ DNS æœåŠ¡ CoreDNS-1.10.1 # å®é™…ä¸Š CoreDNS ä¸æ˜¯å¿…é¡»çš„ï¼Œå®¢æˆ·ç«¯å¯ä»¥æ”¹ç”¨å…¶ä»– DNS æœåŠ¡å™¨ linux/amd64, go1.20, 055b2c3 [#] ip link add wg0 type wireguard # åˆ›å»ºä¸€ä¸ª wireguard è®¾å¤‡ [#] wg setconf wg0 /dev/fd/63 # è®¾ç½® wireguard è®¾å¤‡çš„é…ç½® [#] ip -4 address add 10.13.13.1 dev wg0 # ä¸º wireguard è®¾å¤‡æ·»åŠ ä¸€ä¸ª ip åœ°å€ [#] ip link set mtu 1420 up dev wg0 # è®¾ç½® wireguard è®¾å¤‡çš„ mtu [#] ip -4 route add 10.13.13.2/32 dev wg0 # ä¸º wireguard peer1 æ·»åŠ è·¯ç”±ï¼Œå…¶åœ°å€æ¥è‡ª wireguard é…ç½®çš„ `allowedIPs` å‚æ•° # ä¸‹é¢è¿™å‡ æ¡ iptables å‘½ä»¤ä¸º wireguard è®¾å¤‡æ·»åŠ  NAT è§„åˆ™ï¼Œä½¿å…¶æˆä¸º WireGuard è™šæ‹Ÿç½‘ç»œçš„é»˜è®¤ç½‘å…³ # å¹¶ä½¿è™šæ‹Ÿç½‘ç»œå†…çš„å…¶ä»– peers èƒ½é€šè¿‡æ­¤é»˜è®¤ç½‘å…³è®¿é—®å¤–éƒ¨ç½‘ç»œã€‚ [#] iptables -A FORWARD -i wg0 -j ACCEPT; iptables -A FORWARD -o wg0 -j ACCEPT; iptables -t nat -A POSTROUTING -o eth+ -j MASQUERADE [ls.io-init] done. é€šè¿‡æ—¥å¿—èƒ½çœ‹åˆ°ï¼Œç¨‹åºé¦–å…ˆåˆ›å»ºäº† WireGuard è®¾å¤‡ wg0 å¹¶ç»‘å®šäº†åœ°å€ 10.13.13.1ã€‚ä½œä¸º WireGuard ç½‘ç»œä¸­çš„æœåŠ¡ç«¯ï¼Œå®ƒæ‰€åˆ›å»ºçš„è¿™ä¸ª wg0 çš„ä»»åŠ¡æ˜¯æˆä¸ºæ•´ä¸ª WireGuard è™šæ‹Ÿç½‘ç»œçš„é»˜è®¤ç½‘å…³ï¼Œå¤„ç†æ¥è‡ªè™šæ‹Ÿç½‘ç»œå†…çš„å…¶ä»– peers çš„æµé‡ï¼Œæ„æˆä¸€ä¸ªæ˜Ÿå‹ç½‘ç»œã€‚ ç„¶åæœåŠ¡ç«¯ä¸ºå®ƒæ‰€ç”Ÿæˆçš„ peer1 æ·»åŠ äº†ä¸€ä¸ªè·¯ç”±ï¼Œä½¿å¾— peer1 çš„æµé‡èƒ½å¤Ÿè¢«æ­£ç¡®è·¯ç”±åˆ° wg0 è®¾å¤‡ä¸Šã€‚ æœ€åä¸ºäº†è®© WireGuard è™šæ‹Ÿç½‘ç»œå†…çš„å…¶ä»– peers çš„æµé‡èƒ½å¤Ÿé€šè¿‡ wg0 è®¾å¤‡è®¿é—®å¤–éƒ¨ç½‘ç»œæˆ–è€…äº’ç›¸è®¿é—®ï¼ŒæœåŠ¡ç«¯ä¸º wg0 è®¾å¤‡æ·»åŠ äº†å¦‚ä¸‹çš„ iptables è§„åˆ™ï¼š iptables -A FORWARD -i wg0 -j ACCEPT; iptables -A FORWARD -o wg0 -j ACCEPT;ï¼šå…è®¸è¿›å‡º wg0 è®¾å¤‡çš„æ•°æ®åŒ…é€šè¿‡ netfilter çš„ FORWARD é“¾ï¼ˆé»˜è®¤è§„åˆ™æ˜¯ DROPï¼Œå³é»˜è®¤æ˜¯ä¸å…è®¸é€šè¿‡çš„ï¼‰ iptables -t nat -A POSTROUTING -o eth+ -j MASQUERADEï¼šåœ¨ eth+ ç½‘å¡ä¸Šæ·»åŠ  MASQUERADE è§„åˆ™ï¼Œå³å°†æ•°æ®åŒ…çš„æºåœ°å€ä¼ªè£…æˆ eth+ ç½‘å¡çš„åœ°å€ï¼Œç›®çš„æ˜¯ä¸ºäº†å…è®¸ wireguard çš„æ•°æ®åŒ…é€šè¿‡ NAT è®¿é—®å¤–éƒ¨ç½‘ç»œã€‚ è€Œå›æ¥çš„æµé‡ä¼šè¢« NAT çš„ conntrack é“¾æ¥è¿½è¸ªè§„åˆ™è‡ªåŠ¨å…è®¸é€šè¿‡ï¼Œä¸è¿‡ conntrack è¡¨æœ‰è‡ªåŠ¨æ¸…ç†æœºåˆ¶ï¼Œé•¿æ—¶é—´æ²¡æµé‡çš„è¯ä¼šè¢«ä» conntrack è¡¨ä¸­ç§»é™¤ã€‚è¿™å°±æ˜¯å‰é¢ docker-compose.yml ä¸­çš„ PERSISTENTKEEPALIVE_PEERS=all å‚æ•°è§£å†³çš„é—®é¢˜é€šè¿‡å®šæœŸå‘é€å¿ƒè·³åŒ…æ¥ä¿æŒ conntrack è¡¨ä¸­çš„è¿æ¥ä¿¡æ¯ã€‚ è¿™é‡Œè¿˜æ¶‰åŠåˆ°äº† NAT ç©¿è¶Šç›¸å…³å†…å®¹ï¼Œå°±ä¸å¤šå±•å¼€äº†ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥è‡ªè¡Œäº†è§£ã€‚ WireGuard çš„å®ç°ä¸­è¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„æ¦‚å¿µå«åš AllowedIPsï¼Œå®ƒæ˜¯ä¸€ä¸ª IP åœ°å€åˆ—è¡¨ï¼Œè¡¨ç¤ºå…è®¸å“ªäº› IP åœ°å€çš„æµé‡é€šè¿‡ WireGuard è™šæ‹Ÿç½‘ç»œã€‚ä¸ºäº†è¯¦ç»†è¯´æ˜è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸‹æœåŠ¡ç«¯é…ç½®æ–‡ä»¶å¤¹ä¸­ wg0 çš„é…ç½®ï¼š shell $ cat wg0.conf [Interface] Address = 10.13.13.1 ListenPort = 51820 PrivateKey = kGZzt/CU2MVgq19ffXB2YMDSr6WIhlkdlL1MOeGH700= # wg0 éš§é“å¯åŠ¨åæ·»åŠ  iptables è§„åˆ™ PostUp = iptables -A FORWARD -i %i -j ACCEPT; iptables -A FORWARD -o %i -j ACCEPT; iptables -t nat -A POSTROUTING -o eth+ -j MASQUERADE # wg0 éš§é“åœæ­¢ååˆ é™¤å‰é¢æ·»åŠ çš„ iptables è§„åˆ™ PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -D FORWARD -o %i -j ACCEPT; iptables -t nat -D POSTROUTING -o eth+ -j MASQUERADE [Peer] # peer1 PublicKey = HR8Kp3xWIt2rNdS3aaCk+Ss7yQqC9cn6h3WS6UK3WE0= PresharedKey = 7mCNCZdMKeRz1Zrpl9bFS08jJAdv6/USazRVq7tjznY= # AllowedIPs è®¾ç½®ä¸º peer1 çš„è™šæ‹Ÿ IP åœ°å€ï¼Œè¡¨ç¤ºå…è®¸ peer1 çš„æµé‡é€šè¿‡ WireGuard è™šæ‹Ÿç½‘ç»œ AllowedIPs = 10.13.13.2/32 AllowedIPs å®é™…å°±æ˜¯æ¯ä¸ª peer åœ¨æœåŠ¡ç«¯è·¯ç”±è¡¨ä¸­çš„ ip åœ°å€ï¼Œå®ƒæ—¢å¯ä»¥æ˜¯ ip ä¹Ÿå¯ä»¥æ˜¯ç½‘æ®µï¼Œè€Œä¸”èƒ½è®¾ç½®å¤šä¸ªï¼Œè¿™ä½¿æ‰€æœ‰ peer éƒ½å¯ä»¥è´Ÿè´£ä¸€ä¸ªç”šè‡³å¤šä¸ª ip æ®µçš„è½¬å‘ï¼Œä¹Ÿå°±æ˜¯å……å½“å±€åŸŸç½‘çš„è·¯ç”±å™¨â€”â€”VPN å­è·¯ç”±ã€‚ WireGuard æœ¬èº«åªæ˜¯ä¸€ä¸ªç‚¹å¯¹ç‚¹éš§é“åè®®ï¼Œå®ƒéå¸¸é€šç”¨ã€‚é€šè¿‡ AllowedIPs å‚æ•°ï¼Œæˆ‘ä»¬å°±èƒ½åœ¨æ¯ä¸ª peer ä¸Šæ·»åŠ å„ peers çš„é…ç½®ä¸ä¸åŒçš„è·¯ç”±è§„åˆ™ï¼Œæ„å»ºå‡ºå„ç§å¤æ‚çš„ç½‘ç»œæ‹“æ‰‘ï¼Œæ¯”å¦‚æ˜Ÿå‹ã€ç¯å‹ã€æ ‘å‹ç­‰ç­‰ã€‚ ","date":"2023-03-28","objectID":"/posts/wireguard-on-linux/:2:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["WireGuard","VPN","Linux","ç½‘ç»œ","iptables","conntrack"],"title":"Linux ä¸Šçš„ WireGuard ç½‘ç»œåˆ†æï¼ˆä¸€ï¼‰","uri":"/posts/wireguard-on-linux/#wireguard-æœåŠ¡ç«¯ç½‘ç»œåˆ†æ"},{"categories":["tech"],"content":" WireGuard å®¢æˆ·ç«¯ç½‘ç»œåˆ†æç°åœ¨æ¢å°è™šæ‹Ÿæœºè·‘ WireGuard å®¢æˆ·ç«¯ï¼Œé¦–å…ˆéœ€è¦å®‰è£… wireguard å‘½ä»¤è¡Œå·¥å…·ï¼š shell sudo apt install wireguard resolvconf ç¬¬äºŒæ­¥æ˜¯ä»æœåŠ¡ç«¯çš„é…ç½®æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ° peer1/peer1.confï¼Œå®ƒæ˜¯æœåŠ¡ç«¯å®¹å™¨æ ¹æ®å‚æ•° PEERS=1 è‡ªåŠ¨ç”Ÿæˆçš„å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ï¼Œå…ˆç¡®è®¤ä¸‹å®ƒçš„å†…å®¹ï¼š shell $ cd ./config/peer1 $ cat peer1.conf [Interface] Address = 10.13.13.2 PrivateKey = +GLDb5QQOHQ2QKWvuFS/4FiWpnivaxzwlm0QmFJIHV8= ListenPort = 51820 DNS = 10.13.13.1 [Peer] PublicKey = t95vF4b11RLCId3ArVVIJoC5Ih9CNbI0VTNuDuEzZyw= PresharedKey = 7mCNCZdMKeRz1Zrpl9bFS08jJAdv6/USazRVq7tjznY= # éœ€è¦æ³¨æ„çš„æ˜¯è¿™ä¸ª Peer Endpoint çš„ IP æ˜¯å¦æ­£ç¡® Endpoint = 192.168.5.198:51820 AllowedIPs = 0.0.0.0/0 æ’å…¥ä¸‹ï¼Œè¿™ä¸ª Endpoint çš„åœ°å€ä¹Ÿå¾ˆå€¼å¾—ä¸€è¯´ï¼Œèƒ½çœ‹åˆ°æœåŠ¡ç«¯ wg0.conf çš„é…ç½®ä¸­ï¼Œpeer1 å¹¶æœªè¢«è®¾ç½®ä»»ä½• Endpointï¼Œè¿™å®è´¨æ˜¯è¡¨ç¤ºè¿™ä¸ª peer1 çš„ Endpoint æ˜¯åŠ¨æ€çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡ peer1 å‘é€æ•°æ®åˆ°æœåŠ¡ç«¯ wg0 æ—¶ï¼ŒæœåŠ¡ç«¯é€šè¿‡è®¤è¯åŠ å¯†æŠ€æœ¯è®¤è¯äº†æ•°æ®åï¼Œå°±ä¼šä»¥æ•°æ®åŒ…çš„æ¥æº IP åœ°å€ä½œä¸º peer1 çš„ Endpointï¼Œè¿™æ · peer1 å°±å¯ä»¥éšæ„æ›´æ¢è‡ªå·±çš„ IP åœ°å€ï¼ˆRoamingï¼‰ï¼Œè€Œ WireGuard éš§é“ä»ç„¶èƒ½æ­£å¸¸å·¥ä½œï¼ˆIP é¢‘ç¹æ›´æ¢çš„ä¸€ä¸ªå…¸å‹åœºæ™¯å°±æ˜¯æ‰‹æœºçš„ç½‘ç»œæ¼«æ¸¸ä¸ WiFi åˆ‡æ¢ï¼‰ã€‚è¿™ä½¿ WireGuard å…·å¤‡äº†æ¯”è¾ƒæ˜æ˜¾çš„æ— è¿æ¥ç‰¹æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´ WireGuard éš§é“ä¸éœ€è¦ä¿æŒä¸€ä¸ªä»€ä¹ˆè¿æ¥ï¼Œåˆ‡æ¢ç½‘ç»œä¹Ÿä¸éœ€è¦é‡è¿ï¼Œåªè¦æ•°æ®åŒ…èƒ½å¤Ÿåˆ°è¾¾æœåŠ¡ç«¯ï¼Œå°±èƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚ å› ä¸ºæˆ‘è¿™é‡Œæ˜¯å†…ç½‘ç¯å¢ƒæµ‹è¯•ï¼Œé…ç½®æ–‡ä»¶ä¸­çš„ Peer - Endpoint çš„ IP åœ°å€ç›´æ¥ç”¨æœåŠ¡ç«¯çš„å†…ç½‘ IP åœ°å€å°±è¡Œï¼Œä¹Ÿå°±æ˜¯ 192.168.5.198ã€‚ å¦‚æœä½ çš„æœåŠ¡ç«¯æœ‰å…¬ç½‘ IP åœ°å€ï¼ˆæ¯”å¦‚æ˜¯äº‘æœåŠ¡å™¨ï¼Œæˆ–è€…é€šè¿‡ç«¯å£æ˜ å°„ç”¨å®¶åº­å®½å¸¦çš„åŠ¨æ€å…¬ç½‘ IPï¼‰ï¼Œè¿™ä¸ª Endpoint åœ°å€ä¹Ÿå¯ä»¥ä½¿ç”¨è¯¥å…¬ç½‘ IP åœ°å€ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚ é…ç½®æ–‡ä»¶ç¡®è®¤æ— è¯¯åï¼Œå°†è¯¥é…ç½®æ–‡ä»¶ä¿å­˜åˆ°å®¢æˆ·ç«¯çš„ /etc/wireguard/peer1.conf è¿™ä¸ªè·¯å¾„ä¸‹ï¼Œç„¶åä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯åŠ¨ WireGuard å®¢æˆ·ç«¯ï¼š shell sudo wg-quick up peer1 ä¸Šè¿°å‘½ä»¤ä¼šè‡ªåŠ¨åœ¨ /etc/wireguard/ ç›®å½•ä¸‹æ‰¾åˆ°åä¸º peer1.conf çš„é…ç½®æ–‡ä»¶ï¼Œç„¶åæ ¹æ®å…¶å†…å®¹å¯åŠ¨ä¸€ä¸ªåä¸º peer1 çš„ WireGuard è®¾å¤‡å¹¶å®Œæˆå¯¹åº”é…ç½®ã€‚ æˆ‘å¯åŠ¨æ—¶çš„æ—¥å¿—å¦‚ä¸‹ï¼Œwg-quick æ‰“å°å‡ºäº†å®ƒæ‰§è¡Œçš„æ‰€æœ‰ç½‘ç»œç›¸å…³æŒ‡ä»¤ï¼ˆæˆ‘æ·»åŠ äº†è¯¦ç»†çš„æ³¨é‡Šï¼‰ï¼š shell $ sudo wg-quick up peer1 [#] ip link add peer1 type wireguard # åˆ›å»ºä¸€ä¸ªåä¸º peer1 çš„ WireGuard è®¾å¤‡ [#] wg setconf peer1 /dev/fd/63 # è®¾ç½® peer1 è®¾å¤‡çš„é…ç½® [#] ip -4 address add 10.13.13.2 dev peer1 # è®¾ç½® peer1 è®¾å¤‡çš„ IP åœ°å€ [#] ip link set mtu 1420 up dev peer1 # è®¾ç½® peer1 è®¾å¤‡çš„ MTU [#] resolvconf -a tun.peer1 -m 0 -x # è®¾ç½® peer1 è®¾å¤‡çš„ DNSï¼Œç¡®ä¿ DNS èƒ½å¤Ÿæ­£å¸¸å·¥ä½œ [#] wg set peer1 fwmark 51820 # å°† peer1 è®¾å¤‡çš„é˜²ç«å¢™æ ‡è®°è®¾ä¸º 51820ï¼Œç”¨äºæ ‡è®° WireGuard å‡ºç«™æµé‡ # åœ¨åé¢çš„è·¯ç”±ç­–ç•¥ä¸­ä¼šä½¿ç”¨è¯¥æ ‡è®°ä½¿ WireGuard å‡ºç«™æµé‡èµ°é»˜è®¤è·¯ç”±è¡¨ [#] ip -4 route add 0.0.0.0/0 dev peer1 table 51820 # åˆ›å»ºå•ç‹¬çš„è·¯ç”±è¡¨ 51820ï¼Œé»˜è®¤å°†æ‰€æœ‰æµé‡è½¬å‘åˆ° peer1 æ¥å£ [#] ip -4 rule add not fwmark 51820 table 51820 # æ‰€æœ‰ä¸å¸¦ 51820 æ ‡è®°çš„æµé‡ï¼ˆæ™®é€šæµé‡ï¼‰ï¼Œéƒ½è½¬å‘åˆ°å‰é¢æ–°å»ºçš„è·¯ç”±è¡¨ 51820 # ä¹Ÿå°±æ˜¯æ‰€æœ‰æ™®é€šæµé‡éƒ½è½¬å‘åˆ° peer1 æ¥å£ [#] ip -4 rule add table main suppress_prefixlength 0 # æµé‡å…¨éƒ½èµ° main è·¯ç”±è¡¨ï¼ˆå³é»˜è®¤è·¯ç”±è¡¨ï¼‰ï¼Œä½†æ˜¯æ’é™¤æ‰å‰ç¼€é•¿åº¦ï¼ˆæ©ç ï¼‰ \u003c= 0 çš„æµé‡ # æ©ç  \u003c= 0 çš„åªæœ‰ 0.0.0.0/0ï¼Œå³é»˜è®¤è·¯ç”±ã€‚æ‰€ä»¥æ„æ€æ˜¯æ‰€æœ‰éé»˜è®¤è·¯ç”±ç­–ç•¥çš„æµé‡éƒ½èµ° main è·¯ç”±è¡¨ [#] sysctl -q net.ipv4.conf.all.src_valid_mark=1 # å¯ç”¨æºåœ°å€æœ‰æ•ˆæ€§æ£€æŸ¥ï¼Œç”¨äºé˜²æ­¢ä¼ªé€ æºåœ°å€ [#] nft -f /dev/fd/63 # é…ç½® nftables è§„åˆ™ï¼Œç”¨äºç¡®ä¿ WireGuard æµé‡èƒ½æ­£ç¡®è·¯ç”±ï¼Œå¹¶é˜²æ­¢æ¶æ„æ•°æ®åŒ…è¿›å…¥ç½‘ç»œ è·‘å®Œåæˆ‘ä»¬ç°åœ¨ç¡®è®¤ä¸‹çŠ¶æ€ï¼Œåº”è¯¥æ˜¯èƒ½æ­£å¸¸èµ° WireGuard è®¿é—®ç›¸å…³ç½‘ç»œäº†ï¼Œå¯ä»¥ WireShark æŠ“ä¸ªåŒ…ç¡®è®¤ä¸‹ã€‚ å¦‚æœç½‘ç»œä¸é€šï¼Œé‚£è‚¯å®šæ˜¯ä¸­é—´å“ªä¸€æ­¥é…ç½®æœ‰é—®é¢˜ï¼Œå¯ä»¥æ ¹æ®ä¸Šé¢çš„æ—¥å¿—ä¸€æ­¥æ­¥æ’æŸ¥ç½‘ç»œæ¥å£ã€è·¯ç”±è¡¨ã€è·¯ç”±ç­–ç•¥ã€iptables/nftables çš„é…ç½®ï¼Œå¿…è¦æ—¶å¯ä»¥é€šè¿‡ WireShark æŠ“åŒ…å®šä½ã€‚ ç°åœ¨å†æ£€æŸ¥ä¸‹ç³»ç»Ÿçš„ç½‘ç»œçŠ¶æ€ï¼Œé¦–å…ˆæ£€æŸ¥ä¸‹è·¯ç”±è¡¨ï¼Œä¼šå‘ç°è·¯ç”±è¡¨æ²¡ä»»ä½•å˜åŒ–ï¼š shell $ ip route ls default via 192.168.5.201 dev eth0 proto static 192.168.5.0/24 dev eth0 proto kernel scope link src 192.168.5.197 ä½†æ˜¯æˆ‘ä»¬çš„ WireGuard éš§é“å·²ç»ç”Ÿæ•ˆäº†ï¼Œè¿™å°±è¯´æ˜ç°åœ¨æˆ‘ä»¬çš„æµé‡å·²ç»ä¸æ˜¯ç›´æ¥èµ°ä¸Šé¢è¿™ä¸ªé»˜è®¤è·¯ç”±è¡¨äº†ï¼Œè¿˜æœ‰å…¶ä»–é…ç½®åœ¨èµ·ä½œç”¨ã€‚å¾€å›çœ‹çœ‹å‰é¢çš„å®¢æˆ·ç«¯å¯åŠ¨æ—¥å¿—ï¼Œå…¶ä¸­æ˜¾ç¤º wg-quick åˆ›å»ºäº†ä¸€ä¸ªåä¸º 51820 çš„è·¯ç”±è¡¨ï¼Œæˆ‘ä»¬æ¥æ£€æŸ¥ä¸‹è¿™ä¸ªè¡¨ï¼š shell ryan@ubuntu-2004-builder:~$ ip route ls table 51820 default dev peer1 scope link èƒ½çœ‹åˆ°è¿™ä¸ªè¡¨ç¡®å®æ˜¯å°†æ‰€æœ‰æµé‡éƒ½è½¬å‘åˆ°äº† WireGuard çš„ peer1 æ¥å£ï¼ŒåŸºæœ¬èƒ½ç¡®è®¤ç°åœ¨æµé‡éƒ½èµ°äº†è¿™ä¸ªè·¯ç”±è¡¨ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œç³»ç»Ÿçš„æµé‡æ˜¯å¦‚ä½•è¢«è½¬å‘åˆ°è¿™ä¸ªè·¯ç”±è¡¨çš„å‘¢ï¼Ÿä¸ºä»€ä¹ˆé»˜è®¤çš„è·¯ç”±è¡¨ç°åœ¨ä¸ç”Ÿæ•ˆäº†ï¼Ÿ è¦ç†æ¸…è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦è¡¥å……ç‚¹çŸ¥è¯†â€”â€”Linux ä» 2.2 å¼€å§‹æ”¯æŒäº†å¤šè·¯ç”±è¡¨ï¼Œå¹¶é€šè¿‡è·¯ç”±ç­–ç•¥æ•°æ®åº“æ¥ä¸ºæ¯ä¸ªæ•°æ®åŒ…é€‰æ‹©æ­£ç¡®çš„è·¯ç”±è¡¨ï¼Œè¿™ä¸ªè·¯ç”±ç­–ç•¥æ•°æ®åº“å¯ä»¥é€šè¿‡ ip rule å‘½ä»¤æ¥æŸ¥çœ‹ã€ä¿®æ”¹ã€‚ å‰ç½®çŸ¥è¯†è¡¥å……å®Œæ¯•ï¼Œç°åœ¨æ¥çœ‹ä¸‹ç³»ç»Ÿå½“å‰çš„è·¯ç”±ç­–ç•¥ï¼ŒåŒæ ·æˆ‘å·²ç»è¡¥å……å¥½äº†æ³¨é‡Šï¼š shell $ ip rule show 0: from all lookup local # 0 æ˜¯æœ€é«˜ä¼˜å…ˆçº§ï¼Œ`all` è¡¨ç¤ºæ‰€æœ‰æµé‡ï¼Œ`lookup local` è¡¨ç¤ºæŸ¥æ‰¾ local è·¯ç”±è¡¨ã€‚ # local æ˜¯ä¸€ä¸ªç‰¹æ®Šè·¯ç”±è¡¨ï¼ŒåŒ…å«å¯¹æœ¬åœ°å’Œå¹¿æ’­åœ°å€çš„ä¼˜å…ˆçº§æ§åˆ¶è·¯ç”±ã€‚ 32764: from all lookup main suppress_prefixlength 0 # 32764 ç›®å‰æ˜¯ç¬¬äºŒä¼˜å…ˆçº§ï¼Œå°†æ‰€æœ‰æµé‡è·¯ç”±åˆ° main è·¯ç”±è¡¨ï¼Œä½†æ˜¯æ’é™¤æ‰é»˜è®¤è·¯ç”±ï¼ˆå‰ç¼€/æ©ç  \u003c= 0ï¼‰ # åŠŸèƒ½æ˜¯è®©æ‰€æœ‰éé»˜è®¤è·¯ç”±çš„æµé‡éƒ½èµ° main è·¯ç”±è¡¨ # è¿™æ¡è§„åˆ™å‰é¢å®é™…è§£é‡Šè¿‡äº†ï¼Œå®ƒæ˜¯ wg-quick åœ¨å¯åŠ¨éš§é“æ—¶æ·»åŠ çš„è§„åˆ™ã€‚ 32765: not from all fwmark 0xca6c lookup 51820 # æ‰€æœ‰ä¸å¸¦ 0xca6c æ ‡è®°ï¼ˆ51820 çš„ 16 è¿›åˆ¶æ ¼å¼ï¼‰çš„æµé‡ï¼ˆæ™®é€šæµé‡ï¼‰ï¼Œéƒ½èµ° 51820 è·¯ç”±è¡¨ # ä¹Ÿå°±æ˜¯éƒ½è½¬å‘åˆ° WireGuard peer1 æ¥å£ã€‚ # è¿™æ¡è§„åˆ™æ˜¯å‰é¢çš„ `ip -4 rule add not fwmark 51820 table 51820` å‘½ä»¤æ·»åŠ çš„ã€‚ # è€Œå®ƒæ‰€åŒ¹é…çš„é˜²ç«å¢™æ ‡è®°åˆ™æ˜¯ç”±å‰é¢çš„ `wg set peer1 fwmark 51820` å‘½ä»¤è®¾ç½®çš„ã€‚ 32766: from all lookup main # æ‰€æœ‰æµé‡éƒ½èµ° main è·¯ç”±è¡¨ï¼Œå½“å‰æ˜¯ä¸ç”Ÿæ•ˆçŠ¶æ€ï¼Œå› ä¸ºå‰é¢çš„è§„åˆ™ä¼˜å…ˆçº§æ›´é«˜ã€‚ # main æ˜¯ç³»ç»Ÿçš„é»˜è®¤è·¯ç”±è¡¨ï¼Œé€šå¸¸æˆ‘ä»¬ä½¿ç”¨ ip route å‘½ä»¤éƒ½æ˜¯åœ¨è¿™ä¸ªè¡¨ä¸Šæ“ä½œã€‚ 32767: from all lookup default # æ‰€æœ‰æµé‡éƒ½èµ° default è·¯ç”±è¡¨ï¼Œå½“å‰åŒæ ·æ˜¯ä¸ç”Ÿæ•ˆçŠ¶æ€ã€‚ # default æ˜¯ä¸€ä¸ªç³»ç»Ÿç”Ÿæˆçš„å…œåº•è·¯ç”±è¡¨ï¼Œé»˜è®¤ä¸åŒ…å«ä»»ä½•è·¯ç”±è§„åˆ™ï¼Œå¯ç”¨äºè‡ªå®šä¹‰è·¯ç”±ç­–ç•¥ï¼Œä¹Ÿå¯åˆ é™¤ã€‚ ç»“åˆæ³¨é‡Šçœ‹å®Œä¸Šé¢çš„è·¯ç”±ç­–ç•¥ï¼Œç°åœ¨ä½ åº”è¯¥ç†æ¸…æ¥š WireGuard çš„è·¯ç”±è§„åˆ™äº†ï¼Œå®ƒåŠ äº†æ¡æ¯”é»˜è®¤è·¯ç”±ç­–ç•¥ 32766 ä¼˜å…ˆçº§æ›´é«˜çš„è·¯ç”±ç­–ç•¥ 32765ï¼Œå°†æ‰€æœ‰æ™®é€šæµé‡éƒ½é€šè¿‡å®ƒçš„è‡ªå®šä¹‰è·¯ç”±è¡¨è·¯ç”±åˆ° peer1 æ¥å£ã€‚å¦ä¸€æ–¹é¢ ","date":"2023-03-28","objectID":"/posts/wireguard-on-linux/:3:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["WireGuard","VPN","Linux","ç½‘ç»œ","iptables","conntrack"],"title":"Linux ä¸Šçš„ WireGuard ç½‘ç»œåˆ†æï¼ˆä¸€ï¼‰","uri":"/posts/wireguard-on-linux/#wireguard-å®¢æˆ·ç«¯ç½‘ç»œåˆ†æ"},{"categories":["tech"],"content":" ç»“è¯­ä¸€é€šåˆ†æï¼Œä½ æ˜¯å¦æ„Ÿè§‰åˆ°äº† wg-quick çš„å®ç°ååˆ†å·§å¦™ï¼Œé€šè¿‡ç®€å•å‡ è¡Œ iptables/nftables ä¸ iproute2 å‘½ä»¤å°±åœ¨ WireGuard éš§é“ä¸Šå®ç°äº†ä¸€ä¸ª VPN ç½‘ç»œï¼Œæ›´å¦™çš„æ˜¯åªè¦æŠŠæ–°å¢çš„è¿™äº› iptables/nftables ä¸ iproute2 è§„åˆ™åˆ é™¤ï¼Œå°±èƒ½æ¢å¤åˆ° WireGuard æœªå¯åŠ¨çš„çŠ¶æ€ï¼Œç›¸å½“äºæ•´ä¸ªå·¥ä½œæ˜¯å®Œå…¨å¯é€†çš„ï¼ˆæ˜¾ç„¶å‰é¢çš„ sudo wg-quick down peer1 å°±æ˜¯è¿™ä¹ˆå¹²çš„ï¼‰ã€‚ æ€»ä¹‹è¿™ç¯‡æ–‡ç« ç®€å•åˆ†æäº† wireguard è™šæ‹Ÿç½‘ç»œåœ¨ Linux ä¸Šçš„å®ç°ï¼Œå¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚ ä¸‹ä¸€ç¯‡æ–‡ç« ï¼ˆå¦‚æœæœ‰çš„è¯â€¦ï¼‰ï¼Œæˆ‘ä¼šå¸¦æ¥æ›´å¤šçš„ WireGuard å®ç°ç»†èŠ‚ï¼Œæ•¬è¯·æœŸå¾…ã€‚ ","date":"2023-03-28","objectID":"/posts/wireguard-on-linux/:4:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["WireGuard","VPN","Linux","ç½‘ç»œ","iptables","conntrack"],"title":"Linux ä¸Šçš„ WireGuard ç½‘ç»œåˆ†æï¼ˆä¸€ï¼‰","uri":"/posts/wireguard-on-linux/#ç»“è¯­"},{"categories":["tech"],"content":" å‚è€ƒ wireguard protocolï¼š å®˜æ–¹æ–‡æ¡£è¿˜æœ‰å®˜æ–¹çš„ç™½çš®ä¹¦ï¼Œéƒ½å†™å¾—å¾ˆæ¸…æ™°æ˜“æ‡‚ã€‚ WireGuardåˆ°åº•å¥½åœ¨å“ªï¼Ÿ: æ¯”è¾ƒæ·±å…¥æµ…å‡ºçš„éšæƒ³ï¼Œå€¼å¾—ä¸€è¯»ã€‚ Understanding modern Linux routing (and wg-quick): å¯¹ WireGuard å®¢æˆ·ç«¯ç”¨åˆ°çš„å¤šè·¯ç”±è¡¨ä¸è·¯ç”±ç­–ç•¥æŠ€æœ¯åšäº†è¯¦ç»†çš„ä»‹ç»ã€‚ å®ƒçš„ä¸­æ–‡ç¿»è¯‘ï¼šWireGuard åŸºç¡€æ•™ç¨‹ï¼šwg-quick è·¯ç”±ç­–ç•¥è§£è¯» - ç±³å¼€æœ—åŸºæ‰¬ ","date":"2023-03-28","objectID":"/posts/wireguard-on-linux/:5:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["WireGuard","VPN","Linux","ç½‘ç»œ","iptables","conntrack"],"title":"Linux ä¸Šçš„ WireGuard ç½‘ç»œåˆ†æï¼ˆä¸€ï¼‰","uri":"/posts/wireguard-on-linux/#å‚è€ƒ"},{"categories":["tech"],"content":" é›¶ã€ç¡¬ä»¶å‡†å¤‡ä¸ä¾èµ–åº“è°ƒç ”ä¹‹å‰æ·˜è´§ä¹°äº†æŒºå¤šæ˜¾ç¤ºå±çš„ï¼Œæœ¬æ–‡ä½¿ç”¨çš„æ˜¯è¿™ä¸€å—ï¼š 3.5 å¯¸ç”µé˜»è§¦æ‘¸å±ï¼Œ480 * 320ï¼ŒSPI åè®®ï¼Œæ˜¾ç¤ºå±é©±åŠ¨ IC ä¸º ILI9488 å¼€å‘æ¿æ˜¯ ESP-WROOM-32 æ¨¡ç»„å¼€å‘æ¿ã€‚å…¶ä»–éœ€è¦çš„ä¸œè¥¿ï¼šæœé‚¦çº¿ã€é¢åŒ…æ¿ã€å››ä¸ª 10 K$\\Omega$ ç”µé˜»ã€å››ä¸ªæŒ‰é”®ã€‚ è‡³äºéœ€è¦çš„ä¾èµ–åº“ï¼Œæˆ‘æ‰¾åˆ°å¦‚ä¸‹å‡ ä¸ª stars æ•°è¾ƒé«˜çš„æ”¯æŒ ILI9488 + ESP32 çš„æ˜¾ç¤ºå±é©±åŠ¨åº“ï¼š Bodmer/TFT_eSPI: ä¸€ä¸ªåŸºäº Arudino æ¡†æ¶çš„ tft æ˜¾ç¤ºå±é©±åŠ¨ï¼Œæ”¯æŒ STM32/ESP32 ç­‰å¤šç§èŠ¯ç‰‡ã€‚ lv_port_esp32: lvgl å®˜æ–¹æä¾›çš„ esp32 portï¼Œä½†æ˜¯å‡ ç™¾å¹´ä¸æ›´æ–°äº†ï¼Œç›®å‰ä»…æ”¯æŒåˆ° esp-idf v4ï¼Œè¯•ç”¨äº†ä¸€æ³¢è¢«å‘äº†ï¼Œä¸å»ºè®®ä½¿ç”¨ã€‚ esp-idf/peripherals/lcd: ESP å®˜æ–¹çš„ lcd ç¤ºä¾‹ï¼Œä¸è¿‡ä»…æ”¯æŒéƒ¨åˆ†å¸¸è§æ˜¾ç¤ºå±é©±åŠ¨ï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œç”¨çš„ ili9488 å®˜æ–¹å°±æ²¡æœ‰ã€‚ æ€»ä¹‹å¼ºçƒˆæ¨è TFT_eSPI è¿™ä¸ªåº“ï¼Œå¾ˆå¥½ç”¨ï¼Œè€Œä¸”é©±åŠ¨æ”¯æŒå¾ˆé½å…¨ã€‚ ","date":"2023-03-05","objectID":"/posts/ee-basics-2-esp32-display/:1:0","series":["EE å…¥é—¨"],"tags":["ç”µå­ç”µè·¯","Electrical Engineering","MCU","ESP32","SPI","GPIO","è´ªåƒè›‡","æ˜¾ç¤ºå±"],"title":"EE å…¥é—¨ï¼ˆäºŒï¼‰ - ä½¿ç”¨ ESP32 ä¸ SPI æ˜¾ç¤ºå±ç»˜å›¾ã€æ˜¾ç¤ºå›¾ç‰‡ã€è·‘è´ªåƒè›‡","uri":"/posts/ee-basics-2-esp32-display/#é›¶ç¡¬ä»¶å‡†å¤‡ä¸ä¾èµ–åº“è°ƒç ”"},{"categories":["tech"],"content":" ä¸€ã€å¼€å‘ç¯å¢ƒæ­å»ºã€ç”µè·¯æ­å»ºä¸æµ‹è¯•","date":"2023-03-05","objectID":"/posts/ee-basics-2-esp32-display/:2:0","series":["EE å…¥é—¨"],"tags":["ç”µå­ç”µè·¯","Electrical Engineering","MCU","ESP32","SPI","GPIO","è´ªåƒè›‡","æ˜¾ç¤ºå±"],"title":"EE å…¥é—¨ï¼ˆäºŒï¼‰ - ä½¿ç”¨ ESP32 ä¸ SPI æ˜¾ç¤ºå±ç»˜å›¾ã€æ˜¾ç¤ºå›¾ç‰‡ã€è·‘è´ªåƒè›‡","uri":"/posts/ee-basics-2-esp32-display/#ä¸€å¼€å‘ç¯å¢ƒæ­å»ºç”µè·¯æ­å»ºä¸æµ‹è¯•"},{"categories":["tech"],"content":" 1. åˆ›å»ºé¡¹ç›®å¹¶é…ç½®å¥½ç¯å¢ƒESP32 å¼€å‘æœ‰å¥½å‡ ç§æ–¹å¼ï¼š vscode çš„ esp-idf æ’ä»¶ + å®˜æ–¹çš„ esp-idf å·¥å…· vscode çš„ platformio æ’ä»¶ + arudino æ¡†æ¶ Bodmer/TFT_eSPI è¿™ä¸ªä¾èµ–åº“ä¸¤ç§æ–¹å¼éƒ½æ”¯æŒï¼Œä¸è¿‡çœ‹äº†ä¸‹å®˜æ–¹æ–‡æ¡£ï¼Œä»“åº“ä½œè€…è¡¨ç¤º ESP-IDF çš„æ”¯æŒæ˜¯å…¶ä»–äººæä¾›çš„ï¼Œä»–ä¸ä¿è¯èƒ½ç”¨ï¼Œæ‰€ä»¥ç¨³å¦¥èµ·è§æˆ‘é€‰æ‹©äº† PlatformIO + Arduino æ¡†æ¶ä½œä¸ºå¼€å‘ç¯å¢ƒã€‚ é¦–å…ˆå½“ç„¶æ˜¯åˆ›å»ºä¸€ä¸ªç©ºé¡¹ç›®ï¼Œç‚¹å‡» VSCode ä¾§æ çš„ PlatformIO å›¾æ ‡ï¼Œå†ç‚¹å‡»åˆ—è¡¨ä¸­çš„PlatformIO Core CLI é€‰é¡¹è¿›å…¥ shell æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š shell pio project init --ide=vscode -d tft_esp32_arduino è¿™æ¡å‘½ä»¤ä¼šåˆ›å»ºä¸€ä¸ªç©ºé¡¹ç›®ï¼Œå¹¶é…ç½®å¥½ vscode æ’ä»¶ç›¸å…³é…ç½®ï¼Œè¿™æ ·å°±ç®—å®Œæˆäº†ä¸€ä¸ªç©ºçš„é¡¹ç›®æ¡†æ¶ã€‚ ","date":"2023-03-05","objectID":"/posts/ee-basics-2-esp32-display/:2:1","series":["EE å…¥é—¨"],"tags":["ç”µå­ç”µè·¯","Electrical Engineering","MCU","ESP32","SPI","GPIO","è´ªåƒè›‡","æ˜¾ç¤ºå±"],"title":"EE å…¥é—¨ï¼ˆäºŒï¼‰ - ä½¿ç”¨ ESP32 ä¸ SPI æ˜¾ç¤ºå±ç»˜å›¾ã€æ˜¾ç¤ºå›¾ç‰‡ã€è·‘è´ªåƒè›‡","uri":"/posts/ee-basics-2-esp32-display/#1-åˆ›å»ºé¡¹ç›®å¹¶é…ç½®å¥½ç¯å¢ƒ"},{"categories":["tech"],"content":" 1. æ˜¾ç¤ºå±æ¥çº¿ä¸é¡¹ç›®å‚æ•°é…ç½®ç½‘ä¸Šç®€å•æœäº†ä¸‹ ESP32 pinoutï¼Œæ‰¾åˆ°è¿™å¼ å›¾ï¼Œå¼•è„šå®šä¹‰ä¸æˆ‘çš„ ESP32 å¼€å‘æ¿å®Œå…¨ä¸€è‡´ï¼Œç”¨åšæ¥çº¿å‚è€ƒï¼š å¯ä»¥çœ‹åˆ°è¿™å— ESP32 å¼€å‘æ¿æœ‰ä¸¤ä¸ª SPI ç«¯å£ï¼šHSPI è·Ÿ VSPIï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ HSPIï¼Œé‚£ä¹ˆ MOSI/MISO/SCK ä¸‰ä¸ªå¼•è„šçš„æ¥çº¿å¿…é¡»ä¸ä¸Šå›¾çš„å®šä¹‰å®Œå…¨ä¸€è‡´ã€‚è€Œå…¶ä»–å¼•è„šéšä¾¿æ‰¾ä¸ªæ™®é€š GPIO å£æ¥ä¸Šå°±è¡Œã€‚ æ­¤å¤–èƒŒå…‰ç¯çš„çº¿æˆ‘è¯•äº†ä¸‹æ¥ GPIO å£ä¸å¥½ä½¿ï¼Œå»ºè®®ç›´æ¥æ¥åœ¨ 3V3 å¼•è„šä¸Šï¼ˆç¼ºç‚¹å°±æ˜¯æ²¡æ³•é€šè¿‡ç¨‹åºå…³é—­èƒŒå…‰ï¼Œé—®é¢˜ä¸å¤§ï¼‰ã€‚ æˆ‘çš„æ¥çº¿å¦‚ä¸‹ï¼š ä½¿ç”¨ wokwi.com åˆ¶ä½œçš„ç¤ºæ„å›¾ æ¥çº¿å®æ“ çº¿æ¥å¥½åéœ€è¦æ›´æ–°ä¸‹ PlatformIO é¡¹ç›®æ ¹ç›®å½• platformio.ini çš„é…ç½®ï¼Œä½¿å…¶æ˜¾ç¤ºå±å¼•è„šç›¸å…³çš„å‚æ•°ä¸æˆ‘ä»¬çš„æ¥çº¿å®Œå…¨å¯¹åº”èµ·æ¥ï¼Œè¿™æ ·æ‰èƒ½æ­£å¸¸é©±åŠ¨è¿™ä¸ªæ˜¾ç¤ºå±ã€‚ è¿™é‡Œæˆ‘ä»¥é©±åŠ¨åº“å®˜æ–¹æä¾›çš„æ¨¡æ¿Bodmer/TFT_eSPI/docs/PlatformIO ä¸ºåŸºç¡€ï¼Œæ›´æ–°äº†å…¶æ„å»ºå‚æ•°å¯¹åº”çš„å¼•è„šï¼ŒåŠ äº†ç‚¹æ³¨é‡Šï¼Œå¾—åˆ°çš„å†…å®¹å¦‚ä¸‹ï¼ˆå¦‚æœä½ çš„æ¥çº¿ä¸æˆ‘ä¸€è‡´ï¼Œç›´æ¥æŠ„å°±è¡Œï¼‰ï¼š ini [env:esp32dev] platform = espressif32 board = esp32dev framework = arduino lib_deps = bodmer/TFT_eSPI@^2.5.0 Bodmer/TFT_eWidget@^0.0.5 monitor_speed = 115200 build_flags = -Os -DCORE_DEBUG_LEVEL=ARDUHAL_LOG_LEVEL_DEBUG -DUSER_SETUP_LOADED=1 ; Define the TFT driver, pins etc here: ; æ˜¾ç¤ºå±é©±åŠ¨è¦å¯¹å¾—ä¸Š -DILI9488_DRIVER=1 # å®½åº¦ä¸é«˜åº¦ -DTFT_WIDTH=480 -DTFT_HEIGHT=320 # SPI å¼•è„šçš„æ¥çº¿æ–¹å¼ï¼Œ -DTFT_MISO=12 -DTFT_MOSI=13 # SCLK åœ¨æ˜¾ç¤ºå±ä¸Šå¯¹åº”çš„å¼•è„šå¯èƒ½å« SCKï¼Œæ˜¯åŒä¸€ä¸ªä¸œè¥¿ -DTFT_SCLK=14 -DTFT_CS=15 # DC åœ¨æ˜¾ç¤ºå±ä¸Šå¯¹åº”çš„å¼•è„šå¯èƒ½å« RS æˆ–è€… DC/RSï¼Œæ˜¯åŒä¸€ä¸ªä¸œè¥¿ -DTFT_DC=4 -DTFT_RST=2 # èƒŒå…‰æš‚æ—¶ç›´æ¥æ¥åœ¨ 3V3 ä¸Š ; -DTFT_BL=27 # è§¦æ‘¸ï¼Œæš‚æ—¶ä¸ç”¨ ;-DTOUCH_CS=22 -DLOAD_GLCD=1 # å…¶ä»–é…ç½®ï¼Œä¿æŒé»˜è®¤å³å¯ -DLOAD_FONT2=1 -DLOAD_FONT4=1 -DLOAD_FONT6=1 -DLOAD_FONT7=1 -DLOAD_FONT8=1 -DLOAD_GFXFF=1 -DSMOOTH_FONT=1 -DSPI_FREQUENCY=27000000 ä¿®å¥½åä¿å­˜ä¿®æ”¹ï¼Œplatformio å°†ä¼šè‡ªåŠ¨æ£€æµ‹åˆ°é…ç½®æ–‡ä»¶å˜æ›´ï¼Œå¹¶æ ¹æ®é…ç½®æ–‡ä»¶ä¸‹è½½ Arduino/ESP32 å·¥å…·é“¾ï¼Œæ›´æ–°æ„å»ºé…ç½®ã€æ‹‰å–ä¾èµ–åº“ï¼ˆå»ºè®®å¼€ä¸ªå…¨å±€ä»£ç†ï¼Œä¸ç„¶ä¸‹è½½ä¼šè´¼æ…¢ï¼‰ã€‚ ","date":"2023-03-05","objectID":"/posts/ee-basics-2-esp32-display/:2:2","series":["EE å…¥é—¨"],"tags":["ç”µå­ç”µè·¯","Electrical Engineering","MCU","ESP32","SPI","GPIO","è´ªåƒè›‡","æ˜¾ç¤ºå±"],"title":"EE å…¥é—¨ï¼ˆäºŒï¼‰ - ä½¿ç”¨ ESP32 ä¸ SPI æ˜¾ç¤ºå±ç»˜å›¾ã€æ˜¾ç¤ºå›¾ç‰‡ã€è·‘è´ªåƒè›‡","uri":"/posts/ee-basics-2-esp32-display/#1-æ˜¾ç¤ºå±æ¥çº¿ä¸é¡¹ç›®å‚æ•°é…ç½®"},{"categories":["tech"],"content":" 3. æµ‹è¯•éªŒè¯ç°åœ¨æ‰¾å‡ ä¸ª demo è·‘è·‘çœ‹ï¼Œæ–°å»ºæ–‡ä»¶ src/main.inoï¼Œä»å¦‚ä¸‹æ–‡ä»¶å¤¹ä¸­éšä¾¿æ‰¾ä¸ª demo copy è¿›å»ç„¶åç¼–è¯‘ä¸Šä¼ ï¼Œçœ‹çœ‹æ•ˆæœï¼š Bodmer/TFT_eSPI - examples/480x320 å¯ä»¥ç›´æ¥ä» libdeps ä¸­ copy examples ä»£ç è¿‡æ¥æµ‹è¯•ï¼šcp .pio/libdeps/esp32dev/TFT_eSPI/examples/480\\ x\\ 320/TFT_Meters/TFT_Meters.ino src/main.ino æˆ‘è·‘å‡ºæ¥çš„æ•ˆæœï¼š ","date":"2023-03-05","objectID":"/posts/ee-basics-2-esp32-display/:2:3","series":["EE å…¥é—¨"],"tags":["ç”µå­ç”µè·¯","Electrical Engineering","MCU","ESP32","SPI","GPIO","è´ªåƒè›‡","æ˜¾ç¤ºå±"],"title":"EE å…¥é—¨ï¼ˆäºŒï¼‰ - ä½¿ç”¨ ESP32 ä¸ SPI æ˜¾ç¤ºå±ç»˜å›¾ã€æ˜¾ç¤ºå›¾ç‰‡ã€è·‘è´ªåƒè›‡","uri":"/posts/ee-basics-2-esp32-display/#3-æµ‹è¯•éªŒè¯"},{"categories":["tech"],"content":" äºŒã€æ˜¾ç¤ºå›¾ç‰‡ã€æ–‡å­—è¿™éœ€è¦é¦–å…ˆå°†å›¾ç‰‡/æ–‡å­—è½¬æ¢æˆ bitmap æ ¼å¼çš„ C ä»£ç ï¼Œå¯ä½¿ç”¨åœ¨çº¿å·¥å…·javl/image2cpp è¿›è¡Œè½¬æ¢ï¼Œç®€å•æ¼”ç¤ºä¸‹ï¼š æ³¨æ„é«˜åº¦ä¸å®½åº¦è°ƒæ•´ä¸ºä¸å±å¹•å¤§å°ä¸€è‡´ï¼Œè®¾ç½®æ”¾ç¼©æ¨¡å¼ï¼Œç„¶åè‰²å½©æ”¹ä¸º RGB565ï¼Œæœ€åä¸Šä¼ å›¾ç‰‡ã€ç”Ÿæˆä»£ç ã€‚ å°†ç”Ÿæˆå¥½çš„ä»£ç è´´åˆ° src/test_img.h ä¸­ï¼š c // We need this header file to use FLASH as storage with PROGMEM directive: // Icon width and height const uint16_t imgWidth = 480; const uint16_t imgHeight = 320; // 'evt_source', 480x320px const uint16_t epd_bitmap_evt_source [] PROGMEM = { // è¿™é‡Œçœç•¥æ‰å›¾ç‰‡å†…å®¹...... } ç„¶åå†™ä¸ªä¸»ç¨‹åº src/main.ino æ˜¾ç¤ºå›¾åƒï¼š c #include \u003cTFT_eSPI.h\u003e // Hardware-specific library TFT_eSPI tft = TFT_eSPI(); // Invoke custom library // Include the header files that contain the icons #include \"test_img.h\" void setup() { Serial.begin(115200); tft.begin(); tft.setRotation(1); // landscape tft.fillScreen(TFT_BLACK); // Swap the colour byte order when rendering tft.setSwapBytes(true); // æ˜¾ç¤ºå›¾ç‰‡ tft.pushImage(0, 0, imgWidth, imgHeight, epd_bitmap_evt_source); delay(2000); } void loop() {} ç¼–è¯‘ä¸Šä¼ ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š ","date":"2023-03-05","objectID":"/posts/ee-basics-2-esp32-display/:3:0","series":["EE å…¥é—¨"],"tags":["ç”µå­ç”µè·¯","Electrical Engineering","MCU","ESP32","SPI","GPIO","è´ªåƒè›‡","æ˜¾ç¤ºå±"],"title":"EE å…¥é—¨ï¼ˆäºŒï¼‰ - ä½¿ç”¨ ESP32 ä¸ SPI æ˜¾ç¤ºå±ç»˜å›¾ã€æ˜¾ç¤ºå›¾ç‰‡ã€è·‘è´ªåƒè›‡","uri":"/posts/ee-basics-2-esp32-display/#äºŒæ˜¾ç¤ºå›¾ç‰‡æ–‡å­—"},{"categories":["tech"],"content":" ä¸‰ã€å†™ä¸ªæç®€è´ªåƒè›‡æ¸¸æˆN å¹´å‰æˆ‘å†™çš„ç¬¬ä¸€ç¯‡åšå®¢æ–‡ç« ï¼Œæ˜¯ç”¨ C è¯­è¨€å†™ä¸€ä¸ªè´ªåƒè›‡ï¼Œè¿™é‡ŒæŠŠå®ƒç§»æ¤è¿‡æ¥ç©ç©çœ‹~ æˆ‘çš„æ—§æ–‡ç« åœ°å€ä¸ºï¼šè´ªåƒè›‡â€”Câ€”åŸºäºeasyxå›¾å½¢åº“(ä¸‹):ä»ç”»å›¾ç¨‹åºåˆ°è´ªåƒè›‡ã€è‡ªå¸¦ç©¿å¢™æœ¯ã€‘ ï¼Œ é‡Œé¢è¯¦ç»†ä»‹ç»äº†ç¨‹åºçš„æ€è·¯ã€‚ é‚£ä¹ˆç°åœ¨å¼€å§‹ä»£ç ç§»æ¤ï¼ŒTFT å±å¹•å‰é¢å·²ç»æ¥å¥½äº†ä¸éœ€è¦åŠ¨ï¼Œè¦æ”¹çš„åªæœ‰è½¯ä»¶éƒ¨åˆ†ï¼Œè¿˜æœ‰å°±æ˜¯æ·»åŠ ä¸Šä¸‹å·¦å³å››ä¸ªæŒ‰é”®çš„ç”µè·¯ã€‚ é¦–å…ˆæ¸…ç©º src æ–‡ä»¶å¤¹ï¼Œæ–°å»ºæ–‡ä»¶ src/main.inoï¼Œå†…å®¹å¦‚ä¸‹ï¼Œå…¶ä¸­ä¸»è¦é€»è¾‘å‡ç§»æ¤è‡ªæˆ‘å‰é¢è´´çš„æ–‡ç« ï¼š c #include \u003cmath.h\u003e #include \u003cstdio.h\u003e #include \u003cTFT_eSPI.h\u003e // Hardware-specific library #define WIDTH 480 #define HEIGHT 320 // å››ä¸ªæ–¹å‘é”®å¯¹åº”çš„ GPIO å¼•è„š #define BUTTON_UP_PIN 5 #define BUTTON_LEFT_PIN 18 #define BUTTON_DOWN_PIN 19 #define BUTTON_RIGHT_PIN 21 TFT_eSPI tft = TFT_eSPI(); // Invoke custom library typedef struct Position // åæ ‡ç»“æ„ { int x; int y; } Pos; Pos SNAKE[3000] = {0}; Pos DIRECTION; Pos EGG; long SNAKE_LEN; void setup() { Serial.begin(115200); tft.begin(); tft.setRotation(1); // landscape tft.fillScreen(TFT_BLACK); // Swap the colour byte order when rendering tft.setSwapBytes(true); // initialize the pushbutton pin as an input: the default state is LOW pinMode(BUTTON_UP_PIN, INPUT); pinMode(BUTTON_LEFT_PIN, INPUT); pinMode(BUTTON_DOWN_PIN, INPUT); pinMode(BUTTON_RIGHT_PIN, INPUT); init_game(); } void loop() { command(); // è·å–æŒ‰é”®æ¶ˆæ¯ move(); // ä¿®æ”¹å¤´èŠ‚ç‚¹åæ ‡-è›‡çš„ç§»åŠ¨ eat_egg(); draw(); // ä½œå›¾ eat_self(); delay(100); } void init_game() { // åˆå§‹åŒ–å°è›‡ SNAKE_LEN = 1; SNAKE[0].x = random(50, WIDTH - 50); // å¤´èŠ‚ç‚¹ä½ç½®éšæœºåŒ– SNAKE[0].y = random(50, HEIGHT - 50); DIRECTION.x = pow(-1, random()); // åˆå§‹åŒ–æ–¹å‘å‘é‡ DIRECTION.y = 0; creat_egg(); Serial.println(\"GAM STARTED, Having Fun~\"); } void creat_egg() { while (true) { int ok = 0; EGG.x = random(50, WIDTH - 50); // å¤´èŠ‚ç‚¹ä½ç½®éšæœºåŒ– EGG.y = random(50, HEIGHT - 50); for (int i = 0; i \u003c SNAKE_LEN; i++) { if (SNAKE[i].x == 0 \u0026\u0026 SNAKE[i].y == 0) continue; if (fabs(SNAKE[i].x - EGG.x) \u003c= 10 \u0026\u0026 fabs(SNAKE[i].y - EGG.y) \u003c= 10) ok = -1; break; } if (ok == 0) return; } } void command() // è·å–æŒ‰é”®å‘½ä»¤å‘½ä»¤ { if (digitalRead(BUTTON_LEFT_PIN) == HIGH) { if (DIRECTION.x != 1 || DIRECTION.y != 0) { // å¦‚æœä¸æ˜¯åæ–¹å‘ï¼ŒæŒ‰é”®æ‰æœ‰æ•ˆ Serial.println(\"Turn Left!\"); DIRECTION.x = -1; DIRECTION.y = 0; } } else if (digitalRead(BUTTON_RIGHT_PIN) == HIGH) { if (DIRECTION.x != -1 || DIRECTION.y != 0) { Serial.println(\"Turn Right!\"); DIRECTION.x = 1; DIRECTION.y = 0; } } else if (digitalRead(BUTTON_UP_PIN) == HIGH) { if (DIRECTION.x != 0 || DIRECTION.y != 1) { // æ³¨æ„ Y è½´ï¼Œå‘ä¸Šæ˜¯è´Ÿè½´ï¼Œå› ä¸ºå±å¹•å·¦ä¸Šè§’æ˜¯åŸç‚¹ (0,0) Serial.println(\"Turn Up!\"); DIRECTION.x = 0; DIRECTION.y = -1; } } else if (digitalRead(BUTTON_DOWN_PIN) == HIGH) { if (DIRECTION.x != 0 || DIRECTION.y != -1) { Serial.println(\"Turn Down!\"); DIRECTION.x = 0; DIRECTION.y = 1; } } } void move() // ä¿®æ”¹å„èŠ‚ç‚¹åæ ‡ä»¥è¾¾åˆ°ç§»åŠ¨çš„ç›®çš„ { // è¦†ç›–å°¾éƒ¨èµ°è¿‡çš„ç—•è¿¹ tft.drawRect(SNAKE[SNAKE_LEN - 1].x - 5, SNAKE[SNAKE_LEN - 1].y - 5, 10, 10, TFT_BLACK); for (int i = SNAKE_LEN - 1; i \u003e 0; i--) { SNAKE[i].x = SNAKE[i - 1].x; SNAKE[i].y = SNAKE[i - 1].y; } SNAKE[0].x += DIRECTION.x * 10; // æ¯æ¬¡ç§»åŠ¨10pix SNAKE[0].y += DIRECTION.y * 10; if (SNAKE[0].x \u003e= WIDTH) // å¦‚æœè¶Šç•Œï¼Œä»å¦ä¸€è¾¹å‡ºæ¥ SNAKE[0].x = 0; else if (SNAKE[0].x \u003c= 0) SNAKE[0].x = WIDTH; else if (SNAKE[0].y \u003e= HEIGHT) SNAKE[0].y = 0; else if (SNAKE[0].y \u003c= 0) SNAKE[0].y = HEIGHT; } void eat_egg() { if (fabs(SNAKE[0].x - EGG.x) \u003c= 5 \u0026\u0026 fabs(SNAKE[0].y - EGG.y) \u003c= 5) { // shade old egg tft.drawCircle(EGG.x, EGG.y, 5, TFT_BLACK); creat_egg(); // add snake node SNAKE_LEN += 1; for (int i = SNAKE_LEN - 1; i \u003e 0; i--) { SNAKE[i].x = SNAKE[i - 1].x; SNAKE[i].y = SNAKE[i - 1].y; } SNAKE[0].x += DIRECTION.x * 10; // æ¯æ¬¡ç§»åŠ¨10pix SNAKE[0].y += DIRECTION.y * 10; } } void draw() // ç”»å‡ºè›‡å’Œé£Ÿç‰© { for (int i = 0; i \u003c SNAKE_LEN; i++) { tft.drawRect(SNAKE[i].x - 5, SNAKE[i].y - 5, 10, 10, TFT_BLUE); } tft.drawCircle(EGG.x, EGG.y, 5, TFT_RED); } void eat_self() { if (SNAKE_LEN == 1) return; for (int i = 1; i \u003c SNAKE_LEN; i++) if (fabs(SNAKE[i].x - SNAKE[0].x) \u003c= 5 \u0026\u0026 fabs(SNAKE[i].y - SNAKE[0].y) \u003c= 5) { delay(1000); tft.setTextColor(TFT_RED, TFT_BLACK); tft.drawString(\"GAME OVER!\", 200, 150, 4); delay(3000); setup(); break; } } ä»£ç å°±è¿™ä¹ˆç‚¹ï¼Œæ²¡å‡ è¡Œï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥æ¥ä¸€ä¸‹æŒ‰é”®ç”µè·¯ï¼Œè¿™éƒ¨åˆ†æ˜¯å‚è€ƒäº† arduino çš„å®˜æ–¹æ–‡æ¡£How to Wire and Program a Button æ¥çº¿æ–¹å¼å¦‚ä¸‹ï¼Œä¸»è¦åŸç†å°±æ˜¯é€šè¿‡ GND æ¥çº¿ï¼Œä½¿å››ä¸ªæ–¹å‘é”®å¯¹åº”çš„ GPIO å£é»˜è®¤å€¼ä¸ºä½ç”µå¹³ã€‚å½“æŒ‰é”®æŒ‰ä¸‹æ—¶ï¼ŒGPIO å£ä¼šè¢«æ‹‰å‡æˆé«˜ç”µå¹³ï¼Œä»è€Œä½¿ç¨‹åºè¯†åˆ«åˆ°è¯¥æŒ‰é”®è¢«æŒ‰ä¸‹ã€‚ æ¥çº¿ç¤ºæ„å›¾å¦‚ä¸‹ï¼ˆç®€å•èµ·è§ï¼Œçœç•¥äº†å‰é¢çš„æ˜¾ç¤ºå±æ¥çº¿éƒ¨åˆ†ï¼‰ï¼š ä½¿ç”¨","date":"2023-03-05","objectID":"/posts/ee-basics-2-esp32-display/:4:0","series":["EE å…¥é—¨"],"tags":["ç”µå­ç”µè·¯","Electrical Engineering","MCU","ESP32","SPI","GPIO","è´ªåƒè›‡","æ˜¾ç¤ºå±"],"title":"EE å…¥é—¨ï¼ˆäºŒï¼‰ - ä½¿ç”¨ ESP32 ä¸ SPI æ˜¾ç¤ºå±ç»˜å›¾ã€æ˜¾ç¤ºå›¾ç‰‡ã€è·‘è´ªåƒè›‡","uri":"/posts/ee-basics-2-esp32-display/#ä¸‰å†™ä¸ªæç®€è´ªåƒè›‡æ¸¸æˆ"},{"categories":["tech"],"content":" å‰è¨€æˆ‘æ˜¯ä»å»å¹´ 12 æœˆå¼€å§‹ç©ç”µå­çš„ï¼Œèµ·å› æ˜¯ 11 æœˆæäº†ä¸ª Homelabï¼Œç„¶åå°±ä¸€è·¯ç©åˆ° ESPHomeï¼Œä¹°äº†ä¸€å †ä¼ æ„Ÿå™¨ã€‚ç©äº†ä¸€é˜µå ESPHome è¿™ç§å°ç™½å¼ç©æ³•å°±æ»¡è¶³ä¸äº†æˆ‘äº†ï¼Œäºæ˜¯å¼€å§‹å­¦ä¹ ç”µè·¯çŸ¥è¯†ï¼Œç”¨æ ‘è“æ´¾è·Ÿå…¶ä»–å•ç‰‡æœºå¼€å§‹æŠ˜è…¾é¥æ§å°è½¦ã€ç®€æ˜“æœºæ¢°è‡‚ã€è·‘é©¬ç¯ç­‰ç­‰ï¼Œå¯ä»¥è¯´æ˜¯ç©å¾—å¾ˆå°½å…´ã€‚ ä»Šå¹´æˆ‘ä¹Ÿæ‰“ç®—ç»§ç»­ç©ä¸€ç©è¿™ä¸€å—ï¼Œå°¤å…¶æƒ³ç©ä¸€ç©ç”¨ ESP32/STM32 è‡ªåˆ¶æ— äººæœºï¼Œå¦‚æœèƒ½æææ— äººæœºç¼–é˜Ÿé£è¡Œå°±æ›´å¥½äº†~ è¨€å½’æ­£ä¼ ï¼Œè¿™ç¯‡æ–‡ç« æ˜¯æˆ‘å…¥é—¨ç”µå­ç”µè·¯çš„ç¬¬ä¸€ç¯‡ç¬”è®°ï¼Œæ¶µç›–æœ€åŸºç¡€çš„ç”µè·¯ç†è®ºä¸ä¸€äº›ç„Šæ¥çŸ¥è¯†ï¼Œæœ«å°¾è¿˜åŒ…å«äº†åç»­çš„å­¦ä¹ è§„åˆ’ã€‚ ç¬”è®°å†…å®¹å‚è€ƒäº†è®¸å¤šç½‘ä¸Šçš„èµ„æ–™ï¼Œä¸»è¦æœ‰å¦‚ä¸‹å‡ ä¸ªï¼š çºµæ¨ªå‘å¯¼ - ç”µè·¯å…¥é—¨ é‡‡ç”¨ç±»æ¯”çš„æ–¹æ³•æ¥è®²è§£ç”µè·¯åŸºç¡€ï¼Œå¾ˆé€‚åˆä¸šä½™ç©å®¶é›¶åŸºç¡€å¿«é€Ÿå…¥é—¨ã€‚ Electrical Engineering Essentials - sparkfun åŒæ ·æ˜¯é›¶åŸºç¡€å…¥é—¨ï¼Œå°¤å…¶æ˜¯è¿˜ä»‹ç»äº†ç”µçƒ™é“ç­‰ç©ç”µè·¯æ¿çš„å®ç”¨çŸ¥è¯†ã€‚ The Amazing World of Electronics - Only the Cool Stuff :-) è¿™ä¸ªæ˜¯ä¸€ç¯‡ç¯‡é›¶æ•£çš„æ–‡ç« ï¼Œæ¯ç¯‡æ–‡ç« ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œä½†æ˜¯è®²å¾—æ¯”è¾ƒæ·±å…¥é€å½»ã€‚ æˆ‘çœ‹å®Œä¸Šé¢çš„æ–‡ç« åï¼Œéšç€ç©å¾—è¶Šæ¥è¶Šæ·±å…¥ï¼Œåˆé™†ç»­äº†è§£äº†è¿™äº›å†…å®¹ï¼š ç”µè·¯åŸºç¡€ ä»€ä¹ˆæ˜¯é¢åŒ…æ¿ã€é¢åŒ…çº¿ã€æœé‚¦çº¿ å¦‚ä½•ä½¿ç”¨ä¸‡ç”¨è¡¨æµ‹ç”µå‹ã€ç”µæµã€ç”µé˜»ã€ç”µå®¹ï¼Œåˆ¤æ–­äºŒæç®¡ã€ä¸‰æç®¡å¼•è„šã€‚ ï¼ˆN å¹´å‰å­¦è¿™ç©æ„å„¿æ—¶ç”¨çš„æ˜¯æœ€ç®€å•æ˜“æ‡‚çš„ç‰©ç†æŒ‡é’ˆè¡¨ï¼Œä½†æ˜¯å®é™…æ˜¾ç„¶æ˜¯ç”µå­çš„ç”¨ç€æ›´æ–¹ä¾¿ï¼‰ å›å¿†ä¸‹ç”¨æ³•ï¼šé¦–å…ˆè°ƒåˆ°åˆé€‚æ¡£ä½ï¼Œç„¶åæµ‹ç”µæµè¦ä¸²è”åˆ°ç”µè·¯ä¸­ã€æµ‹ç”µå‹è¦ä¸è¢«æµ‹å™¨ä»¶å¹¶è”ã€æµ‹ç”µé˜»ç›´æ¥æ¥åœ¨è¢«æµ‹å™¨ä»¶ä¸¤ç«¯å³å¯ã€‚ å¯¹äºæ‰‹åŠ¨é‡ç¨‹ä¸‡ç”¨è¡¨ï¼ˆå¦‚ DT-9205Aï¼‰ï¼Œå®ƒçš„æ˜¾ç¤ºå•ä½ä¸ºé‡ç¨‹åå­—æœ«å°¾éæ•°å­—éƒ¨åˆ†ã€‚ æ¯”å¦‚ç”µé˜» 200 é‡ç¨‹çš„æ˜¾ç¤ºå•ä½å°±ä¸º Î©ï¼›2K/20K/200K è¿™ä¸‰ä¸ªé‡ç¨‹çš„æ˜¾ç¤ºå•ä½éƒ½ä¸º KÎ©ï¼›2M/20M/200M çš„æ˜¾ç¤ºå•ä½éƒ½ä¸º MÎ© å¯¹äºç”µæµ/ç”µå‹/ç”µå®¹ä¹Ÿæ˜¯ä¸€æ ·ã€‚ ä»€ä¹ˆå…ƒä»¶éœ€è¦é˜²é™ç”µï¼Œä»¥åŠæœ‰çº¿é˜²é™ç”µæ‰‹ç¯/å°å« å¦‚ä½•è¯»è‰²ç¯ç”µé˜»çš„é˜»å€¼ï¼Ÿï¼ˆä¸ä¼šè¯»ä¸å¦‚ç›´æ¥ä¸‡ç”¨è¡¨èµ°èµ·â€¦ï¼‰ å¦‚ä½•é€‰è´­ã€ä½¿ç”¨ç”µçƒ™é“/å¸é”¡å™¨ç­‰ç„Šæ¥å·¥å…· â€¦ å•ç‰‡æœºï¼ˆMCUï¼‰ä¸å•æ¿è®¡ç®—æœºï¼ˆSBCï¼‰ ä»€ä¹ˆæ˜¯å¼€å‘ç‰ˆ ä»€ä¹ˆæ˜¯ TTL ä¸²å£ã€ä¸²å£é©±åŠ¨ã€æ³¢ç‰¹ç‡ ä»€ä¹ˆæ˜¯ SPI/UART/I$^{2}$C æ•°æ®ä¼ è¾“åè®® ä»€ä¹ˆæ˜¯ GPIO å¼•è„šï¼Œä»¥åŠå¼€å‘ç‰ˆçš„å¼•è„šå„æœ‰ä»€ä¹ˆåŠŸèƒ½ å¦‚ä½•ä½¿ç”¨ USB è½¬ TTL ä¸²å£æ¿ç»™ ESP32/ESP8266/51/STM32 ç­‰å•ç‰‡æœºåˆ·å›ºä»¶ ST-Link/J-Link/DAPLink è°ƒè¯•ç¼–ç¨‹å™¨ï¼ˆä»¿çœŸå™¨ï¼‰ä¸ TTL ä¸²å£æœ‰ä½•åŒºåˆ«ï¼ŒJTAG å’Œ SWD æ¥å£åˆæ˜¯ä¸ªå•¥ï¼Ÿè¯¥ç”¨å“ªä¸ªï¼Ÿ å¦‚ä½•ä½¿ç”¨ C è¯­è¨€ä¸ºå•ç‰‡æœºç¼–å†™ç¨‹åºï¼Ÿå¦‚ä½•ä¸Šä¼ ç¼–è¯‘å¥½çš„å›ºä»¶ï¼Ÿå¦‚ä½•è°ƒè¯•ï¼Ÿ â€¦ æ€»ä¹‹å…´è¶£é©±åŠ¨ï¼Œä¸ä¼šçš„ä¸œè¥¿å°± Google ä¸€ä¸‹æˆ–è€…é—®é—® ChatGPTï¼Œç©èµ·æ¥~ ","date":"2023-01-31","objectID":"/posts/electrical-engineering-circuits-basics-1/:1:0","series":["EE å…¥é—¨"],"tags":["ç”µå­ç”µè·¯","Electrical Engineering","MCU"],"title":"EE å…¥é—¨ï¼ˆä¸€ï¼‰ - ç”µå­ç”µè·¯åŸºç¡€çŸ¥è¯†","uri":"/posts/electrical-engineering-circuits-basics-1/#å‰è¨€"},{"categories":["tech"],"content":" ä¸€ã€å¸¸è§åŸºç¡€å…¬å¼ æ¬§å§†å®šå¾‹ï¼š $U = IR$ ç”µå‹ U å•ä½ä¼ç‰¹ Voltï¼Œç¬¦å· $V$ ç”µæµ I å•ä½å®‰åŸ¹ Ampereï¼Œç¬¦å· $A$ ç”µé˜» R å•ä½æ¬§å§† Ohmï¼Œç¬¦å· $\\Omega$ ç”µåŠŸç‡å…¬å¼ï¼š $p= UI$ åŠŸç‡ p å•ä½ç“¦ç‰¹ Wattï¼Œç¬¦å· $W$ï¼Œç­‰åŒäº $V \\cdot A$ çš„ç¼©å†™ ç”µèƒ½å…¬å¼ï¼š $w = pT$ å…¶ä¸­ p ä¸ºç”µåŠŸç‡ï¼Œå•ä½å‰é¢è¯´äº†å°±æ˜¯ Watt T ä¸ºæ—¶é—´ï¼Œå•ä½ç§’ Second $w$ ç”µèƒ½çš„å•ä½ä¸ºç„¦è€³ jouleï¼Œç­‰åŒäº $V \\cdot A \\cdot s$ å¸¸è§çš„ç”µæ± é€šå¸¸ä¼šä½¿ç”¨ $mA \\cdot h$ æˆ–è€… $w \\cdot h$ æ¥æ ‡è®°å…¶ç”µèƒ½å®¹é‡ã€‚ $mA \\cdot h$ ä¹˜ä¸Šç”µå‹å†è½¬æ¢ä¸‹ç”µæµè·Ÿæ—¶é—´çš„å•ä½ä¸º A è·Ÿ sï¼Œå°±å¾—åˆ°ç„¦è€³æ•° $w \\cdot h$ ç›´æ¥ä¹˜ 3600ï¼ˆ1 å°æ—¶çš„ç§’æ•°ï¼‰å°±å¾—åˆ°ç„¦è€³æ•° ç”µå®¹é‡å…¬å¼ï¼š $C = Q/U$ ç”µå®¹é‡ C å•ä½ä¸ºæ³•æ‹‰ Faradï¼Œç¬¦å·ä¸º $F$ å¸¦ç”µé‡ Q çš„å•ä½ä¸ºåº“ä»‘ Coulombï¼Œç¬¦å·ä¸º $C$ åº“ä»‘çš„å®šä¹‰ï¼š $1C = 1A \\cdot s$ 1 åº“ä»‘å³ $6.24146 \\times 10^{18}$ ä¸ªç”µå­æ‰€å¸¦çš„ç”µè·é‡ ç”µæ„Ÿ TODOï¼ˆè²Œä¼¼ç”¨å¾—æ¯”è¾ƒå°‘â€¦å¾…è¡¥å……ï¼‰ ","date":"2023-01-31","objectID":"/posts/electrical-engineering-circuits-basics-1/:2:0","series":["EE å…¥é—¨"],"tags":["ç”µå­ç”µè·¯","Electrical Engineering","MCU"],"title":"EE å…¥é—¨ï¼ˆä¸€ï¼‰ - ç”µå­ç”µè·¯åŸºç¡€çŸ¥è¯†","uri":"/posts/electrical-engineering-circuits-basics-1/#ä¸€å¸¸è§åŸºç¡€å…¬å¼"},{"categories":["tech"],"content":" äºŒã€å¸¸ç”¨ç”µå­å…ƒä»¶ä»‹ç»å¸¸è§ç”µå­å…ƒå™¨ä»¶ï¼š ç”µé˜» äºŒæç®¡ Diode å‘å…‰äºŒæç®¡ æ•´æµäºŒæç®¡ ç¨³å‹äºŒæç®¡ ä¸‰æç®¡ MOSFET åœºæ•ˆåº”ç®¡ ç”µå‹è½¬æ¢å™¨ï¼ˆpower converterï¼‰ï¼šæ•´æµå™¨ï¼ˆrectifierï¼‰ã€é€†å˜å™¨ï¼ˆinverterï¼‰ã€æ–©æ³¢å™¨ ï¼ˆchopperï¼‰åŠå˜é¢‘é©±åŠ¨å™¨ï¼ˆVFDï¼‰ ç”µå®¹ ç”µè§£ç”µå®¹ ç“·ç‰‡ç”µå®¹ ç‹¬çŸ³ç”µå®¹ æ™¶æŒ¯ ","date":"2023-01-31","objectID":"/posts/electrical-engineering-circuits-basics-1/:3:0","series":["EE å…¥é—¨"],"tags":["ç”µå­ç”µè·¯","Electrical Engineering","MCU"],"title":"EE å…¥é—¨ï¼ˆä¸€ï¼‰ - ç”µå­ç”µè·¯åŸºç¡€çŸ¥è¯†","uri":"/posts/electrical-engineering-circuits-basics-1/#äºŒå¸¸ç”¨ç”µå­å…ƒä»¶ä»‹ç»"},{"categories":["tech"],"content":" 1. äºŒæç®¡ Diode https://learn.sparkfun.com/tutorials/diodes äºŒæç®¡æ˜¯ä¸€ç§åªå…è®¸ç”µæµç”±å•ä¸€æ–¹å‘æµè¿‡ï¼Œå…·æœ‰ä¸¤ä¸ªç”µæçš„å…ƒä»¶ï¼Œæ˜¯ç°ä»£ç”µå­äº§ä¸šçš„åŸºçŸ³ã€‚å¯ç±»æ¯”æ°´æµä¸­çš„å•å‘é˜€é—¨ï¼Œæ°´åªèƒ½ä»ä¸€ç«¯æµå‘å¦ä¸€ç«¯ï¼Œè€Œä¸èƒ½é€†æµã€‚ æœ€åˆçš„äºŒæç®¡æ˜¯çœŸç©ºç”µå­äºŒæç®¡ï¼Œå¾ˆå¤§ã€éœ€è¦é¢„çƒ­ã€åŠŸè€—å¤§ï¼Œæ˜“ç ´ç¢ã€‚åæ¥ç¾å›½äººä½¿ç”¨åŠå¯¼ä½“ææ–™å‘æ˜äº†æ™¶ä½“äºŒæç®¡ï¼ˆæˆ–è€…å«åŠå¯¼ä½“äºŒæç®¡ï¼‰ã€‚ç›®å‰å¸¸ç”¨çš„äºŒæç®¡éƒ½æ˜¯æ™¶ä½“äºŒæç®¡ï¼Œä¸»è¦ä½¿ç”¨ç¡…æˆ–è€…é”—è¿™ç±»åŠå¯¼ä½“ææ–™ã€‚ æ™¶ä½“äºŒæç®¡çš„æ ¸å¿ƒæ˜¯ PN ç»“ï¼ˆpâ€“n junctionï¼‰ï¼Œè¦äº†è§£ PN ç»“ï¼Œéœ€è¦å…ˆä»‹ç»åŠå¯¼ä½“çš„å‡ ä¸ªæ¦‚å¿µï¼š ç©ºç©´ï¼šåˆç§° Electron holeï¼Œç‰©ç†å­¦ä¸­æŒ‡åŸå­çš„å…±ä»·é”®ä¸Šæµå¤±ä¸€ä¸ªç”µå­ï¼Œæœ€ååœ¨å…±ä»·é”®ä¸Šç•™ä¸‹çš„ç©ºä½ã€‚ è½½æµå­ï¼šåŠå¯¼ä½“ä¸­æœ‰ä¸¤ç§è½½æµå­ï¼Œå³ä»·å¸¦ä¸­å¸¦æ­£ç”µçš„ç©ºç©´ï¼Œå’Œå¯¼å¸¦ä¸­å¸¦è´Ÿç”µçš„ç”µå­ã€‚ P å‹åŠå¯¼ä½“ï¼šP è¡¨ç¤º Positiveï¼ŒæŒ‡ä»¥å¸¦æ­£ç”µçš„ç©ºç©´å¯¼ç”µä¸ºä¸»çš„åŠå¯¼ä½“ï¼Œä¹Ÿå«ç©ºç©´åŠå¯¼ä½“ã€‚ åœ¨çº¯å‡€çš„ç¡…æ™¶ä½“ä¸­æºå…¥ä¸‰ä»·å…ƒç´ ï¼ˆå¦‚ç¡¼ï¼‰ï¼Œä½¿ä¹‹å–ä»£æ™¶æ ¼ä¸­ç¡…åŸå­çš„ä½ç½®ï¼Œå°±å½¢æˆPå‹åŠå¯¼ä½“ã€‚ N å‹åŠå¯¼ä½“ï¼šN è¡¨ç¤º Negativeï¼ŒæŒ‡è‡ªç”±ç”µå­æµ“åº¦è¿œå¤§äºç©ºç©´æµ“åº¦çš„æ‚è´¨åŠå¯¼ä½“ã€‚ ä¾‹å¦‚ï¼Œå«æœ‰é€‚é‡äº”ä»·å…ƒç´ ç ·ã€ç£·ã€é”‘ç­‰çš„é”—æˆ–ç¡…ç­‰åŠå¯¼ä½“ã€‚ æ‡‚äº†ä¸Šé¢è¿™äº›åï¼Œè®©æˆ‘ä»¬è€ƒè™‘åœ¨ä¸€ä¸ª N å‹åŠå¯¼ä½“è·Ÿ P å‹åŠå¯¼ä½“å½¢æˆçš„ PN ç»“ä¸­ï¼Œç”µå­æ˜¾ç„¶åªèƒ½ä» N ææµå‘ P æï¼Œå› ä¸ºåªæœ‰ N ææ‰æœ‰è¶³å¤Ÿçš„ç”µå­ã€‚ç›¸åç”µæµåªèƒ½ä» P çº§æµå‘ N æï¼Œå› ä¸ºåªæœ‰ P ææ‰æœ‰è¶³å¤Ÿçš„ç©ºç©´ã€‚ å¦‚æœç”µæµè¦åå‘æµåŠ¨ï¼Œé‚£ PN ç»“çš„ P æçš„ç”µå­ä¼šæ›´å¤šï¼Œè€Œ N çº§çš„ç©ºç©´ä¹Ÿä¼šæ›´å¤šï¼Œç”µåŠ¿å·®ä¼šæ›´å¤§ï¼Œæ˜¾ç„¶å°±ä¼šéå¸¸è´¹åŠ²ã€‚ äºŒæç®¡åœ¨å¯¼é€šçŠ¶æ€ä¸‹äºŒç¤ºæ„å›¾å¦‚ä¸‹ï¼Œå…¶ä¸­ä¹Ÿå±•ç¤ºäº†äºŒæç®¡å¯¹åº”çš„ç¬¦å·ä¸çœŸå®äºŒæç®¡çš„ç»“æ„ï¼ˆå¸¦ç¯çš„ä¸€ä¾§ä¸ºå…¶ N æï¼‰ï¼š ç”µé˜»æ‹¥æœ‰çº¿æ€§çš„ä¼å®‰ç‰¹æ€§æ›²çº¿ï¼Œéµä»æ¬§å§†å®šå¾‹ã€‚è€ŒäºŒæç®¡åˆ™å®Œå…¨ä¸åŒï¼Œå®ƒä¼å®‰ç‰¹æ€§æ›²çº¿ ï¼ˆCurrent-Voltage Graphï¼‰å¦‚ä¸‹ï¼š å‡ ä¸ªä¸»è¦ç‰¹å¾ä¸ç›¸å…³åè¯ä»‹ç»ï¼š æ›´è¯¦ç»†çš„æ–‡ç« ï¼šPN Junction Diode æ­£å‘å‹é™ Forward Voltage: æŒ‡ä½¿ç”µæµèƒ½å¤Ÿå¯¼é€šçš„æœ€å°ç”µå‹ $V_F$ ã€Œæ­£å‘å‹é™ã€è¢«ç”¨äºå…‹æœäºŒæç®¡çš„å†…éƒ¨ç”µåœºäº†ï¼Œæ‰€ä»¥åœ¨ç”µæµé€šè¿‡äºŒæç®¡åï¼Œç”µå‹éœ€è¦å‡å»è¿™ä¸ªç”µå‹ï¼Œè¿™ä¹Ÿæ˜¯ä¸­æ–‡åã€Œæ­£å‘å‹é™ã€çš„ç”±æ¥ã€‚ ç¡…äºŒæç®¡çš„æ­£å‘å‹é™é€šå¸¸ä¸º 0.6v - 1vï¼Œé”—äºŒæç®¡çš„æ­£å‘å‹é™é€šå¸¸ä¸º 0.3v æ ¹æ®ä¼å®‰ç‰¹æ€§æ›²çº¿ï¼Œå®é™…ä¸Šéšç€ç”µæµçš„å˜åŒ–ï¼Œã€Œæ­£å‘å‹é™ã€ä¹Ÿæ˜¯æœ‰å°å¹…æ³¢åŠ¨çš„ï¼Œä¸è¿‡è®¡ç®—æ—¶ä¸€èˆ¬éƒ½è®¤ä¸ºå®ƒæ˜¯å›ºå®šå€¼ã€‚ å‡»ç©¿ç”µå‹ Breakdown Voltage: æŒ‡ä½¿ç”µæµèƒ½å¦åå‘å¯¼é€šçš„æœ€å°ç”µå‹ï¼Œä»å›¾ä¸­æ ‡è¯†çœ‹ $V_{BR}$ ä¸º -50vï¼Œæ˜¾ç„¶å®ƒè¿œå¤§äºä¸åˆ° 1v çš„ã€Œæ­£å‘å‹é™ã€ã€‚ å½“ç”µæµèƒ½ç»è¿‡äºŒæç®¡åå‘å¯¼é€šæ—¶ï¼Œæˆ‘ä»¬ç§°äºŒæç®¡è¢«å‡»ç©¿ï¼ˆBreakdownï¼‰ äºŒæç®¡ä¾æ®å…¶è®¾è®¡ç›®æ ‡ï¼Œåˆ†ç±»äº†è®¸å¤šä¸åŒç±»åˆ«ï¼š æ™®é€šäºŒæç®¡ æ•´æµå™¨(rectifier) / åŠŸç‡äºŒæç®¡ï¼ˆpower diodeï¼‰ ä¾é äºŒæç®¡åªèƒ½å•å‘å¯¼é€šçš„åŸç†ï¼Œå¯ä»¥ä½¿ç”¨å®ƒå°†äº¤æµç”µå˜æˆç›´æµç”µã€‚ èƒ½æ‰¿å—è¾ƒå¤§çš„æ­£å‘ç”µæµå’Œè¾ƒé«˜çš„åå‘ç”µå‹ å‘å…‰äºŒæç®¡ï¼ˆLight-Emitting Diodes, LEDsï¼‰ LED çš„æ­£å‘å‹é™å–å†³äºå®ƒçš„é¢œè‰²ï¼Œè€Œä¸”æ¯”è¾ƒå›ºå®šï¼Œé€šå¸¸çº¢è‰²çº¦ä¸º 1.6vï¼Œç»¿è‰²æœ‰ 2v å’Œ 3v ä¸¤ç§ï¼Œ é»„è‰²å’Œæ©™è‰²çº¦ä¸º 2.2vï¼Œè“è‰²çº¦ä¸º 3.2v ç¨³å‹äºŒæç®¡ åˆ©ç”¨äºŒæç®¡åœ¨åå‘å‡»ç©¿çŠ¶æ€ï¼Œå…¶ç”µæµå¯åœ¨å¾ˆå¤§èŒƒå›´å†…å˜åŒ–è€Œç”µå‹åŸºæœ¬ä¸å˜çš„ç°è±¡ï¼Œåˆ¶æˆçš„èµ·ç¨³å‹ä½œç”¨çš„äºŒæç®¡ã€‚ å¼€å…³äºŒæç®¡ èƒ½å¤Ÿå¿«é€Ÿç”±å¯¼é€šå˜ä¸ºæˆªæ­¢æˆ–ç”±æˆªæ­¢å˜ä¸ºå¯¼é€šçš„ä¸€ç§äºŒæç®¡ã€‚ æ£€æ³¢äºŒæç®¡ TODO é˜»å°¼äºŒæç®¡ å…·æœ‰è¾ƒä½æœ‰ç”µå‹é™å’Œè¾ƒé«˜çš„å·¥ä½œé¢‘ç‡ï¼Œä¸”èƒ½æ‰¿å—è¾ƒé«˜çš„åå‘å‡»ç©¿ç”µå‹å’Œè¾ƒå¤§çš„å³°å€¼ç”µæµã€‚ è¿˜æœ‰äºŒæç®¡å †ç»„ï¼š æ•´æµæ¡¥å †(åŠæ¡¥ã€å…¨æ¡¥) è±å½¢è”æ¥ ç­‰ç­‰â€¦ ","date":"2023-01-31","objectID":"/posts/electrical-engineering-circuits-basics-1/:3:1","series":["EE å…¥é—¨"],"tags":["ç”µå­ç”µè·¯","Electrical Engineering","MCU"],"title":"EE å…¥é—¨ï¼ˆä¸€ï¼‰ - ç”µå­ç”µè·¯åŸºç¡€çŸ¥è¯†","uri":"/posts/electrical-engineering-circuits-basics-1/#1-äºŒæç®¡-diode"},{"categories":["tech"],"content":" 2. ä¸‰æç®¡ triode / bipolar transistorä¸‰æç®¡å³åŒæå‹æ™¶ä½“ç®¡ï¼Œç¼©å†™ BJTï¼Œå‰é¢ä»‹ç»äº†äºŒæç®¡ç»“æ„ä¸ºå•ä¸ª PN ç»“ï¼Œè€Œä¸‰æç®¡çš„ç»“æ„åˆ™ä¸º PNP æˆ–è€… NPN ç»“æ„ï¼Œå…·æœ‰ç”µæµæ”¾å¤§ä½œç”¨ï¼Œæ˜¯ç”µå­ç”µè·¯çš„æ ¸å¿ƒå…ƒä»¶ä¹‹ä¸€ã€‚ å®ƒçš„å·¥ä½œæ–¹å¼å°±åƒæ˜¯ä¸€ä¸ªä¸€ä¸ªæ¶²å‹é˜€é—¨ï¼Œé€šè¿‡å°ç”µæµæ¥é¡¶å¼€ä¸­é—´çš„é€šè·¯ï¼Œä½¿å¤§ç”µæµå¾—ä»¥é€šè¿‡ï¼Œä¸€ä¸ª NPN å‹æ”¾å¤§å™¨ç”µè·¯çš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š b ä¸ e ä¹‹é—´çš„ç”µå‹å½¢æˆä¸€ä¸ªå°ç”µæµï¼Œè¿™ä¸ªå°ç”µæµè¶Šå¤§ï¼Œc ä¸ e ä¹‹é—´çš„ç”µé˜»å°±è¶Šå°ã€‚ å°±åƒæ˜¯å¦‚ä¸‹æ¶²å‹é˜€é—¨ï¼Œb å¤„çš„æ°´å‹è¶Šå¤§ï¼Œæ¶²å‹é˜€é—¨è¢«æ¨å¾—è¶Šå¼€ï¼Œc ä¸ e ä¹‹é—´çš„æ°´æµå°±è¶Šå¤§ï¼š ä¸‰æç®¡ä¸æ˜¯å‡­ç©ºæŠŠç”µæ”¾å¤§äº†ï¼Œè€Œæ˜¯è¯´ï¼š å°çš„ç”µä¿¡å·ï¼ˆå°æ°´æµï¼‰æŠŠå¦ä¸€ä¸ªé€šè·¯çš„å¤§ç”µæµçš„é˜€é—¨æ‰“å¼€äº†ï¼Œ åé¢çš„å™¨ä»¶èƒ½å¤Ÿæ„Ÿå—åˆ°è¿™ä¸ªå¤§ç”µæµï¼Œ æ‰€ä»¥æ˜¯æ”¾å¤§äº†ã€‚å¯¹ç”µæ¥è¯´ å®é™…æœ‰ä¸¤ä¸ªç”µæºä¾›ç”µçš„ ä¸€ä¸ªæ˜¯å°ç”µæº ï¼ˆå°ä¿¡å·ã€ä¿¡å·æºï¼‰ ä¸€ä¸ªæ˜¯å¤§ç”µæºã€‚ å’±ä»¬çš„æ”¶éŸ³æœºï¼Œå®é™…å°±æ˜¯å¤©çº¿ï¼Œæ¥æ”¶åˆ°ç©ºæ°”ä¸­çš„å°ç”µæµï¼Œä½ å¯ä»¥ç†è§£ä¸ºæ¯›æ¯›é›¨ã€‚ è¿™ä¸ªæ¯›æ¯›é›¨åˆ°äº†ä¸‰æç®¡çš„ä¸€ä¸ªè„šä¸Šæ‰“å¼€é˜€é—¨ï¼Œ ç”µæ± ä¾›ç”µé€šè¿‡å¦å¤–ä¸¤ä¸ªè„šæµåŠ¨ï¼Œå†æ‰“å¼€ä¸€ä¸ªåé¢çš„ä¸‰æç®¡ï¼Œ ä¸€çº§çº§çš„è¿™æ ·ä¸æ–­æ‰“å¼€ï¼Œä¸€èˆ¬æ”¶éŸ³æœºæœ€æ—©çš„æ—¶å€™æ˜¯ä¸‰ç®¡æ”¶éŸ³æœºã€å…­ç®¡æ”¶éŸ³æœºï¼Œå°±æ˜¯è¿™ä¹ˆä¸ªæ„æ€ä¸€ç›´åˆ°è¿™ä¸ªæ°´æµå¤§åˆ°èƒ½å¤Ÿæ¨åŠ¨å–‡å­å°±å‘å£°äº†ã€‚ ä¸€ä¸ªæç®€ä¸‰çº§æ”¾å¤§æ”¶éŸ³æœºç”µè·¯ï¼š ä¸¤ç§ä¸‰æç®¡çš„ç¬¦å·ä¸è¯†åˆ«ï¼š ä¸‰ä¸ªç”µæä»‹ç»ï¼š C: å³ Collector é›†ç”µæ B: å³ Base åŸºæ E: å³ Emitter å‘å°„æ å¯ä»¥çœ‹åˆ° NPN è·Ÿ PNP ä¸‰æç®¡æœ€å¤§çš„åŒºåˆ«ï¼Œæ˜¯åœ¨äºç”µæµæµå‘ï¼š NPN çš„ Base åŸºææ˜¯ P å¯¹åº”æ­£æï¼Œç”µæµä» B ä¸ C æ æµå‘ E æ PNP çš„ Base åŸºææ˜¯ N å¯¹åº”è´Ÿæï¼Œç”µæµä» E ææµå‘ B ä¸ C ä¸¤ä¸ªç”µæ æ ¹æ® B æç”µæµ $I_B$ çš„å˜åŒ–ï¼Œ$V_{CE}$ çš„å˜åŒ–æ›²çº¿å¦‚å›¾ï¼š å¯ä»¥çœ‹åˆ°åœ¨ $I_{B}$ ä¸€å®šçš„æƒ…å†µä¸‹ï¼Œä¸è®º $V_{CE}$ åœ¨ 2v ä»¥ä¸Šå¦‚ä½•å˜åŒ–ï¼Œ$I_{C}$ çš„ç”µæµéƒ½å‡ ä¹æ˜¯æ’å®šçš„ã€‚æ¢ä¸ªè§’åº¦çœ‹ç”µå‹åœ¨ 2v - 12v ä¹‹é—´æ—¶ï¼Œ$I_{B}$ ä¸ $I_{C}$ å‡ ä¹æ˜¯å®Œå…¨çš„çº¿æ€§å…³ç³»ï¼Œä¸å—ç”µå‹æ³¢åŠ¨çš„å½±å“ã€‚ æ³¨æ„ 12v ä»¥ä¸Šåªæ˜¯æ²¡æœ‰ç”»å‡ºæ¥ï¼Œå‡ä½¿è¿™ä¸ªä¸‰æç®¡æœ€å¤šåªèƒ½æ‰¿å— 12v ç”µå‹ï¼Œé‚£æ›´é«˜çš„ç”µå‹ä¼šå‡»ç©¿å®ƒï¼Œ ä½ å°±èƒ½çœ‹åˆ°ä¸‰æç®¡å†’ç«èŠ±äº†â€¦ $\\frac{I_{C}}{I_{B}}$ ä¹‹é—´çš„æ¯”ç‡ï¼ˆå¸¸æ•°ï¼‰è¢«ç§°åšä¸‰æç®¡çš„ç”µæµå¢ç›Šï¼ˆCurrent Gainï¼‰ï¼Œä¸€èˆ¬ä½¿ç”¨ $\\beta$ è¡¨ç¤ºã€‚ å› ä¸ºå®é™…åœºæ™¯ä¸­ $I_{B}$ ä¸å¤ªå¥½åˆ¤æ–­ï¼Œé€šå¸¸éƒ½æ˜¯ç›´æ¥è°ƒæ•´ $V_{BE}$ï¼Œå› æ­¤æˆ‘ä»¬å†æ¢ä¸ªè§’åº¦ï¼Œå¯¹æ¯”ä¸‹ $I_{C}$ ä¸ $V_{BE}$ï¼š é€šè¿‡ä¸Šå›¾å¯ä»¥å‘ç°ä¸‰æç®¡çš„å¦å¤–ä¸¤ä¸ªç‰¹å¾ï¼š $V_{BE}$ éœ€è¦ä¸€ä¸ªå¯åŠ¨ç”µå‹ï¼Œå¤§çº¦åœ¨ 0.7v å·¦å³ï¼Œä½äº 0.7v æ—¶$I_C$ çš„ç”µæµä¸€ç›´éå¸¸å°ã€‚ åœ¨ $V_{BE}$ è¶…è¿‡ 0.7v åï¼Œä»»ä½•æ­¤ç”µå‹çš„å°å˜åŒ–ï¼Œéƒ½ä¼šå¯¼è‡´ $I_{C}$ çš„å‰§çƒˆå˜åŒ–ã€‚ ä¸€ä¸ªå¸¸è§çš„å•çŠ¶æ€ NPN æ”¾å¤§å™¨ç”µè·¯å¦‚ä¸‹ï¼š å¯ä»¥æ³¨æ„åˆ°ï¼Œè¾“å…¥ $V_{in}$æ˜¯ä¸€ä¸ªå¾ˆå°çš„äº¤æµä¿¡å·ï¼Œè¿‡æ¥ä¹‹å‰åŠ äº†ä¸€ä¸ªç”µå®¹éš”ç»æ‰å…¶ä¸­å‚æ‚çš„ç›´æµä¿¡å·ã€‚ å…¶æ¬¡å› ä¸º $V_{BE}$ éœ€è¦ä¸€ä¸ªå¯åŠ¨ç”µå‹æ‰èƒ½è¿›å…¥ç”µæµæ”¾å¤§çš„å·¥ä½œåŒºé—´ï¼Œè¿™é‡Œé€šè¿‡ $R1$ ä¸ $R2$ ä¸º $V_{BE}$ æä¾›äº†ä¸€ä¸ªå¯åŠ¨ç”µå‹ DC Biasing Point. ","date":"2023-01-31","objectID":"/posts/electrical-engineering-circuits-basics-1/:3:2","series":["EE å…¥é—¨"],"tags":["ç”µå­ç”µè·¯","Electrical Engineering","MCU"],"title":"EE å…¥é—¨ï¼ˆä¸€ï¼‰ - ç”µå­ç”µè·¯åŸºç¡€çŸ¥è¯†","uri":"/posts/electrical-engineering-circuits-basics-1/#2-ä¸‰æç®¡-triode--bipolar-transistor"},{"categories":["tech"],"content":" 3. MOSFET é‡‘å±æ°§åŒ–ç‰©åœºæ•ˆåº”æ™¶ä½“ç®¡ https://elamazing.com/2021/03/31/mosfet/ MOSFET ä¸ä¸‰æç®¡çš„åŒºåˆ«ä¸é€‰ç”¨ï¼šhttps://www.eet-china.com/mp/a17394.html CMOS é›†æˆç”µè·¯å·¥è‰º - ç™¾ç§‘: https://www.zgbk.com/ecph/words?SiteID=1\u0026ID=124559\u0026Type=bkzyb MOSFET æ™¶ä½“ç®¡ä¸€èˆ¬ç®€ç§° MOS ç®¡ï¼Œæ˜¯ç”µå‹æ§åˆ¶å…ƒä»¶ï¼ˆé€šè¿‡æ …æç”µå‹æ§åˆ¶æºæ¼é—´å¯¼é€šç”µé˜»ï¼‰ï¼Œè€ŒåŒæå‹æ™¶ä½“ç®¡ï¼ˆä¸‰æç®¡ï¼‰æ˜¯ç”µæµæ§åˆ¶å…ƒä»¶ï¼ˆé€šè¿‡åŸºæè¾ƒå°çš„ç”µæµæ§åˆ¶è¾ƒå¤§çš„é›†ç”µæç”µæµï¼‰ã€‚ MOS ç®¡åœ¨å¯¼é€šå‹é™ä¸‹ï¼Œå¯¼é€šç”µé˜»å°ï¼Œæ …æé©±åŠ¨ä¸éœ€è¦ç”µæµï¼ŒæŸè€—å°ï¼Œé©±åŠ¨ç”µè·¯ç®€å•ï¼Œè‡ªå¸¦ä¿æŠ¤äºŒæç®¡ï¼Œ çƒ­é˜»ç‰¹æ€§å¥½ï¼Œé€‚åˆå¤§åŠŸç‡å¹¶è”ï¼Œç¼ºç‚¹å¼€å…³é€Ÿåº¦ä¸é«˜ï¼Œæ¯”è¾ƒæ˜‚è´µã€‚ è€ŒåŠŸèƒ½ä¸ MOS ç®¡ç±»ä¼¼çš„ä¸‰æç®¡ï¼Œç‰¹ç‚¹æ˜¯å¼€å…³é€Ÿåº¦é«˜ï¼Œå¤§å‹ä¸‰æç®¡çš„ IC å¯ä»¥åšçš„å¾ˆå¤§ï¼Œç¼ºç‚¹æŸè€—å¤§ï¼Œ åŸºæé©±åŠ¨ç”µæµå¤§ï¼Œé©±åŠ¨å¤æ‚ã€‚ ä¸€èˆ¬æ¥è¯´ä½æˆæœ¬åœºåˆï¼Œæ™®é€šåº”ç”¨ä¼˜å…ˆè€ƒè™‘ç”¨ä¸‰æç®¡ï¼Œä¸è¡Œçš„è¯æ‰è€ƒè™‘ MOS ç®¡ã€‚ åœºæ•ˆåº”ç®¡èƒ½åœ¨å¾ˆå°ç”µæµå’Œå¾ˆä½ç”µå‹çš„æ¡ä»¶ä¸‹å·¥ä½œï¼ŒåŠŸè€—ä½ï¼Œè€Œä¸”å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æŠŠå¾ˆå¤šåœºæ•ˆåº”ç®¡é›†æˆåœ¨ä¸€å—ç¡…ç‰‡ä¸Šï¼Œå› æ­¤åœºæ•ˆåº”ç®¡åœ¨å¤§è§„æ¨¡é›†æˆç”µè·¯ä¸­å¾—åˆ°äº†å¹¿æ³›çš„åº”ç”¨ã€‚ç›®å‰ä¸»æµçš„æ•°å­—é›†æˆç”µè·¯ï¼ŒåŒ…æ‹¬ CPU/GPU/RAMï¼ŒåŸºæœ¬éƒ½æ˜¯é€šè¿‡å…‰åˆ»åˆ¶é€ çš„ CMOS é›†æˆç”µè·¯ï¼ˆComplementary Metal-Oxide-Semiconductor Integrated Circuitï¼‰ï¼ŒCMOS å°±æ˜¯åŸºäº MOSFET æŠ€æœ¯å®ç°çš„ã€‚ MOSFET ç®¡çš„ç»“æ„ã€ææ€§ï¼Œç”¨æ³•ç­‰å†…å®¹ï¼Œå¾…è¡¥å……â€¦ TODO ","date":"2023-01-31","objectID":"/posts/electrical-engineering-circuits-basics-1/:3:3","series":["EE å…¥é—¨"],"tags":["ç”µå­ç”µè·¯","Electrical Engineering","MCU"],"title":"EE å…¥é—¨ï¼ˆä¸€ï¼‰ - ç”µå­ç”µè·¯åŸºç¡€çŸ¥è¯†","uri":"/posts/electrical-engineering-circuits-basics-1/#3-mosfet-é‡‘å±æ°§åŒ–ç‰©åœºæ•ˆåº”æ™¶ä½“ç®¡"},{"categories":["tech"],"content":" 4. ç”µå®¹ Capacitorç”µå®¹æ˜¯ç”µèƒ½çš„å®¹å™¨ï¼Œé‡Œé¢å­˜å‚¨çš„æ˜¯ç”µè·ï¼Œç”µå®¹åœ¨ç”µè·¯ä¸­æ˜¯å‚¨èƒ½ã€ç¼“å†²ã€å‡å‹ã€è¿‡æ»¤å™¨ä»¶ã€‚ã€‚ æ°´è¦é€šè¿‡æ± å¡˜ã€æ¹–æ³Šï¼Œé¦–å…ˆéœ€è¦çŒæ»¡å®ƒæ‰èƒ½è¿‡å¾—å»ã€‚æ‰€ä»¥è¿™éƒ¨åˆ†æ°´ï¼ˆç”µèƒ½ï¼‰å¯ä»¥è¢«è¿™äº›å®¹å™¨ä¿å­˜ä¸‹æ¥ï¼Œ è¿™æ˜¯ç”µå®¹çš„å‚¨èƒ½ä½œç”¨ï¼Œå¦å¤–å¾ˆæ˜æ˜¾ï¼Œæ— è®ºå‰é¢çš„æ°´æµå¤šä¹ˆæ¹æ€¥ï¼Œåˆ°äº†æ¹–æ³Šå°±è¦å…ˆçŒæ»¡å®ƒï¼Œæ¹–æ³Šå¼€å£å†å‘ä¸‹æ¸¸æµæ°´ï¼Œè‡ªç„¶æµæ°´å°±ç¼“æ…¢ä¸€äº›ï¼Œæ‰€ä»¥å®ƒä¹Ÿæœ‰ç¼“å†²çš„ä½œç”¨ã€‚å¤§æ³¢æµªåˆ°äº†æ¹–æ³Šå˜å¹³ç¨³ï¼Œå®é™…å˜æˆäº†å°æ³¢æµªï¼Œæ³¢çš„å½¢çŠ¶éƒ½å˜äº†ï¼Œè¿™å°±æ˜¯è¿‡æ»¤çš„ä½œç”¨ï¼Œåªå…è®¸ç‰¹å®šçš„æ³¢é€šè¿‡ã€‚ å†å›é¡¾ä¸‹ç”µå®¹ç›¸å…³çš„å…¬å¼ï¼š ç”µå®¹é‡å…¬å¼ï¼š $C = Q/U$ ç”µå®¹é‡ C å•ä½ä¸ºæ³•æ‹‰ Faradï¼Œç¬¦å·ä¸º $F$ å¸¦ç”µé‡ Q çš„å•ä½ä¸ºåº“ä»‘ Coulombï¼Œç¬¦å·ä¸º $C$ åº“ä»‘çš„å®šä¹‰ï¼š $1C = 1A \\cdot s$ 1 åº“ä»‘å³ $6.24146 \\times 10^{18}$ ä¸ªç”µå­æ‰€å¸¦çš„ç”µè·é‡ ç”µå®¹çš„ç±»å‹ï¼š ç“·ç‰‡ç”µå®¹ ç”¨é™¶ç“·ææ–™ä½œä»‹è´¨ï¼Œåœ¨é™¶ç“·è¡¨é¢æ¶‚è¦†ä¸€å±‚é‡‘å±ï¼ˆé“¶ï¼‰è–„è†œï¼Œå†ç»é«˜æ¸©çƒ§ç»“åä½œä¸ºç”µæè€Œæˆã€‚ ç”¨é€”ï¼šé€šå¸¸ç”¨äºé«˜ç¨³å®šæŒ¯è¡å›è·¯ä¸­ï¼Œä½œä¸ºå›è·¯ã€æ—è·¯ç”µå®¹å™¨åŠå«æ•´ç”µå®¹å™¨ã€‚ä½†ä»…é™äºåœ¨å·¥ä½œé¢‘ç‡è¾ƒä½çš„å›è·¯ä¸­ä½œæ—è·¯æˆ–éš”ç›´æµç”¨ï¼Œæˆ–å¯¹ç¨³å®šæ€§å’ŒæŸè€—è¦æ±‚ä¸é«˜çš„åœºåˆã€ˆåŒ…æ‹¬é«˜é¢‘åœ¨å†…ã€‰ã€‚ç“·ç‰‡ç”µå®¹ä¸å®œä½¿ç”¨åœ¨è„‰å†²ç”µè·¯ä¸­ï¼Œå› ä¸ºå®ƒä»¬æ˜“äºè¢«è„‰å†²ç”µå‹å‡»ç©¿ã€‚ é“ç”µè§£ç”µå®¹ï¼ˆæœ‰ææ€§ï¼‰ æœ‰ææ€§é“ç”µè§£ç”µå®¹å™¨æ˜¯å°†é™„æœ‰æ°§åŒ–è†œçš„é“ç®”ï¼ˆæ­£æï¼‰å’Œæµ¸æœ‰ç”µè§£æ¶²çš„è¡¬å«çº¸ï¼Œä¸é˜´æï¼ˆè´Ÿæï¼‰ç®”å ç‰‡ä¸€èµ·å·ç»•è€Œæˆã€‚ ä¼˜ç‚¹: å®¹é‡èŒƒå›´å¤§ï¼Œä¸€èˆ¬ä¸º110 000 Î¼Fï¼Œé¢å®šå·¥ä½œç”µå‹èŒƒå›´ä¸º6.3 V450 Vã€‚ ç¼ºç‚¹: ä»‹è´¨æŸè€—ã€å®¹é‡è¯¯å·®å¤§ï¼ˆæœ€å¤§å…è®¸åå·®+100%ã€â€“20%ï¼‰è€é«˜æ¸©æ€§è¾ƒå·®ï¼Œå­˜æ”¾æ—¶é—´é•¿å®¹æ˜“å¤±æ•ˆã€‚ ç”¨é€”: é€šå¸¸åœ¨ç›´æµç”µæºç”µè·¯æˆ–ä¸­ã€ä½é¢‘ç”µè·¯ä¸­èµ·æ»¤æ³¢ã€é€€è€¦ã€ä¿¡å·è€¦åˆåŠæ—¶é—´å¸¸æ•°è®¾å®šã€éš”ç›´æµç­‰ä½œç”¨ã€‚ æ³¨æ„ï¼šå› å…¶å…·æœ‰ææ€§ï¼Œä¸èƒ½ç”¨äºäº¤æµç”µè·¯ã€‚ ç‹¬çŸ³ç”µå®¹ ç‹¬çŸ³ç”µå®¹æ˜¯ç”¨é’›é…¸é’¡ä¸ºä¸»çš„é™¶ç“·ææ–™çƒ§ç»“åˆ¶æˆçš„å¤šå±‚å ç‰‡çŠ¶è¶…å°å‹ç”µå®¹å™¨ã€‚ ä¼˜ç‚¹: æ€§èƒ½å¯é ã€è€é«˜æ¸©ã€è€æ½®æ¹¿ã€å®¹é‡å¤§ï¼ˆå®¹é‡èŒƒå›´1 pF ~ 1 Î¼Fï¼‰ã€æ¼ç”µæµå°ç­‰ ç¼ºç‚¹: å·¥ä½œç”µå‹ä½ï¼ˆè€å‹ä½äº100 Vï¼‰ ç”¨é€”: å¹¿æ³›åº”ç”¨äºè°æŒ¯ã€æ—è·¯ã€è€¦åˆã€æ»¤æ³¢ç­‰ã€‚ å¸¸ç”¨çš„æœ‰CT4 ï¼ˆä½é¢‘ï¼‰ ã€CT42ï¼ˆä½é¢‘ï¼‰ï¼›CC4ï¼ˆé«˜é¢‘ï¼‰ã€CC42ï¼ˆé«˜é¢‘ï¼‰ç­‰ç³»åˆ—ã€‚ é’½ç”µè§£ç”µå®¹ æœ‰ä¸¤ç§åˆ¶ä½œå·¥è‰ºï¼š ç®”å¼é’½ç”µè§£ç”µå®¹å™¨ï¼šå†…éƒ¨é‡‡ç”¨å·ç»•èŠ¯å­,è´Ÿæä¸ºæ¶²ä½“ç”µè§£è´¨ï¼Œä»‹è´¨ä¸ºæ°§åŒ–é’½ ç²‰çƒ§ç»“å¼ï¼š é˜³æï¼ˆæ­£æï¼‰ç”¨é¢—ç²’å¾ˆç»†çš„é’½ç²‰å‹å—åçƒ§ç»“è€Œæˆ ä¼˜ç‚¹: ä»‹è´¨æŸè€—å°ã€é¢‘ç‡ç‰¹æ€§å¥½ã€è€é«˜æ¸©ã€æ¼ç”µæµå°ã€‚ ç¼ºç‚¹: ç”Ÿäº§æˆæœ¬é«˜ã€è€å‹ä½ ç”¨é€”: å¹¿æ³›åº”ç”¨äºé€šä¿¡ã€èˆªå¤©ã€å†›å·¥åŠå®¶ç”¨ç”µå™¨ä¸Šå„ç§ä¸­ ã€ä½é¢‘ç”µè·¯å’Œæ—¶é—´å¸¸æ•°è®¾ç½®ç”µè·¯ä¸­ã€‚ ç­‰ç­‰ ","date":"2023-01-31","objectID":"/posts/electrical-engineering-circuits-basics-1/:3:4","series":["EE å…¥é—¨"],"tags":["ç”µå­ç”µè·¯","Electrical Engineering","MCU"],"title":"EE å…¥é—¨ï¼ˆä¸€ï¼‰ - ç”µå­ç”µè·¯åŸºç¡€çŸ¥è¯†","uri":"/posts/electrical-engineering-circuits-basics-1/#4-ç”µå®¹-capacitor"},{"categories":["tech"],"content":" 5. ç”µæ„Ÿ Inductanceã€Œç”µç£æ„Ÿåº”ï¼ˆElectromagnetic inductionï¼‰ã€æˆ‘ä»¬éƒ½å­¦è¿‡ï¼Œå®ƒæ˜¯æŒ‡æ”¾åœ¨å˜åŒ–ç£é€šé‡ä¸­çš„å¯¼ä½“ï¼Œä¼šäº§ç”Ÿç”µåŠ¨åŠ¿ã€‚ æ­¤ç”µåŠ¨åŠ¿ç§°ä¸ºæ„Ÿåº”ç”µåŠ¨åŠ¿æˆ–æ„Ÿç”Ÿç”µåŠ¨åŠ¿ï¼Œè‹¥å°†æ­¤å¯¼ä½“é—­åˆæˆä¸€å›è·¯ï¼Œåˆ™è¯¥ç”µåŠ¨åŠ¿ä¼šé©±ä½¿ç”µå­æµåŠ¨ï¼Œå½¢æˆæ„Ÿåº”ç”µæµï¼ˆæ„Ÿç”Ÿç”µæµï¼‰ã€‚ ç®€å•çš„è¯´å°±æ˜¯ç£åœºå˜åŒ–èƒ½äº§ç”Ÿç”µèƒ½ï¼Œç”µæµå˜åŒ–ä¹Ÿä¼šå½¢æˆç£åœºã€‚ ç”µç£æ„Ÿåº”æœ€ä¸ºäººæ‰€çŸ¥çš„åº”ç”¨åº”è¯¥å°±æ˜¯ã€Œå‘ç”µæœºã€ã€ã€Œç”µåŠ¨é©¬è¾¾ã€è·Ÿã€Œå˜å‹å™¨ã€äº†ã€‚ã€Œå‘ç”µæœºã€é€šè¿‡ç”µç£æ„Ÿåº”å°†æœºæ¢°èƒ½è½¬æ¢ä¸ºç”µèƒ½ï¼Œè€Œã€Œç”µåŠ¨é©¬è¾¾ã€åˆšå¥½ç›¸åï¼Œå®ƒé€šè¿‡ç”µç£æ„Ÿåº”å°†ç”µèƒ½è½¬æ¢ä¸ºæœºæ¢°èƒ½ã€‚è¿™ä¸ªè½¬æ¢å®é™…ä¸Šéƒ½æ˜¯ä¾é ç£åœºä¸ã€Œç”µç£æ„Ÿåº”ã€å®ç°çš„ã€‚ è€Œæˆ‘ä»¬è¿™é‡Œæçš„ç”µæ„Ÿè¿™ç§å…ƒå™¨ä»¶ï¼Œå…¶æ ¸å¿ƒåŸç†æ˜¯æ¥æ¬¡å®šå¾‹ï¼ˆLenzâ€™s lawï¼‰ï¼š ç”±äºç£é€šé‡çš„æ”¹å˜è€Œäº§ç”Ÿçš„æ„Ÿåº”ç”µæµï¼Œæ­¤ç”µæµçš„æµå‘ä¸ºæŠ—æ‹’ç£é€šé‡æ”¹å˜çš„æ–¹å‘ã€‚ å°†æ¥æ¬¡å®šå¾‹åº”ç”¨åœ¨é—­åˆå›è·¯çš„è‡ªæ„Ÿæ•ˆåº”ä¸­ï¼Œå¾—åˆ°çš„ç»“è®ºæ˜¯ï¼š ç”µè·¯ä¸Šæ‰€è¯±å¯¼å‡ºçš„ç”µåŠ¨åŠ¿çš„æ–¹å‘ï¼Œæ€»æ˜¯ä½¿å¾—å®ƒæ‰€é©±åŠ¨çš„ç”µæµï¼Œä¼šé˜»ç¢åŸå…ˆäº§ç”Ÿå®ƒï¼ˆå³ç”µåŠ¨åŠ¿ï¼‰çš„ç£é€šé‡ä¹‹å˜åŒ–ã€‚ å…·ä½“è€Œè¨€ï¼Œå¯¹äºã€Œç”µæ„Ÿã€ï¼Œå½“ç”µæµå¢åŠ æ—¶å®ƒä¼šå°†èƒ½é‡ä»¥ç£åœºçš„å½¢å¼æš‚æ—¶å­˜å‚¨èµ·æ¥ï¼Œç­‰åˆ°ç”µæµå‡å°æ—¶å®ƒåˆä¼šå°†ç£åœºçš„èƒ½é‡é‡Šæ”¾å‡ºæ¥ï¼Œè¿™ä¼šäº§ç”ŸæŠµæŠ—ç”µæµå˜åŒ–çš„æ•ˆæœã€‚ ç”µæ„Ÿå¹¶ä¸æŸè€—èƒ½é‡ï¼Œå®ƒåªæ˜¯ä¸´æ—¶å°†ç”µæµå­˜å‚¨èµ·æ¥ï¼Œå¾…ä¼šå„¿å†é‡Šæ”¾å‡ºæ¥è€Œå·²ï¼ˆè¿™å«ä»€ä¹ˆï¼Ÿå‰Šå³°å¡«è°·ï¼Œå¹³æ»‘ç®—æ³•ï¼‰ã€‚ ç”µæ„Ÿçš„ç»“æ„é€šå¸¸æ˜¯æ¼†åŒ…é“œçº¿ç¼ ç»•åœ¨ä¸€ä¸ªæ°¸ç£ä½“ä¸Šï¼Œå› ä¸ºéœ€è¦æœ‰ç”µæµçš„å˜åŒ–æ‰èƒ½å·¥ä½œï¼Œé€šå¸¸ä»…åº”ç”¨åœ¨äº¤æµç”µé¢†åŸŸã€‚ ","date":"2023-01-31","objectID":"/posts/electrical-engineering-circuits-basics-1/:3:5","series":["EE å…¥é—¨"],"tags":["ç”µå­ç”µè·¯","Electrical Engineering","MCU"],"title":"EE å…¥é—¨ï¼ˆä¸€ï¼‰ - ç”µå­ç”µè·¯åŸºç¡€çŸ¥è¯†","uri":"/posts/electrical-engineering-circuits-basics-1/#5-ç”µæ„Ÿ-inductance"},{"categories":["tech"],"content":" 6. ç”µé˜» è¶³å¤Ÿæ·±å…¥çš„åˆ†æï¼šç”µé˜»çš„å®šä¹‰åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ æˆ‘ä»¬å¯¹ç”µé˜»æœ€ç›´è§‚çš„ç†è§£ï¼Œæ˜¯ä¸­å­¦æ—¶å­¦è¿‡çš„ï¼š $$R = \\frac{V}{I}$$ ä½†æ˜¯åœ¨ç®€å•çš„å«æœ‰ç”µé˜» R + ä¸€ä¸ªç”µæ„Ÿæˆ–ç”µå®¹çš„ç›´æµç”µè·¯ä¸­ï¼Œç”µæµæ˜¯éšæ—¶é—´å˜åŒ–çš„ï¼Œå¹¶åœ¨æœ€ç»ˆè¾¾åˆ°ä¸€ä¸ªç¨³æ€ã€‚ è¿™æ—¶æ ¹æ®ä¸Šé¢çš„å…¬å¼è®¡ç®—ï¼Œå› ä¸ºç”µå‹æ˜¯å›ºå®šçš„ï¼Œæˆ‘ä»¬å‘ç°ç”µè·¯ä¸­ç”µé˜» R çš„é˜»å€¼å®é™…æ˜¯éšæ—¶é—´å˜åŒ–çš„ã€‚ è¿™ä¸ªé—®é¢˜åœ¨ç›´æµç”µè·¯ä¸­å¹¶ä¸æ˜æ˜¾ï¼Œå› ä¸ºç”µè·¯æœ€ç»ˆä»ç„¶ä¼šè¾¾åˆ°ç¨³æ€ï¼Œè¿™æ—¶ç”µé˜»å°±è·Ÿå®ƒçš„æ ‡ç§°ç”µé˜»å·®è·ä¸å¤§äº†ã€‚ ä½†æ˜¯åœ¨äº¤æµç”µè·¯ä¸­ï¼Œå› ä¸ºç”µæµå§‹ç»ˆæ˜¯åœ¨éœ‡è¡çš„ï¼Œè¿™ä¸ªé—®é¢˜å°±ä¼šå˜å¾—ç›¸å½“æ˜æ˜¾ï¼Œä»¥è‡³äºæ— æ³•ç®€å•åœ°ä½¿ç”¨ã€Œç”µé˜»ã€æ¥è¡¨è¾¾ä¸€ä¸ªç”µé˜»å™¨çš„ç‰¹æ€§ï¼Œä¸ºæ­¤å¼•å…¥äº†ä¸€ä¸ªæ–°æ¦‚å¿µå«ã€Œé˜»æŠ—ã€ã€‚ åœ¨å…·æœ‰ç”µé˜»ã€ç”µæ„Ÿå’Œç”µå®¹çš„ç”µè·¯é‡Œï¼Œå¯¹ç”µè·¯ä¸­çš„ç”µæµæ‰€èµ·çš„é˜»ç¢ä½œç”¨å«åšé˜»æŠ—ã€‚é˜»æŠ—å¸¸ç”¨Zè¡¨ç¤ºï¼Œæ˜¯ä¸€ä¸ªå¤æ•°ï¼Œå®éƒ¨ç§°ä¸ºç”µé˜»ï¼Œè™šéƒ¨ç§°ä¸ºç”µæŠ—ï¼Œå…¶ä¸­ç”µå®¹åœ¨ç”µè·¯ä¸­å¯¹äº¤æµç”µæ‰€èµ·çš„é˜»ç¢ä½œç”¨ç§°ä¸ºå®¹æŠ— ,ç”µæ„Ÿåœ¨ç”µè·¯ä¸­å¯¹äº¤æµç”µæ‰€èµ·çš„é˜»ç¢ä½œç”¨ç§°ä¸ºæ„ŸæŠ—ï¼Œç”µå®¹å’Œç”µæ„Ÿåœ¨ç”µè·¯ä¸­å¯¹äº¤æµç”µå¼•èµ·çš„é˜»ç¢ä½œç”¨æ€»ç§°ä¸ºé˜»æŠ—ã€‚ é˜»æŠ—çš„å•ä½æ˜¯æ¬§å§†ã€‚é˜»æŠ—çš„æ¦‚å¿µä¸ä»…å­˜åœ¨äºç”µè·¯ä¸­ï¼Œåœ¨åŠ›å­¦çš„æŒ¯åŠ¨ç³»ç»Ÿä¸­ä¹Ÿæœ‰æ¶‰åŠã€‚ å¦‚æœä»”ç»†çœ‹çœ‹ä½ ä¹°è¿‡çš„è€³æœºçš„ç›¸å…³å‚æ•°ï¼Œä¼šå‘ç°å®ƒå°±åŒ…å«ä¸€ä¸ªã€Œé˜»æŠ—ã€å‚æ•°ï¼ŒçŸ¥ä¹ä¸Šå°±æœ‰ç›¸å…³è®¨è®ºè€³æœºæ˜¯ä¸æ˜¯é˜»æŠ—è¶Šé«˜è¶Šå¥½ï¼Ÿ. å¯¹ç”µé˜»æ›´ç²¾ç¡®çš„ç†è§£æ˜¯ï¼šç”µé˜»æ˜¯ç”µå‹å¯¹ç”µæµçš„å˜åŒ–ç‡ï¼Œå®ƒä¸ä¸€å®šæ˜¯ä¸€ä¸ªé™æ€å€¼ï¼ˆä¹Ÿå°±æ˜¯è¯´å¯èƒ½æ˜¯éçº¿æ€§çš„ï¼Œæ¯”å¦‚äºŒæç®¡çš„ä¼å®‰ç‰¹æ€§æ›²çº¿å°±ä¸æ˜¯ç›´çº¿ï¼‰ã€‚ å•ç‰‡æœºçš„ä¸‹æ‹‰ç”µé˜»ä¸ä¸Šæ‹‰ç”µé˜»ç”¨å•ç‰‡æœºè®¾è®¡ç”µè·¯æ—¶ï¼Œä¸€ä¸ªé‡è¦çš„ç‚¹å°±æ˜¯ä¸‹æ‹‰ç”µé˜»ä¸ä¸Šæ‹‰ç”µé˜»ã€‚ ä¸å¤ªå¥½ç›´æ¥è§£é‡Šï¼Œç›´æ¥çœ‹è§†é¢‘å§ï¼Œä¸‹é¢è¿™ä¸¤ä¸ªè§†é¢‘è§£é‡Šå¾—å¾ˆæ¸…æ™°ï¼š ä¸Šæ‹‰ç”µé˜»çš„é€šä¿—è§£é‡Š ä¸‹æ‹‰ç”µé˜»çš„é€šä¿—è§£é‡Š å†è¡¥å……ä¸€ä¸ªåšå‹çš„æ–‡ç« å•ç‰‡æœºçš„GPIOé…ç½®ï¼Œè¯¦ç»†è§£é‡Šäº† GPIO ç›¸å…³çš„é…ç½®åŸç†ã€‚ ","date":"2023-01-31","objectID":"/posts/electrical-engineering-circuits-basics-1/:3:6","series":["EE å…¥é—¨"],"tags":["ç”µå­ç”µè·¯","Electrical Engineering","MCU"],"title":"EE å…¥é—¨ï¼ˆä¸€ï¼‰ - ç”µå­ç”µè·¯åŸºç¡€çŸ¥è¯†","uri":"/posts/electrical-engineering-circuits-basics-1/#6-ç”µé˜»"},{"categories":["tech"],"content":" 6. ç”µé˜» è¶³å¤Ÿæ·±å…¥çš„åˆ†æï¼šç”µé˜»çš„å®šä¹‰åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ æˆ‘ä»¬å¯¹ç”µé˜»æœ€ç›´è§‚çš„ç†è§£ï¼Œæ˜¯ä¸­å­¦æ—¶å­¦è¿‡çš„ï¼š $$R = \\frac{V}{I}$$ ä½†æ˜¯åœ¨ç®€å•çš„å«æœ‰ç”µé˜» R + ä¸€ä¸ªç”µæ„Ÿæˆ–ç”µå®¹çš„ç›´æµç”µè·¯ä¸­ï¼Œç”µæµæ˜¯éšæ—¶é—´å˜åŒ–çš„ï¼Œå¹¶åœ¨æœ€ç»ˆè¾¾åˆ°ä¸€ä¸ªç¨³æ€ã€‚ è¿™æ—¶æ ¹æ®ä¸Šé¢çš„å…¬å¼è®¡ç®—ï¼Œå› ä¸ºç”µå‹æ˜¯å›ºå®šçš„ï¼Œæˆ‘ä»¬å‘ç°ç”µè·¯ä¸­ç”µé˜» R çš„é˜»å€¼å®é™…æ˜¯éšæ—¶é—´å˜åŒ–çš„ã€‚ è¿™ä¸ªé—®é¢˜åœ¨ç›´æµç”µè·¯ä¸­å¹¶ä¸æ˜æ˜¾ï¼Œå› ä¸ºç”µè·¯æœ€ç»ˆä»ç„¶ä¼šè¾¾åˆ°ç¨³æ€ï¼Œè¿™æ—¶ç”µé˜»å°±è·Ÿå®ƒçš„æ ‡ç§°ç”µé˜»å·®è·ä¸å¤§äº†ã€‚ ä½†æ˜¯åœ¨äº¤æµç”µè·¯ä¸­ï¼Œå› ä¸ºç”µæµå§‹ç»ˆæ˜¯åœ¨éœ‡è¡çš„ï¼Œè¿™ä¸ªé—®é¢˜å°±ä¼šå˜å¾—ç›¸å½“æ˜æ˜¾ï¼Œä»¥è‡³äºæ— æ³•ç®€å•åœ°ä½¿ç”¨ã€Œç”µé˜»ã€æ¥è¡¨è¾¾ä¸€ä¸ªç”µé˜»å™¨çš„ç‰¹æ€§ï¼Œä¸ºæ­¤å¼•å…¥äº†ä¸€ä¸ªæ–°æ¦‚å¿µå«ã€Œé˜»æŠ—ã€ã€‚ åœ¨å…·æœ‰ç”µé˜»ã€ç”µæ„Ÿå’Œç”µå®¹çš„ç”µè·¯é‡Œï¼Œå¯¹ç”µè·¯ä¸­çš„ç”µæµæ‰€èµ·çš„é˜»ç¢ä½œç”¨å«åšé˜»æŠ—ã€‚é˜»æŠ—å¸¸ç”¨Zè¡¨ç¤ºï¼Œæ˜¯ä¸€ä¸ªå¤æ•°ï¼Œå®éƒ¨ç§°ä¸ºç”µé˜»ï¼Œè™šéƒ¨ç§°ä¸ºç”µæŠ—ï¼Œå…¶ä¸­ç”µå®¹åœ¨ç”µè·¯ä¸­å¯¹äº¤æµç”µæ‰€èµ·çš„é˜»ç¢ä½œç”¨ç§°ä¸ºå®¹æŠ— ,ç”µæ„Ÿåœ¨ç”µè·¯ä¸­å¯¹äº¤æµç”µæ‰€èµ·çš„é˜»ç¢ä½œç”¨ç§°ä¸ºæ„ŸæŠ—ï¼Œç”µå®¹å’Œç”µæ„Ÿåœ¨ç”µè·¯ä¸­å¯¹äº¤æµç”µå¼•èµ·çš„é˜»ç¢ä½œç”¨æ€»ç§°ä¸ºé˜»æŠ—ã€‚ é˜»æŠ—çš„å•ä½æ˜¯æ¬§å§†ã€‚é˜»æŠ—çš„æ¦‚å¿µä¸ä»…å­˜åœ¨äºç”µè·¯ä¸­ï¼Œåœ¨åŠ›å­¦çš„æŒ¯åŠ¨ç³»ç»Ÿä¸­ä¹Ÿæœ‰æ¶‰åŠã€‚ å¦‚æœä»”ç»†çœ‹çœ‹ä½ ä¹°è¿‡çš„è€³æœºçš„ç›¸å…³å‚æ•°ï¼Œä¼šå‘ç°å®ƒå°±åŒ…å«ä¸€ä¸ªã€Œé˜»æŠ—ã€å‚æ•°ï¼ŒçŸ¥ä¹ä¸Šå°±æœ‰ç›¸å…³è®¨è®ºè€³æœºæ˜¯ä¸æ˜¯é˜»æŠ—è¶Šé«˜è¶Šå¥½ï¼Ÿ. å¯¹ç”µé˜»æ›´ç²¾ç¡®çš„ç†è§£æ˜¯ï¼šç”µé˜»æ˜¯ç”µå‹å¯¹ç”µæµçš„å˜åŒ–ç‡ï¼Œå®ƒä¸ä¸€å®šæ˜¯ä¸€ä¸ªé™æ€å€¼ï¼ˆä¹Ÿå°±æ˜¯è¯´å¯èƒ½æ˜¯éçº¿æ€§çš„ï¼Œæ¯”å¦‚äºŒæç®¡çš„ä¼å®‰ç‰¹æ€§æ›²çº¿å°±ä¸æ˜¯ç›´çº¿ï¼‰ã€‚ å•ç‰‡æœºçš„ä¸‹æ‹‰ç”µé˜»ä¸ä¸Šæ‹‰ç”µé˜»ç”¨å•ç‰‡æœºè®¾è®¡ç”µè·¯æ—¶ï¼Œä¸€ä¸ªé‡è¦çš„ç‚¹å°±æ˜¯ä¸‹æ‹‰ç”µé˜»ä¸ä¸Šæ‹‰ç”µé˜»ã€‚ ä¸å¤ªå¥½ç›´æ¥è§£é‡Šï¼Œç›´æ¥çœ‹è§†é¢‘å§ï¼Œä¸‹é¢è¿™ä¸¤ä¸ªè§†é¢‘è§£é‡Šå¾—å¾ˆæ¸…æ™°ï¼š ä¸Šæ‹‰ç”µé˜»çš„é€šä¿—è§£é‡Š ä¸‹æ‹‰ç”µé˜»çš„é€šä¿—è§£é‡Š å†è¡¥å……ä¸€ä¸ªåšå‹çš„æ–‡ç« å•ç‰‡æœºçš„GPIOé…ç½®ï¼Œè¯¦ç»†è§£é‡Šäº† GPIO ç›¸å…³çš„é…ç½®åŸç†ã€‚ ","date":"2023-01-31","objectID":"/posts/electrical-engineering-circuits-basics-1/:3:6","series":["EE å…¥é—¨"],"tags":["ç”µå­ç”µè·¯","Electrical Engineering","MCU"],"title":"EE å…¥é—¨ï¼ˆä¸€ï¼‰ - ç”µå­ç”µè·¯åŸºç¡€çŸ¥è¯†","uri":"/posts/electrical-engineering-circuits-basics-1/#å•ç‰‡æœºçš„ä¸‹æ‹‰ç”µé˜»ä¸ä¸Šæ‹‰ç”µé˜»"},{"categories":["tech"],"content":" 7. æ™¶æŒ¯ (Xtal) ä¸æŒ¯è¡ç”µè·¯ ç§’æ‡‚å•ç‰‡æœºæ™¶æŒ¯ç”µè·¯åŸç† çŸ³è‹±æ™¶ä½“æˆ–æ™¶æŒ¯ï¼Œæ˜¯åˆ©ç”¨çŸ³è‹±æ™¶ä½“ï¼ˆåˆç§°æ°´æ™¶ï¼‰çš„å‹ç”µæ•ˆåº”ï¼Œç”¨æ¥äº§ç”Ÿé«˜ç²¾åº¦æŒ¯è¡é¢‘ç‡çš„ä¸€ç§ç”µå­å™¨ä»¶ï¼Œå±äºè¢«åŠ¨å™¨ä»¶ï¼ˆæ— æºæºä»¶ï¼‰ã€‚ æ™¶ä½“æ˜¯æŒ‡å…¶ä¸­çš„åŸå­ã€åˆ†å­ã€æˆ–ç¦»å­ä»¥è§„åˆ™ã€é‡å¤çš„æ¨¡å¼æœå„æ–¹å‘å»¶ä¼¸çš„ä¸€ç§å›ºä½“ã€‚æ™¶ä½“ä¸å‡ ä¹æ‰€æœ‰çš„å¼¹æ€§ç‰©è´¨éƒ½å…·æœ‰è‡ªç„¶å…±æŒ¯é¢‘ç‡ï¼Œé€è¿‡é€‚å½“çš„ä¼ æ„Ÿå™¨å¯åŠ ä»¥åˆ©ç”¨ã€‚ çŸ³è‹±æ™¶ä½“çš„ä¼˜ç‚¹æ˜¯åœ¨æ¸©åº¦å˜åŒ–æ—¶ï¼Œå½±å“éœ‡è¡é¢‘ç‡çš„å¼¹æ€§ç³»æ•°ä¸å°ºå¯¸å˜åŒ–è½»å¾®ï¼Œå› è€Œåœ¨é¢‘ç‡ç‰¹æ€§ä¸Šè¡¨ç°ç¨³å®šã€‚ çŸ³è‹±æ™¶ä½“è°æŒ¯å™¨çš„åŸç†ï¼š çŸ³è‹±æ™¶ä½“ä¸Šçš„ç”µæå¯¹ä¸€é¢—è¢«é€‚å½“åˆ‡å‰²å¹¶å®‰ç½®çš„çŸ³è‹±æ™¶ä½“æ–½ä»¥ç”µåœºæ—¶ï¼Œæ™¶ä½“ä¼šäº§ç”Ÿå½¢å˜ã€‚è¿™ä¸æ™¶ä½“å—å‹åŠ›äº§ç”Ÿç”µåŠ¿çš„ç°è±¡åˆšå¥½ç›¸åï¼Œå› æ­¤è¢«ç§°åšé€†å‹ç”µæ•ˆåº”ã€‚ å½“å¤–åŠ ç”µåœºç§»é™¤æ—¶ï¼ŒçŸ³è‹±æ™¶ä½“åˆä¼šæ¢å¤åŸçŠ¶å¹¶å‘å‡ºç”µåœºï¼Œå› è€Œåœ¨ç”µæä¸Šäº§ç”Ÿç”µå‹ï¼Œè¿™æ˜¯æˆ‘ä»¬ç†ŸçŸ¥çš„å‹ç”µæ•ˆåº”ã€‚ é€†å‹ç”µæ•ˆåº” + å‹ç”µæ•ˆåº” è¿™ä¸¤ä¸ªç‰¹æ€§é€ æˆçŸ³è‹±æ™¶ä½“åœ¨ç”µè·¯ä¸­çš„è¡Œä¸ºï¼Œç±»ä¼¼äºæŸç§ç”µæ„Ÿå™¨ã€ç”µå®¹å™¨ã€ä¸ç”µé˜»å™¨æ‰€ç»„åˆæˆçš„ RLC ç”µè·¯ã€‚ç»„åˆä¸­çš„ç”µæ„Ÿç”µå®¹è°æŒ¯é¢‘ç‡åˆ™åæ˜ äº†çŸ³è‹±æ™¶ä½“çš„å®ä½“å…±æŒ¯é¢‘ç‡ã€‚ å½“å¤–åŠ äº¤å˜ç”µå‹çš„é¢‘ç‡ä¸æ™¶ç‰‡çš„å›ºæœ‰é¢‘ç‡ï¼ˆå†³å®šäºæ™¶ç‰‡çš„å°ºå¯¸ä¸åˆ‡å‰²æ–¹æ³•ï¼‰ç›¸ç­‰æ—¶ï¼Œæœºæ¢°æŒ¯åŠ¨çš„å¹…åº¦å°†æ€¥å‰§å¢åŠ ï¼Œè¿™ç§ç°è±¡ç§°ä¸ºå‹ç”µè°æŒ¯ã€‚ å¯èƒ½æœ‰äº›åˆå­¦è€…ä¼šå¯¹æ™¶æŒ¯çš„é¢‘ç‡æ„Ÿåˆ°å¥‡æ€ªï¼Œ12Mã€24M ä¹‹ç±»çš„æ™¶æŒ¯è¾ƒå¥½ç†è§£ï¼Œé€‰ç”¨å¦‚ 11.0592MHZ çš„æ™¶æŒ¯ç»™äººä¸€ç§å¥‡æ€ªçš„æ„Ÿè§‰ï¼Œè¿™ä¸ªé—®é¢˜è§£é‡Šèµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œå¦‚æœåˆå­¦è€…åœ¨ç»ƒä¹ ä¸²å£ç¼–ç¨‹çš„æ—¶å€™å°±ä¼šå¯¹æ­¤æœ‰æ‰€ç†è§£ï¼Œè¿™ç§æ™¶æŒ¯ä¸»è¦æ˜¯å¯ä»¥æ–¹ä¾¿å’Œç²¾ç¡®çš„è®¾è®¡ä¸²å£æˆ–å…¶å®ƒå¼‚æ­¥é€šè®¯æ—¶çš„æ³¢ç‰¹ç‡ã€‚ ","date":"2023-01-31","objectID":"/posts/electrical-engineering-circuits-basics-1/:3:7","series":["EE å…¥é—¨"],"tags":["ç”µå­ç”µè·¯","Electrical Engineering","MCU"],"title":"EE å…¥é—¨ï¼ˆä¸€ï¼‰ - ç”µå­ç”µè·¯åŸºç¡€çŸ¥è¯†","uri":"/posts/electrical-engineering-circuits-basics-1/#7-æ™¶æŒ¯-xtal-ä¸æŒ¯è¡ç”µè·¯"},{"categories":["tech"],"content":" 8. åœ°ç”µè·¯ä¸­æ¯ä¸ªå™¨ä»¶ä¸Šæœ‰ç”µèƒ½é‡é›†èšï¼Œå½¢æˆç”µåŠ¿å·®ï¼Œå°±ç›¸å½“äºç‰©ä½“çš„é«˜åº¦å·®ã€‚å‡è®¾æ²¡æœ‰ä¸€ä¸ªå‚è€ƒåŸºå‡†ç‚¹ï¼Œå°±æ²¡æ³•æµ‹é‡è¿™ä¸ªç”µåŠ¿å·®äº†ï¼Œå› æ­¤è§„å®šç”µè·¯çš„æŸä¸ªç‚¹å°±æ˜¯ä½œä¸ºåŸºå‡†é¢ï¼Œä¹Ÿå°±æ˜¯åœ°ï¼ˆGND/Groundï¼‰äº†ã€‚ åœ°/GND å¹¶ä¸éœ€è¦æ˜¯çœŸæ­£çš„åœ°é¢ï¼Œå¯¹äºæˆ‘ä¸»è¦å…³æ³¨çš„å¼±ç”µç”µè·¯æ¿è€Œè¨€ï¼Œç”µè·¯çš„è´Ÿæå°±æ˜¯åœ°ã€‚ åŒç†å¯æ¨å‡ºï¼Œå¦‚æœéœ€è¦å°†åŒä¸€ä¸ªç”µè·¯æ¿åŒæ—¶æ¥å…¥å¤šä¸ªæºç”µè·¯ï¼Œåˆ™å¿…é¡»å°†è¿™å¤šä¸ªç”µè·¯æ¿çš„è´Ÿæè¿æ¥åœ¨ä¸€èµ·ï¼Œè¿™æ ·å®ƒä»¬çš„ã€ŒGNDã€å‚è€ƒåŸºå‡†ç‚¹æ‰æ˜¯ä¸€è‡´çš„ï¼ é™ç”µç ´åä¸é˜²é™ç”µ https://zhuanlan.zhihu.com/p/570713171 å¼±ç”µé¢†åŸŸå¦å¤–ä¸€ä¸ªå¸¸è§çš„æ¥åœ°åº”è¯¥å°±æ˜¯é™ç”µæ¥åœ°äº†ï¼Œè¿™æ˜¯ä¸ºäº†ç¡®ä¿äººä½“/å·¥ä½œå°ä¸åœ°é¢çš„ç”µåŠ¿å·®ä¸ºé›¶ï¼Œ é¿å…å·¥ä½œæ—¶é™ç”µæ”¾ç”µå¯¼è‡´å…ƒå™¨ä»¶æŸåã€‚ äººä½“æ„Ÿåº”çš„é™ç”µç”µå‹ä¸€èˆ¬åœ¨ 2KV-4KV å·¦å³ï¼Œé€šå¸¸æ˜¯äººä½“è½»å¾®è¿åŠ¨æˆ–ä¸ç»ç¼˜æ‘©æ“¦å¼•èµ·çš„ã€‚è¿™ä¹ˆé«˜çš„ç”µå‹ï¼Œè¶³å¤Ÿå‡»ç©¿å¾ˆå¤šç”µå­å…ƒä»¶äº†ï¼Œæ‰€ä»¥ç”µå­å‚éƒ½ä¼šå¼ºåˆ¶å‘˜å·¥ç©¿æˆ´é˜²é™ç”µè£…ç½®ï¼ˆæœ‰çº¿é˜²é™ç”µæ‰‹ç¯ï¼‰ã€‚ é™ç”µæ¥åœ°é€šå¸¸è¦æ±‚æ¥çœŸæ­£çš„åœ°é¢ï¼Œæ¯”å¦‚ä¸å»ºç­‘ç‰©æ¥è§¦ç´§å¯†çš„é‡‘å±é—¨çª—ã€æ°´é¾™å¤´ç­‰éƒ½ç®—æ˜¯ã€Œåœ°ã€ã€‚ä¸ªäººç”¨çš„è¯ï¼Œæ®æœ‹å‹ä»‹ç»æ•ˆæœæœ€å¥½çš„æ–¹æ³•æ˜¯ï¼šç©¿æ‹–é‹ï¼Œå¹¶ä¸”ä¸€åªè„šè¸©åœ°ä¸Šå“ˆå“ˆ~ ","date":"2023-01-31","objectID":"/posts/electrical-engineering-circuits-basics-1/:3:8","series":["EE å…¥é—¨"],"tags":["ç”µå­ç”µè·¯","Electrical Engineering","MCU"],"title":"EE å…¥é—¨ï¼ˆä¸€ï¼‰ - ç”µå­ç”µè·¯åŸºç¡€çŸ¥è¯†","uri":"/posts/electrical-engineering-circuits-basics-1/#8-åœ°"},{"categories":["tech"],"content":" 8. åœ°ç”µè·¯ä¸­æ¯ä¸ªå™¨ä»¶ä¸Šæœ‰ç”µèƒ½é‡é›†èšï¼Œå½¢æˆç”µåŠ¿å·®ï¼Œå°±ç›¸å½“äºç‰©ä½“çš„é«˜åº¦å·®ã€‚å‡è®¾æ²¡æœ‰ä¸€ä¸ªå‚è€ƒåŸºå‡†ç‚¹ï¼Œå°±æ²¡æ³•æµ‹é‡è¿™ä¸ªç”µåŠ¿å·®äº†ï¼Œå› æ­¤è§„å®šç”µè·¯çš„æŸä¸ªç‚¹å°±æ˜¯ä½œä¸ºåŸºå‡†é¢ï¼Œä¹Ÿå°±æ˜¯åœ°ï¼ˆGND/Groundï¼‰äº†ã€‚ åœ°/GND å¹¶ä¸éœ€è¦æ˜¯çœŸæ­£çš„åœ°é¢ï¼Œå¯¹äºæˆ‘ä¸»è¦å…³æ³¨çš„å¼±ç”µç”µè·¯æ¿è€Œè¨€ï¼Œç”µè·¯çš„è´Ÿæå°±æ˜¯åœ°ã€‚ åŒç†å¯æ¨å‡ºï¼Œå¦‚æœéœ€è¦å°†åŒä¸€ä¸ªç”µè·¯æ¿åŒæ—¶æ¥å…¥å¤šä¸ªæºç”µè·¯ï¼Œåˆ™å¿…é¡»å°†è¿™å¤šä¸ªç”µè·¯æ¿çš„è´Ÿæè¿æ¥åœ¨ä¸€èµ·ï¼Œè¿™æ ·å®ƒä»¬çš„ã€ŒGNDã€å‚è€ƒåŸºå‡†ç‚¹æ‰æ˜¯ä¸€è‡´çš„ï¼ é™ç”µç ´åä¸é˜²é™ç”µ https://zhuanlan.zhihu.com/p/570713171 å¼±ç”µé¢†åŸŸå¦å¤–ä¸€ä¸ªå¸¸è§çš„æ¥åœ°åº”è¯¥å°±æ˜¯é™ç”µæ¥åœ°äº†ï¼Œè¿™æ˜¯ä¸ºäº†ç¡®ä¿äººä½“/å·¥ä½œå°ä¸åœ°é¢çš„ç”µåŠ¿å·®ä¸ºé›¶ï¼Œ é¿å…å·¥ä½œæ—¶é™ç”µæ”¾ç”µå¯¼è‡´å…ƒå™¨ä»¶æŸåã€‚ äººä½“æ„Ÿåº”çš„é™ç”µç”µå‹ä¸€èˆ¬åœ¨ 2KV-4KV å·¦å³ï¼Œé€šå¸¸æ˜¯äººä½“è½»å¾®è¿åŠ¨æˆ–ä¸ç»ç¼˜æ‘©æ“¦å¼•èµ·çš„ã€‚è¿™ä¹ˆé«˜çš„ç”µå‹ï¼Œè¶³å¤Ÿå‡»ç©¿å¾ˆå¤šç”µå­å…ƒä»¶äº†ï¼Œæ‰€ä»¥ç”µå­å‚éƒ½ä¼šå¼ºåˆ¶å‘˜å·¥ç©¿æˆ´é˜²é™ç”µè£…ç½®ï¼ˆæœ‰çº¿é˜²é™ç”µæ‰‹ç¯ï¼‰ã€‚ é™ç”µæ¥åœ°é€šå¸¸è¦æ±‚æ¥çœŸæ­£çš„åœ°é¢ï¼Œæ¯”å¦‚ä¸å»ºç­‘ç‰©æ¥è§¦ç´§å¯†çš„é‡‘å±é—¨çª—ã€æ°´é¾™å¤´ç­‰éƒ½ç®—æ˜¯ã€Œåœ°ã€ã€‚ä¸ªäººç”¨çš„è¯ï¼Œæ®æœ‹å‹ä»‹ç»æ•ˆæœæœ€å¥½çš„æ–¹æ³•æ˜¯ï¼šç©¿æ‹–é‹ï¼Œå¹¶ä¸”ä¸€åªè„šè¸©åœ°ä¸Šå“ˆå“ˆ~ ","date":"2023-01-31","objectID":"/posts/electrical-engineering-circuits-basics-1/:3:8","series":["EE å…¥é—¨"],"tags":["ç”µå­ç”µè·¯","Electrical Engineering","MCU"],"title":"EE å…¥é—¨ï¼ˆä¸€ï¼‰ - ç”µå­ç”µè·¯åŸºç¡€çŸ¥è¯†","uri":"/posts/electrical-engineering-circuits-basics-1/#é™ç”µç ´åä¸é˜²é™ç”µ"},{"categories":["tech"],"content":" ä¸‰ã€å¸¸è§ç”µè·¯è®¡ç®—æ–¹å¼","date":"2023-01-31","objectID":"/posts/electrical-engineering-circuits-basics-1/:4:0","series":["EE å…¥é—¨"],"tags":["ç”µå­ç”µè·¯","Electrical Engineering","MCU"],"title":"EE å…¥é—¨ï¼ˆä¸€ï¼‰ - ç”µå­ç”µè·¯åŸºç¡€çŸ¥è¯†","uri":"/posts/electrical-engineering-circuits-basics-1/#ä¸‰å¸¸è§ç”µè·¯è®¡ç®—æ–¹å¼"},{"categories":["tech"],"content":" 1. å¦‚ä½•é€‰ç”¨æ­£ç¡®çš„ç”µé˜»ï¼Ÿè¿™éœ€è¦ä½¿ç”¨åˆ°æˆ‘ä»¬ä¸­å­¦å­¦è¿‡çš„ç‰©ç†å­¦æ¬§å§†å®šå¾‹å…¬å¼ï¼š $$V = I \\cdot R$$ é¦–å…ˆé’ˆå¯¹ç”µå­ç”µè·¯é¢†åŸŸçš„ hello worldï¼Œå³å‘å…‰äºŒæç®¡ + ç”µé˜»ï¼š æˆ‘ä»¬å¯ä»¥æ ¹æ® LED ç¯çš„æœ€å¤§ç”µæµæ¥ä¼°ç®—ç”µé˜»å€¼ï¼Œæ ¹æ®æ¬§å§†å®šå¾‹æœ‰ $$R = \\frac{V}{I}$$ æ™®é€šå‘å…‰äºŒæç®¡çš„æ­£å¸¸å·¥ä½œç”µæµé€šå¸¸ä¸º $2 \\text{mA}$ ~ $20 \\text{mA}$ï¼Œç”µæµè¶Šå¤§å®ƒå°±è¶Šäº®ï¼Œæ­£å‘å‹é™æœ‰å¥½å‡ ç§ï¼Œå‡è®¾æˆ‘ä»¬çš„ä¸º $3.3v$ã€‚ å› æ­¤ç”µè·¯å…è®¸çš„æœ€å¤§ç”µæµä¸º $0.02 \\text{A}$ï¼Œå¦‚æœç”µæºç”µå‹ä¸º 3.7vï¼Œé‚£ç”µé˜»å¾—åˆ°çš„ç”µå‹å¤§æ¦‚ä¸º $0.4 \\text{V}$ï¼Œè¿™æ ·å¯è®¡ç®—å¾—åˆ° $R$ ä¸º $20 \\Omega$. å‘å…‰äºŒæç®¡åœ¨æ­£å¸¸å·¥ä½œçŠ¶æ€å‡ ä¹æ²¡æœ‰ç”µé˜»ï¼Œå› æ­¤å¯ä»¥ç›´æ¥å°†ä¸Šé¢è®¡ç®—å‡ºçš„ç»“æœå½“ä½œä¸²è”ç”µé˜»çš„é˜»å€¼ã€‚ å› æ­¤ä¸ºäº†ä½¿å‘å…‰äºŒæç®¡æ­£å¸¸å·¥ä½œï¼Œä¸²è”ç”µé˜»åº”è¯¥ç•¥å¤§äº $25 \\Omega$. ","date":"2023-01-31","objectID":"/posts/electrical-engineering-circuits-basics-1/:4:1","series":["EE å…¥é—¨"],"tags":["ç”µå­ç”µè·¯","Electrical Engineering","MCU"],"title":"EE å…¥é—¨ï¼ˆä¸€ï¼‰ - ç”µå­ç”µè·¯åŸºç¡€çŸ¥è¯†","uri":"/posts/electrical-engineering-circuits-basics-1/#1-å¦‚ä½•é€‰ç”¨æ­£ç¡®çš„ç”µé˜»"},{"categories":["tech"],"content":" 2. ç”µè·¯åˆ†æä¸­çš„ä¸¤ä¸ªé‡è¦å®šå¾‹ KAL åŸºå°”éœå¤«ç”µæµå®šå¾‹ï¼šæ‰€æœ‰è¿›å…¥æŸèŠ‚ç‚¹çš„ç”µæµçš„æ€»å’Œç­‰äºæ‰€æœ‰ç¦»å¼€è¿™èŠ‚ç‚¹çš„ç”µæµçš„æ€»å’Œ KVL åŸºå°”éœå¤«ç”µå‹å®šå¾‹ï¼šæ²¿ç€é—­åˆå›è·¯æ‰€æœ‰å…ƒä»¶ä¸¤ç«¯çš„ç”µåŠ¿å·®ï¼ˆç”µå‹ï¼‰çš„ä»£æ•°å’Œç­‰äºé›¶ è¿™ä¸¤ä¸ªå®šå¾‹æ„Ÿè§‰é€šè¿‡ã€Œèƒ½é‡å®ˆæ’ã€å»ç†è§£ï¼Œä¼šæ˜¾å¾—å¾ˆç›´è§‚ï¼Œä¸è®ºæ˜¯ç”µæµè¿˜æ˜¯ç”µå‹ï¼Œéƒ½ä¸ä¼šæ— ä¸­ç”Ÿæœ‰ï¼Œåœ¨æ•´ä¸ªç”µè·¯ä¸Šå®ƒå§‹ç»ˆæ˜¯å®ˆæ’çš„ã€‚ KVL + èŠ‚ç‚¹ç”µå‹æ³•æ˜¯åˆ†æç”µè·¯çš„ä¸€ç§æœ‰æ•ˆæ‰‹æ®µã€‚ ","date":"2023-01-31","objectID":"/posts/electrical-engineering-circuits-basics-1/:4:2","series":["EE å…¥é—¨"],"tags":["ç”µå­ç”µè·¯","Electrical Engineering","MCU"],"title":"EE å…¥é—¨ï¼ˆä¸€ï¼‰ - ç”µå­ç”µè·¯åŸºç¡€çŸ¥è¯†","uri":"/posts/electrical-engineering-circuits-basics-1/#2-ç”µè·¯åˆ†æä¸­çš„ä¸¤ä¸ªé‡è¦å®šå¾‹"},{"categories":["tech"],"content":" 3. éš”ç›´é€šäº¤ä¸éš”äº¤é€šç›´ä¸Šé¢è¿™ä¸ªæ˜¯å¸¸è§çš„ç®€å•ç‰¹æ€§æè¿°ï¼Œä½†æ˜¯ä¸å¤Ÿå‡†ç¡®ï¼Œå‡†ç¡®çš„è¯´ï¼š ç”µå®¹æ˜¯éš”æ–­ä¸å˜çš„ç”µä¿¡å·ï¼Œé€šè¿‡å˜åŒ–çš„ç”µä¿¡å·ã€‚ ç”µæ„Ÿæ˜¯é˜»ç¢å˜åŒ–çš„ç”µä¿¡å·ï¼Œé€šè¿‡ä¸å˜çš„ç”µä¿¡å·ã€‚ æ˜¾ç„¶ç›´æµç”µçš„ç”µæµä¹Ÿæ˜¯å¯ä»¥å˜åŒ–çš„ï¼Œæ¯”å¦‚åˆšè¿‡äº†æ•´æµæ¡¥çš„ç›´æµç”µå°±æ˜¯ä¸€ä¸ªè„‰åŠ¨ä¿¡å·ã€‚ ","date":"2023-01-31","objectID":"/posts/electrical-engineering-circuits-basics-1/:4:3","series":["EE å…¥é—¨"],"tags":["ç”µå­ç”µè·¯","Electrical Engineering","MCU"],"title":"EE å…¥é—¨ï¼ˆä¸€ï¼‰ - ç”µå­ç”µè·¯åŸºç¡€çŸ¥è¯†","uri":"/posts/electrical-engineering-circuits-basics-1/#3-éš”ç›´é€šäº¤ä¸éš”äº¤é€šç›´"},{"categories":["tech"],"content":" 4. äº¤ç›´æµå åŠ ä¿¡å·äº¤æµä¿¡å·å°±å¾ˆå¥½ï¼Œå¾ˆçœŸå®ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æœ‰äº¤æµç›´æµå åŠ ä¿¡å·ï¼Œåˆ°æœ€åè¿˜è¦æŠŠç›´æµä¿¡å·å»æ‰ï¼Œåªä¿ç•™äº¤æµä¿¡å·ï¼Œå¤šéº»çƒ¦ã€‚è¿™æ˜¯å› ä¸ºï¼Œä»»ä½•å™¨ä»¶å¦‚æœæƒ³æ‰“å¼€æˆ–è€…å¤„äºä¸€å®šçŠ¶æ€ï¼Œå¤šå°‘éƒ½éœ€è¦ä¸€å®šçš„èƒ½é‡é©±åŠ¨çš„ï¼Œå¦‚æœè¿™ä¸ªèƒ½é‡ä¸è¶³ï¼Œè®©å™¨ä»¶å¤„äºä¸ç¨³å®šçš„çŠ¶æ€ï¼Œæˆ‘ä»¬è¿˜åŸä¸äº†çœŸå®çš„ä¿¡å·ï¼Œæ‰€ä»¥ä¸‰æç®¡æ”¾å¤§åŠ ä¸Šé™æ€åç½®ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸ºäº†è®©ä»–å…ˆå·¥ä½œåœ¨ä¸´è¿‘æ”¾å¤§åŒºï¼Œå†æ¥äº¤æµä¿¡å·æ‰èƒ½æ­£ç¡®è¿˜åŸã€‚ æ‰€è°“çš„é™æ€åç½®ï¼Œå®é™…ä¸Šå°±æ˜¯æŒ‚ä¸Šä¸ªç”µé˜»å…ˆç»™è¿™ä¸ªä¸‰æç®¡çš„æŸä¸ªå¼•è„šåŠ ä¸Šç›´æµç”µã€‚å†æ¥çš„äº¤æµä¿¡å·ä¸ç›´æµå åŠ å˜æˆäº¤ç›´æµæ··å ä¿¡å·ï¼Œæ¥é©±åŠ¨ä¸‰æç®¡çš„bæã€‚ çŠ¹å¦‚å¤§åçš„å¼€å£åœ¨5ç±³å¤„ï¼Œä½†æ˜¯äº¤æµä¿¡å·ï¼ˆå˜åŒ–çš„ä¿¡å·ï¼‰åªæœ‰1ç±³çš„æ³¢åŠ¨ï¼Œæ‰€ä»¥å…ˆæŠŠæ°´ä½æŠ¬é«˜åˆ°5ç±³ï¼Œè¿™ä¸ªæ³¢åŠ¨æ‰èƒ½é€è¿‡å»ã€‚ ç°åœ¨ä¿¡å·æ”¾å¤§ç”µè·¯å¤§éƒ¨åˆ†è¢«è¿ç®—æ”¾å¤§å™¨æ›¿ä»£ï¼Œä¸¤ä¸ªè¿æ”¾ä¹‹é—´æœ‰ä¸€ä¸ªéš”ç›´ç”µå®¹ï¼Œè¿™æ˜¯å› ä¸ºè¿æ”¾ä¸éœ€è¦è¿™ç§ç±»ä¼¼ä¸‰æç®¡çš„åç½®ï¼Œå®ƒä¸éœ€è¦æŠ¬é«˜æ°´ä½ï¼Œæœ¬èº«å®ƒå»ºç«‹çš„æ¡ä»¶å°±æ˜¯ä½ æ¥æ³¢åŠ¨æˆ‘å°±èƒ½æ­£å¸¸åé¦ˆåˆ°åçº§ï¼Œä½ è¿™ä¸ªæ—¶å€™å¦‚æœå åŠ äº†ç›´æµä¿¡å·ï¼Œåè€Œå‡ºé—®é¢˜äº†ï¼Œå› ä¸ºä½ æŠŠæ°´ä½æŠ¬é«˜äº†ï¼Œæ¯”è¾ƒä½çš„ä¿¡å·ä¸èƒ½æ­£å¸¸åé¦ˆåˆ°åçº§è¢«è¿™ä¸ªç›´æµä¿¡å·æ©ç›–äº†ã€‚ ","date":"2023-01-31","objectID":"/posts/electrical-engineering-circuits-basics-1/:4:4","series":["EE å…¥é—¨"],"tags":["ç”µå­ç”µè·¯","Electrical Engineering","MCU"],"title":"EE å…¥é—¨ï¼ˆä¸€ï¼‰ - ç”µå­ç”µè·¯åŸºç¡€çŸ¥è¯†","uri":"/posts/electrical-engineering-circuits-basics-1/#4-äº¤ç›´æµå åŠ ä¿¡å·"},{"categories":["tech"],"content":" å››ã€ç”µå­ç”µè·¯å·¥å…·å¥—è£…ä»‹ç»ç©ç¡¬ä»¶çš„è¯ï¼Œå·¥å…·å¥—è£…æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œæœ€å…ˆé‡åˆ°çš„åœºæ™¯å°±æ˜¯â€”â€”å¾ˆå¤šçš„ä¼ æ„Ÿå™¨éƒ½éœ€è¦è‡ªå·±ç„Šæ¥æ’é’ˆã€‚ å¸¸ç”¨å·¥å…·çš„ä¸»è¦æœ‰è¿™äº›ï¼š ä¸‡ç”¨ç”µè¡¨ï¼ˆMultimeterï¼‰ é¢åŒ…æ¿ï¼ˆBreadboardï¼‰ ç”µçƒ™é“ï¼ˆSoldering Ironï¼‰ ç»çº¤æ´æ´æ¿ï¼ˆStripboard / Perfboardï¼‰ å…¶ä»–è¿›é˜¶ç©è€æ—¶å¯èƒ½ä¼šç”¨åˆ°çš„å·¥å…·ï¼š ç¤ºæ³¢å™¨ï¼ˆOscilloscopeï¼‰ å¯è°ƒç›´æµç¨³å‹ç”µæºï¼ˆAdjustable DC Power Supplyï¼‰ é¢‘è°±åˆ†æä»ª ç”µå­å…ƒå™¨ä»¶åˆä¸»è¦åˆ†ç±»ä¸¤ç±»ï¼š æ’å¼å…ƒå™¨ä»¶ ä¼ ç»Ÿç”µå­å…ƒå™¨ä»¶ï¼Œéƒ½å¸¦æœ‰è¾ƒé•¿å¼•è„šï¼ŒPCB ç‰ˆéœ€è¦ä¸ºå¼•è„šé¢„ç•™é€šå­”ã€‚ ç›¸å…³æŠ€æœ¯ï¼šthrough-hole technology è¿™ç§å…ƒä»¶æ¯”è¾ƒå¤§ä¸ªï¼Œéƒ½å¾ˆé€‚åˆæ‰‹å·¥ç„Šæ¥ï¼Œç„Šæ¥å®Œæˆåè¿˜éœ€è¦å‰ªæ‰å¤šä½™å¼•è„šã€‚ ç‰‡å¼å…ƒå™¨ä»¶ SMD (surface-mount device) ä¸€ç§æ–°å‹å…ƒå™¨ä»¶ï¼Œä¹Ÿå«è´´ç‰‡å…ƒä»¶ã€‚ æ¯”æ’å¼å…ƒå™¨ä»¶è¦å°å¾ˆå¤šï¼Œè€Œä¸” PCB æ¿ä¸éœ€è¦é¢„ç•™æ’å­”ï¼Œæ›´èŠ‚çœææ–™è·Ÿç©ºé—´ï¼Œå¹¿æ³›åº”ç”¨åœ¨å„ç§å°å‹åŒ–ç”µå­è®¾å¤‡ä¸­ã€‚ ç›¸å…³æŠ€æœ¯ï¼š(SMT) Surface-mount technology ç›¸å…³è®¾å¤‡ï¼šæ¿€å…‰æ‰“å°é’¢ç½‘ã€è´´ç‰‡æœºï¼ˆå·¨è´µï¼‰ è´´ç‰‡å…ƒä»¶æ‰‹å·¥ç„Šæ¥æ—¶ä¸é€‚åˆç”¨ç”µçƒ™é“ç„Šï¼Œå› ä¸ºå®ƒå¤ªå°äº†ï¼Œè¿™æ ·ç„Šæ¥ä¼šå¾ˆè´¹åŠ²ã€‚ è´´ç‰‡å…ƒä»¶æœ€ç®€å•çš„æ‰‹å·¥ç„Šæ¥æ–¹æ³•æ˜¯ä½¿ç”¨é’ˆç­’ç„Šé”¡è†åœ¨ PCB è§¦ç‚¹ä¸Šæ¶‚å¥½é”¡è†ï¼Œå¯ç”¨ç‰™ç­¾å»æ‰å¤šä½™é”¡è†ï¼Œç„¶åç”¨é•Šå­å°†è´´ç‰‡å…ƒä»¶æ”¾ä¸Šå»ï¼Œæœ€åä½¿ç”¨æ’æ¸©ç„Šå°åŠ çƒ­å®Œæˆç„Šæ¥ã€‚å…ƒä»¶æ”¾æ­ªç‚¹æ²¡å…³ç³»ï¼ŒåŠ çƒ­æ—¶å®ƒä¼šå› ä¸ºæ¶²æ€é”¡çš„è¡¨é¢å¼ åŠ›è‡ªåŠ¨æ­£ä½ã€‚ ","date":"2023-01-31","objectID":"/posts/electrical-engineering-circuits-basics-1/:5:0","series":["EE å…¥é—¨"],"tags":["ç”µå­ç”µè·¯","Electrical Engineering","MCU"],"title":"EE å…¥é—¨ï¼ˆä¸€ï¼‰ - ç”µå­ç”µè·¯åŸºç¡€çŸ¥è¯†","uri":"/posts/electrical-engineering-circuits-basics-1/#å››ç”µå­ç”µè·¯å·¥å…·å¥—è£…ä»‹ç»"},{"categories":["tech"],"content":" 1. ç”µçƒ™é“ç¯‡ç”µçƒ™é“ä¸»è¦è€ƒè™‘çš„æ˜¯å‡æ¸©é€Ÿåº¦è·Ÿæ¸©åº¦ä¿æŒèƒ½åŠ›ï¼Œä¾¿å®œçš„ç”µçƒ™é“åŸºæœ¬éƒ½æœ‰å‡æ¸©æ…¢ã€ç„Šæ¥ä¸­é€”æ˜“å¤±æ¸©ç­‰æ¯›ç—…ã€‚ç›®å‰æ€»ç»“çš„ç”µçƒ™é“ä¿¡æ¯å¦‚ä¸‹ï¼š ä¾¿æºç”µçƒ™é“ï¼šå…¥é—¨çº§åˆ«æ¨è ä¼˜ç¼ºç‚¹: ä¾¿æºã€ä»·æ ¼ä½ã€‚ä½†æ˜¯å‡æ¸©ç›¸å¯¹ç„Šå°è¦æ…¢ä¸€äº›ï¼Œæ¸©æ§ç›¸å¯¹ä¸å¤Ÿç²¾ç¡®ï¼Œè€Œä¸”æ— è‡ªåŠ¨ä¼‘çœ ï¼Œ ç©ºçƒ§çƒ™é“å¤´å®¹æ˜“æ°§åŒ–ï¼Œå†æœ‰å°±æ˜¯å®ƒæ²¡æœ‰æ¥åœ°ä¸é˜²ç»å…¸ï¼Œç„Šæ¥ç²¾å¯†å…ƒä»¶æ¯”è¾ƒå±é™©ã€‚ è²Œä¼¼ä¸»è¦æ¨èå¹¿ä¸œé»„èŠ± 907 ç”µçƒ™é“ï¼Œæ·˜å®å®˜æ–¹åº—ä¹°ä¸ªåˆ€å¤´çš„ 54 å¤§æ´‹ çƒ­é£æªï¼šä¸»è¦ç”¨æ¥æ‹†ç„Šï¼Œä»¥åŠç„Šæ¥è´´ç‰‡å…ƒä»¶ + èŠ¯ç‰‡ã€‚ æˆ‘ä¹°äº†ä¸€æŠŠå¾·åŠ›è¥¿ 2000W çš„æ•°æ˜¾çƒ­é£æªï¼Œä¸è¿‡è²Œä¼¼æ›´å¤šäººæ¨èé‚£ç§äºŒåˆä¸€ç„Šå°ï¼Œç›´æ¥æ§åˆ¶çƒ­é£æªè·Ÿç”µçƒ™é“ä¸¤ä¸ªç©æ„å„¿ã€‚ ç„Šå°ï¼šè¿›é˜¶æ¨èï¼Œä¹Ÿå¯è€ƒè™‘ä¸€æ­¥åˆ°ä½â€¦ ä¼˜ç¼ºç‚¹: å‘çƒ­å¾ˆå¿«ã€çƒ­å®¹ç›¸å¯¹è¾ƒå¤§ï¼Œè‡ªåŠ¨ä¼‘çœ ä¸ä¼šç©ºçƒ§ã€è¿˜æœ‰è¿‡æµä¿æŠ¤ã€å•ç‰‡æœºç¨³å®šæ¸©æ§ã€‚ç¼ºç‚¹æ˜¯è¦è´µä¸€äº›ï¼Œå¦å¤–ç›¸å¯¹æ²¡é‚£ä¹ˆä¾¿æºã€‚ ç›¸å…³æµè¡Œäº§å“ ç™½èœç™½å…‰ T12 æ’æ¸©ç„Šå°ï¼Œæœ€æ—©æ˜¯ç½‘å‹åŸºäºæ—¥æœ¬ç™½å…‰å…¬å¸ T12 çƒ™é“å¤´ï¼ˆæ—¥æœ¬å·¥å‚åˆ°æœŸå¼ºåˆ¶æŠ¥åºŸçš„æ´‹åƒåœ¾ï¼‰é…ä¸Šè‡ªåˆ¶æ’æ¸©æ§åˆ¶ç”µè·¯å®Œæˆçš„ DIY ç„Šå°ï¼Œå› ä¸ºç›¸å¯¹é«˜ç«¯ç„Šå°ç›¸å½“ä¾¿å®œæ‰€ä»¥å† ä»¥ã€Œç™½èœã€ä¹‹åã€‚ æ·˜å®ä¸Šæœ‰ä¸€äº›å–è¿™ä¸ªçš„ï¼Œè´¨é‡è§ä»è§æ™ºå§ï¼Œæˆ‘æ²¡ä¹°è¿‡ã€‚ æ—¥æœ¬ç™½å…‰ HAKKO ç„Šå°ï¼šè¿™ä¸ªå¾ˆå¤šäººæ¨èï¼Œè¯´æ˜¯è´¨é‡å¥½ã€‚ä¸è¿‡è´µï¼Œæ–°æ‰‹ç”¨å¯èƒ½æœ‰ç‚¹å¥¢ä¾ˆäº†ã€‚ äºŒåˆä¸€ç„Šå°ï¼šç„Šå°è‡ªå¸¦çƒ­é£æª + é«˜é¢‘ç”µçƒ™é“ä¸¤ä»¶å¥—ï¼Œé«˜æ‰‹å¿…å¤‡ï¼ˆä¸€èˆ¬æ‹†æœºæ‰ä¼šç”¨åˆ°çƒ­é£æªï¼‰ é«˜é¢‘ç”µçƒ™é“ä½¿ç”¨çš„æ˜¯è·Ÿç”µç£ç‚‰ä¸€æ ·çš„é«˜é¢‘æ¶¡æµå‘çƒ­åŸç†ï¼Œç”µçƒ™é“å¤´è‡ªèº«å‘çƒ­ï¼Œä¸éœ€è¦ä»»ä½•å‘çƒ­èŠ¯ï¼Œ å‘çƒ­å¾ˆå¿«ã€çƒ­å®¹å¤§ã€çƒ™é“å¤´æ›´æ¢ä¾¿å®œã€‚é«˜ç«¯çƒ™é“å¤´éƒ½æ˜¯é«˜é¢‘çš„ã€‚ åæ­£å°±å¾ˆé«˜çº§ä¹Ÿå¾ˆè´µå•¦ã€‚æˆ‘ç°é˜¶æ®µä¹°äº†å®ƒä¹Ÿæ˜¯æµªè´¹é’±ï¼Œæ‰€ä»¥æ²¡äº†è§£å…·ä½“å‹å·å•¥çš„äº† æ’æ¸©åŠ çƒ­å°ï¼šåŠŸèƒ½è·Ÿçƒ­é£æªå·®ä¸å¤šï¼Œä½†æ˜¯ä½“ç§¯å¤§å¾ˆå¤šï¼Œè€Œä¸”æ›´è´µï¼Œæ–°æ‰‹ä¸æ¨èä¹°ã€‚ å…³äºç”µçƒ™é“å¤´ï¼Œè²Œä¼¼åˆ€å¤´æ˜¯æœ€æ¨èçš„ï¼Œå› ä¸ºå®ƒç”¨é€”æœ€å¹¿æ³›ï¼Œçƒ­å®¹å¤§ï¼ŒåŸºæœ¬é€‚ç”¨æ‰€æœ‰åœºæ™¯ã€‚ ç”µçƒ™é“ï¼Œæˆ‘æœ€åä¹°çš„ç¬¬ä¸€æŠŠç”µçƒ™é“æ˜¯ç½‘å‹ DIY çš„ã€ŒL245 ç„Šç¬” ç«ç‘°é‡‘ã€ï¼Œé“åˆé‡‘ CNC åˆ‡å‰²å·¥è‰ºï¼ŒType-C ä¾›ç”µï¼Œæœ€é«˜æ”¯æŒåˆ° PD 120Wï¼Œé¢œå€¼å¾ˆé«˜ï¼Œå£ç¢‘ä¹Ÿå¾ˆå¥½ï¼Œä»·æ ¼æ˜¯ 148 å¤§æ´‹ã€‚ä½¿ç”¨èµ·æ¥è¿˜æ˜¯æ¯”è¾ƒ OK çš„ï¼Œçƒ­å¾—å¾ˆå¿«ï¼Œçƒ­å®¹ä¹Ÿ OKã€‚ä¸è¿‡æ¯•ç«Ÿæ˜¯ DIY çš„ä¾¿å®œç„Šç¬”ï¼Œè´¨é‡ä¸ç¨³ï¼Œæˆ‘æœ‰é‡åˆ°è¿‡å¤šæ¬¡è¯¯ä¼‘çœ ã€æœªè¯†åˆ«åˆ°ç„ŠèŠ¯ã€èŠ¯ç‰‡ç³»ç»Ÿå´©æºƒç­‰é—®é¢˜ï¼Œéƒ½æ˜¯é æ–­ç”µé‡å¯è§£å†³çš„ã€‚ ç”µçƒ™é“çš„ä½¿ç”¨ä¸ä¿å…» å‚è€ƒï¼šhttp://www.cxg.cn/newshow1346.html å‰é¢è®²äº†ï¼Œæˆ‘æ¯•ç«Ÿä¹°çš„æ˜¯ 150 ä¸€æŠŠçš„ç„Šç¬”ï¼ŒC245 è¿™ä¸ªçƒ™é“å¤´ä¹Ÿä¸ä¾¿å®œï¼Œç›´æ¥å½“è€—æéšä¾¿æŠ˜è…¾å°±å¤ªæµªè´¹äº†ã€‚æœ‰å¿…è¦ææ¸…æ¥šæ€ä¹ˆä½¿ç”¨ä¸ä¿å…»ç”µçƒ™é“ï¼š ç„Šæ¥ä½œä¸šå‰ï¼Œå…ˆä¸ºé«˜æ¸©æµ·ç»µåŠ æ°´æ¹¿æ¶¦ï¼Œå†æŒ¤æ‰éƒ¨åˆ†æ°´åˆ†ã€‚ å¦‚æœä½¿ç”¨éæ¹¿æ¶¦çš„æ¸…æ´æµ·ç»µï¼Œä¼šä½¿çƒ™é“å¤´å—æŸæ°§åŒ–ï¼Œå¯¼è‡´ä¸æ²¾é”¡ã€‚ å¦å¤–æˆ‘å‘ç°ã€Œé•€é“œé’¢ä¸çƒã€ç¡®å®æ¯”é«˜æ¸©æµ·ç»µå¥½ç”¨å¤šäº†ï¼Œå¢™è£‚æ¨èï¼ç¬”ä¸å¹²å‡€äº†å¾€é’¢ä¸çƒé‡Œæ’ä¸€æ’ï¼Œç«‹å³å…‰äº®å¦‚æ–°ã€‚ ç„Šæ¥ä½œä¸šä¸­ï¼Œæ¯æ¬¡éƒ½å…ˆåœ¨é«˜æ¸©æµ·ç»µä¸Šæ“¦å¹²å‡€çƒ™é“å¤´ä¸Šçš„æ—§é”¡ï¼Œå†è¿›è¡Œç„Šæ¥ã€‚ å¦‚æœæ˜¯ç”¨ã€Œé•€é“œé’¢ä¸çƒã€ï¼Œé‚£å°±ç›´æ¥åœ¨é’¢ä¸çƒé‡Œæ’ä¸€æ’ï¼Œç«‹å³å…‰æ´å¦‚æ–°ã€‚ ä¸­é€”ä¸ä½¿ç”¨æ—¶ï¼Œå¦‚æœæ— è‡ªåŠ¨ä¼‘çœ åŠŸèƒ½ï¼Œå¯ä»¥æ‰‹åŠ¨å°†æ¸©åº¦è°ƒä½è‡³ 200 åº¦ä»¥ä¸‹ï¼Œé¿å…ç©ºçƒ§ã€‚ç©ºçƒ§ä¼šé™ä½çƒ™é“å¤´å¯¿å‘½ã€‚ ç„Šæ¥å®Œæ¯•åï¼Œå°†æ¸©åº¦è°ƒè‡³çº¦ 250 æ‘„æ°åº¦ï¼Œä½¿ç”¨æ¹¿æ¶¦çš„é«˜æ¸©æµ·ç»µæ¸…æ´çƒ™é“å¤´ï¼Œæœ€åå°†çƒ™é“å¤´åŠ ä¸Šä¸€å±‚æ–°é”¡ä½œä¿æŠ¤ï¼Œè¿™æ ·å¯ä»¥ä¿æŠ¤çƒ™é“å¤´å’Œç©ºæ°”éš”ç¦»ï¼Œçƒ™é“å¤´ä¸ä¼šæ°§åŒ–å˜é»‘ã€‚ çƒ™é“å¤´å·²ç»æ°§åŒ–ã€ä¸æ²¾é”¡æ—¶åº”å¦‚ä½•å¤„ç† å…ˆæŠŠæ¸©åº¦è°ƒåˆ° 300 æ‘„æ°åº¦ï¼Œç”¨æ¸…æ´æµ·ç»µæ¸…ç†çƒ™é“å¤´ï¼Œå¹¶æ£€æŸ¥çƒ™é“å¤´çŠ¶å†µã€‚ å¦‚æœçƒ™é“å¤´çš„é•€é”¡å±‚éƒ¨åˆ†å«æœ‰é»‘è‰²æ°§åŒ–ç‰©æ—¶ï¼Œå¯é•€ä¸Šæ–°é”¡å±‚ï¼Œå†ç”¨æ¸…æ´æµ·ç»µæŠ¹å‡€çƒ™é“å¤´ã€‚å¦‚æ­¤é‡å¤æ¸…ç†ï¼Œç›´åˆ°å½»åº•å»é™¤æ°§åŒ–ç‰©ï¼Œç„¶ååœ¨é•€ä¸Šæ–°é”¡å±‚ã€‚ å°†æ¸©åº¦è°ƒè‡³ 200 æ‘„æ°åº¦å·¦å³è²Œä¼¼æ¯”è¾ƒå®¹æ˜“ä¸Šé”¡ï¼Œä¸æ˜“èšæˆçƒã€‚ å®æµ‹ä¸Šé”¡å†ç”¨æµ·ç»µæŠ¹é™¤ï¼Œæ¯æ¬¡éƒ½èƒ½æ‘¸èµ°ä¸€äº›é»‘è‰²æ°§åŒ–ç‰©ï¼Œéå¸¸æœ‰æ•ˆã€‚ä¸è¿‡è¦æ¸…ç†å¹²å‡€è¿˜æ˜¯éœ€è¦ä¸€äº›è€å¿ƒã€‚ å¦‚æœçƒ™é“å¤´å˜å½¢æˆ–ç©¿å­”ï¼Œå¿…é¡»æ›¿æ¢æ–°å’€ã€‚ å…¶ä»–æ³¨æ„äº‹é¡¹ å‹¿å¤§åŠ›ç„Šæ¥ï¼šåªè¦è®©çƒ™é“å¤´å……åˆ†æ¥è§¦ç„Šç‚¹ï¼Œçƒ­é‡å°±å¯ä¼ é€’ï¼Œæ— éœ€å¤§åŠ›ç„Šæ¥ã€‚ å°½é‡ä½æ¸©ç„Šæ¥ï¼šé«˜æ¸©ç„Šæ¥ä¼šåŠ é€Ÿçƒ™é“å¤´æ°§åŒ–ï¼Œé™ä½çƒ™é“å¤´ä½¿ç”¨å¯¿å‘½ã€‚å¦‚çƒ™é“å¤´æ¸©åº¦è¶…è¿‡470â„ƒï¼Œå®ƒçš„æ°§åŒ–é€Ÿåº¦æ˜¯380â„ƒçš„ä¸¤å€ã€‚ ç»å¸¸ä¿æŒçƒ™é“å¤´ä¸Šé”¡ï¼šè¿™å¯ä»¥å‡ä½çƒ™é“å¤´çš„æ°§åŒ–æœºä¼šï¼Œä½¿çƒ™é“å¤´æ›´è€ç”¨ã€‚ ä¿æŒçƒ™é“å¤´æ¸…æ´ä¸åŠæ—¶æ¸…ç†æ°§åŒ–ç‰© å°å¿ƒæ”¾å…¥çƒ™é“æ¶ï¼šå¦‚æœçƒ™é“å¤´æ¥è§¦åˆ°çƒ™é“æ¶æ— æ³•è‡ªåŠ¨ä¼‘çœ ï¼Œé•¿æ—¶é—´ç©ºçƒ§å°†ä¼šæ¯æ‰çƒ™é“å¤´ã€‚ é€‰ç”¨æ´»æ€§ä½çš„åŠ©ç„Šå‰‚ï¼šæœ€ä¾¿å®œçš„å°±æ˜¯æ¾é¦™ï¼Œæ›´å¥½ä¸€ç‚¹çš„æ˜¯æ— é“…æ— é…¸æ— å¤ç´ åŠ©ç„Šå‰‚ã€‚ ç„Šé”¡ä¸åœ¨ç„Šæ¥è¿‡ç¨‹ä¸­ä¸ºä»€ä¹ˆä¼šçˆ†é”¡ï¼Ÿ https://zhuanlan.zhihu.com/p/584316437 å»ºè®®ç›´æ¥çœ‹ä¸Šé¢çš„æ–‡ç« ï¼Œå¯èƒ½çš„åŸå› å¤§æ¦‚æ˜¯ï¼š å—æ½® ç„Šé”¡ä¸æ··æœ‰æ‚è´¨ï¼Œæˆ–è€…åŠ©ç„Šå‰‚å«é‡è¿‡é«˜ ç„Šæ¥æ“ä½œæ—¶æ‰‹ä¸Šæœ‰æ±—æˆ–æ˜¯æ´—è¿‡æ‰‹åæ‰‹æ²¡æœ‰å®Œå…¨å¹²å°±å¼€å§‹ç„Šæ¥ çƒ™é“æ¸©åº¦è¿‡é«˜ æˆ‘æœ€è¿‘ä¹°çš„ä¸¤å·ç„Šé”¡ä¸å°±æœ‰çˆ†é”¡çš„é—®é¢˜ï¼Œçƒ™é“æ¸©åº¦æ˜¯è®¾çš„å¾ˆå¸¸è§„çš„ 320 åº¦ç”šè‡³æ›´ä½çš„ 290 åº¦ï¼Œç°åœ¨æ€€ç–‘æ˜¯ä¸æ˜¯è¿™ä¸ªæ— é“…ç„Šé”¡ä¸æœ‰é—®é¢˜ã€‚ç½ªé­ç¥¸é¦–æ‰¾åˆ°äº†ï¼Œæ˜¯å› ä¸ºæˆ‘çš„é”¡çº¿æ¶ï¼Œå®ƒä¸‹æ–¹å°±æ˜¯æ¹¿æ¶¦çš„é«˜æ¸©æµ·ç»µâ€¦è¿™æ˜¾ç„¶å¾ˆå®¹æ˜“å—æ½®â€¦ å¦‚ä½•ä½¿ç”¨ç”µçƒ™é“è¿›è¡Œæ‹†ç„Šå½“ä½ ç„Šé”™ç„Šåäº†å…ƒä»¶ï¼Œæˆ–è€…ä½ éœ€è¦ä¿®ä¿®æ”¹æ”¹ç”µè·¯æ¿æ—¶ï¼Œå°±éœ€è¦å…ˆè¿›è¡Œæ‹†ç„Šã€‚ ç”¨ç”µçƒ™é“è¿›è¡Œæ‹†ç„Šéœ€è¦æ³¨æ„è¿™äº›äº‹é¡¹ï¼š æ¸©åº¦å¿…é¡»è¦é«˜ï¼Œèµ·ç  350 ä»¥ä¸Š çƒ™é“å°–å¿…é¡»ç•™ç‚¹é”¡åœ¨ä¸Šé¢ã€‚å¦‚æœçƒ™é“å°–ä¸æŒ‚é”¡ï¼Œç„Šæ¥çš„æ—¶å€™ä¼šå‘ç°å³ä½¿æ¸©åº¦é«˜ï¼Œç”µè·¯æ¿çš„ç„Šé”¡ä¹Ÿå¾ˆéš¾èåŒ– å¦ä¸€ä¸ªæ–¹å¼æ˜¯å…ˆåŠ ç‚¹æœ‰é“…é”¡ä¸é™ä½ç„Šé”¡ç†”ç‚¹ï¼Œç„¶åå†ç”¨å¸é”¡å™¨æˆ–å¸é”¡å¸¦æ¥å¸ å¦‚æœç”¨å¸é”¡å™¨ï¼Œå‘ç°ä¸æ’¤çƒ™é“å¤´ç›´æ¥æŠŠå¸é”¡å™¨æ€¼ä¸Šå»ï¼Œæ•ˆæœæ˜¯æœ€å¥½çš„ å¦‚æœä½¿ç”¨çš„æ˜¯å¸é”¡å¸¦ï¼Œæ¸©åº¦å°±å¿…é¡»æ›´é«˜ï¼Œä¼°è®¡è‡³å°‘å¾— 380 ç”šè‡³æ›´é«˜ å› ä¸ºå¸é”¡å¸¦ä¸€èˆ¬æ˜¯çº¯é“œï¼Œå¯¼çƒ­æ€§èƒ½å¾ˆå¥½ã€‚ä¸€èˆ¬ 320 åº¦å°±å¾ˆå®¹æ˜“ç†”çš„é”¡ï¼Œä¸Šäº†å¸é”¡å¸¦åçƒ­é‡å…¨è¢«å¸é”¡å¸¦ä¼ å¯¼èµ°äº†ï¼Œæ¸©åº¦ä¸é«˜æ ¹æœ¬èåŒ–ä¸äº† æˆ–è€…ç›´æ¥ä¸Šçƒ­é£æª+é•Šå­ä¹Ÿè¡Œï¼ˆæˆ‘è¿˜æ²¡è¯•è¿‡â€¦ï¼‰ã€‚ ","date":"2023-01-31","objectID":"/posts/electrical-engineering-circuits-basics-1/:5:1","series":["EE å…¥é—¨"],"tags":["ç”µå­ç”µè·¯","Electrical Engineering","MCU"],"title":"EE å…¥é—¨ï¼ˆä¸€ï¼‰ - ç”µå­ç”µè·¯åŸºç¡€çŸ¥è¯†","uri":"/posts/electrical-engineering-circuits-basics-1/#1-ç”µçƒ™é“ç¯‡"},{"categories":["tech"],"content":" 1. ç”µçƒ™é“ç¯‡ç”µçƒ™é“ä¸»è¦è€ƒè™‘çš„æ˜¯å‡æ¸©é€Ÿåº¦è·Ÿæ¸©åº¦ä¿æŒèƒ½åŠ›ï¼Œä¾¿å®œçš„ç”µçƒ™é“åŸºæœ¬éƒ½æœ‰å‡æ¸©æ…¢ã€ç„Šæ¥ä¸­é€”æ˜“å¤±æ¸©ç­‰æ¯›ç—…ã€‚ç›®å‰æ€»ç»“çš„ç”µçƒ™é“ä¿¡æ¯å¦‚ä¸‹ï¼š ä¾¿æºç”µçƒ™é“ï¼šå…¥é—¨çº§åˆ«æ¨è ä¼˜ç¼ºç‚¹: ä¾¿æºã€ä»·æ ¼ä½ã€‚ä½†æ˜¯å‡æ¸©ç›¸å¯¹ç„Šå°è¦æ…¢ä¸€äº›ï¼Œæ¸©æ§ç›¸å¯¹ä¸å¤Ÿç²¾ç¡®ï¼Œè€Œä¸”æ— è‡ªåŠ¨ä¼‘çœ ï¼Œ ç©ºçƒ§çƒ™é“å¤´å®¹æ˜“æ°§åŒ–ï¼Œå†æœ‰å°±æ˜¯å®ƒæ²¡æœ‰æ¥åœ°ä¸é˜²ç»å…¸ï¼Œç„Šæ¥ç²¾å¯†å…ƒä»¶æ¯”è¾ƒå±é™©ã€‚ è²Œä¼¼ä¸»è¦æ¨èå¹¿ä¸œé»„èŠ± 907 ç”µçƒ™é“ï¼Œæ·˜å®å®˜æ–¹åº—ä¹°ä¸ªåˆ€å¤´çš„ 54 å¤§æ´‹ çƒ­é£æªï¼šä¸»è¦ç”¨æ¥æ‹†ç„Šï¼Œä»¥åŠç„Šæ¥è´´ç‰‡å…ƒä»¶ + èŠ¯ç‰‡ã€‚ æˆ‘ä¹°äº†ä¸€æŠŠå¾·åŠ›è¥¿ 2000W çš„æ•°æ˜¾çƒ­é£æªï¼Œä¸è¿‡è²Œä¼¼æ›´å¤šäººæ¨èé‚£ç§äºŒåˆä¸€ç„Šå°ï¼Œç›´æ¥æ§åˆ¶çƒ­é£æªè·Ÿç”µçƒ™é“ä¸¤ä¸ªç©æ„å„¿ã€‚ ç„Šå°ï¼šè¿›é˜¶æ¨èï¼Œä¹Ÿå¯è€ƒè™‘ä¸€æ­¥åˆ°ä½â€¦ ä¼˜ç¼ºç‚¹: å‘çƒ­å¾ˆå¿«ã€çƒ­å®¹ç›¸å¯¹è¾ƒå¤§ï¼Œè‡ªåŠ¨ä¼‘çœ ä¸ä¼šç©ºçƒ§ã€è¿˜æœ‰è¿‡æµä¿æŠ¤ã€å•ç‰‡æœºç¨³å®šæ¸©æ§ã€‚ç¼ºç‚¹æ˜¯è¦è´µä¸€äº›ï¼Œå¦å¤–ç›¸å¯¹æ²¡é‚£ä¹ˆä¾¿æºã€‚ ç›¸å…³æµè¡Œäº§å“ ç™½èœç™½å…‰ T12 æ’æ¸©ç„Šå°ï¼Œæœ€æ—©æ˜¯ç½‘å‹åŸºäºæ—¥æœ¬ç™½å…‰å…¬å¸ T12 çƒ™é“å¤´ï¼ˆæ—¥æœ¬å·¥å‚åˆ°æœŸå¼ºåˆ¶æŠ¥åºŸçš„æ´‹åƒåœ¾ï¼‰é…ä¸Šè‡ªåˆ¶æ’æ¸©æ§åˆ¶ç”µè·¯å®Œæˆçš„ DIY ç„Šå°ï¼Œå› ä¸ºç›¸å¯¹é«˜ç«¯ç„Šå°ç›¸å½“ä¾¿å®œæ‰€ä»¥å† ä»¥ã€Œç™½èœã€ä¹‹åã€‚ æ·˜å®ä¸Šæœ‰ä¸€äº›å–è¿™ä¸ªçš„ï¼Œè´¨é‡è§ä»è§æ™ºå§ï¼Œæˆ‘æ²¡ä¹°è¿‡ã€‚ æ—¥æœ¬ç™½å…‰ HAKKO ç„Šå°ï¼šè¿™ä¸ªå¾ˆå¤šäººæ¨èï¼Œè¯´æ˜¯è´¨é‡å¥½ã€‚ä¸è¿‡è´µï¼Œæ–°æ‰‹ç”¨å¯èƒ½æœ‰ç‚¹å¥¢ä¾ˆäº†ã€‚ äºŒåˆä¸€ç„Šå°ï¼šç„Šå°è‡ªå¸¦çƒ­é£æª + é«˜é¢‘ç”µçƒ™é“ä¸¤ä»¶å¥—ï¼Œé«˜æ‰‹å¿…å¤‡ï¼ˆä¸€èˆ¬æ‹†æœºæ‰ä¼šç”¨åˆ°çƒ­é£æªï¼‰ é«˜é¢‘ç”µçƒ™é“ä½¿ç”¨çš„æ˜¯è·Ÿç”µç£ç‚‰ä¸€æ ·çš„é«˜é¢‘æ¶¡æµå‘çƒ­åŸç†ï¼Œç”µçƒ™é“å¤´è‡ªèº«å‘çƒ­ï¼Œä¸éœ€è¦ä»»ä½•å‘çƒ­èŠ¯ï¼Œ å‘çƒ­å¾ˆå¿«ã€çƒ­å®¹å¤§ã€çƒ™é“å¤´æ›´æ¢ä¾¿å®œã€‚é«˜ç«¯çƒ™é“å¤´éƒ½æ˜¯é«˜é¢‘çš„ã€‚ åæ­£å°±å¾ˆé«˜çº§ä¹Ÿå¾ˆè´µå•¦ã€‚æˆ‘ç°é˜¶æ®µä¹°äº†å®ƒä¹Ÿæ˜¯æµªè´¹é’±ï¼Œæ‰€ä»¥æ²¡äº†è§£å…·ä½“å‹å·å•¥çš„äº† æ’æ¸©åŠ çƒ­å°ï¼šåŠŸèƒ½è·Ÿçƒ­é£æªå·®ä¸å¤šï¼Œä½†æ˜¯ä½“ç§¯å¤§å¾ˆå¤šï¼Œè€Œä¸”æ›´è´µï¼Œæ–°æ‰‹ä¸æ¨èä¹°ã€‚ å…³äºç”µçƒ™é“å¤´ï¼Œè²Œä¼¼åˆ€å¤´æ˜¯æœ€æ¨èçš„ï¼Œå› ä¸ºå®ƒç”¨é€”æœ€å¹¿æ³›ï¼Œçƒ­å®¹å¤§ï¼ŒåŸºæœ¬é€‚ç”¨æ‰€æœ‰åœºæ™¯ã€‚ ç”µçƒ™é“ï¼Œæˆ‘æœ€åä¹°çš„ç¬¬ä¸€æŠŠç”µçƒ™é“æ˜¯ç½‘å‹ DIY çš„ã€ŒL245 ç„Šç¬” ç«ç‘°é‡‘ã€ï¼Œé“åˆé‡‘ CNC åˆ‡å‰²å·¥è‰ºï¼ŒType-C ä¾›ç”µï¼Œæœ€é«˜æ”¯æŒåˆ° PD 120Wï¼Œé¢œå€¼å¾ˆé«˜ï¼Œå£ç¢‘ä¹Ÿå¾ˆå¥½ï¼Œä»·æ ¼æ˜¯ 148 å¤§æ´‹ã€‚ä½¿ç”¨èµ·æ¥è¿˜æ˜¯æ¯”è¾ƒ OK çš„ï¼Œçƒ­å¾—å¾ˆå¿«ï¼Œçƒ­å®¹ä¹Ÿ OKã€‚ä¸è¿‡æ¯•ç«Ÿæ˜¯ DIY çš„ä¾¿å®œç„Šç¬”ï¼Œè´¨é‡ä¸ç¨³ï¼Œæˆ‘æœ‰é‡åˆ°è¿‡å¤šæ¬¡è¯¯ä¼‘çœ ã€æœªè¯†åˆ«åˆ°ç„ŠèŠ¯ã€èŠ¯ç‰‡ç³»ç»Ÿå´©æºƒç­‰é—®é¢˜ï¼Œéƒ½æ˜¯é æ–­ç”µé‡å¯è§£å†³çš„ã€‚ ç”µçƒ™é“çš„ä½¿ç”¨ä¸ä¿å…» å‚è€ƒï¼šhttp://www.cxg.cn/newshow1346.html å‰é¢è®²äº†ï¼Œæˆ‘æ¯•ç«Ÿä¹°çš„æ˜¯ 150 ä¸€æŠŠçš„ç„Šç¬”ï¼ŒC245 è¿™ä¸ªçƒ™é“å¤´ä¹Ÿä¸ä¾¿å®œï¼Œç›´æ¥å½“è€—æéšä¾¿æŠ˜è…¾å°±å¤ªæµªè´¹äº†ã€‚æœ‰å¿…è¦ææ¸…æ¥šæ€ä¹ˆä½¿ç”¨ä¸ä¿å…»ç”µçƒ™é“ï¼š ç„Šæ¥ä½œä¸šå‰ï¼Œå…ˆä¸ºé«˜æ¸©æµ·ç»µåŠ æ°´æ¹¿æ¶¦ï¼Œå†æŒ¤æ‰éƒ¨åˆ†æ°´åˆ†ã€‚ å¦‚æœä½¿ç”¨éæ¹¿æ¶¦çš„æ¸…æ´æµ·ç»µï¼Œä¼šä½¿çƒ™é“å¤´å—æŸæ°§åŒ–ï¼Œå¯¼è‡´ä¸æ²¾é”¡ã€‚ å¦å¤–æˆ‘å‘ç°ã€Œé•€é“œé’¢ä¸çƒã€ç¡®å®æ¯”é«˜æ¸©æµ·ç»µå¥½ç”¨å¤šäº†ï¼Œå¢™è£‚æ¨èï¼ç¬”ä¸å¹²å‡€äº†å¾€é’¢ä¸çƒé‡Œæ’ä¸€æ’ï¼Œç«‹å³å…‰äº®å¦‚æ–°ã€‚ ç„Šæ¥ä½œä¸šä¸­ï¼Œæ¯æ¬¡éƒ½å…ˆåœ¨é«˜æ¸©æµ·ç»µä¸Šæ“¦å¹²å‡€çƒ™é“å¤´ä¸Šçš„æ—§é”¡ï¼Œå†è¿›è¡Œç„Šæ¥ã€‚ å¦‚æœæ˜¯ç”¨ã€Œé•€é“œé’¢ä¸çƒã€ï¼Œé‚£å°±ç›´æ¥åœ¨é’¢ä¸çƒé‡Œæ’ä¸€æ’ï¼Œç«‹å³å…‰æ´å¦‚æ–°ã€‚ ä¸­é€”ä¸ä½¿ç”¨æ—¶ï¼Œå¦‚æœæ— è‡ªåŠ¨ä¼‘çœ åŠŸèƒ½ï¼Œå¯ä»¥æ‰‹åŠ¨å°†æ¸©åº¦è°ƒä½è‡³ 200 åº¦ä»¥ä¸‹ï¼Œé¿å…ç©ºçƒ§ã€‚ç©ºçƒ§ä¼šé™ä½çƒ™é“å¤´å¯¿å‘½ã€‚ ç„Šæ¥å®Œæ¯•åï¼Œå°†æ¸©åº¦è°ƒè‡³çº¦ 250 æ‘„æ°åº¦ï¼Œä½¿ç”¨æ¹¿æ¶¦çš„é«˜æ¸©æµ·ç»µæ¸…æ´çƒ™é“å¤´ï¼Œæœ€åå°†çƒ™é“å¤´åŠ ä¸Šä¸€å±‚æ–°é”¡ä½œä¿æŠ¤ï¼Œè¿™æ ·å¯ä»¥ä¿æŠ¤çƒ™é“å¤´å’Œç©ºæ°”éš”ç¦»ï¼Œçƒ™é“å¤´ä¸ä¼šæ°§åŒ–å˜é»‘ã€‚ çƒ™é“å¤´å·²ç»æ°§åŒ–ã€ä¸æ²¾é”¡æ—¶åº”å¦‚ä½•å¤„ç† å…ˆæŠŠæ¸©åº¦è°ƒåˆ° 300 æ‘„æ°åº¦ï¼Œç”¨æ¸…æ´æµ·ç»µæ¸…ç†çƒ™é“å¤´ï¼Œå¹¶æ£€æŸ¥çƒ™é“å¤´çŠ¶å†µã€‚ å¦‚æœçƒ™é“å¤´çš„é•€é”¡å±‚éƒ¨åˆ†å«æœ‰é»‘è‰²æ°§åŒ–ç‰©æ—¶ï¼Œå¯é•€ä¸Šæ–°é”¡å±‚ï¼Œå†ç”¨æ¸…æ´æµ·ç»µæŠ¹å‡€çƒ™é“å¤´ã€‚å¦‚æ­¤é‡å¤æ¸…ç†ï¼Œç›´åˆ°å½»åº•å»é™¤æ°§åŒ–ç‰©ï¼Œç„¶ååœ¨é•€ä¸Šæ–°é”¡å±‚ã€‚ å°†æ¸©åº¦è°ƒè‡³ 200 æ‘„æ°åº¦å·¦å³è²Œä¼¼æ¯”è¾ƒå®¹æ˜“ä¸Šé”¡ï¼Œä¸æ˜“èšæˆçƒã€‚ å®æµ‹ä¸Šé”¡å†ç”¨æµ·ç»µæŠ¹é™¤ï¼Œæ¯æ¬¡éƒ½èƒ½æ‘¸èµ°ä¸€äº›é»‘è‰²æ°§åŒ–ç‰©ï¼Œéå¸¸æœ‰æ•ˆã€‚ä¸è¿‡è¦æ¸…ç†å¹²å‡€è¿˜æ˜¯éœ€è¦ä¸€äº›è€å¿ƒã€‚ å¦‚æœçƒ™é“å¤´å˜å½¢æˆ–ç©¿å­”ï¼Œå¿…é¡»æ›¿æ¢æ–°å’€ã€‚ å…¶ä»–æ³¨æ„äº‹é¡¹ å‹¿å¤§åŠ›ç„Šæ¥ï¼šåªè¦è®©çƒ™é“å¤´å……åˆ†æ¥è§¦ç„Šç‚¹ï¼Œçƒ­é‡å°±å¯ä¼ é€’ï¼Œæ— éœ€å¤§åŠ›ç„Šæ¥ã€‚ å°½é‡ä½æ¸©ç„Šæ¥ï¼šé«˜æ¸©ç„Šæ¥ä¼šåŠ é€Ÿçƒ™é“å¤´æ°§åŒ–ï¼Œé™ä½çƒ™é“å¤´ä½¿ç”¨å¯¿å‘½ã€‚å¦‚çƒ™é“å¤´æ¸©åº¦è¶…è¿‡470â„ƒï¼Œå®ƒçš„æ°§åŒ–é€Ÿåº¦æ˜¯380â„ƒçš„ä¸¤å€ã€‚ ç»å¸¸ä¿æŒçƒ™é“å¤´ä¸Šé”¡ï¼šè¿™å¯ä»¥å‡ä½çƒ™é“å¤´çš„æ°§åŒ–æœºä¼šï¼Œä½¿çƒ™é“å¤´æ›´è€ç”¨ã€‚ ä¿æŒçƒ™é“å¤´æ¸…æ´ä¸åŠæ—¶æ¸…ç†æ°§åŒ–ç‰© å°å¿ƒæ”¾å…¥çƒ™é“æ¶ï¼šå¦‚æœçƒ™é“å¤´æ¥è§¦åˆ°çƒ™é“æ¶æ— æ³•è‡ªåŠ¨ä¼‘çœ ï¼Œé•¿æ—¶é—´ç©ºçƒ§å°†ä¼šæ¯æ‰çƒ™é“å¤´ã€‚ é€‰ç”¨æ´»æ€§ä½çš„åŠ©ç„Šå‰‚ï¼šæœ€ä¾¿å®œçš„å°±æ˜¯æ¾é¦™ï¼Œæ›´å¥½ä¸€ç‚¹çš„æ˜¯æ— é“…æ— é…¸æ— å¤ç´ åŠ©ç„Šå‰‚ã€‚ ç„Šé”¡ä¸åœ¨ç„Šæ¥è¿‡ç¨‹ä¸­ä¸ºä»€ä¹ˆä¼šçˆ†é”¡ï¼Ÿ https://zhuanlan.zhihu.com/p/584316437 å»ºè®®ç›´æ¥çœ‹ä¸Šé¢çš„æ–‡ç« ï¼Œå¯èƒ½çš„åŸå› å¤§æ¦‚æ˜¯ï¼š å—æ½® ç„Šé”¡ä¸æ··æœ‰æ‚è´¨ï¼Œæˆ–è€…åŠ©ç„Šå‰‚å«é‡è¿‡é«˜ ç„Šæ¥æ“ä½œæ—¶æ‰‹ä¸Šæœ‰æ±—æˆ–æ˜¯æ´—è¿‡æ‰‹åæ‰‹æ²¡æœ‰å®Œå…¨å¹²å°±å¼€å§‹ç„Šæ¥ çƒ™é“æ¸©åº¦è¿‡é«˜ æˆ‘æœ€è¿‘ä¹°çš„ä¸¤å·ç„Šé”¡ä¸å°±æœ‰çˆ†é”¡çš„é—®é¢˜ï¼Œçƒ™é“æ¸©åº¦æ˜¯è®¾çš„å¾ˆå¸¸è§„çš„ 320 åº¦ç”šè‡³æ›´ä½çš„ 290 åº¦ï¼Œç°åœ¨æ€€ç–‘æ˜¯ä¸æ˜¯è¿™ä¸ªæ— é“…ç„Šé”¡ä¸æœ‰é—®é¢˜ã€‚ç½ªé­ç¥¸é¦–æ‰¾åˆ°äº†ï¼Œæ˜¯å› ä¸ºæˆ‘çš„é”¡çº¿æ¶ï¼Œå®ƒä¸‹æ–¹å°±æ˜¯æ¹¿æ¶¦çš„é«˜æ¸©æµ·ç»µâ€¦è¿™æ˜¾ç„¶å¾ˆå®¹æ˜“å—æ½®â€¦ å¦‚ä½•ä½¿ç”¨ç”µçƒ™é“è¿›è¡Œæ‹†ç„Šå½“ä½ ç„Šé”™ç„Šåäº†å…ƒä»¶ï¼Œæˆ–è€…ä½ éœ€è¦ä¿®ä¿®æ”¹æ”¹ç”µè·¯æ¿æ—¶ï¼Œå°±éœ€è¦å…ˆè¿›è¡Œæ‹†ç„Šã€‚ ç”¨ç”µçƒ™é“è¿›è¡Œæ‹†ç„Šéœ€è¦æ³¨æ„è¿™äº›äº‹é¡¹ï¼š æ¸©åº¦å¿…é¡»è¦é«˜ï¼Œèµ·ç  350 ä»¥ä¸Š çƒ™é“å°–å¿…é¡»ç•™ç‚¹é”¡åœ¨ä¸Šé¢ã€‚å¦‚æœçƒ™é“å°–ä¸æŒ‚é”¡ï¼Œç„Šæ¥çš„æ—¶å€™ä¼šå‘ç°å³ä½¿æ¸©åº¦é«˜ï¼Œç”µè·¯æ¿çš„ç„Šé”¡ä¹Ÿå¾ˆéš¾èåŒ– å¦ä¸€ä¸ªæ–¹å¼æ˜¯å…ˆåŠ ç‚¹æœ‰é“…é”¡ä¸é™ä½ç„Šé”¡ç†”ç‚¹ï¼Œç„¶åå†ç”¨å¸é”¡å™¨æˆ–å¸é”¡å¸¦æ¥å¸ å¦‚æœç”¨å¸é”¡å™¨ï¼Œå‘ç°ä¸æ’¤çƒ™é“å¤´ç›´æ¥æŠŠå¸é”¡å™¨æ€¼ä¸Šå»ï¼Œæ•ˆæœæ˜¯æœ€å¥½çš„ å¦‚æœä½¿ç”¨çš„æ˜¯å¸é”¡å¸¦ï¼Œæ¸©åº¦å°±å¿…é¡»æ›´é«˜ï¼Œä¼°è®¡è‡³å°‘å¾— 380 ç”šè‡³æ›´é«˜ å› ä¸ºå¸é”¡å¸¦ä¸€èˆ¬æ˜¯çº¯é“œï¼Œå¯¼çƒ­æ€§èƒ½å¾ˆå¥½ã€‚ä¸€èˆ¬ 320 åº¦å°±å¾ˆå®¹æ˜“ç†”çš„é”¡ï¼Œä¸Šäº†å¸é”¡å¸¦åçƒ­é‡å…¨è¢«å¸é”¡å¸¦ä¼ å¯¼èµ°äº†ï¼Œæ¸©åº¦ä¸é«˜æ ¹æœ¬èåŒ–ä¸äº† æˆ–è€…ç›´æ¥ä¸Šçƒ­é£æª+é•Šå­ä¹Ÿè¡Œï¼ˆæˆ‘è¿˜æ²¡è¯•è¿‡â€¦ï¼‰ã€‚ ","date":"2023-01-31","objectID":"/posts/electrical-engineering-circuits-basics-1/:5:1","series":["EE å…¥é—¨"],"tags":["ç”µå­ç”µè·¯","Electrical Engineering","MCU"],"title":"EE å…¥é—¨ï¼ˆä¸€ï¼‰ - ç”µå­ç”µè·¯åŸºç¡€çŸ¥è¯†","uri":"/posts/electrical-engineering-circuits-basics-1/#ç”µçƒ™é“çš„ä½¿ç”¨ä¸ä¿å…»"},{"categories":["tech"],"content":" 1. ç”µçƒ™é“ç¯‡ç”µçƒ™é“ä¸»è¦è€ƒè™‘çš„æ˜¯å‡æ¸©é€Ÿåº¦è·Ÿæ¸©åº¦ä¿æŒèƒ½åŠ›ï¼Œä¾¿å®œçš„ç”µçƒ™é“åŸºæœ¬éƒ½æœ‰å‡æ¸©æ…¢ã€ç„Šæ¥ä¸­é€”æ˜“å¤±æ¸©ç­‰æ¯›ç—…ã€‚ç›®å‰æ€»ç»“çš„ç”µçƒ™é“ä¿¡æ¯å¦‚ä¸‹ï¼š ä¾¿æºç”µçƒ™é“ï¼šå…¥é—¨çº§åˆ«æ¨è ä¼˜ç¼ºç‚¹: ä¾¿æºã€ä»·æ ¼ä½ã€‚ä½†æ˜¯å‡æ¸©ç›¸å¯¹ç„Šå°è¦æ…¢ä¸€äº›ï¼Œæ¸©æ§ç›¸å¯¹ä¸å¤Ÿç²¾ç¡®ï¼Œè€Œä¸”æ— è‡ªåŠ¨ä¼‘çœ ï¼Œ ç©ºçƒ§çƒ™é“å¤´å®¹æ˜“æ°§åŒ–ï¼Œå†æœ‰å°±æ˜¯å®ƒæ²¡æœ‰æ¥åœ°ä¸é˜²ç»å…¸ï¼Œç„Šæ¥ç²¾å¯†å…ƒä»¶æ¯”è¾ƒå±é™©ã€‚ è²Œä¼¼ä¸»è¦æ¨èå¹¿ä¸œé»„èŠ± 907 ç”µçƒ™é“ï¼Œæ·˜å®å®˜æ–¹åº—ä¹°ä¸ªåˆ€å¤´çš„ 54 å¤§æ´‹ çƒ­é£æªï¼šä¸»è¦ç”¨æ¥æ‹†ç„Šï¼Œä»¥åŠç„Šæ¥è´´ç‰‡å…ƒä»¶ + èŠ¯ç‰‡ã€‚ æˆ‘ä¹°äº†ä¸€æŠŠå¾·åŠ›è¥¿ 2000W çš„æ•°æ˜¾çƒ­é£æªï¼Œä¸è¿‡è²Œä¼¼æ›´å¤šäººæ¨èé‚£ç§äºŒåˆä¸€ç„Šå°ï¼Œç›´æ¥æ§åˆ¶çƒ­é£æªè·Ÿç”µçƒ™é“ä¸¤ä¸ªç©æ„å„¿ã€‚ ç„Šå°ï¼šè¿›é˜¶æ¨èï¼Œä¹Ÿå¯è€ƒè™‘ä¸€æ­¥åˆ°ä½â€¦ ä¼˜ç¼ºç‚¹: å‘çƒ­å¾ˆå¿«ã€çƒ­å®¹ç›¸å¯¹è¾ƒå¤§ï¼Œè‡ªåŠ¨ä¼‘çœ ä¸ä¼šç©ºçƒ§ã€è¿˜æœ‰è¿‡æµä¿æŠ¤ã€å•ç‰‡æœºç¨³å®šæ¸©æ§ã€‚ç¼ºç‚¹æ˜¯è¦è´µä¸€äº›ï¼Œå¦å¤–ç›¸å¯¹æ²¡é‚£ä¹ˆä¾¿æºã€‚ ç›¸å…³æµè¡Œäº§å“ ç™½èœç™½å…‰ T12 æ’æ¸©ç„Šå°ï¼Œæœ€æ—©æ˜¯ç½‘å‹åŸºäºæ—¥æœ¬ç™½å…‰å…¬å¸ T12 çƒ™é“å¤´ï¼ˆæ—¥æœ¬å·¥å‚åˆ°æœŸå¼ºåˆ¶æŠ¥åºŸçš„æ´‹åƒåœ¾ï¼‰é…ä¸Šè‡ªåˆ¶æ’æ¸©æ§åˆ¶ç”µè·¯å®Œæˆçš„ DIY ç„Šå°ï¼Œå› ä¸ºç›¸å¯¹é«˜ç«¯ç„Šå°ç›¸å½“ä¾¿å®œæ‰€ä»¥å† ä»¥ã€Œç™½èœã€ä¹‹åã€‚ æ·˜å®ä¸Šæœ‰ä¸€äº›å–è¿™ä¸ªçš„ï¼Œè´¨é‡è§ä»è§æ™ºå§ï¼Œæˆ‘æ²¡ä¹°è¿‡ã€‚ æ—¥æœ¬ç™½å…‰ HAKKO ç„Šå°ï¼šè¿™ä¸ªå¾ˆå¤šäººæ¨èï¼Œè¯´æ˜¯è´¨é‡å¥½ã€‚ä¸è¿‡è´µï¼Œæ–°æ‰‹ç”¨å¯èƒ½æœ‰ç‚¹å¥¢ä¾ˆäº†ã€‚ äºŒåˆä¸€ç„Šå°ï¼šç„Šå°è‡ªå¸¦çƒ­é£æª + é«˜é¢‘ç”µçƒ™é“ä¸¤ä»¶å¥—ï¼Œé«˜æ‰‹å¿…å¤‡ï¼ˆä¸€èˆ¬æ‹†æœºæ‰ä¼šç”¨åˆ°çƒ­é£æªï¼‰ é«˜é¢‘ç”µçƒ™é“ä½¿ç”¨çš„æ˜¯è·Ÿç”µç£ç‚‰ä¸€æ ·çš„é«˜é¢‘æ¶¡æµå‘çƒ­åŸç†ï¼Œç”µçƒ™é“å¤´è‡ªèº«å‘çƒ­ï¼Œä¸éœ€è¦ä»»ä½•å‘çƒ­èŠ¯ï¼Œ å‘çƒ­å¾ˆå¿«ã€çƒ­å®¹å¤§ã€çƒ™é“å¤´æ›´æ¢ä¾¿å®œã€‚é«˜ç«¯çƒ™é“å¤´éƒ½æ˜¯é«˜é¢‘çš„ã€‚ åæ­£å°±å¾ˆé«˜çº§ä¹Ÿå¾ˆè´µå•¦ã€‚æˆ‘ç°é˜¶æ®µä¹°äº†å®ƒä¹Ÿæ˜¯æµªè´¹é’±ï¼Œæ‰€ä»¥æ²¡äº†è§£å…·ä½“å‹å·å•¥çš„äº† æ’æ¸©åŠ çƒ­å°ï¼šåŠŸèƒ½è·Ÿçƒ­é£æªå·®ä¸å¤šï¼Œä½†æ˜¯ä½“ç§¯å¤§å¾ˆå¤šï¼Œè€Œä¸”æ›´è´µï¼Œæ–°æ‰‹ä¸æ¨èä¹°ã€‚ å…³äºç”µçƒ™é“å¤´ï¼Œè²Œä¼¼åˆ€å¤´æ˜¯æœ€æ¨èçš„ï¼Œå› ä¸ºå®ƒç”¨é€”æœ€å¹¿æ³›ï¼Œçƒ­å®¹å¤§ï¼ŒåŸºæœ¬é€‚ç”¨æ‰€æœ‰åœºæ™¯ã€‚ ç”µçƒ™é“ï¼Œæˆ‘æœ€åä¹°çš„ç¬¬ä¸€æŠŠç”µçƒ™é“æ˜¯ç½‘å‹ DIY çš„ã€ŒL245 ç„Šç¬” ç«ç‘°é‡‘ã€ï¼Œé“åˆé‡‘ CNC åˆ‡å‰²å·¥è‰ºï¼ŒType-C ä¾›ç”µï¼Œæœ€é«˜æ”¯æŒåˆ° PD 120Wï¼Œé¢œå€¼å¾ˆé«˜ï¼Œå£ç¢‘ä¹Ÿå¾ˆå¥½ï¼Œä»·æ ¼æ˜¯ 148 å¤§æ´‹ã€‚ä½¿ç”¨èµ·æ¥è¿˜æ˜¯æ¯”è¾ƒ OK çš„ï¼Œçƒ­å¾—å¾ˆå¿«ï¼Œçƒ­å®¹ä¹Ÿ OKã€‚ä¸è¿‡æ¯•ç«Ÿæ˜¯ DIY çš„ä¾¿å®œç„Šç¬”ï¼Œè´¨é‡ä¸ç¨³ï¼Œæˆ‘æœ‰é‡åˆ°è¿‡å¤šæ¬¡è¯¯ä¼‘çœ ã€æœªè¯†åˆ«åˆ°ç„ŠèŠ¯ã€èŠ¯ç‰‡ç³»ç»Ÿå´©æºƒç­‰é—®é¢˜ï¼Œéƒ½æ˜¯é æ–­ç”µé‡å¯è§£å†³çš„ã€‚ ç”µçƒ™é“çš„ä½¿ç”¨ä¸ä¿å…» å‚è€ƒï¼šhttp://www.cxg.cn/newshow1346.html å‰é¢è®²äº†ï¼Œæˆ‘æ¯•ç«Ÿä¹°çš„æ˜¯ 150 ä¸€æŠŠçš„ç„Šç¬”ï¼ŒC245 è¿™ä¸ªçƒ™é“å¤´ä¹Ÿä¸ä¾¿å®œï¼Œç›´æ¥å½“è€—æéšä¾¿æŠ˜è…¾å°±å¤ªæµªè´¹äº†ã€‚æœ‰å¿…è¦ææ¸…æ¥šæ€ä¹ˆä½¿ç”¨ä¸ä¿å…»ç”µçƒ™é“ï¼š ç„Šæ¥ä½œä¸šå‰ï¼Œå…ˆä¸ºé«˜æ¸©æµ·ç»µåŠ æ°´æ¹¿æ¶¦ï¼Œå†æŒ¤æ‰éƒ¨åˆ†æ°´åˆ†ã€‚ å¦‚æœä½¿ç”¨éæ¹¿æ¶¦çš„æ¸…æ´æµ·ç»µï¼Œä¼šä½¿çƒ™é“å¤´å—æŸæ°§åŒ–ï¼Œå¯¼è‡´ä¸æ²¾é”¡ã€‚ å¦å¤–æˆ‘å‘ç°ã€Œé•€é“œé’¢ä¸çƒã€ç¡®å®æ¯”é«˜æ¸©æµ·ç»µå¥½ç”¨å¤šäº†ï¼Œå¢™è£‚æ¨èï¼ç¬”ä¸å¹²å‡€äº†å¾€é’¢ä¸çƒé‡Œæ’ä¸€æ’ï¼Œç«‹å³å…‰äº®å¦‚æ–°ã€‚ ç„Šæ¥ä½œä¸šä¸­ï¼Œæ¯æ¬¡éƒ½å…ˆåœ¨é«˜æ¸©æµ·ç»µä¸Šæ“¦å¹²å‡€çƒ™é“å¤´ä¸Šçš„æ—§é”¡ï¼Œå†è¿›è¡Œç„Šæ¥ã€‚ å¦‚æœæ˜¯ç”¨ã€Œé•€é“œé’¢ä¸çƒã€ï¼Œé‚£å°±ç›´æ¥åœ¨é’¢ä¸çƒé‡Œæ’ä¸€æ’ï¼Œç«‹å³å…‰æ´å¦‚æ–°ã€‚ ä¸­é€”ä¸ä½¿ç”¨æ—¶ï¼Œå¦‚æœæ— è‡ªåŠ¨ä¼‘çœ åŠŸèƒ½ï¼Œå¯ä»¥æ‰‹åŠ¨å°†æ¸©åº¦è°ƒä½è‡³ 200 åº¦ä»¥ä¸‹ï¼Œé¿å…ç©ºçƒ§ã€‚ç©ºçƒ§ä¼šé™ä½çƒ™é“å¤´å¯¿å‘½ã€‚ ç„Šæ¥å®Œæ¯•åï¼Œå°†æ¸©åº¦è°ƒè‡³çº¦ 250 æ‘„æ°åº¦ï¼Œä½¿ç”¨æ¹¿æ¶¦çš„é«˜æ¸©æµ·ç»µæ¸…æ´çƒ™é“å¤´ï¼Œæœ€åå°†çƒ™é“å¤´åŠ ä¸Šä¸€å±‚æ–°é”¡ä½œä¿æŠ¤ï¼Œè¿™æ ·å¯ä»¥ä¿æŠ¤çƒ™é“å¤´å’Œç©ºæ°”éš”ç¦»ï¼Œçƒ™é“å¤´ä¸ä¼šæ°§åŒ–å˜é»‘ã€‚ çƒ™é“å¤´å·²ç»æ°§åŒ–ã€ä¸æ²¾é”¡æ—¶åº”å¦‚ä½•å¤„ç† å…ˆæŠŠæ¸©åº¦è°ƒåˆ° 300 æ‘„æ°åº¦ï¼Œç”¨æ¸…æ´æµ·ç»µæ¸…ç†çƒ™é“å¤´ï¼Œå¹¶æ£€æŸ¥çƒ™é“å¤´çŠ¶å†µã€‚ å¦‚æœçƒ™é“å¤´çš„é•€é”¡å±‚éƒ¨åˆ†å«æœ‰é»‘è‰²æ°§åŒ–ç‰©æ—¶ï¼Œå¯é•€ä¸Šæ–°é”¡å±‚ï¼Œå†ç”¨æ¸…æ´æµ·ç»µæŠ¹å‡€çƒ™é“å¤´ã€‚å¦‚æ­¤é‡å¤æ¸…ç†ï¼Œç›´åˆ°å½»åº•å»é™¤æ°§åŒ–ç‰©ï¼Œç„¶ååœ¨é•€ä¸Šæ–°é”¡å±‚ã€‚ å°†æ¸©åº¦è°ƒè‡³ 200 æ‘„æ°åº¦å·¦å³è²Œä¼¼æ¯”è¾ƒå®¹æ˜“ä¸Šé”¡ï¼Œä¸æ˜“èšæˆçƒã€‚ å®æµ‹ä¸Šé”¡å†ç”¨æµ·ç»µæŠ¹é™¤ï¼Œæ¯æ¬¡éƒ½èƒ½æ‘¸èµ°ä¸€äº›é»‘è‰²æ°§åŒ–ç‰©ï¼Œéå¸¸æœ‰æ•ˆã€‚ä¸è¿‡è¦æ¸…ç†å¹²å‡€è¿˜æ˜¯éœ€è¦ä¸€äº›è€å¿ƒã€‚ å¦‚æœçƒ™é“å¤´å˜å½¢æˆ–ç©¿å­”ï¼Œå¿…é¡»æ›¿æ¢æ–°å’€ã€‚ å…¶ä»–æ³¨æ„äº‹é¡¹ å‹¿å¤§åŠ›ç„Šæ¥ï¼šåªè¦è®©çƒ™é“å¤´å……åˆ†æ¥è§¦ç„Šç‚¹ï¼Œçƒ­é‡å°±å¯ä¼ é€’ï¼Œæ— éœ€å¤§åŠ›ç„Šæ¥ã€‚ å°½é‡ä½æ¸©ç„Šæ¥ï¼šé«˜æ¸©ç„Šæ¥ä¼šåŠ é€Ÿçƒ™é“å¤´æ°§åŒ–ï¼Œé™ä½çƒ™é“å¤´ä½¿ç”¨å¯¿å‘½ã€‚å¦‚çƒ™é“å¤´æ¸©åº¦è¶…è¿‡470â„ƒï¼Œå®ƒçš„æ°§åŒ–é€Ÿåº¦æ˜¯380â„ƒçš„ä¸¤å€ã€‚ ç»å¸¸ä¿æŒçƒ™é“å¤´ä¸Šé”¡ï¼šè¿™å¯ä»¥å‡ä½çƒ™é“å¤´çš„æ°§åŒ–æœºä¼šï¼Œä½¿çƒ™é“å¤´æ›´è€ç”¨ã€‚ ä¿æŒçƒ™é“å¤´æ¸…æ´ä¸åŠæ—¶æ¸…ç†æ°§åŒ–ç‰© å°å¿ƒæ”¾å…¥çƒ™é“æ¶ï¼šå¦‚æœçƒ™é“å¤´æ¥è§¦åˆ°çƒ™é“æ¶æ— æ³•è‡ªåŠ¨ä¼‘çœ ï¼Œé•¿æ—¶é—´ç©ºçƒ§å°†ä¼šæ¯æ‰çƒ™é“å¤´ã€‚ é€‰ç”¨æ´»æ€§ä½çš„åŠ©ç„Šå‰‚ï¼šæœ€ä¾¿å®œçš„å°±æ˜¯æ¾é¦™ï¼Œæ›´å¥½ä¸€ç‚¹çš„æ˜¯æ— é“…æ— é…¸æ— å¤ç´ åŠ©ç„Šå‰‚ã€‚ ç„Šé”¡ä¸åœ¨ç„Šæ¥è¿‡ç¨‹ä¸­ä¸ºä»€ä¹ˆä¼šçˆ†é”¡ï¼Ÿ https://zhuanlan.zhihu.com/p/584316437 å»ºè®®ç›´æ¥çœ‹ä¸Šé¢çš„æ–‡ç« ï¼Œå¯èƒ½çš„åŸå› å¤§æ¦‚æ˜¯ï¼š å—æ½® ç„Šé”¡ä¸æ··æœ‰æ‚è´¨ï¼Œæˆ–è€…åŠ©ç„Šå‰‚å«é‡è¿‡é«˜ ç„Šæ¥æ“ä½œæ—¶æ‰‹ä¸Šæœ‰æ±—æˆ–æ˜¯æ´—è¿‡æ‰‹åæ‰‹æ²¡æœ‰å®Œå…¨å¹²å°±å¼€å§‹ç„Šæ¥ çƒ™é“æ¸©åº¦è¿‡é«˜ æˆ‘æœ€è¿‘ä¹°çš„ä¸¤å·ç„Šé”¡ä¸å°±æœ‰çˆ†é”¡çš„é—®é¢˜ï¼Œçƒ™é“æ¸©åº¦æ˜¯è®¾çš„å¾ˆå¸¸è§„çš„ 320 åº¦ç”šè‡³æ›´ä½çš„ 290 åº¦ï¼Œç°åœ¨æ€€ç–‘æ˜¯ä¸æ˜¯è¿™ä¸ªæ— é“…ç„Šé”¡ä¸æœ‰é—®é¢˜ã€‚ç½ªé­ç¥¸é¦–æ‰¾åˆ°äº†ï¼Œæ˜¯å› ä¸ºæˆ‘çš„é”¡çº¿æ¶ï¼Œå®ƒä¸‹æ–¹å°±æ˜¯æ¹¿æ¶¦çš„é«˜æ¸©æµ·ç»µâ€¦è¿™æ˜¾ç„¶å¾ˆå®¹æ˜“å—æ½®â€¦ å¦‚ä½•ä½¿ç”¨ç”µçƒ™é“è¿›è¡Œæ‹†ç„Šå½“ä½ ç„Šé”™ç„Šåäº†å…ƒä»¶ï¼Œæˆ–è€…ä½ éœ€è¦ä¿®ä¿®æ”¹æ”¹ç”µè·¯æ¿æ—¶ï¼Œå°±éœ€è¦å…ˆè¿›è¡Œæ‹†ç„Šã€‚ ç”¨ç”µçƒ™é“è¿›è¡Œæ‹†ç„Šéœ€è¦æ³¨æ„è¿™äº›äº‹é¡¹ï¼š æ¸©åº¦å¿…é¡»è¦é«˜ï¼Œèµ·ç  350 ä»¥ä¸Š çƒ™é“å°–å¿…é¡»ç•™ç‚¹é”¡åœ¨ä¸Šé¢ã€‚å¦‚æœçƒ™é“å°–ä¸æŒ‚é”¡ï¼Œç„Šæ¥çš„æ—¶å€™ä¼šå‘ç°å³ä½¿æ¸©åº¦é«˜ï¼Œç”µè·¯æ¿çš„ç„Šé”¡ä¹Ÿå¾ˆéš¾èåŒ– å¦ä¸€ä¸ªæ–¹å¼æ˜¯å…ˆåŠ ç‚¹æœ‰é“…é”¡ä¸é™ä½ç„Šé”¡ç†”ç‚¹ï¼Œç„¶åå†ç”¨å¸é”¡å™¨æˆ–å¸é”¡å¸¦æ¥å¸ å¦‚æœç”¨å¸é”¡å™¨ï¼Œå‘ç°ä¸æ’¤çƒ™é“å¤´ç›´æ¥æŠŠå¸é”¡å™¨æ€¼ä¸Šå»ï¼Œæ•ˆæœæ˜¯æœ€å¥½çš„ å¦‚æœä½¿ç”¨çš„æ˜¯å¸é”¡å¸¦ï¼Œæ¸©åº¦å°±å¿…é¡»æ›´é«˜ï¼Œä¼°è®¡è‡³å°‘å¾— 380 ç”šè‡³æ›´é«˜ å› ä¸ºå¸é”¡å¸¦ä¸€èˆ¬æ˜¯çº¯é“œï¼Œå¯¼çƒ­æ€§èƒ½å¾ˆå¥½ã€‚ä¸€èˆ¬ 320 åº¦å°±å¾ˆå®¹æ˜“ç†”çš„é”¡ï¼Œä¸Šäº†å¸é”¡å¸¦åçƒ­é‡å…¨è¢«å¸é”¡å¸¦ä¼ å¯¼èµ°äº†ï¼Œæ¸©åº¦ä¸é«˜æ ¹æœ¬èåŒ–ä¸äº† æˆ–è€…ç›´æ¥ä¸Šçƒ­é£æª+é•Šå­ä¹Ÿè¡Œï¼ˆæˆ‘è¿˜æ²¡è¯•è¿‡â€¦ï¼‰ã€‚ ","date":"2023-01-31","objectID":"/posts/electrical-engineering-circuits-basics-1/:5:1","series":["EE å…¥é—¨"],"tags":["ç”µå­ç”µè·¯","Electrical Engineering","MCU"],"title":"EE å…¥é—¨ï¼ˆä¸€ï¼‰ - ç”µå­ç”µè·¯åŸºç¡€çŸ¥è¯†","uri":"/posts/electrical-engineering-circuits-basics-1/#ç„Šé”¡ä¸åœ¨ç„Šæ¥è¿‡ç¨‹ä¸­ä¸ºä»€ä¹ˆä¼šçˆ†é”¡"},{"categories":["tech"],"content":" 1. ç”µçƒ™é“ç¯‡ç”µçƒ™é“ä¸»è¦è€ƒè™‘çš„æ˜¯å‡æ¸©é€Ÿåº¦è·Ÿæ¸©åº¦ä¿æŒèƒ½åŠ›ï¼Œä¾¿å®œçš„ç”µçƒ™é“åŸºæœ¬éƒ½æœ‰å‡æ¸©æ…¢ã€ç„Šæ¥ä¸­é€”æ˜“å¤±æ¸©ç­‰æ¯›ç—…ã€‚ç›®å‰æ€»ç»“çš„ç”µçƒ™é“ä¿¡æ¯å¦‚ä¸‹ï¼š ä¾¿æºç”µçƒ™é“ï¼šå…¥é—¨çº§åˆ«æ¨è ä¼˜ç¼ºç‚¹: ä¾¿æºã€ä»·æ ¼ä½ã€‚ä½†æ˜¯å‡æ¸©ç›¸å¯¹ç„Šå°è¦æ…¢ä¸€äº›ï¼Œæ¸©æ§ç›¸å¯¹ä¸å¤Ÿç²¾ç¡®ï¼Œè€Œä¸”æ— è‡ªåŠ¨ä¼‘çœ ï¼Œ ç©ºçƒ§çƒ™é“å¤´å®¹æ˜“æ°§åŒ–ï¼Œå†æœ‰å°±æ˜¯å®ƒæ²¡æœ‰æ¥åœ°ä¸é˜²ç»å…¸ï¼Œç„Šæ¥ç²¾å¯†å…ƒä»¶æ¯”è¾ƒå±é™©ã€‚ è²Œä¼¼ä¸»è¦æ¨èå¹¿ä¸œé»„èŠ± 907 ç”µçƒ™é“ï¼Œæ·˜å®å®˜æ–¹åº—ä¹°ä¸ªåˆ€å¤´çš„ 54 å¤§æ´‹ çƒ­é£æªï¼šä¸»è¦ç”¨æ¥æ‹†ç„Šï¼Œä»¥åŠç„Šæ¥è´´ç‰‡å…ƒä»¶ + èŠ¯ç‰‡ã€‚ æˆ‘ä¹°äº†ä¸€æŠŠå¾·åŠ›è¥¿ 2000W çš„æ•°æ˜¾çƒ­é£æªï¼Œä¸è¿‡è²Œä¼¼æ›´å¤šäººæ¨èé‚£ç§äºŒåˆä¸€ç„Šå°ï¼Œç›´æ¥æ§åˆ¶çƒ­é£æªè·Ÿç”µçƒ™é“ä¸¤ä¸ªç©æ„å„¿ã€‚ ç„Šå°ï¼šè¿›é˜¶æ¨èï¼Œä¹Ÿå¯è€ƒè™‘ä¸€æ­¥åˆ°ä½â€¦ ä¼˜ç¼ºç‚¹: å‘çƒ­å¾ˆå¿«ã€çƒ­å®¹ç›¸å¯¹è¾ƒå¤§ï¼Œè‡ªåŠ¨ä¼‘çœ ä¸ä¼šç©ºçƒ§ã€è¿˜æœ‰è¿‡æµä¿æŠ¤ã€å•ç‰‡æœºç¨³å®šæ¸©æ§ã€‚ç¼ºç‚¹æ˜¯è¦è´µä¸€äº›ï¼Œå¦å¤–ç›¸å¯¹æ²¡é‚£ä¹ˆä¾¿æºã€‚ ç›¸å…³æµè¡Œäº§å“ ç™½èœç™½å…‰ T12 æ’æ¸©ç„Šå°ï¼Œæœ€æ—©æ˜¯ç½‘å‹åŸºäºæ—¥æœ¬ç™½å…‰å…¬å¸ T12 çƒ™é“å¤´ï¼ˆæ—¥æœ¬å·¥å‚åˆ°æœŸå¼ºåˆ¶æŠ¥åºŸçš„æ´‹åƒåœ¾ï¼‰é…ä¸Šè‡ªåˆ¶æ’æ¸©æ§åˆ¶ç”µè·¯å®Œæˆçš„ DIY ç„Šå°ï¼Œå› ä¸ºç›¸å¯¹é«˜ç«¯ç„Šå°ç›¸å½“ä¾¿å®œæ‰€ä»¥å† ä»¥ã€Œç™½èœã€ä¹‹åã€‚ æ·˜å®ä¸Šæœ‰ä¸€äº›å–è¿™ä¸ªçš„ï¼Œè´¨é‡è§ä»è§æ™ºå§ï¼Œæˆ‘æ²¡ä¹°è¿‡ã€‚ æ—¥æœ¬ç™½å…‰ HAKKO ç„Šå°ï¼šè¿™ä¸ªå¾ˆå¤šäººæ¨èï¼Œè¯´æ˜¯è´¨é‡å¥½ã€‚ä¸è¿‡è´µï¼Œæ–°æ‰‹ç”¨å¯èƒ½æœ‰ç‚¹å¥¢ä¾ˆäº†ã€‚ äºŒåˆä¸€ç„Šå°ï¼šç„Šå°è‡ªå¸¦çƒ­é£æª + é«˜é¢‘ç”µçƒ™é“ä¸¤ä»¶å¥—ï¼Œé«˜æ‰‹å¿…å¤‡ï¼ˆä¸€èˆ¬æ‹†æœºæ‰ä¼šç”¨åˆ°çƒ­é£æªï¼‰ é«˜é¢‘ç”µçƒ™é“ä½¿ç”¨çš„æ˜¯è·Ÿç”µç£ç‚‰ä¸€æ ·çš„é«˜é¢‘æ¶¡æµå‘çƒ­åŸç†ï¼Œç”µçƒ™é“å¤´è‡ªèº«å‘çƒ­ï¼Œä¸éœ€è¦ä»»ä½•å‘çƒ­èŠ¯ï¼Œ å‘çƒ­å¾ˆå¿«ã€çƒ­å®¹å¤§ã€çƒ™é“å¤´æ›´æ¢ä¾¿å®œã€‚é«˜ç«¯çƒ™é“å¤´éƒ½æ˜¯é«˜é¢‘çš„ã€‚ åæ­£å°±å¾ˆé«˜çº§ä¹Ÿå¾ˆè´µå•¦ã€‚æˆ‘ç°é˜¶æ®µä¹°äº†å®ƒä¹Ÿæ˜¯æµªè´¹é’±ï¼Œæ‰€ä»¥æ²¡äº†è§£å…·ä½“å‹å·å•¥çš„äº† æ’æ¸©åŠ çƒ­å°ï¼šåŠŸèƒ½è·Ÿçƒ­é£æªå·®ä¸å¤šï¼Œä½†æ˜¯ä½“ç§¯å¤§å¾ˆå¤šï¼Œè€Œä¸”æ›´è´µï¼Œæ–°æ‰‹ä¸æ¨èä¹°ã€‚ å…³äºç”µçƒ™é“å¤´ï¼Œè²Œä¼¼åˆ€å¤´æ˜¯æœ€æ¨èçš„ï¼Œå› ä¸ºå®ƒç”¨é€”æœ€å¹¿æ³›ï¼Œçƒ­å®¹å¤§ï¼ŒåŸºæœ¬é€‚ç”¨æ‰€æœ‰åœºæ™¯ã€‚ ç”µçƒ™é“ï¼Œæˆ‘æœ€åä¹°çš„ç¬¬ä¸€æŠŠç”µçƒ™é“æ˜¯ç½‘å‹ DIY çš„ã€ŒL245 ç„Šç¬” ç«ç‘°é‡‘ã€ï¼Œé“åˆé‡‘ CNC åˆ‡å‰²å·¥è‰ºï¼ŒType-C ä¾›ç”µï¼Œæœ€é«˜æ”¯æŒåˆ° PD 120Wï¼Œé¢œå€¼å¾ˆé«˜ï¼Œå£ç¢‘ä¹Ÿå¾ˆå¥½ï¼Œä»·æ ¼æ˜¯ 148 å¤§æ´‹ã€‚ä½¿ç”¨èµ·æ¥è¿˜æ˜¯æ¯”è¾ƒ OK çš„ï¼Œçƒ­å¾—å¾ˆå¿«ï¼Œçƒ­å®¹ä¹Ÿ OKã€‚ä¸è¿‡æ¯•ç«Ÿæ˜¯ DIY çš„ä¾¿å®œç„Šç¬”ï¼Œè´¨é‡ä¸ç¨³ï¼Œæˆ‘æœ‰é‡åˆ°è¿‡å¤šæ¬¡è¯¯ä¼‘çœ ã€æœªè¯†åˆ«åˆ°ç„ŠèŠ¯ã€èŠ¯ç‰‡ç³»ç»Ÿå´©æºƒç­‰é—®é¢˜ï¼Œéƒ½æ˜¯é æ–­ç”µé‡å¯è§£å†³çš„ã€‚ ç”µçƒ™é“çš„ä½¿ç”¨ä¸ä¿å…» å‚è€ƒï¼šhttp://www.cxg.cn/newshow1346.html å‰é¢è®²äº†ï¼Œæˆ‘æ¯•ç«Ÿä¹°çš„æ˜¯ 150 ä¸€æŠŠçš„ç„Šç¬”ï¼ŒC245 è¿™ä¸ªçƒ™é“å¤´ä¹Ÿä¸ä¾¿å®œï¼Œç›´æ¥å½“è€—æéšä¾¿æŠ˜è…¾å°±å¤ªæµªè´¹äº†ã€‚æœ‰å¿…è¦ææ¸…æ¥šæ€ä¹ˆä½¿ç”¨ä¸ä¿å…»ç”µçƒ™é“ï¼š ç„Šæ¥ä½œä¸šå‰ï¼Œå…ˆä¸ºé«˜æ¸©æµ·ç»µåŠ æ°´æ¹¿æ¶¦ï¼Œå†æŒ¤æ‰éƒ¨åˆ†æ°´åˆ†ã€‚ å¦‚æœä½¿ç”¨éæ¹¿æ¶¦çš„æ¸…æ´æµ·ç»µï¼Œä¼šä½¿çƒ™é“å¤´å—æŸæ°§åŒ–ï¼Œå¯¼è‡´ä¸æ²¾é”¡ã€‚ å¦å¤–æˆ‘å‘ç°ã€Œé•€é“œé’¢ä¸çƒã€ç¡®å®æ¯”é«˜æ¸©æµ·ç»µå¥½ç”¨å¤šäº†ï¼Œå¢™è£‚æ¨èï¼ç¬”ä¸å¹²å‡€äº†å¾€é’¢ä¸çƒé‡Œæ’ä¸€æ’ï¼Œç«‹å³å…‰äº®å¦‚æ–°ã€‚ ç„Šæ¥ä½œä¸šä¸­ï¼Œæ¯æ¬¡éƒ½å…ˆåœ¨é«˜æ¸©æµ·ç»µä¸Šæ“¦å¹²å‡€çƒ™é“å¤´ä¸Šçš„æ—§é”¡ï¼Œå†è¿›è¡Œç„Šæ¥ã€‚ å¦‚æœæ˜¯ç”¨ã€Œé•€é“œé’¢ä¸çƒã€ï¼Œé‚£å°±ç›´æ¥åœ¨é’¢ä¸çƒé‡Œæ’ä¸€æ’ï¼Œç«‹å³å…‰æ´å¦‚æ–°ã€‚ ä¸­é€”ä¸ä½¿ç”¨æ—¶ï¼Œå¦‚æœæ— è‡ªåŠ¨ä¼‘çœ åŠŸèƒ½ï¼Œå¯ä»¥æ‰‹åŠ¨å°†æ¸©åº¦è°ƒä½è‡³ 200 åº¦ä»¥ä¸‹ï¼Œé¿å…ç©ºçƒ§ã€‚ç©ºçƒ§ä¼šé™ä½çƒ™é“å¤´å¯¿å‘½ã€‚ ç„Šæ¥å®Œæ¯•åï¼Œå°†æ¸©åº¦è°ƒè‡³çº¦ 250 æ‘„æ°åº¦ï¼Œä½¿ç”¨æ¹¿æ¶¦çš„é«˜æ¸©æµ·ç»µæ¸…æ´çƒ™é“å¤´ï¼Œæœ€åå°†çƒ™é“å¤´åŠ ä¸Šä¸€å±‚æ–°é”¡ä½œä¿æŠ¤ï¼Œè¿™æ ·å¯ä»¥ä¿æŠ¤çƒ™é“å¤´å’Œç©ºæ°”éš”ç¦»ï¼Œçƒ™é“å¤´ä¸ä¼šæ°§åŒ–å˜é»‘ã€‚ çƒ™é“å¤´å·²ç»æ°§åŒ–ã€ä¸æ²¾é”¡æ—¶åº”å¦‚ä½•å¤„ç† å…ˆæŠŠæ¸©åº¦è°ƒåˆ° 300 æ‘„æ°åº¦ï¼Œç”¨æ¸…æ´æµ·ç»µæ¸…ç†çƒ™é“å¤´ï¼Œå¹¶æ£€æŸ¥çƒ™é“å¤´çŠ¶å†µã€‚ å¦‚æœçƒ™é“å¤´çš„é•€é”¡å±‚éƒ¨åˆ†å«æœ‰é»‘è‰²æ°§åŒ–ç‰©æ—¶ï¼Œå¯é•€ä¸Šæ–°é”¡å±‚ï¼Œå†ç”¨æ¸…æ´æµ·ç»µæŠ¹å‡€çƒ™é“å¤´ã€‚å¦‚æ­¤é‡å¤æ¸…ç†ï¼Œç›´åˆ°å½»åº•å»é™¤æ°§åŒ–ç‰©ï¼Œç„¶ååœ¨é•€ä¸Šæ–°é”¡å±‚ã€‚ å°†æ¸©åº¦è°ƒè‡³ 200 æ‘„æ°åº¦å·¦å³è²Œä¼¼æ¯”è¾ƒå®¹æ˜“ä¸Šé”¡ï¼Œä¸æ˜“èšæˆçƒã€‚ å®æµ‹ä¸Šé”¡å†ç”¨æµ·ç»µæŠ¹é™¤ï¼Œæ¯æ¬¡éƒ½èƒ½æ‘¸èµ°ä¸€äº›é»‘è‰²æ°§åŒ–ç‰©ï¼Œéå¸¸æœ‰æ•ˆã€‚ä¸è¿‡è¦æ¸…ç†å¹²å‡€è¿˜æ˜¯éœ€è¦ä¸€äº›è€å¿ƒã€‚ å¦‚æœçƒ™é“å¤´å˜å½¢æˆ–ç©¿å­”ï¼Œå¿…é¡»æ›¿æ¢æ–°å’€ã€‚ å…¶ä»–æ³¨æ„äº‹é¡¹ å‹¿å¤§åŠ›ç„Šæ¥ï¼šåªè¦è®©çƒ™é“å¤´å……åˆ†æ¥è§¦ç„Šç‚¹ï¼Œçƒ­é‡å°±å¯ä¼ é€’ï¼Œæ— éœ€å¤§åŠ›ç„Šæ¥ã€‚ å°½é‡ä½æ¸©ç„Šæ¥ï¼šé«˜æ¸©ç„Šæ¥ä¼šåŠ é€Ÿçƒ™é“å¤´æ°§åŒ–ï¼Œé™ä½çƒ™é“å¤´ä½¿ç”¨å¯¿å‘½ã€‚å¦‚çƒ™é“å¤´æ¸©åº¦è¶…è¿‡470â„ƒï¼Œå®ƒçš„æ°§åŒ–é€Ÿåº¦æ˜¯380â„ƒçš„ä¸¤å€ã€‚ ç»å¸¸ä¿æŒçƒ™é“å¤´ä¸Šé”¡ï¼šè¿™å¯ä»¥å‡ä½çƒ™é“å¤´çš„æ°§åŒ–æœºä¼šï¼Œä½¿çƒ™é“å¤´æ›´è€ç”¨ã€‚ ä¿æŒçƒ™é“å¤´æ¸…æ´ä¸åŠæ—¶æ¸…ç†æ°§åŒ–ç‰© å°å¿ƒæ”¾å…¥çƒ™é“æ¶ï¼šå¦‚æœçƒ™é“å¤´æ¥è§¦åˆ°çƒ™é“æ¶æ— æ³•è‡ªåŠ¨ä¼‘çœ ï¼Œé•¿æ—¶é—´ç©ºçƒ§å°†ä¼šæ¯æ‰çƒ™é“å¤´ã€‚ é€‰ç”¨æ´»æ€§ä½çš„åŠ©ç„Šå‰‚ï¼šæœ€ä¾¿å®œçš„å°±æ˜¯æ¾é¦™ï¼Œæ›´å¥½ä¸€ç‚¹çš„æ˜¯æ— é“…æ— é…¸æ— å¤ç´ åŠ©ç„Šå‰‚ã€‚ ç„Šé”¡ä¸åœ¨ç„Šæ¥è¿‡ç¨‹ä¸­ä¸ºä»€ä¹ˆä¼šçˆ†é”¡ï¼Ÿ https://zhuanlan.zhihu.com/p/584316437 å»ºè®®ç›´æ¥çœ‹ä¸Šé¢çš„æ–‡ç« ï¼Œå¯èƒ½çš„åŸå› å¤§æ¦‚æ˜¯ï¼š å—æ½® ç„Šé”¡ä¸æ··æœ‰æ‚è´¨ï¼Œæˆ–è€…åŠ©ç„Šå‰‚å«é‡è¿‡é«˜ ç„Šæ¥æ“ä½œæ—¶æ‰‹ä¸Šæœ‰æ±—æˆ–æ˜¯æ´—è¿‡æ‰‹åæ‰‹æ²¡æœ‰å®Œå…¨å¹²å°±å¼€å§‹ç„Šæ¥ çƒ™é“æ¸©åº¦è¿‡é«˜ æˆ‘æœ€è¿‘ä¹°çš„ä¸¤å·ç„Šé”¡ä¸å°±æœ‰çˆ†é”¡çš„é—®é¢˜ï¼Œçƒ™é“æ¸©åº¦æ˜¯è®¾çš„å¾ˆå¸¸è§„çš„ 320 åº¦ç”šè‡³æ›´ä½çš„ 290 åº¦ï¼Œç°åœ¨æ€€ç–‘æ˜¯ä¸æ˜¯è¿™ä¸ªæ— é“…ç„Šé”¡ä¸æœ‰é—®é¢˜ã€‚ç½ªé­ç¥¸é¦–æ‰¾åˆ°äº†ï¼Œæ˜¯å› ä¸ºæˆ‘çš„é”¡çº¿æ¶ï¼Œå®ƒä¸‹æ–¹å°±æ˜¯æ¹¿æ¶¦çš„é«˜æ¸©æµ·ç»µâ€¦è¿™æ˜¾ç„¶å¾ˆå®¹æ˜“å—æ½®â€¦ å¦‚ä½•ä½¿ç”¨ç”µçƒ™é“è¿›è¡Œæ‹†ç„Šå½“ä½ ç„Šé”™ç„Šåäº†å…ƒä»¶ï¼Œæˆ–è€…ä½ éœ€è¦ä¿®ä¿®æ”¹æ”¹ç”µè·¯æ¿æ—¶ï¼Œå°±éœ€è¦å…ˆè¿›è¡Œæ‹†ç„Šã€‚ ç”¨ç”µçƒ™é“è¿›è¡Œæ‹†ç„Šéœ€è¦æ³¨æ„è¿™äº›äº‹é¡¹ï¼š æ¸©åº¦å¿…é¡»è¦é«˜ï¼Œèµ·ç  350 ä»¥ä¸Š çƒ™é“å°–å¿…é¡»ç•™ç‚¹é”¡åœ¨ä¸Šé¢ã€‚å¦‚æœçƒ™é“å°–ä¸æŒ‚é”¡ï¼Œç„Šæ¥çš„æ—¶å€™ä¼šå‘ç°å³ä½¿æ¸©åº¦é«˜ï¼Œç”µè·¯æ¿çš„ç„Šé”¡ä¹Ÿå¾ˆéš¾èåŒ– å¦ä¸€ä¸ªæ–¹å¼æ˜¯å…ˆåŠ ç‚¹æœ‰é“…é”¡ä¸é™ä½ç„Šé”¡ç†”ç‚¹ï¼Œç„¶åå†ç”¨å¸é”¡å™¨æˆ–å¸é”¡å¸¦æ¥å¸ å¦‚æœç”¨å¸é”¡å™¨ï¼Œå‘ç°ä¸æ’¤çƒ™é“å¤´ç›´æ¥æŠŠå¸é”¡å™¨æ€¼ä¸Šå»ï¼Œæ•ˆæœæ˜¯æœ€å¥½çš„ å¦‚æœä½¿ç”¨çš„æ˜¯å¸é”¡å¸¦ï¼Œæ¸©åº¦å°±å¿…é¡»æ›´é«˜ï¼Œä¼°è®¡è‡³å°‘å¾— 380 ç”šè‡³æ›´é«˜ å› ä¸ºå¸é”¡å¸¦ä¸€èˆ¬æ˜¯çº¯é“œï¼Œå¯¼çƒ­æ€§èƒ½å¾ˆå¥½ã€‚ä¸€èˆ¬ 320 åº¦å°±å¾ˆå®¹æ˜“ç†”çš„é”¡ï¼Œä¸Šäº†å¸é”¡å¸¦åçƒ­é‡å…¨è¢«å¸é”¡å¸¦ä¼ å¯¼èµ°äº†ï¼Œæ¸©åº¦ä¸é«˜æ ¹æœ¬èåŒ–ä¸äº† æˆ–è€…ç›´æ¥ä¸Šçƒ­é£æª+é•Šå­ä¹Ÿè¡Œï¼ˆæˆ‘è¿˜æ²¡è¯•è¿‡â€¦ï¼‰ã€‚ ","date":"2023-01-31","objectID":"/posts/electrical-engineering-circuits-basics-1/:5:1","series":["EE å…¥é—¨"],"tags":["ç”µå­ç”µè·¯","Electrical Engineering","MCU"],"title":"EE å…¥é—¨ï¼ˆä¸€ï¼‰ - ç”µå­ç”µè·¯åŸºç¡€çŸ¥è¯†","uri":"/posts/electrical-engineering-circuits-basics-1/#å¦‚ä½•ä½¿ç”¨ç”µçƒ™é“è¿›è¡Œæ‹†ç„Š"},{"categories":["tech"],"content":" 2. å…¶ä»–å·¥å…·ä¸ææ–™ç„Šæï¼ˆå»ºè®®æ—¥å¸¸ç”¨è´µä¸€ç‚¹çš„æ— é“…é”¡ä¸ï¼Œè™½ç„¶ç†”ç‚¹é«˜äº›ï¼Œä½†å¯¹èº«ä½“å¥½ï¼‰ï¼š ç„Šé”¡ä¸ï¼šæœ€å¸¸è§çš„ç„Šæï¼Œä¸è¿‡ç¨å¾®è¦æ±‚ä¸€ç‚¹ç„Šæ¥æŠ€æœ¯ï¼Œå¯èƒ½éœ€è¦å¤§çº¦åŠä¸ªå°æ—¶ç†Ÿæ‚‰ä¸‹ å¸¸ç”¨ 0.8mm è·Ÿ 1.0mm çš„é”¡ä¸ ä¸ªäººç©å»ºè®®ä¹°æ— é“…çš„ï¼Œè™½ç„¶è´µç‚¹ç†”ç‚¹é«˜ä¸€ç‚¹ï¼Œä½†æ›´ç¯ä¿ï¼Œå¯¹èº«ä½“ä¹Ÿå¥½ã€‚ é”¡è†ï¼šæ–°å‹ç„Šæ¥ææ–™ï¼Œç”±ç„Šé”¡ç²‰ã€åŠ©ç„Šå‰‚ä»¥åŠå…¶å®ƒçš„è¡¨é¢æ´»æ€§å‰‚ç­‰æ··åˆæˆçš„è†çŠ¶ç‰©ã€‚ å¯¹äºå¸¸ç”¨ç„Šæ¥åœºæ™¯ï¼Œå¯ä»¥ç›´æ¥æŠ¹ä¸Šé”¡è†ï¼Œç„¶åç”¨çƒ­é£æªä¸€å¹ï¼Œæˆ–è€…ç”¨çƒ™é“åˆ€å¤´æ‹–ç„Šï¼Œæˆ–è€…ç›´æ¥ä¸Šå‘çƒ­æ¿ / æ’æ¸©åŠ çƒ­å°ï¼Œæ®è¯´éå¸¸ç®€å•å¥½ç”¨ã€‚ æœ€å¸¸ç”¨çš„åœºæ™¯æ˜¯å¤æ‚ PCB æ¿å­ï¼Œç›´æ¥ç”¨å®šåˆ¶çš„é’¢ä¸ç½‘è¦†ç›– PCB æ¿å­åˆ·ä¸Šé”¡è†ã€ç›´æ¥å°±æŠŠè§¦ç‚¹éƒ½åˆ·ä¸Šäº†ï¼Œç„¶åå†ç”¨é•Šå­æ‰‹å·¥è´´ä¸Šè´´ç‰‡å…ƒå™¨ä»¶ã€‚ä¸è¿‡è¿™ä¸ªæœ‰éš¾åº¦â€¦å·²ç»æ˜¯é«˜æ‰‹ç©æ³•äº†ã€‚æœ€çœå¿ƒæ˜¯èŠ±é’±ç›´æ¥æ‰¾ PCB å‚å­ç»™æ‰“å° + ç„Šæ¥ï¼ˆé’èƒ½åŠ›ï¼‰ã€‚ å¯¹äºç„Šç‚¹ä¸å¤šçš„è´´ç‰‡ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨é’ˆç­’å¼çš„é”¡è†æŒ¤ä¸Šå»ï¼Œç„¶åå†ç”¨ç‰™ç­¾æˆ–é•Šå­å»æ‰å¤šä½™çš„é”¡è†ï¼Œ ç”¨é•Šå­æŠŠè´´ç‰‡å…ƒä»¶æ”¾ä¸Šå»ï¼ˆæœ‰ç‚¹æ­ªæ²¡äº‹ï¼ŒåŠ çƒ­æ—¶ç„Šé”¡çš„å¼ åŠ›ä¼šä½¿å®ƒè‡ªåŠ¨å›æ­£ï¼‰ï¼Œæœ€åç›´æ¥ä¸Šçƒ­é£æªæˆ–åŠ çƒ­å°å°±èƒ½ç„Šæ¥ ok äº†ã€‚ åŒæ ·å»ºè®®ä¹°æ— é“…çš„ï¼Œè™½ç„¶è´µç‚¹ç†”ç‚¹é«˜ä¸€ç‚¹ï¼Œä½†æ›´ç¯ä¿ï¼Œå¯¹èº«ä½“ä¹Ÿå¥½ã€‚ é«˜æ¸©æµ·ç»µï¼šå¯ä»¥è¯´æ˜¯ç„Šæ¥å¿…å¤‡äº†ï¼Œä¸€å®šè¦åŠ æ°´æ¹¿æ¶¦åå†ä½¿ç”¨ã€‚å¯ä»¥å¤šå¤‡å‡ ç‰‡ï¼Œè„äº†æ´—æ´—ï¼Œæ´—ä¸å¹²å‡€å°±æ¢ã€‚ é•€é“œé’¢ä¸çƒï¼šåŒæ ·æ˜¯ç”¨äºæ¸…æ´çƒ™é“å¤´çš„ï¼Œå‰é¢è®²ç„Šæ¥æŠ€æœ¯æ—¶å·²ç»è¯´è¿‡äº†ï¼Œè¿™ä¸ªç¡®å®æ¯”é«˜æ¸©æµ·ç»µå¥½ç”¨å¾ˆå¤šã€‚ åŠ©ç„Šå‰‚ Fluxï¼š åœ¨ç„Šæ¥å·¥è‰ºä¸­èƒ½å¸®åŠ©å’Œä¿ƒè¿›ç„Šæ¥è¿‡ç¨‹ï¼ŒåŒæ—¶å…·æœ‰ä¿æŠ¤ä½œç”¨ã€é˜»æ­¢æ°§åŒ–ååº”çš„åŒ–å­¦ç‰©è´¨ã€‚ é«˜çº¯åº¦æ¾é¦™ï¼šä¾¿å®œå¸¸ç”¨ï¼Œä¸€èˆ¬ç„Šä¸ªä¼ æ„Ÿå™¨è·Ÿæ™®é€š PCB æ¿å­å®Œå…¨å¤Ÿç”¨ã€‚ å¦‚æœæ¿å­è¦é•¿æœŸä½¿ç”¨ï¼Œé‚£ç„Šå®Œéœ€è¦ç”¨é…’ç²¾æµ¸æ³¡æ¸…æ´—ï¼Œé¿å…åŠ©ç„Šå‰‚ç¢³åŒ–å¯¼è‡´ç»ç¼˜æ€§èƒ½ä¸‹é™ã€‚ï¼ˆå¦‚æœåªæ˜¯ç»ƒæ‰‹çš„æ¿å­ï¼Œé‚£å°±æ— æ‰€è°“äº†ï¼‰ æ— é“…æ— å¤æ— é…¸åŠ©ç„Šå‰‚ï¼šé«˜ç«¯åŠ©ç„Šå‰‚ï¼Œå…æ´— æ— é“…ä¸»è¦æ˜¯ä¸ºäº†ç¯ä¿ï¼Œå¯¹èº«ä½“å¥½ã€‚ å› ä¸ºå¤ç´ ç¦»å­å¾ˆéš¾æ¸…æ´—å¹²å‡€ï¼ŒåŠ©ç„Šå‰‚æ®‹ç•™å°†å¯¼è‡´ç»ç¼˜æ€§èƒ½ä¸‹é™ï¼Œå› æ­¤å…æ´—åŠ©ç„Šå‰‚å¿…é¡»å¾—æ— å¤ç´ ã€‚ æ— é…¸æ˜¯ä¸ºäº†é¿å…åŠ©ç„Šå‰‚è…èš€ç”µè·¯æ¿è·Ÿã€å¼•è„šã€çƒ™é“å¤´ã€‚ ä»¥åŠå…¶ä»–ç„Šæ¥ç›¸å…³å·¥å…·ï¼š å¸é”¡å™¨ï¼šä¸»è¦ç”¨äºç”µå™¨æ‹†ç„Š åœºæ™¯ï¼šä¸€æ˜¯ç„Šé”™äº†æˆ–è€…é”¡å¤šäº†ï¼Œæ‹†ç„Šåé‡æ–°ç„Šæ¥ã€‚äºŒæ˜¯æ‹†ç„Šå…¶ä»–ç”µè·¯ è¿™ç©æ„å„¿ä¸€ä¸ªä¾¿å®œçš„æ‰åå¤šå—ï¼Œå…¥é—¨é˜¶æ®µä¹°ä¸€ä¸ªä¹Ÿè¡Œã€‚ä¸è¿‡ä¹Ÿæœ‰è¯´æ‹¿ç”µçƒ™é“çƒ­ä¸€ä¸‹ç„¶åä¸€ç£•ï¼Œç„Šé”¡å°±è‡ªå·±æ‰ä¸‹å»äº†ï¼Œè‡ªå·±ç©ä¸ä¸€å®šéœ€è¦è¿™ç©æ„å„¿ã€‚ å¸é”¡å¸¦ï¼šæ‹¿æ¥æ¸…ç†è¡¨è´´ç„Šç›˜ä¸Šçš„æ®‹é”¡ã€‚å°±æ˜¯ä¸€å·ç»†é“œä¸ç¼–åˆ¶çš„å¸¦å­ï¼ŒèåŒ–çš„é”¡å®¹æ˜“è¢«å®ƒå¸èµ° æ¯”å¸é”¡å™¨æ›´ä¾¿å®œä¸‡ç”¨ï¼Œç¼ºç‚¹æ˜¯éœ€è¦æ›´é«˜çš„æ¸©åº¦ï¼Œå¯ä»¥è€ƒè™‘ä¹°ä¸€å·ã€‚ çƒ­é£æªï¼šè²Œä¼¼ä¸»è¦æ˜¯æ‹†ç„Šç”¨çš„ï¼Œå½“ç„¶ç”¨æ¥å¹çƒ­ç¼©ç®¡ä¹Ÿå¾ˆå¥½ç”¨ã€‚ ç„Šå°å¤¹å…·ï¼šç„Šçº¿ç„Šæ¿å­éƒ½æŒºå®ç”¨ï¼Œç›¸å½“äºé•¿å‡ºæ¥å››åªæ‰‹ã€‚è€Œä¸”ç›¸æ¯”æ”¾æ¡Œé¢ï¼Œå®ƒçš„æ•£çƒ­é€Ÿåº¦ä½å¾ˆå¤šï¼Œæ›´éš¾å¤±æ¸©ã€‚ å°–å˜´é’³ï¼šç„Šæ¥å®Œä¸€äº›éè´´ç‰‡å…ƒä»¶ï¼Œå¿…é¡»è¦æŠŠå¤šä½™çš„å¼•è„šå‰ªæ‰ï¼Œå°–å˜´é’³æ„Ÿè§‰æŒºéœ€è¦çš„ã€‚ ç»´ä¿®å·¥ä½œå°ï¼ˆè€é«˜æ¸©ç¡…èƒ¶å«ï¼‰ï¼šæ·˜å®ä¸Šä¸€äºŒåå—é’±ä¸€å—ï¼Œå¯ä»¥ä¿æŠ¤æ¡Œå­ã€æ–¹ä¾¿æ”¾ä¸€äº›å°å…ƒå™¨ä»¶ã€‚ è¿˜æœ‰å°±æ˜¯è·Ÿç„Šæ¥æ²¡å•¥å…³ç³»ï¼Œä½†æ˜¯ DIY å¸¸ç”¨çš„å·¥å…·ï¼š åˆ‡å‰²å«ï¼šå¦‚æœéœ€è¦åšä¸€äº›åˆ‡å‰²ï¼Œè¿™ä¸ªåº”è¯¥ä¹Ÿå¾ˆæœ‰ç”¨ï¼Œçœ‹è®¸å¤šç½‘å‹éƒ½æœ‰ï¼Œä¸è¿‡æˆ‘æš‚æ—¶æ²¡ææ¸…æ¥šè‡ªå·±æ˜¯å¦éœ€è¦ã€‚ èºä¸ç£æ€§æ”¶çº³å«ï¼šå…¶å®è·Ÿç„Šæ¥å…³ç³»ä¸å¤§äº†ï¼Œä¸è¿‡ä¹Ÿåˆ—ä¸€ä¸‹ èºä¸åˆ€ + ä¸‡èƒ½æ‰³æ‰‹ + æ°´å£é’³ï¼šè¿™ä¸ªå¥½åƒè·Ÿç„Šæ¥æ²¡å•¥å…³ç³»ï¼Œä¸è¿‡ä¹Ÿå¯ä»¥åˆ—ä¸€ä¸‹ å°¤å…¶æ˜¯ç”µåŠ¨èºä¸åˆ€ï¼Œåˆ€å¤´ä¸€å®šè¦ä¹°å¥½ä¸€ç‚¹çš„ï¼Œå¹¶ä¸”æœ€å¥½æ˜¯æ ‡å‡†æœ‰æ›¿ä»£å“çš„ã€‚æˆ‘ä»¥å‰ç”¨ç”µåŠ¨èºä¸åˆ€å°±é‡åˆ°è¿‡åˆ€å¤´ç¡¬åº¦ä¸è¡Œè¢«åå­—èºä¸åˆ€å¤´ç£¨å¹³äº†çš„æƒ…å†µâ€¦ æ°´å£é’³æ¨èå¾·åŠ›è¥¿ èºä¸ + èºæ¯ï¼šèºä¸åˆ€è·Ÿæ‰³æ‰‹éƒ½æœ‰äº†ï¼Œèºä¸èºæ¯ä¸å¾—ä¹°å‡ å¥—ï¼Ÿ å…¶ä¸­æœ‰äº›ç‰¹åˆ«çš„æ˜¯è‡ªé”èºæ¯ï¼Œè¿™ç§èºæ¯è‡ªå¸¦å°¼é¾™è‡ªé”åœˆï¼Œå³ä½¿æ²¡æ‹§åˆ°ä½ä¹Ÿèƒ½è‡ªé”ã€‚ä¸è¿‡éœ€è¦ç”¨æ¯”è¾ƒå¤§çš„åŠ›æ°”æ‰èƒ½æ‹§è¿›å»ï¼Œè¿™æ˜¯æ­£å¸¸ç°è±¡ã€‚ èºæ¯é˜²æ¾çš„å…­ç§åŸºæœ¬æ–¹æ³•ï¼Œä½ çŸ¥é“å‡ ä¸ªï¼Ÿï¼ˆåŠ¨å›¾ï¼‰ èºä¸çš„å‹å·ï¼ŒDIY ä¸­å¸¸ç”¨çš„ï¼ŒM3å³èºçµ²å¤–å¾‘ç‚º 3mm, M4 å³èºçµ²å¤–å¾‘ç‚º 4mmï¼ŒåŒç† M5 å³ 5mm æœ‰æ™‚æœƒè¨»æ˜èºçµ²ç‰™è·ï¼Œå¦‚ M3x0.5ï¼ŒM4x0.70ï¼ŒM5x0.8ï¼ŒM6x1ï¼Œä½†å› ç‚ºè¿™æ˜¯æ¨™æº–è¦ç¯„ï¼Œé€šå¸¸ä¸æ å¯¹ç»“æ„å¼ºåº¦è¦æ±‚ä¸é«˜çš„åœºæ™¯ï¼Œä¹Ÿå¯ä»¥è‡ªå·±ç”¨ 3D æ‰“å°æœºæ‰“å°èºä¸èºæ¯ã€‚ èºä¸æ›´è¯¦ç»†çš„ä¸­è‹±æœ¯è¯­å¯¹ç…§ï¼šèºçµ²è¦æ ¼èˆ‡å®šç¾© - ç·¯ä¸èºçµ² æ¸¸æ ‡å¡å°º + å·å°ºï¼šæœ€ç®€å•çš„æ˜¯ä¹°æ•°å­—çš„ï¼Œä¸éœ€è¦è´¹å¿ƒæ€è¯»æ•°â€¦ä¹Ÿæ¨èå¾·åŠ›è¥¿çš„ 3D æ‰“å°æœºã€æ¿€å…‰åˆ‡å‰²æœºç­‰ç­‰å…¶ä»– DIY å·¥å…· ","date":"2023-01-31","objectID":"/posts/electrical-engineering-circuits-basics-1/:5:2","series":["EE å…¥é—¨"],"tags":["ç”µå­ç”µè·¯","Electrical Engineering","MCU"],"title":"EE å…¥é—¨ï¼ˆä¸€ï¼‰ - ç”µå­ç”µè·¯åŸºç¡€çŸ¥è¯†","uri":"/posts/electrical-engineering-circuits-basics-1/#2-å…¶ä»–å·¥å…·ä¸ææ–™"},{"categories":["tech"],"content":" äº”ã€åç»­å­¦ä¹ è·¯çº¿æœ‰äº†ç”µè·¯åŸºç¡€åï¼Œé¦–å…ˆå¯ä»¥ä¹°ä¸€äº›å…¥é—¨çš„ç„Šæ¥å¥—ä»¶ç»ƒç»ƒç„Šæ¥æŠ€æœ¯ï¼Œå¹¶ææ˜ç™½å®ƒçš„åŸç†ã€‚æˆ‘åœ¨æ·˜å®ã€Œç”µå­çˆ±å¥½è€…ä¹‹å®¶ã€ä¸Šä¹°äº†å‡ ä¸ªç„Šæ¥å¥—ä»¶ï¼Œå¦‚æŒ‡å°–é™€èºã€5v å‡ 12v å‡å‹æ¿ã€LED æ‘‡æ‘‡æ£’ã€åäºŒä¸ªå®éªŒæ´æ´æ¿å¥—ä»¶ã€é«˜å‹å‘ç”Ÿå™¨ç­‰ã€‚ è¾¹ç©è¾¹å­¦ä¹ ç›¸å…³çŸ¥è¯†æ˜¯æœ€æœ‰æ„æ€çš„ï¼Œç©åˆ°ä¸€å®šé˜¶æ®µåï¼Œå¯ä»¥å†è€ƒè™‘è¡¥ä¸€è¡¥åŸºç¡€çŸ¥è¯†ã€‚åŸºç¡€ç†è®ºæ–¹é¢æˆ‘æŸ¥åˆ°è¿™å‡ æœ¬ï¼ˆä¸ºäº†æˆ‘çš„è‹±è¯­èƒ½åŠ›ï¼Œé€‰æ‹©è¯»è‹±æ–‡çš„ï¼‰ï¼š Practical Electronics for Inventors, Fourth Edition: ä¸­æ–‡ç‰ˆåä¸ºã€Šå®ç”¨ç”µå­å…ƒå™¨ä»¶ä¸ç”µè·¯åŸºç¡€ã€‹ï¼Œæ˜¯è¯„è®ºåŒº @è¾›æœªç¾Š æ¨èçš„ï¼Œæ„Ÿè§‰ç¡®å®å¾ˆé€‚åˆæˆ‘è¿™ç§ä¸šä½™æ–°æ‰‹å…¥é—¨~ Foundations of Analog and Digital Electronic Circuitsï¼š è¿™æœ¬ä¹¦æ¯”è¾ƒå—æ¨èï¼Œä¸­æ–‡ç‰ˆã€Šæ¨¡æ‹Ÿå’Œæ•°å­—ç”µå­ç”µè·¯åŸºç¡€ã€‹ï¼Œè±†ç“£è¯„åˆ† 9.3ï¼Œä¸è¿‡æˆ‘çœ‹äº†ä¸‹æ¯”ä¸Šé¢é‚£æœ¬è¦éš¾ï¼Œæ„Ÿè§‰é€‚åˆåé¢è¿›é˜¶çœ‹ã€‚ å­¦ä¹ åŸºç¡€çš„ç”µè·¯ç†è®ºæ—¶å¯ä»¥ä»¿çœŸè½¯ä»¶åŒæ­¥å­¦ä¹ ï¼Œå¦‚ï¼š Multisimï¼ˆå…ƒå™¨ä»¶ä»¿çœŸï¼‰ã€Proteusï¼ˆå•ç‰‡æœºä»¿çœŸï¼‰ è¿™ä¸¤ä¸ªè½¯ä»¶éƒ½éå¸¸æµè¡Œï¼Œä¸è¿‡åŸºæœ¬éƒ½ä»…æ”¯æŒ Windows ç³»ç»Ÿï¼Œæˆ‘é€‰æ‹©æ”¾å¼ƒã€‚ EDAï¼ˆElectronic Design Automationï¼‰ ç”µè·¯æ¿åŸç†å›¾ã€PCBï¼ˆPrinted Circuit Boardï¼‰ è®¾è®¡å·¥å…· ç«‹åˆ› EDA: å›½äº§ EDAï¼Œå…¨å¹³å°æ”¯æŒï¼Œä¹Ÿæä¾› Web ç‰ˆ KiCAD: å¼€æºç”µè·¯æ¿è®¾è®¡å·¥å…·ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œæ”¯æŒæ’ä»¶ï¼Œç¤¾åŒºèµ„æºå¤šã€‚ ","date":"2023-01-31","objectID":"/posts/electrical-engineering-circuits-basics-1/:6:0","series":["EE å…¥é—¨"],"tags":["ç”µå­ç”µè·¯","Electrical Engineering","MCU"],"title":"EE å…¥é—¨ï¼ˆä¸€ï¼‰ - ç”µå­ç”µè·¯åŸºç¡€çŸ¥è¯†","uri":"/posts/electrical-engineering-circuits-basics-1/#äº”åç»­å­¦ä¹ è·¯çº¿"},{"categories":["tech"],"content":" 1. å•ç‰‡æœºæœ‰ä¸€å®šç”µè·¯åŸºç¡€åï¼Œå°±å¯ä»¥å¼€å§‹ç©å•ç‰‡æœºäº†ã€‚ ä»‹ç»ï¼šå•ç‰‡æœºçš„è‹±æ–‡åå« Microcontroller Unitï¼Œç¼©å†™ä¸º MCU. å®ƒæ˜¯æŠŠ CPUã€RAMã€å®šæ—¶/è®¡æ•°å™¨ï¼ˆtimer/counterï¼‰ã€I/O æ¥å£ç­‰éƒ½é›†æˆåœ¨ä¸€å—é›†æˆç”µè·¯èŠ¯ç‰‡ä¸Šçš„å¾®å‹è®¡ç®—æœºã€‚ åº”ç”¨ï¼šä¸»è¦ç”¨äºå‰ç«¯çš„æ— æ“ä½œç³»ç»Ÿã€ä»¥å®æ—¶æ§åˆ¶ä¸ºä¸»çš„ç¯å¢ƒï¼Œå¦‚ç”µå­é’Ÿè¡¨ã€ç”µæœºæ§åˆ¶ç­‰ã€‚åœ¨ç¡¬ä»¶çˆ±å¥½è€…æ‰‹ä¸­å¯ç”¨äºæœºå™¨äººå‰ç«¯æ§åˆ¶ï¼Œå››è½´é£è¡Œå™¨å‰ç«¯æ§åˆ¶ï¼Œ3Dæ‰“å°æœºå‰ç«¯æ§åˆ¶ç­‰ã€‚ å…¸å‹äº§å“ï¼š Arduino: AVR å•ç‰‡æœºä¸ºæ ¸å¿ƒæ§åˆ¶å™¨çš„å•ç‰‡æœºåº”ç”¨å¼€å‘æ¿ï¼Œæ˜¯å¼€æºç¡¬ä»¶ï¼Œæ–°æ‰‹å‹å¥½ STM32: è²Œä¼¼æ˜¯å•ç‰‡æœºä»ä¸šäººå‘˜çš„å…¥è¡Œé¦–é€‰ï¼Œä½¿ç”¨ ARM Cortex-M ç³»åˆ—æ ¸å¿ƒã€‚ è¡¥å……è¯´æ˜ï¼š å•ç‰‡æœºéå¸¸ç®€å•ï¼Œå› ä¸ºå¾ˆæ¥è¿‘åº•å±‚ï¼Œè€Œä¸”ç¡¬ä»¶é…ç½®æå·®ï¼Œå¹²ä¸äº†å¤ªå¤šçš„äº‹ã€‚ä¸»è¦çš„ä¼˜åŠ¿å°±æ˜¯ç¨³å®šã€å¼€å‘ä¹Ÿç®€å•ã€‚ å•ç‰‡æœºè·Ÿç¡¬ä»¶çš„ç»‘å®šå¾ˆä¸¥é‡ï¼Œç»å¸¸å‡ºç°ä¸€å¥—ä»£ç æ¢ä¸€ä¸ªå•ç‰‡æœºå¹³å°ï¼Œå°±å¾—å®Œå…¨é‡å†™ã€‚ å•ç‰‡æœºæœ€ç®€å•çš„ç©æ³•å½“å± esphomeï¼Œåªéœ€è¦ä¼š yaml é…ç½®è¯­è¨€å°±èƒ½å¼€å§‹ç”¨ ESP32/ESP8266/ESP32-C3 ç­‰ MCU ç©æ™ºèƒ½å®¶å±…ï¼Œä¸éœ€è¦å†™ä»»ä½•ä»£ç ï¼Œç”Ÿæ€éå¸¸ä¸°å¯Œï¼Œä½œä¸ºå…¥é—¨è·¯å¾„æ„Ÿè§‰å¾ˆåˆé€‚ï¼ˆæ–‡ç« å¼€å¤´å°±è¯´äº†ï¼Œæˆ‘å°±æ˜¯ä»è¿™ç©æ„å„¿å…¥å‘çš„ç¡¬ä»¶â€¦ï¼‰ ä½†æ˜¯ ESPHome æ¯•ç«Ÿå¤ªç®€å•ï¼Œç”¨çš„éƒ½æ˜¯åˆ«äººå†™å¥½çš„ç°æˆæ¨¡å—ï¼Œæƒ³å®ç°ç‚¹æ›´è‡ªå®šä¹‰çš„åŠŸèƒ½å°±å¾—è‡ªå·±å­¦ä¹ å•ç‰‡æœºç¼–ç¨‹äº†ã€‚ æˆ‘çš„å•ç‰‡æœºç¼–ç¨‹å­¦ä¹ è·¯å¾„å¤§æ¦‚æ˜¯ï¼š 8051: æœ€ç®€å•æœ€ç»å…¸çš„å•ç‰‡æœº æˆ‘çš„ 8051 æ±‡ç¼–å­¦ä¹ ç¬”è®°ä¸ä»£ç ï¼šryan4yin/learn-8051-asm STM32: å·¥ä¸šå±Šåº”ç”¨æœ€å¹¿æ³›çš„å•ç‰‡æœºï¼Œç½‘ä¸Šèµ„æ–™ä¼—å¤šã€‚ å¼€å‘å·¥å…·é“¾å¾ˆæˆç†Ÿå®Œå–„ï¼Œä¸è¿‡æœ‰ç‚¹ååº•å±‚ï¼Œé€‚åˆç”¨äºå­¦ä¹ åº•å±‚çŸ¥è¯†ã€‚ æˆ‘çš„ STM32 å­¦ä¹ ç¬”è®°ä¸ä»£ç ï¼ˆæŒç»­æ›´æ–°ä¸­ï¼Œä½¿ç”¨ C è¯­è¨€ï¼Œåç»­æ‰“ç®—è¯•ä¸‹ Rustï¼‰ï¼šryan4yin/learn-stm32f103c8t6 ESP32: åŒ…å« wifi è“ç‰™åŠŸèƒ½çš„ IoT å•ç‰‡æœºï¼Œåœ¨ç‰©è”ç½‘é¢†åŸŸåº”ç”¨éå¸¸å¹¿æ³›ï¼Œç¡¬ä»¶å‘çƒ§å‹çš„æœ€çˆ±ã€‚ ä¹é‘«å®˜æ–¹çš„ ESP-IDF å®Œå…¨å¼€æºï¼ŒåŠŸèƒ½æ¯”è¾ƒå®Œå–„ï¼Œå°è£…å±‚æ¬¡æ¯” STM32 HAL æ›´é«˜ï¼Œè€Œä¸”è¿­ä»£å¾ˆå¿«ï¼Œç”¨èµ·æ¥æ›´ç®€å•ï¼ˆä¸è¿‡ç›¸å¯¹åœ°å°±å¯¹åº•å±‚æ›´ç¼ºä¹æŒæ§ï¼‰ã€‚ æˆ‘çš„ ESP32 å­¦ä¹ ç¬”è®°ä¸ä»£ç ï¼ˆåŒæ ·æŒç»­æ›´æ–°ä¸­ï¼Œä¹Ÿæ˜¯ç”¨çš„ Cï¼Œåé¢ä¹Ÿæ‰“ç®—ç”¨ Rust ææï¼‰ï¼šelectrical-engineering/esp32 å…¶ä»– ä¹°äº†çŸ½é€Ÿç§‘æŠ€æ–°å‡ºçš„ Maix Zero M0S/M1Sï¼Œä½¿ç”¨ RISC-V æ¶æ„çš„ MCUï¼Œè²Œä¼¼ç›®å‰å¿…é¡»ç”¨èŠ¯ç‰‡å®˜æ–¹ ï¼ˆåšæµæ™ºèƒ½ï¼‰çš„ SDK å†™ä»£ç ã€‚ç‚¹äº†ä¸ªç¯å°±ä¸€ç›´åƒç°äº†ï¼ˆ å•ç‰‡æœºé¢†åŸŸç›®å‰ä»ç„¶æ˜¯ ARM32 æ¶æ„çš„å¤©ä¸‹ï¼Œä¸è¿‡å¼€æºå…è´¹çš„ RISC-V æ¶æ„å‘å±•è¿…çŒ›ï¼Œæœ‰æœ›ä¸ ARM32 åˆ†åº­æŠ—ç¤¼ã€‚ç›®å‰ä¹é‘«åŸºäº RISC-V çš„ ESP32C3 å°±æŒºå—æ¬¢è¿çš„ï¼Œè¿˜å‡ºäº†ä¹¦ï¼Œå¦å¤–åç»­ç‰ˆæœ¬ ESP32C5 ä¹Ÿå·²ç»è¢« ESP-IDF æ”¯æŒäº†ï¼Œå‘å±•å¾ˆå¿«ã€‚ ","date":"2023-01-31","objectID":"/posts/electrical-engineering-circuits-basics-1/:6:1","series":["EE å…¥é—¨"],"tags":["ç”µå­ç”µè·¯","Electrical Engineering","MCU"],"title":"EE å…¥é—¨ï¼ˆä¸€ï¼‰ - ç”µå­ç”µè·¯åŸºç¡€çŸ¥è¯†","uri":"/posts/electrical-engineering-circuits-basics-1/#1-å•ç‰‡æœº"},{"categories":["tech"],"content":" 2. åµŒå…¥å¼ Linuxï¼ˆLinux on Embedded Systemï¼‰ åµŒå…¥å¼ç³»ç»Ÿï¼ˆEmbedded Systemï¼‰ï¼Œæ˜¯æŒ‡åµŒå…¥æœºæ¢°æˆ–ç”µæ°”ç³»ç»Ÿå†…éƒ¨ã€å…·æœ‰ä¸“ä¸€åŠŸèƒ½å’Œå®æ—¶è®¡ç®—æ€§èƒ½çš„è®¡ç®—æœºç³»ç»Ÿã€‚ å•ç‰‡æœºç©å¤Ÿäº†åï¼Œå°±å¯ä»¥å¼€å§‹ç©åµŒå…¥å¼ Linuxäº†ã€‚ ä»‹ç»ï¼šåµŒå…¥å¼ Linuxï¼Œå³è¿è¡Œ Linux æ“ä½œç³»ç»Ÿçš„ã€æ€§èƒ½æ¯” MCU æ›´é«˜çš„å¾®å‹è®¡ç®—æœºï¼Œè¡Œä¸šä¸Šæœ€å¸¸ç”¨ ARM Cortex-A5X ç³»åˆ—èŠ¯ç‰‡ä¸ Linux å¼€å‘ä¸€äº›åµŒå…¥å¼è®¾å¤‡ã€‚ åº”ç”¨ï¼šè·¯ç”±å™¨ã€ç”µè§†ç›’å­ã€æ™ºèƒ½å®¶å±…ç­‰ã€‚åœ¨ç¡¬ä»¶çˆ±å¥½è€…æ‰‹é‡Œå¯ä»¥ç”¨æ¥åšè®¡ç®—æœºè§†è§‰æ§åˆ¶å°è½¦ã€WiFiã€è“ç‰™æ§åˆ¶ä¸­æ¢ç­‰ç­‰ã€‚ å…¸å‹äº§å“ Raspberry Pi: ä½¿ç”¨ ARM Cortex-A ç³»åˆ— CPU çš„å¾®å‹è®¡ç®—æœºï¼Œç¤¾åŒºåºå¤§ï¼Œç”Ÿæ€ä¸°å¯Œã€‚ å…¶ä»–å„ç§å›½äº§æ´¾ï¼Œå¦‚åŸºäºç‘èŠ¯å¾® RK35XX ç³»åˆ— SoC çš„ OrangePiã€RockPiã€é‡ç«é²ç­çŒ«ç­‰ï¼Œå®ƒä»¬éƒ½æ¯”ç°åœ¨çš„æ ‘è“æ´¾ä¾¿å®œå¾ˆå¤šï¼ˆ2023 å¹´çš„ 4B 2G å…¨æ–°è¦ 1000+ å¤ªææ€–äº†ï¼‰ï¼Œæ€§èƒ½ä¹Ÿæ›´é«˜ï¼Œç”Ÿæ€å·®ä¸€äº›ä¸è¿‡ç‘•ä¸æ©ç‘œã€‚ STM32/IMX6ULL ä¹Ÿæœ‰ç›¸å…³äº§å“ è¡¥å……è¯´æ˜ åµŒå…¥å¼ Linux ä»£ç çš„å¯ç§»æ¤æ€§ç›¸å¯¹è¦å¥½å¾ˆå¤šï¼Œå› ä¸ºç¡¬ä»¶ç›¸å…³çš„é€»è¾‘éƒ½å°è£…åœ¨é©±åŠ¨å±‚äº†ã€‚ æˆ‘ç›®å‰çš„å­¦ä¹ é¡ºåºä¸è¿›åº¦ï¼š ç‘èŠ¯å¾® RK3588s ç³»åˆ—å›½äº§æ´¾: æ€§èƒ½è´¼å¼ºï¼Œè¿˜è‡ªå¸¦ NPU(2TOPS * 3) ç©è€çš„ç¬”è®°ä»£ç æ”¾åœ¨äº†è¿™é‡Œï¼ˆPython ä¸ C è¯­è¨€ï¼‰electrical-engineering/rk3588 ä¹Ÿç”¨å®ƒç©ä¸Šäº† NixOS: ryan4yin/nixos-rk3588 æ ‘è“æ´¾ 4B: ç©è€ç¬”è®°ä¸ä»£ç ï¼šelectrical-engineering/raspberrypi å…¶ä»– é™¤äº†å‰é¢ä¿©ï¼Œè¿˜å…œå…œè½¬è½¬ç©äº†å¾ˆå¤šæ–°äº§å“ï¼Œç¬”è®°éƒ½å†™åœ¨è¿™é‡Œé¢äº†ï¼šelectrical-engineering MAIX-III AXera-Pi AX620Aï¼ˆçˆ±èŠ¯æ´¾ï¼‰ï¼Œ1.8TOPS ç®—åŠ›ï¼ˆæ ‡ç§° 3.6TOPS çš„ä¸€åŠä¸èƒ½ç”¨äº AIï¼‰ è¿™å—æ¿å­çš„ NPU æ„Ÿè§‰æ€§èƒ½è¿˜å¯ä»¥ï¼Œä½†æ˜¯ CPU è·Ÿ IO éƒ½æœ‰ç‚¹æ‹‰ï¼Œè·‘ä¸ª pip3 list éƒ½è¦å¡è€åŠå¤©ã€‚æ¯•ç«Ÿ A7 å†…æ ¸ï¼Œä¼°è®¡æ€§èƒ½ä¹Ÿå°±è¿™æ ·äº†ï¼Œå…¨é äº¤å‰ç¼–è¯‘ç»­å‘½ã€‚ æ²¡å•¥å¼€æºèµ„æ–™ï¼Œåªé€‚åˆç”¨æ¥ç©ç© AIï¼ŒLinux ç³»ç»Ÿæ²¡å•¥å¯ç©æ€§ã€‚ é²ç­çŒ« 0 æ— çº¿ç‰ˆï¼ˆLubanCat Zero Wï¼‰ åŸºäº RK3566ï¼Œå¼€æ”¾çš„èµ„æ–™éå¸¸å…¨ï¼ŒåŒ…å« SoC åŸå‚çš„å„ç§æ–‡æ¡£ã€SDK é©±åŠ¨å¼€å‘åŒ…ã€æ ¸å¿ƒæ¿å°è£…åº“ï¼Œè¿˜æä¾›è®¸å¤šå…è´¹çš„åœ¨çº¿æ–‡æ¡£ï¼Œå†…å®¹åŒ…å« Linux å†…æ ¸ç¼–è¯‘éƒ¨ç½²ã€Linux é©±åŠ¨å¼€å‘ã€åµŒå…¥å¼ QT å¼€å‘ç­‰ç­‰ å› ä¸ºèµ„æ–™å¾ˆå…¨ï¼Œç”¨æ¥å­¦ Linux å†…æ ¸é©±åŠ¨å¼€å‘æ„Ÿè§‰æ˜¯æ¯”è¾ƒåˆé€‚çš„ã€‚ çŸ½é€Ÿç§‘æŠ€çš„ LicheePi 4Aï¼Œå›½äº§é«˜æ€§èƒ½ RISC-V å¼€å‘ç‰ˆã€‚ å·²ç»ç”¨å®ƒç©ä¸Šäº† NixOS:ryan4yin/nixos-licheepi4a ç¾¤æ˜Ÿé—ªè€€å®¶çš„ Milk-V Marsï¼ŒåŒæ ·æ˜¯å›½äº§é«˜æ€§èƒ½ RISC-V å¼€å‘ç‰ˆï¼Œä¸è¿‡æ¯” LicheePi 4A å¼±ä¸€äº› ï¼ˆä»·æ ¼ä½å¥½å¤šå“ªï¼‰ã€‚ ç”¨çš„æ˜¯èµ›æ˜‰å®¶çš„ JH7100 èŠ¯ç‰‡ï¼Œç”¨ Nick_Cao è€å¸ˆçš„ä»£ç è·‘äº† NixOS ç©ã€‚ åæ§½ï¼šå®ƒå®¶è¿™åå­—æ˜¯ä¼šå–çš„ï¼Œä¸è®ºæ˜¯ã€Œç¾¤æ˜Ÿé—ªè€€ã€è¿˜æ˜¯ã€ŒMilk-Vã€éƒ½å¾ˆæœ‰æ„æ€ å…¶ä»–æˆ‘æ„Ÿå…´è¶£çš„èµ„æ–™ï¼ˆèµ„æ–™å†…å®¹æœ‰ä¸€å®šçš„é‡å ï¼‰ï¼š ã€ŠLinux/Unix ç³»ç»Ÿç¼–ç¨‹æ‰‹å†Œã€‹ï¼šè®²è§£ Linux çš„ä¸»è¦ç³»ç»Ÿ API é‡ç«åµŒå…¥å¼ Linux ç³»åˆ—æ•™ç¨‹ï¼š åŸºç¡€ä½¿ç”¨ + å†…æ ¸ç¼–ç¨‹ï¼š æ„Ÿè§‰è·Ÿã€ŠLinux/Unix ç³»ç»Ÿç¼–ç¨‹æ‰‹å†Œã€‹å†…å®¹æ˜¯é‡å¤çš„ï¼Œå¯ä»¥ç®€å•è¿‡ä¸€è¿‡ Linux é•œåƒæ„å»ºä¸éƒ¨ç½²: è·Ÿéšæ­¤æ–‡æ¡£è‡ªå·±æ„å»ºä¸€ä¸ª Linux é•œåƒéƒ¨ç½²åˆ°æ¿å¡ä¸Šï¼Œè¿™æ ·å¯ä»¥æ›´å¥½çš„ç†è§£ Linux çš„å¯åŠ¨è¿‡ç¨‹ Linux é©±åŠ¨å¼€å‘å…¥é—¨ - åŸºäºé²ç­çŒ« RK356X ç³»åˆ—æ¿å¡: Linux é©±åŠ¨å¼€å‘å…¥é—¨æ•™ç¨‹ã€‚ Linux Device Driver Development - Second Edition: Linux é©±åŠ¨ç¼–ç¨‹å…¥é—¨ï¼Œ2022 å¹´å‡ºçš„æ–°ä¹¦ï¼ŒåŸºäº Linux 5.10ï¼Œamazon ä¸Šè¯„ä»·ä¸é”™ï¼Œç›®å‰åªæœ‰è‹±æ–‡ç‰ˆï¼Œå†™çš„å¾ˆå¥½ï¼Œå¯¹æ–°æ‰‹å¾ˆå‹å¥½ã€‚å†…å®¹è·Ÿé‡ç«çš„æ•™ç¨‹å·®ä¸å¤šï¼Œå¯ä»¥å¯¹ç…§å­¦ä¹ ã€‚ å¦å¤–è¿˜æœ‰æœ¬ 2018 å¹´å‡ºçš„Linux Driver Development for Embedded Processors 2nd Edition å¯å½“ä½œå‚è€ƒä¹¦çœ‹ï¼Œå†™å¾—æ²¡ä¸Šé¢é‚£æœ¬å¥½ã€å†…å®¹ä¹Ÿæ²¡é‚£ä¹ˆæ–°ï¼Œä½†æ˜¯çœ‹è¯„ä»·ä¹Ÿä¸é”™ï¼Œç‰¹ç‚¹æ˜¯æœ‰è®¸å¤šçš„ Lab å¯åšã€‚ Linux Kernel Programming: A comprehensive guide to kernel internals: Linux å†…æ ¸ç¼–ç¨‹é¢†åŸŸçš„æ–°ä¹¦ï¼Œé€‚åˆå…¥é—¨ Linux å†…æ ¸ï¼Œamazon ä¸Šè¯„ä»·æŒºå¥½ï¼Œå…ˆæ”¶è—ä¸€ä¸ª å—äº¬å¤§å­¦ è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯ç³» è®¡ç®—æœºç³»ç»ŸåŸºç¡€ è¯¾ç¨‹å®éªŒ (PA) Understanding the Linux Kernel, 3rd Editionï¼šLinux å†…æ ¸æŠ€æœ¯è¿›é˜¶ã€‚ åµŒå…¥å¼ Linux é¢†åŸŸç›®å‰ä¹Ÿä»ç„¶æ˜¯ ARM æ¶æ„çš„å¤©ä¸‹ï¼Œä½†æ˜¯å¼€æºå…è´¹çš„ RISC-V æ¶æ„å‘å±•ä¹Ÿå¾ˆå¿«ï¼Œæ€§èƒ½è¶Šæ¥è¶Šå¼ºï¼Œç”Ÿæ€è¶Šæ¥è¶Šå¥½ï¼Œå¾ˆå€¼å¾—æœŸå¾…ã€‚ ","date":"2023-01-31","objectID":"/posts/electrical-engineering-circuits-basics-1/:6:2","series":["EE å…¥é—¨"],"tags":["ç”µå­ç”µè·¯","Electrical Engineering","MCU"],"title":"EE å…¥é—¨ï¼ˆä¸€ï¼‰ - ç”µå­ç”µè·¯åŸºç¡€çŸ¥è¯†","uri":"/posts/electrical-engineering-circuits-basics-1/#2-åµŒå…¥å¼-linuxlinux-on-embedded-system"},{"categories":["tech"],"content":" å…¶ä»–æœ€è¿‘ä¹Ÿæ•´äº†ç‚¹ FPGA ç©ï¼Œå­¦äº†ç‚¹ Verilog è¯­è¨€ï¼Œæµ…å°è¾„æ­¢ï¼Œåšäº†ç‚¹ç¬”è®°ï¼š ee/fpga ","date":"2023-01-31","objectID":"/posts/electrical-engineering-circuits-basics-1/:7:0","series":["EE å…¥é—¨"],"tags":["ç”µå­ç”µè·¯","Electrical Engineering","MCU"],"title":"EE å…¥é—¨ï¼ˆä¸€ï¼‰ - ç”µå­ç”µè·¯åŸºç¡€çŸ¥è¯†","uri":"/posts/electrical-engineering-circuits-basics-1/#å…¶ä»–"},{"categories":["tech"],"content":" ç¤¾åŒºå…¬ä¼—å·æ”¶è—å•çº¯ä¸€ä¸ªäººåŸ‹å¤´è‡ªå­¦æœªå…å¤ªè¿‡æ¯ç‡¥ï¼Œæ•ˆç‡ä¹Ÿä¸ä¸€å®šé«˜ï¼Œå¶å°”ä¹Ÿå¯ä»¥é€›é€›å„ç§ç¤¾åŒºã€çœ‹çœ‹ç›¸å…³çš„æŠ€æœ¯åšå®¢ã€æ–‡ç« ï¼Œæ˜¯ä¸€ä¸ªæ›´ä¸°å¯Œçš„ä¿¡æ¯æºã€‚ æˆ‘æ”¶é›†çš„ä¸€äº›ç›¸å…³è®ºå›ã€å…¬ä¼—å·ã€äº¤æµç¾¤æ€»ç»“åœ¨äº†è¿™é‡Œï¼Œå¯ä¾›å‚è€ƒï¼š å¯ä»¥ç»™æˆ‘æ¨èå‡ ä¸ªç›¸å…³çš„è®ºå›æˆ–è€…å¾®ä¿¡å…¬ä¼—å·å—ï¼Ÿ - çŸ¥ä¹ ","date":"2023-01-31","objectID":"/posts/electrical-engineering-circuits-basics-1/:8:0","series":["EE å…¥é—¨"],"tags":["ç”µå­ç”µè·¯","Electrical Engineering","MCU"],"title":"EE å…¥é—¨ï¼ˆä¸€ï¼‰ - ç”µå­ç”µè·¯åŸºç¡€çŸ¥è¯†","uri":"/posts/electrical-engineering-circuits-basics-1/#ç¤¾åŒºå…¬ä¼—å·æ”¶è—"},{"categories":["tech"],"content":" æœ€åç®€å•æ€»ç»“ä¸‹ä¸Šé¢è¿™äº›éƒ½å­¦äº†ä¸€éçš„è¯ï¼Œä¸šä½™ç©ç©ç¡¬ä»¶åº”è¯¥å°±å¾ˆå¤Ÿç”¨äº†ï¼ŒæœŸå¾…æˆ‘å®Œæˆè¿™ä¸ªå­¦ä¹ è·¯çº¿çš„é‚£ä¸€å¤©â€¦ ","date":"2023-01-31","objectID":"/posts/electrical-engineering-circuits-basics-1/:9:0","series":["EE å…¥é—¨"],"tags":["ç”µå­ç”µè·¯","Electrical Engineering","MCU"],"title":"EE å…¥é—¨ï¼ˆä¸€ï¼‰ - ç”µå­ç”µè·¯åŸºç¡€çŸ¥è¯†","uri":"/posts/electrical-engineering-circuits-basics-1/#æœ€åç®€å•æ€»ç»“ä¸‹"},{"categories":["life","tech"],"content":" é—²è¨€ç¢è¯­æ˜¯çš„åˆè¿‡å»ä¸€å¹´ï¼Œåˆåˆ°äº†ä¸€å¹´ä¸€åº¦çš„ä¼ ç»ŸèŠ‚ç›®â€”â€”å¹´ç»ˆæ€»ç»“æ—¶é—´ã€‚ ","date":"2023-01-02","objectID":"/posts/2022-summary/:1:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"2022 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2022-summary/#é—²è¨€ç¢è¯­"},{"categories":["life","tech"],"content":" 2022 å¹´æµæ°´è´¦å…ˆç®€å•è¿‡ä¸€ä¸‹æˆ‘ 2022 å¹´çš„æµæ°´è´¦ï¼ˆæœ‰è®°å½•ä¸€ä¸ª /historyï¼Œå›é¡¾èµ·æ¥å°±æ˜¯æ–¹ä¾¿ï¼‰ï¼š 1 æœˆ è´­å…¥ Synthesizer V + é’æº¯ AI å£°åº“ï¼Œç®€å•è°ƒäº†å‡ é¦–æ­Œè¯•è¯•ï¼Œæ•ˆæœéå¸¸æ£’ã€‚ç„¶åå°±ä¸€ç›´æ”¾äº†ä¸€å¹´æ²¡ç¢°å®ƒâ€¦è¿˜è¯•ç”¨äº†å…è´¹çš„ ACE è™šæ‹Ÿæ­Œå§¬ï¼Œåˆæˆæ•ˆæœç¡®å®å¾ˆå¼ºï¼Œè·Ÿæ”¶è´¹çš„ Synthesizer V æœ‰çš„ä¸€æ‹¼ã€‚ åœ¨å®¶è¿‡æ˜¥èŠ‚ï¼Œç»™å®¶é‡ŒäºŒæ¥¼è£…äº†ç©ºè°ƒã€åŠ æ¹¿å™¨è·Ÿåœ°å«ã€‚ä½†æ˜¯æ²¡ä¹°åœ°æš–å«ï¼Œå¯¼è‡´å¼€äº†ç©ºè°ƒååœ°ä¸Šçš„å«å­å†°å‡‰ã€‚åé¢è¡¥ä¹°äº†åœ°æš–å«ä½†æ˜¯å·²ç»è¦ä¸Šç­äº†æ²¡ä½“éªŒä¸Šã€‚ 2 æœˆè·Ÿ 3 æœˆ æƒ³å­¦ä¸‹åŒºå—é“¾æŠ€æœ¯ï¼Œç»“æœå‘ç°è¯¾ç¨‹ä¸€å¼€å§‹å°±è®²åŠ å¯†å“ˆå¸Œå‡½æ•°çš„åŸºæœ¬æ€§è´¨ï¼Œå°±å†³å®šå…ˆæä¸€æ³¢å¯†ç å­¦ï¼Œ ç»“æœå°±æ˜¯è¾“å‡ºäº†ä¸€ä¸ªã€Šå†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ã€‹ç³»åˆ—æ–‡ç« ï¼Œ å†…å®¹å¤§éƒ¨åˆ†æ˜¯ç¿»è¯‘çš„ï¼Œå°‘éƒ¨åˆ†æ˜¯æˆ‘è‡ªå·±è¡¥å……ã€‚ ä¸»è¦å·¥ä½œï¼šè·Ÿæ¨èç³»ç»Ÿå¤§ä½¬ä¸€èµ·å°†æœåŠ¡ä» HTTP åˆ‡æ¢åˆ° gRPCï¼Œæ•ˆæœç«‹ç«¿è§å½±ï¼ŒæœåŠ¡æµé‡ä¸‹é™ 50% ~ 60%ï¼Œå»¶è¿Ÿä¸‹é™ 30% ~ 50%ã€‚ 4 æœˆä»½ è¯»å®Œäº† Mastering Ethereumï¼Œå¯¹ä»¥å¤ªåŠæœ‰äº†åŸºæœ¬çš„äº†è§£ã€‚ è¯»äº†ã€ŠGo ç¨‹åºè®¾è®¡è¯­è¨€ï¼ˆè‹±æ–‡ç‰ˆï¼‰ã€‹ Go ç¨‹åºè®¾è®¡è¯­è¨€ï¼ˆè‹±æ–‡ç‰ˆï¼‰ 2022-08-19 è¡¥å›¾ å¾ˆé«˜å…´é€šè¿‡äº†èŒçº§æ™‹å‡ï¼Œä¸å†æ˜¯ SRE èŒæ–°äº†ã€‚ ä¸»è¦å·¥ä½œï¼šä½¿ç”¨ aws/karpenter å®ç°ç¦»çº¿è®¡ç®—é›†ç¾¤çš„å¼¹æ€§æ‰©ç¼©å®¹ï¼Œçœäº†ä¸€æ³¢æˆæœ¬ã€‚ 5 æœˆä»½ ä¸»è¦æ˜¯å­¦å®Œäº†ã€Šæ·±å…¥æµ…å‡º Kubernetesã€‹è¿™ä¸ªæå®¢æ—¶é—´ä¸“æ  é€šè¿‡ã€Šåˆ†å¸ƒå¼åè®®ä¸ç®—æ³•å®æˆ˜ã€‹ç­‰ç›¸å…³èµ„æ–™ç®€å•äº†è§£äº†ä¸‹åˆ†å¸ƒå¼å…±è¯†ç®—æ³•çš„åŸç†ï¼Œè®°å½•äº†äº›ç¬”è®°ï¼Œ8 æœˆä»½çš„æ—¶å€™æŠŠç¬”è®°æ•´ç†è¾“å‡ºä¸ºäº†ä¸€ç¯‡åšå®¢åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€è‡´æ€§é—®é¢˜ä¸å…±è¯†ç®—æ³• è¿˜è¯»äº†è®¸å¤šç¤¾åŒºçš„åŒºå—é“¾ç›¸å…³èµ„æ–™ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºWeb 3.0ï¼šç©¿è¶Šåå¹´çš„è®¨è®º - çŸ¥ä¹ã€ã€ŠWeb3 DApp æœ€ä½³ç¼–ç¨‹å®è·µæŒ‡å—ã€‹ã€dcbuild3r/blockchain-development-guide å› ä¸º AI å‘å±•è¿…çŒ›ï¼Œæ¥äº†ä¸‰åˆ†é’Ÿå…´è¶£å­¦äº†ä¸€ç‚¹åŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹  - Pytorch ç‰ˆï¼Œä½†æ˜¯è¿›åº¦æ¡èµ°äº†ä¸åˆ° 15% å°±ä¸äº†äº†ä¹‹äº†ã€‚ ä¸»è¦å·¥ä½œï¼šç ”ç©¶è·¨äº‘åº”ç”¨éƒ¨ç½²æ–¹æ¡ˆä¸è·¨äº‘ kubernetes ç½‘ç»œæ–¹æ¡ˆï¼Œå¦‚ karmada/kubevela/istioï¼Œ ä»¥åŠ L4/L7 å±‚çš„å¼€æº/å•†ä¸šç½‘å…³æ–¹æ¡ˆ 6 æœˆä»½ è¯»å®Œäº†ã€Šåœ¨ç”Ÿå‘½çš„å°½å¤´æ‹¥æŠ±ä½ -ä¸´ç»ˆå…³æ€€åŒ»ç”Ÿæ‰‹è®°ã€‹ è¯»äº†ä¸€ç‚¹ä¹°çš„æ–°ä¹¦ï¼šã€Šè¯­è¨€å­¦çš„é‚€è¯·ã€‹è·Ÿã€ŠIntimate Relationshipã€‹ 7 æœˆä»½ ä¸»è¦å·¥ä½œï¼šç¡®å®šå¹¶å®æ–½ç½‘å…³æ¶æ„ä¼˜åŒ–çš„åˆæ­¥æ–¹æ¡ˆï¼Œä½¿ç”¨ Go è¯­è¨€å†™äº†ä¸€ä¸ª Nginx Gateway æ§åˆ¶å™¨ï¼Œè¿ç§»æµé‡åˆ°æ–°å®¹å™¨åŒ–ç½‘å…³çœäº†ä¸€æ³¢æˆæœ¬ã€‚ 8 æœˆ è¯»å®Œäº†ã€Šåœ¨å³¡æ±Ÿçš„è½¬å¼¯å¤„ - é™ˆè¡Œç”²äººç”Ÿç¬”è®°ã€‹ é™ˆè¡Œç”²äººç”Ÿç¬”è®° å»¶ç»­ä¸Šä¸ªæœˆå¯¹ Linux ç³»ç»Ÿçš„å…´è¶£ï¼Œå¿«é€Ÿè¿‡äº†ä¸€é The ANSI C Programming Language ä»¥ç†Ÿæ‚‰ C çš„è¯­æ³•ï¼Œä¹‹åå¼€å§‹é˜…è¯» Linux/Unix ç³»ç»Ÿç¼–ç¨‹æ‰‹å†Œï¼ˆä¸Šå†Œï¼‰ å†™äº†ä¸€ä¸ªå°é¡¹ç›® video2ascii-c ç»ƒæ‰‹ C è¯­è¨€ã€‚ The ANSI C Programming Language å› ä¸ºä»Šå¹´æç½‘å…³ APISIX/Nginx æ¥è§¦æ¯”è¾ƒå¤šï¼Œçœ‹äº†ä¸€ç‚¹æå®¢æ—¶é—´ã€ŠOpenResty ä»å…¥é—¨åˆ°å®æˆ˜ã€‹ä½†æ˜¯å› ä¸ºå…´è¶£å¹¶ä¸å¼ºçƒˆï¼Œåˆä¸äº†äº†ä¹‹äº†ã€‚ ä¸»è¦å·¥ä½œï¼š æç½‘å…³ä¼˜åŒ–çœäº†ä¸€æ³¢æˆæœ¬ï¼Œä½†æ˜¯æœŸé—´ä¹Ÿæå‡ºä¸€ä¸ªä¸¥é‡æ•…éšœâ€¦ æ‰¿æ¥äº†ä¸€ä¸ªæ•°æ®ä¸ŠæŠ¥ç½‘å…³çš„éœ€æ±‚ï¼Œéœ€è¦åœ¨ç½‘å…³å±‚æ”¯æŒä¸€äº›ç¨å¾®å¤æ‚ç‚¹çš„åŠŸèƒ½ç¡®ä¿å‡çº§æµç¨‹çš„ç¨³å®šæ€§ã€‚è·Ÿ APISIX å®˜æ–¹æ²Ÿé€šåå¾—åˆ°äº†æ¯”è¾ƒå¥½çš„è§£å†³æ–¹æ¡ˆcustom plugin - set an upstream as a http fallback server 9 æœˆ å¶ç„¶å‘ç°æ‰‹æœºæ¡Œé¢ä¸Šæœ‰ä¸€ä¸ªå®‰è£…äº†å¥½ä¹…ä½†æ˜¯ä¸€ç›´æ²¡ç”¨è¿‡çš„ APP è‹±è¯­æµåˆ©è¯´ï¼Œé¡ºæ‰‹ç”¨å®ƒæµ‹äº†ä¸‹è‡ªå·±çš„è‹±æ–‡æ°´å¹³ã€‚ç„¶åå°±å¯¹è‹±è¯­æ„Ÿå…´è¶£äº†ï¼Œåˆ¶å®šäº†è‹±è¯­å­¦ä¹ è®¡åˆ’å¹¶å‘å¸ƒå¯¹åº”çš„åšæ–‡Learn English Againï¼Œç„¶åå°±å¼€å§‹åšæŒå­¦è‹±è¯­ï¼Œæ„Ÿè§‰æ•´ä¸ªè¿‡ç¨‹éƒ½å¾ˆé¡ºåˆ©ã€‚ ä¸»è¦å·¥ä½œï¼š ä»ç„¶æ˜¯æç½‘å…³ä¼˜åŒ–çœæˆæœ¬ï¼Œå› ä¸ºå„ç§åŸå› ï¼Œå†æ¬¡è¾“å‡ºä¸€ç¯‡ Post Mortem ææ•°æ®ä¸ŠæŠ¥ç½‘å…³çš„éœ€æ±‚ 10 æœˆ æ‰¾äº†å¾ˆå¤šè‹±è¯­å­¦ä¹ èµ„æ–™ï¼Œé€šè¿‡æ¯æ—¥çš„åšæŒå­¦ä¹ ï¼Œæ¸æ¸æ‰¾åˆ°äº†è‡ªå·±çš„è‹±è¯­å­¦ä¹ èŠ‚å¥ï¼Œå®Œå–„äº†å­¦ä¹ è§„åˆ’ã€‚ ã€ŠLinux/Unix ç³»ç»Ÿç¼–ç¨‹æ‰‹å†Œï¼ˆä¸Šå†Œï¼‰ã€‹é˜…è¯»è¿›åº¦è¿‡åŠï¼Œä½†æ˜¯ä¸šä½™æ—¶é—´å°±è¿™ä¹ˆç‚¹ï¼ŒåŒæ—¶ç”¨æ¥å­¦ä¹  Linux è·Ÿè‹±è¯­å®åœ¨æœ‰ç‚¹åƒåŠ›ï¼Œè¿™æœ¬ä¹¦çš„é˜…è¯»å°±æ…¢æ…¢æ”¾ä¸‹äº†ã€‚ Linux/Unix ç³»ç»Ÿç¼–ç¨‹æ‰‹å†Œï¼ˆä¸Šå†Œï¼‰ é€šè¿‡å‹é“¾æ¼«æ¸¸ï¼Œå‘ç°äº† 0xFFFF ç¤¾åŒºï¼Œå†…å®¹è´¨é‡å¾ˆé«˜ï¼Œä¹Ÿåœ¨ç¤¾åŒºçš„ QQ ç¾¤é‡Œè·Ÿç¾¤å‹ä»¬èŠäº†äº›æœ‰æ„æ€æœ‰ä»·å€¼çš„å†…å®¹ã€‚ æ‰“æ¸¸æˆå­¦è‹±è¯­è¶…é£’çš„é‡å‰‘å¥³ä»† Noelle DEEMO 2 ä¸­ä¸°å¯Œçš„å¯¹è¯å†…å®¹ å› ä¸ºè®¸å¤šåŸå› ï¼Œä¸­æ¦‚è‚¡å¤§è·Œï¼Œå…¬å¸æ¶æ„å¤§è°ƒæ•´ï¼Œèµ°äº†å¾ˆå¤šå¤§ä½¬ï¼ŒåŒ…æ‹¬å»å¹´å¸¦æˆ‘å†²æµªçš„ç®—æ³•éƒ¨é—¨å‰è¾ˆã€‚ ä¸»è¦å·¥ä½œ ææ•°æ®ä¸ŠæŠ¥ç½‘å…³çš„éœ€æ±‚ï¼Œä¸€è·¯è¸©å‘ï¼Œæ€»ç®—æŠŠæ•°ä¸‡ QPS çš„æµé‡å…¨éƒ¨è¿ç§»åˆ°æ–°ç½‘å…³ä¸Šäº†ã€‚ 11 æœˆ é‡æ–°å¯¹æ Homelab äº§ç”Ÿäº†å…´è¶£ï¼Œä¹°äº†ä¸‰å° MINI ä¸»æœºç»„äº†ä¸€ä¸ª Homelabï¼Œæ—¶éš”ä¸€å¹´å¤šåˆå¼€å§‹æŠ˜è…¾ Proxmox VEï¼Œåšå„ç§è§„åˆ’ã€‚ è¿­ä»£äº†å¾ˆå¤šæ¬¡åçš„ä¸ªäºº Homelab æ–‡æ¡£ï¼šryan4yin/knowledge/homelab æˆ‘çš„ Homelab å¯¼èˆªé¡µ 2022-11-12 å› ä¸ºä¸šä½™æ—¶é—´æ²‰è¿·æ Homelabï¼Œè‹±è¯­æ‰“å¡å°±å˜å¾—æ–­æ–­ç»­ç»­äº†â€¦ä½†æ˜¯è¯æ±‡é‡æµ‹è¯•çš„æ•ˆæœå‡ºä¹æ„æ–™ï¼Œ è¿›æ­¥é€Ÿåº¦å–œäººï¼Œé˜…è¯»èƒ½åŠ›ä¹Ÿèƒ½æ„Ÿè§‰åˆ°æœ‰æ˜æ˜¾æå‡ã€‚ æœˆåº•æ¬å®¶æ¢äº†ä¸ªæ–°ç§Ÿæˆ¿ï¼ŒåºŠæ˜¯æŒ‚å¤©èŠ±æ¿ä¸Šçš„ï¼Œæˆ¿é—´å°±å®½æ•äº†å¾ˆå¤šï¼Œè€Œä¸”æ‹‰äº†ç‹¬ç«‹çš„ç”µä¿¡å®½å¸¦ï¼Œç½‘é€Ÿæ æ çš„ã€‚ 11/25 å»ä¸œèæ¾å±±æ¹–è·Ÿé«˜ä¸­åŒå­¦èšä¼šï¼Œç„¶åè·Ÿå‡ ä½åŒå­¦æ‰“éº»å°†æ‰“åˆ°åŠå¤œä¸‰ç‚¹å¤šâ€¦ è¿˜è¿œè¿œçœºæœ›äº†çœ¼åŒå­¦è¯»åšçš„åœ°æ–¹â€”â€”ã€Œä¸­å›½æ•£è£‚ä¸­å­æºã€ï¼Œæ„Ÿè§‰å¾ˆé«˜å¤§ä¸Š ä¸»è¦å·¥ä½œï¼šç»§ç»­æ¨è¿›çº¿ä¸Šç½‘å…³ä¼˜åŒ–é¡¹ç›®ï¼Œä»¥åŠè°ƒç ” K8s / Istio çš„æ–°ç‰ˆæœ¬å˜åŒ–ï¼Œä¸ºé›†ç¾¤å‡çº§åšé¢„å¤‡å·¥ä½œã€‚ 12 æœˆ ä» Homelab æŠ˜è…¾åˆ° HomeAssistant/ESPHomeï¼Œç„¶åå°±æŠ˜è…¾ ESP32/ESP8266ï¼Œç»“æœå¾ˆæ„å¤–åœ°å°±ä¹°äº†ä¸€å †ç¡¬ä»¶ï¼Œå…¥æ‰‹äº†ç”µçƒ™é“çƒ­é£æªä¸‡ç”¨è¡¨ç­‰å„ç§ä»ªå™¨ï¼ŒESP/51/STM32 éƒ½ç©äº†ä¸ªéâ€¦ è¾“å‡ºå†…å®¹æœ‰ä¸¤ä¸ªä»£ç ä»“åº“ï¼šlearn-8051-asm ä¸ learn-stm32f103c8t6ï¼Œä»¥åŠä¸€ä»½ EE ç¬”è®°ï¼šElectrical Engineering æˆ‘çš„ç”µå­ç”µè·¯åˆä½“éªŒ 8051 æ±‡ç¼– - æ•°ç ç®¡æ˜¾ç¤º 2023 ChatGPT æ¨ªç©ºå‡ºä¸–ï¼Œå¼•å‘å…¨ç½‘çƒ­æ½®ã€‚æœ‰æŠ€æœ¯å¤§ä½¬æ„Ÿæ…¨ï¼Œè¿™ä¸ªæ—¶åˆ»ç«Ÿç„¶æ¥ä¸´å¾—å¦‚æ­¤ä¹‹å¿«ï¼ŒæƒŠå–œä¹‹ä½™ä¹Ÿæœ‰ç‚¹çŒä¸åŠé˜²ã€‚æˆ‘ä¹ŸæŠŠç©äº†ä¸€æ³¢ï¼Œä¹Ÿç”¨å®ƒå¸®åŠ©æˆ‘å­¦äº†è®¸å¤šç¡¬ä»¶ç›¸å…³çš„ä¸œè¥¿ï¼Œå¾ˆæœ‰å¸®åŠ©ã€‚ ä¸ªäººçŒœæµ‹æœªæ¥ ChatGPT æˆç†Ÿåå¤§æ¦‚ç‡èƒ½æå¤§æå‡æŠ€æœ¯äººå‘˜çš„å·¥ä½œæ•ˆç‡ï¼Œå¾ˆå¯èƒ½é—´æ¥å½±å“åˆ°è®¸å¤šäººçš„å·¥ä½œã€‚ å¹´åº•è¿˜å…¥æ‰‹äº†ä¸€å° 3D æ‰“å°æœº ELEGOO Neptune 3 Proâ€¦ å…¨å›½é€æ¸æ”¾å¼€ç–«æƒ…ç®¡æ§ï¼Œæˆ‘å¾—äº†æ–°å† ï¼Œç„¶ååº·å¤â€¦ è¿™ä¸ªæœˆæŠ˜è…¾ç¡¬ä»¶ï¼Œè‹±è¯­æ¼æ‰“å¡æ›´ä¸¥é‡äº†ï¼Œä½†æ˜¯è¯æ±‡é‡ä»ç„¶åœ¨ç¨³æ­¥å¢é•¿ï¼Œé˜…è¯»èµ·æ¥ä¹Ÿæ˜¯è¶Šæ¥è¶Šé¡ºç•…ã€‚ ä¸»è¦å·¥ä½œï¼š çº¿ä¸Šç½‘å…³ä¼˜åŒ–é¡¹ç›®åŸºæœ¬è½åœ°ï¼Œå–å¾—äº†é¢„æœŸæ”¶ç›Šï¼Œä½†æ˜¯æ²¡è¾¾åˆ°ä¹‹å‰è®¾çš„æ¿€è¿›ç›®æ ‡ã€‚ï¼ˆæ—§ç½‘å…³ä»ç•™å­˜æå°‘éƒ¨åˆ†æµé‡ï¼Œè¿˜éœ€è¦æ—¶é—´å»ç»Ÿä¸€ç½‘å…³æ¶æ„ï¼‰ åš K8s é›†ç¾¤å‡çº§å‡†å¤‡ï¼Œç„¶åæœˆåº•å…¬å¸å¤§é¢ç§¯æ–°å† ï¼Œæ‹–æ…¢äº†è¿™é¡¹å·¥ä½œçš„è¿›åº¦ï¼Œå³ä½¿åè°ƒäº†å‡çº§æ—¶é—´ï¼Œä»ç„¶æ„Ÿè§‰æœ‰ç‚¹è™šâ€¦ æœ€åæ˜¯è¿ç»­ä¸‰å¹´è‰è”æˆ‘å¹´åº¦æ­Œæ‰‹çš„å¤©ä¾åŒå­¦ï¼Œæˆªå›¾æ”¾è¿™é‡Œçºªå¿µä¸€ä¸‹ï¼š æˆ‘çš„ç½‘æ˜“äº‘å¹´åº¦æ­Œæ‰‹ ","date":"2023-01-02","objectID":"/posts/2022-summary/:2:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"2022 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2022-summary/#2022-å¹´æµæ°´è´¦"},{"categories":["life","tech"],"content":" 2022 å¹´ Highlights","date":"2023-01-02","objectID":"/posts/2022-summary/:3:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"2022 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2022-summary/#2022-å¹´-highlights"},{"categories":["life","tech"],"content":" 1. è‹±è¯­è‹±è¯­ä¹Ÿæ˜¯æˆ‘ä»Šå¹´æ¯”è¾ƒæƒŠå–œçš„ä¸€ä¸ªéƒ¨åˆ†ï¼Œå¾ˆé•¿ä¸€æ®µæ—¶é—´å†…ï¼Œæˆ‘éƒ½è§‰å¾—è‹±è¯­çš„ä¼˜å…ˆçº§å¹¶ä¸é«˜ï¼Œä¸€ç›´æ²¡æœ‰æŠŠå®ƒçš„å­¦ä¹ æ’ä¸Šæ—¥ç¨‹ï¼Œæ°´å¹³ä¹Ÿä¸€ç›´æ²¡å•¥æ˜¾è‘—æå‡ã€‚ ä½†æ˜¯ä»ä»Šå¹´ 9 æœˆä»½å¼€å§‹åˆ°ç°åœ¨è¿™å››ä¸ªæœˆçš„è‹±è¯­å­¦ä¹ ä¸­ï¼Œæˆ‘çš„è¿›æ­¥ç›¸å½“æ˜æ˜¾ï¼Œä»å»å¹´å¤§æ¦‚ 4700 è¯ï¼Œåˆ°ç°åœ¨æµ‹è¯•ç»“æœä¸º 6583 è¯ï¼Œæ¶¨äº†è¿‘ 2000 è¯ï¼Œæœˆå‡æ¥è¿‘ 500 è¯ï¼ˆæŒ‰è¿™ä¸ªé€Ÿåº¦ï¼Œ2023 å¹´ 10000 è¯çš„ç›®æ ‡å¥½åƒæ²¡å•¥éš¾åº¦äº†ï¼‰ã€‚ è¯æ±‡é‡æµ‹è¯•ç»“æœæŒ‰æ—¶é—´æ’åºå¦‚ä¸‹ï¼Œä½¿ç”¨çš„æµ‹è¯•å·¥å…·æ˜¯Test Your Vocabulary ï¼š 2023-01-02 è¯æ±‡é‡æµ‹è¯•ç»“æœï¼š6583 è¯ 2022-12-19 è¯æ±‡é‡æµ‹è¯•ç»“æœï¼š6300 è¯ 2022-11-17 è¯æ±‡é‡æµ‹è¯•ç»“æœï¼š5600 è¯ 2022-10-18 è¯æ±‡é‡æµ‹è¯•ç»“æœï¼š5100 è¯ å¦å¤–å› ä¸ºä¸»è¦æ˜¯é è¯»ä¹¦æ¥å­¦è‹±è¯­ï¼Œä»Šå¹´çš„è‹±æ–‡é˜…è¯»èƒ½åŠ›ä¹Ÿæœ‰æ˜æ˜¾æå‡ï¼Œè·Ÿ 9 æœˆä»½åˆšå¼€å§‹è¯»çš„æ—¶å€™æ¯”ï¼Œ é˜…è¯»ä½“éªŒè¦æµç•…å¤šäº†ã€‚ä¸€äº›è‹±æ–‡åŸç‰ˆä¹¦é˜…è¯»æˆå°±ï¼š åœ¨è–„è·é˜…è¯»ä¸Šè¯»å®Œçš„ç¬¬ä¸€æœ¬è‹±è¯­åŸç‰ˆä¹¦ è€Œå£è¯­ã€å†™ä½œè¿™äº›ä»Šå¹´åŸºæœ¬æ²¡ç»ƒä¹ ï¼ŒåŸåœ°è¸æ­¥ã€‚ ","date":"2023-01-02","objectID":"/posts/2022-summary/:3:1","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"2022 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2022-summary/#1-è‹±è¯­"},{"categories":["life","tech"],"content":" 2. ä¸šä½™æŠ€æœ¯ä»Šå¹´ä¸šä½™æçš„æŠ€æœ¯ï¼Œæ„Ÿè§‰è¿™äº›éƒ½æ˜¯æˆ‘æ¯”è¾ƒæ»¡æ„çš„ï¼š Web3: ä»Šå¹´ä¸ŠåŠå¹´èŠ±äº†ä¸å°‘æ—¶é—´å»äº†è§£ Web3ï¼Œä½†æ˜¯ä»ç„¶æ²¡æ•¢è¯´è‡ªå·±å·²ç»æ‡‚äº†å®ƒã€‚æ°´æ¯”è¾ƒæ·±ï¼Œæµ…å°è¾„æ­¢ã€‚ ç”µå­ç”µè·¯ï¼ˆç¡¬ä»¶ï¼‰ï¼šç‚¹äº®è¿™ä¸ªæŠ€èƒ½å®Œå…¨æ˜¯ä¸ªæ„å¤–â€¦ä½†ä¹ŸæŒºæƒŠå–œçš„ï¼Œæ¯•ç«Ÿæˆ‘å¤§å­¦å­¦çš„å»ºç­‘å£°å­¦ï¼Œä»¥å‰éƒ½æ²¡æ¥è§¦è¿‡ç¡¬ä»¶ã€‚ Go è¯­è¨€ï¼šå»å¹´åº•å®šçš„ç›®æ ‡æ˜¯å°† Go è¯­è¨€åº”ç”¨åœ¨è‡³å°‘ä¸¤ä¸ªé¡¹ç›®ä¸Šï¼Œå®é™…ä¸Šåªç”¨åœ¨äº†ä¸€ä¸ªé¡¹ç›®ä¸Šï¼Œå®Œæˆåº¦ 50% å§ã€‚ Linux: Linux ä»Šå¹´ä¸»è¦æ˜¯å¤ä¹ äº†ä¸€é C è¯­è¨€ï¼Œç„¶åçœ‹äº†åŠæœ¬ã€ŠLinux/Unix ç³»ç»Ÿç¼–ç¨‹æ‰‹å†Œï¼ˆä¸Šå†Œï¼‰ã€‹ï¼Œä¹‹åå› ä¸ºå­¦è‹±è¯­å°±ç»™æ”¾ä¸‹äº†ã€‚ æ¯•ç«Ÿè‹±è¯­çš„æˆæœå¾ˆä¸é”™ï¼Œè¿™ä¸ªç»“æœæˆ‘è§‰å¾—ä¹Ÿæ˜¯é¢„æœŸå†…çš„ã€‚ åšå®¢ï¼šä»Šå¹´åšå®¢ç»è¥å¾—å°šå¯ï¼Œæ•°äº†ä¸‹æœ‰ 18 ç¯‡æŠ€æœ¯å¹²è´§ï¼Œå››ç¯‡éæŠ€æœ¯æ–‡ç« ã€‚æœ€ä¸»è¦æ˜¯ä¸‰æœˆä»½ç¿»è¯‘å¯†ç å­¦çš„æ–‡ç« å†²äº†ä¸€æ³¢å†…å®¹é‡ã€‚è™½ç„¶ 12 æœˆä»½åˆé¸½æ‰äº†â€¦æ€»ä½“è¿˜æ˜¯æ»¡æ„çš„ã€‚ ","date":"2023-01-02","objectID":"/posts/2022-summary/:3:2","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"2022 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2022-summary/#2-ä¸šä½™æŠ€æœ¯"},{"categories":["life","tech"],"content":" 3. å·¥ä½œSRE ç»„ 2022 å¹´å·¥ä½œçš„ä¸»æ—‹å¾‹å…¶å®å°±æ˜¯çœé’±ï¼Œæˆ‘ 2022 å¹´çš„å·¥ä½œä¸Šæœ‰æ›´å¤šçš„æŒ‘æˆ˜ï¼Œä¸è¿‡å› ä¸ºå¾—å¿ƒåº”æ‰‹å¾ˆå¤šï¼Œåå€’æ²¡ä»€ä¹ˆæƒ³ç‰¹åˆ«ç€å¢¨æè¿°çš„äº†ã€‚ æˆ‘ä¸ŠåŠå¹´å·¥ä½œæˆæœæ¯”è¾ƒçªå‡ºï¼Œä¸‹åŠå¹´è™½ç„¶å·¥ä½œæˆæœå·®ä¸€äº›ï¼Œä½†æ˜¯ä¸šä½™çš„å­¦ä¹ æˆæœç›¸å½“çªå‡ºï¼Œæ€»ä½“å¾ˆæ»¡æ„è‡ªå·±ä»Šå¹´çš„æˆç»©ã€‚ å•çº¯ä»å·¥ä½œæ–¹é¢è®²ï¼Œæˆ‘ç»™è‡ªå·±çš„è¯„ä»·ä»ç„¶æ˜¯ã€Œè‰¯å¥½ã€ã€‚ ","date":"2023-01-02","objectID":"/posts/2022-summary/:3:3","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"2022 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2022-summary/#3-å·¥ä½œ"},{"categories":["life","tech"],"content":" 4. é˜…è¯»2022 å¹´ä¸€å…±è¯»å®Œäº†è¿™äº›ä¹¦ï¼š ã€Šäººé—´å¤±æ ¼ã€‹ ã€Šæœˆå®«ã€‹ ã€ŠPractical Cryptography for Developersã€‹ ã€ŠMastering Ethereumã€‹ ã€ŠGo ç¨‹åºè®¾è®¡è¯­è¨€ï¼ˆè‹±æ–‡ç‰ˆï¼‰ã€‹ ã€Šæ·±å…¥æµ…å‡º Kubernetes - å¼ ç£Šã€‹ ã€Šåœ¨ç”Ÿå‘½çš„å°½å¤´æ‹¥æŠ±ä½ -ä¸´ç»ˆå…³æ€€åŒ»ç”Ÿæ‰‹è®°ã€‹ ã€Šåœ¨å³¡æ±Ÿçš„è½¬å¼¯å¤„ - é™ˆè¡Œç”²äººç”Ÿç¬”è®°ã€‹ ã€ŠThe ANSI C Programming Languageã€‹ The Time Machine Learn Robotics With Raspberry Pi å­¦ä¹ ä½¿ç”¨æ ‘è“æ´¾æ§åˆ¶æ™ºèƒ½å°è½¦ï¼Œç»“åˆæœ¬ä¹¦ä¸ç½‘ä¸Šèµ„æ–™ï¼Œæˆ‘åˆ¶ä½œäº†ä¸€å°ä½¿ç”¨ Xbox One æ‰‹æŸ„é¥æ§çš„å››é©±å°è½¦ï¼Œç›¸å½“æœ‰æ„æ€~ Learn Robotics Programming, 2nd Edition è·Ÿå‰é¢é‚£æœ¬ä¸€æ ·æ˜¯è®²æ ‘è“æ´¾å°è½¦çš„ï¼Œä¸è¿‡è¿™æœ¬ä¹¦æ›´æ·±å…¥ï¼Œä»£ç å«é‡é«˜å¾ˆå¤šã€‚ å¿«é€Ÿç¿»äº†ä¸€éï¼Œè·³è¿‡äº†å…¶ä¸­å¤§éƒ¨åˆ†ä»£ç ï¼Œå› ä¸ºä¹¦ä¸­çš„å°è½¦ä¸å¤ªç¬¦åˆæˆ‘çš„éœ€æ±‚ã€‚ The Unlikely Pilgrimage of Harold Fry 51 å•ç‰‡æœºè‡ªå­¦ç¬”è®° çœ‹èµ·æ¥ï¼Œå»å¹´å®šçš„ä¸€ä¸ªæœˆè‡³å°‘è¯»ä¸€æœ¬ä¹¦çš„ç›®æ ‡ï¼Œè¿˜æ˜¯è¾¾æˆäº†æ»´~ ","date":"2023-01-02","objectID":"/posts/2022-summary/:3:4","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"2022 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2022-summary/#4-é˜…è¯»"},{"categories":["life","tech"],"content":" 2023 å¹´çš„å±•æœ›","date":"2023-01-02","objectID":"/posts/2022-summary/:4:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"2022 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2022-summary/#2023-å¹´çš„å±•æœ›"},{"categories":["life","tech"],"content":" æŠ€æœ¯ä¾§2022 å¹´çš„ç»“æœè·Ÿå¹´åˆçš„å±•æœ›åŒºåˆ«ä»ç„¶æ˜¯æŒºå¤§çš„ï¼Œä½†æ˜¯æˆ‘ä¸ªäººæŒºæ»¡æ„ã€‚ è¿™é‡Œå†è®°ä¸€ä¸‹ 2023 å¹´æŠ€æœ¯ä¸Šçš„å±•æœ›ï¼Œçœ‹çœ‹ä»Šå¹´èƒ½å®ç°å¤šå°‘ï¼Œåˆä¼šç‚¹å‡ºå¤šå°‘æ„æ–™ä¹‹å¤–çš„æŠ€èƒ½å§å“ˆå“ˆï¼š äº‘åŸç”Ÿ å»å¹´å®šçš„é˜…è¯» k8s åŠç›¸å…³ç”Ÿæ€çš„æºç æ²¡ä»»ä½•è¿›åº¦ï¼Œ2023 å¹´ç»§ç»­â€¦ 2019 å¹´åˆ°ç°åœ¨ï¼Œæˆ‘çš„å·¥ä½œæ—¶é•¿å·²ç»æœ‰ä¸‰å¹´åŠäº†ï¼Œå¸Œæœ›æ›´å¤šçš„ä¸œè¥¿èƒ½é€šè¿‡å­¦ä¹ åº•å±‚çŸ¥è¯†å»çŸ¥å…¶æ‰€ä»¥ç„¶ï¼Œè€Œä¸æ˜¯å…¨é ç½‘ä¸Šæ‰¾èµ„æ–™ï¼Œäººäº‘äº¦äº‘ä¸€çŸ¥åŠè§£åœ°å»è§£å†³é—®é¢˜ã€‚ Linux ä¸ç½‘ç»œ 2023 å¹´æŠŠã€ŠLinux/Unix ç³»ç»Ÿç¼–ç¨‹æ‰‹å†Œã€‹è¿™å¥—ä¹¦çœ‹å®Œï¼Œå¹¶ä¸”è¿‡å®Œ0xFFFF - MIT6.S081 Operating System Engineering (Fall 2020) è¿™ä¸ªè¯¾ï¼Œå¯¹ Linux å†…æ ¸ä¸æ“ä½œç³»ç»Ÿå½¢æˆè¾ƒæ·±å…¥çš„ç†è§£ã€‚ å€Ÿç€å¯¹ç¡¬ä»¶çš„å…´è¶£å­¦ä¸€å­¦ Linux é©±åŠ¨å¼€å‘ã€‚ å­¦ä¹ å­¦ä¹ æ—¶ä¸‹è¶…æµè¡Œçš„ eBPF æŠ€æœ¯ 3D æ‰“å° 2022 å¹´åº•ä¹°äº†å°æ‰“å°æœºï¼Œé‚£ä¸å¿…é¡»å¾—æ‰“å°ç‚¹è‡ªå·±è®¾è®¡çš„ä¸œè¥¿ï¼Ÿ FreeCAD å­¦ï¼Blender å¯èƒ½è·Ÿ 3D æ‰“å°æ²¡å•¥å…³ç³»ä½†æ˜¯ä¹Ÿè¦å­¦ï¼ ç¼–ç¨‹è¯­è¨€ ä»Šå¹´ Go/C ä¸¤ä¸ªè¯­è¨€çš„æŠ€èƒ½ç‚¹æ„Ÿè§‰æ˜¯ç‚¹å‡ºæ¥äº†ï¼Œ2023 å¹´éœ€è¦å·©å›ºä¸‹ï¼Œç”¨å®ƒä»¬å®Œæˆäº›æ›´å¤æ‚çš„ä»»åŠ¡ã€‚ å¦å¤–å€Ÿç€æç¡¬ä»¶çš„å…´è¶£ï¼ŒæŠŠ Rust/C++ ä¸¤é—¨è¯­è¨€ä¹Ÿç©ä¸€ç© C++ ä¸»è¦æ˜¯ç”¨æ¥ç© ESP32/ESP8266ï¼Œrust é‚£å¯æ˜¯æ—¶ä¸‹æœ€æ½®çš„ç³»ç»Ÿçº§è¯­è¨€ï¼Œ2022 å¹´è™½ç„¶ç”¨ rust å†™äº†ç‚¹ demo ä½†ç¦»ç†Ÿç»ƒè¿˜å·®å¾ˆè¿œã€‚ å…¶ä»– 2022 å¹´æˆ‘ç»™å¼€æºç¤¾åŒºæäº¤çš„ä»£ç è´¡çŒ®å‡ ä¹æ²¡æœ‰ï¼Œå¸Œæœ› 2023 å¹´èƒ½è‡³å°‘ç»™ä¸‰ä¸ªå¼€æºé¡¹ç›®æäº¤ä¸€äº›ä»£ç è´¡çŒ®ï¼Œè¿™ä¹Ÿæ˜¯æ£€éªŒè‡ªå·±çš„ä»£ç æ°´å¹³ã€‚ åˆ¶ä½œä¸€å°è‡ªå·±çš„æ— äººæœºæˆ–è€…ç©¿è¶Šæœºï¼ˆè™½ç„¶è¿˜ä¸å¤ªæ‡‚ä»€ä¹ˆæ˜¯ç©¿è¶Šæœºâ€¦ï¼‰ï¼Œå¹¶å€Ÿæ­¤ç»ƒä¹ è‡ªå·±å­¦ä¹ çš„è½¯ç¡¬ä»¶çŸ¥è¯†ã€‚ æ›´å¤šåœ°åœ¨å…¬å¸å†…éƒ¨ã€åšå®¢ç­‰åœ°æ–¹åˆ†äº«è‡ªå·±æ‰€å­¦çš„çŸ¥è¯†ï¼Œæå‡æ‰€å­¦çŸ¥è¯†çš„å¯å¤ç”¨æ€§ï¼ŒåŒæ—¶ä¹Ÿç¢°æ’å‡ºæ›´å¤šçš„çµå…‰ï¼Œæ›´æ·±å…¥åœ°ç†è§£å®ƒä»¬ã€‚ ","date":"2023-01-02","objectID":"/posts/2022-summary/:4:1","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"2022 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2022-summary/#æŠ€æœ¯ä¾§"},{"categories":["life","tech"],"content":" ç”Ÿæ´»ä¾§2022 å¹´åˆæˆ‘å†™çš„ç”Ÿæ´»ä¸Šçš„å±•æœ›ï¼Œè²Œä¼¼åªæœ‰ã€Œé˜…è¯»ã€è¿™ä¸€é¡¹è¾¾æ ‡äº†â€¦ ä¸è¿‡ä»Šå¹´ä¹Ÿä»æ—§è®°å½•ä¸‹ 2023 å¹´çš„å±•æœ›ï¼š 2022 å¹´å› ä¸ºç–«æƒ…ä»¥åŠè‡ªå·±æ‡’ï¼Œå‚ä¸çš„æˆ·å¤–æ´»åŠ¨ç›¸å½“å°‘ï¼Œ2023 å¹´å¸Œæœ›èƒ½æ›´å¤šçš„åšäº›æˆ·å¤–è¿åŠ¨ï¼Œèº«ä½“è¿˜æ˜¯å¾ˆé‡è¦çš„å•Šã€‚ æŠŠè½®æ»‘æ°´å¹³ç»ƒä¸Šå»ä¸€ç‚¹ï¼Œè½®æ»‘é‹åœ¨ 2022 å¹´åƒç°äº†å‡ ä¹ä¸€æ•´å¹´â€¦ éŸ³ä¹ä¸Šï¼Œå£ç´ã€ç«¹ç¬›ã€midi é”®ç›˜ã€Synthesizer V / ACE Studio / Reaperï¼Œæ€»è¦æŠŠå…¶ä¸­ä¸€ä¸ªç»ƒä¸€ç»ƒå§â€¦ï¼ˆä»€ä¹ˆï¼Ÿå­¦å‰ä»–ï¼Ÿï¼Ÿä¸æ•¢å¼€æ–°å‘äº†ï¼Œæ—§å‘éƒ½è¿˜æ²¡å¡«å®Œå‘¢â€¦ï¼‰ é˜…è¯»ï¼šä»ç„¶è·Ÿå»å¹´ä¿æŒä¸€æ ·çš„èŠ‚å¥å°±å¥½ï¼Œç›®æ ‡æ˜¯ä¸€ä¸ªæœˆè‡³å°‘é˜…è¯»ä¸€æœ¬ä¹¦ã€‚ è‹±è¯­ï¼šè‹±è¯­çš„è§„åˆ’åœ¨Learn English Again ä¸­å·²ç»åšå¾—æ¯”è¾ƒè¯¦å°½äº†ï¼Œè¿™é‡Œä»…æ‘˜æŠ„ä¸‹ç›®æ ‡ã€‚ 2023 å¹´è¾¾åˆ° CEFR çš„ C1 ç­‰çº§ï¼ŒæŠ¥è€ƒå¹¶å–å¾— BEC é«˜çº§è¯ä¹¦ 2023 å¹´åº•è¯æ±‡é‡è¶…è¿‡ 10000 ","date":"2023-01-02","objectID":"/posts/2022-summary/:4:2","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"2022 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2022-summary/#ç”Ÿæ´»ä¾§"},{"categories":["life","tech"],"content":" ç»“è¯­2021 å¹´çš„å¹´ç»ˆæ€»ç»“æ–‡æœ«ï¼Œæˆ‘ç»™è‡ªå·± 2022 å¹´çš„æœŸè®¸æ˜¯ã€Œæ›´ä¸Šä¸€å±‚æ¥¼ã€ï¼Œæ„Ÿè§‰ç¡®å®åº”éªŒäº†ã€‚ é‚£ä¹ˆ 2023 å¹´ï¼Œæˆ‘å¸Œæœ›è‡ªå·±èƒ½å¤Ÿã€Œè®¤è¯†æ›´å¤šæœ‰è¶£çš„äººï¼Œè§è¯†ä¸‹æ›´å®½å¹¿çš„ä¸–ç•Œã€~ æ›´å¤šæœ‰è¶£çš„çš„ 2022 å¹´åº¦æ€»ç»“ï¼šhttps://github.com/saveweb/review-2022 ","date":"2023-01-02","objectID":"/posts/2022-summary/:5:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"2022 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2022-summary/#ç»“è¯­"},{"categories":["tech"],"content":" æœ¬æ–‡ä»‹ç»æˆ‘ä½¿ç”¨ PVE çš„ä¸€äº›å¿ƒå¾—ï¼ˆä¸ä¿è¯æ­£ç¡® emmmmï¼‰ï¼Œå¯èƒ½éœ€è¦ä¸€å®šä½¿ç”¨ç»éªŒæ‰èƒ½é¡ºç•…é˜…è¯»ã€‚ ","date":"2022-11-27","objectID":"/posts/proxmox-virtual-environment-instruction/:0:0","series":[],"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt","Proxmox"],"title":"Proxmox Virtual Environment ä½¿ç”¨æŒ‡å—","uri":"/posts/proxmox-virtual-environment-instruction/#"},{"categories":["tech"],"content":" å‰è¨€æˆ‘åœ¨å»å¹´çš„æ–‡ç«  ã€ŒQEMU/KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨ã€ ä¸­ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ QEMU/KVM ä½œä¸ºæ¡Œé¢è™šæ‹ŸåŒ–è½¯ä»¶ï¼Œå…¶åŠŸèƒ½å¯¹æ ‡å¼€æºå…è´¹çš„Oracle VM VirtualBox ä»¥åŠæ”¶è´¹ä½†æ˜¯ç”¨æˆ·ä¼—å¤šçš„VMware Workstation Pro. è™½ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥è¿œç¨‹ä½¿ç”¨ QEMU/KVMï¼Œä½†æ˜¯ä½¿ç”¨é—¨æ§›æ¯”è¾ƒé«˜ã€‚è€Œä¸”å¦‚æœè¦ç®¡ç†å¤šå°æœåŠ¡å™¨ï¼Œå„ç§å‘½ä»¤ä¹Ÿæ¯”è¾ƒç¹çã€‚æˆ‘ä»¬æ˜¾ç„¶éœ€è¦æ›´æ˜“ç”¨çš„è½¯ä»¶æ¥ç®¡ç†æœåŠ¡å™¨åœºæ™¯ä¸‹çš„è™šæ‹ŸåŒ–ã€‚ è€Œè¿™ç¯‡æ–‡ç« ä»‹ç»çš„ Proxmox Virtual Environmentï¼ˆåç»­ç®€ç§° PVEï¼‰ï¼Œå°±æ˜¯ä¸€ä¸ªåŸºäº QEMU/KVM çš„è™šæ‹Ÿæœºé›†ç¾¤ç®¡ç†å¹³å°ã€‚ PVE ä»¥ Debian + QEMU/KVM + LXC ä¸ºåŸºç¡€è¿›è¡Œäº†æ·±åº¦å®šåˆ¶ï¼Œæä¾›äº†ä¸€å¥—æ¯”è¾ƒå®Œå–„çš„ Web UIï¼ŒåŸºæœ¬ä¸Š 95% çš„æ“ä½œéƒ½å¯ä»¥ç›´æ¥é€šè¿‡å®ƒçš„ Web UI å®Œæˆï¼Œä½†æ˜¯ä»ç„¶æœ‰äº›åŠŸèƒ½åªéœ€è¦ä½¿ç”¨å®ƒçš„ CLI å®Œæˆï¼Œæˆ–è€…è¯´éœ€è¦æ‰‹åŠ¨ä¿®æ”¹ä¸€äº›é…ç½®æ–‡ä»¶ã€‚ PVE å®Œå…¨åŸºäº Linux ä¸–ç•Œçš„å„ç§å¼€æºæŠ€æœ¯ï¼Œå­˜å‚¨æŠ€æœ¯ä½¿ç”¨äº† LVMï¼ˆä¹Ÿæ”¯æŒ Ceph/iSCSI/NFSï¼‰ï¼Œä¹Ÿæ”¯æŒé€šè¿‡ cloudinit é¢„é…ç½®ç½‘ç»œã€ç£ç›˜æ‰©å®¹ã€è®¾ç½® hostnameï¼ˆè¿™å…¶å®æ˜¯ libvirtd çš„åŠŸèƒ½ï¼‰ã€‚å®ƒçš„æ–‡æ¡£ä¹Ÿæ¯”è¾ƒé½å…¨ï¼Œè€Œä¸”å†™å¾—æ¸…æ™°æ˜“æ‡‚ï¼Œè¿˜åŒ…å«è®¸å¤šå®ƒåº•å±‚çš„ QEMU/KVM/CEPH/Cloudinit ç­‰å¼€æºæŠ€æœ¯çš„å†…å®¹ï¼Œ å¯¹å­¦ä¹  Linux è™šæ‹ŸåŒ–æŠ€æœ¯ä¹Ÿæœ‰äº›å¸®åŠ©ã€‚ï¼ˆè¿™é‡Œå¿…é¡»å–·ä¸‹ VMware çš„æ–‡æ¡£ï¼ŒçœŸçš„æ˜¯å†™å¾—çƒ‚å¾—ä¸€æ‰¹ï¼Œä¸çŸ¥æ‰€äº‘ï¼‰ æ€»çš„æ¥è¯´ï¼ŒPVE æ²¡æœ‰ vSphere Hypervisor è·Ÿ Windows Hyper-V é‚£ä¹ˆæˆç†Ÿã€å®Œå–„ã€ç¨³å®šï¼Œä½†æ˜¯åŸºäº QEMU/KVM ä¸”èƒ½å¤Ÿå…è´¹ä½¿ç”¨ï¼Œå¾ˆé€‚åˆ Linux/å¼€æº/è™šæ‹ŸåŒ– çˆ±å¥½è€…æŠ˜è…¾ã€‚ ä½ å¯èƒ½è¿˜å¬è¯´è¿‡ OpenStackï¼Œä¸è¿‡è¿™ä¸ªç©æ„å„¿æˆ‘æ²¡æ¥è§¦è¿‡ï¼Œæ‰€ä»¥è¿™é‡Œç•¥è¿‡äº†å®ƒã€‚ å› ä¸ºè¿™äº›åŸå› ï¼Œæˆ‘é€‰æ‹©äº† PVE ä½œä¸ºæˆ‘çš„ Homelab ç³»ç»Ÿã€‚ å…ˆè´´ä¸€å¼ æˆ‘å½“å‰ Homelab çš„ PVE æ§åˆ¶å°æˆªå›¾ï¼Œç„¶åå°±è¿›å…¥æ­£æ–‡ã€‚ æˆ‘çš„ PVE é›†ç¾¤ å¦‚æœä½ æƒ³äº†è§£æˆ‘çš„ PVE é›†ç¾¤éƒ½è·‘äº†äº›å•¥ï¼Œå¯ä»¥ç…ä¸€ç…homelab - ryan4yin/knowledge. ","date":"2022-11-27","objectID":"/posts/proxmox-virtual-environment-instruction/:1:0","series":[],"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt","Proxmox"],"title":"Proxmox Virtual Environment ä½¿ç”¨æŒ‡å—","uri":"/posts/proxmox-virtual-environment-instruction/#å‰è¨€"},{"categories":["tech"],"content":" ä¸€ã€å®‰è£… PVE ç³»ç»Ÿå»ºè®®ç›´æ¥ä½¿ç”¨ ventoy åˆ¶ä½œä¸€ä¸ª U ç›˜å¯åŠ¨ç›˜ï¼ŒæŠŠå®˜ç½‘ä¸‹è½½çš„ PVE ISO é•œåƒæ‹·è´è¿›å»ï¼Œå³å¯ä½¿ç”¨å®ƒè¿›è¡Œç³»ç»Ÿå®‰è£…ã€‚å®‰è£…è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„çš„ç‚¹æœ‰ï¼š å¦‚æœä½ æœ‰å¤šå°æœºå™¨ï¼Œæ¯å°æœºå™¨éœ€è¦ä½¿ç”¨ä¸åŒçš„ä¸»æœºåç§°ï¼ˆhostnameï¼‰ï¼Œå¦åˆ™åé¢ç»„å»º PVE é›†ç¾¤æ—¶ä¼šæœ‰éº»çƒ¦ã€‚ å»ºè®®ä½¿ç”¨æœºå™¨å‹å· + æ•°å­—ç¼–å·ä½œä¸ºæœºå™¨çš„ hostname ä¸ºæ¯å° PVE èŠ‚ç‚¹é…ç½®é™æ€ IPï¼Œé¿å… IP å˜æ›´ã€‚ ç³»ç»Ÿå®‰è£…å¥½åå³å¯æŒ‰ç…§æç¤ºç›´æ¥è®¿é—®å…¶ Web UIï¼Œä¼šæç¤º HTTPS è¯ä¹¦æ— æ•ˆï¼Œå¿½ç•¥å³å¯ã€‚å¦å¤–è¿˜ä¼šæœ‰ä¸€ä¸ªçƒ¦äººçš„ PVE è®¢é˜…æç¤ºï¼Œä¹Ÿå¯ç›´æ¥å¿½ç•¥ï¼ˆ7.2 åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œæš‚æ—¶æ²¡æ‰¾åˆ°æ€ä¹ˆç¦ç”¨æ‰è¿™ä¸ªæç¤ºï¼‰ã€‚ æ­¤å¤–å¯¹äºå›½å†…ç¯å¢ƒï¼Œå»ºè®®ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤é…ç½®å›½å†…é•œåƒæºï¼ˆæå‡è½¯ä»¶å®‰è£…é€Ÿåº¦ï¼‰ï¼š shell # è®¾ç½® debian çš„é˜¿é‡Œé•œåƒæº cp /etc/apt/sources.list /etc/apt/sources.list.bak sed -i \"s@\\(deb\\|security\\).debian.org@mirrors.aliyun.com@g\" /etc/apt/sources.list # è®¾ç½® pve å›½å†…é•œåƒæº # https://mirrors.bfsu.edu.cn/help/proxmox/ echo 'deb https://mirrors.bfsu.edu.cn/proxmox/debian buster pve-no-subscription' \u003e /etc/apt/sources.list.d/pve-no-subscription.list ","date":"2022-11-27","objectID":"/posts/proxmox-virtual-environment-instruction/:2:0","series":[],"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt","Proxmox"],"title":"Proxmox Virtual Environment ä½¿ç”¨æŒ‡å—","uri":"/posts/proxmox-virtual-environment-instruction/#ä¸€å®‰è£…-pve-ç³»ç»Ÿ"},{"categories":["tech"],"content":" ç»„å»º PVE é›†ç¾¤ å¦‚æœä½ ä»…ä½¿ç”¨å•æœº PVEï¼Œå¯å¿½ç•¥è¿™ä¸€èŠ‚å†…å®¹ã€‚ å°†å¤šå° PVE èŠ‚ç‚¹ç»„æˆä¸€ä¸ªé›†ç¾¤ï¼Œå¯ä»¥è·å¾—å¾ˆå¤šæ–°ç©æ³•ï¼Œæ¯”å¦‚è™šæ‹Ÿæœºåœ¨å¤šèŠ‚ç‚¹é—´çš„çƒ­è¿ç§»ã€‚ æ³¨æ„ CPU æ¶æ„å·®åˆ«è¾ƒå¤§å¾ˆå¯èƒ½ä¼šå¯¼è‡´æ— æ³•çƒ­è¿ç§»ï¼Œå»ºè®®ä½¿ç”¨åŒå“ç‰Œã€åŒä»£çš„ CPUï¼Œæœ€å¥½æ˜¯ CPU å‹å·å®Œå…¨ä¸€è‡´ã€‚æ¯”å¦‚éƒ½æ˜¯ Intel çš„ 12 ä»£ CPUï¼Œæˆ–è€…éƒ½æ˜¯ AMD çš„ 5 ä»£ CPUã€‚ è¿™ä¸ªä¹Ÿè¿˜æŒºç®€å•çš„ï¼Œé¦–å…ˆéšä¾¿ç™»å…¥ä¸€å°æœºå™¨çš„ Web Consoleï¼Œç‚¹å‡»ã€ŒDatacenterã€=\u003eã€ŒClusterã€=\u003eã€ŒCreate Clusterã€å³å¯åˆ›å»ºä¸€ä¸ª PVE é›†ç¾¤ã€‚ æ¥ç€å¤åˆ¶ã€ŒJoin Informationã€ä¸­çš„å†…å®¹ï¼Œåœ¨å…¶ä»–æ¯å° PVE èŠ‚ç‚¹çš„ Web Console é¡µé¢ä¸­ï¼Œç‚¹å‡»ã€ŒDatacenterã€=\u003eã€ŒClusterã€=\u003eã€ŒJoin Clusterã€ï¼Œç„¶åç²˜è´´å‰é¢å¤åˆ¶çš„ã€ŒJoin Informationã€ï¼Œå†è¾“å…¥å‰é¢èŠ‚ç‚¹çš„å¯†ç ï¼Œç­‰å¾…å¤§çº¦ä¸€åˆ†é’Ÿï¼Œç„¶ååˆ·æ–°é¡µé¢ï¼ŒPVE é›†ç¾¤å³ç»„å»ºå®Œæˆã€‚ PVE é›†ç¾¤é…ç½® PVE é›†ç¾¤çš„æ‰€æœ‰èŠ‚ç‚¹æ˜¯å®Œå…¨å¹³ç­‰çš„ï¼Œé›†ç¾¤ç»„å»ºå®Œæˆåï¼Œç™»å½•å…¶ä¸­ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹çš„ Web Console éƒ½å¯ä»¥ç®¡ç†é›†ç¾¤ä¸­æ‰€æœ‰èŠ‚ç‚¹çš„èµ„æºã€‚ ","date":"2022-11-27","objectID":"/posts/proxmox-virtual-environment-instruction/:2:1","series":[],"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt","Proxmox"],"title":"Proxmox Virtual Environment ä½¿ç”¨æŒ‡å—","uri":"/posts/proxmox-virtual-environment-instruction/#ç»„å»º-pve-é›†ç¾¤"},{"categories":["tech"],"content":" äºŒã€PVE æ§åˆ¶å°çš„ä½¿ç”¨PVE æ§åˆ¶å°çš„ä½¿ç”¨è¿˜æŒºç®€å•çš„ï¼Œå¤šè¯•è¯•åŸºæœ¬å°±ä¼šç”¨äº†ã€‚è¿™é‡Œä¸åšè¯¦ç»†ä»‹ç»ï¼Œä¸»è¦è¯´æ˜ä¸‹åˆ›å»ºè™šæ‹Ÿæœºæ—¶ä¸€äº›é‡è¦çš„å‚æ•°ï¼š CPU å°† CPU ç±»å‹è®¾ç½®ä¸º host å¯ä»¥æé«˜æ€§èƒ½ï¼Œé€‚åˆæ¯”è¾ƒåƒæ€§èƒ½æˆ–è€…å¯¹å®æ—¶æ€§è¦æ±‚é«˜çš„è™šæ‹Ÿæœºå¦‚ windows/openwrt å¯¹äºè™šæ‹Ÿæœºæ ¸æ•°ï¼Œå»ºè®®å°† sockets è®¾ä¸º 1ï¼ˆå³ CPU æ’æ§½æ•°ï¼Œä¸€èˆ¬ç‰©ç†æœåŠ¡å™¨æ‰ä¼šæœ‰ 2 åŠä»¥ä¸Šçš„ CPU æ’æ§½ï¼‰ï¼Œcores è®¾ä¸ºä½ æƒ³åˆ†é…ç»™è¯¥è™šæ‹Ÿæœºçš„ CPU æ ¸æ•° ä»…é’ˆå¯¹å¤šç‰©ç† CPU åœºæ™¯ï¼ˆå¤š socketsï¼‰æ‰éœ€è¦å¯ç”¨ NUMAï¼ˆä¸ªäººçŒœæµ‹ï¼Œå¯èƒ½æœ‰é”™ï¼‰ ç£ç›˜ã€ç½‘å¡ ç£ç›˜é©±åŠ¨å»ºè®®ç”¨ virtio SCSIã€ç½‘å¡é©±åŠ¨å»ºè®®ç”¨ VirtIO(paravirtualized)ï¼Œå®ƒçš„æ€§èƒ½æ›´é«˜ã€‚ Linux è™šæ‹ŸæœºåŸç”Ÿæ”¯æŒ virtio åŠè™šæ‹ŸåŒ–ï¼Œè€Œ windows æƒ³è¦å®Œå…¨å¼€å¯åŠè™šæ‹ŸåŒ–ï¼Œéœ€è¦æ‰‹åŠ¨å®‰è£…é©±åŠ¨ï¼Œè¯¦è§Windows_VirtIO_Drivers - Proxmox WIKIï¼Œ ç®€å•çš„è¯´å°±æ˜¯è¦ä¸‹ä¸ª iso æŒ‚è½½åˆ° windows ä¸»æœºä¸­ï¼Œå¹¶å®‰è£…å…¶ä¸­çš„é©±åŠ¨ã€‚ å¦‚æœç¡¬ç›˜æ˜¯ SSDï¼Œè™šæ‹Ÿæœºç£ç›˜å¯ä»¥å¯ç”¨ SSD Emulationï¼Œå¯¹äº IO æ€§èƒ½è¦æ±‚é«˜çš„åœºæ™¯è¿˜å¯ä»¥ä¸ºç£ç›˜å‹¾é€‰ IO Thread åŠŸèƒ½ æ˜¾ç¤ºå™¨ é»˜è®¤ä½¿ç”¨ std ç±»å‹ï¼Œå…¼å®¹æ€§æœ€å¥½ï¼Œä½†æ˜¯æ˜¯çº¯ CPU æ¨¡æ‹Ÿçš„ï¼Œæ¯”è¾ƒè€— CPUã€‚ å¦‚æœä½ æœ‰éœ€è¦æ˜¾å¡åŠ é€Ÿçš„æ¡Œé¢è™šæ‹Ÿæœºï¼Œä½†æ˜¯åˆä¸æƒ³æå¤æ‚çš„æ˜¾å¡ç›´é€šï¼Œå¯ä»¥é€‰æ‹©VirGL GPU(virtio-gl) ç±»å‹ï¼ˆæ³¨æ„ä¸æ˜¯ VirtIO-GPU(virtio)ï¼Œè¿™ä¸ªé©±åŠ¨æ²¡æœ‰æ˜¾å¡åŠ é€Ÿèƒ½åŠ›ï¼‰ï¼Œå®ƒèƒ½ä»¥è¾ƒå°çš„æ€§èƒ½æŸè€—å°†è™šæ‹Ÿæœºä¸­çš„ 3D/2D è¿ç®— offload åˆ° host GPUï¼Œè€Œä¸”é¿å…å¤æ‚çš„é©±åŠ¨é…ç½®ï¼Œåªéœ€è¦åœ¨ PVE ä¸­æ‰§è¡Œã€‚ä½†æ˜¯ç›®å‰å®ƒä»…æ”¯æŒ Linux 4.4+ çš„ Guest ä¸»æœºï¼Œå¹¶ä¸”è¦æ±‚ mesa (\u003e=11.2) compiled with the option gallium-drivers=virglï¼ˆæˆ‘æ„Ÿè§‰è¿™åŠŸèƒ½ç›®å‰è¿˜æœ‰ç‚¹é¸¡è‚‹ï¼‰ã€‚ è¦ä½¿ç”¨ VirGL GPU(virtio-gl)ï¼Œè¿˜éœ€è¦åœ¨ PVE ä¸»æœºä¸Šå®‰è£…é¢å¤–çš„ä¾èµ–ï¼šapt install libgl1 libegl1ï¼Œå®‰è£…å¥½åå³å¯ä½¿ç”¨ã€‚ è¯¦è§QEMU Graphic card - Proxmox VE å…¶ä»–é€‰é¡¹ è°ƒæ•´å¯åŠ¨é¡¹é¡ºåºï¼Œå¯¹äº cloud image å»ºè®®åªå¯ç”¨ scsi0 è¿™ä¸ªé€‰é¡¹ è™šæ‹Ÿæœºæ¨¡æ¿ï¼ˆTemplateï¼‰ä¸å…‹éš†ï¼ˆCloneï¼‰ å»ºè®®é¦–å…ˆä½¿ç”¨ ubuntu/opensuse cloud image é…ç½®å¥½åŸºç¡€ç¯å¢ƒï¼ˆæ¯”å¦‚å®‰è£…å¥½ vim/curl/qemu-guest-agentï¼‰ï¼Œç„¶åè½¬æ¢ä¸º templateï¼Œå…¶ä»–æ‰€æœ‰ Linux è™šæ‹Ÿæœºéƒ½å¯ä»¥ç›´æ¥ clone ä¸€ä¸ªï¼Œæ”¹ä¸ªæ–°åå­—ï¼Œå†æ”¹æ”¹ cloudinit é…ç½®è·Ÿç£ç›˜å¤§å°ï¼Œå°±èƒ½ç›´æ¥å¯åŠ¨ä½¿ç”¨äº†ã€‚ç›¸å½“æ–¹ä¾¿ã€‚ ä»… Full Clone çš„è™šæ‹Ÿæœºæ‰å¯ä»¥åœ¨ PVE é›†ç¾¤èŠ‚ç‚¹é—´éšæ„è¿ç§»ï¼Œå› æ­¤å¦‚æœä½ éœ€è¦è™šæ‹Ÿæœºè¿ç§»åŠŸèƒ½ï¼Œ è¯·ä¸è¦ä½¿ç”¨ Link Clone. BIOS é€šå¸¸éƒ½å»ºè®®ä½¿ç”¨é»˜è®¤çš„ SeaBIOSï¼Œä»… Windows ç­‰åœºæ™¯æ‰å»ºè®®æ¢æˆ OMVF(UEFI) OMVF çš„åˆ†è¾¨ç‡ã€Secure Boot ç­‰å‚æ•°ï¼Œéƒ½å¯ä»¥åœ¨å¯åŠ¨æ—¶æŒ‰ ESC è¿›å…¥ UEFI é…ç½®ç•Œé¢æ¥è°ƒæ•´ã€‚ ä¸Šé¢è¿™äº›å†…å®¹ï¼Œå®˜æ–¹æœ‰è¯¦ç»†æ–‡æ¡£ï¼Œèƒ½è¯»è‹±æ–‡çš„è¯å¯ä»¥ç›´æ¥çœ‹Qemu/KVM Virtual Machines - Proxmox WIKI. ","date":"2022-11-27","objectID":"/posts/proxmox-virtual-environment-instruction/:3:0","series":[],"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt","Proxmox"],"title":"Proxmox Virtual Environment ä½¿ç”¨æŒ‡å—","uri":"/posts/proxmox-virtual-environment-instruction/#äºŒpve-æ§åˆ¶å°çš„ä½¿ç”¨"},{"categories":["tech"],"content":" 1. ä½¿ç”¨ cloudinit è‡ªåŠ¨é…ç½®ç½‘å¡ã€SSHå¯†é’¥ã€å­˜å‚¨ç©ºé—´ å®Œå…¨å‚ç…§å®˜æ–¹æ–‡æ¡£Cloud-Init_Support - PVE Docs æ³¨æ„ï¼šä¸‹é¢çš„å‡ ç§é•œåƒéƒ½åˆ†åˆ«æœ‰è‡ªå·±çš„å‘ç‚¹ï¼Œä»… Ubuntu/OpenSUSE æµ‹è¯•é€šè¿‡ï¼Œå…¶ä»–å‘è¡Œç‰ˆçš„ Cloud é•œåƒéƒ½æœ‰å„ç§æ¯›ç—…â€¦ ä¸€èˆ¬é… Linux è™šæ‹Ÿæœºï¼Œæˆ‘ä»¬å½“ç„¶å¸Œæœ›èƒ½åœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œå°±è‡ªåŠ¨é…ç½®å¥½ IP åœ°å€ã€SSH å¯†é’¥ã€æ–‡ä»¶ç³»ç»Ÿè‡ªåŠ¨æ‰©å®¹ï¼Œè¿™æ ·èƒ½å…å»å¾ˆå¤šæ‰‹å·¥æ“ä½œã€‚cloudinit å°±æ˜¯ä¸€ä¸ªèƒ½å¸®ä½ è‡ªåŠ¨å®Œæˆè¿™äº›åŠŸèƒ½çš„å·¥å…·ï¼ŒAWSã€é˜¿é‡Œäº‘ç­‰å„å¤§äº‘æœåŠ¡å‚å•†éƒ½æ”¯æŒè¿™ç§é…ç½®æ–¹å¼ï¼Œå¥½æ¶ˆæ¯æ˜¯ PVE ä¹Ÿæ”¯æŒã€‚ ä¸‹é¢ç®€å•ä»‹ç»ä¸‹å¦‚ä½•ä½¿ç”¨ cloudinit æ¥è‡ªåŠ¨åŒ–é…ç½® Linux è™šæ‹Ÿæœºã€‚ é¦–å…ˆ cloudinit å¿…é¡»ä½¿ç”¨ç‰¹æ®Šçš„ç³»ç»Ÿé•œåƒï¼Œä¸‹é¢æ˜¯å‡ ä¸ªçŸ¥åå‘è¡Œç‰ˆçš„ Cloud ç³»ç»Ÿé•œåƒï¼š Ubuntu Cloud Images (RELEASED): æä¾› img æ ¼å¼çš„è£¸é•œåƒï¼ˆPVE ä¹Ÿæ”¯æŒæ­¤æ ¼å¼ï¼‰ è¯·ä¸‹è½½å¸¦æœ‰ .img ç»“å°¾çš„é•œåƒï¼Œå…¶ä¸­ä»¥ kvm.img ç»“å°¾çš„é•œåƒä¼šæ›´ç²¾ç®€ä¸€ç‚¹ï¼Œè€Œåç§°ä¸­ä¸åŒ…å« kvm çš„é•œåƒä¼šç¨å¾®å¤§ä¸€ç‚¹ï¼Œä½†æ˜¯å¸¦äº†æ‰€æœ‰å¸¸ç”¨çš„å†…æ ¸æ¨¡å—ã€‚ï¼ˆå¦‚æœä½ ä¸ç†è§£å‰è€…ç²¾ç®€äº†å•¥ï¼Œè¯·é€‰æ‹©åè€…â€”â€”ä¹Ÿå°±æ˜¯ç¨å¤§çš„è¿™ä¸ªé•œåƒæ–‡ä»¶ã€‚ï¼‰ OpenSUSE Cloud Images è¯·ä¸‹è½½å¸¦æœ‰ NoCloud æˆ–è€… OpenStack å­—æ ·çš„é•œåƒã€‚ å¯¹äºå…¶ä»–é•œåƒï¼Œå¯ä»¥è€ƒè™‘æ‰‹åŠ¨é€šè¿‡ iso æ¥åˆ¶ä½œä¸€ä¸ª cloudinit é•œåƒï¼Œå‚è€ƒopenstack - create ubuntu cloud images from iso æ³¨ï¼šDebian Cloud Images çš„é•œåƒæ— æ³•ä½¿ç”¨ï¼Œå…¶ä»– ubuntu/opensuse çš„ cloud é•œåƒä¹Ÿå„æœ‰é—®é¢˜â€¦åœ¨åé¢çš„å¸¸è§é—®é¢˜ä¸­æœ‰ç®€å•æè¿°è¿™äº›é—®é¢˜ã€‚ è¿™é‡Œè¯„è®ºåŒºæœ‰äº›æ–°å†…å®¹ï¼ŒæŒ‡å‡º cloud image çš„å„ç§æ¯›ç—…å¯èƒ½çš„è§£å†³æ–¹æ¡ˆï¼Œæƒ³æ·±å…¥äº†è§£è¯·ç§»æ­¥è¯„è®ºåŒºã€‚ ä¸Šè¿°é•œåƒå’Œæˆ‘ä»¬æ™®é€šè™šæ‹Ÿæœºä½¿ç”¨çš„ ISO é•œåƒçš„åŒºåˆ«ï¼Œä¸€æ˜¯é•œåƒæ ¼å¼ä¸åŒï¼ŒäºŒæ˜¯éƒ½è‡ªå¸¦äº†cloud-init/cloud-utils-growpart ç­‰ç”¨äºè‡ªåŠ¨åŒ–é…ç½®è™šæ‹Ÿæœºçš„ç›¸å…³å·¥å…·ã€‚ å…¶åå­—ä¸­çš„ NoCloud è¡¨ç¤ºæ”¯æŒ cloudinit NoCloud æ•°æ®æºâ€”â€”å³ä½¿ç”¨ seed.iso æä¾› user-data/meta-data/network-config é…ç½®ï¼ŒPVE å°±æ˜¯ä½¿ç”¨çš„è¿™ç§æ¨¡å¼ã€‚è€Œ Openstack é•œåƒé€šå¸¸ä¹Ÿéƒ½æ”¯æŒ NoCloud æ¨¡å¼ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨çš„ã€‚ ä»¥ ubuntu çš„ cloudimg é•œåƒä¸ºä¾‹ï¼Œä¸‹è½½å¥½é•œåƒåï¼Œé¦–å…ˆåˆ›å»ºè™šæ‹Ÿæœºï¼Œå¹¶ä»¥å¯¼å…¥çš„ç£ç›˜ä¸ºè¯¥è™šæ‹Ÿæœºçš„ç¡¬ç›˜ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š å¦‚ä¸‹æ“ä½œä¹Ÿå¯åœ¨ Web UI ä¸Šæ“ä½œï¼Œè¿™é‡Œä»…ä»¥å‘½ä»¤è¡Œä¸ºä¾‹ã€‚ shell # åˆ›å»ºæ–°è™šæ‹Ÿæœº qm create 9000 --name ubuntu-bionic-template --memory 2048 --net0 virtio,bridge=vmbr0 # å°†ä¸‹è½½å¥½çš„ img/qcow2 é•œåƒå¯¼å…¥ä¸ºæ–°è™šæ‹Ÿæœºçš„ç¡¬ç›˜ qm importdisk 9000 ubuntu-20.10-server-cloudimg-amd64.img local-lvm # é€šè¿‡ scsi æ–¹å¼ï¼Œå°†å¯¼å…¥çš„ç¡¬ç›˜æŒ‚è½½åˆ°è™šæ‹Ÿæœºä¸Š qm set 9000 --scsihw virtio-scsi-pci --scsi0 local-lvm:vm-9000-disk-0 # qcow2 é•œåƒé»˜è®¤ä»… 2G å¤§å°ï¼Œéœ€è¦æ‰‹åŠ¨æ‰©å®¹åˆ° 32Gï¼Œå¦åˆ™è™šæ‹Ÿæœºå¯åŠ¨ä¼šæŠ¥é”™ qm resize 9000 scsi0 32G ç„¶ååˆ›å»ºæŒ‚è½½ cloud-init çš„ seed.isoï¼Œä¿®æ”¹å¯åŠ¨é¡¹ä»¥åŠå…¶ä»–ï¼š shell # åˆ›å»ºä¸€ä¸ª cloud-init éœ€è¦ä½¿ç”¨çš„ CDROM ç›˜(sr0) qm set 9000 --ide2 local-lvm:cloudinit # è®¾ç½®ç³»ç»Ÿå¼•å¯¼ç›˜ qm set 9000 --boot c --bootdisk scsi0 # è®¾ç½® serial0 ä¸ºæ˜¾ç¤ºç»ˆç«¯ï¼Œå¾ˆå¤šäº‘é•œåƒéƒ½éœ€è¦è¿™ä¸ªã€‚ qm set 9000 --serial0 socket --vga serial0 ä¸Šé¢çš„å·¥ä½œéƒ½å®Œæˆåï¼Œè¿˜éœ€è¦åšä¸€äº›åç»­é…ç½® æ‰‹åŠ¨è®¾ç½® cloud-init å‚æ•°ï¼Œé‡æ–°ç”Ÿæˆ cloudinit imageï¼Œå¯åŠ¨è™šæ‹Ÿæœºï¼Œå¹¶é€šè¿‡ ssh ç™»å…¥è¿œç¨‹ç»ˆç«¯ cloud image åŸºæœ¬éƒ½æ²¡æœ‰é»˜è®¤å¯†ç ï¼Œå¹¶ä¸”ç¦ç”¨äº† SSH å¯†ç ç™»å½•ã€‚å¿…é¡»é€šè¿‡ cloud-init å‚æ•°æ·»åŠ ç§é’¥ã€è®¾ç½®è´¦å·ã€å¯†ç ã€ç§é’¥ã€‚ æ£€æŸ¥ qemu-guest-agentï¼Œå¦‚æœæœªè‡ªå¸¦ï¼Œä¸€å®šè¦æ‰‹åŠ¨å®‰è£…å®ƒï¼ ubuntu éœ€è¦é€šè¿‡ sudo apt install qemu-guest-agent æ‰‹åŠ¨å®‰è£…å®ƒ å®‰è£…æ‰€éœ€çš„åŸºç¡€ç¯å¢ƒï¼Œå¦‚ docker/docker-compose/vim/git/python3 å…³é—­è™šæ‹Ÿæœºï¼Œç„¶åå°†è™šæ‹Ÿæœºè®¾ä¸ºæ¨¡æ¿ æ¥ä¸‹æ¥å°±å¯ä»¥ä»è¿™ä¸ªæ¨¡æ¿è™šæ‹Ÿæœºï¼Œå…‹éš†å„ç±»æ–°è™šæ‹Ÿæœºäº†~ ä¿é™©èµ·è§ï¼Œæ”¹å®Œé…ç½®åè®°å¾—ç‚¹ä¸‹ Regenerate Image å…¶ä»– cloudinit ç›¸å…³æ–‡æ¡£ï¼š é…ç½® Cloud-Init å·¥å…· - åä¸ºäº‘ canonical/cloud-init - github Run Amazon Linux 2 as a virtual machine on premises ","date":"2022-11-27","objectID":"/posts/proxmox-virtual-environment-instruction/:3:1","series":[],"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt","Proxmox"],"title":"Proxmox Virtual Environment ä½¿ç”¨æŒ‡å—","uri":"/posts/proxmox-virtual-environment-instruction/#1-ä½¿ç”¨-cloudinit-è‡ªåŠ¨é…ç½®ç½‘å¡sshå¯†é’¥å­˜å‚¨ç©ºé—´"},{"categories":["tech"],"content":" 2. è™šæ‹Ÿæœºç¡¬ç›˜æ‰©å®¹CentOS/Ubuntu/Debian æä¾›çš„ Cloud é•œåƒï¼Œéƒ½è‡ªå¸¦äº† cloud-utils-growpart è¿™ä¸ªç»„ä»¶ï¼Œå¯ä»¥å®ç°åœ¨æ‰©å®¹ç‰©ç†ç¡¬ç›˜æ—¶ï¼Œè‡ªåŠ¨è°ƒæ•´ Linux çš„åˆ†åŒºå¤§å°ã€‚ å› æ­¤éœ€è¦æ‰©å®¹è™šæ‹Ÿæœºæ—¶ï¼Œç›´æ¥é€šè¿‡ UI é¢æ¿/å‘½ä»¤è¡Œæ‰©å®¹è™šæ‹Ÿæœºçš„ç¡¬ç›˜ï¼Œç„¶åé‡å¯è™šæ‹Ÿæœºå³å¯ï¼ŒLinuxçš„åˆ†åŒºä¼šåœ¨ç³»ç»Ÿå¯åŠ¨é˜¶æ®µè¢« cloud-utils-growpart è‡ªåŠ¨æ‰©å®¹ã€‚ PVE å¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤è¿›è¡Œç£ç›˜æ‰©å®¹ï¼š shell # å°† id ä¸º 9000 çš„è™šæ‹Ÿæœºçš„ scsi0 ç£ç›˜ï¼Œæ‰©å®¹åˆ° 32G # è¯·è‡ªè¡Œä¿®æ”¹è™šæ‹Ÿæœº ID ä¸ç£ç›˜å¤§å°ï¼Œæ³¨æ„ä»…æ”¯æŒæ‰©å®¹ï¼ä¸èƒ½ç¼©å®¹ã€‚ qm resize 9000 scsi0 32G è€Œå…¶ä»–é Cloud é•œåƒï¼Œåˆ™éœ€è¦åœ¨æ‰©å®¹ç£ç›˜åå†è¿›å…¥è™šæ‹Ÿæœºæ‰‹åŠ¨æ‰©å®¹åˆ†åŒºè·Ÿç£ç›˜ï¼Œå…·ä½“å‘½ä»¤å°±ä¸ä»‹ç»äº†ï¼Œè¯·è‡ªè¡ŒæŸ¥é˜…ç›¸å…³æ–‡æ¡£å§ã€‚ å› ä¸ºè¿™ä¸ªæ–¹ä¾¿çš„ç‰¹æ€§ï¼Œä¹Ÿä¸ºäº†å‡å°‘è™šæ‹ŸåŒ–çš„å¼€é”€ï¼ŒCloud é•œåƒé»˜è®¤æ˜¯ä¸ä½¿ç”¨ LVM é€»è¾‘åˆ†åŒºçš„ã€‚LVMé€»è¾‘åˆ†åŒºè™½ç„¶æ–¹ä¾¿ï¼Œä½†æ˜¯å®ƒå¯¹ç‰©ç†æœºçš„ä½œç”¨æ›´å¤§äº›ã€‚è™šæ‹Ÿæœºå› ä¸ºæœ¬èº«å°±èƒ½åŠ¨æ€æ‰©å®¹ã€Œç‰©ç†ç¡¬ç›˜ã€çš„å¤§å°ï¼ŒåŸºæœ¬ä¸ç”¨ä¸åˆ° LVMã€‚ è¿˜æœ‰ä¸€ç‚¹ï¼Œå°±æ˜¯è™šæ‹Ÿæœºé€šå¸¸åªéœ€è¦ä¸€ä¸ªæ ¹åˆ†åŒºå°±è¡Œï¼Œå°¤å…¶æ˜¯å½’ openstack/kubernetes ç®¡çš„è™šæ‹Ÿæœºã€‚åªæœ‰åœ¨ä½¿ç”¨åˆ†å¸ƒå¼å­˜å‚¨ä¹‹ç±»çš„åœºæ™¯ä¸‹ï¼Œæ•°æ®éœ€è¦ç‹¬ç«‹å­˜å‚¨ï¼Œæ‰éœ€è¦ç”¨åˆ°é¢å¤–çš„åˆ†åŒº(/data ä¹‹ç±»çš„)ã€‚ä¸€èˆ¬åªæœ‰ç‰©ç†æœºï¼Œæ‰éœ€è¦åƒç½‘ä¸Šå¾ˆå¤šæ–‡ç« æçš„é‚£æ ·ï¼Œä¸º /boot / /home å»å•ç‹¬åˆ†åŒºã€‚è€Œä¸”ç°åœ¨å¤§å®¶éƒ½ç”¨ SSD äº†ï¼Œç‰©ç†æœºè¿™æ ·åšåˆ†åŒºçš„éƒ½å°‘äº†ï¼Œæ¯”å¦‚æˆ‘ä¸ªäººç”µè„‘ï¼Œå°±æ˜¯ä¸€ä¸ª / åˆ†åŒºæ‰“å¤©ä¸‹ã€‚ã€‚ã€‚ ","date":"2022-11-27","objectID":"/posts/proxmox-virtual-environment-instruction/:3:2","series":[],"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt","Proxmox"],"title":"Proxmox Virtual Environment ä½¿ç”¨æŒ‡å—","uri":"/posts/proxmox-virtual-environment-instruction/#2-è™šæ‹Ÿæœºç¡¬ç›˜æ‰©å®¹"},{"categories":["tech"],"content":" ä¸‰ã€å¸¸è§é—®é¢˜","date":"2022-11-27","objectID":"/posts/proxmox-virtual-environment-instruction/:4:0","series":[],"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt","Proxmox"],"title":"Proxmox Virtual Environment ä½¿ç”¨æŒ‡å—","uri":"/posts/proxmox-virtual-environment-instruction/#ä¸‰å¸¸è§é—®é¢˜"},{"categories":["tech"],"content":" 1. å¯¼å…¥å·²æœ‰çš„ qcow2 é•œåƒ è¿™ä¸€æ­¥å¿…é¡»è¦å‘½ä»¤è¡Œæ“ä½œï¼ŒWebUI ç•Œé¢ä¸æ”¯æŒã€‚ é¦–å…ˆåœ¨é¡µé¢ä¸Šæ–°å»ºä¸€å°æ–°è™šæ‹Ÿæœºï¼Œè®°å½•ä¸‹è™šæ‹Ÿæœº IDã€‚ å‡è®¾ä½ åˆ›å»ºçš„è™šæ‹Ÿæœº id ä¸º 201ï¼Œç°åœ¨é€šè¿‡ scp/rsync ç­‰æ‰‹æ®µå°† qcow2 ä¼ è¾“åˆ° PVE èŠ‚ç‚¹ä¸Šï¼Œç„¶åå‘½ä»¤è¡Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯¼å…¥ qcow2/img é•œåƒï¼š shell # å‘½ä»¤æ ¼å¼ qm importdisk \u003cvmid\u003e \u003csource\u003e \u003cstorage\u003e # ç¤ºä¾‹ qm importdisk 201 vm-201-disk-1.qcow2 local-lvm å¯¼å…¥å®Œæˆåï¼Œåœ¨è™šæ‹Ÿæœºçš„ WebUI ç•Œé¢ä¸­ï¼Œä¼šçœ‹åˆ°åº•ä¸‹å¤šäº†ä¸€ä¸ªã€Œæœªä½¿ç”¨çš„ç£ç›˜ 0ã€ã€‚ æ¥ç€åˆ é™¤æ‰é»˜è®¤çš„ç£ç›˜ï¼ˆåˆ†ç¦»+åˆ é™¤ï¼Œè¦ä¸¤æ­¥ï¼‰ï¼Œå†æŒ‚è½½è¿™ä¸ªã€Œæœªä½¿ç”¨çš„ç£ç›˜ 0ã€ã€‚ æŒ‚è½½å®Œæˆåç›´æ¥å¯åŠ¨æ˜¯ä¸è¡Œçš„ï¼Œè¿˜éœ€è¦åœ¨è®¾ç½®ä¸­å°†æ–°ç£ç›˜æ·»åŠ åˆ°å¯åŠ¨é¡¹ä¸­ï¼Œè¿™æ ·å°±èƒ½æ­£å¸¸å¯åŠ¨äº†ã€‚ ","date":"2022-11-27","objectID":"/posts/proxmox-virtual-environment-instruction/:4:1","series":[],"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt","Proxmox"],"title":"Proxmox Virtual Environment ä½¿ç”¨æŒ‡å—","uri":"/posts/proxmox-virtual-environment-instruction/#1-å¯¼å…¥å·²æœ‰çš„-qcow2-é•œåƒ"},{"categories":["tech"],"content":" 2. ç‚¹å‡» shutdown å PVE ç³»ç»Ÿå¡ä½PVE çš„ shutdown åŠŸèƒ½ä¾èµ– qemu-guest-agentï¼Œå¯¹äºè¿˜æ²¡æœ‰å®‰è£… qemu-guest-agent çš„ä»»ä½•ä¸»æœºï¼Œæˆ–è€…å·²ç»å¡æ­»æ— å“åº”çš„è™šæ‹Ÿæœºï¼Œåƒä¸‡ä¸è¦ç‚¹ shutdown æŒ‰é’®ï¼Œå› ä¸ºä¸€å®šä¼šå¡ä½å¾ˆä¹…ï¼Œæœ€åå¤±è´¥ï¼ shutdown å¡ä½çš„è§£å†³åŠæ³•ï¼šæ‰‹åŠ¨åœ¨ä¸‹æ–¹çš„ã€ŒTasksã€é¢æ¿ä¸­åŒå‡»å¡ä½çš„ã€ŒShutdownã€æ“ä½œï¼Œç„¶åç‚¹å‡»ã€Œstopã€åœæ­¢è¯¥æ“ä½œã€‚ è¯¥å¦‚ä½•å…³é—­è¿™ç±»æ²¡æœ‰ qemu-guest-agent æˆ–è€…å·²ç»å¡æ­»æ— å“åº”çš„ä¸»æœºï¼Ÿç­”æ¡ˆæ˜¯ä½¿ç”¨ stopï¼ ","date":"2022-11-27","objectID":"/posts/proxmox-virtual-environment-instruction/:4:2","series":[],"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt","Proxmox"],"title":"Proxmox Virtual Environment ä½¿ç”¨æŒ‡å—","uri":"/posts/proxmox-virtual-environment-instruction/#2-ç‚¹å‡»-shutdown-å-pve-ç³»ç»Ÿå¡ä½"},{"categories":["tech"],"content":" 3. canâ€™t lock file â€˜/var/lock/qemu-server/lock-xxx.confâ€™ â€“ got timeoutPVE è™šæ‹Ÿæœºå¡åœ¨ BIOS ç³»ç»Ÿå¼•å¯¼è¿™ä¸€æ­¥ï¼Œæ— æ³•å¯åŠ¨ï¼Œä¹Ÿæ— æ³• stopï¼ è§£å†³æ–¹æ³•ï¼šæ‰‹åŠ¨åˆ é™¤æ‰ lockfile: /var/lock/qemu-server/lock-xxx.conf å› ä¸ºè™šæ‹Ÿæœºè¿˜å¡åœ¨ BIOS å¼•å¯¼è¿™ä¸€æ­¥ï¼Œåˆ é™¤æ‰ lockfile å†å…³é—­è™šæ‹Ÿæœºå¹¶ä¸ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚ ","date":"2022-11-27","objectID":"/posts/proxmox-virtual-environment-instruction/:4:3","series":[],"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt","Proxmox"],"title":"Proxmox Virtual Environment ä½¿ç”¨æŒ‡å—","uri":"/posts/proxmox-virtual-environment-instruction/#3-cant-lock-file-varlockqemu-serverlock-xxxconf--got-timeout"},{"categories":["tech"],"content":" 4. PVE é›†ç¾¤æœ‰ä¸€ä¸ªèŠ‚ç‚¹å®•æœºï¼Œå¦‚ä½•è§£é™¤å…³è”ï¼Ÿå°†å¤šä¸ªèŠ‚ç‚¹ç»„æˆä¸€ä¸ª PVE Cluster æ˜¯å¾ˆè‡ªç„¶çš„ä¸€ä¸ªé€‰æ‹©ï¼Œå®ƒèƒ½æä¾›è™šæ‹Ÿæœºçƒ­è¿ç§»ã€ç»Ÿä¸€ç®¡ç†é¢æ¿ç­‰éå¸¸æ–¹ä¾¿çš„åŠŸèƒ½ã€‚ä½†æ˜¯è¿™ä¼šå¸¦æ¥é›†ç¾¤çº§åˆ«çš„é«˜å¯ç”¨é—®é¢˜ã€‚ æ ¹æ®å®˜æ–¹æ–‡æ¡£ Cluster_Manager - Proxmoxï¼Œå¦‚æœä½ éœ€è¦å®¹å¿ä¸€å®šæ•°é‡çš„èŠ‚ç‚¹å®•æœºï¼ŒPVE Cluster è‡³å°‘éœ€è¦ä¸‰å°ä¸»æœºï¼ˆè¿™è·Ÿ Etcd ä¸€æ ·ï¼Œå¤§æ¦‚æ˜¯ Raft å…±è¯†ç®—æ³•çš„è¦æ±‚ï¼‰ï¼Œå¹¶ä¸”æ‰€æœ‰èŠ‚ç‚¹çš„ PVE ç‰ˆæœ¬è¦å®Œå…¨ä¸€è‡´ã€‚ é‚£ä¹ˆå¦‚æœä¸ªåˆ«èŠ‚ç‚¹å‡ºäº†é—®é¢˜ï¼Œæ— æ³•ä¿®å¤ï¼Œè¯¥å¦‚ä½•å°†å®ƒè¸¢å‡ºé›†ç¾¤å‘¢ï¼Ÿ å¦‚æœåœ¨çº¿èŠ‚ç‚¹å æ¯”è¶…è¿‡ 50%ï¼ŒèŠ‚ç‚¹åˆ é™¤çš„æµç¨‹å¦‚ä¸‹ï¼š é¦–å…ˆé€šè¿‡è®¿é—®èŠ‚ç‚¹çš„ shell ç•Œé¢ï¼Œé€šè¿‡å‘½ä»¤ pvecm nodes ç¡®è®¤é›†ç¾¤çš„æ‰€æœ‰èŠ‚ç‚¹ å°†éœ€è¦ç§»é™¤çš„èŠ‚ç‚¹å½»åº•å…³æœºï¼Œå¹¶ä¸”ç¡®ä¿å®ƒä¸ä¼šä»¥å½“å‰é…ç½®å†æ¬¡å¯åŠ¨ï¼ˆä¹Ÿå°±æ˜¯è¯´å…³æœºåéœ€è¦æ¸…ç©ºç¡¬ç›˜ï¼Œ é¿å…æ•°æ®æ··ä¹±ï¼‰ å¦‚æœè¢«åˆ é™¤èŠ‚ç‚¹å·²å®•æœºï¼Œåˆ™å¯è·³è¿‡ å…³æœº æ­¥éª¤ é€šè¿‡å‘½ä»¤ pvecm delnode xxx å°†é—®é¢˜èŠ‚ç‚¹ç§»é™¤é›†ç¾¤ é‡ç½®æ—§èŠ‚ç‚¹ç¡¬ç›˜ï¼Œå¹¶é‡æ–°è£…æœºï¼Œç”¨åšå…¶ä»–ç”¨é€”ã€‚ å¦‚æœä½ çš„é›†ç¾¤åªæœ‰ 2 ä¸ªèŠ‚ç‚¹ï¼Œæˆ–è€…æœ‰è¶…è¿‡ 3 ä¸ªèŠ‚ç‚¹ä½†æ˜¯å®•æœºèŠ‚ç‚¹æ•°ä¸ä½äº 50%ï¼Œé‚£å‡ºäºæ•°æ®ä¸€è‡´æ€§è¦æ±‚ Raft ç®—æ³•ä¼šç¦æ­¢æ›´æ–°é›†ç¾¤æ•°æ®ï¼Œä¸Šé¢çš„æµç¨‹å°±èµ°ä¸é€šäº†ã€‚å¦‚æœä½ ç›´æ¥èµ°ä¸Šé¢çš„æµç¨‹ï¼Œå®ƒä¼šæŠ¥é”™cluster not ready - no quorum? è¿™æ—¶éœ€è¦é¦–å…ˆä¿®æ”¹é…ç½®ï¼Œä½¿å‰©ä¸‹çš„èŠ‚ç‚¹é‡æ–°è¾¾æˆä¸€è‡´ã€‚å…¶å®å°±æ˜¯ä¿®æ”¹é€‰ä¸»èŠ‚ç‚¹æ—¶çš„æŠ•ç¥¨æ•°ã€‚ å¯¹äº 2 ä¸ªèŠ‚ç‚¹ä½†æŒ‚æ‰ 1 ä¸ªçš„æƒ…å†µï¼Œé¦–å…ˆæ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤å…è®¸å½“å‰èŠ‚ç‚¹è‡ªå·±é€‰ä¸»ï¼š shell # è®¾ç½®åªéœ€è¦ 1 ç¥¨å°±èƒ½å½“å‰ä¸»èŠ‚ç‚¹ # æ½œåœ¨é—®é¢˜æ˜¯å¯èƒ½æœ‰äº›é›†ç¾¤å…ƒæ•°æ®åªåœ¨æŸåèŠ‚ç‚¹ä¸Šæœ‰ï¼Œè¿™ä¹ˆæ”¹ä¼šå¯¼è‡´è¿™äº›æ•°æ®ä¸¢å¤±ï¼Œä»è€Œé€ æˆä¸€äº›é—®é¢˜ã€‚ # å®‰å…¨èµ·è§ï¼Œå»ºè®®åœ¨ä¿®å¤é›†ç¾¤åï¼Œå†é‡å¯ä¸€éèŠ‚ç‚¹... pvecm expected 1 ç°åœ¨ quorum å°±å·²ç»æ¢å¤äº†ï¼Œå¯ä»¥èµ°å‰é¢ç»™å‡ºçš„èŠ‚ç‚¹ç§»é™¤æµç¨‹ã€‚ å¦‚æœèŠ‚ç‚¹å·²ç»åˆ é™¤ï¼Œä½†æ˜¯ Web GUI ä¸Šä»ç„¶æ˜¾ç¤ºæœ‰è¢«åˆ é™¤çš„èŠ‚ç‚¹ï¼Œå¯ä»¥åœ¨é›†ç¾¤çš„æ‰€æœ‰å‰©ä½™èŠ‚ç‚¹ä¸Šï¼Œæ‰‹åŠ¨åˆ é™¤æ‰ /etc/pve/nodes/node-name/ æ–‡ä»¶å¤¹ï¼Œå³å¯ä»é›†ç¾¤ä¸­å½»åº•åˆ é™¤è¯¥èŠ‚ç‚¹çš„æ•°æ®ï¼Œæ³¨æ„åƒä¸‡åˆ«åˆ é”™äº†ï¼Œä¸ç„¶å°±å°´å°¬äº†â€¦ å¦‚æœ corosync å®Œå…¨æ— æ³•å¯åŠ¨ï¼Œä¸Šé¢ç»™å‡ºçš„å‘½ä»¤ä¹Ÿä¼šä¿®æ”¹é€‰ä¸»æŠ•ç¥¨å‚æ•°ä¹Ÿä¼šå¤±è´¥ï¼Œè¿™æ—¶å¯ä»¥ç›´æ¥æ‰‹åŠ¨ä¿®æ”¹ /etc/corosync/corosync.conf åˆ é™¤æ‰æœ‰é—®é¢˜çš„èŠ‚ç‚¹å¯¹åº”çš„é…ç½®ï¼Œè°ƒä½ expected æŠ•ç¥¨æ•°ï¼Œä½¿ corosync èƒ½æ­£å¸¸å¯åŠ¨ï¼Œå†æ‰§è¡Œå‰è¿°æ“ä½œã€‚ ","date":"2022-11-27","objectID":"/posts/proxmox-virtual-environment-instruction/:4:4","series":[],"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt","Proxmox"],"title":"Proxmox Virtual Environment ä½¿ç”¨æŒ‡å—","uri":"/posts/proxmox-virtual-environment-instruction/#4-pve-é›†ç¾¤æœ‰ä¸€ä¸ªèŠ‚ç‚¹å®•æœºå¦‚ä½•è§£é™¤å…³è”"},{"categories":["tech"],"content":" 5. cloud image çš„å‘ ubuntu cloud image çš„å‘ ubuntu å¯åŠ¨æ—¶ä¼šæŠ¥é”™ no such device: rootï¼Œä½†æ˜¯è¿‡ä¸€ä¼šå°±ä¼šæ­£å¸¸å¯åŠ¨ã€‚ è¿™æ˜¯ ubuntu cloud image çš„ bug: https://bugs.launchpad.net/cloud-images/+bug/1726476 ubuntu å¯åŠ¨åå¾ˆå¿«å°±ä¼šè¿›å…¥ç™»å½•ç•Œé¢ï¼Œä½†æ˜¯ root å¯†ç å¯èƒ½è¿˜æ²¡æ”¹å¥½ï¼Œç™»å½•ä¼šæŠ¥å¯†ç é”™è¯¯ï¼Œç­‰å¾…ä¸€ä¼šå†å°è¯•ç™»å½•å°± OK äº† ubuntu çš„é»˜è®¤ç½‘å¡åç§°æ˜¯ ens3ï¼Œä¸æ˜¯ eth0ï¼Œæ³¨æ„ä¿®æ”¹ network_config çš„ç½‘å¡åç§°ï¼Œå¦åˆ™ç½‘ç»œé…ç½®ä¸ä¼šç”Ÿæ•ˆ ä»¥ kvm ç»“å°¾çš„ Ubuntu Cloud Image æ— æ³•è¯†åˆ«åˆ° USB è®¾å¤‡ï¼Œå°† USB ç«¯å£æ˜ å°„åˆ°è¯¥è™šæ‹Ÿæœºä¸­æ²¡æœ‰ä»»ä½•ä½œç”¨ã€‚ kvm ä½¿ç”¨äº†ç²¾ç®€ç‰ˆçš„ linux å†…æ ¸ï¼Œå»æ‰äº† USB ç­‰åœ¨äº‘ä¸Šç”¨ä¸åˆ°çš„é©±åŠ¨ï¼Œå»ºè®®æ”¹ç”¨æ—  kvm ç»“å°¾çš„é•œåƒã€‚ ã€ŒUbuntu Cloud Image æ— æ³•è¯†åˆ«åˆ° USB è®¾å¤‡ã€çš„æ’æŸ¥è®°å½•ç°è±¡ï¼š åœ¨å°è¯•ä½¿ç”¨ PVE å°† USB æ¥å£ç›´é€šåˆ° Ubuntu Cloud Image å¯åŠ¨çš„è™šæ‹Ÿæœºä½œä¸º NAS ç³»ç»Ÿæ—¶ï¼Œå‘ç°lsblk æ ¹æœ¬æ— æ³•æ‰¾åˆ°æˆ‘çš„ USB ç¡¬ç›˜ æ¢æˆæˆ‘ç¬”è®°æœ¬æ¥ç¡¬ç›˜ç›’ï¼Œèƒ½å¤Ÿæ­£å¸¸è¯†åˆ«å¹¶æŒ‚è½½ç¡¬ç›˜ ä½¿ç”¨ lsusb ä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯ä¹Ÿçœ‹ä¸åˆ°ä»»ä½•å†…å®¹ ä½¿ç”¨ lspci èƒ½æ‰¾åˆ° USB å¯¹åº”çš„ PCI è®¾å¤‡ è¿›ä¸€æ­¥ä½¿ç”¨ cat /proc/modules | grep usb ä¸ lsmod | grep usb å‡æŸ¥ä¸åˆ°ä»»ä½• usb ç›¸å…³çš„å†…æ ¸æ¨¡å— è€Œåœ¨æˆ‘ç¬”è®°æœ¬ä¸Š lsmod | grep usb èƒ½å¤Ÿè¾“å‡º usb_storage usb_core ç­‰å¤šé¡¹å†…æ ¸æ¨¡å—ã€‚ å†ç”¨ modprobe usb ä¼šæç¤ºmodprobe: FATAL: Module usb not found in directory /lib/modules/5.15.0-1021-kvm é—®é¢˜åŸå› å¾ˆæ˜æ˜¾äº†ï¼ŒUbuntu æ ¹æœ¬æ²¡æœ‰ä¸º cloud image é¢„ç½® usb å†…æ ¸æ¨¡å—ï¼Œæ‰€ä»¥æ‰æœ‰è¿™ä¸ªé—®é¢˜â€¦ è¿›ä¸€æ­¥æœç´¢å‘ç°è¿™ä¸ªå¸–å­ï¼šWhatâ€™s the difference between ubuntuâ€™s amd64-disk-kvm.img and the regular amd64.img cloud images?ï¼Œ è§£ç­”äº†æˆ‘çš„ç–‘æƒ‘ã€‚ åŸå› æ˜¯ï¼Œæˆ‘ä½¿ç”¨äº† ubuntu ä¸º cloud ç¯å¢ƒåšäº†ç²¾ç®€çš„ kvm å†…æ ¸ï¼Œéå¸¸è½»é‡ï¼Œä½†æ˜¯ç¼ºå°‘ usb ç­‰å¸¸ç”¨å†…æ ¸æ¨¡å—ã€‚ å¯¹äº NAS å¤–æ¥å­˜å‚¨è¿™ä¸ªåœºæ™¯ï¼Œæˆ‘åº”è¯¥ä½¿ç”¨ä¸ä»¥ kvm ç»“å°¾çš„ ubuntu cloud imageï¼Œæ¢äº†ä¸ªåŸºç¡€é•œåƒåé—®é¢˜å°±è§£å†³äº†~ opensuse cloud image çš„å‘ opensuse leap 15 åªæ”¯æŒ network_config v1ï¼Œå¯¹ v2 çš„æ”¯æŒæœ‰ bugï¼Œgateway4 ä¸ä¼šç”Ÿæ•ˆ debian cloud image çš„å‘debian çš„ cloud é•œåƒæ ¹æœ¬æ²¡æ³•ç”¨ï¼Œå»ºè®®é¿å…ä½¿ç”¨å®ƒã€‚ debian å¯åŠ¨æ—¶ä¼šå½»åº•å¡ä½ï¼Œæˆ–è€…ç›´æ¥æŠ¥é”™ kernel panic åŸå› æ˜¯æ·»åŠ äº† spice å›¾å½¢å¡ï¼Œæ¢æˆ vnc å°±æ­£å¸¸äº† Debian Cloud Images ä¸­çš„ nocloud é•œåƒä¸ä¼šåœ¨å¯åŠ¨æ—¶è¿è¡Œ cloudinitï¼Œcloudinit å®Œå…¨ä¸ç”Ÿæ•ˆ ä¸çŸ¥é“æ˜¯å•¥å‘ï¼Œæ²¡è§£å†³ ","date":"2022-11-27","objectID":"/posts/proxmox-virtual-environment-instruction/:4:5","series":[],"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt","Proxmox"],"title":"Proxmox Virtual Environment ä½¿ç”¨æŒ‡å—","uri":"/posts/proxmox-virtual-environment-instruction/#5-cloud-image-çš„å‘"},{"categories":["tech"],"content":" 5. cloud image çš„å‘ ubuntu cloud image çš„å‘ ubuntu å¯åŠ¨æ—¶ä¼šæŠ¥é”™ no such device: rootï¼Œä½†æ˜¯è¿‡ä¸€ä¼šå°±ä¼šæ­£å¸¸å¯åŠ¨ã€‚ è¿™æ˜¯ ubuntu cloud image çš„ bug: https://bugs.launchpad.net/cloud-images/+bug/1726476 ubuntu å¯åŠ¨åå¾ˆå¿«å°±ä¼šè¿›å…¥ç™»å½•ç•Œé¢ï¼Œä½†æ˜¯ root å¯†ç å¯èƒ½è¿˜æ²¡æ”¹å¥½ï¼Œç™»å½•ä¼šæŠ¥å¯†ç é”™è¯¯ï¼Œç­‰å¾…ä¸€ä¼šå†å°è¯•ç™»å½•å°± OK äº† ubuntu çš„é»˜è®¤ç½‘å¡åç§°æ˜¯ ens3ï¼Œä¸æ˜¯ eth0ï¼Œæ³¨æ„ä¿®æ”¹ network_config çš„ç½‘å¡åç§°ï¼Œå¦åˆ™ç½‘ç»œé…ç½®ä¸ä¼šç”Ÿæ•ˆ ä»¥ kvm ç»“å°¾çš„ Ubuntu Cloud Image æ— æ³•è¯†åˆ«åˆ° USB è®¾å¤‡ï¼Œå°† USB ç«¯å£æ˜ å°„åˆ°è¯¥è™šæ‹Ÿæœºä¸­æ²¡æœ‰ä»»ä½•ä½œç”¨ã€‚ kvm ä½¿ç”¨äº†ç²¾ç®€ç‰ˆçš„ linux å†…æ ¸ï¼Œå»æ‰äº† USB ç­‰åœ¨äº‘ä¸Šç”¨ä¸åˆ°çš„é©±åŠ¨ï¼Œå»ºè®®æ”¹ç”¨æ—  kvm ç»“å°¾çš„é•œåƒã€‚ ã€ŒUbuntu Cloud Image æ— æ³•è¯†åˆ«åˆ° USB è®¾å¤‡ã€çš„æ’æŸ¥è®°å½•ç°è±¡ï¼š åœ¨å°è¯•ä½¿ç”¨ PVE å°† USB æ¥å£ç›´é€šåˆ° Ubuntu Cloud Image å¯åŠ¨çš„è™šæ‹Ÿæœºä½œä¸º NAS ç³»ç»Ÿæ—¶ï¼Œå‘ç°lsblk æ ¹æœ¬æ— æ³•æ‰¾åˆ°æˆ‘çš„ USB ç¡¬ç›˜ æ¢æˆæˆ‘ç¬”è®°æœ¬æ¥ç¡¬ç›˜ç›’ï¼Œèƒ½å¤Ÿæ­£å¸¸è¯†åˆ«å¹¶æŒ‚è½½ç¡¬ç›˜ ä½¿ç”¨ lsusb ä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯ä¹Ÿçœ‹ä¸åˆ°ä»»ä½•å†…å®¹ ä½¿ç”¨ lspci èƒ½æ‰¾åˆ° USB å¯¹åº”çš„ PCI è®¾å¤‡ è¿›ä¸€æ­¥ä½¿ç”¨ cat /proc/modules | grep usb ä¸ lsmod | grep usb å‡æŸ¥ä¸åˆ°ä»»ä½• usb ç›¸å…³çš„å†…æ ¸æ¨¡å— è€Œåœ¨æˆ‘ç¬”è®°æœ¬ä¸Š lsmod | grep usb èƒ½å¤Ÿè¾“å‡º usb_storage usb_core ç­‰å¤šé¡¹å†…æ ¸æ¨¡å—ã€‚ å†ç”¨ modprobe usb ä¼šæç¤ºmodprobe: FATAL: Module usb not found in directory /lib/modules/5.15.0-1021-kvm é—®é¢˜åŸå› å¾ˆæ˜æ˜¾äº†ï¼ŒUbuntu æ ¹æœ¬æ²¡æœ‰ä¸º cloud image é¢„ç½® usb å†…æ ¸æ¨¡å—ï¼Œæ‰€ä»¥æ‰æœ‰è¿™ä¸ªé—®é¢˜â€¦ è¿›ä¸€æ­¥æœç´¢å‘ç°è¿™ä¸ªå¸–å­ï¼šWhatâ€™s the difference between ubuntuâ€™s amd64-disk-kvm.img and the regular amd64.img cloud images?ï¼Œ è§£ç­”äº†æˆ‘çš„ç–‘æƒ‘ã€‚ åŸå› æ˜¯ï¼Œæˆ‘ä½¿ç”¨äº† ubuntu ä¸º cloud ç¯å¢ƒåšäº†ç²¾ç®€çš„ kvm å†…æ ¸ï¼Œéå¸¸è½»é‡ï¼Œä½†æ˜¯ç¼ºå°‘ usb ç­‰å¸¸ç”¨å†…æ ¸æ¨¡å—ã€‚ å¯¹äº NAS å¤–æ¥å­˜å‚¨è¿™ä¸ªåœºæ™¯ï¼Œæˆ‘åº”è¯¥ä½¿ç”¨ä¸ä»¥ kvm ç»“å°¾çš„ ubuntu cloud imageï¼Œæ¢äº†ä¸ªåŸºç¡€é•œåƒåé—®é¢˜å°±è§£å†³äº†~ opensuse cloud image çš„å‘ opensuse leap 15 åªæ”¯æŒ network_config v1ï¼Œå¯¹ v2 çš„æ”¯æŒæœ‰ bugï¼Œgateway4 ä¸ä¼šç”Ÿæ•ˆ debian cloud image çš„å‘debian çš„ cloud é•œåƒæ ¹æœ¬æ²¡æ³•ç”¨ï¼Œå»ºè®®é¿å…ä½¿ç”¨å®ƒã€‚ debian å¯åŠ¨æ—¶ä¼šå½»åº•å¡ä½ï¼Œæˆ–è€…ç›´æ¥æŠ¥é”™ kernel panic åŸå› æ˜¯æ·»åŠ äº† spice å›¾å½¢å¡ï¼Œæ¢æˆ vnc å°±æ­£å¸¸äº† Debian Cloud Images ä¸­çš„ nocloud é•œåƒä¸ä¼šåœ¨å¯åŠ¨æ—¶è¿è¡Œ cloudinitï¼Œcloudinit å®Œå…¨ä¸ç”Ÿæ•ˆ ä¸çŸ¥é“æ˜¯å•¥å‘ï¼Œæ²¡è§£å†³ ","date":"2022-11-27","objectID":"/posts/proxmox-virtual-environment-instruction/:4:5","series":[],"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt","Proxmox"],"title":"Proxmox Virtual Environment ä½¿ç”¨æŒ‡å—","uri":"/posts/proxmox-virtual-environment-instruction/#ubuntu-cloud-image-çš„å‘"},{"categories":["tech"],"content":" 5. cloud image çš„å‘ ubuntu cloud image çš„å‘ ubuntu å¯åŠ¨æ—¶ä¼šæŠ¥é”™ no such device: rootï¼Œä½†æ˜¯è¿‡ä¸€ä¼šå°±ä¼šæ­£å¸¸å¯åŠ¨ã€‚ è¿™æ˜¯ ubuntu cloud image çš„ bug: https://bugs.launchpad.net/cloud-images/+bug/1726476 ubuntu å¯åŠ¨åå¾ˆå¿«å°±ä¼šè¿›å…¥ç™»å½•ç•Œé¢ï¼Œä½†æ˜¯ root å¯†ç å¯èƒ½è¿˜æ²¡æ”¹å¥½ï¼Œç™»å½•ä¼šæŠ¥å¯†ç é”™è¯¯ï¼Œç­‰å¾…ä¸€ä¼šå†å°è¯•ç™»å½•å°± OK äº† ubuntu çš„é»˜è®¤ç½‘å¡åç§°æ˜¯ ens3ï¼Œä¸æ˜¯ eth0ï¼Œæ³¨æ„ä¿®æ”¹ network_config çš„ç½‘å¡åç§°ï¼Œå¦åˆ™ç½‘ç»œé…ç½®ä¸ä¼šç”Ÿæ•ˆ ä»¥ kvm ç»“å°¾çš„ Ubuntu Cloud Image æ— æ³•è¯†åˆ«åˆ° USB è®¾å¤‡ï¼Œå°† USB ç«¯å£æ˜ å°„åˆ°è¯¥è™šæ‹Ÿæœºä¸­æ²¡æœ‰ä»»ä½•ä½œç”¨ã€‚ kvm ä½¿ç”¨äº†ç²¾ç®€ç‰ˆçš„ linux å†…æ ¸ï¼Œå»æ‰äº† USB ç­‰åœ¨äº‘ä¸Šç”¨ä¸åˆ°çš„é©±åŠ¨ï¼Œå»ºè®®æ”¹ç”¨æ—  kvm ç»“å°¾çš„é•œåƒã€‚ ã€ŒUbuntu Cloud Image æ— æ³•è¯†åˆ«åˆ° USB è®¾å¤‡ã€çš„æ’æŸ¥è®°å½•ç°è±¡ï¼š åœ¨å°è¯•ä½¿ç”¨ PVE å°† USB æ¥å£ç›´é€šåˆ° Ubuntu Cloud Image å¯åŠ¨çš„è™šæ‹Ÿæœºä½œä¸º NAS ç³»ç»Ÿæ—¶ï¼Œå‘ç°lsblk æ ¹æœ¬æ— æ³•æ‰¾åˆ°æˆ‘çš„ USB ç¡¬ç›˜ æ¢æˆæˆ‘ç¬”è®°æœ¬æ¥ç¡¬ç›˜ç›’ï¼Œèƒ½å¤Ÿæ­£å¸¸è¯†åˆ«å¹¶æŒ‚è½½ç¡¬ç›˜ ä½¿ç”¨ lsusb ä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯ä¹Ÿçœ‹ä¸åˆ°ä»»ä½•å†…å®¹ ä½¿ç”¨ lspci èƒ½æ‰¾åˆ° USB å¯¹åº”çš„ PCI è®¾å¤‡ è¿›ä¸€æ­¥ä½¿ç”¨ cat /proc/modules | grep usb ä¸ lsmod | grep usb å‡æŸ¥ä¸åˆ°ä»»ä½• usb ç›¸å…³çš„å†…æ ¸æ¨¡å— è€Œåœ¨æˆ‘ç¬”è®°æœ¬ä¸Š lsmod | grep usb èƒ½å¤Ÿè¾“å‡º usb_storage usb_core ç­‰å¤šé¡¹å†…æ ¸æ¨¡å—ã€‚ å†ç”¨ modprobe usb ä¼šæç¤ºmodprobe: FATAL: Module usb not found in directory /lib/modules/5.15.0-1021-kvm é—®é¢˜åŸå› å¾ˆæ˜æ˜¾äº†ï¼ŒUbuntu æ ¹æœ¬æ²¡æœ‰ä¸º cloud image é¢„ç½® usb å†…æ ¸æ¨¡å—ï¼Œæ‰€ä»¥æ‰æœ‰è¿™ä¸ªé—®é¢˜â€¦ è¿›ä¸€æ­¥æœç´¢å‘ç°è¿™ä¸ªå¸–å­ï¼šWhatâ€™s the difference between ubuntuâ€™s amd64-disk-kvm.img and the regular amd64.img cloud images?ï¼Œ è§£ç­”äº†æˆ‘çš„ç–‘æƒ‘ã€‚ åŸå› æ˜¯ï¼Œæˆ‘ä½¿ç”¨äº† ubuntu ä¸º cloud ç¯å¢ƒåšäº†ç²¾ç®€çš„ kvm å†…æ ¸ï¼Œéå¸¸è½»é‡ï¼Œä½†æ˜¯ç¼ºå°‘ usb ç­‰å¸¸ç”¨å†…æ ¸æ¨¡å—ã€‚ å¯¹äº NAS å¤–æ¥å­˜å‚¨è¿™ä¸ªåœºæ™¯ï¼Œæˆ‘åº”è¯¥ä½¿ç”¨ä¸ä»¥ kvm ç»“å°¾çš„ ubuntu cloud imageï¼Œæ¢äº†ä¸ªåŸºç¡€é•œåƒåé—®é¢˜å°±è§£å†³äº†~ opensuse cloud image çš„å‘ opensuse leap 15 åªæ”¯æŒ network_config v1ï¼Œå¯¹ v2 çš„æ”¯æŒæœ‰ bugï¼Œgateway4 ä¸ä¼šç”Ÿæ•ˆ debian cloud image çš„å‘debian çš„ cloud é•œåƒæ ¹æœ¬æ²¡æ³•ç”¨ï¼Œå»ºè®®é¿å…ä½¿ç”¨å®ƒã€‚ debian å¯åŠ¨æ—¶ä¼šå½»åº•å¡ä½ï¼Œæˆ–è€…ç›´æ¥æŠ¥é”™ kernel panic åŸå› æ˜¯æ·»åŠ äº† spice å›¾å½¢å¡ï¼Œæ¢æˆ vnc å°±æ­£å¸¸äº† Debian Cloud Images ä¸­çš„ nocloud é•œåƒä¸ä¼šåœ¨å¯åŠ¨æ—¶è¿è¡Œ cloudinitï¼Œcloudinit å®Œå…¨ä¸ç”Ÿæ•ˆ ä¸çŸ¥é“æ˜¯å•¥å‘ï¼Œæ²¡è§£å†³ ","date":"2022-11-27","objectID":"/posts/proxmox-virtual-environment-instruction/:4:5","series":[],"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt","Proxmox"],"title":"Proxmox Virtual Environment ä½¿ç”¨æŒ‡å—","uri":"/posts/proxmox-virtual-environment-instruction/#ubuntu-cloud-image-æ— æ³•è¯†åˆ«åˆ°-usb-è®¾å¤‡çš„æ’æŸ¥è®°å½•"},{"categories":["tech"],"content":" 5. cloud image çš„å‘ ubuntu cloud image çš„å‘ ubuntu å¯åŠ¨æ—¶ä¼šæŠ¥é”™ no such device: rootï¼Œä½†æ˜¯è¿‡ä¸€ä¼šå°±ä¼šæ­£å¸¸å¯åŠ¨ã€‚ è¿™æ˜¯ ubuntu cloud image çš„ bug: https://bugs.launchpad.net/cloud-images/+bug/1726476 ubuntu å¯åŠ¨åå¾ˆå¿«å°±ä¼šè¿›å…¥ç™»å½•ç•Œé¢ï¼Œä½†æ˜¯ root å¯†ç å¯èƒ½è¿˜æ²¡æ”¹å¥½ï¼Œç™»å½•ä¼šæŠ¥å¯†ç é”™è¯¯ï¼Œç­‰å¾…ä¸€ä¼šå†å°è¯•ç™»å½•å°± OK äº† ubuntu çš„é»˜è®¤ç½‘å¡åç§°æ˜¯ ens3ï¼Œä¸æ˜¯ eth0ï¼Œæ³¨æ„ä¿®æ”¹ network_config çš„ç½‘å¡åç§°ï¼Œå¦åˆ™ç½‘ç»œé…ç½®ä¸ä¼šç”Ÿæ•ˆ ä»¥ kvm ç»“å°¾çš„ Ubuntu Cloud Image æ— æ³•è¯†åˆ«åˆ° USB è®¾å¤‡ï¼Œå°† USB ç«¯å£æ˜ å°„åˆ°è¯¥è™šæ‹Ÿæœºä¸­æ²¡æœ‰ä»»ä½•ä½œç”¨ã€‚ kvm ä½¿ç”¨äº†ç²¾ç®€ç‰ˆçš„ linux å†…æ ¸ï¼Œå»æ‰äº† USB ç­‰åœ¨äº‘ä¸Šç”¨ä¸åˆ°çš„é©±åŠ¨ï¼Œå»ºè®®æ”¹ç”¨æ—  kvm ç»“å°¾çš„é•œåƒã€‚ ã€ŒUbuntu Cloud Image æ— æ³•è¯†åˆ«åˆ° USB è®¾å¤‡ã€çš„æ’æŸ¥è®°å½•ç°è±¡ï¼š åœ¨å°è¯•ä½¿ç”¨ PVE å°† USB æ¥å£ç›´é€šåˆ° Ubuntu Cloud Image å¯åŠ¨çš„è™šæ‹Ÿæœºä½œä¸º NAS ç³»ç»Ÿæ—¶ï¼Œå‘ç°lsblk æ ¹æœ¬æ— æ³•æ‰¾åˆ°æˆ‘çš„ USB ç¡¬ç›˜ æ¢æˆæˆ‘ç¬”è®°æœ¬æ¥ç¡¬ç›˜ç›’ï¼Œèƒ½å¤Ÿæ­£å¸¸è¯†åˆ«å¹¶æŒ‚è½½ç¡¬ç›˜ ä½¿ç”¨ lsusb ä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯ä¹Ÿçœ‹ä¸åˆ°ä»»ä½•å†…å®¹ ä½¿ç”¨ lspci èƒ½æ‰¾åˆ° USB å¯¹åº”çš„ PCI è®¾å¤‡ è¿›ä¸€æ­¥ä½¿ç”¨ cat /proc/modules | grep usb ä¸ lsmod | grep usb å‡æŸ¥ä¸åˆ°ä»»ä½• usb ç›¸å…³çš„å†…æ ¸æ¨¡å— è€Œåœ¨æˆ‘ç¬”è®°æœ¬ä¸Š lsmod | grep usb èƒ½å¤Ÿè¾“å‡º usb_storage usb_core ç­‰å¤šé¡¹å†…æ ¸æ¨¡å—ã€‚ å†ç”¨ modprobe usb ä¼šæç¤ºmodprobe: FATAL: Module usb not found in directory /lib/modules/5.15.0-1021-kvm é—®é¢˜åŸå› å¾ˆæ˜æ˜¾äº†ï¼ŒUbuntu æ ¹æœ¬æ²¡æœ‰ä¸º cloud image é¢„ç½® usb å†…æ ¸æ¨¡å—ï¼Œæ‰€ä»¥æ‰æœ‰è¿™ä¸ªé—®é¢˜â€¦ è¿›ä¸€æ­¥æœç´¢å‘ç°è¿™ä¸ªå¸–å­ï¼šWhatâ€™s the difference between ubuntuâ€™s amd64-disk-kvm.img and the regular amd64.img cloud images?ï¼Œ è§£ç­”äº†æˆ‘çš„ç–‘æƒ‘ã€‚ åŸå› æ˜¯ï¼Œæˆ‘ä½¿ç”¨äº† ubuntu ä¸º cloud ç¯å¢ƒåšäº†ç²¾ç®€çš„ kvm å†…æ ¸ï¼Œéå¸¸è½»é‡ï¼Œä½†æ˜¯ç¼ºå°‘ usb ç­‰å¸¸ç”¨å†…æ ¸æ¨¡å—ã€‚ å¯¹äº NAS å¤–æ¥å­˜å‚¨è¿™ä¸ªåœºæ™¯ï¼Œæˆ‘åº”è¯¥ä½¿ç”¨ä¸ä»¥ kvm ç»“å°¾çš„ ubuntu cloud imageï¼Œæ¢äº†ä¸ªåŸºç¡€é•œåƒåé—®é¢˜å°±è§£å†³äº†~ opensuse cloud image çš„å‘ opensuse leap 15 åªæ”¯æŒ network_config v1ï¼Œå¯¹ v2 çš„æ”¯æŒæœ‰ bugï¼Œgateway4 ä¸ä¼šç”Ÿæ•ˆ debian cloud image çš„å‘debian çš„ cloud é•œåƒæ ¹æœ¬æ²¡æ³•ç”¨ï¼Œå»ºè®®é¿å…ä½¿ç”¨å®ƒã€‚ debian å¯åŠ¨æ—¶ä¼šå½»åº•å¡ä½ï¼Œæˆ–è€…ç›´æ¥æŠ¥é”™ kernel panic åŸå› æ˜¯æ·»åŠ äº† spice å›¾å½¢å¡ï¼Œæ¢æˆ vnc å°±æ­£å¸¸äº† Debian Cloud Images ä¸­çš„ nocloud é•œåƒä¸ä¼šåœ¨å¯åŠ¨æ—¶è¿è¡Œ cloudinitï¼Œcloudinit å®Œå…¨ä¸ç”Ÿæ•ˆ ä¸çŸ¥é“æ˜¯å•¥å‘ï¼Œæ²¡è§£å†³ ","date":"2022-11-27","objectID":"/posts/proxmox-virtual-environment-instruction/:4:5","series":[],"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt","Proxmox"],"title":"Proxmox Virtual Environment ä½¿ç”¨æŒ‡å—","uri":"/posts/proxmox-virtual-environment-instruction/#opensuse-cloud-image-çš„å‘"},{"categories":["tech"],"content":" 5. cloud image çš„å‘ ubuntu cloud image çš„å‘ ubuntu å¯åŠ¨æ—¶ä¼šæŠ¥é”™ no such device: rootï¼Œä½†æ˜¯è¿‡ä¸€ä¼šå°±ä¼šæ­£å¸¸å¯åŠ¨ã€‚ è¿™æ˜¯ ubuntu cloud image çš„ bug: https://bugs.launchpad.net/cloud-images/+bug/1726476 ubuntu å¯åŠ¨åå¾ˆå¿«å°±ä¼šè¿›å…¥ç™»å½•ç•Œé¢ï¼Œä½†æ˜¯ root å¯†ç å¯èƒ½è¿˜æ²¡æ”¹å¥½ï¼Œç™»å½•ä¼šæŠ¥å¯†ç é”™è¯¯ï¼Œç­‰å¾…ä¸€ä¼šå†å°è¯•ç™»å½•å°± OK äº† ubuntu çš„é»˜è®¤ç½‘å¡åç§°æ˜¯ ens3ï¼Œä¸æ˜¯ eth0ï¼Œæ³¨æ„ä¿®æ”¹ network_config çš„ç½‘å¡åç§°ï¼Œå¦åˆ™ç½‘ç»œé…ç½®ä¸ä¼šç”Ÿæ•ˆ ä»¥ kvm ç»“å°¾çš„ Ubuntu Cloud Image æ— æ³•è¯†åˆ«åˆ° USB è®¾å¤‡ï¼Œå°† USB ç«¯å£æ˜ å°„åˆ°è¯¥è™šæ‹Ÿæœºä¸­æ²¡æœ‰ä»»ä½•ä½œç”¨ã€‚ kvm ä½¿ç”¨äº†ç²¾ç®€ç‰ˆçš„ linux å†…æ ¸ï¼Œå»æ‰äº† USB ç­‰åœ¨äº‘ä¸Šç”¨ä¸åˆ°çš„é©±åŠ¨ï¼Œå»ºè®®æ”¹ç”¨æ—  kvm ç»“å°¾çš„é•œåƒã€‚ ã€ŒUbuntu Cloud Image æ— æ³•è¯†åˆ«åˆ° USB è®¾å¤‡ã€çš„æ’æŸ¥è®°å½•ç°è±¡ï¼š åœ¨å°è¯•ä½¿ç”¨ PVE å°† USB æ¥å£ç›´é€šåˆ° Ubuntu Cloud Image å¯åŠ¨çš„è™šæ‹Ÿæœºä½œä¸º NAS ç³»ç»Ÿæ—¶ï¼Œå‘ç°lsblk æ ¹æœ¬æ— æ³•æ‰¾åˆ°æˆ‘çš„ USB ç¡¬ç›˜ æ¢æˆæˆ‘ç¬”è®°æœ¬æ¥ç¡¬ç›˜ç›’ï¼Œèƒ½å¤Ÿæ­£å¸¸è¯†åˆ«å¹¶æŒ‚è½½ç¡¬ç›˜ ä½¿ç”¨ lsusb ä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯ä¹Ÿçœ‹ä¸åˆ°ä»»ä½•å†…å®¹ ä½¿ç”¨ lspci èƒ½æ‰¾åˆ° USB å¯¹åº”çš„ PCI è®¾å¤‡ è¿›ä¸€æ­¥ä½¿ç”¨ cat /proc/modules | grep usb ä¸ lsmod | grep usb å‡æŸ¥ä¸åˆ°ä»»ä½• usb ç›¸å…³çš„å†…æ ¸æ¨¡å— è€Œåœ¨æˆ‘ç¬”è®°æœ¬ä¸Š lsmod | grep usb èƒ½å¤Ÿè¾“å‡º usb_storage usb_core ç­‰å¤šé¡¹å†…æ ¸æ¨¡å—ã€‚ å†ç”¨ modprobe usb ä¼šæç¤ºmodprobe: FATAL: Module usb not found in directory /lib/modules/5.15.0-1021-kvm é—®é¢˜åŸå› å¾ˆæ˜æ˜¾äº†ï¼ŒUbuntu æ ¹æœ¬æ²¡æœ‰ä¸º cloud image é¢„ç½® usb å†…æ ¸æ¨¡å—ï¼Œæ‰€ä»¥æ‰æœ‰è¿™ä¸ªé—®é¢˜â€¦ è¿›ä¸€æ­¥æœç´¢å‘ç°è¿™ä¸ªå¸–å­ï¼šWhatâ€™s the difference between ubuntuâ€™s amd64-disk-kvm.img and the regular amd64.img cloud images?ï¼Œ è§£ç­”äº†æˆ‘çš„ç–‘æƒ‘ã€‚ åŸå› æ˜¯ï¼Œæˆ‘ä½¿ç”¨äº† ubuntu ä¸º cloud ç¯å¢ƒåšäº†ç²¾ç®€çš„ kvm å†…æ ¸ï¼Œéå¸¸è½»é‡ï¼Œä½†æ˜¯ç¼ºå°‘ usb ç­‰å¸¸ç”¨å†…æ ¸æ¨¡å—ã€‚ å¯¹äº NAS å¤–æ¥å­˜å‚¨è¿™ä¸ªåœºæ™¯ï¼Œæˆ‘åº”è¯¥ä½¿ç”¨ä¸ä»¥ kvm ç»“å°¾çš„ ubuntu cloud imageï¼Œæ¢äº†ä¸ªåŸºç¡€é•œåƒåé—®é¢˜å°±è§£å†³äº†~ opensuse cloud image çš„å‘ opensuse leap 15 åªæ”¯æŒ network_config v1ï¼Œå¯¹ v2 çš„æ”¯æŒæœ‰ bugï¼Œgateway4 ä¸ä¼šç”Ÿæ•ˆ debian cloud image çš„å‘debian çš„ cloud é•œåƒæ ¹æœ¬æ²¡æ³•ç”¨ï¼Œå»ºè®®é¿å…ä½¿ç”¨å®ƒã€‚ debian å¯åŠ¨æ—¶ä¼šå½»åº•å¡ä½ï¼Œæˆ–è€…ç›´æ¥æŠ¥é”™ kernel panic åŸå› æ˜¯æ·»åŠ äº† spice å›¾å½¢å¡ï¼Œæ¢æˆ vnc å°±æ­£å¸¸äº† Debian Cloud Images ä¸­çš„ nocloud é•œåƒä¸ä¼šåœ¨å¯åŠ¨æ—¶è¿è¡Œ cloudinitï¼Œcloudinit å®Œå…¨ä¸ç”Ÿæ•ˆ ä¸çŸ¥é“æ˜¯å•¥å‘ï¼Œæ²¡è§£å†³ ","date":"2022-11-27","objectID":"/posts/proxmox-virtual-environment-instruction/:4:5","series":[],"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt","Proxmox"],"title":"Proxmox Virtual Environment ä½¿ç”¨æŒ‡å—","uri":"/posts/proxmox-virtual-environment-instruction/#debian-cloud-image-çš„å‘"},{"categories":["tech"],"content":" 6. å…‹éš†åˆ›å»ºçš„è™šæ‹Ÿæœºï¼Œå¡åœ¨ Booting from Hard Disk... çŠ¶æ€è¢«ç”¨åšæ¨¡æ¿çš„è™šæ‹Ÿæœºå¯ä»¥æ­£å¸¸å¯åŠ¨ï¼Œä½†æ˜¯å…‹éš†çš„è™šæ‹Ÿæœºå°±å¡ä½äº†ã€‚ å¯èƒ½çš„åŸå› ï¼š ç£ç›˜æœ‰é—®é¢˜ï¼Œå‡ºè¿™ä¸ªé—®é¢˜çš„ cloud image æ˜¯ ubuntu-20.10-server-cloudimg-amd64.imgï¼Œæˆ‘æ›´æ¢æˆ ubuntu-20.10-server-cloudimg-amd64-disk-kvm.img å°±æ²¡é—®é¢˜äº†ã€‚ ç£ç›˜é•œåƒå‡ä¸‹è½½è‡ª https://cloud-images.ubuntu.com/releases/groovy/release-20201210/ BIOS ä¸åŒ¹é…ï¼šå°† BIOS ä» SeaBIOS åˆ‡æ¢åˆ° OVMF(UEFI) å¦‚æœä»ç„¶æ— æ³•å¯åŠ¨ï¼Œè¯·è¿›å…¥ OVMF çš„ BIOS ç•Œé¢å…³é—­ã€ŒSecure Bootã€åå†é‡å¯çœ‹çœ‹ ","date":"2022-11-27","objectID":"/posts/proxmox-virtual-environment-instruction/:4:6","series":[],"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt","Proxmox"],"title":"Proxmox Virtual Environment ä½¿ç”¨æŒ‡å—","uri":"/posts/proxmox-virtual-environment-instruction/#6-å…‹éš†åˆ›å»ºçš„è™šæ‹Ÿæœºå¡åœ¨-booting-from-hard-disk-çŠ¶æ€"},{"categories":["tech"],"content":" 7. è™šæ‹Ÿæœºå¯åŠ¨æ—¶ cloudinit æŠ¥é”™ failed to start OpenBSD Secure Shell serveræœ‰å¦‚ä¸‹å‡ ç§å¯èƒ½ï¼š å¯èƒ½æ€§ä¸€ï¼šè™šæ‹Ÿæœºåç§°åŒ…å«éæ³•å­—ç¬¦ pve çš„ cloudinit é…ç½®ä¼šåœ¨å¯åŠ¨æ—¶å°è¯•å°†è™šæ‹Ÿæœº hostname ä¿®æ”¹ä¸ºä¸è™šæ‹Ÿæœºä¸€è‡´ï¼Œä½†æ˜¯åˆæ²¡æœ‰å¯¹è™šæ‹Ÿæœºåç§°åšåˆæ³•æ€§æ ¡éªŒâ€¦ å½“ä½ ä½¿ç”¨çš„è™šæ‹Ÿæœºåç§°åŒ…å«äº†éæ³•å­—ç¬¦æ—¶å°±ä¼šå‡ºè¿™ä¸ªé—®é¢˜ï¼Œæ¯”å¦‚ubuntu-22.10-cloudimage-templateï¼Œå…¶ä¸­çš„ . å°±æ˜¯éæ³•çš„ï¼Œ . åœ¨ DNS ä¸­ç”¨äºåˆ’åˆ†ä¸åŒçš„åŸŸï¼ è§£å†³æ–¹æ³•ï¼šå…‹éš†ä¸ªæ–°è™šæ‹Ÿæœºå¹¶æ”¹ç”¨åˆæ³•åç§°ï¼Œå†åˆ é™¤æ—§è™šæ‹Ÿæœºï¼Œé—®é¢˜å°±è§£å†³äº†ã€‚ å¯èƒ½æ€§äºŒï¼šç£ç›˜ç©ºé—´ä¸è¶³ qcow é•œåƒè½¬æ¢æˆçš„è™šæ‹Ÿæœºç£ç›˜å¾ˆå°ï¼Œåªæœ‰ 2Gï¼Œå¦‚æœä¸æ‰©å®¹ï¼Œå¯åŠ¨æ—¶å°±ä¼šå‡ºå„ç§å¥‡æ€ªçš„é—®é¢˜ã€‚ è§£å†³æ–¹æ³•ï¼šé€šè¿‡ Web UI æ‰©å®¹ç£ç›˜å¤§å°ï¼Œå»ºè®®è‡³å°‘ç»™ 32Gã€‚ ","date":"2022-11-27","objectID":"/posts/proxmox-virtual-environment-instruction/:4:7","series":[],"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt","Proxmox"],"title":"Proxmox Virtual Environment ä½¿ç”¨æŒ‡å—","uri":"/posts/proxmox-virtual-environment-instruction/#7-è™šæ‹Ÿæœºå¯åŠ¨æ—¶-cloudinit-æŠ¥é”™-failed-to-start-openbsd-secure-shell-server"},{"categories":["tech"],"content":" 8. ä¿®æ”¹ Linux è™šæ‹Ÿæœºçš„ Hostnameå¦‚å‰æ‰€è¿°ï¼Œpve çš„ cloudinit é…ç½®ä¼šåœ¨å¯åŠ¨æ—¶å°è¯•å°†è™šæ‹Ÿæœº hostname ä¿®æ”¹ä¸ºä¸è™šæ‹Ÿæœºä¸€è‡´ï¼Œè¿™å¯¼è‡´æ‰‹åŠ¨ä¿®æ”¹æ— æ³•ç”Ÿæ•ˆæ— æ•ˆã€‚ è§£å†³æ–¹æ³•ï¼šä»æ—§çš„è™šæ‹Ÿæœºå…‹éš†ä¸€ä¸ªæ–°è™šæ‹Ÿæœºï¼Œå°†æ–°è™šæ‹Ÿæœºåç§°è®¾ä¸ºä½ æœŸæœ›çš„ hostnameï¼Œç„¶ååˆ é™¤æ—§è™šæ‹Ÿæœºï¼Œå¯åŠ¨æ–°å…‹éš†çš„è™šæ‹Ÿæœºï¼Œå³å®Œæˆäº† hostname é‡å‘½åã€‚ ","date":"2022-11-27","objectID":"/posts/proxmox-virtual-environment-instruction/:4:8","series":[],"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt","Proxmox"],"title":"Proxmox Virtual Environment ä½¿ç”¨æŒ‡å—","uri":"/posts/proxmox-virtual-environment-instruction/#8-ä¿®æ”¹-linux-è™šæ‹Ÿæœºçš„-hostname"},{"categories":["tech"],"content":" 9. è™šæ‹Ÿæœºè¿ç§»æ—¶æŠ¥é”™ Host key verification failed ç¤¾åŒºç›¸å…³å¸–å­ï¼šhttps://forum.proxmox.com/threads/host-key-verification-failed-when-migrate.41666/ è¿™é€šå¸¸æ˜¯å› ä¸ºèŠ‚ç‚¹å¢åˆ ï¼Œæˆ–è€…ä¸å°å¿ƒåŠ¨åˆ°äº† ~/.ssh/known_hosts æ–‡ä»¶ï¼Œå¯¼è‡´çš„é—®é¢˜ã€‚ å¯ä»¥é€šè¿‡æ‰‹åŠ¨åœ¨æ¯å°èŠ‚ç‚¹ä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è§£å†³ï¼š shell ssh -o 'HostKeyAlias=\u003cTarget node Name\u003e' root@\u003cTarget node IP\u003e æ³¨æ„å°†ä¸Šè¿°å‘½ä»¤ä¸­çš„ Target node Name\u003e æ”¹ä¸ºèŠ‚ç‚¹åç§°ï¼Œå°† \u003cTarget node IP\u003e æ”¹ä¸ºèŠ‚ç‚¹ IP åœ°å€ã€‚ ","date":"2022-11-27","objectID":"/posts/proxmox-virtual-environment-instruction/:4:9","series":[],"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt","Proxmox"],"title":"Proxmox Virtual Environment ä½¿ç”¨æŒ‡å—","uri":"/posts/proxmox-virtual-environment-instruction/#9-è™šæ‹Ÿæœºè¿ç§»æ—¶æŠ¥é”™-host-key-verification-failed"},{"categories":["tech"],"content":" 10. PVE çš„ vm ä¸æ”¯æŒ vmx/svm è™šæ‹ŸåŒ–æŒ‡ä»¤é›†åœ¨ Linux è™šæ‹Ÿæœºä¸­è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š shell egrep '(vmx|svm)' --color=always /proc/cpuinfo æœ‰è¾“å‡ºåˆ™è¯´æ˜æ­¤è™šæ‹Ÿæœºæœ¬èº«ä¹Ÿæ”¯æŒ vmx/svm è™šæ‹ŸåŒ–æŒ‡ä»¤é›†ï¼ˆvmx æ˜¯ intel æŒ‡ä»¤é›†ï¼Œsvm æ˜¯ amd çš„æŒ‡ä»¤é›†ï¼‰ã€‚ å¦‚æœæ²¡æœ‰ä»»ä½•è¾“å‡ºï¼Œè¯´æ˜æ­¤è™šæ‹Ÿæœºä¸æ”¯æŒåµŒå¥—è™šæ‹Ÿæœºï¼Œæ— æ³•åœ¨å…¶å†…éƒ¨è¿è¡Œ Hyper-V æˆ–è€… kvm è™šæ‹ŸåŒ–ç¨‹åºã€‚ ä¸€èˆ¬æ¥è¯´ PVE å®¿ä¸»æœºé»˜è®¤å°±ä¼šå¯ç”¨åµŒå¥—è™šæ‹ŸåŒ–åŠŸèƒ½ï¼Œå¯é€šè¿‡å¦‚ä¸‹æŒ‡ä»¤éªŒè¯ï¼š shell # intel ç”¨è¿™ä¸ªå‘½ä»¤ï¼Œè¾“å‡º Y åˆ™è¡¨ç¤ºå¯ç”¨äº†åµŒå¥—è™šæ‹ŸåŒ– cat /sys/module/kvm_intel/parameters/nested # amd ç”¨å¦‚ä¸‹æŒ‡ä»¤ï¼Œè¾“å‡º 1 åˆ™è¡¨ç¤ºå¯ç”¨äº†åµŒå¥—è™šæ‹ŸåŒ– cat /sys/module/kvm_amd/parameters/nested å¦‚æœè¾“å‡ºä¸æ˜¯ Y/1ï¼Œåˆ™éœ€è¦æ‰‹åŠ¨å¯ç”¨åµŒå¥—è™šæ‹ŸåŒ–åŠŸèƒ½ã€‚ å¦‚æœæ˜¯ intel cpuï¼Œéœ€è¦ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯ç”¨åµŒå¥—è™šæ‹ŸåŒ–åŠŸèƒ½ï¼š shell ## 1. å…³é—­æ‰€æœ‰è™šæ‹Ÿæœºï¼Œå¹¶å¸è½½ kvm_intel å†…æ ¸æ¨¡å— sudo modprobe -r kvm_intel ## 2. å¯ç”¨åµŒå¥—è™šæ‹ŸåŒ–åŠŸèƒ½ sudo modprobe kvm_intel nested=1 ## 3. ä¿å­˜é…ç½®ï¼Œä½¿åµŒå¥—è™šæ‹ŸåŒ–åŠŸèƒ½åœ¨é‡å¯åè‡ªåŠ¨å¯ç”¨ cat \u003c\u003cEOF | sudo tee /etc/modprobe.d/kvm.conf options kvm_intel nested=1 EOF å¦‚æœæ˜¯ amd cpuï¼Œåˆ™åº”ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯ç”¨åµŒå¥—è™šæ‹ŸåŒ–åŠŸèƒ½ï¼š shell ## 1. å…³é—­æ‰€æœ‰è™šæ‹Ÿæœºï¼Œå¹¶å¸è½½ kvm_intel å†…æ ¸æ¨¡å— sudo modprobe -r kvm_amd ## 2. å¯ç”¨åµŒå¥—è™šæ‹ŸåŒ–åŠŸèƒ½ sudo modprobe kvm_amd nested=1 ## 3. ä¿å­˜é…ç½®ï¼Œä½¿åµŒå¥—è™šæ‹ŸåŒ–åŠŸèƒ½åœ¨é‡å¯åè‡ªåŠ¨å¯ç”¨ cat \u003c\u003cEOF | sudo tee /etc/modprobe.d/kvm.conf options kvm_amd nested=1 EOF ä¸Šé¢è¿™ä¹ˆä¸€å †æ“ä½œåï¼Œå®¿ä¸»æœºå°±å·²ç»å¯ç”¨äº†åµŒå¥—è™šæ‹ŸåŒ–ï¼Œä½†æ˜¯è™šæ‹Ÿæœºå†…éƒ¨å´ä»ç„¶ä¸ä¸€å®šèƒ½æœ‰è™šæ‹ŸåŒ–æŒ‡ä»¤é›†ã€‚ æ ¹æœ¬åŸå› æ˜¯ PVE é»˜è®¤ä½¿ç”¨ kvm64 è¿™ç§è™šæ‹ŸåŒ–çš„ CPU ç±»å‹ï¼Œå®ƒä¸æ”¯æŒ vmx/svm æŒ‡ä»¤é›†ï¼å°†è™šæ‹Ÿæœºçš„ CPU ç±»å‹æ”¹ä¸º hostï¼Œç„¶åé‡å¯è™šæ‹Ÿæœºï¼Œé—®é¢˜å°±è§£å†³äº†ã€‚ ","date":"2022-11-27","objectID":"/posts/proxmox-virtual-environment-instruction/:4:10","series":[],"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt","Proxmox"],"title":"Proxmox Virtual Environment ä½¿ç”¨æŒ‡å—","uri":"/posts/proxmox-virtual-environment-instruction/#10-pve-çš„-vm-ä¸æ”¯æŒ-vmxsvm-è™šæ‹ŸåŒ–æŒ‡ä»¤é›†"},{"categories":["tech"],"content":" 11. å¦‚ä½•åœ¨å¤šå°ä¸»æœºé—´åŒæ­¥ iso é•œåƒã€backup æ–‡ä»¶PVE è‡ªåŠ¨åˆ›å»ºçš„å¤‡ä»½ï¼Œé»˜è®¤éƒ½åªä¼šä¿å­˜åˆ°æœ¬æœºçš„ local åˆ†åŒºä¸­ï¼Œé‚£ä¸‡ä¸€æœºå™¨å‡ºäº†é—®é¢˜ï¼Œå¾ˆå¯èƒ½å¤‡ä»½å°±ä¸€èµ·ä¸¢äº†ã€‚ä¸ºäº†ç¡®ä¿æ•°æ®å®‰å…¨ï¼Œå°±éœ€è¦åšå¤šæœºå¤‡ä»½ï¼Œæˆ–è€…å°†æ•°æ®ç»Ÿä¸€å¤‡ä»½åˆ°å¦ä¸€ä¸ª NAS ç³»ç»Ÿã€‚ æˆ‘è€ƒè™‘äº†å¦‚ä¸‹å‡ ä¸ªå¤‡ä»½æ–¹æ¡ˆï¼š proxmox-backup-serverï¼šproxmox å®˜æ–¹æ¨å‡ºçš„ä¸€ä¸ªå¤‡ä»½å·¥å…·ï¼Œä½¿ç”¨ rust ç¼–å†™ã€‚ å®ƒçš„ä¸»è¦å¥½å¤„åœ¨äºï¼Œæ”¯æŒç›´æ¥åœ¨ proxmox-ve ä¸­å°†å…¶æ·»åŠ ä¸º cluster çº§åˆ«çš„ storageï¼Œç„¶åå°±å¯ä»¥é€šè¿‡ PVE çš„å®šæ—¶å¤‡ä»½ä»»åŠ¡ï¼Œç›´æ¥å°†æ•°æ®å¤‡ä»½åˆ° proxmox-backup-server ä¸­ã€‚ä½†æ˜¯æˆ‘é‡åˆ°è¿™ä¹ˆå‡ ä¸ªé—®é¢˜ï¼Œå¯¼è‡´æˆ‘æ”¾å¼ƒäº†å®ƒ: ä¸€æ˜¯æˆ‘æƒ³ç›´æ¥æŠŠæ•°æ®é€šè¿‡ SMB åè®®å¤‡ä»½åˆ° Windows Server è¿œç¨‹å­˜å‚¨ä¸­ï¼Œä½†æ˜¯å°† SMB æŒ‚è½½ç£ç›˜ç”¨åš proxmox-backup-server çš„ Datastore ä¼šå‡ºé—®é¢˜ï¼Œå¤‡ä»½æ—¶ pbs ä¼šåˆ›å»ºä¸€äº›ç‰¹æ®Šçš„ä¸´æ—¶æ–‡ä»¶ï¼Œå¯èƒ½è¦ç”¨åˆ° SMB æŒ‚è½½æ’ä»¶ä¸æ”¯æŒçš„ç‰¹æ€§ï¼Œå¯¼è‡´æ“ä½œä¼šå¤±è´¥ã€‚ äºŒæ˜¯æˆ‘çš„ proxmox-backup-server è·Ÿ Windows Server éƒ½è·‘åœ¨ proxmox è™šæ‹Ÿæœºé‡Œé¢ï¼Œé‚£å®ƒå°±ä¸èƒ½å¤‡ä»½å®ƒè‡ªå·±ï¼Œä¸€å¤‡ä»½å°±ä¼šå¡ä½ã€‚ cronab + rclone/rsync: æç®€æ–¹æ¡ˆï¼Œä½¿ç”¨ crontab è·‘å®šæ—¶è„šæœ¬ï¼Œç”¨ rclone/rsync åŒæ­¥æ•°æ®ã€‚æµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š é¦–å…ˆåœ¨ PVE DataCenter =\u003e Backup ä¸­åˆ›å»ºä¸€ä¸ªå®šæœŸå¤‡ä»½ä»»åŠ¡ï¼Œå°†æ‰€æœ‰ vm éƒ½å¤‡ä»½åˆ° local å­˜å‚¨ä¸­ï¼Œå®ƒå®é™…å°±å­˜å‚¨ä½ç½®ä¸ºå®¿ä¸»æœºçš„ /var/lib/vz/dumpã€‚ é€šè¿‡ crontab å®šæ—¶ä»»åŠ¡è·‘è„šæœ¬ï¼Œä½¿ç”¨ rclone å°†æ¯ä¸ªèŠ‚ç‚¹çš„ /var/lib/vz/ ä¸­çš„æ–‡ä»¶å…¨éƒ¨é€šè¿‡ SMB åè®®åŒæ­¥åˆ° HDD ä¸­ã€‚crontab çš„è¿è¡Œæ—¶é—´è®¾ç½®åœ¨ PVE å®Œæˆåä¸ºæœ€ä½³ã€‚å¹¶ä¸”å°†åŒæ­¥æŒ‡æ ‡ä¸Šä¼ åˆ° victoria-metrics ç›‘æ§ç³»ç»Ÿï¼Œå¦‚æœå¤‡ä»½åŠŸèƒ½å¤±æ•ˆï¼Œç›‘æ§ç³»ç»Ÿå°†é€šè¿‡çŸ­ä¿¡æˆ–é‚®ä»¶å‘Šè­¦ã€‚ /var/lib/vz/ ä¸­é™¤äº†å¤‡ä»½æ–‡ä»¶å¤–è¿˜ä¿å­˜äº† iso é•œåƒç­‰æ–‡ä»¶ï¼Œè¿™é‡Œä¹Ÿä¸€èµ·å¤‡ä»½äº†ã€‚ restic: ä¸€ä¸ªæ›´ä¸“ä¸šçš„è¿œç¨‹å¢é‡å¤‡ä»½å·¥å…·ï¼Œé€šè¿‡ rclone æ”¯æŒå‡ ä¹æ‰€æœ‰å¸¸è§åè®®çš„è¿œç¨‹å­˜å‚¨ï¼ˆs3/ssh/smb ç­‰ï¼‰ï¼Œæ”¯æŒå¤šç§å¤‡ä»½ç­–ç•¥ã€ç‰ˆæœ¬ç­–ç•¥ã€ä¿ç•™ç­–ç•¥ï¼Œ æ”¯æŒåŠ å¯†å¤‡ä»½ã€‚ restic çœ‹ç€ç¡®å®æŒºæ£’ï¼Œä½†æ˜¯æ„Ÿè§‰æœ‰ç‚¹å¤æ‚äº†ï¼Œå¾ˆå¤šåŠŸèƒ½æˆ‘éƒ½ä¸éœ€è¦ã€‚PVE è‡ªå¸¦çš„å¤‡ä»½åŠŸèƒ½å·²ç»æä¾›äº†å¤‡ä»½çš„ã€Œä¿ç•™ç­–ç•¥ã€ï¼Œæˆ‘è¿™é‡Œå®é™…åªéœ€è¦ä¸€ä¸ªæ•°æ®åŒæ­¥å·¥å…·ã€‚å› æ­¤æ²¡é€‰æ‹©å®ƒã€‚ å¦‚ä¸Šæ–‡æ‰€è¿°ï¼Œä¸€ç•ªç ”ç©¶åæˆ‘æŠ›å¼ƒäº† proxmox-backup-server ä¸ resticï¼Œæœ€ç»ˆé€‰æ‹©äº†æœ€ç®€å•çš„ cronab + rclone æ–¹æ¡ˆï¼Œç®€å•å®ç”¨åˆç¬¦åˆæˆ‘è‡ªå·±çš„éœ€æ±‚ï¼ˆä»…æˆ‘ä¸ªäººçš„é€‰æ‹©ï¼Œå»ºè®®ç»“åˆéœ€æ±‚è‡ªè¡ŒæŠ‰æ‹©ï¼‰ã€‚ åŒæ­¥è„šæœ¬ä¹Ÿå¾ˆç®€å•ï¼Œé¦–å…ˆé€šè¿‡ rclone config æ‰‹åŠ¨å°†æ‰€æœ‰ PVE èŠ‚ç‚¹åŠ å…¥ä¸º rclone çš„ remoteï¼Œå†å°†æˆ‘çš„ smb è¿œç¨‹å­˜å‚¨åŠ è¿›æ¥ï¼ˆä¹Ÿå¯ä»¥æ‰‹åŠ¨æ”¹ ~/.config/rclone/rclone.confï¼‰ã€‚ è¿™ä¸ªæ–¹æ¡ˆæœ€å¤§çš„ç¼ºç‚¹æ˜¯ï¼Œæ‰€æœ‰å¤‡ä»½éƒ½éœ€è¦ä¿å­˜åœ¨æ¯å°èŠ‚ç‚¹çš„ local å·ä¸­ï¼Œæ‰€ä»¥æœ‰å¿…è¦ç»™ local åˆ†é…è¾ƒå¤§çš„ç£ç›˜ç©ºé—´ï¼Œä¸ç„¶æœºå™¨å¤šçš„è¯å¾ˆå¿«å°±æ»¡äº†â€¦ rclone é…ç½®å¥½åï¼Œæˆ‘å†™äº†ä¸ªå‡ è¡Œçš„ shell è„šæœ¬åšå¤‡ä»½åŒæ­¥ï¼š shell # æˆ‘çš„ä¸‰å° pve èŠ‚ç‚¹ï¼Œå¯¹åº”çš„ rclone remote åç§° declare -a pve_nodes=( \"pve-um560\" \"pve-gtr5\" \"pve-s500plus\" ) # crontab æ‰§è¡Œä»»åŠ¡ï¼Œéœ€è¦æŒ‡å®šä¸‹é…ç½®æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ for node in \"${pve_nodes[@]}\"; do rclone sync --progress \\ --config=/home/ryan/.config/rclone/rclone.conf \\ ${node}:/var/lib/vz \\ smb-downloads:/Downloads/proxmox-backup/${node}/ done # TODO ä¸Šä¼ ç›‘æ§æŒ‡æ ‡åˆ°ç›‘æ§ç³»ç»Ÿï¼Œç”¨äºç›‘æ§ä»»åŠ¡æ˜¯å¦æˆåŠŸã€‚ ç„¶åæ‰‹åŠ¨æ‰§è¡Œ /bin/bash /home/ryan/rclone-sync-to-nas.sh \u003e /home/ryan/rclone-sync.log çœ‹çœ‹æ˜¯å¦è¿è¡Œæ­£å¸¸ã€‚ è¿è¡Œæ²¡é—®é¢˜åï¼Œå†æ·»åŠ è¿™ä¹ˆä¸€ä¸ªæ¯å¤©æ™šä¸Š 5 ç‚¹ï¼ˆUTC 21 ç‚¹ï¼‰å¤šæ‰§è¡Œçš„å®šæ—¶ä»»åŠ¡è¿›è¡ŒåŒæ­¥ï¼Œå°±å®Œæˆäº†ï¼š shell # ä¸ºäº†å‡è¡¡è´Ÿè½½ï¼Œå»ºè®®åˆ†é’Ÿå€¼éšä¾¿å¡«ä¸ªå¥‡æ•°ã€‚ 17 21 * * * /bin/bash /home/ryan/rclone-sync-to-nas.sh \u003e /home/ryan/rclone-sync.log å¯ä»¥æŠŠè¿è¡Œæ—¶é—´è°ƒæ•´åˆ° 1 åˆ†é’Ÿåç¡®è®¤ä¸‹æ•ˆæœï¼Œå¦‚æœè¦çœ‹å®æ—¶æ—¥å¿—å¯ä»¥ç”¨tail -f /home/ryan/rclone-sync.log æŸ¥çœ‹ã€‚ å¦‚æœä»»åŠ¡æœªæ‰§è¡Œï¼Œå¯ä»¥é€šè¿‡ sudo systmctl status cron æŸ¥çœ‹ä»»åŠ¡æ‰§è¡Œæ—¥å¿—ï¼Œæ’æŸ¥é—®é¢˜ã€‚ ","date":"2022-11-27","objectID":"/posts/proxmox-virtual-environment-instruction/:4:11","series":[],"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt","Proxmox"],"title":"Proxmox Virtual Environment ä½¿ç”¨æŒ‡å—","uri":"/posts/proxmox-virtual-environment-instruction/#backup"},{"categories":["tech"],"content":" 12. ä½¿ç”¨ cloud image åˆ›å»ºçš„è™šæ‹Ÿæœºæ‰©å®¹ç£ç›˜å¹¶é‡å¯åï¼Œæ–‡ä»¶ç³»ç»Ÿæœªè‡ªåŠ¨æ‰©å®¹è¿™ä¸ªæˆ‘é‡åˆ°è¿‡å‡ æ¬¡ï¼Œéƒ½æ˜¯å› ä¸ºç£ç›˜å®¹é‡ç”¨å°½ï¼Œå¯¼è‡´ cloudinit æ‰©å®¹è„šæœ¬è¿è¡Œå¤±è´¥ï¼Œåªè¦æ‰‹åŠ¨å›æ”¶äº›ç©ºé—´ï¼Œå†é‡å¯ç³»ç»Ÿï¼Œå°±èƒ½è‡ªåŠ¨æ‰©å®¹ã€‚ æˆ‘è¯•äº†åªè¦èƒ½ç¡®ä¿ç³»ç»Ÿè¿˜å‰©ä½™ 100M å·¦å³çš„å­˜å‚¨ç©ºé—´å°±èƒ½æ­£å¸¸æ‰©å®¹äº†ï¼Œæ›´ä½çš„è¿˜æ²¡è¯•è¿‡ã€‚ å¦‚æœæ•°æ®å®åœ¨ä¸èƒ½æ¸…ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘æ‰‹åŠ¨æ‰©å®¹ï¼Œæœ‰ä¸¤ç§æ–¹æ³•ï¼š ç›´æ¥ä½¿ç”¨ growpart /dev/vda 1 è¿›è¡Œæ‰©å®¹ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç£ç›˜è·¯å¾„ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯åˆ†åŒºå·ï¼Œè¿™é‡Œæ˜¯ 1ï¼Œè¡¨ç¤ºæ‰©å®¹ç¬¬ä¸€ä¸ªåˆ†åŒºã€‚æ­¤å‘½ä»¤ä¼šåŒæ—¶æ‰©å®¹åˆ†åŒºå’Œæ–‡ä»¶ç³»ç»Ÿã€‚ ç”¨ fdisk å…ˆåˆ é™¤åˆ†åŒºï¼Œå†é‡æ–°åˆ›å»ºåˆ†åŒºï¼Œå®ç°ä¿®æ”¹åˆ†åŒºè¡¨æ‰©å®¹ã€‚ç„¶åè¿˜éœ€è¦ç”¨ resize2fs æ‰©å®¹æ–‡ä»¶ç³»ç»Ÿã€‚ç»†èŠ‚è¯·è‡ªè¡Œç½‘ä¸Šæœç´¢æ–‡æ¡£ã€‚ ","date":"2022-11-27","objectID":"/posts/proxmox-virtual-environment-instruction/:4:12","series":[],"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt","Proxmox"],"title":"Proxmox Virtual Environment ä½¿ç”¨æŒ‡å—","uri":"/posts/proxmox-virtual-environment-instruction/#12-ä½¿ç”¨-cloud-image-åˆ›å»ºçš„è™šæ‹Ÿæœºæ‰©å®¹ç£ç›˜å¹¶é‡å¯åæ–‡ä»¶ç³»ç»Ÿæœªè‡ªåŠ¨æ‰©å®¹"},{"categories":["tech"],"content":" å››ã€PVE ç½‘ç»œé…ç½®","date":"2022-11-27","objectID":"/posts/proxmox-virtual-environment-instruction/:5:0","series":[],"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt","Proxmox"],"title":"Proxmox Virtual Environment ä½¿ç”¨æŒ‡å—","uri":"/posts/proxmox-virtual-environment-instruction/#å››pve-ç½‘ç»œé…ç½®"},{"categories":["tech"],"content":" 1. æ¡¥æ¥å¤šå¼ ç‰©ç†ç½‘å¡ç¤ºä¾‹å¦‚ä¸‹ï¼Œä¸»è¦å°±æ˜¯åœ¨ vmbr0 ç½‘æ¡¥çš„ Bridge Ports é‡Œé¢ï¼š æ¡¥æ¥å¤šå¼ ç‰©ç†ç½‘å¡ ","date":"2022-11-27","objectID":"/posts/proxmox-virtual-environment-instruction/:5:1","series":[],"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt","Proxmox"],"title":"Proxmox Virtual Environment ä½¿ç”¨æŒ‡å—","uri":"/posts/proxmox-virtual-environment-instruction/#1-æ¡¥æ¥å¤šå¼ ç‰©ç†ç½‘å¡"},{"categories":["tech"],"content":" 2. æ‰‹åŠ¨æ·»åŠ  USB ç‰©ç†ç½‘å¡ å‚è€ƒå®˜æ–¹æ–‡æ¡£:SysAdmin - Network Configuration æˆ‘é‡åˆ°è¿™ä¸ªé—®é¢˜çš„åœºæ™¯æ˜¯ï¼šæˆ‘çš„ mini ä¸»æœºï¼ˆGTR5ï¼‰åªæœ‰ä¸¤ä¸ª 2.5G ç½‘å¡ï¼Œä¸å¤ªå¤Ÿç”¨ã€‚è€Œå®¶é‡Œçš„è·¯ç”±å™¨å‰©ä¸‹çš„éƒ½æ˜¯åƒå…†ç½‘å£ï¼Œè·¯ç”±å™¨ä¹Ÿéš¾ä»¥æ‹“å±•ç½‘å¡ã€‚ç½‘ä¸Šæœäº†ä¸‹ 2.5G äº¤æ¢æœºåˆå‘ç°ä»·æ ¼ 429 èµ·æ­¥ï¼Œæ‰€ä»¥å†³å®šä¹°ä¸¤å¼  USB 2.5GbE ç½‘å¡æ’åœ¨è¿™å°å°ä¸»æœºä¸Šä½œä¸ºä¾¿å®œçš„ç½‘å£æ‹“å±•æ–¹æ¡ˆã€‚ ç°åœ¨ç½‘å¡æœ‰äº†ï¼Œæœ‰ä¸¤ç§æ–¹å¼å¯ä»¥è®© PVE è¯†åˆ«åˆ°è¿™å¼ ç½‘å¡ï¼š å¥½åƒ PVE å¶å°”ä¹Ÿèƒ½è‡ªåŠ¨è¯†åˆ«åˆ°ç½‘å¡ï¼Œå°±æ˜¯æ¯”è¾ƒæ…¢â€¦ æ–¹æ³•ä¸€ï¼šç›´æ¥é‡å¯æœºå™¨ï¼Œç„¶åå°±èƒ½åœ¨ Web UI çš„ Network é…ç½®ä¸­è§åˆ°è¿™å¼  USB ç½‘å¡äº†ã€‚ä¹‹åç›´æ¥æŠŠè¯¥ç½‘å¡åŠ å…¥åˆ° vmbr ç½‘æ¡¥çš„ Bridge Ports ä¸­å¹¶åº”ç”¨é…ç½®ï¼Œå°±å¤§åŠŸå‘Šæˆäº†ã€‚ æ–¹æ³•äºŒï¼šä¸é‡å¯æœºå™¨å®ç°æ·»åŠ  USB ç½‘å¡ã€‚å¦‚æœæœºå™¨ä¸èƒ½é‡å¯ï¼Œå°±å¯ä»¥èµ°è¿™ä¸ªæµç¨‹ï¼š é¦–å…ˆï¼Œä½¿ç”¨ ip link å‘½ä»¤æ‰“å°å‡ºå½“å‰çš„æ‰€æœ‰ç½‘ç»œæ¥å£ å°† 2.5GbE ç½‘å¡æ’åˆ° USB3.0 ç«¯å£ä¸Šï¼ŒLinux å°†è‡ªåŠ¨è¯†åˆ«åˆ°å®ƒ ç°åœ¨å†ä½¿ç”¨ ip link å‘½ä»¤æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œæ¥å£ï¼Œæ‰¾åˆ°æ–°å¢çš„æ¥å£åç§°ï¼ˆé€šå¸¸åœ¨è¾“å‡ºå†…å®¹æœ€æœ«å°¾ï¼‰ã€‚ åœ¨æˆ‘çš„ç¯å¢ƒä¸­æ–°çš„ USB ç½‘å¡åç§°ä¸º enx00e04c680178 åœ¨é…ç½®æ–‡ä»¶ /etc/network/interfaces çš„æœ«å°¾æ–°å¢ä¸€è¡Œï¼šiface enx00e04c680178 inet manualï¼ˆæ³¨æ„æ›¿æ¢ç½‘å¡åç§°ï¼‰ ç°åœ¨ç›´æ¥åˆ·æ–° Web UI é¡µé¢ï¼Œ USB ç½‘å¡å°±ä¼šå‡ºç°äº†ã€‚ä¹‹åç›´æ¥æŠŠè¯¥ç½‘å¡åŠ å…¥åˆ° vmbr ç½‘æ¡¥çš„Bridge Ports ä¸­å¹¶åº”ç”¨é…ç½®ï¼Œå°±å¤§åŠŸå‘Šæˆäº†ã€‚ ","date":"2022-11-27","objectID":"/posts/proxmox-virtual-environment-instruction/:5:2","series":[],"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt","Proxmox"],"title":"Proxmox Virtual Environment ä½¿ç”¨æŒ‡å—","uri":"/posts/proxmox-virtual-environment-instruction/#2-æ‰‹åŠ¨æ·»åŠ -usb-ç‰©ç†ç½‘å¡"},{"categories":["tech"],"content":" 3. é…ç½® WiFi ç½‘å¡å¦‚æœä¸»æœºè‡ªå¸¦äº† WiFi ç½‘å¡ï¼Œå¯åŠ¨å Proxmox VE èƒ½è¯†åˆ«åˆ°è¯¥ç½‘å¡ï¼Œä½†æ˜¯æ— æ³•é€šè¿‡ Web UI ä¿®æ”¹å®ƒçš„ä»»ä½•é…ç½®ã€‚ é‚£ä¹ˆæœ¬ç€ç‰©å°½å…¶ç”¨çš„ç²¾ç¥ï¼Œè¯¥å¦‚ä½•åˆ©ç”¨ä¸Šè¿™å¼  WiFi ç½‘å¡å‘¢ï¼Ÿ æ ¹æ® PVE å®˜æ–¹æ–‡æ¡£ WLAN - Proxmox VE Docsï¼Œå¹¶ä¸å»ºè®®åœ¨ PVE ä¸Šä½¿ç”¨ WLANï¼Œå®ƒå­˜åœ¨å¦‚ä¸‹é—®é¢˜ï¼š WiFi è‡ªèº«å¿…é¡»æ˜¯ä¸€ä¸ª Linux Bridge è®¾å¤‡ï¼Œæ— æ³•è¢«æ¡¥æ¥åˆ° vmbr0 ç­‰ç½‘æ¡¥ä¸Šã€‚å› ä¸ºå¤§å¤šæ•° Access Point éƒ½ä¼šç›´æ¥æ‹’ç»æ‰æœªæˆæƒçš„æºåœ°å€å‘è¿‡æ¥çš„æ•°æ®åŒ…â€¦ ä¸æœ‰çº¿è¿æ¥ç›¸æ¯”ï¼ŒWiFi çš„å»¶è¿Ÿè¦é«˜å¾—å¤šï¼Œè€Œä¸”å»¶è¿Ÿæ³¢åŠ¨è¾ƒå¤§ã€‚ å› æ­¤ä»…å»ºè®®åœ¨ä¸å¾—å·²çš„æƒ…å†µä¸‹ï¼Œæ‰ä½¿ç”¨ WiFi ç½‘å¡. å¦‚æœè¦é…ç½® WLAN ç½‘å¡çš„è¯ï¼Œå®˜æ–¹å»ºè®®ç›´æ¥å‚è€ƒ Debian çš„å®˜æ–¹æ–‡æ¡£è¿›è¡Œé…ç½®ï¼šHow to use a WiFi interface - Debianï¼Œä¸è¿‡è¿™é‡Œä¹Ÿæ‰¾åˆ°ä¸€ç¯‡ä¸­æ–‡åšå®¢ï¼š proxmoxä¸­ä½¿ç”¨ax210è¿æ¥æ— çº¿ç½‘ç»œ - ä½›è¥¿åšå®¢ ","date":"2022-11-27","objectID":"/posts/proxmox-virtual-environment-instruction/:5:3","series":[],"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt","Proxmox"],"title":"Proxmox Virtual Environment ä½¿ç”¨æŒ‡å—","uri":"/posts/proxmox-virtual-environment-instruction/#3-é…ç½®-wifi-ç½‘å¡"},{"categories":["tech"],"content":" äº”ã€æå‡ PVE çš„å®‰å…¨æ€§","date":"2022-11-27","objectID":"/posts/proxmox-virtual-environment-instruction/:6:0","series":[],"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt","Proxmox"],"title":"Proxmox Virtual Environment ä½¿ç”¨æŒ‡å—","uri":"/posts/proxmox-virtual-environment-instruction/#äº”æå‡-pve-çš„å®‰å…¨æ€§"},{"categories":["tech"],"content":" 1. é…ç½® ACME è¯ä¹¦å¹¶ä½¿å…¶è‡ªåŠ¨æ›´æ–°å¯¹äºä¸ªäººä½¿ç”¨è€Œè¨€ï¼Œä¸é…ç½®è¯ä¹¦å¥½åƒä¹Ÿ okï¼Œè™½ç„¶è®¿é—® Web UI æ—¶æµè§ˆå™¨ä¼šæç¤ºä¸å®‰å…¨ï¼Œä½†ä¹Ÿä¸å½±å“ä½¿ç”¨ã€‚ å¦‚æœä½ æ‹¥æœ‰è‡ªå·±çš„åŸŸåï¼ŒåŒæ—¶ä¹ŸæœŸæœ›æ›´é«˜çš„å®‰å…¨æ€§ï¼Œæ ¹æ®Certificate Management - å®˜æ–¹æ–‡æ¡£ï¼Œpve å¯å€ŸåŠ© acme.sh è¿›è¡Œè¯ä¹¦çš„ç”³è¯·ä¸è‡ªåŠ¨æ›´æ–°ã€‚ TODO ","date":"2022-11-27","objectID":"/posts/proxmox-virtual-environment-instruction/:6:1","series":[],"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt","Proxmox"],"title":"Proxmox Virtual Environment ä½¿ç”¨æŒ‡å—","uri":"/posts/proxmox-virtual-environment-instruction/#1-é…ç½®-acme-è¯ä¹¦å¹¶ä½¿å…¶è‡ªåŠ¨æ›´æ–°"},{"categories":["tech"],"content":" 2. SSH ç¦ç”¨å¯†ç ç™»å½•pve çš„ ssh é»˜è®¤æ˜¯å¯ç”¨äº†å¯†ç ç™»å½•çš„ï¼Œä¸ºäº†å®‰å…¨æ€§ï¼Œå»ºè®®ä¸Šä¼  ssh å¯†é’¥æ”¹ç”¨å¯†é’¥ç™»å½•ï¼Œå¹¶ç¦ç”¨å¯†ç ç™»å½•åŠŸèƒ½ã€‚ è¯¦è§Linux ä¸»æœºå®‰å…¨è®¾ç½®.md - ryan4yin ","date":"2022-11-27","objectID":"/posts/proxmox-virtual-environment-instruction/:6:2","series":[],"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt","Proxmox"],"title":"Proxmox Virtual Environment ä½¿ç”¨æŒ‡å—","uri":"/posts/proxmox-virtual-environment-instruction/#2-ssh-ç¦ç”¨å¯†ç ç™»å½•"},{"categories":["tech"],"content":" 3. ç”¨æˆ·ç®¡ç†PVE æ”¯æŒå¯¹æ¥å¤šç§æˆæƒåè®®ï¼Œå¯¹äºä¸ªäººä½¿ç”¨è€Œè¨€ï¼Œç›´æ¥ä½¿ç”¨ Linux PAM æ˜¯æœ€ç®€å•çš„ã€‚ å³ä½¿æ˜¯åœ¨å†…ç½‘ï¼Œä¸ºäº†å®‰å…¨æ€§ï¼Œä¹Ÿå»ºè®®è®¾ç½®å¤æ‚å¯†ç ï¼ŒåŒæ—¶æ‰€æœ‰è™šæ‹Ÿæœºä¹Ÿå»ºè®®ä»…å¯ç”¨å¯†é’¥ç™»å½•ï¼Œæ‰€æœ‰ Web é¡µé¢éƒ½å»ºè®®è®¾ç½®å¤æ‚å¯†ç ã€‚ï¼ˆç‰¹åˆ«æ˜¯å®¶é‡Œæ²¡æœ‰è®¿å®¢ç½‘ç»œçš„æ—¶å€™â€¦ï¼‰ ","date":"2022-11-27","objectID":"/posts/proxmox-virtual-environment-instruction/:6:3","series":[],"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt","Proxmox"],"title":"Proxmox Virtual Environment ä½¿ç”¨æŒ‡å—","uri":"/posts/proxmox-virtual-environment-instruction/#3-ç”¨æˆ·ç®¡ç†"},{"categories":["tech"],"content":" å…­ã€PCI(e) ç›´é€šï¼ˆæ˜¾å¡ã€ç¡¬ç›˜ã€USB è®¾å¤‡ç­‰ï¼‰QEMU/KVM çš„ PCI(e) ç›´é€šåŠŸèƒ½å¯ä»¥è®©è™šæ‹Ÿæœºç‹¬å æŒ‡å®šçš„ PCI(e) è®¾å¤‡ï¼Œè¶Šè¿‡å®¿ä¸»æœºæ§åˆ¶å™¨ç›´æ¥ä¸è¯¥ PCI(e) è®¾å¤‡é€šä¿¡ã€‚ ç›¸æ¯”ä½¿ç”¨ QEMU/KVM æä¾›çš„ virtio åŠè™šæ‹ŸåŒ–ç¡¬ä»¶ï¼ŒPCI(e) ç›´é€šæœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š å¤§å¤§æå‡è™šæ‹Ÿæœºä¸ PCI(e) è®¾å¤‡çš„ IO æ€§èƒ½ï¼ˆæ›´ä½çš„å»¶è¿Ÿï¼Œæ›´é«˜çš„é€Ÿåº¦ï¼Œæ›´ä½çš„èµ„æºå ç”¨ï¼‰ã€‚ å¯ä»¥åˆ©ç”¨ä¸Š QEMU/KVM æœ¬èº«ä¸æ”¯æŒçš„ç¡¬ä»¶ç‰¹æ€§ï¼Œæ¯”å¦‚ PCI ç›´é€šæœ€å¸¸è§çš„ä½¿ç”¨åœºæ™¯â€”â€”æ˜¾å¡ç›´é€šã€‚ é‚£ä¹ˆæœ€å¸¸è§çš„ PCI(e) ç›´é€šéœ€æ±‚æœ‰ï¼š æ˜¾å¡ç›´é€šï¼Œå®ç°åœ¨å†…éƒ¨ windows ä¸»æœºä¸­ç”¨å®¿ä¸»æœºæ˜¾å¡çœ‹å½±è§†ã€ç©æ¸¸æˆã€å‰ªè§†é¢‘ ç¡¬ç›˜æˆ– USB ç›´é€šï¼Œä»¥æå‡ç¡¬ç›˜æˆ– USB çš„ IO æ€§èƒ½ã€‚ é¦–å…ˆåˆ—ä¸¾ä¸‹ç›¸å…³çš„æ–‡æ¡£ï¼š PCI(e) Passthrough - Proxmox WIKI. GPU OVMF PCI Passthrough (recommended) - Proxmox WIKI QEMU/Guest graphics acceleration - Arch WIKI TODO å®æ“å†…å®¹å¾…è¡¥å……â€¦ ","date":"2022-11-27","objectID":"/posts/proxmox-virtual-environment-instruction/:7:0","series":[],"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt","Proxmox"],"title":"Proxmox Virtual Environment ä½¿ç”¨æŒ‡å—","uri":"/posts/proxmox-virtual-environment-instruction/#å…­pcie-ç›´é€šæ˜¾å¡ç¡¬ç›˜usb-è®¾å¤‡ç­‰"},{"categories":["tech"],"content":" æ‹“å±• - cloudinit é«˜çº§é…ç½®PVE ä½¿ç”¨ CDROM åªè¯»ç›˜(/dev/sr0)æ¥è¿›è¡Œ cloud-init çš„é…ç½®ã€‚åœ¨è™šæ‹Ÿæœºå¯åŠ¨åï¼Œ/dev/sr0 å°†è¢«å¸è½½ã€‚ å¯æŒ‚è½½ä¸Šè¯¥åªè¯»ç›˜ï¼ŒæŸ¥çœ‹å…¶ä¸­çš„åˆå§‹åŒ–é…ç½®å†…å®¹ï¼š shell $ mkdir cloud-config $ mount /dev/sr0 cloud-config mount: /dev/sr0 is write-protected, mounting read-only $ ls cloud-config meta-data network-config user-data æŸ¥çœ‹å…¶ä¸­å†…å®¹ï¼Œä¼šå‘ç° user-data æœ‰å¾ˆå¤šå‚æ•°éƒ½è¢«ç¡¬ç¼–ç äº†ï¼Œæ²¡æœ‰é€šè¿‡ PVE Web Console æš´éœ²å‡ºæ¥ï¼Œå¯¼è‡´æˆ‘ä»¬æ— æ³•è‡ªå®šä¹‰è¿™äº›é…ç½®ã€‚ æ¯”å¦‚å®ƒç¡¬ç¼–ç äº† manage_etc_hosts: trueï¼Œå¼ºåˆ¶æ¯æ¬¡éƒ½ä½¿ç”¨è™šæ‹Ÿæœºçš„åç§°ä½œä¸º hostname. å¦‚æœç¡®è®¤æœ‰ä¿®æ”¹è¿™äº›é…ç½®çš„éœ€æ±‚ï¼Œå®Œå…¨å¯ä»¥ä¿®æ”¹æ‰ PVE ä»£ç é‡Œçš„ç¡¬ç¼–ç å‚æ•°ã€‚é€šè¿‡å…¨æ–‡æœç´¢å³å¯æ‰¾åˆ°ç¡¬ç¼–ç å‚æ•°çš„ä½ç½®ï¼Œä»¥ manage_etc_hosts ä¸ºä¾‹ï¼š shell # åœ¨ /usr/share ä¸­å…¨æ–‡æœç´¢ manage_etc_hosts è¿™ä¸ªå…³é”®å­— grep -r manage_etc_hosts /usr/share ç›´æ¥å°±æœç´¢åˆ°äº†ç¡¬ç¼–ç ä½ç½®æ˜¯ /usr/share/perl5/PVE/QemuServer/Cloudinit.pmï¼Œä¿®æ”¹å¯¹åº”çš„ cloudinit é…ç½®æ¨¡æ¿ï¼Œç„¶åé‡å¯èŠ‚ç‚¹ï¼ˆé‡å¯æ‰èƒ½é‡æ–°åŠ è½½å¯¹åº”çš„ ruby ç¨‹åºï¼‰ï¼Œå³å¯å®ç°å¯¹è¯¥ç¡¬ç¼–ç å‚æ•°çš„ä¿®æ”¹ã€‚ ","date":"2022-11-27","objectID":"/posts/proxmox-virtual-environment-instruction/:8:0","series":[],"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt","Proxmox"],"title":"Proxmox Virtual Environment ä½¿ç”¨æŒ‡å—","uri":"/posts/proxmox-virtual-environment-instruction/#æ‹“å±•---cloudinit-é«˜çº§é…ç½®"},{"categories":["tech"],"content":" æ‹“å±• - è‡ªåŠ¨åŒ–é…ç½®ä¸ç›‘æ§å‘Šè­¦è‡ªåŠ¨åŒ–é…ç½®ç›¸å…³å·¥å…·ï¼š Telmate/terraform-provider-proxmox: ç”¨æˆ·æœ€å¤šï¼Œä½†æ˜¯åªæ”¯æŒç®¡ç†è™šæ‹Ÿæœºèµ„æº danitso/terraform-provider-proxmox: stars å°‘ï¼Œä½†æ˜¯å¯ä»¥ç®¡ç† PVE çš„å¤§éƒ¨åˆ†èµ„æºï¼ŒåŒ…æ‹¬èŠ‚ç‚¹ã€ç”¨æˆ·ã€èµ„æºæ± ã€TLSè¯ä¹¦ç­‰ç­‰ ä»£ç æ›´é¡ºçœ¼ï¼Œä½†æ˜¯ä½œè€…å¿™ï¼Œæ²¡æ—¶é—´åˆå¹¶ prï¼Œå¯¼è‡´ Bug æ›´å¤šä¸€äº›ï¼Œè€Œä¸”å¾ˆä¹…æ²¡æ›´æ–°äº†â€¦ ryan4yin/pulumi-proxmox: æˆ‘ç»´æŠ¤çš„ä¸€ä¸ª proxmox è‡ªåŠ¨é…ç½®å·¥å…·ï¼ˆå¾ˆä¹…æ²¡æ›´æ–°äº†â€¦ï¼‰ Python SDK ç›‘æ§å‘Šè­¦ï¼š prometheus pve exporter: é€šè¿‡ prometheus+grafana ç›‘æ§ PVE é›†ç¾¤ ","date":"2022-11-27","objectID":"/posts/proxmox-virtual-environment-instruction/:9:0","series":[],"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt","Proxmox"],"title":"Proxmox Virtual Environment ä½¿ç”¨æŒ‡å—","uri":"/posts/proxmox-virtual-environment-instruction/#æ‹“å±•---è‡ªåŠ¨åŒ–é…ç½®ä¸ç›‘æ§å‘Šè­¦"},{"categories":["tech"],"content":" æ‹“å±• - PVE è¿è¡Œåœ¨ ARM å¼€å‘ç‰ˆä¸ŠPVE å®˜æ–¹ç›®å‰è¿˜æœªæ¨å‡º ARM æ”¯æŒï¼Œä½†æ˜¯ç¤¾åŒºå·²æœ‰æ–¹æ¡ˆï¼š pimox7 å®‰è£…Armç‰ˆæœ¬çš„Proxmox VE - ä½›è¥¿åšå®¢ Proxmox-Arm64 proxmox ç¤¾åŒºæ¯”è¾ƒæ´»è·ƒï¼Œå»ºè®®å¤šåœ¨ç¤¾åŒºå†…çœ‹çœ‹ç›¸å…³è¿›å±•ã€‚ ","date":"2022-11-27","objectID":"/posts/proxmox-virtual-environment-instruction/:10:0","series":[],"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt","Proxmox"],"title":"Proxmox Virtual Environment ä½¿ç”¨æŒ‡å—","uri":"/posts/proxmox-virtual-environment-instruction/#æ‹“å±•---pve-è¿è¡Œåœ¨-arm-å¼€å‘ç‰ˆä¸Š"},{"categories":["tech"],"content":" æ‹“å±• - å…¶ä»– QEMU/KVM ç›¸å…³çš„è™šæ‹ŸåŒ–å¹³å°PVE æ¯•ç«Ÿæ˜¯ä¸€ä¸ªå•†ä¸šç³»ç»Ÿï¼Œè™½ç„¶ç›®å‰å¯ä»¥å…è´¹ç”¨ï¼Œä½†æ˜¯ä»¥åå°±ä¸ä¸€å®šäº†ã€‚ å¦‚æœä½ æ‹…å¿ƒ PVE ä»¥åä¼šä¸æä¾›å…è´¹ä½¿ç”¨çš„åŠŸèƒ½ï¼Œæˆ–è€…å•çº¯æƒ³æŠ˜è…¾æŠ˜è…¾çš„æŠ€æœ¯ï¼Œè¿˜å¯ä»¥è¯•è¯•ä¸‹é¢è¿™äº›è™šæ‹ŸåŒ–å¹³å°ï¼š webvirtcloud: å…¶å‰èº«æ˜¯ webvirtmgrï¼Œä¸€ä¸ªå®Œå…¨å¼€æºçš„ QEMU/KVM Web UIï¼Œé¢å¤–æä¾›äº†ç”¨æˆ·ç®¡ç†åŠŸèƒ½ã€‚ kubevirt: åŸºäº Kubernetes è¿›è¡Œè™šæ‹ŸåŒ–ç®¡ç† rancher/harvester: Rancher å¼€æºçš„åŸºäº Kubernetes çš„è¶…èåˆå¹³å°(HCI) å…¶åº•å±‚ä½¿ç”¨ kubevirt æä¾›è™šæ‹ŸåŒ–èƒ½åŠ›ï¼Œé€šè¿‡ longhorn æä¾›åˆ†å¸ƒå¼å­˜å‚¨èƒ½åŠ›ã€‚ HCI è¶…èåˆ = è®¡ç®—è™šæ‹ŸåŒ– + ç½‘ç»œè™šæ‹ŸåŒ– + åˆ†å¸ƒå¼å­˜å‚¨ï¼Œå®ƒå’Œä¼ ç»Ÿçš„è™šæ‹ŸåŒ–è½¯ä»¶æœ€å¤§çš„ä¸åŒæ˜¯ï¼š åˆ†å¸ƒå¼å­˜å‚¨ã€‚ ä¼ä¸šçº§åœºæ™¯ä¸‹ä¸€èˆ¬è‡³å°‘å¾— 10GbE ç½‘ç»œ + SSD æ‰èƒ½ hold ä½ HCI è¶…èåˆæ¶æ„ã€‚ è¶…èåˆå¯¹å­˜å‚¨çš„ä¸€äº›è¦æ±‚ï¼š è½¯ä»¶å®šä¹‰ â€“ è§£é™¤ç¡¬ä»¶ç»‘å®šï¼Œå¯é€šè¿‡å‡çº§æ‹“å±•æ›´ä¸°å¯Œçš„åŠŸèƒ½ï¼Œè‡ªåŠ¨åŒ–èƒ½åŠ›é«˜ å…¨åˆ†å¸ƒå¼æ¶æ„ - æ‰©å±•æ€§å¥½ï¼Œæ¶ˆé™¤å•ç‚¹æ•…éšœé£é™© é«˜å¯é æ€§ - æ™ºèƒ½çš„æ•…éšœæ¢å¤åŠŸèƒ½ï¼Œä¸°å¯Œçš„æ•°æ®ä¿æŠ¤æ‰‹æ®µ é«˜æ€§èƒ½ â€“ æ”¯æŒå¤šç§å­˜å‚¨ä»‹è´¨ï¼Œå……åˆ†æŒ–æ˜å’Œåˆ©ç”¨æ–°å¼ç¡¬ä»¶çš„æ€§èƒ½ é«˜åº¦èåˆ â€“ æ¶æ„ç®€å•å¹¶æ˜“äºç®¡ç† è¶…èåˆæ¶æ„å¯ä»¥é™ä½ç§æœ‰äº‘çš„æ„å»ºä¸ç»´æŠ¤éš¾åº¦ï¼Œè®©ç§æœ‰äº‘çš„ä½¿ç”¨ç»´æŠ¤å’Œå…¬æœ‰äº‘ä¸€æ ·ç®€å•ã€‚ è¶…èåˆæ¶æ„ä¸‹ï¼Œè™šæ‹Ÿæœºçš„è®¡ç®—å’Œå­˜å‚¨æ˜¯å®Œå…¨é«˜å¯ç”¨çš„ï¼šè®¡ç®—èµ„æºèƒ½æ™ºèƒ½åŠ¨æ€æ›´æ¢ï¼Œå­˜å‚¨ä¹Ÿæ˜¯åˆ†å¸ƒå¼å­˜å‚¨ï¼Œåº•å±‚è®¡ç®—å’Œå­˜å‚¨ä¹Ÿå¯ä»¥å¾ˆç®€å•çš„æ‰©ç¼©å®¹ã€‚ æˆ‘æ‰“ç®—æœ‰æ—¶é—´åœ¨ PVE é›†ç¾¤é‡Œè·‘ä¸ª rancher/harvester ç©ç© emmmm ","date":"2022-11-27","objectID":"/posts/proxmox-virtual-environment-instruction/:11:0","series":[],"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt","Proxmox"],"title":"Proxmox Virtual Environment ä½¿ç”¨æŒ‡å—","uri":"/posts/proxmox-virtual-environment-instruction/#æ‹“å±•---å…¶ä»–-qemukvm-ç›¸å…³çš„è™šæ‹ŸåŒ–å¹³å°"},{"categories":["tech"],"content":" å‚è€ƒ KVM è™šæ‹ŸåŒ–ç¯å¢ƒæ­å»º - ProxmoxVE KVM è™šæ‹ŸåŒ–ç¯å¢ƒæ­å»º - WebVirtMgr Proxmox Virtual Environment - Proxmox WIKI QEMU - Arch Linux WIKI ä½›è¥¿åšå®¢ - PVE ç›¸å…³: è¿™ä½åšä¸»å†™äº†å¾ˆå¤š pve ç›¸å…³çš„å†…å®¹ï¼Œè€Œä¸”æ¯”è¾ƒæœ‰æ·±åº¦ ","date":"2022-11-27","objectID":"/posts/proxmox-virtual-environment-instruction/:12:0","series":[],"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt","Proxmox"],"title":"Proxmox Virtual Environment ä½¿ç”¨æŒ‡å—","uri":"/posts/proxmox-virtual-environment-instruction/#å‚è€ƒ"},{"categories":["life"],"content":"æˆ‘æœ€è¿‘ç†è§£åˆ°ä¸€ä¸ªäº‹å®â€”â€”è®¸å¤šçŸ¥è¯†æˆ–è€…æŠ€èƒ½ï¼Œéƒ½æ˜¯å¯ä»¥é€šè¿‡æ­£ç¡®çš„å­¦ä¹ æ–¹æ³•ï¼ŒåŠ ä¸ŠçŸ­æ—¶é—´å¤§é‡çš„ç»ƒä¹ ï¼Œå°±èƒ½è¾¾åˆ° 60 åˆ†åŠæ ¼æ ‡å‡†çš„ã€‚è€Œè¿™ä¸ªåŠæ ¼æ°´å¹³ï¼Œç›¸å¯¹äºå®Œå…¨æ²¡æœ‰è¿›è¡Œè¿‡è¿™æ ·è®­ç»ƒçš„å…¶ä»–äººè€Œè¨€ï¼Œ å¯èƒ½å°±å·²ç»å¾ˆæƒŠè‰³äº†ã€‚ å¦‚æœä½ æ€»æ˜¯åŠé€”è€ŒåºŸï¼Œå¯èƒ½åªæ˜¯ä½ å—äº†å¿«é¤å¼çŸ­æœŸå¿«ä¹çš„è¯±æƒ‘è€Œæ”¾å¼ƒï¼Œæˆ–è€…ä½ æ½œæ„è¯†è§‰å¾—å®ƒå¹¶ä¸é‡è¦ä»è€Œæ— æ³•åšæŒã€‚ ","date":"2022-10-05","objectID":"/posts/deliberate-practice/:0:0","series":null,"tags":["å­¦ä¹ ","æ–¹æ³•è®º","èˆ’é€‚åŒº","å»¶è¿Ÿæ»¡è¶³"],"title":"åˆ»æ„ç»ƒä¹ ","uri":"/posts/deliberate-practice/#"},{"categories":["life"],"content":" ä½è¯ä¹‹ä¸€ - è‹±è¯­å£è¯­å—é™äºå›½å†…è‹±è¯­æ•™è‚²çš„æ–¹æ³•ï¼Œå¾ˆå¤šçš„åŒå­¦æœ‹å‹å£è¯­å‘éŸ³éƒ½æ¯”è¾ƒç³Ÿç³•ã€‚ä½†æˆ‘å®è·µå‘ç°ï¼Œçº æ­£è‡ªå·±çš„å£è¯­å‘éŸ³ï¼Œè¾¾åˆ°åˆ° 60 åˆ†æ°´å¹³ï¼Œå¹¶ä¸æ˜¯ä¸€ä»¶å¾ˆéš¾çš„äº‹ã€‚çœŸæ­£çš„é—®é¢˜åœ¨äºï¼Œç»å¤§å¤šæ•°äººä»æ²¡æœ‰å»æŸ¥è¿‡ç›¸å…³èµ„æ–™ã€å¹¶è¿›è¡Œå¤§é‡çš„ç»ƒä¹ ã€‚ æˆ‘å¤§ä¸‰ä¹‹å‰å‘éŸ³ä¹Ÿæƒ¨ä¸å¿ç¹ï¼Œç„¶åå› ä¸ºä¸ªäººå…´è¶£ä¸éœ€æ±‚æƒ³æŠŠè‹±è¯­å­¦å¥½ï¼Œå°±æŸ¥äº†å¾ˆå¤šèµ„æ–™ï¼Œè·Ÿç€æ¶é­”å¥¶çˆ¸ç»™å‡ºçš„è‹±è¯­å£è¯­å­¦ä¹ æ–¹æ³•ï¼ŒèŠ±äº†å¤§æ¦‚ä¸€ä¸ªæœˆçš„æ—¶é—´ä¸“é—¨ç»ƒäº†ä¸€æ³¢ï¼Œæ•ˆæœç«‹ç«¿è§å½±ã€‚ ","date":"2022-10-05","objectID":"/posts/deliberate-practice/:1:0","series":null,"tags":["å­¦ä¹ ","æ–¹æ³•è®º","èˆ’é€‚åŒº","å»¶è¿Ÿæ»¡è¶³"],"title":"åˆ»æ„ç»ƒä¹ ","uri":"/posts/deliberate-practice/#ä½è¯ä¹‹ä¸€---è‹±è¯­å£è¯­"},{"categories":["life"],"content":" ä½è¯ä¹‹äºŒ - ç»ƒå­—æˆ‘å ‚å¼Ÿä¹‹å‰åˆ†äº«è¿‡ä»–ç»ƒå­—çš„ç»å†ç»™æˆ‘ã€‚ ä»–å¤§å­¦ä¹‹å‰çš„å­—è·Ÿæˆ‘ä¸€æ ·ä¸‘ä¸æ‹‰å‡ ã€‚å¤§å­¦æœŸé—´å› ä¸ºæ— èŠï¼Œå°±ä¸“é—¨æŸ¥äº†å¾ˆå¤šèµ„æ–™ï¼Œå®šä¸‹äº†ç»ƒå­—è®¡åˆ’ã€‚ç»Ÿå…±å°±ç»ƒäº†ä¸¤ä¸‰ä¸ªæœˆï¼Œç°åœ¨ä»–å†™çš„å­—çš„ç¾è§‚ç¨‹åº¦ï¼Œå·²ç»åŠæ‰“æˆ‘è¿™ä¸ªèœé¸¡ã€‚ ","date":"2022-10-05","objectID":"/posts/deliberate-practice/:2:0","series":null,"tags":["å­¦ä¹ ","æ–¹æ³•è®º","èˆ’é€‚åŒº","å»¶è¿Ÿæ»¡è¶³"],"title":"åˆ»æ„ç»ƒä¹ ","uri":"/posts/deliberate-practice/#ä½è¯ä¹‹äºŒ---ç»ƒå­—"},{"categories":["life"],"content":" ä½è¯ä¹‹ä¸‰ - å‡è‚¥æˆ‘æœ‰ä¸€ä¸ªåŒæ‘çš„æœ‹å‹ï¼Œä¹Ÿæ˜¯æˆ‘å°å­¦åŒå­¦ã€‚ä»–ä»åˆä¸­å¼€å§‹å°±èƒ–å¾—ä¸è¡Œï¼Œä¸€ç›´åˆ°ç»“å©šå·¥ä½œï¼Œä½“é‡éƒ½æ²¡å‡ä¸‹æ¥ã€‚ ä½†æ˜¯åœ¨å»å¹´å› ä¸ºå©šå§»å˜æ•…ä»¥åŠä¸€äº›å…¶ä»–åŸå› ï¼Œæ¯”è¾ƒå¤±æ„ï¼Œçªç„¶å°±æ‰“ç®—å‡è‚¥ï¼Œå°±å¼€å§‹åšæŒè·‘æ­¥ã€‚ è·‘å¤šè¿œå¿˜äº†ï¼Œå¯èƒ½æ…¢æ…¢åŠ é‡åˆ°æ¯å¤©åå…¬é‡Œå§ã€‚ä»–æ™šé¥­ä¸åƒï¼Œé¥¿äº†å°±ç–¯ç‹‚å–æ°´ã€‚ä¸€å¼€å§‹å› ä¸ºä½“é‡å¤ªé«˜ï¼Œä¸€è¶Ÿä¸‹æ¥è†å…³èŠ‚ç›´æ¥è·‘åˆ°æµ®è‚¿ã€‚ å°±è¿™æ ·åšæŒäº†å¤§æ¦‚ä¸‰ä¸ªæœˆï¼Œç›´æ¥ç˜¦äº† 50 æ–¤ï¼Œæ•´ä¸ªäººæ¸…çˆ½å¸…æ°”å¤ªå¤šäº†ã€‚ ","date":"2022-10-05","objectID":"/posts/deliberate-practice/:3:0","series":null,"tags":["å­¦ä¹ ","æ–¹æ³•è®º","èˆ’é€‚åŒº","å»¶è¿Ÿæ»¡è¶³"],"title":"åˆ»æ„ç»ƒä¹ ","uri":"/posts/deliberate-practice/#ä½è¯ä¹‹ä¸‰---å‡è‚¥"},{"categories":["life"],"content":" ç»“è¯­ç»å¸¸å¬äººè¯´è¦ã€Œè¸å‡ºèˆ’é€‚åŒºã€ã€ã€Œå»¶è¿Ÿæ»¡è¶³ã€ï¼Œå…¶å®æ˜¯ä¸€ä¸ªé“ç†ã€‚ å³ä½¿æŒæ¡äº†æ­£ç¡®çš„ç»ƒä¹ æ–¹æ³•ï¼Œå¦‚æœå› ä¸ºåšæŒäº†ä¸‰å¤©å‘ç°æ²¡æ•ˆæœï¼Œå°±åšæŒä¸ä¸‹å»äº†ï¼Œé‚£æ— è®ºå¦‚ä½•éƒ½ä¸ä¼šæœ‰å¥½çš„æ•ˆæœã€‚å¯å¦‚æœæŠŠè¿™ä¸ªæ—¶é—´æ”¾å¤§åå€â€”â€”ä¸‰åå¤©ï¼Œè§†ç›®æ ‡çš„éš¾åº¦ï¼Œå°±ä¼šå¼€å§‹å‡ºç°æ¯”è¾ƒæ˜æ˜¾çš„æ•ˆæœäº†ã€‚ å¦‚æœä½ å¯¹è‡ªå·±æ¯”è¾ƒç‹ ï¼ˆé«˜å¼ºåº¦ç»ƒä¹ ï¼‰ï¼Œå†æŠŠåšæŒçš„æ—¶é—´å†æ”¾å¤§åˆ°ä¸‰ä¸ªæœˆï¼Œä½ çš„æŠ€èƒ½æ°´å¹³å°±èƒ½è·å¾—ç›¸å½“æ˜¾è‘—çš„æå‡ï¼å°±åƒæˆ‘é‚£ä½å‡è‚¥çš„æœ‹å‹ã€æˆ‘ç»ƒå­—çš„å ‚å¼Ÿä¸€æ ·ï¼ ä¸‰ä¸ªæœˆçš„æ—¶é—´ï¼Œå¯¹äºå­¦ä¹ ä¸€é¡¹æŠ€èƒ½è€Œè¨€ï¼ŒçœŸçš„æ˜¯å¾ˆçŸ­çš„ä¸€æ®µæ—¶é—´ï¼Œä½†æ˜¯å´æœ‰èƒ½åŠ›ä½¿ä½ å…¥é—¨ä¸€é¡¹ç»ˆç”Ÿå—ç›Šçš„æŠ€èƒ½ã€‚å¯¹æœªæ¥çš„è‡ªå·±å¥½ä¸€ç‚¹ï¼Œå¤šæŠ•èµ„æŠ•èµ„è‡ªå·±ï¼Œè¯¸å›å…±å‹‰ã€‚ ","date":"2022-10-05","objectID":"/posts/deliberate-practice/:4:0","series":null,"tags":["å­¦ä¹ ","æ–¹æ³•è®º","èˆ’é€‚åŒº","å»¶è¿Ÿæ»¡è¶³"],"title":"åˆ»æ„ç»ƒä¹ ","uri":"/posts/deliberate-practice/#ç»“è¯­"},{"categories":["life"],"content":" å‚è€ƒ Deliberate Practice: Achieve Mastery in Anything - Youtube ","date":"2022-10-05","objectID":"/posts/deliberate-practice/:5:0","series":null,"tags":["å­¦ä¹ ","æ–¹æ³•è®º","èˆ’é€‚åŒº","å»¶è¿Ÿæ»¡è¶³"],"title":"åˆ»æ„ç»ƒä¹ ","uri":"/posts/deliberate-practice/#å‚è€ƒ"},{"categories":["life"],"content":" ä¸€ã€ç¼˜èµ·ä¸å­¦ä¹ ç›®æ ‡å·¥ä½œäº†ä¸‰å¹´å¤šäº†ï¼Œæˆ‘çš„è‹±è¯­é˜…è¯»æ°´å¹³å¤§è‡´ä¸€ç›´å¤„åœ¨ã€Œèƒ½è¾ƒæµç•…åœ°é˜…è¯»å„ç±»æŠ€æœ¯æ–‡æ¡£ï¼Œä½†æ˜¯é˜…è¯»ä¸ç†è§£é€Ÿåº¦ä¸å¤Ÿå¿«ã€çš„ç¨‹åº¦ã€‚å·¥ä½œä»¥æ¥æ²¡æœ‰ä¸“é—¨å»å­¦è¿‡è‹±è¯­ï¼Œä¸è¿‡ä¼šæœ‰æ„è¯†åœ°å°½é‡å»é˜…è¯»è‹±æ–‡æŠ€æœ¯æ–‡æ¡£ã€è‹±æ–‡æŠ€æœ¯ä¹¦ç±ï¼Œæˆ–è€…åœ¨ Youtube ä¸Šæ‰¾ä¸€äº›å›½é™…æŠ€æœ¯ä¼šè®®è§†é¢‘å­¦ä¹ ï¼ˆå¦‚ KubeConã€IstioConï¼‰ï¼Œæ‰€ä»¥è¿™ä¸‰å¹´å¤šæˆ‘çš„è‹±è¯­æ°´å¹³æå‡åº”è¯¥æ˜¯æœ‰ä¸€ä¸ªç¼“æ…¢çš„æå‡ã€‚ è¿™å‘¨äº”çš„æ—¶å€™ï¼ˆæ˜¯çš„å°±æ˜¯ 2022-09-02ï¼‰ï¼Œå¶ç„¶å‘ç°è‡ªå·±æ‰‹æœºé‡Œè¿˜è£…äº†ä¸ªè‹±è¯­æµåˆ©è¯´ APPï¼Œå®‰è£…äº†ä¸¤å¹´å¤šä½†ä¸€ç›´æ²¡ç¢°è¿‡å®ƒ emmmm çªç„¶æ¥äº†å…´è¶£å°±æ‰“ç®—è¯•ç”¨ä¸€æ³¢ï¼Œç”±æ­¤å¼€å§‹äº†æˆ‘çš„é‡å­¦è‹±è¯­ä¹‹æ—…â€¦ é¦–å…ˆè‚¯å®šæ˜¯è¦æµ‹è¯•ä¸€ä¸‹è‡ªå·±çš„è‹±æ–‡æ°´å¹³ï¼Œç¡®å®šè‹±è¯­å­¦ä¹ çš„èµ·ç‚¹ã€‚æµåˆ©è¯´ APP æŠŠè‹±è¯­åˆ†æˆ 7 ä¸ª Levelï¼Œ å®ƒè¯„ä»·æˆ‘å±äº Lv.5ï¼Œå¤§è‡´å¯¹åº” CEFR è¯„çº§ B2ã€‚äº”ä¸ªè¯„çº§ç»´åº¦ä¸­æˆ‘çš„å‘éŸ³æ˜¯æœ€å¥½çš„ï¼Œå£è¯­æ˜¯æœ€å·®çš„ã€‚è€Œè¯æ±‡é‡å¤§æ¦‚åœ¨ 5000 è¿™ä¸ªæ¡£ä½ï¼ˆæˆ‘è§‰å¾—å¦‚æœç®—ä¸Šæˆ‘æ‡‚çš„è®¡ç®—æœºåè¯å¯èƒ½ä¼šæ›´é«˜äº› emmmmï¼‰ã€‚ æµ‹å‡ºçš„ç»“æœè·Ÿæˆ‘çš„è‡ªæˆ‘æ„Ÿè§‰åŸºæœ¬å»åˆã€‚ä¹‹å‰æœ‰è·Ÿ AWS å·¥ç¨‹å¸ˆåšè¿‡å‡ æ¬¡è‹±è¯­æ²Ÿé€šï¼Œå‘ç°æˆ‘çš„å£è¯­å‹‰å¼ºå¯ä»¥æ”¯æ’‘æ—¥å¸¸æŠ€æœ¯æ²Ÿé€šï¼Œä½†æ˜¯æ„Ÿè§‰å¾ˆè´¹åŠ²ï¼ŒåŸå› æ˜¾ç„¶æ˜¯å£è¯­åŸºæœ¬æ²¡æ€ä¹ˆç»ƒè¿‡ã€‚è€Œæˆ‘çš„å‘éŸ³ä¹‹æ‰€ä»¥è¿˜ä¸é”™ï¼Œ ä¸»è¦æ˜¯å¤§ä¸‰çš„æ—¶å€™ä¸“é—¨è·Ÿç€å¥¶çˆ¸æ¨èçš„ã€Šèµ–ä¸–é›„ç¾è¯­éŸ³æ ‡ã€‹ã€ã€ŠAmerican Spoken Englishã€‹ç­‰èµ„æ–™ç»ƒä¹ è¿‡ï¼Œæˆ‘å½“æ—¶è¿˜å†™è¿‡ç¯‡æ–‡ç« è®²è¿™ä¸ªâ€”â€”å­¦è‹±è¯­å•Šå­¦è‹±è¯­ã€‚ å…ˆä¸æç»†èŠ‚ï¼Œæ€»ä¹‹æˆ‘å°±æ˜¯è¿™ä¹ˆç€ï¼Œçªç„¶å¯¹å­¦è‹±è¯­åˆæ¥äº†å…´è¶£~ å½“å¤©å°±æ·±å…¥æ¢ç´¢äº†ä¸‹è‹±è¯­æµåˆ©è¯´è¿™ä¸ª APPï¼ŒåˆèŠ± 49 å…ƒä¹°äº†ä¸€ä¸ªæœˆçš„ã€Œæ‡‚ä½ è‹±è¯­ A+ ä¸ªæ€§åŒ–å­¦ä¹ è®¡åˆ’ã€ï¼Œè¿™ä¸ªè®¡åˆ’è¿˜ç»™åˆ†é…å¾®ä¿¡å­¦ä¹ ç¤¾ç¾¤è·Ÿç­ä¸»ä»»ï¼Œæ¯å¤©åšæŒ 30 åˆ° 60 åˆ†é’Ÿã€‚ç¬¬ä¸€å¤©ä½“éªŒè¿™ä¸ªå­¦ä¹ è®¡åˆ’ï¼Œæ„Ÿè§‰ç¡®å®è·Ÿæˆ‘æ¯”è¾ƒå¥‘åˆï¼Œè€Œä¸”ä¹Ÿä¸æ¯ç‡¥ï¼Œæ‰“ç®—åšæŒä¸€ä¸ªæœˆè¯•è¯•ã€‚ æœ€åï¼Œä¸ºäº†æ›´æœ‰ç›®çš„æ€§åœ°æå‡è‡ªå·±çš„è‹±è¯­ï¼Œæˆ‘æ€»ç»“äº†ä¸‹æˆ‘æ­¤æ¬¡ã€Œé‡å­¦è‹±è¯­ã€çš„ç›®çš„ï¼Œä»¥åŠå½“å‰çš„æ°´å¹³ ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰ï¼š èƒ½æµç•…åœ°ç”¨è‹±è¯­äº¤æµï¼šæµåˆ©è¯´æµ‹è¯•æ˜¾ç¤ºæˆ‘è¿™é¡¹æŠ€èƒ½å¾ˆå·®ï¼ŒäºŸå¾…æå‡ã€‚ æµç•…é˜…è¯»å„ç±»è‹±æ–‡èµ„æ–™ï¼šæˆ‘ç›®å‰å¯ä»¥æ— éšœç¢é˜…è¯»å¤§å¤šæ•°ç¼–ç¨‹ç›¸å…³çš„è‹±æ–‡åšå®¢è·Ÿæ–‡æ¡£ï¼Œä½†æ˜¯é˜…è¯»é€Ÿåº¦ä¸å¤Ÿå¿«ï¼Œæœ‰äº›é•¿å¥ç»å¸¸è¦è¯»å¥½å‡ æ¬¡æ‰èƒ½ç†è§£å¤§æ„ã€‚å¦å¤–è¯æ±‡é‡åä½ï¼ŒéæŠ€æœ¯ç±»çš„èµ„æ–™æˆ‘è¯»èµ·æ¥éå¸¸åƒåŠ›ã€‚ æ— éšœç¢çœ‹ç¾å‰§ï¼šæˆ‘çš„å¬åŠ›æ°´å¹³è·Ÿè¯æ±‡æ°´å¹³å¤§æ¦‚å·®ä¸å¤šï¼Œçœ‹ç¾å‰§è¿˜æ˜¯å¾—æœ‰ä¸ªè‹±æ–‡å­—å¹•ï¼Œè¿˜éœ€è¦æå‡ã€‚ å†™è‹±æ–‡åšå®¢ï¼šé«˜ä¸­æ¯•ä¸šåå°±æ²¡å­¦è¿‡è¯­æ³•ï¼Œä¹Ÿæ²¡æ€ä¹ˆç»ƒè¿‡å†™ä½œï¼Œè¯æ±‡é‡åˆä½ï¼Œæˆ‘çš„å†™ä½œèƒ½åŠ›æ˜¾ç„¶è¿˜æœ‰å¾ˆå¤§çš„æå‡ç©ºé—´ã€‚ ","date":"2022-09-04","objectID":"/posts/learn-english-again/:0:1","series":null,"tags":["è‹±è¯­","è¯­è¨€å­¦ä¹ "],"title":"Learn English Again","uri":"/posts/learn-english-again/#ä¸€ç¼˜èµ·ä¸å­¦ä¹ ç›®æ ‡"},{"categories":["life"],"content":" äºŒã€è‹±è¯­è‡ªå­¦è·¯çº¿å®Œå…¨æŒ‡å—å› ä¸ºæœ€è¿‘å¯¹è‹±è¯­æ¥äº†ç”µï¼Œå°±æ‰“ç®—æ·±å…¥äº†è§£ä¸‹å¸‚é¢ä¸Šå¸¸è§çš„è‹±è¯­å­¦ä¹ è·¯å¾„ï¼Œäº‰å–æ‰¾åˆ°æœ€ä½³å­¦ä¹ è·¯çº¿ã€‚ 1. ä¸èŠ±é’±çš„è‡ªå­¦è·¯çº¿é¦–å…ˆæ˜¯ä¸èŠ±é’±çš„è‡ªå­¦è·¯çº¿ï¼Œè¿™ä¸ªæˆ‘åœ¨å¤§ä¸‰æ—¶æœ‰è¿‡å®è·µï¼Œå½“æ—¶æ‰“ç®—è€ƒç ”ï¼Œä¸“é—¨ç»ƒè¿‡ä¸€æ³¢è‹±è¯­ï¼Œå¤§è‡´è·¯çº¿æ˜¯è¿™æ ·çš„ï¼š æ¶é­”å¥¶çˆ¸æ€»ç»“çš„ ç»ƒä¹ è‹±è¯­å£è¯­çš„åŠæ³•ï¼Œæœ¬äººå®æµ‹æ•ˆæœæ˜¾è‘— å…¶ä¸­ä»‹ç»çš„ ESLPodã€EnglishPod ç­‰ææ–™ï¼Œä¸ä»…å¯ä»¥æå‡è¯­æ„Ÿï¼Œä¹Ÿèƒ½å¸®åŠ©æå‡å¬åŠ›ã€‚ å¦‚æœæ˜¯è¿›é˜¶çš„è¯ï¼Œå¯ä»¥å» Youtube ä¸Šçœ‹ä¸€äº›æµè¡Œçš„ Talk Showï¼Œè¿™ç±»è§†é¢‘å¾ˆæœ‰æ„æ€ã€è¯­é€Ÿå¿«ä¿¡æ¯é‡åˆå¤§ï¼Œæ˜¯å¾ˆåˆé€‚çš„è¿›é˜¶å­¦ä¹ ææ–™ ä»¥çœ‹è§†é¢‘çš„æ–¹å¼å­¦è‹±è¯­ï¼Œä¸€ä¸ªè¦ç‚¹å°±æ˜¯ã€Œé‡å¤ã€æˆ–è€…è¯´ã€Œç²¾å¬ã€ã€‚ ã€Œä¸€ç‚¹è‹±è¯­ã€å°±æ˜¯åœ¨è¿™ä¸Šé¢ä¸‹äº†ä¸å°‘åŠŸå¤«ï¼Œè¦é€‰é‚£ç§ç¬¬ä¸€éå¬æœ‰éš¾åº¦çš„è§†é¢‘ï¼Œæœ€å¥½å†…å®¹è¿˜æ¯”è¾ƒæœ‰è¶£ ï¼ˆæ¯”å¦‚ Talk Show å°±æ¯”è¾ƒæœ‰æ„æ€ï¼‰ã€‚ å¯è¡Œçš„å­¦ä¹ æ–¹æ³•ï¼šç¬¬ä¸€éå¸¦å­—å¹•çœ‹è§†é¢‘ï¼Œä½†æ˜¯å°½é‡åˆ«çœ‹å­—å¹•ï¼›ç¬¬äºŒéå¸¦å­—å¹•åå¤ç²¾çœ‹å¬ä¸æ‡‚çš„éƒ¨åˆ†ï¼Œç¬¬ä¸‰éå†å®Œå…¨å…³æ‰å­—å¹•éªŒè¯å­¦ä¹ æ•ˆæœã€‚ è¿˜æœ‰å°±æ˜¯å¾ˆå¤šäººæ¨èçš„é˜…è¯»è‹±æ–‡åŸç‰ˆä¹¦ ä¸€å¼€å§‹å¯èƒ½ä¼šè¯»å¾—å¾ˆæ…¢ï¼Œè¿™ä¸ªæ—¶å€™æœ€é‡è¦çš„å°±æ˜¯åšæŒï¼é˜…è¯»é‡ä¸Šæ¥äº†ï¼Œé€Ÿåº¦è‡ªç„¶å°±æå‡äº†ã€‚ è®©è‡ªå·±æ›´å®¹æ˜“åšæŒçš„é˜…è¯»æ–¹æ³•ï¼š è¦æ‰¾ä¸€äº›ä½ æ„Ÿå…´è¶£çš„ã€éš¾åº¦é€‚ä¸­çš„åŸç‰ˆä¹¦ï¼ˆæ¯”å¦‚æ„Ÿå…´è¶£çš„å°è¯´ã€ä¸“ä¸šç›¸å…³çš„æŠ€æœ¯ä¹¦ç­‰ï¼‰ã€‚å› ä¸ºé˜…è¯»çš„é¦–è¦ç‚¹æ˜¯è¦èƒ½æ„Ÿå—åˆ°ä¹è¶£ï¼Œå¦åˆ™ä¼šå¾ˆæ¯ç‡¥ï¼Œå¾ˆéš¾åšæŒã€‚ ç„¶åè¦åšå¥½è§„åˆ’å¹¶åšæŒæ‰§è¡Œï¼Œæ¯”å¦‚æ¯å¤©è¯» 10 é¡µã€‚ å½“ç„¶ä½ ä¹Ÿå¯ä»¥èµ°ä¼ ç»Ÿçš„èƒŒå•è¯ã€è¯ç»„ã€ä¾‹å¥è¿™æ ·çš„è·¯çº¿ï¼Œè¿™æ¡è·¯çº¿çš„å¥½å¤„æ˜¯èƒ½å¿«é€Ÿæå‡è‡ªå·±çš„è‹±è¯­èƒ½åŠ›ï¼Œä½†æ˜¯ç›¸å¯¹çš„ä¹Ÿå¾ˆéš¾åšæŒã€‚ å¸¸è§çš„æœ‰æ–°ä¸œæ–¹çš„è¯æ±‡å½•æ’­è¯¾ï¼ˆç½‘ä¸Šèƒ½æ‰¾åˆ°å…è´¹çš„èµ„æ–™åˆ†äº«ï¼‰ï¼Œä»¥å‰å¬è¿‡æ–°ä¸œæ–¹æœ±ä¼Ÿè€å¸ˆçš„ã€Šæ‹ç»ƒæœ‰è¯ã€‹ï¼Œæ„Ÿè§‰æŒºä¸é”™çš„ã€‚ ä¸èƒŒå•è¯ã€ç™¾è¯æ–©è¿™ç±» APP ä¹Ÿå¯ä»¥è¯•è¯•ï¼Œä¸è¿‡æˆ‘ä¸ªäººä½“éªŒæ˜¯åŸºæœ¬åšæŒä¸äº†å¤šä¹…â€¦ æ¯æ—¥è‹±è¯­å¬åŠ› è·Ÿæ¬§è·¯è¯å…¸æ˜¯åŒä¸€å®¶å…¬å¸åšçš„ï¼Œå¾ˆè‰¯å¿ƒã€‚ ä¸è¿‡å› ä¸ºæˆ‘å·²ç»ä¹°äº†å…¶ä»–è¯¾ç¨‹äº†ï¼Œè¿™ä¸ª APP ç›®å‰ç”¨å¾—æ¯”è¾ƒå°‘ã€‚ æ¯æ—¥è‹±è¯­å¬å†™ Daily English Dictation 1-400 è¿™æ˜¯ Youtube ä¸Šç›¸å½“ç«çš„ä¸€ä¸ªè‹±è¯­å¬å†™ç³»åˆ—è§†é¢‘ï¼Œåšå¾—éå¸¸æ£’ï¼ŒåšæŒå¬å®Œ 400 æœŸï¼Œå¬åŠ›å°±ç¥åŠŸå¤§æˆäº†ï¼ ä¸ªäººæ„Ÿè§‰èµ·ç å¾—æœ‰ä¸ª CET4 æ°´å¹³ï¼Œæ‰èƒ½æ¯”è¾ƒèˆ’æœåœ°è·Ÿè¿™ä¸ªè¯¾ç¨‹ã€‚ ä¸€äº›å¯¹è¯ã€è§’è‰²è®¾å®šã€ä¸–ç•Œè§‚è®¾å®šè¾ƒå¤šçš„æ¸¸æˆä¹Ÿæ˜¯å­¦è‹±è¯­çš„å¥½ææ–™ï¼Œæ¯”å¦‚ã€ŒGenshin Impactã€ã€ã€ŒDEEMO 2ã€ï¼Œæˆ–è€…ä¸€äº› Galgame éƒ½å¯ã€‚å¨±ä¹è·Ÿè‹±è¯­ä¸¤ä¸è¯¯ emmm Genshin Impact é‡Œè¶…é£’çš„é‡å‰‘å¥³ä»† Noelle DEEMO 2 ä¸­ä¸°å¯Œçš„å¯¹è¯å†…å®¹ DEEMO 2 çš„ä¸€äº›è®¾å®š ä¸Šé¢ä¸»è¦æ˜¯é’ˆå¯¹ CET4 å››çº§ä»¥ä¸Šæ°´å¹³çš„è‹±è¯­å­¦ä¹ è€…ï¼Œå¦‚æœåŸºç¡€æ¯”è¾ƒå·®ï¼Œå¯ä»¥è€ƒè™‘æŒ‰ç…§æ¶é­”å¥¶çˆ¸æ¨èçš„é›¶åŸºç¡€è‹±è¯­å­¦ä¹ è·¯çº¿è¿›è¡Œè‡ªå­¦ï¼š è‹±è¯­ï¼šå£¹ç«  - æ¶é­”å¥¶çˆ¸ï¼šé’ˆå¯¹é›¶åŸºç¡€/åŸºç¡€è¶…çº§ä¸å¥½çš„åŒå­¦ è‹±è¯­ï¼šè´°ç«  - æ¶é­”å¥¶çˆ¸ï¼šé’ˆå¯¹å¤„äºè‹±è¯­åˆçº§é˜¶æ®µçš„åŒå­¦ è‹±è¯­ï¼šåç«  - æ¶é­”å¥¶çˆ¸ï¼šé’ˆå¯¹å¤§å­¦å››å…­çº§æ°´å¹³çš„åŒå­¦ ï¼ˆå°±è·Ÿæˆ‘ä¸Šé¢åˆ—çš„å·®ä¸å¤šäº†ï¼‰ 2. èŠ±é’±æŠ„æ·å¾„è€Œå¯¹äºæˆ‘è¿™ç§ä¸Šç­æ—æˆ–è€…å…¶ä»–æœ‰é—²é’±çš„å­¦ç”Ÿï¼Œè€Œä¸”ä¸æ±‚å¿«é€Ÿæå‡è‹±è¯­èƒ½åŠ›çš„äººè€Œè¨€ï¼Œå¦‚æœæ„¿æ„èŠ±ç‚¹å°é’±ï¼Œä¹Ÿæ˜¯æœ‰æ·å¾„å¯ä»¥æŠ„çš„ã€‚ é¦–å…ˆå°±æ˜¯çº¿ä¸‹è¯¾ç¨‹è·Ÿçº¿ä¸Šè§†é¢‘è¯¾ç¨‹ï¼ˆæ¯”å¦‚æ–°ä¸œæ–¹ã€å±±å§†è‹±è¯­ï¼‰ï¼Œè¿™ä¸ªæ²¡æ—¶é—´å‚åŠ ï¼Œæ—¶é—´å®‰æ’ä¹Ÿä¸å¤Ÿçµæ´»ï¼Œè€Œä¸”å¯èƒ½ä¼šæ¯”è¾ƒæ¯ç‡¥ï¼Œç›´æ¥ Pass. å…¶æ¬¡å°±æ˜¯è‹±è¯­å­¦ä¹ ç±» APP äº†ï¼Œè¿™ä¸ªå¸‚é¢ä¸Šè¿˜æœ‰æŒºå¤šçš„ï¼Œæˆ‘è¯•ç”¨äº†ä¸€æ³¢åæ„Ÿè§‰å¾ˆé€‚åˆæˆ‘ï¼Œå¹¶ä¸”ç­›é€‰å‡ºäº†ä¸‹é¢å‡ ä¸ªæ¯”è¾ƒä¸­æ„çš„ APPï¼šæ¬§è·¯è¯å…¸ã€çŸ¥ç±³é˜…è¯»ã€å¼€è¨€è‹±è¯­ä»¥åŠä¸€ç‚¹è‹±è¯­ã€‚ å¹¶ä¸”ä½¿ç”¨ä¸Šè¿°å‡ æ¬¾è½¯ä»¶æä¾›çš„è‹±è¯­èƒ½åŠ›æµ‹è¯•ï¼Œå®Œæ•´è¯„ä¼°äº†ä¸‹æˆ‘çš„è‹±è¯­æ°´å¹³ã€‚ä¸‹å›¾ä»å·¦è‡³å³ä¾æ¬¡æ˜¯ä¸€ç‚¹è‹±è¯­ã€å¼€è¨€è‹±è¯­ï¼Œä»¥åŠè‹±è¯­æµåˆ©è¯´çš„æ•´ä½“è‹±è¯­æ°´å¹³è·Ÿå£è¯­æ°´å¹³ä¸¤é¡¹æµ‹è¯•ç»“æœï¼ˆç»“æœåé«˜ï¼Œä»…ä¾›å‚è€ƒï¼‰ï¼š å„ APP çš„è‹±è¯­æ°´å¹³æµ‹è¯„ç»“æœï¼ˆä¸€ç‚¹è‹±è¯­çš„ç»“æœæ˜æ˜¾åé«˜ï¼‰ æµåˆ©è¯´è‹±è¯­è¯„çº§å¯¹ç…§è¡¨ ä¸‹é¢è¯¦ç»†ä»‹ç»ä¸‹æˆ‘æ¯”è¾ƒæ¨èçš„è‹±è¯­å­¦ä¹ ç±» APP è·Ÿè¯¾ç¨‹ï¼š æ¬§è·¯è¯å…¸ æœ€ç‰›é€¼çš„è¯å…¸è½¯ä»¶ï¼Œéå¸¸é€‚åˆç”¨äºæ—¥å¸¸æŸ¥è¯ã€‚ æœ€å¼ºçš„ä¸€ç‚¹åœ¨äºå®ƒèƒ½å¯¼å…¥å„ç§ç¦»çº¿è¯å…¸ï¼Œè¯¦è§æ¶é­”å¥¶çˆ¸æœ‰åˆ†äº«çš„è¯å…¸æ–‡ç« ï¼Œ æˆ‘ç”¨åˆ°çš„æœ‰å¦‚ä¸‹å‡ æœ¬ï¼š ä¸­è‹±åŒè§£è¯å…¸ æŸ¯æ—æ–¯åŒè§£ Collins Cobuild Advanced Learnerâ€™s English Dictionaryï¼šåŒ…å«ä¸­æ–‡ç¿»è¯‘ã€è‹±è‹±é‡Šä¹‰è·Ÿå¥å­ç¤ºä¾‹ï¼Œè¿˜æä¾› 1-5 çš„å•è¯ä½¿ç”¨é¢‘ç‡æ ‡è¯† Microsoft Bing Dictionaryï¼šæ˜¯ç½‘å‹æŠ“å–åˆ¶ä½œçš„å¿…åº”å¤§è¯å…¸ï¼Œè·Ÿ Collins Cobuild ç±»ä¼¼ï¼ŒåŒ…å«çº§åˆ«ï¼ˆCET4/CET6/GREï¼‰ã€ä¸­æ–‡ç¿»è¯‘ã€è‹±è‹±é‡Šä¹‰è·Ÿå¥å­ç¿»è¯‘ è‹±è‹±è¯å…¸ LDOCEæœ—æ–‡å½“ä»£5 è‹±è‹±ç‰ˆ: å…‰ä½“ç§¯å°± 1Gï¼ŒåŒ…å«äº†æ‰€æœ‰å•è¯ä¾‹å¥çš„å½•éŸ³ï¼Œæ˜¯éå¸¸è¯¦å°½çš„ä¸€æœ¬è‹±è‹±å­¦ä¹ è¯å…¸ã€‚æ”¶è¯é‡ç›¸å½“å¤§ï¼ŒçŸ­è¯­ã€ç”¨æ³•å®Œå¤‡ è¯ç»„æ­é…ã€åŒä¹‰è¯è¯å…¸ ç‰›æ´¥æ­é…è¯å…¸ç¬¬äºŒç‰ˆ Collins Thesaurus Collins COBUILD English Usage WordNet 3.0 USE THE RIGHT WORD: åŒä¹‰è¿‘ä¹‰è¯ç”¨æ³•è§£é‡Šï¼Œå¾ˆè¯¦ç»† Merriam-Websterâ€™s Vocabulary Builder: é€šè¿‡è¯æ ¹è¯ç¼€æ¥å…³è”èµ·å„ç§ç›¸å…³å•è¯ è‹±è¯­å¸¸ç”¨è¯ç–‘éš¾ç”¨æ³•æ‰‹å†Œ è–„è·é˜…è¯»ï¼š199 å…ƒ / 100 å¤© é˜…è¯»åŸç‰ˆä¹¦å­¦ä¹ è‹±è¯­ ç”¨å®ƒè¾…åŠ©é˜…è¯»åŸç‰ˆä¹¦çš„å¥½å¤„æœ‰ï¼š ä¼šæå‰å¸®ä½ é€‰å‡ºç”Ÿè¯è¿›è¡Œé¢„ä¹  æä¾›é…å¥—çš„æœ‰å£°ä¹¦ï¼Œå¯ä»¥å¬ä¹¦ä¹Ÿå¯ä»¥çœ‹ä¹¦ éšæ—¶åŒå‡»æŸ¥è¯ï¼ŒæŸ¥è¯éå¸¸æ–¹ä¾¿ å­¦ä¹ å®Œæˆåè¿˜æœ‰æä¾›é…å¥—çš„è®²ä¹‰ï¼Œå¯¹å„é¡¹å•è¯ã€è¯ç»„ã€ç–‘éš¾å¥è¿›è¡Œè¯¦ç»†è§£é‡Šï¼Œè¿™ä¸ªæ„Ÿè§‰ä¼šéå¸¸æœ‰ç”¨ï¼ ç¼ºç‚¹ æ¯é€¢è´­ç‰©æ´»åŠ¨å°±å¼€å§‹æ‰“å¹¿å‘Šï¼Œè®©äººæœ‰ç‚¹çƒ¦ã€‚ ç›¸æ¯”åé¢çš„ç«å“ï¼Œä»·æ ¼æœ‰ç‚¹å¤ªé«˜äº†â€¦ çŸ¥ç±³é˜…è¯»ï¼š199 å…ƒï¼Œ365 å¤©ç•…è¯»æ‰€æœ‰ä¹¦å• é˜…è¯»åŸç‰ˆä¹¦å­¦ä¹ è‹±è¯­ è·Ÿè–„è·é˜…è¯»å‡ ä¹ä¸€æ ·çš„æ¨¡å¼ï¼ŒåŠŸèƒ½å¤§åŒå°å¼‚ã€‚ ä½†æ˜¯å®ƒçš„å¹´è´¹ä¼šå‘˜ä»…ä¸ºè–„è·é˜…è¯» VIP çš„ 1/5ï¼Œè€Œä¸”è¿˜èƒ½ç•…è¯»æ‰€æœ‰ä¹¦å•ï¼ ä¸ªäººæ„Ÿè§‰å®ƒçš„å°ç¨‹åºè®¾è®¡æ„Ÿæ¯”è–„è·é˜…è¯»æ›´å¥½ ä¸€ç‚¹è‹±è¯­ï¼š æŠ˜å 1998 å…ƒ 270 å¤© å¦‚æœåšæŒæ‰“å¡ 270 å¤©ï¼ŒæœŸæœ«è¿˜è¿” 1000 ç°é‡‘ + 500 ç»­è¯¾åˆ¸ï¼ˆå®æµ‹å¤§åŠå¹´ä¸‹æ¥æ„å¤–å¤ªå¤šï¼ŒåŸºæœ¬ä¸å¯èƒ½æ‹¿åˆ°ã€ä½†æ˜¯ä¸‡ä¸€å°±æˆåŠŸäº†å‘¢â€¦ï¼‰ é€šè¿‡ã€Œæ¼”è®²/åŠ¨æ¼«/å–œå‰§/éŸ³ä¹ç°åœºã€ç­‰å„ç§è§†é¢‘å†…å®¹å­¦ä¹ è‹±è¯­å•è¯ï¼ŒåŒæ—¶ç»ƒä¹ å¬åŠ›è·Ÿå£è¯­ ç›¸æ¯”å…¶ä»– APPï¼Œå®ƒçš„è¯¾ç¨‹ä¼šæœ‰è¶£å¾ˆå¤šï¼Œä¸é‚£ä¹ˆæ¯ç‡¥ã€‚æˆ‘è§‰å¾—ç”¨å®ƒç»ƒä¹ å¬åŠ›éå¸¸åˆé€‚ã€‚ ç¼ºé™·ï¼š å®ƒçš„è§†é¢‘è¯­æ–™æœ‰éƒ¨åˆ†è·Ÿå•è¯æœ‰ç‚¹å¯¹ä¸ä¸Šï¼Œæœ‰æ—¶å€™ä¼šé‡ä¸Šï¼Œä¸è¿‡æ— ä¼¤å¤§é›…ã€‚ å®ƒèƒŒå•è¯çš„åŠŸèƒ½è·Ÿã€Œä¸èƒŒå•è¯ã€æˆ–è€…ã€Œæ¬§è·¯è¯å…¸ã€å·®è·è¾ƒå¤§ã€‚å…¶ä¸­è‹±è§£é‡Šæ¯”è¾ƒç®€é™‹ã€è®°å¿†ç®—æ³•å¼ºåº¦æ²¡ä¸èƒŒå•è¯é«˜ï¼Œä¹Ÿæ²¡æœ‰è¯æ ¹è¯ç¼€åŠŸèƒ½ï¼Œæ­¤å¤–ä¾‹å¥å¶å°”ä¼šæœ‰äº›é”™è¯¯ã€‚ å¼€è¨€è‹±è¯­ é€šè¿‡å¤–æ•™å½•åˆ¶çš„è§†é¢‘ + ç¨‹åºæ§åˆ¶å®ç°äº†ä¸€å®šçš„å¯äº¤äº’æ€§ï¼Œæ„Ÿè§‰è¯¾ç¨‹æ¯”è‹±è¯­æµåˆ©è¯´åšå¾—è¦æœ‰è¶£äº›ã€‚ å¼€è¨€è‹±è¯­çš„ WeMeet è‹±è¯­è§’ä½“éªŒçœŸçš„è¶…æ£’ï¼Œè€Œä¸”è¿˜å…è´¹ï¼ ç¬¬ä¸€æ¬¡å‚åŠ æ—¶ï¼Œä¸€èµ·èŠå¤©çš„ä¸¤ä½æœ‹å‹ï¼Œä¸€ä½åœ¨ä¸‡è±ªé…’åº—å·¥ä½œäº†å·®ä¸å¤š 10 å¹´ï¼Œå¦ä¸€ä½æ˜¯äº§å“ç»ç†ï¼Œåœ¨è…¾è®¯ã€æœç‹ã€ç¾å›¢ç­‰å…¬å¸å·¥ä½œäº†å·®ä¸å¤š 15 å¹´ï¼ŒèŠå¾—éå¸¸å¼€å¿ƒï¼Œå¾ˆæœ‰æ”¶è·ï¼ ä»·æ ¼ å¤–æ•™ç³»ç»Ÿè¯¾æ˜¯ 2598 ä¸€å¹´ï¼Œæä¾›æµ·é‡å¤–æ•™è§†é¢‘äº’åŠ¨è¯¾è·ŸéŸ³é¢‘è¯¾ è¿˜æœ‰ä¸ªå¤–æ•™è§†é¢‘è¯¾ï¼Œäº’åŠ¨æ€§ä¼šæ›´é«˜ï¼Œä»·æ ¼æ˜¯ 1598 ä¸€å¹´ ã€Šæ½˜å‰ Jenny å‘Šè¯‰ä½ ã€‹è¿™ä¸ªå£ç¢‘åœ¨ï¼Œæˆ‘è§‰å¾—å¼€è¨€è‹±è¯­çš„å¤–æ•™è¯¾ç¨‹æ˜¯å¯ä»¥è€ƒè™‘çš„ æ–°ä¸œæ–¹åœ¨çº¿ åœ¨çº¿å½•æ’­è¯¾ã€ç›´æ’­è¯¾ï¼Œä»ä»¥å‰å­¦è¿‡çš„è€ƒç ”è‹±è¯­çœ‹ï¼Œè¿˜æ˜¯å¾ˆä¸“ä¸šã€å¾ˆæˆä½“ç³»çš„ã€‚ å¯¹ BECã€é›…æ€ã€æ‰˜ç¦éƒ½æœ‰å¯¹åº”çš„è¯¾ç¨‹å¯é€‰ï¼Œä»·æ ¼å¯¹å·¥ä½œå…šè€Œè¨€é—®é¢˜ä¸å¤§ã€‚ VoiceTubeï¼šä»·æ ¼è¿˜ä¸å¤ªæ¸…æ¥š åº”è¯¥æ˜¯æœ€æ—©åšã€Œçœ‹è§†é¢‘å­¦è‹±è¯­ã€åŠŸèƒ½çš„ APP ä¹‹ä¸€ï¼Œå®ƒæœ€åˆå‘å¸ƒäº 2013/09ï¼Œè€Œå‰é¢ä»‹ç»çš„ã€Œä¸€ç‚¹è‹±è¯­ã€æœ€åˆå‘å¸ƒäº 2018 å¹´ï¼ˆè€Œä¸” UI å¸ƒå±€ä¹Ÿè·Ÿ VoiceTube å¾ˆç±»ä¼¼ï¼‰ã€‚ è·å¾—äº† Facebook 2016 å¹´å¹´åº¦æœ€ä½³ APP å¥–é¡¹ ä½†æ˜¯ï¼ˆå› ä¸ºç‰ˆæƒåŸå› ï¼‰å®ƒåŸºæœ¬éƒ½æ˜¯ç›´æ¥å†…åµŒçš„ Youtube è§†é¢‘ï¼Œå®ƒéœ€è¦åŒæ—¶å®‰è£… Youtubeï¼ˆåŒæ—¶è¿˜éœ€è¦ä¸€äº›ä½¿ä½ èƒ½è®¿é—® Youtube çš„ç‰¹æ®Šæ‰‹æ®µï¼‰ã€‚ å¦å¤–ä¸€äº›æˆ‘ç”¨è¿‡ä½†æ˜¯ä¸æ¨èçš„ APP ä¹Ÿç®€å•è¯´ä¸‹é—®é¢˜æ‰€åœ¨ï¼š è‹±è¯­æµåˆ©è¯´ æ‡‚ä½ è‹±è¯­ A+ è¯¾ç¨‹è´¨é‡ç¡®å®ä¸é”™ï¼Œä½†æ˜¯å…¨éƒ½æ˜¯ AI è¯­éŸ³ï¼Œè™½ç„¶å¾ˆæ ‡å‡†ï¼Œä½†æ˜¯å¤ªæœºæ¢°äº†ï¼Œä¸å¸¦å•¥æ„Ÿæƒ…ï¼Œæˆ‘å­¦äº†æ‰ 6 å¤©å°±å¼€å§‹åŒå€¦äº†ã€‚ä¸ªäººä¸æ¨èé€‰å®ƒ ç™¾è¯æ–© æ›´é€‚åˆç”¨äºè¶£å‘³æ€§èƒŒå•è¯ å¯¹å¾ˆå¤šå­¦ç”Ÿå…šï¼ˆæ¯”å¦‚å¤§å­¦æœŸé—´çš„æˆ‘ï¼‰è€Œè¨€è¿™äº› APP ä¸€å¹´ä¸‹æ¥å¥½å‡ åƒçš„è´¹ç”¨ç¡®å®æ˜¯éš¾ä»¥æ‰¿æ‹…ï¼Œä½†æ˜¯å¯¹æˆ‘è¿™æ ·çš„å·¥ä½œå…šè€Œè¨€ï¼Œä¸å¤±ä¸ºä¸€ä¸ªå¾ˆå¥½çš„å­¦ä¹ æ‰‹æ®µã€‚ ä¸Šè¿°è¿™äº›è½¯ä»¶æœ€å¤§çš„ä¼˜åŠ¿æ˜¯ã€Œäº’åŠ¨ã€ï¼Œè¿™ä¼šä½¿å®ƒæ¯”å•çº¯è‡ªå­¦æœ‰è¶£å¾ˆå¤šï¼Œæ›´å®¹æ˜“åšæŒã€‚ é™¤è–„è·è‹±è¯­å¤–ï¼Œå…¶ä»–ä¸‰ä¸ª APP éƒ½æœ‰æä¾›é•¿çŸ­ä¸ä¸€çš„ä¼šå‘˜ä½“éªŒæ—¶é—´ï¼Œæœ‰å…´è¶£çš„è¯å¯ä»¥è‡ªå·±è¯•ç”¨ä¸‹~ æ€»ç»“ä¸‹ï¼Œç›®å‰å·²ä¹°è¯¾ç¨‹ï¼š ã€ŒçŸ¥ç±³é˜…è¯»ã€199 å…ƒï¼Œ365 å¤©ç•…è¯»æ‰€æœ‰ä¹¦å•ã€‚çœ‹çš„ç¬¬ä¸€æœ¬ä¹¦æ˜¯ã€ŒTime Machineã€ã€‚é˜…è¯»ä½“éªŒå¾ˆä¸é”™ï¼Œè€Œä¸”æ¯”è–„è·é˜…è¯»ä¾¿å®œå¤ªå¤šäº†ã€‚ ã€Œä¸€ç‚¹è‹±è¯­ã€çœ‹è§†é¢‘/å¬æ­Œå­¦è‹±è¯­çœŸçš„éå¸¸æ£’ï¼å·²ç»èŠ± 1998 å…ƒä¹°äº† 270 å¤©çš„ä¼šå‘˜ äº‰å–æ¯å¤©æ‰“å¡ï¼Œèµšåˆ° 1000 ç°é‡‘è¿”è¿˜ç›®å‰ï¼ˆ2022-11-07ï¼‰è¿›åº¦æ˜¯ 62 å¤©ï¼Œå·²ç»æ¼æ‰“å¡ 5 å¤©â€¦ éƒ¨åˆ†åŸå› æ˜¯æ¼æ‰“å¡ç¬¬ä¸€å¤©åï¼Œäº‰å–æ¯å¤©æ‰“å¡çš„æ‰§å¿µå°±æ²¡é‚£ä¹ˆå¼ºçƒˆäº†ï¼Œå¶å°”å“ªä¸€å¤©å¤ªç´¯äº†æˆ–è€…åˆ«çš„äº‹æ²¡æå®Œï¼Œå°±ç›´æ¥ä¸æ‰“å¡äº†â€¦ ã€Œè–„è·è‹±è¯­ã€èŠ±äº† 199 å…ƒä¹°äº†ã€Šä¸€ä¸ªäººçš„æœåœ£ã€‹è¿™ä¸ªåŸç‰ˆä¹¦ï¼Œä¹¦å·²ç»çœ‹å®Œäº†ã€‚å†…å®¹ä¸é”™ï¼Œå°±æ˜¯è·ŸçŸ¥ç±³é˜…è¯»æ¯”å¤ªè´µäº†ã€‚ ã€Œè‹±è¯­æµåˆ©è¯´ã€èŠ±äº† 49 å…ƒï¼Œä¹°äº†ä¸ª 30 å¤©çš„æ‡‚ä½ è‹±è¯­ A+ ä½“éªŒè¯¾ï¼Œä½†æ˜¯å› ä¸ºå‰è¿°åŸå› ï¼ˆAI è¯­éŸ³å¤ªæ­»æ¿ï¼Œå¬å¤šäº†çƒ¦ï¼‰å°±ç”¨äº†ä¸€å‘¨å°±æ²¡ç»§ç»­ç”¨äº†ã€‚ ","date":"2022-09-04","objectID":"/posts/learn-english-again/:0:2","series":null,"tags":["è‹±è¯­","è¯­è¨€å­¦ä¹ "],"title":"Learn English Again","uri":"/posts/learn-english-again/#äºŒè‹±è¯­è‡ªå­¦è·¯çº¿å®Œå…¨æŒ‡å—"},{"categories":["life"],"content":" äºŒã€è‹±è¯­è‡ªå­¦è·¯çº¿å®Œå…¨æŒ‡å—å› ä¸ºæœ€è¿‘å¯¹è‹±è¯­æ¥äº†ç”µï¼Œå°±æ‰“ç®—æ·±å…¥äº†è§£ä¸‹å¸‚é¢ä¸Šå¸¸è§çš„è‹±è¯­å­¦ä¹ è·¯å¾„ï¼Œäº‰å–æ‰¾åˆ°æœ€ä½³å­¦ä¹ è·¯çº¿ã€‚ 1. ä¸èŠ±é’±çš„è‡ªå­¦è·¯çº¿é¦–å…ˆæ˜¯ä¸èŠ±é’±çš„è‡ªå­¦è·¯çº¿ï¼Œè¿™ä¸ªæˆ‘åœ¨å¤§ä¸‰æ—¶æœ‰è¿‡å®è·µï¼Œå½“æ—¶æ‰“ç®—è€ƒç ”ï¼Œä¸“é—¨ç»ƒè¿‡ä¸€æ³¢è‹±è¯­ï¼Œå¤§è‡´è·¯çº¿æ˜¯è¿™æ ·çš„ï¼š æ¶é­”å¥¶çˆ¸æ€»ç»“çš„ ç»ƒä¹ è‹±è¯­å£è¯­çš„åŠæ³•ï¼Œæœ¬äººå®æµ‹æ•ˆæœæ˜¾è‘— å…¶ä¸­ä»‹ç»çš„ ESLPodã€EnglishPod ç­‰ææ–™ï¼Œä¸ä»…å¯ä»¥æå‡è¯­æ„Ÿï¼Œä¹Ÿèƒ½å¸®åŠ©æå‡å¬åŠ›ã€‚ å¦‚æœæ˜¯è¿›é˜¶çš„è¯ï¼Œå¯ä»¥å» Youtube ä¸Šçœ‹ä¸€äº›æµè¡Œçš„ Talk Showï¼Œè¿™ç±»è§†é¢‘å¾ˆæœ‰æ„æ€ã€è¯­é€Ÿå¿«ä¿¡æ¯é‡åˆå¤§ï¼Œæ˜¯å¾ˆåˆé€‚çš„è¿›é˜¶å­¦ä¹ ææ–™ ä»¥çœ‹è§†é¢‘çš„æ–¹å¼å­¦è‹±è¯­ï¼Œä¸€ä¸ªè¦ç‚¹å°±æ˜¯ã€Œé‡å¤ã€æˆ–è€…è¯´ã€Œç²¾å¬ã€ã€‚ ã€Œä¸€ç‚¹è‹±è¯­ã€å°±æ˜¯åœ¨è¿™ä¸Šé¢ä¸‹äº†ä¸å°‘åŠŸå¤«ï¼Œè¦é€‰é‚£ç§ç¬¬ä¸€éå¬æœ‰éš¾åº¦çš„è§†é¢‘ï¼Œæœ€å¥½å†…å®¹è¿˜æ¯”è¾ƒæœ‰è¶£ ï¼ˆæ¯”å¦‚ Talk Show å°±æ¯”è¾ƒæœ‰æ„æ€ï¼‰ã€‚ å¯è¡Œçš„å­¦ä¹ æ–¹æ³•ï¼šç¬¬ä¸€éå¸¦å­—å¹•çœ‹è§†é¢‘ï¼Œä½†æ˜¯å°½é‡åˆ«çœ‹å­—å¹•ï¼›ç¬¬äºŒéå¸¦å­—å¹•åå¤ç²¾çœ‹å¬ä¸æ‡‚çš„éƒ¨åˆ†ï¼Œç¬¬ä¸‰éå†å®Œå…¨å…³æ‰å­—å¹•éªŒè¯å­¦ä¹ æ•ˆæœã€‚ è¿˜æœ‰å°±æ˜¯å¾ˆå¤šäººæ¨èçš„é˜…è¯»è‹±æ–‡åŸç‰ˆä¹¦ ä¸€å¼€å§‹å¯èƒ½ä¼šè¯»å¾—å¾ˆæ…¢ï¼Œè¿™ä¸ªæ—¶å€™æœ€é‡è¦çš„å°±æ˜¯åšæŒï¼é˜…è¯»é‡ä¸Šæ¥äº†ï¼Œé€Ÿåº¦è‡ªç„¶å°±æå‡äº†ã€‚ è®©è‡ªå·±æ›´å®¹æ˜“åšæŒçš„é˜…è¯»æ–¹æ³•ï¼š è¦æ‰¾ä¸€äº›ä½ æ„Ÿå…´è¶£çš„ã€éš¾åº¦é€‚ä¸­çš„åŸç‰ˆä¹¦ï¼ˆæ¯”å¦‚æ„Ÿå…´è¶£çš„å°è¯´ã€ä¸“ä¸šç›¸å…³çš„æŠ€æœ¯ä¹¦ç­‰ï¼‰ã€‚å› ä¸ºé˜…è¯»çš„é¦–è¦ç‚¹æ˜¯è¦èƒ½æ„Ÿå—åˆ°ä¹è¶£ï¼Œå¦åˆ™ä¼šå¾ˆæ¯ç‡¥ï¼Œå¾ˆéš¾åšæŒã€‚ ç„¶åè¦åšå¥½è§„åˆ’å¹¶åšæŒæ‰§è¡Œï¼Œæ¯”å¦‚æ¯å¤©è¯» 10 é¡µã€‚ å½“ç„¶ä½ ä¹Ÿå¯ä»¥èµ°ä¼ ç»Ÿçš„èƒŒå•è¯ã€è¯ç»„ã€ä¾‹å¥è¿™æ ·çš„è·¯çº¿ï¼Œè¿™æ¡è·¯çº¿çš„å¥½å¤„æ˜¯èƒ½å¿«é€Ÿæå‡è‡ªå·±çš„è‹±è¯­èƒ½åŠ›ï¼Œä½†æ˜¯ç›¸å¯¹çš„ä¹Ÿå¾ˆéš¾åšæŒã€‚ å¸¸è§çš„æœ‰æ–°ä¸œæ–¹çš„è¯æ±‡å½•æ’­è¯¾ï¼ˆç½‘ä¸Šèƒ½æ‰¾åˆ°å…è´¹çš„èµ„æ–™åˆ†äº«ï¼‰ï¼Œä»¥å‰å¬è¿‡æ–°ä¸œæ–¹æœ±ä¼Ÿè€å¸ˆçš„ã€Šæ‹ç»ƒæœ‰è¯ã€‹ï¼Œæ„Ÿè§‰æŒºä¸é”™çš„ã€‚ ä¸èƒŒå•è¯ã€ç™¾è¯æ–©è¿™ç±» APP ä¹Ÿå¯ä»¥è¯•è¯•ï¼Œä¸è¿‡æˆ‘ä¸ªäººä½“éªŒæ˜¯åŸºæœ¬åšæŒä¸äº†å¤šä¹…â€¦ æ¯æ—¥è‹±è¯­å¬åŠ› è·Ÿæ¬§è·¯è¯å…¸æ˜¯åŒä¸€å®¶å…¬å¸åšçš„ï¼Œå¾ˆè‰¯å¿ƒã€‚ ä¸è¿‡å› ä¸ºæˆ‘å·²ç»ä¹°äº†å…¶ä»–è¯¾ç¨‹äº†ï¼Œè¿™ä¸ª APP ç›®å‰ç”¨å¾—æ¯”è¾ƒå°‘ã€‚ æ¯æ—¥è‹±è¯­å¬å†™ Daily English Dictation 1-400 è¿™æ˜¯ Youtube ä¸Šç›¸å½“ç«çš„ä¸€ä¸ªè‹±è¯­å¬å†™ç³»åˆ—è§†é¢‘ï¼Œåšå¾—éå¸¸æ£’ï¼ŒåšæŒå¬å®Œ 400 æœŸï¼Œå¬åŠ›å°±ç¥åŠŸå¤§æˆäº†ï¼ ä¸ªäººæ„Ÿè§‰èµ·ç å¾—æœ‰ä¸ª CET4 æ°´å¹³ï¼Œæ‰èƒ½æ¯”è¾ƒèˆ’æœåœ°è·Ÿè¿™ä¸ªè¯¾ç¨‹ã€‚ ä¸€äº›å¯¹è¯ã€è§’è‰²è®¾å®šã€ä¸–ç•Œè§‚è®¾å®šè¾ƒå¤šçš„æ¸¸æˆä¹Ÿæ˜¯å­¦è‹±è¯­çš„å¥½ææ–™ï¼Œæ¯”å¦‚ã€ŒGenshin Impactã€ã€ã€ŒDEEMO 2ã€ï¼Œæˆ–è€…ä¸€äº› Galgame éƒ½å¯ã€‚å¨±ä¹è·Ÿè‹±è¯­ä¸¤ä¸è¯¯ emmm Genshin Impact é‡Œè¶…é£’çš„é‡å‰‘å¥³ä»† Noelle DEEMO 2 ä¸­ä¸°å¯Œçš„å¯¹è¯å†…å®¹ DEEMO 2 çš„ä¸€äº›è®¾å®š ä¸Šé¢ä¸»è¦æ˜¯é’ˆå¯¹ CET4 å››çº§ä»¥ä¸Šæ°´å¹³çš„è‹±è¯­å­¦ä¹ è€…ï¼Œå¦‚æœåŸºç¡€æ¯”è¾ƒå·®ï¼Œå¯ä»¥è€ƒè™‘æŒ‰ç…§æ¶é­”å¥¶çˆ¸æ¨èçš„é›¶åŸºç¡€è‹±è¯­å­¦ä¹ è·¯çº¿è¿›è¡Œè‡ªå­¦ï¼š è‹±è¯­ï¼šå£¹ç«  - æ¶é­”å¥¶çˆ¸ï¼šé’ˆå¯¹é›¶åŸºç¡€/åŸºç¡€è¶…çº§ä¸å¥½çš„åŒå­¦ è‹±è¯­ï¼šè´°ç«  - æ¶é­”å¥¶çˆ¸ï¼šé’ˆå¯¹å¤„äºè‹±è¯­åˆçº§é˜¶æ®µçš„åŒå­¦ è‹±è¯­ï¼šåç«  - æ¶é­”å¥¶çˆ¸ï¼šé’ˆå¯¹å¤§å­¦å››å…­çº§æ°´å¹³çš„åŒå­¦ ï¼ˆå°±è·Ÿæˆ‘ä¸Šé¢åˆ—çš„å·®ä¸å¤šäº†ï¼‰ 2. èŠ±é’±æŠ„æ·å¾„è€Œå¯¹äºæˆ‘è¿™ç§ä¸Šç­æ—æˆ–è€…å…¶ä»–æœ‰é—²é’±çš„å­¦ç”Ÿï¼Œè€Œä¸”ä¸æ±‚å¿«é€Ÿæå‡è‹±è¯­èƒ½åŠ›çš„äººè€Œè¨€ï¼Œå¦‚æœæ„¿æ„èŠ±ç‚¹å°é’±ï¼Œä¹Ÿæ˜¯æœ‰æ·å¾„å¯ä»¥æŠ„çš„ã€‚ é¦–å…ˆå°±æ˜¯çº¿ä¸‹è¯¾ç¨‹è·Ÿçº¿ä¸Šè§†é¢‘è¯¾ç¨‹ï¼ˆæ¯”å¦‚æ–°ä¸œæ–¹ã€å±±å§†è‹±è¯­ï¼‰ï¼Œè¿™ä¸ªæ²¡æ—¶é—´å‚åŠ ï¼Œæ—¶é—´å®‰æ’ä¹Ÿä¸å¤Ÿçµæ´»ï¼Œè€Œä¸”å¯èƒ½ä¼šæ¯”è¾ƒæ¯ç‡¥ï¼Œç›´æ¥ Pass. å…¶æ¬¡å°±æ˜¯è‹±è¯­å­¦ä¹ ç±» APP äº†ï¼Œè¿™ä¸ªå¸‚é¢ä¸Šè¿˜æœ‰æŒºå¤šçš„ï¼Œæˆ‘è¯•ç”¨äº†ä¸€æ³¢åæ„Ÿè§‰å¾ˆé€‚åˆæˆ‘ï¼Œå¹¶ä¸”ç­›é€‰å‡ºäº†ä¸‹é¢å‡ ä¸ªæ¯”è¾ƒä¸­æ„çš„ APPï¼šæ¬§è·¯è¯å…¸ã€çŸ¥ç±³é˜…è¯»ã€å¼€è¨€è‹±è¯­ä»¥åŠä¸€ç‚¹è‹±è¯­ã€‚ å¹¶ä¸”ä½¿ç”¨ä¸Šè¿°å‡ æ¬¾è½¯ä»¶æä¾›çš„è‹±è¯­èƒ½åŠ›æµ‹è¯•ï¼Œå®Œæ•´è¯„ä¼°äº†ä¸‹æˆ‘çš„è‹±è¯­æ°´å¹³ã€‚ä¸‹å›¾ä»å·¦è‡³å³ä¾æ¬¡æ˜¯ä¸€ç‚¹è‹±è¯­ã€å¼€è¨€è‹±è¯­ï¼Œä»¥åŠè‹±è¯­æµåˆ©è¯´çš„æ•´ä½“è‹±è¯­æ°´å¹³è·Ÿå£è¯­æ°´å¹³ä¸¤é¡¹æµ‹è¯•ç»“æœï¼ˆç»“æœåé«˜ï¼Œä»…ä¾›å‚è€ƒï¼‰ï¼š å„ APP çš„è‹±è¯­æ°´å¹³æµ‹è¯„ç»“æœï¼ˆä¸€ç‚¹è‹±è¯­çš„ç»“æœæ˜æ˜¾åé«˜ï¼‰ æµåˆ©è¯´è‹±è¯­è¯„çº§å¯¹ç…§è¡¨ ä¸‹é¢è¯¦ç»†ä»‹ç»ä¸‹æˆ‘æ¯”è¾ƒæ¨èçš„è‹±è¯­å­¦ä¹ ç±» APP è·Ÿè¯¾ç¨‹ï¼š æ¬§è·¯è¯å…¸ æœ€ç‰›é€¼çš„è¯å…¸è½¯ä»¶ï¼Œéå¸¸é€‚åˆç”¨äºæ—¥å¸¸æŸ¥è¯ã€‚ æœ€å¼ºçš„ä¸€ç‚¹åœ¨äºå®ƒèƒ½å¯¼å…¥å„ç§ç¦»çº¿è¯å…¸ï¼Œè¯¦è§æ¶é­”å¥¶çˆ¸æœ‰åˆ†äº«çš„è¯å…¸æ–‡ç« ï¼Œ æˆ‘ç”¨åˆ°çš„æœ‰å¦‚ä¸‹å‡ æœ¬ï¼š ä¸­è‹±åŒè§£è¯å…¸ æŸ¯æ—æ–¯åŒè§£ Collins Cobuild Advanced Learnerâ€™s English Dictionaryï¼šåŒ…å«ä¸­æ–‡ç¿»è¯‘ã€è‹±è‹±é‡Šä¹‰è·Ÿå¥å­ç¤ºä¾‹ï¼Œè¿˜æä¾› 1-5 çš„å•è¯ä½¿ç”¨é¢‘ç‡æ ‡è¯† Microsoft Bing Dictionaryï¼šæ˜¯ç½‘å‹æŠ“å–åˆ¶ä½œçš„å¿…åº”å¤§è¯å…¸ï¼Œè·Ÿ Collins Cobuild ç±»ä¼¼ï¼ŒåŒ…å«çº§åˆ«ï¼ˆCET4/CET6/GREï¼‰ã€ä¸­æ–‡ç¿»è¯‘ã€è‹±è‹±é‡Šä¹‰è·Ÿå¥å­ç¿»è¯‘ è‹±è‹±è¯å…¸ LDOCEæœ—æ–‡å½“ä»£5 è‹±è‹±ç‰ˆ: å…‰ä½“ç§¯å°± 1Gï¼ŒåŒ…å«äº†æ‰€æœ‰å•è¯ä¾‹å¥çš„å½•éŸ³ï¼Œæ˜¯éå¸¸è¯¦å°½çš„ä¸€æœ¬è‹±è‹±å­¦ä¹ è¯å…¸ã€‚æ”¶è¯é‡ç›¸å½“å¤§ï¼ŒçŸ­è¯­ã€ç”¨æ³•å®Œå¤‡ è¯ç»„æ­é…ã€åŒä¹‰è¯è¯å…¸ ç‰›æ´¥æ­é…è¯å…¸ç¬¬äºŒç‰ˆ Collins Thesaurus Collins COBUILD English Usage WordNet 3.0 USE THE RIGHT WORD: åŒä¹‰è¿‘ä¹‰è¯ç”¨æ³•è§£é‡Šï¼Œå¾ˆè¯¦ç»† Merriam-Websterâ€™s Vocabulary Builder: é€šè¿‡è¯æ ¹è¯ç¼€æ¥å…³è”èµ·å„ç§ç›¸å…³å•è¯ è‹±è¯­å¸¸ç”¨è¯ç–‘éš¾ç”¨æ³•æ‰‹å†Œ è–„è·é˜…è¯»ï¼š199 å…ƒ / 100 å¤© é˜…è¯»åŸç‰ˆä¹¦å­¦ä¹ è‹±è¯­ ç”¨å®ƒè¾…åŠ©é˜…è¯»åŸç‰ˆä¹¦çš„å¥½å¤„æœ‰ï¼š ä¼šæå‰å¸®ä½ é€‰å‡ºç”Ÿè¯è¿›è¡Œé¢„ä¹  æä¾›é…å¥—çš„æœ‰å£°ä¹¦ï¼Œå¯ä»¥å¬ä¹¦ä¹Ÿå¯ä»¥çœ‹ä¹¦ éšæ—¶åŒå‡»æŸ¥è¯ï¼ŒæŸ¥è¯éå¸¸æ–¹ä¾¿ å­¦ä¹ å®Œæˆåè¿˜æœ‰æä¾›é…å¥—çš„è®²ä¹‰ï¼Œå¯¹å„é¡¹å•è¯ã€è¯ç»„ã€ç–‘éš¾å¥è¿›è¡Œè¯¦ç»†è§£é‡Šï¼Œè¿™ä¸ªæ„Ÿè§‰ä¼šéå¸¸æœ‰ç”¨ï¼ ç¼ºç‚¹ æ¯é€¢è´­ç‰©æ´»åŠ¨å°±å¼€å§‹æ‰“å¹¿å‘Šï¼Œè®©äººæœ‰ç‚¹çƒ¦ã€‚ ç›¸æ¯”åé¢çš„ç«å“ï¼Œä»·æ ¼æœ‰ç‚¹å¤ªé«˜äº†â€¦ çŸ¥ç±³é˜…è¯»ï¼š199 å…ƒï¼Œ365 å¤©ç•…è¯»æ‰€æœ‰ä¹¦å• é˜…è¯»åŸç‰ˆä¹¦å­¦ä¹ è‹±è¯­ è·Ÿè–„è·é˜…è¯»å‡ ä¹ä¸€æ ·çš„æ¨¡å¼ï¼ŒåŠŸèƒ½å¤§åŒå°å¼‚ã€‚ ä½†æ˜¯å®ƒçš„å¹´è´¹ä¼šå‘˜ä»…ä¸ºè–„è·é˜…è¯» VIP çš„ 1/5ï¼Œè€Œä¸”è¿˜èƒ½ç•…è¯»æ‰€æœ‰ä¹¦å•ï¼ ä¸ªäººæ„Ÿè§‰å®ƒçš„å°ç¨‹åºè®¾è®¡æ„Ÿæ¯”è–„è·é˜…è¯»æ›´å¥½ ä¸€ç‚¹è‹±è¯­ï¼š æŠ˜å 1998 å…ƒ 270 å¤© å¦‚æœåšæŒæ‰“å¡ 270 å¤©ï¼ŒæœŸæœ«è¿˜è¿” 1000 ç°é‡‘ + 500 ç»­è¯¾åˆ¸ï¼ˆå®æµ‹å¤§åŠå¹´ä¸‹æ¥æ„å¤–å¤ªå¤šï¼ŒåŸºæœ¬ä¸å¯èƒ½æ‹¿åˆ°ã€ä½†æ˜¯ä¸‡ä¸€å°±æˆåŠŸäº†å‘¢â€¦ï¼‰ é€šè¿‡ã€Œæ¼”è®²/åŠ¨æ¼«/å–œå‰§/éŸ³ä¹ç°åœºã€ç­‰å„ç§è§†é¢‘å†…å®¹å­¦ä¹ è‹±è¯­å•è¯ï¼ŒåŒæ—¶ç»ƒä¹ å¬åŠ›è·Ÿå£è¯­ ç›¸æ¯”å…¶ä»– APPï¼Œå®ƒçš„è¯¾ç¨‹ä¼šæœ‰è¶£å¾ˆå¤šï¼Œä¸é‚£ä¹ˆæ¯ç‡¥ã€‚æˆ‘è§‰å¾—ç”¨å®ƒç»ƒä¹ å¬åŠ›éå¸¸åˆé€‚ã€‚ ç¼ºé™·ï¼š å®ƒçš„è§†é¢‘è¯­æ–™æœ‰éƒ¨åˆ†è·Ÿå•è¯æœ‰ç‚¹å¯¹ä¸ä¸Šï¼Œæœ‰æ—¶å€™ä¼šé‡ä¸Šï¼Œä¸è¿‡æ— ä¼¤å¤§é›…ã€‚ å®ƒèƒŒå•è¯çš„åŠŸèƒ½è·Ÿã€Œä¸èƒŒå•è¯ã€æˆ–è€…ã€Œæ¬§è·¯è¯å…¸ã€å·®è·è¾ƒå¤§ã€‚å…¶ä¸­è‹±è§£é‡Šæ¯”è¾ƒç®€é™‹ã€è®°å¿†ç®—æ³•å¼ºåº¦æ²¡ä¸èƒŒå•è¯é«˜ï¼Œä¹Ÿæ²¡æœ‰è¯æ ¹è¯ç¼€åŠŸèƒ½ï¼Œæ­¤å¤–ä¾‹å¥å¶å°”ä¼šæœ‰äº›é”™è¯¯ã€‚ å¼€è¨€è‹±è¯­ é€šè¿‡å¤–æ•™å½•åˆ¶çš„è§†é¢‘ + ç¨‹åºæ§åˆ¶å®ç°äº†ä¸€å®šçš„å¯äº¤äº’æ€§ï¼Œæ„Ÿè§‰è¯¾ç¨‹æ¯”è‹±è¯­æµåˆ©è¯´åšå¾—è¦æœ‰è¶£äº›ã€‚ å¼€è¨€è‹±è¯­çš„ WeMeet è‹±è¯­è§’ä½“éªŒçœŸçš„è¶…æ£’ï¼Œè€Œä¸”è¿˜å…è´¹ï¼ ç¬¬ä¸€æ¬¡å‚åŠ æ—¶ï¼Œä¸€èµ·èŠå¤©çš„ä¸¤ä½æœ‹å‹ï¼Œä¸€ä½åœ¨ä¸‡è±ªé…’åº—å·¥ä½œäº†å·®ä¸å¤š 10 å¹´ï¼Œå¦ä¸€ä½æ˜¯äº§å“ç»ç†ï¼Œåœ¨è…¾è®¯ã€æœç‹ã€ç¾å›¢ç­‰å…¬å¸å·¥ä½œäº†å·®ä¸å¤š 15 å¹´ï¼ŒèŠå¾—éå¸¸å¼€å¿ƒï¼Œå¾ˆæœ‰æ”¶è·ï¼ ä»·æ ¼ å¤–æ•™ç³»ç»Ÿè¯¾æ˜¯ 2598 ä¸€å¹´ï¼Œæä¾›æµ·é‡å¤–æ•™è§†é¢‘äº’åŠ¨è¯¾è·ŸéŸ³é¢‘è¯¾ è¿˜æœ‰ä¸ªå¤–æ•™è§†é¢‘è¯¾ï¼Œäº’åŠ¨æ€§ä¼šæ›´é«˜ï¼Œä»·æ ¼æ˜¯ 1598 ä¸€å¹´ ã€Šæ½˜å‰ Jenny å‘Šè¯‰ä½ ã€‹è¿™ä¸ªå£ç¢‘åœ¨ï¼Œæˆ‘è§‰å¾—å¼€è¨€è‹±è¯­çš„å¤–æ•™è¯¾ç¨‹æ˜¯å¯ä»¥è€ƒè™‘çš„ æ–°ä¸œæ–¹åœ¨çº¿ åœ¨çº¿å½•æ’­è¯¾ã€ç›´æ’­è¯¾ï¼Œä»ä»¥å‰å­¦è¿‡çš„è€ƒç ”è‹±è¯­çœ‹ï¼Œè¿˜æ˜¯å¾ˆä¸“ä¸šã€å¾ˆæˆä½“ç³»çš„ã€‚ å¯¹ BECã€é›…æ€ã€æ‰˜ç¦éƒ½æœ‰å¯¹åº”çš„è¯¾ç¨‹å¯é€‰ï¼Œä»·æ ¼å¯¹å·¥ä½œå…šè€Œè¨€é—®é¢˜ä¸å¤§ã€‚ VoiceTubeï¼šä»·æ ¼è¿˜ä¸å¤ªæ¸…æ¥š åº”è¯¥æ˜¯æœ€æ—©åšã€Œçœ‹è§†é¢‘å­¦è‹±è¯­ã€åŠŸèƒ½çš„ APP ä¹‹ä¸€ï¼Œå®ƒæœ€åˆå‘å¸ƒäº 2013/09ï¼Œè€Œå‰é¢ä»‹ç»çš„ã€Œä¸€ç‚¹è‹±è¯­ã€æœ€åˆå‘å¸ƒäº 2018 å¹´ï¼ˆè€Œä¸” UI å¸ƒå±€ä¹Ÿè·Ÿ VoiceTube å¾ˆç±»ä¼¼ï¼‰ã€‚ è·å¾—äº† Facebook 2016 å¹´å¹´åº¦æœ€ä½³ APP å¥–é¡¹ ä½†æ˜¯ï¼ˆå› ä¸ºç‰ˆæƒåŸå› ï¼‰å®ƒåŸºæœ¬éƒ½æ˜¯ç›´æ¥å†…åµŒçš„ Youtube è§†é¢‘ï¼Œå®ƒéœ€è¦åŒæ—¶å®‰è£… Youtubeï¼ˆåŒæ—¶è¿˜éœ€è¦ä¸€äº›ä½¿ä½ èƒ½è®¿é—® Youtube çš„ç‰¹æ®Šæ‰‹æ®µï¼‰ã€‚ å¦å¤–ä¸€äº›æˆ‘ç”¨è¿‡ä½†æ˜¯ä¸æ¨èçš„ APP ä¹Ÿç®€å•è¯´ä¸‹é—®é¢˜æ‰€åœ¨ï¼š è‹±è¯­æµåˆ©è¯´ æ‡‚ä½ è‹±è¯­ A+ è¯¾ç¨‹è´¨é‡ç¡®å®ä¸é”™ï¼Œä½†æ˜¯å…¨éƒ½æ˜¯ AI è¯­éŸ³ï¼Œè™½ç„¶å¾ˆæ ‡å‡†ï¼Œä½†æ˜¯å¤ªæœºæ¢°äº†ï¼Œä¸å¸¦å•¥æ„Ÿæƒ…ï¼Œæˆ‘å­¦äº†æ‰ 6 å¤©å°±å¼€å§‹åŒå€¦äº†ã€‚ä¸ªäººä¸æ¨èé€‰å®ƒ ç™¾è¯æ–© æ›´é€‚åˆç”¨äºè¶£å‘³æ€§èƒŒå•è¯ å¯¹å¾ˆå¤šå­¦ç”Ÿå…šï¼ˆæ¯”å¦‚å¤§å­¦æœŸé—´çš„æˆ‘ï¼‰è€Œè¨€è¿™äº› APP ä¸€å¹´ä¸‹æ¥å¥½å‡ åƒçš„è´¹ç”¨ç¡®å®æ˜¯éš¾ä»¥æ‰¿æ‹…ï¼Œä½†æ˜¯å¯¹æˆ‘è¿™æ ·çš„å·¥ä½œå…šè€Œè¨€ï¼Œä¸å¤±ä¸ºä¸€ä¸ªå¾ˆå¥½çš„å­¦ä¹ æ‰‹æ®µã€‚ ä¸Šè¿°è¿™äº›è½¯ä»¶æœ€å¤§çš„ä¼˜åŠ¿æ˜¯ã€Œäº’åŠ¨ã€ï¼Œè¿™ä¼šä½¿å®ƒæ¯”å•çº¯è‡ªå­¦æœ‰è¶£å¾ˆå¤šï¼Œæ›´å®¹æ˜“åšæŒã€‚ é™¤è–„è·è‹±è¯­å¤–ï¼Œå…¶ä»–ä¸‰ä¸ª APP éƒ½æœ‰æä¾›é•¿çŸ­ä¸ä¸€çš„ä¼šå‘˜ä½“éªŒæ—¶é—´ï¼Œæœ‰å…´è¶£çš„è¯å¯ä»¥è‡ªå·±è¯•ç”¨ä¸‹~ æ€»ç»“ä¸‹ï¼Œç›®å‰å·²ä¹°è¯¾ç¨‹ï¼š ã€ŒçŸ¥ç±³é˜…è¯»ã€199 å…ƒï¼Œ365 å¤©ç•…è¯»æ‰€æœ‰ä¹¦å•ã€‚çœ‹çš„ç¬¬ä¸€æœ¬ä¹¦æ˜¯ã€ŒTime Machineã€ã€‚é˜…è¯»ä½“éªŒå¾ˆä¸é”™ï¼Œè€Œä¸”æ¯”è–„è·é˜…è¯»ä¾¿å®œå¤ªå¤šäº†ã€‚ ã€Œä¸€ç‚¹è‹±è¯­ã€çœ‹è§†é¢‘/å¬æ­Œå­¦è‹±è¯­çœŸçš„éå¸¸æ£’ï¼å·²ç»èŠ± 1998 å…ƒä¹°äº† 270 å¤©çš„ä¼šå‘˜ äº‰å–æ¯å¤©æ‰“å¡ï¼Œèµšåˆ° 1000 ç°é‡‘è¿”è¿˜ç›®å‰ï¼ˆ2022-11-07ï¼‰è¿›åº¦æ˜¯ 62 å¤©ï¼Œå·²ç»æ¼æ‰“å¡ 5 å¤©â€¦ éƒ¨åˆ†åŸå› æ˜¯æ¼æ‰“å¡ç¬¬ä¸€å¤©åï¼Œäº‰å–æ¯å¤©æ‰“å¡çš„æ‰§å¿µå°±æ²¡é‚£ä¹ˆå¼ºçƒˆäº†ï¼Œå¶å°”å“ªä¸€å¤©å¤ªç´¯äº†æˆ–è€…åˆ«çš„äº‹æ²¡æå®Œï¼Œå°±ç›´æ¥ä¸æ‰“å¡äº†â€¦ ã€Œè–„è·è‹±è¯­ã€èŠ±äº† 199 å…ƒä¹°äº†ã€Šä¸€ä¸ªäººçš„æœåœ£ã€‹è¿™ä¸ªåŸç‰ˆä¹¦ï¼Œä¹¦å·²ç»çœ‹å®Œäº†ã€‚å†…å®¹ä¸é”™ï¼Œå°±æ˜¯è·ŸçŸ¥ç±³é˜…è¯»æ¯”å¤ªè´µäº†ã€‚ ã€Œè‹±è¯­æµåˆ©è¯´ã€èŠ±äº† 49 å…ƒï¼Œä¹°äº†ä¸ª 30 å¤©çš„æ‡‚ä½ è‹±è¯­ A+ ä½“éªŒè¯¾ï¼Œä½†æ˜¯å› ä¸ºå‰è¿°åŸå› ï¼ˆAI è¯­éŸ³å¤ªæ­»æ¿ï¼Œå¬å¤šäº†çƒ¦ï¼‰å°±ç”¨äº†ä¸€å‘¨å°±æ²¡ç»§ç»­ç”¨äº†ã€‚ ","date":"2022-09-04","objectID":"/posts/learn-english-again/:0:2","series":null,"tags":["è‹±è¯­","è¯­è¨€å­¦ä¹ "],"title":"Learn English Again","uri":"/posts/learn-english-again/#1-ä¸èŠ±é’±çš„è‡ªå­¦è·¯çº¿"},{"categories":["life"],"content":" äºŒã€è‹±è¯­è‡ªå­¦è·¯çº¿å®Œå…¨æŒ‡å—å› ä¸ºæœ€è¿‘å¯¹è‹±è¯­æ¥äº†ç”µï¼Œå°±æ‰“ç®—æ·±å…¥äº†è§£ä¸‹å¸‚é¢ä¸Šå¸¸è§çš„è‹±è¯­å­¦ä¹ è·¯å¾„ï¼Œäº‰å–æ‰¾åˆ°æœ€ä½³å­¦ä¹ è·¯çº¿ã€‚ 1. ä¸èŠ±é’±çš„è‡ªå­¦è·¯çº¿é¦–å…ˆæ˜¯ä¸èŠ±é’±çš„è‡ªå­¦è·¯çº¿ï¼Œè¿™ä¸ªæˆ‘åœ¨å¤§ä¸‰æ—¶æœ‰è¿‡å®è·µï¼Œå½“æ—¶æ‰“ç®—è€ƒç ”ï¼Œä¸“é—¨ç»ƒè¿‡ä¸€æ³¢è‹±è¯­ï¼Œå¤§è‡´è·¯çº¿æ˜¯è¿™æ ·çš„ï¼š æ¶é­”å¥¶çˆ¸æ€»ç»“çš„ ç»ƒä¹ è‹±è¯­å£è¯­çš„åŠæ³•ï¼Œæœ¬äººå®æµ‹æ•ˆæœæ˜¾è‘— å…¶ä¸­ä»‹ç»çš„ ESLPodã€EnglishPod ç­‰ææ–™ï¼Œä¸ä»…å¯ä»¥æå‡è¯­æ„Ÿï¼Œä¹Ÿèƒ½å¸®åŠ©æå‡å¬åŠ›ã€‚ å¦‚æœæ˜¯è¿›é˜¶çš„è¯ï¼Œå¯ä»¥å» Youtube ä¸Šçœ‹ä¸€äº›æµè¡Œçš„ Talk Showï¼Œè¿™ç±»è§†é¢‘å¾ˆæœ‰æ„æ€ã€è¯­é€Ÿå¿«ä¿¡æ¯é‡åˆå¤§ï¼Œæ˜¯å¾ˆåˆé€‚çš„è¿›é˜¶å­¦ä¹ ææ–™ ä»¥çœ‹è§†é¢‘çš„æ–¹å¼å­¦è‹±è¯­ï¼Œä¸€ä¸ªè¦ç‚¹å°±æ˜¯ã€Œé‡å¤ã€æˆ–è€…è¯´ã€Œç²¾å¬ã€ã€‚ ã€Œä¸€ç‚¹è‹±è¯­ã€å°±æ˜¯åœ¨è¿™ä¸Šé¢ä¸‹äº†ä¸å°‘åŠŸå¤«ï¼Œè¦é€‰é‚£ç§ç¬¬ä¸€éå¬æœ‰éš¾åº¦çš„è§†é¢‘ï¼Œæœ€å¥½å†…å®¹è¿˜æ¯”è¾ƒæœ‰è¶£ ï¼ˆæ¯”å¦‚ Talk Show å°±æ¯”è¾ƒæœ‰æ„æ€ï¼‰ã€‚ å¯è¡Œçš„å­¦ä¹ æ–¹æ³•ï¼šç¬¬ä¸€éå¸¦å­—å¹•çœ‹è§†é¢‘ï¼Œä½†æ˜¯å°½é‡åˆ«çœ‹å­—å¹•ï¼›ç¬¬äºŒéå¸¦å­—å¹•åå¤ç²¾çœ‹å¬ä¸æ‡‚çš„éƒ¨åˆ†ï¼Œç¬¬ä¸‰éå†å®Œå…¨å…³æ‰å­—å¹•éªŒè¯å­¦ä¹ æ•ˆæœã€‚ è¿˜æœ‰å°±æ˜¯å¾ˆå¤šäººæ¨èçš„é˜…è¯»è‹±æ–‡åŸç‰ˆä¹¦ ä¸€å¼€å§‹å¯èƒ½ä¼šè¯»å¾—å¾ˆæ…¢ï¼Œè¿™ä¸ªæ—¶å€™æœ€é‡è¦çš„å°±æ˜¯åšæŒï¼é˜…è¯»é‡ä¸Šæ¥äº†ï¼Œé€Ÿåº¦è‡ªç„¶å°±æå‡äº†ã€‚ è®©è‡ªå·±æ›´å®¹æ˜“åšæŒçš„é˜…è¯»æ–¹æ³•ï¼š è¦æ‰¾ä¸€äº›ä½ æ„Ÿå…´è¶£çš„ã€éš¾åº¦é€‚ä¸­çš„åŸç‰ˆä¹¦ï¼ˆæ¯”å¦‚æ„Ÿå…´è¶£çš„å°è¯´ã€ä¸“ä¸šç›¸å…³çš„æŠ€æœ¯ä¹¦ç­‰ï¼‰ã€‚å› ä¸ºé˜…è¯»çš„é¦–è¦ç‚¹æ˜¯è¦èƒ½æ„Ÿå—åˆ°ä¹è¶£ï¼Œå¦åˆ™ä¼šå¾ˆæ¯ç‡¥ï¼Œå¾ˆéš¾åšæŒã€‚ ç„¶åè¦åšå¥½è§„åˆ’å¹¶åšæŒæ‰§è¡Œï¼Œæ¯”å¦‚æ¯å¤©è¯» 10 é¡µã€‚ å½“ç„¶ä½ ä¹Ÿå¯ä»¥èµ°ä¼ ç»Ÿçš„èƒŒå•è¯ã€è¯ç»„ã€ä¾‹å¥è¿™æ ·çš„è·¯çº¿ï¼Œè¿™æ¡è·¯çº¿çš„å¥½å¤„æ˜¯èƒ½å¿«é€Ÿæå‡è‡ªå·±çš„è‹±è¯­èƒ½åŠ›ï¼Œä½†æ˜¯ç›¸å¯¹çš„ä¹Ÿå¾ˆéš¾åšæŒã€‚ å¸¸è§çš„æœ‰æ–°ä¸œæ–¹çš„è¯æ±‡å½•æ’­è¯¾ï¼ˆç½‘ä¸Šèƒ½æ‰¾åˆ°å…è´¹çš„èµ„æ–™åˆ†äº«ï¼‰ï¼Œä»¥å‰å¬è¿‡æ–°ä¸œæ–¹æœ±ä¼Ÿè€å¸ˆçš„ã€Šæ‹ç»ƒæœ‰è¯ã€‹ï¼Œæ„Ÿè§‰æŒºä¸é”™çš„ã€‚ ä¸èƒŒå•è¯ã€ç™¾è¯æ–©è¿™ç±» APP ä¹Ÿå¯ä»¥è¯•è¯•ï¼Œä¸è¿‡æˆ‘ä¸ªäººä½“éªŒæ˜¯åŸºæœ¬åšæŒä¸äº†å¤šä¹…â€¦ æ¯æ—¥è‹±è¯­å¬åŠ› è·Ÿæ¬§è·¯è¯å…¸æ˜¯åŒä¸€å®¶å…¬å¸åšçš„ï¼Œå¾ˆè‰¯å¿ƒã€‚ ä¸è¿‡å› ä¸ºæˆ‘å·²ç»ä¹°äº†å…¶ä»–è¯¾ç¨‹äº†ï¼Œè¿™ä¸ª APP ç›®å‰ç”¨å¾—æ¯”è¾ƒå°‘ã€‚ æ¯æ—¥è‹±è¯­å¬å†™ Daily English Dictation 1-400 è¿™æ˜¯ Youtube ä¸Šç›¸å½“ç«çš„ä¸€ä¸ªè‹±è¯­å¬å†™ç³»åˆ—è§†é¢‘ï¼Œåšå¾—éå¸¸æ£’ï¼ŒåšæŒå¬å®Œ 400 æœŸï¼Œå¬åŠ›å°±ç¥åŠŸå¤§æˆäº†ï¼ ä¸ªäººæ„Ÿè§‰èµ·ç å¾—æœ‰ä¸ª CET4 æ°´å¹³ï¼Œæ‰èƒ½æ¯”è¾ƒèˆ’æœåœ°è·Ÿè¿™ä¸ªè¯¾ç¨‹ã€‚ ä¸€äº›å¯¹è¯ã€è§’è‰²è®¾å®šã€ä¸–ç•Œè§‚è®¾å®šè¾ƒå¤šçš„æ¸¸æˆä¹Ÿæ˜¯å­¦è‹±è¯­çš„å¥½ææ–™ï¼Œæ¯”å¦‚ã€ŒGenshin Impactã€ã€ã€ŒDEEMO 2ã€ï¼Œæˆ–è€…ä¸€äº› Galgame éƒ½å¯ã€‚å¨±ä¹è·Ÿè‹±è¯­ä¸¤ä¸è¯¯ emmm Genshin Impact é‡Œè¶…é£’çš„é‡å‰‘å¥³ä»† Noelle DEEMO 2 ä¸­ä¸°å¯Œçš„å¯¹è¯å†…å®¹ DEEMO 2 çš„ä¸€äº›è®¾å®š ä¸Šé¢ä¸»è¦æ˜¯é’ˆå¯¹ CET4 å››çº§ä»¥ä¸Šæ°´å¹³çš„è‹±è¯­å­¦ä¹ è€…ï¼Œå¦‚æœåŸºç¡€æ¯”è¾ƒå·®ï¼Œå¯ä»¥è€ƒè™‘æŒ‰ç…§æ¶é­”å¥¶çˆ¸æ¨èçš„é›¶åŸºç¡€è‹±è¯­å­¦ä¹ è·¯çº¿è¿›è¡Œè‡ªå­¦ï¼š è‹±è¯­ï¼šå£¹ç«  - æ¶é­”å¥¶çˆ¸ï¼šé’ˆå¯¹é›¶åŸºç¡€/åŸºç¡€è¶…çº§ä¸å¥½çš„åŒå­¦ è‹±è¯­ï¼šè´°ç«  - æ¶é­”å¥¶çˆ¸ï¼šé’ˆå¯¹å¤„äºè‹±è¯­åˆçº§é˜¶æ®µçš„åŒå­¦ è‹±è¯­ï¼šåç«  - æ¶é­”å¥¶çˆ¸ï¼šé’ˆå¯¹å¤§å­¦å››å…­çº§æ°´å¹³çš„åŒå­¦ ï¼ˆå°±è·Ÿæˆ‘ä¸Šé¢åˆ—çš„å·®ä¸å¤šäº†ï¼‰ 2. èŠ±é’±æŠ„æ·å¾„è€Œå¯¹äºæˆ‘è¿™ç§ä¸Šç­æ—æˆ–è€…å…¶ä»–æœ‰é—²é’±çš„å­¦ç”Ÿï¼Œè€Œä¸”ä¸æ±‚å¿«é€Ÿæå‡è‹±è¯­èƒ½åŠ›çš„äººè€Œè¨€ï¼Œå¦‚æœæ„¿æ„èŠ±ç‚¹å°é’±ï¼Œä¹Ÿæ˜¯æœ‰æ·å¾„å¯ä»¥æŠ„çš„ã€‚ é¦–å…ˆå°±æ˜¯çº¿ä¸‹è¯¾ç¨‹è·Ÿçº¿ä¸Šè§†é¢‘è¯¾ç¨‹ï¼ˆæ¯”å¦‚æ–°ä¸œæ–¹ã€å±±å§†è‹±è¯­ï¼‰ï¼Œè¿™ä¸ªæ²¡æ—¶é—´å‚åŠ ï¼Œæ—¶é—´å®‰æ’ä¹Ÿä¸å¤Ÿçµæ´»ï¼Œè€Œä¸”å¯èƒ½ä¼šæ¯”è¾ƒæ¯ç‡¥ï¼Œç›´æ¥ Pass. å…¶æ¬¡å°±æ˜¯è‹±è¯­å­¦ä¹ ç±» APP äº†ï¼Œè¿™ä¸ªå¸‚é¢ä¸Šè¿˜æœ‰æŒºå¤šçš„ï¼Œæˆ‘è¯•ç”¨äº†ä¸€æ³¢åæ„Ÿè§‰å¾ˆé€‚åˆæˆ‘ï¼Œå¹¶ä¸”ç­›é€‰å‡ºäº†ä¸‹é¢å‡ ä¸ªæ¯”è¾ƒä¸­æ„çš„ APPï¼šæ¬§è·¯è¯å…¸ã€çŸ¥ç±³é˜…è¯»ã€å¼€è¨€è‹±è¯­ä»¥åŠä¸€ç‚¹è‹±è¯­ã€‚ å¹¶ä¸”ä½¿ç”¨ä¸Šè¿°å‡ æ¬¾è½¯ä»¶æä¾›çš„è‹±è¯­èƒ½åŠ›æµ‹è¯•ï¼Œå®Œæ•´è¯„ä¼°äº†ä¸‹æˆ‘çš„è‹±è¯­æ°´å¹³ã€‚ä¸‹å›¾ä»å·¦è‡³å³ä¾æ¬¡æ˜¯ä¸€ç‚¹è‹±è¯­ã€å¼€è¨€è‹±è¯­ï¼Œä»¥åŠè‹±è¯­æµåˆ©è¯´çš„æ•´ä½“è‹±è¯­æ°´å¹³è·Ÿå£è¯­æ°´å¹³ä¸¤é¡¹æµ‹è¯•ç»“æœï¼ˆç»“æœåé«˜ï¼Œä»…ä¾›å‚è€ƒï¼‰ï¼š å„ APP çš„è‹±è¯­æ°´å¹³æµ‹è¯„ç»“æœï¼ˆä¸€ç‚¹è‹±è¯­çš„ç»“æœæ˜æ˜¾åé«˜ï¼‰ æµåˆ©è¯´è‹±è¯­è¯„çº§å¯¹ç…§è¡¨ ä¸‹é¢è¯¦ç»†ä»‹ç»ä¸‹æˆ‘æ¯”è¾ƒæ¨èçš„è‹±è¯­å­¦ä¹ ç±» APP è·Ÿè¯¾ç¨‹ï¼š æ¬§è·¯è¯å…¸ æœ€ç‰›é€¼çš„è¯å…¸è½¯ä»¶ï¼Œéå¸¸é€‚åˆç”¨äºæ—¥å¸¸æŸ¥è¯ã€‚ æœ€å¼ºçš„ä¸€ç‚¹åœ¨äºå®ƒèƒ½å¯¼å…¥å„ç§ç¦»çº¿è¯å…¸ï¼Œè¯¦è§æ¶é­”å¥¶çˆ¸æœ‰åˆ†äº«çš„è¯å…¸æ–‡ç« ï¼Œ æˆ‘ç”¨åˆ°çš„æœ‰å¦‚ä¸‹å‡ æœ¬ï¼š ä¸­è‹±åŒè§£è¯å…¸ æŸ¯æ—æ–¯åŒè§£ Collins Cobuild Advanced Learnerâ€™s English Dictionaryï¼šåŒ…å«ä¸­æ–‡ç¿»è¯‘ã€è‹±è‹±é‡Šä¹‰è·Ÿå¥å­ç¤ºä¾‹ï¼Œè¿˜æä¾› 1-5 çš„å•è¯ä½¿ç”¨é¢‘ç‡æ ‡è¯† Microsoft Bing Dictionaryï¼šæ˜¯ç½‘å‹æŠ“å–åˆ¶ä½œçš„å¿…åº”å¤§è¯å…¸ï¼Œè·Ÿ Collins Cobuild ç±»ä¼¼ï¼ŒåŒ…å«çº§åˆ«ï¼ˆCET4/CET6/GREï¼‰ã€ä¸­æ–‡ç¿»è¯‘ã€è‹±è‹±é‡Šä¹‰è·Ÿå¥å­ç¿»è¯‘ è‹±è‹±è¯å…¸ LDOCEæœ—æ–‡å½“ä»£5 è‹±è‹±ç‰ˆ: å…‰ä½“ç§¯å°± 1Gï¼ŒåŒ…å«äº†æ‰€æœ‰å•è¯ä¾‹å¥çš„å½•éŸ³ï¼Œæ˜¯éå¸¸è¯¦å°½çš„ä¸€æœ¬è‹±è‹±å­¦ä¹ è¯å…¸ã€‚æ”¶è¯é‡ç›¸å½“å¤§ï¼ŒçŸ­è¯­ã€ç”¨æ³•å®Œå¤‡ è¯ç»„æ­é…ã€åŒä¹‰è¯è¯å…¸ ç‰›æ´¥æ­é…è¯å…¸ç¬¬äºŒç‰ˆ Collins Thesaurus Collins COBUILD English Usage WordNet 3.0 USE THE RIGHT WORD: åŒä¹‰è¿‘ä¹‰è¯ç”¨æ³•è§£é‡Šï¼Œå¾ˆè¯¦ç»† Merriam-Websterâ€™s Vocabulary Builder: é€šè¿‡è¯æ ¹è¯ç¼€æ¥å…³è”èµ·å„ç§ç›¸å…³å•è¯ è‹±è¯­å¸¸ç”¨è¯ç–‘éš¾ç”¨æ³•æ‰‹å†Œ è–„è·é˜…è¯»ï¼š199 å…ƒ / 100 å¤© é˜…è¯»åŸç‰ˆä¹¦å­¦ä¹ è‹±è¯­ ç”¨å®ƒè¾…åŠ©é˜…è¯»åŸç‰ˆä¹¦çš„å¥½å¤„æœ‰ï¼š ä¼šæå‰å¸®ä½ é€‰å‡ºç”Ÿè¯è¿›è¡Œé¢„ä¹  æä¾›é…å¥—çš„æœ‰å£°ä¹¦ï¼Œå¯ä»¥å¬ä¹¦ä¹Ÿå¯ä»¥çœ‹ä¹¦ éšæ—¶åŒå‡»æŸ¥è¯ï¼ŒæŸ¥è¯éå¸¸æ–¹ä¾¿ å­¦ä¹ å®Œæˆåè¿˜æœ‰æä¾›é…å¥—çš„è®²ä¹‰ï¼Œå¯¹å„é¡¹å•è¯ã€è¯ç»„ã€ç–‘éš¾å¥è¿›è¡Œè¯¦ç»†è§£é‡Šï¼Œè¿™ä¸ªæ„Ÿè§‰ä¼šéå¸¸æœ‰ç”¨ï¼ ç¼ºç‚¹ æ¯é€¢è´­ç‰©æ´»åŠ¨å°±å¼€å§‹æ‰“å¹¿å‘Šï¼Œè®©äººæœ‰ç‚¹çƒ¦ã€‚ ç›¸æ¯”åé¢çš„ç«å“ï¼Œä»·æ ¼æœ‰ç‚¹å¤ªé«˜äº†â€¦ çŸ¥ç±³é˜…è¯»ï¼š199 å…ƒï¼Œ365 å¤©ç•…è¯»æ‰€æœ‰ä¹¦å• é˜…è¯»åŸç‰ˆä¹¦å­¦ä¹ è‹±è¯­ è·Ÿè–„è·é˜…è¯»å‡ ä¹ä¸€æ ·çš„æ¨¡å¼ï¼ŒåŠŸèƒ½å¤§åŒå°å¼‚ã€‚ ä½†æ˜¯å®ƒçš„å¹´è´¹ä¼šå‘˜ä»…ä¸ºè–„è·é˜…è¯» VIP çš„ 1/5ï¼Œè€Œä¸”è¿˜èƒ½ç•…è¯»æ‰€æœ‰ä¹¦å•ï¼ ä¸ªäººæ„Ÿè§‰å®ƒçš„å°ç¨‹åºè®¾è®¡æ„Ÿæ¯”è–„è·é˜…è¯»æ›´å¥½ ä¸€ç‚¹è‹±è¯­ï¼š æŠ˜å 1998 å…ƒ 270 å¤© å¦‚æœåšæŒæ‰“å¡ 270 å¤©ï¼ŒæœŸæœ«è¿˜è¿” 1000 ç°é‡‘ + 500 ç»­è¯¾åˆ¸ï¼ˆå®æµ‹å¤§åŠå¹´ä¸‹æ¥æ„å¤–å¤ªå¤šï¼ŒåŸºæœ¬ä¸å¯èƒ½æ‹¿åˆ°ã€ä½†æ˜¯ä¸‡ä¸€å°±æˆåŠŸäº†å‘¢â€¦ï¼‰ é€šè¿‡ã€Œæ¼”è®²/åŠ¨æ¼«/å–œå‰§/éŸ³ä¹ç°åœºã€ç­‰å„ç§è§†é¢‘å†…å®¹å­¦ä¹ è‹±è¯­å•è¯ï¼ŒåŒæ—¶ç»ƒä¹ å¬åŠ›è·Ÿå£è¯­ ç›¸æ¯”å…¶ä»– APPï¼Œå®ƒçš„è¯¾ç¨‹ä¼šæœ‰è¶£å¾ˆå¤šï¼Œä¸é‚£ä¹ˆæ¯ç‡¥ã€‚æˆ‘è§‰å¾—ç”¨å®ƒç»ƒä¹ å¬åŠ›éå¸¸åˆé€‚ã€‚ ç¼ºé™·ï¼š å®ƒçš„è§†é¢‘è¯­æ–™æœ‰éƒ¨åˆ†è·Ÿå•è¯æœ‰ç‚¹å¯¹ä¸ä¸Šï¼Œæœ‰æ—¶å€™ä¼šé‡ä¸Šï¼Œä¸è¿‡æ— ä¼¤å¤§é›…ã€‚ å®ƒèƒŒå•è¯çš„åŠŸèƒ½è·Ÿã€Œä¸èƒŒå•è¯ã€æˆ–è€…ã€Œæ¬§è·¯è¯å…¸ã€å·®è·è¾ƒå¤§ã€‚å…¶ä¸­è‹±è§£é‡Šæ¯”è¾ƒç®€é™‹ã€è®°å¿†ç®—æ³•å¼ºåº¦æ²¡ä¸èƒŒå•è¯é«˜ï¼Œä¹Ÿæ²¡æœ‰è¯æ ¹è¯ç¼€åŠŸèƒ½ï¼Œæ­¤å¤–ä¾‹å¥å¶å°”ä¼šæœ‰äº›é”™è¯¯ã€‚ å¼€è¨€è‹±è¯­ é€šè¿‡å¤–æ•™å½•åˆ¶çš„è§†é¢‘ + ç¨‹åºæ§åˆ¶å®ç°äº†ä¸€å®šçš„å¯äº¤äº’æ€§ï¼Œæ„Ÿè§‰è¯¾ç¨‹æ¯”è‹±è¯­æµåˆ©è¯´åšå¾—è¦æœ‰è¶£äº›ã€‚ å¼€è¨€è‹±è¯­çš„ WeMeet è‹±è¯­è§’ä½“éªŒçœŸçš„è¶…æ£’ï¼Œè€Œä¸”è¿˜å…è´¹ï¼ ç¬¬ä¸€æ¬¡å‚åŠ æ—¶ï¼Œä¸€èµ·èŠå¤©çš„ä¸¤ä½æœ‹å‹ï¼Œä¸€ä½åœ¨ä¸‡è±ªé…’åº—å·¥ä½œäº†å·®ä¸å¤š 10 å¹´ï¼Œå¦ä¸€ä½æ˜¯äº§å“ç»ç†ï¼Œåœ¨è…¾è®¯ã€æœç‹ã€ç¾å›¢ç­‰å…¬å¸å·¥ä½œäº†å·®ä¸å¤š 15 å¹´ï¼ŒèŠå¾—éå¸¸å¼€å¿ƒï¼Œå¾ˆæœ‰æ”¶è·ï¼ ä»·æ ¼ å¤–æ•™ç³»ç»Ÿè¯¾æ˜¯ 2598 ä¸€å¹´ï¼Œæä¾›æµ·é‡å¤–æ•™è§†é¢‘äº’åŠ¨è¯¾è·ŸéŸ³é¢‘è¯¾ è¿˜æœ‰ä¸ªå¤–æ•™è§†é¢‘è¯¾ï¼Œäº’åŠ¨æ€§ä¼šæ›´é«˜ï¼Œä»·æ ¼æ˜¯ 1598 ä¸€å¹´ ã€Šæ½˜å‰ Jenny å‘Šè¯‰ä½ ã€‹è¿™ä¸ªå£ç¢‘åœ¨ï¼Œæˆ‘è§‰å¾—å¼€è¨€è‹±è¯­çš„å¤–æ•™è¯¾ç¨‹æ˜¯å¯ä»¥è€ƒè™‘çš„ æ–°ä¸œæ–¹åœ¨çº¿ åœ¨çº¿å½•æ’­è¯¾ã€ç›´æ’­è¯¾ï¼Œä»ä»¥å‰å­¦è¿‡çš„è€ƒç ”è‹±è¯­çœ‹ï¼Œè¿˜æ˜¯å¾ˆä¸“ä¸šã€å¾ˆæˆä½“ç³»çš„ã€‚ å¯¹ BECã€é›…æ€ã€æ‰˜ç¦éƒ½æœ‰å¯¹åº”çš„è¯¾ç¨‹å¯é€‰ï¼Œä»·æ ¼å¯¹å·¥ä½œå…šè€Œè¨€é—®é¢˜ä¸å¤§ã€‚ VoiceTubeï¼šä»·æ ¼è¿˜ä¸å¤ªæ¸…æ¥š åº”è¯¥æ˜¯æœ€æ—©åšã€Œçœ‹è§†é¢‘å­¦è‹±è¯­ã€åŠŸèƒ½çš„ APP ä¹‹ä¸€ï¼Œå®ƒæœ€åˆå‘å¸ƒäº 2013/09ï¼Œè€Œå‰é¢ä»‹ç»çš„ã€Œä¸€ç‚¹è‹±è¯­ã€æœ€åˆå‘å¸ƒäº 2018 å¹´ï¼ˆè€Œä¸” UI å¸ƒå±€ä¹Ÿè·Ÿ VoiceTube å¾ˆç±»ä¼¼ï¼‰ã€‚ è·å¾—äº† Facebook 2016 å¹´å¹´åº¦æœ€ä½³ APP å¥–é¡¹ ä½†æ˜¯ï¼ˆå› ä¸ºç‰ˆæƒåŸå› ï¼‰å®ƒåŸºæœ¬éƒ½æ˜¯ç›´æ¥å†…åµŒçš„ Youtube è§†é¢‘ï¼Œå®ƒéœ€è¦åŒæ—¶å®‰è£… Youtubeï¼ˆåŒæ—¶è¿˜éœ€è¦ä¸€äº›ä½¿ä½ èƒ½è®¿é—® Youtube çš„ç‰¹æ®Šæ‰‹æ®µï¼‰ã€‚ å¦å¤–ä¸€äº›æˆ‘ç”¨è¿‡ä½†æ˜¯ä¸æ¨èçš„ APP ä¹Ÿç®€å•è¯´ä¸‹é—®é¢˜æ‰€åœ¨ï¼š è‹±è¯­æµåˆ©è¯´ æ‡‚ä½ è‹±è¯­ A+ è¯¾ç¨‹è´¨é‡ç¡®å®ä¸é”™ï¼Œä½†æ˜¯å…¨éƒ½æ˜¯ AI è¯­éŸ³ï¼Œè™½ç„¶å¾ˆæ ‡å‡†ï¼Œä½†æ˜¯å¤ªæœºæ¢°äº†ï¼Œä¸å¸¦å•¥æ„Ÿæƒ…ï¼Œæˆ‘å­¦äº†æ‰ 6 å¤©å°±å¼€å§‹åŒå€¦äº†ã€‚ä¸ªäººä¸æ¨èé€‰å®ƒ ç™¾è¯æ–© æ›´é€‚åˆç”¨äºè¶£å‘³æ€§èƒŒå•è¯ å¯¹å¾ˆå¤šå­¦ç”Ÿå…šï¼ˆæ¯”å¦‚å¤§å­¦æœŸé—´çš„æˆ‘ï¼‰è€Œè¨€è¿™äº› APP ä¸€å¹´ä¸‹æ¥å¥½å‡ åƒçš„è´¹ç”¨ç¡®å®æ˜¯éš¾ä»¥æ‰¿æ‹…ï¼Œä½†æ˜¯å¯¹æˆ‘è¿™æ ·çš„å·¥ä½œå…šè€Œè¨€ï¼Œä¸å¤±ä¸ºä¸€ä¸ªå¾ˆå¥½çš„å­¦ä¹ æ‰‹æ®µã€‚ ä¸Šè¿°è¿™äº›è½¯ä»¶æœ€å¤§çš„ä¼˜åŠ¿æ˜¯ã€Œäº’åŠ¨ã€ï¼Œè¿™ä¼šä½¿å®ƒæ¯”å•çº¯è‡ªå­¦æœ‰è¶£å¾ˆå¤šï¼Œæ›´å®¹æ˜“åšæŒã€‚ é™¤è–„è·è‹±è¯­å¤–ï¼Œå…¶ä»–ä¸‰ä¸ª APP éƒ½æœ‰æä¾›é•¿çŸ­ä¸ä¸€çš„ä¼šå‘˜ä½“éªŒæ—¶é—´ï¼Œæœ‰å…´è¶£çš„è¯å¯ä»¥è‡ªå·±è¯•ç”¨ä¸‹~ æ€»ç»“ä¸‹ï¼Œç›®å‰å·²ä¹°è¯¾ç¨‹ï¼š ã€ŒçŸ¥ç±³é˜…è¯»ã€199 å…ƒï¼Œ365 å¤©ç•…è¯»æ‰€æœ‰ä¹¦å•ã€‚çœ‹çš„ç¬¬ä¸€æœ¬ä¹¦æ˜¯ã€ŒTime Machineã€ã€‚é˜…è¯»ä½“éªŒå¾ˆä¸é”™ï¼Œè€Œä¸”æ¯”è–„è·é˜…è¯»ä¾¿å®œå¤ªå¤šäº†ã€‚ ã€Œä¸€ç‚¹è‹±è¯­ã€çœ‹è§†é¢‘/å¬æ­Œå­¦è‹±è¯­çœŸçš„éå¸¸æ£’ï¼å·²ç»èŠ± 1998 å…ƒä¹°äº† 270 å¤©çš„ä¼šå‘˜ äº‰å–æ¯å¤©æ‰“å¡ï¼Œèµšåˆ° 1000 ç°é‡‘è¿”è¿˜ç›®å‰ï¼ˆ2022-11-07ï¼‰è¿›åº¦æ˜¯ 62 å¤©ï¼Œå·²ç»æ¼æ‰“å¡ 5 å¤©â€¦ éƒ¨åˆ†åŸå› æ˜¯æ¼æ‰“å¡ç¬¬ä¸€å¤©åï¼Œäº‰å–æ¯å¤©æ‰“å¡çš„æ‰§å¿µå°±æ²¡é‚£ä¹ˆå¼ºçƒˆäº†ï¼Œå¶å°”å“ªä¸€å¤©å¤ªç´¯äº†æˆ–è€…åˆ«çš„äº‹æ²¡æå®Œï¼Œå°±ç›´æ¥ä¸æ‰“å¡äº†â€¦ ã€Œè–„è·è‹±è¯­ã€èŠ±äº† 199 å…ƒä¹°äº†ã€Šä¸€ä¸ªäººçš„æœåœ£ã€‹è¿™ä¸ªåŸç‰ˆä¹¦ï¼Œä¹¦å·²ç»çœ‹å®Œäº†ã€‚å†…å®¹ä¸é”™ï¼Œå°±æ˜¯è·ŸçŸ¥ç±³é˜…è¯»æ¯”å¤ªè´µäº†ã€‚ ã€Œè‹±è¯­æµåˆ©è¯´ã€èŠ±äº† 49 å…ƒï¼Œä¹°äº†ä¸ª 30 å¤©çš„æ‡‚ä½ è‹±è¯­ A+ ä½“éªŒè¯¾ï¼Œä½†æ˜¯å› ä¸ºå‰è¿°åŸå› ï¼ˆAI è¯­éŸ³å¤ªæ­»æ¿ï¼Œå¬å¤šäº†çƒ¦ï¼‰å°±ç”¨äº†ä¸€å‘¨å°±æ²¡ç»§ç»­ç”¨äº†ã€‚ ","date":"2022-09-04","objectID":"/posts/learn-english-again/:0:2","series":null,"tags":["è‹±è¯­","è¯­è¨€å­¦ä¹ "],"title":"Learn English Again","uri":"/posts/learn-english-again/#2-èŠ±é’±æŠ„æ·å¾„"},{"categories":["life"],"content":" ä¸‰ã€å¦‚ä½•ç»ƒä¹ è‹±è¯­å£è¯­ï¼Ÿé¦–å…ˆï¼Œä¸Šé¢å·²ç»æè¿‡äº†ï¼Œã€Œå¼€è¨€è‹±è¯­ã€çš„çº¿ä¸Šè‹±è¯­è§’ WeMeet éå¸¸çš„æ£’ã€‚è¿™ä¸ªåŠŸèƒ½æ˜¯å…è´¹çš„ï¼Œä½†æ˜¯éœ€è¦äº¤ 5 å—é’±æŠ¼é‡‘ï¼Œæˆ‘è§‰å¾—è¿™ 5 å—é’±çš„æŠ¼é‡‘å¤§å¤§æå‡äº†è¿™ä¸ªè‹±è¯­è§’çš„é˜Ÿå‹è´¨é‡ï¼Œèƒ½ç¡®ä¿å¤§å®¶éƒ½æ˜¯æœ‰å¼ºçƒˆæ„æ„¿å»ç”¨è‹±è¯­èŠå¤©çš„ã€‚å®é™…çš„ä½“éªŒä¹Ÿéå¸¸æ£’ï¼Œä¸ä»…èƒ½ç»ƒä¹ å£è¯­ï¼Œè¿˜èƒ½äº¤åˆ°å„è¡Œå„ä¸šå–œæ¬¢è‹±è¯­çš„æœ‹å‹ã€‚ å…¶æ¬¡ï¼Œå¦‚æœä½ çš„ä¸Šç½‘å·¥å…·èƒ½ä½¿ä½ ç”¨ä¸Š Discordï¼Œä¹Ÿæœ‰ä¸€äº›è‹±è¯­å­¦ä¹ çš„ Discord Server éå¸¸å€¼å¾—æ¨èï¼Œ ä½ èƒ½åœ¨ä¸Šé¢è·Ÿå„ç§æ¯è¯­ã€å„ä¸ªå›½å®¶ã€å„ç§å£éŸ³çš„æœ‹å‹ä¸€èµ·ç”¨è‹±è¯­èŠå¤©ï¼Œä½“éªŒè¿˜ä¸é”™ï¼Œè¿˜èƒ½äº¤åˆ°æœ‰æ„æ€çš„å›½å¤–æœ‹å‹ã€‚ è‹±è¯­å­¦ä¹  Discord Server åœ°å€: https://discord.gg/english https://discord.gg/c-e åŠ å…¥ Server åè¦å¾€ä¸‹ç¿»å¾ˆå¤šé¡µæ‰èƒ½åˆ° English Practice éƒ¨åˆ†ï¼Œç›®å‰åˆ†åˆ«æœ‰ 8 ä¸ªã€ŒBeginner Englishã€èŠå¤©å®¤è·Ÿ 8 ä¸ªã€ŒIntermeidate/Advanced Englishã€èŠå¤©å®¤ï¼Œèµ¶å¿«åŠ å…¥å¼€èŠå§~ æ­¤å¤–ï¼Œå¦‚æœä½ æƒ³èµ°é«˜æ•ˆçš„æ°ªé‡‘è·¯çº¿ï¼Œä¹Ÿæœ‰å¾ˆå¤šçº¿ä¸ŠçœŸäººä¸Šå¤–æ•™å¹³å°ä¾›ä½ é€‰æ‹©ï¼Œä¸»è¦æœ‰å¦‚ä¸‹å‡ ä¸ªï¼š Lingoda: è¢«è®¤ä¸ºæ˜¯æœ€ä½³æˆäººè‹±è¯­å­¦ä¹ å¹³å°ä¹‹ä¸€ï¼Œå®ƒæœ‰éƒ¨åˆ†è¯¾è¿˜æä¾›äº†å­¦è´¹è¿”è¿˜æœºåˆ¶ï¼Œå¯ä»¥äº†è§£ä¸‹ã€‚ Cambly: twitter ä¸Šæ¨å‹æ¨èçš„ï¼Œæœ€æµè¡Œçš„è‹±è¯­å­¦ä¹ å¹³å°ä¹‹ä¸€ï¼ŒçœŸäººå¤–æ•™ä¸€å¯¹ä¸€æ•™å­¦ æ®è¯´æ‰“æŠ˜æ—¶å¾ˆä¾¿å®œï¼Œä¼˜æƒ ä»·åªè¦äººæ°‘å¸ 30 å…ƒ 30 åˆ†é’Ÿ Preply: æˆ‘ç”¨çš„è¯æ±‡æµ‹è¯•ç«™ç‚¹ï¼Œç°åœ¨å°±å±äºè¿™å®¶å…¬å¸çš„äº§å“ã€‚æ®è¯´æ¯”è¾ƒä¸“ä¸šï¼Œæä¾› 4-5 äººå°ç»„æ•™å­¦è·Ÿä¸€å¯¹ä¸€æ•™å­¦ä¸¤ç§å­¦ä¹ æ¨¡å¼ è²Œä¼¼æ¯”è¾ƒè´µï¼š$15-20 per hour ä½ è¿˜å¯ä»¥åœ¨è¿™ä¸ªç«™ç‚¹ä¸Šé¢åº”è˜æ±‰è¯­æ•™å­¦ï¼ˆæœ‰ 20%-30% çš„æŠ½æˆï¼Œ150 ç¾åˆ€æ‰èƒ½æç°ï¼‰ Verbling: ä¸€æ ·ä¹Ÿæ˜¯ä¸€ä¸ªè€ç‰Œè¯­è¨€å­¦ä¹ ç«™ç‚¹ æ®è¯´ä»·æ ¼æ¯”è¾ƒä¼˜æƒ ï¼Œè¿˜æ”¯æŒå…è´¹è¯•è¯¾ã€‚ è·Ÿ Preply ä¸€æ ·ä½ ä¹Ÿå¯ä»¥åœ¨è¿™ä¸ªç«™ç‚¹ä¸Šé¢åº”è˜æ±‰è¯­æ•™å­¦ä½œä¸ºå…¼èŒã€‚ ITalk: å›½å†…åˆ›åŠçš„æ¯”è¾ƒå¤§çš„è¯­è¨€äº¤æ¢å¹³å°ï¼Œæ®è¯´æ˜¯æœ€ casual çš„å­¦ä¹ å¹³å°ï¼Œæ‰€ä»¥ä¸å¤ªé€‚åˆè‡ªæˆ‘é©±åŠ¨åŠ›ä¸å¼ºçš„æœ‹å‹ã€‚ ","date":"2022-09-04","objectID":"/posts/learn-english-again/:1:0","series":null,"tags":["è‹±è¯­","è¯­è¨€å­¦ä¹ "],"title":"Learn English Again","uri":"/posts/learn-english-again/#ä¸‰å¦‚ä½•ç»ƒä¹ è‹±è¯­å£è¯­"},{"categories":["life"],"content":" å››ã€æ€»è€Œè¨€ä¹‹å—¯ï¼Œæ¯•ç«Ÿæ˜¯èŠ±äº†é’±çš„ï¼Œè¿™æ¬¡çš„å¤§ç›®æ ‡å°±æ˜¯ç”¨è¿‘ä¸€å¹´çš„æ—¶é—´ï¼Œå…¨é¢æå‡è‹±è¯­æ°´å¹³ã€‚ å¬è¯´è€ƒ BEC é«˜çº§å¯¹è‹±è¯­æ°´å¹³æå‡å¸®åŠ©å¾ˆå¤§ï¼Œä¸ºäº†æä¾›ä¸€ç‚¹å‹åŠ›ä¸åŠ¨åŠ›ï¼Œå°±å®šä¸€ä¸ªç¡¬æ€§ç›®æ ‡ï¼š 2023 å¹´è¾¾åˆ° CEFR çš„ C1 ç­‰çº§ï¼ŒæŠ¥è€ƒå¹¶å–å¾— BEC é«˜çº§è¯ä¹¦ 2023 å¹´åº•è¯æ±‡é‡è¶…è¿‡ 10000 ","date":"2022-09-04","objectID":"/posts/learn-english-again/:2:0","series":null,"tags":["è‹±è¯­","è¯­è¨€å­¦ä¹ "],"title":"Learn English Again","uri":"/posts/learn-english-again/#å››æ€»è€Œè¨€ä¹‹"},{"categories":["life"],"content":" å…¶ä»–èµ„æ–™æ–‡æœ«å†åˆ†äº«å‡ ç¯‡æˆ‘æ”¶è—çš„è‹±è¯­å­¦ä¹ ç›¸å…³çš„èµ„æ–™ï¼Œä¸ªäººæ„Ÿè§‰è¯»äº†æœ‰äº›å¸®åŠ©ï¼š ç¼–ç¨‹çš„æŠ€æœ¯èµ„æ–™å¥½å¤šéƒ½æ˜¯å…¨è‹±æ–‡çš„è¯¥æ€ä¹ˆå­¦ä¹ ï¼Ÿ å…³é”®ç‚¹æ€»ç»“ï¼šä½ è¦èƒ½æ¥å—è‡ªå·±ä¸èƒ½ 100% çœ‹æ‡‚èµ„æ–™ å¦‚ä½•åšåˆ°æµç•…é˜…è¯»è‹±æ–‡èµ„æ–™å’Œå¬æ‡‚å›½å¤–å…¬å¼€è¯¾ï¼Ÿ æå‡é˜…è¯»é€Ÿåº¦è¿‡ç¨‹ä¸­ä¸€ä¸ªæœ€åŸºæœ¬çš„å› ç´ å°±æ˜¯é˜…è¯»é‡ï¼Œè·³å‡ºèˆ’é€‚åŒºï¼Œåˆ»æ„ç»ƒä¹ ã€‚ å¦‚ä½•æœ‰æ•ˆæé«˜è‹±è¯­å†™ä½œï¼Ÿ å…³é”®ç‚¹æ€»ç»“ï¼šæé«˜è‹±æ–‡å†™ä½œæ°´å¹³çš„ç¬¬ä¸€æ­¥æ˜¯ã€Œå¤§é‡é˜…è¯»ã€ YouTube ä¸Šæœ‰å“ªäº›è´¨é‡ä¸é”™çš„è‹±æ–‡æ•™å­¦è§†é¢‘å’Œè‹±æ–‡è§†é¢‘ï¼Ÿ è¿™äº›è§†é¢‘å¾ˆå¤šéƒ½èƒ½åœ¨ Bilibili ä¸Šæœåˆ° é€šè¿‡ã€Œå¬å†™ã€å­¦ä¹ è‹±è¯­ï¼Œæ•ˆæœæ€ä¹ˆæ ·ï¼Ÿ è‹±è¯­å­¦ä¹ è¿‡ç¨‹ä¸­å¦‚ä½•æœ‰æ•ˆåœ°æå‡è¯æ±‡åŠŸåº•ï¼Ÿ å…³é”®ç‚¹æ€»ç»“ï¼šå­¦ä¹ ä¸€é—¨è¯­è¨€æ–‡å­—çš„æœ€çŸ­æœ€ä½³é€”å¾„ï¼Œæ˜¯æŒæ¡å®ƒçš„è¯æ ¹ï¼ˆrootï¼‰ï¼Œä¹Ÿå°±æ˜¯é‚£äº›å…¶ä»–å•è¯å€Ÿä»¥å½¢æˆçš„åŸç”Ÿè¯ çŸ¥ä¹ã€Œè‹±è¯­å­¦ä¹ ã€è¯é¢˜ä¸‹çš„ç²¾åå›ç­” ","date":"2022-09-04","objectID":"/posts/learn-english-again/:3:0","series":null,"tags":["è‹±è¯­","è¯­è¨€å­¦ä¹ "],"title":"Learn English Again","uri":"/posts/learn-english-again/#å…¶ä»–èµ„æ–™"},{"categories":["life"],"content":" å­¦ä¹ æˆæœè®°å½• - æŒç»­æ›´æ–°å…ˆç®€å•è®°å½•ä¸‹å­¦ä¹ æ—¶é—´çº¿ï¼š 2022/9 - 2022/12 å¹³å‡æ¯å¤©å¤§æ¦‚èŠ± 30 åˆ†é’Ÿå­¦ä¹ è‹±è¯­ï¼ˆå¶å°”å…´ä¹‹æ‰€è‡³å¯èƒ½ä¼šèŠ± 1 å°æ—¶ç”šè‡³æ›´å¤šï¼Œä¹Ÿå¶å°”ä¼šæ–­å‡ å¤©ï¼‰ã€‚ ä¸»è¦å­¦ä¹ æ–¹æ³•å°±æ˜¯é€šè¿‡ã€Œè–„è·é˜…è¯»ã€ã€ŒçŸ¥ç±³é˜…è¯»ã€è¯»è‹±æ–‡åŸç‰ˆä¹¦ï¼Œä»¥åŠé€šè¿‡ã€Œä¸€ç‚¹è‹±è¯­ã€çœ‹è§†é¢‘ç»ƒå¬åŠ›ã€è®°å•è¯ã€‚ 2023/1: åŸºæœ¬ç®—æ˜¯ä¼‘æ¯äº†ä¸€ä¸ªæœˆï¼Œæ²¡æ€ä¹ˆå­¦ã€‚ æœªå®Œå¾…ç»­ ","date":"2022-09-04","objectID":"/posts/learn-english-again/:4:0","series":null,"tags":["è‹±è¯­","è¯­è¨€å­¦ä¹ "],"title":"Learn English Again","uri":"/posts/learn-english-again/#å­¦ä¹ æˆæœè®°å½•---æŒç»­æ›´æ–°"},{"categories":["life"],"content":" 1. è¯æ±‡é‡è¯æ±‡é‡æµ‹è¯•ç»“æœæŒ‰æ—¶é—´æ’åºå¦‚ä¸‹ï¼Œä½¿ç”¨çš„æµ‹è¯•å·¥å…·æ˜¯Test Your Vocabulary ï¼š 2022 å¹´ 9 æœˆåˆï¼Œæµ‹è¯•ç»“æœï¼š4700 è¯ï¼ˆæ— æˆªå›¾ï¼‰ 2022-10-18 è¯æ±‡é‡æµ‹è¯•ç»“æœï¼š5100 è¯ 2022-10-18 è¯æ±‡é‡æµ‹è¯•ç»“æœï¼š5100 è¯ 2022-11-17 è¯æ±‡é‡æµ‹è¯•ç»“æœï¼š5600 è¯ 2022-12-19 è¯æ±‡é‡æµ‹è¯•ç»“æœï¼š 6300 è¯ 2023-01-02 è¯æ±‡é‡æµ‹è¯•ç»“æœï¼š6583 è¯ 2023 å¹´ 1 æœˆä»½æš‚åœäº†å­¦ä¹ ï¼Œè¯æ±‡é‡åŸºæœ¬æ²¡æ¶¨ï¼Œç®—æ˜¯ä¼‘æ¯äº†ä¸€ä¸ªæœˆã€‚ ","date":"2022-09-04","objectID":"/posts/learn-english-again/:4:1","series":null,"tags":["è‹±è¯­","è¯­è¨€å­¦ä¹ "],"title":"Learn English Again","uri":"/posts/learn-english-again/#1-è¯æ±‡é‡"},{"categories":["life"],"content":" 2. å£è¯­äº¤æµèƒ½åŠ›2022 å¹´åªæ˜¯å‚ä¸äº†ä¸¤æ¬¡ã€Œå¼€è¨€è‹±è¯­ã€çš„çº¿ä¸Šè‹±è¯­è§’ WeMeetï¼Œå¦å¤–æ¢ç´¢äº†ä¸‹å­¦ä¹ æ–¹æ³•ï¼Œä½†æ˜¯æ—¶é—´åŸå› æœªæŒç»­æ¨è¿›ã€‚ è®¡åˆ’åœ¨ 2023 å¹´è¿›è¡Œä¸“é—¨ç»ƒä¹ ï¼Œæœªå®Œå¾…ç»­â€¦ ","date":"2022-09-04","objectID":"/posts/learn-english-again/:4:2","series":null,"tags":["è‹±è¯­","è¯­è¨€å­¦ä¹ "],"title":"Learn English Again","uri":"/posts/learn-english-again/#2-å£è¯­äº¤æµèƒ½åŠ›"},{"categories":["life"],"content":" 3. å…¶ä»–è¿›å±• å†™ä½œèƒ½åŠ› è®¡åˆ’åœ¨ 2023 å¹´è¿›è¡Œä¸“é—¨ç»ƒä¹ ï¼Œæœªå®Œå¾…ç»­â€¦ é˜…è¯»èƒ½åŠ› 2022 å¹´çš„ 4 ä¸ªæœˆé‡Œï¼Œé˜…è¯»æ˜¯æˆ‘æå‡è¯æ±‡é‡çš„ä¸»è¦æ‰‹æ®µä¹‹ä¸€ï¼Œçœ‹ç»Ÿè®¡è¯»äº†æœ‰ 15 ä¸‡è¯ï¼Œè¯æ±‡é‡è·Ÿé˜…è¯»é€Ÿåº¦éƒ½æœ‰æ˜æ˜¾æå‡ã€‚ åœ¨è–„è·é˜…è¯»ä¸Šè¯»å®Œçš„ç¬¬ä¸€æœ¬è‹±è¯­åŸç‰ˆä¹¦ ","date":"2022-09-04","objectID":"/posts/learn-english-again/:4:3","series":null,"tags":["è‹±è¯­","è¯­è¨€å­¦ä¹ "],"title":"Learn English Again","uri":"/posts/learn-english-again/#3-å…¶ä»–è¿›å±•"},{"categories":["tech"],"content":" ä¸ªäººç¬”è®°ï¼Œä¸ä¿è¯æ­£ç¡®ï¼ è°ˆåˆ°åˆ†å¸ƒå¼æ•°æ®åº“ï¼Œä¸è®ºæ˜¯ Etcd/Zookeeper è¿™æ ·çš„ä¸­å¿ƒåŒ–åˆ†å¸ƒå¼æ•°æ®åº“ï¼Œè¿˜æ˜¯ Ethereum åŒºå—é“¾è¿™æ ·çš„å»ä¸­å¿ƒåŒ–æ•°æ®åº“ï¼Œéƒ½é¿å…ä¸äº†ä¸¤ä¸ªå…³é”®è¯ï¼šã€Œä¸€è‡´æ€§ã€è·Ÿã€Œå…±è¯†ã€ã€‚ æœ¬æ–‡æ˜¯ç¬”è€…å­¦ä¹ ã€Œä¸€è‡´æ€§ã€å’Œã€Œå…±è¯†ã€ä»¥åŠç›¸å…³çš„ç†è®ºçŸ¥è¯†æ—¶è®°å½•çš„ç¬”è®°ï¼Œè¿™äº›çŸ¥è¯†èƒ½å¸®åŠ©æˆ‘ä»¬äº†è§£ Etcd/Zookeeper/Consul/MySQL/PostgreSQL/DynamoDB/Cassandra/MongoDB/CockroachDB/TiDB ç­‰ä¸€ä¼—æ•°æ®åº“çš„åŒºåˆ«ï¼Œç†è§£å„æ•°æ®åº“çš„ä¼˜åŠ¿ä¸å±€é™æ€§ï¼Œææ‡‚æ•°æ®åº“éš”ç¦»çº§åˆ«çš„å«ä¹‰ä»¥åŠåº”è¯¥å¦‚ä½•è®¾ç½®ï¼Œ å¹¶ä½¿æˆ‘ä»¬èƒ½åœ¨å„ç§åº”ç”¨åœºæ™¯ä¸­é€‰æ‹©å‡ºé€‚ç”¨çš„æ•°æ®åº“ã€‚ å¦‚æœä½ å¯¹åŒºå—é“¾æ„Ÿå…´è¶£ï¼Œé‚£è¿™ç¯‡æ–‡ç« ä¹Ÿèƒ½å¸®åŠ©ä½ äº†è§£åŒºå—é“¾è¿™æ ·çš„å»ä¸­å¿ƒåŒ–æ•°æ®åº“ï¼Œè·Ÿä¸šç•Œæµè¡Œçš„åˆ†å¸ƒå¼æ•°æ®åº“åœ¨æŠ€æœ¯ä¸Šæœ‰ä½•åŒºåˆ«ï¼Œåˆæœ‰å“ªäº›å…±åŒç‚¹ï¼Œå…·ä½“æ˜¯å¦‚ä½•å®ç°ã€‚ ","date":"2022-08-07","objectID":"/posts/consistency-and-consensus-algorithm/:0:0","series":null,"tags":["å…±è¯†","ä¸€è‡´æ€§","åˆ†å¸ƒå¼","æ•°æ®åº“","åŒºå—é“¾"],"title":"åˆ†å¸ƒå¼æ•°æ®åº“çš„ä¸€è‡´æ€§é—®é¢˜ä¸å…±è¯†ç®—æ³•","uri":"/posts/consistency-and-consensus-algorithm/#"},{"categories":["tech"],"content":" ä¸€ã€ä¸€è‡´æ€§ - Consistencyã€Œä¸€è‡´æ€§ã€æœ¬èº«æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ¨¡ç³Šçš„å®šä¹‰ï¼Œè§†ä½¿ç”¨åœºæ™¯çš„ä¸åŒï¼Œå­˜åœ¨è®¸å¤šä¸åŒçš„å«ä¹‰ã€‚ç”±äºæ•°æ®åº“ä»ç„¶æ˜¯ä¸€ä¸ªæ–°å…´é¢†åŸŸï¼Œç›®å‰å­˜åœ¨è®¸å¤šä¸åŒçš„ä¸€è‡´æ€§æ¨¡å‹ï¼Œå…¶ä¸­çš„ä¸€äº›æœ¯è¯­æè¿°çš„ä¸€è‡´æ€§ä¹‹é—´å¯èƒ½è¿˜æœ‰é‡å å…³ç³»ï¼Œè¿™äº›å…³ç³»ç”šè‡³ä¼šå›°æ‰°ä¸“ä¸šçš„æ•°æ®åº“å¼€å‘äººå‘˜ã€‚ ä½†æ˜¯ç©¶å…¶æ ¹æœ¬ï¼Œå®é™…ä¸Šåœ¨è°ˆè®ºä¸€è‡´æ€§æ—¶ï¼Œæˆ‘ä»¬æ˜¯åœ¨è°ˆè®ºäº‹åŠ¡ä¸€è‡´æ€§è·Ÿæ•°æ®ä¸€è‡´æ€§ï¼Œä¸‹é¢æˆ‘ä»¬åˆ†åˆ«ä»‹ç»ä¸‹è¿™ä¸¤ä¸ªä¸€è‡´æ€§ã€‚ ","date":"2022-08-07","objectID":"/posts/consistency-and-consensus-algorithm/:1:0","series":null,"tags":["å…±è¯†","ä¸€è‡´æ€§","åˆ†å¸ƒå¼","æ•°æ®åº“","åŒºå—é“¾"],"title":"åˆ†å¸ƒå¼æ•°æ®åº“çš„ä¸€è‡´æ€§é—®é¢˜ä¸å…±è¯†ç®—æ³•","uri":"/posts/consistency-and-consensus-algorithm/#ä¸€ä¸€è‡´æ€§---consistency"},{"categories":["tech"],"content":" 1. äº‹åŠ¡ä¸€è‡´æ€§ - Transactions Consistencyã€Œäº‹åŠ¡ä¸€è‡´æ€§ã€æŒ‡çš„æ˜¯æ•°æ®åº“ä¸­äº‹åŠ¡çš„ä¸€è‡´æ€§ï¼Œå®ƒæ˜¯ ACID ç†è®ºä¸­æœ€ä¸èµ·çœ¼çš„ç‰¹æ€§ï¼Œä¹Ÿå¹¶ä¸æ˜¯æœ¬æ–‡çš„é‡ç‚¹ã€‚ä½†æ˜¯è¿™é‡Œå°±å†™è¿™ä¹ˆä¸€å¥è¯ä¹Ÿè¯´ä¸è¿‡å»ï¼Œæ‰€ä»¥ä¸‹é¢å°±ä»”ç»†ä»‹ç»ä¸‹äº‹åŠ¡ä¸ ACID ç†è®ºã€‚ äº‹åŠ¡ä¸ ACID ç†è®ºäº‹åŠ¡æ˜¯ä¸€ç§ã€Œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå®Œå…¨ä¸åšï¼ˆAll or Nothingï¼‰ã€çš„æŒ‡ä»¤è¿è¡Œæœºåˆ¶ã€‚ ACID ç†è®ºå®šä¹‰ï¼Œæ‹¥æœ‰å¦‚ä¸‹å››ä¸ªç‰¹æ€§çš„ã€Œæ•°æ®åº“æŒ‡ä»¤åºåˆ—ã€ï¼Œå°±è¢«ç§°ä¸ºäº‹åŠ¡ï¼š åŸå­æ€§ Atomicityï¼šäº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•å…ƒï¼Œäº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå…¨éƒ¨ä¸å®Œæˆï¼Œä¸å¯èƒ½åœæ»åœ¨æŸä¸ªä¸­é—´çŠ¶æ€ã€‚ æ¯”å¦‚ A è½¬è´¦ 100 å…ƒç»™ Bï¼Œè¦ä¹ˆè½¬è´¦å¤±è´¥ï¼Œè¦ä¹ˆè½¬è´¦æˆåŠŸï¼Œä¸å¯èƒ½å¡åœ¨ A è¢«æ‰£é™¤äº† 100 å…ƒï¼Œè€Œ B è¿˜æ²¡æ”¶åˆ° 100 å…ƒçš„ä¸­é—´çŠ¶æ€ã€‚ åŸå­æ€§åœ¨å•æœºæ•°æ®åº“ä¸Šå·²å¾—åˆ°å¦¥å–„è§£å†³ï¼Œä½†æ˜¯åœ¨åˆ†å¸ƒå¼æ•°æ®åº“ä¸Šå®ƒæˆä¸ºä¸€é¡¹æ–°çš„æŒ‘æˆ˜ã€‚è¦åœ¨åˆ†å¸ƒå¼æ¶æ„ä¸‹æ”¯æŒåŸå­æ€§å¹¶ä¸å®¹æ˜“ï¼Œæ‰€ä»¥ä¸å°‘ NoSQL äº§å“éƒ½é€‰æ‹©ç»•è¿‡è¿™ä¸ªé—®é¢˜ï¼Œèšç„¦åˆ°é‚£äº›å¯¹åŸå­æ€§ä¸æ•æ„Ÿçš„ç»†åˆ†åœºæ™¯ã€‚ ä¸€è‡´æ€§ Consistencyï¼šä¹Ÿå«æ•°æ®çš„ã€Œæ­£ç¡®æ€§ Correctnessã€æˆ–è€…å®Œæ•´æ€§ï¼ŒæŒ‡äº‹åŠ¡å¯¹æ•°æ®åº“çŠ¶æ€çš„å˜æ›´å¿…é¡»æ»¡è¶³æ‰€æœ‰é¢„å®šä¹‰çš„è§„åˆ™ï¼ŒåŒ…æ‹¬ã€Œçº¦æŸ constraintsã€ã€ã€Œçº§è” cascadesã€ã€ã€Œè§¦å‘å™¨ triggersã€ä»¥åŠè¿™äº›è§„åˆ™çš„ä»»ä½•ç»„åˆã€‚ æ¯”å¦‚å¦‚æœç”¨æˆ·ä¸ºæŸä¸ªå­—æ®µè®¾ç½®äº†çº¦æŸæ¡ä»¶ uniqueï¼Œé‚£ä¹ˆäº‹åŠ¡å¯¹è¯¥è¡¨çš„æ‰€æœ‰ä¿®æ”¹éƒ½å¿…é¡»ä¿è¯æ­¤çº¦æŸæˆç«‹ï¼Œå¦åˆ™å®ƒå°†ä¼šå¤±è´¥ã€‚ æ˜¯å­˜åœ¨æ„Ÿæœ€ä½çš„ç‰¹æ€§ éš”ç¦»æ€§ Isolationï¼šå¹¶å‘æ‰§è¡Œçš„å¤šä¸ªäº‹åŠ¡ä¹‹é—´æ˜¯å®Œå…¨éš”ç¦»çš„ï¼Œå®ƒä»¬çš„æ‰§è¡Œæ•ˆæœè·ŸæŒ‰äº‹åŠ¡çš„å¼€å§‹é¡ºåºä¸²è¡Œæ‰§è¡Œå®Œå…¨ä¸€è‡´ã€‚ äº‹åŠ¡ä¸­æœ€å¤æ‚çš„ç‰¹æ€§ æŒä¹…æ€§ Durabilityï¼šäº‹åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œç»“æœå°±ä¿å­˜ä¸å˜äº†ã€‚è¿™ä¸ªæœ€å¥½ç†è§£ã€‚ ACID æ˜¯ä¼ ç»Ÿçš„å•æœºæ•°æ®åº“çš„æ ¸å¿ƒç‰¹æ€§ï¼Œæ¯”å¦‚ MySQL/PostgreSQL. ACID ä¸­æœ€å¤æ‚çš„ç‰¹æ€§ - éš”ç¦»æ€§å®Œå…¨åœ°å®ç° ACID å¾—åˆ°çš„æ•°æ®åº“ï¼Œæ€§èƒ½æ˜¯éå¸¸å·®çš„ã€‚å› æ­¤åœ¨å…³ç³»æ•°æ®åº“ä¸­ï¼Œè®¾è®¡è€…é€šå¸¸ä¼šé€‰æ‹©ç‰ºç‰²ç›¸å¯¹ä¸é‡è¦çš„ã€Œéš”ç¦»æ€§ã€æ¥è·å–æ›´å¥½çš„æ€§èƒ½ã€‚ è€Œä¸€æ—¦éš”ç¦»ä¸å¤Ÿå½»åº•ï¼Œå°±å¯èƒ½ä¼šé‡åˆ°ä¸€äº›äº‹åŠ¡ä¹‹é—´äº’ç›¸å½±å“çš„å¼‚å¸¸æƒ…å†µï¼Œè¿™äº›å¼‚å¸¸è¢«åˆ†ä¸ºå¦‚ä¸‹å‡ ç§ï¼š è„å†™ Dirty writesï¼šå³äº‹åŠ¡ T1 è·Ÿäº‹åŠ¡ T2 åŒæ—¶åœ¨åŸæ•°æ®çš„åŸºç¡€ä¸Šæ›´æ–°åŒä¸€ä¸ªæ•°æ®ï¼Œå¯¼è‡´ç»“æœä¸ç¬¦åˆé¢„æœŸã€‚ æ¡ˆä¾‹ï¼šä¸¤ä¸ªäº‹åŠ¡åŒæ—¶å°è¯•ä»è´¦æˆ·ä¸­æ‰£æ¬¾ 1000 å…ƒï¼Œä½†æ˜¯å®ƒä»¬è¯»åˆ°çš„åˆå§‹çŠ¶æ€éƒ½æ˜¯ 5000 å…ƒï¼Œäºæ˜¯éƒ½å°è¯•å°†è´¦æˆ·ä¿®æ”¹ä¸º 4000 å…ƒï¼Œç»“æœå°±æ˜¯å°‘æ‰£äº† 1000 å…ƒã€‚ æœ€ç®€å•çš„è§£å†³æ–¹æ³•ï¼šé’ˆå¯¹ UPDATE table SET field = field - 1000 WHERE id = 1 è¿™ç±»æ•°æ®å¢åˆ æ”¹çš„é€»è¾‘ï¼Œéœ€è¦å¯¹è¢«æ›´æ–°çš„è¡ŒåŠ ä¸€æŠŠã€Œè¡Œå†™é”ã€ï¼Œä½¿å…¶ä»–éœ€è¦å†™æ­¤æ•°æ®çš„äº‹åŠ¡ç­‰å¾…ã€‚ è„è¯» Dirty readsï¼šäº‹åŠ¡ T1 è¯»å–äº†äº‹åŠ¡ T2 æœªæäº¤çš„æ•°æ®ã€‚è¿™ä¸ªæ•°æ®ä¸ä¸€å®šå‡†ç¡®ï¼Œè¢«ç§°ä¸ºè„æ•°æ®ï¼Œå› ä¸ºå‡å¦‚äº‹åŠ¡ T2 å›æ»šäº†ï¼ŒT1 æ‹¿åˆ°çš„å°±æ˜¯ä¸€ä¸ªé”™è¯¯çš„æ•°æ® æ¡ˆä¾‹ï¼šå‡è®¾å°æ˜å°çº¢åœ¨ä¸€ä¸ªé“¶è¡Œè´¦æˆ·å­˜äº† 5000 å…ƒï¼Œå°æ˜å°çº¢åœ¨ç”¨è¿™åŒä¸€ä¸ªè´¦æˆ·æ¶ˆè´¹ 1000 å…ƒï¼Œè¿™ä¸­é—´å°æ˜ä»˜æ¬¾çš„äº‹åŠ¡è¯»å–åˆ°è´¦æˆ·å·²ç»è¢«å°çº¢çš„äº‹åŠ¡ä¿®æ”¹ä¸ºäº† 4000 å…ƒï¼Œäºæ˜¯å®ƒæŠŠä½™é¢ä¿®æ”¹ä¸º 3000 å…ƒï¼Œç„¶åä»˜æ¬¾æˆåŠŸã€‚ä½†æ˜¯åœ¨å°æ˜çš„ä»˜æ¬¾äº‹åŠ¡æˆåŠŸåï¼Œå°çº¢çš„ä»˜æ¬¾å¤±è´¥å›æ»šäº†ï¼Œä½™é¢åˆä» 3000 è¢«ä¿®æ”¹å› 5000 å…ƒã€‚å°æ˜å°±å®Œæˆäº† 0 å…ƒè´­çš„å£®ä¸¾ã€‚ æœ€ç®€å•çš„è§£å†³æ–¹æ³•ï¼šäº‹åŠ¡ T2 å†™æ•°æ®æ—¶å¯¹è¢«ä¿®æ”¹çš„è¡ŒåŠ ã€Œè¡Œå†™é”ã€ï¼ŒT2 ç»“æŸåå†é‡Šæ”¾é”ï¼Œè¿™æ ·äº‹åŠ¡ T1 çš„è¯»å–å°±ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°é”é‡Šæ”¾ã€‚ ä¸å¯é‡å¤è¯» Non-repeatable readsï¼šäº‹åŠ¡ T1 è¯»å–æ•°æ®åï¼Œç´§æ¥ç€äº‹åŠ¡ T2 å°±æ›´æ–°äº†æ•°æ®å¹¶æäº¤ï¼Œäº‹åŠ¡ T1 å†æ¬¡è¯»å–çš„æ—¶å€™å‘ç°æ•°æ®ä¸ä¸€è‡´äº† æ¡ˆä¾‹ï¼š å°æ˜åœ¨äº¬ä¸œä¸ŠæŠ¢è´­å•†å“ï¼ŒæŠ¢è´­äº‹åŠ¡å¯åŠ¨æ—¶äº‹åŠ¡è¯»åˆ°è¿˜å‰© 36 ä»¶å•†å“ï¼Œäºæ˜¯ç»§ç»­æ‰§è¡ŒæŠ¢è´­é€»è¾‘ï¼Œä¹‹åäº‹åŠ¡å› ä¸ºæŸç§åŸå› éœ€è¦å†è¯»ä¸€æ¬¡å•†å“æ•°é‡ï¼Œç»“æœå‘ç°å•†å“æ•°é‡å·²ç»å˜æˆ 0 äº†ï¼ŒæŠ¢è´­å¤±è´¥ã€‚ æ›´éº»çƒ¦çš„æ˜¯ï¼Œä¸å¯é‡å¤è¯»å¯¼è‡´ SELECT è·Ÿ UPDATE ä¹‹é—´ä¹Ÿå¯èƒ½å‡ºç°æ•°æ®å˜æ›´ï¼Œå¦‚æœä½ åœ¨äº‹åŠ¡ä¸­å…ˆé€šè¿‡ SELECT field INTO myvar FROM mytable WHERE uid = 1 è¯»åˆ°ä½™é¢ï¼Œå†åœ¨æ­¤åŸºç¡€ä¸Šé€šè¿‡UPDATE å»æ›´æ–°ä½™é¢ï¼Œå¾ˆå¯èƒ½å¯¼è‡´æ•°æ®å˜å¾—ä¸€å›¢ç³Ÿï¼ æ­£ç¡®çš„åšæ³•æ˜¯ä½¿ç”¨ UPDATE mytable SET field = field - 1000 WHERE id = 1ï¼Œå› ä¸ºæ¯ä¸€æ¡ SQL å‘½ä»¤æœ¬èº«éƒ½æ˜¯åŸå­çš„ï¼Œè¿™ä¸ª SQL ä¸ä¼šæœ‰é—®é¢˜ã€‚ æœ€ç®€å•çš„è§£å†³åŠæ³•ï¼šäº‹åŠ¡ T1 è¯»æ•°æ®æ—¶ï¼Œä¹ŸåŠ ä¸€æŠŠã€Œè¡Œã€é”ï¼Œç›´åˆ°ä¸å†éœ€è¦è¯»è¯¥æ•°æ®äº†ï¼Œå†é‡Šæ”¾é”ã€‚ å¹»è¯» Phantom readsï¼šäº‹åŠ¡ T1 åœ¨å¤šæ¬¡æ‰¹é‡è¯»æ•°æ®æ—¶ï¼Œäº‹åŠ¡ T2 å¾€å…¶ä¸­æ‰§è¡Œäº†æ’å…¥/åˆ é™¤æ“ä½œï¼Œ å¯¼è‡´ T1 è¯»åˆ°çš„æ˜¯æ—§æ•°æ®çš„ä¸€ä¸ªæ®‹å½±ï¼Œè€Œéå½“å‰çœŸå®çš„æ•°æ®çŠ¶æ€ã€‚ æœ€ç®€å•çš„è§£å†³åŠæ³•ï¼šäº‹åŠ¡ T1 åœ¨æ‰¹é‡è¯»æ•°æ®æ—¶ï¼Œå…ˆåŠ ä¸€æŠŠèŒƒå›´é”ï¼Œåœ¨äº‹åŠ¡ T1 ç»“æŸè¯»å–ä¹‹åï¼Œå†é‡Šæ”¾è¿™æŠŠé”ã€‚è¿™èƒ½åŒæ—¶è§£å†³ã€Œå¹»è¯»ã€è·Ÿã€Œä¸å¯é‡å¤è¯»ã€çš„é—®é¢˜ã€‚ æ ¹æ®éš”ç¦»ç¨‹åº¦ï¼ŒANSI SQL-92 æ ‡å‡†ä¸­å°†ã€Œéš”ç¦»æ€§ã€ç»†åˆ†ä¸ºå››ä¸ªç­‰çº§ï¼ˆé¿å…ã€Œè„å†™ã€æ˜¯æ•°æ®åº“çš„å¿…å¤‡è¦æ±‚ï¼Œå› æ­¤æœªè®°å½•åœ¨ä¸‹é¢çš„å››ä¸ªç­‰çº§ä¸­ï¼‰ï¼š ä¸²è¡ŒåŒ– Serializableï¼šä¹Ÿå°±æ˜¯å®Œå…¨çš„éš”ç¦»ï¼Œåªè¦äº‹åŠ¡ä¹‹é—´å­˜åœ¨äº’ç›¸å½±å“çš„å¯èƒ½ï¼Œå°±ï¼ˆé€šè¿‡é”æœºåˆ¶ï¼‰å¼ºåˆ¶å®ƒä»¬ä¸²è¡Œæ‰§è¡Œã€‚ å¯é‡å¤è¯» Repeatable readï¼šå¯é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»çš„å‘ç”Ÿï¼Œä½†æ˜¯è§£å†³ä¸äº†å¹»è¯»çš„é—®é¢˜ã€‚ è¯»å·²æäº¤ Read committedï¼šåªèƒ½é¿å…è„è¯» è¯»æœªæäº¤ Read uncommittedï¼šæœ€ä½çº§åˆ«ï¼Œå®Œå…¨æ”¾å¼ƒéš”ç¦»æ€§ MySQL é»˜è®¤çš„éš”ç¦»çº§åˆ«ä¸ºã€Œå¯é‡å¤è¯» Repeatable Readã€ï¼ŒPostgreSQL å’Œ Oracle é»˜è®¤éš”ç¦»çº§åˆ«ä¸ºã€Œè¯»å·²æäº¤ Read committedã€ã€‚ ä¸ºä»€ä¹ˆ MySQL/PostgreSQL/Oracle çš„é»˜è®¤éš”ç¦»çº§åˆ«æ˜¯è¿™æ ·è®¾ç½®çš„å‘¢ï¼Ÿè¯¥å¦‚ä½•é€‰æ‹©æ­£ç¡®çš„éš”ç¦»çº§åˆ«å‘¢ï¼Ÿ æˆ‘ä»¬é’ˆå¯¹æ™®é€šçš„é«˜å¹¶å‘ä¸šåŠ¡åœºæ™¯åšä¸ªç®€å•åˆ†æï¼š é¦–å…ˆï¼Œã€Œè„è¯»ã€æ˜¯å¿…é¡»é¿å…çš„ï¼Œå®ƒä¼šä½¿äº‹åŠ¡è¯»åˆ°é”™è¯¯çš„æ•°æ®ï¼æœ€ä½çš„ã€Œè¯»æœªæäº¤ã€çº§åˆ«ç›´æ¥æ’é™¤ ã€Œä¸²è¡ŒåŒ–ã€çš„æ€§èƒ½å¤ªå·®ï¼Œä¹Ÿç›´æ¥æ’é™¤ åªè¦ SQL ç”¨å¾—å¯¹ï¼Œã€Œä¸å¯é‡å¤è¯»ã€é—®é¢˜å¯¹ä¸šåŠ¡é€»è¾‘çš„æ­£ç¡®æ€§é€šå¸¸å¹¶æ— å½±å“ï¼Œæ‰€ä»¥æ˜¯å¯ä»¥å®¹å¿çš„ã€‚ å› æ­¤ä¸€èˆ¬ã€Œè¯»å·²æäº¤ã€æ˜¯æœ€ä½³çš„éš”ç¦»çº§åˆ«ï¼Œè¿™ä¹Ÿæ˜¯ PostgreSQL/Oracle å°†å…¶è®¾ä¸ºé»˜è®¤éš”ç¦»çº§åˆ«çš„åŸå› ã€‚ é‚£ä¹ˆä¸ºä»€ä¹ˆ MySQL è¿™ä¹ˆç‰¹ç«‹ç‹¬è¡Œï¼Œå°†é»˜è®¤éš”ç¦»çº§åˆ«æé«˜åˆ°äº†ã€Œå¯é‡å¤è¯»ã€å‘¢ï¼Ÿä¸ºå•¥é˜¿é‡Œè¿™ç§å¤§çš„äº’è”ç½‘å…¬å¸åˆä¼šæŠŠ MySQL é»˜è®¤çš„éš”ç¦»çº§åˆ«æ”¹æˆã€Œè¯»å·²æäº¤ã€ï¼Ÿ æ ¹æ®ç½‘ä¸ŠæŸ¥åˆ°çš„èµ„æ–™ï¼Œè¿™æ˜¯ MySQL çš„å†å²é—®é¢˜å¯¼è‡´çš„ã€‚MySQL 5.0 ä¹‹å‰åªæ”¯æŒ statement è¿™ç§ binlog æ ¼å¼ï¼Œæ­¤æ ¼å¼åœ¨ã€Œè¯»å·²æäº¤ã€çš„éš”ç¦»çº§åˆ«ä¸‹ä¼šå‡ºç°è¯¸å¤šé—®é¢˜ï¼Œæœ€æ˜æ˜¾çš„å°±æ˜¯å¯èƒ½ä¼šå¯¼è‡´ä¸»ä»æ•°æ®åº“çš„æ•°æ®ä¸ä¸€è‡´ã€‚ é™¤äº†è®¾ç½®é»˜è®¤çš„éš”ç¦»çº§åˆ«å¤–ï¼ŒMySQL è¿˜ç¦æ­¢åœ¨ä½¿ç”¨ statement æ ¼å¼çš„ binlog æ—¶ï¼Œä½¿ç”¨ READ COMMITTED ä½œä¸ºäº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œå°è¯•ä¿®æ”¹éš”ç¦»çº§åˆ«ä¼šæŠ¥é”™Transaction level 'READ-COMMITTED' in InnoDB is not safe for binlog mode 'STATEMENT' è€Œäº’è”ç½‘å…¬å¸å°†éš”ç¦»çº§åˆ«æ”¹ä¸ºã€Œè¯»å·²æäº¤ã€çš„åŸå› ä¹Ÿå¾ˆå¥½ç†è§£ï¼Œæ­£å¦‚å‰æ–‡æ‰€è¿°ã€Œè¯»å·²æäº¤ã€æ˜¯æœ€ä½³çš„éš”ç¦»çº§åˆ«ï¼Œè¿™æ ·ä¿®æ”¹èƒ½å¤Ÿæå‡æ•°æ®åº“çš„æ€§èƒ½ã€‚ ã€Œéš”ç¦»æ€§ã€çš„æœ¬è´¨å…¶å®å°±æ˜¯äº‹åŠ¡çš„å¹¶å‘æ§åˆ¶ï¼Œä¸åŒçš„éš”ç¦»çº§åˆ«ä»£è¡¨äº†å¯¹å¹¶å‘äº‹åŠ¡çš„éš”ç¦»ç¨‹åº¦ï¼Œä¸»è¦çš„å®ç°æ‰‹æ®µæ˜¯ã€Œå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ MVCCã€ä¸ã€Œé”ã€ã€‚é”æœºåˆ¶å‰é¢å·²ç»ç®€å•ä»‹ç»è¿‡äº†ï¼Œè€Œ MVCC å…¶å®å°±æ˜¯ä¸ºæ¯ä¸ªäº‹åŠ¡åˆ›å»ºä¸€ä¸ªç‰¹å®šéš”ç¦»çº§åˆ«çš„å¿«ç…§ï¼Œè¿™æ ·è¯»å†™ä¸ä¼šäº’ç›¸é˜»å¡ï¼Œæ€§èƒ½å°±æå‡äº†ã€‚ï¼ˆMVCC æš‚æ—¶ä¹Ÿæ˜¯è¶…çº²çŸ¥è¯†ï¼Œåé¢å†ç ”ç©¶å§ emmmmï¼‰ ANSI SQL-92 å¯¹å¼‚å¸¸ç°è±¡çš„åˆ†æä»ç„¶å¤ªè¿‡ç®€å•äº†ï¼Œ1995 å¹´æ–°å‘å¸ƒçš„è®ºæ–‡A Critique of ANSI SQL Isolation Levels ä¸°å¯Œå’Œç»†åŒ–äº† SQL-92 çš„å†…å®¹ï¼Œå®šä¹‰äº†å…­ç§éš”ç¦»çº§åˆ«å’Œå…«ç§å¼‚å¸¸ç°è±¡ï¼ˆæœ‰å¤§ä½¬å¼ºçƒˆå»ºè®®é€šè¯»æ­¤è®ºæ–‡ï¼Œé‡ç‚¹æ˜¯æ–‡ä¸­çš„å¿«ç…§éš”ç¦»ï¼ˆSnapshot Isolation, SIï¼‰çº§åˆ«ï¼‰ã€‚ ","date":"2022-08-07","objectID":"/posts/consistency-and-consensus-algorithm/:1:1","series":null,"tags":["å…±è¯†","ä¸€è‡´æ€§","åˆ†å¸ƒå¼","æ•°æ®åº“","åŒºå—é“¾"],"title":"åˆ†å¸ƒå¼æ•°æ®åº“çš„ä¸€è‡´æ€§é—®é¢˜ä¸å…±è¯†ç®—æ³•","uri":"/posts/consistency-and-consensus-algorithm/#1-äº‹åŠ¡ä¸€è‡´æ€§---transactions-consistency"},{"categories":["tech"],"content":" 1. äº‹åŠ¡ä¸€è‡´æ€§ - Transactions Consistencyã€Œäº‹åŠ¡ä¸€è‡´æ€§ã€æŒ‡çš„æ˜¯æ•°æ®åº“ä¸­äº‹åŠ¡çš„ä¸€è‡´æ€§ï¼Œå®ƒæ˜¯ ACID ç†è®ºä¸­æœ€ä¸èµ·çœ¼çš„ç‰¹æ€§ï¼Œä¹Ÿå¹¶ä¸æ˜¯æœ¬æ–‡çš„é‡ç‚¹ã€‚ä½†æ˜¯è¿™é‡Œå°±å†™è¿™ä¹ˆä¸€å¥è¯ä¹Ÿè¯´ä¸è¿‡å»ï¼Œæ‰€ä»¥ä¸‹é¢å°±ä»”ç»†ä»‹ç»ä¸‹äº‹åŠ¡ä¸ ACID ç†è®ºã€‚ äº‹åŠ¡ä¸ ACID ç†è®ºäº‹åŠ¡æ˜¯ä¸€ç§ã€Œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå®Œå…¨ä¸åšï¼ˆAll or Nothingï¼‰ã€çš„æŒ‡ä»¤è¿è¡Œæœºåˆ¶ã€‚ ACID ç†è®ºå®šä¹‰ï¼Œæ‹¥æœ‰å¦‚ä¸‹å››ä¸ªç‰¹æ€§çš„ã€Œæ•°æ®åº“æŒ‡ä»¤åºåˆ—ã€ï¼Œå°±è¢«ç§°ä¸ºäº‹åŠ¡ï¼š åŸå­æ€§ Atomicityï¼šäº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•å…ƒï¼Œäº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå…¨éƒ¨ä¸å®Œæˆï¼Œä¸å¯èƒ½åœæ»åœ¨æŸä¸ªä¸­é—´çŠ¶æ€ã€‚ æ¯”å¦‚ A è½¬è´¦ 100 å…ƒç»™ Bï¼Œè¦ä¹ˆè½¬è´¦å¤±è´¥ï¼Œè¦ä¹ˆè½¬è´¦æˆåŠŸï¼Œä¸å¯èƒ½å¡åœ¨ A è¢«æ‰£é™¤äº† 100 å…ƒï¼Œè€Œ B è¿˜æ²¡æ”¶åˆ° 100 å…ƒçš„ä¸­é—´çŠ¶æ€ã€‚ åŸå­æ€§åœ¨å•æœºæ•°æ®åº“ä¸Šå·²å¾—åˆ°å¦¥å–„è§£å†³ï¼Œä½†æ˜¯åœ¨åˆ†å¸ƒå¼æ•°æ®åº“ä¸Šå®ƒæˆä¸ºä¸€é¡¹æ–°çš„æŒ‘æˆ˜ã€‚è¦åœ¨åˆ†å¸ƒå¼æ¶æ„ä¸‹æ”¯æŒåŸå­æ€§å¹¶ä¸å®¹æ˜“ï¼Œæ‰€ä»¥ä¸å°‘ NoSQL äº§å“éƒ½é€‰æ‹©ç»•è¿‡è¿™ä¸ªé—®é¢˜ï¼Œèšç„¦åˆ°é‚£äº›å¯¹åŸå­æ€§ä¸æ•æ„Ÿçš„ç»†åˆ†åœºæ™¯ã€‚ ä¸€è‡´æ€§ Consistencyï¼šä¹Ÿå«æ•°æ®çš„ã€Œæ­£ç¡®æ€§ Correctnessã€æˆ–è€…å®Œæ•´æ€§ï¼ŒæŒ‡äº‹åŠ¡å¯¹æ•°æ®åº“çŠ¶æ€çš„å˜æ›´å¿…é¡»æ»¡è¶³æ‰€æœ‰é¢„å®šä¹‰çš„è§„åˆ™ï¼ŒåŒ…æ‹¬ã€Œçº¦æŸ constraintsã€ã€ã€Œçº§è” cascadesã€ã€ã€Œè§¦å‘å™¨ triggersã€ä»¥åŠè¿™äº›è§„åˆ™çš„ä»»ä½•ç»„åˆã€‚ æ¯”å¦‚å¦‚æœç”¨æˆ·ä¸ºæŸä¸ªå­—æ®µè®¾ç½®äº†çº¦æŸæ¡ä»¶ uniqueï¼Œé‚£ä¹ˆäº‹åŠ¡å¯¹è¯¥è¡¨çš„æ‰€æœ‰ä¿®æ”¹éƒ½å¿…é¡»ä¿è¯æ­¤çº¦æŸæˆç«‹ï¼Œå¦åˆ™å®ƒå°†ä¼šå¤±è´¥ã€‚ æ˜¯å­˜åœ¨æ„Ÿæœ€ä½çš„ç‰¹æ€§ éš”ç¦»æ€§ Isolationï¼šå¹¶å‘æ‰§è¡Œçš„å¤šä¸ªäº‹åŠ¡ä¹‹é—´æ˜¯å®Œå…¨éš”ç¦»çš„ï¼Œå®ƒä»¬çš„æ‰§è¡Œæ•ˆæœè·ŸæŒ‰äº‹åŠ¡çš„å¼€å§‹é¡ºåºä¸²è¡Œæ‰§è¡Œå®Œå…¨ä¸€è‡´ã€‚ äº‹åŠ¡ä¸­æœ€å¤æ‚çš„ç‰¹æ€§ æŒä¹…æ€§ Durabilityï¼šäº‹åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œç»“æœå°±ä¿å­˜ä¸å˜äº†ã€‚è¿™ä¸ªæœ€å¥½ç†è§£ã€‚ ACID æ˜¯ä¼ ç»Ÿçš„å•æœºæ•°æ®åº“çš„æ ¸å¿ƒç‰¹æ€§ï¼Œæ¯”å¦‚ MySQL/PostgreSQL. ACID ä¸­æœ€å¤æ‚çš„ç‰¹æ€§ - éš”ç¦»æ€§å®Œå…¨åœ°å®ç° ACID å¾—åˆ°çš„æ•°æ®åº“ï¼Œæ€§èƒ½æ˜¯éå¸¸å·®çš„ã€‚å› æ­¤åœ¨å…³ç³»æ•°æ®åº“ä¸­ï¼Œè®¾è®¡è€…é€šå¸¸ä¼šé€‰æ‹©ç‰ºç‰²ç›¸å¯¹ä¸é‡è¦çš„ã€Œéš”ç¦»æ€§ã€æ¥è·å–æ›´å¥½çš„æ€§èƒ½ã€‚ è€Œä¸€æ—¦éš”ç¦»ä¸å¤Ÿå½»åº•ï¼Œå°±å¯èƒ½ä¼šé‡åˆ°ä¸€äº›äº‹åŠ¡ä¹‹é—´äº’ç›¸å½±å“çš„å¼‚å¸¸æƒ…å†µï¼Œè¿™äº›å¼‚å¸¸è¢«åˆ†ä¸ºå¦‚ä¸‹å‡ ç§ï¼š è„å†™ Dirty writesï¼šå³äº‹åŠ¡ T1 è·Ÿäº‹åŠ¡ T2 åŒæ—¶åœ¨åŸæ•°æ®çš„åŸºç¡€ä¸Šæ›´æ–°åŒä¸€ä¸ªæ•°æ®ï¼Œå¯¼è‡´ç»“æœä¸ç¬¦åˆé¢„æœŸã€‚ æ¡ˆä¾‹ï¼šä¸¤ä¸ªäº‹åŠ¡åŒæ—¶å°è¯•ä»è´¦æˆ·ä¸­æ‰£æ¬¾ 1000 å…ƒï¼Œä½†æ˜¯å®ƒä»¬è¯»åˆ°çš„åˆå§‹çŠ¶æ€éƒ½æ˜¯ 5000 å…ƒï¼Œäºæ˜¯éƒ½å°è¯•å°†è´¦æˆ·ä¿®æ”¹ä¸º 4000 å…ƒï¼Œç»“æœå°±æ˜¯å°‘æ‰£äº† 1000 å…ƒã€‚ æœ€ç®€å•çš„è§£å†³æ–¹æ³•ï¼šé’ˆå¯¹ UPDATE table SET field = field - 1000 WHERE id = 1 è¿™ç±»æ•°æ®å¢åˆ æ”¹çš„é€»è¾‘ï¼Œéœ€è¦å¯¹è¢«æ›´æ–°çš„è¡ŒåŠ ä¸€æŠŠã€Œè¡Œå†™é”ã€ï¼Œä½¿å…¶ä»–éœ€è¦å†™æ­¤æ•°æ®çš„äº‹åŠ¡ç­‰å¾…ã€‚ è„è¯» Dirty readsï¼šäº‹åŠ¡ T1 è¯»å–äº†äº‹åŠ¡ T2 æœªæäº¤çš„æ•°æ®ã€‚è¿™ä¸ªæ•°æ®ä¸ä¸€å®šå‡†ç¡®ï¼Œè¢«ç§°ä¸ºè„æ•°æ®ï¼Œå› ä¸ºå‡å¦‚äº‹åŠ¡ T2 å›æ»šäº†ï¼ŒT1 æ‹¿åˆ°çš„å°±æ˜¯ä¸€ä¸ªé”™è¯¯çš„æ•°æ® æ¡ˆä¾‹ï¼šå‡è®¾å°æ˜å°çº¢åœ¨ä¸€ä¸ªé“¶è¡Œè´¦æˆ·å­˜äº† 5000 å…ƒï¼Œå°æ˜å°çº¢åœ¨ç”¨è¿™åŒä¸€ä¸ªè´¦æˆ·æ¶ˆè´¹ 1000 å…ƒï¼Œè¿™ä¸­é—´å°æ˜ä»˜æ¬¾çš„äº‹åŠ¡è¯»å–åˆ°è´¦æˆ·å·²ç»è¢«å°çº¢çš„äº‹åŠ¡ä¿®æ”¹ä¸ºäº† 4000 å…ƒï¼Œäºæ˜¯å®ƒæŠŠä½™é¢ä¿®æ”¹ä¸º 3000 å…ƒï¼Œç„¶åä»˜æ¬¾æˆåŠŸã€‚ä½†æ˜¯åœ¨å°æ˜çš„ä»˜æ¬¾äº‹åŠ¡æˆåŠŸåï¼Œå°çº¢çš„ä»˜æ¬¾å¤±è´¥å›æ»šäº†ï¼Œä½™é¢åˆä» 3000 è¢«ä¿®æ”¹å› 5000 å…ƒã€‚å°æ˜å°±å®Œæˆäº† 0 å…ƒè´­çš„å£®ä¸¾ã€‚ æœ€ç®€å•çš„è§£å†³æ–¹æ³•ï¼šäº‹åŠ¡ T2 å†™æ•°æ®æ—¶å¯¹è¢«ä¿®æ”¹çš„è¡ŒåŠ ã€Œè¡Œå†™é”ã€ï¼ŒT2 ç»“æŸåå†é‡Šæ”¾é”ï¼Œè¿™æ ·äº‹åŠ¡ T1 çš„è¯»å–å°±ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°é”é‡Šæ”¾ã€‚ ä¸å¯é‡å¤è¯» Non-repeatable readsï¼šäº‹åŠ¡ T1 è¯»å–æ•°æ®åï¼Œç´§æ¥ç€äº‹åŠ¡ T2 å°±æ›´æ–°äº†æ•°æ®å¹¶æäº¤ï¼Œäº‹åŠ¡ T1 å†æ¬¡è¯»å–çš„æ—¶å€™å‘ç°æ•°æ®ä¸ä¸€è‡´äº† æ¡ˆä¾‹ï¼š å°æ˜åœ¨äº¬ä¸œä¸ŠæŠ¢è´­å•†å“ï¼ŒæŠ¢è´­äº‹åŠ¡å¯åŠ¨æ—¶äº‹åŠ¡è¯»åˆ°è¿˜å‰© 36 ä»¶å•†å“ï¼Œäºæ˜¯ç»§ç»­æ‰§è¡ŒæŠ¢è´­é€»è¾‘ï¼Œä¹‹åäº‹åŠ¡å› ä¸ºæŸç§åŸå› éœ€è¦å†è¯»ä¸€æ¬¡å•†å“æ•°é‡ï¼Œç»“æœå‘ç°å•†å“æ•°é‡å·²ç»å˜æˆ 0 äº†ï¼ŒæŠ¢è´­å¤±è´¥ã€‚ æ›´éº»çƒ¦çš„æ˜¯ï¼Œä¸å¯é‡å¤è¯»å¯¼è‡´ SELECT è·Ÿ UPDATE ä¹‹é—´ä¹Ÿå¯èƒ½å‡ºç°æ•°æ®å˜æ›´ï¼Œå¦‚æœä½ åœ¨äº‹åŠ¡ä¸­å…ˆé€šè¿‡ SELECT field INTO myvar FROM mytable WHERE uid = 1 è¯»åˆ°ä½™é¢ï¼Œå†åœ¨æ­¤åŸºç¡€ä¸Šé€šè¿‡UPDATE å»æ›´æ–°ä½™é¢ï¼Œå¾ˆå¯èƒ½å¯¼è‡´æ•°æ®å˜å¾—ä¸€å›¢ç³Ÿï¼ æ­£ç¡®çš„åšæ³•æ˜¯ä½¿ç”¨ UPDATE mytable SET field = field - 1000 WHERE id = 1ï¼Œå› ä¸ºæ¯ä¸€æ¡ SQL å‘½ä»¤æœ¬èº«éƒ½æ˜¯åŸå­çš„ï¼Œè¿™ä¸ª SQL ä¸ä¼šæœ‰é—®é¢˜ã€‚ æœ€ç®€å•çš„è§£å†³åŠæ³•ï¼šäº‹åŠ¡ T1 è¯»æ•°æ®æ—¶ï¼Œä¹ŸåŠ ä¸€æŠŠã€Œè¡Œã€é”ï¼Œç›´åˆ°ä¸å†éœ€è¦è¯»è¯¥æ•°æ®äº†ï¼Œå†é‡Šæ”¾é”ã€‚ å¹»è¯» Phantom readsï¼šäº‹åŠ¡ T1 åœ¨å¤šæ¬¡æ‰¹é‡è¯»æ•°æ®æ—¶ï¼Œäº‹åŠ¡ T2 å¾€å…¶ä¸­æ‰§è¡Œäº†æ’å…¥/åˆ é™¤æ“ä½œï¼Œ å¯¼è‡´ T1 è¯»åˆ°çš„æ˜¯æ—§æ•°æ®çš„ä¸€ä¸ªæ®‹å½±ï¼Œè€Œéå½“å‰çœŸå®çš„æ•°æ®çŠ¶æ€ã€‚ æœ€ç®€å•çš„è§£å†³åŠæ³•ï¼šäº‹åŠ¡ T1 åœ¨æ‰¹é‡è¯»æ•°æ®æ—¶ï¼Œå…ˆåŠ ä¸€æŠŠèŒƒå›´é”ï¼Œåœ¨äº‹åŠ¡ T1 ç»“æŸè¯»å–ä¹‹åï¼Œå†é‡Šæ”¾è¿™æŠŠé”ã€‚è¿™èƒ½åŒæ—¶è§£å†³ã€Œå¹»è¯»ã€è·Ÿã€Œä¸å¯é‡å¤è¯»ã€çš„é—®é¢˜ã€‚ æ ¹æ®éš”ç¦»ç¨‹åº¦ï¼ŒANSI SQL-92 æ ‡å‡†ä¸­å°†ã€Œéš”ç¦»æ€§ã€ç»†åˆ†ä¸ºå››ä¸ªç­‰çº§ï¼ˆé¿å…ã€Œè„å†™ã€æ˜¯æ•°æ®åº“çš„å¿…å¤‡è¦æ±‚ï¼Œå› æ­¤æœªè®°å½•åœ¨ä¸‹é¢çš„å››ä¸ªç­‰çº§ä¸­ï¼‰ï¼š ä¸²è¡ŒåŒ– Serializableï¼šä¹Ÿå°±æ˜¯å®Œå…¨çš„éš”ç¦»ï¼Œåªè¦äº‹åŠ¡ä¹‹é—´å­˜åœ¨äº’ç›¸å½±å“çš„å¯èƒ½ï¼Œå°±ï¼ˆé€šè¿‡é”æœºåˆ¶ï¼‰å¼ºåˆ¶å®ƒä»¬ä¸²è¡Œæ‰§è¡Œã€‚ å¯é‡å¤è¯» Repeatable readï¼šå¯é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»çš„å‘ç”Ÿï¼Œä½†æ˜¯è§£å†³ä¸äº†å¹»è¯»çš„é—®é¢˜ã€‚ è¯»å·²æäº¤ Read committedï¼šåªèƒ½é¿å…è„è¯» è¯»æœªæäº¤ Read uncommittedï¼šæœ€ä½çº§åˆ«ï¼Œå®Œå…¨æ”¾å¼ƒéš”ç¦»æ€§ MySQL é»˜è®¤çš„éš”ç¦»çº§åˆ«ä¸ºã€Œå¯é‡å¤è¯» Repeatable Readã€ï¼ŒPostgreSQL å’Œ Oracle é»˜è®¤éš”ç¦»çº§åˆ«ä¸ºã€Œè¯»å·²æäº¤ Read committedã€ã€‚ ä¸ºä»€ä¹ˆ MySQL/PostgreSQL/Oracle çš„é»˜è®¤éš”ç¦»çº§åˆ«æ˜¯è¿™æ ·è®¾ç½®çš„å‘¢ï¼Ÿè¯¥å¦‚ä½•é€‰æ‹©æ­£ç¡®çš„éš”ç¦»çº§åˆ«å‘¢ï¼Ÿ æˆ‘ä»¬é’ˆå¯¹æ™®é€šçš„é«˜å¹¶å‘ä¸šåŠ¡åœºæ™¯åšä¸ªç®€å•åˆ†æï¼š é¦–å…ˆï¼Œã€Œè„è¯»ã€æ˜¯å¿…é¡»é¿å…çš„ï¼Œå®ƒä¼šä½¿äº‹åŠ¡è¯»åˆ°é”™è¯¯çš„æ•°æ®ï¼æœ€ä½çš„ã€Œè¯»æœªæäº¤ã€çº§åˆ«ç›´æ¥æ’é™¤ ã€Œä¸²è¡ŒåŒ–ã€çš„æ€§èƒ½å¤ªå·®ï¼Œä¹Ÿç›´æ¥æ’é™¤ åªè¦ SQL ç”¨å¾—å¯¹ï¼Œã€Œä¸å¯é‡å¤è¯»ã€é—®é¢˜å¯¹ä¸šåŠ¡é€»è¾‘çš„æ­£ç¡®æ€§é€šå¸¸å¹¶æ— å½±å“ï¼Œæ‰€ä»¥æ˜¯å¯ä»¥å®¹å¿çš„ã€‚ å› æ­¤ä¸€èˆ¬ã€Œè¯»å·²æäº¤ã€æ˜¯æœ€ä½³çš„éš”ç¦»çº§åˆ«ï¼Œè¿™ä¹Ÿæ˜¯ PostgreSQL/Oracle å°†å…¶è®¾ä¸ºé»˜è®¤éš”ç¦»çº§åˆ«çš„åŸå› ã€‚ é‚£ä¹ˆä¸ºä»€ä¹ˆ MySQL è¿™ä¹ˆç‰¹ç«‹ç‹¬è¡Œï¼Œå°†é»˜è®¤éš”ç¦»çº§åˆ«æé«˜åˆ°äº†ã€Œå¯é‡å¤è¯»ã€å‘¢ï¼Ÿä¸ºå•¥é˜¿é‡Œè¿™ç§å¤§çš„äº’è”ç½‘å…¬å¸åˆä¼šæŠŠ MySQL é»˜è®¤çš„éš”ç¦»çº§åˆ«æ”¹æˆã€Œè¯»å·²æäº¤ã€ï¼Ÿ æ ¹æ®ç½‘ä¸ŠæŸ¥åˆ°çš„èµ„æ–™ï¼Œè¿™æ˜¯ MySQL çš„å†å²é—®é¢˜å¯¼è‡´çš„ã€‚MySQL 5.0 ä¹‹å‰åªæ”¯æŒ statement è¿™ç§ binlog æ ¼å¼ï¼Œæ­¤æ ¼å¼åœ¨ã€Œè¯»å·²æäº¤ã€çš„éš”ç¦»çº§åˆ«ä¸‹ä¼šå‡ºç°è¯¸å¤šé—®é¢˜ï¼Œæœ€æ˜æ˜¾çš„å°±æ˜¯å¯èƒ½ä¼šå¯¼è‡´ä¸»ä»æ•°æ®åº“çš„æ•°æ®ä¸ä¸€è‡´ã€‚ é™¤äº†è®¾ç½®é»˜è®¤çš„éš”ç¦»çº§åˆ«å¤–ï¼ŒMySQL è¿˜ç¦æ­¢åœ¨ä½¿ç”¨ statement æ ¼å¼çš„ binlog æ—¶ï¼Œä½¿ç”¨ READ COMMITTED ä½œä¸ºäº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œå°è¯•ä¿®æ”¹éš”ç¦»çº§åˆ«ä¼šæŠ¥é”™Transaction level 'READ-COMMITTED' in InnoDB is not safe for binlog mode 'STATEMENT' è€Œäº’è”ç½‘å…¬å¸å°†éš”ç¦»çº§åˆ«æ”¹ä¸ºã€Œè¯»å·²æäº¤ã€çš„åŸå› ä¹Ÿå¾ˆå¥½ç†è§£ï¼Œæ­£å¦‚å‰æ–‡æ‰€è¿°ã€Œè¯»å·²æäº¤ã€æ˜¯æœ€ä½³çš„éš”ç¦»çº§åˆ«ï¼Œè¿™æ ·ä¿®æ”¹èƒ½å¤Ÿæå‡æ•°æ®åº“çš„æ€§èƒ½ã€‚ ã€Œéš”ç¦»æ€§ã€çš„æœ¬è´¨å…¶å®å°±æ˜¯äº‹åŠ¡çš„å¹¶å‘æ§åˆ¶ï¼Œä¸åŒçš„éš”ç¦»çº§åˆ«ä»£è¡¨äº†å¯¹å¹¶å‘äº‹åŠ¡çš„éš”ç¦»ç¨‹åº¦ï¼Œä¸»è¦çš„å®ç°æ‰‹æ®µæ˜¯ã€Œå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ MVCCã€ä¸ã€Œé”ã€ã€‚é”æœºåˆ¶å‰é¢å·²ç»ç®€å•ä»‹ç»è¿‡äº†ï¼Œè€Œ MVCC å…¶å®å°±æ˜¯ä¸ºæ¯ä¸ªäº‹åŠ¡åˆ›å»ºä¸€ä¸ªç‰¹å®šéš”ç¦»çº§åˆ«çš„å¿«ç…§ï¼Œè¿™æ ·è¯»å†™ä¸ä¼šäº’ç›¸é˜»å¡ï¼Œæ€§èƒ½å°±æå‡äº†ã€‚ï¼ˆMVCC æš‚æ—¶ä¹Ÿæ˜¯è¶…çº²çŸ¥è¯†ï¼Œåé¢å†ç ”ç©¶å§ emmmmï¼‰ ANSI SQL-92 å¯¹å¼‚å¸¸ç°è±¡çš„åˆ†æä»ç„¶å¤ªè¿‡ç®€å•äº†ï¼Œ1995 å¹´æ–°å‘å¸ƒçš„è®ºæ–‡A Critique of ANSI SQL Isolation Levels ä¸°å¯Œå’Œç»†åŒ–äº† SQL-92 çš„å†…å®¹ï¼Œå®šä¹‰äº†å…­ç§éš”ç¦»çº§åˆ«å’Œå…«ç§å¼‚å¸¸ç°è±¡ï¼ˆæœ‰å¤§ä½¬å¼ºçƒˆå»ºè®®é€šè¯»æ­¤è®ºæ–‡ï¼Œé‡ç‚¹æ˜¯æ–‡ä¸­çš„å¿«ç…§éš”ç¦»ï¼ˆSnapshot Isolation, SIï¼‰çº§åˆ«ï¼‰ã€‚ ","date":"2022-08-07","objectID":"/posts/consistency-and-consensus-algorithm/:1:1","series":null,"tags":["å…±è¯†","ä¸€è‡´æ€§","åˆ†å¸ƒå¼","æ•°æ®åº“","åŒºå—é“¾"],"title":"åˆ†å¸ƒå¼æ•°æ®åº“çš„ä¸€è‡´æ€§é—®é¢˜ä¸å…±è¯†ç®—æ³•","uri":"/posts/consistency-and-consensus-algorithm/#äº‹åŠ¡ä¸-acid-ç†è®º"},{"categories":["tech"],"content":" 1. äº‹åŠ¡ä¸€è‡´æ€§ - Transactions Consistencyã€Œäº‹åŠ¡ä¸€è‡´æ€§ã€æŒ‡çš„æ˜¯æ•°æ®åº“ä¸­äº‹åŠ¡çš„ä¸€è‡´æ€§ï¼Œå®ƒæ˜¯ ACID ç†è®ºä¸­æœ€ä¸èµ·çœ¼çš„ç‰¹æ€§ï¼Œä¹Ÿå¹¶ä¸æ˜¯æœ¬æ–‡çš„é‡ç‚¹ã€‚ä½†æ˜¯è¿™é‡Œå°±å†™è¿™ä¹ˆä¸€å¥è¯ä¹Ÿè¯´ä¸è¿‡å»ï¼Œæ‰€ä»¥ä¸‹é¢å°±ä»”ç»†ä»‹ç»ä¸‹äº‹åŠ¡ä¸ ACID ç†è®ºã€‚ äº‹åŠ¡ä¸ ACID ç†è®ºäº‹åŠ¡æ˜¯ä¸€ç§ã€Œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå®Œå…¨ä¸åšï¼ˆAll or Nothingï¼‰ã€çš„æŒ‡ä»¤è¿è¡Œæœºåˆ¶ã€‚ ACID ç†è®ºå®šä¹‰ï¼Œæ‹¥æœ‰å¦‚ä¸‹å››ä¸ªç‰¹æ€§çš„ã€Œæ•°æ®åº“æŒ‡ä»¤åºåˆ—ã€ï¼Œå°±è¢«ç§°ä¸ºäº‹åŠ¡ï¼š åŸå­æ€§ Atomicityï¼šäº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•å…ƒï¼Œäº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå…¨éƒ¨ä¸å®Œæˆï¼Œä¸å¯èƒ½åœæ»åœ¨æŸä¸ªä¸­é—´çŠ¶æ€ã€‚ æ¯”å¦‚ A è½¬è´¦ 100 å…ƒç»™ Bï¼Œè¦ä¹ˆè½¬è´¦å¤±è´¥ï¼Œè¦ä¹ˆè½¬è´¦æˆåŠŸï¼Œä¸å¯èƒ½å¡åœ¨ A è¢«æ‰£é™¤äº† 100 å…ƒï¼Œè€Œ B è¿˜æ²¡æ”¶åˆ° 100 å…ƒçš„ä¸­é—´çŠ¶æ€ã€‚ åŸå­æ€§åœ¨å•æœºæ•°æ®åº“ä¸Šå·²å¾—åˆ°å¦¥å–„è§£å†³ï¼Œä½†æ˜¯åœ¨åˆ†å¸ƒå¼æ•°æ®åº“ä¸Šå®ƒæˆä¸ºä¸€é¡¹æ–°çš„æŒ‘æˆ˜ã€‚è¦åœ¨åˆ†å¸ƒå¼æ¶æ„ä¸‹æ”¯æŒåŸå­æ€§å¹¶ä¸å®¹æ˜“ï¼Œæ‰€ä»¥ä¸å°‘ NoSQL äº§å“éƒ½é€‰æ‹©ç»•è¿‡è¿™ä¸ªé—®é¢˜ï¼Œèšç„¦åˆ°é‚£äº›å¯¹åŸå­æ€§ä¸æ•æ„Ÿçš„ç»†åˆ†åœºæ™¯ã€‚ ä¸€è‡´æ€§ Consistencyï¼šä¹Ÿå«æ•°æ®çš„ã€Œæ­£ç¡®æ€§ Correctnessã€æˆ–è€…å®Œæ•´æ€§ï¼ŒæŒ‡äº‹åŠ¡å¯¹æ•°æ®åº“çŠ¶æ€çš„å˜æ›´å¿…é¡»æ»¡è¶³æ‰€æœ‰é¢„å®šä¹‰çš„è§„åˆ™ï¼ŒåŒ…æ‹¬ã€Œçº¦æŸ constraintsã€ã€ã€Œçº§è” cascadesã€ã€ã€Œè§¦å‘å™¨ triggersã€ä»¥åŠè¿™äº›è§„åˆ™çš„ä»»ä½•ç»„åˆã€‚ æ¯”å¦‚å¦‚æœç”¨æˆ·ä¸ºæŸä¸ªå­—æ®µè®¾ç½®äº†çº¦æŸæ¡ä»¶ uniqueï¼Œé‚£ä¹ˆäº‹åŠ¡å¯¹è¯¥è¡¨çš„æ‰€æœ‰ä¿®æ”¹éƒ½å¿…é¡»ä¿è¯æ­¤çº¦æŸæˆç«‹ï¼Œå¦åˆ™å®ƒå°†ä¼šå¤±è´¥ã€‚ æ˜¯å­˜åœ¨æ„Ÿæœ€ä½çš„ç‰¹æ€§ éš”ç¦»æ€§ Isolationï¼šå¹¶å‘æ‰§è¡Œçš„å¤šä¸ªäº‹åŠ¡ä¹‹é—´æ˜¯å®Œå…¨éš”ç¦»çš„ï¼Œå®ƒä»¬çš„æ‰§è¡Œæ•ˆæœè·ŸæŒ‰äº‹åŠ¡çš„å¼€å§‹é¡ºåºä¸²è¡Œæ‰§è¡Œå®Œå…¨ä¸€è‡´ã€‚ äº‹åŠ¡ä¸­æœ€å¤æ‚çš„ç‰¹æ€§ æŒä¹…æ€§ Durabilityï¼šäº‹åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œç»“æœå°±ä¿å­˜ä¸å˜äº†ã€‚è¿™ä¸ªæœ€å¥½ç†è§£ã€‚ ACID æ˜¯ä¼ ç»Ÿçš„å•æœºæ•°æ®åº“çš„æ ¸å¿ƒç‰¹æ€§ï¼Œæ¯”å¦‚ MySQL/PostgreSQL. ACID ä¸­æœ€å¤æ‚çš„ç‰¹æ€§ - éš”ç¦»æ€§å®Œå…¨åœ°å®ç° ACID å¾—åˆ°çš„æ•°æ®åº“ï¼Œæ€§èƒ½æ˜¯éå¸¸å·®çš„ã€‚å› æ­¤åœ¨å…³ç³»æ•°æ®åº“ä¸­ï¼Œè®¾è®¡è€…é€šå¸¸ä¼šé€‰æ‹©ç‰ºç‰²ç›¸å¯¹ä¸é‡è¦çš„ã€Œéš”ç¦»æ€§ã€æ¥è·å–æ›´å¥½çš„æ€§èƒ½ã€‚ è€Œä¸€æ—¦éš”ç¦»ä¸å¤Ÿå½»åº•ï¼Œå°±å¯èƒ½ä¼šé‡åˆ°ä¸€äº›äº‹åŠ¡ä¹‹é—´äº’ç›¸å½±å“çš„å¼‚å¸¸æƒ…å†µï¼Œè¿™äº›å¼‚å¸¸è¢«åˆ†ä¸ºå¦‚ä¸‹å‡ ç§ï¼š è„å†™ Dirty writesï¼šå³äº‹åŠ¡ T1 è·Ÿäº‹åŠ¡ T2 åŒæ—¶åœ¨åŸæ•°æ®çš„åŸºç¡€ä¸Šæ›´æ–°åŒä¸€ä¸ªæ•°æ®ï¼Œå¯¼è‡´ç»“æœä¸ç¬¦åˆé¢„æœŸã€‚ æ¡ˆä¾‹ï¼šä¸¤ä¸ªäº‹åŠ¡åŒæ—¶å°è¯•ä»è´¦æˆ·ä¸­æ‰£æ¬¾ 1000 å…ƒï¼Œä½†æ˜¯å®ƒä»¬è¯»åˆ°çš„åˆå§‹çŠ¶æ€éƒ½æ˜¯ 5000 å…ƒï¼Œäºæ˜¯éƒ½å°è¯•å°†è´¦æˆ·ä¿®æ”¹ä¸º 4000 å…ƒï¼Œç»“æœå°±æ˜¯å°‘æ‰£äº† 1000 å…ƒã€‚ æœ€ç®€å•çš„è§£å†³æ–¹æ³•ï¼šé’ˆå¯¹ UPDATE table SET field = field - 1000 WHERE id = 1 è¿™ç±»æ•°æ®å¢åˆ æ”¹çš„é€»è¾‘ï¼Œéœ€è¦å¯¹è¢«æ›´æ–°çš„è¡ŒåŠ ä¸€æŠŠã€Œè¡Œå†™é”ã€ï¼Œä½¿å…¶ä»–éœ€è¦å†™æ­¤æ•°æ®çš„äº‹åŠ¡ç­‰å¾…ã€‚ è„è¯» Dirty readsï¼šäº‹åŠ¡ T1 è¯»å–äº†äº‹åŠ¡ T2 æœªæäº¤çš„æ•°æ®ã€‚è¿™ä¸ªæ•°æ®ä¸ä¸€å®šå‡†ç¡®ï¼Œè¢«ç§°ä¸ºè„æ•°æ®ï¼Œå› ä¸ºå‡å¦‚äº‹åŠ¡ T2 å›æ»šäº†ï¼ŒT1 æ‹¿åˆ°çš„å°±æ˜¯ä¸€ä¸ªé”™è¯¯çš„æ•°æ® æ¡ˆä¾‹ï¼šå‡è®¾å°æ˜å°çº¢åœ¨ä¸€ä¸ªé“¶è¡Œè´¦æˆ·å­˜äº† 5000 å…ƒï¼Œå°æ˜å°çº¢åœ¨ç”¨è¿™åŒä¸€ä¸ªè´¦æˆ·æ¶ˆè´¹ 1000 å…ƒï¼Œè¿™ä¸­é—´å°æ˜ä»˜æ¬¾çš„äº‹åŠ¡è¯»å–åˆ°è´¦æˆ·å·²ç»è¢«å°çº¢çš„äº‹åŠ¡ä¿®æ”¹ä¸ºäº† 4000 å…ƒï¼Œäºæ˜¯å®ƒæŠŠä½™é¢ä¿®æ”¹ä¸º 3000 å…ƒï¼Œç„¶åä»˜æ¬¾æˆåŠŸã€‚ä½†æ˜¯åœ¨å°æ˜çš„ä»˜æ¬¾äº‹åŠ¡æˆåŠŸåï¼Œå°çº¢çš„ä»˜æ¬¾å¤±è´¥å›æ»šäº†ï¼Œä½™é¢åˆä» 3000 è¢«ä¿®æ”¹å› 5000 å…ƒã€‚å°æ˜å°±å®Œæˆäº† 0 å…ƒè´­çš„å£®ä¸¾ã€‚ æœ€ç®€å•çš„è§£å†³æ–¹æ³•ï¼šäº‹åŠ¡ T2 å†™æ•°æ®æ—¶å¯¹è¢«ä¿®æ”¹çš„è¡ŒåŠ ã€Œè¡Œå†™é”ã€ï¼ŒT2 ç»“æŸåå†é‡Šæ”¾é”ï¼Œè¿™æ ·äº‹åŠ¡ T1 çš„è¯»å–å°±ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°é”é‡Šæ”¾ã€‚ ä¸å¯é‡å¤è¯» Non-repeatable readsï¼šäº‹åŠ¡ T1 è¯»å–æ•°æ®åï¼Œç´§æ¥ç€äº‹åŠ¡ T2 å°±æ›´æ–°äº†æ•°æ®å¹¶æäº¤ï¼Œäº‹åŠ¡ T1 å†æ¬¡è¯»å–çš„æ—¶å€™å‘ç°æ•°æ®ä¸ä¸€è‡´äº† æ¡ˆä¾‹ï¼š å°æ˜åœ¨äº¬ä¸œä¸ŠæŠ¢è´­å•†å“ï¼ŒæŠ¢è´­äº‹åŠ¡å¯åŠ¨æ—¶äº‹åŠ¡è¯»åˆ°è¿˜å‰© 36 ä»¶å•†å“ï¼Œäºæ˜¯ç»§ç»­æ‰§è¡ŒæŠ¢è´­é€»è¾‘ï¼Œä¹‹åäº‹åŠ¡å› ä¸ºæŸç§åŸå› éœ€è¦å†è¯»ä¸€æ¬¡å•†å“æ•°é‡ï¼Œç»“æœå‘ç°å•†å“æ•°é‡å·²ç»å˜æˆ 0 äº†ï¼ŒæŠ¢è´­å¤±è´¥ã€‚ æ›´éº»çƒ¦çš„æ˜¯ï¼Œä¸å¯é‡å¤è¯»å¯¼è‡´ SELECT è·Ÿ UPDATE ä¹‹é—´ä¹Ÿå¯èƒ½å‡ºç°æ•°æ®å˜æ›´ï¼Œå¦‚æœä½ åœ¨äº‹åŠ¡ä¸­å…ˆé€šè¿‡ SELECT field INTO myvar FROM mytable WHERE uid = 1 è¯»åˆ°ä½™é¢ï¼Œå†åœ¨æ­¤åŸºç¡€ä¸Šé€šè¿‡UPDATE å»æ›´æ–°ä½™é¢ï¼Œå¾ˆå¯èƒ½å¯¼è‡´æ•°æ®å˜å¾—ä¸€å›¢ç³Ÿï¼ æ­£ç¡®çš„åšæ³•æ˜¯ä½¿ç”¨ UPDATE mytable SET field = field - 1000 WHERE id = 1ï¼Œå› ä¸ºæ¯ä¸€æ¡ SQL å‘½ä»¤æœ¬èº«éƒ½æ˜¯åŸå­çš„ï¼Œè¿™ä¸ª SQL ä¸ä¼šæœ‰é—®é¢˜ã€‚ æœ€ç®€å•çš„è§£å†³åŠæ³•ï¼šäº‹åŠ¡ T1 è¯»æ•°æ®æ—¶ï¼Œä¹ŸåŠ ä¸€æŠŠã€Œè¡Œã€é”ï¼Œç›´åˆ°ä¸å†éœ€è¦è¯»è¯¥æ•°æ®äº†ï¼Œå†é‡Šæ”¾é”ã€‚ å¹»è¯» Phantom readsï¼šäº‹åŠ¡ T1 åœ¨å¤šæ¬¡æ‰¹é‡è¯»æ•°æ®æ—¶ï¼Œäº‹åŠ¡ T2 å¾€å…¶ä¸­æ‰§è¡Œäº†æ’å…¥/åˆ é™¤æ“ä½œï¼Œ å¯¼è‡´ T1 è¯»åˆ°çš„æ˜¯æ—§æ•°æ®çš„ä¸€ä¸ªæ®‹å½±ï¼Œè€Œéå½“å‰çœŸå®çš„æ•°æ®çŠ¶æ€ã€‚ æœ€ç®€å•çš„è§£å†³åŠæ³•ï¼šäº‹åŠ¡ T1 åœ¨æ‰¹é‡è¯»æ•°æ®æ—¶ï¼Œå…ˆåŠ ä¸€æŠŠèŒƒå›´é”ï¼Œåœ¨äº‹åŠ¡ T1 ç»“æŸè¯»å–ä¹‹åï¼Œå†é‡Šæ”¾è¿™æŠŠé”ã€‚è¿™èƒ½åŒæ—¶è§£å†³ã€Œå¹»è¯»ã€è·Ÿã€Œä¸å¯é‡å¤è¯»ã€çš„é—®é¢˜ã€‚ æ ¹æ®éš”ç¦»ç¨‹åº¦ï¼ŒANSI SQL-92 æ ‡å‡†ä¸­å°†ã€Œéš”ç¦»æ€§ã€ç»†åˆ†ä¸ºå››ä¸ªç­‰çº§ï¼ˆé¿å…ã€Œè„å†™ã€æ˜¯æ•°æ®åº“çš„å¿…å¤‡è¦æ±‚ï¼Œå› æ­¤æœªè®°å½•åœ¨ä¸‹é¢çš„å››ä¸ªç­‰çº§ä¸­ï¼‰ï¼š ä¸²è¡ŒåŒ– Serializableï¼šä¹Ÿå°±æ˜¯å®Œå…¨çš„éš”ç¦»ï¼Œåªè¦äº‹åŠ¡ä¹‹é—´å­˜åœ¨äº’ç›¸å½±å“çš„å¯èƒ½ï¼Œå°±ï¼ˆé€šè¿‡é”æœºåˆ¶ï¼‰å¼ºåˆ¶å®ƒä»¬ä¸²è¡Œæ‰§è¡Œã€‚ å¯é‡å¤è¯» Repeatable readï¼šå¯é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»çš„å‘ç”Ÿï¼Œä½†æ˜¯è§£å†³ä¸äº†å¹»è¯»çš„é—®é¢˜ã€‚ è¯»å·²æäº¤ Read committedï¼šåªèƒ½é¿å…è„è¯» è¯»æœªæäº¤ Read uncommittedï¼šæœ€ä½çº§åˆ«ï¼Œå®Œå…¨æ”¾å¼ƒéš”ç¦»æ€§ MySQL é»˜è®¤çš„éš”ç¦»çº§åˆ«ä¸ºã€Œå¯é‡å¤è¯» Repeatable Readã€ï¼ŒPostgreSQL å’Œ Oracle é»˜è®¤éš”ç¦»çº§åˆ«ä¸ºã€Œè¯»å·²æäº¤ Read committedã€ã€‚ ä¸ºä»€ä¹ˆ MySQL/PostgreSQL/Oracle çš„é»˜è®¤éš”ç¦»çº§åˆ«æ˜¯è¿™æ ·è®¾ç½®çš„å‘¢ï¼Ÿè¯¥å¦‚ä½•é€‰æ‹©æ­£ç¡®çš„éš”ç¦»çº§åˆ«å‘¢ï¼Ÿ æˆ‘ä»¬é’ˆå¯¹æ™®é€šçš„é«˜å¹¶å‘ä¸šåŠ¡åœºæ™¯åšä¸ªç®€å•åˆ†æï¼š é¦–å…ˆï¼Œã€Œè„è¯»ã€æ˜¯å¿…é¡»é¿å…çš„ï¼Œå®ƒä¼šä½¿äº‹åŠ¡è¯»åˆ°é”™è¯¯çš„æ•°æ®ï¼æœ€ä½çš„ã€Œè¯»æœªæäº¤ã€çº§åˆ«ç›´æ¥æ’é™¤ ã€Œä¸²è¡ŒåŒ–ã€çš„æ€§èƒ½å¤ªå·®ï¼Œä¹Ÿç›´æ¥æ’é™¤ åªè¦ SQL ç”¨å¾—å¯¹ï¼Œã€Œä¸å¯é‡å¤è¯»ã€é—®é¢˜å¯¹ä¸šåŠ¡é€»è¾‘çš„æ­£ç¡®æ€§é€šå¸¸å¹¶æ— å½±å“ï¼Œæ‰€ä»¥æ˜¯å¯ä»¥å®¹å¿çš„ã€‚ å› æ­¤ä¸€èˆ¬ã€Œè¯»å·²æäº¤ã€æ˜¯æœ€ä½³çš„éš”ç¦»çº§åˆ«ï¼Œè¿™ä¹Ÿæ˜¯ PostgreSQL/Oracle å°†å…¶è®¾ä¸ºé»˜è®¤éš”ç¦»çº§åˆ«çš„åŸå› ã€‚ é‚£ä¹ˆä¸ºä»€ä¹ˆ MySQL è¿™ä¹ˆç‰¹ç«‹ç‹¬è¡Œï¼Œå°†é»˜è®¤éš”ç¦»çº§åˆ«æé«˜åˆ°äº†ã€Œå¯é‡å¤è¯»ã€å‘¢ï¼Ÿä¸ºå•¥é˜¿é‡Œè¿™ç§å¤§çš„äº’è”ç½‘å…¬å¸åˆä¼šæŠŠ MySQL é»˜è®¤çš„éš”ç¦»çº§åˆ«æ”¹æˆã€Œè¯»å·²æäº¤ã€ï¼Ÿ æ ¹æ®ç½‘ä¸ŠæŸ¥åˆ°çš„èµ„æ–™ï¼Œè¿™æ˜¯ MySQL çš„å†å²é—®é¢˜å¯¼è‡´çš„ã€‚MySQL 5.0 ä¹‹å‰åªæ”¯æŒ statement è¿™ç§ binlog æ ¼å¼ï¼Œæ­¤æ ¼å¼åœ¨ã€Œè¯»å·²æäº¤ã€çš„éš”ç¦»çº§åˆ«ä¸‹ä¼šå‡ºç°è¯¸å¤šé—®é¢˜ï¼Œæœ€æ˜æ˜¾çš„å°±æ˜¯å¯èƒ½ä¼šå¯¼è‡´ä¸»ä»æ•°æ®åº“çš„æ•°æ®ä¸ä¸€è‡´ã€‚ é™¤äº†è®¾ç½®é»˜è®¤çš„éš”ç¦»çº§åˆ«å¤–ï¼ŒMySQL è¿˜ç¦æ­¢åœ¨ä½¿ç”¨ statement æ ¼å¼çš„ binlog æ—¶ï¼Œä½¿ç”¨ READ COMMITTED ä½œä¸ºäº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œå°è¯•ä¿®æ”¹éš”ç¦»çº§åˆ«ä¼šæŠ¥é”™Transaction level 'READ-COMMITTED' in InnoDB is not safe for binlog mode 'STATEMENT' è€Œäº’è”ç½‘å…¬å¸å°†éš”ç¦»çº§åˆ«æ”¹ä¸ºã€Œè¯»å·²æäº¤ã€çš„åŸå› ä¹Ÿå¾ˆå¥½ç†è§£ï¼Œæ­£å¦‚å‰æ–‡æ‰€è¿°ã€Œè¯»å·²æäº¤ã€æ˜¯æœ€ä½³çš„éš”ç¦»çº§åˆ«ï¼Œè¿™æ ·ä¿®æ”¹èƒ½å¤Ÿæå‡æ•°æ®åº“çš„æ€§èƒ½ã€‚ ã€Œéš”ç¦»æ€§ã€çš„æœ¬è´¨å…¶å®å°±æ˜¯äº‹åŠ¡çš„å¹¶å‘æ§åˆ¶ï¼Œä¸åŒçš„éš”ç¦»çº§åˆ«ä»£è¡¨äº†å¯¹å¹¶å‘äº‹åŠ¡çš„éš”ç¦»ç¨‹åº¦ï¼Œä¸»è¦çš„å®ç°æ‰‹æ®µæ˜¯ã€Œå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ MVCCã€ä¸ã€Œé”ã€ã€‚é”æœºåˆ¶å‰é¢å·²ç»ç®€å•ä»‹ç»è¿‡äº†ï¼Œè€Œ MVCC å…¶å®å°±æ˜¯ä¸ºæ¯ä¸ªäº‹åŠ¡åˆ›å»ºä¸€ä¸ªç‰¹å®šéš”ç¦»çº§åˆ«çš„å¿«ç…§ï¼Œè¿™æ ·è¯»å†™ä¸ä¼šäº’ç›¸é˜»å¡ï¼Œæ€§èƒ½å°±æå‡äº†ã€‚ï¼ˆMVCC æš‚æ—¶ä¹Ÿæ˜¯è¶…çº²çŸ¥è¯†ï¼Œåé¢å†ç ”ç©¶å§ emmmmï¼‰ ANSI SQL-92 å¯¹å¼‚å¸¸ç°è±¡çš„åˆ†æä»ç„¶å¤ªè¿‡ç®€å•äº†ï¼Œ1995 å¹´æ–°å‘å¸ƒçš„è®ºæ–‡A Critique of ANSI SQL Isolation Levels ä¸°å¯Œå’Œç»†åŒ–äº† SQL-92 çš„å†…å®¹ï¼Œå®šä¹‰äº†å…­ç§éš”ç¦»çº§åˆ«å’Œå…«ç§å¼‚å¸¸ç°è±¡ï¼ˆæœ‰å¤§ä½¬å¼ºçƒˆå»ºè®®é€šè¯»æ­¤è®ºæ–‡ï¼Œé‡ç‚¹æ˜¯æ–‡ä¸­çš„å¿«ç…§éš”ç¦»ï¼ˆSnapshot Isolation, SIï¼‰çº§åˆ«ï¼‰ã€‚ ","date":"2022-08-07","objectID":"/posts/consistency-and-consensus-algorithm/:1:1","series":null,"tags":["å…±è¯†","ä¸€è‡´æ€§","åˆ†å¸ƒå¼","æ•°æ®åº“","åŒºå—é“¾"],"title":"åˆ†å¸ƒå¼æ•°æ®åº“çš„ä¸€è‡´æ€§é—®é¢˜ä¸å…±è¯†ç®—æ³•","uri":"/posts/consistency-and-consensus-algorithm/#acid-ä¸­æœ€å¤æ‚çš„ç‰¹æ€§---éš”ç¦»æ€§"},{"categories":["tech"],"content":" 2. æ•°æ®ä¸€è‡´æ€§ Data Consistencyã€Œæ•°æ®ä¸€è‡´æ€§ã€æ˜¯æŒ‡å¯¹æ•°æ®åº“çš„æ¯ä¸€æ¬¡è¯»æ“ä½œéƒ½åº”è¯¥è¯»åˆ°æœ€æ–°å†™å…¥çš„æ•°æ®ï¼Œæˆ–è€…ç›´æ¥æŠ¥é”™ã€‚ å¯¹å•æœºæ•°æ®åº“è€Œè¨€ã€Œæ•°æ®ä¸€è‡´æ€§ã€å¾€å¾€ä¸æ˜¯é—®é¢˜ï¼Œå› ä¸ºå®ƒé€šå¸¸åªæœ‰ä¸€ä»½ä¿å­˜åœ¨ç£ç›˜æˆ–å†…å­˜ä¸­çš„æ•°æ®ã€‚ä½†æ˜¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸ºäº†æ•°æ®å®‰å…¨æ€§æˆ–è€…ä¸ºäº†æ€§èƒ½ï¼Œå¾€å¾€æ¯ä¸€ä»½æ•°æ®éƒ½åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šå­˜æœ‰å…¶å‰¯æœ¬ï¼Œè¿™å°±å¼•å‡ºäº†æ•°æ®å‰¯æœ¬ä»¬çš„ä¸€è‡´æ€§é—®é¢˜ã€‚å› æ­¤ï¼Œæˆ‘ä»¬é€šå¸¸è°ˆè®ºçš„ã€Œæ•°æ®ä¸€è‡´æ€§ã€å°±æ˜¯æŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿçš„ã€Œæ•°æ®ä¸€è‡´æ€§ã€ã€‚ CAP åŸåˆ™æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿé¢†åŸŸä¸€ä¸ªè‘—åçš„ç†è®ºï¼Œå®ƒå‘Šè¯‰æˆ‘ä»¬åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¦‚ä¸‹ä¸‰ç§å±æ€§ä¸å¯èƒ½å…¨éƒ¨è¾¾æˆï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä½œã€ŒCAP ä¸å¯èƒ½ä¸‰è§’ã€ï¼š æ•°æ®ä¸€è‡´æ€§ Data Consistencyï¼šå®¢æˆ·ç«¯çš„æ¯æ¬¡è¯»æ“ä½œï¼Œä¸ç®¡è®¿é—®ç³»ç»Ÿçš„å“ªä¸ªèŠ‚ç‚¹ï¼Œè¦ä¹ˆè¯»åˆ°çš„éƒ½æ˜¯åŒä¸€ä»½æœ€æ–°å†™å…¥çš„æ•°æ®ï¼Œè¦ä¹ˆè¯»å–å¤±è´¥ å¼ºè°ƒæ•°æ®å®Œå…¨æ­£ç¡® å¯ç”¨æ€§ Availabilityï¼šä»»ä½•æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œä¸ç®¡è®¿é—®å“ªä¸ªéæ•…éšœèŠ‚ç‚¹ï¼Œéƒ½èƒ½å¾—åˆ°å“åº”æ•°æ®ï¼Œä½†ä¸ä¿è¯æ˜¯åŒä¸€ä»½æœ€æ–°æ•°æ® å¼ºè°ƒçš„æ˜¯æœåŠ¡å¯ç”¨ï¼Œä½†ä¸ä¿è¯æ•°æ®æ­£ç¡® åˆ†åŒºå®¹é”™æ€§ Partition Toleranceï¼šå³ä½¿èŠ‚ç‚¹ä¹‹é—´å‡ºç°äº†ä»»æ„æ•°é‡çš„æ¶ˆæ¯ä¸¢å¤±æˆ–è€…é«˜å»¶è¿Ÿï¼Œç³»ç»Ÿä»èƒ½æ­£å¸¸è¿è¡Œ å°±æ˜¯è¯´ç½‘ç»œä¸¢åŒ…æˆ–å»¶è¿Ÿä¼šå¯¼è‡´ç³»ç»Ÿè¢«åˆ†æˆå¤šä¸ª Partitionï¼Œç³»ç»Ÿèƒ½å¤Ÿå®¹å¿è¿™ç§æƒ…å†µ ä¸ºäº†ä¿è¯åˆ†åŒºå®¹é”™æ€§ Pï¼Œè€ƒè™‘å½“åˆ†å¸ƒå¼ç³»ç»Ÿå› ä¸ºç½‘ç»œé—®é¢˜è¢«å‰²è£‚æˆå¤šä¸ªåˆ†åŒºæ—¶ï¼Œæ¯ä¸ªåˆ†åŒºåªæœ‰å¦‚ä¸‹ä¸¤ç§é€‰æ‹©ï¼ŒA è·Ÿ C å¿…é¡»ç‰ºç‰²æ‰å…¶ä¸­ä¹‹ä¸€ï¼š å–æ¶ˆæ“ä½œå¹¶æ‹’ç»æä¾›æœåŠ¡ï¼Œè¿™é™ä½äº†å¯ç”¨æ€§ï¼Œä½†æ˜¯èƒ½ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ ç»§ç»­å¤„ç†è¯·æ±‚ï¼Œè¿™ç¡®ä¿äº†å¯ç”¨æ€§ï¼Œä½†æ˜¯æ•°æ®ä¸€è‡´æ€§å°±æ— æ³•ä¿è¯äº† å¦‚æœç³»ç»Ÿçš„å¤šä¸ªåˆ†åŒºéƒ½åœ¨åŒæ—¶æä¾›æœåŠ¡ï¼Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´å¹¶ä¸”å­˜åœ¨å†²çªæ— æ³•åˆå¹¶ï¼Œè¿™å°±è¢«ç§°ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„ã€Œè„‘è£‚ã€ï¼Œæ˜¾ç„¶ä»»ä½•åˆ†å¸ƒå¼ç³»ç»Ÿéƒ½ä¸ä¼šå¸Œæœ›å‘ç”Ÿã€Œè„‘è£‚ã€ã€‚ å› ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿä¸å•æœºç³»ç»Ÿä¸åŒï¼Œå®ƒæ¶‰åŠåˆ°å¤šèŠ‚ç‚¹é—´çš„ç½‘ç»œé€šè®¯å’Œäº¤äº’ï¼Œä½†æ˜¯åªè¦æœ‰ç½‘ç»œäº¤äº’å°±ä¸€å®šä¼šæœ‰å»¶è¿Ÿå’Œæ•°æ®ä¸¢å¤±ï¼ŒèŠ‚ç‚¹é—´çš„åˆ†åŒºæ•…éšœæ˜¯å¾ˆæœ‰å¯èƒ½å‘ç”Ÿçš„ã€‚å› æ­¤ä¸ºäº†æ­£å¸¸è¿è¡Œï¼ŒP æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿå¿…é¡»ä¿è¯çš„ç‰¹æ€§ï¼Œåœ¨å‡ºç°åˆ†åŒºæ•…éšœæ—¶ï¼Œä¸ºäº† P åªèƒ½ç‰ºç‰²æ‰ A æˆ–è€… Cã€‚ å·¥ç¨‹ä¸Šæ˜¯è¦ AP è¿˜æ˜¯ CPï¼Œå¾—è§†æƒ…å†µè€Œå®šï¼š Etcd/Zookeeper/Consul: å®ƒä»¬é€šå¸¸è¢«ç”¨äºå­˜å‚¨ç³»ç»Ÿè¿è¡Œçš„å…³é”®å…ƒä¿¡æ¯ï¼Œæ¯æ¬¡è¯»ï¼Œéƒ½è¦èƒ½è¯»å–åˆ°æœ€æ–°æ•°æ®ã€‚å› æ­¤å®ƒä»¬å®ç°äº† CPï¼Œç‰ºç‰²äº† A DynamoDB/Cassandra/MongoDBï¼šä¸è¦æ±‚æ•°æ®ä¸€è‡´æ€§ï¼Œä¸€æ®µæ—¶é—´å†…ç”¨æ—§çš„ç¼“å­˜é—®é¢˜ä¹Ÿä¸å¤§ï¼Œä½†æ˜¯è¦æ±‚å¯ç”¨æ€§ï¼Œå› æ­¤åº”è¯¥å®ç° APï¼Œç‰ºç‰²æ‰ C æ•°æ®ä¸€è‡´æ€§æ¨¡å‹åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¤šå‰¯æœ¬æ•°æ®ä¸Šçš„ä¸€ç»„è¯»å†™ç­–ç•¥ï¼Œè¢«ç§°ä¸ºã€Œï¼ˆæ•°æ®ï¼‰ä¸€è‡´æ€§æ¨¡å‹ Consistency Modelã€ã€‚ä¸€è‡´æ€§æ¨¡å‹æ•°é‡å¾ˆå¤šï¼Œè®©äººéš¾ä»¥åˆ†è¾¨ã€‚ä¸ºäº†ä¾¿äºç†è§£ï¼Œæˆ‘ä»¬å…ˆä»çŠ¶æ€è§†è§’å‡ºå‘åŒºåˆ†ä¸€ä¸‹å¼ºä¸€è‡´ä¸å¼±ä¸€è‡´çš„æ¦‚å¿µï¼Œåœ¨è¿™ä¸ªçš„åŸºç¡€ä¸Šå†ä»æ“ä½œè§†è§’å»ç†è§£è¿™ä¼—å¤šçš„ä¸€è‡´æ€§æ¨¡å‹ã€‚ 1. çŠ¶æ€è§†è§’ - å¼ºä¸€è‡´ä¸å¼±ä¸€è‡´æˆ‘ä»¬é¦–å…ˆæŠŠæ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿçœ‹ä½œä¸€ä¸ªç™½ç›’ï¼Œä»çŠ¶æ€è§†è§’çœ‹ï¼Œä»»ä½•å˜æ›´æ“ä½œåï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿçš„å¤šä¸ªæ•°æ®å‰¯æœ¬åªæœ‰å¦‚ä¸‹ä¸‰ç§çŠ¶æ€ï¼š åœ¨æŸäº›æ¡ä»¶ä¸‹ï¼Œå„å‰¯æœ¬çŠ¶æ€ä¸ä¸€è‡´çš„ç°è±¡åªæ˜¯æš‚æ—¶çš„ï¼Œåç»­è¿˜ä¼šè½¬æ¢åˆ°ä¸€è‡´çš„çŠ¶æ€ï¼Œè¿™è¢«ç§°ä¸ºã€Œå¼±ä¸€è‡´ã€ï¼› è¿™é€šå¸¸æ˜¯ä½¿ç”¨å¼‚æ­¥å¤åˆ¶æ¥åŒæ­¥å„å‰¯æœ¬çš„çŠ¶æ€ã€‚ ç›¸å¯¹çš„è¯´ï¼Œå¦‚æœç³»ç»Ÿå„å‰¯æœ¬ä¸å­˜åœ¨ã€Œä¸ä¸€è‡´ã€è¿™ç§çŠ¶æ€ï¼Œåªè¦å˜æ›´æ“ä½œæˆåŠŸæ•°æ®å°±ä¸€å®šå®Œå…¨ä¸€è‡´ï¼Œé‚£å®ƒå°±è¢«ç§°ä¸ºã€Œå¼ºä¸€è‡´ã€ã€‚ è¿™è¦æ±‚æ‰€æœ‰å‰¯æœ¬ä¹‹é—´çš„æ•°æ®æ›´æ–°å¿…é¡»å®Œå…¨åŒæ­¥ï¼Œå°±å¿…é¡»ä½¿ç”¨å…¨åŒæ­¥å¤åˆ¶ã€‚ æ°¸è¿œä¸ä¼šä¸€è‡´ï¼šè¿™åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å°±æ˜¯ bug äº†ï¼Œä¹Ÿè¢«ç§°ä¸ºã€Œè„‘è£‚ã€ã€‚ ä¸Šé¢æè¿°çš„æ˜¯æ•´ä¸ªç³»ç»Ÿçš„å®¢è§‚ã€å®é™…çŠ¶æ€ï¼Œä½†å¯¹äºç»å¤§éƒ¨åˆ†ç”¨æˆ·è€Œè¨€åˆ†å¸ƒå¼ç³»ç»Ÿæ›´å¤šçš„æ˜¯ä¸€ä¸ªé»‘ç›’ï¼Œå› æ­¤æ›´æµè¡Œçš„æ˜¯åŸºäºã€Œé»‘ç›’ã€çš„åˆ†ç±»æ–¹å¼ï¼Œå®ƒæ ¹æ®ç³»ç»Ÿçš„å¯¹å¤–çŠ¶æ€å°†ç³»ç»Ÿåˆ†æˆä¸¤ç§ç±»å‹ï¼š å¼ºä¸€è‡´ï¼šæŒ‡å¯¹ç³»ç»Ÿçš„ä»»ä½•èŠ‚ç‚¹/è¿›ç¨‹ï¼Œå†™æ“ä½œå®Œæˆåï¼Œä»»ä½•ç”¨æˆ·å¯¹ä»»ä½•èŠ‚ç‚¹çš„åç»­è®¿é—®éƒ½èƒ½è¯»åˆ°æ–°çš„å€¼ã€‚å°±å¥½åƒç³»ç»Ÿåªå­˜åœ¨ä¸€ä¸ªå‰¯æœ¬ä¸€æ ·ã€‚ æœ€å¸¸ç”¨ç®—æ³•æ˜¯ Raft/Paxosï¼Œå®ƒä»¬çš„å†™æ“ä½œåªè¦æ±‚è¶…è¿‡åŠæ•°èŠ‚ç‚¹å†™å…¥æˆåŠŸï¼Œå› æ­¤å†™å…¥å®Œæˆæ—¶ï¼Œå†…éƒ¨çŠ¶æ€å®é™…æ˜¯ä¸ä¸€è‡´çš„ï¼Œä½†æ˜¯å¯¹å®ƒè¿›è¡Œè¯»å†™ï¼Œæ•ˆæœè·Ÿã€Œå…¨åŒæ­¥å¤åˆ¶ã€æ²¡æœ‰åŒºåˆ«ã€‚ å¼±ä¸€è‡´ï¼šæŒ‡å¯¹ç³»ç»Ÿçš„ä»»ä½•èŠ‚ç‚¹/è¿›ç¨‹ï¼Œå†™æ“ä½œå®Œæˆåï¼Œåç»­çš„ä»»ä½•è®¿é—®å¯èƒ½ä¼šæ‹¿åˆ°çš„å€¼æ˜¯ä¸ç¡®å®šçš„ï¼Œä½†ç»è¿‡ä¸€æ®µæ—¶é—´åï¼Œåç»­çš„ä»»ä½•è®¿é—®éƒ½èƒ½è¯»åˆ°æ–°çš„å€¼ã€‚ å¼±ä¸€è‡´æ˜¯éå¸¸æ¨¡ç³Šçš„å®šä¹‰ã€‚å¦‚æœæˆ‘ä»¬æŠŠæœ€ç»ˆæ‰€æœ‰ç”¨æˆ·éƒ½èƒ½è®¿é—®åˆ°æ–°çš„å€¼è¢«ç§°ä¸ºã€Œç³»ç»Ÿæ”¶æ•›ã€ï¼Œ ç³»ç»Ÿæ”¶æ•›çš„ç”¨æ—¶å¯ä»¥æœ‰æ˜ç¡®è¾¹ç•Œï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰ã€‚ç³»ç»Ÿæ”¶æ•›å‰çš„è®¿é—®è¡Œä¸ºå¯ä»¥æœ‰æ˜ç¡®è§„èŒƒï¼Œä¹Ÿå¯ä»¥ä¸å­˜åœ¨è§„èŒƒã€‚ä¸€åˆ‡éƒ½çœ‹å…·ä½“ç³»ç»Ÿçš„å®ç°ã€‚ å¦‚æœç³»ç»Ÿèƒ½å¤Ÿåœ¨æœ‰é™æ—¶é—´å†…æ”¶æ•›ï¼Œé‚£å®ƒå°±æ˜¯ã€Œæœ€ç»ˆä¸€è‡´ã€ï¼Œå¦åˆ™å¯ä»¥è®¤ä¸ºå®ƒæ˜¯ã€Œä¸ä¸€è‡´ã€ã€‚ ä¸ºäº†å®é™…éœ€è¦ï¼Œæ•°æ®åº“ä¸“å®¶å¯¹ç³»ç»Ÿæ”¶æ•›ä¹‹å‰çš„è¯»å†™æ•ˆæœè¿›è¡Œå„ç§é™åˆ¶ï¼Œå¯¹ç³»ç»Ÿçš„æ”¶æ•›æ—¶é—´è¿›è¡Œå„ç§é™åˆ¶ï¼Œå¾—åˆ°äº†è®¸å¤šä¸€è‡´æ€§æ¨¡å‹ã€‚ 2. æ“ä½œè§†è§’ - å¤šç§ä¸€è‡´æ€§æ¨¡å‹ä»æ¯ä¸ªå®¢æˆ·ç«¯çš„æ“ä½œè§’åº¦çœ‹ï¼Œæœ‰å››ç§ä¸€è‡´æ€§æ¨¡å‹ï¼š å†™åè¯»ä¸€è‡´æ€§ Read after Write Consistencyï¼šä¹Ÿè¢«ç§°ä½œã€Œè¯»è‡ªå·±æ‰€å†™ä¸€è‡´æ€§ã€ï¼Œå³è‡ªå·±å†™å®Œæ•°æ®ç‰ˆæœ¬ N åï¼Œåç»­è¯»åˆ°çš„ç‰ˆæœ¬ä¸€å®šä¸å°äºç‰ˆæœ¬ Nã€‚ å®ƒè§£å†³çš„é—®é¢˜ï¼šA å‘äº†ä¸ªæŠ–éŸ³è§†é¢‘ï¼Œåˆ·æ–°é¡µé¢åå´è«åå…¶å¦™æ¶ˆå¤±äº†ï¼ˆæ—§ç‰ˆæœ¬ï¼‰ï¼Œå‡ åˆ†é’Ÿåæ‰é‡æ–°åˆ·å‡ºæ¥ã€‚ å®ç°æ–¹å¼ä¹‹ä¸€ï¼šä¸ºå†™å…¥è€…å•ç‹¬æ·»åŠ ä¸€ä¸ªè¯»å–è§„åˆ™ï¼Œä»–çš„è¯»éƒ½ç”±å·²æ›´æ–°å…¶å†™å…¥æ•°æ®çš„å‰¯æœ¬æ¥å¤„ç†ã€‚ å•è°ƒè¯»ä¸€è‡´æ€§ Monotonic Read Consistencyï¼šä¿è¯å¤šä¸ªè¯»æ“ä½œçš„é¡ºåºï¼Œå³å®¢æˆ·ç«¯ä¸€æ—¦è¯»åˆ°æŸä¸ªæ•°æ®ç‰ˆæœ¬ Nï¼Œåç»­ä¸ä¼šè¯»åˆ°æ¯” N æ›´ä½çš„ç‰ˆæœ¬ã€‚ å®ƒè§£å†³çš„é—®é¢˜æ˜¯ï¼šA åˆ é™¤äº†ä¸€ä¸ªæŠ–éŸ³è§†é¢‘ï¼Œå¯å¤šæ¬¡åˆ·æ–°ï¼Œå¶å°”åˆ·ä¸åˆ°è§†é¢‘ï¼Œå¶å°”åˆèƒ½åˆ·åˆ°è¢«åˆ é™¤è§†é¢‘ï¼ˆæ—§ç‰ˆæœ¬ï¼‰ï¼Œå‡ åˆ†é’Ÿåæ‰å½»åº•è¢«åˆ é™¤ã€‚ å®ç°æ–¹å¼ä¹‹ä¸€ï¼šä¸ºæ¯ä¸ªç”¨æˆ·çš„è¯»éƒ½åˆ›å»ºä¸€ä¸ªå‰¯æœ¬æ˜ å°„ï¼Œåç»­çš„è¯»éƒ½ç”±ä¸€ä¸ªå›ºå®šçš„å‰¯æœ¬å¤„ç†ï¼Œé¿å…éšæœºåˆ‡æ¢å‰¯æœ¬è€Œè¯»åˆ°æ›´è€çš„å€¼ã€‚ å•è°ƒå†™ä¸€è‡´æ€§ Monotonic Write Consistencyï¼šä¿è¯å¤šä¸ªå†™æ“ä½œçš„é¡ºåºï¼Œå³å®¢æˆ·ç«¯å¯¹åŒä¸€æ•°æ®çš„ä¸¤æ¬¡å†™å…¥æ“ä½œï¼Œä¸€å®šæŒ‰å…¶è¢«æäº¤çš„é¡ºåºè¢«æ‰§è¡Œã€‚ è¯»åå†™ä¸€è‡´æ€§ Write after Read Consistencyï¼šè¯»åå†™ä¸€è‡´æ€§ï¼Œä¿è¯ä¸€ä¸ªå®¢æˆ·ç«¯è¯»åˆ°æ•°æ®ç‰ˆæœ¬ N åï¼ˆå¯èƒ½æ˜¯å…¶ä»–å®¢æˆ·ç«¯å†™å…¥çš„ï¼‰ï¼Œéšåå¯¹åŒä¸€æ•°æ®çš„å†™æ“ä½œå¿…é¡»è¦åœ¨ç‰ˆæœ¬å·å¤§äºç­‰äº N çš„å‰¯æœ¬ä¸Šæ‰§è¡Œã€‚ ä¸Šè¿°å››ä¸ªä¸€è‡´æ€§æ¨¡å‹éƒ½åªä»æ¯ä¸ªå®¢æˆ·ç«¯è‡ªèº«çš„è§’åº¦å®šä¹‰è§„åˆ™ï¼Œæ¯”è¾ƒç‰‡é¢ï¼Œå› æ­¤å®ƒä»¬éƒ½æ˜¯ã€Œå¼±ä¸€è‡´æ¨¡å‹ã€ã€‚ è€Œä¸è€ƒè™‘å®¢æˆ·ç«¯ï¼Œç›´æ¥ä»æ‰€æœ‰æ•°æ®åº“ç”¨æˆ·çš„æ“ä½œè§†è§’çœ‹ï¼Œæœ‰å¦‚ä¸‹å‡ ç§ä¸€è‡´æ€§æ¨¡å‹ï¼š çº¿æ€§ä¸€è‡´æ€§ Linearizabilityï¼šçº¿æ€§ä¸€è‡´æ€§åˆ©ç”¨äº†äº‹ä»¶çš„æäº¤é¡ºåºï¼Œå®ƒä¿è¯ä»»ä½•è¯»æ“ä½œå¾—åˆ°çš„æ•°æ®ï¼Œå…¶é¡ºåºè·Ÿè¯»/å†™äº‹ä»¶çš„æäº¤é¡ºåºä¸€è‡´ã€‚ ç®€å•çš„è¯´å®ƒè¦æ±‚æ•´ä¸ªç³»ç»Ÿè¡¨ç°å¾—åƒåªå­˜åœ¨ä¸€ä¸ªå‰¯æœ¬ï¼Œæ‰€æœ‰æ“ä½œçš„æ‰§è¡Œç»“æœå°±è·Ÿè¿™äº›äº‹ä»¶æŒ‰æäº¤é¡ºåºå®Œå…¨ä¸²è¡Œæ‰§è¡Œä¸€æ ·ã€‚è¿™å®é™…ä¹Ÿæ˜¯åœ¨è¯´æ‰€æœ‰å¹¶å‘äº‹ä»¶éƒ½æ˜¯åŸå­çš„ï¼Œä¸€æ—¦äº’ç›¸ä¹‹é—´å­˜åœ¨å†²çªï¼Œå°±ä¸€å®šå¾—æŒ‰é¡ºåºæ‰§è¡Œï¼Œå› æ­¤ä¹Ÿæœ‰äººç§°å®ƒä¸ºã€ŒåŸå­ä¸€è‡´æ€§ã€ã€‚ çº¿æ€§ä¸€è‡´æ€§ï¼Œå®Œå…¨ç­‰ä»·äºç³»ç»Ÿå¯¹å¤–çŠ¶æ€çš„ã€Œå¼ºä¸€è‡´æ€§ã€ çº¿æ€§ä¸€è‡´æ€§çš„ç³»ç»Ÿæ˜¯å®Œå…¨ç¡®å®šæ€§çš„ å®ç°æ–¹å¼ï¼šéœ€è¦ä¸€ä¸ªæ‰€æœ‰èŠ‚ç‚¹éƒ½ä¸€è‡´çš„ã€Œå…¨å±€æ—¶é’Ÿã€ï¼Œè¿™æ ·æ‰å¯ä»¥å¯¹æ‰€æœ‰äº‹ä»¶è¿›è¡Œå…¨å±€æ’åºã€‚ å¤§å¤šæ•°åˆ†å¸ƒå¼æ•°æ®åº“å¦‚ TiDB/Etcd éƒ½æ˜¯é€šè¿‡ NTP ç­‰åè®®è¿›è¡Œå•ç‚¹æˆæ—¶ä¸åŒæ­¥å®ç°çš„å…¨å±€æ—¶é’Ÿã€‚ æœ‰å…¨çƒåŒ–éƒ¨ç½²éœ€è¦çš„ Google Spanner æ˜¯ä½¿ç”¨ GPS + åŸå­é’Ÿå®ç°çš„å…¨å±€æ—¶é’Ÿ TrueTimeï¼Œå…¨å±€è¯¯å·®å¯ä»¥æ§åˆ¶åœ¨ 7ms ä»¥å†…ã€‚ å±€é™æ€§ï¼šæ ¹æ®çˆ±å› æ–¯å¦ç›¸å¯¹è®ºï¼Œã€Œæ—¶é—´æ˜¯ç›¸å¯¹çš„ã€ï¼Œå®é™…ä¸Šå¹¶ä¸å­˜åœ¨ç»å¯¹çš„æ—¶é—´ï¼Œå› æ­¤çº¿æ€§ä¸€è‡´æ€§åªåœ¨ç»å…¸ç‰©ç†å­¦èŒƒå›´å†…é€‚ç”¨ã€‚ é¡ºåºä¸€è‡´æ€§ Sequentially Consistentï¼š é¡ºåºä¸€è‡´æ€§æœ€æ—©æ˜¯ Leslie Lamport ç”¨æ¥æè¿°å¤šæ ¸ CPU çš„è¡Œä¸ºçš„ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿé¢†åŸŸç”¨å¾—è¾ƒå°‘ã€‚ é¡ºåºä¸€è‡´æ€§çš„è¦æ±‚æœ‰ä¸¤ç‚¹ï¼š ä»å•ä¸ªè¿›ç¨‹ï¼ˆå‰¯æœ¬ï¼‰çš„è§’åº¦çœ‹ï¼Œæ‰€æœ‰æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºè·Ÿä»£ç é€»è¾‘çš„é¡ºåºå®Œå…¨ä¸€è‡´ã€‚ ä»æ‰€æœ‰çš„å¤„ç†å™¨ï¼ˆæ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼‰è§’åº¦çœ‹ï¼Œå†™æ“ä½œä¸å¿…ç«‹å³å¯¹æ‰€æœ‰ç”¨æˆ·å¯è§ï¼Œä½†æ˜¯æ‰€æœ‰å‰¯æœ¬å¿…é¡»ä»¥ç›¸åŒçš„é¡ºåºæ¥æ”¶è¿™äº›å†™æ“ä½œã€‚ é¡ºåºä¸€è‡´æ€§å’Œçº¿æ€§ä¸€è‡´æ€§éƒ½æ˜¯è¦æ‰¾åˆ°ä¸€ä¸ªæ»¡è¶³ã€Œå†™åè¯»ã€çš„ä¸€ç»„æ“ä½œå†å²ï¼Œå·®å¼‚åœ¨äºçº¿æ€§ä¸€è‡´æ€§è¦æ±‚ä¸¥æ ¼çš„æ—¶é—´åºï¼Œè€Œé¡ºåºä¸€è‡´æ€§åªè¦æ±‚æ»¡è¶³ä»£ç çš„é€»è¾‘é¡ºåºï¼Œè€Œå…¶ä»–ä»£ç é€»è¾‘æœªå®šä¹‰çš„äº‹ä»¶é¡ºåºï¼ˆæ¯”å¦‚å¤šå‰¯æœ¬ä¸Šå„äº‹ä»¶ä¹‹é—´çš„é¡ºåºï¼‰ï¼Œå…·ä½“æ˜¯ä»€ä¹ˆæ ·çš„é¡ºåºæ— æ‰€è°“ï¼Œåªè¦æ‰€æœ‰å‰¯æœ¬çœ‹åˆ°çš„äº‹ä»¶é¡ºåºéƒ½ç›¸åŒå°±è¡Œã€‚ é¡ºåºä¸€è‡´æ€§å¹¶ä¸èƒ½æä¾›ã€Œç¡®å®šæ€§ã€ï¼Œç›¸åŒçš„ä¸¤æ¬¡æ“ä½œä»ç„¶å¯èƒ½å¾—åˆ°ä¸åŒçš„äº‹ä»¶é¡ºåºã€‚ å®ç°æ–¹å¼ï¼šå› ä¸ºä¸è¦æ±‚ä¸¥æ ¼çš„å…¨å±€æ—¶é—´åºï¼Œå®ƒå°±ä¸éœ€è¦ä¸€ä¸ªå…¨å±€æ—¶é’Ÿäº†ï¼Œä½†å®é™…ä¸Šä¸ºäº†æ»¡è¶³å…¨å±€çš„ç¡®å®šæ€§ï¼Œä»ç„¶éœ€è¦ä¸€äº›å¤æ‚çš„æ“ä½œã€‚ å› æœä¸€è‡´æ€§ Causal Consistencyï¼šçº¿æ€§ä¸€è‡´æ€§çš„å…¨å±€æ—¶é’Ÿæœ‰å…¶å±€é™æ€§ï¼Œè€Œå› æœä¸€è‡´æ€§åŸºäºå†™äº‹ä»¶çš„ã€Œååºå…³ç³»ã€æå‡ºäº†ã€Œé€»è¾‘æ—¶é’Ÿã€çš„æ¦‚å¿µï¼Œå¹¶ä¿è¯è¯»é¡ºåºä¸é€»è¾‘æ—¶é’Ÿä¸Šçš„å†™äº‹ä»¶é¡ºåºä¸€è‡´ã€‚ å†™äº‹ä»¶çš„ã€Œååºå…³ç³»ã€å…³ç³»æ˜¯æŒ‡ï¼Œè‡³å°‘éƒ¨åˆ†äº‹ä»¶ï¼ˆæ¯”å¦‚ä¸€ä¸ªèŠ‚ç‚¹å†…éƒ¨çš„äº‹ä»¶ï¼‰æ˜¯å¯ä»¥ä½¿ç”¨æœ¬åœ°æ—¶é’Ÿç›´æ¥æ’åºçš„ï¼Œè€ŒèŠ‚ç‚¹ä¹‹é—´å‘ç”Ÿé€šè®¯æ—¶ï¼Œæ¥æ”¶æ–¹çš„äº‹ä»¶ä¸€å®šæ™šäºè°ƒç”¨æ–¹çš„äº‹ä»¶ã€‚åŸºäºè¿™ä¸€ç‚¹å¯ä»¥å®ç°ä¸€ä¸ªã€Œé€»è¾‘æ—¶é’Ÿã€ï¼Œä½†é€»è¾‘æ—¶é’Ÿçš„ç¼ºç‚¹åœ¨äºï¼Œå¦‚æœæŸä¸¤ä¸ªäº‹ä»¶ä¸å­˜åœ¨ç›¸å…³æ€§ï¼Œé‚£é€»è¾‘æ—¶é’Ÿç»™å‡ºçš„é¡ºåºå°±æ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚ å¤šæ•°è§‚ç‚¹è®¤ä¸ºï¼Œå› æœä¸€è‡´æ€§å¼±äºçº¿æ€§ä¸€è‡´æ€§ï¼Œä½†åœ¨å¹¶å‘æ€§èƒ½ä¸Šå…·æœ‰ä¼˜åŠ¿ï¼Œä¹Ÿè¶³ä»¥å¤„ç†å¤šæ•°çš„å¼‚å¸¸ç°è±¡ï¼Œæ‰€ä»¥å› æœä¸€è‡´æ€§ä¹Ÿåœ¨å·¥ä¸šç•Œå¾—åˆ°äº†åº”ç”¨ã€‚ CockroachDB å’Œ YugabyteDB éƒ½åœ¨è®¾è®¡ä¸­é‡‡ç”¨äº†é€»è¾‘æ··åˆæ—¶é’Ÿï¼ˆHybrid Logical Clocksï¼‰ï¼Œè¿™ä¸ªæ–¹æ¡ˆæºè‡ª Lamport çš„é€»è¾‘æ—¶é’Ÿï¼Œä¹Ÿå–å¾—äº†ä¸é”™çš„æ•ˆæœ å‰ç¼€ä¸€è‡´æ€§ Consistent Prefixï¼šå‰¯æœ¬ä¹‹é—´çš„åŒæ­¥è¿‡ç¨‹ä¸­ï¼Œä¼šå­˜åœ¨ä¸€äº›å‰¯æœ¬æ¥æ”¶æ•°æ®çš„é¡ºåºå¹¶ä¸ä¸€è‡´ã€‚ã€Œå‰ç¼€ä¸€è‡´æ€§ã€æ˜¯è¯´æ‰€æœ‰ç”¨æˆ·è¯»åˆ°çš„æ•°æ®é¡ºåºçš„å‰ç¼€æ°¸è¿œæ˜¯ä¸€è‡´çš„ã€‚ ã€Œå‰ç¼€ã€æ˜¯æŒ‡ç¨‹åºåœ¨æ‰§è¡Œå†™æ“ä½œæ—¶ï¼Œéœ€è¦æ˜¾å¼å£°æ˜å…¶ã€Œå‰ç¼€ã€äº‹ä»¶ï¼Œè¿™æ ·æ¯ä¸ªäº‹ä»¶å°±éƒ½å­˜","date":"2022-08-07","objectID":"/posts/consistency-and-consensus-algorithm/:1:2","series":null,"tags":["å…±è¯†","ä¸€è‡´æ€§","åˆ†å¸ƒå¼","æ•°æ®åº“","åŒºå—é“¾"],"title":"åˆ†å¸ƒå¼æ•°æ®åº“çš„ä¸€è‡´æ€§é—®é¢˜ä¸å…±è¯†ç®—æ³•","uri":"/posts/consistency-and-consensus-algorithm/#2-æ•°æ®ä¸€è‡´æ€§-data-consistency"},{"categories":["tech"],"content":" 2. æ•°æ®ä¸€è‡´æ€§ Data Consistencyã€Œæ•°æ®ä¸€è‡´æ€§ã€æ˜¯æŒ‡å¯¹æ•°æ®åº“çš„æ¯ä¸€æ¬¡è¯»æ“ä½œéƒ½åº”è¯¥è¯»åˆ°æœ€æ–°å†™å…¥çš„æ•°æ®ï¼Œæˆ–è€…ç›´æ¥æŠ¥é”™ã€‚ å¯¹å•æœºæ•°æ®åº“è€Œè¨€ã€Œæ•°æ®ä¸€è‡´æ€§ã€å¾€å¾€ä¸æ˜¯é—®é¢˜ï¼Œå› ä¸ºå®ƒé€šå¸¸åªæœ‰ä¸€ä»½ä¿å­˜åœ¨ç£ç›˜æˆ–å†…å­˜ä¸­çš„æ•°æ®ã€‚ä½†æ˜¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸ºäº†æ•°æ®å®‰å…¨æ€§æˆ–è€…ä¸ºäº†æ€§èƒ½ï¼Œå¾€å¾€æ¯ä¸€ä»½æ•°æ®éƒ½åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šå­˜æœ‰å…¶å‰¯æœ¬ï¼Œè¿™å°±å¼•å‡ºäº†æ•°æ®å‰¯æœ¬ä»¬çš„ä¸€è‡´æ€§é—®é¢˜ã€‚å› æ­¤ï¼Œæˆ‘ä»¬é€šå¸¸è°ˆè®ºçš„ã€Œæ•°æ®ä¸€è‡´æ€§ã€å°±æ˜¯æŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿçš„ã€Œæ•°æ®ä¸€è‡´æ€§ã€ã€‚ CAP åŸåˆ™æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿé¢†åŸŸä¸€ä¸ªè‘—åçš„ç†è®ºï¼Œå®ƒå‘Šè¯‰æˆ‘ä»¬åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¦‚ä¸‹ä¸‰ç§å±æ€§ä¸å¯èƒ½å…¨éƒ¨è¾¾æˆï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä½œã€ŒCAP ä¸å¯èƒ½ä¸‰è§’ã€ï¼š æ•°æ®ä¸€è‡´æ€§ Data Consistencyï¼šå®¢æˆ·ç«¯çš„æ¯æ¬¡è¯»æ“ä½œï¼Œä¸ç®¡è®¿é—®ç³»ç»Ÿçš„å“ªä¸ªèŠ‚ç‚¹ï¼Œè¦ä¹ˆè¯»åˆ°çš„éƒ½æ˜¯åŒä¸€ä»½æœ€æ–°å†™å…¥çš„æ•°æ®ï¼Œè¦ä¹ˆè¯»å–å¤±è´¥ å¼ºè°ƒæ•°æ®å®Œå…¨æ­£ç¡® å¯ç”¨æ€§ Availabilityï¼šä»»ä½•æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œä¸ç®¡è®¿é—®å“ªä¸ªéæ•…éšœèŠ‚ç‚¹ï¼Œéƒ½èƒ½å¾—åˆ°å“åº”æ•°æ®ï¼Œä½†ä¸ä¿è¯æ˜¯åŒä¸€ä»½æœ€æ–°æ•°æ® å¼ºè°ƒçš„æ˜¯æœåŠ¡å¯ç”¨ï¼Œä½†ä¸ä¿è¯æ•°æ®æ­£ç¡® åˆ†åŒºå®¹é”™æ€§ Partition Toleranceï¼šå³ä½¿èŠ‚ç‚¹ä¹‹é—´å‡ºç°äº†ä»»æ„æ•°é‡çš„æ¶ˆæ¯ä¸¢å¤±æˆ–è€…é«˜å»¶è¿Ÿï¼Œç³»ç»Ÿä»èƒ½æ­£å¸¸è¿è¡Œ å°±æ˜¯è¯´ç½‘ç»œä¸¢åŒ…æˆ–å»¶è¿Ÿä¼šå¯¼è‡´ç³»ç»Ÿè¢«åˆ†æˆå¤šä¸ª Partitionï¼Œç³»ç»Ÿèƒ½å¤Ÿå®¹å¿è¿™ç§æƒ…å†µ ä¸ºäº†ä¿è¯åˆ†åŒºå®¹é”™æ€§ Pï¼Œè€ƒè™‘å½“åˆ†å¸ƒå¼ç³»ç»Ÿå› ä¸ºç½‘ç»œé—®é¢˜è¢«å‰²è£‚æˆå¤šä¸ªåˆ†åŒºæ—¶ï¼Œæ¯ä¸ªåˆ†åŒºåªæœ‰å¦‚ä¸‹ä¸¤ç§é€‰æ‹©ï¼ŒA è·Ÿ C å¿…é¡»ç‰ºç‰²æ‰å…¶ä¸­ä¹‹ä¸€ï¼š å–æ¶ˆæ“ä½œå¹¶æ‹’ç»æä¾›æœåŠ¡ï¼Œè¿™é™ä½äº†å¯ç”¨æ€§ï¼Œä½†æ˜¯èƒ½ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ ç»§ç»­å¤„ç†è¯·æ±‚ï¼Œè¿™ç¡®ä¿äº†å¯ç”¨æ€§ï¼Œä½†æ˜¯æ•°æ®ä¸€è‡´æ€§å°±æ— æ³•ä¿è¯äº† å¦‚æœç³»ç»Ÿçš„å¤šä¸ªåˆ†åŒºéƒ½åœ¨åŒæ—¶æä¾›æœåŠ¡ï¼Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´å¹¶ä¸”å­˜åœ¨å†²çªæ— æ³•åˆå¹¶ï¼Œè¿™å°±è¢«ç§°ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„ã€Œè„‘è£‚ã€ï¼Œæ˜¾ç„¶ä»»ä½•åˆ†å¸ƒå¼ç³»ç»Ÿéƒ½ä¸ä¼šå¸Œæœ›å‘ç”Ÿã€Œè„‘è£‚ã€ã€‚ å› ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿä¸å•æœºç³»ç»Ÿä¸åŒï¼Œå®ƒæ¶‰åŠåˆ°å¤šèŠ‚ç‚¹é—´çš„ç½‘ç»œé€šè®¯å’Œäº¤äº’ï¼Œä½†æ˜¯åªè¦æœ‰ç½‘ç»œäº¤äº’å°±ä¸€å®šä¼šæœ‰å»¶è¿Ÿå’Œæ•°æ®ä¸¢å¤±ï¼ŒèŠ‚ç‚¹é—´çš„åˆ†åŒºæ•…éšœæ˜¯å¾ˆæœ‰å¯èƒ½å‘ç”Ÿçš„ã€‚å› æ­¤ä¸ºäº†æ­£å¸¸è¿è¡Œï¼ŒP æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿå¿…é¡»ä¿è¯çš„ç‰¹æ€§ï¼Œåœ¨å‡ºç°åˆ†åŒºæ•…éšœæ—¶ï¼Œä¸ºäº† P åªèƒ½ç‰ºç‰²æ‰ A æˆ–è€… Cã€‚ å·¥ç¨‹ä¸Šæ˜¯è¦ AP è¿˜æ˜¯ CPï¼Œå¾—è§†æƒ…å†µè€Œå®šï¼š Etcd/Zookeeper/Consul: å®ƒä»¬é€šå¸¸è¢«ç”¨äºå­˜å‚¨ç³»ç»Ÿè¿è¡Œçš„å…³é”®å…ƒä¿¡æ¯ï¼Œæ¯æ¬¡è¯»ï¼Œéƒ½è¦èƒ½è¯»å–åˆ°æœ€æ–°æ•°æ®ã€‚å› æ­¤å®ƒä»¬å®ç°äº† CPï¼Œç‰ºç‰²äº† A DynamoDB/Cassandra/MongoDBï¼šä¸è¦æ±‚æ•°æ®ä¸€è‡´æ€§ï¼Œä¸€æ®µæ—¶é—´å†…ç”¨æ—§çš„ç¼“å­˜é—®é¢˜ä¹Ÿä¸å¤§ï¼Œä½†æ˜¯è¦æ±‚å¯ç”¨æ€§ï¼Œå› æ­¤åº”è¯¥å®ç° APï¼Œç‰ºç‰²æ‰ C æ•°æ®ä¸€è‡´æ€§æ¨¡å‹åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¤šå‰¯æœ¬æ•°æ®ä¸Šçš„ä¸€ç»„è¯»å†™ç­–ç•¥ï¼Œè¢«ç§°ä¸ºã€Œï¼ˆæ•°æ®ï¼‰ä¸€è‡´æ€§æ¨¡å‹ Consistency Modelã€ã€‚ä¸€è‡´æ€§æ¨¡å‹æ•°é‡å¾ˆå¤šï¼Œè®©äººéš¾ä»¥åˆ†è¾¨ã€‚ä¸ºäº†ä¾¿äºç†è§£ï¼Œæˆ‘ä»¬å…ˆä»çŠ¶æ€è§†è§’å‡ºå‘åŒºåˆ†ä¸€ä¸‹å¼ºä¸€è‡´ä¸å¼±ä¸€è‡´çš„æ¦‚å¿µï¼Œåœ¨è¿™ä¸ªçš„åŸºç¡€ä¸Šå†ä»æ“ä½œè§†è§’å»ç†è§£è¿™ä¼—å¤šçš„ä¸€è‡´æ€§æ¨¡å‹ã€‚ 1. çŠ¶æ€è§†è§’ - å¼ºä¸€è‡´ä¸å¼±ä¸€è‡´æˆ‘ä»¬é¦–å…ˆæŠŠæ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿçœ‹ä½œä¸€ä¸ªç™½ç›’ï¼Œä»çŠ¶æ€è§†è§’çœ‹ï¼Œä»»ä½•å˜æ›´æ“ä½œåï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿçš„å¤šä¸ªæ•°æ®å‰¯æœ¬åªæœ‰å¦‚ä¸‹ä¸‰ç§çŠ¶æ€ï¼š åœ¨æŸäº›æ¡ä»¶ä¸‹ï¼Œå„å‰¯æœ¬çŠ¶æ€ä¸ä¸€è‡´çš„ç°è±¡åªæ˜¯æš‚æ—¶çš„ï¼Œåç»­è¿˜ä¼šè½¬æ¢åˆ°ä¸€è‡´çš„çŠ¶æ€ï¼Œè¿™è¢«ç§°ä¸ºã€Œå¼±ä¸€è‡´ã€ï¼› è¿™é€šå¸¸æ˜¯ä½¿ç”¨å¼‚æ­¥å¤åˆ¶æ¥åŒæ­¥å„å‰¯æœ¬çš„çŠ¶æ€ã€‚ ç›¸å¯¹çš„è¯´ï¼Œå¦‚æœç³»ç»Ÿå„å‰¯æœ¬ä¸å­˜åœ¨ã€Œä¸ä¸€è‡´ã€è¿™ç§çŠ¶æ€ï¼Œåªè¦å˜æ›´æ“ä½œæˆåŠŸæ•°æ®å°±ä¸€å®šå®Œå…¨ä¸€è‡´ï¼Œé‚£å®ƒå°±è¢«ç§°ä¸ºã€Œå¼ºä¸€è‡´ã€ã€‚ è¿™è¦æ±‚æ‰€æœ‰å‰¯æœ¬ä¹‹é—´çš„æ•°æ®æ›´æ–°å¿…é¡»å®Œå…¨åŒæ­¥ï¼Œå°±å¿…é¡»ä½¿ç”¨å…¨åŒæ­¥å¤åˆ¶ã€‚ æ°¸è¿œä¸ä¼šä¸€è‡´ï¼šè¿™åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å°±æ˜¯ bug äº†ï¼Œä¹Ÿè¢«ç§°ä¸ºã€Œè„‘è£‚ã€ã€‚ ä¸Šé¢æè¿°çš„æ˜¯æ•´ä¸ªç³»ç»Ÿçš„å®¢è§‚ã€å®é™…çŠ¶æ€ï¼Œä½†å¯¹äºç»å¤§éƒ¨åˆ†ç”¨æˆ·è€Œè¨€åˆ†å¸ƒå¼ç³»ç»Ÿæ›´å¤šçš„æ˜¯ä¸€ä¸ªé»‘ç›’ï¼Œå› æ­¤æ›´æµè¡Œçš„æ˜¯åŸºäºã€Œé»‘ç›’ã€çš„åˆ†ç±»æ–¹å¼ï¼Œå®ƒæ ¹æ®ç³»ç»Ÿçš„å¯¹å¤–çŠ¶æ€å°†ç³»ç»Ÿåˆ†æˆä¸¤ç§ç±»å‹ï¼š å¼ºä¸€è‡´ï¼šæŒ‡å¯¹ç³»ç»Ÿçš„ä»»ä½•èŠ‚ç‚¹/è¿›ç¨‹ï¼Œå†™æ“ä½œå®Œæˆåï¼Œä»»ä½•ç”¨æˆ·å¯¹ä»»ä½•èŠ‚ç‚¹çš„åç»­è®¿é—®éƒ½èƒ½è¯»åˆ°æ–°çš„å€¼ã€‚å°±å¥½åƒç³»ç»Ÿåªå­˜åœ¨ä¸€ä¸ªå‰¯æœ¬ä¸€æ ·ã€‚ æœ€å¸¸ç”¨ç®—æ³•æ˜¯ Raft/Paxosï¼Œå®ƒä»¬çš„å†™æ“ä½œåªè¦æ±‚è¶…è¿‡åŠæ•°èŠ‚ç‚¹å†™å…¥æˆåŠŸï¼Œå› æ­¤å†™å…¥å®Œæˆæ—¶ï¼Œå†…éƒ¨çŠ¶æ€å®é™…æ˜¯ä¸ä¸€è‡´çš„ï¼Œä½†æ˜¯å¯¹å®ƒè¿›è¡Œè¯»å†™ï¼Œæ•ˆæœè·Ÿã€Œå…¨åŒæ­¥å¤åˆ¶ã€æ²¡æœ‰åŒºåˆ«ã€‚ å¼±ä¸€è‡´ï¼šæŒ‡å¯¹ç³»ç»Ÿçš„ä»»ä½•èŠ‚ç‚¹/è¿›ç¨‹ï¼Œå†™æ“ä½œå®Œæˆåï¼Œåç»­çš„ä»»ä½•è®¿é—®å¯èƒ½ä¼šæ‹¿åˆ°çš„å€¼æ˜¯ä¸ç¡®å®šçš„ï¼Œä½†ç»è¿‡ä¸€æ®µæ—¶é—´åï¼Œåç»­çš„ä»»ä½•è®¿é—®éƒ½èƒ½è¯»åˆ°æ–°çš„å€¼ã€‚ å¼±ä¸€è‡´æ˜¯éå¸¸æ¨¡ç³Šçš„å®šä¹‰ã€‚å¦‚æœæˆ‘ä»¬æŠŠæœ€ç»ˆæ‰€æœ‰ç”¨æˆ·éƒ½èƒ½è®¿é—®åˆ°æ–°çš„å€¼è¢«ç§°ä¸ºã€Œç³»ç»Ÿæ”¶æ•›ã€ï¼Œ ç³»ç»Ÿæ”¶æ•›çš„ç”¨æ—¶å¯ä»¥æœ‰æ˜ç¡®è¾¹ç•Œï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰ã€‚ç³»ç»Ÿæ”¶æ•›å‰çš„è®¿é—®è¡Œä¸ºå¯ä»¥æœ‰æ˜ç¡®è§„èŒƒï¼Œä¹Ÿå¯ä»¥ä¸å­˜åœ¨è§„èŒƒã€‚ä¸€åˆ‡éƒ½çœ‹å…·ä½“ç³»ç»Ÿçš„å®ç°ã€‚ å¦‚æœç³»ç»Ÿèƒ½å¤Ÿåœ¨æœ‰é™æ—¶é—´å†…æ”¶æ•›ï¼Œé‚£å®ƒå°±æ˜¯ã€Œæœ€ç»ˆä¸€è‡´ã€ï¼Œå¦åˆ™å¯ä»¥è®¤ä¸ºå®ƒæ˜¯ã€Œä¸ä¸€è‡´ã€ã€‚ ä¸ºäº†å®é™…éœ€è¦ï¼Œæ•°æ®åº“ä¸“å®¶å¯¹ç³»ç»Ÿæ”¶æ•›ä¹‹å‰çš„è¯»å†™æ•ˆæœè¿›è¡Œå„ç§é™åˆ¶ï¼Œå¯¹ç³»ç»Ÿçš„æ”¶æ•›æ—¶é—´è¿›è¡Œå„ç§é™åˆ¶ï¼Œå¾—åˆ°äº†è®¸å¤šä¸€è‡´æ€§æ¨¡å‹ã€‚ 2. æ“ä½œè§†è§’ - å¤šç§ä¸€è‡´æ€§æ¨¡å‹ä»æ¯ä¸ªå®¢æˆ·ç«¯çš„æ“ä½œè§’åº¦çœ‹ï¼Œæœ‰å››ç§ä¸€è‡´æ€§æ¨¡å‹ï¼š å†™åè¯»ä¸€è‡´æ€§ Read after Write Consistencyï¼šä¹Ÿè¢«ç§°ä½œã€Œè¯»è‡ªå·±æ‰€å†™ä¸€è‡´æ€§ã€ï¼Œå³è‡ªå·±å†™å®Œæ•°æ®ç‰ˆæœ¬ N åï¼Œåç»­è¯»åˆ°çš„ç‰ˆæœ¬ä¸€å®šä¸å°äºç‰ˆæœ¬ Nã€‚ å®ƒè§£å†³çš„é—®é¢˜ï¼šA å‘äº†ä¸ªæŠ–éŸ³è§†é¢‘ï¼Œåˆ·æ–°é¡µé¢åå´è«åå…¶å¦™æ¶ˆå¤±äº†ï¼ˆæ—§ç‰ˆæœ¬ï¼‰ï¼Œå‡ åˆ†é’Ÿåæ‰é‡æ–°åˆ·å‡ºæ¥ã€‚ å®ç°æ–¹å¼ä¹‹ä¸€ï¼šä¸ºå†™å…¥è€…å•ç‹¬æ·»åŠ ä¸€ä¸ªè¯»å–è§„åˆ™ï¼Œä»–çš„è¯»éƒ½ç”±å·²æ›´æ–°å…¶å†™å…¥æ•°æ®çš„å‰¯æœ¬æ¥å¤„ç†ã€‚ å•è°ƒè¯»ä¸€è‡´æ€§ Monotonic Read Consistencyï¼šä¿è¯å¤šä¸ªè¯»æ“ä½œçš„é¡ºåºï¼Œå³å®¢æˆ·ç«¯ä¸€æ—¦è¯»åˆ°æŸä¸ªæ•°æ®ç‰ˆæœ¬ Nï¼Œåç»­ä¸ä¼šè¯»åˆ°æ¯” N æ›´ä½çš„ç‰ˆæœ¬ã€‚ å®ƒè§£å†³çš„é—®é¢˜æ˜¯ï¼šA åˆ é™¤äº†ä¸€ä¸ªæŠ–éŸ³è§†é¢‘ï¼Œå¯å¤šæ¬¡åˆ·æ–°ï¼Œå¶å°”åˆ·ä¸åˆ°è§†é¢‘ï¼Œå¶å°”åˆèƒ½åˆ·åˆ°è¢«åˆ é™¤è§†é¢‘ï¼ˆæ—§ç‰ˆæœ¬ï¼‰ï¼Œå‡ åˆ†é’Ÿåæ‰å½»åº•è¢«åˆ é™¤ã€‚ å®ç°æ–¹å¼ä¹‹ä¸€ï¼šä¸ºæ¯ä¸ªç”¨æˆ·çš„è¯»éƒ½åˆ›å»ºä¸€ä¸ªå‰¯æœ¬æ˜ å°„ï¼Œåç»­çš„è¯»éƒ½ç”±ä¸€ä¸ªå›ºå®šçš„å‰¯æœ¬å¤„ç†ï¼Œé¿å…éšæœºåˆ‡æ¢å‰¯æœ¬è€Œè¯»åˆ°æ›´è€çš„å€¼ã€‚ å•è°ƒå†™ä¸€è‡´æ€§ Monotonic Write Consistencyï¼šä¿è¯å¤šä¸ªå†™æ“ä½œçš„é¡ºåºï¼Œå³å®¢æˆ·ç«¯å¯¹åŒä¸€æ•°æ®çš„ä¸¤æ¬¡å†™å…¥æ“ä½œï¼Œä¸€å®šæŒ‰å…¶è¢«æäº¤çš„é¡ºåºè¢«æ‰§è¡Œã€‚ è¯»åå†™ä¸€è‡´æ€§ Write after Read Consistencyï¼šè¯»åå†™ä¸€è‡´æ€§ï¼Œä¿è¯ä¸€ä¸ªå®¢æˆ·ç«¯è¯»åˆ°æ•°æ®ç‰ˆæœ¬ N åï¼ˆå¯èƒ½æ˜¯å…¶ä»–å®¢æˆ·ç«¯å†™å…¥çš„ï¼‰ï¼Œéšåå¯¹åŒä¸€æ•°æ®çš„å†™æ“ä½œå¿…é¡»è¦åœ¨ç‰ˆæœ¬å·å¤§äºç­‰äº N çš„å‰¯æœ¬ä¸Šæ‰§è¡Œã€‚ ä¸Šè¿°å››ä¸ªä¸€è‡´æ€§æ¨¡å‹éƒ½åªä»æ¯ä¸ªå®¢æˆ·ç«¯è‡ªèº«çš„è§’åº¦å®šä¹‰è§„åˆ™ï¼Œæ¯”è¾ƒç‰‡é¢ï¼Œå› æ­¤å®ƒä»¬éƒ½æ˜¯ã€Œå¼±ä¸€è‡´æ¨¡å‹ã€ã€‚ è€Œä¸è€ƒè™‘å®¢æˆ·ç«¯ï¼Œç›´æ¥ä»æ‰€æœ‰æ•°æ®åº“ç”¨æˆ·çš„æ“ä½œè§†è§’çœ‹ï¼Œæœ‰å¦‚ä¸‹å‡ ç§ä¸€è‡´æ€§æ¨¡å‹ï¼š çº¿æ€§ä¸€è‡´æ€§ Linearizabilityï¼šçº¿æ€§ä¸€è‡´æ€§åˆ©ç”¨äº†äº‹ä»¶çš„æäº¤é¡ºåºï¼Œå®ƒä¿è¯ä»»ä½•è¯»æ“ä½œå¾—åˆ°çš„æ•°æ®ï¼Œå…¶é¡ºåºè·Ÿè¯»/å†™äº‹ä»¶çš„æäº¤é¡ºåºä¸€è‡´ã€‚ ç®€å•çš„è¯´å®ƒè¦æ±‚æ•´ä¸ªç³»ç»Ÿè¡¨ç°å¾—åƒåªå­˜åœ¨ä¸€ä¸ªå‰¯æœ¬ï¼Œæ‰€æœ‰æ“ä½œçš„æ‰§è¡Œç»“æœå°±è·Ÿè¿™äº›äº‹ä»¶æŒ‰æäº¤é¡ºåºå®Œå…¨ä¸²è¡Œæ‰§è¡Œä¸€æ ·ã€‚è¿™å®é™…ä¹Ÿæ˜¯åœ¨è¯´æ‰€æœ‰å¹¶å‘äº‹ä»¶éƒ½æ˜¯åŸå­çš„ï¼Œä¸€æ—¦äº’ç›¸ä¹‹é—´å­˜åœ¨å†²çªï¼Œå°±ä¸€å®šå¾—æŒ‰é¡ºåºæ‰§è¡Œï¼Œå› æ­¤ä¹Ÿæœ‰äººç§°å®ƒä¸ºã€ŒåŸå­ä¸€è‡´æ€§ã€ã€‚ çº¿æ€§ä¸€è‡´æ€§ï¼Œå®Œå…¨ç­‰ä»·äºç³»ç»Ÿå¯¹å¤–çŠ¶æ€çš„ã€Œå¼ºä¸€è‡´æ€§ã€ çº¿æ€§ä¸€è‡´æ€§çš„ç³»ç»Ÿæ˜¯å®Œå…¨ç¡®å®šæ€§çš„ å®ç°æ–¹å¼ï¼šéœ€è¦ä¸€ä¸ªæ‰€æœ‰èŠ‚ç‚¹éƒ½ä¸€è‡´çš„ã€Œå…¨å±€æ—¶é’Ÿã€ï¼Œè¿™æ ·æ‰å¯ä»¥å¯¹æ‰€æœ‰äº‹ä»¶è¿›è¡Œå…¨å±€æ’åºã€‚ å¤§å¤šæ•°åˆ†å¸ƒå¼æ•°æ®åº“å¦‚ TiDB/Etcd éƒ½æ˜¯é€šè¿‡ NTP ç­‰åè®®è¿›è¡Œå•ç‚¹æˆæ—¶ä¸åŒæ­¥å®ç°çš„å…¨å±€æ—¶é’Ÿã€‚ æœ‰å…¨çƒåŒ–éƒ¨ç½²éœ€è¦çš„ Google Spanner æ˜¯ä½¿ç”¨ GPS + åŸå­é’Ÿå®ç°çš„å…¨å±€æ—¶é’Ÿ TrueTimeï¼Œå…¨å±€è¯¯å·®å¯ä»¥æ§åˆ¶åœ¨ 7ms ä»¥å†…ã€‚ å±€é™æ€§ï¼šæ ¹æ®çˆ±å› æ–¯å¦ç›¸å¯¹è®ºï¼Œã€Œæ—¶é—´æ˜¯ç›¸å¯¹çš„ã€ï¼Œå®é™…ä¸Šå¹¶ä¸å­˜åœ¨ç»å¯¹çš„æ—¶é—´ï¼Œå› æ­¤çº¿æ€§ä¸€è‡´æ€§åªåœ¨ç»å…¸ç‰©ç†å­¦èŒƒå›´å†…é€‚ç”¨ã€‚ é¡ºåºä¸€è‡´æ€§ Sequentially Consistentï¼š é¡ºåºä¸€è‡´æ€§æœ€æ—©æ˜¯ Leslie Lamport ç”¨æ¥æè¿°å¤šæ ¸ CPU çš„è¡Œä¸ºçš„ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿé¢†åŸŸç”¨å¾—è¾ƒå°‘ã€‚ é¡ºåºä¸€è‡´æ€§çš„è¦æ±‚æœ‰ä¸¤ç‚¹ï¼š ä»å•ä¸ªè¿›ç¨‹ï¼ˆå‰¯æœ¬ï¼‰çš„è§’åº¦çœ‹ï¼Œæ‰€æœ‰æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºè·Ÿä»£ç é€»è¾‘çš„é¡ºåºå®Œå…¨ä¸€è‡´ã€‚ ä»æ‰€æœ‰çš„å¤„ç†å™¨ï¼ˆæ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼‰è§’åº¦çœ‹ï¼Œå†™æ“ä½œä¸å¿…ç«‹å³å¯¹æ‰€æœ‰ç”¨æˆ·å¯è§ï¼Œä½†æ˜¯æ‰€æœ‰å‰¯æœ¬å¿…é¡»ä»¥ç›¸åŒçš„é¡ºåºæ¥æ”¶è¿™äº›å†™æ“ä½œã€‚ é¡ºåºä¸€è‡´æ€§å’Œçº¿æ€§ä¸€è‡´æ€§éƒ½æ˜¯è¦æ‰¾åˆ°ä¸€ä¸ªæ»¡è¶³ã€Œå†™åè¯»ã€çš„ä¸€ç»„æ“ä½œå†å²ï¼Œå·®å¼‚åœ¨äºçº¿æ€§ä¸€è‡´æ€§è¦æ±‚ä¸¥æ ¼çš„æ—¶é—´åºï¼Œè€Œé¡ºåºä¸€è‡´æ€§åªè¦æ±‚æ»¡è¶³ä»£ç çš„é€»è¾‘é¡ºåºï¼Œè€Œå…¶ä»–ä»£ç é€»è¾‘æœªå®šä¹‰çš„äº‹ä»¶é¡ºåºï¼ˆæ¯”å¦‚å¤šå‰¯æœ¬ä¸Šå„äº‹ä»¶ä¹‹é—´çš„é¡ºåºï¼‰ï¼Œå…·ä½“æ˜¯ä»€ä¹ˆæ ·çš„é¡ºåºæ— æ‰€è°“ï¼Œåªè¦æ‰€æœ‰å‰¯æœ¬çœ‹åˆ°çš„äº‹ä»¶é¡ºåºéƒ½ç›¸åŒå°±è¡Œã€‚ é¡ºåºä¸€è‡´æ€§å¹¶ä¸èƒ½æä¾›ã€Œç¡®å®šæ€§ã€ï¼Œç›¸åŒçš„ä¸¤æ¬¡æ“ä½œä»ç„¶å¯èƒ½å¾—åˆ°ä¸åŒçš„äº‹ä»¶é¡ºåºã€‚ å®ç°æ–¹å¼ï¼šå› ä¸ºä¸è¦æ±‚ä¸¥æ ¼çš„å…¨å±€æ—¶é—´åºï¼Œå®ƒå°±ä¸éœ€è¦ä¸€ä¸ªå…¨å±€æ—¶é’Ÿäº†ï¼Œä½†å®é™…ä¸Šä¸ºäº†æ»¡è¶³å…¨å±€çš„ç¡®å®šæ€§ï¼Œä»ç„¶éœ€è¦ä¸€äº›å¤æ‚çš„æ“ä½œã€‚ å› æœä¸€è‡´æ€§ Causal Consistencyï¼šçº¿æ€§ä¸€è‡´æ€§çš„å…¨å±€æ—¶é’Ÿæœ‰å…¶å±€é™æ€§ï¼Œè€Œå› æœä¸€è‡´æ€§åŸºäºå†™äº‹ä»¶çš„ã€Œååºå…³ç³»ã€æå‡ºäº†ã€Œé€»è¾‘æ—¶é’Ÿã€çš„æ¦‚å¿µï¼Œå¹¶ä¿è¯è¯»é¡ºåºä¸é€»è¾‘æ—¶é’Ÿä¸Šçš„å†™äº‹ä»¶é¡ºåºä¸€è‡´ã€‚ å†™äº‹ä»¶çš„ã€Œååºå…³ç³»ã€å…³ç³»æ˜¯æŒ‡ï¼Œè‡³å°‘éƒ¨åˆ†äº‹ä»¶ï¼ˆæ¯”å¦‚ä¸€ä¸ªèŠ‚ç‚¹å†…éƒ¨çš„äº‹ä»¶ï¼‰æ˜¯å¯ä»¥ä½¿ç”¨æœ¬åœ°æ—¶é’Ÿç›´æ¥æ’åºçš„ï¼Œè€ŒèŠ‚ç‚¹ä¹‹é—´å‘ç”Ÿé€šè®¯æ—¶ï¼Œæ¥æ”¶æ–¹çš„äº‹ä»¶ä¸€å®šæ™šäºè°ƒç”¨æ–¹çš„äº‹ä»¶ã€‚åŸºäºè¿™ä¸€ç‚¹å¯ä»¥å®ç°ä¸€ä¸ªã€Œé€»è¾‘æ—¶é’Ÿã€ï¼Œä½†é€»è¾‘æ—¶é’Ÿçš„ç¼ºç‚¹åœ¨äºï¼Œå¦‚æœæŸä¸¤ä¸ªäº‹ä»¶ä¸å­˜åœ¨ç›¸å…³æ€§ï¼Œé‚£é€»è¾‘æ—¶é’Ÿç»™å‡ºçš„é¡ºåºå°±æ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚ å¤šæ•°è§‚ç‚¹è®¤ä¸ºï¼Œå› æœä¸€è‡´æ€§å¼±äºçº¿æ€§ä¸€è‡´æ€§ï¼Œä½†åœ¨å¹¶å‘æ€§èƒ½ä¸Šå…·æœ‰ä¼˜åŠ¿ï¼Œä¹Ÿè¶³ä»¥å¤„ç†å¤šæ•°çš„å¼‚å¸¸ç°è±¡ï¼Œæ‰€ä»¥å› æœä¸€è‡´æ€§ä¹Ÿåœ¨å·¥ä¸šç•Œå¾—åˆ°äº†åº”ç”¨ã€‚ CockroachDB å’Œ YugabyteDB éƒ½åœ¨è®¾è®¡ä¸­é‡‡ç”¨äº†é€»è¾‘æ··åˆæ—¶é’Ÿï¼ˆHybrid Logical Clocksï¼‰ï¼Œè¿™ä¸ªæ–¹æ¡ˆæºè‡ª Lamport çš„é€»è¾‘æ—¶é’Ÿï¼Œä¹Ÿå–å¾—äº†ä¸é”™çš„æ•ˆæœ å‰ç¼€ä¸€è‡´æ€§ Consistent Prefixï¼šå‰¯æœ¬ä¹‹é—´çš„åŒæ­¥è¿‡ç¨‹ä¸­ï¼Œä¼šå­˜åœ¨ä¸€äº›å‰¯æœ¬æ¥æ”¶æ•°æ®çš„é¡ºåºå¹¶ä¸ä¸€è‡´ã€‚ã€Œå‰ç¼€ä¸€è‡´æ€§ã€æ˜¯è¯´æ‰€æœ‰ç”¨æˆ·è¯»åˆ°çš„æ•°æ®é¡ºåºçš„å‰ç¼€æ°¸è¿œæ˜¯ä¸€è‡´çš„ã€‚ ã€Œå‰ç¼€ã€æ˜¯æŒ‡ç¨‹åºåœ¨æ‰§è¡Œå†™æ“ä½œæ—¶ï¼Œéœ€è¦æ˜¾å¼å£°æ˜å…¶ã€Œå‰ç¼€ã€äº‹ä»¶ï¼Œè¿™æ ·æ¯ä¸ªäº‹ä»¶å°±éƒ½å­˜","date":"2022-08-07","objectID":"/posts/consistency-and-consensus-algorithm/:1:2","series":null,"tags":["å…±è¯†","ä¸€è‡´æ€§","åˆ†å¸ƒå¼","æ•°æ®åº“","åŒºå—é“¾"],"title":"åˆ†å¸ƒå¼æ•°æ®åº“çš„ä¸€è‡´æ€§é—®é¢˜ä¸å…±è¯†ç®—æ³•","uri":"/posts/consistency-and-consensus-algorithm/#æ•°æ®ä¸€è‡´æ€§æ¨¡å‹"},{"categories":["tech"],"content":" 2. æ•°æ®ä¸€è‡´æ€§ Data Consistencyã€Œæ•°æ®ä¸€è‡´æ€§ã€æ˜¯æŒ‡å¯¹æ•°æ®åº“çš„æ¯ä¸€æ¬¡è¯»æ“ä½œéƒ½åº”è¯¥è¯»åˆ°æœ€æ–°å†™å…¥çš„æ•°æ®ï¼Œæˆ–è€…ç›´æ¥æŠ¥é”™ã€‚ å¯¹å•æœºæ•°æ®åº“è€Œè¨€ã€Œæ•°æ®ä¸€è‡´æ€§ã€å¾€å¾€ä¸æ˜¯é—®é¢˜ï¼Œå› ä¸ºå®ƒé€šå¸¸åªæœ‰ä¸€ä»½ä¿å­˜åœ¨ç£ç›˜æˆ–å†…å­˜ä¸­çš„æ•°æ®ã€‚ä½†æ˜¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸ºäº†æ•°æ®å®‰å…¨æ€§æˆ–è€…ä¸ºäº†æ€§èƒ½ï¼Œå¾€å¾€æ¯ä¸€ä»½æ•°æ®éƒ½åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šå­˜æœ‰å…¶å‰¯æœ¬ï¼Œè¿™å°±å¼•å‡ºäº†æ•°æ®å‰¯æœ¬ä»¬çš„ä¸€è‡´æ€§é—®é¢˜ã€‚å› æ­¤ï¼Œæˆ‘ä»¬é€šå¸¸è°ˆè®ºçš„ã€Œæ•°æ®ä¸€è‡´æ€§ã€å°±æ˜¯æŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿçš„ã€Œæ•°æ®ä¸€è‡´æ€§ã€ã€‚ CAP åŸåˆ™æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿé¢†åŸŸä¸€ä¸ªè‘—åçš„ç†è®ºï¼Œå®ƒå‘Šè¯‰æˆ‘ä»¬åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¦‚ä¸‹ä¸‰ç§å±æ€§ä¸å¯èƒ½å…¨éƒ¨è¾¾æˆï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä½œã€ŒCAP ä¸å¯èƒ½ä¸‰è§’ã€ï¼š æ•°æ®ä¸€è‡´æ€§ Data Consistencyï¼šå®¢æˆ·ç«¯çš„æ¯æ¬¡è¯»æ“ä½œï¼Œä¸ç®¡è®¿é—®ç³»ç»Ÿçš„å“ªä¸ªèŠ‚ç‚¹ï¼Œè¦ä¹ˆè¯»åˆ°çš„éƒ½æ˜¯åŒä¸€ä»½æœ€æ–°å†™å…¥çš„æ•°æ®ï¼Œè¦ä¹ˆè¯»å–å¤±è´¥ å¼ºè°ƒæ•°æ®å®Œå…¨æ­£ç¡® å¯ç”¨æ€§ Availabilityï¼šä»»ä½•æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œä¸ç®¡è®¿é—®å“ªä¸ªéæ•…éšœèŠ‚ç‚¹ï¼Œéƒ½èƒ½å¾—åˆ°å“åº”æ•°æ®ï¼Œä½†ä¸ä¿è¯æ˜¯åŒä¸€ä»½æœ€æ–°æ•°æ® å¼ºè°ƒçš„æ˜¯æœåŠ¡å¯ç”¨ï¼Œä½†ä¸ä¿è¯æ•°æ®æ­£ç¡® åˆ†åŒºå®¹é”™æ€§ Partition Toleranceï¼šå³ä½¿èŠ‚ç‚¹ä¹‹é—´å‡ºç°äº†ä»»æ„æ•°é‡çš„æ¶ˆæ¯ä¸¢å¤±æˆ–è€…é«˜å»¶è¿Ÿï¼Œç³»ç»Ÿä»èƒ½æ­£å¸¸è¿è¡Œ å°±æ˜¯è¯´ç½‘ç»œä¸¢åŒ…æˆ–å»¶è¿Ÿä¼šå¯¼è‡´ç³»ç»Ÿè¢«åˆ†æˆå¤šä¸ª Partitionï¼Œç³»ç»Ÿèƒ½å¤Ÿå®¹å¿è¿™ç§æƒ…å†µ ä¸ºäº†ä¿è¯åˆ†åŒºå®¹é”™æ€§ Pï¼Œè€ƒè™‘å½“åˆ†å¸ƒå¼ç³»ç»Ÿå› ä¸ºç½‘ç»œé—®é¢˜è¢«å‰²è£‚æˆå¤šä¸ªåˆ†åŒºæ—¶ï¼Œæ¯ä¸ªåˆ†åŒºåªæœ‰å¦‚ä¸‹ä¸¤ç§é€‰æ‹©ï¼ŒA è·Ÿ C å¿…é¡»ç‰ºç‰²æ‰å…¶ä¸­ä¹‹ä¸€ï¼š å–æ¶ˆæ“ä½œå¹¶æ‹’ç»æä¾›æœåŠ¡ï¼Œè¿™é™ä½äº†å¯ç”¨æ€§ï¼Œä½†æ˜¯èƒ½ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ ç»§ç»­å¤„ç†è¯·æ±‚ï¼Œè¿™ç¡®ä¿äº†å¯ç”¨æ€§ï¼Œä½†æ˜¯æ•°æ®ä¸€è‡´æ€§å°±æ— æ³•ä¿è¯äº† å¦‚æœç³»ç»Ÿçš„å¤šä¸ªåˆ†åŒºéƒ½åœ¨åŒæ—¶æä¾›æœåŠ¡ï¼Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´å¹¶ä¸”å­˜åœ¨å†²çªæ— æ³•åˆå¹¶ï¼Œè¿™å°±è¢«ç§°ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„ã€Œè„‘è£‚ã€ï¼Œæ˜¾ç„¶ä»»ä½•åˆ†å¸ƒå¼ç³»ç»Ÿéƒ½ä¸ä¼šå¸Œæœ›å‘ç”Ÿã€Œè„‘è£‚ã€ã€‚ å› ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿä¸å•æœºç³»ç»Ÿä¸åŒï¼Œå®ƒæ¶‰åŠåˆ°å¤šèŠ‚ç‚¹é—´çš„ç½‘ç»œé€šè®¯å’Œäº¤äº’ï¼Œä½†æ˜¯åªè¦æœ‰ç½‘ç»œäº¤äº’å°±ä¸€å®šä¼šæœ‰å»¶è¿Ÿå’Œæ•°æ®ä¸¢å¤±ï¼ŒèŠ‚ç‚¹é—´çš„åˆ†åŒºæ•…éšœæ˜¯å¾ˆæœ‰å¯èƒ½å‘ç”Ÿçš„ã€‚å› æ­¤ä¸ºäº†æ­£å¸¸è¿è¡Œï¼ŒP æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿå¿…é¡»ä¿è¯çš„ç‰¹æ€§ï¼Œåœ¨å‡ºç°åˆ†åŒºæ•…éšœæ—¶ï¼Œä¸ºäº† P åªèƒ½ç‰ºç‰²æ‰ A æˆ–è€… Cã€‚ å·¥ç¨‹ä¸Šæ˜¯è¦ AP è¿˜æ˜¯ CPï¼Œå¾—è§†æƒ…å†µè€Œå®šï¼š Etcd/Zookeeper/Consul: å®ƒä»¬é€šå¸¸è¢«ç”¨äºå­˜å‚¨ç³»ç»Ÿè¿è¡Œçš„å…³é”®å…ƒä¿¡æ¯ï¼Œæ¯æ¬¡è¯»ï¼Œéƒ½è¦èƒ½è¯»å–åˆ°æœ€æ–°æ•°æ®ã€‚å› æ­¤å®ƒä»¬å®ç°äº† CPï¼Œç‰ºç‰²äº† A DynamoDB/Cassandra/MongoDBï¼šä¸è¦æ±‚æ•°æ®ä¸€è‡´æ€§ï¼Œä¸€æ®µæ—¶é—´å†…ç”¨æ—§çš„ç¼“å­˜é—®é¢˜ä¹Ÿä¸å¤§ï¼Œä½†æ˜¯è¦æ±‚å¯ç”¨æ€§ï¼Œå› æ­¤åº”è¯¥å®ç° APï¼Œç‰ºç‰²æ‰ C æ•°æ®ä¸€è‡´æ€§æ¨¡å‹åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¤šå‰¯æœ¬æ•°æ®ä¸Šçš„ä¸€ç»„è¯»å†™ç­–ç•¥ï¼Œè¢«ç§°ä¸ºã€Œï¼ˆæ•°æ®ï¼‰ä¸€è‡´æ€§æ¨¡å‹ Consistency Modelã€ã€‚ä¸€è‡´æ€§æ¨¡å‹æ•°é‡å¾ˆå¤šï¼Œè®©äººéš¾ä»¥åˆ†è¾¨ã€‚ä¸ºäº†ä¾¿äºç†è§£ï¼Œæˆ‘ä»¬å…ˆä»çŠ¶æ€è§†è§’å‡ºå‘åŒºåˆ†ä¸€ä¸‹å¼ºä¸€è‡´ä¸å¼±ä¸€è‡´çš„æ¦‚å¿µï¼Œåœ¨è¿™ä¸ªçš„åŸºç¡€ä¸Šå†ä»æ“ä½œè§†è§’å»ç†è§£è¿™ä¼—å¤šçš„ä¸€è‡´æ€§æ¨¡å‹ã€‚ 1. çŠ¶æ€è§†è§’ - å¼ºä¸€è‡´ä¸å¼±ä¸€è‡´æˆ‘ä»¬é¦–å…ˆæŠŠæ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿçœ‹ä½œä¸€ä¸ªç™½ç›’ï¼Œä»çŠ¶æ€è§†è§’çœ‹ï¼Œä»»ä½•å˜æ›´æ“ä½œåï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿçš„å¤šä¸ªæ•°æ®å‰¯æœ¬åªæœ‰å¦‚ä¸‹ä¸‰ç§çŠ¶æ€ï¼š åœ¨æŸäº›æ¡ä»¶ä¸‹ï¼Œå„å‰¯æœ¬çŠ¶æ€ä¸ä¸€è‡´çš„ç°è±¡åªæ˜¯æš‚æ—¶çš„ï¼Œåç»­è¿˜ä¼šè½¬æ¢åˆ°ä¸€è‡´çš„çŠ¶æ€ï¼Œè¿™è¢«ç§°ä¸ºã€Œå¼±ä¸€è‡´ã€ï¼› è¿™é€šå¸¸æ˜¯ä½¿ç”¨å¼‚æ­¥å¤åˆ¶æ¥åŒæ­¥å„å‰¯æœ¬çš„çŠ¶æ€ã€‚ ç›¸å¯¹çš„è¯´ï¼Œå¦‚æœç³»ç»Ÿå„å‰¯æœ¬ä¸å­˜åœ¨ã€Œä¸ä¸€è‡´ã€è¿™ç§çŠ¶æ€ï¼Œåªè¦å˜æ›´æ“ä½œæˆåŠŸæ•°æ®å°±ä¸€å®šå®Œå…¨ä¸€è‡´ï¼Œé‚£å®ƒå°±è¢«ç§°ä¸ºã€Œå¼ºä¸€è‡´ã€ã€‚ è¿™è¦æ±‚æ‰€æœ‰å‰¯æœ¬ä¹‹é—´çš„æ•°æ®æ›´æ–°å¿…é¡»å®Œå…¨åŒæ­¥ï¼Œå°±å¿…é¡»ä½¿ç”¨å…¨åŒæ­¥å¤åˆ¶ã€‚ æ°¸è¿œä¸ä¼šä¸€è‡´ï¼šè¿™åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å°±æ˜¯ bug äº†ï¼Œä¹Ÿè¢«ç§°ä¸ºã€Œè„‘è£‚ã€ã€‚ ä¸Šé¢æè¿°çš„æ˜¯æ•´ä¸ªç³»ç»Ÿçš„å®¢è§‚ã€å®é™…çŠ¶æ€ï¼Œä½†å¯¹äºç»å¤§éƒ¨åˆ†ç”¨æˆ·è€Œè¨€åˆ†å¸ƒå¼ç³»ç»Ÿæ›´å¤šçš„æ˜¯ä¸€ä¸ªé»‘ç›’ï¼Œå› æ­¤æ›´æµè¡Œçš„æ˜¯åŸºäºã€Œé»‘ç›’ã€çš„åˆ†ç±»æ–¹å¼ï¼Œå®ƒæ ¹æ®ç³»ç»Ÿçš„å¯¹å¤–çŠ¶æ€å°†ç³»ç»Ÿåˆ†æˆä¸¤ç§ç±»å‹ï¼š å¼ºä¸€è‡´ï¼šæŒ‡å¯¹ç³»ç»Ÿçš„ä»»ä½•èŠ‚ç‚¹/è¿›ç¨‹ï¼Œå†™æ“ä½œå®Œæˆåï¼Œä»»ä½•ç”¨æˆ·å¯¹ä»»ä½•èŠ‚ç‚¹çš„åç»­è®¿é—®éƒ½èƒ½è¯»åˆ°æ–°çš„å€¼ã€‚å°±å¥½åƒç³»ç»Ÿåªå­˜åœ¨ä¸€ä¸ªå‰¯æœ¬ä¸€æ ·ã€‚ æœ€å¸¸ç”¨ç®—æ³•æ˜¯ Raft/Paxosï¼Œå®ƒä»¬çš„å†™æ“ä½œåªè¦æ±‚è¶…è¿‡åŠæ•°èŠ‚ç‚¹å†™å…¥æˆåŠŸï¼Œå› æ­¤å†™å…¥å®Œæˆæ—¶ï¼Œå†…éƒ¨çŠ¶æ€å®é™…æ˜¯ä¸ä¸€è‡´çš„ï¼Œä½†æ˜¯å¯¹å®ƒè¿›è¡Œè¯»å†™ï¼Œæ•ˆæœè·Ÿã€Œå…¨åŒæ­¥å¤åˆ¶ã€æ²¡æœ‰åŒºåˆ«ã€‚ å¼±ä¸€è‡´ï¼šæŒ‡å¯¹ç³»ç»Ÿçš„ä»»ä½•èŠ‚ç‚¹/è¿›ç¨‹ï¼Œå†™æ“ä½œå®Œæˆåï¼Œåç»­çš„ä»»ä½•è®¿é—®å¯èƒ½ä¼šæ‹¿åˆ°çš„å€¼æ˜¯ä¸ç¡®å®šçš„ï¼Œä½†ç»è¿‡ä¸€æ®µæ—¶é—´åï¼Œåç»­çš„ä»»ä½•è®¿é—®éƒ½èƒ½è¯»åˆ°æ–°çš„å€¼ã€‚ å¼±ä¸€è‡´æ˜¯éå¸¸æ¨¡ç³Šçš„å®šä¹‰ã€‚å¦‚æœæˆ‘ä»¬æŠŠæœ€ç»ˆæ‰€æœ‰ç”¨æˆ·éƒ½èƒ½è®¿é—®åˆ°æ–°çš„å€¼è¢«ç§°ä¸ºã€Œç³»ç»Ÿæ”¶æ•›ã€ï¼Œ ç³»ç»Ÿæ”¶æ•›çš„ç”¨æ—¶å¯ä»¥æœ‰æ˜ç¡®è¾¹ç•Œï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰ã€‚ç³»ç»Ÿæ”¶æ•›å‰çš„è®¿é—®è¡Œä¸ºå¯ä»¥æœ‰æ˜ç¡®è§„èŒƒï¼Œä¹Ÿå¯ä»¥ä¸å­˜åœ¨è§„èŒƒã€‚ä¸€åˆ‡éƒ½çœ‹å…·ä½“ç³»ç»Ÿçš„å®ç°ã€‚ å¦‚æœç³»ç»Ÿèƒ½å¤Ÿåœ¨æœ‰é™æ—¶é—´å†…æ”¶æ•›ï¼Œé‚£å®ƒå°±æ˜¯ã€Œæœ€ç»ˆä¸€è‡´ã€ï¼Œå¦åˆ™å¯ä»¥è®¤ä¸ºå®ƒæ˜¯ã€Œä¸ä¸€è‡´ã€ã€‚ ä¸ºäº†å®é™…éœ€è¦ï¼Œæ•°æ®åº“ä¸“å®¶å¯¹ç³»ç»Ÿæ”¶æ•›ä¹‹å‰çš„è¯»å†™æ•ˆæœè¿›è¡Œå„ç§é™åˆ¶ï¼Œå¯¹ç³»ç»Ÿçš„æ”¶æ•›æ—¶é—´è¿›è¡Œå„ç§é™åˆ¶ï¼Œå¾—åˆ°äº†è®¸å¤šä¸€è‡´æ€§æ¨¡å‹ã€‚ 2. æ“ä½œè§†è§’ - å¤šç§ä¸€è‡´æ€§æ¨¡å‹ä»æ¯ä¸ªå®¢æˆ·ç«¯çš„æ“ä½œè§’åº¦çœ‹ï¼Œæœ‰å››ç§ä¸€è‡´æ€§æ¨¡å‹ï¼š å†™åè¯»ä¸€è‡´æ€§ Read after Write Consistencyï¼šä¹Ÿè¢«ç§°ä½œã€Œè¯»è‡ªå·±æ‰€å†™ä¸€è‡´æ€§ã€ï¼Œå³è‡ªå·±å†™å®Œæ•°æ®ç‰ˆæœ¬ N åï¼Œåç»­è¯»åˆ°çš„ç‰ˆæœ¬ä¸€å®šä¸å°äºç‰ˆæœ¬ Nã€‚ å®ƒè§£å†³çš„é—®é¢˜ï¼šA å‘äº†ä¸ªæŠ–éŸ³è§†é¢‘ï¼Œåˆ·æ–°é¡µé¢åå´è«åå…¶å¦™æ¶ˆå¤±äº†ï¼ˆæ—§ç‰ˆæœ¬ï¼‰ï¼Œå‡ åˆ†é’Ÿåæ‰é‡æ–°åˆ·å‡ºæ¥ã€‚ å®ç°æ–¹å¼ä¹‹ä¸€ï¼šä¸ºå†™å…¥è€…å•ç‹¬æ·»åŠ ä¸€ä¸ªè¯»å–è§„åˆ™ï¼Œä»–çš„è¯»éƒ½ç”±å·²æ›´æ–°å…¶å†™å…¥æ•°æ®çš„å‰¯æœ¬æ¥å¤„ç†ã€‚ å•è°ƒè¯»ä¸€è‡´æ€§ Monotonic Read Consistencyï¼šä¿è¯å¤šä¸ªè¯»æ“ä½œçš„é¡ºåºï¼Œå³å®¢æˆ·ç«¯ä¸€æ—¦è¯»åˆ°æŸä¸ªæ•°æ®ç‰ˆæœ¬ Nï¼Œåç»­ä¸ä¼šè¯»åˆ°æ¯” N æ›´ä½çš„ç‰ˆæœ¬ã€‚ å®ƒè§£å†³çš„é—®é¢˜æ˜¯ï¼šA åˆ é™¤äº†ä¸€ä¸ªæŠ–éŸ³è§†é¢‘ï¼Œå¯å¤šæ¬¡åˆ·æ–°ï¼Œå¶å°”åˆ·ä¸åˆ°è§†é¢‘ï¼Œå¶å°”åˆèƒ½åˆ·åˆ°è¢«åˆ é™¤è§†é¢‘ï¼ˆæ—§ç‰ˆæœ¬ï¼‰ï¼Œå‡ åˆ†é’Ÿåæ‰å½»åº•è¢«åˆ é™¤ã€‚ å®ç°æ–¹å¼ä¹‹ä¸€ï¼šä¸ºæ¯ä¸ªç”¨æˆ·çš„è¯»éƒ½åˆ›å»ºä¸€ä¸ªå‰¯æœ¬æ˜ å°„ï¼Œåç»­çš„è¯»éƒ½ç”±ä¸€ä¸ªå›ºå®šçš„å‰¯æœ¬å¤„ç†ï¼Œé¿å…éšæœºåˆ‡æ¢å‰¯æœ¬è€Œè¯»åˆ°æ›´è€çš„å€¼ã€‚ å•è°ƒå†™ä¸€è‡´æ€§ Monotonic Write Consistencyï¼šä¿è¯å¤šä¸ªå†™æ“ä½œçš„é¡ºåºï¼Œå³å®¢æˆ·ç«¯å¯¹åŒä¸€æ•°æ®çš„ä¸¤æ¬¡å†™å…¥æ“ä½œï¼Œä¸€å®šæŒ‰å…¶è¢«æäº¤çš„é¡ºåºè¢«æ‰§è¡Œã€‚ è¯»åå†™ä¸€è‡´æ€§ Write after Read Consistencyï¼šè¯»åå†™ä¸€è‡´æ€§ï¼Œä¿è¯ä¸€ä¸ªå®¢æˆ·ç«¯è¯»åˆ°æ•°æ®ç‰ˆæœ¬ N åï¼ˆå¯èƒ½æ˜¯å…¶ä»–å®¢æˆ·ç«¯å†™å…¥çš„ï¼‰ï¼Œéšåå¯¹åŒä¸€æ•°æ®çš„å†™æ“ä½œå¿…é¡»è¦åœ¨ç‰ˆæœ¬å·å¤§äºç­‰äº N çš„å‰¯æœ¬ä¸Šæ‰§è¡Œã€‚ ä¸Šè¿°å››ä¸ªä¸€è‡´æ€§æ¨¡å‹éƒ½åªä»æ¯ä¸ªå®¢æˆ·ç«¯è‡ªèº«çš„è§’åº¦å®šä¹‰è§„åˆ™ï¼Œæ¯”è¾ƒç‰‡é¢ï¼Œå› æ­¤å®ƒä»¬éƒ½æ˜¯ã€Œå¼±ä¸€è‡´æ¨¡å‹ã€ã€‚ è€Œä¸è€ƒè™‘å®¢æˆ·ç«¯ï¼Œç›´æ¥ä»æ‰€æœ‰æ•°æ®åº“ç”¨æˆ·çš„æ“ä½œè§†è§’çœ‹ï¼Œæœ‰å¦‚ä¸‹å‡ ç§ä¸€è‡´æ€§æ¨¡å‹ï¼š çº¿æ€§ä¸€è‡´æ€§ Linearizabilityï¼šçº¿æ€§ä¸€è‡´æ€§åˆ©ç”¨äº†äº‹ä»¶çš„æäº¤é¡ºåºï¼Œå®ƒä¿è¯ä»»ä½•è¯»æ“ä½œå¾—åˆ°çš„æ•°æ®ï¼Œå…¶é¡ºåºè·Ÿè¯»/å†™äº‹ä»¶çš„æäº¤é¡ºåºä¸€è‡´ã€‚ ç®€å•çš„è¯´å®ƒè¦æ±‚æ•´ä¸ªç³»ç»Ÿè¡¨ç°å¾—åƒåªå­˜åœ¨ä¸€ä¸ªå‰¯æœ¬ï¼Œæ‰€æœ‰æ“ä½œçš„æ‰§è¡Œç»“æœå°±è·Ÿè¿™äº›äº‹ä»¶æŒ‰æäº¤é¡ºåºå®Œå…¨ä¸²è¡Œæ‰§è¡Œä¸€æ ·ã€‚è¿™å®é™…ä¹Ÿæ˜¯åœ¨è¯´æ‰€æœ‰å¹¶å‘äº‹ä»¶éƒ½æ˜¯åŸå­çš„ï¼Œä¸€æ—¦äº’ç›¸ä¹‹é—´å­˜åœ¨å†²çªï¼Œå°±ä¸€å®šå¾—æŒ‰é¡ºåºæ‰§è¡Œï¼Œå› æ­¤ä¹Ÿæœ‰äººç§°å®ƒä¸ºã€ŒåŸå­ä¸€è‡´æ€§ã€ã€‚ çº¿æ€§ä¸€è‡´æ€§ï¼Œå®Œå…¨ç­‰ä»·äºç³»ç»Ÿå¯¹å¤–çŠ¶æ€çš„ã€Œå¼ºä¸€è‡´æ€§ã€ çº¿æ€§ä¸€è‡´æ€§çš„ç³»ç»Ÿæ˜¯å®Œå…¨ç¡®å®šæ€§çš„ å®ç°æ–¹å¼ï¼šéœ€è¦ä¸€ä¸ªæ‰€æœ‰èŠ‚ç‚¹éƒ½ä¸€è‡´çš„ã€Œå…¨å±€æ—¶é’Ÿã€ï¼Œè¿™æ ·æ‰å¯ä»¥å¯¹æ‰€æœ‰äº‹ä»¶è¿›è¡Œå…¨å±€æ’åºã€‚ å¤§å¤šæ•°åˆ†å¸ƒå¼æ•°æ®åº“å¦‚ TiDB/Etcd éƒ½æ˜¯é€šè¿‡ NTP ç­‰åè®®è¿›è¡Œå•ç‚¹æˆæ—¶ä¸åŒæ­¥å®ç°çš„å…¨å±€æ—¶é’Ÿã€‚ æœ‰å…¨çƒåŒ–éƒ¨ç½²éœ€è¦çš„ Google Spanner æ˜¯ä½¿ç”¨ GPS + åŸå­é’Ÿå®ç°çš„å…¨å±€æ—¶é’Ÿ TrueTimeï¼Œå…¨å±€è¯¯å·®å¯ä»¥æ§åˆ¶åœ¨ 7ms ä»¥å†…ã€‚ å±€é™æ€§ï¼šæ ¹æ®çˆ±å› æ–¯å¦ç›¸å¯¹è®ºï¼Œã€Œæ—¶é—´æ˜¯ç›¸å¯¹çš„ã€ï¼Œå®é™…ä¸Šå¹¶ä¸å­˜åœ¨ç»å¯¹çš„æ—¶é—´ï¼Œå› æ­¤çº¿æ€§ä¸€è‡´æ€§åªåœ¨ç»å…¸ç‰©ç†å­¦èŒƒå›´å†…é€‚ç”¨ã€‚ é¡ºåºä¸€è‡´æ€§ Sequentially Consistentï¼š é¡ºåºä¸€è‡´æ€§æœ€æ—©æ˜¯ Leslie Lamport ç”¨æ¥æè¿°å¤šæ ¸ CPU çš„è¡Œä¸ºçš„ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿé¢†åŸŸç”¨å¾—è¾ƒå°‘ã€‚ é¡ºåºä¸€è‡´æ€§çš„è¦æ±‚æœ‰ä¸¤ç‚¹ï¼š ä»å•ä¸ªè¿›ç¨‹ï¼ˆå‰¯æœ¬ï¼‰çš„è§’åº¦çœ‹ï¼Œæ‰€æœ‰æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºè·Ÿä»£ç é€»è¾‘çš„é¡ºåºå®Œå…¨ä¸€è‡´ã€‚ ä»æ‰€æœ‰çš„å¤„ç†å™¨ï¼ˆæ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼‰è§’åº¦çœ‹ï¼Œå†™æ“ä½œä¸å¿…ç«‹å³å¯¹æ‰€æœ‰ç”¨æˆ·å¯è§ï¼Œä½†æ˜¯æ‰€æœ‰å‰¯æœ¬å¿…é¡»ä»¥ç›¸åŒçš„é¡ºåºæ¥æ”¶è¿™äº›å†™æ“ä½œã€‚ é¡ºåºä¸€è‡´æ€§å’Œçº¿æ€§ä¸€è‡´æ€§éƒ½æ˜¯è¦æ‰¾åˆ°ä¸€ä¸ªæ»¡è¶³ã€Œå†™åè¯»ã€çš„ä¸€ç»„æ“ä½œå†å²ï¼Œå·®å¼‚åœ¨äºçº¿æ€§ä¸€è‡´æ€§è¦æ±‚ä¸¥æ ¼çš„æ—¶é—´åºï¼Œè€Œé¡ºåºä¸€è‡´æ€§åªè¦æ±‚æ»¡è¶³ä»£ç çš„é€»è¾‘é¡ºåºï¼Œè€Œå…¶ä»–ä»£ç é€»è¾‘æœªå®šä¹‰çš„äº‹ä»¶é¡ºåºï¼ˆæ¯”å¦‚å¤šå‰¯æœ¬ä¸Šå„äº‹ä»¶ä¹‹é—´çš„é¡ºåºï¼‰ï¼Œå…·ä½“æ˜¯ä»€ä¹ˆæ ·çš„é¡ºåºæ— æ‰€è°“ï¼Œåªè¦æ‰€æœ‰å‰¯æœ¬çœ‹åˆ°çš„äº‹ä»¶é¡ºåºéƒ½ç›¸åŒå°±è¡Œã€‚ é¡ºåºä¸€è‡´æ€§å¹¶ä¸èƒ½æä¾›ã€Œç¡®å®šæ€§ã€ï¼Œç›¸åŒçš„ä¸¤æ¬¡æ“ä½œä»ç„¶å¯èƒ½å¾—åˆ°ä¸åŒçš„äº‹ä»¶é¡ºåºã€‚ å®ç°æ–¹å¼ï¼šå› ä¸ºä¸è¦æ±‚ä¸¥æ ¼çš„å…¨å±€æ—¶é—´åºï¼Œå®ƒå°±ä¸éœ€è¦ä¸€ä¸ªå…¨å±€æ—¶é’Ÿäº†ï¼Œä½†å®é™…ä¸Šä¸ºäº†æ»¡è¶³å…¨å±€çš„ç¡®å®šæ€§ï¼Œä»ç„¶éœ€è¦ä¸€äº›å¤æ‚çš„æ“ä½œã€‚ å› æœä¸€è‡´æ€§ Causal Consistencyï¼šçº¿æ€§ä¸€è‡´æ€§çš„å…¨å±€æ—¶é’Ÿæœ‰å…¶å±€é™æ€§ï¼Œè€Œå› æœä¸€è‡´æ€§åŸºäºå†™äº‹ä»¶çš„ã€Œååºå…³ç³»ã€æå‡ºäº†ã€Œé€»è¾‘æ—¶é’Ÿã€çš„æ¦‚å¿µï¼Œå¹¶ä¿è¯è¯»é¡ºåºä¸é€»è¾‘æ—¶é’Ÿä¸Šçš„å†™äº‹ä»¶é¡ºåºä¸€è‡´ã€‚ å†™äº‹ä»¶çš„ã€Œååºå…³ç³»ã€å…³ç³»æ˜¯æŒ‡ï¼Œè‡³å°‘éƒ¨åˆ†äº‹ä»¶ï¼ˆæ¯”å¦‚ä¸€ä¸ªèŠ‚ç‚¹å†…éƒ¨çš„äº‹ä»¶ï¼‰æ˜¯å¯ä»¥ä½¿ç”¨æœ¬åœ°æ—¶é’Ÿç›´æ¥æ’åºçš„ï¼Œè€ŒèŠ‚ç‚¹ä¹‹é—´å‘ç”Ÿé€šè®¯æ—¶ï¼Œæ¥æ”¶æ–¹çš„äº‹ä»¶ä¸€å®šæ™šäºè°ƒç”¨æ–¹çš„äº‹ä»¶ã€‚åŸºäºè¿™ä¸€ç‚¹å¯ä»¥å®ç°ä¸€ä¸ªã€Œé€»è¾‘æ—¶é’Ÿã€ï¼Œä½†é€»è¾‘æ—¶é’Ÿçš„ç¼ºç‚¹åœ¨äºï¼Œå¦‚æœæŸä¸¤ä¸ªäº‹ä»¶ä¸å­˜åœ¨ç›¸å…³æ€§ï¼Œé‚£é€»è¾‘æ—¶é’Ÿç»™å‡ºçš„é¡ºåºå°±æ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚ å¤šæ•°è§‚ç‚¹è®¤ä¸ºï¼Œå› æœä¸€è‡´æ€§å¼±äºçº¿æ€§ä¸€è‡´æ€§ï¼Œä½†åœ¨å¹¶å‘æ€§èƒ½ä¸Šå…·æœ‰ä¼˜åŠ¿ï¼Œä¹Ÿè¶³ä»¥å¤„ç†å¤šæ•°çš„å¼‚å¸¸ç°è±¡ï¼Œæ‰€ä»¥å› æœä¸€è‡´æ€§ä¹Ÿåœ¨å·¥ä¸šç•Œå¾—åˆ°äº†åº”ç”¨ã€‚ CockroachDB å’Œ YugabyteDB éƒ½åœ¨è®¾è®¡ä¸­é‡‡ç”¨äº†é€»è¾‘æ··åˆæ—¶é’Ÿï¼ˆHybrid Logical Clocksï¼‰ï¼Œè¿™ä¸ªæ–¹æ¡ˆæºè‡ª Lamport çš„é€»è¾‘æ—¶é’Ÿï¼Œä¹Ÿå–å¾—äº†ä¸é”™çš„æ•ˆæœ å‰ç¼€ä¸€è‡´æ€§ Consistent Prefixï¼šå‰¯æœ¬ä¹‹é—´çš„åŒæ­¥è¿‡ç¨‹ä¸­ï¼Œä¼šå­˜åœ¨ä¸€äº›å‰¯æœ¬æ¥æ”¶æ•°æ®çš„é¡ºåºå¹¶ä¸ä¸€è‡´ã€‚ã€Œå‰ç¼€ä¸€è‡´æ€§ã€æ˜¯è¯´æ‰€æœ‰ç”¨æˆ·è¯»åˆ°çš„æ•°æ®é¡ºåºçš„å‰ç¼€æ°¸è¿œæ˜¯ä¸€è‡´çš„ã€‚ ã€Œå‰ç¼€ã€æ˜¯æŒ‡ç¨‹åºåœ¨æ‰§è¡Œå†™æ“ä½œæ—¶ï¼Œéœ€è¦æ˜¾å¼å£°æ˜å…¶ã€Œå‰ç¼€ã€äº‹ä»¶ï¼Œè¿™æ ·æ¯ä¸ªäº‹ä»¶å°±éƒ½å­˜","date":"2022-08-07","objectID":"/posts/consistency-and-consensus-algorithm/:1:2","series":null,"tags":["å…±è¯†","ä¸€è‡´æ€§","åˆ†å¸ƒå¼","æ•°æ®åº“","åŒºå—é“¾"],"title":"åˆ†å¸ƒå¼æ•°æ®åº“çš„ä¸€è‡´æ€§é—®é¢˜ä¸å…±è¯†ç®—æ³•","uri":"/posts/consistency-and-consensus-algorithm/#1-çŠ¶æ€è§†è§’---å¼ºä¸€è‡´ä¸å¼±ä¸€è‡´"},{"categories":["tech"],"content":" 2. æ•°æ®ä¸€è‡´æ€§ Data Consistencyã€Œæ•°æ®ä¸€è‡´æ€§ã€æ˜¯æŒ‡å¯¹æ•°æ®åº“çš„æ¯ä¸€æ¬¡è¯»æ“ä½œéƒ½åº”è¯¥è¯»åˆ°æœ€æ–°å†™å…¥çš„æ•°æ®ï¼Œæˆ–è€…ç›´æ¥æŠ¥é”™ã€‚ å¯¹å•æœºæ•°æ®åº“è€Œè¨€ã€Œæ•°æ®ä¸€è‡´æ€§ã€å¾€å¾€ä¸æ˜¯é—®é¢˜ï¼Œå› ä¸ºå®ƒé€šå¸¸åªæœ‰ä¸€ä»½ä¿å­˜åœ¨ç£ç›˜æˆ–å†…å­˜ä¸­çš„æ•°æ®ã€‚ä½†æ˜¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸ºäº†æ•°æ®å®‰å…¨æ€§æˆ–è€…ä¸ºäº†æ€§èƒ½ï¼Œå¾€å¾€æ¯ä¸€ä»½æ•°æ®éƒ½åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šå­˜æœ‰å…¶å‰¯æœ¬ï¼Œè¿™å°±å¼•å‡ºäº†æ•°æ®å‰¯æœ¬ä»¬çš„ä¸€è‡´æ€§é—®é¢˜ã€‚å› æ­¤ï¼Œæˆ‘ä»¬é€šå¸¸è°ˆè®ºçš„ã€Œæ•°æ®ä¸€è‡´æ€§ã€å°±æ˜¯æŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿçš„ã€Œæ•°æ®ä¸€è‡´æ€§ã€ã€‚ CAP åŸåˆ™æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿé¢†åŸŸä¸€ä¸ªè‘—åçš„ç†è®ºï¼Œå®ƒå‘Šè¯‰æˆ‘ä»¬åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¦‚ä¸‹ä¸‰ç§å±æ€§ä¸å¯èƒ½å…¨éƒ¨è¾¾æˆï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä½œã€ŒCAP ä¸å¯èƒ½ä¸‰è§’ã€ï¼š æ•°æ®ä¸€è‡´æ€§ Data Consistencyï¼šå®¢æˆ·ç«¯çš„æ¯æ¬¡è¯»æ“ä½œï¼Œä¸ç®¡è®¿é—®ç³»ç»Ÿçš„å“ªä¸ªèŠ‚ç‚¹ï¼Œè¦ä¹ˆè¯»åˆ°çš„éƒ½æ˜¯åŒä¸€ä»½æœ€æ–°å†™å…¥çš„æ•°æ®ï¼Œè¦ä¹ˆè¯»å–å¤±è´¥ å¼ºè°ƒæ•°æ®å®Œå…¨æ­£ç¡® å¯ç”¨æ€§ Availabilityï¼šä»»ä½•æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œä¸ç®¡è®¿é—®å“ªä¸ªéæ•…éšœèŠ‚ç‚¹ï¼Œéƒ½èƒ½å¾—åˆ°å“åº”æ•°æ®ï¼Œä½†ä¸ä¿è¯æ˜¯åŒä¸€ä»½æœ€æ–°æ•°æ® å¼ºè°ƒçš„æ˜¯æœåŠ¡å¯ç”¨ï¼Œä½†ä¸ä¿è¯æ•°æ®æ­£ç¡® åˆ†åŒºå®¹é”™æ€§ Partition Toleranceï¼šå³ä½¿èŠ‚ç‚¹ä¹‹é—´å‡ºç°äº†ä»»æ„æ•°é‡çš„æ¶ˆæ¯ä¸¢å¤±æˆ–è€…é«˜å»¶è¿Ÿï¼Œç³»ç»Ÿä»èƒ½æ­£å¸¸è¿è¡Œ å°±æ˜¯è¯´ç½‘ç»œä¸¢åŒ…æˆ–å»¶è¿Ÿä¼šå¯¼è‡´ç³»ç»Ÿè¢«åˆ†æˆå¤šä¸ª Partitionï¼Œç³»ç»Ÿèƒ½å¤Ÿå®¹å¿è¿™ç§æƒ…å†µ ä¸ºäº†ä¿è¯åˆ†åŒºå®¹é”™æ€§ Pï¼Œè€ƒè™‘å½“åˆ†å¸ƒå¼ç³»ç»Ÿå› ä¸ºç½‘ç»œé—®é¢˜è¢«å‰²è£‚æˆå¤šä¸ªåˆ†åŒºæ—¶ï¼Œæ¯ä¸ªåˆ†åŒºåªæœ‰å¦‚ä¸‹ä¸¤ç§é€‰æ‹©ï¼ŒA è·Ÿ C å¿…é¡»ç‰ºç‰²æ‰å…¶ä¸­ä¹‹ä¸€ï¼š å–æ¶ˆæ“ä½œå¹¶æ‹’ç»æä¾›æœåŠ¡ï¼Œè¿™é™ä½äº†å¯ç”¨æ€§ï¼Œä½†æ˜¯èƒ½ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ ç»§ç»­å¤„ç†è¯·æ±‚ï¼Œè¿™ç¡®ä¿äº†å¯ç”¨æ€§ï¼Œä½†æ˜¯æ•°æ®ä¸€è‡´æ€§å°±æ— æ³•ä¿è¯äº† å¦‚æœç³»ç»Ÿçš„å¤šä¸ªåˆ†åŒºéƒ½åœ¨åŒæ—¶æä¾›æœåŠ¡ï¼Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´å¹¶ä¸”å­˜åœ¨å†²çªæ— æ³•åˆå¹¶ï¼Œè¿™å°±è¢«ç§°ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„ã€Œè„‘è£‚ã€ï¼Œæ˜¾ç„¶ä»»ä½•åˆ†å¸ƒå¼ç³»ç»Ÿéƒ½ä¸ä¼šå¸Œæœ›å‘ç”Ÿã€Œè„‘è£‚ã€ã€‚ å› ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿä¸å•æœºç³»ç»Ÿä¸åŒï¼Œå®ƒæ¶‰åŠåˆ°å¤šèŠ‚ç‚¹é—´çš„ç½‘ç»œé€šè®¯å’Œäº¤äº’ï¼Œä½†æ˜¯åªè¦æœ‰ç½‘ç»œäº¤äº’å°±ä¸€å®šä¼šæœ‰å»¶è¿Ÿå’Œæ•°æ®ä¸¢å¤±ï¼ŒèŠ‚ç‚¹é—´çš„åˆ†åŒºæ•…éšœæ˜¯å¾ˆæœ‰å¯èƒ½å‘ç”Ÿçš„ã€‚å› æ­¤ä¸ºäº†æ­£å¸¸è¿è¡Œï¼ŒP æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿå¿…é¡»ä¿è¯çš„ç‰¹æ€§ï¼Œåœ¨å‡ºç°åˆ†åŒºæ•…éšœæ—¶ï¼Œä¸ºäº† P åªèƒ½ç‰ºç‰²æ‰ A æˆ–è€… Cã€‚ å·¥ç¨‹ä¸Šæ˜¯è¦ AP è¿˜æ˜¯ CPï¼Œå¾—è§†æƒ…å†µè€Œå®šï¼š Etcd/Zookeeper/Consul: å®ƒä»¬é€šå¸¸è¢«ç”¨äºå­˜å‚¨ç³»ç»Ÿè¿è¡Œçš„å…³é”®å…ƒä¿¡æ¯ï¼Œæ¯æ¬¡è¯»ï¼Œéƒ½è¦èƒ½è¯»å–åˆ°æœ€æ–°æ•°æ®ã€‚å› æ­¤å®ƒä»¬å®ç°äº† CPï¼Œç‰ºç‰²äº† A DynamoDB/Cassandra/MongoDBï¼šä¸è¦æ±‚æ•°æ®ä¸€è‡´æ€§ï¼Œä¸€æ®µæ—¶é—´å†…ç”¨æ—§çš„ç¼“å­˜é—®é¢˜ä¹Ÿä¸å¤§ï¼Œä½†æ˜¯è¦æ±‚å¯ç”¨æ€§ï¼Œå› æ­¤åº”è¯¥å®ç° APï¼Œç‰ºç‰²æ‰ C æ•°æ®ä¸€è‡´æ€§æ¨¡å‹åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¤šå‰¯æœ¬æ•°æ®ä¸Šçš„ä¸€ç»„è¯»å†™ç­–ç•¥ï¼Œè¢«ç§°ä¸ºã€Œï¼ˆæ•°æ®ï¼‰ä¸€è‡´æ€§æ¨¡å‹ Consistency Modelã€ã€‚ä¸€è‡´æ€§æ¨¡å‹æ•°é‡å¾ˆå¤šï¼Œè®©äººéš¾ä»¥åˆ†è¾¨ã€‚ä¸ºäº†ä¾¿äºç†è§£ï¼Œæˆ‘ä»¬å…ˆä»çŠ¶æ€è§†è§’å‡ºå‘åŒºåˆ†ä¸€ä¸‹å¼ºä¸€è‡´ä¸å¼±ä¸€è‡´çš„æ¦‚å¿µï¼Œåœ¨è¿™ä¸ªçš„åŸºç¡€ä¸Šå†ä»æ“ä½œè§†è§’å»ç†è§£è¿™ä¼—å¤šçš„ä¸€è‡´æ€§æ¨¡å‹ã€‚ 1. çŠ¶æ€è§†è§’ - å¼ºä¸€è‡´ä¸å¼±ä¸€è‡´æˆ‘ä»¬é¦–å…ˆæŠŠæ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿçœ‹ä½œä¸€ä¸ªç™½ç›’ï¼Œä»çŠ¶æ€è§†è§’çœ‹ï¼Œä»»ä½•å˜æ›´æ“ä½œåï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿçš„å¤šä¸ªæ•°æ®å‰¯æœ¬åªæœ‰å¦‚ä¸‹ä¸‰ç§çŠ¶æ€ï¼š åœ¨æŸäº›æ¡ä»¶ä¸‹ï¼Œå„å‰¯æœ¬çŠ¶æ€ä¸ä¸€è‡´çš„ç°è±¡åªæ˜¯æš‚æ—¶çš„ï¼Œåç»­è¿˜ä¼šè½¬æ¢åˆ°ä¸€è‡´çš„çŠ¶æ€ï¼Œè¿™è¢«ç§°ä¸ºã€Œå¼±ä¸€è‡´ã€ï¼› è¿™é€šå¸¸æ˜¯ä½¿ç”¨å¼‚æ­¥å¤åˆ¶æ¥åŒæ­¥å„å‰¯æœ¬çš„çŠ¶æ€ã€‚ ç›¸å¯¹çš„è¯´ï¼Œå¦‚æœç³»ç»Ÿå„å‰¯æœ¬ä¸å­˜åœ¨ã€Œä¸ä¸€è‡´ã€è¿™ç§çŠ¶æ€ï¼Œåªè¦å˜æ›´æ“ä½œæˆåŠŸæ•°æ®å°±ä¸€å®šå®Œå…¨ä¸€è‡´ï¼Œé‚£å®ƒå°±è¢«ç§°ä¸ºã€Œå¼ºä¸€è‡´ã€ã€‚ è¿™è¦æ±‚æ‰€æœ‰å‰¯æœ¬ä¹‹é—´çš„æ•°æ®æ›´æ–°å¿…é¡»å®Œå…¨åŒæ­¥ï¼Œå°±å¿…é¡»ä½¿ç”¨å…¨åŒæ­¥å¤åˆ¶ã€‚ æ°¸è¿œä¸ä¼šä¸€è‡´ï¼šè¿™åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å°±æ˜¯ bug äº†ï¼Œä¹Ÿè¢«ç§°ä¸ºã€Œè„‘è£‚ã€ã€‚ ä¸Šé¢æè¿°çš„æ˜¯æ•´ä¸ªç³»ç»Ÿçš„å®¢è§‚ã€å®é™…çŠ¶æ€ï¼Œä½†å¯¹äºç»å¤§éƒ¨åˆ†ç”¨æˆ·è€Œè¨€åˆ†å¸ƒå¼ç³»ç»Ÿæ›´å¤šçš„æ˜¯ä¸€ä¸ªé»‘ç›’ï¼Œå› æ­¤æ›´æµè¡Œçš„æ˜¯åŸºäºã€Œé»‘ç›’ã€çš„åˆ†ç±»æ–¹å¼ï¼Œå®ƒæ ¹æ®ç³»ç»Ÿçš„å¯¹å¤–çŠ¶æ€å°†ç³»ç»Ÿåˆ†æˆä¸¤ç§ç±»å‹ï¼š å¼ºä¸€è‡´ï¼šæŒ‡å¯¹ç³»ç»Ÿçš„ä»»ä½•èŠ‚ç‚¹/è¿›ç¨‹ï¼Œå†™æ“ä½œå®Œæˆåï¼Œä»»ä½•ç”¨æˆ·å¯¹ä»»ä½•èŠ‚ç‚¹çš„åç»­è®¿é—®éƒ½èƒ½è¯»åˆ°æ–°çš„å€¼ã€‚å°±å¥½åƒç³»ç»Ÿåªå­˜åœ¨ä¸€ä¸ªå‰¯æœ¬ä¸€æ ·ã€‚ æœ€å¸¸ç”¨ç®—æ³•æ˜¯ Raft/Paxosï¼Œå®ƒä»¬çš„å†™æ“ä½œåªè¦æ±‚è¶…è¿‡åŠæ•°èŠ‚ç‚¹å†™å…¥æˆåŠŸï¼Œå› æ­¤å†™å…¥å®Œæˆæ—¶ï¼Œå†…éƒ¨çŠ¶æ€å®é™…æ˜¯ä¸ä¸€è‡´çš„ï¼Œä½†æ˜¯å¯¹å®ƒè¿›è¡Œè¯»å†™ï¼Œæ•ˆæœè·Ÿã€Œå…¨åŒæ­¥å¤åˆ¶ã€æ²¡æœ‰åŒºåˆ«ã€‚ å¼±ä¸€è‡´ï¼šæŒ‡å¯¹ç³»ç»Ÿçš„ä»»ä½•èŠ‚ç‚¹/è¿›ç¨‹ï¼Œå†™æ“ä½œå®Œæˆåï¼Œåç»­çš„ä»»ä½•è®¿é—®å¯èƒ½ä¼šæ‹¿åˆ°çš„å€¼æ˜¯ä¸ç¡®å®šçš„ï¼Œä½†ç»è¿‡ä¸€æ®µæ—¶é—´åï¼Œåç»­çš„ä»»ä½•è®¿é—®éƒ½èƒ½è¯»åˆ°æ–°çš„å€¼ã€‚ å¼±ä¸€è‡´æ˜¯éå¸¸æ¨¡ç³Šçš„å®šä¹‰ã€‚å¦‚æœæˆ‘ä»¬æŠŠæœ€ç»ˆæ‰€æœ‰ç”¨æˆ·éƒ½èƒ½è®¿é—®åˆ°æ–°çš„å€¼è¢«ç§°ä¸ºã€Œç³»ç»Ÿæ”¶æ•›ã€ï¼Œ ç³»ç»Ÿæ”¶æ•›çš„ç”¨æ—¶å¯ä»¥æœ‰æ˜ç¡®è¾¹ç•Œï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰ã€‚ç³»ç»Ÿæ”¶æ•›å‰çš„è®¿é—®è¡Œä¸ºå¯ä»¥æœ‰æ˜ç¡®è§„èŒƒï¼Œä¹Ÿå¯ä»¥ä¸å­˜åœ¨è§„èŒƒã€‚ä¸€åˆ‡éƒ½çœ‹å…·ä½“ç³»ç»Ÿçš„å®ç°ã€‚ å¦‚æœç³»ç»Ÿèƒ½å¤Ÿåœ¨æœ‰é™æ—¶é—´å†…æ”¶æ•›ï¼Œé‚£å®ƒå°±æ˜¯ã€Œæœ€ç»ˆä¸€è‡´ã€ï¼Œå¦åˆ™å¯ä»¥è®¤ä¸ºå®ƒæ˜¯ã€Œä¸ä¸€è‡´ã€ã€‚ ä¸ºäº†å®é™…éœ€è¦ï¼Œæ•°æ®åº“ä¸“å®¶å¯¹ç³»ç»Ÿæ”¶æ•›ä¹‹å‰çš„è¯»å†™æ•ˆæœè¿›è¡Œå„ç§é™åˆ¶ï¼Œå¯¹ç³»ç»Ÿçš„æ”¶æ•›æ—¶é—´è¿›è¡Œå„ç§é™åˆ¶ï¼Œå¾—åˆ°äº†è®¸å¤šä¸€è‡´æ€§æ¨¡å‹ã€‚ 2. æ“ä½œè§†è§’ - å¤šç§ä¸€è‡´æ€§æ¨¡å‹ä»æ¯ä¸ªå®¢æˆ·ç«¯çš„æ“ä½œè§’åº¦çœ‹ï¼Œæœ‰å››ç§ä¸€è‡´æ€§æ¨¡å‹ï¼š å†™åè¯»ä¸€è‡´æ€§ Read after Write Consistencyï¼šä¹Ÿè¢«ç§°ä½œã€Œè¯»è‡ªå·±æ‰€å†™ä¸€è‡´æ€§ã€ï¼Œå³è‡ªå·±å†™å®Œæ•°æ®ç‰ˆæœ¬ N åï¼Œåç»­è¯»åˆ°çš„ç‰ˆæœ¬ä¸€å®šä¸å°äºç‰ˆæœ¬ Nã€‚ å®ƒè§£å†³çš„é—®é¢˜ï¼šA å‘äº†ä¸ªæŠ–éŸ³è§†é¢‘ï¼Œåˆ·æ–°é¡µé¢åå´è«åå…¶å¦™æ¶ˆå¤±äº†ï¼ˆæ—§ç‰ˆæœ¬ï¼‰ï¼Œå‡ åˆ†é’Ÿåæ‰é‡æ–°åˆ·å‡ºæ¥ã€‚ å®ç°æ–¹å¼ä¹‹ä¸€ï¼šä¸ºå†™å…¥è€…å•ç‹¬æ·»åŠ ä¸€ä¸ªè¯»å–è§„åˆ™ï¼Œä»–çš„è¯»éƒ½ç”±å·²æ›´æ–°å…¶å†™å…¥æ•°æ®çš„å‰¯æœ¬æ¥å¤„ç†ã€‚ å•è°ƒè¯»ä¸€è‡´æ€§ Monotonic Read Consistencyï¼šä¿è¯å¤šä¸ªè¯»æ“ä½œçš„é¡ºåºï¼Œå³å®¢æˆ·ç«¯ä¸€æ—¦è¯»åˆ°æŸä¸ªæ•°æ®ç‰ˆæœ¬ Nï¼Œåç»­ä¸ä¼šè¯»åˆ°æ¯” N æ›´ä½çš„ç‰ˆæœ¬ã€‚ å®ƒè§£å†³çš„é—®é¢˜æ˜¯ï¼šA åˆ é™¤äº†ä¸€ä¸ªæŠ–éŸ³è§†é¢‘ï¼Œå¯å¤šæ¬¡åˆ·æ–°ï¼Œå¶å°”åˆ·ä¸åˆ°è§†é¢‘ï¼Œå¶å°”åˆèƒ½åˆ·åˆ°è¢«åˆ é™¤è§†é¢‘ï¼ˆæ—§ç‰ˆæœ¬ï¼‰ï¼Œå‡ åˆ†é’Ÿåæ‰å½»åº•è¢«åˆ é™¤ã€‚ å®ç°æ–¹å¼ä¹‹ä¸€ï¼šä¸ºæ¯ä¸ªç”¨æˆ·çš„è¯»éƒ½åˆ›å»ºä¸€ä¸ªå‰¯æœ¬æ˜ å°„ï¼Œåç»­çš„è¯»éƒ½ç”±ä¸€ä¸ªå›ºå®šçš„å‰¯æœ¬å¤„ç†ï¼Œé¿å…éšæœºåˆ‡æ¢å‰¯æœ¬è€Œè¯»åˆ°æ›´è€çš„å€¼ã€‚ å•è°ƒå†™ä¸€è‡´æ€§ Monotonic Write Consistencyï¼šä¿è¯å¤šä¸ªå†™æ“ä½œçš„é¡ºåºï¼Œå³å®¢æˆ·ç«¯å¯¹åŒä¸€æ•°æ®çš„ä¸¤æ¬¡å†™å…¥æ“ä½œï¼Œä¸€å®šæŒ‰å…¶è¢«æäº¤çš„é¡ºåºè¢«æ‰§è¡Œã€‚ è¯»åå†™ä¸€è‡´æ€§ Write after Read Consistencyï¼šè¯»åå†™ä¸€è‡´æ€§ï¼Œä¿è¯ä¸€ä¸ªå®¢æˆ·ç«¯è¯»åˆ°æ•°æ®ç‰ˆæœ¬ N åï¼ˆå¯èƒ½æ˜¯å…¶ä»–å®¢æˆ·ç«¯å†™å…¥çš„ï¼‰ï¼Œéšåå¯¹åŒä¸€æ•°æ®çš„å†™æ“ä½œå¿…é¡»è¦åœ¨ç‰ˆæœ¬å·å¤§äºç­‰äº N çš„å‰¯æœ¬ä¸Šæ‰§è¡Œã€‚ ä¸Šè¿°å››ä¸ªä¸€è‡´æ€§æ¨¡å‹éƒ½åªä»æ¯ä¸ªå®¢æˆ·ç«¯è‡ªèº«çš„è§’åº¦å®šä¹‰è§„åˆ™ï¼Œæ¯”è¾ƒç‰‡é¢ï¼Œå› æ­¤å®ƒä»¬éƒ½æ˜¯ã€Œå¼±ä¸€è‡´æ¨¡å‹ã€ã€‚ è€Œä¸è€ƒè™‘å®¢æˆ·ç«¯ï¼Œç›´æ¥ä»æ‰€æœ‰æ•°æ®åº“ç”¨æˆ·çš„æ“ä½œè§†è§’çœ‹ï¼Œæœ‰å¦‚ä¸‹å‡ ç§ä¸€è‡´æ€§æ¨¡å‹ï¼š çº¿æ€§ä¸€è‡´æ€§ Linearizabilityï¼šçº¿æ€§ä¸€è‡´æ€§åˆ©ç”¨äº†äº‹ä»¶çš„æäº¤é¡ºåºï¼Œå®ƒä¿è¯ä»»ä½•è¯»æ“ä½œå¾—åˆ°çš„æ•°æ®ï¼Œå…¶é¡ºåºè·Ÿè¯»/å†™äº‹ä»¶çš„æäº¤é¡ºåºä¸€è‡´ã€‚ ç®€å•çš„è¯´å®ƒè¦æ±‚æ•´ä¸ªç³»ç»Ÿè¡¨ç°å¾—åƒåªå­˜åœ¨ä¸€ä¸ªå‰¯æœ¬ï¼Œæ‰€æœ‰æ“ä½œçš„æ‰§è¡Œç»“æœå°±è·Ÿè¿™äº›äº‹ä»¶æŒ‰æäº¤é¡ºåºå®Œå…¨ä¸²è¡Œæ‰§è¡Œä¸€æ ·ã€‚è¿™å®é™…ä¹Ÿæ˜¯åœ¨è¯´æ‰€æœ‰å¹¶å‘äº‹ä»¶éƒ½æ˜¯åŸå­çš„ï¼Œä¸€æ—¦äº’ç›¸ä¹‹é—´å­˜åœ¨å†²çªï¼Œå°±ä¸€å®šå¾—æŒ‰é¡ºåºæ‰§è¡Œï¼Œå› æ­¤ä¹Ÿæœ‰äººç§°å®ƒä¸ºã€ŒåŸå­ä¸€è‡´æ€§ã€ã€‚ çº¿æ€§ä¸€è‡´æ€§ï¼Œå®Œå…¨ç­‰ä»·äºç³»ç»Ÿå¯¹å¤–çŠ¶æ€çš„ã€Œå¼ºä¸€è‡´æ€§ã€ çº¿æ€§ä¸€è‡´æ€§çš„ç³»ç»Ÿæ˜¯å®Œå…¨ç¡®å®šæ€§çš„ å®ç°æ–¹å¼ï¼šéœ€è¦ä¸€ä¸ªæ‰€æœ‰èŠ‚ç‚¹éƒ½ä¸€è‡´çš„ã€Œå…¨å±€æ—¶é’Ÿã€ï¼Œè¿™æ ·æ‰å¯ä»¥å¯¹æ‰€æœ‰äº‹ä»¶è¿›è¡Œå…¨å±€æ’åºã€‚ å¤§å¤šæ•°åˆ†å¸ƒå¼æ•°æ®åº“å¦‚ TiDB/Etcd éƒ½æ˜¯é€šè¿‡ NTP ç­‰åè®®è¿›è¡Œå•ç‚¹æˆæ—¶ä¸åŒæ­¥å®ç°çš„å…¨å±€æ—¶é’Ÿã€‚ æœ‰å…¨çƒåŒ–éƒ¨ç½²éœ€è¦çš„ Google Spanner æ˜¯ä½¿ç”¨ GPS + åŸå­é’Ÿå®ç°çš„å…¨å±€æ—¶é’Ÿ TrueTimeï¼Œå…¨å±€è¯¯å·®å¯ä»¥æ§åˆ¶åœ¨ 7ms ä»¥å†…ã€‚ å±€é™æ€§ï¼šæ ¹æ®çˆ±å› æ–¯å¦ç›¸å¯¹è®ºï¼Œã€Œæ—¶é—´æ˜¯ç›¸å¯¹çš„ã€ï¼Œå®é™…ä¸Šå¹¶ä¸å­˜åœ¨ç»å¯¹çš„æ—¶é—´ï¼Œå› æ­¤çº¿æ€§ä¸€è‡´æ€§åªåœ¨ç»å…¸ç‰©ç†å­¦èŒƒå›´å†…é€‚ç”¨ã€‚ é¡ºåºä¸€è‡´æ€§ Sequentially Consistentï¼š é¡ºåºä¸€è‡´æ€§æœ€æ—©æ˜¯ Leslie Lamport ç”¨æ¥æè¿°å¤šæ ¸ CPU çš„è¡Œä¸ºçš„ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿé¢†åŸŸç”¨å¾—è¾ƒå°‘ã€‚ é¡ºåºä¸€è‡´æ€§çš„è¦æ±‚æœ‰ä¸¤ç‚¹ï¼š ä»å•ä¸ªè¿›ç¨‹ï¼ˆå‰¯æœ¬ï¼‰çš„è§’åº¦çœ‹ï¼Œæ‰€æœ‰æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºè·Ÿä»£ç é€»è¾‘çš„é¡ºåºå®Œå…¨ä¸€è‡´ã€‚ ä»æ‰€æœ‰çš„å¤„ç†å™¨ï¼ˆæ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼‰è§’åº¦çœ‹ï¼Œå†™æ“ä½œä¸å¿…ç«‹å³å¯¹æ‰€æœ‰ç”¨æˆ·å¯è§ï¼Œä½†æ˜¯æ‰€æœ‰å‰¯æœ¬å¿…é¡»ä»¥ç›¸åŒçš„é¡ºåºæ¥æ”¶è¿™äº›å†™æ“ä½œã€‚ é¡ºåºä¸€è‡´æ€§å’Œçº¿æ€§ä¸€è‡´æ€§éƒ½æ˜¯è¦æ‰¾åˆ°ä¸€ä¸ªæ»¡è¶³ã€Œå†™åè¯»ã€çš„ä¸€ç»„æ“ä½œå†å²ï¼Œå·®å¼‚åœ¨äºçº¿æ€§ä¸€è‡´æ€§è¦æ±‚ä¸¥æ ¼çš„æ—¶é—´åºï¼Œè€Œé¡ºåºä¸€è‡´æ€§åªè¦æ±‚æ»¡è¶³ä»£ç çš„é€»è¾‘é¡ºåºï¼Œè€Œå…¶ä»–ä»£ç é€»è¾‘æœªå®šä¹‰çš„äº‹ä»¶é¡ºåºï¼ˆæ¯”å¦‚å¤šå‰¯æœ¬ä¸Šå„äº‹ä»¶ä¹‹é—´çš„é¡ºåºï¼‰ï¼Œå…·ä½“æ˜¯ä»€ä¹ˆæ ·çš„é¡ºåºæ— æ‰€è°“ï¼Œåªè¦æ‰€æœ‰å‰¯æœ¬çœ‹åˆ°çš„äº‹ä»¶é¡ºåºéƒ½ç›¸åŒå°±è¡Œã€‚ é¡ºåºä¸€è‡´æ€§å¹¶ä¸èƒ½æä¾›ã€Œç¡®å®šæ€§ã€ï¼Œç›¸åŒçš„ä¸¤æ¬¡æ“ä½œä»ç„¶å¯èƒ½å¾—åˆ°ä¸åŒçš„äº‹ä»¶é¡ºåºã€‚ å®ç°æ–¹å¼ï¼šå› ä¸ºä¸è¦æ±‚ä¸¥æ ¼çš„å…¨å±€æ—¶é—´åºï¼Œå®ƒå°±ä¸éœ€è¦ä¸€ä¸ªå…¨å±€æ—¶é’Ÿäº†ï¼Œä½†å®é™…ä¸Šä¸ºäº†æ»¡è¶³å…¨å±€çš„ç¡®å®šæ€§ï¼Œä»ç„¶éœ€è¦ä¸€äº›å¤æ‚çš„æ“ä½œã€‚ å› æœä¸€è‡´æ€§ Causal Consistencyï¼šçº¿æ€§ä¸€è‡´æ€§çš„å…¨å±€æ—¶é’Ÿæœ‰å…¶å±€é™æ€§ï¼Œè€Œå› æœä¸€è‡´æ€§åŸºäºå†™äº‹ä»¶çš„ã€Œååºå…³ç³»ã€æå‡ºäº†ã€Œé€»è¾‘æ—¶é’Ÿã€çš„æ¦‚å¿µï¼Œå¹¶ä¿è¯è¯»é¡ºåºä¸é€»è¾‘æ—¶é’Ÿä¸Šçš„å†™äº‹ä»¶é¡ºåºä¸€è‡´ã€‚ å†™äº‹ä»¶çš„ã€Œååºå…³ç³»ã€å…³ç³»æ˜¯æŒ‡ï¼Œè‡³å°‘éƒ¨åˆ†äº‹ä»¶ï¼ˆæ¯”å¦‚ä¸€ä¸ªèŠ‚ç‚¹å†…éƒ¨çš„äº‹ä»¶ï¼‰æ˜¯å¯ä»¥ä½¿ç”¨æœ¬åœ°æ—¶é’Ÿç›´æ¥æ’åºçš„ï¼Œè€ŒèŠ‚ç‚¹ä¹‹é—´å‘ç”Ÿé€šè®¯æ—¶ï¼Œæ¥æ”¶æ–¹çš„äº‹ä»¶ä¸€å®šæ™šäºè°ƒç”¨æ–¹çš„äº‹ä»¶ã€‚åŸºäºè¿™ä¸€ç‚¹å¯ä»¥å®ç°ä¸€ä¸ªã€Œé€»è¾‘æ—¶é’Ÿã€ï¼Œä½†é€»è¾‘æ—¶é’Ÿçš„ç¼ºç‚¹åœ¨äºï¼Œå¦‚æœæŸä¸¤ä¸ªäº‹ä»¶ä¸å­˜åœ¨ç›¸å…³æ€§ï¼Œé‚£é€»è¾‘æ—¶é’Ÿç»™å‡ºçš„é¡ºåºå°±æ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚ å¤šæ•°è§‚ç‚¹è®¤ä¸ºï¼Œå› æœä¸€è‡´æ€§å¼±äºçº¿æ€§ä¸€è‡´æ€§ï¼Œä½†åœ¨å¹¶å‘æ€§èƒ½ä¸Šå…·æœ‰ä¼˜åŠ¿ï¼Œä¹Ÿè¶³ä»¥å¤„ç†å¤šæ•°çš„å¼‚å¸¸ç°è±¡ï¼Œæ‰€ä»¥å› æœä¸€è‡´æ€§ä¹Ÿåœ¨å·¥ä¸šç•Œå¾—åˆ°äº†åº”ç”¨ã€‚ CockroachDB å’Œ YugabyteDB éƒ½åœ¨è®¾è®¡ä¸­é‡‡ç”¨äº†é€»è¾‘æ··åˆæ—¶é’Ÿï¼ˆHybrid Logical Clocksï¼‰ï¼Œè¿™ä¸ªæ–¹æ¡ˆæºè‡ª Lamport çš„é€»è¾‘æ—¶é’Ÿï¼Œä¹Ÿå–å¾—äº†ä¸é”™çš„æ•ˆæœ å‰ç¼€ä¸€è‡´æ€§ Consistent Prefixï¼šå‰¯æœ¬ä¹‹é—´çš„åŒæ­¥è¿‡ç¨‹ä¸­ï¼Œä¼šå­˜åœ¨ä¸€äº›å‰¯æœ¬æ¥æ”¶æ•°æ®çš„é¡ºåºå¹¶ä¸ä¸€è‡´ã€‚ã€Œå‰ç¼€ä¸€è‡´æ€§ã€æ˜¯è¯´æ‰€æœ‰ç”¨æˆ·è¯»åˆ°çš„æ•°æ®é¡ºåºçš„å‰ç¼€æ°¸è¿œæ˜¯ä¸€è‡´çš„ã€‚ ã€Œå‰ç¼€ã€æ˜¯æŒ‡ç¨‹åºåœ¨æ‰§è¡Œå†™æ“ä½œæ—¶ï¼Œéœ€è¦æ˜¾å¼å£°æ˜å…¶ã€Œå‰ç¼€ã€äº‹ä»¶ï¼Œè¿™æ ·æ¯ä¸ªäº‹ä»¶å°±éƒ½å­˜","date":"2022-08-07","objectID":"/posts/consistency-and-consensus-algorithm/:1:2","series":null,"tags":["å…±è¯†","ä¸€è‡´æ€§","åˆ†å¸ƒå¼","æ•°æ®åº“","åŒºå—é“¾"],"title":"åˆ†å¸ƒå¼æ•°æ®åº“çš„ä¸€è‡´æ€§é—®é¢˜ä¸å…±è¯†ç®—æ³•","uri":"/posts/consistency-and-consensus-algorithm/#2-æ“ä½œè§†è§’---å¤šç§ä¸€è‡´æ€§æ¨¡å‹"},{"categories":["tech"],"content":" äºŒã€åˆ†å¸ƒå¼ç³»ç»Ÿçš„ BASE ä¸æœ€ç»ˆä¸€è‡´æ€§BASE ç†è®ºï¼š åŸºæœ¬å¯ç”¨ Basically Availableï¼šå½“åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°ä¸å¯é¢„çŸ¥çš„æ•…éšœæ—¶ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†åŠŸèƒ½çš„å¯ç”¨æ€§ï¼Œä¿éšœæ ¸å¿ƒåŠŸèƒ½çš„å¯ç”¨æ€§ å››ç§å®ç°åŸºæœ¬å¯ç”¨çš„æ‰‹æ®µï¼šæµé‡å‰Šå³°ã€å»¶è¿Ÿå“åº”ã€ä½“éªŒé™çº§ã€è¿‡è½½ä¿æŠ¤ è½¯çŠ¶æ€ Soft stateï¼šåœ¨æŸ”æ€§äº‹åŠ¡ä¸­ï¼Œå…è®¸ç³»ç»Ÿå­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œä¸”è¿™ä¸ªä¸­é—´çŠ¶æ€ä¸ä¼šå½±å“ç³»ç»Ÿæ•´ä½“å¯ç”¨æ€§ã€‚æ¯”å¦‚ï¼Œæ•°æ®åº“è¯»å†™åˆ†ç¦»ï¼Œå†™åº“åŒæ­¥åˆ°è¯»åº“ï¼ˆä¸»åº“åŒæ­¥åˆ°ä»åº“ï¼‰ä¼šæœ‰ä¸€ä¸ªå»¶æ—¶ï¼Œå…¶å®å°±æ˜¯ä¸€ç§æŸ”æ€§çŠ¶æ€ã€‚ æœ€ç»ˆä¸€è‡´æ€§ Eventually consistentï¼šå‰é¢å·²ç»è¯´å¾—å¾ˆè¯¦ç»†äº†ï¼Œå®ƒæŒ‡å¯¹ç³»ç»Ÿçš„ä»»ä½•èŠ‚ç‚¹/è¿›ç¨‹ï¼Œ å†™æ“ä½œå®Œæˆåï¼Œåç»­çš„ä»»ä½•è®¿é—®å¯èƒ½ä¼šæ‹¿åˆ°çš„å€¼æ˜¯ä¸ç¡®å®šçš„ï¼Œä½†ç»è¿‡æœ‰é™çš„ä¸€æ®µæ—¶é—´åï¼Œåç»­çš„ä»»ä½•è®¿é—®éƒ½èƒ½è¯»åˆ°æ–°çš„å€¼ã€‚ ACID ä¸ BASE å®è´¨ä¸Šæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿå®ç°ä¸­çš„çš„ä¸¤ä¸ªæç«¯ï¼š ACID ç†è®ºå°±å¦‚å®ƒçš„å«ä¹‰ã€Œé…¸ã€ä¸€æ ·ï¼Œæ˜¯ CAP åŸåˆ™ä¸­ä¸€è‡´æ€§çš„è¾¹ç•Œâ€”â€”æœ€å¼ºçš„ä¸€è‡´æ€§ï¼Œæ˜¯ç‰ºç‰²æ‰ A åè¾¾åˆ° CP çš„æè‡´ã€‚ BASE ç¿»è¯‘è¿‡æ¥å°±æ˜¯ã€Œç¢±ã€ï¼Œå®ƒæ˜¯ CAP åŸåˆ™ä¸­å¯ç”¨æ€§çš„è¾¹ç•Œâ€”â€”æœ€é«˜çš„å¯ç”¨æ€§ï¼Œæœ€å¼±çš„ä¸€è‡´æ€§ï¼Œé€šè¿‡ç‰ºç‰²æ‰ C æ¥è¾¾åˆ° AP çš„æè‡´ã€‚ æ ¹æ® CAP ç†è®ºï¼Œå¦‚æœåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å®ç°äº†ä¸€è‡´æ€§ï¼Œå¯ç”¨æ€§å¿…ç„¶å—åˆ°å½±å“ã€‚æ¯”å¦‚ï¼Œå¦‚æœå‡ºç°ä¸€ä¸ªèŠ‚ç‚¹æ•…éšœï¼Œåˆ™æ•´ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡çš„æ‰§è¡Œéƒ½æ˜¯å¤±è´¥çš„ã€‚å®é™…ä¸Šï¼Œç»å¤§éƒ¨åˆ†åœºæ™¯å¯¹ä¸€è‡´æ€§è¦æ±‚æ²¡é‚£ä¹ˆé«˜ï¼ŒçŸ­æš‚çš„ä¸ä¸€è‡´æ˜¯èƒ½æ¥å—çš„ï¼Œå¦å¤–ï¼Œä¹ŸåŸºäºå¯ç”¨æ€§å’Œå¹¶å‘æ€§èƒ½çš„è€ƒè™‘ï¼Œå»ºè®®åœ¨å¼€å‘å®ç°åˆ†å¸ƒå¼ç³»ç»Ÿæ—¶ï¼Œå¦‚æœä¸æ˜¯å¿…é¡»ï¼Œå°½é‡ä¸è¦å®ç°äº‹åŠ¡ï¼Œå¯ä»¥è€ƒè™‘é‡‡ç”¨æœ€ç»ˆä¸€è‡´æ€§ã€‚ æœ€ç»ˆä¸€è‡´æ€§çš„å®ç°æ‰‹æ®µï¼š è¯»æ—¶ä¿®å¤ï¼šåœ¨è¯»å–æ•°æ®æ—¶ï¼Œæ£€æµ‹æ•°æ®çš„ä¸ä¸€è‡´ï¼Œè¿›è¡Œä¿®å¤ å†™æ—¶ä¿®å¤ï¼šåœ¨å†™å…¥æ•°æ®æ—¶ï¼Œæ£€æµ‹æ•°æ®çš„ä¸ä¸€è‡´ï¼Œè¿›è¡Œä¿®å¤ å¼‚æ­¥ä¿®å¤ï¼šè¿™ä¸ªæ˜¯æœ€å¸¸ç”¨çš„æ–¹å¼ï¼Œé€šè¿‡å®šæ—¶å¯¹è´¦ï¼Œæ£€æµ‹å‰¯æœ¬æ•°æ®çš„ä¸€è‡´æ€§å¹¶ä¿®å¤ åœ¨å®ç°æœ€ç»ˆä¸€è‡´æ€§çš„æ—¶å€™ï¼Œè¿˜æ¨èåŒæ—¶å®ç°è‡ªå®šä¹‰å†™ä¸€è‡´æ€§çº§åˆ«ï¼ˆæ¯”å¦‚ Allã€Quorumã€Oneã€Anyï¼‰ï¼Œè®¸å¤šåˆ†å¸ƒå¼æ•°æ®åº“çš„æœ€ç»ˆä¸€è‡´æ€§çº§åˆ«éƒ½æ˜¯å¯è°ƒçš„ã€‚ ä½†æ˜¯éšç€ TiDB ç­‰åˆ†å¸ƒå¼å…³ç³»æ•°æ®åº“çš„å…´èµ·ï¼Œåˆ†å¸ƒå¼é¢†åŸŸçš„ BASE ç†è®ºå®é™…ä¸Šæ­£åœ¨è¢« ACID èµ¶è¶…ï¼ŒACID ç„•å‘åˆä¸€æ˜¥äº†ã€‚ ","date":"2022-08-07","objectID":"/posts/consistency-and-consensus-algorithm/:2:0","series":null,"tags":["å…±è¯†","ä¸€è‡´æ€§","åˆ†å¸ƒå¼","æ•°æ®åº“","åŒºå—é“¾"],"title":"åˆ†å¸ƒå¼æ•°æ®åº“çš„ä¸€è‡´æ€§é—®é¢˜ä¸å…±è¯†ç®—æ³•","uri":"/posts/consistency-and-consensus-algorithm/#äºŒåˆ†å¸ƒå¼ç³»ç»Ÿçš„-base-ä¸æœ€ç»ˆä¸€è‡´æ€§"},{"categories":["tech"],"content":" ä¸‰ã€å…±è¯†ç®—æ³•å…±è¯†ç®—æ³•ï¼Œä¹Ÿè¢«ç§°ä¸ºä¸€è‡´æ€§åè®®ï¼Œæ˜¯æŒ‡åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´å¯¹æŸä¸ªææ¡ˆ Proposalï¼ˆä¾‹å¦‚å¤šä¸ªäº‹åŠ¡è¯·æ±‚ï¼Œå…ˆæ‰§è¡Œè°ï¼Ÿï¼‰è¾¾æˆä¸€è‡´çœ‹æ³•çš„ä¸€å¥—æµç¨‹ã€‚ ææ¡ˆçš„å«ä¹‰åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ååˆ†å®½æ³›ï¼Œå¦‚å¤šä¸ªäº‹ä»¶å‘ç”Ÿçš„é¡ºåºã€æŸä¸ªé”®å¯¹åº”çš„å€¼ã€è°æ˜¯ä¸»èŠ‚ç‚¹â€¦â€¦ç­‰ç­‰ã€‚å¯ä»¥è®¤ä¸ºä»»ä½•å¯ä»¥è¾¾æˆä¸€è‡´çš„ä¿¡æ¯éƒ½æ˜¯ä¸€ä¸ªææ¡ˆã€‚ å¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿæ¥è®²ï¼Œå„ä¸ªèŠ‚ç‚¹é€šå¸¸éƒ½æ˜¯ç›¸åŒçš„ç¡®å®šæ€§çŠ¶æ€æœºæ¨¡å‹ï¼ˆåˆç§°ä¸ºçŠ¶æ€æœºå¤åˆ¶é—®é¢˜ï¼ŒState-Machine Replicationï¼‰ï¼Œä»ç›¸åŒåˆå§‹çŠ¶æ€å¼€å§‹æ¥æ”¶ç›¸åŒé¡ºåºçš„æŒ‡ä»¤ï¼Œåˆ™å¯ä»¥ä¿è¯ç›¸åŒçš„ç»“æœçŠ¶æ€ã€‚å› æ­¤ï¼Œç³»ç»Ÿä¸­å¤šä¸ªèŠ‚ç‚¹æœ€å…³é”®çš„æ˜¯å¯¹å¤šä¸ªäº‹ä»¶çš„é¡ºåºè¿›è¡Œå…±è¯†ï¼Œå³æ’åºã€‚ å…±è¯†ç®—æ³•æ˜¯è¾¾æˆæ•°æ®ä¸€è‡´æ€§çš„ä¸€ç§æ‰‹æ®µï¼Œè€Œä¸”æ˜¯æ•°æ®å¼ºä¸€è‡´æ€§çš„å¿…è¦éå……åˆ†æ¡ä»¶ã€‚æ¯”å¦‚ç›´æ¥ä½¿ç”¨ Raft ç®—æ³•ï¼Œä½†æ˜¯å…è®¸è¯»å–é›†ç¾¤çš„ä»»ä½•èŠ‚ç‚¹ï¼Œåªèƒ½å¾—åˆ°æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ï¼Œè¿˜éœ€è¦å…¶ä»–æ‰‹æ®µæ‰èƒ½ç¡®ä¿å¼ºä¸€è‡´æ€§ã€‚ ","date":"2022-08-07","objectID":"/posts/consistency-and-consensus-algorithm/:3:0","series":null,"tags":["å…±è¯†","ä¸€è‡´æ€§","åˆ†å¸ƒå¼","æ•°æ®åº“","åŒºå—é“¾"],"title":"åˆ†å¸ƒå¼æ•°æ®åº“çš„ä¸€è‡´æ€§é—®é¢˜ä¸å…±è¯†ç®—æ³•","uri":"/posts/consistency-and-consensus-algorithm/#ä¸‰å…±è¯†ç®—æ³•"},{"categories":["tech"],"content":" æ‹œå åº­å°†å†›é—®é¢˜ä¸æ‹œå åº­å®¹é”™æ‹œå åº­é”™è¯¯æ˜¯ 1982 å¹´å…°ä¼¯ç‰¹åœ¨ã€Šæ‹œå åº­å°†å†›é—®é¢˜ã€‹ä¸­æå‡ºçš„ä¸€ä¸ªé”™è¯¯æ¨¡å‹ï¼Œæè¿°äº†åœ¨å°‘æ•°èŠ‚ç‚¹ä¸ä»…å­˜åœ¨æ•…éšœï¼Œè¿˜å­˜åœ¨æ¶æ„è¡Œä¸ºçš„åœºæ™¯ä¸‹ï¼Œèƒ½å¦è¾¾æˆå…±è¯†è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼Œè®ºæ–‡æè¿°å¦‚ä¸‹ï¼š 9 ä½æ‹œå åº­å°†å†›åˆ†åˆ«ç‡é¢†ä¸€æ”¯å†›é˜Ÿè¦å…±åŒå›´å›°ä¸€åº§åŸå¸‚ï¼Œå› ä¸ºè¿™åº§åŸå¸‚å¾ˆå¼ºå¤§ï¼Œå¦‚æœä¸åè°ƒç»Ÿä¸€å°†å†›ä»¬çš„è¡ŒåŠ¨ç­–ç•¥ï¼Œéƒ¨åˆ†å†›é˜Ÿè¿›æ”»ã€éƒ¨åˆ†å†›é˜Ÿæ’¤é€€ä¼šé€ æˆå›´å›°å¤±è´¥ï¼Œå› æ­¤å„ä½å°†å†›å¿…é¡»é€šè¿‡æŠ•ç¥¨æ¥è¾¾æˆä¸€è‡´ç­–ç•¥ï¼Œè¦ä¹ˆä¸€èµ·è¿›æ”»ï¼Œè¦ä¹ˆä¸€èµ·æ’¤é€€ã€‚ å› ä¸ºå„ä½å°†å†›åˆ†åˆ«å æ®åŸå¸‚çš„ä¸€è§’ï¼Œä»–ä»¬åªèƒ½é€šè¿‡ä¿¡ä½¿äº’ç›¸è”ç³»ã€‚åœ¨åè°ƒè¿‡ç¨‹ä¸­æ¯ä½å°†å†›éƒ½å°†è‡ªå·±æŠ•ç¥¨ã€Œè¿›æ”»ã€è¿˜æ˜¯ã€Œæ’¤é€€ã€çš„æ¶ˆæ¯é€šè¿‡ä¿¡ä½¿åˆ†åˆ«é€šçŸ¥å…¶ä»–æ‰€æœ‰å°†å†›ï¼Œè¿™æ ·ä¸€æ¥æ¯ä½å°†å†›æ ¹æ®è‡ªå·±çš„æŠ•ç¥¨å’Œå…¶ä»–å°†å†›é€è¿‡æ¥çš„æŠ•ç¥¨ï¼Œå°±å¯ä»¥çŸ¥é“æŠ•ç¥¨ç»“æœï¼Œä»è€Œå†³å®šæ˜¯è¿›æ”»è¿˜æ˜¯æ’¤é€€ã€‚ è€Œé—®é¢˜çš„å¤æ‚æ€§å°±åœ¨äºï¼šå°†å†›ä¸­å¯èƒ½å‡ºç°å›å¾’ï¼Œä»–ä»¬ä¸ä»…å¯ä»¥æŠ•ç¥¨ç»™é”™è¯¯çš„å†³ç­–ï¼Œè¿˜å¯èƒ½ä¼šé€‰æ‹©æ€§åœ°å‘é€æŠ•ç¥¨ã€‚å‡è®¾ 9 ä½å°†å†›ä¸­æœ‰ 1 åå›å¾’ï¼Œ8 ä½å¿ è¯šçš„å°†å†›ä¸­å‡ºç°äº† 4 äººæŠ•ã€Œè¿›æ”»ã€ï¼Œ4 äººæŠ•ã€Œæ’¤é€€ã€ï¼Œè¿™æ—¶å€™å›å¾’å¯èƒ½æ•…æ„ç»™ 4 åæŠ•ã€Œè¿›æ”»ã€çš„å°†å†›æŠ•ã€Œè¿›æ”»ã€ï¼Œè€Œç»™å¦å¤– 4 åæŠ•ã€Œæ’¤é€€ã€çš„å°†å†›æŠ•ã€Œæ’¤é€€ã€ã€‚è¿™æ ·åœ¨ 4 åæŠ•ã€Œè¿›æ”»ã€çš„å°†å†›çœ‹æ¥ï¼ŒæŠ•ç¥¨æ˜¯ 5 äººæŠ•ã€Œè¿›æ”»ã€ï¼Œä»è€Œå‘åŠ¨è¿›æ”»ï¼›è€Œå¦å¤– 4 åå°†å†›çœ‹æ¥æ˜¯ 5 äººæŠ•ã€Œæ’¤é€€ã€ï¼Œä»è€Œæ’¤é€€ã€‚è¿™æ ·ï¼Œä¸€è‡´æ€§å°±é­åˆ°äº†ç ´åã€‚ è¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œå› ä¸ºå°†å†›ä¹‹é—´éœ€è¦é€šè¿‡ä¿¡ä½¿äº¤æµï¼Œå³ä¾¿æ‰€æœ‰çš„å°†å†›éƒ½æ˜¯å¿ è¯šçš„ï¼Œæ´¾å‡ºå»çš„ä¿¡ä½¿ä¹Ÿå¯èƒ½è¢«æ•Œå†›æˆªæ€ï¼Œç”šè‡³è¢«é—´è°æ›¿æ¢ï¼Œä¹Ÿå°±æ˜¯è¯´å°†å†›ä¹‹é—´è¿›è¡Œäº¤æµçš„ä¿¡æ¯é€šé“æ˜¯ä¸èƒ½ä¿è¯å¯é æ€§çš„ã€‚æ‰€ä»¥åœ¨æ²¡æœ‰æ”¶åˆ°å¯¹åº”å°†å†›æ¶ˆæ¯çš„æ—¶å€™ï¼Œå°†å†›ä»¬ä¼šé»˜è®¤æŠ•ä¸€ä¸ªç¥¨ï¼Œä¾‹å¦‚ã€Œè¿›æ”»ã€ã€‚ æ›´ä¸€èˆ¬åœ°ï¼Œåœ¨å·²çŸ¥æœ‰ N ä¸ªå°†å†›è°‹åçš„æƒ…å†µä¸‹ï¼Œå…¶ä½™ M ä¸ªå¿ è¯šçš„å°†å†›åœ¨ä¸å—å›å¾’çš„å½±å“ä¸‹èƒ½å¦è¾¾æˆå…±è¯†ï¼Ÿæœ‰ä»€ä¹ˆæ ·çš„å‰ææ¡ä»¶ï¼Œè¯¥å¦‚ä½•è¾¾æˆå…±è¯†ï¼Ÿè¿™å°±æ˜¯æ‹œå åº­å°†å†›é—®é¢˜ã€‚ å¦‚æœä¸€ä¸ªå…±è¯†ç®—æ³•åœ¨ä¸€å®šæ¡ä»¶ä¸‹èƒ½å¤Ÿè§£å†³æ‹œå åº­å°†å†›é—®é¢˜ï¼Œé‚£æˆ‘ä»¬å°±ç§°è¿™ä¸ªç®—æ³•æ˜¯ã€Œæ‹œå åº­å®¹é”™ Byzantine Fault Toleranceï¼ˆBFTï¼‰ã€ç®—æ³•ã€‚åä¹‹å¦‚æœä¸€ä¸ªå…±è¯†ç®—æ³•æ— æ³•æ¥å—ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹ä½œæ¶ï¼Œé‚£å®ƒå°±è¢«ç§°ä¸ºã€Œéæ‹œå åº­å®¹é”™ Crash Fault Tolerance (CFT)ã€ç®—æ³•ã€‚ å¯ä»¥é€šè¿‡ç®€å•ç©·ä¸¾å‘ç°ï¼ŒäºŒå¿ ä¸€å›æ˜¯æ— æ³•è¾¾æˆå…±è¯†çš„ï¼Œè¿™ä¸ªç»“è®ºç»“åˆåè¯æ³•å¯è¯æ˜ï¼Œæ‹œå åº­å®¹é”™ç®—æ³•è¦æ±‚å›å¾’çš„æ¯”ä¾‹å¿…é¡»ä½äº 1/3ã€‚ ","date":"2022-08-07","objectID":"/posts/consistency-and-consensus-algorithm/:3:1","series":null,"tags":["å…±è¯†","ä¸€è‡´æ€§","åˆ†å¸ƒå¼","æ•°æ®åº“","åŒºå—é“¾"],"title":"åˆ†å¸ƒå¼æ•°æ®åº“çš„ä¸€è‡´æ€§é—®é¢˜ä¸å…±è¯†ç®—æ³•","uri":"/posts/consistency-and-consensus-algorithm/#æ‹œå åº­å°†å†›é—®é¢˜ä¸æ‹œå åº­å®¹é”™"},{"categories":["tech"],"content":" å¸¸ç”¨å…±è¯†ç®—æ³•å¯¹äºã€Œéæ‹œå åº­å®¹é”™ Crash Fault Tolerance (CFT)ã€çš„æƒ…å†µï¼Œå·²ç»å­˜åœ¨ä¸å°‘ç»å…¸çš„ç®—æ³•ï¼ŒåŒ…æ‹¬ Paxosï¼ˆ1990 å¹´ï¼‰ã€Raftï¼ˆ2014 å¹´ï¼‰åŠå…¶å˜ç§ç­‰ã€‚è¿™ç±»å®¹é”™ç®—æ³•å¾€å¾€æ€§èƒ½æ¯”è¾ƒå¥½ï¼Œå¤„ç†è¾ƒå¿«ï¼Œå®¹å¿ä¸è¶…è¿‡ä¸€åŠçš„æ•…éšœèŠ‚ç‚¹ã€‚ å¯¹äºã€Œæ‹œå åº­å®¹é”™ Byzantine Fault Toleranceï¼ˆBFTï¼‰ã€çš„æƒ…å†µï¼Œç›®å‰æœ‰ PBFTï¼ˆPractical Byzantine Fault Toleranceï¼Œ1999 å¹´ï¼‰ä¸ºä»£è¡¨çš„ç¡®å®šæ€§ç³»åˆ—ç®—æ³•ã€PoWï¼ˆ1999 å¹´ï¼‰ä¸ºä»£è¡¨çš„æ¦‚ç‡ç®—æ³•ç­‰ç®—æ³•å¯é€‰ã€‚ç¡®å®šæ€§ç®—æ³•ä¸€æ—¦è¾¾æˆå…±è¯†å°±ä¸å¯é€†è½¬ï¼Œå³å…±è¯†æ˜¯æœ€ç»ˆç»“æœï¼›è€Œæ¦‚ç‡ç±»ç®—æ³•çš„å…±è¯†ç»“æœåˆ™æ˜¯ä¸´æ—¶çš„ï¼Œéšç€æ—¶é—´æ¨ç§»æˆ–æŸç§å¼ºåŒ–ï¼Œå…±è¯†ç»“æœè¢«æ¨ç¿»çš„æ¦‚ç‡è¶Šæ¥è¶Šå°ï¼Œæœ€ç»ˆæˆä¸ºäº‹å®ä¸Šç»“æœã€‚æ‹œå åº­ç±»å®¹é”™ç®—æ³•å¾€å¾€æ€§èƒ½è¾ƒå·®ï¼Œå®¹å¿ä¸è¶…è¿‡ 1/3 çš„æ•…éšœèŠ‚ç‚¹ã€‚ æ­¤å¤–ï¼ŒXFTï¼ˆCross Fault Toleranceï¼Œ2015 å¹´ï¼‰ç­‰æœ€è¿‘æå‡ºçš„æ”¹è¿›ç®—æ³•å¯ä»¥æä¾›ç±»ä¼¼ CFT çš„å¤„ç†å“åº”é€Ÿåº¦ï¼Œå¹¶èƒ½åœ¨å¤§å¤šæ•°èŠ‚ç‚¹æ­£å¸¸å·¥ä½œæ—¶æä¾› BFT ä¿éšœã€‚Algorand ç®—æ³•ï¼ˆ2017 å¹´ï¼‰åŸºäº PBFT è¿›è¡Œæ”¹è¿›ï¼Œé€šè¿‡å¼•å…¥å¯éªŒè¯éšæœºå‡½æ•°è§£å†³äº†ææ¡ˆé€‰æ‹©çš„é—®é¢˜ï¼Œç†è®ºä¸Šå¯ä»¥åœ¨å®¹å¿æ‹œå åº­é”™è¯¯çš„å‰æä¸‹å®ç°æ›´å¥½çš„æ€§èƒ½ï¼ˆ1000+ TPSï¼‰ã€‚ æ³¨ï¼šå®è·µä¸­ï¼Œå¯¹å®¢æˆ·ç«¯æ¥è¯´è¦æ‹¿åˆ°å…±è¯†ç»“æœéœ€è¦è‡ªè¡ŒéªŒè¯ï¼Œå…¸å‹åœ°ï¼Œå¯è®¿é—®è¶³å¤Ÿå¤šä¸ªæœåŠ¡èŠ‚ç‚¹æ¥æ¯”å¯¹ç»“æœï¼Œç¡®ä¿è·å–ç»“æœçš„å‡†ç¡®æ€§ã€‚ å¸¸è§å…±è¯†ç®—æ³•åˆ—ä¸¾å¦‚ä¸‹ï¼š æ‹œå åº­å®¹é”™ ä¸€è‡´æ€§ æ€§èƒ½ å¯ç”¨æ€§ï¼ˆèƒ½å®¹å¿å¤šå¤§æ¯”ä¾‹çš„èŠ‚ç‚¹å‡ºç°æ•…éšœï¼‰ ä¸¤é˜¶æ®µæäº¤ 2PC å¦ å¼ºä¸€è‡´æ€§ ä½ ä½ TCC(try-confirm-cancel) å¦ æœ€ç»ˆä¸€è‡´æ€§ ä½ ä½ Paxos å¦ å¼ºä¸€è‡´æ€§ ä¸­ ä¸­ ZAB å¦ æœ€ç»ˆä¸€è‡´æ€§ ä¸­ ä¸­ Raft å¦ å¼ºä¸€è‡´æ€§ ä¸­ ä¸­ Gossip å¦ æœ€ç»ˆä¸€è‡´æ€§ é«˜ é«˜ Quorum NWR å¦ å¼ºä¸€è‡´æ€§ ä¸­ ä¸­ PBFT æ˜¯ N/A ä½ ä¸­ PoW æ˜¯ N/A ä½ ä¸­ PoS æ˜¯ N/A ä½ ä¸­ PoH æ˜¯ N/A ä¸­ ä¸­ æ³¨ï¼šè¿™é‡Œè™½ç„¶åˆ—å‡ºäº† PoW/PoS/PoH ç­‰åº”ç”¨åœ¨åŒºå—é“¾ä¸­çš„ä¸€è‡´æ€§ç®—æ³•ï¼Œä½†æ˜¯å®ƒä»¬è·Ÿ PBFT ç­‰å…¶ä»–æ‹œå åº­å®¹é”™ç®—æ³•å­˜åœ¨å¾ˆå¤§çš„åŒºåˆ«ï¼Œåé¢ä¼šç»™å‡ºä»‹ç»ã€‚ ","date":"2022-08-07","objectID":"/posts/consistency-and-consensus-algorithm/:3:2","series":null,"tags":["å…±è¯†","ä¸€è‡´æ€§","åˆ†å¸ƒå¼","æ•°æ®åº“","åŒºå—é“¾"],"title":"åˆ†å¸ƒå¼æ•°æ®åº“çš„ä¸€è‡´æ€§é—®é¢˜ä¸å…±è¯†ç®—æ³•","uri":"/posts/consistency-and-consensus-algorithm/#å¸¸ç”¨å…±è¯†ç®—æ³•"},{"categories":["tech"],"content":" ä¸åŒå…±è¯†ç®—æ³•çš„åº”ç”¨åœºæ™¯åœ¨ä¸å¯ä¿¡ç¯å¢ƒä¸­ï¼Œå› ä¸ºå¯èƒ½å­˜åœ¨æ¶æ„è¡Œä¸ºï¼Œå°±éœ€è¦ä½¿ç”¨æ”¯æŒæ‹œå åº­å®¹é”™çš„å…±è¯†ç®—æ³•å¦‚ PoW/PoSï¼Œä½¿ç³»ç»Ÿåœ¨å­˜åœ¨éƒ¨åˆ†èŠ‚ç‚¹ä½œæ¶çš„æƒ…å†µä¸‹ä»ç„¶èƒ½è¾¾æˆå…±è¯†ã€‚è¿™å°±æ˜¯åŒºå—é“¾ä½¿ç”¨ PoW/PoS ç®—æ³•è€Œä¸æ˜¯ Paxos/Raft ç®—æ³•çš„åŸå› ã€‚ è€Œåœ¨ä¼ä¸šå†…ç½‘ç­‰åœºæ™¯ä¸‹ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯å¯ä¿¡ç¯å¢ƒï¼ŒåŸºæœ¬ä¸ä¼šå‡ºç°æ¶æ„èŠ‚ç‚¹æˆ–è€…å¯ä»¥é€šè¿‡ mTLS ç­‰æ‰‹æ®µè¿›è¡ŒèŠ‚ç‚¹èº«ä»½è®¤è¯ï¼Œè¿™ç§åœºæ™¯ä¸‹ç³»ç»Ÿå…·æœ‰æ•…éšœå®¹é”™èƒ½åŠ›å°±å¤Ÿäº†ï¼Œå°±æ²¡å¿…è¦åšåˆ°æ‹œå åº­å®¹é”™ï¼Œå› æ­¤å¸¸ç”¨ Raft/Paxos ç­‰ç®—æ³•ã€‚ ","date":"2022-08-07","objectID":"/posts/consistency-and-consensus-algorithm/:3:3","series":null,"tags":["å…±è¯†","ä¸€è‡´æ€§","åˆ†å¸ƒå¼","æ•°æ®åº“","åŒºå—é“¾"],"title":"åˆ†å¸ƒå¼æ•°æ®åº“çš„ä¸€è‡´æ€§é—®é¢˜ä¸å…±è¯†ç®—æ³•","uri":"/posts/consistency-and-consensus-algorithm/#ä¸åŒå…±è¯†ç®—æ³•çš„åº”ç”¨åœºæ™¯"},{"categories":["tech"],"content":" éæ‹œå åº­é”™è¯¯å…±è¯†ç®—æ³• Paxos ä¸ Raftå—é™äºç¯‡å¹…ä¸ç¬”è€…ç²¾åŠ›ï¼Œè¿™éƒ¨åˆ†æš‚æ—¶è·³è¿‡â€¦åé¢å¯èƒ½ä¼šå†™ç¯‡æ–°çš„æ–‡ç« ä¸“é—¨ä»‹ç» Paxos/Raft ç®—æ³•ã€‚ ","date":"2022-08-07","objectID":"/posts/consistency-and-consensus-algorithm/:3:4","series":null,"tags":["å…±è¯†","ä¸€è‡´æ€§","åˆ†å¸ƒå¼","æ•°æ®åº“","åŒºå—é“¾"],"title":"åˆ†å¸ƒå¼æ•°æ®åº“çš„ä¸€è‡´æ€§é—®é¢˜ä¸å…±è¯†ç®—æ³•","uri":"/posts/consistency-and-consensus-algorithm/#éæ‹œå åº­é”™è¯¯å…±è¯†ç®—æ³•-paxos-ä¸-raft"},{"categories":["tech"],"content":" èƒ½å®¹å¿æ‹œå åº­é”™è¯¯çš„ PoW æ¦‚ç‡å…±è¯†ç®—æ³•PoW å³ Proof of Work å·¥ä½œé‡è¯æ˜ï¼ŒæŒ‡ç³»ç»Ÿä¸ºè¾¾åˆ°æŸä¸€ç›®æ ‡è€Œè®¾ç½®çš„åº¦é‡æ–¹æ³•ã€‚ç®€å•ç†è§£å°±æ˜¯ä¸€ä»½è¯æ˜ï¼Œç”¨æ¥ç¡®è®¤ä½ åšè¿‡ä¸€å®šé‡çš„å·¥ä½œã€‚ç›‘æµ‹å·¥ä½œçš„æ•´ä¸ªè¿‡ç¨‹é€šå¸¸æ˜¯æä¸ºä½æ•ˆçš„ï¼Œè€Œé€šè¿‡å¯¹å·¥ä½œçš„ç»“æœè¿›è¡Œè®¤è¯æ¥è¯æ˜å®Œæˆäº†ç›¸åº”çš„å·¥ä½œé‡ï¼Œè¿™ä¸ªè®¤è¯æµç¨‹æ˜¯éå¸¸ç®€å•é«˜æ•ˆçš„ï¼Œè¿™å°±æ˜¯ PoW çš„ä¼˜åŠ¿æ‰€åœ¨ã€‚ åœ¨ 1993 å¹´ï¼ŒCynthia Dwork å’Œ Moni Naor è®¾è®¡äº†ä¸€ä¸ªç³»ç»Ÿç”¨äºååƒåœ¾é‚®ä»¶ã€é¿å…èµ„æºè¢«æ»¥ç”¨ï¼Œ è¿™æ˜¯ PoW ç®—æ³•çš„é›å½¢ã€‚å…¶æ ¸å¿ƒæ€æƒ³å¦‚ä¸‹ï¼š The main idea is to require a user to compute a moderately hard but not intractable function in order to gain access to the resource, thus preventing frivolous use. ç¿»è¯‘æˆä¸­æ–‡ï¼š å…¶ä¸»è¦æ€æƒ³æ˜¯è¦æ±‚ç”¨æˆ·è®¡ç®—ä¸€ä¸ªä¸­ç­‰éš¾åº¦ä½†ä¸éš¾å¤„ç†çš„å‡½æ•°ï¼Œä»¥è·å¾—å¯¹èµ„æºçš„è®¿é—®ï¼Œä»è€Œé˜²æ­¢ï¼ˆç³»ç»Ÿèµ„æºè¢«ï¼‰æ»¥ç”¨ã€‚ åœ¨ 1999 å¹´ï¼ŒMarkus Jakobsson ä¸ Ari Juels ç¬¬ä¸€æ¬¡ä»å„ç§åè®®ä¸­æç‚¼å‡º Proofs of Work è¿™ä¸ªæ¦‚å¿µã€‚ POW ç³»ç»Ÿä¸­ä¸€å®šæœ‰ä¸¤ä¸ªè§’è‰²ï¼Œå·¥ä½œè€…å’ŒéªŒè¯è€…ï¼Œä»–ä»¬éœ€è¦å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š å·¥ä½œè€…éœ€è¦å®Œæˆçš„å·¥ä½œå¿…é¡»æœ‰ä¸€å®šçš„é‡ï¼Œè¿™ä¸ªé‡ç”±å·¥ä½œéªŒè¯è€…ç»™å‡ºã€‚ éªŒè¯è€…å¯ä»¥è¿…é€Ÿçš„æ£€éªŒå·¥ä½œé‡æ˜¯å¦è¾¾æ ‡ã€‚ å·¥ä½œè€…æ— æ³•è‡ªå·±\"åˆ›é€ å·¥ä½œ\"ï¼Œå¿…é¡»ç”±éªŒè¯è€…å‘å¸ƒå·¥ä½œã€‚ å·¥ä½œè€…æ— æ³•æ‰¾åˆ°å¾ˆå¿«å®Œæˆå·¥ä½œçš„åŠæ³•ã€‚ è¯´åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å¯¹ PoW åº”è¯¥æœ‰è¶³å¤Ÿçš„ç†è§£äº†ï¼Œå®ƒå°±æ˜¯è®©å·¥ä½œè€…æ¶ˆè€—ä¸€å®šçš„èµ„æºä½œä¸ºä½¿ç”¨ç³»ç»Ÿçš„æˆæœ¬ã€‚å¯¹äºæ­£å¸¸çš„ç”¨æˆ·è€Œè¨€è¿™éƒ¨åˆ†è¢«æ¶ˆè€—çš„èµ„æºæ˜¯å®Œå…¨å¯ä»¥æ¥å—çš„ï¼Œä½†æ˜¯å¯¹äºæ¶æ„æ”»å‡»è€…è€Œè¨€ï¼Œå®ƒå¦‚æœæƒ³æ»¥ç”¨ç³»ç»Ÿçš„èµ„æºæˆ–è€…å‘é€æµ·é‡çš„åƒåœ¾é‚®ä»¶ï¼Œå°±éœ€è¦æ¶ˆè€—æµ·é‡çš„è®¡ç®—èµ„æºä½œä¸ºæˆæœ¬ï¼Œè¿™æ ·å°±æå¤§åœ°æå‡äº†æ”»å‡»æˆæœ¬ã€‚ å†æ€»ç»“ä¸‹ï¼ŒPoW ç®—æ³•çš„æ ¸å¿ƒæ˜¯å®ƒä¸ºä¿¡æ¯å‘é€åŠ å…¥äº†æˆæœ¬ï¼Œé™ä½äº†ä¿¡æ¯ä¼ é€’çš„é€Ÿç‡ã€‚ æŠŠæ¯”ç‰¹å¸åŒºå—é“¾è½¬æ¢æˆæ‹œå åº­å°†å†›é—®é¢˜æ¥çœ‹ï¼Œå®ƒçš„æ€è·¯æ˜¯è¿™æ ·çš„ï¼š é™åˆ¶ä¸€æ®µæ—¶é—´å†…ææ¡ˆçš„ä¸ªæ•°ï¼Œåªæœ‰æ‹¥æœ‰å¯¹åº”æƒé™çš„èŠ‚ç‚¹ï¼ˆå°†å†›ï¼‰å¯ä»¥å‘èµ·ææ¡ˆã€‚ è¿™æ˜¯é€šè¿‡ PoW å·¥ä½œé‡è¯æ˜å®ç°çš„ï¼Œæ¯”ç‰¹å¸åŒºå—é“¾è¦æ±‚èŠ‚ç‚¹è¿›è¡Œæµ·é‡çš„å“ˆå¸Œè®¡ç®—ä½œä¸ºè·å¾—ææ¡ˆæƒé™çš„ä»£ä»·ï¼Œç®—æ³•éš¾åº¦æ¯éš”ä¸¤å‘¨è°ƒæ•´ä¸€æ¬¡ä»¥ä¿è¯æ•´ä¸ªç³»ç»Ÿæ‰¾åˆ°æ­£ç¡® Hash å€¼çš„å¹³å‡ç”¨æ—¶å¤§çº¦ä¸º 10 åˆ†é’Ÿã€‚ ç”±å¼ºä¸€è‡´æ€§æ”¾å®½è‡³æœ€ç»ˆä¸€è‡´æ€§ã€‚ å¯¹åº”ä¸€æ¬¡ææ¡ˆçš„ç»“æœä¸éœ€è¦å…¨éƒ¨çš„èŠ‚ç‚¹é©¬ä¸Šè·Ÿè¿›ï¼Œåªéœ€è¦åœ¨èŠ‚ç‚¹èƒ½æœå¯»åˆ°çš„å…¨ç½‘ç»œä¸­çš„æ‰€æœ‰é“¾æ¡ä¸­ï¼Œé€‰å–æœ€é•¿çš„é“¾æ¡è¿›è¡Œåç»­æ‹“å±•å°±å¯ä»¥ã€‚ ä½¿ç”¨éå¯¹ç§°åŠ å¯†ç®—æ³•å¯¹èŠ‚ç‚¹é—´çš„æ¶ˆæ¯ä¼ é€’æä¾›ç­¾åæŠ€æœ¯æ”¯æŒï¼Œæ¯ä¸ªèŠ‚ç‚¹ï¼ˆå°†å†›ï¼‰éƒ½æœ‰å±äºè‡ªå·±çš„ç§˜é’¥ ï¼ˆå…¬é’¥ç§é’¥ï¼‰ï¼Œå”¯ä¸€æ ‡è¯†èŠ‚ç‚¹èº«ä»½ã€‚ ä½¿ç”¨éå¯¹ç§°åŠ å¯†ç®—æ³•ä¼ é€’æ¶ˆæ¯ï¼Œèƒ½å¤Ÿä¿è¯æ¶ˆæ¯ä¼ é€’çš„ç§å¯†æ€§ã€‚è€Œä¸”æ¶ˆæ¯ç­¾åä¸å¯ç¯¡æ”¹ï¼Œè¿™é¿å…äº†æ¶ˆæ¯è¢«æ¶æ„èŠ‚ç‚¹ä¼ªé€ ã€‚ æˆ‘ä»¬å‰é¢æœ‰ç»™å‡ºä¸€ä¸ªç»“è®ºï¼šæ‹œå åº­å®¹é”™ç®—æ³•è¦æ±‚å›å¾’çš„æ¯”ä¾‹å¿…é¡»ä½äº 1/3ã€‚ ä½†æ˜¯åŒºå—é“¾ä¸æ‹œå åº­å°†å†›é—®é¢˜çš„åŒºåˆ«å¾ˆå¤§ï¼Œä¸¾ä¾‹å¦‚ä¸‹ï¼š åŒºå—é“¾å…è®¸ä»»ä½•èŠ‚ç‚¹éšæ—¶åŠ å…¥æˆ–ç¦»å¼€åŒºå—é“¾ï¼Œè€Œæ‹œå åº­å°†å†›é—®é¢˜æ˜¯é¢„è®¾äº†èŠ‚ç‚¹æ•°ï¼Œè€Œä¸”ä¸è€ƒè™‘èŠ‚ç‚¹çš„æ·»åŠ æˆ–åˆ é™¤ã€‚ æ¯”ç‰¹å¸åŒºå—é“¾çš„ PoW ç®—æ³•åªèƒ½ä¿è¯æ•´ä¸ªç³»ç»Ÿæ‰¾åˆ°æ­£ç¡® Hash å€¼çš„å¹³å‡ç”¨æ—¶å¤§çº¦ä¸º 10 åˆ†é’Ÿï¼Œé‚£è‚¯å®šå°±å­˜åœ¨æ€§èƒ½æ›´å¥½çš„èŠ‚ç‚¹ç”¨æ—¶æ›´çŸ­ï¼Œæ€§èƒ½æ›´å·®çš„èŠ‚ç‚¹ç”¨æ—¶æ›´é•¿ï¼Œç”šè‡³æŸäº›èŠ‚ç‚¹è¿æ°”å¥½å‡ ç§’é’Ÿå°±ç®—å‡ºäº†ç»“æœï¼Œè¿™éƒ½æ˜¯å®Œå…¨å¯èƒ½çš„ã€‚è€Œè¶Šæ—©ç®—å‡ºè¿™ä¸ª Hash å€¼çš„èŠ‚ç‚¹ï¼Œå®ƒçš„ææ¡ˆï¼ˆåŒºå—ï¼‰æˆä¸ºæœ€é•¿é“¾æ¡çš„æ¦‚ç‡å°±è¶Šå¤§ã€‚ PoW ç”±å¼ºä¸€è‡´æ€§æ”¾å®½è‡³æœ€ç»ˆä¸€è‡´æ€§ï¼Œç³»ç»Ÿæ€»ä¼šé€‰å–æœ€é•¿çš„é“¾è¿›è¡Œåç»­æ‹“å±•ï¼Œé‚£å¦‚æœæŸä¸ªé“¾æ¡ä¸€å¼€å§‹ä¸é•¿ï¼Œä½†æ˜¯å®ƒçš„æ‹“å±•é€Ÿåº¦è¶³å¤Ÿå¿«ï¼Œå®ƒå°±èƒ½æˆä¸ºæœ€é•¿çš„é“¾æ¡ã€‚è€Œæ‹œå åº­å°†å†›é—®é¢˜ä¸å…è®¸ä»»ä½•åˆ†æ”¯ï¼Œåªå­˜åœ¨ä¸€ä¸ªç»“æœï¼ åªæ˜¯å—é™äºç®—åŠ›ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼ŒçŸ­çš„é“¾æ¡è¿½ä¸Šæœ€é•¿é“¾æ¡çš„æ¦‚ç‡ä¼šè¶Šæ¥è¶Šå°ã€‚ æ€»ä¹‹å› ä¸ºåŒºå—é“¾è¿™æ ·çš„ç‰¹ç‚¹ï¼Œå®ƒä¼šäº§ç”Ÿä¸€äº›è·Ÿæ‹œå åº­å®¹é”™ç®—æ³•ä¸åŒçš„ç»“æœï¼š æ”»å‡»è€…æ‹¥æœ‰çš„èŠ‚ç‚¹æ•°é‡å æ¯”æ˜¯æ¯«æ— æ„ä¹‰çš„ï¼Œæ ¸å¿ƒæ˜¯ç®—åŠ›ï¼Œä¹Ÿå°±å¯¹åº”ç€åŒºå—é“¾ä¸­çš„ææ¡ˆæƒã€‚ å³ä½¿æ”»å‡»è€…æ‹¥æœ‰äº† 99% çš„èŠ‚ç‚¹ï¼Œä½†æ˜¯å®ƒçš„æ€»ä½“ç®—åŠ›å¾ˆå¼±çš„è¯ï¼Œå®ƒçš„ææ¡ˆï¼ˆåŒºå—ï¼‰æˆä¸ºæœ€é•¿é“¾æ¡çš„æ¦‚ç‡ä¹Ÿä¼šå¾ˆä½ã€‚ åŒºå—é“¾çš„ 51% æ”»å‡»ï¼šå› ä¸ºã€Œç³»ç»Ÿæ€»æ˜¯é€‰å–æœ€é•¿é“¾æ¡è¿›è¡Œåç»­æ‹“å±•ã€è¿™ä¸ªåŸåˆ™ï¼Œåªæœ‰æŸä¸ªæ”»å‡»è€…æ‹¥æœ‰äº†è¶…è¿‡ 50% ç®—åŠ›çš„æƒ…å†µä¸‹ï¼Œå®ƒæ‰æ‹¥æœ‰ç»å¯¹æ€§çš„ä¼˜åŠ¿ï¼Œä½¿å®ƒçš„åŒºå—åœ¨ä¸€å®šæ—¶é—´åä¸€å®šèƒ½æˆä¸ºæœ€é•¿çš„é“¾æ¡ï¼Œå¹¶ä¸”å§‹ç»ˆç»´æŒè¿™æ ·ä¸€ä¸ªä¼˜åŠ¿ï¼Œä»è€Œè¾¾æˆæ”»å‡»ç›®çš„ã€‚ è‡³äº PoW ç®—æ³•çš„å…·ä½“å®ç°ï¼Œä»¥åŠå®ƒçš„æ›¿ä»£ç®—æ³• PoS/PoH ç­‰æ–°å…´ç®—æ³•çš„åŸç†ä¸å®ç°ï¼Œå°†åœ¨åç»­çš„åŒºå—é“¾ç³»åˆ—æ–‡ç« ä¸­è¯¦ç»†ä»‹ç»ï¼Œå°½è¯·æœŸå¾…â€¦ ","date":"2022-08-07","objectID":"/posts/consistency-and-consensus-algorithm/:3:5","series":null,"tags":["å…±è¯†","ä¸€è‡´æ€§","åˆ†å¸ƒå¼","æ•°æ®åº“","åŒºå—é“¾"],"title":"åˆ†å¸ƒå¼æ•°æ®åº“çš„ä¸€è‡´æ€§é—®é¢˜ä¸å…±è¯†ç®—æ³•","uri":"/posts/consistency-and-consensus-algorithm/#èƒ½å®¹å¿æ‹œå åº­é”™è¯¯çš„-pow-æ¦‚ç‡å…±è¯†ç®—æ³•"},{"categories":["tech"],"content":" å‚è€ƒ ã€ŠDesigning Data-Intensive Applications - The Big Ideas Behind Reliable, Scalable, and Maintainable Systems (Martin Kleppmann)ã€‹ æå®¢æ—¶é—´ã€Šåˆ†å¸ƒå¼æ•°æ®åº“ 30 è®²ã€‹ æå®¢æ—¶é—´ã€Šåˆ†å¸ƒå¼åè®®ä¸ç®—æ³•å®æˆ˜ã€‹ åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿçš„ä¸€è‡´æ€§æ˜¯ä»€ä¹ˆï¼Ÿ- OceanBase çº¿æ€§ä¸€è‡´æ€§å’Œ Raft - PingCAP ä¸€è‡´æ€§æ¨¡å‹ç¬”è®° æ¡åˆ†ç¼•æåˆ†å¸ƒå¼ï¼šæµ…æå¼ºå¼±ä¸€è‡´æ€§ - å¼ é“è•¾ Why you should pick strong consistency, whenever possible - Google Spanner æ‹œå åº­å°†å†›é—®é¢˜ä¸åŒºå—é“¾ åŒºå—é“¾åè®®å®‰å…¨ç³»åˆ—â€” â€”å½“æ‹œå åº­å°†å†›çŠ¯é”™æ—¶ï¼ŒåŒºå—é“¾å…±è¯†è¿˜å®‰å…¨ä¹ˆï¼Ÿï¼ˆä¸Šé›†ï¼‰ Eventually Consistent - Revisited ","date":"2022-08-07","objectID":"/posts/consistency-and-consensus-algorithm/:4:0","series":null,"tags":["å…±è¯†","ä¸€è‡´æ€§","åˆ†å¸ƒå¼","æ•°æ®åº“","åŒºå—é“¾"],"title":"åˆ†å¸ƒå¼æ•°æ®åº“çš„ä¸€è‡´æ€§é—®é¢˜ä¸å…±è¯†ç®—æ³•","uri":"/posts/consistency-and-consensus-algorithm/#å‚è€ƒ"},{"categories":["tech"],"content":"æˆ‘åœ¨ä¹‹å‰çš„æ–‡ç« å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®® ä¸­ï¼Œä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ openssl ç”Ÿæˆä¸ç®¡ç†å„ç§ç”¨é€”çš„æ•°å­—è¯ä¹¦ï¼Œä¹Ÿç®€å•ä»‹ç»äº†å¦‚ä½•é€šè¿‡ certbot ç­‰å·¥å…·ä¸ ACME è¯ä¹¦ç”³è¯·ä¸ç®¡ç†åè®®ï¼Œè¿›è¡Œæ•°å­—è¯ä¹¦çš„ç”³è¯·ä¸è‡ªåŠ¨æ›´æ–°ï¼ˆautorenewï¼‰ã€‚ è¿™ç¯‡æ–‡ç« è¦ä»‹ç»çš„ cert-managerï¼Œè·Ÿ certbot è¿™ç±»å·¥å…·æœ‰ç‚¹ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºå®ƒæ˜¯å·¥ä½œåœ¨ Kubernetes ä¸­çš„ã€‚ cert-manager æ˜¯ä¸€ä¸ªè¯ä¹¦çš„è‡ªåŠ¨åŒ–ç®¡ç†å·¥å…·ï¼Œç”¨äºåœ¨ Kubernetes é›†ç¾¤ä¸­è‡ªåŠ¨åŒ–åœ°é¢å‘ä¸ç®¡ç†å„ç§æ¥æºã€å„ç§ç”¨é€”çš„æ•°å­—è¯ä¹¦ã€‚å®ƒå°†ç¡®ä¿è¯ä¹¦æœ‰æ•ˆï¼Œå¹¶åœ¨åˆé€‚çš„æ—¶é—´è‡ªåŠ¨æ›´æ–°è¯ä¹¦ã€‚ å¤šçš„å°±ä¸è¯´äº†ï¼Œè¯ä¹¦ç›¸å…³çš„å†…å®¹è¯·å‚è§æˆ‘çš„å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®® æˆ–è€…å…¶ä»–èµ„æ–™ï¼Œç°åœ¨ç›´æ¥è¿›å…¥æ­£é¢˜ã€‚ æ³¨ï¼šcert-manager çš„ç®¡ç†å¯¹è±¡æ˜¯ã€Œè¯ä¹¦ã€ï¼Œå¦‚æœä½ ä»…éœ€è¦ä½¿ç”¨éå¯¹ç§°åŠ å¯†çš„å…¬ç§é’¥å¯¹è¿›è¡Œ JWT ç­¾åã€æ•°æ®åŠ è§£å¯†ï¼Œå¯ä»¥è€ƒè™‘ç›´æ¥ä½¿ç”¨secrets ç®¡ç†å·¥å…· Vault. ","date":"2022-07-31","objectID":"/posts/kubernetes-cert-management/:0:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["æ•°å­—è¯ä¹¦","è¯ä¹¦","TLS","Kubernetes","cert-manager"],"title":"Kubernetes ä¸­çš„è¯ä¹¦ç®¡ç†å·¥å…· - cert-manager","uri":"/posts/kubernetes-cert-management/#"},{"categories":["tech"],"content":" ä¸€ã€éƒ¨ç½² https://cert-manager.io/docs/installation/helm/ å®˜æ–¹æä¾›äº†å¤šç§éƒ¨ç½²æ–¹å¼ï¼Œä½¿ç”¨ helm3 å®‰è£…çš„æ–¹æ³•å¦‚ä¸‹ï¼š shell # æ·»åŠ  cert-manager çš„ helm ä»“åº“ helm repo add jetstack https://charts.jetstack.io helm repo update # æŸ¥çœ‹ç‰ˆæœ¬å· helm search repo jetstack/cert-manager -l | head # ä¸‹è½½å¹¶è§£å‹ chartï¼Œç›®çš„æ˜¯æ–¹ä¾¿ gitops ç‰ˆæœ¬ç®¡ç† helm pull jetstack/cert-manager --untar --version 1.8.2 helm install \\ cert-manager ./cert-manager \\ --namespace cert-manager \\ --create-namespace \\ # ä¸‹é¢è¿™ä¸ªå‚æ•°ä¼šå¯¼è‡´ä½¿ç”¨ helm å¸è½½çš„æ—¶å€™ï¼Œä¼šåˆ é™¤æ‰€æœ‰ CRDsï¼Œå¯èƒ½å¯¼è‡´æ‰€æœ‰ CRDs èµ„æºå…¨éƒ¨ä¸¢å¤±ï¼è¦æ ¼å¤–æ³¨æ„ --set installCRDs=true ","date":"2022-07-31","objectID":"/posts/kubernetes-cert-management/:1:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["æ•°å­—è¯ä¹¦","è¯ä¹¦","TLS","Kubernetes","cert-manager"],"title":"Kubernetes ä¸­çš„è¯ä¹¦ç®¡ç†å·¥å…· - cert-manager","uri":"/posts/kubernetes-cert-management/#deploy"},{"categories":["tech"],"content":" äºŒã€åˆ›å»º Issuercert-manager æ”¯æŒå¤šç§ issuerï¼Œä½ ç”šè‡³å¯ä»¥é€šè¿‡å®ƒçš„æ ‡å‡† API åˆ›å»ºè‡ªå·±çš„ Issuerã€‚ ä½†æ˜¯æ€»çš„æ¥è¯´ä¸å¤–ä¹ä¸‰ç§ï¼š ç”±æƒå¨ CA æœºæ„ç­¾åçš„ã€Œå…¬ç½‘å—ä¿¡ä»»è¯ä¹¦ã€: è¿™ç±»è¯ä¹¦ä¼šè¢«æµè§ˆå™¨ã€å°ç¨‹åºç­‰ç¬¬ä¸‰æ–¹åº”ç”¨/æœåŠ¡å•†ä¿¡ä»» æœ¬åœ°ç­¾åè¯ä¹¦: å³ç”±æœ¬åœ° CA è¯ä¹¦ç­¾åçš„æ•°å­—è¯ä¹¦ è‡ªç­¾åè¯ä¹¦: å³ä½¿ç”¨è¯ä¹¦çš„ç§é’¥ä¸ºè¯ä¹¦è‡ªå·±ç­¾å ä¸‹é¢ä»‹ç»ä¸‹å¦‚ä½•ç”³è¯·å…¬ç½‘è¯ä¹¦ä»¥åŠæœ¬åœ°ç­¾åè¯ä¹¦ã€‚ ","date":"2022-07-31","objectID":"/posts/kubernetes-cert-management/:2:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["æ•°å­—è¯ä¹¦","è¯ä¹¦","TLS","Kubernetes","cert-manager"],"title":"Kubernetes ä¸­çš„è¯ä¹¦ç®¡ç†å·¥å…· - cert-manager","uri":"/posts/kubernetes-cert-management/#create-issuer"},{"categories":["tech"],"content":" 1. é€šè¿‡æƒå¨æœºæ„åˆ›å»ºå…¬ç½‘å—ä¿¡è¯ä¹¦é€šè¿‡æƒå¨æœºæ„åˆ›å»ºçš„å…¬ç½‘å—ä¿¡è¯ä¹¦ï¼Œå¯ä»¥ç›´æ¥åº”ç”¨åœ¨è¾¹ç•Œç½‘å…³ä¸Šï¼Œç”¨äºç»™å…¬ç½‘ç”¨æˆ·æä¾› TLS åŠ å¯†è®¿é—®æœåŠ¡ï¼Œæ¯”å¦‚å„ç§ HTTPS ç«™ç‚¹ã€APIã€‚è¿™æ˜¯éœ€æ±‚æœ€å¹¿çš„ä¸€ç±»æ•°å­—è¯ä¹¦æœåŠ¡ã€‚ cert-manager æ”¯æŒä¸¤ç§ç”³è¯·å…¬ç½‘å—ä¿¡è¯ä¹¦çš„æ–¹å¼ï¼š ACMEï¼ˆAutomated Certificate Management Environment (ACME) Certificate Authority serverï¼‰è¯ä¹¦è‡ªåŠ¨åŒ–ç”³è¯·ä¸ç®¡ç†åè®®ã€‚ venafi-as-a-service: venafi æ˜¯ä¸€ä¸ªè¯ä¹¦çš„é›†ä¸­åŒ–ç®¡ç†å¹³å°ï¼Œå®ƒä¹Ÿæä¾›äº† cert-manager æ’ä»¶ï¼Œå¯ç”¨äºè‡ªåŠ¨åŒ–ç”³è¯· DigiCert/Entrust/GlobalSign/Letâ€™s Encrypt å››ç§ç±»å‹çš„å…¬ç½‘å—ä¿¡è¯ä¹¦ã€‚ è¿™é‡Œä¸»è¦ä»‹ç»ä½¿ç”¨ ACMEv2 åè®®ç”³è¯·å…¬ç½‘è¯ä¹¦ï¼Œæ”¯æŒä½¿ç”¨æ­¤å¼€æ”¾åè®®ç”³è¯·è¯ä¹¦çš„æƒå¨æœºæ„æœ‰ï¼š å…è´¹æœåŠ¡ Letâ€™s Encrypt: ä¼—æ‰€å‘¨çŸ¥ï¼Œå®ƒæä¾›ä¸‰ä¸ªæœˆæœ‰æ•ˆæœŸçš„å…è´¹è¯ä¹¦ã€‚ ZeroSSL: è²Œä¼¼ä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒæœ‰åçš„ SSL è¯ä¹¦æœåŠ¡ é€šè¿‡ ACME åè®®æ”¯æŒä¸é™æ•°é‡çš„ 90 å¤©è¯ä¹¦ï¼Œä¹Ÿæ”¯æŒå¤šåŸŸåè¯ä¹¦ä¸æ³›åŸŸåè¯ä¹¦ã€‚ å®ƒæä¾›äº†ä¸€ä¸ªé¢å¤–çš„ Dashboard æŸ¥çœ‹ä¸ç®¡ç†æ‰€æœ‰ç”³è¯·çš„è¯ä¹¦ï¼Œè¿™æ˜¯æ¯”è¾ƒæ–¹ä¾¿çš„åœ°æ–¹ã€‚ ä»˜è´¹æœåŠ¡ DigiCert: è¿™ä¸ªéå¸¸æœ‰åï¼ˆä½†ä¹Ÿæ˜¯ç›¸å½“è´µï¼‰ï¼Œå®˜æ–¹æ–‡æ¡£Digicert - Third-party ACME client automation Google Public Authority(Google Trust Services): Google æ¨å‡ºçš„å…¬ç½‘è¯ä¹¦æœåŠ¡ï¼Œä¹Ÿæ˜¯ä¸‰ä¸ªæœˆæœ‰æ•ˆæœŸï¼Œå…¶æ ¹è¯ä¹¦äº¤å‰éªŒè¯äº† GlobalSignï¼ŒOCSP æœåŠ¡å™¨åœ¨å›½å†…é€Ÿåº¦ä¹Ÿå¾ˆå¿«ã€‚ è¯¦è§acme.sh/wiki/Google-Public-CA æ­¤åŠŸèƒ½ç›®å‰ï¼ˆ2022-08-10ï¼‰ä»å¤„äº beta çŠ¶æ€ï¼Œéœ€è¦æè¡¨å•ç”³è¯·æ‰èƒ½è·å¾—ä½¿ç”¨ å®˜æ–¹åœ°å€ï¼šhttps://pki.goog/ Entrust: å®˜æ–¹æ–‡æ¡£Entrustâ€™s ACME implementation GlobalSign: å®˜æ–¹æ–‡æ¡£GlobalSign ACME Service è¿™é‡Œä¹Ÿé¡ºä¾¿ä»‹ç»ä¸‹æ”¶è´¹è¯ä¹¦æœåŠ¡å¯¹è¯ä¹¦çš„åˆ†çº§ï¼Œä»¥åŠè¯¥å¦‚ä½•é€‰ç”¨ï¼š Domain Validatedï¼ˆDVï¼‰è¯ä¹¦ ä»…éªŒè¯åŸŸåæ‰€æœ‰æƒï¼ŒéªŒè¯æ­¥éª¤æœ€å°‘ï¼Œä»·æ ¼æœ€ä½ï¼Œä»…éœ€è¦æ•°åˆ†é’Ÿå³å¯ç­¾å‘ã€‚ ä¼˜ç‚¹å°±æ˜¯æ˜“äºç­¾å‘ï¼Œå¾ˆé€‚åˆåšè‡ªåŠ¨åŒ–ã€‚ å„äº‘å‚å•†ï¼ˆAWS/GCP/Cloudflareï¼Œä»¥åŠ Vercel/Github çš„ç«™ç‚¹æœåŠ¡ï¼‰ç»™è‡ªå®¶æœåŠ¡æä¾›çš„å…è´¹è¯ä¹¦éƒ½æ˜¯ DV è¯ä¹¦ï¼ŒLetâ€™s Encrypt çš„è¯ä¹¦ä¹Ÿæ˜¯è¿™ä¸ªç±»å‹ã€‚ å¾ˆæ˜æ˜¾è¿™äº›è¯ä¹¦çš„ç­¾å‘éƒ½éå¸¸æ–¹ä¾¿ï¼Œè€Œä¸”ä»…éªŒè¯åŸŸåæ‰€æœ‰æƒã€‚ ä½†æ˜¯ AWS/GCP/Cloudflare/Vercel/Github æä¾›çš„ DV è¯ä¹¦éƒ½ä»…èƒ½åœ¨å®ƒä»¬çš„äº‘æœåŠ¡ä¸Šä½¿ç”¨ï¼Œä¸æä¾›ç§é’¥å¯¼å‡ºåŠŸèƒ½ï¼ Organization Validated (OV) è¯ä¹¦ æ˜¯ä¼ä¸š SSL è¯ä¹¦çš„é¦–é€‰ï¼Œé€šè¿‡ä¼ä¸šè®¤è¯ç¡®ä¿ä¼ä¸š SSL è¯ä¹¦çš„çœŸå®æ€§ã€‚ é™¤åŸŸåæ‰€æœ‰æƒå¤–ï¼ŒCA æœºæ„è¿˜ä¼šå®¡æ ¸ç»„ç»‡åŠä¼ä¸šçš„çœŸå®æ€§ï¼ŒåŒ…æ‹¬æ³¨å†ŒçŠ¶å†µã€è”ç³»æ–¹å¼ã€æ¶æ„è½¯ä»¶ç­‰å†…å®¹ã€‚ å¦‚æœè¦åšåˆè§„åŒ–ï¼Œå¯èƒ½è‡³å°‘ä¹Ÿå¾—ç”¨ OV è¿™ä¸ªçº§åˆ«çš„è¯ä¹¦ã€‚ Extended Validationï¼ˆEVï¼‰è¯ä¹¦ æœ€ä¸¥æ ¼çš„è®¤è¯æ–¹å¼ï¼ŒCA æœºæ„ä¼šæ·±åº¦å®¡æ ¸ç»„ç»‡åŠä¼ä¸šå„æ–¹é¢çš„ä¿¡æ¯ã€‚ è¢«è®¤ä¸ºé€‚åˆç”¨äºå¤§å‹ä¼ä¸šã€é‡‘èæœºæ„ç­‰ç»„ç»‡æˆ–ä¼ä¸šã€‚ è€Œä¸”ä»…æ”¯æŒç­¾å‘å•åŸŸåã€å¤šåŸŸåè¯ä¹¦ï¼Œä¸æ”¯æŒç­¾å‘æ³›åŸŸåè¯ä¹¦ï¼Œå®‰å…¨æ€§æ æ çš„ã€‚ ACME æ”¯æŒ HTTP01 è·Ÿ DNS01 ä¸¤ç§åŸŸåéªŒè¯æ–¹å¼ï¼Œå…¶ä¸­ DNS01 æ˜¯æœ€ç®€ä¾¿çš„æ–¹æ³•ã€‚ ä¸‹é¢åˆ†åˆ«æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ AWS Route53 è·Ÿ AliDNSï¼Œé€šè¿‡ DNS éªŒè¯æ–¹å¼ç”³è¯·ä¸€ä¸ª Letâ€™s Encrypt è¯ä¹¦ã€‚ ï¼ˆå…¶ä»– DNS æä¾›å•†çš„é…ç½®æ–¹å¼è¯·ç›´æ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼‰ 1.1 ä½¿ç”¨ AWS Route53 åˆ›å»ºä¸€ä¸ªè¯ä¹¦ç­¾å‘è€…ã€ŒCertificate Issuerã€ é AWS Route53 ç”¨æˆ·å¯å¿½ç•¥è¿™ä¸€èŠ‚ https://cert-manager.io/docs/configuration/acme/dns01/route53/ 1.1.1 é€šè¿‡ IAM æˆæƒ cert-manager è°ƒç”¨ AWS Route53 API è¿™é‡Œä»‹ç»ä¸€ç§ä¸éœ€è¦åˆ›å»º ACCESS_KEY_ID/ACCESS_SECRETï¼Œç›´æ¥ä½¿ç”¨ AWS EKS å®˜æ–¹çš„å…å¯†è®¤è¯çš„æ–¹æ³•ã€‚ä¼šæ›´å¤æ‚ä¸€ç‚¹ï¼Œä½†æ˜¯æ›´å®‰å…¨å¯ç»´æŠ¤ã€‚ é¦–å…ˆéœ€è¦ä¸º EKS é›†ç¾¤åˆ›å»º OIDC providerï¼Œå‚è§aws-iam-and-kubernetesï¼Œ è¿™é‡Œä¸å†èµ˜è¿°ã€‚ cert-manager éœ€è¦æŸ¥è¯¢ä¸æ›´æ–° Route53 è®°å½•çš„æƒé™ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨å¦‚ä¸‹é…ç½®åˆ›å»ºä¸€ä¸ª IAM Policyï¼Œ å¯ä»¥å‘½åä¸º \u003cClusterName\u003eCertManagerRoute53Accessï¼ˆæ³¨æ„æ›¿æ¢æ‰ \u003cClusterName\u003eï¼‰ï¼š json { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Effect\": \"Allow\", \"Action\": \"route53:GetChange\", \"Resource\": \"arn:aws:route53:::change/*\" }, { \"Effect\": \"Allow\", \"Action\": [\"route53:ChangeResourceRecordSets\", \"route53:ListResourceRecordSets\"], \"Resource\": \"arn:aws:route53:::hostedzone/*\" }, { \"Effect\": \"Allow\", \"Action\": \"route53:ListHostedZonesByName\", \"Resource\": \"*\" } ] } æ¯”å¦‚ä½¿ç”¨ awscli åˆ›å»ºæ­¤ policyï¼š shell aws iam create-policy \\ --policy-name XxxCertManagerRoute53Access \\ --policy-document file://cert-manager-route53-access.json ç„¶åé€šè¿‡ä¸Šè¿°é…ç½®åˆ›å»ºä¸€ä¸ª IAM Role å¹¶è‡ªåŠ¨ç»™ cert-manager æ‰€åœ¨çš„ EKS é›†ç¾¤æ·»åŠ ä¿¡ä»»å…³ç³»ï¼š shell export CLUSTER_NAME=\"xxx\" export AWS_ACCOUNT_ID=\"112233445566\" # ä½¿ç”¨ eksctl è‡ªåŠ¨åˆ›å»ºå¯¹åº”çš„ role å¹¶æ·»åŠ ä¿¡ä»»å…³ç³» # éœ€è¦å…ˆå®‰è£…å¥½ eksctl eksctl create iamserviceaccount \\ --cluster \"${CLUSTER_NAME}\" --name cert-manager --namespace cert-manager \\ --role-name \"${CLUSTER_NAME}-cert-manager-route53-role\" \\ --attach-policy-arn \"arn:aws:iam::${AWS_ACCOUNT_ID}:policy/\u003cClusterName\u003eCertManagerRoute53Access\" \\ --role-only \\ --approve ä¹‹åéœ€è¦ä¸º cert-manager çš„ ServiceAccount æ·»åŠ æ³¨è§£æ¥ç»‘å®šä¸Šé¢åˆšåˆ›å»ºå¥½çš„ IAM Roleï¼Œé¦–å…ˆåˆ›å»ºå¦‚ä¸‹ helm values æ–‡ä»¶ cert-manager-values.yaml: yaml # å¦‚æœæŠŠè¿™ä¸ªæ”¹æˆ falseï¼Œä¹Ÿä¼šå¯¼è‡´ cert-manager çš„æ‰€æœ‰ CRDs åŠç›¸å…³èµ„æºè¢«åˆ é™¤ï¼ installCRDs: true serviceAccount: annotations: # æ³¨æ„ä¿®æ”¹è¿™é‡Œçš„ ${AWS_ACCOUNT_ID} ä»¥åŠ ${CLUSTER_NAME} eks.amazonaws.com/role-arn: \u003e- arn:aws:iam::${AWS_ACCOUNT_ID}:role/${CLUSTER_NAME}-cert-manager-route53-role securityContext: enabled: true # æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼Œè¿˜å¾—ä¿®æ”¹ä¸‹è¿™ä¸ªï¼Œå…è®¸ cert-manager è¯»å– ServiceAccount Tokenï¼Œä»è€Œè·å¾—æˆæƒ fsGroup: 1001 ç„¶åé‡æ–°éƒ¨ç½² cert-manager: shell helm upgrade -i cert-manager ./cert-manager -n cert-manager -f cert-manager-values.yaml è¿™æ ·å°±å®Œæˆäº†æˆæƒã€‚ 1.1.2 åˆ›å»ºä¸€ä¸ªä½¿ç”¨ AWS Route53 è¿›è¡ŒéªŒè¯çš„ ACME Issueråœ¨ xxx åå­—ç©ºé—´åˆ›å»ºä¸€ä¸ª Iusserï¼š yaml apiVersion: cert-manager.io/v1 kind: Issuer metadata: name: letsencrypt-prod-aws namespace: xxx spec: acme: # ç”¨äºæ¥å—åŸŸåè¿‡æœŸæé†’çš„é‚®ä»¶åœ°å€ email: user@example.com # ACME æœåŠ¡å™¨ï¼Œæ¯”å¦‚ let's encryptã€Digicert ç­‰ # let's encrypt çš„æµ‹è¯• URLï¼Œå¯ç”¨äºæµ‹è¯•é…ç½®æ­£ç¡®æ€§ # server:","date":"2022-07-31","objectID":"/posts/kubernetes-cert-management/:2:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["æ•°å­—è¯ä¹¦","è¯ä¹¦","TLS","Kubernetes","cert-manager"],"title":"Kubernetes ä¸­çš„è¯ä¹¦ç®¡ç†å·¥å…· - cert-manager","uri":"/posts/kubernetes-cert-management/#create-public-cert"},{"categories":["tech"],"content":" 1. é€šè¿‡æƒå¨æœºæ„åˆ›å»ºå…¬ç½‘å—ä¿¡è¯ä¹¦é€šè¿‡æƒå¨æœºæ„åˆ›å»ºçš„å…¬ç½‘å—ä¿¡è¯ä¹¦ï¼Œå¯ä»¥ç›´æ¥åº”ç”¨åœ¨è¾¹ç•Œç½‘å…³ä¸Šï¼Œç”¨äºç»™å…¬ç½‘ç”¨æˆ·æä¾› TLS åŠ å¯†è®¿é—®æœåŠ¡ï¼Œæ¯”å¦‚å„ç§ HTTPS ç«™ç‚¹ã€APIã€‚è¿™æ˜¯éœ€æ±‚æœ€å¹¿çš„ä¸€ç±»æ•°å­—è¯ä¹¦æœåŠ¡ã€‚ cert-manager æ”¯æŒä¸¤ç§ç”³è¯·å…¬ç½‘å—ä¿¡è¯ä¹¦çš„æ–¹å¼ï¼š ACMEï¼ˆAutomated Certificate Management Environment (ACME) Certificate Authority serverï¼‰è¯ä¹¦è‡ªåŠ¨åŒ–ç”³è¯·ä¸ç®¡ç†åè®®ã€‚ venafi-as-a-service: venafi æ˜¯ä¸€ä¸ªè¯ä¹¦çš„é›†ä¸­åŒ–ç®¡ç†å¹³å°ï¼Œå®ƒä¹Ÿæä¾›äº† cert-manager æ’ä»¶ï¼Œå¯ç”¨äºè‡ªåŠ¨åŒ–ç”³è¯· DigiCert/Entrust/GlobalSign/Letâ€™s Encrypt å››ç§ç±»å‹çš„å…¬ç½‘å—ä¿¡è¯ä¹¦ã€‚ è¿™é‡Œä¸»è¦ä»‹ç»ä½¿ç”¨ ACMEv2 åè®®ç”³è¯·å…¬ç½‘è¯ä¹¦ï¼Œæ”¯æŒä½¿ç”¨æ­¤å¼€æ”¾åè®®ç”³è¯·è¯ä¹¦çš„æƒå¨æœºæ„æœ‰ï¼š å…è´¹æœåŠ¡ Letâ€™s Encrypt: ä¼—æ‰€å‘¨çŸ¥ï¼Œå®ƒæä¾›ä¸‰ä¸ªæœˆæœ‰æ•ˆæœŸçš„å…è´¹è¯ä¹¦ã€‚ ZeroSSL: è²Œä¼¼ä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒæœ‰åçš„ SSL è¯ä¹¦æœåŠ¡ é€šè¿‡ ACME åè®®æ”¯æŒä¸é™æ•°é‡çš„ 90 å¤©è¯ä¹¦ï¼Œä¹Ÿæ”¯æŒå¤šåŸŸåè¯ä¹¦ä¸æ³›åŸŸåè¯ä¹¦ã€‚ å®ƒæä¾›äº†ä¸€ä¸ªé¢å¤–çš„ Dashboard æŸ¥çœ‹ä¸ç®¡ç†æ‰€æœ‰ç”³è¯·çš„è¯ä¹¦ï¼Œè¿™æ˜¯æ¯”è¾ƒæ–¹ä¾¿çš„åœ°æ–¹ã€‚ ä»˜è´¹æœåŠ¡ DigiCert: è¿™ä¸ªéå¸¸æœ‰åï¼ˆä½†ä¹Ÿæ˜¯ç›¸å½“è´µï¼‰ï¼Œå®˜æ–¹æ–‡æ¡£Digicert - Third-party ACME client automation Google Public Authority(Google Trust Services): Google æ¨å‡ºçš„å…¬ç½‘è¯ä¹¦æœåŠ¡ï¼Œä¹Ÿæ˜¯ä¸‰ä¸ªæœˆæœ‰æ•ˆæœŸï¼Œå…¶æ ¹è¯ä¹¦äº¤å‰éªŒè¯äº† GlobalSignï¼ŒOCSP æœåŠ¡å™¨åœ¨å›½å†…é€Ÿåº¦ä¹Ÿå¾ˆå¿«ã€‚ è¯¦è§acme.sh/wiki/Google-Public-CA æ­¤åŠŸèƒ½ç›®å‰ï¼ˆ2022-08-10ï¼‰ä»å¤„äº beta çŠ¶æ€ï¼Œéœ€è¦æè¡¨å•ç”³è¯·æ‰èƒ½è·å¾—ä½¿ç”¨ å®˜æ–¹åœ°å€ï¼šhttps://pki.goog/ Entrust: å®˜æ–¹æ–‡æ¡£Entrustâ€™s ACME implementation GlobalSign: å®˜æ–¹æ–‡æ¡£GlobalSign ACME Service è¿™é‡Œä¹Ÿé¡ºä¾¿ä»‹ç»ä¸‹æ”¶è´¹è¯ä¹¦æœåŠ¡å¯¹è¯ä¹¦çš„åˆ†çº§ï¼Œä»¥åŠè¯¥å¦‚ä½•é€‰ç”¨ï¼š Domain Validatedï¼ˆDVï¼‰è¯ä¹¦ ä»…éªŒè¯åŸŸåæ‰€æœ‰æƒï¼ŒéªŒè¯æ­¥éª¤æœ€å°‘ï¼Œä»·æ ¼æœ€ä½ï¼Œä»…éœ€è¦æ•°åˆ†é’Ÿå³å¯ç­¾å‘ã€‚ ä¼˜ç‚¹å°±æ˜¯æ˜“äºç­¾å‘ï¼Œå¾ˆé€‚åˆåšè‡ªåŠ¨åŒ–ã€‚ å„äº‘å‚å•†ï¼ˆAWS/GCP/Cloudflareï¼Œä»¥åŠ Vercel/Github çš„ç«™ç‚¹æœåŠ¡ï¼‰ç»™è‡ªå®¶æœåŠ¡æä¾›çš„å…è´¹è¯ä¹¦éƒ½æ˜¯ DV è¯ä¹¦ï¼ŒLetâ€™s Encrypt çš„è¯ä¹¦ä¹Ÿæ˜¯è¿™ä¸ªç±»å‹ã€‚ å¾ˆæ˜æ˜¾è¿™äº›è¯ä¹¦çš„ç­¾å‘éƒ½éå¸¸æ–¹ä¾¿ï¼Œè€Œä¸”ä»…éªŒè¯åŸŸåæ‰€æœ‰æƒã€‚ ä½†æ˜¯ AWS/GCP/Cloudflare/Vercel/Github æä¾›çš„ DV è¯ä¹¦éƒ½ä»…èƒ½åœ¨å®ƒä»¬çš„äº‘æœåŠ¡ä¸Šä½¿ç”¨ï¼Œä¸æä¾›ç§é’¥å¯¼å‡ºåŠŸèƒ½ï¼ Organization Validated (OV) è¯ä¹¦ æ˜¯ä¼ä¸š SSL è¯ä¹¦çš„é¦–é€‰ï¼Œé€šè¿‡ä¼ä¸šè®¤è¯ç¡®ä¿ä¼ä¸š SSL è¯ä¹¦çš„çœŸå®æ€§ã€‚ é™¤åŸŸåæ‰€æœ‰æƒå¤–ï¼ŒCA æœºæ„è¿˜ä¼šå®¡æ ¸ç»„ç»‡åŠä¼ä¸šçš„çœŸå®æ€§ï¼ŒåŒ…æ‹¬æ³¨å†ŒçŠ¶å†µã€è”ç³»æ–¹å¼ã€æ¶æ„è½¯ä»¶ç­‰å†…å®¹ã€‚ å¦‚æœè¦åšåˆè§„åŒ–ï¼Œå¯èƒ½è‡³å°‘ä¹Ÿå¾—ç”¨ OV è¿™ä¸ªçº§åˆ«çš„è¯ä¹¦ã€‚ Extended Validationï¼ˆEVï¼‰è¯ä¹¦ æœ€ä¸¥æ ¼çš„è®¤è¯æ–¹å¼ï¼ŒCA æœºæ„ä¼šæ·±åº¦å®¡æ ¸ç»„ç»‡åŠä¼ä¸šå„æ–¹é¢çš„ä¿¡æ¯ã€‚ è¢«è®¤ä¸ºé€‚åˆç”¨äºå¤§å‹ä¼ä¸šã€é‡‘èæœºæ„ç­‰ç»„ç»‡æˆ–ä¼ä¸šã€‚ è€Œä¸”ä»…æ”¯æŒç­¾å‘å•åŸŸåã€å¤šåŸŸåè¯ä¹¦ï¼Œä¸æ”¯æŒç­¾å‘æ³›åŸŸåè¯ä¹¦ï¼Œå®‰å…¨æ€§æ æ çš„ã€‚ ACME æ”¯æŒ HTTP01 è·Ÿ DNS01 ä¸¤ç§åŸŸåéªŒè¯æ–¹å¼ï¼Œå…¶ä¸­ DNS01 æ˜¯æœ€ç®€ä¾¿çš„æ–¹æ³•ã€‚ ä¸‹é¢åˆ†åˆ«æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ AWS Route53 è·Ÿ AliDNSï¼Œé€šè¿‡ DNS éªŒè¯æ–¹å¼ç”³è¯·ä¸€ä¸ª Letâ€™s Encrypt è¯ä¹¦ã€‚ ï¼ˆå…¶ä»– DNS æä¾›å•†çš„é…ç½®æ–¹å¼è¯·ç›´æ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼‰ 1.1 ä½¿ç”¨ AWS Route53 åˆ›å»ºä¸€ä¸ªè¯ä¹¦ç­¾å‘è€…ã€ŒCertificate Issuerã€ é AWS Route53 ç”¨æˆ·å¯å¿½ç•¥è¿™ä¸€èŠ‚ https://cert-manager.io/docs/configuration/acme/dns01/route53/ 1.1.1 é€šè¿‡ IAM æˆæƒ cert-manager è°ƒç”¨ AWS Route53 API è¿™é‡Œä»‹ç»ä¸€ç§ä¸éœ€è¦åˆ›å»º ACCESS_KEY_ID/ACCESS_SECRETï¼Œç›´æ¥ä½¿ç”¨ AWS EKS å®˜æ–¹çš„å…å¯†è®¤è¯çš„æ–¹æ³•ã€‚ä¼šæ›´å¤æ‚ä¸€ç‚¹ï¼Œä½†æ˜¯æ›´å®‰å…¨å¯ç»´æŠ¤ã€‚ é¦–å…ˆéœ€è¦ä¸º EKS é›†ç¾¤åˆ›å»º OIDC providerï¼Œå‚è§aws-iam-and-kubernetesï¼Œ è¿™é‡Œä¸å†èµ˜è¿°ã€‚ cert-manager éœ€è¦æŸ¥è¯¢ä¸æ›´æ–° Route53 è®°å½•çš„æƒé™ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨å¦‚ä¸‹é…ç½®åˆ›å»ºä¸€ä¸ª IAM Policyï¼Œ å¯ä»¥å‘½åä¸º CertManagerRoute53Accessï¼ˆæ³¨æ„æ›¿æ¢æ‰ ï¼‰ï¼š json { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Effect\": \"Allow\", \"Action\": \"route53:GetChange\", \"Resource\": \"arn:aws:route53:::change/*\" }, { \"Effect\": \"Allow\", \"Action\": [\"route53:ChangeResourceRecordSets\", \"route53:ListResourceRecordSets\"], \"Resource\": \"arn:aws:route53:::hostedzone/*\" }, { \"Effect\": \"Allow\", \"Action\": \"route53:ListHostedZonesByName\", \"Resource\": \"*\" } ] } æ¯”å¦‚ä½¿ç”¨ awscli åˆ›å»ºæ­¤ policyï¼š shell aws iam create-policy \\ --policy-name XxxCertManagerRoute53Access \\ --policy-document file://cert-manager-route53-access.json ç„¶åé€šè¿‡ä¸Šè¿°é…ç½®åˆ›å»ºä¸€ä¸ª IAM Role å¹¶è‡ªåŠ¨ç»™ cert-manager æ‰€åœ¨çš„ EKS é›†ç¾¤æ·»åŠ ä¿¡ä»»å…³ç³»ï¼š shell export CLUSTER_NAME=\"xxx\" export AWS_ACCOUNT_ID=\"112233445566\" # ä½¿ç”¨ eksctl è‡ªåŠ¨åˆ›å»ºå¯¹åº”çš„ role å¹¶æ·»åŠ ä¿¡ä»»å…³ç³» # éœ€è¦å…ˆå®‰è£…å¥½ eksctl eksctl create iamserviceaccount \\ --cluster \"${CLUSTER_NAME}\" --name cert-manager --namespace cert-manager \\ --role-name \"${CLUSTER_NAME}-cert-manager-route53-role\" \\ --attach-policy-arn \"arn:aws:iam::${AWS_ACCOUNT_ID}:policy/CertManagerRoute53Access\" \\ --role-only \\ --approve ä¹‹åéœ€è¦ä¸º cert-manager çš„ ServiceAccount æ·»åŠ æ³¨è§£æ¥ç»‘å®šä¸Šé¢åˆšåˆ›å»ºå¥½çš„ IAM Roleï¼Œé¦–å…ˆåˆ›å»ºå¦‚ä¸‹ helm values æ–‡ä»¶ cert-manager-values.yaml: yaml # å¦‚æœæŠŠè¿™ä¸ªæ”¹æˆ falseï¼Œä¹Ÿä¼šå¯¼è‡´ cert-manager çš„æ‰€æœ‰ CRDs åŠç›¸å…³èµ„æºè¢«åˆ é™¤ï¼ installCRDs: true serviceAccount: annotations: # æ³¨æ„ä¿®æ”¹è¿™é‡Œçš„ ${AWS_ACCOUNT_ID} ä»¥åŠ ${CLUSTER_NAME} eks.amazonaws.com/role-arn: \u003e- arn:aws:iam::${AWS_ACCOUNT_ID}:role/${CLUSTER_NAME}-cert-manager-route53-role securityContext: enabled: true # æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼Œè¿˜å¾—ä¿®æ”¹ä¸‹è¿™ä¸ªï¼Œå…è®¸ cert-manager è¯»å– ServiceAccount Tokenï¼Œä»è€Œè·å¾—æˆæƒ fsGroup: 1001 ç„¶åé‡æ–°éƒ¨ç½² cert-manager: shell helm upgrade -i cert-manager ./cert-manager -n cert-manager -f cert-manager-values.yaml è¿™æ ·å°±å®Œæˆäº†æˆæƒã€‚ 1.1.2 åˆ›å»ºä¸€ä¸ªä½¿ç”¨ AWS Route53 è¿›è¡ŒéªŒè¯çš„ ACME Issueråœ¨ xxx åå­—ç©ºé—´åˆ›å»ºä¸€ä¸ª Iusserï¼š yaml apiVersion: cert-manager.io/v1 kind: Issuer metadata: name: letsencrypt-prod-aws namespace: xxx spec: acme: # ç”¨äºæ¥å—åŸŸåè¿‡æœŸæé†’çš„é‚®ä»¶åœ°å€ email: user@example.com # ACME æœåŠ¡å™¨ï¼Œæ¯”å¦‚ let's encryptã€Digicert ç­‰ # let's encrypt çš„æµ‹è¯• URLï¼Œå¯ç”¨äºæµ‹è¯•é…ç½®æ­£ç¡®æ€§ # server:","date":"2022-07-31","objectID":"/posts/kubernetes-cert-management/:2:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["æ•°å­—è¯ä¹¦","è¯ä¹¦","TLS","Kubernetes","cert-manager"],"title":"Kubernetes ä¸­çš„è¯ä¹¦ç®¡ç†å·¥å…· - cert-manager","uri":"/posts/kubernetes-cert-management/#1-1-aws-route53"},{"categories":["tech"],"content":" 1. é€šè¿‡æƒå¨æœºæ„åˆ›å»ºå…¬ç½‘å—ä¿¡è¯ä¹¦é€šè¿‡æƒå¨æœºæ„åˆ›å»ºçš„å…¬ç½‘å—ä¿¡è¯ä¹¦ï¼Œå¯ä»¥ç›´æ¥åº”ç”¨åœ¨è¾¹ç•Œç½‘å…³ä¸Šï¼Œç”¨äºç»™å…¬ç½‘ç”¨æˆ·æä¾› TLS åŠ å¯†è®¿é—®æœåŠ¡ï¼Œæ¯”å¦‚å„ç§ HTTPS ç«™ç‚¹ã€APIã€‚è¿™æ˜¯éœ€æ±‚æœ€å¹¿çš„ä¸€ç±»æ•°å­—è¯ä¹¦æœåŠ¡ã€‚ cert-manager æ”¯æŒä¸¤ç§ç”³è¯·å…¬ç½‘å—ä¿¡è¯ä¹¦çš„æ–¹å¼ï¼š ACMEï¼ˆAutomated Certificate Management Environment (ACME) Certificate Authority serverï¼‰è¯ä¹¦è‡ªåŠ¨åŒ–ç”³è¯·ä¸ç®¡ç†åè®®ã€‚ venafi-as-a-service: venafi æ˜¯ä¸€ä¸ªè¯ä¹¦çš„é›†ä¸­åŒ–ç®¡ç†å¹³å°ï¼Œå®ƒä¹Ÿæä¾›äº† cert-manager æ’ä»¶ï¼Œå¯ç”¨äºè‡ªåŠ¨åŒ–ç”³è¯· DigiCert/Entrust/GlobalSign/Letâ€™s Encrypt å››ç§ç±»å‹çš„å…¬ç½‘å—ä¿¡è¯ä¹¦ã€‚ è¿™é‡Œä¸»è¦ä»‹ç»ä½¿ç”¨ ACMEv2 åè®®ç”³è¯·å…¬ç½‘è¯ä¹¦ï¼Œæ”¯æŒä½¿ç”¨æ­¤å¼€æ”¾åè®®ç”³è¯·è¯ä¹¦çš„æƒå¨æœºæ„æœ‰ï¼š å…è´¹æœåŠ¡ Letâ€™s Encrypt: ä¼—æ‰€å‘¨çŸ¥ï¼Œå®ƒæä¾›ä¸‰ä¸ªæœˆæœ‰æ•ˆæœŸçš„å…è´¹è¯ä¹¦ã€‚ ZeroSSL: è²Œä¼¼ä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒæœ‰åçš„ SSL è¯ä¹¦æœåŠ¡ é€šè¿‡ ACME åè®®æ”¯æŒä¸é™æ•°é‡çš„ 90 å¤©è¯ä¹¦ï¼Œä¹Ÿæ”¯æŒå¤šåŸŸåè¯ä¹¦ä¸æ³›åŸŸåè¯ä¹¦ã€‚ å®ƒæä¾›äº†ä¸€ä¸ªé¢å¤–çš„ Dashboard æŸ¥çœ‹ä¸ç®¡ç†æ‰€æœ‰ç”³è¯·çš„è¯ä¹¦ï¼Œè¿™æ˜¯æ¯”è¾ƒæ–¹ä¾¿çš„åœ°æ–¹ã€‚ ä»˜è´¹æœåŠ¡ DigiCert: è¿™ä¸ªéå¸¸æœ‰åï¼ˆä½†ä¹Ÿæ˜¯ç›¸å½“è´µï¼‰ï¼Œå®˜æ–¹æ–‡æ¡£Digicert - Third-party ACME client automation Google Public Authority(Google Trust Services): Google æ¨å‡ºçš„å…¬ç½‘è¯ä¹¦æœåŠ¡ï¼Œä¹Ÿæ˜¯ä¸‰ä¸ªæœˆæœ‰æ•ˆæœŸï¼Œå…¶æ ¹è¯ä¹¦äº¤å‰éªŒè¯äº† GlobalSignï¼ŒOCSP æœåŠ¡å™¨åœ¨å›½å†…é€Ÿåº¦ä¹Ÿå¾ˆå¿«ã€‚ è¯¦è§acme.sh/wiki/Google-Public-CA æ­¤åŠŸèƒ½ç›®å‰ï¼ˆ2022-08-10ï¼‰ä»å¤„äº beta çŠ¶æ€ï¼Œéœ€è¦æè¡¨å•ç”³è¯·æ‰èƒ½è·å¾—ä½¿ç”¨ å®˜æ–¹åœ°å€ï¼šhttps://pki.goog/ Entrust: å®˜æ–¹æ–‡æ¡£Entrustâ€™s ACME implementation GlobalSign: å®˜æ–¹æ–‡æ¡£GlobalSign ACME Service è¿™é‡Œä¹Ÿé¡ºä¾¿ä»‹ç»ä¸‹æ”¶è´¹è¯ä¹¦æœåŠ¡å¯¹è¯ä¹¦çš„åˆ†çº§ï¼Œä»¥åŠè¯¥å¦‚ä½•é€‰ç”¨ï¼š Domain Validatedï¼ˆDVï¼‰è¯ä¹¦ ä»…éªŒè¯åŸŸåæ‰€æœ‰æƒï¼ŒéªŒè¯æ­¥éª¤æœ€å°‘ï¼Œä»·æ ¼æœ€ä½ï¼Œä»…éœ€è¦æ•°åˆ†é’Ÿå³å¯ç­¾å‘ã€‚ ä¼˜ç‚¹å°±æ˜¯æ˜“äºç­¾å‘ï¼Œå¾ˆé€‚åˆåšè‡ªåŠ¨åŒ–ã€‚ å„äº‘å‚å•†ï¼ˆAWS/GCP/Cloudflareï¼Œä»¥åŠ Vercel/Github çš„ç«™ç‚¹æœåŠ¡ï¼‰ç»™è‡ªå®¶æœåŠ¡æä¾›çš„å…è´¹è¯ä¹¦éƒ½æ˜¯ DV è¯ä¹¦ï¼ŒLetâ€™s Encrypt çš„è¯ä¹¦ä¹Ÿæ˜¯è¿™ä¸ªç±»å‹ã€‚ å¾ˆæ˜æ˜¾è¿™äº›è¯ä¹¦çš„ç­¾å‘éƒ½éå¸¸æ–¹ä¾¿ï¼Œè€Œä¸”ä»…éªŒè¯åŸŸåæ‰€æœ‰æƒã€‚ ä½†æ˜¯ AWS/GCP/Cloudflare/Vercel/Github æä¾›çš„ DV è¯ä¹¦éƒ½ä»…èƒ½åœ¨å®ƒä»¬çš„äº‘æœåŠ¡ä¸Šä½¿ç”¨ï¼Œä¸æä¾›ç§é’¥å¯¼å‡ºåŠŸèƒ½ï¼ Organization Validated (OV) è¯ä¹¦ æ˜¯ä¼ä¸š SSL è¯ä¹¦çš„é¦–é€‰ï¼Œé€šè¿‡ä¼ä¸šè®¤è¯ç¡®ä¿ä¼ä¸š SSL è¯ä¹¦çš„çœŸå®æ€§ã€‚ é™¤åŸŸåæ‰€æœ‰æƒå¤–ï¼ŒCA æœºæ„è¿˜ä¼šå®¡æ ¸ç»„ç»‡åŠä¼ä¸šçš„çœŸå®æ€§ï¼ŒåŒ…æ‹¬æ³¨å†ŒçŠ¶å†µã€è”ç³»æ–¹å¼ã€æ¶æ„è½¯ä»¶ç­‰å†…å®¹ã€‚ å¦‚æœè¦åšåˆè§„åŒ–ï¼Œå¯èƒ½è‡³å°‘ä¹Ÿå¾—ç”¨ OV è¿™ä¸ªçº§åˆ«çš„è¯ä¹¦ã€‚ Extended Validationï¼ˆEVï¼‰è¯ä¹¦ æœ€ä¸¥æ ¼çš„è®¤è¯æ–¹å¼ï¼ŒCA æœºæ„ä¼šæ·±åº¦å®¡æ ¸ç»„ç»‡åŠä¼ä¸šå„æ–¹é¢çš„ä¿¡æ¯ã€‚ è¢«è®¤ä¸ºé€‚åˆç”¨äºå¤§å‹ä¼ä¸šã€é‡‘èæœºæ„ç­‰ç»„ç»‡æˆ–ä¼ä¸šã€‚ è€Œä¸”ä»…æ”¯æŒç­¾å‘å•åŸŸåã€å¤šåŸŸåè¯ä¹¦ï¼Œä¸æ”¯æŒç­¾å‘æ³›åŸŸåè¯ä¹¦ï¼Œå®‰å…¨æ€§æ æ çš„ã€‚ ACME æ”¯æŒ HTTP01 è·Ÿ DNS01 ä¸¤ç§åŸŸåéªŒè¯æ–¹å¼ï¼Œå…¶ä¸­ DNS01 æ˜¯æœ€ç®€ä¾¿çš„æ–¹æ³•ã€‚ ä¸‹é¢åˆ†åˆ«æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ AWS Route53 è·Ÿ AliDNSï¼Œé€šè¿‡ DNS éªŒè¯æ–¹å¼ç”³è¯·ä¸€ä¸ª Letâ€™s Encrypt è¯ä¹¦ã€‚ ï¼ˆå…¶ä»– DNS æä¾›å•†çš„é…ç½®æ–¹å¼è¯·ç›´æ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼‰ 1.1 ä½¿ç”¨ AWS Route53 åˆ›å»ºä¸€ä¸ªè¯ä¹¦ç­¾å‘è€…ã€ŒCertificate Issuerã€ é AWS Route53 ç”¨æˆ·å¯å¿½ç•¥è¿™ä¸€èŠ‚ https://cert-manager.io/docs/configuration/acme/dns01/route53/ 1.1.1 é€šè¿‡ IAM æˆæƒ cert-manager è°ƒç”¨ AWS Route53 API è¿™é‡Œä»‹ç»ä¸€ç§ä¸éœ€è¦åˆ›å»º ACCESS_KEY_ID/ACCESS_SECRETï¼Œç›´æ¥ä½¿ç”¨ AWS EKS å®˜æ–¹çš„å…å¯†è®¤è¯çš„æ–¹æ³•ã€‚ä¼šæ›´å¤æ‚ä¸€ç‚¹ï¼Œä½†æ˜¯æ›´å®‰å…¨å¯ç»´æŠ¤ã€‚ é¦–å…ˆéœ€è¦ä¸º EKS é›†ç¾¤åˆ›å»º OIDC providerï¼Œå‚è§aws-iam-and-kubernetesï¼Œ è¿™é‡Œä¸å†èµ˜è¿°ã€‚ cert-manager éœ€è¦æŸ¥è¯¢ä¸æ›´æ–° Route53 è®°å½•çš„æƒé™ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨å¦‚ä¸‹é…ç½®åˆ›å»ºä¸€ä¸ª IAM Policyï¼Œ å¯ä»¥å‘½åä¸º CertManagerRoute53Accessï¼ˆæ³¨æ„æ›¿æ¢æ‰ ï¼‰ï¼š json { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Effect\": \"Allow\", \"Action\": \"route53:GetChange\", \"Resource\": \"arn:aws:route53:::change/*\" }, { \"Effect\": \"Allow\", \"Action\": [\"route53:ChangeResourceRecordSets\", \"route53:ListResourceRecordSets\"], \"Resource\": \"arn:aws:route53:::hostedzone/*\" }, { \"Effect\": \"Allow\", \"Action\": \"route53:ListHostedZonesByName\", \"Resource\": \"*\" } ] } æ¯”å¦‚ä½¿ç”¨ awscli åˆ›å»ºæ­¤ policyï¼š shell aws iam create-policy \\ --policy-name XxxCertManagerRoute53Access \\ --policy-document file://cert-manager-route53-access.json ç„¶åé€šè¿‡ä¸Šè¿°é…ç½®åˆ›å»ºä¸€ä¸ª IAM Role å¹¶è‡ªåŠ¨ç»™ cert-manager æ‰€åœ¨çš„ EKS é›†ç¾¤æ·»åŠ ä¿¡ä»»å…³ç³»ï¼š shell export CLUSTER_NAME=\"xxx\" export AWS_ACCOUNT_ID=\"112233445566\" # ä½¿ç”¨ eksctl è‡ªåŠ¨åˆ›å»ºå¯¹åº”çš„ role å¹¶æ·»åŠ ä¿¡ä»»å…³ç³» # éœ€è¦å…ˆå®‰è£…å¥½ eksctl eksctl create iamserviceaccount \\ --cluster \"${CLUSTER_NAME}\" --name cert-manager --namespace cert-manager \\ --role-name \"${CLUSTER_NAME}-cert-manager-route53-role\" \\ --attach-policy-arn \"arn:aws:iam::${AWS_ACCOUNT_ID}:policy/CertManagerRoute53Access\" \\ --role-only \\ --approve ä¹‹åéœ€è¦ä¸º cert-manager çš„ ServiceAccount æ·»åŠ æ³¨è§£æ¥ç»‘å®šä¸Šé¢åˆšåˆ›å»ºå¥½çš„ IAM Roleï¼Œé¦–å…ˆåˆ›å»ºå¦‚ä¸‹ helm values æ–‡ä»¶ cert-manager-values.yaml: yaml # å¦‚æœæŠŠè¿™ä¸ªæ”¹æˆ falseï¼Œä¹Ÿä¼šå¯¼è‡´ cert-manager çš„æ‰€æœ‰ CRDs åŠç›¸å…³èµ„æºè¢«åˆ é™¤ï¼ installCRDs: true serviceAccount: annotations: # æ³¨æ„ä¿®æ”¹è¿™é‡Œçš„ ${AWS_ACCOUNT_ID} ä»¥åŠ ${CLUSTER_NAME} eks.amazonaws.com/role-arn: \u003e- arn:aws:iam::${AWS_ACCOUNT_ID}:role/${CLUSTER_NAME}-cert-manager-route53-role securityContext: enabled: true # æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼Œè¿˜å¾—ä¿®æ”¹ä¸‹è¿™ä¸ªï¼Œå…è®¸ cert-manager è¯»å– ServiceAccount Tokenï¼Œä»è€Œè·å¾—æˆæƒ fsGroup: 1001 ç„¶åé‡æ–°éƒ¨ç½² cert-manager: shell helm upgrade -i cert-manager ./cert-manager -n cert-manager -f cert-manager-values.yaml è¿™æ ·å°±å®Œæˆäº†æˆæƒã€‚ 1.1.2 åˆ›å»ºä¸€ä¸ªä½¿ç”¨ AWS Route53 è¿›è¡ŒéªŒè¯çš„ ACME Issueråœ¨ xxx åå­—ç©ºé—´åˆ›å»ºä¸€ä¸ª Iusserï¼š yaml apiVersion: cert-manager.io/v1 kind: Issuer metadata: name: letsencrypt-prod-aws namespace: xxx spec: acme: # ç”¨äºæ¥å—åŸŸåè¿‡æœŸæé†’çš„é‚®ä»¶åœ°å€ email: user@example.com # ACME æœåŠ¡å™¨ï¼Œæ¯”å¦‚ let's encryptã€Digicert ç­‰ # let's encrypt çš„æµ‹è¯• URLï¼Œå¯ç”¨äºæµ‹è¯•é…ç½®æ­£ç¡®æ€§ # server:","date":"2022-07-31","objectID":"/posts/kubernetes-cert-management/:2:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["æ•°å­—è¯ä¹¦","è¯ä¹¦","TLS","Kubernetes","cert-manager"],"title":"Kubernetes ä¸­çš„è¯ä¹¦ç®¡ç†å·¥å…· - cert-manager","uri":"/posts/kubernetes-cert-management/#1-1-1-iam-cert-manager-aws-route53-api"},{"categories":["tech"],"content":" 1. é€šè¿‡æƒå¨æœºæ„åˆ›å»ºå…¬ç½‘å—ä¿¡è¯ä¹¦é€šè¿‡æƒå¨æœºæ„åˆ›å»ºçš„å…¬ç½‘å—ä¿¡è¯ä¹¦ï¼Œå¯ä»¥ç›´æ¥åº”ç”¨åœ¨è¾¹ç•Œç½‘å…³ä¸Šï¼Œç”¨äºç»™å…¬ç½‘ç”¨æˆ·æä¾› TLS åŠ å¯†è®¿é—®æœåŠ¡ï¼Œæ¯”å¦‚å„ç§ HTTPS ç«™ç‚¹ã€APIã€‚è¿™æ˜¯éœ€æ±‚æœ€å¹¿çš„ä¸€ç±»æ•°å­—è¯ä¹¦æœåŠ¡ã€‚ cert-manager æ”¯æŒä¸¤ç§ç”³è¯·å…¬ç½‘å—ä¿¡è¯ä¹¦çš„æ–¹å¼ï¼š ACMEï¼ˆAutomated Certificate Management Environment (ACME) Certificate Authority serverï¼‰è¯ä¹¦è‡ªåŠ¨åŒ–ç”³è¯·ä¸ç®¡ç†åè®®ã€‚ venafi-as-a-service: venafi æ˜¯ä¸€ä¸ªè¯ä¹¦çš„é›†ä¸­åŒ–ç®¡ç†å¹³å°ï¼Œå®ƒä¹Ÿæä¾›äº† cert-manager æ’ä»¶ï¼Œå¯ç”¨äºè‡ªåŠ¨åŒ–ç”³è¯· DigiCert/Entrust/GlobalSign/Letâ€™s Encrypt å››ç§ç±»å‹çš„å…¬ç½‘å—ä¿¡è¯ä¹¦ã€‚ è¿™é‡Œä¸»è¦ä»‹ç»ä½¿ç”¨ ACMEv2 åè®®ç”³è¯·å…¬ç½‘è¯ä¹¦ï¼Œæ”¯æŒä½¿ç”¨æ­¤å¼€æ”¾åè®®ç”³è¯·è¯ä¹¦çš„æƒå¨æœºæ„æœ‰ï¼š å…è´¹æœåŠ¡ Letâ€™s Encrypt: ä¼—æ‰€å‘¨çŸ¥ï¼Œå®ƒæä¾›ä¸‰ä¸ªæœˆæœ‰æ•ˆæœŸçš„å…è´¹è¯ä¹¦ã€‚ ZeroSSL: è²Œä¼¼ä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒæœ‰åçš„ SSL è¯ä¹¦æœåŠ¡ é€šè¿‡ ACME åè®®æ”¯æŒä¸é™æ•°é‡çš„ 90 å¤©è¯ä¹¦ï¼Œä¹Ÿæ”¯æŒå¤šåŸŸåè¯ä¹¦ä¸æ³›åŸŸåè¯ä¹¦ã€‚ å®ƒæä¾›äº†ä¸€ä¸ªé¢å¤–çš„ Dashboard æŸ¥çœ‹ä¸ç®¡ç†æ‰€æœ‰ç”³è¯·çš„è¯ä¹¦ï¼Œè¿™æ˜¯æ¯”è¾ƒæ–¹ä¾¿çš„åœ°æ–¹ã€‚ ä»˜è´¹æœåŠ¡ DigiCert: è¿™ä¸ªéå¸¸æœ‰åï¼ˆä½†ä¹Ÿæ˜¯ç›¸å½“è´µï¼‰ï¼Œå®˜æ–¹æ–‡æ¡£Digicert - Third-party ACME client automation Google Public Authority(Google Trust Services): Google æ¨å‡ºçš„å…¬ç½‘è¯ä¹¦æœåŠ¡ï¼Œä¹Ÿæ˜¯ä¸‰ä¸ªæœˆæœ‰æ•ˆæœŸï¼Œå…¶æ ¹è¯ä¹¦äº¤å‰éªŒè¯äº† GlobalSignï¼ŒOCSP æœåŠ¡å™¨åœ¨å›½å†…é€Ÿåº¦ä¹Ÿå¾ˆå¿«ã€‚ è¯¦è§acme.sh/wiki/Google-Public-CA æ­¤åŠŸèƒ½ç›®å‰ï¼ˆ2022-08-10ï¼‰ä»å¤„äº beta çŠ¶æ€ï¼Œéœ€è¦æè¡¨å•ç”³è¯·æ‰èƒ½è·å¾—ä½¿ç”¨ å®˜æ–¹åœ°å€ï¼šhttps://pki.goog/ Entrust: å®˜æ–¹æ–‡æ¡£Entrustâ€™s ACME implementation GlobalSign: å®˜æ–¹æ–‡æ¡£GlobalSign ACME Service è¿™é‡Œä¹Ÿé¡ºä¾¿ä»‹ç»ä¸‹æ”¶è´¹è¯ä¹¦æœåŠ¡å¯¹è¯ä¹¦çš„åˆ†çº§ï¼Œä»¥åŠè¯¥å¦‚ä½•é€‰ç”¨ï¼š Domain Validatedï¼ˆDVï¼‰è¯ä¹¦ ä»…éªŒè¯åŸŸåæ‰€æœ‰æƒï¼ŒéªŒè¯æ­¥éª¤æœ€å°‘ï¼Œä»·æ ¼æœ€ä½ï¼Œä»…éœ€è¦æ•°åˆ†é’Ÿå³å¯ç­¾å‘ã€‚ ä¼˜ç‚¹å°±æ˜¯æ˜“äºç­¾å‘ï¼Œå¾ˆé€‚åˆåšè‡ªåŠ¨åŒ–ã€‚ å„äº‘å‚å•†ï¼ˆAWS/GCP/Cloudflareï¼Œä»¥åŠ Vercel/Github çš„ç«™ç‚¹æœåŠ¡ï¼‰ç»™è‡ªå®¶æœåŠ¡æä¾›çš„å…è´¹è¯ä¹¦éƒ½æ˜¯ DV è¯ä¹¦ï¼ŒLetâ€™s Encrypt çš„è¯ä¹¦ä¹Ÿæ˜¯è¿™ä¸ªç±»å‹ã€‚ å¾ˆæ˜æ˜¾è¿™äº›è¯ä¹¦çš„ç­¾å‘éƒ½éå¸¸æ–¹ä¾¿ï¼Œè€Œä¸”ä»…éªŒè¯åŸŸåæ‰€æœ‰æƒã€‚ ä½†æ˜¯ AWS/GCP/Cloudflare/Vercel/Github æä¾›çš„ DV è¯ä¹¦éƒ½ä»…èƒ½åœ¨å®ƒä»¬çš„äº‘æœåŠ¡ä¸Šä½¿ç”¨ï¼Œä¸æä¾›ç§é’¥å¯¼å‡ºåŠŸèƒ½ï¼ Organization Validated (OV) è¯ä¹¦ æ˜¯ä¼ä¸š SSL è¯ä¹¦çš„é¦–é€‰ï¼Œé€šè¿‡ä¼ä¸šè®¤è¯ç¡®ä¿ä¼ä¸š SSL è¯ä¹¦çš„çœŸå®æ€§ã€‚ é™¤åŸŸåæ‰€æœ‰æƒå¤–ï¼ŒCA æœºæ„è¿˜ä¼šå®¡æ ¸ç»„ç»‡åŠä¼ä¸šçš„çœŸå®æ€§ï¼ŒåŒ…æ‹¬æ³¨å†ŒçŠ¶å†µã€è”ç³»æ–¹å¼ã€æ¶æ„è½¯ä»¶ç­‰å†…å®¹ã€‚ å¦‚æœè¦åšåˆè§„åŒ–ï¼Œå¯èƒ½è‡³å°‘ä¹Ÿå¾—ç”¨ OV è¿™ä¸ªçº§åˆ«çš„è¯ä¹¦ã€‚ Extended Validationï¼ˆEVï¼‰è¯ä¹¦ æœ€ä¸¥æ ¼çš„è®¤è¯æ–¹å¼ï¼ŒCA æœºæ„ä¼šæ·±åº¦å®¡æ ¸ç»„ç»‡åŠä¼ä¸šå„æ–¹é¢çš„ä¿¡æ¯ã€‚ è¢«è®¤ä¸ºé€‚åˆç”¨äºå¤§å‹ä¼ä¸šã€é‡‘èæœºæ„ç­‰ç»„ç»‡æˆ–ä¼ä¸šã€‚ è€Œä¸”ä»…æ”¯æŒç­¾å‘å•åŸŸåã€å¤šåŸŸåè¯ä¹¦ï¼Œä¸æ”¯æŒç­¾å‘æ³›åŸŸåè¯ä¹¦ï¼Œå®‰å…¨æ€§æ æ çš„ã€‚ ACME æ”¯æŒ HTTP01 è·Ÿ DNS01 ä¸¤ç§åŸŸåéªŒè¯æ–¹å¼ï¼Œå…¶ä¸­ DNS01 æ˜¯æœ€ç®€ä¾¿çš„æ–¹æ³•ã€‚ ä¸‹é¢åˆ†åˆ«æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ AWS Route53 è·Ÿ AliDNSï¼Œé€šè¿‡ DNS éªŒè¯æ–¹å¼ç”³è¯·ä¸€ä¸ª Letâ€™s Encrypt è¯ä¹¦ã€‚ ï¼ˆå…¶ä»– DNS æä¾›å•†çš„é…ç½®æ–¹å¼è¯·ç›´æ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼‰ 1.1 ä½¿ç”¨ AWS Route53 åˆ›å»ºä¸€ä¸ªè¯ä¹¦ç­¾å‘è€…ã€ŒCertificate Issuerã€ é AWS Route53 ç”¨æˆ·å¯å¿½ç•¥è¿™ä¸€èŠ‚ https://cert-manager.io/docs/configuration/acme/dns01/route53/ 1.1.1 é€šè¿‡ IAM æˆæƒ cert-manager è°ƒç”¨ AWS Route53 API è¿™é‡Œä»‹ç»ä¸€ç§ä¸éœ€è¦åˆ›å»º ACCESS_KEY_ID/ACCESS_SECRETï¼Œç›´æ¥ä½¿ç”¨ AWS EKS å®˜æ–¹çš„å…å¯†è®¤è¯çš„æ–¹æ³•ã€‚ä¼šæ›´å¤æ‚ä¸€ç‚¹ï¼Œä½†æ˜¯æ›´å®‰å…¨å¯ç»´æŠ¤ã€‚ é¦–å…ˆéœ€è¦ä¸º EKS é›†ç¾¤åˆ›å»º OIDC providerï¼Œå‚è§aws-iam-and-kubernetesï¼Œ è¿™é‡Œä¸å†èµ˜è¿°ã€‚ cert-manager éœ€è¦æŸ¥è¯¢ä¸æ›´æ–° Route53 è®°å½•çš„æƒé™ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨å¦‚ä¸‹é…ç½®åˆ›å»ºä¸€ä¸ª IAM Policyï¼Œ å¯ä»¥å‘½åä¸º CertManagerRoute53Accessï¼ˆæ³¨æ„æ›¿æ¢æ‰ ï¼‰ï¼š json { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Effect\": \"Allow\", \"Action\": \"route53:GetChange\", \"Resource\": \"arn:aws:route53:::change/*\" }, { \"Effect\": \"Allow\", \"Action\": [\"route53:ChangeResourceRecordSets\", \"route53:ListResourceRecordSets\"], \"Resource\": \"arn:aws:route53:::hostedzone/*\" }, { \"Effect\": \"Allow\", \"Action\": \"route53:ListHostedZonesByName\", \"Resource\": \"*\" } ] } æ¯”å¦‚ä½¿ç”¨ awscli åˆ›å»ºæ­¤ policyï¼š shell aws iam create-policy \\ --policy-name XxxCertManagerRoute53Access \\ --policy-document file://cert-manager-route53-access.json ç„¶åé€šè¿‡ä¸Šè¿°é…ç½®åˆ›å»ºä¸€ä¸ª IAM Role å¹¶è‡ªåŠ¨ç»™ cert-manager æ‰€åœ¨çš„ EKS é›†ç¾¤æ·»åŠ ä¿¡ä»»å…³ç³»ï¼š shell export CLUSTER_NAME=\"xxx\" export AWS_ACCOUNT_ID=\"112233445566\" # ä½¿ç”¨ eksctl è‡ªåŠ¨åˆ›å»ºå¯¹åº”çš„ role å¹¶æ·»åŠ ä¿¡ä»»å…³ç³» # éœ€è¦å…ˆå®‰è£…å¥½ eksctl eksctl create iamserviceaccount \\ --cluster \"${CLUSTER_NAME}\" --name cert-manager --namespace cert-manager \\ --role-name \"${CLUSTER_NAME}-cert-manager-route53-role\" \\ --attach-policy-arn \"arn:aws:iam::${AWS_ACCOUNT_ID}:policy/CertManagerRoute53Access\" \\ --role-only \\ --approve ä¹‹åéœ€è¦ä¸º cert-manager çš„ ServiceAccount æ·»åŠ æ³¨è§£æ¥ç»‘å®šä¸Šé¢åˆšåˆ›å»ºå¥½çš„ IAM Roleï¼Œé¦–å…ˆåˆ›å»ºå¦‚ä¸‹ helm values æ–‡ä»¶ cert-manager-values.yaml: yaml # å¦‚æœæŠŠè¿™ä¸ªæ”¹æˆ falseï¼Œä¹Ÿä¼šå¯¼è‡´ cert-manager çš„æ‰€æœ‰ CRDs åŠç›¸å…³èµ„æºè¢«åˆ é™¤ï¼ installCRDs: true serviceAccount: annotations: # æ³¨æ„ä¿®æ”¹è¿™é‡Œçš„ ${AWS_ACCOUNT_ID} ä»¥åŠ ${CLUSTER_NAME} eks.amazonaws.com/role-arn: \u003e- arn:aws:iam::${AWS_ACCOUNT_ID}:role/${CLUSTER_NAME}-cert-manager-route53-role securityContext: enabled: true # æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼Œè¿˜å¾—ä¿®æ”¹ä¸‹è¿™ä¸ªï¼Œå…è®¸ cert-manager è¯»å– ServiceAccount Tokenï¼Œä»è€Œè·å¾—æˆæƒ fsGroup: 1001 ç„¶åé‡æ–°éƒ¨ç½² cert-manager: shell helm upgrade -i cert-manager ./cert-manager -n cert-manager -f cert-manager-values.yaml è¿™æ ·å°±å®Œæˆäº†æˆæƒã€‚ 1.1.2 åˆ›å»ºä¸€ä¸ªä½¿ç”¨ AWS Route53 è¿›è¡ŒéªŒè¯çš„ ACME Issueråœ¨ xxx åå­—ç©ºé—´åˆ›å»ºä¸€ä¸ª Iusserï¼š yaml apiVersion: cert-manager.io/v1 kind: Issuer metadata: name: letsencrypt-prod-aws namespace: xxx spec: acme: # ç”¨äºæ¥å—åŸŸåè¿‡æœŸæé†’çš„é‚®ä»¶åœ°å€ email: user@example.com # ACME æœåŠ¡å™¨ï¼Œæ¯”å¦‚ let's encryptã€Digicert ç­‰ # let's encrypt çš„æµ‹è¯• URLï¼Œå¯ç”¨äºæµ‹è¯•é…ç½®æ­£ç¡®æ€§ # server:","date":"2022-07-31","objectID":"/posts/kubernetes-cert-management/:2:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["æ•°å­—è¯ä¹¦","è¯ä¹¦","TLS","Kubernetes","cert-manager"],"title":"Kubernetes ä¸­çš„è¯ä¹¦ç®¡ç†å·¥å…· - cert-manager","uri":"/posts/kubernetes-cert-management/#1-1-2-aws-route53-acme-issuer"},{"categories":["tech"],"content":" 1. é€šè¿‡æƒå¨æœºæ„åˆ›å»ºå…¬ç½‘å—ä¿¡è¯ä¹¦é€šè¿‡æƒå¨æœºæ„åˆ›å»ºçš„å…¬ç½‘å—ä¿¡è¯ä¹¦ï¼Œå¯ä»¥ç›´æ¥åº”ç”¨åœ¨è¾¹ç•Œç½‘å…³ä¸Šï¼Œç”¨äºç»™å…¬ç½‘ç”¨æˆ·æä¾› TLS åŠ å¯†è®¿é—®æœåŠ¡ï¼Œæ¯”å¦‚å„ç§ HTTPS ç«™ç‚¹ã€APIã€‚è¿™æ˜¯éœ€æ±‚æœ€å¹¿çš„ä¸€ç±»æ•°å­—è¯ä¹¦æœåŠ¡ã€‚ cert-manager æ”¯æŒä¸¤ç§ç”³è¯·å…¬ç½‘å—ä¿¡è¯ä¹¦çš„æ–¹å¼ï¼š ACMEï¼ˆAutomated Certificate Management Environment (ACME) Certificate Authority serverï¼‰è¯ä¹¦è‡ªåŠ¨åŒ–ç”³è¯·ä¸ç®¡ç†åè®®ã€‚ venafi-as-a-service: venafi æ˜¯ä¸€ä¸ªè¯ä¹¦çš„é›†ä¸­åŒ–ç®¡ç†å¹³å°ï¼Œå®ƒä¹Ÿæä¾›äº† cert-manager æ’ä»¶ï¼Œå¯ç”¨äºè‡ªåŠ¨åŒ–ç”³è¯· DigiCert/Entrust/GlobalSign/Letâ€™s Encrypt å››ç§ç±»å‹çš„å…¬ç½‘å—ä¿¡è¯ä¹¦ã€‚ è¿™é‡Œä¸»è¦ä»‹ç»ä½¿ç”¨ ACMEv2 åè®®ç”³è¯·å…¬ç½‘è¯ä¹¦ï¼Œæ”¯æŒä½¿ç”¨æ­¤å¼€æ”¾åè®®ç”³è¯·è¯ä¹¦çš„æƒå¨æœºæ„æœ‰ï¼š å…è´¹æœåŠ¡ Letâ€™s Encrypt: ä¼—æ‰€å‘¨çŸ¥ï¼Œå®ƒæä¾›ä¸‰ä¸ªæœˆæœ‰æ•ˆæœŸçš„å…è´¹è¯ä¹¦ã€‚ ZeroSSL: è²Œä¼¼ä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒæœ‰åçš„ SSL è¯ä¹¦æœåŠ¡ é€šè¿‡ ACME åè®®æ”¯æŒä¸é™æ•°é‡çš„ 90 å¤©è¯ä¹¦ï¼Œä¹Ÿæ”¯æŒå¤šåŸŸåè¯ä¹¦ä¸æ³›åŸŸåè¯ä¹¦ã€‚ å®ƒæä¾›äº†ä¸€ä¸ªé¢å¤–çš„ Dashboard æŸ¥çœ‹ä¸ç®¡ç†æ‰€æœ‰ç”³è¯·çš„è¯ä¹¦ï¼Œè¿™æ˜¯æ¯”è¾ƒæ–¹ä¾¿çš„åœ°æ–¹ã€‚ ä»˜è´¹æœåŠ¡ DigiCert: è¿™ä¸ªéå¸¸æœ‰åï¼ˆä½†ä¹Ÿæ˜¯ç›¸å½“è´µï¼‰ï¼Œå®˜æ–¹æ–‡æ¡£Digicert - Third-party ACME client automation Google Public Authority(Google Trust Services): Google æ¨å‡ºçš„å…¬ç½‘è¯ä¹¦æœåŠ¡ï¼Œä¹Ÿæ˜¯ä¸‰ä¸ªæœˆæœ‰æ•ˆæœŸï¼Œå…¶æ ¹è¯ä¹¦äº¤å‰éªŒè¯äº† GlobalSignï¼ŒOCSP æœåŠ¡å™¨åœ¨å›½å†…é€Ÿåº¦ä¹Ÿå¾ˆå¿«ã€‚ è¯¦è§acme.sh/wiki/Google-Public-CA æ­¤åŠŸèƒ½ç›®å‰ï¼ˆ2022-08-10ï¼‰ä»å¤„äº beta çŠ¶æ€ï¼Œéœ€è¦æè¡¨å•ç”³è¯·æ‰èƒ½è·å¾—ä½¿ç”¨ å®˜æ–¹åœ°å€ï¼šhttps://pki.goog/ Entrust: å®˜æ–¹æ–‡æ¡£Entrustâ€™s ACME implementation GlobalSign: å®˜æ–¹æ–‡æ¡£GlobalSign ACME Service è¿™é‡Œä¹Ÿé¡ºä¾¿ä»‹ç»ä¸‹æ”¶è´¹è¯ä¹¦æœåŠ¡å¯¹è¯ä¹¦çš„åˆ†çº§ï¼Œä»¥åŠè¯¥å¦‚ä½•é€‰ç”¨ï¼š Domain Validatedï¼ˆDVï¼‰è¯ä¹¦ ä»…éªŒè¯åŸŸåæ‰€æœ‰æƒï¼ŒéªŒè¯æ­¥éª¤æœ€å°‘ï¼Œä»·æ ¼æœ€ä½ï¼Œä»…éœ€è¦æ•°åˆ†é’Ÿå³å¯ç­¾å‘ã€‚ ä¼˜ç‚¹å°±æ˜¯æ˜“äºç­¾å‘ï¼Œå¾ˆé€‚åˆåšè‡ªåŠ¨åŒ–ã€‚ å„äº‘å‚å•†ï¼ˆAWS/GCP/Cloudflareï¼Œä»¥åŠ Vercel/Github çš„ç«™ç‚¹æœåŠ¡ï¼‰ç»™è‡ªå®¶æœåŠ¡æä¾›çš„å…è´¹è¯ä¹¦éƒ½æ˜¯ DV è¯ä¹¦ï¼ŒLetâ€™s Encrypt çš„è¯ä¹¦ä¹Ÿæ˜¯è¿™ä¸ªç±»å‹ã€‚ å¾ˆæ˜æ˜¾è¿™äº›è¯ä¹¦çš„ç­¾å‘éƒ½éå¸¸æ–¹ä¾¿ï¼Œè€Œä¸”ä»…éªŒè¯åŸŸåæ‰€æœ‰æƒã€‚ ä½†æ˜¯ AWS/GCP/Cloudflare/Vercel/Github æä¾›çš„ DV è¯ä¹¦éƒ½ä»…èƒ½åœ¨å®ƒä»¬çš„äº‘æœåŠ¡ä¸Šä½¿ç”¨ï¼Œä¸æä¾›ç§é’¥å¯¼å‡ºåŠŸèƒ½ï¼ Organization Validated (OV) è¯ä¹¦ æ˜¯ä¼ä¸š SSL è¯ä¹¦çš„é¦–é€‰ï¼Œé€šè¿‡ä¼ä¸šè®¤è¯ç¡®ä¿ä¼ä¸š SSL è¯ä¹¦çš„çœŸå®æ€§ã€‚ é™¤åŸŸåæ‰€æœ‰æƒå¤–ï¼ŒCA æœºæ„è¿˜ä¼šå®¡æ ¸ç»„ç»‡åŠä¼ä¸šçš„çœŸå®æ€§ï¼ŒåŒ…æ‹¬æ³¨å†ŒçŠ¶å†µã€è”ç³»æ–¹å¼ã€æ¶æ„è½¯ä»¶ç­‰å†…å®¹ã€‚ å¦‚æœè¦åšåˆè§„åŒ–ï¼Œå¯èƒ½è‡³å°‘ä¹Ÿå¾—ç”¨ OV è¿™ä¸ªçº§åˆ«çš„è¯ä¹¦ã€‚ Extended Validationï¼ˆEVï¼‰è¯ä¹¦ æœ€ä¸¥æ ¼çš„è®¤è¯æ–¹å¼ï¼ŒCA æœºæ„ä¼šæ·±åº¦å®¡æ ¸ç»„ç»‡åŠä¼ä¸šå„æ–¹é¢çš„ä¿¡æ¯ã€‚ è¢«è®¤ä¸ºé€‚åˆç”¨äºå¤§å‹ä¼ä¸šã€é‡‘èæœºæ„ç­‰ç»„ç»‡æˆ–ä¼ä¸šã€‚ è€Œä¸”ä»…æ”¯æŒç­¾å‘å•åŸŸåã€å¤šåŸŸåè¯ä¹¦ï¼Œä¸æ”¯æŒç­¾å‘æ³›åŸŸåè¯ä¹¦ï¼Œå®‰å…¨æ€§æ æ çš„ã€‚ ACME æ”¯æŒ HTTP01 è·Ÿ DNS01 ä¸¤ç§åŸŸåéªŒè¯æ–¹å¼ï¼Œå…¶ä¸­ DNS01 æ˜¯æœ€ç®€ä¾¿çš„æ–¹æ³•ã€‚ ä¸‹é¢åˆ†åˆ«æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ AWS Route53 è·Ÿ AliDNSï¼Œé€šè¿‡ DNS éªŒè¯æ–¹å¼ç”³è¯·ä¸€ä¸ª Letâ€™s Encrypt è¯ä¹¦ã€‚ ï¼ˆå…¶ä»– DNS æä¾›å•†çš„é…ç½®æ–¹å¼è¯·ç›´æ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼‰ 1.1 ä½¿ç”¨ AWS Route53 åˆ›å»ºä¸€ä¸ªè¯ä¹¦ç­¾å‘è€…ã€ŒCertificate Issuerã€ é AWS Route53 ç”¨æˆ·å¯å¿½ç•¥è¿™ä¸€èŠ‚ https://cert-manager.io/docs/configuration/acme/dns01/route53/ 1.1.1 é€šè¿‡ IAM æˆæƒ cert-manager è°ƒç”¨ AWS Route53 API è¿™é‡Œä»‹ç»ä¸€ç§ä¸éœ€è¦åˆ›å»º ACCESS_KEY_ID/ACCESS_SECRETï¼Œç›´æ¥ä½¿ç”¨ AWS EKS å®˜æ–¹çš„å…å¯†è®¤è¯çš„æ–¹æ³•ã€‚ä¼šæ›´å¤æ‚ä¸€ç‚¹ï¼Œä½†æ˜¯æ›´å®‰å…¨å¯ç»´æŠ¤ã€‚ é¦–å…ˆéœ€è¦ä¸º EKS é›†ç¾¤åˆ›å»º OIDC providerï¼Œå‚è§aws-iam-and-kubernetesï¼Œ è¿™é‡Œä¸å†èµ˜è¿°ã€‚ cert-manager éœ€è¦æŸ¥è¯¢ä¸æ›´æ–° Route53 è®°å½•çš„æƒé™ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨å¦‚ä¸‹é…ç½®åˆ›å»ºä¸€ä¸ª IAM Policyï¼Œ å¯ä»¥å‘½åä¸º CertManagerRoute53Accessï¼ˆæ³¨æ„æ›¿æ¢æ‰ ï¼‰ï¼š json { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Effect\": \"Allow\", \"Action\": \"route53:GetChange\", \"Resource\": \"arn:aws:route53:::change/*\" }, { \"Effect\": \"Allow\", \"Action\": [\"route53:ChangeResourceRecordSets\", \"route53:ListResourceRecordSets\"], \"Resource\": \"arn:aws:route53:::hostedzone/*\" }, { \"Effect\": \"Allow\", \"Action\": \"route53:ListHostedZonesByName\", \"Resource\": \"*\" } ] } æ¯”å¦‚ä½¿ç”¨ awscli åˆ›å»ºæ­¤ policyï¼š shell aws iam create-policy \\ --policy-name XxxCertManagerRoute53Access \\ --policy-document file://cert-manager-route53-access.json ç„¶åé€šè¿‡ä¸Šè¿°é…ç½®åˆ›å»ºä¸€ä¸ª IAM Role å¹¶è‡ªåŠ¨ç»™ cert-manager æ‰€åœ¨çš„ EKS é›†ç¾¤æ·»åŠ ä¿¡ä»»å…³ç³»ï¼š shell export CLUSTER_NAME=\"xxx\" export AWS_ACCOUNT_ID=\"112233445566\" # ä½¿ç”¨ eksctl è‡ªåŠ¨åˆ›å»ºå¯¹åº”çš„ role å¹¶æ·»åŠ ä¿¡ä»»å…³ç³» # éœ€è¦å…ˆå®‰è£…å¥½ eksctl eksctl create iamserviceaccount \\ --cluster \"${CLUSTER_NAME}\" --name cert-manager --namespace cert-manager \\ --role-name \"${CLUSTER_NAME}-cert-manager-route53-role\" \\ --attach-policy-arn \"arn:aws:iam::${AWS_ACCOUNT_ID}:policy/CertManagerRoute53Access\" \\ --role-only \\ --approve ä¹‹åéœ€è¦ä¸º cert-manager çš„ ServiceAccount æ·»åŠ æ³¨è§£æ¥ç»‘å®šä¸Šé¢åˆšåˆ›å»ºå¥½çš„ IAM Roleï¼Œé¦–å…ˆåˆ›å»ºå¦‚ä¸‹ helm values æ–‡ä»¶ cert-manager-values.yaml: yaml # å¦‚æœæŠŠè¿™ä¸ªæ”¹æˆ falseï¼Œä¹Ÿä¼šå¯¼è‡´ cert-manager çš„æ‰€æœ‰ CRDs åŠç›¸å…³èµ„æºè¢«åˆ é™¤ï¼ installCRDs: true serviceAccount: annotations: # æ³¨æ„ä¿®æ”¹è¿™é‡Œçš„ ${AWS_ACCOUNT_ID} ä»¥åŠ ${CLUSTER_NAME} eks.amazonaws.com/role-arn: \u003e- arn:aws:iam::${AWS_ACCOUNT_ID}:role/${CLUSTER_NAME}-cert-manager-route53-role securityContext: enabled: true # æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼Œè¿˜å¾—ä¿®æ”¹ä¸‹è¿™ä¸ªï¼Œå…è®¸ cert-manager è¯»å– ServiceAccount Tokenï¼Œä»è€Œè·å¾—æˆæƒ fsGroup: 1001 ç„¶åé‡æ–°éƒ¨ç½² cert-manager: shell helm upgrade -i cert-manager ./cert-manager -n cert-manager -f cert-manager-values.yaml è¿™æ ·å°±å®Œæˆäº†æˆæƒã€‚ 1.1.2 åˆ›å»ºä¸€ä¸ªä½¿ç”¨ AWS Route53 è¿›è¡ŒéªŒè¯çš„ ACME Issueråœ¨ xxx åå­—ç©ºé—´åˆ›å»ºä¸€ä¸ª Iusserï¼š yaml apiVersion: cert-manager.io/v1 kind: Issuer metadata: name: letsencrypt-prod-aws namespace: xxx spec: acme: # ç”¨äºæ¥å—åŸŸåè¿‡æœŸæé†’çš„é‚®ä»¶åœ°å€ email: user@example.com # ACME æœåŠ¡å™¨ï¼Œæ¯”å¦‚ let's encryptã€Digicert ç­‰ # let's encrypt çš„æµ‹è¯• URLï¼Œå¯ç”¨äºæµ‹è¯•é…ç½®æ­£ç¡®æ€§ # server:","date":"2022-07-31","objectID":"/posts/kubernetes-cert-management/:2:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["æ•°å­—è¯ä¹¦","è¯ä¹¦","TLS","Kubernetes","cert-manager"],"title":"Kubernetes ä¸­çš„è¯ä¹¦ç®¡ç†å·¥å…· - cert-manager","uri":"/posts/kubernetes-cert-management/#1-2-alidns-certificate-issuer"},{"categories":["tech"],"content":" 1. é€šè¿‡æƒå¨æœºæ„åˆ›å»ºå…¬ç½‘å—ä¿¡è¯ä¹¦é€šè¿‡æƒå¨æœºæ„åˆ›å»ºçš„å…¬ç½‘å—ä¿¡è¯ä¹¦ï¼Œå¯ä»¥ç›´æ¥åº”ç”¨åœ¨è¾¹ç•Œç½‘å…³ä¸Šï¼Œç”¨äºç»™å…¬ç½‘ç”¨æˆ·æä¾› TLS åŠ å¯†è®¿é—®æœåŠ¡ï¼Œæ¯”å¦‚å„ç§ HTTPS ç«™ç‚¹ã€APIã€‚è¿™æ˜¯éœ€æ±‚æœ€å¹¿çš„ä¸€ç±»æ•°å­—è¯ä¹¦æœåŠ¡ã€‚ cert-manager æ”¯æŒä¸¤ç§ç”³è¯·å…¬ç½‘å—ä¿¡è¯ä¹¦çš„æ–¹å¼ï¼š ACMEï¼ˆAutomated Certificate Management Environment (ACME) Certificate Authority serverï¼‰è¯ä¹¦è‡ªåŠ¨åŒ–ç”³è¯·ä¸ç®¡ç†åè®®ã€‚ venafi-as-a-service: venafi æ˜¯ä¸€ä¸ªè¯ä¹¦çš„é›†ä¸­åŒ–ç®¡ç†å¹³å°ï¼Œå®ƒä¹Ÿæä¾›äº† cert-manager æ’ä»¶ï¼Œå¯ç”¨äºè‡ªåŠ¨åŒ–ç”³è¯· DigiCert/Entrust/GlobalSign/Letâ€™s Encrypt å››ç§ç±»å‹çš„å…¬ç½‘å—ä¿¡è¯ä¹¦ã€‚ è¿™é‡Œä¸»è¦ä»‹ç»ä½¿ç”¨ ACMEv2 åè®®ç”³è¯·å…¬ç½‘è¯ä¹¦ï¼Œæ”¯æŒä½¿ç”¨æ­¤å¼€æ”¾åè®®ç”³è¯·è¯ä¹¦çš„æƒå¨æœºæ„æœ‰ï¼š å…è´¹æœåŠ¡ Letâ€™s Encrypt: ä¼—æ‰€å‘¨çŸ¥ï¼Œå®ƒæä¾›ä¸‰ä¸ªæœˆæœ‰æ•ˆæœŸçš„å…è´¹è¯ä¹¦ã€‚ ZeroSSL: è²Œä¼¼ä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒæœ‰åçš„ SSL è¯ä¹¦æœåŠ¡ é€šè¿‡ ACME åè®®æ”¯æŒä¸é™æ•°é‡çš„ 90 å¤©è¯ä¹¦ï¼Œä¹Ÿæ”¯æŒå¤šåŸŸåè¯ä¹¦ä¸æ³›åŸŸåè¯ä¹¦ã€‚ å®ƒæä¾›äº†ä¸€ä¸ªé¢å¤–çš„ Dashboard æŸ¥çœ‹ä¸ç®¡ç†æ‰€æœ‰ç”³è¯·çš„è¯ä¹¦ï¼Œè¿™æ˜¯æ¯”è¾ƒæ–¹ä¾¿çš„åœ°æ–¹ã€‚ ä»˜è´¹æœåŠ¡ DigiCert: è¿™ä¸ªéå¸¸æœ‰åï¼ˆä½†ä¹Ÿæ˜¯ç›¸å½“è´µï¼‰ï¼Œå®˜æ–¹æ–‡æ¡£Digicert - Third-party ACME client automation Google Public Authority(Google Trust Services): Google æ¨å‡ºçš„å…¬ç½‘è¯ä¹¦æœåŠ¡ï¼Œä¹Ÿæ˜¯ä¸‰ä¸ªæœˆæœ‰æ•ˆæœŸï¼Œå…¶æ ¹è¯ä¹¦äº¤å‰éªŒè¯äº† GlobalSignï¼ŒOCSP æœåŠ¡å™¨åœ¨å›½å†…é€Ÿåº¦ä¹Ÿå¾ˆå¿«ã€‚ è¯¦è§acme.sh/wiki/Google-Public-CA æ­¤åŠŸèƒ½ç›®å‰ï¼ˆ2022-08-10ï¼‰ä»å¤„äº beta çŠ¶æ€ï¼Œéœ€è¦æè¡¨å•ç”³è¯·æ‰èƒ½è·å¾—ä½¿ç”¨ å®˜æ–¹åœ°å€ï¼šhttps://pki.goog/ Entrust: å®˜æ–¹æ–‡æ¡£Entrustâ€™s ACME implementation GlobalSign: å®˜æ–¹æ–‡æ¡£GlobalSign ACME Service è¿™é‡Œä¹Ÿé¡ºä¾¿ä»‹ç»ä¸‹æ”¶è´¹è¯ä¹¦æœåŠ¡å¯¹è¯ä¹¦çš„åˆ†çº§ï¼Œä»¥åŠè¯¥å¦‚ä½•é€‰ç”¨ï¼š Domain Validatedï¼ˆDVï¼‰è¯ä¹¦ ä»…éªŒè¯åŸŸåæ‰€æœ‰æƒï¼ŒéªŒè¯æ­¥éª¤æœ€å°‘ï¼Œä»·æ ¼æœ€ä½ï¼Œä»…éœ€è¦æ•°åˆ†é’Ÿå³å¯ç­¾å‘ã€‚ ä¼˜ç‚¹å°±æ˜¯æ˜“äºç­¾å‘ï¼Œå¾ˆé€‚åˆåšè‡ªåŠ¨åŒ–ã€‚ å„äº‘å‚å•†ï¼ˆAWS/GCP/Cloudflareï¼Œä»¥åŠ Vercel/Github çš„ç«™ç‚¹æœåŠ¡ï¼‰ç»™è‡ªå®¶æœåŠ¡æä¾›çš„å…è´¹è¯ä¹¦éƒ½æ˜¯ DV è¯ä¹¦ï¼ŒLetâ€™s Encrypt çš„è¯ä¹¦ä¹Ÿæ˜¯è¿™ä¸ªç±»å‹ã€‚ å¾ˆæ˜æ˜¾è¿™äº›è¯ä¹¦çš„ç­¾å‘éƒ½éå¸¸æ–¹ä¾¿ï¼Œè€Œä¸”ä»…éªŒè¯åŸŸåæ‰€æœ‰æƒã€‚ ä½†æ˜¯ AWS/GCP/Cloudflare/Vercel/Github æä¾›çš„ DV è¯ä¹¦éƒ½ä»…èƒ½åœ¨å®ƒä»¬çš„äº‘æœåŠ¡ä¸Šä½¿ç”¨ï¼Œä¸æä¾›ç§é’¥å¯¼å‡ºåŠŸèƒ½ï¼ Organization Validated (OV) è¯ä¹¦ æ˜¯ä¼ä¸š SSL è¯ä¹¦çš„é¦–é€‰ï¼Œé€šè¿‡ä¼ä¸šè®¤è¯ç¡®ä¿ä¼ä¸š SSL è¯ä¹¦çš„çœŸå®æ€§ã€‚ é™¤åŸŸåæ‰€æœ‰æƒå¤–ï¼ŒCA æœºæ„è¿˜ä¼šå®¡æ ¸ç»„ç»‡åŠä¼ä¸šçš„çœŸå®æ€§ï¼ŒåŒ…æ‹¬æ³¨å†ŒçŠ¶å†µã€è”ç³»æ–¹å¼ã€æ¶æ„è½¯ä»¶ç­‰å†…å®¹ã€‚ å¦‚æœè¦åšåˆè§„åŒ–ï¼Œå¯èƒ½è‡³å°‘ä¹Ÿå¾—ç”¨ OV è¿™ä¸ªçº§åˆ«çš„è¯ä¹¦ã€‚ Extended Validationï¼ˆEVï¼‰è¯ä¹¦ æœ€ä¸¥æ ¼çš„è®¤è¯æ–¹å¼ï¼ŒCA æœºæ„ä¼šæ·±åº¦å®¡æ ¸ç»„ç»‡åŠä¼ä¸šå„æ–¹é¢çš„ä¿¡æ¯ã€‚ è¢«è®¤ä¸ºé€‚åˆç”¨äºå¤§å‹ä¼ä¸šã€é‡‘èæœºæ„ç­‰ç»„ç»‡æˆ–ä¼ä¸šã€‚ è€Œä¸”ä»…æ”¯æŒç­¾å‘å•åŸŸåã€å¤šåŸŸåè¯ä¹¦ï¼Œä¸æ”¯æŒç­¾å‘æ³›åŸŸåè¯ä¹¦ï¼Œå®‰å…¨æ€§æ æ çš„ã€‚ ACME æ”¯æŒ HTTP01 è·Ÿ DNS01 ä¸¤ç§åŸŸåéªŒè¯æ–¹å¼ï¼Œå…¶ä¸­ DNS01 æ˜¯æœ€ç®€ä¾¿çš„æ–¹æ³•ã€‚ ä¸‹é¢åˆ†åˆ«æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ AWS Route53 è·Ÿ AliDNSï¼Œé€šè¿‡ DNS éªŒè¯æ–¹å¼ç”³è¯·ä¸€ä¸ª Letâ€™s Encrypt è¯ä¹¦ã€‚ ï¼ˆå…¶ä»– DNS æä¾›å•†çš„é…ç½®æ–¹å¼è¯·ç›´æ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼‰ 1.1 ä½¿ç”¨ AWS Route53 åˆ›å»ºä¸€ä¸ªè¯ä¹¦ç­¾å‘è€…ã€ŒCertificate Issuerã€ é AWS Route53 ç”¨æˆ·å¯å¿½ç•¥è¿™ä¸€èŠ‚ https://cert-manager.io/docs/configuration/acme/dns01/route53/ 1.1.1 é€šè¿‡ IAM æˆæƒ cert-manager è°ƒç”¨ AWS Route53 API è¿™é‡Œä»‹ç»ä¸€ç§ä¸éœ€è¦åˆ›å»º ACCESS_KEY_ID/ACCESS_SECRETï¼Œç›´æ¥ä½¿ç”¨ AWS EKS å®˜æ–¹çš„å…å¯†è®¤è¯çš„æ–¹æ³•ã€‚ä¼šæ›´å¤æ‚ä¸€ç‚¹ï¼Œä½†æ˜¯æ›´å®‰å…¨å¯ç»´æŠ¤ã€‚ é¦–å…ˆéœ€è¦ä¸º EKS é›†ç¾¤åˆ›å»º OIDC providerï¼Œå‚è§aws-iam-and-kubernetesï¼Œ è¿™é‡Œä¸å†èµ˜è¿°ã€‚ cert-manager éœ€è¦æŸ¥è¯¢ä¸æ›´æ–° Route53 è®°å½•çš„æƒé™ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨å¦‚ä¸‹é…ç½®åˆ›å»ºä¸€ä¸ª IAM Policyï¼Œ å¯ä»¥å‘½åä¸º CertManagerRoute53Accessï¼ˆæ³¨æ„æ›¿æ¢æ‰ ï¼‰ï¼š json { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Effect\": \"Allow\", \"Action\": \"route53:GetChange\", \"Resource\": \"arn:aws:route53:::change/*\" }, { \"Effect\": \"Allow\", \"Action\": [\"route53:ChangeResourceRecordSets\", \"route53:ListResourceRecordSets\"], \"Resource\": \"arn:aws:route53:::hostedzone/*\" }, { \"Effect\": \"Allow\", \"Action\": \"route53:ListHostedZonesByName\", \"Resource\": \"*\" } ] } æ¯”å¦‚ä½¿ç”¨ awscli åˆ›å»ºæ­¤ policyï¼š shell aws iam create-policy \\ --policy-name XxxCertManagerRoute53Access \\ --policy-document file://cert-manager-route53-access.json ç„¶åé€šè¿‡ä¸Šè¿°é…ç½®åˆ›å»ºä¸€ä¸ª IAM Role å¹¶è‡ªåŠ¨ç»™ cert-manager æ‰€åœ¨çš„ EKS é›†ç¾¤æ·»åŠ ä¿¡ä»»å…³ç³»ï¼š shell export CLUSTER_NAME=\"xxx\" export AWS_ACCOUNT_ID=\"112233445566\" # ä½¿ç”¨ eksctl è‡ªåŠ¨åˆ›å»ºå¯¹åº”çš„ role å¹¶æ·»åŠ ä¿¡ä»»å…³ç³» # éœ€è¦å…ˆå®‰è£…å¥½ eksctl eksctl create iamserviceaccount \\ --cluster \"${CLUSTER_NAME}\" --name cert-manager --namespace cert-manager \\ --role-name \"${CLUSTER_NAME}-cert-manager-route53-role\" \\ --attach-policy-arn \"arn:aws:iam::${AWS_ACCOUNT_ID}:policy/CertManagerRoute53Access\" \\ --role-only \\ --approve ä¹‹åéœ€è¦ä¸º cert-manager çš„ ServiceAccount æ·»åŠ æ³¨è§£æ¥ç»‘å®šä¸Šé¢åˆšåˆ›å»ºå¥½çš„ IAM Roleï¼Œé¦–å…ˆåˆ›å»ºå¦‚ä¸‹ helm values æ–‡ä»¶ cert-manager-values.yaml: yaml # å¦‚æœæŠŠè¿™ä¸ªæ”¹æˆ falseï¼Œä¹Ÿä¼šå¯¼è‡´ cert-manager çš„æ‰€æœ‰ CRDs åŠç›¸å…³èµ„æºè¢«åˆ é™¤ï¼ installCRDs: true serviceAccount: annotations: # æ³¨æ„ä¿®æ”¹è¿™é‡Œçš„ ${AWS_ACCOUNT_ID} ä»¥åŠ ${CLUSTER_NAME} eks.amazonaws.com/role-arn: \u003e- arn:aws:iam::${AWS_ACCOUNT_ID}:role/${CLUSTER_NAME}-cert-manager-route53-role securityContext: enabled: true # æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼Œè¿˜å¾—ä¿®æ”¹ä¸‹è¿™ä¸ªï¼Œå…è®¸ cert-manager è¯»å– ServiceAccount Tokenï¼Œä»è€Œè·å¾—æˆæƒ fsGroup: 1001 ç„¶åé‡æ–°éƒ¨ç½² cert-manager: shell helm upgrade -i cert-manager ./cert-manager -n cert-manager -f cert-manager-values.yaml è¿™æ ·å°±å®Œæˆäº†æˆæƒã€‚ 1.1.2 åˆ›å»ºä¸€ä¸ªä½¿ç”¨ AWS Route53 è¿›è¡ŒéªŒè¯çš„ ACME Issueråœ¨ xxx åå­—ç©ºé—´åˆ›å»ºä¸€ä¸ª Iusserï¼š yaml apiVersion: cert-manager.io/v1 kind: Issuer metadata: name: letsencrypt-prod-aws namespace: xxx spec: acme: # ç”¨äºæ¥å—åŸŸåè¿‡æœŸæé†’çš„é‚®ä»¶åœ°å€ email: user@example.com # ACME æœåŠ¡å™¨ï¼Œæ¯”å¦‚ let's encryptã€Digicert ç­‰ # let's encrypt çš„æµ‹è¯• URLï¼Œå¯ç”¨äºæµ‹è¯•é…ç½®æ­£ç¡®æ€§ # server:","date":"2022-07-31","objectID":"/posts/kubernetes-cert-management/:2:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["æ•°å­—è¯ä¹¦","è¯ä¹¦","TLS","Kubernetes","cert-manager"],"title":"Kubernetes ä¸­çš„è¯ä¹¦ç®¡ç†å·¥å…· - cert-manager","uri":"/posts/kubernetes-cert-management/#111-é€šè¿‡-iam-æˆæƒ-cert-manager-è°ƒç”¨-aws-route53-api"},{"categories":["tech"],"content":" 1. é€šè¿‡æƒå¨æœºæ„åˆ›å»ºå…¬ç½‘å—ä¿¡è¯ä¹¦é€šè¿‡æƒå¨æœºæ„åˆ›å»ºçš„å…¬ç½‘å—ä¿¡è¯ä¹¦ï¼Œå¯ä»¥ç›´æ¥åº”ç”¨åœ¨è¾¹ç•Œç½‘å…³ä¸Šï¼Œç”¨äºç»™å…¬ç½‘ç”¨æˆ·æä¾› TLS åŠ å¯†è®¿é—®æœåŠ¡ï¼Œæ¯”å¦‚å„ç§ HTTPS ç«™ç‚¹ã€APIã€‚è¿™æ˜¯éœ€æ±‚æœ€å¹¿çš„ä¸€ç±»æ•°å­—è¯ä¹¦æœåŠ¡ã€‚ cert-manager æ”¯æŒä¸¤ç§ç”³è¯·å…¬ç½‘å—ä¿¡è¯ä¹¦çš„æ–¹å¼ï¼š ACMEï¼ˆAutomated Certificate Management Environment (ACME) Certificate Authority serverï¼‰è¯ä¹¦è‡ªåŠ¨åŒ–ç”³è¯·ä¸ç®¡ç†åè®®ã€‚ venafi-as-a-service: venafi æ˜¯ä¸€ä¸ªè¯ä¹¦çš„é›†ä¸­åŒ–ç®¡ç†å¹³å°ï¼Œå®ƒä¹Ÿæä¾›äº† cert-manager æ’ä»¶ï¼Œå¯ç”¨äºè‡ªåŠ¨åŒ–ç”³è¯· DigiCert/Entrust/GlobalSign/Letâ€™s Encrypt å››ç§ç±»å‹çš„å…¬ç½‘å—ä¿¡è¯ä¹¦ã€‚ è¿™é‡Œä¸»è¦ä»‹ç»ä½¿ç”¨ ACMEv2 åè®®ç”³è¯·å…¬ç½‘è¯ä¹¦ï¼Œæ”¯æŒä½¿ç”¨æ­¤å¼€æ”¾åè®®ç”³è¯·è¯ä¹¦çš„æƒå¨æœºæ„æœ‰ï¼š å…è´¹æœåŠ¡ Letâ€™s Encrypt: ä¼—æ‰€å‘¨çŸ¥ï¼Œå®ƒæä¾›ä¸‰ä¸ªæœˆæœ‰æ•ˆæœŸçš„å…è´¹è¯ä¹¦ã€‚ ZeroSSL: è²Œä¼¼ä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒæœ‰åçš„ SSL è¯ä¹¦æœåŠ¡ é€šè¿‡ ACME åè®®æ”¯æŒä¸é™æ•°é‡çš„ 90 å¤©è¯ä¹¦ï¼Œä¹Ÿæ”¯æŒå¤šåŸŸåè¯ä¹¦ä¸æ³›åŸŸåè¯ä¹¦ã€‚ å®ƒæä¾›äº†ä¸€ä¸ªé¢å¤–çš„ Dashboard æŸ¥çœ‹ä¸ç®¡ç†æ‰€æœ‰ç”³è¯·çš„è¯ä¹¦ï¼Œè¿™æ˜¯æ¯”è¾ƒæ–¹ä¾¿çš„åœ°æ–¹ã€‚ ä»˜è´¹æœåŠ¡ DigiCert: è¿™ä¸ªéå¸¸æœ‰åï¼ˆä½†ä¹Ÿæ˜¯ç›¸å½“è´µï¼‰ï¼Œå®˜æ–¹æ–‡æ¡£Digicert - Third-party ACME client automation Google Public Authority(Google Trust Services): Google æ¨å‡ºçš„å…¬ç½‘è¯ä¹¦æœåŠ¡ï¼Œä¹Ÿæ˜¯ä¸‰ä¸ªæœˆæœ‰æ•ˆæœŸï¼Œå…¶æ ¹è¯ä¹¦äº¤å‰éªŒè¯äº† GlobalSignï¼ŒOCSP æœåŠ¡å™¨åœ¨å›½å†…é€Ÿåº¦ä¹Ÿå¾ˆå¿«ã€‚ è¯¦è§acme.sh/wiki/Google-Public-CA æ­¤åŠŸèƒ½ç›®å‰ï¼ˆ2022-08-10ï¼‰ä»å¤„äº beta çŠ¶æ€ï¼Œéœ€è¦æè¡¨å•ç”³è¯·æ‰èƒ½è·å¾—ä½¿ç”¨ å®˜æ–¹åœ°å€ï¼šhttps://pki.goog/ Entrust: å®˜æ–¹æ–‡æ¡£Entrustâ€™s ACME implementation GlobalSign: å®˜æ–¹æ–‡æ¡£GlobalSign ACME Service è¿™é‡Œä¹Ÿé¡ºä¾¿ä»‹ç»ä¸‹æ”¶è´¹è¯ä¹¦æœåŠ¡å¯¹è¯ä¹¦çš„åˆ†çº§ï¼Œä»¥åŠè¯¥å¦‚ä½•é€‰ç”¨ï¼š Domain Validatedï¼ˆDVï¼‰è¯ä¹¦ ä»…éªŒè¯åŸŸåæ‰€æœ‰æƒï¼ŒéªŒè¯æ­¥éª¤æœ€å°‘ï¼Œä»·æ ¼æœ€ä½ï¼Œä»…éœ€è¦æ•°åˆ†é’Ÿå³å¯ç­¾å‘ã€‚ ä¼˜ç‚¹å°±æ˜¯æ˜“äºç­¾å‘ï¼Œå¾ˆé€‚åˆåšè‡ªåŠ¨åŒ–ã€‚ å„äº‘å‚å•†ï¼ˆAWS/GCP/Cloudflareï¼Œä»¥åŠ Vercel/Github çš„ç«™ç‚¹æœåŠ¡ï¼‰ç»™è‡ªå®¶æœåŠ¡æä¾›çš„å…è´¹è¯ä¹¦éƒ½æ˜¯ DV è¯ä¹¦ï¼ŒLetâ€™s Encrypt çš„è¯ä¹¦ä¹Ÿæ˜¯è¿™ä¸ªç±»å‹ã€‚ å¾ˆæ˜æ˜¾è¿™äº›è¯ä¹¦çš„ç­¾å‘éƒ½éå¸¸æ–¹ä¾¿ï¼Œè€Œä¸”ä»…éªŒè¯åŸŸåæ‰€æœ‰æƒã€‚ ä½†æ˜¯ AWS/GCP/Cloudflare/Vercel/Github æä¾›çš„ DV è¯ä¹¦éƒ½ä»…èƒ½åœ¨å®ƒä»¬çš„äº‘æœåŠ¡ä¸Šä½¿ç”¨ï¼Œä¸æä¾›ç§é’¥å¯¼å‡ºåŠŸèƒ½ï¼ Organization Validated (OV) è¯ä¹¦ æ˜¯ä¼ä¸š SSL è¯ä¹¦çš„é¦–é€‰ï¼Œé€šè¿‡ä¼ä¸šè®¤è¯ç¡®ä¿ä¼ä¸š SSL è¯ä¹¦çš„çœŸå®æ€§ã€‚ é™¤åŸŸåæ‰€æœ‰æƒå¤–ï¼ŒCA æœºæ„è¿˜ä¼šå®¡æ ¸ç»„ç»‡åŠä¼ä¸šçš„çœŸå®æ€§ï¼ŒåŒ…æ‹¬æ³¨å†ŒçŠ¶å†µã€è”ç³»æ–¹å¼ã€æ¶æ„è½¯ä»¶ç­‰å†…å®¹ã€‚ å¦‚æœè¦åšåˆè§„åŒ–ï¼Œå¯èƒ½è‡³å°‘ä¹Ÿå¾—ç”¨ OV è¿™ä¸ªçº§åˆ«çš„è¯ä¹¦ã€‚ Extended Validationï¼ˆEVï¼‰è¯ä¹¦ æœ€ä¸¥æ ¼çš„è®¤è¯æ–¹å¼ï¼ŒCA æœºæ„ä¼šæ·±åº¦å®¡æ ¸ç»„ç»‡åŠä¼ä¸šå„æ–¹é¢çš„ä¿¡æ¯ã€‚ è¢«è®¤ä¸ºé€‚åˆç”¨äºå¤§å‹ä¼ä¸šã€é‡‘èæœºæ„ç­‰ç»„ç»‡æˆ–ä¼ä¸šã€‚ è€Œä¸”ä»…æ”¯æŒç­¾å‘å•åŸŸåã€å¤šåŸŸåè¯ä¹¦ï¼Œä¸æ”¯æŒç­¾å‘æ³›åŸŸåè¯ä¹¦ï¼Œå®‰å…¨æ€§æ æ çš„ã€‚ ACME æ”¯æŒ HTTP01 è·Ÿ DNS01 ä¸¤ç§åŸŸåéªŒè¯æ–¹å¼ï¼Œå…¶ä¸­ DNS01 æ˜¯æœ€ç®€ä¾¿çš„æ–¹æ³•ã€‚ ä¸‹é¢åˆ†åˆ«æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ AWS Route53 è·Ÿ AliDNSï¼Œé€šè¿‡ DNS éªŒè¯æ–¹å¼ç”³è¯·ä¸€ä¸ª Letâ€™s Encrypt è¯ä¹¦ã€‚ ï¼ˆå…¶ä»– DNS æä¾›å•†çš„é…ç½®æ–¹å¼è¯·ç›´æ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼‰ 1.1 ä½¿ç”¨ AWS Route53 åˆ›å»ºä¸€ä¸ªè¯ä¹¦ç­¾å‘è€…ã€ŒCertificate Issuerã€ é AWS Route53 ç”¨æˆ·å¯å¿½ç•¥è¿™ä¸€èŠ‚ https://cert-manager.io/docs/configuration/acme/dns01/route53/ 1.1.1 é€šè¿‡ IAM æˆæƒ cert-manager è°ƒç”¨ AWS Route53 API è¿™é‡Œä»‹ç»ä¸€ç§ä¸éœ€è¦åˆ›å»º ACCESS_KEY_ID/ACCESS_SECRETï¼Œç›´æ¥ä½¿ç”¨ AWS EKS å®˜æ–¹çš„å…å¯†è®¤è¯çš„æ–¹æ³•ã€‚ä¼šæ›´å¤æ‚ä¸€ç‚¹ï¼Œä½†æ˜¯æ›´å®‰å…¨å¯ç»´æŠ¤ã€‚ é¦–å…ˆéœ€è¦ä¸º EKS é›†ç¾¤åˆ›å»º OIDC providerï¼Œå‚è§aws-iam-and-kubernetesï¼Œ è¿™é‡Œä¸å†èµ˜è¿°ã€‚ cert-manager éœ€è¦æŸ¥è¯¢ä¸æ›´æ–° Route53 è®°å½•çš„æƒé™ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨å¦‚ä¸‹é…ç½®åˆ›å»ºä¸€ä¸ª IAM Policyï¼Œ å¯ä»¥å‘½åä¸º CertManagerRoute53Accessï¼ˆæ³¨æ„æ›¿æ¢æ‰ ï¼‰ï¼š json { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Effect\": \"Allow\", \"Action\": \"route53:GetChange\", \"Resource\": \"arn:aws:route53:::change/*\" }, { \"Effect\": \"Allow\", \"Action\": [\"route53:ChangeResourceRecordSets\", \"route53:ListResourceRecordSets\"], \"Resource\": \"arn:aws:route53:::hostedzone/*\" }, { \"Effect\": \"Allow\", \"Action\": \"route53:ListHostedZonesByName\", \"Resource\": \"*\" } ] } æ¯”å¦‚ä½¿ç”¨ awscli åˆ›å»ºæ­¤ policyï¼š shell aws iam create-policy \\ --policy-name XxxCertManagerRoute53Access \\ --policy-document file://cert-manager-route53-access.json ç„¶åé€šè¿‡ä¸Šè¿°é…ç½®åˆ›å»ºä¸€ä¸ª IAM Role å¹¶è‡ªåŠ¨ç»™ cert-manager æ‰€åœ¨çš„ EKS é›†ç¾¤æ·»åŠ ä¿¡ä»»å…³ç³»ï¼š shell export CLUSTER_NAME=\"xxx\" export AWS_ACCOUNT_ID=\"112233445566\" # ä½¿ç”¨ eksctl è‡ªåŠ¨åˆ›å»ºå¯¹åº”çš„ role å¹¶æ·»åŠ ä¿¡ä»»å…³ç³» # éœ€è¦å…ˆå®‰è£…å¥½ eksctl eksctl create iamserviceaccount \\ --cluster \"${CLUSTER_NAME}\" --name cert-manager --namespace cert-manager \\ --role-name \"${CLUSTER_NAME}-cert-manager-route53-role\" \\ --attach-policy-arn \"arn:aws:iam::${AWS_ACCOUNT_ID}:policy/CertManagerRoute53Access\" \\ --role-only \\ --approve ä¹‹åéœ€è¦ä¸º cert-manager çš„ ServiceAccount æ·»åŠ æ³¨è§£æ¥ç»‘å®šä¸Šé¢åˆšåˆ›å»ºå¥½çš„ IAM Roleï¼Œé¦–å…ˆåˆ›å»ºå¦‚ä¸‹ helm values æ–‡ä»¶ cert-manager-values.yaml: yaml # å¦‚æœæŠŠè¿™ä¸ªæ”¹æˆ falseï¼Œä¹Ÿä¼šå¯¼è‡´ cert-manager çš„æ‰€æœ‰ CRDs åŠç›¸å…³èµ„æºè¢«åˆ é™¤ï¼ installCRDs: true serviceAccount: annotations: # æ³¨æ„ä¿®æ”¹è¿™é‡Œçš„ ${AWS_ACCOUNT_ID} ä»¥åŠ ${CLUSTER_NAME} eks.amazonaws.com/role-arn: \u003e- arn:aws:iam::${AWS_ACCOUNT_ID}:role/${CLUSTER_NAME}-cert-manager-route53-role securityContext: enabled: true # æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼Œè¿˜å¾—ä¿®æ”¹ä¸‹è¿™ä¸ªï¼Œå…è®¸ cert-manager è¯»å– ServiceAccount Tokenï¼Œä»è€Œè·å¾—æˆæƒ fsGroup: 1001 ç„¶åé‡æ–°éƒ¨ç½² cert-manager: shell helm upgrade -i cert-manager ./cert-manager -n cert-manager -f cert-manager-values.yaml è¿™æ ·å°±å®Œæˆäº†æˆæƒã€‚ 1.1.2 åˆ›å»ºä¸€ä¸ªä½¿ç”¨ AWS Route53 è¿›è¡ŒéªŒè¯çš„ ACME Issueråœ¨ xxx åå­—ç©ºé—´åˆ›å»ºä¸€ä¸ª Iusserï¼š yaml apiVersion: cert-manager.io/v1 kind: Issuer metadata: name: letsencrypt-prod-aws namespace: xxx spec: acme: # ç”¨äºæ¥å—åŸŸåè¿‡æœŸæé†’çš„é‚®ä»¶åœ°å€ email: user@example.com # ACME æœåŠ¡å™¨ï¼Œæ¯”å¦‚ let's encryptã€Digicert ç­‰ # let's encrypt çš„æµ‹è¯• URLï¼Œå¯ç”¨äºæµ‹è¯•é…ç½®æ­£ç¡®æ€§ # server:","date":"2022-07-31","objectID":"/posts/kubernetes-cert-management/:2:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["æ•°å­—è¯ä¹¦","è¯ä¹¦","TLS","Kubernetes","cert-manager"],"title":"Kubernetes ä¸­çš„è¯ä¹¦ç®¡ç†å·¥å…· - cert-manager","uri":"/posts/kubernetes-cert-management/#1-1-2-alidns-acme-issuer"},{"categories":["tech"],"content":" 1. é€šè¿‡æƒå¨æœºæ„åˆ›å»ºå…¬ç½‘å—ä¿¡è¯ä¹¦é€šè¿‡æƒå¨æœºæ„åˆ›å»ºçš„å…¬ç½‘å—ä¿¡è¯ä¹¦ï¼Œå¯ä»¥ç›´æ¥åº”ç”¨åœ¨è¾¹ç•Œç½‘å…³ä¸Šï¼Œç”¨äºç»™å…¬ç½‘ç”¨æˆ·æä¾› TLS åŠ å¯†è®¿é—®æœåŠ¡ï¼Œæ¯”å¦‚å„ç§ HTTPS ç«™ç‚¹ã€APIã€‚è¿™æ˜¯éœ€æ±‚æœ€å¹¿çš„ä¸€ç±»æ•°å­—è¯ä¹¦æœåŠ¡ã€‚ cert-manager æ”¯æŒä¸¤ç§ç”³è¯·å…¬ç½‘å—ä¿¡è¯ä¹¦çš„æ–¹å¼ï¼š ACMEï¼ˆAutomated Certificate Management Environment (ACME) Certificate Authority serverï¼‰è¯ä¹¦è‡ªåŠ¨åŒ–ç”³è¯·ä¸ç®¡ç†åè®®ã€‚ venafi-as-a-service: venafi æ˜¯ä¸€ä¸ªè¯ä¹¦çš„é›†ä¸­åŒ–ç®¡ç†å¹³å°ï¼Œå®ƒä¹Ÿæä¾›äº† cert-manager æ’ä»¶ï¼Œå¯ç”¨äºè‡ªåŠ¨åŒ–ç”³è¯· DigiCert/Entrust/GlobalSign/Letâ€™s Encrypt å››ç§ç±»å‹çš„å…¬ç½‘å—ä¿¡è¯ä¹¦ã€‚ è¿™é‡Œä¸»è¦ä»‹ç»ä½¿ç”¨ ACMEv2 åè®®ç”³è¯·å…¬ç½‘è¯ä¹¦ï¼Œæ”¯æŒä½¿ç”¨æ­¤å¼€æ”¾åè®®ç”³è¯·è¯ä¹¦çš„æƒå¨æœºæ„æœ‰ï¼š å…è´¹æœåŠ¡ Letâ€™s Encrypt: ä¼—æ‰€å‘¨çŸ¥ï¼Œå®ƒæä¾›ä¸‰ä¸ªæœˆæœ‰æ•ˆæœŸçš„å…è´¹è¯ä¹¦ã€‚ ZeroSSL: è²Œä¼¼ä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒæœ‰åçš„ SSL è¯ä¹¦æœåŠ¡ é€šè¿‡ ACME åè®®æ”¯æŒä¸é™æ•°é‡çš„ 90 å¤©è¯ä¹¦ï¼Œä¹Ÿæ”¯æŒå¤šåŸŸåè¯ä¹¦ä¸æ³›åŸŸåè¯ä¹¦ã€‚ å®ƒæä¾›äº†ä¸€ä¸ªé¢å¤–çš„ Dashboard æŸ¥çœ‹ä¸ç®¡ç†æ‰€æœ‰ç”³è¯·çš„è¯ä¹¦ï¼Œè¿™æ˜¯æ¯”è¾ƒæ–¹ä¾¿çš„åœ°æ–¹ã€‚ ä»˜è´¹æœåŠ¡ DigiCert: è¿™ä¸ªéå¸¸æœ‰åï¼ˆä½†ä¹Ÿæ˜¯ç›¸å½“è´µï¼‰ï¼Œå®˜æ–¹æ–‡æ¡£Digicert - Third-party ACME client automation Google Public Authority(Google Trust Services): Google æ¨å‡ºçš„å…¬ç½‘è¯ä¹¦æœåŠ¡ï¼Œä¹Ÿæ˜¯ä¸‰ä¸ªæœˆæœ‰æ•ˆæœŸï¼Œå…¶æ ¹è¯ä¹¦äº¤å‰éªŒè¯äº† GlobalSignï¼ŒOCSP æœåŠ¡å™¨åœ¨å›½å†…é€Ÿåº¦ä¹Ÿå¾ˆå¿«ã€‚ è¯¦è§acme.sh/wiki/Google-Public-CA æ­¤åŠŸèƒ½ç›®å‰ï¼ˆ2022-08-10ï¼‰ä»å¤„äº beta çŠ¶æ€ï¼Œéœ€è¦æè¡¨å•ç”³è¯·æ‰èƒ½è·å¾—ä½¿ç”¨ å®˜æ–¹åœ°å€ï¼šhttps://pki.goog/ Entrust: å®˜æ–¹æ–‡æ¡£Entrustâ€™s ACME implementation GlobalSign: å®˜æ–¹æ–‡æ¡£GlobalSign ACME Service è¿™é‡Œä¹Ÿé¡ºä¾¿ä»‹ç»ä¸‹æ”¶è´¹è¯ä¹¦æœåŠ¡å¯¹è¯ä¹¦çš„åˆ†çº§ï¼Œä»¥åŠè¯¥å¦‚ä½•é€‰ç”¨ï¼š Domain Validatedï¼ˆDVï¼‰è¯ä¹¦ ä»…éªŒè¯åŸŸåæ‰€æœ‰æƒï¼ŒéªŒè¯æ­¥éª¤æœ€å°‘ï¼Œä»·æ ¼æœ€ä½ï¼Œä»…éœ€è¦æ•°åˆ†é’Ÿå³å¯ç­¾å‘ã€‚ ä¼˜ç‚¹å°±æ˜¯æ˜“äºç­¾å‘ï¼Œå¾ˆé€‚åˆåšè‡ªåŠ¨åŒ–ã€‚ å„äº‘å‚å•†ï¼ˆAWS/GCP/Cloudflareï¼Œä»¥åŠ Vercel/Github çš„ç«™ç‚¹æœåŠ¡ï¼‰ç»™è‡ªå®¶æœåŠ¡æä¾›çš„å…è´¹è¯ä¹¦éƒ½æ˜¯ DV è¯ä¹¦ï¼ŒLetâ€™s Encrypt çš„è¯ä¹¦ä¹Ÿæ˜¯è¿™ä¸ªç±»å‹ã€‚ å¾ˆæ˜æ˜¾è¿™äº›è¯ä¹¦çš„ç­¾å‘éƒ½éå¸¸æ–¹ä¾¿ï¼Œè€Œä¸”ä»…éªŒè¯åŸŸåæ‰€æœ‰æƒã€‚ ä½†æ˜¯ AWS/GCP/Cloudflare/Vercel/Github æä¾›çš„ DV è¯ä¹¦éƒ½ä»…èƒ½åœ¨å®ƒä»¬çš„äº‘æœåŠ¡ä¸Šä½¿ç”¨ï¼Œä¸æä¾›ç§é’¥å¯¼å‡ºåŠŸèƒ½ï¼ Organization Validated (OV) è¯ä¹¦ æ˜¯ä¼ä¸š SSL è¯ä¹¦çš„é¦–é€‰ï¼Œé€šè¿‡ä¼ä¸šè®¤è¯ç¡®ä¿ä¼ä¸š SSL è¯ä¹¦çš„çœŸå®æ€§ã€‚ é™¤åŸŸåæ‰€æœ‰æƒå¤–ï¼ŒCA æœºæ„è¿˜ä¼šå®¡æ ¸ç»„ç»‡åŠä¼ä¸šçš„çœŸå®æ€§ï¼ŒåŒ…æ‹¬æ³¨å†ŒçŠ¶å†µã€è”ç³»æ–¹å¼ã€æ¶æ„è½¯ä»¶ç­‰å†…å®¹ã€‚ å¦‚æœè¦åšåˆè§„åŒ–ï¼Œå¯èƒ½è‡³å°‘ä¹Ÿå¾—ç”¨ OV è¿™ä¸ªçº§åˆ«çš„è¯ä¹¦ã€‚ Extended Validationï¼ˆEVï¼‰è¯ä¹¦ æœ€ä¸¥æ ¼çš„è®¤è¯æ–¹å¼ï¼ŒCA æœºæ„ä¼šæ·±åº¦å®¡æ ¸ç»„ç»‡åŠä¼ä¸šå„æ–¹é¢çš„ä¿¡æ¯ã€‚ è¢«è®¤ä¸ºé€‚åˆç”¨äºå¤§å‹ä¼ä¸šã€é‡‘èæœºæ„ç­‰ç»„ç»‡æˆ–ä¼ä¸šã€‚ è€Œä¸”ä»…æ”¯æŒç­¾å‘å•åŸŸåã€å¤šåŸŸåè¯ä¹¦ï¼Œä¸æ”¯æŒç­¾å‘æ³›åŸŸåè¯ä¹¦ï¼Œå®‰å…¨æ€§æ æ çš„ã€‚ ACME æ”¯æŒ HTTP01 è·Ÿ DNS01 ä¸¤ç§åŸŸåéªŒè¯æ–¹å¼ï¼Œå…¶ä¸­ DNS01 æ˜¯æœ€ç®€ä¾¿çš„æ–¹æ³•ã€‚ ä¸‹é¢åˆ†åˆ«æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ AWS Route53 è·Ÿ AliDNSï¼Œé€šè¿‡ DNS éªŒè¯æ–¹å¼ç”³è¯·ä¸€ä¸ª Letâ€™s Encrypt è¯ä¹¦ã€‚ ï¼ˆå…¶ä»– DNS æä¾›å•†çš„é…ç½®æ–¹å¼è¯·ç›´æ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼‰ 1.1 ä½¿ç”¨ AWS Route53 åˆ›å»ºä¸€ä¸ªè¯ä¹¦ç­¾å‘è€…ã€ŒCertificate Issuerã€ é AWS Route53 ç”¨æˆ·å¯å¿½ç•¥è¿™ä¸€èŠ‚ https://cert-manager.io/docs/configuration/acme/dns01/route53/ 1.1.1 é€šè¿‡ IAM æˆæƒ cert-manager è°ƒç”¨ AWS Route53 API è¿™é‡Œä»‹ç»ä¸€ç§ä¸éœ€è¦åˆ›å»º ACCESS_KEY_ID/ACCESS_SECRETï¼Œç›´æ¥ä½¿ç”¨ AWS EKS å®˜æ–¹çš„å…å¯†è®¤è¯çš„æ–¹æ³•ã€‚ä¼šæ›´å¤æ‚ä¸€ç‚¹ï¼Œä½†æ˜¯æ›´å®‰å…¨å¯ç»´æŠ¤ã€‚ é¦–å…ˆéœ€è¦ä¸º EKS é›†ç¾¤åˆ›å»º OIDC providerï¼Œå‚è§aws-iam-and-kubernetesï¼Œ è¿™é‡Œä¸å†èµ˜è¿°ã€‚ cert-manager éœ€è¦æŸ¥è¯¢ä¸æ›´æ–° Route53 è®°å½•çš„æƒé™ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨å¦‚ä¸‹é…ç½®åˆ›å»ºä¸€ä¸ª IAM Policyï¼Œ å¯ä»¥å‘½åä¸º CertManagerRoute53Accessï¼ˆæ³¨æ„æ›¿æ¢æ‰ ï¼‰ï¼š json { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Effect\": \"Allow\", \"Action\": \"route53:GetChange\", \"Resource\": \"arn:aws:route53:::change/*\" }, { \"Effect\": \"Allow\", \"Action\": [\"route53:ChangeResourceRecordSets\", \"route53:ListResourceRecordSets\"], \"Resource\": \"arn:aws:route53:::hostedzone/*\" }, { \"Effect\": \"Allow\", \"Action\": \"route53:ListHostedZonesByName\", \"Resource\": \"*\" } ] } æ¯”å¦‚ä½¿ç”¨ awscli åˆ›å»ºæ­¤ policyï¼š shell aws iam create-policy \\ --policy-name XxxCertManagerRoute53Access \\ --policy-document file://cert-manager-route53-access.json ç„¶åé€šè¿‡ä¸Šè¿°é…ç½®åˆ›å»ºä¸€ä¸ª IAM Role å¹¶è‡ªåŠ¨ç»™ cert-manager æ‰€åœ¨çš„ EKS é›†ç¾¤æ·»åŠ ä¿¡ä»»å…³ç³»ï¼š shell export CLUSTER_NAME=\"xxx\" export AWS_ACCOUNT_ID=\"112233445566\" # ä½¿ç”¨ eksctl è‡ªåŠ¨åˆ›å»ºå¯¹åº”çš„ role å¹¶æ·»åŠ ä¿¡ä»»å…³ç³» # éœ€è¦å…ˆå®‰è£…å¥½ eksctl eksctl create iamserviceaccount \\ --cluster \"${CLUSTER_NAME}\" --name cert-manager --namespace cert-manager \\ --role-name \"${CLUSTER_NAME}-cert-manager-route53-role\" \\ --attach-policy-arn \"arn:aws:iam::${AWS_ACCOUNT_ID}:policy/CertManagerRoute53Access\" \\ --role-only \\ --approve ä¹‹åéœ€è¦ä¸º cert-manager çš„ ServiceAccount æ·»åŠ æ³¨è§£æ¥ç»‘å®šä¸Šé¢åˆšåˆ›å»ºå¥½çš„ IAM Roleï¼Œé¦–å…ˆåˆ›å»ºå¦‚ä¸‹ helm values æ–‡ä»¶ cert-manager-values.yaml: yaml # å¦‚æœæŠŠè¿™ä¸ªæ”¹æˆ falseï¼Œä¹Ÿä¼šå¯¼è‡´ cert-manager çš„æ‰€æœ‰ CRDs åŠç›¸å…³èµ„æºè¢«åˆ é™¤ï¼ installCRDs: true serviceAccount: annotations: # æ³¨æ„ä¿®æ”¹è¿™é‡Œçš„ ${AWS_ACCOUNT_ID} ä»¥åŠ ${CLUSTER_NAME} eks.amazonaws.com/role-arn: \u003e- arn:aws:iam::${AWS_ACCOUNT_ID}:role/${CLUSTER_NAME}-cert-manager-route53-role securityContext: enabled: true # æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼Œè¿˜å¾—ä¿®æ”¹ä¸‹è¿™ä¸ªï¼Œå…è®¸ cert-manager è¯»å– ServiceAccount Tokenï¼Œä»è€Œè·å¾—æˆæƒ fsGroup: 1001 ç„¶åé‡æ–°éƒ¨ç½² cert-manager: shell helm upgrade -i cert-manager ./cert-manager -n cert-manager -f cert-manager-values.yaml è¿™æ ·å°±å®Œæˆäº†æˆæƒã€‚ 1.1.2 åˆ›å»ºä¸€ä¸ªä½¿ç”¨ AWS Route53 è¿›è¡ŒéªŒè¯çš„ ACME Issueråœ¨ xxx åå­—ç©ºé—´åˆ›å»ºä¸€ä¸ª Iusserï¼š yaml apiVersion: cert-manager.io/v1 kind: Issuer metadata: name: letsencrypt-prod-aws namespace: xxx spec: acme: # ç”¨äºæ¥å—åŸŸåè¿‡æœŸæé†’çš„é‚®ä»¶åœ°å€ email: user@example.com # ACME æœåŠ¡å™¨ï¼Œæ¯”å¦‚ let's encryptã€Digicert ç­‰ # let's encrypt çš„æµ‹è¯• URLï¼Œå¯ç”¨äºæµ‹è¯•é…ç½®æ­£ç¡®æ€§ # server:","date":"2022-07-31","objectID":"/posts/kubernetes-cert-management/:2:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["æ•°å­—è¯ä¹¦","è¯ä¹¦","TLS","Kubernetes","cert-manager"],"title":"Kubernetes ä¸­çš„è¯ä¹¦ç®¡ç†å·¥å…· - cert-manager","uri":"/posts/kubernetes-cert-management/#1-3-acme-certificate"},{"categories":["tech"],"content":" 1. é€šè¿‡æƒå¨æœºæ„åˆ›å»ºå…¬ç½‘å—ä¿¡è¯ä¹¦é€šè¿‡æƒå¨æœºæ„åˆ›å»ºçš„å…¬ç½‘å—ä¿¡è¯ä¹¦ï¼Œå¯ä»¥ç›´æ¥åº”ç”¨åœ¨è¾¹ç•Œç½‘å…³ä¸Šï¼Œç”¨äºç»™å…¬ç½‘ç”¨æˆ·æä¾› TLS åŠ å¯†è®¿é—®æœåŠ¡ï¼Œæ¯”å¦‚å„ç§ HTTPS ç«™ç‚¹ã€APIã€‚è¿™æ˜¯éœ€æ±‚æœ€å¹¿çš„ä¸€ç±»æ•°å­—è¯ä¹¦æœåŠ¡ã€‚ cert-manager æ”¯æŒä¸¤ç§ç”³è¯·å…¬ç½‘å—ä¿¡è¯ä¹¦çš„æ–¹å¼ï¼š ACMEï¼ˆAutomated Certificate Management Environment (ACME) Certificate Authority serverï¼‰è¯ä¹¦è‡ªåŠ¨åŒ–ç”³è¯·ä¸ç®¡ç†åè®®ã€‚ venafi-as-a-service: venafi æ˜¯ä¸€ä¸ªè¯ä¹¦çš„é›†ä¸­åŒ–ç®¡ç†å¹³å°ï¼Œå®ƒä¹Ÿæä¾›äº† cert-manager æ’ä»¶ï¼Œå¯ç”¨äºè‡ªåŠ¨åŒ–ç”³è¯· DigiCert/Entrust/GlobalSign/Letâ€™s Encrypt å››ç§ç±»å‹çš„å…¬ç½‘å—ä¿¡è¯ä¹¦ã€‚ è¿™é‡Œä¸»è¦ä»‹ç»ä½¿ç”¨ ACMEv2 åè®®ç”³è¯·å…¬ç½‘è¯ä¹¦ï¼Œæ”¯æŒä½¿ç”¨æ­¤å¼€æ”¾åè®®ç”³è¯·è¯ä¹¦çš„æƒå¨æœºæ„æœ‰ï¼š å…è´¹æœåŠ¡ Letâ€™s Encrypt: ä¼—æ‰€å‘¨çŸ¥ï¼Œå®ƒæä¾›ä¸‰ä¸ªæœˆæœ‰æ•ˆæœŸçš„å…è´¹è¯ä¹¦ã€‚ ZeroSSL: è²Œä¼¼ä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒæœ‰åçš„ SSL è¯ä¹¦æœåŠ¡ é€šè¿‡ ACME åè®®æ”¯æŒä¸é™æ•°é‡çš„ 90 å¤©è¯ä¹¦ï¼Œä¹Ÿæ”¯æŒå¤šåŸŸåè¯ä¹¦ä¸æ³›åŸŸåè¯ä¹¦ã€‚ å®ƒæä¾›äº†ä¸€ä¸ªé¢å¤–çš„ Dashboard æŸ¥çœ‹ä¸ç®¡ç†æ‰€æœ‰ç”³è¯·çš„è¯ä¹¦ï¼Œè¿™æ˜¯æ¯”è¾ƒæ–¹ä¾¿çš„åœ°æ–¹ã€‚ ä»˜è´¹æœåŠ¡ DigiCert: è¿™ä¸ªéå¸¸æœ‰åï¼ˆä½†ä¹Ÿæ˜¯ç›¸å½“è´µï¼‰ï¼Œå®˜æ–¹æ–‡æ¡£Digicert - Third-party ACME client automation Google Public Authority(Google Trust Services): Google æ¨å‡ºçš„å…¬ç½‘è¯ä¹¦æœåŠ¡ï¼Œä¹Ÿæ˜¯ä¸‰ä¸ªæœˆæœ‰æ•ˆæœŸï¼Œå…¶æ ¹è¯ä¹¦äº¤å‰éªŒè¯äº† GlobalSignï¼ŒOCSP æœåŠ¡å™¨åœ¨å›½å†…é€Ÿåº¦ä¹Ÿå¾ˆå¿«ã€‚ è¯¦è§acme.sh/wiki/Google-Public-CA æ­¤åŠŸèƒ½ç›®å‰ï¼ˆ2022-08-10ï¼‰ä»å¤„äº beta çŠ¶æ€ï¼Œéœ€è¦æè¡¨å•ç”³è¯·æ‰èƒ½è·å¾—ä½¿ç”¨ å®˜æ–¹åœ°å€ï¼šhttps://pki.goog/ Entrust: å®˜æ–¹æ–‡æ¡£Entrustâ€™s ACME implementation GlobalSign: å®˜æ–¹æ–‡æ¡£GlobalSign ACME Service è¿™é‡Œä¹Ÿé¡ºä¾¿ä»‹ç»ä¸‹æ”¶è´¹è¯ä¹¦æœåŠ¡å¯¹è¯ä¹¦çš„åˆ†çº§ï¼Œä»¥åŠè¯¥å¦‚ä½•é€‰ç”¨ï¼š Domain Validatedï¼ˆDVï¼‰è¯ä¹¦ ä»…éªŒè¯åŸŸåæ‰€æœ‰æƒï¼ŒéªŒè¯æ­¥éª¤æœ€å°‘ï¼Œä»·æ ¼æœ€ä½ï¼Œä»…éœ€è¦æ•°åˆ†é’Ÿå³å¯ç­¾å‘ã€‚ ä¼˜ç‚¹å°±æ˜¯æ˜“äºç­¾å‘ï¼Œå¾ˆé€‚åˆåšè‡ªåŠ¨åŒ–ã€‚ å„äº‘å‚å•†ï¼ˆAWS/GCP/Cloudflareï¼Œä»¥åŠ Vercel/Github çš„ç«™ç‚¹æœåŠ¡ï¼‰ç»™è‡ªå®¶æœåŠ¡æä¾›çš„å…è´¹è¯ä¹¦éƒ½æ˜¯ DV è¯ä¹¦ï¼ŒLetâ€™s Encrypt çš„è¯ä¹¦ä¹Ÿæ˜¯è¿™ä¸ªç±»å‹ã€‚ å¾ˆæ˜æ˜¾è¿™äº›è¯ä¹¦çš„ç­¾å‘éƒ½éå¸¸æ–¹ä¾¿ï¼Œè€Œä¸”ä»…éªŒè¯åŸŸåæ‰€æœ‰æƒã€‚ ä½†æ˜¯ AWS/GCP/Cloudflare/Vercel/Github æä¾›çš„ DV è¯ä¹¦éƒ½ä»…èƒ½åœ¨å®ƒä»¬çš„äº‘æœåŠ¡ä¸Šä½¿ç”¨ï¼Œä¸æä¾›ç§é’¥å¯¼å‡ºåŠŸèƒ½ï¼ Organization Validated (OV) è¯ä¹¦ æ˜¯ä¼ä¸š SSL è¯ä¹¦çš„é¦–é€‰ï¼Œé€šè¿‡ä¼ä¸šè®¤è¯ç¡®ä¿ä¼ä¸š SSL è¯ä¹¦çš„çœŸå®æ€§ã€‚ é™¤åŸŸåæ‰€æœ‰æƒå¤–ï¼ŒCA æœºæ„è¿˜ä¼šå®¡æ ¸ç»„ç»‡åŠä¼ä¸šçš„çœŸå®æ€§ï¼ŒåŒ…æ‹¬æ³¨å†ŒçŠ¶å†µã€è”ç³»æ–¹å¼ã€æ¶æ„è½¯ä»¶ç­‰å†…å®¹ã€‚ å¦‚æœè¦åšåˆè§„åŒ–ï¼Œå¯èƒ½è‡³å°‘ä¹Ÿå¾—ç”¨ OV è¿™ä¸ªçº§åˆ«çš„è¯ä¹¦ã€‚ Extended Validationï¼ˆEVï¼‰è¯ä¹¦ æœ€ä¸¥æ ¼çš„è®¤è¯æ–¹å¼ï¼ŒCA æœºæ„ä¼šæ·±åº¦å®¡æ ¸ç»„ç»‡åŠä¼ä¸šå„æ–¹é¢çš„ä¿¡æ¯ã€‚ è¢«è®¤ä¸ºé€‚åˆç”¨äºå¤§å‹ä¼ä¸šã€é‡‘èæœºæ„ç­‰ç»„ç»‡æˆ–ä¼ä¸šã€‚ è€Œä¸”ä»…æ”¯æŒç­¾å‘å•åŸŸåã€å¤šåŸŸåè¯ä¹¦ï¼Œä¸æ”¯æŒç­¾å‘æ³›åŸŸåè¯ä¹¦ï¼Œå®‰å…¨æ€§æ æ çš„ã€‚ ACME æ”¯æŒ HTTP01 è·Ÿ DNS01 ä¸¤ç§åŸŸåéªŒè¯æ–¹å¼ï¼Œå…¶ä¸­ DNS01 æ˜¯æœ€ç®€ä¾¿çš„æ–¹æ³•ã€‚ ä¸‹é¢åˆ†åˆ«æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ AWS Route53 è·Ÿ AliDNSï¼Œé€šè¿‡ DNS éªŒè¯æ–¹å¼ç”³è¯·ä¸€ä¸ª Letâ€™s Encrypt è¯ä¹¦ã€‚ ï¼ˆå…¶ä»– DNS æä¾›å•†çš„é…ç½®æ–¹å¼è¯·ç›´æ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼‰ 1.1 ä½¿ç”¨ AWS Route53 åˆ›å»ºä¸€ä¸ªè¯ä¹¦ç­¾å‘è€…ã€ŒCertificate Issuerã€ é AWS Route53 ç”¨æˆ·å¯å¿½ç•¥è¿™ä¸€èŠ‚ https://cert-manager.io/docs/configuration/acme/dns01/route53/ 1.1.1 é€šè¿‡ IAM æˆæƒ cert-manager è°ƒç”¨ AWS Route53 API è¿™é‡Œä»‹ç»ä¸€ç§ä¸éœ€è¦åˆ›å»º ACCESS_KEY_ID/ACCESS_SECRETï¼Œç›´æ¥ä½¿ç”¨ AWS EKS å®˜æ–¹çš„å…å¯†è®¤è¯çš„æ–¹æ³•ã€‚ä¼šæ›´å¤æ‚ä¸€ç‚¹ï¼Œä½†æ˜¯æ›´å®‰å…¨å¯ç»´æŠ¤ã€‚ é¦–å…ˆéœ€è¦ä¸º EKS é›†ç¾¤åˆ›å»º OIDC providerï¼Œå‚è§aws-iam-and-kubernetesï¼Œ è¿™é‡Œä¸å†èµ˜è¿°ã€‚ cert-manager éœ€è¦æŸ¥è¯¢ä¸æ›´æ–° Route53 è®°å½•çš„æƒé™ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨å¦‚ä¸‹é…ç½®åˆ›å»ºä¸€ä¸ª IAM Policyï¼Œ å¯ä»¥å‘½åä¸º CertManagerRoute53Accessï¼ˆæ³¨æ„æ›¿æ¢æ‰ ï¼‰ï¼š json { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Effect\": \"Allow\", \"Action\": \"route53:GetChange\", \"Resource\": \"arn:aws:route53:::change/*\" }, { \"Effect\": \"Allow\", \"Action\": [\"route53:ChangeResourceRecordSets\", \"route53:ListResourceRecordSets\"], \"Resource\": \"arn:aws:route53:::hostedzone/*\" }, { \"Effect\": \"Allow\", \"Action\": \"route53:ListHostedZonesByName\", \"Resource\": \"*\" } ] } æ¯”å¦‚ä½¿ç”¨ awscli åˆ›å»ºæ­¤ policyï¼š shell aws iam create-policy \\ --policy-name XxxCertManagerRoute53Access \\ --policy-document file://cert-manager-route53-access.json ç„¶åé€šè¿‡ä¸Šè¿°é…ç½®åˆ›å»ºä¸€ä¸ª IAM Role å¹¶è‡ªåŠ¨ç»™ cert-manager æ‰€åœ¨çš„ EKS é›†ç¾¤æ·»åŠ ä¿¡ä»»å…³ç³»ï¼š shell export CLUSTER_NAME=\"xxx\" export AWS_ACCOUNT_ID=\"112233445566\" # ä½¿ç”¨ eksctl è‡ªåŠ¨åˆ›å»ºå¯¹åº”çš„ role å¹¶æ·»åŠ ä¿¡ä»»å…³ç³» # éœ€è¦å…ˆå®‰è£…å¥½ eksctl eksctl create iamserviceaccount \\ --cluster \"${CLUSTER_NAME}\" --name cert-manager --namespace cert-manager \\ --role-name \"${CLUSTER_NAME}-cert-manager-route53-role\" \\ --attach-policy-arn \"arn:aws:iam::${AWS_ACCOUNT_ID}:policy/CertManagerRoute53Access\" \\ --role-only \\ --approve ä¹‹åéœ€è¦ä¸º cert-manager çš„ ServiceAccount æ·»åŠ æ³¨è§£æ¥ç»‘å®šä¸Šé¢åˆšåˆ›å»ºå¥½çš„ IAM Roleï¼Œé¦–å…ˆåˆ›å»ºå¦‚ä¸‹ helm values æ–‡ä»¶ cert-manager-values.yaml: yaml # å¦‚æœæŠŠè¿™ä¸ªæ”¹æˆ falseï¼Œä¹Ÿä¼šå¯¼è‡´ cert-manager çš„æ‰€æœ‰ CRDs åŠç›¸å…³èµ„æºè¢«åˆ é™¤ï¼ installCRDs: true serviceAccount: annotations: # æ³¨æ„ä¿®æ”¹è¿™é‡Œçš„ ${AWS_ACCOUNT_ID} ä»¥åŠ ${CLUSTER_NAME} eks.amazonaws.com/role-arn: \u003e- arn:aws:iam::${AWS_ACCOUNT_ID}:role/${CLUSTER_NAME}-cert-manager-route53-role securityContext: enabled: true # æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼Œè¿˜å¾—ä¿®æ”¹ä¸‹è¿™ä¸ªï¼Œå…è®¸ cert-manager è¯»å– ServiceAccount Tokenï¼Œä»è€Œè·å¾—æˆæƒ fsGroup: 1001 ç„¶åé‡æ–°éƒ¨ç½² cert-manager: shell helm upgrade -i cert-manager ./cert-manager -n cert-manager -f cert-manager-values.yaml è¿™æ ·å°±å®Œæˆäº†æˆæƒã€‚ 1.1.2 åˆ›å»ºä¸€ä¸ªä½¿ç”¨ AWS Route53 è¿›è¡ŒéªŒè¯çš„ ACME Issueråœ¨ xxx åå­—ç©ºé—´åˆ›å»ºä¸€ä¸ª Iusserï¼š yaml apiVersion: cert-manager.io/v1 kind: Issuer metadata: name: letsencrypt-prod-aws namespace: xxx spec: acme: # ç”¨äºæ¥å—åŸŸåè¿‡æœŸæé†’çš„é‚®ä»¶åœ°å€ email: user@example.com # ACME æœåŠ¡å™¨ï¼Œæ¯”å¦‚ let's encryptã€Digicert ç­‰ # let's encrypt çš„æµ‹è¯• URLï¼Œå¯ç”¨äºæµ‹è¯•é…ç½®æ­£ç¡®æ€§ # server:","date":"2022-07-31","objectID":"/posts/kubernetes-cert-management/:2:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["æ•°å­—è¯ä¹¦","è¯ä¹¦","TLS","Kubernetes","cert-manager"],"title":"Kubernetes ä¸­çš„è¯ä¹¦ç®¡ç†å·¥å…· - cert-manager","uri":"/posts/kubernetes-cert-management/#csi-driver"},{"categories":["tech"],"content":" 2. é€šè¿‡ç§æœ‰ CA é¢å‘è¯ä¹¦Private CA æ˜¯ä¸€ç§ä¼ä¸šè‡ªå·±ç”Ÿæˆçš„ CA è¯ä¹¦ï¼Œé€šå¸¸ä¼ä¸šç”¨å®ƒæ¥æ„å»ºè‡ªå·±çš„ PKI åŸºç¡€è®¾æ–½ã€‚ åœ¨ TLS åè®®è¿™ä¸ªåº”ç”¨åœºæ™¯ä¸‹ï¼ŒPrivate CA é¢å‘çš„è¯ä¹¦ä»…é€‚åˆåœ¨ä¼ä¸šå†…éƒ¨ä½¿ç”¨ï¼Œå¿…é¡»åœ¨å®¢æˆ·ç«¯å®‰è£…ä¸Šè¿™ä¸ª CA è¯ä¹¦ï¼Œæ‰èƒ½æ­£å¸¸è®¿é—®ç”±å®ƒç­¾åçš„æ•°å­—è¯ä¹¦åŠ å¯†çš„ Web API æˆ–è€…ç«™ç‚¹ã€‚Private CA ç­¾åçš„æ•°å­—è¯ä¹¦åœ¨å…¬ç½‘ä¸Šæ˜¯ä¸è¢«ä¿¡ä»»çš„ï¼ cert-manager æä¾›çš„ Private CA æœåŠ¡æœ‰ï¼š Vault: é¼é¼å¤§åäº†ï¼ŒVault æ˜¯ä¸€ä¸ªå¯†ç å³æœåŠ¡å·¥å…·ï¼Œå¯ä»¥éƒ¨ç½²åœ¨ K8s é›†ç¾¤ä¸­ï¼Œæä¾›è®¸å¤šå¯†ç ã€è¯ä¹¦ç›¸å…³çš„åŠŸèƒ½ã€‚ å¼€æºå…è´¹ AWS Certificate Manager Private CA: è·Ÿ Vault çš„ CA åŠŸèƒ½æ˜¯ä¸€è‡´çš„ï¼ŒåŒºåˆ«æ˜¯å®ƒæ˜¯æ‰˜ç®¡çš„ï¼Œç”± AWS è´Ÿè´£ç»´æŠ¤ã€‚ æ¯ä¸ª Private CA è¯ä¹¦ï¼š$400/month æ¯ä¸ªç­¾å‘çš„è¯ä¹¦ï¼ˆä»…è¯»å–äº†ç§é’¥åŠè¯ä¹¦å†…å®¹åæ‰ä¼šæ”¶è´¹ï¼‰ï¼šæŒ‰æ¢¯åº¦ä¸€æ¬¡æ€§æ”¶è´¹ï¼Œ0-1000 ä¸ªä»¥å†…æ˜¯ $0.75 æ¯ä¸ª å…¶ä»–çš„è‡ªå·±çœ‹æ–‡æ¡£â€¦ è¿™ä¸ªå› ä¸ºæš‚æ—¶ç”¨ä¸ä¸Šï¼Œæ‰€ä»¥è¿˜æ²¡ç ”ç©¶ï¼Œä¹‹åæœ‰ç ”ç©¶å†ç»™è¡¥ä¸Šã€‚ TO BE DONE. ","date":"2022-07-31","objectID":"/posts/kubernetes-cert-management/:2:2","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["æ•°å­—è¯ä¹¦","è¯ä¹¦","TLS","Kubernetes","cert-manager"],"title":"Kubernetes ä¸­çš„è¯ä¹¦ç®¡ç†å·¥å…· - cert-manager","uri":"/posts/kubernetes-cert-management/#2-é€šè¿‡ç§æœ‰-ca-é¢å‘è¯ä¹¦"},{"categories":["tech"],"content":" ä¸‰ã€cert-manager ä¸ istio/ingress ç­‰ç½‘å…³é›†æˆcert-manager æä¾›çš„ Certificate èµ„æºï¼Œä¼šå°†ç”Ÿæˆå¥½çš„å…¬ç§é’¥å­˜æ”¾åœ¨ Secret ä¸­ï¼Œè€Œ Istio/Ingress éƒ½æ”¯æŒè¿™ç§æ ¼å¼çš„ Secretï¼Œæ‰€ä»¥ä½¿ç”¨è¿˜æ˜¯æŒºç®€å•çš„ã€‚ ä»¥ Istio Gateway ä¸ºä¾‹ï¼Œç›´æ¥åœ¨ Gateway èµ„æºä¸ŠæŒ‡å®š Secret åç§°å³å¯ï¼š yaml apiVersion: networking.istio.io/v1alpha3 kind: Gateway metadata: name: example-gateway spec: selector: istio: ingressgateway servers: - port: number: 8080 name: http protocol: HTTP hosts: - product.example.com tls: httpsRedirect: true # sends 301 redirect for http requests - port: number: 8443 name: https protocol: HTTPS tls: mode: SIMPLE # enables HTTPS on this port credentialName: tls-example.com # This should match the Certificate secretName hosts: - product.example.com # This should match a DNS name in the Certificate --- apiVersion: networking.istio.io/v1alpha3 kind: VirtualService metadata: name: product spec: hosts: - product.example.com gateways: - example-gateway http: - route: - destination: host: product port: number: 8080 --- apiVersion: v1 kind: Service metadata: labels: app: product name: product namespace: prod spec: ports: - name: grpc port: 9090 protocol: TCP targetPort: 9090 - name: http port: 8080 protocol: TCP targetPort: 8080 selector: app: product sessionAffinity: None type: ClusterIP --- apiVersion: networking.istio.io/v1alpha3 kind: DestinationRule metadata: name: product spec: host: product # å®šä¹‰äº†ä¸¤ä¸ª subset subsets: - labels: version: v1 name: v1 - labels: version: v2 name: v2 --- # å…¶ä»– deployment ç­‰é…ç½® ä¹‹åå†é…åˆ VirtualService ç­‰èµ„æºï¼Œå°±å¯ä»¥å°† Istio è·Ÿ cert-manager ç»“åˆèµ·æ¥å•¦ã€‚ ","date":"2022-07-31","objectID":"/posts/kubernetes-cert-management/:3:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["æ•°å­—è¯ä¹¦","è¯ä¹¦","TLS","Kubernetes","cert-manager"],"title":"Kubernetes ä¸­çš„è¯ä¹¦ç®¡ç†å·¥å…· - cert-manager","uri":"/posts/kubernetes-cert-management/#cert-manager-and-gateway"},{"categories":["tech"],"content":" å››ã€å°† cert-manager è¯ä¹¦æŒ‚è½½åˆ°è‡ªå®šä¹‰ç½‘å…³ä¸­ æ³¨æ„ï¼Œåƒä¸‡åˆ«ä½¿ç”¨ subPath æŒ‚è½½ï¼Œæ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼Œ è¿™ç§æ–¹å¼æŒ‚è½½çš„ Secret æ–‡ä»¶ä¸ä¼šè‡ªåŠ¨æ›´æ–°ï¼ æ—¢ç„¶è¯ä¹¦è¢«å­˜æ”¾åœ¨ Secret ä¸­ï¼Œè‡ªç„¶å¯ä»¥ç›´æ¥å½“æˆæ•°æ®å·æŒ‚è½½åˆ° Pods ä¸­ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š yaml apiVersion: v1 kind: Pod metadata: name: nginx spec: containers: - name: nginx image: nginx:latest volumeMounts: - name: tls-example.com mountPath: \"/certs/example.com\" readOnly: true volumes: - name: tls-example.com secret: secretName: tls-example.com optional: false # default setting; \"mysecret\" must exist å¯¹äº nginx è€Œè¨€ï¼Œå¯ä»¥ç®€å•åœ°æä¸ª sidecar ç›‘æ§ä¸‹ï¼Œæœ‰é…ç½®å˜æ›´å°± reload ä¸‹ nginxï¼Œå®ç°è¯ä¹¦è‡ªåŠ¨æ›´æ–°ã€‚ æˆ–è€…å¯ä»¥è€ƒè™‘ç›´æ¥å†™ä¸ª k8s informer ç›‘æ§ secret çš„å˜æ›´ï¼Œæœ‰å˜æ›´å°±ç›´æ¥ reload æ‰€æœ‰ nginx å®ä¾‹ï¼Œæ€»ä¹‹å®ç°çš„æ–¹å¼æœ‰å¾ˆå¤šç§ã€‚ ","date":"2022-07-31","objectID":"/posts/kubernetes-cert-management/:4:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["æ•°å­—è¯ä¹¦","è¯ä¹¦","TLS","Kubernetes","cert-manager"],"title":"Kubernetes ä¸­çš„è¯ä¹¦ç®¡ç†å·¥å…· - cert-manager","uri":"/posts/kubernetes-cert-management/#cert-manager-istio-ingress"},{"categories":["tech"],"content":" äº”ã€ç›‘æ§å‘Šè­¦è¯ä¹¦çš„è¿‡æœŸæ—¶é—´æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„æŒ‡æ ‡ï¼Œè¯ä¹¦è¿‡æœŸäº†ï¼Œç½‘ç«™å°±æ— æ³•æ­£å¸¸è®¿é—®äº†ã€‚è™½ç„¶æ­£å¸¸æƒ…å†µä¸‹ cert-manager åº”è¯¥èƒ½å¤Ÿè‡ªåŠ¨æ›´æ–°è¯ä¹¦ï¼Œä½†æ˜¯ä¸‡ä¸€å‡ºç°äº†é—®é¢˜ï¼Œåˆæ²¡æœ‰åŠæ—¶å‘ç°ï¼Œé‚£å°±éº»çƒ¦äº†ã€‚ å› æ­¤ï¼Œå»ºè®®å¯¹è¯ä¹¦çš„è¿‡æœŸæ—¶é—´è¿›è¡Œç›‘æ§ï¼Œå½“è¯ä¹¦çš„è¿‡æœŸæ—¶é—´å°äºä¸€å®šé˜ˆå€¼æ—¶ï¼ŒåŠæ—¶å‘å‡ºå‘Šè­¦ã€‚ cert-manager æä¾›äº† Prometheus ç›‘æ§æŒ‡æ ‡ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ Prometheus ç­‰å·¥å…·è¿›è¡Œç›‘æ§å‘Šè­¦ã€‚ å®˜æ–¹æ–‡æ¡£æ˜¯è¿™ä¸ªï¼šhttps://cert-manager.io/docs/usage/prometheus-metrics/#scraping-metrics æ–‡æ¡£ä¸­æ²¡è¯¦ç»†åˆ—å‡ºæ‰€æœ‰çš„æŒ‡æ ‡ï¼Œå¯ä»¥ç›´æ¥æ¥å…¥åˆ° Prometheus ä¸­ï¼Œç„¶åé€šè¿‡ Grafana æŸ¥çœ‹ã€‚ æ¯”å¦‚è¦è®¾ç½®è¯ä¹¦è¿‡æœŸæ—¶é—´çš„å‘Šè­¦ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹ PromQLï¼š promql (certmanager_certificate_expiration_timestamp_seconds - time())/3600/24 \u003c 20 ä¸Šé¢è¿™ä¸ª PromQL è¡¨ç¤ºï¼Œå¦‚æœè¯ä¹¦çš„è¿‡æœŸæ—¶é—´å°äº 20 å¤©ï¼Œå°±ä¼šè§¦å‘å‘Šè­¦ã€‚ ","date":"2022-07-31","objectID":"/posts/kubernetes-cert-management/:5:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["æ•°å­—è¯ä¹¦","è¯ä¹¦","TLS","Kubernetes","cert-manager"],"title":"Kubernetes ä¸­çš„è¯ä¹¦ç®¡ç†å·¥å…· - cert-manager","uri":"/posts/kubernetes-cert-management/#monitoring-and-alerting"},{"categories":["tech"],"content":" å…­ã€æ³¨æ„äº‹é¡¹æœåŠ¡ç«¯ TLS åè®®çš„é…ç½®æœ‰è®¸å¤šçš„ä¼˜åŒ–ç‚¹ï¼Œæœ‰äº›é…ç½®å¯¹æ€§èƒ½çš„æå‡æ˜¯å¾ˆæ˜æ˜¾çš„ï¼Œå»ºè®®è‡ªè¡Œç½‘ä¸Šæœç´¢ç›¸å…³èµ„æ–™ï¼Œè¿™é‡Œä»…åˆ—å‡ºéƒ¨åˆ†ç›¸å…³ä¿¡æ¯ã€‚ ","date":"2022-07-31","objectID":"/posts/kubernetes-cert-management/:6:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["æ•°å­—è¯ä¹¦","è¯ä¹¦","TLS","Kubernetes","cert-manager"],"title":"Kubernetes ä¸­çš„è¯ä¹¦ç®¡ç†å·¥å…· - cert-manager","uri":"/posts/kubernetes-cert-management/#attention"},{"categories":["tech"],"content":" OCSP è¯ä¹¦éªŒè¯åè®®ä¼šå¤§å¹…æ‹–æ…¢ HTTPS åè®®çš„å“åº”é€Ÿåº¦ https://www.ssl.com/blogs/how-do-browsers-handle-revoked-ssl-tls-certificates/ https://imququ.com/post/why-can-not-turn-on-ocsp-stapling.html https://www.digicert.com/help/ å‰é¢æåˆ°é™¤äº†æ•°å­—è¯ä¹¦è‡ªå¸¦çš„æœ‰æ•ˆæœŸå¤–ï¼Œä¸ºäº†åœ¨ç§é’¥æ³„æ¼çš„æƒ…å†µä¸‹ï¼Œèƒ½å¤ŸåŠé”€å¯¹åº”çš„è¯ä¹¦ï¼ŒPKI å…¬é’¥åŸºç¡€è®¾æ–½è¿˜æä¾›äº† OCSPï¼ˆOnline Certificate Status Protocolï¼‰è¯ä¹¦çŠ¶æ€æŸ¥è¯¢åè®®ã€‚ è¿™å¯¼è‡´äº†ä¸€äº›é—®é¢˜ï¼š Chrome/Firefox ç­‰æµè§ˆå™¨éƒ½ä¼šå®šæœŸé€šè¿‡ OCSP åè®®å»è¯·æ±‚ CA æœºæ„çš„ OCSP æœåŠ¡å™¨éªŒè¯è¯ä¹¦çŠ¶æ€ï¼Œ è¿™å¯èƒ½ä¼šæ‹–æ…¢ HTTPS åè®®çš„å“åº”é€Ÿåº¦ã€‚ æ‰€è°“çš„å®šæœŸæ˜¯æŒ‡è¶…è¿‡ä¸Šä¸€ä¸ª OCSP å“åº”çš„ nextUpdate æ—¶é—´ï¼ˆä¸€èˆ¬ä¸º 7 å¤©ï¼‰ï¼Œæˆ–è€…å¦‚æœè¯¥å€¼ä¸ºç©ºçš„è¯ï¼ŒFirefox é»˜è®¤ 24h åä¼šé‡æ–°æŸ¥è¯¢ OCSP çŠ¶æ€ã€‚ å› ä¸ºå®¢æˆ·ç«¯ç›´æ¥å»è¯·æ±‚ CA æœºæ„çš„ OCSP åœ°å€è·å–è¯ä¹¦çŠ¶æ€ï¼Œè¿™å°±å¯¼è‡´ CA æœºæ„å¯ä»¥è·å–åˆ°ä¸€äº›å¯¹åº”ç«™ç‚¹çš„ç”¨æˆ·ä¿¡æ¯ï¼ˆIP åœ°å€ã€ç½‘ç»œçŠ¶æ€ç­‰ï¼‰ã€‚ ä¸ºäº†è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œrfc6066 å®šä¹‰äº† OCSP stapling åŠŸèƒ½ï¼Œå®ƒä½¿æœåŠ¡å™¨å¯ä»¥æå‰è®¿é—® OCSP è·å–è¯ä¹¦çŠ¶æ€ä¿¡æ¯å¹¶ç¼“å­˜åˆ°æœ¬åœ°ï¼ŒåŸºæœ¬ Nginx/Caddy ç­‰å„å¤§ Web æœåŠ¡å™¨æˆ–ç½‘å…³ï¼Œéƒ½æ”¯æŒ OCSP stapling åè®®ã€‚ åœ¨å®¢æˆ·ç«¯ä½¿ç”¨ TLS åè®®è®¿é—® HTTPS æœåŠ¡æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šç›´æ¥åœ¨æ¡æ‰‹é˜¶æ®µå°†ç¼“å­˜çš„ OCSP ä¿¡æ¯å‘é€ç»™å®¢æˆ·ç«¯ã€‚å› ä¸º OCSP ä¿¡æ¯ä¼šå¸¦æœ‰ CA è¯ä¹¦çš„ç­¾ååŠæœ‰æ•ˆæœŸï¼Œå®¢æˆ·ç«¯å¯ä»¥ç›´æ¥é€šè¿‡ç­¾åéªŒè¯ OCSP ä¿¡æ¯çš„çœŸå®æ€§ä¸æœ‰æ•ˆæ€§ï¼Œè¿™æ ·å°±é¿å…äº†å®¢æˆ·ç«¯è®¿é—® OCSP æœåŠ¡å™¨å¸¦æ¥çš„å¼€é”€ã€‚ è€Œå¦ä¸€ä¸ªæ–¹æ³•ï¼Œå°±æ˜¯é€‰ç”¨ ocsp æœåŠ¡å™¨åœ¨ç›®æ ‡ç”¨æˆ·åŒºåŸŸé€Ÿåº¦å¿«çš„ CA æœºæ„ç­¾å‘è¯ä¹¦ã€‚ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æµ‹è¯•ï¼Œç¡®è®¤ç«™ç‚¹æ˜¯å¦å¯ç”¨äº† ocsp stapling: conf $ openssl s_client -connect www.digicert.com:443 -servername www.digicert.com -status -tlsextdebug \u003c /dev/null 2\u003e\u00261 | grep -i \"OCSP response\" å¦‚æœè¾“å‡ºåŒ…å« OCSP Response Status: successful å°±è¯´æ˜ç«™ç‚¹æ”¯æŒ ocsp staplingï¼Œå¦‚æœè¾“å‡ºå†…å®¹ä¸º OCSP response: no response sent åˆ™è¯´æ˜ç«™ç‚¹ä¸æ”¯æŒocsp staplingã€‚ å®é™…ä¸Š Google/AWS ç­‰å¤§å¤šæ•°ç«™ç‚¹éƒ½ä¸ä¼šå¯ç”¨ä¹Ÿä¸éœ€è¦å¯ç”¨ ocsp staplingï¼Œä¸€æ˜¯å› ä¸ºå®ƒä»¬è‡ªå·±å°±æ˜¯è¯ä¹¦é¢å‘æœºæ„ï¼ŒOCSP æœåŠ¡å™¨ä¹Ÿå½’å®ƒä»¬è‡ªå·±ç®¡ï¼Œä¸å­˜åœ¨éšç§çš„é—®é¢˜ã€‚äºŒæ˜¯å®ƒä»¬çš„ OCSP æœåŠ¡å™¨éå¸ƒå…¨çƒï¼Œä¹Ÿä¸å­˜åœ¨æ€§èƒ½é—®é¢˜ã€‚è¿™ç§æƒ…å†µä¸‹å¼€ä¸ª OCSP Stapling åè€Œæ˜¯æµªè´¹æµé‡ï¼Œå› ä¸ºæ¯æ¬¡ TLS æ¡æ‰‹éƒ½å¾—å‘é€ä¸€ä¸ª OCSP çŠ¶æ€ä¿¡æ¯ã€‚ æˆ‘æµ‹è¯•å‘ç°åªæœ‰ www.digicert.com/www.douban.com ç­‰å°‘æ•°ç«™ç‚¹å¯ç”¨äº† ocsp staplingï¼Œwww.baidu.com/www.google.com/www.zhihu.com éƒ½æœªå¯ç”¨ ocsp stapling. ","date":"2022-07-31","objectID":"/posts/kubernetes-cert-management/:6:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["æ•°å­—è¯ä¹¦","è¯ä¹¦","TLS","Kubernetes","cert-manager"],"title":"Kubernetes ä¸­çš„è¯ä¹¦ç®¡ç†å·¥å…· - cert-manager","uri":"/posts/kubernetes-cert-management/#ocsp-è¯ä¹¦éªŒè¯åè®®ä¼šå¤§å¹…æ‹–æ…¢-https-åè®®çš„å“åº”é€Ÿåº¦"},{"categories":["life"],"content":" æˆ‘å¹¶ä¸çŸ¥é“ä½•æ—¶æ‰æ˜¯æ­»æœŸï¼Œ å´æ—¥æ—¥é—®è‡ªå·±ï¼Œ ä¼šä¸ä¼šæœ‰å¹½çµæ¥ç‰µæˆ‘çš„æ‰‹ï¼Œ å¼•æˆ‘ä¸€è·¯å‘è¥¿ï¼Ÿ å¯ä»–ä»¬çœ‹åˆ°çš„å…‰æ˜åˆåœ¨å“ªé‡Œï¼Ÿ ä¼šä¸ä¼šä¹Ÿä¸ºæˆ‘äº®èµ·ï¼Ÿ è¿™ä¸€åˆ‡å¿«æ¥å§ï¼Œæˆ‘å·²ç­‰ä¸åŠï¼ â€”â€”ã€Šçº¢è‰²åœ°å¸¦çš„æ²‰æ€ã€‹ by ä¸´ç»ˆæ‚£è€… Patricia æˆ‘æœ€è¿‘åœ¨çœ‹ä¸€æœ¬ä¹¦ï¼Œã€Šåœ¨ç”Ÿå‘½çš„å°½å¤´æ‹¥æŠ±ä½ -ä¸´ç»ˆå…³æ€€åŒ»ç”Ÿæ‰‹è®°ã€‹ï¼Œå®ƒçš„è‹±æ–‡åŸåå³æœ¬æ–‡çš„æ ‡é¢˜ã€‚æç™½åœ¨ã€Šæ˜¥å¤œå®´ä»å¼Ÿæ¡ƒèŠ±å›­åºã€‹ä¸­å†™ã€Œè€Œæµ®ç”Ÿè‹¥æ¢¦ï¼Œä¸ºæ¬¢å‡ ä½•ï¼Ÿã€ï¼Œä»¿ç…§ä¸‹æ–‡æ³•ï¼Œæœ¬æ–‡çš„æ ‡é¢˜ã€ŒDeath Is But a Dreamã€å¤§æ¦‚å¯ä»¥ç›´è¯‘æˆã€Œä¸´ç»ˆè‹¥æ¢¦ã€ï¼Œè·Ÿæ­¤ä¹¦çš„ä¸­æ–‡ç‰ˆåç§°æœ‰äº›ä¸åŒçš„éŸµå‘³åœ¨ã€‚ è¿™ä¹¦è®²çš„æ˜¯æ­»äº¡çš„è¿‡ç¨‹â€”â€”ä¸´ç»ˆæ¢¦å¢ƒã€‚éšç€å¹´é¾„æ¸é•¿ï¼Œè€ä¸€è¾ˆä»¬æ…¢æ…¢è€å»ï¼Œæˆ‘ä»¬éƒ½ä¸å¯é¿å…åœ°ä¼šè¶Šæ¥è¶Šå¤šåœ°æ¥è§¦åˆ°æ­»äº¡ã€‚è¿™ä¸–é—´è½®æ›¿æ›´è¿­ï¼Œçˆ±æ¨æƒ…ä»‡æ˜¯ä¸å˜çš„ä¸»é¢˜ï¼Œä½†æ˜¯æ­»äº¡å§‹ç»ˆæ˜¯é…è§’ï¼Œå®åœ¨æ˜¯å› ä¸ºæ¯äººä¸€ç”Ÿéƒ½åªæœ‰å”¯ä¸€ä¸€æ¬¡æœºä¼šå»çœŸæ­£ä½“å‘³æ­»äº¡ï¼Œéš¾æœ‰å®æ„Ÿã€‚è€Œä¸”æ­»äº¡å¾€å¾€ä»£è¡¨ç€ç»ˆç»“ï¼Œæˆ‘ä»¬åšä¸ºç”Ÿè€…ï¼Œå½“ç„¶æ›´å‘å¾€ä¹¦å†™ç”Ÿè€…çš„ä¸–ç•Œã€‚ æ•‘äººä¸€å‘½èƒœé€ ä¸ƒçº§æµ®å± ï¼Œççˆ±ç”Ÿå‘½æ˜¯æˆ‘ä»¬ä»å°åˆ°å¤§è¢«æ•™è‚²çš„æ€æƒ³ã€‚ä½†æ˜¯è¿™æ ·çš„æ€æƒ³å´ä¹Ÿé€ æˆäº†è®¸å¤šæ‚²å‰§ï¼Œå…¨ä¸–ç•Œæœ‰è®¸å¤šçš„æ‚£è€…ç—›è‹¦ä¸å ªåœ°æ´»åœ¨ä¸–ä¸Šï¼Œæ±‚æ­»ä¸èƒ½ï¼Œæœ€ç»ˆåœ¨ç—…é­”çš„æŠ˜ç£¨ä¸‹å‡„æƒ¨ç¦»ä¸–ï¼Œå¦‚æœæˆ‘ä»¬èƒ½è°¨æ…æ‰¿è®¤ã€Œæ­»äº¡ã€çš„ä»·å€¼ï¼Œä»è¿™ä¸ªè§’åº¦çœ‹ä¹Ÿæ˜¯æ‹¯æ•‘äº†è®¸å¤šçš„æ‚£è€…ä¸å®¶åº­ã€‚ è€Œå…³äºæ­»äº¡ï¼Œåœ¨æˆ‘äº²èº«ç»å†çš„å‡ æ¬¡é•¿è¾ˆè‘¬ç¤¼ä¸­ï¼Œæˆ‘å‘ç°çˆ¶è¾ˆä»¬å¯¹æ­»äº¡å¤§éƒ½çœ‹å¾—å¾ˆå¼€ï¼Œä»–ä»¬è¯´ã€Œäººæ€»æœ‰ä¸€æ­»ï¼Œè€äººå®¶è¿‡ä¸–äº†æˆ‘ä»¬å½“å­å¥³çš„è‚¯å®šè¦é€æœ€åä¸€ç¨‹ï¼Œä½†æ˜¯ä¸éœ€è¦æƒ³å¤ªå¤šï¼Œé­‚å½’å¤©åœ°ç½¢äº†ã€‚ã€ï¼Œæˆ‘ä½©æœè¿™ç§è±è¾¾ã€‚ ä½†æ˜¯è¯´åˆ°ä¸´ç»ˆæ¢¦å¢ƒï¼Œæˆ‘æ˜¯çœŸçš„æ²¡ä»€ä¹ˆäº†è§£ã€‚æˆ‘ä»æ¥æ²¡è·Ÿé•¿è¾ˆäº¤æµè¿‡ç”Ÿå‘½æœ«æœŸçš„æ¢¦å¢ƒï¼Œè„‘æµ·ä¸­ä¹ŸæŒ–æ˜ä¸å‡ºç›¸å…³çš„è®°å¿†ã€‚é€èµ°æˆ‘çˆ·çˆ·çš„æ—¶å€™ï¼Œçœ‹ç€çˆ·çˆ·å› ä¸ºå‘¼å¸å›°éš¾è€Œå¤§å£å–˜æ°”ï¼Œå ‚å“¥è·ªåœ¨æˆ‘å‰é¢ï¼ŒåŒçœ¼æ³›çº¢éšå«æ³ªå…‰ï¼Œä½†æˆ‘å®Œå…¨æ²¡æœ‰å®æ„Ÿâ€”â€”ä¸€åˆ‡éƒ½æ˜¾å¾—é‚£ä¹ˆä¸çœŸå®ã€‚å¬ç€çˆ·çˆ·è¢«ç—°å µå¡æ°”ç®¡ã€è‰°éš¾çš„å‘¼å¸å£°ï¼Œæˆ‘ç”šè‡³æ„Ÿåˆ°å®³æ€•ï¼Œæƒ³è¦é€ƒç¦»ã€‚ çˆ·çˆ·è¿‡ä¸–åï¼Œå¥¶å¥¶å°±æ˜¯ä¸€ä¸ªäººç”Ÿæ´»äº†ï¼Œä¸€ä¸ªäººèµ·å±…ã€ä¸€ä¸ªäººç»™èœè‹—æ¾åœŸï¼Œç„¶ååœ¨èœåœ°é‡Œä¸å°å¿ƒè·Œäº†ä¸€è·¤ï¼Œå°±éšç€çˆ·çˆ·å»äº†ã€‚ 2023/1/7 è¡¥å……ï¼šè·Ÿå ‚å¼Ÿå°ç…§è®°å¿†åå‘ç°ï¼Œè¿™é‡Œæˆ‘çš„è®°å¿†æˆ–è®¸å·²ç»ä¸å¯¹äº†â€¦ æˆ‘åæ¥åœ¨çˆ·çˆ·å¥¶å¥¶æˆ¿é‡Œä¸€ä¸ªå£æ©±ä¸Šï¼Œæ‰¾åˆ°ä¸‰å››æšé“œé’±ï¼Œè¿˜æ²¾ç€æ³¥åœŸï¼Œæœ‰äº›é”ˆèš€ç—•è¿¹ã€‚æˆ‘æŠŠå…¶ä¸­ä¸€æšé€šå®çº¢çº¿ä¸²å¥½ï¼Œè´´èº«å¸¦äº†å¥½å‡ å¹´ï¼Œå¿ƒæƒ…ä¸å¥½çš„æ—¶å€™å°±å‡è§†ç€è¿™æšé“œé’±é»¯ç„¶ç¥ä¼¤ï¼Œå¿ƒæƒ…å¥½çš„æ—¶å€™ä¹Ÿè¦æ‚ç€å®ƒå…¥ç¡ã€‚ æˆ‘è¿˜å–œæ¬¢ä¸Šäº†æˆæ›²ï¼Œç¼ ç€åŒå­¦è¯»äº†å¥¹çš„ã€Šä¸­å›½æˆå‰§å²ã€‹ã€‚å¤§å­¦çš„æ—¶å€™åˆå–œæ¬¢ä¸Šè¶Šå‰§ï¼Œå´ä¾¬è½¯è¯­ã€‚åˆå› ä¸ºåˆä¸­æ—¶å­¦è¿‡ç‚¹ç«¹ç¬›ï¼Œå–œæ¬¢ä¸Šäº†ä¼ ç»Ÿä¹æ›²ï¼Œæˆ‘å¯¹ä¸€äº›ç»å…¸è€æ­Œä¹Ÿæƒ…æœ‰ç‹¬é’Ÿã€‚åœ¨å¾ˆå¤šåŒå­¦è·ŸåŒäº‹çš„çœ¼ä¸­ï¼Œæˆ‘çš„éŸ³ä¹å“å‘³æ˜¯å¾ˆã€Œç‹¬ç‰¹ã€çš„ï¼Œè¿™æˆ–è®¸éƒ½æºè‡ªçˆ·çˆ·å¥¶å¥¶çš„ç†é™¶ã€‚å®é™…ä¸Šæˆ‘å°çš„æ—¶å€™å¹¶ä¸å–œæ¬¢æˆå‰§ï¼Œæˆ‘è·Ÿçˆ·çˆ·å¥¶å¥¶å»çœ‹åº™æˆçš„ç›®çš„ï¼Œé€šå¸¸éƒ½åªæ˜¯ä¸ºäº†åƒä¸€ç¢—å‡‰ç²‰ï¼Œæˆ–è€…ä¸ºäº†å»ç©è€ã€çœ‹ä¸ªçƒ­é—¹ã€‚å¶å°”å»çˆ·çˆ·å¥¶å¥¶å®¶ç©ï¼Œä¹Ÿåªæ˜¯è§‰å¾—ä»–ä»¬å¤ªå­¤å•äº†ï¼Œè·Ÿä»–ä»¬éšä¾¿èŠèŠå¤©ï¼Œå®é™…ä¸Šè¿™ä¹ˆå¤šå¹´ï¼Œè·Ÿçˆ·çˆ·å¥¶å¥¶çœ‹è¿‡çš„æˆæ›²ï¼Œæˆ‘å°±æ²¡å¬æ‡‚è¿‡å‡ å¥å°è¯ã€‚ é‚£æ˜¯å¤šå°‘å¹´å‰äº†å‘¢ï¼ŸåªçŸ¥é“æ˜¯å¾ˆå¤šå¹´å‰äº†ï¼Œä¸ä»”ç»†å›å¿†å›å¿†ã€ææŒ‡ç®—ç®—ï¼Œéƒ½æä¸æ¸…å…·ä½“è¿‡äº†å¤šå°‘å¹´æœˆã€‚è¿™ä¹ˆå¤šä¸ªæ—¥æ—¥å¤œå¤œé‡Œï¼Œæˆ‘å¹¼ç¨šè¿‡ã€çƒ­è¡€è¿‡ï¼Œä¹Ÿè¿·èŒ«è¿‡ã€é¢“åºŸè¿‡ï¼Œå€’ä¹Ÿä¸ç®—åº¸åº¸ç¢Œç¢Œï¼Œæˆ‘è¿˜æ˜¯çŸ¥è¶³çš„ï¼Œè¿™ç§å¿ƒæ€è²Œä¼¼æ˜¯è¢«ç§°ä½œç°å…… emmm é«˜ä¸‰æ—¶æ›¾ç»çœ‹è¿‡ä¸€æœ¬è¶…çº§å–œæ¬¢çš„åŠ±å¿—ä¹¦ï¼Œåæ¥æˆ‘é«˜è€ƒå®Œäºå¾½å·æ±‚å­¦ã€æ·±åœ³æ‰“å·¥ï¼Œè¿™ä¹ˆå¤šå¹´ä¸€ç›´å°†å®ƒå¸¦åœ¨èº«è¾¹ï¼Œä¹¦åå«ã€Šè¿™ä¸€ç”Ÿå†ä¹Ÿä¸ä¼šæœ‰çš„å¥‡é‡ã€‹ã€‚ä¹¦çš„æ‰‰é¡µåªæœ‰ä¸€å¥è¯ï¼šã€Œå½“æ˜å¤©å†ä¹Ÿä¸æ˜¯æ— é™ï¼Œä½ è¿˜ä¼šåƒä»Šå¤©ä¸€æ ·åº¦è¿‡ä½ çš„äººç”Ÿå—ï¼Ÿã€ ã€Šè¿™ä¸€ç”Ÿå†ä¹Ÿä¸ä¼šæœ‰çš„å¥‡é‡ã€‹å·²é™ªæˆ‘åº¦è¿‡äº†ä¸ƒå…«ä¸ªæ˜¥å¤ç§‹å†¬ å½“æ˜å¤©å†ä¹Ÿä¸æ˜¯æ— é™ å†™åˆ°è¿™å„¿ï¼Œæˆ‘åˆæƒ³èµ·æˆ‘é«˜ä¸­æ—¶è¿˜çœ‹è¿‡ä¸€æœ¬ä¹¦ã€ŠåˆºçŒ¬çš„ä¼˜é›…ã€‹ï¼Œå®ƒåŒæ ·é™ªä¼´æˆ‘åº¦è¿‡äº†å››å¹´å¤§å­¦å²æœˆï¼Œåæ¥åˆè¾—è½¬åˆ°äº†æ·±åœ³ï¼Œä½†ç°åœ¨å€’æ˜¯ä¸åœ¨èº«è¾¹ã€‚ä¹¦ä¸­æœ‰å‡ å¥è¯æˆ‘å°è±¡æ·±åˆ»ï¼Œæ”¾åœ¨è¿™ç¯‡æ–‡ç« é‡Œä¹ŸæŒºåº”æ™¯çš„ï¼š è¯åˆè¯´å›æ¥ï¼Œä¸èƒ½å› ä¸ºæœ‰æƒ³æ­»çš„å¿ƒï¼Œå¾€åå°±è¦åƒçƒ‚èœå¸®ä¸€æ ·çš„è¿‡æ—¥å­ï¼Œç”šè‡³åº”è¯¥å®Œå…¨ç›¸åã€‚ é‡è¦çš„ä¸æ˜¯æ­»äº¡ï¼Œè€Œæ˜¯åœ¨æ­»äº¡çš„é‚£ä¸€åˆ»æˆ‘ä»¬åœ¨åšä»€ä¹ˆã€‚ æˆ‘åœ¨åšä»€ä¹ˆå‘¢ï¼Ÿ æˆ‘æ›¾é‡åˆ°ä¸€ä¸ªäººï¼Œè€Œä¸”æˆ‘æ­£å‡†å¤‡çˆ±ä¸Šä»–ã€‚ éšæ„å†™ä¸‹è¿™äº›æ–‡å­—ï¼Œè„‘å­é‡Œå„ç§æƒ³æ³•æ£æ„æµæ·Œï¼Œæˆ‘æ‰“ç®—æå‰å†™å†™æˆ‘çš„ä¸´ç»ˆé—è¨€ï¼ŒæŠŠä¸€åˆ‡éƒ½å‡†å¤‡å¥½ã€‚ ä½†åœ¨æ­»äº¡åˆ°æ¥ä¹‹å‰ï¼Œæˆ‘ä»è¦ç²¾å½©çš„æ´»ï¼ ","date":"2022-05-24","objectID":"/posts/death-is-but-a-dream/:0:0","series":null,"tags":["ä¸´ç»ˆä½“éªŒ","ä¸´ç»ˆå…³æ€€","æ­»äº¡","ä¸´ç»ˆ","æ¢¦å¢ƒ","å“²å­¦"],"title":"Death Is But a Dream","uri":"/posts/death-is-but-a-dream/#"},{"categories":["life"],"content":" å‚è€ƒ ã€Šåœ¨ç”Ÿå‘½çš„å°½å¤´æ‹¥æŠ±ä½ -ä¸´ç»ˆå…³æ€€åŒ»ç”Ÿæ‰‹è®°ã€‹ Death Is But A Dream (2021) Official trailer I See Dead People: Dreams and Visions of the Dying | Dr. Christopher Kerr | TEDxBuffalo End-of-Life Experiences - Dr. Christopher Kerr æœ‰è°çœ‹è¿‡ã€ŠåˆºçŒ¬çš„ä¼˜é›…ã€‹è¿™æœ¬ä¹¦å—ï¼Ÿå¦‚ä½•ï¼Ÿ - æ–¼æ¸…æ¨‚ æœ‰ä»€ä¹ˆäººç”Ÿä¸­å€¼å¾—ä¸€è¯»çš„å°è¯´æˆ–åè‘—ï¼Ÿï¼ˆæœ€å¥½ç°ä»£ä½œå®¶çš„ä¹¦ï¼‰ï¼Ÿ - æ–¼æ¸…æ¨‚ ","date":"2022-05-24","objectID":"/posts/death-is-but-a-dream/:1:0","series":null,"tags":["ä¸´ç»ˆä½“éªŒ","ä¸´ç»ˆå…³æ€€","æ­»äº¡","ä¸´ç»ˆ","æ¢¦å¢ƒ","å“²å­¦"],"title":"Death Is But a Dream","uri":"/posts/death-is-but-a-dream/#å‚è€ƒ"},{"categories":["tech"],"content":" ä¸ªäººç¬”è®°ï¼Œä¸ä¸€å®šæ­£ç¡®â€¦ å½“å‰æ–‡ç« å®Œæˆåº¦ - 70% ","date":"2022-05-13","objectID":"/posts/about-nat/:0:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["NAT","ç½‘ç»œ","NAT ç©¿è¶Š","å†…ç½‘ç©¿é€","è™šæ‹Ÿç½‘ç»œ","P2P","WebRTC"],"title":"NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ","uri":"/posts/about-nat/#"},{"categories":["tech"],"content":" å‰è¨€NATï¼Œå³ Network Address Translationï¼Œæ˜¯ IPv4 ç½‘ç»œä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œç”¨äºæ‰§è¡Œ IP åœ°å€ä¸ç«¯å£çš„è½¬æ¢ã€‚ IPv4 çš„è®¾è®¡è€…æ²¡é¢„æ–™åˆ°å› ç‰¹ç½‘æŠ€æœ¯çš„å‘å±•ä¼šå¦‚æ­¤ä¹‹å¿«ï¼Œåœ¨è®¾è®¡æ—¶åªä½¿ç”¨äº† 32bits çš„åœ°å€ç©ºé—´ï¼Œéšç€å› ç‰¹ç½‘çš„é£é€Ÿå‘å±•ï¼Œå®ƒå¾ˆå¿«å°±å˜å¾—ä¸å¤Ÿç”¨äº†ã€‚åæ¥è™½ç„¶è®¾è®¡äº†æ–°çš„ IPv6 åè®®ï¼Œä½†æ˜¯å®ƒä¸ IPv4 ä¸å…¼å®¹ï¼Œéœ€è¦æ–°çš„ç¡¬ä»¶è®¾å¤‡ä»¥åŠå„ç§ç½‘ç»œç¨‹åºæ”¯æŒï¼Œæ— æ³•å¿«é€Ÿæ™®åŠã€‚ NAT å°±æ˜¯åœ¨ IPv6 æ™®åŠå‰ï¼Œä¸´æ—¶è§£å†³ IPv4 åœ°å€ç©ºé—´ä¸å¤Ÿç”¨è€Œå¼€å‘çš„æŠ€æœ¯ï¼Œé€šä¿—åœ°è®² NAT å°±æ˜¯ç”¨æ¥ç»™ IPv4 ç»­å‘½çš„ã€‚å®ƒè§£å†³ IPv4 åœ°å€çŸ­ç¼ºé—®é¢˜çš„æ–¹æ³•æ˜¯ï¼š æ¯ä¸ªå®¶åº­ã€ç»„ç»‡ã€ä¼ä¸šï¼Œåœ¨å†…éƒ¨éƒ½ä½¿ç”¨å±€åŸŸç½‘é€šè®¯ï¼Œä¸å ç”¨å…¬ç½‘ IPv4 èµ„æº åœ¨å±€åŸŸç½‘ä¸ä¸Šå±‚ç½‘ç»œçš„äº¤ç•Œå¤„ï¼ˆè·¯ç”±å™¨ï¼‰ï¼Œä½¿ç”¨ NAT æŠ€æœ¯è¿›è¡Œ IP/port è½¬æ¢ï¼Œä½¿ç”¨æˆ·èƒ½æ­£å¸¸è®¿é—®ä¸Šå±‚ç½‘ç»œ åœ¨æ›¾ç» IPv4 åœ°å€è¿˜ä¸æ˜¯ç‰¹åˆ«çŸ­ç¼ºçš„æ—¶å€™ï¼Œæ™®é€šå®¶åº­çš„ç½‘ç»œæ¶æ„é€šå¸¸æ˜¯ï¼šã€Œå®¶åº­å±€åŸŸç½‘ã€=\u003eã€ŒNAT ç½‘å…³ ï¼ˆå®¶åº­è·¯ç”±å™¨ï¼‰ã€=\u003eã€Œå› ç‰¹ç½‘ã€ã€‚ ä½†æ˜¯äº’è”ç½‘ä¸»è¦å‘å±•äºæ¬§ç¾ï¼Œå› æ­¤è®¸å¤šæ¬§ç¾çš„ç»„ç»‡ä¸æœºæ„åœ¨åˆæœŸè¢«åˆ†é…äº†å¤§é‡çš„ IPv4 èµ„æºï¼Œè€Œåå…¥åœºçš„ä¸­å›½åˆ†é…åˆ°çš„ IPv4 åœ°å€å°±ä¸å¤ªèƒ½åŒ¹é…ä¸Šæˆ‘ä»¬çš„äººå£ã€‚å› æ­¤ç›¸æ¯”æ¬§ç¾ï¼Œä¸­å›½çš„ IPv4 åœ°å€æ˜¯éå¸¸çŸ­ç¼ºçš„ï¼Œå³ä½¿ä½¿ç”¨ä¸Šè¿°è¿™æ ·çš„ç½‘ç»œæ¶æ„â€”â€”ä¹Ÿå°±æ˜¯ç»™æ¯ä¸ªå®¶åº­ï¼ˆæˆ–ç»„ç»‡ï¼‰åˆ†é…ä¸€ä¸ª IPv4 åœ°å€â€”â€”éƒ½æœ‰ç‚¹æ‰è¥Ÿè§è‚˜äº†ã€‚äºæ˜¯ä¸­å›½ç”µä¿¡ç­‰è¿è¥å•†ä¸å¾—ä¸å†åŠ ä¸€å±‚ NATï¼Œè®©å¤šä¸ªå®¶åº­å…±ç”¨åŒä¸€ä¸ª IP åœ°å€ï¼Œè¿™æ—¶ç½‘ç»œæ¶æ„ä¼šå˜æˆè¿™æ ·ï¼šã€Œå®¶åº­å±€åŸŸç½‘ã€=\u003eã€Œå®¶åº­ NAT ç½‘å…³ã€=\u003eã€Œè¿è¥å•†å¹¿åŸŸç½‘ã€=\u003eã€Œè¿è¥å•† NAT ç½‘å…³ã€=\u003eã€Œå…¬å…±å› ç‰¹ç½‘ã€ã€‚ç”±äºæ­¤æ¶æ„é€šè¿‡ä¸¤å±‚ NAT ç½‘å…³ä¸²è”äº†ä¸‰ä¸ªä¸åŒçš„ IPv4 ç½‘ç»œï¼Œå®ƒä¹Ÿè¢«å½¢è±¡åœ°ç§°ä¸ºNAT444 æŠ€æœ¯ï¼Œè¯¦è§ç”µä¿¡çº§NAT - ç»´åŸºç™¾ç§‘ã€‚ æ® v2ex ä¸Šä¼ é—»å›½å†…è¿è¥å•†ç”šè‡³å¼€å§‹å°è¯•ä½¿ç”¨ NAT4444 äº†â€¦ ç›®çš„æ˜¯ç»™ç”¨æˆ·åˆ†é…ä¸€ä¸ªå‡å…¬ç½‘ IP åœ°å€â€¦ ä¸è¿‡ IPv6 ä¹Ÿæ­£åœ¨å˜å¾—è¶Šæ¥è¶Šæµè¡Œï¼Œçœ‹ v2ex ä¸Šæœ€è¿‘ï¼ˆ2022-08ï¼‰å°±å¾ˆå¤šäººåœ¨èŠï¼Œä¸€äº›åŸå¸‚åœ¨è¯•ç‚¹ ipv4 over ipv6 éš§é“æŠ€æœ¯ï¼Œåº•å±‚å®Œå…¨æ¢æˆ IPv6 åè®®åŠ  IPoE æ‹¨å·äº†ï¼Œå¸¦æ¥çš„é—®é¢˜æ˜¯æ²¡æ³•æ¡¥æ¥ï¼Œè¯¦è§ç”µä¿¡åˆä¸€æ–°åŠ¨ä½œï¼šä¸Šç½‘ä¸šåŠ¡ä¸å†ä½¿ç”¨ PPPoE æ–°è£…å®½å¸¦æ— æ³•æ”¹æ¡¥æ¥ - v2exã€‚ æ€»çš„æ¥è¯´ï¼ŒNAT æ˜¯ä¸€é¡¹éå¸¸æˆåŠŸçš„æŠ€æœ¯ï¼Œå®ƒæˆåŠŸå¸® IPv4 ç»­å‘½äº†å‡ åå¹´ï¼Œç”šè‡³åˆ°å¦‚ä»Š 2022 å¹´ï¼Œå…¨çƒç½‘ç»œä»ç„¶æ˜¯ IPv4 çš„å¤©ä¸‹ã€‚ ","date":"2022-05-13","objectID":"/posts/about-nat/:1:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["NAT","ç½‘ç»œ","NAT ç©¿è¶Š","å†…ç½‘ç©¿é€","è™šæ‹Ÿç½‘ç»œ","P2P","WebRTC"],"title":"NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ","uri":"/posts/about-nat/#å‰è¨€"},{"categories":["tech"],"content":" NAT å¦‚ä½•å·¥ä½œNAT çš„å·¥ä½œæ–¹å¼ï¼Œä½¿ç”¨å›¾ä¾‹æè¿°æ˜¯è¿™æ ·çš„ï¼š NAT ç¤ºä¾‹ ä»å¤–éƒ¨ç½‘ç»œçœ‹ä¸€ä¸ª NAT ç½‘å…³ï¼ˆä¸€ä¸ªå¯ç”¨äº† NAT çš„è·¯ç”±å™¨ï¼‰ï¼Œå®ƒåªæ˜¯æ‹¥æœ‰ä¸€ä¸ª IPv4 åœ°å€çš„æ™®é€šè®¾å¤‡ï¼Œ æ‰€æœ‰ä»å±€åŸŸç½‘å‘é€åˆ°å…¬ç½‘çš„æµé‡ï¼Œå…¶ IP åœ°å€éƒ½æ˜¯è¿™ä¸ªè·¯ç”±å™¨çš„ WAN IP åœ°å€ï¼Œåœ¨ä¸Šå›¾ä¸­ï¼Œè¿™ä¸ª IP åœ°å€æ˜¯ 138.76.29.7. æœ¬è´¨ä¸Šï¼ŒNAT ç½‘å…³éšè—äº†å®¶åº­ç½‘ç»œçš„ç»†èŠ‚ï¼Œä»å¤–éƒ¨ç½‘ç»œä¸Šçœ‹ï¼Œæ•´ä¸ªå®¶åº­ç½‘ç»œå°±åƒä¸€å°æ™®é€šçš„ç½‘ç»œè®¾å¤‡ã€‚ ä¸‹é¢æˆ‘ä»¬ä¼šå­¦ä¹ åˆ°ï¼Œä¸Šè¿°è¿™ä¸ª NAT å·¥ä½œæ–¹å¼å®é™…ä¸Šæ˜¯ NAPTï¼Œå®ƒåŒæ—¶ä½¿ç”¨ L3/L4 çš„ä¿¡æ¯è¿›è¡Œåœ°å€è½¬æ¢å·¥ä½œã€‚ ","date":"2022-05-13","objectID":"/posts/about-nat/:2:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["NAT","ç½‘ç»œ","NAT ç©¿è¶Š","å†…ç½‘ç©¿é€","è™šæ‹Ÿç½‘ç»œ","P2P","WebRTC"],"title":"NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ","uri":"/posts/about-nat/#nat-å¦‚ä½•å·¥ä½œ"},{"categories":["tech"],"content":" NAT çš„åœ°å€æ˜ å°„æ–¹å¼NAT çš„å…·ä½“å®ç°æœ‰è®¸å¤šçš„å˜ç§ï¼Œä¸å­˜åœ¨ç»Ÿä¸€çš„è§„èŒƒï¼Œä½†æ˜¯å¤§ä½“ä¸Šèƒ½åˆ†ä¸ºä¸¤ç§æ¨¡å‹ï¼šã€Œä¸€å¯¹ä¸€ NATã€ä¸ã€Œä¸€å¯¹å¤š NATã€ï¼Œä¸‹é¢åˆ†åˆ«è¿›è¡Œä»‹ç»ã€‚ ","date":"2022-05-13","objectID":"/posts/about-nat/:3:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["NAT","ç½‘ç»œ","NAT ç©¿è¶Š","å†…ç½‘ç©¿é€","è™šæ‹Ÿç½‘ç»œ","P2P","WebRTC"],"title":"NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ","uri":"/posts/about-nat/#nat-çš„åœ°å€æ˜ å°„æ–¹å¼"},{"categories":["tech"],"content":" 1. ä¸€å¯¹ä¸€ NATä¸€å¯¹ä¸€ NATï¼Œè¿™ç§ç±»å‹çš„ NAT åœ¨ RFC2663 ä¸­è¢«ç§°ä¸º Basic NATã€‚å®ƒåœ¨æŠ€æœ¯ä¸Šæ¯”è¾ƒç®€å•ï¼Œåªåˆ©ç”¨ç½‘ç»œå±‚çš„ä¿¡æ¯ï¼Œå¯¹ IP åœ°å€è¿›è¡Œè½¬æ¢ã€‚ ç®€å•çš„è¯´ï¼ŒBasic NAT è¦æ±‚æ¯ä¸ªå†…ç½‘ IP éƒ½éœ€è¦ç»‘å®šä¸€ä¸ªå”¯ä¸€çš„å…¬ç½‘ IPï¼Œæ‰èƒ½è¿é€šå¤–éƒ¨ç½‘ç»œã€‚ å…¶ä¸»è¦åº”ç”¨åœºæ™¯æ˜¯ï¼Œå…¬ç½‘ç”¨æˆ·éœ€è¦è®¿é—®åˆ°å†…ç½‘ä¸»æœºã€‚ Basic NAT æœ‰ä¸‰ç§ç±»å‹ï¼šã€Œé™æ€ NATã€ã€ã€ŒåŠ¨æ€ NATã€ä»¥åŠã€ŒNAT Serverã€ã€‚ ç°åœ¨çš„å¾ˆå¤šå®¶åº­è·¯ç”±å™¨éƒ½è‡ªå¸¦ä¸€ä¸ªè¢«ç§°ä¸º DMZ ä¸»æœºçš„åŠŸèƒ½ï¼Œå®ƒæ˜¯ã€ŒDemilitarized Zoneã€çš„ç¼©å†™ï¼Œæ„ä¸ºéš”ç¦»åŒºã€‚å®ƒå…è®¸å°†æŸä¸€å°å†…ç½‘ä¸»æœºè®¾ç½®ä¸º DMZ ä¸»æœºï¼ˆæˆ–è€…å«éš”ç¦»åŒºä¸»æœºï¼Œä»…æ­¤ä¸»æœºå¯ä¾›å¤–ç½‘è®¿é—®ï¼‰ï¼Œæ‰€æœ‰ä»å¤–éƒ¨è¿›æ¥çš„æµé‡ï¼Œéƒ½ä¼šè¢«é€šè¿‡ Basic NAT ä¿®æ”¹ä¸ºå¯¹åº”çš„å†…ç½‘ IP åœ°å€ï¼Œç„¶åç›´æ¥å‘é€åˆ°è¯¥ä¸»æœºã€‚è·¯ç”±å™¨çš„è¿™ç§ DMZ æŠ€æœ¯å°±æ˜¯ã€Œé™æ€ NATã€ï¼Œå› ä¸º DMZ ä¸»æœºå¯¹åº”çš„å†…ç½‘ IP éœ€è¦æ‰‹åŠ¨é…ç½®ï¼Œä¸ä¼šåŠ¨æ€å˜åŒ–ã€‚ DMZ ä¸»æœºæ‹“æ‰‘ç»“æ„ è€Œã€ŒåŠ¨æ€ NATã€åˆ™éœ€è¦ä¸€ä¸ªå…¬ç½‘ IP åœ°å€æ± ï¼Œæ¯æ¬¡ç”¨æˆ·éœ€è¦è®¿é—®å…¬ç½‘æ—¶ï¼ŒåŠ¨æ€ NAT ä¼šç»™å®ƒåˆ†é…ä¸€ä¸ªåŠ¨æ€å…¬ç½‘ IP å¹¶è‡ªåŠ¨é…ç½®ç›¸åº”çš„ NAT è§„åˆ™ï¼Œä½¿ç”¨å®Œå†å›æ”¶ã€‚ ç¬¬ä¸‰ç§æ˜¯ã€ŒNAT Serverã€ï¼Œäº‘æœåŠ¡å•†æä¾›çš„ã€Œå…¬ç½‘ IPã€å°±æ˜¯é€šè¿‡ã€ŒNAT Serverã€å®ç°çš„ï¼Œåœ¨äº‘æœåŠ¡å™¨ä¸­ä½¿ç”¨ ip addr ls æŸ¥çœ‹ä½ ä¼šå‘ç°ï¼Œè¯¥ä¸»æœºä¸Šå®é™…åªé…äº†å±€åŸŸç½‘ IP åœ°å€ï¼Œä½†æ˜¯å®ƒå´èƒ½æ­£å¸¸ä½¿ç”¨å…¬ç½‘ IP é€šä¿¡ï¼ŒåŸå› å°±æ˜¯äº‘æœåŠ¡å•†åœ¨ã€ŒNAT Serverã€ä¸Šä¸ºè¿™äº›æœåŠ¡å™¨é…ç½®äº† IP è½¬å‘è§„åˆ™ã€‚ä¸ºä¸€å°äº‘æœåŠ¡å™¨ç»‘å®šä¸€ä¸ªå…¬ç½‘ IPï¼Œå®é™…ä¸Šå°±æ˜¯è¯·æ±‚ã€ŒNAT Serverã€ä»å…¬ç½‘ IP åœ°å€æ± ä¸­å–å‡ºä¸€ä¸ªï¼Œå¹¶é…ç½®å¯¹åº”çš„ NAT è§„åˆ™åˆ°è¿™å°äº‘æœåŠ¡å™¨çš„å±€åŸŸç½‘ IPã€‚ ç¤ºä¾‹å¦‚ä¸‹ï¼Œå…¶ä¸­çš„ Internet Gateway å®é™…ä¸Šå°±æ˜¯ä¸ªä¸€å¯¹ä¸€ NAT Serverï¼š AWS VPC ä¸­çš„ NAT ç½‘å…³ä»¥åŠ Internet ç½‘å…³ äº‘æœåŠ¡ VPC ä¸­çš„å…¬æœ‰å­ç½‘ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ª DMZ(Demilitarized Zone) éš”ç¦»åŒºï¼Œæ˜¯ä¸å®‰å…¨çš„ã€‚è€Œç§æœ‰å­ç½‘åˆ™æ˜¯å®‰å…¨åŒºï¼Œå…¬ç½‘æ— æ³•ç›´æ¥è®¿é—®åˆ°å…¶ä¸­çš„ä¸»æœºã€‚ è€Œã€ŒåŠ¨æ€ NATã€åˆ™éœ€è¦è·¯ç”±å™¨ç»´æŠ¤ä¸€ä¸ªå…¬ç½‘ IP åœ°å€æ± ï¼Œå†…ç½‘æœåŠ¡å™¨éœ€è¦è®¿é—®å…¬ç½‘æ—¶ï¼ŒåŠ¨æ€ NAT å°±ä»åœ°å€æ± ä¸­æ‹¿å‡ºä¸€ä¸ªå…¬ç½‘ IP ç»™å®ƒä½¿ç”¨ï¼Œç”¨å®Œå†å›æ”¶ã€‚è¿™ç§åœºæ™¯éœ€è¦ä¸€ä¸ªå…¬ç½‘ IP åœ°å€æ± ï¼Œæ¯å½“å†…éƒ¨æœ‰æœåŠ¡éœ€è¦è¯·æ±‚å¤–ç½‘æ—¶ï¼Œå°±åŠ¨æ€åœ°ä¸ºå®ƒåˆ†é…ä¸€ä¸ªå…¬ç½‘ IP åœ°å€ï¼Œä½¿ç”¨å®Œå†å›æ”¶ã€‚ Basic NAT çš„å¥½å¤„æ˜¯ï¼Œå®ƒä»…å·¥ä½œåœ¨ L3 ç½‘ç»œå±‚ï¼Œç½‘ç»œå±‚ä¸Šçš„åè®®éƒ½å¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼ˆæ¯”å¦‚ P2Pï¼‰ï¼Œä¸éœ€è¦å•¥ã€Œå†…ç½‘ç©¿è¶Šã€æŠ€æœ¯ã€‚ ","date":"2022-05-13","objectID":"/posts/about-nat/:3:1","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["NAT","ç½‘ç»œ","NAT ç©¿è¶Š","å†…ç½‘ç©¿é€","è™šæ‹Ÿç½‘ç»œ","P2P","WebRTC"],"title":"NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ","uri":"/posts/about-nat/#1-ä¸€å¯¹ä¸€-nat"},{"categories":["tech"],"content":" 2. ä¸€å¯¹å¤š NAT - NAPTä¸€å¯¹å¤š NATï¼Œä¹Ÿè¢«ç§°ä¸º NAPTï¼ˆnetwork address and port translationï¼‰ï¼ŒåŒæ ·åœ¨RFC2663 ä¸­è¢«å®šä¹‰ã€‚Easy IP æ˜¯ NAPT çš„ä¸€ä¸ªç‰¹æ®Šå½¢å¼ã€‚ NAPT çš„ä¸»è¦åº”ç”¨åœºæ™¯æ˜¯ï¼Œå†…ç½‘ç”¨æˆ·éœ€è¦è®¿é—®åˆ°å…¬ç½‘ä¸»æœºã€‚ç»å¤§å¤šæ•°çš„å®¶åº­ç½‘ç»œã€åŠå…¬ç½‘ç»œéƒ½æ˜¯ NAPT ç±»å‹çš„ã€‚åŸå› åº”è¯¥å¾ˆå¥½ç†è§£â€”â€”å®¶åº­ç½‘ç»œæˆ–åŠå…¬ç½‘ç»œéƒ½åŒ…å«è®¸å¤šè”ç½‘è®¾å¤‡ï¼Œä½†æ˜¯è¿™ç±»ç½‘ç»œé€šå¸¸åªæœ‰ä¸€ä¸ªæˆ–æ•°ä¸ªå…¬ç½‘ IPï¼Œä½¿ç”¨ä¸€å¯¹ä¸€ NAT çš„è¯å…¬ç½‘ IP æ˜¾ç„¶æ˜¯ä¸å¤Ÿç”¨çš„ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ä¸€å¯¹å¤š NAT. NAPT é€šè¿‡åŒæ—¶åˆ©ç”¨ L3 çš„ IP ä¿¡æ¯ï¼Œä»¥åŠ L4 ä¼ è¾“å±‚çš„ç«¯å£ä¿¡æ¯ï¼Œæ¥ä¸ºå±€åŸŸç½‘è®¾å¤‡æä¾›é€æ˜çš„ã€é…ç½®æ–¹ä¾¿çš„ã€æ”¯æŒè¶…é«˜å¹¶å‘è¿æ¥çš„å¤–éƒ¨ç½‘ç»œé€šä¿¡ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š NAPT çš„ç«¯å£åˆ†é…ä¸è½¬æ¢è§„åˆ™ï¼ˆMapping Behaviorï¼‰ä»¥åŠå¯¹å¤–æ¥æµé‡çš„è¿‡æ»¤è§„åˆ™ï¼ˆFiltering Behaviorï¼‰éƒ½å­˜åœ¨è®¸å¤šä¸åŒçš„å®ç°ï¼Œæ²¡æœ‰ç»Ÿä¸€çš„è§„èŒƒä¸æ ‡å‡†ï¼Œä½†æ˜¯å­˜åœ¨ä¸¤ç§åˆ†ç±»è§„èŒƒï¼Œè¿™ç§åˆ†ç±»æ–¹æ³•ä¸»è¦ç”¨åœ¨ NAT ç©¿è¶ŠæŠ€æœ¯ä¸­ã€‚ RFC3489 å®šä¹‰çš„ NAT ç±»å‹ï¼ˆå››ç§ï¼‰åœ¨ RFC3489 ä¸­å°† NAPT åˆ†ä¸ºå››ç§ç±»å‹ï¼Œè¿™ä¹Ÿæ˜¯åº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ NAT åˆ†ç±»æ–¹æ³•ï¼Œå¦‚ä¸‹å›¾ï¼š ä¸‹é¢æˆ‘ä»¬é€ä¸€ä»‹ç»è¿™å››ç§ä¸åŒçš„ NAPT ç±»å‹ã€‚ ä»è¿™é‡Œå¼€å§‹ï¼Œä¸‹æ–‡ä¸­çš„ NAT ç‰¹æŒ‡ NAPTï¼Œå¦‚æœæ¶‰åŠã€Œä¸€å¯¹ä¸€ NATã€ä¼šä½¿ç”¨å®ƒçš„å…¨åã€‚ 1. Full-cone NATFull-cone NAT çš„ç‰¹ç‚¹å¦‚ä¸‹ï¼š æ•°æ®åŒ…æµå‡ºï¼šä¸€æ—¦å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰æ˜ å°„åˆ°å¤–éƒ¨åœ°å€ï¼ˆeAddr:ePortï¼‰ï¼Œæ‰€æœ‰å‘è‡ª iAddr:iPort çš„æ•°æ®åŒ…éƒ½ç»ç”± eAddr:ePort å‘å¤–å‘é€ã€‚ æ•°æ®åŒ…æµå…¥ï¼šä»»æ„ä¸»æœºå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œéƒ½èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. ä¹Ÿå°±æ˜¯ä¸å¯¹å¤–éƒ¨è¿›æ¥çš„æ•°æ®åšä»»ä½•é™åˆ¶ï¼Œå…¨éƒ¨æ”¾è¡Œã€‚ cone åœ†é”¥ï¼Œä¸ªäººç†è§£æ˜¯ä¸€ä¸ªæ¯”å–»ï¼Œä»»æ„å‘é€è¿›æ¥çš„æ•°æ®ï¼ˆå¤šï¼‰ï¼Œéƒ½èƒ½é€šè¿‡ NAT åˆ°è¾¾è¿™ä¸ªå†…éƒ¨åœ°å€ ï¼ˆä¸€ï¼‰ï¼Œå°±åƒä¸€ä¸ªåœ†é”¥ã€‚ å…è®¸ä»»æ„ä¸»æœºå‘é€åˆ° eAddr:ePort çš„æ•°æ®åˆ°è¾¾å†…éƒ¨åœ°å€æ˜¯å¾ˆå±é™©çš„è¡Œä¸ºï¼Œå› ä¸ºå†…éƒ¨ä¸»æœºä¸ä¸€å®šé…ç½®äº†åˆé€‚çš„å®‰å…¨ç­–ç•¥ã€‚å› æ­¤ Full-cone NAT æ¯”è¾ƒå°‘è§ï¼Œå°±ç®—è·¯ç”±å™¨ç­‰ NAT è®¾å¤‡æ”¯æŒ Full-cone NATï¼Œ é€šå¸¸ä¹Ÿä¸ä¼šæ˜¯é»˜è®¤é€‰é¡¹ã€‚æˆ‘ä»¬ä¼šåœ¨åé¢æ›´è¯¦ç»†åœ°ä»‹ç»å®ƒã€‚ 2. (Address-)Restricted cone NAT æ•°æ®åŒ…æµå‡ºï¼šï¼ˆè·Ÿ Full-cone NAT å®Œå…¨ä¸€è‡´ï¼‰ä¸€æ—¦å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰æ˜ å°„åˆ°å¤–éƒ¨åœ°å€ ï¼ˆeAddr:ePortï¼‰ï¼Œæ‰€æœ‰å‘è‡ª iAddr:iPort çš„æ•°æ®åŒ…éƒ½ç»ç”± eAddr:ePort å‘å¤–å‘é€ã€‚ æ•°æ®åŒ…æµå…¥ï¼šåªæœ‰å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸»åŠ¨è¿æ¥è¿‡çš„å¤–éƒ¨ä¸»æœºï¼ˆnAddr:anyï¼‰ï¼Œå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œæ‰èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. è·Ÿ Full-cone NAT çš„åŒºåˆ«åœ¨äºï¼Œå®ƒé™åˆ¶äº†å¤–éƒ¨ä¸»æœºçš„ IP åœ°å€ã€‚åªæœ‰ä¸»åŠ¨è¿æ¥è¿‡çš„ä¸»æœºï¼Œæ‰èƒ½å‘é€æ•°æ®åˆ° NAT å†…éƒ¨ã€‚è¿™æå‡äº†ä¸€äº›å®‰å…¨æ€§ã€‚ 3. Port-Restricted cone NAT æ•°æ®åŒ…æµå‡ºï¼šï¼ˆè·Ÿ Full-cone NAT å®Œå…¨ä¸€è‡´ï¼‰ä¸€æ—¦å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰æ˜ å°„åˆ°å¤–éƒ¨åœ°å€ ï¼ˆeAddr:ePortï¼‰ï¼Œæ‰€æœ‰å‘è‡ª iAddr:iPort çš„æ•°æ®åŒ…éƒ½ç»ç”± eAddr:ePort å‘å¤–å‘é€ã€‚ æ•°æ®åŒ…æµå…¥ï¼šåªæœ‰å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸»åŠ¨è¿æ¥è¿‡çš„å¤–éƒ¨ç¨‹åºï¼ˆnAddr:nPortï¼‰ï¼Œå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œæ‰èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. ä¸ Address-Restricted cone NAT çš„åŒºåˆ«åœ¨äºï¼Œå®ƒåŒæ—¶é™åˆ¶äº†å¤–éƒ¨ä¸»æœºçš„ IP ä¸ç«¯å£ï¼Œå¯ä»¥è¯´æ˜¯æ›´è¿›ä¸€æ­¥åœ°æå‡äº†å®‰å…¨æ€§ã€‚ 4. Symmetric NAT æ•°æ®åŒ…æµå‡ºï¼šåŒä¸€ä¸ªå†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸ä¸åŒå¤–éƒ¨ä¸»æœºï¼ˆnAddr:nPortï¼‰çš„é€šä¿¡ï¼Œä¼šéšæœºä½¿ç”¨ä¸åŒçš„ NAT å¤–éƒ¨ç«¯å£ï¼ˆeAddr:randomPortï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´å†…éƒ¨åœ°å€ä¸ NAT å¤–éƒ¨åœ°å€çš„å…³ç³»ä¹Ÿæ˜¯ä¸€å¯¹å¤šï¼ ä¸ºæ¯ä¸ªè¿æ¥éƒ½éšæœºé€‰æ‹©ä¸€ä¸ªä¸åŒçš„ NAT ç«¯å£ï¼Œè¿™å®é™…æ˜¯è¿›ä¸€æ­¥å¼ºåŒ–äº† NAT å†…ç½‘çš„å®‰å…¨æ€§ã€‚ä½†è¿™ä¹Ÿæ˜¯ NAT ç©¿è¶Šæœ€å¤§çš„éš¾ç‚¹â€”â€”å®ƒå¯¼è‡´ Symmetric NAT çš„ç«¯å£éš¾ä»¥é¢„æµ‹ï¼ æ•°æ®åŒ…æµå…¥ï¼šåªæœ‰å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸»åŠ¨è¿æ¥è¿‡çš„å¤–éƒ¨ç¨‹åºï¼ˆnAddr:nPortï¼‰ï¼Œå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œæ‰èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. è¿™ä¸ªæ•°æ®æµå…¥è§„åˆ™ï¼Œä¸ Port-Restricted cone NAT æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚ å¯¹ç§° NAT æ˜¯æœ€å®‰å…¨çš„ä¸€ç§ NAT ç»“æ„ï¼Œé™åˆ¶æœ€ä¸ºä¸¥æ ¼ï¼Œåº”è¯¥ä¹Ÿæ˜¯åº”ç”¨æœ€å¹¿æ³›çš„ NAT ç»“æ„ã€‚ä½†æ˜¯å®ƒå¯¼è‡´æ‰€æœ‰çš„ TCP è¿æ¥éƒ½åªèƒ½ç”±ä»å†…éƒ¨ä¸»åŠ¨å‘èµ·ï¼Œå¤–éƒ¨å‘èµ·çš„ TCP è¿æ¥è¯·æ±‚ä¼šç›´æ¥è¢« NAT æ‹’ç»ï¼Œå› æ­¤å®ƒä¹Ÿæ˜¯ P2P ç©å®¶æœ€å¤´ç–¼çš„ä¸€ç§ NAT ç±»å‹ã€‚è§£å†³æ–¹æ¡ˆæ˜¯é€šè¿‡ UDP è¿‚å›å®ç°è¿æ¥çš„å»ºç«‹ï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚ 5. Linux ä¸­çš„ NAPTLinux çš„ç½‘ç»œæ ˆä¸­ï¼Œå¯é€šè¿‡ iptables/netfilter çš„ SNAT/MASQUERADE å®ç° NAPT ç½‘å…³ï¼Œè¿™ç§æ–¹å¼åªèƒ½å®ç°ä¸€ä¸ª Symmetric NAT. ä¹Ÿå°±æ˜¯è¯´ç»å¤§å¤šæ•°åŸºäº Linux å®ç°çš„å®¶åº­å±€åŸŸç½‘ã€Docker è™šæ‹Ÿç½‘ç»œã€Kubernetes è™šæ‹Ÿç½‘ç»œã€äº‘æœåŠ¡çš„è™šæ‹Ÿç½‘ç»œï¼Œéƒ½æ˜¯ Symmetric NAT. åªæœ‰ä¸€äº›æœ‰ Full-cone NAT éœ€æ±‚çš„ç½‘å§ã€ISP çš„ LSN(Large Scale NAT) ç½‘å…³ç­‰ç»„ç»‡ï¼Œä¼šä½¿ç”¨é Linux å†…æ ¸çš„ä¼ä¸šçº§è·¯ç”±å™¨æä¾› Full-cone NAT èƒ½åŠ›ï¼Œè¿™äº›è®¾å¤‡å¯èƒ½æ˜¯åŸºäº FPGA ç­‰ä¸“ç”¨èŠ¯ç‰‡è®¾è®¡çš„ã€‚ æƒ³è¦å°† Symmetric NAT å†…çš„ä¸»æœºæä¾›ç»™å¤–éƒ¨è®¿é—®ï¼Œåªèƒ½é€šè¿‡ç«¯å£æ˜ å°„ã€ä¸€å¯¹ä¸€ NAT ç­‰æ–¹å¼å®ç°ï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»è¿™äº›æ–¹æ³•ã€‚ RFC5389 å®šä¹‰çš„ NAT ç±»å‹ï¼ˆä¹ç§ï¼‰RFC3489 è¿™ä¸ªæ—©æœŸ RFC å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œé—®é¢˜ä¹‹ä¸€å°±æ˜¯å®ƒå¯¹ NAT å½’ç±»è¿‡äºç¬¼ç»Ÿï¼Œå¾ˆå¤š NAPT ç½‘å…³éƒ½æ— æ³•å¾ˆå¥½çš„åŒ¹é…ä¸Šå…¶ä¸­æŸä¸ªç±»åˆ«ã€‚ äºæ˜¯åæ¥ï¼ŒRFC3489 è¢«åºŸå¼ƒå¹¶ç”± RFC5389 æ¥æ›¿ä»£ï¼Œåœ¨ RFC5389 ä¸­ï¼Œå°† Mapping Behaviorï¼ˆæ˜ å°„è§„åˆ™ï¼‰å’Œ Filtering Behaviorï¼ˆè¿‡æ»¤è§„åˆ™ï¼‰åˆ†å¼€æ¥ï¼Œå®šä¹‰äº† 3 ç§ Mapping Behaviorï¼ˆæ˜ å°„è§„åˆ™ï¼‰å’Œ 3 ç§ Filtering Behaviorï¼ˆè¿‡æ»¤è§„åˆ™ï¼‰ï¼Œä¸€å…±æœ‰ 9 ç§ç»„åˆã€‚ 1. æ˜ å°„è§„åˆ™ä¸‰ç§æ˜ å°„è§„åˆ™å¦‚å›¾æ‰€ç¤ºï¼Œå‡è®¾ä¸€ä¸ªå†…ç½‘ä¸»æœº HostX çš„å†…ç½‘ IP åœ°å€ä¸º Xï¼Œç«¯å£å·ä¸º xï¼Œç» NAT æ˜ å°„åçš„å¤–ç½‘ IP åœ°å€ä¸º Mï¼Œç«¯å£å·ä¸º mã€‚ä¸ºæ–¹ä¾¿æè¿°ï¼Œå°†å†…ç½‘çš„ Endpoint è®°ä¸º Endpoint(X,x)ï¼Œæ˜ å°„åå¤–ç½‘çš„ Endpoint è®°ä¸º Endpoint(M,m)ã€‚å†…ç½‘ Endpoint(X,x) å‘å¾€å¤–ç½‘ HostD1 çš„ IP åœ°å€å’Œç«¯å£å·è®°ä¸ºç›®çš„ Endpoint(D1,d1)ï¼›å‘å¾€å¤–ç½‘ HostD2 çš„ IP åœ°å€å’Œç«¯å£å·è®°ä¸ºç›®çš„Endpoint(D2,d2)ã€‚ NAT æ˜ å°„è§„åˆ™ EIM(Endpoint-Independent Mapping) å¤–éƒ¨åœ°å€æ— å…³æ˜ å°„ å¯¹äºä¸€ä¸ªå†…ç½‘ Endpoint(X,x)ï¼Œå…¶æ˜ å°„çš„å¤–ç½‘ Endpoint(M,m) æ˜¯å›ºå®šçš„ã€‚å³ä»ç›¸åŒçš„Endpoint(X,x) å‘é€åˆ°ä»»ä½•å¤–éƒ¨ IP åœ°å€å’Œä»»ä½•å¤–éƒ¨ç«¯å£çš„æŠ¥æ–‡åœ¨ NAT è®¾å¤‡ä¸Šä½¿ç”¨ç›¸åŒçš„æ˜ å°„ã€‚ ADM(Address-Dependent Mapping) å¤–éƒ¨åœ°å€ç›¸å…³æ˜ å°„ï¼šå¯¹äºä¸€ä¸ªå†…ç½‘ Endpoint(X,x)ï¼Œå‘å¾€ç›®çš„ Endpoint(D1,d1) çš„æŠ¥æ–‡ï¼ŒEndpoint(X,x) è¢«æ˜ å°„æˆ Endpoint(M1,m1)ï¼›å‘å¾€ç›®çš„Endpoint(D2,d2) çš„æŠ¥æ–‡ï¼ŒEndpoint(X,x) è¢«æ˜ å°„æˆ Endpoint(M2,m2)ã€‚åªè¦D1=D2ï¼Œä¸ç®¡d1 å’Œd2æ˜¯å¤šå°‘ï¼Œéƒ½æœ‰ Endpoint(M1,m1)=Endpoint(M2,m2)ã€‚å³ä»ç›¸åŒçš„ Endpoint(X,x) å‘é€åˆ°ç›¸åŒå¤–éƒ¨ IP åœ°å€å’Œä»»ä½•å¤–éƒ¨ç«¯å£çš„æŠ¥æ–‡åœ¨ NAT è®¾å¤‡ä¸Šä½¿ç”¨ç›¸åŒçš„æ˜ å°„ã€‚ APDMï¼ˆAddress and Port-Dependent Mappingï¼‰å¤–éƒ¨åœ°å€å’Œç«¯å£ç›¸å…³æ˜ å°„ï¼šå¯¹äºä¸€ä¸ªå†…ç½‘Endpoint(X,x)ï¼Œå‘å¾€ç›®çš„ Endpoint(D1,d1) çš„æŠ¥æ–‡ï¼ŒEndpoint(X,x) è¢«æ˜ å°„æˆEndpoint(M1,m1)ï¼›å‘å¾€ç›®çš„ Endpoint(D2,d2) çš„æŠ¥æ–‡ï¼Œ Endpoint(X,x) è¢«æ˜ å°„æˆEndpoint(M2,m2)ã€‚åªæœ‰å½“D1=D2ï¼Œä¸”d1=d2ï¼Œæ‰æœ‰ Endpoint(M1,m1)=Endpoint(M2,m2)ã€‚å³ä»ç›¸åŒçš„ Endpoint(X,x) å‘é€åˆ°ç›¸åŒå¤–éƒ¨IPåœ°å€å’Œç›¸åŒå¤–éƒ¨ç«¯å£çš„æŠ¥æ–‡åœ¨NATè®¾å¤‡ä¸Šä½¿ç”¨ç›¸åŒçš„æ˜ å°„ã€‚ 2. è¿‡æ»¤è§„åˆ™ NAT è¿‡æ»¤è§„åˆ™ EIFï¼ˆEndpoint-Independent Filteringï¼‰å¤–éƒ¨åœ°å€æ— å…³è¿‡æ»¤ï¼šå¯¹äºä¸€ä¸ªå†…ç½‘Endpoint(X,x)ï¼Œåªè¦å®ƒæ›¾ç»å‘å¤–ç½‘å‘é€è¿‡æ•°æ®ï¼Œå¤–ç½‘ä¸»æœºå°±å¯ä»¥è·å–åˆ°å®ƒç» NAT æ˜ å°„åçš„å¤–ç½‘Endpoint(M,m) ã€‚é‚£ä¹ˆåªè¦æ˜¯å‘ç»™ Endpoint(M,m) çš„æŠ¥æ–‡ï¼Œä¸ç®¡æ¥æºäº D1 è¿˜æ˜¯ D2ï¼Œéƒ½èƒ½è¢«è½¬æ¢å¹¶å‘å¾€å†…ç½‘ï¼Œå…¶ä»–æŠ¥æ–‡è¢«è¿‡æ»¤æ‰ã€‚ ADFï¼ˆAddr","date":"2022-05-13","objectID":"/posts/about-nat/:3:2","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["NAT","ç½‘ç»œ","NAT ç©¿è¶Š","å†…ç½‘ç©¿é€","è™šæ‹Ÿç½‘ç»œ","P2P","WebRTC"],"title":"NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ","uri":"/posts/about-nat/#2-ä¸€å¯¹å¤š-nat---napt"},{"categories":["tech"],"content":" 2. ä¸€å¯¹å¤š NAT - NAPTä¸€å¯¹å¤š NATï¼Œä¹Ÿè¢«ç§°ä¸º NAPTï¼ˆnetwork address and port translationï¼‰ï¼ŒåŒæ ·åœ¨RFC2663 ä¸­è¢«å®šä¹‰ã€‚Easy IP æ˜¯ NAPT çš„ä¸€ä¸ªç‰¹æ®Šå½¢å¼ã€‚ NAPT çš„ä¸»è¦åº”ç”¨åœºæ™¯æ˜¯ï¼Œå†…ç½‘ç”¨æˆ·éœ€è¦è®¿é—®åˆ°å…¬ç½‘ä¸»æœºã€‚ç»å¤§å¤šæ•°çš„å®¶åº­ç½‘ç»œã€åŠå…¬ç½‘ç»œéƒ½æ˜¯ NAPT ç±»å‹çš„ã€‚åŸå› åº”è¯¥å¾ˆå¥½ç†è§£â€”â€”å®¶åº­ç½‘ç»œæˆ–åŠå…¬ç½‘ç»œéƒ½åŒ…å«è®¸å¤šè”ç½‘è®¾å¤‡ï¼Œä½†æ˜¯è¿™ç±»ç½‘ç»œé€šå¸¸åªæœ‰ä¸€ä¸ªæˆ–æ•°ä¸ªå…¬ç½‘ IPï¼Œä½¿ç”¨ä¸€å¯¹ä¸€ NAT çš„è¯å…¬ç½‘ IP æ˜¾ç„¶æ˜¯ä¸å¤Ÿç”¨çš„ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ä¸€å¯¹å¤š NAT. NAPT é€šè¿‡åŒæ—¶åˆ©ç”¨ L3 çš„ IP ä¿¡æ¯ï¼Œä»¥åŠ L4 ä¼ è¾“å±‚çš„ç«¯å£ä¿¡æ¯ï¼Œæ¥ä¸ºå±€åŸŸç½‘è®¾å¤‡æä¾›é€æ˜çš„ã€é…ç½®æ–¹ä¾¿çš„ã€æ”¯æŒè¶…é«˜å¹¶å‘è¿æ¥çš„å¤–éƒ¨ç½‘ç»œé€šä¿¡ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š NAPT çš„ç«¯å£åˆ†é…ä¸è½¬æ¢è§„åˆ™ï¼ˆMapping Behaviorï¼‰ä»¥åŠå¯¹å¤–æ¥æµé‡çš„è¿‡æ»¤è§„åˆ™ï¼ˆFiltering Behaviorï¼‰éƒ½å­˜åœ¨è®¸å¤šä¸åŒçš„å®ç°ï¼Œæ²¡æœ‰ç»Ÿä¸€çš„è§„èŒƒä¸æ ‡å‡†ï¼Œä½†æ˜¯å­˜åœ¨ä¸¤ç§åˆ†ç±»è§„èŒƒï¼Œè¿™ç§åˆ†ç±»æ–¹æ³•ä¸»è¦ç”¨åœ¨ NAT ç©¿è¶ŠæŠ€æœ¯ä¸­ã€‚ RFC3489 å®šä¹‰çš„ NAT ç±»å‹ï¼ˆå››ç§ï¼‰åœ¨ RFC3489 ä¸­å°† NAPT åˆ†ä¸ºå››ç§ç±»å‹ï¼Œè¿™ä¹Ÿæ˜¯åº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ NAT åˆ†ç±»æ–¹æ³•ï¼Œå¦‚ä¸‹å›¾ï¼š ä¸‹é¢æˆ‘ä»¬é€ä¸€ä»‹ç»è¿™å››ç§ä¸åŒçš„ NAPT ç±»å‹ã€‚ ä»è¿™é‡Œå¼€å§‹ï¼Œä¸‹æ–‡ä¸­çš„ NAT ç‰¹æŒ‡ NAPTï¼Œå¦‚æœæ¶‰åŠã€Œä¸€å¯¹ä¸€ NATã€ä¼šä½¿ç”¨å®ƒçš„å…¨åã€‚ 1. Full-cone NATFull-cone NAT çš„ç‰¹ç‚¹å¦‚ä¸‹ï¼š æ•°æ®åŒ…æµå‡ºï¼šä¸€æ—¦å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰æ˜ å°„åˆ°å¤–éƒ¨åœ°å€ï¼ˆeAddr:ePortï¼‰ï¼Œæ‰€æœ‰å‘è‡ª iAddr:iPort çš„æ•°æ®åŒ…éƒ½ç»ç”± eAddr:ePort å‘å¤–å‘é€ã€‚ æ•°æ®åŒ…æµå…¥ï¼šä»»æ„ä¸»æœºå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œéƒ½èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. ä¹Ÿå°±æ˜¯ä¸å¯¹å¤–éƒ¨è¿›æ¥çš„æ•°æ®åšä»»ä½•é™åˆ¶ï¼Œå…¨éƒ¨æ”¾è¡Œã€‚ cone åœ†é”¥ï¼Œä¸ªäººç†è§£æ˜¯ä¸€ä¸ªæ¯”å–»ï¼Œä»»æ„å‘é€è¿›æ¥çš„æ•°æ®ï¼ˆå¤šï¼‰ï¼Œéƒ½èƒ½é€šè¿‡ NAT åˆ°è¾¾è¿™ä¸ªå†…éƒ¨åœ°å€ ï¼ˆä¸€ï¼‰ï¼Œå°±åƒä¸€ä¸ªåœ†é”¥ã€‚ å…è®¸ä»»æ„ä¸»æœºå‘é€åˆ° eAddr:ePort çš„æ•°æ®åˆ°è¾¾å†…éƒ¨åœ°å€æ˜¯å¾ˆå±é™©çš„è¡Œä¸ºï¼Œå› ä¸ºå†…éƒ¨ä¸»æœºä¸ä¸€å®šé…ç½®äº†åˆé€‚çš„å®‰å…¨ç­–ç•¥ã€‚å› æ­¤ Full-cone NAT æ¯”è¾ƒå°‘è§ï¼Œå°±ç®—è·¯ç”±å™¨ç­‰ NAT è®¾å¤‡æ”¯æŒ Full-cone NATï¼Œ é€šå¸¸ä¹Ÿä¸ä¼šæ˜¯é»˜è®¤é€‰é¡¹ã€‚æˆ‘ä»¬ä¼šåœ¨åé¢æ›´è¯¦ç»†åœ°ä»‹ç»å®ƒã€‚ 2. (Address-)Restricted cone NAT æ•°æ®åŒ…æµå‡ºï¼šï¼ˆè·Ÿ Full-cone NAT å®Œå…¨ä¸€è‡´ï¼‰ä¸€æ—¦å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰æ˜ å°„åˆ°å¤–éƒ¨åœ°å€ ï¼ˆeAddr:ePortï¼‰ï¼Œæ‰€æœ‰å‘è‡ª iAddr:iPort çš„æ•°æ®åŒ…éƒ½ç»ç”± eAddr:ePort å‘å¤–å‘é€ã€‚ æ•°æ®åŒ…æµå…¥ï¼šåªæœ‰å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸»åŠ¨è¿æ¥è¿‡çš„å¤–éƒ¨ä¸»æœºï¼ˆnAddr:anyï¼‰ï¼Œå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œæ‰èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. è·Ÿ Full-cone NAT çš„åŒºåˆ«åœ¨äºï¼Œå®ƒé™åˆ¶äº†å¤–éƒ¨ä¸»æœºçš„ IP åœ°å€ã€‚åªæœ‰ä¸»åŠ¨è¿æ¥è¿‡çš„ä¸»æœºï¼Œæ‰èƒ½å‘é€æ•°æ®åˆ° NAT å†…éƒ¨ã€‚è¿™æå‡äº†ä¸€äº›å®‰å…¨æ€§ã€‚ 3. Port-Restricted cone NAT æ•°æ®åŒ…æµå‡ºï¼šï¼ˆè·Ÿ Full-cone NAT å®Œå…¨ä¸€è‡´ï¼‰ä¸€æ—¦å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰æ˜ å°„åˆ°å¤–éƒ¨åœ°å€ ï¼ˆeAddr:ePortï¼‰ï¼Œæ‰€æœ‰å‘è‡ª iAddr:iPort çš„æ•°æ®åŒ…éƒ½ç»ç”± eAddr:ePort å‘å¤–å‘é€ã€‚ æ•°æ®åŒ…æµå…¥ï¼šåªæœ‰å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸»åŠ¨è¿æ¥è¿‡çš„å¤–éƒ¨ç¨‹åºï¼ˆnAddr:nPortï¼‰ï¼Œå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œæ‰èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. ä¸ Address-Restricted cone NAT çš„åŒºåˆ«åœ¨äºï¼Œå®ƒåŒæ—¶é™åˆ¶äº†å¤–éƒ¨ä¸»æœºçš„ IP ä¸ç«¯å£ï¼Œå¯ä»¥è¯´æ˜¯æ›´è¿›ä¸€æ­¥åœ°æå‡äº†å®‰å…¨æ€§ã€‚ 4. Symmetric NAT æ•°æ®åŒ…æµå‡ºï¼šåŒä¸€ä¸ªå†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸ä¸åŒå¤–éƒ¨ä¸»æœºï¼ˆnAddr:nPortï¼‰çš„é€šä¿¡ï¼Œä¼šéšæœºä½¿ç”¨ä¸åŒçš„ NAT å¤–éƒ¨ç«¯å£ï¼ˆeAddr:randomPortï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´å†…éƒ¨åœ°å€ä¸ NAT å¤–éƒ¨åœ°å€çš„å…³ç³»ä¹Ÿæ˜¯ä¸€å¯¹å¤šï¼ ä¸ºæ¯ä¸ªè¿æ¥éƒ½éšæœºé€‰æ‹©ä¸€ä¸ªä¸åŒçš„ NAT ç«¯å£ï¼Œè¿™å®é™…æ˜¯è¿›ä¸€æ­¥å¼ºåŒ–äº† NAT å†…ç½‘çš„å®‰å…¨æ€§ã€‚ä½†è¿™ä¹Ÿæ˜¯ NAT ç©¿è¶Šæœ€å¤§çš„éš¾ç‚¹â€”â€”å®ƒå¯¼è‡´ Symmetric NAT çš„ç«¯å£éš¾ä»¥é¢„æµ‹ï¼ æ•°æ®åŒ…æµå…¥ï¼šåªæœ‰å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸»åŠ¨è¿æ¥è¿‡çš„å¤–éƒ¨ç¨‹åºï¼ˆnAddr:nPortï¼‰ï¼Œå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œæ‰èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. è¿™ä¸ªæ•°æ®æµå…¥è§„åˆ™ï¼Œä¸ Port-Restricted cone NAT æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚ å¯¹ç§° NAT æ˜¯æœ€å®‰å…¨çš„ä¸€ç§ NAT ç»“æ„ï¼Œé™åˆ¶æœ€ä¸ºä¸¥æ ¼ï¼Œåº”è¯¥ä¹Ÿæ˜¯åº”ç”¨æœ€å¹¿æ³›çš„ NAT ç»“æ„ã€‚ä½†æ˜¯å®ƒå¯¼è‡´æ‰€æœ‰çš„ TCP è¿æ¥éƒ½åªèƒ½ç”±ä»å†…éƒ¨ä¸»åŠ¨å‘èµ·ï¼Œå¤–éƒ¨å‘èµ·çš„ TCP è¿æ¥è¯·æ±‚ä¼šç›´æ¥è¢« NAT æ‹’ç»ï¼Œå› æ­¤å®ƒä¹Ÿæ˜¯ P2P ç©å®¶æœ€å¤´ç–¼çš„ä¸€ç§ NAT ç±»å‹ã€‚è§£å†³æ–¹æ¡ˆæ˜¯é€šè¿‡ UDP è¿‚å›å®ç°è¿æ¥çš„å»ºç«‹ï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚ 5. Linux ä¸­çš„ NAPTLinux çš„ç½‘ç»œæ ˆä¸­ï¼Œå¯é€šè¿‡ iptables/netfilter çš„ SNAT/MASQUERADE å®ç° NAPT ç½‘å…³ï¼Œè¿™ç§æ–¹å¼åªèƒ½å®ç°ä¸€ä¸ª Symmetric NAT. ä¹Ÿå°±æ˜¯è¯´ç»å¤§å¤šæ•°åŸºäº Linux å®ç°çš„å®¶åº­å±€åŸŸç½‘ã€Docker è™šæ‹Ÿç½‘ç»œã€Kubernetes è™šæ‹Ÿç½‘ç»œã€äº‘æœåŠ¡çš„è™šæ‹Ÿç½‘ç»œï¼Œéƒ½æ˜¯ Symmetric NAT. åªæœ‰ä¸€äº›æœ‰ Full-cone NAT éœ€æ±‚çš„ç½‘å§ã€ISP çš„ LSN(Large Scale NAT) ç½‘å…³ç­‰ç»„ç»‡ï¼Œä¼šä½¿ç”¨é Linux å†…æ ¸çš„ä¼ä¸šçº§è·¯ç”±å™¨æä¾› Full-cone NAT èƒ½åŠ›ï¼Œè¿™äº›è®¾å¤‡å¯èƒ½æ˜¯åŸºäº FPGA ç­‰ä¸“ç”¨èŠ¯ç‰‡è®¾è®¡çš„ã€‚ æƒ³è¦å°† Symmetric NAT å†…çš„ä¸»æœºæä¾›ç»™å¤–éƒ¨è®¿é—®ï¼Œåªèƒ½é€šè¿‡ç«¯å£æ˜ å°„ã€ä¸€å¯¹ä¸€ NAT ç­‰æ–¹å¼å®ç°ï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»è¿™äº›æ–¹æ³•ã€‚ RFC5389 å®šä¹‰çš„ NAT ç±»å‹ï¼ˆä¹ç§ï¼‰RFC3489 è¿™ä¸ªæ—©æœŸ RFC å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œé—®é¢˜ä¹‹ä¸€å°±æ˜¯å®ƒå¯¹ NAT å½’ç±»è¿‡äºç¬¼ç»Ÿï¼Œå¾ˆå¤š NAPT ç½‘å…³éƒ½æ— æ³•å¾ˆå¥½çš„åŒ¹é…ä¸Šå…¶ä¸­æŸä¸ªç±»åˆ«ã€‚ äºæ˜¯åæ¥ï¼ŒRFC3489 è¢«åºŸå¼ƒå¹¶ç”± RFC5389 æ¥æ›¿ä»£ï¼Œåœ¨ RFC5389 ä¸­ï¼Œå°† Mapping Behaviorï¼ˆæ˜ å°„è§„åˆ™ï¼‰å’Œ Filtering Behaviorï¼ˆè¿‡æ»¤è§„åˆ™ï¼‰åˆ†å¼€æ¥ï¼Œå®šä¹‰äº† 3 ç§ Mapping Behaviorï¼ˆæ˜ å°„è§„åˆ™ï¼‰å’Œ 3 ç§ Filtering Behaviorï¼ˆè¿‡æ»¤è§„åˆ™ï¼‰ï¼Œä¸€å…±æœ‰ 9 ç§ç»„åˆã€‚ 1. æ˜ å°„è§„åˆ™ä¸‰ç§æ˜ å°„è§„åˆ™å¦‚å›¾æ‰€ç¤ºï¼Œå‡è®¾ä¸€ä¸ªå†…ç½‘ä¸»æœº HostX çš„å†…ç½‘ IP åœ°å€ä¸º Xï¼Œç«¯å£å·ä¸º xï¼Œç» NAT æ˜ å°„åçš„å¤–ç½‘ IP åœ°å€ä¸º Mï¼Œç«¯å£å·ä¸º mã€‚ä¸ºæ–¹ä¾¿æè¿°ï¼Œå°†å†…ç½‘çš„ Endpoint è®°ä¸º Endpoint(X,x)ï¼Œæ˜ å°„åå¤–ç½‘çš„ Endpoint è®°ä¸º Endpoint(M,m)ã€‚å†…ç½‘ Endpoint(X,x) å‘å¾€å¤–ç½‘ HostD1 çš„ IP åœ°å€å’Œç«¯å£å·è®°ä¸ºç›®çš„ Endpoint(D1,d1)ï¼›å‘å¾€å¤–ç½‘ HostD2 çš„ IP åœ°å€å’Œç«¯å£å·è®°ä¸ºç›®çš„Endpoint(D2,d2)ã€‚ NAT æ˜ å°„è§„åˆ™ EIM(Endpoint-Independent Mapping) å¤–éƒ¨åœ°å€æ— å…³æ˜ å°„ å¯¹äºä¸€ä¸ªå†…ç½‘ Endpoint(X,x)ï¼Œå…¶æ˜ å°„çš„å¤–ç½‘ Endpoint(M,m) æ˜¯å›ºå®šçš„ã€‚å³ä»ç›¸åŒçš„Endpoint(X,x) å‘é€åˆ°ä»»ä½•å¤–éƒ¨ IP åœ°å€å’Œä»»ä½•å¤–éƒ¨ç«¯å£çš„æŠ¥æ–‡åœ¨ NAT è®¾å¤‡ä¸Šä½¿ç”¨ç›¸åŒçš„æ˜ å°„ã€‚ ADM(Address-Dependent Mapping) å¤–éƒ¨åœ°å€ç›¸å…³æ˜ å°„ï¼šå¯¹äºä¸€ä¸ªå†…ç½‘ Endpoint(X,x)ï¼Œå‘å¾€ç›®çš„ Endpoint(D1,d1) çš„æŠ¥æ–‡ï¼ŒEndpoint(X,x) è¢«æ˜ å°„æˆ Endpoint(M1,m1)ï¼›å‘å¾€ç›®çš„Endpoint(D2,d2) çš„æŠ¥æ–‡ï¼ŒEndpoint(X,x) è¢«æ˜ å°„æˆ Endpoint(M2,m2)ã€‚åªè¦D1=D2ï¼Œä¸ç®¡d1 å’Œd2æ˜¯å¤šå°‘ï¼Œéƒ½æœ‰ Endpoint(M1,m1)=Endpoint(M2,m2)ã€‚å³ä»ç›¸åŒçš„ Endpoint(X,x) å‘é€åˆ°ç›¸åŒå¤–éƒ¨ IP åœ°å€å’Œä»»ä½•å¤–éƒ¨ç«¯å£çš„æŠ¥æ–‡åœ¨ NAT è®¾å¤‡ä¸Šä½¿ç”¨ç›¸åŒçš„æ˜ å°„ã€‚ APDMï¼ˆAddress and Port-Dependent Mappingï¼‰å¤–éƒ¨åœ°å€å’Œç«¯å£ç›¸å…³æ˜ å°„ï¼šå¯¹äºä¸€ä¸ªå†…ç½‘Endpoint(X,x)ï¼Œå‘å¾€ç›®çš„ Endpoint(D1,d1) çš„æŠ¥æ–‡ï¼ŒEndpoint(X,x) è¢«æ˜ å°„æˆEndpoint(M1,m1)ï¼›å‘å¾€ç›®çš„ Endpoint(D2,d2) çš„æŠ¥æ–‡ï¼Œ Endpoint(X,x) è¢«æ˜ å°„æˆEndpoint(M2,m2)ã€‚åªæœ‰å½“D1=D2ï¼Œä¸”d1=d2ï¼Œæ‰æœ‰ Endpoint(M1,m1)=Endpoint(M2,m2)ã€‚å³ä»ç›¸åŒçš„ Endpoint(X,x) å‘é€åˆ°ç›¸åŒå¤–éƒ¨IPåœ°å€å’Œç›¸åŒå¤–éƒ¨ç«¯å£çš„æŠ¥æ–‡åœ¨NATè®¾å¤‡ä¸Šä½¿ç”¨ç›¸åŒçš„æ˜ å°„ã€‚ 2. è¿‡æ»¤è§„åˆ™ NAT è¿‡æ»¤è§„åˆ™ EIFï¼ˆEndpoint-Independent Filteringï¼‰å¤–éƒ¨åœ°å€æ— å…³è¿‡æ»¤ï¼šå¯¹äºä¸€ä¸ªå†…ç½‘Endpoint(X,x)ï¼Œåªè¦å®ƒæ›¾ç»å‘å¤–ç½‘å‘é€è¿‡æ•°æ®ï¼Œå¤–ç½‘ä¸»æœºå°±å¯ä»¥è·å–åˆ°å®ƒç» NAT æ˜ å°„åçš„å¤–ç½‘Endpoint(M,m) ã€‚é‚£ä¹ˆåªè¦æ˜¯å‘ç»™ Endpoint(M,m) çš„æŠ¥æ–‡ï¼Œä¸ç®¡æ¥æºäº D1 è¿˜æ˜¯ D2ï¼Œéƒ½èƒ½è¢«è½¬æ¢å¹¶å‘å¾€å†…ç½‘ï¼Œå…¶ä»–æŠ¥æ–‡è¢«è¿‡æ»¤æ‰ã€‚ ADFï¼ˆAddr","date":"2022-05-13","objectID":"/posts/about-nat/:3:2","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["NAT","ç½‘ç»œ","NAT ç©¿è¶Š","å†…ç½‘ç©¿é€","è™šæ‹Ÿç½‘ç»œ","P2P","WebRTC"],"title":"NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ","uri":"/posts/about-nat/#rfc3489-å®šä¹‰çš„-nat-ç±»å‹å››ç§"},{"categories":["tech"],"content":" 2. ä¸€å¯¹å¤š NAT - NAPTä¸€å¯¹å¤š NATï¼Œä¹Ÿè¢«ç§°ä¸º NAPTï¼ˆnetwork address and port translationï¼‰ï¼ŒåŒæ ·åœ¨RFC2663 ä¸­è¢«å®šä¹‰ã€‚Easy IP æ˜¯ NAPT çš„ä¸€ä¸ªç‰¹æ®Šå½¢å¼ã€‚ NAPT çš„ä¸»è¦åº”ç”¨åœºæ™¯æ˜¯ï¼Œå†…ç½‘ç”¨æˆ·éœ€è¦è®¿é—®åˆ°å…¬ç½‘ä¸»æœºã€‚ç»å¤§å¤šæ•°çš„å®¶åº­ç½‘ç»œã€åŠå…¬ç½‘ç»œéƒ½æ˜¯ NAPT ç±»å‹çš„ã€‚åŸå› åº”è¯¥å¾ˆå¥½ç†è§£â€”â€”å®¶åº­ç½‘ç»œæˆ–åŠå…¬ç½‘ç»œéƒ½åŒ…å«è®¸å¤šè”ç½‘è®¾å¤‡ï¼Œä½†æ˜¯è¿™ç±»ç½‘ç»œé€šå¸¸åªæœ‰ä¸€ä¸ªæˆ–æ•°ä¸ªå…¬ç½‘ IPï¼Œä½¿ç”¨ä¸€å¯¹ä¸€ NAT çš„è¯å…¬ç½‘ IP æ˜¾ç„¶æ˜¯ä¸å¤Ÿç”¨çš„ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ä¸€å¯¹å¤š NAT. NAPT é€šè¿‡åŒæ—¶åˆ©ç”¨ L3 çš„ IP ä¿¡æ¯ï¼Œä»¥åŠ L4 ä¼ è¾“å±‚çš„ç«¯å£ä¿¡æ¯ï¼Œæ¥ä¸ºå±€åŸŸç½‘è®¾å¤‡æä¾›é€æ˜çš„ã€é…ç½®æ–¹ä¾¿çš„ã€æ”¯æŒè¶…é«˜å¹¶å‘è¿æ¥çš„å¤–éƒ¨ç½‘ç»œé€šä¿¡ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š NAPT çš„ç«¯å£åˆ†é…ä¸è½¬æ¢è§„åˆ™ï¼ˆMapping Behaviorï¼‰ä»¥åŠå¯¹å¤–æ¥æµé‡çš„è¿‡æ»¤è§„åˆ™ï¼ˆFiltering Behaviorï¼‰éƒ½å­˜åœ¨è®¸å¤šä¸åŒçš„å®ç°ï¼Œæ²¡æœ‰ç»Ÿä¸€çš„è§„èŒƒä¸æ ‡å‡†ï¼Œä½†æ˜¯å­˜åœ¨ä¸¤ç§åˆ†ç±»è§„èŒƒï¼Œè¿™ç§åˆ†ç±»æ–¹æ³•ä¸»è¦ç”¨åœ¨ NAT ç©¿è¶ŠæŠ€æœ¯ä¸­ã€‚ RFC3489 å®šä¹‰çš„ NAT ç±»å‹ï¼ˆå››ç§ï¼‰åœ¨ RFC3489 ä¸­å°† NAPT åˆ†ä¸ºå››ç§ç±»å‹ï¼Œè¿™ä¹Ÿæ˜¯åº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ NAT åˆ†ç±»æ–¹æ³•ï¼Œå¦‚ä¸‹å›¾ï¼š ä¸‹é¢æˆ‘ä»¬é€ä¸€ä»‹ç»è¿™å››ç§ä¸åŒçš„ NAPT ç±»å‹ã€‚ ä»è¿™é‡Œå¼€å§‹ï¼Œä¸‹æ–‡ä¸­çš„ NAT ç‰¹æŒ‡ NAPTï¼Œå¦‚æœæ¶‰åŠã€Œä¸€å¯¹ä¸€ NATã€ä¼šä½¿ç”¨å®ƒçš„å…¨åã€‚ 1. Full-cone NATFull-cone NAT çš„ç‰¹ç‚¹å¦‚ä¸‹ï¼š æ•°æ®åŒ…æµå‡ºï¼šä¸€æ—¦å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰æ˜ å°„åˆ°å¤–éƒ¨åœ°å€ï¼ˆeAddr:ePortï¼‰ï¼Œæ‰€æœ‰å‘è‡ª iAddr:iPort çš„æ•°æ®åŒ…éƒ½ç»ç”± eAddr:ePort å‘å¤–å‘é€ã€‚ æ•°æ®åŒ…æµå…¥ï¼šä»»æ„ä¸»æœºå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œéƒ½èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. ä¹Ÿå°±æ˜¯ä¸å¯¹å¤–éƒ¨è¿›æ¥çš„æ•°æ®åšä»»ä½•é™åˆ¶ï¼Œå…¨éƒ¨æ”¾è¡Œã€‚ cone åœ†é”¥ï¼Œä¸ªäººç†è§£æ˜¯ä¸€ä¸ªæ¯”å–»ï¼Œä»»æ„å‘é€è¿›æ¥çš„æ•°æ®ï¼ˆå¤šï¼‰ï¼Œéƒ½èƒ½é€šè¿‡ NAT åˆ°è¾¾è¿™ä¸ªå†…éƒ¨åœ°å€ ï¼ˆä¸€ï¼‰ï¼Œå°±åƒä¸€ä¸ªåœ†é”¥ã€‚ å…è®¸ä»»æ„ä¸»æœºå‘é€åˆ° eAddr:ePort çš„æ•°æ®åˆ°è¾¾å†…éƒ¨åœ°å€æ˜¯å¾ˆå±é™©çš„è¡Œä¸ºï¼Œå› ä¸ºå†…éƒ¨ä¸»æœºä¸ä¸€å®šé…ç½®äº†åˆé€‚çš„å®‰å…¨ç­–ç•¥ã€‚å› æ­¤ Full-cone NAT æ¯”è¾ƒå°‘è§ï¼Œå°±ç®—è·¯ç”±å™¨ç­‰ NAT è®¾å¤‡æ”¯æŒ Full-cone NATï¼Œ é€šå¸¸ä¹Ÿä¸ä¼šæ˜¯é»˜è®¤é€‰é¡¹ã€‚æˆ‘ä»¬ä¼šåœ¨åé¢æ›´è¯¦ç»†åœ°ä»‹ç»å®ƒã€‚ 2. (Address-)Restricted cone NAT æ•°æ®åŒ…æµå‡ºï¼šï¼ˆè·Ÿ Full-cone NAT å®Œå…¨ä¸€è‡´ï¼‰ä¸€æ—¦å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰æ˜ å°„åˆ°å¤–éƒ¨åœ°å€ ï¼ˆeAddr:ePortï¼‰ï¼Œæ‰€æœ‰å‘è‡ª iAddr:iPort çš„æ•°æ®åŒ…éƒ½ç»ç”± eAddr:ePort å‘å¤–å‘é€ã€‚ æ•°æ®åŒ…æµå…¥ï¼šåªæœ‰å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸»åŠ¨è¿æ¥è¿‡çš„å¤–éƒ¨ä¸»æœºï¼ˆnAddr:anyï¼‰ï¼Œå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œæ‰èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. è·Ÿ Full-cone NAT çš„åŒºåˆ«åœ¨äºï¼Œå®ƒé™åˆ¶äº†å¤–éƒ¨ä¸»æœºçš„ IP åœ°å€ã€‚åªæœ‰ä¸»åŠ¨è¿æ¥è¿‡çš„ä¸»æœºï¼Œæ‰èƒ½å‘é€æ•°æ®åˆ° NAT å†…éƒ¨ã€‚è¿™æå‡äº†ä¸€äº›å®‰å…¨æ€§ã€‚ 3. Port-Restricted cone NAT æ•°æ®åŒ…æµå‡ºï¼šï¼ˆè·Ÿ Full-cone NAT å®Œå…¨ä¸€è‡´ï¼‰ä¸€æ—¦å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰æ˜ å°„åˆ°å¤–éƒ¨åœ°å€ ï¼ˆeAddr:ePortï¼‰ï¼Œæ‰€æœ‰å‘è‡ª iAddr:iPort çš„æ•°æ®åŒ…éƒ½ç»ç”± eAddr:ePort å‘å¤–å‘é€ã€‚ æ•°æ®åŒ…æµå…¥ï¼šåªæœ‰å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸»åŠ¨è¿æ¥è¿‡çš„å¤–éƒ¨ç¨‹åºï¼ˆnAddr:nPortï¼‰ï¼Œå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œæ‰èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. ä¸ Address-Restricted cone NAT çš„åŒºåˆ«åœ¨äºï¼Œå®ƒåŒæ—¶é™åˆ¶äº†å¤–éƒ¨ä¸»æœºçš„ IP ä¸ç«¯å£ï¼Œå¯ä»¥è¯´æ˜¯æ›´è¿›ä¸€æ­¥åœ°æå‡äº†å®‰å…¨æ€§ã€‚ 4. Symmetric NAT æ•°æ®åŒ…æµå‡ºï¼šåŒä¸€ä¸ªå†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸ä¸åŒå¤–éƒ¨ä¸»æœºï¼ˆnAddr:nPortï¼‰çš„é€šä¿¡ï¼Œä¼šéšæœºä½¿ç”¨ä¸åŒçš„ NAT å¤–éƒ¨ç«¯å£ï¼ˆeAddr:randomPortï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´å†…éƒ¨åœ°å€ä¸ NAT å¤–éƒ¨åœ°å€çš„å…³ç³»ä¹Ÿæ˜¯ä¸€å¯¹å¤šï¼ ä¸ºæ¯ä¸ªè¿æ¥éƒ½éšæœºé€‰æ‹©ä¸€ä¸ªä¸åŒçš„ NAT ç«¯å£ï¼Œè¿™å®é™…æ˜¯è¿›ä¸€æ­¥å¼ºåŒ–äº† NAT å†…ç½‘çš„å®‰å…¨æ€§ã€‚ä½†è¿™ä¹Ÿæ˜¯ NAT ç©¿è¶Šæœ€å¤§çš„éš¾ç‚¹â€”â€”å®ƒå¯¼è‡´ Symmetric NAT çš„ç«¯å£éš¾ä»¥é¢„æµ‹ï¼ æ•°æ®åŒ…æµå…¥ï¼šåªæœ‰å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸»åŠ¨è¿æ¥è¿‡çš„å¤–éƒ¨ç¨‹åºï¼ˆnAddr:nPortï¼‰ï¼Œå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œæ‰èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. è¿™ä¸ªæ•°æ®æµå…¥è§„åˆ™ï¼Œä¸ Port-Restricted cone NAT æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚ å¯¹ç§° NAT æ˜¯æœ€å®‰å…¨çš„ä¸€ç§ NAT ç»“æ„ï¼Œé™åˆ¶æœ€ä¸ºä¸¥æ ¼ï¼Œåº”è¯¥ä¹Ÿæ˜¯åº”ç”¨æœ€å¹¿æ³›çš„ NAT ç»“æ„ã€‚ä½†æ˜¯å®ƒå¯¼è‡´æ‰€æœ‰çš„ TCP è¿æ¥éƒ½åªèƒ½ç”±ä»å†…éƒ¨ä¸»åŠ¨å‘èµ·ï¼Œå¤–éƒ¨å‘èµ·çš„ TCP è¿æ¥è¯·æ±‚ä¼šç›´æ¥è¢« NAT æ‹’ç»ï¼Œå› æ­¤å®ƒä¹Ÿæ˜¯ P2P ç©å®¶æœ€å¤´ç–¼çš„ä¸€ç§ NAT ç±»å‹ã€‚è§£å†³æ–¹æ¡ˆæ˜¯é€šè¿‡ UDP è¿‚å›å®ç°è¿æ¥çš„å»ºç«‹ï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚ 5. Linux ä¸­çš„ NAPTLinux çš„ç½‘ç»œæ ˆä¸­ï¼Œå¯é€šè¿‡ iptables/netfilter çš„ SNAT/MASQUERADE å®ç° NAPT ç½‘å…³ï¼Œè¿™ç§æ–¹å¼åªèƒ½å®ç°ä¸€ä¸ª Symmetric NAT. ä¹Ÿå°±æ˜¯è¯´ç»å¤§å¤šæ•°åŸºäº Linux å®ç°çš„å®¶åº­å±€åŸŸç½‘ã€Docker è™šæ‹Ÿç½‘ç»œã€Kubernetes è™šæ‹Ÿç½‘ç»œã€äº‘æœåŠ¡çš„è™šæ‹Ÿç½‘ç»œï¼Œéƒ½æ˜¯ Symmetric NAT. åªæœ‰ä¸€äº›æœ‰ Full-cone NAT éœ€æ±‚çš„ç½‘å§ã€ISP çš„ LSN(Large Scale NAT) ç½‘å…³ç­‰ç»„ç»‡ï¼Œä¼šä½¿ç”¨é Linux å†…æ ¸çš„ä¼ä¸šçº§è·¯ç”±å™¨æä¾› Full-cone NAT èƒ½åŠ›ï¼Œè¿™äº›è®¾å¤‡å¯èƒ½æ˜¯åŸºäº FPGA ç­‰ä¸“ç”¨èŠ¯ç‰‡è®¾è®¡çš„ã€‚ æƒ³è¦å°† Symmetric NAT å†…çš„ä¸»æœºæä¾›ç»™å¤–éƒ¨è®¿é—®ï¼Œåªèƒ½é€šè¿‡ç«¯å£æ˜ å°„ã€ä¸€å¯¹ä¸€ NAT ç­‰æ–¹å¼å®ç°ï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»è¿™äº›æ–¹æ³•ã€‚ RFC5389 å®šä¹‰çš„ NAT ç±»å‹ï¼ˆä¹ç§ï¼‰RFC3489 è¿™ä¸ªæ—©æœŸ RFC å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œé—®é¢˜ä¹‹ä¸€å°±æ˜¯å®ƒå¯¹ NAT å½’ç±»è¿‡äºç¬¼ç»Ÿï¼Œå¾ˆå¤š NAPT ç½‘å…³éƒ½æ— æ³•å¾ˆå¥½çš„åŒ¹é…ä¸Šå…¶ä¸­æŸä¸ªç±»åˆ«ã€‚ äºæ˜¯åæ¥ï¼ŒRFC3489 è¢«åºŸå¼ƒå¹¶ç”± RFC5389 æ¥æ›¿ä»£ï¼Œåœ¨ RFC5389 ä¸­ï¼Œå°† Mapping Behaviorï¼ˆæ˜ å°„è§„åˆ™ï¼‰å’Œ Filtering Behaviorï¼ˆè¿‡æ»¤è§„åˆ™ï¼‰åˆ†å¼€æ¥ï¼Œå®šä¹‰äº† 3 ç§ Mapping Behaviorï¼ˆæ˜ å°„è§„åˆ™ï¼‰å’Œ 3 ç§ Filtering Behaviorï¼ˆè¿‡æ»¤è§„åˆ™ï¼‰ï¼Œä¸€å…±æœ‰ 9 ç§ç»„åˆã€‚ 1. æ˜ å°„è§„åˆ™ä¸‰ç§æ˜ å°„è§„åˆ™å¦‚å›¾æ‰€ç¤ºï¼Œå‡è®¾ä¸€ä¸ªå†…ç½‘ä¸»æœº HostX çš„å†…ç½‘ IP åœ°å€ä¸º Xï¼Œç«¯å£å·ä¸º xï¼Œç» NAT æ˜ å°„åçš„å¤–ç½‘ IP åœ°å€ä¸º Mï¼Œç«¯å£å·ä¸º mã€‚ä¸ºæ–¹ä¾¿æè¿°ï¼Œå°†å†…ç½‘çš„ Endpoint è®°ä¸º Endpoint(X,x)ï¼Œæ˜ å°„åå¤–ç½‘çš„ Endpoint è®°ä¸º Endpoint(M,m)ã€‚å†…ç½‘ Endpoint(X,x) å‘å¾€å¤–ç½‘ HostD1 çš„ IP åœ°å€å’Œç«¯å£å·è®°ä¸ºç›®çš„ Endpoint(D1,d1)ï¼›å‘å¾€å¤–ç½‘ HostD2 çš„ IP åœ°å€å’Œç«¯å£å·è®°ä¸ºç›®çš„Endpoint(D2,d2)ã€‚ NAT æ˜ å°„è§„åˆ™ EIM(Endpoint-Independent Mapping) å¤–éƒ¨åœ°å€æ— å…³æ˜ å°„ å¯¹äºä¸€ä¸ªå†…ç½‘ Endpoint(X,x)ï¼Œå…¶æ˜ å°„çš„å¤–ç½‘ Endpoint(M,m) æ˜¯å›ºå®šçš„ã€‚å³ä»ç›¸åŒçš„Endpoint(X,x) å‘é€åˆ°ä»»ä½•å¤–éƒ¨ IP åœ°å€å’Œä»»ä½•å¤–éƒ¨ç«¯å£çš„æŠ¥æ–‡åœ¨ NAT è®¾å¤‡ä¸Šä½¿ç”¨ç›¸åŒçš„æ˜ å°„ã€‚ ADM(Address-Dependent Mapping) å¤–éƒ¨åœ°å€ç›¸å…³æ˜ å°„ï¼šå¯¹äºä¸€ä¸ªå†…ç½‘ Endpoint(X,x)ï¼Œå‘å¾€ç›®çš„ Endpoint(D1,d1) çš„æŠ¥æ–‡ï¼ŒEndpoint(X,x) è¢«æ˜ å°„æˆ Endpoint(M1,m1)ï¼›å‘å¾€ç›®çš„Endpoint(D2,d2) çš„æŠ¥æ–‡ï¼ŒEndpoint(X,x) è¢«æ˜ å°„æˆ Endpoint(M2,m2)ã€‚åªè¦D1=D2ï¼Œä¸ç®¡d1 å’Œd2æ˜¯å¤šå°‘ï¼Œéƒ½æœ‰ Endpoint(M1,m1)=Endpoint(M2,m2)ã€‚å³ä»ç›¸åŒçš„ Endpoint(X,x) å‘é€åˆ°ç›¸åŒå¤–éƒ¨ IP åœ°å€å’Œä»»ä½•å¤–éƒ¨ç«¯å£çš„æŠ¥æ–‡åœ¨ NAT è®¾å¤‡ä¸Šä½¿ç”¨ç›¸åŒçš„æ˜ å°„ã€‚ APDMï¼ˆAddress and Port-Dependent Mappingï¼‰å¤–éƒ¨åœ°å€å’Œç«¯å£ç›¸å…³æ˜ å°„ï¼šå¯¹äºä¸€ä¸ªå†…ç½‘Endpoint(X,x)ï¼Œå‘å¾€ç›®çš„ Endpoint(D1,d1) çš„æŠ¥æ–‡ï¼ŒEndpoint(X,x) è¢«æ˜ å°„æˆEndpoint(M1,m1)ï¼›å‘å¾€ç›®çš„ Endpoint(D2,d2) çš„æŠ¥æ–‡ï¼Œ Endpoint(X,x) è¢«æ˜ å°„æˆEndpoint(M2,m2)ã€‚åªæœ‰å½“D1=D2ï¼Œä¸”d1=d2ï¼Œæ‰æœ‰ Endpoint(M1,m1)=Endpoint(M2,m2)ã€‚å³ä»ç›¸åŒçš„ Endpoint(X,x) å‘é€åˆ°ç›¸åŒå¤–éƒ¨IPåœ°å€å’Œç›¸åŒå¤–éƒ¨ç«¯å£çš„æŠ¥æ–‡åœ¨NATè®¾å¤‡ä¸Šä½¿ç”¨ç›¸åŒçš„æ˜ å°„ã€‚ 2. è¿‡æ»¤è§„åˆ™ NAT è¿‡æ»¤è§„åˆ™ EIFï¼ˆEndpoint-Independent Filteringï¼‰å¤–éƒ¨åœ°å€æ— å…³è¿‡æ»¤ï¼šå¯¹äºä¸€ä¸ªå†…ç½‘Endpoint(X,x)ï¼Œåªè¦å®ƒæ›¾ç»å‘å¤–ç½‘å‘é€è¿‡æ•°æ®ï¼Œå¤–ç½‘ä¸»æœºå°±å¯ä»¥è·å–åˆ°å®ƒç» NAT æ˜ å°„åçš„å¤–ç½‘Endpoint(M,m) ã€‚é‚£ä¹ˆåªè¦æ˜¯å‘ç»™ Endpoint(M,m) çš„æŠ¥æ–‡ï¼Œä¸ç®¡æ¥æºäº D1 è¿˜æ˜¯ D2ï¼Œéƒ½èƒ½è¢«è½¬æ¢å¹¶å‘å¾€å†…ç½‘ï¼Œå…¶ä»–æŠ¥æ–‡è¢«è¿‡æ»¤æ‰ã€‚ ADFï¼ˆAddr","date":"2022-05-13","objectID":"/posts/about-nat/:3:2","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["NAT","ç½‘ç»œ","NAT ç©¿è¶Š","å†…ç½‘ç©¿é€","è™šæ‹Ÿç½‘ç»œ","P2P","WebRTC"],"title":"NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ","uri":"/posts/about-nat/#1-full-cone-nat"},{"categories":["tech"],"content":" 2. ä¸€å¯¹å¤š NAT - NAPTä¸€å¯¹å¤š NATï¼Œä¹Ÿè¢«ç§°ä¸º NAPTï¼ˆnetwork address and port translationï¼‰ï¼ŒåŒæ ·åœ¨RFC2663 ä¸­è¢«å®šä¹‰ã€‚Easy IP æ˜¯ NAPT çš„ä¸€ä¸ªç‰¹æ®Šå½¢å¼ã€‚ NAPT çš„ä¸»è¦åº”ç”¨åœºæ™¯æ˜¯ï¼Œå†…ç½‘ç”¨æˆ·éœ€è¦è®¿é—®åˆ°å…¬ç½‘ä¸»æœºã€‚ç»å¤§å¤šæ•°çš„å®¶åº­ç½‘ç»œã€åŠå…¬ç½‘ç»œéƒ½æ˜¯ NAPT ç±»å‹çš„ã€‚åŸå› åº”è¯¥å¾ˆå¥½ç†è§£â€”â€”å®¶åº­ç½‘ç»œæˆ–åŠå…¬ç½‘ç»œéƒ½åŒ…å«è®¸å¤šè”ç½‘è®¾å¤‡ï¼Œä½†æ˜¯è¿™ç±»ç½‘ç»œé€šå¸¸åªæœ‰ä¸€ä¸ªæˆ–æ•°ä¸ªå…¬ç½‘ IPï¼Œä½¿ç”¨ä¸€å¯¹ä¸€ NAT çš„è¯å…¬ç½‘ IP æ˜¾ç„¶æ˜¯ä¸å¤Ÿç”¨çš„ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ä¸€å¯¹å¤š NAT. NAPT é€šè¿‡åŒæ—¶åˆ©ç”¨ L3 çš„ IP ä¿¡æ¯ï¼Œä»¥åŠ L4 ä¼ è¾“å±‚çš„ç«¯å£ä¿¡æ¯ï¼Œæ¥ä¸ºå±€åŸŸç½‘è®¾å¤‡æä¾›é€æ˜çš„ã€é…ç½®æ–¹ä¾¿çš„ã€æ”¯æŒè¶…é«˜å¹¶å‘è¿æ¥çš„å¤–éƒ¨ç½‘ç»œé€šä¿¡ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š NAPT çš„ç«¯å£åˆ†é…ä¸è½¬æ¢è§„åˆ™ï¼ˆMapping Behaviorï¼‰ä»¥åŠå¯¹å¤–æ¥æµé‡çš„è¿‡æ»¤è§„åˆ™ï¼ˆFiltering Behaviorï¼‰éƒ½å­˜åœ¨è®¸å¤šä¸åŒçš„å®ç°ï¼Œæ²¡æœ‰ç»Ÿä¸€çš„è§„èŒƒä¸æ ‡å‡†ï¼Œä½†æ˜¯å­˜åœ¨ä¸¤ç§åˆ†ç±»è§„èŒƒï¼Œè¿™ç§åˆ†ç±»æ–¹æ³•ä¸»è¦ç”¨åœ¨ NAT ç©¿è¶ŠæŠ€æœ¯ä¸­ã€‚ RFC3489 å®šä¹‰çš„ NAT ç±»å‹ï¼ˆå››ç§ï¼‰åœ¨ RFC3489 ä¸­å°† NAPT åˆ†ä¸ºå››ç§ç±»å‹ï¼Œè¿™ä¹Ÿæ˜¯åº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ NAT åˆ†ç±»æ–¹æ³•ï¼Œå¦‚ä¸‹å›¾ï¼š ä¸‹é¢æˆ‘ä»¬é€ä¸€ä»‹ç»è¿™å››ç§ä¸åŒçš„ NAPT ç±»å‹ã€‚ ä»è¿™é‡Œå¼€å§‹ï¼Œä¸‹æ–‡ä¸­çš„ NAT ç‰¹æŒ‡ NAPTï¼Œå¦‚æœæ¶‰åŠã€Œä¸€å¯¹ä¸€ NATã€ä¼šä½¿ç”¨å®ƒçš„å…¨åã€‚ 1. Full-cone NATFull-cone NAT çš„ç‰¹ç‚¹å¦‚ä¸‹ï¼š æ•°æ®åŒ…æµå‡ºï¼šä¸€æ—¦å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰æ˜ å°„åˆ°å¤–éƒ¨åœ°å€ï¼ˆeAddr:ePortï¼‰ï¼Œæ‰€æœ‰å‘è‡ª iAddr:iPort çš„æ•°æ®åŒ…éƒ½ç»ç”± eAddr:ePort å‘å¤–å‘é€ã€‚ æ•°æ®åŒ…æµå…¥ï¼šä»»æ„ä¸»æœºå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œéƒ½èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. ä¹Ÿå°±æ˜¯ä¸å¯¹å¤–éƒ¨è¿›æ¥çš„æ•°æ®åšä»»ä½•é™åˆ¶ï¼Œå…¨éƒ¨æ”¾è¡Œã€‚ cone åœ†é”¥ï¼Œä¸ªäººç†è§£æ˜¯ä¸€ä¸ªæ¯”å–»ï¼Œä»»æ„å‘é€è¿›æ¥çš„æ•°æ®ï¼ˆå¤šï¼‰ï¼Œéƒ½èƒ½é€šè¿‡ NAT åˆ°è¾¾è¿™ä¸ªå†…éƒ¨åœ°å€ ï¼ˆä¸€ï¼‰ï¼Œå°±åƒä¸€ä¸ªåœ†é”¥ã€‚ å…è®¸ä»»æ„ä¸»æœºå‘é€åˆ° eAddr:ePort çš„æ•°æ®åˆ°è¾¾å†…éƒ¨åœ°å€æ˜¯å¾ˆå±é™©çš„è¡Œä¸ºï¼Œå› ä¸ºå†…éƒ¨ä¸»æœºä¸ä¸€å®šé…ç½®äº†åˆé€‚çš„å®‰å…¨ç­–ç•¥ã€‚å› æ­¤ Full-cone NAT æ¯”è¾ƒå°‘è§ï¼Œå°±ç®—è·¯ç”±å™¨ç­‰ NAT è®¾å¤‡æ”¯æŒ Full-cone NATï¼Œ é€šå¸¸ä¹Ÿä¸ä¼šæ˜¯é»˜è®¤é€‰é¡¹ã€‚æˆ‘ä»¬ä¼šåœ¨åé¢æ›´è¯¦ç»†åœ°ä»‹ç»å®ƒã€‚ 2. (Address-)Restricted cone NAT æ•°æ®åŒ…æµå‡ºï¼šï¼ˆè·Ÿ Full-cone NAT å®Œå…¨ä¸€è‡´ï¼‰ä¸€æ—¦å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰æ˜ å°„åˆ°å¤–éƒ¨åœ°å€ ï¼ˆeAddr:ePortï¼‰ï¼Œæ‰€æœ‰å‘è‡ª iAddr:iPort çš„æ•°æ®åŒ…éƒ½ç»ç”± eAddr:ePort å‘å¤–å‘é€ã€‚ æ•°æ®åŒ…æµå…¥ï¼šåªæœ‰å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸»åŠ¨è¿æ¥è¿‡çš„å¤–éƒ¨ä¸»æœºï¼ˆnAddr:anyï¼‰ï¼Œå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œæ‰èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. è·Ÿ Full-cone NAT çš„åŒºåˆ«åœ¨äºï¼Œå®ƒé™åˆ¶äº†å¤–éƒ¨ä¸»æœºçš„ IP åœ°å€ã€‚åªæœ‰ä¸»åŠ¨è¿æ¥è¿‡çš„ä¸»æœºï¼Œæ‰èƒ½å‘é€æ•°æ®åˆ° NAT å†…éƒ¨ã€‚è¿™æå‡äº†ä¸€äº›å®‰å…¨æ€§ã€‚ 3. Port-Restricted cone NAT æ•°æ®åŒ…æµå‡ºï¼šï¼ˆè·Ÿ Full-cone NAT å®Œå…¨ä¸€è‡´ï¼‰ä¸€æ—¦å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰æ˜ å°„åˆ°å¤–éƒ¨åœ°å€ ï¼ˆeAddr:ePortï¼‰ï¼Œæ‰€æœ‰å‘è‡ª iAddr:iPort çš„æ•°æ®åŒ…éƒ½ç»ç”± eAddr:ePort å‘å¤–å‘é€ã€‚ æ•°æ®åŒ…æµå…¥ï¼šåªæœ‰å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸»åŠ¨è¿æ¥è¿‡çš„å¤–éƒ¨ç¨‹åºï¼ˆnAddr:nPortï¼‰ï¼Œå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œæ‰èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. ä¸ Address-Restricted cone NAT çš„åŒºåˆ«åœ¨äºï¼Œå®ƒåŒæ—¶é™åˆ¶äº†å¤–éƒ¨ä¸»æœºçš„ IP ä¸ç«¯å£ï¼Œå¯ä»¥è¯´æ˜¯æ›´è¿›ä¸€æ­¥åœ°æå‡äº†å®‰å…¨æ€§ã€‚ 4. Symmetric NAT æ•°æ®åŒ…æµå‡ºï¼šåŒä¸€ä¸ªå†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸ä¸åŒå¤–éƒ¨ä¸»æœºï¼ˆnAddr:nPortï¼‰çš„é€šä¿¡ï¼Œä¼šéšæœºä½¿ç”¨ä¸åŒçš„ NAT å¤–éƒ¨ç«¯å£ï¼ˆeAddr:randomPortï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´å†…éƒ¨åœ°å€ä¸ NAT å¤–éƒ¨åœ°å€çš„å…³ç³»ä¹Ÿæ˜¯ä¸€å¯¹å¤šï¼ ä¸ºæ¯ä¸ªè¿æ¥éƒ½éšæœºé€‰æ‹©ä¸€ä¸ªä¸åŒçš„ NAT ç«¯å£ï¼Œè¿™å®é™…æ˜¯è¿›ä¸€æ­¥å¼ºåŒ–äº† NAT å†…ç½‘çš„å®‰å…¨æ€§ã€‚ä½†è¿™ä¹Ÿæ˜¯ NAT ç©¿è¶Šæœ€å¤§çš„éš¾ç‚¹â€”â€”å®ƒå¯¼è‡´ Symmetric NAT çš„ç«¯å£éš¾ä»¥é¢„æµ‹ï¼ æ•°æ®åŒ…æµå…¥ï¼šåªæœ‰å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸»åŠ¨è¿æ¥è¿‡çš„å¤–éƒ¨ç¨‹åºï¼ˆnAddr:nPortï¼‰ï¼Œå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œæ‰èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. è¿™ä¸ªæ•°æ®æµå…¥è§„åˆ™ï¼Œä¸ Port-Restricted cone NAT æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚ å¯¹ç§° NAT æ˜¯æœ€å®‰å…¨çš„ä¸€ç§ NAT ç»“æ„ï¼Œé™åˆ¶æœ€ä¸ºä¸¥æ ¼ï¼Œåº”è¯¥ä¹Ÿæ˜¯åº”ç”¨æœ€å¹¿æ³›çš„ NAT ç»“æ„ã€‚ä½†æ˜¯å®ƒå¯¼è‡´æ‰€æœ‰çš„ TCP è¿æ¥éƒ½åªèƒ½ç”±ä»å†…éƒ¨ä¸»åŠ¨å‘èµ·ï¼Œå¤–éƒ¨å‘èµ·çš„ TCP è¿æ¥è¯·æ±‚ä¼šç›´æ¥è¢« NAT æ‹’ç»ï¼Œå› æ­¤å®ƒä¹Ÿæ˜¯ P2P ç©å®¶æœ€å¤´ç–¼çš„ä¸€ç§ NAT ç±»å‹ã€‚è§£å†³æ–¹æ¡ˆæ˜¯é€šè¿‡ UDP è¿‚å›å®ç°è¿æ¥çš„å»ºç«‹ï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚ 5. Linux ä¸­çš„ NAPTLinux çš„ç½‘ç»œæ ˆä¸­ï¼Œå¯é€šè¿‡ iptables/netfilter çš„ SNAT/MASQUERADE å®ç° NAPT ç½‘å…³ï¼Œè¿™ç§æ–¹å¼åªèƒ½å®ç°ä¸€ä¸ª Symmetric NAT. ä¹Ÿå°±æ˜¯è¯´ç»å¤§å¤šæ•°åŸºäº Linux å®ç°çš„å®¶åº­å±€åŸŸç½‘ã€Docker è™šæ‹Ÿç½‘ç»œã€Kubernetes è™šæ‹Ÿç½‘ç»œã€äº‘æœåŠ¡çš„è™šæ‹Ÿç½‘ç»œï¼Œéƒ½æ˜¯ Symmetric NAT. åªæœ‰ä¸€äº›æœ‰ Full-cone NAT éœ€æ±‚çš„ç½‘å§ã€ISP çš„ LSN(Large Scale NAT) ç½‘å…³ç­‰ç»„ç»‡ï¼Œä¼šä½¿ç”¨é Linux å†…æ ¸çš„ä¼ä¸šçº§è·¯ç”±å™¨æä¾› Full-cone NAT èƒ½åŠ›ï¼Œè¿™äº›è®¾å¤‡å¯èƒ½æ˜¯åŸºäº FPGA ç­‰ä¸“ç”¨èŠ¯ç‰‡è®¾è®¡çš„ã€‚ æƒ³è¦å°† Symmetric NAT å†…çš„ä¸»æœºæä¾›ç»™å¤–éƒ¨è®¿é—®ï¼Œåªèƒ½é€šè¿‡ç«¯å£æ˜ å°„ã€ä¸€å¯¹ä¸€ NAT ç­‰æ–¹å¼å®ç°ï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»è¿™äº›æ–¹æ³•ã€‚ RFC5389 å®šä¹‰çš„ NAT ç±»å‹ï¼ˆä¹ç§ï¼‰RFC3489 è¿™ä¸ªæ—©æœŸ RFC å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œé—®é¢˜ä¹‹ä¸€å°±æ˜¯å®ƒå¯¹ NAT å½’ç±»è¿‡äºç¬¼ç»Ÿï¼Œå¾ˆå¤š NAPT ç½‘å…³éƒ½æ— æ³•å¾ˆå¥½çš„åŒ¹é…ä¸Šå…¶ä¸­æŸä¸ªç±»åˆ«ã€‚ äºæ˜¯åæ¥ï¼ŒRFC3489 è¢«åºŸå¼ƒå¹¶ç”± RFC5389 æ¥æ›¿ä»£ï¼Œåœ¨ RFC5389 ä¸­ï¼Œå°† Mapping Behaviorï¼ˆæ˜ å°„è§„åˆ™ï¼‰å’Œ Filtering Behaviorï¼ˆè¿‡æ»¤è§„åˆ™ï¼‰åˆ†å¼€æ¥ï¼Œå®šä¹‰äº† 3 ç§ Mapping Behaviorï¼ˆæ˜ å°„è§„åˆ™ï¼‰å’Œ 3 ç§ Filtering Behaviorï¼ˆè¿‡æ»¤è§„åˆ™ï¼‰ï¼Œä¸€å…±æœ‰ 9 ç§ç»„åˆã€‚ 1. æ˜ å°„è§„åˆ™ä¸‰ç§æ˜ å°„è§„åˆ™å¦‚å›¾æ‰€ç¤ºï¼Œå‡è®¾ä¸€ä¸ªå†…ç½‘ä¸»æœº HostX çš„å†…ç½‘ IP åœ°å€ä¸º Xï¼Œç«¯å£å·ä¸º xï¼Œç» NAT æ˜ å°„åçš„å¤–ç½‘ IP åœ°å€ä¸º Mï¼Œç«¯å£å·ä¸º mã€‚ä¸ºæ–¹ä¾¿æè¿°ï¼Œå°†å†…ç½‘çš„ Endpoint è®°ä¸º Endpoint(X,x)ï¼Œæ˜ å°„åå¤–ç½‘çš„ Endpoint è®°ä¸º Endpoint(M,m)ã€‚å†…ç½‘ Endpoint(X,x) å‘å¾€å¤–ç½‘ HostD1 çš„ IP åœ°å€å’Œç«¯å£å·è®°ä¸ºç›®çš„ Endpoint(D1,d1)ï¼›å‘å¾€å¤–ç½‘ HostD2 çš„ IP åœ°å€å’Œç«¯å£å·è®°ä¸ºç›®çš„Endpoint(D2,d2)ã€‚ NAT æ˜ å°„è§„åˆ™ EIM(Endpoint-Independent Mapping) å¤–éƒ¨åœ°å€æ— å…³æ˜ å°„ å¯¹äºä¸€ä¸ªå†…ç½‘ Endpoint(X,x)ï¼Œå…¶æ˜ å°„çš„å¤–ç½‘ Endpoint(M,m) æ˜¯å›ºå®šçš„ã€‚å³ä»ç›¸åŒçš„Endpoint(X,x) å‘é€åˆ°ä»»ä½•å¤–éƒ¨ IP åœ°å€å’Œä»»ä½•å¤–éƒ¨ç«¯å£çš„æŠ¥æ–‡åœ¨ NAT è®¾å¤‡ä¸Šä½¿ç”¨ç›¸åŒçš„æ˜ å°„ã€‚ ADM(Address-Dependent Mapping) å¤–éƒ¨åœ°å€ç›¸å…³æ˜ å°„ï¼šå¯¹äºä¸€ä¸ªå†…ç½‘ Endpoint(X,x)ï¼Œå‘å¾€ç›®çš„ Endpoint(D1,d1) çš„æŠ¥æ–‡ï¼ŒEndpoint(X,x) è¢«æ˜ å°„æˆ Endpoint(M1,m1)ï¼›å‘å¾€ç›®çš„Endpoint(D2,d2) çš„æŠ¥æ–‡ï¼ŒEndpoint(X,x) è¢«æ˜ å°„æˆ Endpoint(M2,m2)ã€‚åªè¦D1=D2ï¼Œä¸ç®¡d1 å’Œd2æ˜¯å¤šå°‘ï¼Œéƒ½æœ‰ Endpoint(M1,m1)=Endpoint(M2,m2)ã€‚å³ä»ç›¸åŒçš„ Endpoint(X,x) å‘é€åˆ°ç›¸åŒå¤–éƒ¨ IP åœ°å€å’Œä»»ä½•å¤–éƒ¨ç«¯å£çš„æŠ¥æ–‡åœ¨ NAT è®¾å¤‡ä¸Šä½¿ç”¨ç›¸åŒçš„æ˜ å°„ã€‚ APDMï¼ˆAddress and Port-Dependent Mappingï¼‰å¤–éƒ¨åœ°å€å’Œç«¯å£ç›¸å…³æ˜ å°„ï¼šå¯¹äºä¸€ä¸ªå†…ç½‘Endpoint(X,x)ï¼Œå‘å¾€ç›®çš„ Endpoint(D1,d1) çš„æŠ¥æ–‡ï¼ŒEndpoint(X,x) è¢«æ˜ å°„æˆEndpoint(M1,m1)ï¼›å‘å¾€ç›®çš„ Endpoint(D2,d2) çš„æŠ¥æ–‡ï¼Œ Endpoint(X,x) è¢«æ˜ å°„æˆEndpoint(M2,m2)ã€‚åªæœ‰å½“D1=D2ï¼Œä¸”d1=d2ï¼Œæ‰æœ‰ Endpoint(M1,m1)=Endpoint(M2,m2)ã€‚å³ä»ç›¸åŒçš„ Endpoint(X,x) å‘é€åˆ°ç›¸åŒå¤–éƒ¨IPåœ°å€å’Œç›¸åŒå¤–éƒ¨ç«¯å£çš„æŠ¥æ–‡åœ¨NATè®¾å¤‡ä¸Šä½¿ç”¨ç›¸åŒçš„æ˜ å°„ã€‚ 2. è¿‡æ»¤è§„åˆ™ NAT è¿‡æ»¤è§„åˆ™ EIFï¼ˆEndpoint-Independent Filteringï¼‰å¤–éƒ¨åœ°å€æ— å…³è¿‡æ»¤ï¼šå¯¹äºä¸€ä¸ªå†…ç½‘Endpoint(X,x)ï¼Œåªè¦å®ƒæ›¾ç»å‘å¤–ç½‘å‘é€è¿‡æ•°æ®ï¼Œå¤–ç½‘ä¸»æœºå°±å¯ä»¥è·å–åˆ°å®ƒç» NAT æ˜ å°„åçš„å¤–ç½‘Endpoint(M,m) ã€‚é‚£ä¹ˆåªè¦æ˜¯å‘ç»™ Endpoint(M,m) çš„æŠ¥æ–‡ï¼Œä¸ç®¡æ¥æºäº D1 è¿˜æ˜¯ D2ï¼Œéƒ½èƒ½è¢«è½¬æ¢å¹¶å‘å¾€å†…ç½‘ï¼Œå…¶ä»–æŠ¥æ–‡è¢«è¿‡æ»¤æ‰ã€‚ ADFï¼ˆAddr","date":"2022-05-13","objectID":"/posts/about-nat/:3:2","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["NAT","ç½‘ç»œ","NAT ç©¿è¶Š","å†…ç½‘ç©¿é€","è™šæ‹Ÿç½‘ç»œ","P2P","WebRTC"],"title":"NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ","uri":"/posts/about-nat/#2-address-restricted-cone-nat"},{"categories":["tech"],"content":" 2. ä¸€å¯¹å¤š NAT - NAPTä¸€å¯¹å¤š NATï¼Œä¹Ÿè¢«ç§°ä¸º NAPTï¼ˆnetwork address and port translationï¼‰ï¼ŒåŒæ ·åœ¨RFC2663 ä¸­è¢«å®šä¹‰ã€‚Easy IP æ˜¯ NAPT çš„ä¸€ä¸ªç‰¹æ®Šå½¢å¼ã€‚ NAPT çš„ä¸»è¦åº”ç”¨åœºæ™¯æ˜¯ï¼Œå†…ç½‘ç”¨æˆ·éœ€è¦è®¿é—®åˆ°å…¬ç½‘ä¸»æœºã€‚ç»å¤§å¤šæ•°çš„å®¶åº­ç½‘ç»œã€åŠå…¬ç½‘ç»œéƒ½æ˜¯ NAPT ç±»å‹çš„ã€‚åŸå› åº”è¯¥å¾ˆå¥½ç†è§£â€”â€”å®¶åº­ç½‘ç»œæˆ–åŠå…¬ç½‘ç»œéƒ½åŒ…å«è®¸å¤šè”ç½‘è®¾å¤‡ï¼Œä½†æ˜¯è¿™ç±»ç½‘ç»œé€šå¸¸åªæœ‰ä¸€ä¸ªæˆ–æ•°ä¸ªå…¬ç½‘ IPï¼Œä½¿ç”¨ä¸€å¯¹ä¸€ NAT çš„è¯å…¬ç½‘ IP æ˜¾ç„¶æ˜¯ä¸å¤Ÿç”¨çš„ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ä¸€å¯¹å¤š NAT. NAPT é€šè¿‡åŒæ—¶åˆ©ç”¨ L3 çš„ IP ä¿¡æ¯ï¼Œä»¥åŠ L4 ä¼ è¾“å±‚çš„ç«¯å£ä¿¡æ¯ï¼Œæ¥ä¸ºå±€åŸŸç½‘è®¾å¤‡æä¾›é€æ˜çš„ã€é…ç½®æ–¹ä¾¿çš„ã€æ”¯æŒè¶…é«˜å¹¶å‘è¿æ¥çš„å¤–éƒ¨ç½‘ç»œé€šä¿¡ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š NAPT çš„ç«¯å£åˆ†é…ä¸è½¬æ¢è§„åˆ™ï¼ˆMapping Behaviorï¼‰ä»¥åŠå¯¹å¤–æ¥æµé‡çš„è¿‡æ»¤è§„åˆ™ï¼ˆFiltering Behaviorï¼‰éƒ½å­˜åœ¨è®¸å¤šä¸åŒçš„å®ç°ï¼Œæ²¡æœ‰ç»Ÿä¸€çš„è§„èŒƒä¸æ ‡å‡†ï¼Œä½†æ˜¯å­˜åœ¨ä¸¤ç§åˆ†ç±»è§„èŒƒï¼Œè¿™ç§åˆ†ç±»æ–¹æ³•ä¸»è¦ç”¨åœ¨ NAT ç©¿è¶ŠæŠ€æœ¯ä¸­ã€‚ RFC3489 å®šä¹‰çš„ NAT ç±»å‹ï¼ˆå››ç§ï¼‰åœ¨ RFC3489 ä¸­å°† NAPT åˆ†ä¸ºå››ç§ç±»å‹ï¼Œè¿™ä¹Ÿæ˜¯åº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ NAT åˆ†ç±»æ–¹æ³•ï¼Œå¦‚ä¸‹å›¾ï¼š ä¸‹é¢æˆ‘ä»¬é€ä¸€ä»‹ç»è¿™å››ç§ä¸åŒçš„ NAPT ç±»å‹ã€‚ ä»è¿™é‡Œå¼€å§‹ï¼Œä¸‹æ–‡ä¸­çš„ NAT ç‰¹æŒ‡ NAPTï¼Œå¦‚æœæ¶‰åŠã€Œä¸€å¯¹ä¸€ NATã€ä¼šä½¿ç”¨å®ƒçš„å…¨åã€‚ 1. Full-cone NATFull-cone NAT çš„ç‰¹ç‚¹å¦‚ä¸‹ï¼š æ•°æ®åŒ…æµå‡ºï¼šä¸€æ—¦å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰æ˜ å°„åˆ°å¤–éƒ¨åœ°å€ï¼ˆeAddr:ePortï¼‰ï¼Œæ‰€æœ‰å‘è‡ª iAddr:iPort çš„æ•°æ®åŒ…éƒ½ç»ç”± eAddr:ePort å‘å¤–å‘é€ã€‚ æ•°æ®åŒ…æµå…¥ï¼šä»»æ„ä¸»æœºå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œéƒ½èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. ä¹Ÿå°±æ˜¯ä¸å¯¹å¤–éƒ¨è¿›æ¥çš„æ•°æ®åšä»»ä½•é™åˆ¶ï¼Œå…¨éƒ¨æ”¾è¡Œã€‚ cone åœ†é”¥ï¼Œä¸ªäººç†è§£æ˜¯ä¸€ä¸ªæ¯”å–»ï¼Œä»»æ„å‘é€è¿›æ¥çš„æ•°æ®ï¼ˆå¤šï¼‰ï¼Œéƒ½èƒ½é€šè¿‡ NAT åˆ°è¾¾è¿™ä¸ªå†…éƒ¨åœ°å€ ï¼ˆä¸€ï¼‰ï¼Œå°±åƒä¸€ä¸ªåœ†é”¥ã€‚ å…è®¸ä»»æ„ä¸»æœºå‘é€åˆ° eAddr:ePort çš„æ•°æ®åˆ°è¾¾å†…éƒ¨åœ°å€æ˜¯å¾ˆå±é™©çš„è¡Œä¸ºï¼Œå› ä¸ºå†…éƒ¨ä¸»æœºä¸ä¸€å®šé…ç½®äº†åˆé€‚çš„å®‰å…¨ç­–ç•¥ã€‚å› æ­¤ Full-cone NAT æ¯”è¾ƒå°‘è§ï¼Œå°±ç®—è·¯ç”±å™¨ç­‰ NAT è®¾å¤‡æ”¯æŒ Full-cone NATï¼Œ é€šå¸¸ä¹Ÿä¸ä¼šæ˜¯é»˜è®¤é€‰é¡¹ã€‚æˆ‘ä»¬ä¼šåœ¨åé¢æ›´è¯¦ç»†åœ°ä»‹ç»å®ƒã€‚ 2. (Address-)Restricted cone NAT æ•°æ®åŒ…æµå‡ºï¼šï¼ˆè·Ÿ Full-cone NAT å®Œå…¨ä¸€è‡´ï¼‰ä¸€æ—¦å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰æ˜ å°„åˆ°å¤–éƒ¨åœ°å€ ï¼ˆeAddr:ePortï¼‰ï¼Œæ‰€æœ‰å‘è‡ª iAddr:iPort çš„æ•°æ®åŒ…éƒ½ç»ç”± eAddr:ePort å‘å¤–å‘é€ã€‚ æ•°æ®åŒ…æµå…¥ï¼šåªæœ‰å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸»åŠ¨è¿æ¥è¿‡çš„å¤–éƒ¨ä¸»æœºï¼ˆnAddr:anyï¼‰ï¼Œå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œæ‰èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. è·Ÿ Full-cone NAT çš„åŒºåˆ«åœ¨äºï¼Œå®ƒé™åˆ¶äº†å¤–éƒ¨ä¸»æœºçš„ IP åœ°å€ã€‚åªæœ‰ä¸»åŠ¨è¿æ¥è¿‡çš„ä¸»æœºï¼Œæ‰èƒ½å‘é€æ•°æ®åˆ° NAT å†…éƒ¨ã€‚è¿™æå‡äº†ä¸€äº›å®‰å…¨æ€§ã€‚ 3. Port-Restricted cone NAT æ•°æ®åŒ…æµå‡ºï¼šï¼ˆè·Ÿ Full-cone NAT å®Œå…¨ä¸€è‡´ï¼‰ä¸€æ—¦å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰æ˜ å°„åˆ°å¤–éƒ¨åœ°å€ ï¼ˆeAddr:ePortï¼‰ï¼Œæ‰€æœ‰å‘è‡ª iAddr:iPort çš„æ•°æ®åŒ…éƒ½ç»ç”± eAddr:ePort å‘å¤–å‘é€ã€‚ æ•°æ®åŒ…æµå…¥ï¼šåªæœ‰å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸»åŠ¨è¿æ¥è¿‡çš„å¤–éƒ¨ç¨‹åºï¼ˆnAddr:nPortï¼‰ï¼Œå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œæ‰èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. ä¸ Address-Restricted cone NAT çš„åŒºåˆ«åœ¨äºï¼Œå®ƒåŒæ—¶é™åˆ¶äº†å¤–éƒ¨ä¸»æœºçš„ IP ä¸ç«¯å£ï¼Œå¯ä»¥è¯´æ˜¯æ›´è¿›ä¸€æ­¥åœ°æå‡äº†å®‰å…¨æ€§ã€‚ 4. Symmetric NAT æ•°æ®åŒ…æµå‡ºï¼šåŒä¸€ä¸ªå†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸ä¸åŒå¤–éƒ¨ä¸»æœºï¼ˆnAddr:nPortï¼‰çš„é€šä¿¡ï¼Œä¼šéšæœºä½¿ç”¨ä¸åŒçš„ NAT å¤–éƒ¨ç«¯å£ï¼ˆeAddr:randomPortï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´å†…éƒ¨åœ°å€ä¸ NAT å¤–éƒ¨åœ°å€çš„å…³ç³»ä¹Ÿæ˜¯ä¸€å¯¹å¤šï¼ ä¸ºæ¯ä¸ªè¿æ¥éƒ½éšæœºé€‰æ‹©ä¸€ä¸ªä¸åŒçš„ NAT ç«¯å£ï¼Œè¿™å®é™…æ˜¯è¿›ä¸€æ­¥å¼ºåŒ–äº† NAT å†…ç½‘çš„å®‰å…¨æ€§ã€‚ä½†è¿™ä¹Ÿæ˜¯ NAT ç©¿è¶Šæœ€å¤§çš„éš¾ç‚¹â€”â€”å®ƒå¯¼è‡´ Symmetric NAT çš„ç«¯å£éš¾ä»¥é¢„æµ‹ï¼ æ•°æ®åŒ…æµå…¥ï¼šåªæœ‰å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸»åŠ¨è¿æ¥è¿‡çš„å¤–éƒ¨ç¨‹åºï¼ˆnAddr:nPortï¼‰ï¼Œå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œæ‰èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. è¿™ä¸ªæ•°æ®æµå…¥è§„åˆ™ï¼Œä¸ Port-Restricted cone NAT æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚ å¯¹ç§° NAT æ˜¯æœ€å®‰å…¨çš„ä¸€ç§ NAT ç»“æ„ï¼Œé™åˆ¶æœ€ä¸ºä¸¥æ ¼ï¼Œåº”è¯¥ä¹Ÿæ˜¯åº”ç”¨æœ€å¹¿æ³›çš„ NAT ç»“æ„ã€‚ä½†æ˜¯å®ƒå¯¼è‡´æ‰€æœ‰çš„ TCP è¿æ¥éƒ½åªèƒ½ç”±ä»å†…éƒ¨ä¸»åŠ¨å‘èµ·ï¼Œå¤–éƒ¨å‘èµ·çš„ TCP è¿æ¥è¯·æ±‚ä¼šç›´æ¥è¢« NAT æ‹’ç»ï¼Œå› æ­¤å®ƒä¹Ÿæ˜¯ P2P ç©å®¶æœ€å¤´ç–¼çš„ä¸€ç§ NAT ç±»å‹ã€‚è§£å†³æ–¹æ¡ˆæ˜¯é€šè¿‡ UDP è¿‚å›å®ç°è¿æ¥çš„å»ºç«‹ï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚ 5. Linux ä¸­çš„ NAPTLinux çš„ç½‘ç»œæ ˆä¸­ï¼Œå¯é€šè¿‡ iptables/netfilter çš„ SNAT/MASQUERADE å®ç° NAPT ç½‘å…³ï¼Œè¿™ç§æ–¹å¼åªèƒ½å®ç°ä¸€ä¸ª Symmetric NAT. ä¹Ÿå°±æ˜¯è¯´ç»å¤§å¤šæ•°åŸºäº Linux å®ç°çš„å®¶åº­å±€åŸŸç½‘ã€Docker è™šæ‹Ÿç½‘ç»œã€Kubernetes è™šæ‹Ÿç½‘ç»œã€äº‘æœåŠ¡çš„è™šæ‹Ÿç½‘ç»œï¼Œéƒ½æ˜¯ Symmetric NAT. åªæœ‰ä¸€äº›æœ‰ Full-cone NAT éœ€æ±‚çš„ç½‘å§ã€ISP çš„ LSN(Large Scale NAT) ç½‘å…³ç­‰ç»„ç»‡ï¼Œä¼šä½¿ç”¨é Linux å†…æ ¸çš„ä¼ä¸šçº§è·¯ç”±å™¨æä¾› Full-cone NAT èƒ½åŠ›ï¼Œè¿™äº›è®¾å¤‡å¯èƒ½æ˜¯åŸºäº FPGA ç­‰ä¸“ç”¨èŠ¯ç‰‡è®¾è®¡çš„ã€‚ æƒ³è¦å°† Symmetric NAT å†…çš„ä¸»æœºæä¾›ç»™å¤–éƒ¨è®¿é—®ï¼Œåªèƒ½é€šè¿‡ç«¯å£æ˜ å°„ã€ä¸€å¯¹ä¸€ NAT ç­‰æ–¹å¼å®ç°ï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»è¿™äº›æ–¹æ³•ã€‚ RFC5389 å®šä¹‰çš„ NAT ç±»å‹ï¼ˆä¹ç§ï¼‰RFC3489 è¿™ä¸ªæ—©æœŸ RFC å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œé—®é¢˜ä¹‹ä¸€å°±æ˜¯å®ƒå¯¹ NAT å½’ç±»è¿‡äºç¬¼ç»Ÿï¼Œå¾ˆå¤š NAPT ç½‘å…³éƒ½æ— æ³•å¾ˆå¥½çš„åŒ¹é…ä¸Šå…¶ä¸­æŸä¸ªç±»åˆ«ã€‚ äºæ˜¯åæ¥ï¼ŒRFC3489 è¢«åºŸå¼ƒå¹¶ç”± RFC5389 æ¥æ›¿ä»£ï¼Œåœ¨ RFC5389 ä¸­ï¼Œå°† Mapping Behaviorï¼ˆæ˜ å°„è§„åˆ™ï¼‰å’Œ Filtering Behaviorï¼ˆè¿‡æ»¤è§„åˆ™ï¼‰åˆ†å¼€æ¥ï¼Œå®šä¹‰äº† 3 ç§ Mapping Behaviorï¼ˆæ˜ å°„è§„åˆ™ï¼‰å’Œ 3 ç§ Filtering Behaviorï¼ˆè¿‡æ»¤è§„åˆ™ï¼‰ï¼Œä¸€å…±æœ‰ 9 ç§ç»„åˆã€‚ 1. æ˜ å°„è§„åˆ™ä¸‰ç§æ˜ å°„è§„åˆ™å¦‚å›¾æ‰€ç¤ºï¼Œå‡è®¾ä¸€ä¸ªå†…ç½‘ä¸»æœº HostX çš„å†…ç½‘ IP åœ°å€ä¸º Xï¼Œç«¯å£å·ä¸º xï¼Œç» NAT æ˜ å°„åçš„å¤–ç½‘ IP åœ°å€ä¸º Mï¼Œç«¯å£å·ä¸º mã€‚ä¸ºæ–¹ä¾¿æè¿°ï¼Œå°†å†…ç½‘çš„ Endpoint è®°ä¸º Endpoint(X,x)ï¼Œæ˜ å°„åå¤–ç½‘çš„ Endpoint è®°ä¸º Endpoint(M,m)ã€‚å†…ç½‘ Endpoint(X,x) å‘å¾€å¤–ç½‘ HostD1 çš„ IP åœ°å€å’Œç«¯å£å·è®°ä¸ºç›®çš„ Endpoint(D1,d1)ï¼›å‘å¾€å¤–ç½‘ HostD2 çš„ IP åœ°å€å’Œç«¯å£å·è®°ä¸ºç›®çš„Endpoint(D2,d2)ã€‚ NAT æ˜ å°„è§„åˆ™ EIM(Endpoint-Independent Mapping) å¤–éƒ¨åœ°å€æ— å…³æ˜ å°„ å¯¹äºä¸€ä¸ªå†…ç½‘ Endpoint(X,x)ï¼Œå…¶æ˜ å°„çš„å¤–ç½‘ Endpoint(M,m) æ˜¯å›ºå®šçš„ã€‚å³ä»ç›¸åŒçš„Endpoint(X,x) å‘é€åˆ°ä»»ä½•å¤–éƒ¨ IP åœ°å€å’Œä»»ä½•å¤–éƒ¨ç«¯å£çš„æŠ¥æ–‡åœ¨ NAT è®¾å¤‡ä¸Šä½¿ç”¨ç›¸åŒçš„æ˜ å°„ã€‚ ADM(Address-Dependent Mapping) å¤–éƒ¨åœ°å€ç›¸å…³æ˜ å°„ï¼šå¯¹äºä¸€ä¸ªå†…ç½‘ Endpoint(X,x)ï¼Œå‘å¾€ç›®çš„ Endpoint(D1,d1) çš„æŠ¥æ–‡ï¼ŒEndpoint(X,x) è¢«æ˜ å°„æˆ Endpoint(M1,m1)ï¼›å‘å¾€ç›®çš„Endpoint(D2,d2) çš„æŠ¥æ–‡ï¼ŒEndpoint(X,x) è¢«æ˜ å°„æˆ Endpoint(M2,m2)ã€‚åªè¦D1=D2ï¼Œä¸ç®¡d1 å’Œd2æ˜¯å¤šå°‘ï¼Œéƒ½æœ‰ Endpoint(M1,m1)=Endpoint(M2,m2)ã€‚å³ä»ç›¸åŒçš„ Endpoint(X,x) å‘é€åˆ°ç›¸åŒå¤–éƒ¨ IP åœ°å€å’Œä»»ä½•å¤–éƒ¨ç«¯å£çš„æŠ¥æ–‡åœ¨ NAT è®¾å¤‡ä¸Šä½¿ç”¨ç›¸åŒçš„æ˜ å°„ã€‚ APDMï¼ˆAddress and Port-Dependent Mappingï¼‰å¤–éƒ¨åœ°å€å’Œç«¯å£ç›¸å…³æ˜ å°„ï¼šå¯¹äºä¸€ä¸ªå†…ç½‘Endpoint(X,x)ï¼Œå‘å¾€ç›®çš„ Endpoint(D1,d1) çš„æŠ¥æ–‡ï¼ŒEndpoint(X,x) è¢«æ˜ å°„æˆEndpoint(M1,m1)ï¼›å‘å¾€ç›®çš„ Endpoint(D2,d2) çš„æŠ¥æ–‡ï¼Œ Endpoint(X,x) è¢«æ˜ å°„æˆEndpoint(M2,m2)ã€‚åªæœ‰å½“D1=D2ï¼Œä¸”d1=d2ï¼Œæ‰æœ‰ Endpoint(M1,m1)=Endpoint(M2,m2)ã€‚å³ä»ç›¸åŒçš„ Endpoint(X,x) å‘é€åˆ°ç›¸åŒå¤–éƒ¨IPåœ°å€å’Œç›¸åŒå¤–éƒ¨ç«¯å£çš„æŠ¥æ–‡åœ¨NATè®¾å¤‡ä¸Šä½¿ç”¨ç›¸åŒçš„æ˜ å°„ã€‚ 2. è¿‡æ»¤è§„åˆ™ NAT è¿‡æ»¤è§„åˆ™ EIFï¼ˆEndpoint-Independent Filteringï¼‰å¤–éƒ¨åœ°å€æ— å…³è¿‡æ»¤ï¼šå¯¹äºä¸€ä¸ªå†…ç½‘Endpoint(X,x)ï¼Œåªè¦å®ƒæ›¾ç»å‘å¤–ç½‘å‘é€è¿‡æ•°æ®ï¼Œå¤–ç½‘ä¸»æœºå°±å¯ä»¥è·å–åˆ°å®ƒç» NAT æ˜ å°„åçš„å¤–ç½‘Endpoint(M,m) ã€‚é‚£ä¹ˆåªè¦æ˜¯å‘ç»™ Endpoint(M,m) çš„æŠ¥æ–‡ï¼Œä¸ç®¡æ¥æºäº D1 è¿˜æ˜¯ D2ï¼Œéƒ½èƒ½è¢«è½¬æ¢å¹¶å‘å¾€å†…ç½‘ï¼Œå…¶ä»–æŠ¥æ–‡è¢«è¿‡æ»¤æ‰ã€‚ ADFï¼ˆAddr","date":"2022-05-13","objectID":"/posts/about-nat/:3:2","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["NAT","ç½‘ç»œ","NAT ç©¿è¶Š","å†…ç½‘ç©¿é€","è™šæ‹Ÿç½‘ç»œ","P2P","WebRTC"],"title":"NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ","uri":"/posts/about-nat/#3-port-restricted-cone-nat"},{"categories":["tech"],"content":" 2. ä¸€å¯¹å¤š NAT - NAPTä¸€å¯¹å¤š NATï¼Œä¹Ÿè¢«ç§°ä¸º NAPTï¼ˆnetwork address and port translationï¼‰ï¼ŒåŒæ ·åœ¨RFC2663 ä¸­è¢«å®šä¹‰ã€‚Easy IP æ˜¯ NAPT çš„ä¸€ä¸ªç‰¹æ®Šå½¢å¼ã€‚ NAPT çš„ä¸»è¦åº”ç”¨åœºæ™¯æ˜¯ï¼Œå†…ç½‘ç”¨æˆ·éœ€è¦è®¿é—®åˆ°å…¬ç½‘ä¸»æœºã€‚ç»å¤§å¤šæ•°çš„å®¶åº­ç½‘ç»œã€åŠå…¬ç½‘ç»œéƒ½æ˜¯ NAPT ç±»å‹çš„ã€‚åŸå› åº”è¯¥å¾ˆå¥½ç†è§£â€”â€”å®¶åº­ç½‘ç»œæˆ–åŠå…¬ç½‘ç»œéƒ½åŒ…å«è®¸å¤šè”ç½‘è®¾å¤‡ï¼Œä½†æ˜¯è¿™ç±»ç½‘ç»œé€šå¸¸åªæœ‰ä¸€ä¸ªæˆ–æ•°ä¸ªå…¬ç½‘ IPï¼Œä½¿ç”¨ä¸€å¯¹ä¸€ NAT çš„è¯å…¬ç½‘ IP æ˜¾ç„¶æ˜¯ä¸å¤Ÿç”¨çš„ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ä¸€å¯¹å¤š NAT. NAPT é€šè¿‡åŒæ—¶åˆ©ç”¨ L3 çš„ IP ä¿¡æ¯ï¼Œä»¥åŠ L4 ä¼ è¾“å±‚çš„ç«¯å£ä¿¡æ¯ï¼Œæ¥ä¸ºå±€åŸŸç½‘è®¾å¤‡æä¾›é€æ˜çš„ã€é…ç½®æ–¹ä¾¿çš„ã€æ”¯æŒè¶…é«˜å¹¶å‘è¿æ¥çš„å¤–éƒ¨ç½‘ç»œé€šä¿¡ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š NAPT çš„ç«¯å£åˆ†é…ä¸è½¬æ¢è§„åˆ™ï¼ˆMapping Behaviorï¼‰ä»¥åŠå¯¹å¤–æ¥æµé‡çš„è¿‡æ»¤è§„åˆ™ï¼ˆFiltering Behaviorï¼‰éƒ½å­˜åœ¨è®¸å¤šä¸åŒçš„å®ç°ï¼Œæ²¡æœ‰ç»Ÿä¸€çš„è§„èŒƒä¸æ ‡å‡†ï¼Œä½†æ˜¯å­˜åœ¨ä¸¤ç§åˆ†ç±»è§„èŒƒï¼Œè¿™ç§åˆ†ç±»æ–¹æ³•ä¸»è¦ç”¨åœ¨ NAT ç©¿è¶ŠæŠ€æœ¯ä¸­ã€‚ RFC3489 å®šä¹‰çš„ NAT ç±»å‹ï¼ˆå››ç§ï¼‰åœ¨ RFC3489 ä¸­å°† NAPT åˆ†ä¸ºå››ç§ç±»å‹ï¼Œè¿™ä¹Ÿæ˜¯åº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ NAT åˆ†ç±»æ–¹æ³•ï¼Œå¦‚ä¸‹å›¾ï¼š ä¸‹é¢æˆ‘ä»¬é€ä¸€ä»‹ç»è¿™å››ç§ä¸åŒçš„ NAPT ç±»å‹ã€‚ ä»è¿™é‡Œå¼€å§‹ï¼Œä¸‹æ–‡ä¸­çš„ NAT ç‰¹æŒ‡ NAPTï¼Œå¦‚æœæ¶‰åŠã€Œä¸€å¯¹ä¸€ NATã€ä¼šä½¿ç”¨å®ƒçš„å…¨åã€‚ 1. Full-cone NATFull-cone NAT çš„ç‰¹ç‚¹å¦‚ä¸‹ï¼š æ•°æ®åŒ…æµå‡ºï¼šä¸€æ—¦å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰æ˜ å°„åˆ°å¤–éƒ¨åœ°å€ï¼ˆeAddr:ePortï¼‰ï¼Œæ‰€æœ‰å‘è‡ª iAddr:iPort çš„æ•°æ®åŒ…éƒ½ç»ç”± eAddr:ePort å‘å¤–å‘é€ã€‚ æ•°æ®åŒ…æµå…¥ï¼šä»»æ„ä¸»æœºå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œéƒ½èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. ä¹Ÿå°±æ˜¯ä¸å¯¹å¤–éƒ¨è¿›æ¥çš„æ•°æ®åšä»»ä½•é™åˆ¶ï¼Œå…¨éƒ¨æ”¾è¡Œã€‚ cone åœ†é”¥ï¼Œä¸ªäººç†è§£æ˜¯ä¸€ä¸ªæ¯”å–»ï¼Œä»»æ„å‘é€è¿›æ¥çš„æ•°æ®ï¼ˆå¤šï¼‰ï¼Œéƒ½èƒ½é€šè¿‡ NAT åˆ°è¾¾è¿™ä¸ªå†…éƒ¨åœ°å€ ï¼ˆä¸€ï¼‰ï¼Œå°±åƒä¸€ä¸ªåœ†é”¥ã€‚ å…è®¸ä»»æ„ä¸»æœºå‘é€åˆ° eAddr:ePort çš„æ•°æ®åˆ°è¾¾å†…éƒ¨åœ°å€æ˜¯å¾ˆå±é™©çš„è¡Œä¸ºï¼Œå› ä¸ºå†…éƒ¨ä¸»æœºä¸ä¸€å®šé…ç½®äº†åˆé€‚çš„å®‰å…¨ç­–ç•¥ã€‚å› æ­¤ Full-cone NAT æ¯”è¾ƒå°‘è§ï¼Œå°±ç®—è·¯ç”±å™¨ç­‰ NAT è®¾å¤‡æ”¯æŒ Full-cone NATï¼Œ é€šå¸¸ä¹Ÿä¸ä¼šæ˜¯é»˜è®¤é€‰é¡¹ã€‚æˆ‘ä»¬ä¼šåœ¨åé¢æ›´è¯¦ç»†åœ°ä»‹ç»å®ƒã€‚ 2. (Address-)Restricted cone NAT æ•°æ®åŒ…æµå‡ºï¼šï¼ˆè·Ÿ Full-cone NAT å®Œå…¨ä¸€è‡´ï¼‰ä¸€æ—¦å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰æ˜ å°„åˆ°å¤–éƒ¨åœ°å€ ï¼ˆeAddr:ePortï¼‰ï¼Œæ‰€æœ‰å‘è‡ª iAddr:iPort çš„æ•°æ®åŒ…éƒ½ç»ç”± eAddr:ePort å‘å¤–å‘é€ã€‚ æ•°æ®åŒ…æµå…¥ï¼šåªæœ‰å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸»åŠ¨è¿æ¥è¿‡çš„å¤–éƒ¨ä¸»æœºï¼ˆnAddr:anyï¼‰ï¼Œå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œæ‰èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. è·Ÿ Full-cone NAT çš„åŒºåˆ«åœ¨äºï¼Œå®ƒé™åˆ¶äº†å¤–éƒ¨ä¸»æœºçš„ IP åœ°å€ã€‚åªæœ‰ä¸»åŠ¨è¿æ¥è¿‡çš„ä¸»æœºï¼Œæ‰èƒ½å‘é€æ•°æ®åˆ° NAT å†…éƒ¨ã€‚è¿™æå‡äº†ä¸€äº›å®‰å…¨æ€§ã€‚ 3. Port-Restricted cone NAT æ•°æ®åŒ…æµå‡ºï¼šï¼ˆè·Ÿ Full-cone NAT å®Œå…¨ä¸€è‡´ï¼‰ä¸€æ—¦å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰æ˜ å°„åˆ°å¤–éƒ¨åœ°å€ ï¼ˆeAddr:ePortï¼‰ï¼Œæ‰€æœ‰å‘è‡ª iAddr:iPort çš„æ•°æ®åŒ…éƒ½ç»ç”± eAddr:ePort å‘å¤–å‘é€ã€‚ æ•°æ®åŒ…æµå…¥ï¼šåªæœ‰å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸»åŠ¨è¿æ¥è¿‡çš„å¤–éƒ¨ç¨‹åºï¼ˆnAddr:nPortï¼‰ï¼Œå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œæ‰èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. ä¸ Address-Restricted cone NAT çš„åŒºåˆ«åœ¨äºï¼Œå®ƒåŒæ—¶é™åˆ¶äº†å¤–éƒ¨ä¸»æœºçš„ IP ä¸ç«¯å£ï¼Œå¯ä»¥è¯´æ˜¯æ›´è¿›ä¸€æ­¥åœ°æå‡äº†å®‰å…¨æ€§ã€‚ 4. Symmetric NAT æ•°æ®åŒ…æµå‡ºï¼šåŒä¸€ä¸ªå†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸ä¸åŒå¤–éƒ¨ä¸»æœºï¼ˆnAddr:nPortï¼‰çš„é€šä¿¡ï¼Œä¼šéšæœºä½¿ç”¨ä¸åŒçš„ NAT å¤–éƒ¨ç«¯å£ï¼ˆeAddr:randomPortï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´å†…éƒ¨åœ°å€ä¸ NAT å¤–éƒ¨åœ°å€çš„å…³ç³»ä¹Ÿæ˜¯ä¸€å¯¹å¤šï¼ ä¸ºæ¯ä¸ªè¿æ¥éƒ½éšæœºé€‰æ‹©ä¸€ä¸ªä¸åŒçš„ NAT ç«¯å£ï¼Œè¿™å®é™…æ˜¯è¿›ä¸€æ­¥å¼ºåŒ–äº† NAT å†…ç½‘çš„å®‰å…¨æ€§ã€‚ä½†è¿™ä¹Ÿæ˜¯ NAT ç©¿è¶Šæœ€å¤§çš„éš¾ç‚¹â€”â€”å®ƒå¯¼è‡´ Symmetric NAT çš„ç«¯å£éš¾ä»¥é¢„æµ‹ï¼ æ•°æ®åŒ…æµå…¥ï¼šåªæœ‰å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸»åŠ¨è¿æ¥è¿‡çš„å¤–éƒ¨ç¨‹åºï¼ˆnAddr:nPortï¼‰ï¼Œå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œæ‰èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. è¿™ä¸ªæ•°æ®æµå…¥è§„åˆ™ï¼Œä¸ Port-Restricted cone NAT æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚ å¯¹ç§° NAT æ˜¯æœ€å®‰å…¨çš„ä¸€ç§ NAT ç»“æ„ï¼Œé™åˆ¶æœ€ä¸ºä¸¥æ ¼ï¼Œåº”è¯¥ä¹Ÿæ˜¯åº”ç”¨æœ€å¹¿æ³›çš„ NAT ç»“æ„ã€‚ä½†æ˜¯å®ƒå¯¼è‡´æ‰€æœ‰çš„ TCP è¿æ¥éƒ½åªèƒ½ç”±ä»å†…éƒ¨ä¸»åŠ¨å‘èµ·ï¼Œå¤–éƒ¨å‘èµ·çš„ TCP è¿æ¥è¯·æ±‚ä¼šç›´æ¥è¢« NAT æ‹’ç»ï¼Œå› æ­¤å®ƒä¹Ÿæ˜¯ P2P ç©å®¶æœ€å¤´ç–¼çš„ä¸€ç§ NAT ç±»å‹ã€‚è§£å†³æ–¹æ¡ˆæ˜¯é€šè¿‡ UDP è¿‚å›å®ç°è¿æ¥çš„å»ºç«‹ï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚ 5. Linux ä¸­çš„ NAPTLinux çš„ç½‘ç»œæ ˆä¸­ï¼Œå¯é€šè¿‡ iptables/netfilter çš„ SNAT/MASQUERADE å®ç° NAPT ç½‘å…³ï¼Œè¿™ç§æ–¹å¼åªèƒ½å®ç°ä¸€ä¸ª Symmetric NAT. ä¹Ÿå°±æ˜¯è¯´ç»å¤§å¤šæ•°åŸºäº Linux å®ç°çš„å®¶åº­å±€åŸŸç½‘ã€Docker è™šæ‹Ÿç½‘ç»œã€Kubernetes è™šæ‹Ÿç½‘ç»œã€äº‘æœåŠ¡çš„è™šæ‹Ÿç½‘ç»œï¼Œéƒ½æ˜¯ Symmetric NAT. åªæœ‰ä¸€äº›æœ‰ Full-cone NAT éœ€æ±‚çš„ç½‘å§ã€ISP çš„ LSN(Large Scale NAT) ç½‘å…³ç­‰ç»„ç»‡ï¼Œä¼šä½¿ç”¨é Linux å†…æ ¸çš„ä¼ä¸šçº§è·¯ç”±å™¨æä¾› Full-cone NAT èƒ½åŠ›ï¼Œè¿™äº›è®¾å¤‡å¯èƒ½æ˜¯åŸºäº FPGA ç­‰ä¸“ç”¨èŠ¯ç‰‡è®¾è®¡çš„ã€‚ æƒ³è¦å°† Symmetric NAT å†…çš„ä¸»æœºæä¾›ç»™å¤–éƒ¨è®¿é—®ï¼Œåªèƒ½é€šè¿‡ç«¯å£æ˜ å°„ã€ä¸€å¯¹ä¸€ NAT ç­‰æ–¹å¼å®ç°ï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»è¿™äº›æ–¹æ³•ã€‚ RFC5389 å®šä¹‰çš„ NAT ç±»å‹ï¼ˆä¹ç§ï¼‰RFC3489 è¿™ä¸ªæ—©æœŸ RFC å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œé—®é¢˜ä¹‹ä¸€å°±æ˜¯å®ƒå¯¹ NAT å½’ç±»è¿‡äºç¬¼ç»Ÿï¼Œå¾ˆå¤š NAPT ç½‘å…³éƒ½æ— æ³•å¾ˆå¥½çš„åŒ¹é…ä¸Šå…¶ä¸­æŸä¸ªç±»åˆ«ã€‚ äºæ˜¯åæ¥ï¼ŒRFC3489 è¢«åºŸå¼ƒå¹¶ç”± RFC5389 æ¥æ›¿ä»£ï¼Œåœ¨ RFC5389 ä¸­ï¼Œå°† Mapping Behaviorï¼ˆæ˜ å°„è§„åˆ™ï¼‰å’Œ Filtering Behaviorï¼ˆè¿‡æ»¤è§„åˆ™ï¼‰åˆ†å¼€æ¥ï¼Œå®šä¹‰äº† 3 ç§ Mapping Behaviorï¼ˆæ˜ å°„è§„åˆ™ï¼‰å’Œ 3 ç§ Filtering Behaviorï¼ˆè¿‡æ»¤è§„åˆ™ï¼‰ï¼Œä¸€å…±æœ‰ 9 ç§ç»„åˆã€‚ 1. æ˜ å°„è§„åˆ™ä¸‰ç§æ˜ å°„è§„åˆ™å¦‚å›¾æ‰€ç¤ºï¼Œå‡è®¾ä¸€ä¸ªå†…ç½‘ä¸»æœº HostX çš„å†…ç½‘ IP åœ°å€ä¸º Xï¼Œç«¯å£å·ä¸º xï¼Œç» NAT æ˜ å°„åçš„å¤–ç½‘ IP åœ°å€ä¸º Mï¼Œç«¯å£å·ä¸º mã€‚ä¸ºæ–¹ä¾¿æè¿°ï¼Œå°†å†…ç½‘çš„ Endpoint è®°ä¸º Endpoint(X,x)ï¼Œæ˜ å°„åå¤–ç½‘çš„ Endpoint è®°ä¸º Endpoint(M,m)ã€‚å†…ç½‘ Endpoint(X,x) å‘å¾€å¤–ç½‘ HostD1 çš„ IP åœ°å€å’Œç«¯å£å·è®°ä¸ºç›®çš„ Endpoint(D1,d1)ï¼›å‘å¾€å¤–ç½‘ HostD2 çš„ IP åœ°å€å’Œç«¯å£å·è®°ä¸ºç›®çš„Endpoint(D2,d2)ã€‚ NAT æ˜ å°„è§„åˆ™ EIM(Endpoint-Independent Mapping) å¤–éƒ¨åœ°å€æ— å…³æ˜ å°„ å¯¹äºä¸€ä¸ªå†…ç½‘ Endpoint(X,x)ï¼Œå…¶æ˜ å°„çš„å¤–ç½‘ Endpoint(M,m) æ˜¯å›ºå®šçš„ã€‚å³ä»ç›¸åŒçš„Endpoint(X,x) å‘é€åˆ°ä»»ä½•å¤–éƒ¨ IP åœ°å€å’Œä»»ä½•å¤–éƒ¨ç«¯å£çš„æŠ¥æ–‡åœ¨ NAT è®¾å¤‡ä¸Šä½¿ç”¨ç›¸åŒçš„æ˜ å°„ã€‚ ADM(Address-Dependent Mapping) å¤–éƒ¨åœ°å€ç›¸å…³æ˜ å°„ï¼šå¯¹äºä¸€ä¸ªå†…ç½‘ Endpoint(X,x)ï¼Œå‘å¾€ç›®çš„ Endpoint(D1,d1) çš„æŠ¥æ–‡ï¼ŒEndpoint(X,x) è¢«æ˜ å°„æˆ Endpoint(M1,m1)ï¼›å‘å¾€ç›®çš„Endpoint(D2,d2) çš„æŠ¥æ–‡ï¼ŒEndpoint(X,x) è¢«æ˜ å°„æˆ Endpoint(M2,m2)ã€‚åªè¦D1=D2ï¼Œä¸ç®¡d1 å’Œd2æ˜¯å¤šå°‘ï¼Œéƒ½æœ‰ Endpoint(M1,m1)=Endpoint(M2,m2)ã€‚å³ä»ç›¸åŒçš„ Endpoint(X,x) å‘é€åˆ°ç›¸åŒå¤–éƒ¨ IP åœ°å€å’Œä»»ä½•å¤–éƒ¨ç«¯å£çš„æŠ¥æ–‡åœ¨ NAT è®¾å¤‡ä¸Šä½¿ç”¨ç›¸åŒçš„æ˜ å°„ã€‚ APDMï¼ˆAddress and Port-Dependent Mappingï¼‰å¤–éƒ¨åœ°å€å’Œç«¯å£ç›¸å…³æ˜ å°„ï¼šå¯¹äºä¸€ä¸ªå†…ç½‘Endpoint(X,x)ï¼Œå‘å¾€ç›®çš„ Endpoint(D1,d1) çš„æŠ¥æ–‡ï¼ŒEndpoint(X,x) è¢«æ˜ å°„æˆEndpoint(M1,m1)ï¼›å‘å¾€ç›®çš„ Endpoint(D2,d2) çš„æŠ¥æ–‡ï¼Œ Endpoint(X,x) è¢«æ˜ å°„æˆEndpoint(M2,m2)ã€‚åªæœ‰å½“D1=D2ï¼Œä¸”d1=d2ï¼Œæ‰æœ‰ Endpoint(M1,m1)=Endpoint(M2,m2)ã€‚å³ä»ç›¸åŒçš„ Endpoint(X,x) å‘é€åˆ°ç›¸åŒå¤–éƒ¨IPåœ°å€å’Œç›¸åŒå¤–éƒ¨ç«¯å£çš„æŠ¥æ–‡åœ¨NATè®¾å¤‡ä¸Šä½¿ç”¨ç›¸åŒçš„æ˜ å°„ã€‚ 2. è¿‡æ»¤è§„åˆ™ NAT è¿‡æ»¤è§„åˆ™ EIFï¼ˆEndpoint-Independent Filteringï¼‰å¤–éƒ¨åœ°å€æ— å…³è¿‡æ»¤ï¼šå¯¹äºä¸€ä¸ªå†…ç½‘Endpoint(X,x)ï¼Œåªè¦å®ƒæ›¾ç»å‘å¤–ç½‘å‘é€è¿‡æ•°æ®ï¼Œå¤–ç½‘ä¸»æœºå°±å¯ä»¥è·å–åˆ°å®ƒç» NAT æ˜ å°„åçš„å¤–ç½‘Endpoint(M,m) ã€‚é‚£ä¹ˆåªè¦æ˜¯å‘ç»™ Endpoint(M,m) çš„æŠ¥æ–‡ï¼Œä¸ç®¡æ¥æºäº D1 è¿˜æ˜¯ D2ï¼Œéƒ½èƒ½è¢«è½¬æ¢å¹¶å‘å¾€å†…ç½‘ï¼Œå…¶ä»–æŠ¥æ–‡è¢«è¿‡æ»¤æ‰ã€‚ ADFï¼ˆAddr","date":"2022-05-13","objectID":"/posts/about-nat/:3:2","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["NAT","ç½‘ç»œ","NAT ç©¿è¶Š","å†…ç½‘ç©¿é€","è™šæ‹Ÿç½‘ç»œ","P2P","WebRTC"],"title":"NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ","uri":"/posts/about-nat/#4-symmetric-nat"},{"categories":["tech"],"content":" 2. ä¸€å¯¹å¤š NAT - NAPTä¸€å¯¹å¤š NATï¼Œä¹Ÿè¢«ç§°ä¸º NAPTï¼ˆnetwork address and port translationï¼‰ï¼ŒåŒæ ·åœ¨RFC2663 ä¸­è¢«å®šä¹‰ã€‚Easy IP æ˜¯ NAPT çš„ä¸€ä¸ªç‰¹æ®Šå½¢å¼ã€‚ NAPT çš„ä¸»è¦åº”ç”¨åœºæ™¯æ˜¯ï¼Œå†…ç½‘ç”¨æˆ·éœ€è¦è®¿é—®åˆ°å…¬ç½‘ä¸»æœºã€‚ç»å¤§å¤šæ•°çš„å®¶åº­ç½‘ç»œã€åŠå…¬ç½‘ç»œéƒ½æ˜¯ NAPT ç±»å‹çš„ã€‚åŸå› åº”è¯¥å¾ˆå¥½ç†è§£â€”â€”å®¶åº­ç½‘ç»œæˆ–åŠå…¬ç½‘ç»œéƒ½åŒ…å«è®¸å¤šè”ç½‘è®¾å¤‡ï¼Œä½†æ˜¯è¿™ç±»ç½‘ç»œé€šå¸¸åªæœ‰ä¸€ä¸ªæˆ–æ•°ä¸ªå…¬ç½‘ IPï¼Œä½¿ç”¨ä¸€å¯¹ä¸€ NAT çš„è¯å…¬ç½‘ IP æ˜¾ç„¶æ˜¯ä¸å¤Ÿç”¨çš„ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ä¸€å¯¹å¤š NAT. NAPT é€šè¿‡åŒæ—¶åˆ©ç”¨ L3 çš„ IP ä¿¡æ¯ï¼Œä»¥åŠ L4 ä¼ è¾“å±‚çš„ç«¯å£ä¿¡æ¯ï¼Œæ¥ä¸ºå±€åŸŸç½‘è®¾å¤‡æä¾›é€æ˜çš„ã€é…ç½®æ–¹ä¾¿çš„ã€æ”¯æŒè¶…é«˜å¹¶å‘è¿æ¥çš„å¤–éƒ¨ç½‘ç»œé€šä¿¡ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š NAPT çš„ç«¯å£åˆ†é…ä¸è½¬æ¢è§„åˆ™ï¼ˆMapping Behaviorï¼‰ä»¥åŠå¯¹å¤–æ¥æµé‡çš„è¿‡æ»¤è§„åˆ™ï¼ˆFiltering Behaviorï¼‰éƒ½å­˜åœ¨è®¸å¤šä¸åŒçš„å®ç°ï¼Œæ²¡æœ‰ç»Ÿä¸€çš„è§„èŒƒä¸æ ‡å‡†ï¼Œä½†æ˜¯å­˜åœ¨ä¸¤ç§åˆ†ç±»è§„èŒƒï¼Œè¿™ç§åˆ†ç±»æ–¹æ³•ä¸»è¦ç”¨åœ¨ NAT ç©¿è¶ŠæŠ€æœ¯ä¸­ã€‚ RFC3489 å®šä¹‰çš„ NAT ç±»å‹ï¼ˆå››ç§ï¼‰åœ¨ RFC3489 ä¸­å°† NAPT åˆ†ä¸ºå››ç§ç±»å‹ï¼Œè¿™ä¹Ÿæ˜¯åº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ NAT åˆ†ç±»æ–¹æ³•ï¼Œå¦‚ä¸‹å›¾ï¼š ä¸‹é¢æˆ‘ä»¬é€ä¸€ä»‹ç»è¿™å››ç§ä¸åŒçš„ NAPT ç±»å‹ã€‚ ä»è¿™é‡Œå¼€å§‹ï¼Œä¸‹æ–‡ä¸­çš„ NAT ç‰¹æŒ‡ NAPTï¼Œå¦‚æœæ¶‰åŠã€Œä¸€å¯¹ä¸€ NATã€ä¼šä½¿ç”¨å®ƒçš„å…¨åã€‚ 1. Full-cone NATFull-cone NAT çš„ç‰¹ç‚¹å¦‚ä¸‹ï¼š æ•°æ®åŒ…æµå‡ºï¼šä¸€æ—¦å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰æ˜ å°„åˆ°å¤–éƒ¨åœ°å€ï¼ˆeAddr:ePortï¼‰ï¼Œæ‰€æœ‰å‘è‡ª iAddr:iPort çš„æ•°æ®åŒ…éƒ½ç»ç”± eAddr:ePort å‘å¤–å‘é€ã€‚ æ•°æ®åŒ…æµå…¥ï¼šä»»æ„ä¸»æœºå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œéƒ½èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. ä¹Ÿå°±æ˜¯ä¸å¯¹å¤–éƒ¨è¿›æ¥çš„æ•°æ®åšä»»ä½•é™åˆ¶ï¼Œå…¨éƒ¨æ”¾è¡Œã€‚ cone åœ†é”¥ï¼Œä¸ªäººç†è§£æ˜¯ä¸€ä¸ªæ¯”å–»ï¼Œä»»æ„å‘é€è¿›æ¥çš„æ•°æ®ï¼ˆå¤šï¼‰ï¼Œéƒ½èƒ½é€šè¿‡ NAT åˆ°è¾¾è¿™ä¸ªå†…éƒ¨åœ°å€ ï¼ˆä¸€ï¼‰ï¼Œå°±åƒä¸€ä¸ªåœ†é”¥ã€‚ å…è®¸ä»»æ„ä¸»æœºå‘é€åˆ° eAddr:ePort çš„æ•°æ®åˆ°è¾¾å†…éƒ¨åœ°å€æ˜¯å¾ˆå±é™©çš„è¡Œä¸ºï¼Œå› ä¸ºå†…éƒ¨ä¸»æœºä¸ä¸€å®šé…ç½®äº†åˆé€‚çš„å®‰å…¨ç­–ç•¥ã€‚å› æ­¤ Full-cone NAT æ¯”è¾ƒå°‘è§ï¼Œå°±ç®—è·¯ç”±å™¨ç­‰ NAT è®¾å¤‡æ”¯æŒ Full-cone NATï¼Œ é€šå¸¸ä¹Ÿä¸ä¼šæ˜¯é»˜è®¤é€‰é¡¹ã€‚æˆ‘ä»¬ä¼šåœ¨åé¢æ›´è¯¦ç»†åœ°ä»‹ç»å®ƒã€‚ 2. (Address-)Restricted cone NAT æ•°æ®åŒ…æµå‡ºï¼šï¼ˆè·Ÿ Full-cone NAT å®Œå…¨ä¸€è‡´ï¼‰ä¸€æ—¦å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰æ˜ å°„åˆ°å¤–éƒ¨åœ°å€ ï¼ˆeAddr:ePortï¼‰ï¼Œæ‰€æœ‰å‘è‡ª iAddr:iPort çš„æ•°æ®åŒ…éƒ½ç»ç”± eAddr:ePort å‘å¤–å‘é€ã€‚ æ•°æ®åŒ…æµå…¥ï¼šåªæœ‰å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸»åŠ¨è¿æ¥è¿‡çš„å¤–éƒ¨ä¸»æœºï¼ˆnAddr:anyï¼‰ï¼Œå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œæ‰èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. è·Ÿ Full-cone NAT çš„åŒºåˆ«åœ¨äºï¼Œå®ƒé™åˆ¶äº†å¤–éƒ¨ä¸»æœºçš„ IP åœ°å€ã€‚åªæœ‰ä¸»åŠ¨è¿æ¥è¿‡çš„ä¸»æœºï¼Œæ‰èƒ½å‘é€æ•°æ®åˆ° NAT å†…éƒ¨ã€‚è¿™æå‡äº†ä¸€äº›å®‰å…¨æ€§ã€‚ 3. Port-Restricted cone NAT æ•°æ®åŒ…æµå‡ºï¼šï¼ˆè·Ÿ Full-cone NAT å®Œå…¨ä¸€è‡´ï¼‰ä¸€æ—¦å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰æ˜ å°„åˆ°å¤–éƒ¨åœ°å€ ï¼ˆeAddr:ePortï¼‰ï¼Œæ‰€æœ‰å‘è‡ª iAddr:iPort çš„æ•°æ®åŒ…éƒ½ç»ç”± eAddr:ePort å‘å¤–å‘é€ã€‚ æ•°æ®åŒ…æµå…¥ï¼šåªæœ‰å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸»åŠ¨è¿æ¥è¿‡çš„å¤–éƒ¨ç¨‹åºï¼ˆnAddr:nPortï¼‰ï¼Œå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œæ‰èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. ä¸ Address-Restricted cone NAT çš„åŒºåˆ«åœ¨äºï¼Œå®ƒåŒæ—¶é™åˆ¶äº†å¤–éƒ¨ä¸»æœºçš„ IP ä¸ç«¯å£ï¼Œå¯ä»¥è¯´æ˜¯æ›´è¿›ä¸€æ­¥åœ°æå‡äº†å®‰å…¨æ€§ã€‚ 4. Symmetric NAT æ•°æ®åŒ…æµå‡ºï¼šåŒä¸€ä¸ªå†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸ä¸åŒå¤–éƒ¨ä¸»æœºï¼ˆnAddr:nPortï¼‰çš„é€šä¿¡ï¼Œä¼šéšæœºä½¿ç”¨ä¸åŒçš„ NAT å¤–éƒ¨ç«¯å£ï¼ˆeAddr:randomPortï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´å†…éƒ¨åœ°å€ä¸ NAT å¤–éƒ¨åœ°å€çš„å…³ç³»ä¹Ÿæ˜¯ä¸€å¯¹å¤šï¼ ä¸ºæ¯ä¸ªè¿æ¥éƒ½éšæœºé€‰æ‹©ä¸€ä¸ªä¸åŒçš„ NAT ç«¯å£ï¼Œè¿™å®é™…æ˜¯è¿›ä¸€æ­¥å¼ºåŒ–äº† NAT å†…ç½‘çš„å®‰å…¨æ€§ã€‚ä½†è¿™ä¹Ÿæ˜¯ NAT ç©¿è¶Šæœ€å¤§çš„éš¾ç‚¹â€”â€”å®ƒå¯¼è‡´ Symmetric NAT çš„ç«¯å£éš¾ä»¥é¢„æµ‹ï¼ æ•°æ®åŒ…æµå…¥ï¼šåªæœ‰å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸»åŠ¨è¿æ¥è¿‡çš„å¤–éƒ¨ç¨‹åºï¼ˆnAddr:nPortï¼‰ï¼Œå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œæ‰èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. è¿™ä¸ªæ•°æ®æµå…¥è§„åˆ™ï¼Œä¸ Port-Restricted cone NAT æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚ å¯¹ç§° NAT æ˜¯æœ€å®‰å…¨çš„ä¸€ç§ NAT ç»“æ„ï¼Œé™åˆ¶æœ€ä¸ºä¸¥æ ¼ï¼Œåº”è¯¥ä¹Ÿæ˜¯åº”ç”¨æœ€å¹¿æ³›çš„ NAT ç»“æ„ã€‚ä½†æ˜¯å®ƒå¯¼è‡´æ‰€æœ‰çš„ TCP è¿æ¥éƒ½åªèƒ½ç”±ä»å†…éƒ¨ä¸»åŠ¨å‘èµ·ï¼Œå¤–éƒ¨å‘èµ·çš„ TCP è¿æ¥è¯·æ±‚ä¼šç›´æ¥è¢« NAT æ‹’ç»ï¼Œå› æ­¤å®ƒä¹Ÿæ˜¯ P2P ç©å®¶æœ€å¤´ç–¼çš„ä¸€ç§ NAT ç±»å‹ã€‚è§£å†³æ–¹æ¡ˆæ˜¯é€šè¿‡ UDP è¿‚å›å®ç°è¿æ¥çš„å»ºç«‹ï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚ 5. Linux ä¸­çš„ NAPTLinux çš„ç½‘ç»œæ ˆä¸­ï¼Œå¯é€šè¿‡ iptables/netfilter çš„ SNAT/MASQUERADE å®ç° NAPT ç½‘å…³ï¼Œè¿™ç§æ–¹å¼åªèƒ½å®ç°ä¸€ä¸ª Symmetric NAT. ä¹Ÿå°±æ˜¯è¯´ç»å¤§å¤šæ•°åŸºäº Linux å®ç°çš„å®¶åº­å±€åŸŸç½‘ã€Docker è™šæ‹Ÿç½‘ç»œã€Kubernetes è™šæ‹Ÿç½‘ç»œã€äº‘æœåŠ¡çš„è™šæ‹Ÿç½‘ç»œï¼Œéƒ½æ˜¯ Symmetric NAT. åªæœ‰ä¸€äº›æœ‰ Full-cone NAT éœ€æ±‚çš„ç½‘å§ã€ISP çš„ LSN(Large Scale NAT) ç½‘å…³ç­‰ç»„ç»‡ï¼Œä¼šä½¿ç”¨é Linux å†…æ ¸çš„ä¼ä¸šçº§è·¯ç”±å™¨æä¾› Full-cone NAT èƒ½åŠ›ï¼Œè¿™äº›è®¾å¤‡å¯èƒ½æ˜¯åŸºäº FPGA ç­‰ä¸“ç”¨èŠ¯ç‰‡è®¾è®¡çš„ã€‚ æƒ³è¦å°† Symmetric NAT å†…çš„ä¸»æœºæä¾›ç»™å¤–éƒ¨è®¿é—®ï¼Œåªèƒ½é€šè¿‡ç«¯å£æ˜ å°„ã€ä¸€å¯¹ä¸€ NAT ç­‰æ–¹å¼å®ç°ï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»è¿™äº›æ–¹æ³•ã€‚ RFC5389 å®šä¹‰çš„ NAT ç±»å‹ï¼ˆä¹ç§ï¼‰RFC3489 è¿™ä¸ªæ—©æœŸ RFC å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œé—®é¢˜ä¹‹ä¸€å°±æ˜¯å®ƒå¯¹ NAT å½’ç±»è¿‡äºç¬¼ç»Ÿï¼Œå¾ˆå¤š NAPT ç½‘å…³éƒ½æ— æ³•å¾ˆå¥½çš„åŒ¹é…ä¸Šå…¶ä¸­æŸä¸ªç±»åˆ«ã€‚ äºæ˜¯åæ¥ï¼ŒRFC3489 è¢«åºŸå¼ƒå¹¶ç”± RFC5389 æ¥æ›¿ä»£ï¼Œåœ¨ RFC5389 ä¸­ï¼Œå°† Mapping Behaviorï¼ˆæ˜ å°„è§„åˆ™ï¼‰å’Œ Filtering Behaviorï¼ˆè¿‡æ»¤è§„åˆ™ï¼‰åˆ†å¼€æ¥ï¼Œå®šä¹‰äº† 3 ç§ Mapping Behaviorï¼ˆæ˜ å°„è§„åˆ™ï¼‰å’Œ 3 ç§ Filtering Behaviorï¼ˆè¿‡æ»¤è§„åˆ™ï¼‰ï¼Œä¸€å…±æœ‰ 9 ç§ç»„åˆã€‚ 1. æ˜ å°„è§„åˆ™ä¸‰ç§æ˜ å°„è§„åˆ™å¦‚å›¾æ‰€ç¤ºï¼Œå‡è®¾ä¸€ä¸ªå†…ç½‘ä¸»æœº HostX çš„å†…ç½‘ IP åœ°å€ä¸º Xï¼Œç«¯å£å·ä¸º xï¼Œç» NAT æ˜ å°„åçš„å¤–ç½‘ IP åœ°å€ä¸º Mï¼Œç«¯å£å·ä¸º mã€‚ä¸ºæ–¹ä¾¿æè¿°ï¼Œå°†å†…ç½‘çš„ Endpoint è®°ä¸º Endpoint(X,x)ï¼Œæ˜ å°„åå¤–ç½‘çš„ Endpoint è®°ä¸º Endpoint(M,m)ã€‚å†…ç½‘ Endpoint(X,x) å‘å¾€å¤–ç½‘ HostD1 çš„ IP åœ°å€å’Œç«¯å£å·è®°ä¸ºç›®çš„ Endpoint(D1,d1)ï¼›å‘å¾€å¤–ç½‘ HostD2 çš„ IP åœ°å€å’Œç«¯å£å·è®°ä¸ºç›®çš„Endpoint(D2,d2)ã€‚ NAT æ˜ å°„è§„åˆ™ EIM(Endpoint-Independent Mapping) å¤–éƒ¨åœ°å€æ— å…³æ˜ å°„ å¯¹äºä¸€ä¸ªå†…ç½‘ Endpoint(X,x)ï¼Œå…¶æ˜ å°„çš„å¤–ç½‘ Endpoint(M,m) æ˜¯å›ºå®šçš„ã€‚å³ä»ç›¸åŒçš„Endpoint(X,x) å‘é€åˆ°ä»»ä½•å¤–éƒ¨ IP åœ°å€å’Œä»»ä½•å¤–éƒ¨ç«¯å£çš„æŠ¥æ–‡åœ¨ NAT è®¾å¤‡ä¸Šä½¿ç”¨ç›¸åŒçš„æ˜ å°„ã€‚ ADM(Address-Dependent Mapping) å¤–éƒ¨åœ°å€ç›¸å…³æ˜ å°„ï¼šå¯¹äºä¸€ä¸ªå†…ç½‘ Endpoint(X,x)ï¼Œå‘å¾€ç›®çš„ Endpoint(D1,d1) çš„æŠ¥æ–‡ï¼ŒEndpoint(X,x) è¢«æ˜ å°„æˆ Endpoint(M1,m1)ï¼›å‘å¾€ç›®çš„Endpoint(D2,d2) çš„æŠ¥æ–‡ï¼ŒEndpoint(X,x) è¢«æ˜ å°„æˆ Endpoint(M2,m2)ã€‚åªè¦D1=D2ï¼Œä¸ç®¡d1 å’Œd2æ˜¯å¤šå°‘ï¼Œéƒ½æœ‰ Endpoint(M1,m1)=Endpoint(M2,m2)ã€‚å³ä»ç›¸åŒçš„ Endpoint(X,x) å‘é€åˆ°ç›¸åŒå¤–éƒ¨ IP åœ°å€å’Œä»»ä½•å¤–éƒ¨ç«¯å£çš„æŠ¥æ–‡åœ¨ NAT è®¾å¤‡ä¸Šä½¿ç”¨ç›¸åŒçš„æ˜ å°„ã€‚ APDMï¼ˆAddress and Port-Dependent Mappingï¼‰å¤–éƒ¨åœ°å€å’Œç«¯å£ç›¸å…³æ˜ å°„ï¼šå¯¹äºä¸€ä¸ªå†…ç½‘Endpoint(X,x)ï¼Œå‘å¾€ç›®çš„ Endpoint(D1,d1) çš„æŠ¥æ–‡ï¼ŒEndpoint(X,x) è¢«æ˜ å°„æˆEndpoint(M1,m1)ï¼›å‘å¾€ç›®çš„ Endpoint(D2,d2) çš„æŠ¥æ–‡ï¼Œ Endpoint(X,x) è¢«æ˜ å°„æˆEndpoint(M2,m2)ã€‚åªæœ‰å½“D1=D2ï¼Œä¸”d1=d2ï¼Œæ‰æœ‰ Endpoint(M1,m1)=Endpoint(M2,m2)ã€‚å³ä»ç›¸åŒçš„ Endpoint(X,x) å‘é€åˆ°ç›¸åŒå¤–éƒ¨IPåœ°å€å’Œç›¸åŒå¤–éƒ¨ç«¯å£çš„æŠ¥æ–‡åœ¨NATè®¾å¤‡ä¸Šä½¿ç”¨ç›¸åŒçš„æ˜ å°„ã€‚ 2. è¿‡æ»¤è§„åˆ™ NAT è¿‡æ»¤è§„åˆ™ EIFï¼ˆEndpoint-Independent Filteringï¼‰å¤–éƒ¨åœ°å€æ— å…³è¿‡æ»¤ï¼šå¯¹äºä¸€ä¸ªå†…ç½‘Endpoint(X,x)ï¼Œåªè¦å®ƒæ›¾ç»å‘å¤–ç½‘å‘é€è¿‡æ•°æ®ï¼Œå¤–ç½‘ä¸»æœºå°±å¯ä»¥è·å–åˆ°å®ƒç» NAT æ˜ å°„åçš„å¤–ç½‘Endpoint(M,m) ã€‚é‚£ä¹ˆåªè¦æ˜¯å‘ç»™ Endpoint(M,m) çš„æŠ¥æ–‡ï¼Œä¸ç®¡æ¥æºäº D1 è¿˜æ˜¯ D2ï¼Œéƒ½èƒ½è¢«è½¬æ¢å¹¶å‘å¾€å†…ç½‘ï¼Œå…¶ä»–æŠ¥æ–‡è¢«è¿‡æ»¤æ‰ã€‚ ADFï¼ˆAddr","date":"2022-05-13","objectID":"/posts/about-nat/:3:2","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["NAT","ç½‘ç»œ","NAT ç©¿è¶Š","å†…ç½‘ç©¿é€","è™šæ‹Ÿç½‘ç»œ","P2P","WebRTC"],"title":"NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ","uri":"/posts/about-nat/#5-linux-ä¸­çš„-napt"},{"categories":["tech"],"content":" 2. ä¸€å¯¹å¤š NAT - NAPTä¸€å¯¹å¤š NATï¼Œä¹Ÿè¢«ç§°ä¸º NAPTï¼ˆnetwork address and port translationï¼‰ï¼ŒåŒæ ·åœ¨RFC2663 ä¸­è¢«å®šä¹‰ã€‚Easy IP æ˜¯ NAPT çš„ä¸€ä¸ªç‰¹æ®Šå½¢å¼ã€‚ NAPT çš„ä¸»è¦åº”ç”¨åœºæ™¯æ˜¯ï¼Œå†…ç½‘ç”¨æˆ·éœ€è¦è®¿é—®åˆ°å…¬ç½‘ä¸»æœºã€‚ç»å¤§å¤šæ•°çš„å®¶åº­ç½‘ç»œã€åŠå…¬ç½‘ç»œéƒ½æ˜¯ NAPT ç±»å‹çš„ã€‚åŸå› åº”è¯¥å¾ˆå¥½ç†è§£â€”â€”å®¶åº­ç½‘ç»œæˆ–åŠå…¬ç½‘ç»œéƒ½åŒ…å«è®¸å¤šè”ç½‘è®¾å¤‡ï¼Œä½†æ˜¯è¿™ç±»ç½‘ç»œé€šå¸¸åªæœ‰ä¸€ä¸ªæˆ–æ•°ä¸ªå…¬ç½‘ IPï¼Œä½¿ç”¨ä¸€å¯¹ä¸€ NAT çš„è¯å…¬ç½‘ IP æ˜¾ç„¶æ˜¯ä¸å¤Ÿç”¨çš„ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ä¸€å¯¹å¤š NAT. NAPT é€šè¿‡åŒæ—¶åˆ©ç”¨ L3 çš„ IP ä¿¡æ¯ï¼Œä»¥åŠ L4 ä¼ è¾“å±‚çš„ç«¯å£ä¿¡æ¯ï¼Œæ¥ä¸ºå±€åŸŸç½‘è®¾å¤‡æä¾›é€æ˜çš„ã€é…ç½®æ–¹ä¾¿çš„ã€æ”¯æŒè¶…é«˜å¹¶å‘è¿æ¥çš„å¤–éƒ¨ç½‘ç»œé€šä¿¡ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š NAPT çš„ç«¯å£åˆ†é…ä¸è½¬æ¢è§„åˆ™ï¼ˆMapping Behaviorï¼‰ä»¥åŠå¯¹å¤–æ¥æµé‡çš„è¿‡æ»¤è§„åˆ™ï¼ˆFiltering Behaviorï¼‰éƒ½å­˜åœ¨è®¸å¤šä¸åŒçš„å®ç°ï¼Œæ²¡æœ‰ç»Ÿä¸€çš„è§„èŒƒä¸æ ‡å‡†ï¼Œä½†æ˜¯å­˜åœ¨ä¸¤ç§åˆ†ç±»è§„èŒƒï¼Œè¿™ç§åˆ†ç±»æ–¹æ³•ä¸»è¦ç”¨åœ¨ NAT ç©¿è¶ŠæŠ€æœ¯ä¸­ã€‚ RFC3489 å®šä¹‰çš„ NAT ç±»å‹ï¼ˆå››ç§ï¼‰åœ¨ RFC3489 ä¸­å°† NAPT åˆ†ä¸ºå››ç§ç±»å‹ï¼Œè¿™ä¹Ÿæ˜¯åº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ NAT åˆ†ç±»æ–¹æ³•ï¼Œå¦‚ä¸‹å›¾ï¼š ä¸‹é¢æˆ‘ä»¬é€ä¸€ä»‹ç»è¿™å››ç§ä¸åŒçš„ NAPT ç±»å‹ã€‚ ä»è¿™é‡Œå¼€å§‹ï¼Œä¸‹æ–‡ä¸­çš„ NAT ç‰¹æŒ‡ NAPTï¼Œå¦‚æœæ¶‰åŠã€Œä¸€å¯¹ä¸€ NATã€ä¼šä½¿ç”¨å®ƒçš„å…¨åã€‚ 1. Full-cone NATFull-cone NAT çš„ç‰¹ç‚¹å¦‚ä¸‹ï¼š æ•°æ®åŒ…æµå‡ºï¼šä¸€æ—¦å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰æ˜ å°„åˆ°å¤–éƒ¨åœ°å€ï¼ˆeAddr:ePortï¼‰ï¼Œæ‰€æœ‰å‘è‡ª iAddr:iPort çš„æ•°æ®åŒ…éƒ½ç»ç”± eAddr:ePort å‘å¤–å‘é€ã€‚ æ•°æ®åŒ…æµå…¥ï¼šä»»æ„ä¸»æœºå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œéƒ½èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. ä¹Ÿå°±æ˜¯ä¸å¯¹å¤–éƒ¨è¿›æ¥çš„æ•°æ®åšä»»ä½•é™åˆ¶ï¼Œå…¨éƒ¨æ”¾è¡Œã€‚ cone åœ†é”¥ï¼Œä¸ªäººç†è§£æ˜¯ä¸€ä¸ªæ¯”å–»ï¼Œä»»æ„å‘é€è¿›æ¥çš„æ•°æ®ï¼ˆå¤šï¼‰ï¼Œéƒ½èƒ½é€šè¿‡ NAT åˆ°è¾¾è¿™ä¸ªå†…éƒ¨åœ°å€ ï¼ˆä¸€ï¼‰ï¼Œå°±åƒä¸€ä¸ªåœ†é”¥ã€‚ å…è®¸ä»»æ„ä¸»æœºå‘é€åˆ° eAddr:ePort çš„æ•°æ®åˆ°è¾¾å†…éƒ¨åœ°å€æ˜¯å¾ˆå±é™©çš„è¡Œä¸ºï¼Œå› ä¸ºå†…éƒ¨ä¸»æœºä¸ä¸€å®šé…ç½®äº†åˆé€‚çš„å®‰å…¨ç­–ç•¥ã€‚å› æ­¤ Full-cone NAT æ¯”è¾ƒå°‘è§ï¼Œå°±ç®—è·¯ç”±å™¨ç­‰ NAT è®¾å¤‡æ”¯æŒ Full-cone NATï¼Œ é€šå¸¸ä¹Ÿä¸ä¼šæ˜¯é»˜è®¤é€‰é¡¹ã€‚æˆ‘ä»¬ä¼šåœ¨åé¢æ›´è¯¦ç»†åœ°ä»‹ç»å®ƒã€‚ 2. (Address-)Restricted cone NAT æ•°æ®åŒ…æµå‡ºï¼šï¼ˆè·Ÿ Full-cone NAT å®Œå…¨ä¸€è‡´ï¼‰ä¸€æ—¦å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰æ˜ å°„åˆ°å¤–éƒ¨åœ°å€ ï¼ˆeAddr:ePortï¼‰ï¼Œæ‰€æœ‰å‘è‡ª iAddr:iPort çš„æ•°æ®åŒ…éƒ½ç»ç”± eAddr:ePort å‘å¤–å‘é€ã€‚ æ•°æ®åŒ…æµå…¥ï¼šåªæœ‰å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸»åŠ¨è¿æ¥è¿‡çš„å¤–éƒ¨ä¸»æœºï¼ˆnAddr:anyï¼‰ï¼Œå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œæ‰èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. è·Ÿ Full-cone NAT çš„åŒºåˆ«åœ¨äºï¼Œå®ƒé™åˆ¶äº†å¤–éƒ¨ä¸»æœºçš„ IP åœ°å€ã€‚åªæœ‰ä¸»åŠ¨è¿æ¥è¿‡çš„ä¸»æœºï¼Œæ‰èƒ½å‘é€æ•°æ®åˆ° NAT å†…éƒ¨ã€‚è¿™æå‡äº†ä¸€äº›å®‰å…¨æ€§ã€‚ 3. Port-Restricted cone NAT æ•°æ®åŒ…æµå‡ºï¼šï¼ˆè·Ÿ Full-cone NAT å®Œå…¨ä¸€è‡´ï¼‰ä¸€æ—¦å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰æ˜ å°„åˆ°å¤–éƒ¨åœ°å€ ï¼ˆeAddr:ePortï¼‰ï¼Œæ‰€æœ‰å‘è‡ª iAddr:iPort çš„æ•°æ®åŒ…éƒ½ç»ç”± eAddr:ePort å‘å¤–å‘é€ã€‚ æ•°æ®åŒ…æµå…¥ï¼šåªæœ‰å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸»åŠ¨è¿æ¥è¿‡çš„å¤–éƒ¨ç¨‹åºï¼ˆnAddr:nPortï¼‰ï¼Œå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œæ‰èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. ä¸ Address-Restricted cone NAT çš„åŒºåˆ«åœ¨äºï¼Œå®ƒåŒæ—¶é™åˆ¶äº†å¤–éƒ¨ä¸»æœºçš„ IP ä¸ç«¯å£ï¼Œå¯ä»¥è¯´æ˜¯æ›´è¿›ä¸€æ­¥åœ°æå‡äº†å®‰å…¨æ€§ã€‚ 4. Symmetric NAT æ•°æ®åŒ…æµå‡ºï¼šåŒä¸€ä¸ªå†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸ä¸åŒå¤–éƒ¨ä¸»æœºï¼ˆnAddr:nPortï¼‰çš„é€šä¿¡ï¼Œä¼šéšæœºä½¿ç”¨ä¸åŒçš„ NAT å¤–éƒ¨ç«¯å£ï¼ˆeAddr:randomPortï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´å†…éƒ¨åœ°å€ä¸ NAT å¤–éƒ¨åœ°å€çš„å…³ç³»ä¹Ÿæ˜¯ä¸€å¯¹å¤šï¼ ä¸ºæ¯ä¸ªè¿æ¥éƒ½éšæœºé€‰æ‹©ä¸€ä¸ªä¸åŒçš„ NAT ç«¯å£ï¼Œè¿™å®é™…æ˜¯è¿›ä¸€æ­¥å¼ºåŒ–äº† NAT å†…ç½‘çš„å®‰å…¨æ€§ã€‚ä½†è¿™ä¹Ÿæ˜¯ NAT ç©¿è¶Šæœ€å¤§çš„éš¾ç‚¹â€”â€”å®ƒå¯¼è‡´ Symmetric NAT çš„ç«¯å£éš¾ä»¥é¢„æµ‹ï¼ æ•°æ®åŒ…æµå…¥ï¼šåªæœ‰å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸»åŠ¨è¿æ¥è¿‡çš„å¤–éƒ¨ç¨‹åºï¼ˆnAddr:nPortï¼‰ï¼Œå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œæ‰èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. è¿™ä¸ªæ•°æ®æµå…¥è§„åˆ™ï¼Œä¸ Port-Restricted cone NAT æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚ å¯¹ç§° NAT æ˜¯æœ€å®‰å…¨çš„ä¸€ç§ NAT ç»“æ„ï¼Œé™åˆ¶æœ€ä¸ºä¸¥æ ¼ï¼Œåº”è¯¥ä¹Ÿæ˜¯åº”ç”¨æœ€å¹¿æ³›çš„ NAT ç»“æ„ã€‚ä½†æ˜¯å®ƒå¯¼è‡´æ‰€æœ‰çš„ TCP è¿æ¥éƒ½åªèƒ½ç”±ä»å†…éƒ¨ä¸»åŠ¨å‘èµ·ï¼Œå¤–éƒ¨å‘èµ·çš„ TCP è¿æ¥è¯·æ±‚ä¼šç›´æ¥è¢« NAT æ‹’ç»ï¼Œå› æ­¤å®ƒä¹Ÿæ˜¯ P2P ç©å®¶æœ€å¤´ç–¼çš„ä¸€ç§ NAT ç±»å‹ã€‚è§£å†³æ–¹æ¡ˆæ˜¯é€šè¿‡ UDP è¿‚å›å®ç°è¿æ¥çš„å»ºç«‹ï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚ 5. Linux ä¸­çš„ NAPTLinux çš„ç½‘ç»œæ ˆä¸­ï¼Œå¯é€šè¿‡ iptables/netfilter çš„ SNAT/MASQUERADE å®ç° NAPT ç½‘å…³ï¼Œè¿™ç§æ–¹å¼åªèƒ½å®ç°ä¸€ä¸ª Symmetric NAT. ä¹Ÿå°±æ˜¯è¯´ç»å¤§å¤šæ•°åŸºäº Linux å®ç°çš„å®¶åº­å±€åŸŸç½‘ã€Docker è™šæ‹Ÿç½‘ç»œã€Kubernetes è™šæ‹Ÿç½‘ç»œã€äº‘æœåŠ¡çš„è™šæ‹Ÿç½‘ç»œï¼Œéƒ½æ˜¯ Symmetric NAT. åªæœ‰ä¸€äº›æœ‰ Full-cone NAT éœ€æ±‚çš„ç½‘å§ã€ISP çš„ LSN(Large Scale NAT) ç½‘å…³ç­‰ç»„ç»‡ï¼Œä¼šä½¿ç”¨é Linux å†…æ ¸çš„ä¼ä¸šçº§è·¯ç”±å™¨æä¾› Full-cone NAT èƒ½åŠ›ï¼Œè¿™äº›è®¾å¤‡å¯èƒ½æ˜¯åŸºäº FPGA ç­‰ä¸“ç”¨èŠ¯ç‰‡è®¾è®¡çš„ã€‚ æƒ³è¦å°† Symmetric NAT å†…çš„ä¸»æœºæä¾›ç»™å¤–éƒ¨è®¿é—®ï¼Œåªèƒ½é€šè¿‡ç«¯å£æ˜ å°„ã€ä¸€å¯¹ä¸€ NAT ç­‰æ–¹å¼å®ç°ï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»è¿™äº›æ–¹æ³•ã€‚ RFC5389 å®šä¹‰çš„ NAT ç±»å‹ï¼ˆä¹ç§ï¼‰RFC3489 è¿™ä¸ªæ—©æœŸ RFC å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œé—®é¢˜ä¹‹ä¸€å°±æ˜¯å®ƒå¯¹ NAT å½’ç±»è¿‡äºç¬¼ç»Ÿï¼Œå¾ˆå¤š NAPT ç½‘å…³éƒ½æ— æ³•å¾ˆå¥½çš„åŒ¹é…ä¸Šå…¶ä¸­æŸä¸ªç±»åˆ«ã€‚ äºæ˜¯åæ¥ï¼ŒRFC3489 è¢«åºŸå¼ƒå¹¶ç”± RFC5389 æ¥æ›¿ä»£ï¼Œåœ¨ RFC5389 ä¸­ï¼Œå°† Mapping Behaviorï¼ˆæ˜ å°„è§„åˆ™ï¼‰å’Œ Filtering Behaviorï¼ˆè¿‡æ»¤è§„åˆ™ï¼‰åˆ†å¼€æ¥ï¼Œå®šä¹‰äº† 3 ç§ Mapping Behaviorï¼ˆæ˜ å°„è§„åˆ™ï¼‰å’Œ 3 ç§ Filtering Behaviorï¼ˆè¿‡æ»¤è§„åˆ™ï¼‰ï¼Œä¸€å…±æœ‰ 9 ç§ç»„åˆã€‚ 1. æ˜ å°„è§„åˆ™ä¸‰ç§æ˜ å°„è§„åˆ™å¦‚å›¾æ‰€ç¤ºï¼Œå‡è®¾ä¸€ä¸ªå†…ç½‘ä¸»æœº HostX çš„å†…ç½‘ IP åœ°å€ä¸º Xï¼Œç«¯å£å·ä¸º xï¼Œç» NAT æ˜ å°„åçš„å¤–ç½‘ IP åœ°å€ä¸º Mï¼Œç«¯å£å·ä¸º mã€‚ä¸ºæ–¹ä¾¿æè¿°ï¼Œå°†å†…ç½‘çš„ Endpoint è®°ä¸º Endpoint(X,x)ï¼Œæ˜ å°„åå¤–ç½‘çš„ Endpoint è®°ä¸º Endpoint(M,m)ã€‚å†…ç½‘ Endpoint(X,x) å‘å¾€å¤–ç½‘ HostD1 çš„ IP åœ°å€å’Œç«¯å£å·è®°ä¸ºç›®çš„ Endpoint(D1,d1)ï¼›å‘å¾€å¤–ç½‘ HostD2 çš„ IP åœ°å€å’Œç«¯å£å·è®°ä¸ºç›®çš„Endpoint(D2,d2)ã€‚ NAT æ˜ å°„è§„åˆ™ EIM(Endpoint-Independent Mapping) å¤–éƒ¨åœ°å€æ— å…³æ˜ å°„ å¯¹äºä¸€ä¸ªå†…ç½‘ Endpoint(X,x)ï¼Œå…¶æ˜ å°„çš„å¤–ç½‘ Endpoint(M,m) æ˜¯å›ºå®šçš„ã€‚å³ä»ç›¸åŒçš„Endpoint(X,x) å‘é€åˆ°ä»»ä½•å¤–éƒ¨ IP åœ°å€å’Œä»»ä½•å¤–éƒ¨ç«¯å£çš„æŠ¥æ–‡åœ¨ NAT è®¾å¤‡ä¸Šä½¿ç”¨ç›¸åŒçš„æ˜ å°„ã€‚ ADM(Address-Dependent Mapping) å¤–éƒ¨åœ°å€ç›¸å…³æ˜ å°„ï¼šå¯¹äºä¸€ä¸ªå†…ç½‘ Endpoint(X,x)ï¼Œå‘å¾€ç›®çš„ Endpoint(D1,d1) çš„æŠ¥æ–‡ï¼ŒEndpoint(X,x) è¢«æ˜ å°„æˆ Endpoint(M1,m1)ï¼›å‘å¾€ç›®çš„Endpoint(D2,d2) çš„æŠ¥æ–‡ï¼ŒEndpoint(X,x) è¢«æ˜ å°„æˆ Endpoint(M2,m2)ã€‚åªè¦D1=D2ï¼Œä¸ç®¡d1 å’Œd2æ˜¯å¤šå°‘ï¼Œéƒ½æœ‰ Endpoint(M1,m1)=Endpoint(M2,m2)ã€‚å³ä»ç›¸åŒçš„ Endpoint(X,x) å‘é€åˆ°ç›¸åŒå¤–éƒ¨ IP åœ°å€å’Œä»»ä½•å¤–éƒ¨ç«¯å£çš„æŠ¥æ–‡åœ¨ NAT è®¾å¤‡ä¸Šä½¿ç”¨ç›¸åŒçš„æ˜ å°„ã€‚ APDMï¼ˆAddress and Port-Dependent Mappingï¼‰å¤–éƒ¨åœ°å€å’Œç«¯å£ç›¸å…³æ˜ å°„ï¼šå¯¹äºä¸€ä¸ªå†…ç½‘Endpoint(X,x)ï¼Œå‘å¾€ç›®çš„ Endpoint(D1,d1) çš„æŠ¥æ–‡ï¼ŒEndpoint(X,x) è¢«æ˜ å°„æˆEndpoint(M1,m1)ï¼›å‘å¾€ç›®çš„ Endpoint(D2,d2) çš„æŠ¥æ–‡ï¼Œ Endpoint(X,x) è¢«æ˜ å°„æˆEndpoint(M2,m2)ã€‚åªæœ‰å½“D1=D2ï¼Œä¸”d1=d2ï¼Œæ‰æœ‰ Endpoint(M1,m1)=Endpoint(M2,m2)ã€‚å³ä»ç›¸åŒçš„ Endpoint(X,x) å‘é€åˆ°ç›¸åŒå¤–éƒ¨IPåœ°å€å’Œç›¸åŒå¤–éƒ¨ç«¯å£çš„æŠ¥æ–‡åœ¨NATè®¾å¤‡ä¸Šä½¿ç”¨ç›¸åŒçš„æ˜ å°„ã€‚ 2. è¿‡æ»¤è§„åˆ™ NAT è¿‡æ»¤è§„åˆ™ EIFï¼ˆEndpoint-Independent Filteringï¼‰å¤–éƒ¨åœ°å€æ— å…³è¿‡æ»¤ï¼šå¯¹äºä¸€ä¸ªå†…ç½‘Endpoint(X,x)ï¼Œåªè¦å®ƒæ›¾ç»å‘å¤–ç½‘å‘é€è¿‡æ•°æ®ï¼Œå¤–ç½‘ä¸»æœºå°±å¯ä»¥è·å–åˆ°å®ƒç» NAT æ˜ å°„åçš„å¤–ç½‘Endpoint(M,m) ã€‚é‚£ä¹ˆåªè¦æ˜¯å‘ç»™ Endpoint(M,m) çš„æŠ¥æ–‡ï¼Œä¸ç®¡æ¥æºäº D1 è¿˜æ˜¯ D2ï¼Œéƒ½èƒ½è¢«è½¬æ¢å¹¶å‘å¾€å†…ç½‘ï¼Œå…¶ä»–æŠ¥æ–‡è¢«è¿‡æ»¤æ‰ã€‚ ADFï¼ˆAddr","date":"2022-05-13","objectID":"/posts/about-nat/:3:2","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["NAT","ç½‘ç»œ","NAT ç©¿è¶Š","å†…ç½‘ç©¿é€","è™šæ‹Ÿç½‘ç»œ","P2P","WebRTC"],"title":"NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ","uri":"/posts/about-nat/#rfc5389-å®šä¹‰çš„-nat-ç±»å‹ä¹ç§"},{"categories":["tech"],"content":" 2. ä¸€å¯¹å¤š NAT - NAPTä¸€å¯¹å¤š NATï¼Œä¹Ÿè¢«ç§°ä¸º NAPTï¼ˆnetwork address and port translationï¼‰ï¼ŒåŒæ ·åœ¨RFC2663 ä¸­è¢«å®šä¹‰ã€‚Easy IP æ˜¯ NAPT çš„ä¸€ä¸ªç‰¹æ®Šå½¢å¼ã€‚ NAPT çš„ä¸»è¦åº”ç”¨åœºæ™¯æ˜¯ï¼Œå†…ç½‘ç”¨æˆ·éœ€è¦è®¿é—®åˆ°å…¬ç½‘ä¸»æœºã€‚ç»å¤§å¤šæ•°çš„å®¶åº­ç½‘ç»œã€åŠå…¬ç½‘ç»œéƒ½æ˜¯ NAPT ç±»å‹çš„ã€‚åŸå› åº”è¯¥å¾ˆå¥½ç†è§£â€”â€”å®¶åº­ç½‘ç»œæˆ–åŠå…¬ç½‘ç»œéƒ½åŒ…å«è®¸å¤šè”ç½‘è®¾å¤‡ï¼Œä½†æ˜¯è¿™ç±»ç½‘ç»œé€šå¸¸åªæœ‰ä¸€ä¸ªæˆ–æ•°ä¸ªå…¬ç½‘ IPï¼Œä½¿ç”¨ä¸€å¯¹ä¸€ NAT çš„è¯å…¬ç½‘ IP æ˜¾ç„¶æ˜¯ä¸å¤Ÿç”¨çš„ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ä¸€å¯¹å¤š NAT. NAPT é€šè¿‡åŒæ—¶åˆ©ç”¨ L3 çš„ IP ä¿¡æ¯ï¼Œä»¥åŠ L4 ä¼ è¾“å±‚çš„ç«¯å£ä¿¡æ¯ï¼Œæ¥ä¸ºå±€åŸŸç½‘è®¾å¤‡æä¾›é€æ˜çš„ã€é…ç½®æ–¹ä¾¿çš„ã€æ”¯æŒè¶…é«˜å¹¶å‘è¿æ¥çš„å¤–éƒ¨ç½‘ç»œé€šä¿¡ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š NAPT çš„ç«¯å£åˆ†é…ä¸è½¬æ¢è§„åˆ™ï¼ˆMapping Behaviorï¼‰ä»¥åŠå¯¹å¤–æ¥æµé‡çš„è¿‡æ»¤è§„åˆ™ï¼ˆFiltering Behaviorï¼‰éƒ½å­˜åœ¨è®¸å¤šä¸åŒçš„å®ç°ï¼Œæ²¡æœ‰ç»Ÿä¸€çš„è§„èŒƒä¸æ ‡å‡†ï¼Œä½†æ˜¯å­˜åœ¨ä¸¤ç§åˆ†ç±»è§„èŒƒï¼Œè¿™ç§åˆ†ç±»æ–¹æ³•ä¸»è¦ç”¨åœ¨ NAT ç©¿è¶ŠæŠ€æœ¯ä¸­ã€‚ RFC3489 å®šä¹‰çš„ NAT ç±»å‹ï¼ˆå››ç§ï¼‰åœ¨ RFC3489 ä¸­å°† NAPT åˆ†ä¸ºå››ç§ç±»å‹ï¼Œè¿™ä¹Ÿæ˜¯åº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ NAT åˆ†ç±»æ–¹æ³•ï¼Œå¦‚ä¸‹å›¾ï¼š ä¸‹é¢æˆ‘ä»¬é€ä¸€ä»‹ç»è¿™å››ç§ä¸åŒçš„ NAPT ç±»å‹ã€‚ ä»è¿™é‡Œå¼€å§‹ï¼Œä¸‹æ–‡ä¸­çš„ NAT ç‰¹æŒ‡ NAPTï¼Œå¦‚æœæ¶‰åŠã€Œä¸€å¯¹ä¸€ NATã€ä¼šä½¿ç”¨å®ƒçš„å…¨åã€‚ 1. Full-cone NATFull-cone NAT çš„ç‰¹ç‚¹å¦‚ä¸‹ï¼š æ•°æ®åŒ…æµå‡ºï¼šä¸€æ—¦å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰æ˜ å°„åˆ°å¤–éƒ¨åœ°å€ï¼ˆeAddr:ePortï¼‰ï¼Œæ‰€æœ‰å‘è‡ª iAddr:iPort çš„æ•°æ®åŒ…éƒ½ç»ç”± eAddr:ePort å‘å¤–å‘é€ã€‚ æ•°æ®åŒ…æµå…¥ï¼šä»»æ„ä¸»æœºå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œéƒ½èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. ä¹Ÿå°±æ˜¯ä¸å¯¹å¤–éƒ¨è¿›æ¥çš„æ•°æ®åšä»»ä½•é™åˆ¶ï¼Œå…¨éƒ¨æ”¾è¡Œã€‚ cone åœ†é”¥ï¼Œä¸ªäººç†è§£æ˜¯ä¸€ä¸ªæ¯”å–»ï¼Œä»»æ„å‘é€è¿›æ¥çš„æ•°æ®ï¼ˆå¤šï¼‰ï¼Œéƒ½èƒ½é€šè¿‡ NAT åˆ°è¾¾è¿™ä¸ªå†…éƒ¨åœ°å€ ï¼ˆä¸€ï¼‰ï¼Œå°±åƒä¸€ä¸ªåœ†é”¥ã€‚ å…è®¸ä»»æ„ä¸»æœºå‘é€åˆ° eAddr:ePort çš„æ•°æ®åˆ°è¾¾å†…éƒ¨åœ°å€æ˜¯å¾ˆå±é™©çš„è¡Œä¸ºï¼Œå› ä¸ºå†…éƒ¨ä¸»æœºä¸ä¸€å®šé…ç½®äº†åˆé€‚çš„å®‰å…¨ç­–ç•¥ã€‚å› æ­¤ Full-cone NAT æ¯”è¾ƒå°‘è§ï¼Œå°±ç®—è·¯ç”±å™¨ç­‰ NAT è®¾å¤‡æ”¯æŒ Full-cone NATï¼Œ é€šå¸¸ä¹Ÿä¸ä¼šæ˜¯é»˜è®¤é€‰é¡¹ã€‚æˆ‘ä»¬ä¼šåœ¨åé¢æ›´è¯¦ç»†åœ°ä»‹ç»å®ƒã€‚ 2. (Address-)Restricted cone NAT æ•°æ®åŒ…æµå‡ºï¼šï¼ˆè·Ÿ Full-cone NAT å®Œå…¨ä¸€è‡´ï¼‰ä¸€æ—¦å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰æ˜ å°„åˆ°å¤–éƒ¨åœ°å€ ï¼ˆeAddr:ePortï¼‰ï¼Œæ‰€æœ‰å‘è‡ª iAddr:iPort çš„æ•°æ®åŒ…éƒ½ç»ç”± eAddr:ePort å‘å¤–å‘é€ã€‚ æ•°æ®åŒ…æµå…¥ï¼šåªæœ‰å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸»åŠ¨è¿æ¥è¿‡çš„å¤–éƒ¨ä¸»æœºï¼ˆnAddr:anyï¼‰ï¼Œå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œæ‰èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. è·Ÿ Full-cone NAT çš„åŒºåˆ«åœ¨äºï¼Œå®ƒé™åˆ¶äº†å¤–éƒ¨ä¸»æœºçš„ IP åœ°å€ã€‚åªæœ‰ä¸»åŠ¨è¿æ¥è¿‡çš„ä¸»æœºï¼Œæ‰èƒ½å‘é€æ•°æ®åˆ° NAT å†…éƒ¨ã€‚è¿™æå‡äº†ä¸€äº›å®‰å…¨æ€§ã€‚ 3. Port-Restricted cone NAT æ•°æ®åŒ…æµå‡ºï¼šï¼ˆè·Ÿ Full-cone NAT å®Œå…¨ä¸€è‡´ï¼‰ä¸€æ—¦å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰æ˜ å°„åˆ°å¤–éƒ¨åœ°å€ ï¼ˆeAddr:ePortï¼‰ï¼Œæ‰€æœ‰å‘è‡ª iAddr:iPort çš„æ•°æ®åŒ…éƒ½ç»ç”± eAddr:ePort å‘å¤–å‘é€ã€‚ æ•°æ®åŒ…æµå…¥ï¼šåªæœ‰å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸»åŠ¨è¿æ¥è¿‡çš„å¤–éƒ¨ç¨‹åºï¼ˆnAddr:nPortï¼‰ï¼Œå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œæ‰èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. ä¸ Address-Restricted cone NAT çš„åŒºåˆ«åœ¨äºï¼Œå®ƒåŒæ—¶é™åˆ¶äº†å¤–éƒ¨ä¸»æœºçš„ IP ä¸ç«¯å£ï¼Œå¯ä»¥è¯´æ˜¯æ›´è¿›ä¸€æ­¥åœ°æå‡äº†å®‰å…¨æ€§ã€‚ 4. Symmetric NAT æ•°æ®åŒ…æµå‡ºï¼šåŒä¸€ä¸ªå†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸ä¸åŒå¤–éƒ¨ä¸»æœºï¼ˆnAddr:nPortï¼‰çš„é€šä¿¡ï¼Œä¼šéšæœºä½¿ç”¨ä¸åŒçš„ NAT å¤–éƒ¨ç«¯å£ï¼ˆeAddr:randomPortï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´å†…éƒ¨åœ°å€ä¸ NAT å¤–éƒ¨åœ°å€çš„å…³ç³»ä¹Ÿæ˜¯ä¸€å¯¹å¤šï¼ ä¸ºæ¯ä¸ªè¿æ¥éƒ½éšæœºé€‰æ‹©ä¸€ä¸ªä¸åŒçš„ NAT ç«¯å£ï¼Œè¿™å®é™…æ˜¯è¿›ä¸€æ­¥å¼ºåŒ–äº† NAT å†…ç½‘çš„å®‰å…¨æ€§ã€‚ä½†è¿™ä¹Ÿæ˜¯ NAT ç©¿è¶Šæœ€å¤§çš„éš¾ç‚¹â€”â€”å®ƒå¯¼è‡´ Symmetric NAT çš„ç«¯å£éš¾ä»¥é¢„æµ‹ï¼ æ•°æ®åŒ…æµå…¥ï¼šåªæœ‰å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸»åŠ¨è¿æ¥è¿‡çš„å¤–éƒ¨ç¨‹åºï¼ˆnAddr:nPortï¼‰ï¼Œå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œæ‰èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. è¿™ä¸ªæ•°æ®æµå…¥è§„åˆ™ï¼Œä¸ Port-Restricted cone NAT æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚ å¯¹ç§° NAT æ˜¯æœ€å®‰å…¨çš„ä¸€ç§ NAT ç»“æ„ï¼Œé™åˆ¶æœ€ä¸ºä¸¥æ ¼ï¼Œåº”è¯¥ä¹Ÿæ˜¯åº”ç”¨æœ€å¹¿æ³›çš„ NAT ç»“æ„ã€‚ä½†æ˜¯å®ƒå¯¼è‡´æ‰€æœ‰çš„ TCP è¿æ¥éƒ½åªèƒ½ç”±ä»å†…éƒ¨ä¸»åŠ¨å‘èµ·ï¼Œå¤–éƒ¨å‘èµ·çš„ TCP è¿æ¥è¯·æ±‚ä¼šç›´æ¥è¢« NAT æ‹’ç»ï¼Œå› æ­¤å®ƒä¹Ÿæ˜¯ P2P ç©å®¶æœ€å¤´ç–¼çš„ä¸€ç§ NAT ç±»å‹ã€‚è§£å†³æ–¹æ¡ˆæ˜¯é€šè¿‡ UDP è¿‚å›å®ç°è¿æ¥çš„å»ºç«‹ï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚ 5. Linux ä¸­çš„ NAPTLinux çš„ç½‘ç»œæ ˆä¸­ï¼Œå¯é€šè¿‡ iptables/netfilter çš„ SNAT/MASQUERADE å®ç° NAPT ç½‘å…³ï¼Œè¿™ç§æ–¹å¼åªèƒ½å®ç°ä¸€ä¸ª Symmetric NAT. ä¹Ÿå°±æ˜¯è¯´ç»å¤§å¤šæ•°åŸºäº Linux å®ç°çš„å®¶åº­å±€åŸŸç½‘ã€Docker è™šæ‹Ÿç½‘ç»œã€Kubernetes è™šæ‹Ÿç½‘ç»œã€äº‘æœåŠ¡çš„è™šæ‹Ÿç½‘ç»œï¼Œéƒ½æ˜¯ Symmetric NAT. åªæœ‰ä¸€äº›æœ‰ Full-cone NAT éœ€æ±‚çš„ç½‘å§ã€ISP çš„ LSN(Large Scale NAT) ç½‘å…³ç­‰ç»„ç»‡ï¼Œä¼šä½¿ç”¨é Linux å†…æ ¸çš„ä¼ä¸šçº§è·¯ç”±å™¨æä¾› Full-cone NAT èƒ½åŠ›ï¼Œè¿™äº›è®¾å¤‡å¯èƒ½æ˜¯åŸºäº FPGA ç­‰ä¸“ç”¨èŠ¯ç‰‡è®¾è®¡çš„ã€‚ æƒ³è¦å°† Symmetric NAT å†…çš„ä¸»æœºæä¾›ç»™å¤–éƒ¨è®¿é—®ï¼Œåªèƒ½é€šè¿‡ç«¯å£æ˜ å°„ã€ä¸€å¯¹ä¸€ NAT ç­‰æ–¹å¼å®ç°ï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»è¿™äº›æ–¹æ³•ã€‚ RFC5389 å®šä¹‰çš„ NAT ç±»å‹ï¼ˆä¹ç§ï¼‰RFC3489 è¿™ä¸ªæ—©æœŸ RFC å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œé—®é¢˜ä¹‹ä¸€å°±æ˜¯å®ƒå¯¹ NAT å½’ç±»è¿‡äºç¬¼ç»Ÿï¼Œå¾ˆå¤š NAPT ç½‘å…³éƒ½æ— æ³•å¾ˆå¥½çš„åŒ¹é…ä¸Šå…¶ä¸­æŸä¸ªç±»åˆ«ã€‚ äºæ˜¯åæ¥ï¼ŒRFC3489 è¢«åºŸå¼ƒå¹¶ç”± RFC5389 æ¥æ›¿ä»£ï¼Œåœ¨ RFC5389 ä¸­ï¼Œå°† Mapping Behaviorï¼ˆæ˜ å°„è§„åˆ™ï¼‰å’Œ Filtering Behaviorï¼ˆè¿‡æ»¤è§„åˆ™ï¼‰åˆ†å¼€æ¥ï¼Œå®šä¹‰äº† 3 ç§ Mapping Behaviorï¼ˆæ˜ å°„è§„åˆ™ï¼‰å’Œ 3 ç§ Filtering Behaviorï¼ˆè¿‡æ»¤è§„åˆ™ï¼‰ï¼Œä¸€å…±æœ‰ 9 ç§ç»„åˆã€‚ 1. æ˜ å°„è§„åˆ™ä¸‰ç§æ˜ å°„è§„åˆ™å¦‚å›¾æ‰€ç¤ºï¼Œå‡è®¾ä¸€ä¸ªå†…ç½‘ä¸»æœº HostX çš„å†…ç½‘ IP åœ°å€ä¸º Xï¼Œç«¯å£å·ä¸º xï¼Œç» NAT æ˜ å°„åçš„å¤–ç½‘ IP åœ°å€ä¸º Mï¼Œç«¯å£å·ä¸º mã€‚ä¸ºæ–¹ä¾¿æè¿°ï¼Œå°†å†…ç½‘çš„ Endpoint è®°ä¸º Endpoint(X,x)ï¼Œæ˜ å°„åå¤–ç½‘çš„ Endpoint è®°ä¸º Endpoint(M,m)ã€‚å†…ç½‘ Endpoint(X,x) å‘å¾€å¤–ç½‘ HostD1 çš„ IP åœ°å€å’Œç«¯å£å·è®°ä¸ºç›®çš„ Endpoint(D1,d1)ï¼›å‘å¾€å¤–ç½‘ HostD2 çš„ IP åœ°å€å’Œç«¯å£å·è®°ä¸ºç›®çš„Endpoint(D2,d2)ã€‚ NAT æ˜ å°„è§„åˆ™ EIM(Endpoint-Independent Mapping) å¤–éƒ¨åœ°å€æ— å…³æ˜ å°„ å¯¹äºä¸€ä¸ªå†…ç½‘ Endpoint(X,x)ï¼Œå…¶æ˜ å°„çš„å¤–ç½‘ Endpoint(M,m) æ˜¯å›ºå®šçš„ã€‚å³ä»ç›¸åŒçš„Endpoint(X,x) å‘é€åˆ°ä»»ä½•å¤–éƒ¨ IP åœ°å€å’Œä»»ä½•å¤–éƒ¨ç«¯å£çš„æŠ¥æ–‡åœ¨ NAT è®¾å¤‡ä¸Šä½¿ç”¨ç›¸åŒçš„æ˜ å°„ã€‚ ADM(Address-Dependent Mapping) å¤–éƒ¨åœ°å€ç›¸å…³æ˜ å°„ï¼šå¯¹äºä¸€ä¸ªå†…ç½‘ Endpoint(X,x)ï¼Œå‘å¾€ç›®çš„ Endpoint(D1,d1) çš„æŠ¥æ–‡ï¼ŒEndpoint(X,x) è¢«æ˜ å°„æˆ Endpoint(M1,m1)ï¼›å‘å¾€ç›®çš„Endpoint(D2,d2) çš„æŠ¥æ–‡ï¼ŒEndpoint(X,x) è¢«æ˜ å°„æˆ Endpoint(M2,m2)ã€‚åªè¦D1=D2ï¼Œä¸ç®¡d1 å’Œd2æ˜¯å¤šå°‘ï¼Œéƒ½æœ‰ Endpoint(M1,m1)=Endpoint(M2,m2)ã€‚å³ä»ç›¸åŒçš„ Endpoint(X,x) å‘é€åˆ°ç›¸åŒå¤–éƒ¨ IP åœ°å€å’Œä»»ä½•å¤–éƒ¨ç«¯å£çš„æŠ¥æ–‡åœ¨ NAT è®¾å¤‡ä¸Šä½¿ç”¨ç›¸åŒçš„æ˜ å°„ã€‚ APDMï¼ˆAddress and Port-Dependent Mappingï¼‰å¤–éƒ¨åœ°å€å’Œç«¯å£ç›¸å…³æ˜ å°„ï¼šå¯¹äºä¸€ä¸ªå†…ç½‘Endpoint(X,x)ï¼Œå‘å¾€ç›®çš„ Endpoint(D1,d1) çš„æŠ¥æ–‡ï¼ŒEndpoint(X,x) è¢«æ˜ å°„æˆEndpoint(M1,m1)ï¼›å‘å¾€ç›®çš„ Endpoint(D2,d2) çš„æŠ¥æ–‡ï¼Œ Endpoint(X,x) è¢«æ˜ å°„æˆEndpoint(M2,m2)ã€‚åªæœ‰å½“D1=D2ï¼Œä¸”d1=d2ï¼Œæ‰æœ‰ Endpoint(M1,m1)=Endpoint(M2,m2)ã€‚å³ä»ç›¸åŒçš„ Endpoint(X,x) å‘é€åˆ°ç›¸åŒå¤–éƒ¨IPåœ°å€å’Œç›¸åŒå¤–éƒ¨ç«¯å£çš„æŠ¥æ–‡åœ¨NATè®¾å¤‡ä¸Šä½¿ç”¨ç›¸åŒçš„æ˜ å°„ã€‚ 2. è¿‡æ»¤è§„åˆ™ NAT è¿‡æ»¤è§„åˆ™ EIFï¼ˆEndpoint-Independent Filteringï¼‰å¤–éƒ¨åœ°å€æ— å…³è¿‡æ»¤ï¼šå¯¹äºä¸€ä¸ªå†…ç½‘Endpoint(X,x)ï¼Œåªè¦å®ƒæ›¾ç»å‘å¤–ç½‘å‘é€è¿‡æ•°æ®ï¼Œå¤–ç½‘ä¸»æœºå°±å¯ä»¥è·å–åˆ°å®ƒç» NAT æ˜ å°„åçš„å¤–ç½‘Endpoint(M,m) ã€‚é‚£ä¹ˆåªè¦æ˜¯å‘ç»™ Endpoint(M,m) çš„æŠ¥æ–‡ï¼Œä¸ç®¡æ¥æºäº D1 è¿˜æ˜¯ D2ï¼Œéƒ½èƒ½è¢«è½¬æ¢å¹¶å‘å¾€å†…ç½‘ï¼Œå…¶ä»–æŠ¥æ–‡è¢«è¿‡æ»¤æ‰ã€‚ ADFï¼ˆAddr","date":"2022-05-13","objectID":"/posts/about-nat/:3:2","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["NAT","ç½‘ç»œ","NAT ç©¿è¶Š","å†…ç½‘ç©¿é€","è™šæ‹Ÿç½‘ç»œ","P2P","WebRTC"],"title":"NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ","uri":"/posts/about-nat/#1-æ˜ å°„è§„åˆ™"},{"categories":["tech"],"content":" 2. ä¸€å¯¹å¤š NAT - NAPTä¸€å¯¹å¤š NATï¼Œä¹Ÿè¢«ç§°ä¸º NAPTï¼ˆnetwork address and port translationï¼‰ï¼ŒåŒæ ·åœ¨RFC2663 ä¸­è¢«å®šä¹‰ã€‚Easy IP æ˜¯ NAPT çš„ä¸€ä¸ªç‰¹æ®Šå½¢å¼ã€‚ NAPT çš„ä¸»è¦åº”ç”¨åœºæ™¯æ˜¯ï¼Œå†…ç½‘ç”¨æˆ·éœ€è¦è®¿é—®åˆ°å…¬ç½‘ä¸»æœºã€‚ç»å¤§å¤šæ•°çš„å®¶åº­ç½‘ç»œã€åŠå…¬ç½‘ç»œéƒ½æ˜¯ NAPT ç±»å‹çš„ã€‚åŸå› åº”è¯¥å¾ˆå¥½ç†è§£â€”â€”å®¶åº­ç½‘ç»œæˆ–åŠå…¬ç½‘ç»œéƒ½åŒ…å«è®¸å¤šè”ç½‘è®¾å¤‡ï¼Œä½†æ˜¯è¿™ç±»ç½‘ç»œé€šå¸¸åªæœ‰ä¸€ä¸ªæˆ–æ•°ä¸ªå…¬ç½‘ IPï¼Œä½¿ç”¨ä¸€å¯¹ä¸€ NAT çš„è¯å…¬ç½‘ IP æ˜¾ç„¶æ˜¯ä¸å¤Ÿç”¨çš„ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ä¸€å¯¹å¤š NAT. NAPT é€šè¿‡åŒæ—¶åˆ©ç”¨ L3 çš„ IP ä¿¡æ¯ï¼Œä»¥åŠ L4 ä¼ è¾“å±‚çš„ç«¯å£ä¿¡æ¯ï¼Œæ¥ä¸ºå±€åŸŸç½‘è®¾å¤‡æä¾›é€æ˜çš„ã€é…ç½®æ–¹ä¾¿çš„ã€æ”¯æŒè¶…é«˜å¹¶å‘è¿æ¥çš„å¤–éƒ¨ç½‘ç»œé€šä¿¡ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š NAPT çš„ç«¯å£åˆ†é…ä¸è½¬æ¢è§„åˆ™ï¼ˆMapping Behaviorï¼‰ä»¥åŠå¯¹å¤–æ¥æµé‡çš„è¿‡æ»¤è§„åˆ™ï¼ˆFiltering Behaviorï¼‰éƒ½å­˜åœ¨è®¸å¤šä¸åŒçš„å®ç°ï¼Œæ²¡æœ‰ç»Ÿä¸€çš„è§„èŒƒä¸æ ‡å‡†ï¼Œä½†æ˜¯å­˜åœ¨ä¸¤ç§åˆ†ç±»è§„èŒƒï¼Œè¿™ç§åˆ†ç±»æ–¹æ³•ä¸»è¦ç”¨åœ¨ NAT ç©¿è¶ŠæŠ€æœ¯ä¸­ã€‚ RFC3489 å®šä¹‰çš„ NAT ç±»å‹ï¼ˆå››ç§ï¼‰åœ¨ RFC3489 ä¸­å°† NAPT åˆ†ä¸ºå››ç§ç±»å‹ï¼Œè¿™ä¹Ÿæ˜¯åº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ NAT åˆ†ç±»æ–¹æ³•ï¼Œå¦‚ä¸‹å›¾ï¼š ä¸‹é¢æˆ‘ä»¬é€ä¸€ä»‹ç»è¿™å››ç§ä¸åŒçš„ NAPT ç±»å‹ã€‚ ä»è¿™é‡Œå¼€å§‹ï¼Œä¸‹æ–‡ä¸­çš„ NAT ç‰¹æŒ‡ NAPTï¼Œå¦‚æœæ¶‰åŠã€Œä¸€å¯¹ä¸€ NATã€ä¼šä½¿ç”¨å®ƒçš„å…¨åã€‚ 1. Full-cone NATFull-cone NAT çš„ç‰¹ç‚¹å¦‚ä¸‹ï¼š æ•°æ®åŒ…æµå‡ºï¼šä¸€æ—¦å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰æ˜ å°„åˆ°å¤–éƒ¨åœ°å€ï¼ˆeAddr:ePortï¼‰ï¼Œæ‰€æœ‰å‘è‡ª iAddr:iPort çš„æ•°æ®åŒ…éƒ½ç»ç”± eAddr:ePort å‘å¤–å‘é€ã€‚ æ•°æ®åŒ…æµå…¥ï¼šä»»æ„ä¸»æœºå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œéƒ½èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. ä¹Ÿå°±æ˜¯ä¸å¯¹å¤–éƒ¨è¿›æ¥çš„æ•°æ®åšä»»ä½•é™åˆ¶ï¼Œå…¨éƒ¨æ”¾è¡Œã€‚ cone åœ†é”¥ï¼Œä¸ªäººç†è§£æ˜¯ä¸€ä¸ªæ¯”å–»ï¼Œä»»æ„å‘é€è¿›æ¥çš„æ•°æ®ï¼ˆå¤šï¼‰ï¼Œéƒ½èƒ½é€šè¿‡ NAT åˆ°è¾¾è¿™ä¸ªå†…éƒ¨åœ°å€ ï¼ˆä¸€ï¼‰ï¼Œå°±åƒä¸€ä¸ªåœ†é”¥ã€‚ å…è®¸ä»»æ„ä¸»æœºå‘é€åˆ° eAddr:ePort çš„æ•°æ®åˆ°è¾¾å†…éƒ¨åœ°å€æ˜¯å¾ˆå±é™©çš„è¡Œä¸ºï¼Œå› ä¸ºå†…éƒ¨ä¸»æœºä¸ä¸€å®šé…ç½®äº†åˆé€‚çš„å®‰å…¨ç­–ç•¥ã€‚å› æ­¤ Full-cone NAT æ¯”è¾ƒå°‘è§ï¼Œå°±ç®—è·¯ç”±å™¨ç­‰ NAT è®¾å¤‡æ”¯æŒ Full-cone NATï¼Œ é€šå¸¸ä¹Ÿä¸ä¼šæ˜¯é»˜è®¤é€‰é¡¹ã€‚æˆ‘ä»¬ä¼šåœ¨åé¢æ›´è¯¦ç»†åœ°ä»‹ç»å®ƒã€‚ 2. (Address-)Restricted cone NAT æ•°æ®åŒ…æµå‡ºï¼šï¼ˆè·Ÿ Full-cone NAT å®Œå…¨ä¸€è‡´ï¼‰ä¸€æ—¦å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰æ˜ å°„åˆ°å¤–éƒ¨åœ°å€ ï¼ˆeAddr:ePortï¼‰ï¼Œæ‰€æœ‰å‘è‡ª iAddr:iPort çš„æ•°æ®åŒ…éƒ½ç»ç”± eAddr:ePort å‘å¤–å‘é€ã€‚ æ•°æ®åŒ…æµå…¥ï¼šåªæœ‰å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸»åŠ¨è¿æ¥è¿‡çš„å¤–éƒ¨ä¸»æœºï¼ˆnAddr:anyï¼‰ï¼Œå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œæ‰èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. è·Ÿ Full-cone NAT çš„åŒºåˆ«åœ¨äºï¼Œå®ƒé™åˆ¶äº†å¤–éƒ¨ä¸»æœºçš„ IP åœ°å€ã€‚åªæœ‰ä¸»åŠ¨è¿æ¥è¿‡çš„ä¸»æœºï¼Œæ‰èƒ½å‘é€æ•°æ®åˆ° NAT å†…éƒ¨ã€‚è¿™æå‡äº†ä¸€äº›å®‰å…¨æ€§ã€‚ 3. Port-Restricted cone NAT æ•°æ®åŒ…æµå‡ºï¼šï¼ˆè·Ÿ Full-cone NAT å®Œå…¨ä¸€è‡´ï¼‰ä¸€æ—¦å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰æ˜ å°„åˆ°å¤–éƒ¨åœ°å€ ï¼ˆeAddr:ePortï¼‰ï¼Œæ‰€æœ‰å‘è‡ª iAddr:iPort çš„æ•°æ®åŒ…éƒ½ç»ç”± eAddr:ePort å‘å¤–å‘é€ã€‚ æ•°æ®åŒ…æµå…¥ï¼šåªæœ‰å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸»åŠ¨è¿æ¥è¿‡çš„å¤–éƒ¨ç¨‹åºï¼ˆnAddr:nPortï¼‰ï¼Œå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œæ‰èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. ä¸ Address-Restricted cone NAT çš„åŒºåˆ«åœ¨äºï¼Œå®ƒåŒæ—¶é™åˆ¶äº†å¤–éƒ¨ä¸»æœºçš„ IP ä¸ç«¯å£ï¼Œå¯ä»¥è¯´æ˜¯æ›´è¿›ä¸€æ­¥åœ°æå‡äº†å®‰å…¨æ€§ã€‚ 4. Symmetric NAT æ•°æ®åŒ…æµå‡ºï¼šåŒä¸€ä¸ªå†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸ä¸åŒå¤–éƒ¨ä¸»æœºï¼ˆnAddr:nPortï¼‰çš„é€šä¿¡ï¼Œä¼šéšæœºä½¿ç”¨ä¸åŒçš„ NAT å¤–éƒ¨ç«¯å£ï¼ˆeAddr:randomPortï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´å†…éƒ¨åœ°å€ä¸ NAT å¤–éƒ¨åœ°å€çš„å…³ç³»ä¹Ÿæ˜¯ä¸€å¯¹å¤šï¼ ä¸ºæ¯ä¸ªè¿æ¥éƒ½éšæœºé€‰æ‹©ä¸€ä¸ªä¸åŒçš„ NAT ç«¯å£ï¼Œè¿™å®é™…æ˜¯è¿›ä¸€æ­¥å¼ºåŒ–äº† NAT å†…ç½‘çš„å®‰å…¨æ€§ã€‚ä½†è¿™ä¹Ÿæ˜¯ NAT ç©¿è¶Šæœ€å¤§çš„éš¾ç‚¹â€”â€”å®ƒå¯¼è‡´ Symmetric NAT çš„ç«¯å£éš¾ä»¥é¢„æµ‹ï¼ æ•°æ®åŒ…æµå…¥ï¼šåªæœ‰å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸»åŠ¨è¿æ¥è¿‡çš„å¤–éƒ¨ç¨‹åºï¼ˆnAddr:nPortï¼‰ï¼Œå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œæ‰èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. è¿™ä¸ªæ•°æ®æµå…¥è§„åˆ™ï¼Œä¸ Port-Restricted cone NAT æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚ å¯¹ç§° NAT æ˜¯æœ€å®‰å…¨çš„ä¸€ç§ NAT ç»“æ„ï¼Œé™åˆ¶æœ€ä¸ºä¸¥æ ¼ï¼Œåº”è¯¥ä¹Ÿæ˜¯åº”ç”¨æœ€å¹¿æ³›çš„ NAT ç»“æ„ã€‚ä½†æ˜¯å®ƒå¯¼è‡´æ‰€æœ‰çš„ TCP è¿æ¥éƒ½åªèƒ½ç”±ä»å†…éƒ¨ä¸»åŠ¨å‘èµ·ï¼Œå¤–éƒ¨å‘èµ·çš„ TCP è¿æ¥è¯·æ±‚ä¼šç›´æ¥è¢« NAT æ‹’ç»ï¼Œå› æ­¤å®ƒä¹Ÿæ˜¯ P2P ç©å®¶æœ€å¤´ç–¼çš„ä¸€ç§ NAT ç±»å‹ã€‚è§£å†³æ–¹æ¡ˆæ˜¯é€šè¿‡ UDP è¿‚å›å®ç°è¿æ¥çš„å»ºç«‹ï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚ 5. Linux ä¸­çš„ NAPTLinux çš„ç½‘ç»œæ ˆä¸­ï¼Œå¯é€šè¿‡ iptables/netfilter çš„ SNAT/MASQUERADE å®ç° NAPT ç½‘å…³ï¼Œè¿™ç§æ–¹å¼åªèƒ½å®ç°ä¸€ä¸ª Symmetric NAT. ä¹Ÿå°±æ˜¯è¯´ç»å¤§å¤šæ•°åŸºäº Linux å®ç°çš„å®¶åº­å±€åŸŸç½‘ã€Docker è™šæ‹Ÿç½‘ç»œã€Kubernetes è™šæ‹Ÿç½‘ç»œã€äº‘æœåŠ¡çš„è™šæ‹Ÿç½‘ç»œï¼Œéƒ½æ˜¯ Symmetric NAT. åªæœ‰ä¸€äº›æœ‰ Full-cone NAT éœ€æ±‚çš„ç½‘å§ã€ISP çš„ LSN(Large Scale NAT) ç½‘å…³ç­‰ç»„ç»‡ï¼Œä¼šä½¿ç”¨é Linux å†…æ ¸çš„ä¼ä¸šçº§è·¯ç”±å™¨æä¾› Full-cone NAT èƒ½åŠ›ï¼Œè¿™äº›è®¾å¤‡å¯èƒ½æ˜¯åŸºäº FPGA ç­‰ä¸“ç”¨èŠ¯ç‰‡è®¾è®¡çš„ã€‚ æƒ³è¦å°† Symmetric NAT å†…çš„ä¸»æœºæä¾›ç»™å¤–éƒ¨è®¿é—®ï¼Œåªèƒ½é€šè¿‡ç«¯å£æ˜ å°„ã€ä¸€å¯¹ä¸€ NAT ç­‰æ–¹å¼å®ç°ï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»è¿™äº›æ–¹æ³•ã€‚ RFC5389 å®šä¹‰çš„ NAT ç±»å‹ï¼ˆä¹ç§ï¼‰RFC3489 è¿™ä¸ªæ—©æœŸ RFC å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œé—®é¢˜ä¹‹ä¸€å°±æ˜¯å®ƒå¯¹ NAT å½’ç±»è¿‡äºç¬¼ç»Ÿï¼Œå¾ˆå¤š NAPT ç½‘å…³éƒ½æ— æ³•å¾ˆå¥½çš„åŒ¹é…ä¸Šå…¶ä¸­æŸä¸ªç±»åˆ«ã€‚ äºæ˜¯åæ¥ï¼ŒRFC3489 è¢«åºŸå¼ƒå¹¶ç”± RFC5389 æ¥æ›¿ä»£ï¼Œåœ¨ RFC5389 ä¸­ï¼Œå°† Mapping Behaviorï¼ˆæ˜ å°„è§„åˆ™ï¼‰å’Œ Filtering Behaviorï¼ˆè¿‡æ»¤è§„åˆ™ï¼‰åˆ†å¼€æ¥ï¼Œå®šä¹‰äº† 3 ç§ Mapping Behaviorï¼ˆæ˜ å°„è§„åˆ™ï¼‰å’Œ 3 ç§ Filtering Behaviorï¼ˆè¿‡æ»¤è§„åˆ™ï¼‰ï¼Œä¸€å…±æœ‰ 9 ç§ç»„åˆã€‚ 1. æ˜ å°„è§„åˆ™ä¸‰ç§æ˜ å°„è§„åˆ™å¦‚å›¾æ‰€ç¤ºï¼Œå‡è®¾ä¸€ä¸ªå†…ç½‘ä¸»æœº HostX çš„å†…ç½‘ IP åœ°å€ä¸º Xï¼Œç«¯å£å·ä¸º xï¼Œç» NAT æ˜ å°„åçš„å¤–ç½‘ IP åœ°å€ä¸º Mï¼Œç«¯å£å·ä¸º mã€‚ä¸ºæ–¹ä¾¿æè¿°ï¼Œå°†å†…ç½‘çš„ Endpoint è®°ä¸º Endpoint(X,x)ï¼Œæ˜ å°„åå¤–ç½‘çš„ Endpoint è®°ä¸º Endpoint(M,m)ã€‚å†…ç½‘ Endpoint(X,x) å‘å¾€å¤–ç½‘ HostD1 çš„ IP åœ°å€å’Œç«¯å£å·è®°ä¸ºç›®çš„ Endpoint(D1,d1)ï¼›å‘å¾€å¤–ç½‘ HostD2 çš„ IP åœ°å€å’Œç«¯å£å·è®°ä¸ºç›®çš„Endpoint(D2,d2)ã€‚ NAT æ˜ å°„è§„åˆ™ EIM(Endpoint-Independent Mapping) å¤–éƒ¨åœ°å€æ— å…³æ˜ å°„ å¯¹äºä¸€ä¸ªå†…ç½‘ Endpoint(X,x)ï¼Œå…¶æ˜ å°„çš„å¤–ç½‘ Endpoint(M,m) æ˜¯å›ºå®šçš„ã€‚å³ä»ç›¸åŒçš„Endpoint(X,x) å‘é€åˆ°ä»»ä½•å¤–éƒ¨ IP åœ°å€å’Œä»»ä½•å¤–éƒ¨ç«¯å£çš„æŠ¥æ–‡åœ¨ NAT è®¾å¤‡ä¸Šä½¿ç”¨ç›¸åŒçš„æ˜ å°„ã€‚ ADM(Address-Dependent Mapping) å¤–éƒ¨åœ°å€ç›¸å…³æ˜ å°„ï¼šå¯¹äºä¸€ä¸ªå†…ç½‘ Endpoint(X,x)ï¼Œå‘å¾€ç›®çš„ Endpoint(D1,d1) çš„æŠ¥æ–‡ï¼ŒEndpoint(X,x) è¢«æ˜ å°„æˆ Endpoint(M1,m1)ï¼›å‘å¾€ç›®çš„Endpoint(D2,d2) çš„æŠ¥æ–‡ï¼ŒEndpoint(X,x) è¢«æ˜ å°„æˆ Endpoint(M2,m2)ã€‚åªè¦D1=D2ï¼Œä¸ç®¡d1 å’Œd2æ˜¯å¤šå°‘ï¼Œéƒ½æœ‰ Endpoint(M1,m1)=Endpoint(M2,m2)ã€‚å³ä»ç›¸åŒçš„ Endpoint(X,x) å‘é€åˆ°ç›¸åŒå¤–éƒ¨ IP åœ°å€å’Œä»»ä½•å¤–éƒ¨ç«¯å£çš„æŠ¥æ–‡åœ¨ NAT è®¾å¤‡ä¸Šä½¿ç”¨ç›¸åŒçš„æ˜ å°„ã€‚ APDMï¼ˆAddress and Port-Dependent Mappingï¼‰å¤–éƒ¨åœ°å€å’Œç«¯å£ç›¸å…³æ˜ å°„ï¼šå¯¹äºä¸€ä¸ªå†…ç½‘Endpoint(X,x)ï¼Œå‘å¾€ç›®çš„ Endpoint(D1,d1) çš„æŠ¥æ–‡ï¼ŒEndpoint(X,x) è¢«æ˜ å°„æˆEndpoint(M1,m1)ï¼›å‘å¾€ç›®çš„ Endpoint(D2,d2) çš„æŠ¥æ–‡ï¼Œ Endpoint(X,x) è¢«æ˜ å°„æˆEndpoint(M2,m2)ã€‚åªæœ‰å½“D1=D2ï¼Œä¸”d1=d2ï¼Œæ‰æœ‰ Endpoint(M1,m1)=Endpoint(M2,m2)ã€‚å³ä»ç›¸åŒçš„ Endpoint(X,x) å‘é€åˆ°ç›¸åŒå¤–éƒ¨IPåœ°å€å’Œç›¸åŒå¤–éƒ¨ç«¯å£çš„æŠ¥æ–‡åœ¨NATè®¾å¤‡ä¸Šä½¿ç”¨ç›¸åŒçš„æ˜ å°„ã€‚ 2. è¿‡æ»¤è§„åˆ™ NAT è¿‡æ»¤è§„åˆ™ EIFï¼ˆEndpoint-Independent Filteringï¼‰å¤–éƒ¨åœ°å€æ— å…³è¿‡æ»¤ï¼šå¯¹äºä¸€ä¸ªå†…ç½‘Endpoint(X,x)ï¼Œåªè¦å®ƒæ›¾ç»å‘å¤–ç½‘å‘é€è¿‡æ•°æ®ï¼Œå¤–ç½‘ä¸»æœºå°±å¯ä»¥è·å–åˆ°å®ƒç» NAT æ˜ å°„åçš„å¤–ç½‘Endpoint(M,m) ã€‚é‚£ä¹ˆåªè¦æ˜¯å‘ç»™ Endpoint(M,m) çš„æŠ¥æ–‡ï¼Œä¸ç®¡æ¥æºäº D1 è¿˜æ˜¯ D2ï¼Œéƒ½èƒ½è¢«è½¬æ¢å¹¶å‘å¾€å†…ç½‘ï¼Œå…¶ä»–æŠ¥æ–‡è¢«è¿‡æ»¤æ‰ã€‚ ADFï¼ˆAddr","date":"2022-05-13","objectID":"/posts/about-nat/:3:2","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["NAT","ç½‘ç»œ","NAT ç©¿è¶Š","å†…ç½‘ç©¿é€","è™šæ‹Ÿç½‘ç»œ","P2P","WebRTC"],"title":"NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ","uri":"/posts/about-nat/#2-è¿‡æ»¤è§„åˆ™"},{"categories":["tech"],"content":" 2. ä¸€å¯¹å¤š NAT - NAPTä¸€å¯¹å¤š NATï¼Œä¹Ÿè¢«ç§°ä¸º NAPTï¼ˆnetwork address and port translationï¼‰ï¼ŒåŒæ ·åœ¨RFC2663 ä¸­è¢«å®šä¹‰ã€‚Easy IP æ˜¯ NAPT çš„ä¸€ä¸ªç‰¹æ®Šå½¢å¼ã€‚ NAPT çš„ä¸»è¦åº”ç”¨åœºæ™¯æ˜¯ï¼Œå†…ç½‘ç”¨æˆ·éœ€è¦è®¿é—®åˆ°å…¬ç½‘ä¸»æœºã€‚ç»å¤§å¤šæ•°çš„å®¶åº­ç½‘ç»œã€åŠå…¬ç½‘ç»œéƒ½æ˜¯ NAPT ç±»å‹çš„ã€‚åŸå› åº”è¯¥å¾ˆå¥½ç†è§£â€”â€”å®¶åº­ç½‘ç»œæˆ–åŠå…¬ç½‘ç»œéƒ½åŒ…å«è®¸å¤šè”ç½‘è®¾å¤‡ï¼Œä½†æ˜¯è¿™ç±»ç½‘ç»œé€šå¸¸åªæœ‰ä¸€ä¸ªæˆ–æ•°ä¸ªå…¬ç½‘ IPï¼Œä½¿ç”¨ä¸€å¯¹ä¸€ NAT çš„è¯å…¬ç½‘ IP æ˜¾ç„¶æ˜¯ä¸å¤Ÿç”¨çš„ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ä¸€å¯¹å¤š NAT. NAPT é€šè¿‡åŒæ—¶åˆ©ç”¨ L3 çš„ IP ä¿¡æ¯ï¼Œä»¥åŠ L4 ä¼ è¾“å±‚çš„ç«¯å£ä¿¡æ¯ï¼Œæ¥ä¸ºå±€åŸŸç½‘è®¾å¤‡æä¾›é€æ˜çš„ã€é…ç½®æ–¹ä¾¿çš„ã€æ”¯æŒè¶…é«˜å¹¶å‘è¿æ¥çš„å¤–éƒ¨ç½‘ç»œé€šä¿¡ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š NAPT çš„ç«¯å£åˆ†é…ä¸è½¬æ¢è§„åˆ™ï¼ˆMapping Behaviorï¼‰ä»¥åŠå¯¹å¤–æ¥æµé‡çš„è¿‡æ»¤è§„åˆ™ï¼ˆFiltering Behaviorï¼‰éƒ½å­˜åœ¨è®¸å¤šä¸åŒçš„å®ç°ï¼Œæ²¡æœ‰ç»Ÿä¸€çš„è§„èŒƒä¸æ ‡å‡†ï¼Œä½†æ˜¯å­˜åœ¨ä¸¤ç§åˆ†ç±»è§„èŒƒï¼Œè¿™ç§åˆ†ç±»æ–¹æ³•ä¸»è¦ç”¨åœ¨ NAT ç©¿è¶ŠæŠ€æœ¯ä¸­ã€‚ RFC3489 å®šä¹‰çš„ NAT ç±»å‹ï¼ˆå››ç§ï¼‰åœ¨ RFC3489 ä¸­å°† NAPT åˆ†ä¸ºå››ç§ç±»å‹ï¼Œè¿™ä¹Ÿæ˜¯åº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ NAT åˆ†ç±»æ–¹æ³•ï¼Œå¦‚ä¸‹å›¾ï¼š ä¸‹é¢æˆ‘ä»¬é€ä¸€ä»‹ç»è¿™å››ç§ä¸åŒçš„ NAPT ç±»å‹ã€‚ ä»è¿™é‡Œå¼€å§‹ï¼Œä¸‹æ–‡ä¸­çš„ NAT ç‰¹æŒ‡ NAPTï¼Œå¦‚æœæ¶‰åŠã€Œä¸€å¯¹ä¸€ NATã€ä¼šä½¿ç”¨å®ƒçš„å…¨åã€‚ 1. Full-cone NATFull-cone NAT çš„ç‰¹ç‚¹å¦‚ä¸‹ï¼š æ•°æ®åŒ…æµå‡ºï¼šä¸€æ—¦å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰æ˜ å°„åˆ°å¤–éƒ¨åœ°å€ï¼ˆeAddr:ePortï¼‰ï¼Œæ‰€æœ‰å‘è‡ª iAddr:iPort çš„æ•°æ®åŒ…éƒ½ç»ç”± eAddr:ePort å‘å¤–å‘é€ã€‚ æ•°æ®åŒ…æµå…¥ï¼šä»»æ„ä¸»æœºå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œéƒ½èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. ä¹Ÿå°±æ˜¯ä¸å¯¹å¤–éƒ¨è¿›æ¥çš„æ•°æ®åšä»»ä½•é™åˆ¶ï¼Œå…¨éƒ¨æ”¾è¡Œã€‚ cone åœ†é”¥ï¼Œä¸ªäººç†è§£æ˜¯ä¸€ä¸ªæ¯”å–»ï¼Œä»»æ„å‘é€è¿›æ¥çš„æ•°æ®ï¼ˆå¤šï¼‰ï¼Œéƒ½èƒ½é€šè¿‡ NAT åˆ°è¾¾è¿™ä¸ªå†…éƒ¨åœ°å€ ï¼ˆä¸€ï¼‰ï¼Œå°±åƒä¸€ä¸ªåœ†é”¥ã€‚ å…è®¸ä»»æ„ä¸»æœºå‘é€åˆ° eAddr:ePort çš„æ•°æ®åˆ°è¾¾å†…éƒ¨åœ°å€æ˜¯å¾ˆå±é™©çš„è¡Œä¸ºï¼Œå› ä¸ºå†…éƒ¨ä¸»æœºä¸ä¸€å®šé…ç½®äº†åˆé€‚çš„å®‰å…¨ç­–ç•¥ã€‚å› æ­¤ Full-cone NAT æ¯”è¾ƒå°‘è§ï¼Œå°±ç®—è·¯ç”±å™¨ç­‰ NAT è®¾å¤‡æ”¯æŒ Full-cone NATï¼Œ é€šå¸¸ä¹Ÿä¸ä¼šæ˜¯é»˜è®¤é€‰é¡¹ã€‚æˆ‘ä»¬ä¼šåœ¨åé¢æ›´è¯¦ç»†åœ°ä»‹ç»å®ƒã€‚ 2. (Address-)Restricted cone NAT æ•°æ®åŒ…æµå‡ºï¼šï¼ˆè·Ÿ Full-cone NAT å®Œå…¨ä¸€è‡´ï¼‰ä¸€æ—¦å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰æ˜ å°„åˆ°å¤–éƒ¨åœ°å€ ï¼ˆeAddr:ePortï¼‰ï¼Œæ‰€æœ‰å‘è‡ª iAddr:iPort çš„æ•°æ®åŒ…éƒ½ç»ç”± eAddr:ePort å‘å¤–å‘é€ã€‚ æ•°æ®åŒ…æµå…¥ï¼šåªæœ‰å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸»åŠ¨è¿æ¥è¿‡çš„å¤–éƒ¨ä¸»æœºï¼ˆnAddr:anyï¼‰ï¼Œå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œæ‰èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. è·Ÿ Full-cone NAT çš„åŒºåˆ«åœ¨äºï¼Œå®ƒé™åˆ¶äº†å¤–éƒ¨ä¸»æœºçš„ IP åœ°å€ã€‚åªæœ‰ä¸»åŠ¨è¿æ¥è¿‡çš„ä¸»æœºï¼Œæ‰èƒ½å‘é€æ•°æ®åˆ° NAT å†…éƒ¨ã€‚è¿™æå‡äº†ä¸€äº›å®‰å…¨æ€§ã€‚ 3. Port-Restricted cone NAT æ•°æ®åŒ…æµå‡ºï¼šï¼ˆè·Ÿ Full-cone NAT å®Œå…¨ä¸€è‡´ï¼‰ä¸€æ—¦å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰æ˜ å°„åˆ°å¤–éƒ¨åœ°å€ ï¼ˆeAddr:ePortï¼‰ï¼Œæ‰€æœ‰å‘è‡ª iAddr:iPort çš„æ•°æ®åŒ…éƒ½ç»ç”± eAddr:ePort å‘å¤–å‘é€ã€‚ æ•°æ®åŒ…æµå…¥ï¼šåªæœ‰å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸»åŠ¨è¿æ¥è¿‡çš„å¤–éƒ¨ç¨‹åºï¼ˆnAddr:nPortï¼‰ï¼Œå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œæ‰èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. ä¸ Address-Restricted cone NAT çš„åŒºåˆ«åœ¨äºï¼Œå®ƒåŒæ—¶é™åˆ¶äº†å¤–éƒ¨ä¸»æœºçš„ IP ä¸ç«¯å£ï¼Œå¯ä»¥è¯´æ˜¯æ›´è¿›ä¸€æ­¥åœ°æå‡äº†å®‰å…¨æ€§ã€‚ 4. Symmetric NAT æ•°æ®åŒ…æµå‡ºï¼šåŒä¸€ä¸ªå†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸ä¸åŒå¤–éƒ¨ä¸»æœºï¼ˆnAddr:nPortï¼‰çš„é€šä¿¡ï¼Œä¼šéšæœºä½¿ç”¨ä¸åŒçš„ NAT å¤–éƒ¨ç«¯å£ï¼ˆeAddr:randomPortï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´å†…éƒ¨åœ°å€ä¸ NAT å¤–éƒ¨åœ°å€çš„å…³ç³»ä¹Ÿæ˜¯ä¸€å¯¹å¤šï¼ ä¸ºæ¯ä¸ªè¿æ¥éƒ½éšæœºé€‰æ‹©ä¸€ä¸ªä¸åŒçš„ NAT ç«¯å£ï¼Œè¿™å®é™…æ˜¯è¿›ä¸€æ­¥å¼ºåŒ–äº† NAT å†…ç½‘çš„å®‰å…¨æ€§ã€‚ä½†è¿™ä¹Ÿæ˜¯ NAT ç©¿è¶Šæœ€å¤§çš„éš¾ç‚¹â€”â€”å®ƒå¯¼è‡´ Symmetric NAT çš„ç«¯å£éš¾ä»¥é¢„æµ‹ï¼ æ•°æ®åŒ…æµå…¥ï¼šåªæœ‰å†…éƒ¨åœ°å€ï¼ˆiAddr:iPortï¼‰ä¸»åŠ¨è¿æ¥è¿‡çš„å¤–éƒ¨ç¨‹åºï¼ˆnAddr:nPortï¼‰ï¼Œå‘é€åˆ° eAddr:ePort çš„æ•°æ®åŒ…ï¼Œæ‰èƒ½é€šè¿‡ NAT åˆ°è¾¾ iAddr:iPort. è¿™ä¸ªæ•°æ®æµå…¥è§„åˆ™ï¼Œä¸ Port-Restricted cone NAT æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚ å¯¹ç§° NAT æ˜¯æœ€å®‰å…¨çš„ä¸€ç§ NAT ç»“æ„ï¼Œé™åˆ¶æœ€ä¸ºä¸¥æ ¼ï¼Œåº”è¯¥ä¹Ÿæ˜¯åº”ç”¨æœ€å¹¿æ³›çš„ NAT ç»“æ„ã€‚ä½†æ˜¯å®ƒå¯¼è‡´æ‰€æœ‰çš„ TCP è¿æ¥éƒ½åªèƒ½ç”±ä»å†…éƒ¨ä¸»åŠ¨å‘èµ·ï¼Œå¤–éƒ¨å‘èµ·çš„ TCP è¿æ¥è¯·æ±‚ä¼šç›´æ¥è¢« NAT æ‹’ç»ï¼Œå› æ­¤å®ƒä¹Ÿæ˜¯ P2P ç©å®¶æœ€å¤´ç–¼çš„ä¸€ç§ NAT ç±»å‹ã€‚è§£å†³æ–¹æ¡ˆæ˜¯é€šè¿‡ UDP è¿‚å›å®ç°è¿æ¥çš„å»ºç«‹ï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚ 5. Linux ä¸­çš„ NAPTLinux çš„ç½‘ç»œæ ˆä¸­ï¼Œå¯é€šè¿‡ iptables/netfilter çš„ SNAT/MASQUERADE å®ç° NAPT ç½‘å…³ï¼Œè¿™ç§æ–¹å¼åªèƒ½å®ç°ä¸€ä¸ª Symmetric NAT. ä¹Ÿå°±æ˜¯è¯´ç»å¤§å¤šæ•°åŸºäº Linux å®ç°çš„å®¶åº­å±€åŸŸç½‘ã€Docker è™šæ‹Ÿç½‘ç»œã€Kubernetes è™šæ‹Ÿç½‘ç»œã€äº‘æœåŠ¡çš„è™šæ‹Ÿç½‘ç»œï¼Œéƒ½æ˜¯ Symmetric NAT. åªæœ‰ä¸€äº›æœ‰ Full-cone NAT éœ€æ±‚çš„ç½‘å§ã€ISP çš„ LSN(Large Scale NAT) ç½‘å…³ç­‰ç»„ç»‡ï¼Œä¼šä½¿ç”¨é Linux å†…æ ¸çš„ä¼ä¸šçº§è·¯ç”±å™¨æä¾› Full-cone NAT èƒ½åŠ›ï¼Œè¿™äº›è®¾å¤‡å¯èƒ½æ˜¯åŸºäº FPGA ç­‰ä¸“ç”¨èŠ¯ç‰‡è®¾è®¡çš„ã€‚ æƒ³è¦å°† Symmetric NAT å†…çš„ä¸»æœºæä¾›ç»™å¤–éƒ¨è®¿é—®ï¼Œåªèƒ½é€šè¿‡ç«¯å£æ˜ å°„ã€ä¸€å¯¹ä¸€ NAT ç­‰æ–¹å¼å®ç°ï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»è¿™äº›æ–¹æ³•ã€‚ RFC5389 å®šä¹‰çš„ NAT ç±»å‹ï¼ˆä¹ç§ï¼‰RFC3489 è¿™ä¸ªæ—©æœŸ RFC å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œé—®é¢˜ä¹‹ä¸€å°±æ˜¯å®ƒå¯¹ NAT å½’ç±»è¿‡äºç¬¼ç»Ÿï¼Œå¾ˆå¤š NAPT ç½‘å…³éƒ½æ— æ³•å¾ˆå¥½çš„åŒ¹é…ä¸Šå…¶ä¸­æŸä¸ªç±»åˆ«ã€‚ äºæ˜¯åæ¥ï¼ŒRFC3489 è¢«åºŸå¼ƒå¹¶ç”± RFC5389 æ¥æ›¿ä»£ï¼Œåœ¨ RFC5389 ä¸­ï¼Œå°† Mapping Behaviorï¼ˆæ˜ å°„è§„åˆ™ï¼‰å’Œ Filtering Behaviorï¼ˆè¿‡æ»¤è§„åˆ™ï¼‰åˆ†å¼€æ¥ï¼Œå®šä¹‰äº† 3 ç§ Mapping Behaviorï¼ˆæ˜ å°„è§„åˆ™ï¼‰å’Œ 3 ç§ Filtering Behaviorï¼ˆè¿‡æ»¤è§„åˆ™ï¼‰ï¼Œä¸€å…±æœ‰ 9 ç§ç»„åˆã€‚ 1. æ˜ å°„è§„åˆ™ä¸‰ç§æ˜ å°„è§„åˆ™å¦‚å›¾æ‰€ç¤ºï¼Œå‡è®¾ä¸€ä¸ªå†…ç½‘ä¸»æœº HostX çš„å†…ç½‘ IP åœ°å€ä¸º Xï¼Œç«¯å£å·ä¸º xï¼Œç» NAT æ˜ å°„åçš„å¤–ç½‘ IP åœ°å€ä¸º Mï¼Œç«¯å£å·ä¸º mã€‚ä¸ºæ–¹ä¾¿æè¿°ï¼Œå°†å†…ç½‘çš„ Endpoint è®°ä¸º Endpoint(X,x)ï¼Œæ˜ å°„åå¤–ç½‘çš„ Endpoint è®°ä¸º Endpoint(M,m)ã€‚å†…ç½‘ Endpoint(X,x) å‘å¾€å¤–ç½‘ HostD1 çš„ IP åœ°å€å’Œç«¯å£å·è®°ä¸ºç›®çš„ Endpoint(D1,d1)ï¼›å‘å¾€å¤–ç½‘ HostD2 çš„ IP åœ°å€å’Œç«¯å£å·è®°ä¸ºç›®çš„Endpoint(D2,d2)ã€‚ NAT æ˜ å°„è§„åˆ™ EIM(Endpoint-Independent Mapping) å¤–éƒ¨åœ°å€æ— å…³æ˜ å°„ å¯¹äºä¸€ä¸ªå†…ç½‘ Endpoint(X,x)ï¼Œå…¶æ˜ å°„çš„å¤–ç½‘ Endpoint(M,m) æ˜¯å›ºå®šçš„ã€‚å³ä»ç›¸åŒçš„Endpoint(X,x) å‘é€åˆ°ä»»ä½•å¤–éƒ¨ IP åœ°å€å’Œä»»ä½•å¤–éƒ¨ç«¯å£çš„æŠ¥æ–‡åœ¨ NAT è®¾å¤‡ä¸Šä½¿ç”¨ç›¸åŒçš„æ˜ å°„ã€‚ ADM(Address-Dependent Mapping) å¤–éƒ¨åœ°å€ç›¸å…³æ˜ å°„ï¼šå¯¹äºä¸€ä¸ªå†…ç½‘ Endpoint(X,x)ï¼Œå‘å¾€ç›®çš„ Endpoint(D1,d1) çš„æŠ¥æ–‡ï¼ŒEndpoint(X,x) è¢«æ˜ å°„æˆ Endpoint(M1,m1)ï¼›å‘å¾€ç›®çš„Endpoint(D2,d2) çš„æŠ¥æ–‡ï¼ŒEndpoint(X,x) è¢«æ˜ å°„æˆ Endpoint(M2,m2)ã€‚åªè¦D1=D2ï¼Œä¸ç®¡d1 å’Œd2æ˜¯å¤šå°‘ï¼Œéƒ½æœ‰ Endpoint(M1,m1)=Endpoint(M2,m2)ã€‚å³ä»ç›¸åŒçš„ Endpoint(X,x) å‘é€åˆ°ç›¸åŒå¤–éƒ¨ IP åœ°å€å’Œä»»ä½•å¤–éƒ¨ç«¯å£çš„æŠ¥æ–‡åœ¨ NAT è®¾å¤‡ä¸Šä½¿ç”¨ç›¸åŒçš„æ˜ å°„ã€‚ APDMï¼ˆAddress and Port-Dependent Mappingï¼‰å¤–éƒ¨åœ°å€å’Œç«¯å£ç›¸å…³æ˜ å°„ï¼šå¯¹äºä¸€ä¸ªå†…ç½‘Endpoint(X,x)ï¼Œå‘å¾€ç›®çš„ Endpoint(D1,d1) çš„æŠ¥æ–‡ï¼ŒEndpoint(X,x) è¢«æ˜ å°„æˆEndpoint(M1,m1)ï¼›å‘å¾€ç›®çš„ Endpoint(D2,d2) çš„æŠ¥æ–‡ï¼Œ Endpoint(X,x) è¢«æ˜ å°„æˆEndpoint(M2,m2)ã€‚åªæœ‰å½“D1=D2ï¼Œä¸”d1=d2ï¼Œæ‰æœ‰ Endpoint(M1,m1)=Endpoint(M2,m2)ã€‚å³ä»ç›¸åŒçš„ Endpoint(X,x) å‘é€åˆ°ç›¸åŒå¤–éƒ¨IPåœ°å€å’Œç›¸åŒå¤–éƒ¨ç«¯å£çš„æŠ¥æ–‡åœ¨NATè®¾å¤‡ä¸Šä½¿ç”¨ç›¸åŒçš„æ˜ å°„ã€‚ 2. è¿‡æ»¤è§„åˆ™ NAT è¿‡æ»¤è§„åˆ™ EIFï¼ˆEndpoint-Independent Filteringï¼‰å¤–éƒ¨åœ°å€æ— å…³è¿‡æ»¤ï¼šå¯¹äºä¸€ä¸ªå†…ç½‘Endpoint(X,x)ï¼Œåªè¦å®ƒæ›¾ç»å‘å¤–ç½‘å‘é€è¿‡æ•°æ®ï¼Œå¤–ç½‘ä¸»æœºå°±å¯ä»¥è·å–åˆ°å®ƒç» NAT æ˜ å°„åçš„å¤–ç½‘Endpoint(M,m) ã€‚é‚£ä¹ˆåªè¦æ˜¯å‘ç»™ Endpoint(M,m) çš„æŠ¥æ–‡ï¼Œä¸ç®¡æ¥æºäº D1 è¿˜æ˜¯ D2ï¼Œéƒ½èƒ½è¢«è½¬æ¢å¹¶å‘å¾€å†…ç½‘ï¼Œå…¶ä»–æŠ¥æ–‡è¢«è¿‡æ»¤æ‰ã€‚ ADFï¼ˆAddr","date":"2022-05-13","objectID":"/posts/about-nat/:3:2","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["NAT","ç½‘ç»œ","NAT ç©¿è¶Š","å†…ç½‘ç©¿é€","è™šæ‹Ÿç½‘ç»œ","P2P","WebRTC"],"title":"NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ","uri":"/posts/about-nat/#3-rfc3489-ä¸-rfc5389-çš„-nat-ç±»å‹å®šä¹‰å…³ç³»"},{"categories":["tech"],"content":" NAT çš„å¼Šç«¯ IP ä¼šè¯çš„ä¿æŒæ—¶æ•ˆå˜çŸ­ï¼šNAT éœ€è¦ç»´æŠ¤ä¸€ä¸ªä¼šè¯åˆ—è¡¨ï¼Œå¦‚æœä¼šè¯é™é»˜æ—¶é—´è¶…è¿‡ä¸€ä¸ªé˜ˆå€¼ï¼Œå°†ä¼šè¢«ä»åˆ—è¡¨ä¸­ç§»é™¤ã€‚ ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå°±éœ€è¦å®šæœŸå‘é€å¿ƒè·³åŒ…æ¥ç»´æŒ NAT ä¼šè¯ã€‚ä¿—ç§°å¿ƒè·³ä¿æ´» IP è·Ÿè¸ªæœºåˆ¶å¤±æ•ˆï¼šä¸€å¯¹å¤š NAT ä½¿å¾—å¤šä¸ªå±€åŸŸç½‘ä¸»æœºå…±ç”¨ä¸€ä¸ªå…¬ç½‘ IPï¼Œè¿™å¯¼è‡´åŸºäºå…¬ç½‘ IP è¿›è¡Œæµé‡åˆ†æçš„é€»è¾‘å¤±å»æ„ä¹‰ã€‚ æ¯”å¦‚å¾ˆå¤šç«™ç‚¹éƒ½åŠ äº†åŸºäº IP çš„è®¿é—®é¢‘ç‡é™åˆ¶ï¼Œè¿™ä¼šé€ æˆå±€åŸŸç½‘å†…å¤šä¸ªç”¨æˆ·ä¹‹é—´çš„æœåŠ¡æŠ¢å ä¸æ’é˜Ÿã€‚ NAT çš„å·¥ä½œæœºåˆ¶ä¾èµ–äºä¿®æ”¹IPåŒ…å¤´çš„ä¿¡æ¯ï¼Œè¿™ä¼šå¦¨ç¢ä¸€äº›å®‰å…¨åè®®çš„å·¥ä½œã€‚ å› ä¸º NAT ç¯¡æ”¹äº† IP åœ°å€ã€ä¼ è¾“å±‚ç«¯å£å·å’Œæ ¡éªŒå’Œï¼Œè¿™ä¼šå¯¼è‡´ IP å±‚çš„è®¤è¯åè®®å½»åº•ä¸èƒ½å·¥ä½œï¼Œ å› ä¸ºè®¤è¯ç›®çš„å°±æ˜¯è¦ä¿è¯è¿™äº›ä¿¡æ¯åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ²¡æœ‰å˜åŒ–ã€‚ å¯¹äºä¸€äº›éš§é“åè®®ï¼ŒNAT çš„å­˜åœ¨ä¹Ÿå¯¼è‡´äº†é¢å¤–çš„é—®é¢˜ï¼Œå› ä¸ºéš§é“åè®®é€šå¸¸ç”¨å¤–å±‚åœ°å€æ ‡è¯†éš§é“å®ä½“ï¼Œç©¿è¿‡ NAT çš„éš§é“ä¼šæœ‰ IP å¤ç”¨å…³ç³»ï¼Œåœ¨å¦ä¸€ç«¯éœ€è¦å°å¿ƒå¤„ç†ã€‚ ICMP æ˜¯ä¸€ç§ç½‘ç»œæ§åˆ¶åè®®ï¼Œå®ƒçš„å·¥ä½œåŸç†ä¹Ÿæ˜¯åœ¨ä¸¤ä¸ªä¸»æœºä¹‹é—´ä¼ é€’å·®é”™å’Œæ§åˆ¶æ¶ˆæ¯ï¼Œå› ä¸ºIPçš„å¯¹åº”å…³ç³»è¢«é‡æ–°æ˜ å°„ï¼ŒICMP ä¹Ÿè¦è¿›è¡Œå¤ç”¨å’Œè§£å¤ç”¨å¤„ç†ï¼Œå¾ˆå¤šæƒ…å†µä¸‹å› ä¸º ICMP æŠ¥æ–‡è½½è·æ— æ³•æä¾›è¶³å¤Ÿçš„ä¿¡æ¯ï¼Œè§£å¤ç”¨ä¼šå¤±è´¥ã€‚ IP åˆ†ç‰‡æœºåˆ¶æ˜¯åœ¨ä¿¡æ¯æºç«¯æˆ–ç½‘ç»œè·¯å¾„ä¸Šï¼Œéœ€è¦å‘é€çš„ IP æŠ¥æ–‡å°ºå¯¸å¤§äºè·¯å¾„å®é™…èƒ½æ‰¿è½½æœ€å¤§å°ºå¯¸æ—¶ï¼ŒIP åè®®å±‚ä¼šå°†ä¸€ä¸ªæŠ¥æ–‡åˆ†æˆå¤šä¸ªç‰‡æ–­å‘é€ï¼Œç„¶ååœ¨æ¥æ”¶ç«¯é‡ç»„è¿™äº›ç‰‡æ–­æ¢å¤åŸå§‹æŠ¥æ–‡ã€‚IP è¿™æ ·çš„åˆ†ç‰‡æœºåˆ¶ä¼šå¯¼è‡´ä¼ è¾“å±‚çš„ä¿¡æ¯åªåŒ…æ‹¬åœ¨ç¬¬ä¸€ä¸ªåˆ†ç‰‡ä¸­ï¼ŒNATéš¾ä»¥è¯†åˆ«åç»­åˆ†ç‰‡ä¸å…³è”è¡¨çš„å¯¹åº”å…³ç³»ï¼Œå› æ­¤éœ€è¦ç‰¹æ®Šå¤„ç†ã€‚ ","date":"2022-05-13","objectID":"/posts/about-nat/:4:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["NAT","ç½‘ç»œ","NAT ç©¿è¶Š","å†…ç½‘ç©¿é€","è™šæ‹Ÿç½‘ç»œ","P2P","WebRTC"],"title":"NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ","uri":"/posts/about-nat/#nat-çš„å¼Šç«¯"},{"categories":["tech"],"content":" NAT ç©¿è¶Š - NAT Traversalå¤©ä¸‹è‹¦ NAT ä¹…çŸ£ï¼Œå°¤å…¶æ˜¯å¯¹å„ç§ P2P ç©å®¶ï¼Œå¦‚ NAS ç©å®¶ã€P2P æ¸¸æˆç©å®¶ï¼Œä»¥åŠéœ€è¦æ­å»º VPN è™šæ‹Ÿç§æœ‰ç½‘ç»œçš„ç½‘ç»œç®¡ç†å‘˜è€Œè¨€ã€‚åœ¨å¸¸è§çš„è”æœºæ¸¸æˆã€BitTorrent æ–‡ä»¶å…±äº«åè®®ã€P2P èŠå¤©ç­‰ç‚¹å¯¹ç‚¹é€šè®¯åœºæ™¯ä¸­ï¼Œé€šè®¯åŒæ–¹å®¢æˆ·ç«¯é€šå¸¸éƒ½è¿è¡Œåœ¨å®¶åº­å±€åŸŸç½‘ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸­é—´éš”ç€ä¸¤å±‚å®¶åº­è·¯ç”±å™¨çš„ NATï¼Œè·¯ç”±å™¨çš„é»˜è®¤é…ç½®éƒ½æ˜¯å®‰å…¨ä¼˜å…ˆçš„ï¼Œå­˜åœ¨å¾ˆå¤šå®‰å…¨é™åˆ¶ï¼Œç›´æ¥è¿›è¡Œ P2P é€šè®¯å¤§æ¦‚ç‡ä¼šå¤±è´¥ã€‚ ä¸ºäº†ç©¿è¶Šè¿™äº› NAT ç½‘å…³è¿›è¡Œ P2P é€šè®¯ï¼Œå°±éœ€è¦å€ŸåŠ©NAT ç©¿è¶ŠæŠ€æœ¯ã€‚ è¿™é‡Œè®¨è®ºçš„å‰ææ˜¯ï¼Œä½ çš„ç½‘ç»œåªæœ‰å•å±‚ NATï¼Œå¦‚æœå¤–éƒ¨è¿˜å­˜åœ¨å…¬å¯“ NATã€ISP å¹¿åŸŸç½‘ NATï¼Œé‚£ä¸‹é¢ä»‹ç»çš„ NAT æå‡æŠ€æœ¯å®é™…ä¸Šå°±æ²¡å•¥æ„ä¹‰äº†ã€‚ ","date":"2022-05-13","objectID":"/posts/about-nat/:5:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["NAT","ç½‘ç»œ","NAT ç©¿è¶Š","å†…ç½‘ç©¿é€","è™šæ‹Ÿç½‘ç»œ","P2P","WebRTC"],"title":"NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ","uri":"/posts/about-nat/#nat-ç©¿è¶Š---nat-traversal"},{"categories":["tech"],"content":" 1. ã€ŒDMZ ä¸»æœºã€æˆ–è€…ã€Œå®šå‘ DNAT è½¬å‘ã€æœ€ç®€å•çš„æ–¹æ³•æ˜¯ DMZ ä¸»æœºåŠŸèƒ½ï¼Œå‰é¢å·²ç»ä»‹ç»è¿‡äº†ï¼ŒDMZ å¯ä»¥ç›´æ¥ç»™å†…ç½‘æœåŠ¡å™¨ç»‘å®šè·¯ç”±å™¨çš„å¤–éƒ¨ IPï¼Œä»è¯¥ IP è¿›æ¥çš„æ‰€æœ‰æµé‡éƒ½ä¼šç›´æ¥è¢«å‘é€ç»™è¿™å°å†…ç½‘æœåŠ¡å™¨ã€‚è¢«æŒ‡å®šçš„ DMZ ä¸»æœºï¼Œå…¶ NAT ç±»å‹å°†ä» NAPT å˜æˆä¸€å¯¹ä¸€ NATï¼Œè€Œä¸€å¯¹ä¸€ NAT å¯¹ P2P é€šè®¯è€Œè¨€æ˜¯é€æ˜çš„ï¼Œè¿™æ ·å°±å¯ä»¥æ„‰å¿«åœ°ç©è€äº†ã€‚ åœ¨ Linux è·¯ç”±å™¨ä¸Šå®ç°ç±»ä¼¼ DMZ çš„åŠŸèƒ½ï¼Œåªéœ€è¦ä¸¤è¡Œ iptables å‘½ä»¤ï¼Œè¿™å¯ä»¥ç§°ä½œã€Œå®šå‘ DNAT è½¬å‘ã€ï¼š shell iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE # æ™®é€šçš„SNAT iptables -t nat -A PREROUTING -i eth0 -j DNAT --to-destination 192.168.1.3 # å°†å…¥ç«™æµé‡DNATè½¬å‘åˆ°å†…ç½‘ä¸»æœº192.168.1.3 è¿™ä¸¤é¡¹æŠ€æœ¯çš„ç¼ºç‚¹æ˜¯åªèƒ½å°†ä¸€å°ä¸»æœºæä¾›ç»™å¤–ç½‘è®¿é—®ï¼Œè€Œä¸”å°†æ•´å°ä¸»æœºå¼€æ”¾åˆ°å…¬ç½‘å®é™…ä¸Šæ˜¯å¾ˆå±é™©çš„ï¼Œ å¦‚æœä¸æ‡‚ç½‘ç»œå¾ˆå®¹æ˜“è¢«é»‘å®¢å…¥ä¾µã€‚ ","date":"2022-05-13","objectID":"/posts/about-nat/:5:1","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["NAT","ç½‘ç»œ","NAT ç©¿è¶Š","å†…ç½‘ç©¿é€","è™šæ‹Ÿç½‘ç»œ","P2P","WebRTC"],"title":"NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ","uri":"/posts/about-nat/#1-dmz-ä¸»æœºæˆ–è€…å®šå‘-dnat-è½¬å‘"},{"categories":["tech"],"content":" 2. é™æ€ç«¯å£è½¬å‘é€€ä¸€æ­¥ï¼Œå¯ä»¥ç›´æ¥ç”¨é™æ€ç«¯å£è½¬å‘åŠŸèƒ½ï¼Œå°±æ˜¯åœ¨è·¯ç”±å™¨ä¸Šæ‰‹åŠ¨è®¾ç½®æŸä¸ªç«¯å£å·çš„æ‰€æœ‰ TCP/UDP æµé‡ï¼Œ éƒ½ç›´æ¥ NAT è½¬å‘åˆ°åˆ°å†…ç½‘çš„æŒ‡å®šåœ°å€ã€‚ä¹Ÿå°±æ˜¯å¾€ NAT çš„è½¬å‘è¡¨ä¸­æ‰‹åŠ¨æ·»åŠ å†…å®¹ï¼Œç¤ºæ„å›¾ï¼š NAPT tables è®¾ç½®å¥½ç«¯å£è½¬å‘åï¼Œåªè¦ä½¿ç”¨çš„æ˜¯è¢«è®¾å®šçš„ç«¯å£ï¼ŒNAT å¯¹ P2P é€šä¿¡è€Œè¨€å°†å®Œå…¨é€æ˜ã€‚ç»å¤§å¤šæ•°è·¯ç”±å™¨éƒ½æ”¯æŒè¿™é¡¹åŠŸèƒ½ï¼ŒNAS å‘çƒ§å‹ä»¬æƒ³ç© P2P ä¸‹è½½åˆ†äº«ï¼ŒåŸºæœ¬éƒ½æ˜¯è¿™ä¹ˆæçš„ã€‚ ","date":"2022-05-13","objectID":"/posts/about-nat/:5:2","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["NAT","ç½‘ç»œ","NAT ç©¿è¶Š","å†…ç½‘ç©¿é€","è™šæ‹Ÿç½‘ç»œ","P2P","WebRTC"],"title":"NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ","uri":"/posts/about-nat/#2-é™æ€ç«¯å£è½¬å‘"},{"categories":["tech"],"content":" 3. UPnP åŠ¨æ€ç«¯å£è½¬å‘ æœ€æµè¡Œçš„ UPnP å®ç°æ˜¯ https://github.com/miniupnp/miniupnp é™æ€ç«¯å£è½¬å‘å¯¹ç”¨æˆ·çš„æŠ€æœ¯è¦æ±‚è¾ƒé«˜ï¼Œæˆ‘ä½œä¸ºä¸€ä¸ªç½‘ç»œå°ç™½ï¼Œå¸Œæœ›æœ‰ä¸€ä¸ªå‚»ç“œå¼çš„å¼€å…³èƒ½è®©æˆ‘æ„‰å¿«åœ°ç©è€ Xbox/PS5 è”æœºæ¸¸æˆï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿä½ éœ€è¦çš„åªæ˜¯åœ¨è·¯ç”±å™¨ä¸Šå¯ç”¨ UPnP(Universal Plug and Play) åè®®ï¼Œå¯ç”¨å®ƒåï¼Œå†…ç½‘æ¸¸æˆè®¾å¤‡å°±å¯ä»¥é€šè¿‡ UPnP å‘è·¯ç”±å™¨åŠ¨æ€ç”³è¯·ä¸€ä¸ªç«¯å£å·ä¾›å…¶ä½¿ç”¨ï¼ŒUPnP ä¼šè‡ªåŠ¨é…ç½®å¯¹åº”çš„ç«¯å£è½¬å‘è§„åˆ™ã€‚ ç°åœ¨æ–°å‡ºçš„è·¯ç”±å™¨åŸºæœ¬éƒ½æ”¯æŒ UPnP åŠŸèƒ½ï¼Œå®ƒæ˜¯æœ€ç®€å•æœ‰æ•ˆçš„ NAT æå‡æ–¹å¼ã€‚ UPnP è§£å†³äº†ã€Œé™æ€ç«¯å£è½¬å‘ã€éœ€è¦æ‰‹åŠ¨é…ç½®çš„é—®é¢˜ï¼Œåœ¨å¯ç”¨äº† UPnP åï¼Œå¯¹æ‰€æœ‰æ”¯æŒ UPnP çš„å†…ç½‘ç¨‹åºè€Œè¨€ï¼ŒNAT ç±»å‹å°†æå‡åˆ° Full-cone NAT. ","date":"2022-05-13","objectID":"/posts/about-nat/:5:3","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["NAT","ç½‘ç»œ","NAT ç©¿è¶Š","å†…ç½‘ç©¿é€","è™šæ‹Ÿç½‘ç»œ","P2P","WebRTC"],"title":"NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ","uri":"/posts/about-nat/#3-upnp-åŠ¨æ€ç«¯å£è½¬å‘"},{"categories":["tech"],"content":" 4. NAT ç©¿è¶Šåè®® - STUN/TURN/ICEå¦‚æœå¾ˆä¸å¹¸å‰é¢æåˆ°çš„ã€ŒDMZ ä¸»æœºã€/ã€Œé™æ€ç«¯å£è½¬å‘ã€/ã€ŒUPnPã€ ä¸‰é¡¹æŠ€æœ¯ï¼Œä½ çš„è·¯ç”±å™¨éƒ½ä¸æ”¯æŒï¼Œ é‚£ä½ å°±åªèƒ½å€ŸåŠ© NAT ç©¿è¶Šåè®®äº†ã€‚ ç›®å‰æœ‰å¦‚ä¸‹å‡ ä¸ª NAT ç©¿è¶Šåè®®æ ‡å‡†ï¼š RFC3489 Classic STUN Classic STUN æ˜¯ä¸€ä¸ªæ—©æœŸçš„ STUN è§„èŒƒï¼Œå®ƒå®šä¹‰äº†ä¸€æ•´å¥—å®Œæ•´çš„ NAT ç©¿è¶Šæ–¹æ¡ˆï¼Œä½†æ˜¯å› ä¸ºå­˜åœ¨è®¸å¤šé—®é¢˜ï¼Œå·²ç»è¢«åºŸå¼ƒã€‚ RFC5389 - Simple Traversal of UDP Through NATs (STUN) RFC5389 æ‰€å®šä¹‰çš„ STUN åè®®æ˜¯å¯¹ Classic STUN çš„æ”¹è¿›ï¼Œå®ƒçš„å®šä½ä¸å†æ˜¯ä¸€ä¸ªå®Œæ•´çš„ NAT ç©¿è¶Šè§£å†³æ–¹æ¡ˆï¼Œè€Œæ˜¯ä½œä¸ºå…¶ä»–åè®®ï¼ˆä¾‹å¦‚SIPã€FTPã€DNSï¼‰å¤„ç† NAT ç©¿è¶Šé—®é¢˜çš„ä¸€ä¸ªå·¥å…·ã€‚ å…¶å¯ä»¥ç”¨äºæ£€æŸ¥ç½‘ç»œä¸­NATè®¾å¤‡çš„å­˜åœ¨ï¼Œå¹¶ç¡®å®šä¸¤ä¸ªé€šä¿¡ç«¯ç‚¹è¢«NATè®¾å¤‡åˆ†é…çš„IPåœ°å€å’Œç«¯å£å·ã€‚ç„¶åï¼Œé€šè¿‡ICEï¼ˆInteractive Connectivity Establishmentï¼‰ï¼Œè‡ªåŠ¨åˆ›å»ºä¸€æ¡èƒ½å¤Ÿè¿›è¡ŒNATç©¿è¶Šçš„æ•°æ®é€šé“ã€‚ STUN æ”¯æŒé™¤ Symmetric NAT ä¹‹å¤–çš„å¦å¤–ä¸‰ç§ NAT ç±»å‹ RFC5766 - Traversal Using Relays around NAT (TURN) TURN åœ¨ STUN åè®®ä¹‹ä¸Šæ·»åŠ äº†ä¸€ä¸ªä¸­ç»§ï¼Œä»¥ç¡®ä¿åœ¨æ— æ³•å®ç° NAT ç©¿è¶Šçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ fallback åˆ°ç›´æ¥ä½¿ç”¨ä¸­ç»§æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ã€‚ è¿™ä¸ªä¸­ç»§çš„åŸç†ç±»ä¼¼åå‘ä»£ç†ï¼Œå•çº¯è´Ÿè´£æ•°æ®çš„è½¬å‘ åœ¨ç¾å›½æœ‰ä¸€é¡¹æ•°æ®è¡¨ç¤ºåœ¨è¿›è¡Œ P2P ç©¿è¶Šçš„æ—¶å€™ï¼Œç©¿è¶ŠæˆåŠŸçš„æ¦‚ç‡ä¸º 70%ï¼Œä½†æ˜¯åœ¨å›½å†…è¿™ä¸ªæˆåŠŸç‡ 50% å¯èƒ½éƒ½åˆ°ä¸äº†ã€‚å› æ­¤å°±æœ‰å¿…è¦ä½¿ç”¨ TURN åè®®ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯åœ¨ç©¿è¶Šå¤±è´¥çš„æƒ…å†µä¸‹ï¼Œç”¨æˆ·ä»ç„¶èƒ½æ­£å¸¸é€šä¿¡ã€‚ RFC8445 - Interactive Connectivity Establishment (ICE) ä¸€ä¸ª NAT ç©¿è¶Šçš„åå•†åè®®ï¼Œå®ƒç»Ÿä¸€äº† STUN ä¸ TURN ä¸¤ç§åè®®ï¼Œä¼šå°è¯•éå†æ‰€æœ‰å¯èƒ½çš„è¿æ¥æ–¹æ¡ˆã€‚ æ€»çš„æ¥è¯´ï¼Œæ ‡å‡†çš„ NAT ç©¿è¶Šåè®®ä¼˜å…ˆä½¿ç”¨æ‰“æ´ ï¼ˆNAT Hole Pounchingï¼‰æŠ€æœ¯ï¼Œå¦‚æœæ‰“æ´å¤±è´¥ï¼Œå°±ä½¿ç”¨ä¸­ç»§æœåŠ¡å™¨æŠ€æœ¯å…œåº•ï¼Œç¡®ä¿èƒ½æˆåŠŸç©¿è¶Šã€‚ STUN/TURN/ICE çš„ NAT ç±»å‹æ£€æµ‹RFC5389 å®šä¹‰äº†å¯¹ NAT æ˜ å°„ç±»å‹ä»¥åŠè¿‡æ»¤ç±»å‹çš„æ£€æµ‹æ–¹æ³•ã€‚ TBD STUN/TURN/ICE åè®®å¦‚ä½•å®ç° NAT æ‰“æ´é¦–å…ˆ P2P åŒæ–¹å¦‚æœåªéš”ç€ 0-1 å±‚ NATï¼Œé‚£æ˜¯ä¸éœ€è¦ä½¿ç”¨ NAT æ‰“æ´æŠ€æœ¯çš„ï¼Œå¯ä»¥ç›´è¿æˆ–è€…åå‘è¿æ¥ã€‚ ä¸‹é¢å°±è®¨è®ºä¸‹ P2P åŒæ–¹éš”ç€ 2 å±‚åŠä»¥ä¸Š NAT çš„åœºæ™¯ä¸‹ï¼Œå¦‚ä½•åˆ©ç”¨ UDP åè®®å®ç° NAT æ‰“æ´ã€‚ ä¸€ä¸ªå®Œæ•´çš„ NAT æ‰“æ´æ–¹æ¡ˆï¼Œéœ€è¦åŒ…å«å¦‚ä¸‹åŠŸèƒ½ï¼š A è·Ÿ B éœ€è¦çŸ¥é“å¯¹æ–¹çš„å…¬ç½‘ IP ä»¥åŠç›‘å¬çš„ç«¯å£å· è§£å†³æ–¹æ³•ï¼šéœ€è¦ä¸€ä¸ªå…¬ç½‘ä¸­ä»‹æ¥ä»‹ç»åŒæ–¹è®¤è¯†ï¼ˆäº¤æ¢ IP/portï¼‰ NAT è¿é€šæ€§æµ‹è¯•ï¼Œéœ€è¦å€ŸåŠ©å…¬ç½‘ä¸»æœºï¼Œæ£€æµ‹åŒæ–¹ä¸­é—´ç½‘ç»œçš„ç±»å‹ é’ˆå¯¹ä¸åŒçš„ NAT ç±»å‹ï¼Œå­˜åœ¨å“ªäº›ç©¿è¶Šæ‰‹æ®µï¼Ÿä»¥ä½•ç§é¡ºåºè¿›è¡Œç©¿è¶Šå°è¯•ï¼Ÿ NAT æ‰“æ´å¯ä»¥ä½¿ç”¨ UDP/TCP ä¸¤ç§ L4 åè®®ï¼Œä½†æ˜¯ TCP é¢å‘è¿æ¥çš„ç‰¹æ€§ä½¿å®ƒåœ¨è¿™ä¸ªåœºæ™¯ä¸­é™åˆ¶æ€§æ›´å¤§ ï¼ˆå…·ä½“é™åˆ¶è§å‚è€ƒæ–‡ç« ï¼Œæˆ‘æœ‰ç©ºå†è¡¥å……ï¼‰ï¼Œå› æ­¤å„ç§ NAT ç©¿è¶Šåè®®é€šå¸¸éƒ½åŸºäº UDP å®ç°ã€‚ æ­¤å¤–ï¼Œå› ä¸º NAT çš„å…·ä½“è¡Œä¸ºæ˜¯éæ ‡å‡†åŒ–çš„ï¼Œè·¯ç”±å™¨çš„é˜²ç«å¢™ç­–ç•¥ä¹Ÿå­˜åœ¨å¾ˆå¤§å˜åŠ¨ç©ºé—´ï¼Œå†æœ‰å°±æ˜¯ RF3489 çš„è¿™ç§ NAT åˆ†ç±»æ–¹æ³•ä¸å¤Ÿç²¾ç¡®ï¼Œè¿™äº›å› ç´ å¯¼è‡´ NAT ç©¿é€èƒ½å¦æˆåŠŸé€šå¸¸éƒ½æ˜¯è°ˆæ¦‚ç‡ã€‚ 1. A ä¸ B åœ¨åŒä¸€å±€åŸŸç½‘ä¸­è¿™æ˜¯æœ€ç®€å•çš„æƒ…å†µï¼Œæœ€ä½³æ–¹æ¡ˆæ˜¯ç›´æ¥èµ°å†…ç½‘é€šè®¯ï¼Œä¸ç»è¿‡ NAT. ç¬¬äºŒä¸ªæ–¹æ¡ˆæ˜¯ï¼Œè¿™ä¸¤ä¸ªåŒä¸€å±€åŸŸç½‘å†…çš„å®¢æˆ·ç«¯ä¸èµ°å†…ç½‘ï¼Œä»ç„¶é€šè¿‡ NAT é€šè®¯ã€‚è¿™ç§é€šè®¯æ–¹å¼è¢«ç§°ä½œã€Œå›ç¯ NAT(Loopback NAT)ã€æˆ–è€…ã€Œå‘å¤¹ NAT(Hairpin NAT)ã€ã€‚å¯¹äºä¸æ”¯æŒæˆ–æœªå¯ç”¨ã€ŒHairpin NATã€çš„ç½‘å…³è®¾å¤‡è€Œè¨€ï¼Œè¿™æ ·çš„é€šè®¯å°è¯•å°†ä¼šå¤±è´¥ï¼ 2. A ä¸ B åˆ†åˆ«åœ¨ä¸åŒçš„å±€åŸŸç½‘ä¸­è¿™æ ·å®é™…ä¸Š A ä¸ B ä¸­é—´å°±éš”äº†ä¸¤ä¸ª NAT ç½‘å…³ï¼Œè¿™æ˜¯æœ€æ™®éçš„ä¸€ç§æƒ…å†µã€‚ STUN/TURN çš„ NAT ç©¿é€æµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š é¦–å…ˆï¼ŒA è·Ÿ B ä¸¤ä¸ªç¨‹åºå¯åŠ¨æ—¶ï¼Œéœ€è¦æŠŠè‡ªå·±çš„å†…å¤–ç½‘ IP åŠç«¯å£ä¿¡æ¯ä¸ŠæŠ¥åˆ°ä¸€å°ä¸­ä»‹æœåŠ¡å™¨ S ç°åœ¨å‡è®¾ A æƒ³è¦è·Ÿ B å»ºç«‹ä¸€ä¸ª P2P è¿æ¥ï¼Œé¦–å…ˆä»–ä»¬éœ€è¦ä» S è·å¾—å¯¹æ–¹çš„ ID A å°† B çš„ ID å‘é€ç»™ä¸­ä»‹æœåŠ¡å™¨ Sï¼Œè¯·æ±‚ä¸ B å»ºç«‹ P2P è¿æ¥ ä¸­ä»‹æœåŠ¡å™¨å°† B çš„å†…å¤–ç½‘ IP åŠç«¯å£ä¿¡æ¯å‘é€ç»™ Aï¼ŒåŒæ—¶å°† A çš„ç½‘ç»œä¿¡æ¯å‘é€ç»™ B A å°è¯•è¯·æ±‚ B çš„å…¬ç½‘åœ°å€ B_public_ip:B_public_port è¿™è‚¯å®šä¼šå¤±è´¥ï¼Œä½†æ˜¯ä¼šåœ¨ A çš„ NAT ç½‘å…³ä¸Šç•™ä¸‹è®°å½•ï¼šA æ›¾ç»è¯·æ±‚è¿‡è¿™ä¸ªåœ°å€ï¼Œé‚£ä¹‹åè¿™ä¸ªåœ°å€å‘åˆ° A çš„ NAT ç½‘å…³çš„æµé‡å°±å¯ä»¥è¿›æ¥äº†ã€‚ B å°è¯•è¯·æ±‚ A çš„å…¬ç½‘åœ°å€ A_public_ip:A_public_port åŒæ ·è¿™è‚¯å®šä¹Ÿä¼šå¤±è´¥ï¼Œä½†æ˜¯ä¼šåœ¨ B çš„ NAT ç½‘å…³ä¸Šæµé‡è®°å½•ï¼šB æ›¾ç»è¯·æ±‚è¿‡è¿™ä¸ªåœ°å€ï¼Œé‚£ä¹‹åè¿™ä¸ªåœ°å€å‘åˆ° B çš„ NAT ç½‘å…³çš„æµé‡å°±å¯ä»¥è¿›æ¥äº† ä¸­é—´çš„ä¸¤å±‚ NAT ç½‘å…³å‡å½¢æˆ NAT ç©¿è¶Šè®°å½•ï¼Œç©¿è¶Šå®Œæˆã€‚ ç°åœ¨ A å°è¯•è¯·æ±‚ B çš„å…¬ç½‘åœ°å€ B_public_ip:B_public_portï¼Œç”±äº B çš„ NAT å·²æœ‰è®°å½•ï¼Œæµé‡é¡ºåˆ©é€šè¿‡ NAT åˆ°è¾¾ç¨‹åº B B å‘é€ç»™ A çš„æ•°æ®ä¹ŸåŒæ ·ï¼Œå¯ä»¥é¡ºåˆ©åˆ°è¾¾ A ä¸Šè¿°æµç¨‹ä¸­çš„å…³é”®ç‚¹åœ¨äºï¼Œå¦‚ä½•æŸ¥å‡ºå†…ç½‘æœåŠ¡å™¨è¢« NAT åˆ†é…çš„å¤–éƒ¨ IP åŠç«¯å£ï¼Œåªè¦æœ‰äº†è¿™ä¸¤ä¸ªä¿¡æ¯ï¼Œå°±å¯ä»¥é€šè¿‡ STUN ä¸­ä»‹æœåŠ¡å™¨äº¤æ¢è¿™ä¸ªä¿¡æ¯ï¼Œç„¶åå®Œæˆè¿æ¥çš„å»ºç«‹äº†ã€‚å®¶åº­æœåŠ¡å™¨é€šå¸¸éƒ½åªæœ‰ä¸€ä¸ªå…¬ç½‘ IPï¼Œæ‰€ä»¥åŸºæœ¬å¯ä»¥è®¤ä¸º IP æ˜¯å›ºå®šçš„ï¼Œå› æ­¤æœ€å…³é”®çš„é—®é¢˜å°±æ˜¯ã€Œå¦‚ä½•çŸ¥é“ NAT ä¸ºä¼šè¯åˆ†é…çš„ç«¯å£åœ°å€ã€ã€‚ å¯¹ç«¯å£çš„é™åˆ¶ä¸¥æ ¼ç¨‹åº¦è·Ÿ NAPT çš„ç±»å‹æœ‰å…³ï¼ŒFull-cone è·Ÿ Restricted cone å¯¹ç«¯å£éƒ½æ²¡æœ‰ä»»ä½•é™åˆ¶ï¼Œæ‰€ä»¥ä¸Šè¿°æµç¨‹è‚¯å®šå¯ä»¥æˆåŠŸï¼› TBD ä¸€ä¸ªç©¿è¶Š Symmetric NATs çš„ STUN è‰æ¡ˆï¼šSymmetric NAT Traversal using STUN åœ¨ä½¿ç”¨ STUN/TURN è¿›è¡Œ NAT ç©¿è¶Šæ—¶ï¼Œæ”¯æŒçš„çš„ NAT ç±»å‹å¦‚ä¸‹è¡¨ã€‚è¡Œä¸åˆ—åˆ†åˆ«ä»£è¡¨åŒæ–¹çš„ NAT ç±»å‹ï¼Œâœ… è¡¨ç¤ºæ”¯æŒ UDP ç©¿è¶Šï¼ŒâŒ è¡¨ç¤º TURN æ— æ³•è¿›è¡Œ UDP ç©¿è¶Šï¼š NAT ç±»å‹ Full Cone Restricted Port-Restricted Symmetric Full Cone âœ… âœ… âœ… âœ… Restricted âœ… âœ… âœ… âœ… Port-Restricted âœ… âœ… âœ… âŒ Symmetric âœ… âœ… âŒ âŒ è¿™ç§åœºæ™¯ä¸‹ TURN åè®®ç»™å‡ºçš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œfallback åˆ°ä¸­ç»§æœåŠ¡å™¨ç­–ç•¥ä½œä¸ºå…œåº•æ–¹æ¡ˆï¼Œä¿è¯è¿æ¥èƒ½æˆåŠŸï¼Œä½†æ˜¯è¿™ä¼šç»™ä¸­ç»§æœåŠ¡å™¨å¸¦æ¥å¾ˆå¤§å‹åŠ›ï¼Œå»¶è¿Ÿç­‰å‚æ•°å°†ä¸å¯é¿å…åœ°å˜å·®ã€‚ 3. A ä¸ B ä¹‹é—´éš”ç€ä¸‰å±‚ä»¥ä¸Šçš„ NATè¿™ç§æƒ…å†µè¾ƒä¸ºå¸¸è§çš„æœ‰ï¼š ISP ä¸ºäº†èŠ‚çº¦ä½¿ç”¨å…¬ç½‘ IPï¼Œç»™ç”¨æˆ·åˆ†é…äº†ä¸ªå¹¿åŸŸç½‘ IPï¼Œä¸­é—´å°±å¤šäº†ä¸ªå¹¿åŸŸç½‘ NAT å¤§åŸå¸‚çš„å„ç§ç§Ÿæˆ¿å…¬å¯“é€šå¸¸åªä¼šä» ISP è´­ä¹°ä¸€ä¸¤æ ¹å®½å¸¦ï¼ŒäºŒæ¬¡åˆ†é”€ç»™æ•´æ ‹æ¥¼çš„ç§Ÿå®¢å…±ç”¨ï¼Œè¿™å°±é€ æˆä¸­é—´å¤šäº†ä¸€å±‚å…¬å¯“çš„ NAT è¿™æ˜¯æœ€å¤æ‚çš„ä¸€ç§æƒ…å†µï¼ŒåŸºæœ¬ä¸Šå°±æ²¡ä»€ä¹ˆ NAT ç©¿é€çš„å¸Œæœ›äº†ï¼Œåªèƒ½èµ°ä¸‹é¢ä»‹ç»çš„å…œåº•ç­–ç•¥â€”â€”æœåŠ¡å™¨ä¸­ç»§ã€‚ TBD å¾…ç»­ 4. ç‰¹æ®Šç©¿è¶Šæ–¹æ¡ˆ - æœåŠ¡å™¨ä¸­ç»§Relay æœåŠ¡å™¨ä¸­ç»§æ˜¯å…¼å®¹æ€§æœ€ä½³ï¼Œä½†æ˜¯æ€§èƒ½æœ€å·®çš„æ–¹æ¡ˆï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ¡ˆä¸‹ï¼Œæ‰€æœ‰çš„ P2P è¿æ¥éƒ½éœ€è¦ç»è¿‡ä¸­ç»§æœåŠ¡å™¨è½¬å‘ï¼Œåœ¨ä½¿ç”¨äººæ•°ä¼—å¤šæ—¶è¿™ä¼šç»™ä¸­ç»§æœåŠ¡å™¨é€ æˆå¾ˆå¤§çš„å‹åŠ›ã€‚ å› æ­¤è¿™ä¸ªæ–¹æ¡ˆé€šå¸¸æ˜¯ç”¨äºå…œåº•çš„ã€‚ ","date":"2022-05-13","objectID":"/posts/about-nat/:5:4","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["NAT","ç½‘ç»œ","NAT ç©¿è¶Š","å†…ç½‘ç©¿é€","è™šæ‹Ÿç½‘ç»œ","P2P","WebRTC"],"title":"NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ","uri":"/posts/about-nat/#4-nat-ç©¿è¶Šåè®®---stunturnice"},{"categories":["tech"],"content":" 4. NAT ç©¿è¶Šåè®® - STUN/TURN/ICEå¦‚æœå¾ˆä¸å¹¸å‰é¢æåˆ°çš„ã€ŒDMZ ä¸»æœºã€/ã€Œé™æ€ç«¯å£è½¬å‘ã€/ã€ŒUPnPã€ ä¸‰é¡¹æŠ€æœ¯ï¼Œä½ çš„è·¯ç”±å™¨éƒ½ä¸æ”¯æŒï¼Œ é‚£ä½ å°±åªèƒ½å€ŸåŠ© NAT ç©¿è¶Šåè®®äº†ã€‚ ç›®å‰æœ‰å¦‚ä¸‹å‡ ä¸ª NAT ç©¿è¶Šåè®®æ ‡å‡†ï¼š RFC3489 Classic STUN Classic STUN æ˜¯ä¸€ä¸ªæ—©æœŸçš„ STUN è§„èŒƒï¼Œå®ƒå®šä¹‰äº†ä¸€æ•´å¥—å®Œæ•´çš„ NAT ç©¿è¶Šæ–¹æ¡ˆï¼Œä½†æ˜¯å› ä¸ºå­˜åœ¨è®¸å¤šé—®é¢˜ï¼Œå·²ç»è¢«åºŸå¼ƒã€‚ RFC5389 - Simple Traversal of UDP Through NATs (STUN) RFC5389 æ‰€å®šä¹‰çš„ STUN åè®®æ˜¯å¯¹ Classic STUN çš„æ”¹è¿›ï¼Œå®ƒçš„å®šä½ä¸å†æ˜¯ä¸€ä¸ªå®Œæ•´çš„ NAT ç©¿è¶Šè§£å†³æ–¹æ¡ˆï¼Œè€Œæ˜¯ä½œä¸ºå…¶ä»–åè®®ï¼ˆä¾‹å¦‚SIPã€FTPã€DNSï¼‰å¤„ç† NAT ç©¿è¶Šé—®é¢˜çš„ä¸€ä¸ªå·¥å…·ã€‚ å…¶å¯ä»¥ç”¨äºæ£€æŸ¥ç½‘ç»œä¸­NATè®¾å¤‡çš„å­˜åœ¨ï¼Œå¹¶ç¡®å®šä¸¤ä¸ªé€šä¿¡ç«¯ç‚¹è¢«NATè®¾å¤‡åˆ†é…çš„IPåœ°å€å’Œç«¯å£å·ã€‚ç„¶åï¼Œé€šè¿‡ICEï¼ˆInteractive Connectivity Establishmentï¼‰ï¼Œè‡ªåŠ¨åˆ›å»ºä¸€æ¡èƒ½å¤Ÿè¿›è¡ŒNATç©¿è¶Šçš„æ•°æ®é€šé“ã€‚ STUN æ”¯æŒé™¤ Symmetric NAT ä¹‹å¤–çš„å¦å¤–ä¸‰ç§ NAT ç±»å‹ RFC5766 - Traversal Using Relays around NAT (TURN) TURN åœ¨ STUN åè®®ä¹‹ä¸Šæ·»åŠ äº†ä¸€ä¸ªä¸­ç»§ï¼Œä»¥ç¡®ä¿åœ¨æ— æ³•å®ç° NAT ç©¿è¶Šçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ fallback åˆ°ç›´æ¥ä½¿ç”¨ä¸­ç»§æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ã€‚ è¿™ä¸ªä¸­ç»§çš„åŸç†ç±»ä¼¼åå‘ä»£ç†ï¼Œå•çº¯è´Ÿè´£æ•°æ®çš„è½¬å‘ åœ¨ç¾å›½æœ‰ä¸€é¡¹æ•°æ®è¡¨ç¤ºåœ¨è¿›è¡Œ P2P ç©¿è¶Šçš„æ—¶å€™ï¼Œç©¿è¶ŠæˆåŠŸçš„æ¦‚ç‡ä¸º 70%ï¼Œä½†æ˜¯åœ¨å›½å†…è¿™ä¸ªæˆåŠŸç‡ 50% å¯èƒ½éƒ½åˆ°ä¸äº†ã€‚å› æ­¤å°±æœ‰å¿…è¦ä½¿ç”¨ TURN åè®®ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯åœ¨ç©¿è¶Šå¤±è´¥çš„æƒ…å†µä¸‹ï¼Œç”¨æˆ·ä»ç„¶èƒ½æ­£å¸¸é€šä¿¡ã€‚ RFC8445 - Interactive Connectivity Establishment (ICE) ä¸€ä¸ª NAT ç©¿è¶Šçš„åå•†åè®®ï¼Œå®ƒç»Ÿä¸€äº† STUN ä¸ TURN ä¸¤ç§åè®®ï¼Œä¼šå°è¯•éå†æ‰€æœ‰å¯èƒ½çš„è¿æ¥æ–¹æ¡ˆã€‚ æ€»çš„æ¥è¯´ï¼Œæ ‡å‡†çš„ NAT ç©¿è¶Šåè®®ä¼˜å…ˆä½¿ç”¨æ‰“æ´ ï¼ˆNAT Hole Pounchingï¼‰æŠ€æœ¯ï¼Œå¦‚æœæ‰“æ´å¤±è´¥ï¼Œå°±ä½¿ç”¨ä¸­ç»§æœåŠ¡å™¨æŠ€æœ¯å…œåº•ï¼Œç¡®ä¿èƒ½æˆåŠŸç©¿è¶Šã€‚ STUN/TURN/ICE çš„ NAT ç±»å‹æ£€æµ‹RFC5389 å®šä¹‰äº†å¯¹ NAT æ˜ å°„ç±»å‹ä»¥åŠè¿‡æ»¤ç±»å‹çš„æ£€æµ‹æ–¹æ³•ã€‚ TBD STUN/TURN/ICE åè®®å¦‚ä½•å®ç° NAT æ‰“æ´é¦–å…ˆ P2P åŒæ–¹å¦‚æœåªéš”ç€ 0-1 å±‚ NATï¼Œé‚£æ˜¯ä¸éœ€è¦ä½¿ç”¨ NAT æ‰“æ´æŠ€æœ¯çš„ï¼Œå¯ä»¥ç›´è¿æˆ–è€…åå‘è¿æ¥ã€‚ ä¸‹é¢å°±è®¨è®ºä¸‹ P2P åŒæ–¹éš”ç€ 2 å±‚åŠä»¥ä¸Š NAT çš„åœºæ™¯ä¸‹ï¼Œå¦‚ä½•åˆ©ç”¨ UDP åè®®å®ç° NAT æ‰“æ´ã€‚ ä¸€ä¸ªå®Œæ•´çš„ NAT æ‰“æ´æ–¹æ¡ˆï¼Œéœ€è¦åŒ…å«å¦‚ä¸‹åŠŸèƒ½ï¼š A è·Ÿ B éœ€è¦çŸ¥é“å¯¹æ–¹çš„å…¬ç½‘ IP ä»¥åŠç›‘å¬çš„ç«¯å£å· è§£å†³æ–¹æ³•ï¼šéœ€è¦ä¸€ä¸ªå…¬ç½‘ä¸­ä»‹æ¥ä»‹ç»åŒæ–¹è®¤è¯†ï¼ˆäº¤æ¢ IP/portï¼‰ NAT è¿é€šæ€§æµ‹è¯•ï¼Œéœ€è¦å€ŸåŠ©å…¬ç½‘ä¸»æœºï¼Œæ£€æµ‹åŒæ–¹ä¸­é—´ç½‘ç»œçš„ç±»å‹ é’ˆå¯¹ä¸åŒçš„ NAT ç±»å‹ï¼Œå­˜åœ¨å“ªäº›ç©¿è¶Šæ‰‹æ®µï¼Ÿä»¥ä½•ç§é¡ºåºè¿›è¡Œç©¿è¶Šå°è¯•ï¼Ÿ NAT æ‰“æ´å¯ä»¥ä½¿ç”¨ UDP/TCP ä¸¤ç§ L4 åè®®ï¼Œä½†æ˜¯ TCP é¢å‘è¿æ¥çš„ç‰¹æ€§ä½¿å®ƒåœ¨è¿™ä¸ªåœºæ™¯ä¸­é™åˆ¶æ€§æ›´å¤§ ï¼ˆå…·ä½“é™åˆ¶è§å‚è€ƒæ–‡ç« ï¼Œæˆ‘æœ‰ç©ºå†è¡¥å……ï¼‰ï¼Œå› æ­¤å„ç§ NAT ç©¿è¶Šåè®®é€šå¸¸éƒ½åŸºäº UDP å®ç°ã€‚ æ­¤å¤–ï¼Œå› ä¸º NAT çš„å…·ä½“è¡Œä¸ºæ˜¯éæ ‡å‡†åŒ–çš„ï¼Œè·¯ç”±å™¨çš„é˜²ç«å¢™ç­–ç•¥ä¹Ÿå­˜åœ¨å¾ˆå¤§å˜åŠ¨ç©ºé—´ï¼Œå†æœ‰å°±æ˜¯ RF3489 çš„è¿™ç§ NAT åˆ†ç±»æ–¹æ³•ä¸å¤Ÿç²¾ç¡®ï¼Œè¿™äº›å› ç´ å¯¼è‡´ NAT ç©¿é€èƒ½å¦æˆåŠŸé€šå¸¸éƒ½æ˜¯è°ˆæ¦‚ç‡ã€‚ 1. A ä¸ B åœ¨åŒä¸€å±€åŸŸç½‘ä¸­è¿™æ˜¯æœ€ç®€å•çš„æƒ…å†µï¼Œæœ€ä½³æ–¹æ¡ˆæ˜¯ç›´æ¥èµ°å†…ç½‘é€šè®¯ï¼Œä¸ç»è¿‡ NAT. ç¬¬äºŒä¸ªæ–¹æ¡ˆæ˜¯ï¼Œè¿™ä¸¤ä¸ªåŒä¸€å±€åŸŸç½‘å†…çš„å®¢æˆ·ç«¯ä¸èµ°å†…ç½‘ï¼Œä»ç„¶é€šè¿‡ NAT é€šè®¯ã€‚è¿™ç§é€šè®¯æ–¹å¼è¢«ç§°ä½œã€Œå›ç¯ NAT(Loopback NAT)ã€æˆ–è€…ã€Œå‘å¤¹ NAT(Hairpin NAT)ã€ã€‚å¯¹äºä¸æ”¯æŒæˆ–æœªå¯ç”¨ã€ŒHairpin NATã€çš„ç½‘å…³è®¾å¤‡è€Œè¨€ï¼Œè¿™æ ·çš„é€šè®¯å°è¯•å°†ä¼šå¤±è´¥ï¼ 2. A ä¸ B åˆ†åˆ«åœ¨ä¸åŒçš„å±€åŸŸç½‘ä¸­è¿™æ ·å®é™…ä¸Š A ä¸ B ä¸­é—´å°±éš”äº†ä¸¤ä¸ª NAT ç½‘å…³ï¼Œè¿™æ˜¯æœ€æ™®éçš„ä¸€ç§æƒ…å†µã€‚ STUN/TURN çš„ NAT ç©¿é€æµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š é¦–å…ˆï¼ŒA è·Ÿ B ä¸¤ä¸ªç¨‹åºå¯åŠ¨æ—¶ï¼Œéœ€è¦æŠŠè‡ªå·±çš„å†…å¤–ç½‘ IP åŠç«¯å£ä¿¡æ¯ä¸ŠæŠ¥åˆ°ä¸€å°ä¸­ä»‹æœåŠ¡å™¨ S ç°åœ¨å‡è®¾ A æƒ³è¦è·Ÿ B å»ºç«‹ä¸€ä¸ª P2P è¿æ¥ï¼Œé¦–å…ˆä»–ä»¬éœ€è¦ä» S è·å¾—å¯¹æ–¹çš„ ID A å°† B çš„ ID å‘é€ç»™ä¸­ä»‹æœåŠ¡å™¨ Sï¼Œè¯·æ±‚ä¸ B å»ºç«‹ P2P è¿æ¥ ä¸­ä»‹æœåŠ¡å™¨å°† B çš„å†…å¤–ç½‘ IP åŠç«¯å£ä¿¡æ¯å‘é€ç»™ Aï¼ŒåŒæ—¶å°† A çš„ç½‘ç»œä¿¡æ¯å‘é€ç»™ B A å°è¯•è¯·æ±‚ B çš„å…¬ç½‘åœ°å€ B_public_ip:B_public_port è¿™è‚¯å®šä¼šå¤±è´¥ï¼Œä½†æ˜¯ä¼šåœ¨ A çš„ NAT ç½‘å…³ä¸Šç•™ä¸‹è®°å½•ï¼šA æ›¾ç»è¯·æ±‚è¿‡è¿™ä¸ªåœ°å€ï¼Œé‚£ä¹‹åè¿™ä¸ªåœ°å€å‘åˆ° A çš„ NAT ç½‘å…³çš„æµé‡å°±å¯ä»¥è¿›æ¥äº†ã€‚ B å°è¯•è¯·æ±‚ A çš„å…¬ç½‘åœ°å€ A_public_ip:A_public_port åŒæ ·è¿™è‚¯å®šä¹Ÿä¼šå¤±è´¥ï¼Œä½†æ˜¯ä¼šåœ¨ B çš„ NAT ç½‘å…³ä¸Šæµé‡è®°å½•ï¼šB æ›¾ç»è¯·æ±‚è¿‡è¿™ä¸ªåœ°å€ï¼Œé‚£ä¹‹åè¿™ä¸ªåœ°å€å‘åˆ° B çš„ NAT ç½‘å…³çš„æµé‡å°±å¯ä»¥è¿›æ¥äº† ä¸­é—´çš„ä¸¤å±‚ NAT ç½‘å…³å‡å½¢æˆ NAT ç©¿è¶Šè®°å½•ï¼Œç©¿è¶Šå®Œæˆã€‚ ç°åœ¨ A å°è¯•è¯·æ±‚ B çš„å…¬ç½‘åœ°å€ B_public_ip:B_public_portï¼Œç”±äº B çš„ NAT å·²æœ‰è®°å½•ï¼Œæµé‡é¡ºåˆ©é€šè¿‡ NAT åˆ°è¾¾ç¨‹åº B B å‘é€ç»™ A çš„æ•°æ®ä¹ŸåŒæ ·ï¼Œå¯ä»¥é¡ºåˆ©åˆ°è¾¾ A ä¸Šè¿°æµç¨‹ä¸­çš„å…³é”®ç‚¹åœ¨äºï¼Œå¦‚ä½•æŸ¥å‡ºå†…ç½‘æœåŠ¡å™¨è¢« NAT åˆ†é…çš„å¤–éƒ¨ IP åŠç«¯å£ï¼Œåªè¦æœ‰äº†è¿™ä¸¤ä¸ªä¿¡æ¯ï¼Œå°±å¯ä»¥é€šè¿‡ STUN ä¸­ä»‹æœåŠ¡å™¨äº¤æ¢è¿™ä¸ªä¿¡æ¯ï¼Œç„¶åå®Œæˆè¿æ¥çš„å»ºç«‹äº†ã€‚å®¶åº­æœåŠ¡å™¨é€šå¸¸éƒ½åªæœ‰ä¸€ä¸ªå…¬ç½‘ IPï¼Œæ‰€ä»¥åŸºæœ¬å¯ä»¥è®¤ä¸º IP æ˜¯å›ºå®šçš„ï¼Œå› æ­¤æœ€å…³é”®çš„é—®é¢˜å°±æ˜¯ã€Œå¦‚ä½•çŸ¥é“ NAT ä¸ºä¼šè¯åˆ†é…çš„ç«¯å£åœ°å€ã€ã€‚ å¯¹ç«¯å£çš„é™åˆ¶ä¸¥æ ¼ç¨‹åº¦è·Ÿ NAPT çš„ç±»å‹æœ‰å…³ï¼ŒFull-cone è·Ÿ Restricted cone å¯¹ç«¯å£éƒ½æ²¡æœ‰ä»»ä½•é™åˆ¶ï¼Œæ‰€ä»¥ä¸Šè¿°æµç¨‹è‚¯å®šå¯ä»¥æˆåŠŸï¼› TBD ä¸€ä¸ªç©¿è¶Š Symmetric NATs çš„ STUN è‰æ¡ˆï¼šSymmetric NAT Traversal using STUN åœ¨ä½¿ç”¨ STUN/TURN è¿›è¡Œ NAT ç©¿è¶Šæ—¶ï¼Œæ”¯æŒçš„çš„ NAT ç±»å‹å¦‚ä¸‹è¡¨ã€‚è¡Œä¸åˆ—åˆ†åˆ«ä»£è¡¨åŒæ–¹çš„ NAT ç±»å‹ï¼Œâœ… è¡¨ç¤ºæ”¯æŒ UDP ç©¿è¶Šï¼ŒâŒ è¡¨ç¤º TURN æ— æ³•è¿›è¡Œ UDP ç©¿è¶Šï¼š NAT ç±»å‹ Full Cone Restricted Port-Restricted Symmetric Full Cone âœ… âœ… âœ… âœ… Restricted âœ… âœ… âœ… âœ… Port-Restricted âœ… âœ… âœ… âŒ Symmetric âœ… âœ… âŒ âŒ è¿™ç§åœºæ™¯ä¸‹ TURN åè®®ç»™å‡ºçš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œfallback åˆ°ä¸­ç»§æœåŠ¡å™¨ç­–ç•¥ä½œä¸ºå…œåº•æ–¹æ¡ˆï¼Œä¿è¯è¿æ¥èƒ½æˆåŠŸï¼Œä½†æ˜¯è¿™ä¼šç»™ä¸­ç»§æœåŠ¡å™¨å¸¦æ¥å¾ˆå¤§å‹åŠ›ï¼Œå»¶è¿Ÿç­‰å‚æ•°å°†ä¸å¯é¿å…åœ°å˜å·®ã€‚ 3. A ä¸ B ä¹‹é—´éš”ç€ä¸‰å±‚ä»¥ä¸Šçš„ NATè¿™ç§æƒ…å†µè¾ƒä¸ºå¸¸è§çš„æœ‰ï¼š ISP ä¸ºäº†èŠ‚çº¦ä½¿ç”¨å…¬ç½‘ IPï¼Œç»™ç”¨æˆ·åˆ†é…äº†ä¸ªå¹¿åŸŸç½‘ IPï¼Œä¸­é—´å°±å¤šäº†ä¸ªå¹¿åŸŸç½‘ NAT å¤§åŸå¸‚çš„å„ç§ç§Ÿæˆ¿å…¬å¯“é€šå¸¸åªä¼šä» ISP è´­ä¹°ä¸€ä¸¤æ ¹å®½å¸¦ï¼ŒäºŒæ¬¡åˆ†é”€ç»™æ•´æ ‹æ¥¼çš„ç§Ÿå®¢å…±ç”¨ï¼Œè¿™å°±é€ æˆä¸­é—´å¤šäº†ä¸€å±‚å…¬å¯“çš„ NAT è¿™æ˜¯æœ€å¤æ‚çš„ä¸€ç§æƒ…å†µï¼ŒåŸºæœ¬ä¸Šå°±æ²¡ä»€ä¹ˆ NAT ç©¿é€çš„å¸Œæœ›äº†ï¼Œåªèƒ½èµ°ä¸‹é¢ä»‹ç»çš„å…œåº•ç­–ç•¥â€”â€”æœåŠ¡å™¨ä¸­ç»§ã€‚ TBD å¾…ç»­ 4. ç‰¹æ®Šç©¿è¶Šæ–¹æ¡ˆ - æœåŠ¡å™¨ä¸­ç»§Relay æœåŠ¡å™¨ä¸­ç»§æ˜¯å…¼å®¹æ€§æœ€ä½³ï¼Œä½†æ˜¯æ€§èƒ½æœ€å·®çš„æ–¹æ¡ˆï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ¡ˆä¸‹ï¼Œæ‰€æœ‰çš„ P2P è¿æ¥éƒ½éœ€è¦ç»è¿‡ä¸­ç»§æœåŠ¡å™¨è½¬å‘ï¼Œåœ¨ä½¿ç”¨äººæ•°ä¼—å¤šæ—¶è¿™ä¼šç»™ä¸­ç»§æœåŠ¡å™¨é€ æˆå¾ˆå¤§çš„å‹åŠ›ã€‚ å› æ­¤è¿™ä¸ªæ–¹æ¡ˆé€šå¸¸æ˜¯ç”¨äºå…œåº•çš„ã€‚ ","date":"2022-05-13","objectID":"/posts/about-nat/:5:4","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["NAT","ç½‘ç»œ","NAT ç©¿è¶Š","å†…ç½‘ç©¿é€","è™šæ‹Ÿç½‘ç»œ","P2P","WebRTC"],"title":"NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ","uri":"/posts/about-nat/#stunturnice-çš„-nat-ç±»å‹æ£€æµ‹"},{"categories":["tech"],"content":" 4. NAT ç©¿è¶Šåè®® - STUN/TURN/ICEå¦‚æœå¾ˆä¸å¹¸å‰é¢æåˆ°çš„ã€ŒDMZ ä¸»æœºã€/ã€Œé™æ€ç«¯å£è½¬å‘ã€/ã€ŒUPnPã€ ä¸‰é¡¹æŠ€æœ¯ï¼Œä½ çš„è·¯ç”±å™¨éƒ½ä¸æ”¯æŒï¼Œ é‚£ä½ å°±åªèƒ½å€ŸåŠ© NAT ç©¿è¶Šåè®®äº†ã€‚ ç›®å‰æœ‰å¦‚ä¸‹å‡ ä¸ª NAT ç©¿è¶Šåè®®æ ‡å‡†ï¼š RFC3489 Classic STUN Classic STUN æ˜¯ä¸€ä¸ªæ—©æœŸçš„ STUN è§„èŒƒï¼Œå®ƒå®šä¹‰äº†ä¸€æ•´å¥—å®Œæ•´çš„ NAT ç©¿è¶Šæ–¹æ¡ˆï¼Œä½†æ˜¯å› ä¸ºå­˜åœ¨è®¸å¤šé—®é¢˜ï¼Œå·²ç»è¢«åºŸå¼ƒã€‚ RFC5389 - Simple Traversal of UDP Through NATs (STUN) RFC5389 æ‰€å®šä¹‰çš„ STUN åè®®æ˜¯å¯¹ Classic STUN çš„æ”¹è¿›ï¼Œå®ƒçš„å®šä½ä¸å†æ˜¯ä¸€ä¸ªå®Œæ•´çš„ NAT ç©¿è¶Šè§£å†³æ–¹æ¡ˆï¼Œè€Œæ˜¯ä½œä¸ºå…¶ä»–åè®®ï¼ˆä¾‹å¦‚SIPã€FTPã€DNSï¼‰å¤„ç† NAT ç©¿è¶Šé—®é¢˜çš„ä¸€ä¸ªå·¥å…·ã€‚ å…¶å¯ä»¥ç”¨äºæ£€æŸ¥ç½‘ç»œä¸­NATè®¾å¤‡çš„å­˜åœ¨ï¼Œå¹¶ç¡®å®šä¸¤ä¸ªé€šä¿¡ç«¯ç‚¹è¢«NATè®¾å¤‡åˆ†é…çš„IPåœ°å€å’Œç«¯å£å·ã€‚ç„¶åï¼Œé€šè¿‡ICEï¼ˆInteractive Connectivity Establishmentï¼‰ï¼Œè‡ªåŠ¨åˆ›å»ºä¸€æ¡èƒ½å¤Ÿè¿›è¡ŒNATç©¿è¶Šçš„æ•°æ®é€šé“ã€‚ STUN æ”¯æŒé™¤ Symmetric NAT ä¹‹å¤–çš„å¦å¤–ä¸‰ç§ NAT ç±»å‹ RFC5766 - Traversal Using Relays around NAT (TURN) TURN åœ¨ STUN åè®®ä¹‹ä¸Šæ·»åŠ äº†ä¸€ä¸ªä¸­ç»§ï¼Œä»¥ç¡®ä¿åœ¨æ— æ³•å®ç° NAT ç©¿è¶Šçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ fallback åˆ°ç›´æ¥ä½¿ç”¨ä¸­ç»§æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ã€‚ è¿™ä¸ªä¸­ç»§çš„åŸç†ç±»ä¼¼åå‘ä»£ç†ï¼Œå•çº¯è´Ÿè´£æ•°æ®çš„è½¬å‘ åœ¨ç¾å›½æœ‰ä¸€é¡¹æ•°æ®è¡¨ç¤ºåœ¨è¿›è¡Œ P2P ç©¿è¶Šçš„æ—¶å€™ï¼Œç©¿è¶ŠæˆåŠŸçš„æ¦‚ç‡ä¸º 70%ï¼Œä½†æ˜¯åœ¨å›½å†…è¿™ä¸ªæˆåŠŸç‡ 50% å¯èƒ½éƒ½åˆ°ä¸äº†ã€‚å› æ­¤å°±æœ‰å¿…è¦ä½¿ç”¨ TURN åè®®ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯åœ¨ç©¿è¶Šå¤±è´¥çš„æƒ…å†µä¸‹ï¼Œç”¨æˆ·ä»ç„¶èƒ½æ­£å¸¸é€šä¿¡ã€‚ RFC8445 - Interactive Connectivity Establishment (ICE) ä¸€ä¸ª NAT ç©¿è¶Šçš„åå•†åè®®ï¼Œå®ƒç»Ÿä¸€äº† STUN ä¸ TURN ä¸¤ç§åè®®ï¼Œä¼šå°è¯•éå†æ‰€æœ‰å¯èƒ½çš„è¿æ¥æ–¹æ¡ˆã€‚ æ€»çš„æ¥è¯´ï¼Œæ ‡å‡†çš„ NAT ç©¿è¶Šåè®®ä¼˜å…ˆä½¿ç”¨æ‰“æ´ ï¼ˆNAT Hole Pounchingï¼‰æŠ€æœ¯ï¼Œå¦‚æœæ‰“æ´å¤±è´¥ï¼Œå°±ä½¿ç”¨ä¸­ç»§æœåŠ¡å™¨æŠ€æœ¯å…œåº•ï¼Œç¡®ä¿èƒ½æˆåŠŸç©¿è¶Šã€‚ STUN/TURN/ICE çš„ NAT ç±»å‹æ£€æµ‹RFC5389 å®šä¹‰äº†å¯¹ NAT æ˜ å°„ç±»å‹ä»¥åŠè¿‡æ»¤ç±»å‹çš„æ£€æµ‹æ–¹æ³•ã€‚ TBD STUN/TURN/ICE åè®®å¦‚ä½•å®ç° NAT æ‰“æ´é¦–å…ˆ P2P åŒæ–¹å¦‚æœåªéš”ç€ 0-1 å±‚ NATï¼Œé‚£æ˜¯ä¸éœ€è¦ä½¿ç”¨ NAT æ‰“æ´æŠ€æœ¯çš„ï¼Œå¯ä»¥ç›´è¿æˆ–è€…åå‘è¿æ¥ã€‚ ä¸‹é¢å°±è®¨è®ºä¸‹ P2P åŒæ–¹éš”ç€ 2 å±‚åŠä»¥ä¸Š NAT çš„åœºæ™¯ä¸‹ï¼Œå¦‚ä½•åˆ©ç”¨ UDP åè®®å®ç° NAT æ‰“æ´ã€‚ ä¸€ä¸ªå®Œæ•´çš„ NAT æ‰“æ´æ–¹æ¡ˆï¼Œéœ€è¦åŒ…å«å¦‚ä¸‹åŠŸèƒ½ï¼š A è·Ÿ B éœ€è¦çŸ¥é“å¯¹æ–¹çš„å…¬ç½‘ IP ä»¥åŠç›‘å¬çš„ç«¯å£å· è§£å†³æ–¹æ³•ï¼šéœ€è¦ä¸€ä¸ªå…¬ç½‘ä¸­ä»‹æ¥ä»‹ç»åŒæ–¹è®¤è¯†ï¼ˆäº¤æ¢ IP/portï¼‰ NAT è¿é€šæ€§æµ‹è¯•ï¼Œéœ€è¦å€ŸåŠ©å…¬ç½‘ä¸»æœºï¼Œæ£€æµ‹åŒæ–¹ä¸­é—´ç½‘ç»œçš„ç±»å‹ é’ˆå¯¹ä¸åŒçš„ NAT ç±»å‹ï¼Œå­˜åœ¨å“ªäº›ç©¿è¶Šæ‰‹æ®µï¼Ÿä»¥ä½•ç§é¡ºåºè¿›è¡Œç©¿è¶Šå°è¯•ï¼Ÿ NAT æ‰“æ´å¯ä»¥ä½¿ç”¨ UDP/TCP ä¸¤ç§ L4 åè®®ï¼Œä½†æ˜¯ TCP é¢å‘è¿æ¥çš„ç‰¹æ€§ä½¿å®ƒåœ¨è¿™ä¸ªåœºæ™¯ä¸­é™åˆ¶æ€§æ›´å¤§ ï¼ˆå…·ä½“é™åˆ¶è§å‚è€ƒæ–‡ç« ï¼Œæˆ‘æœ‰ç©ºå†è¡¥å……ï¼‰ï¼Œå› æ­¤å„ç§ NAT ç©¿è¶Šåè®®é€šå¸¸éƒ½åŸºäº UDP å®ç°ã€‚ æ­¤å¤–ï¼Œå› ä¸º NAT çš„å…·ä½“è¡Œä¸ºæ˜¯éæ ‡å‡†åŒ–çš„ï¼Œè·¯ç”±å™¨çš„é˜²ç«å¢™ç­–ç•¥ä¹Ÿå­˜åœ¨å¾ˆå¤§å˜åŠ¨ç©ºé—´ï¼Œå†æœ‰å°±æ˜¯ RF3489 çš„è¿™ç§ NAT åˆ†ç±»æ–¹æ³•ä¸å¤Ÿç²¾ç¡®ï¼Œè¿™äº›å› ç´ å¯¼è‡´ NAT ç©¿é€èƒ½å¦æˆåŠŸé€šå¸¸éƒ½æ˜¯è°ˆæ¦‚ç‡ã€‚ 1. A ä¸ B åœ¨åŒä¸€å±€åŸŸç½‘ä¸­è¿™æ˜¯æœ€ç®€å•çš„æƒ…å†µï¼Œæœ€ä½³æ–¹æ¡ˆæ˜¯ç›´æ¥èµ°å†…ç½‘é€šè®¯ï¼Œä¸ç»è¿‡ NAT. ç¬¬äºŒä¸ªæ–¹æ¡ˆæ˜¯ï¼Œè¿™ä¸¤ä¸ªåŒä¸€å±€åŸŸç½‘å†…çš„å®¢æˆ·ç«¯ä¸èµ°å†…ç½‘ï¼Œä»ç„¶é€šè¿‡ NAT é€šè®¯ã€‚è¿™ç§é€šè®¯æ–¹å¼è¢«ç§°ä½œã€Œå›ç¯ NAT(Loopback NAT)ã€æˆ–è€…ã€Œå‘å¤¹ NAT(Hairpin NAT)ã€ã€‚å¯¹äºä¸æ”¯æŒæˆ–æœªå¯ç”¨ã€ŒHairpin NATã€çš„ç½‘å…³è®¾å¤‡è€Œè¨€ï¼Œè¿™æ ·çš„é€šè®¯å°è¯•å°†ä¼šå¤±è´¥ï¼ 2. A ä¸ B åˆ†åˆ«åœ¨ä¸åŒçš„å±€åŸŸç½‘ä¸­è¿™æ ·å®é™…ä¸Š A ä¸ B ä¸­é—´å°±éš”äº†ä¸¤ä¸ª NAT ç½‘å…³ï¼Œè¿™æ˜¯æœ€æ™®éçš„ä¸€ç§æƒ…å†µã€‚ STUN/TURN çš„ NAT ç©¿é€æµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š é¦–å…ˆï¼ŒA è·Ÿ B ä¸¤ä¸ªç¨‹åºå¯åŠ¨æ—¶ï¼Œéœ€è¦æŠŠè‡ªå·±çš„å†…å¤–ç½‘ IP åŠç«¯å£ä¿¡æ¯ä¸ŠæŠ¥åˆ°ä¸€å°ä¸­ä»‹æœåŠ¡å™¨ S ç°åœ¨å‡è®¾ A æƒ³è¦è·Ÿ B å»ºç«‹ä¸€ä¸ª P2P è¿æ¥ï¼Œé¦–å…ˆä»–ä»¬éœ€è¦ä» S è·å¾—å¯¹æ–¹çš„ ID A å°† B çš„ ID å‘é€ç»™ä¸­ä»‹æœåŠ¡å™¨ Sï¼Œè¯·æ±‚ä¸ B å»ºç«‹ P2P è¿æ¥ ä¸­ä»‹æœåŠ¡å™¨å°† B çš„å†…å¤–ç½‘ IP åŠç«¯å£ä¿¡æ¯å‘é€ç»™ Aï¼ŒåŒæ—¶å°† A çš„ç½‘ç»œä¿¡æ¯å‘é€ç»™ B A å°è¯•è¯·æ±‚ B çš„å…¬ç½‘åœ°å€ B_public_ip:B_public_port è¿™è‚¯å®šä¼šå¤±è´¥ï¼Œä½†æ˜¯ä¼šåœ¨ A çš„ NAT ç½‘å…³ä¸Šç•™ä¸‹è®°å½•ï¼šA æ›¾ç»è¯·æ±‚è¿‡è¿™ä¸ªåœ°å€ï¼Œé‚£ä¹‹åè¿™ä¸ªåœ°å€å‘åˆ° A çš„ NAT ç½‘å…³çš„æµé‡å°±å¯ä»¥è¿›æ¥äº†ã€‚ B å°è¯•è¯·æ±‚ A çš„å…¬ç½‘åœ°å€ A_public_ip:A_public_port åŒæ ·è¿™è‚¯å®šä¹Ÿä¼šå¤±è´¥ï¼Œä½†æ˜¯ä¼šåœ¨ B çš„ NAT ç½‘å…³ä¸Šæµé‡è®°å½•ï¼šB æ›¾ç»è¯·æ±‚è¿‡è¿™ä¸ªåœ°å€ï¼Œé‚£ä¹‹åè¿™ä¸ªåœ°å€å‘åˆ° B çš„ NAT ç½‘å…³çš„æµé‡å°±å¯ä»¥è¿›æ¥äº† ä¸­é—´çš„ä¸¤å±‚ NAT ç½‘å…³å‡å½¢æˆ NAT ç©¿è¶Šè®°å½•ï¼Œç©¿è¶Šå®Œæˆã€‚ ç°åœ¨ A å°è¯•è¯·æ±‚ B çš„å…¬ç½‘åœ°å€ B_public_ip:B_public_portï¼Œç”±äº B çš„ NAT å·²æœ‰è®°å½•ï¼Œæµé‡é¡ºåˆ©é€šè¿‡ NAT åˆ°è¾¾ç¨‹åº B B å‘é€ç»™ A çš„æ•°æ®ä¹ŸåŒæ ·ï¼Œå¯ä»¥é¡ºåˆ©åˆ°è¾¾ A ä¸Šè¿°æµç¨‹ä¸­çš„å…³é”®ç‚¹åœ¨äºï¼Œå¦‚ä½•æŸ¥å‡ºå†…ç½‘æœåŠ¡å™¨è¢« NAT åˆ†é…çš„å¤–éƒ¨ IP åŠç«¯å£ï¼Œåªè¦æœ‰äº†è¿™ä¸¤ä¸ªä¿¡æ¯ï¼Œå°±å¯ä»¥é€šè¿‡ STUN ä¸­ä»‹æœåŠ¡å™¨äº¤æ¢è¿™ä¸ªä¿¡æ¯ï¼Œç„¶åå®Œæˆè¿æ¥çš„å»ºç«‹äº†ã€‚å®¶åº­æœåŠ¡å™¨é€šå¸¸éƒ½åªæœ‰ä¸€ä¸ªå…¬ç½‘ IPï¼Œæ‰€ä»¥åŸºæœ¬å¯ä»¥è®¤ä¸º IP æ˜¯å›ºå®šçš„ï¼Œå› æ­¤æœ€å…³é”®çš„é—®é¢˜å°±æ˜¯ã€Œå¦‚ä½•çŸ¥é“ NAT ä¸ºä¼šè¯åˆ†é…çš„ç«¯å£åœ°å€ã€ã€‚ å¯¹ç«¯å£çš„é™åˆ¶ä¸¥æ ¼ç¨‹åº¦è·Ÿ NAPT çš„ç±»å‹æœ‰å…³ï¼ŒFull-cone è·Ÿ Restricted cone å¯¹ç«¯å£éƒ½æ²¡æœ‰ä»»ä½•é™åˆ¶ï¼Œæ‰€ä»¥ä¸Šè¿°æµç¨‹è‚¯å®šå¯ä»¥æˆåŠŸï¼› TBD ä¸€ä¸ªç©¿è¶Š Symmetric NATs çš„ STUN è‰æ¡ˆï¼šSymmetric NAT Traversal using STUN åœ¨ä½¿ç”¨ STUN/TURN è¿›è¡Œ NAT ç©¿è¶Šæ—¶ï¼Œæ”¯æŒçš„çš„ NAT ç±»å‹å¦‚ä¸‹è¡¨ã€‚è¡Œä¸åˆ—åˆ†åˆ«ä»£è¡¨åŒæ–¹çš„ NAT ç±»å‹ï¼Œâœ… è¡¨ç¤ºæ”¯æŒ UDP ç©¿è¶Šï¼ŒâŒ è¡¨ç¤º TURN æ— æ³•è¿›è¡Œ UDP ç©¿è¶Šï¼š NAT ç±»å‹ Full Cone Restricted Port-Restricted Symmetric Full Cone âœ… âœ… âœ… âœ… Restricted âœ… âœ… âœ… âœ… Port-Restricted âœ… âœ… âœ… âŒ Symmetric âœ… âœ… âŒ âŒ è¿™ç§åœºæ™¯ä¸‹ TURN åè®®ç»™å‡ºçš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œfallback åˆ°ä¸­ç»§æœåŠ¡å™¨ç­–ç•¥ä½œä¸ºå…œåº•æ–¹æ¡ˆï¼Œä¿è¯è¿æ¥èƒ½æˆåŠŸï¼Œä½†æ˜¯è¿™ä¼šç»™ä¸­ç»§æœåŠ¡å™¨å¸¦æ¥å¾ˆå¤§å‹åŠ›ï¼Œå»¶è¿Ÿç­‰å‚æ•°å°†ä¸å¯é¿å…åœ°å˜å·®ã€‚ 3. A ä¸ B ä¹‹é—´éš”ç€ä¸‰å±‚ä»¥ä¸Šçš„ NATè¿™ç§æƒ…å†µè¾ƒä¸ºå¸¸è§çš„æœ‰ï¼š ISP ä¸ºäº†èŠ‚çº¦ä½¿ç”¨å…¬ç½‘ IPï¼Œç»™ç”¨æˆ·åˆ†é…äº†ä¸ªå¹¿åŸŸç½‘ IPï¼Œä¸­é—´å°±å¤šäº†ä¸ªå¹¿åŸŸç½‘ NAT å¤§åŸå¸‚çš„å„ç§ç§Ÿæˆ¿å…¬å¯“é€šå¸¸åªä¼šä» ISP è´­ä¹°ä¸€ä¸¤æ ¹å®½å¸¦ï¼ŒäºŒæ¬¡åˆ†é”€ç»™æ•´æ ‹æ¥¼çš„ç§Ÿå®¢å…±ç”¨ï¼Œè¿™å°±é€ æˆä¸­é—´å¤šäº†ä¸€å±‚å…¬å¯“çš„ NAT è¿™æ˜¯æœ€å¤æ‚çš„ä¸€ç§æƒ…å†µï¼ŒåŸºæœ¬ä¸Šå°±æ²¡ä»€ä¹ˆ NAT ç©¿é€çš„å¸Œæœ›äº†ï¼Œåªèƒ½èµ°ä¸‹é¢ä»‹ç»çš„å…œåº•ç­–ç•¥â€”â€”æœåŠ¡å™¨ä¸­ç»§ã€‚ TBD å¾…ç»­ 4. ç‰¹æ®Šç©¿è¶Šæ–¹æ¡ˆ - æœåŠ¡å™¨ä¸­ç»§Relay æœåŠ¡å™¨ä¸­ç»§æ˜¯å…¼å®¹æ€§æœ€ä½³ï¼Œä½†æ˜¯æ€§èƒ½æœ€å·®çš„æ–¹æ¡ˆï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ¡ˆä¸‹ï¼Œæ‰€æœ‰çš„ P2P è¿æ¥éƒ½éœ€è¦ç»è¿‡ä¸­ç»§æœåŠ¡å™¨è½¬å‘ï¼Œåœ¨ä½¿ç”¨äººæ•°ä¼—å¤šæ—¶è¿™ä¼šç»™ä¸­ç»§æœåŠ¡å™¨é€ æˆå¾ˆå¤§çš„å‹åŠ›ã€‚ å› æ­¤è¿™ä¸ªæ–¹æ¡ˆé€šå¸¸æ˜¯ç”¨äºå…œåº•çš„ã€‚ ","date":"2022-05-13","objectID":"/posts/about-nat/:5:4","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["NAT","ç½‘ç»œ","NAT ç©¿è¶Š","å†…ç½‘ç©¿é€","è™šæ‹Ÿç½‘ç»œ","P2P","WebRTC"],"title":"NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ","uri":"/posts/about-nat/#stunturnice-åè®®å¦‚ä½•å®ç°-nat-æ‰“æ´"},{"categories":["tech"],"content":" 4. NAT ç©¿è¶Šåè®® - STUN/TURN/ICEå¦‚æœå¾ˆä¸å¹¸å‰é¢æåˆ°çš„ã€ŒDMZ ä¸»æœºã€/ã€Œé™æ€ç«¯å£è½¬å‘ã€/ã€ŒUPnPã€ ä¸‰é¡¹æŠ€æœ¯ï¼Œä½ çš„è·¯ç”±å™¨éƒ½ä¸æ”¯æŒï¼Œ é‚£ä½ å°±åªèƒ½å€ŸåŠ© NAT ç©¿è¶Šåè®®äº†ã€‚ ç›®å‰æœ‰å¦‚ä¸‹å‡ ä¸ª NAT ç©¿è¶Šåè®®æ ‡å‡†ï¼š RFC3489 Classic STUN Classic STUN æ˜¯ä¸€ä¸ªæ—©æœŸçš„ STUN è§„èŒƒï¼Œå®ƒå®šä¹‰äº†ä¸€æ•´å¥—å®Œæ•´çš„ NAT ç©¿è¶Šæ–¹æ¡ˆï¼Œä½†æ˜¯å› ä¸ºå­˜åœ¨è®¸å¤šé—®é¢˜ï¼Œå·²ç»è¢«åºŸå¼ƒã€‚ RFC5389 - Simple Traversal of UDP Through NATs (STUN) RFC5389 æ‰€å®šä¹‰çš„ STUN åè®®æ˜¯å¯¹ Classic STUN çš„æ”¹è¿›ï¼Œå®ƒçš„å®šä½ä¸å†æ˜¯ä¸€ä¸ªå®Œæ•´çš„ NAT ç©¿è¶Šè§£å†³æ–¹æ¡ˆï¼Œè€Œæ˜¯ä½œä¸ºå…¶ä»–åè®®ï¼ˆä¾‹å¦‚SIPã€FTPã€DNSï¼‰å¤„ç† NAT ç©¿è¶Šé—®é¢˜çš„ä¸€ä¸ªå·¥å…·ã€‚ å…¶å¯ä»¥ç”¨äºæ£€æŸ¥ç½‘ç»œä¸­NATè®¾å¤‡çš„å­˜åœ¨ï¼Œå¹¶ç¡®å®šä¸¤ä¸ªé€šä¿¡ç«¯ç‚¹è¢«NATè®¾å¤‡åˆ†é…çš„IPåœ°å€å’Œç«¯å£å·ã€‚ç„¶åï¼Œé€šè¿‡ICEï¼ˆInteractive Connectivity Establishmentï¼‰ï¼Œè‡ªåŠ¨åˆ›å»ºä¸€æ¡èƒ½å¤Ÿè¿›è¡ŒNATç©¿è¶Šçš„æ•°æ®é€šé“ã€‚ STUN æ”¯æŒé™¤ Symmetric NAT ä¹‹å¤–çš„å¦å¤–ä¸‰ç§ NAT ç±»å‹ RFC5766 - Traversal Using Relays around NAT (TURN) TURN åœ¨ STUN åè®®ä¹‹ä¸Šæ·»åŠ äº†ä¸€ä¸ªä¸­ç»§ï¼Œä»¥ç¡®ä¿åœ¨æ— æ³•å®ç° NAT ç©¿è¶Šçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ fallback åˆ°ç›´æ¥ä½¿ç”¨ä¸­ç»§æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ã€‚ è¿™ä¸ªä¸­ç»§çš„åŸç†ç±»ä¼¼åå‘ä»£ç†ï¼Œå•çº¯è´Ÿè´£æ•°æ®çš„è½¬å‘ åœ¨ç¾å›½æœ‰ä¸€é¡¹æ•°æ®è¡¨ç¤ºåœ¨è¿›è¡Œ P2P ç©¿è¶Šçš„æ—¶å€™ï¼Œç©¿è¶ŠæˆåŠŸçš„æ¦‚ç‡ä¸º 70%ï¼Œä½†æ˜¯åœ¨å›½å†…è¿™ä¸ªæˆåŠŸç‡ 50% å¯èƒ½éƒ½åˆ°ä¸äº†ã€‚å› æ­¤å°±æœ‰å¿…è¦ä½¿ç”¨ TURN åè®®ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯åœ¨ç©¿è¶Šå¤±è´¥çš„æƒ…å†µä¸‹ï¼Œç”¨æˆ·ä»ç„¶èƒ½æ­£å¸¸é€šä¿¡ã€‚ RFC8445 - Interactive Connectivity Establishment (ICE) ä¸€ä¸ª NAT ç©¿è¶Šçš„åå•†åè®®ï¼Œå®ƒç»Ÿä¸€äº† STUN ä¸ TURN ä¸¤ç§åè®®ï¼Œä¼šå°è¯•éå†æ‰€æœ‰å¯èƒ½çš„è¿æ¥æ–¹æ¡ˆã€‚ æ€»çš„æ¥è¯´ï¼Œæ ‡å‡†çš„ NAT ç©¿è¶Šåè®®ä¼˜å…ˆä½¿ç”¨æ‰“æ´ ï¼ˆNAT Hole Pounchingï¼‰æŠ€æœ¯ï¼Œå¦‚æœæ‰“æ´å¤±è´¥ï¼Œå°±ä½¿ç”¨ä¸­ç»§æœåŠ¡å™¨æŠ€æœ¯å…œåº•ï¼Œç¡®ä¿èƒ½æˆåŠŸç©¿è¶Šã€‚ STUN/TURN/ICE çš„ NAT ç±»å‹æ£€æµ‹RFC5389 å®šä¹‰äº†å¯¹ NAT æ˜ å°„ç±»å‹ä»¥åŠè¿‡æ»¤ç±»å‹çš„æ£€æµ‹æ–¹æ³•ã€‚ TBD STUN/TURN/ICE åè®®å¦‚ä½•å®ç° NAT æ‰“æ´é¦–å…ˆ P2P åŒæ–¹å¦‚æœåªéš”ç€ 0-1 å±‚ NATï¼Œé‚£æ˜¯ä¸éœ€è¦ä½¿ç”¨ NAT æ‰“æ´æŠ€æœ¯çš„ï¼Œå¯ä»¥ç›´è¿æˆ–è€…åå‘è¿æ¥ã€‚ ä¸‹é¢å°±è®¨è®ºä¸‹ P2P åŒæ–¹éš”ç€ 2 å±‚åŠä»¥ä¸Š NAT çš„åœºæ™¯ä¸‹ï¼Œå¦‚ä½•åˆ©ç”¨ UDP åè®®å®ç° NAT æ‰“æ´ã€‚ ä¸€ä¸ªå®Œæ•´çš„ NAT æ‰“æ´æ–¹æ¡ˆï¼Œéœ€è¦åŒ…å«å¦‚ä¸‹åŠŸèƒ½ï¼š A è·Ÿ B éœ€è¦çŸ¥é“å¯¹æ–¹çš„å…¬ç½‘ IP ä»¥åŠç›‘å¬çš„ç«¯å£å· è§£å†³æ–¹æ³•ï¼šéœ€è¦ä¸€ä¸ªå…¬ç½‘ä¸­ä»‹æ¥ä»‹ç»åŒæ–¹è®¤è¯†ï¼ˆäº¤æ¢ IP/portï¼‰ NAT è¿é€šæ€§æµ‹è¯•ï¼Œéœ€è¦å€ŸåŠ©å…¬ç½‘ä¸»æœºï¼Œæ£€æµ‹åŒæ–¹ä¸­é—´ç½‘ç»œçš„ç±»å‹ é’ˆå¯¹ä¸åŒçš„ NAT ç±»å‹ï¼Œå­˜åœ¨å“ªäº›ç©¿è¶Šæ‰‹æ®µï¼Ÿä»¥ä½•ç§é¡ºåºè¿›è¡Œç©¿è¶Šå°è¯•ï¼Ÿ NAT æ‰“æ´å¯ä»¥ä½¿ç”¨ UDP/TCP ä¸¤ç§ L4 åè®®ï¼Œä½†æ˜¯ TCP é¢å‘è¿æ¥çš„ç‰¹æ€§ä½¿å®ƒåœ¨è¿™ä¸ªåœºæ™¯ä¸­é™åˆ¶æ€§æ›´å¤§ ï¼ˆå…·ä½“é™åˆ¶è§å‚è€ƒæ–‡ç« ï¼Œæˆ‘æœ‰ç©ºå†è¡¥å……ï¼‰ï¼Œå› æ­¤å„ç§ NAT ç©¿è¶Šåè®®é€šå¸¸éƒ½åŸºäº UDP å®ç°ã€‚ æ­¤å¤–ï¼Œå› ä¸º NAT çš„å…·ä½“è¡Œä¸ºæ˜¯éæ ‡å‡†åŒ–çš„ï¼Œè·¯ç”±å™¨çš„é˜²ç«å¢™ç­–ç•¥ä¹Ÿå­˜åœ¨å¾ˆå¤§å˜åŠ¨ç©ºé—´ï¼Œå†æœ‰å°±æ˜¯ RF3489 çš„è¿™ç§ NAT åˆ†ç±»æ–¹æ³•ä¸å¤Ÿç²¾ç¡®ï¼Œè¿™äº›å› ç´ å¯¼è‡´ NAT ç©¿é€èƒ½å¦æˆåŠŸé€šå¸¸éƒ½æ˜¯è°ˆæ¦‚ç‡ã€‚ 1. A ä¸ B åœ¨åŒä¸€å±€åŸŸç½‘ä¸­è¿™æ˜¯æœ€ç®€å•çš„æƒ…å†µï¼Œæœ€ä½³æ–¹æ¡ˆæ˜¯ç›´æ¥èµ°å†…ç½‘é€šè®¯ï¼Œä¸ç»è¿‡ NAT. ç¬¬äºŒä¸ªæ–¹æ¡ˆæ˜¯ï¼Œè¿™ä¸¤ä¸ªåŒä¸€å±€åŸŸç½‘å†…çš„å®¢æˆ·ç«¯ä¸èµ°å†…ç½‘ï¼Œä»ç„¶é€šè¿‡ NAT é€šè®¯ã€‚è¿™ç§é€šè®¯æ–¹å¼è¢«ç§°ä½œã€Œå›ç¯ NAT(Loopback NAT)ã€æˆ–è€…ã€Œå‘å¤¹ NAT(Hairpin NAT)ã€ã€‚å¯¹äºä¸æ”¯æŒæˆ–æœªå¯ç”¨ã€ŒHairpin NATã€çš„ç½‘å…³è®¾å¤‡è€Œè¨€ï¼Œè¿™æ ·çš„é€šè®¯å°è¯•å°†ä¼šå¤±è´¥ï¼ 2. A ä¸ B åˆ†åˆ«åœ¨ä¸åŒçš„å±€åŸŸç½‘ä¸­è¿™æ ·å®é™…ä¸Š A ä¸ B ä¸­é—´å°±éš”äº†ä¸¤ä¸ª NAT ç½‘å…³ï¼Œè¿™æ˜¯æœ€æ™®éçš„ä¸€ç§æƒ…å†µã€‚ STUN/TURN çš„ NAT ç©¿é€æµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š é¦–å…ˆï¼ŒA è·Ÿ B ä¸¤ä¸ªç¨‹åºå¯åŠ¨æ—¶ï¼Œéœ€è¦æŠŠè‡ªå·±çš„å†…å¤–ç½‘ IP åŠç«¯å£ä¿¡æ¯ä¸ŠæŠ¥åˆ°ä¸€å°ä¸­ä»‹æœåŠ¡å™¨ S ç°åœ¨å‡è®¾ A æƒ³è¦è·Ÿ B å»ºç«‹ä¸€ä¸ª P2P è¿æ¥ï¼Œé¦–å…ˆä»–ä»¬éœ€è¦ä» S è·å¾—å¯¹æ–¹çš„ ID A å°† B çš„ ID å‘é€ç»™ä¸­ä»‹æœåŠ¡å™¨ Sï¼Œè¯·æ±‚ä¸ B å»ºç«‹ P2P è¿æ¥ ä¸­ä»‹æœåŠ¡å™¨å°† B çš„å†…å¤–ç½‘ IP åŠç«¯å£ä¿¡æ¯å‘é€ç»™ Aï¼ŒåŒæ—¶å°† A çš„ç½‘ç»œä¿¡æ¯å‘é€ç»™ B A å°è¯•è¯·æ±‚ B çš„å…¬ç½‘åœ°å€ B_public_ip:B_public_port è¿™è‚¯å®šä¼šå¤±è´¥ï¼Œä½†æ˜¯ä¼šåœ¨ A çš„ NAT ç½‘å…³ä¸Šç•™ä¸‹è®°å½•ï¼šA æ›¾ç»è¯·æ±‚è¿‡è¿™ä¸ªåœ°å€ï¼Œé‚£ä¹‹åè¿™ä¸ªåœ°å€å‘åˆ° A çš„ NAT ç½‘å…³çš„æµé‡å°±å¯ä»¥è¿›æ¥äº†ã€‚ B å°è¯•è¯·æ±‚ A çš„å…¬ç½‘åœ°å€ A_public_ip:A_public_port åŒæ ·è¿™è‚¯å®šä¹Ÿä¼šå¤±è´¥ï¼Œä½†æ˜¯ä¼šåœ¨ B çš„ NAT ç½‘å…³ä¸Šæµé‡è®°å½•ï¼šB æ›¾ç»è¯·æ±‚è¿‡è¿™ä¸ªåœ°å€ï¼Œé‚£ä¹‹åè¿™ä¸ªåœ°å€å‘åˆ° B çš„ NAT ç½‘å…³çš„æµé‡å°±å¯ä»¥è¿›æ¥äº† ä¸­é—´çš„ä¸¤å±‚ NAT ç½‘å…³å‡å½¢æˆ NAT ç©¿è¶Šè®°å½•ï¼Œç©¿è¶Šå®Œæˆã€‚ ç°åœ¨ A å°è¯•è¯·æ±‚ B çš„å…¬ç½‘åœ°å€ B_public_ip:B_public_portï¼Œç”±äº B çš„ NAT å·²æœ‰è®°å½•ï¼Œæµé‡é¡ºåˆ©é€šè¿‡ NAT åˆ°è¾¾ç¨‹åº B B å‘é€ç»™ A çš„æ•°æ®ä¹ŸåŒæ ·ï¼Œå¯ä»¥é¡ºåˆ©åˆ°è¾¾ A ä¸Šè¿°æµç¨‹ä¸­çš„å…³é”®ç‚¹åœ¨äºï¼Œå¦‚ä½•æŸ¥å‡ºå†…ç½‘æœåŠ¡å™¨è¢« NAT åˆ†é…çš„å¤–éƒ¨ IP åŠç«¯å£ï¼Œåªè¦æœ‰äº†è¿™ä¸¤ä¸ªä¿¡æ¯ï¼Œå°±å¯ä»¥é€šè¿‡ STUN ä¸­ä»‹æœåŠ¡å™¨äº¤æ¢è¿™ä¸ªä¿¡æ¯ï¼Œç„¶åå®Œæˆè¿æ¥çš„å»ºç«‹äº†ã€‚å®¶åº­æœåŠ¡å™¨é€šå¸¸éƒ½åªæœ‰ä¸€ä¸ªå…¬ç½‘ IPï¼Œæ‰€ä»¥åŸºæœ¬å¯ä»¥è®¤ä¸º IP æ˜¯å›ºå®šçš„ï¼Œå› æ­¤æœ€å…³é”®çš„é—®é¢˜å°±æ˜¯ã€Œå¦‚ä½•çŸ¥é“ NAT ä¸ºä¼šè¯åˆ†é…çš„ç«¯å£åœ°å€ã€ã€‚ å¯¹ç«¯å£çš„é™åˆ¶ä¸¥æ ¼ç¨‹åº¦è·Ÿ NAPT çš„ç±»å‹æœ‰å…³ï¼ŒFull-cone è·Ÿ Restricted cone å¯¹ç«¯å£éƒ½æ²¡æœ‰ä»»ä½•é™åˆ¶ï¼Œæ‰€ä»¥ä¸Šè¿°æµç¨‹è‚¯å®šå¯ä»¥æˆåŠŸï¼› TBD ä¸€ä¸ªç©¿è¶Š Symmetric NATs çš„ STUN è‰æ¡ˆï¼šSymmetric NAT Traversal using STUN åœ¨ä½¿ç”¨ STUN/TURN è¿›è¡Œ NAT ç©¿è¶Šæ—¶ï¼Œæ”¯æŒçš„çš„ NAT ç±»å‹å¦‚ä¸‹è¡¨ã€‚è¡Œä¸åˆ—åˆ†åˆ«ä»£è¡¨åŒæ–¹çš„ NAT ç±»å‹ï¼Œâœ… è¡¨ç¤ºæ”¯æŒ UDP ç©¿è¶Šï¼ŒâŒ è¡¨ç¤º TURN æ— æ³•è¿›è¡Œ UDP ç©¿è¶Šï¼š NAT ç±»å‹ Full Cone Restricted Port-Restricted Symmetric Full Cone âœ… âœ… âœ… âœ… Restricted âœ… âœ… âœ… âœ… Port-Restricted âœ… âœ… âœ… âŒ Symmetric âœ… âœ… âŒ âŒ è¿™ç§åœºæ™¯ä¸‹ TURN åè®®ç»™å‡ºçš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œfallback åˆ°ä¸­ç»§æœåŠ¡å™¨ç­–ç•¥ä½œä¸ºå…œåº•æ–¹æ¡ˆï¼Œä¿è¯è¿æ¥èƒ½æˆåŠŸï¼Œä½†æ˜¯è¿™ä¼šç»™ä¸­ç»§æœåŠ¡å™¨å¸¦æ¥å¾ˆå¤§å‹åŠ›ï¼Œå»¶è¿Ÿç­‰å‚æ•°å°†ä¸å¯é¿å…åœ°å˜å·®ã€‚ 3. A ä¸ B ä¹‹é—´éš”ç€ä¸‰å±‚ä»¥ä¸Šçš„ NATè¿™ç§æƒ…å†µè¾ƒä¸ºå¸¸è§çš„æœ‰ï¼š ISP ä¸ºäº†èŠ‚çº¦ä½¿ç”¨å…¬ç½‘ IPï¼Œç»™ç”¨æˆ·åˆ†é…äº†ä¸ªå¹¿åŸŸç½‘ IPï¼Œä¸­é—´å°±å¤šäº†ä¸ªå¹¿åŸŸç½‘ NAT å¤§åŸå¸‚çš„å„ç§ç§Ÿæˆ¿å…¬å¯“é€šå¸¸åªä¼šä» ISP è´­ä¹°ä¸€ä¸¤æ ¹å®½å¸¦ï¼ŒäºŒæ¬¡åˆ†é”€ç»™æ•´æ ‹æ¥¼çš„ç§Ÿå®¢å…±ç”¨ï¼Œè¿™å°±é€ æˆä¸­é—´å¤šäº†ä¸€å±‚å…¬å¯“çš„ NAT è¿™æ˜¯æœ€å¤æ‚çš„ä¸€ç§æƒ…å†µï¼ŒåŸºæœ¬ä¸Šå°±æ²¡ä»€ä¹ˆ NAT ç©¿é€çš„å¸Œæœ›äº†ï¼Œåªèƒ½èµ°ä¸‹é¢ä»‹ç»çš„å…œåº•ç­–ç•¥â€”â€”æœåŠ¡å™¨ä¸­ç»§ã€‚ TBD å¾…ç»­ 4. ç‰¹æ®Šç©¿è¶Šæ–¹æ¡ˆ - æœåŠ¡å™¨ä¸­ç»§Relay æœåŠ¡å™¨ä¸­ç»§æ˜¯å…¼å®¹æ€§æœ€ä½³ï¼Œä½†æ˜¯æ€§èƒ½æœ€å·®çš„æ–¹æ¡ˆï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ¡ˆä¸‹ï¼Œæ‰€æœ‰çš„ P2P è¿æ¥éƒ½éœ€è¦ç»è¿‡ä¸­ç»§æœåŠ¡å™¨è½¬å‘ï¼Œåœ¨ä½¿ç”¨äººæ•°ä¼—å¤šæ—¶è¿™ä¼šç»™ä¸­ç»§æœåŠ¡å™¨é€ æˆå¾ˆå¤§çš„å‹åŠ›ã€‚ å› æ­¤è¿™ä¸ªæ–¹æ¡ˆé€šå¸¸æ˜¯ç”¨äºå…œåº•çš„ã€‚ ","date":"2022-05-13","objectID":"/posts/about-nat/:5:4","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["NAT","ç½‘ç»œ","NAT ç©¿è¶Š","å†…ç½‘ç©¿é€","è™šæ‹Ÿç½‘ç»œ","P2P","WebRTC"],"title":"NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ","uri":"/posts/about-nat/#1-a-ä¸-b-åœ¨åŒä¸€å±€åŸŸç½‘ä¸­"},{"categories":["tech"],"content":" 4. NAT ç©¿è¶Šåè®® - STUN/TURN/ICEå¦‚æœå¾ˆä¸å¹¸å‰é¢æåˆ°çš„ã€ŒDMZ ä¸»æœºã€/ã€Œé™æ€ç«¯å£è½¬å‘ã€/ã€ŒUPnPã€ ä¸‰é¡¹æŠ€æœ¯ï¼Œä½ çš„è·¯ç”±å™¨éƒ½ä¸æ”¯æŒï¼Œ é‚£ä½ å°±åªèƒ½å€ŸåŠ© NAT ç©¿è¶Šåè®®äº†ã€‚ ç›®å‰æœ‰å¦‚ä¸‹å‡ ä¸ª NAT ç©¿è¶Šåè®®æ ‡å‡†ï¼š RFC3489 Classic STUN Classic STUN æ˜¯ä¸€ä¸ªæ—©æœŸçš„ STUN è§„èŒƒï¼Œå®ƒå®šä¹‰äº†ä¸€æ•´å¥—å®Œæ•´çš„ NAT ç©¿è¶Šæ–¹æ¡ˆï¼Œä½†æ˜¯å› ä¸ºå­˜åœ¨è®¸å¤šé—®é¢˜ï¼Œå·²ç»è¢«åºŸå¼ƒã€‚ RFC5389 - Simple Traversal of UDP Through NATs (STUN) RFC5389 æ‰€å®šä¹‰çš„ STUN åè®®æ˜¯å¯¹ Classic STUN çš„æ”¹è¿›ï¼Œå®ƒçš„å®šä½ä¸å†æ˜¯ä¸€ä¸ªå®Œæ•´çš„ NAT ç©¿è¶Šè§£å†³æ–¹æ¡ˆï¼Œè€Œæ˜¯ä½œä¸ºå…¶ä»–åè®®ï¼ˆä¾‹å¦‚SIPã€FTPã€DNSï¼‰å¤„ç† NAT ç©¿è¶Šé—®é¢˜çš„ä¸€ä¸ªå·¥å…·ã€‚ å…¶å¯ä»¥ç”¨äºæ£€æŸ¥ç½‘ç»œä¸­NATè®¾å¤‡çš„å­˜åœ¨ï¼Œå¹¶ç¡®å®šä¸¤ä¸ªé€šä¿¡ç«¯ç‚¹è¢«NATè®¾å¤‡åˆ†é…çš„IPåœ°å€å’Œç«¯å£å·ã€‚ç„¶åï¼Œé€šè¿‡ICEï¼ˆInteractive Connectivity Establishmentï¼‰ï¼Œè‡ªåŠ¨åˆ›å»ºä¸€æ¡èƒ½å¤Ÿè¿›è¡ŒNATç©¿è¶Šçš„æ•°æ®é€šé“ã€‚ STUN æ”¯æŒé™¤ Symmetric NAT ä¹‹å¤–çš„å¦å¤–ä¸‰ç§ NAT ç±»å‹ RFC5766 - Traversal Using Relays around NAT (TURN) TURN åœ¨ STUN åè®®ä¹‹ä¸Šæ·»åŠ äº†ä¸€ä¸ªä¸­ç»§ï¼Œä»¥ç¡®ä¿åœ¨æ— æ³•å®ç° NAT ç©¿è¶Šçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ fallback åˆ°ç›´æ¥ä½¿ç”¨ä¸­ç»§æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ã€‚ è¿™ä¸ªä¸­ç»§çš„åŸç†ç±»ä¼¼åå‘ä»£ç†ï¼Œå•çº¯è´Ÿè´£æ•°æ®çš„è½¬å‘ åœ¨ç¾å›½æœ‰ä¸€é¡¹æ•°æ®è¡¨ç¤ºåœ¨è¿›è¡Œ P2P ç©¿è¶Šçš„æ—¶å€™ï¼Œç©¿è¶ŠæˆåŠŸçš„æ¦‚ç‡ä¸º 70%ï¼Œä½†æ˜¯åœ¨å›½å†…è¿™ä¸ªæˆåŠŸç‡ 50% å¯èƒ½éƒ½åˆ°ä¸äº†ã€‚å› æ­¤å°±æœ‰å¿…è¦ä½¿ç”¨ TURN åè®®ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯åœ¨ç©¿è¶Šå¤±è´¥çš„æƒ…å†µä¸‹ï¼Œç”¨æˆ·ä»ç„¶èƒ½æ­£å¸¸é€šä¿¡ã€‚ RFC8445 - Interactive Connectivity Establishment (ICE) ä¸€ä¸ª NAT ç©¿è¶Šçš„åå•†åè®®ï¼Œå®ƒç»Ÿä¸€äº† STUN ä¸ TURN ä¸¤ç§åè®®ï¼Œä¼šå°è¯•éå†æ‰€æœ‰å¯èƒ½çš„è¿æ¥æ–¹æ¡ˆã€‚ æ€»çš„æ¥è¯´ï¼Œæ ‡å‡†çš„ NAT ç©¿è¶Šåè®®ä¼˜å…ˆä½¿ç”¨æ‰“æ´ ï¼ˆNAT Hole Pounchingï¼‰æŠ€æœ¯ï¼Œå¦‚æœæ‰“æ´å¤±è´¥ï¼Œå°±ä½¿ç”¨ä¸­ç»§æœåŠ¡å™¨æŠ€æœ¯å…œåº•ï¼Œç¡®ä¿èƒ½æˆåŠŸç©¿è¶Šã€‚ STUN/TURN/ICE çš„ NAT ç±»å‹æ£€æµ‹RFC5389 å®šä¹‰äº†å¯¹ NAT æ˜ å°„ç±»å‹ä»¥åŠè¿‡æ»¤ç±»å‹çš„æ£€æµ‹æ–¹æ³•ã€‚ TBD STUN/TURN/ICE åè®®å¦‚ä½•å®ç° NAT æ‰“æ´é¦–å…ˆ P2P åŒæ–¹å¦‚æœåªéš”ç€ 0-1 å±‚ NATï¼Œé‚£æ˜¯ä¸éœ€è¦ä½¿ç”¨ NAT æ‰“æ´æŠ€æœ¯çš„ï¼Œå¯ä»¥ç›´è¿æˆ–è€…åå‘è¿æ¥ã€‚ ä¸‹é¢å°±è®¨è®ºä¸‹ P2P åŒæ–¹éš”ç€ 2 å±‚åŠä»¥ä¸Š NAT çš„åœºæ™¯ä¸‹ï¼Œå¦‚ä½•åˆ©ç”¨ UDP åè®®å®ç° NAT æ‰“æ´ã€‚ ä¸€ä¸ªå®Œæ•´çš„ NAT æ‰“æ´æ–¹æ¡ˆï¼Œéœ€è¦åŒ…å«å¦‚ä¸‹åŠŸèƒ½ï¼š A è·Ÿ B éœ€è¦çŸ¥é“å¯¹æ–¹çš„å…¬ç½‘ IP ä»¥åŠç›‘å¬çš„ç«¯å£å· è§£å†³æ–¹æ³•ï¼šéœ€è¦ä¸€ä¸ªå…¬ç½‘ä¸­ä»‹æ¥ä»‹ç»åŒæ–¹è®¤è¯†ï¼ˆäº¤æ¢ IP/portï¼‰ NAT è¿é€šæ€§æµ‹è¯•ï¼Œéœ€è¦å€ŸåŠ©å…¬ç½‘ä¸»æœºï¼Œæ£€æµ‹åŒæ–¹ä¸­é—´ç½‘ç»œçš„ç±»å‹ é’ˆå¯¹ä¸åŒçš„ NAT ç±»å‹ï¼Œå­˜åœ¨å“ªäº›ç©¿è¶Šæ‰‹æ®µï¼Ÿä»¥ä½•ç§é¡ºåºè¿›è¡Œç©¿è¶Šå°è¯•ï¼Ÿ NAT æ‰“æ´å¯ä»¥ä½¿ç”¨ UDP/TCP ä¸¤ç§ L4 åè®®ï¼Œä½†æ˜¯ TCP é¢å‘è¿æ¥çš„ç‰¹æ€§ä½¿å®ƒåœ¨è¿™ä¸ªåœºæ™¯ä¸­é™åˆ¶æ€§æ›´å¤§ ï¼ˆå…·ä½“é™åˆ¶è§å‚è€ƒæ–‡ç« ï¼Œæˆ‘æœ‰ç©ºå†è¡¥å……ï¼‰ï¼Œå› æ­¤å„ç§ NAT ç©¿è¶Šåè®®é€šå¸¸éƒ½åŸºäº UDP å®ç°ã€‚ æ­¤å¤–ï¼Œå› ä¸º NAT çš„å…·ä½“è¡Œä¸ºæ˜¯éæ ‡å‡†åŒ–çš„ï¼Œè·¯ç”±å™¨çš„é˜²ç«å¢™ç­–ç•¥ä¹Ÿå­˜åœ¨å¾ˆå¤§å˜åŠ¨ç©ºé—´ï¼Œå†æœ‰å°±æ˜¯ RF3489 çš„è¿™ç§ NAT åˆ†ç±»æ–¹æ³•ä¸å¤Ÿç²¾ç¡®ï¼Œè¿™äº›å› ç´ å¯¼è‡´ NAT ç©¿é€èƒ½å¦æˆåŠŸé€šå¸¸éƒ½æ˜¯è°ˆæ¦‚ç‡ã€‚ 1. A ä¸ B åœ¨åŒä¸€å±€åŸŸç½‘ä¸­è¿™æ˜¯æœ€ç®€å•çš„æƒ…å†µï¼Œæœ€ä½³æ–¹æ¡ˆæ˜¯ç›´æ¥èµ°å†…ç½‘é€šè®¯ï¼Œä¸ç»è¿‡ NAT. ç¬¬äºŒä¸ªæ–¹æ¡ˆæ˜¯ï¼Œè¿™ä¸¤ä¸ªåŒä¸€å±€åŸŸç½‘å†…çš„å®¢æˆ·ç«¯ä¸èµ°å†…ç½‘ï¼Œä»ç„¶é€šè¿‡ NAT é€šè®¯ã€‚è¿™ç§é€šè®¯æ–¹å¼è¢«ç§°ä½œã€Œå›ç¯ NAT(Loopback NAT)ã€æˆ–è€…ã€Œå‘å¤¹ NAT(Hairpin NAT)ã€ã€‚å¯¹äºä¸æ”¯æŒæˆ–æœªå¯ç”¨ã€ŒHairpin NATã€çš„ç½‘å…³è®¾å¤‡è€Œè¨€ï¼Œè¿™æ ·çš„é€šè®¯å°è¯•å°†ä¼šå¤±è´¥ï¼ 2. A ä¸ B åˆ†åˆ«åœ¨ä¸åŒçš„å±€åŸŸç½‘ä¸­è¿™æ ·å®é™…ä¸Š A ä¸ B ä¸­é—´å°±éš”äº†ä¸¤ä¸ª NAT ç½‘å…³ï¼Œè¿™æ˜¯æœ€æ™®éçš„ä¸€ç§æƒ…å†µã€‚ STUN/TURN çš„ NAT ç©¿é€æµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š é¦–å…ˆï¼ŒA è·Ÿ B ä¸¤ä¸ªç¨‹åºå¯åŠ¨æ—¶ï¼Œéœ€è¦æŠŠè‡ªå·±çš„å†…å¤–ç½‘ IP åŠç«¯å£ä¿¡æ¯ä¸ŠæŠ¥åˆ°ä¸€å°ä¸­ä»‹æœåŠ¡å™¨ S ç°åœ¨å‡è®¾ A æƒ³è¦è·Ÿ B å»ºç«‹ä¸€ä¸ª P2P è¿æ¥ï¼Œé¦–å…ˆä»–ä»¬éœ€è¦ä» S è·å¾—å¯¹æ–¹çš„ ID A å°† B çš„ ID å‘é€ç»™ä¸­ä»‹æœåŠ¡å™¨ Sï¼Œè¯·æ±‚ä¸ B å»ºç«‹ P2P è¿æ¥ ä¸­ä»‹æœåŠ¡å™¨å°† B çš„å†…å¤–ç½‘ IP åŠç«¯å£ä¿¡æ¯å‘é€ç»™ Aï¼ŒåŒæ—¶å°† A çš„ç½‘ç»œä¿¡æ¯å‘é€ç»™ B A å°è¯•è¯·æ±‚ B çš„å…¬ç½‘åœ°å€ B_public_ip:B_public_port è¿™è‚¯å®šä¼šå¤±è´¥ï¼Œä½†æ˜¯ä¼šåœ¨ A çš„ NAT ç½‘å…³ä¸Šç•™ä¸‹è®°å½•ï¼šA æ›¾ç»è¯·æ±‚è¿‡è¿™ä¸ªåœ°å€ï¼Œé‚£ä¹‹åè¿™ä¸ªåœ°å€å‘åˆ° A çš„ NAT ç½‘å…³çš„æµé‡å°±å¯ä»¥è¿›æ¥äº†ã€‚ B å°è¯•è¯·æ±‚ A çš„å…¬ç½‘åœ°å€ A_public_ip:A_public_port åŒæ ·è¿™è‚¯å®šä¹Ÿä¼šå¤±è´¥ï¼Œä½†æ˜¯ä¼šåœ¨ B çš„ NAT ç½‘å…³ä¸Šæµé‡è®°å½•ï¼šB æ›¾ç»è¯·æ±‚è¿‡è¿™ä¸ªåœ°å€ï¼Œé‚£ä¹‹åè¿™ä¸ªåœ°å€å‘åˆ° B çš„ NAT ç½‘å…³çš„æµé‡å°±å¯ä»¥è¿›æ¥äº† ä¸­é—´çš„ä¸¤å±‚ NAT ç½‘å…³å‡å½¢æˆ NAT ç©¿è¶Šè®°å½•ï¼Œç©¿è¶Šå®Œæˆã€‚ ç°åœ¨ A å°è¯•è¯·æ±‚ B çš„å…¬ç½‘åœ°å€ B_public_ip:B_public_portï¼Œç”±äº B çš„ NAT å·²æœ‰è®°å½•ï¼Œæµé‡é¡ºåˆ©é€šè¿‡ NAT åˆ°è¾¾ç¨‹åº B B å‘é€ç»™ A çš„æ•°æ®ä¹ŸåŒæ ·ï¼Œå¯ä»¥é¡ºåˆ©åˆ°è¾¾ A ä¸Šè¿°æµç¨‹ä¸­çš„å…³é”®ç‚¹åœ¨äºï¼Œå¦‚ä½•æŸ¥å‡ºå†…ç½‘æœåŠ¡å™¨è¢« NAT åˆ†é…çš„å¤–éƒ¨ IP åŠç«¯å£ï¼Œåªè¦æœ‰äº†è¿™ä¸¤ä¸ªä¿¡æ¯ï¼Œå°±å¯ä»¥é€šè¿‡ STUN ä¸­ä»‹æœåŠ¡å™¨äº¤æ¢è¿™ä¸ªä¿¡æ¯ï¼Œç„¶åå®Œæˆè¿æ¥çš„å»ºç«‹äº†ã€‚å®¶åº­æœåŠ¡å™¨é€šå¸¸éƒ½åªæœ‰ä¸€ä¸ªå…¬ç½‘ IPï¼Œæ‰€ä»¥åŸºæœ¬å¯ä»¥è®¤ä¸º IP æ˜¯å›ºå®šçš„ï¼Œå› æ­¤æœ€å…³é”®çš„é—®é¢˜å°±æ˜¯ã€Œå¦‚ä½•çŸ¥é“ NAT ä¸ºä¼šè¯åˆ†é…çš„ç«¯å£åœ°å€ã€ã€‚ å¯¹ç«¯å£çš„é™åˆ¶ä¸¥æ ¼ç¨‹åº¦è·Ÿ NAPT çš„ç±»å‹æœ‰å…³ï¼ŒFull-cone è·Ÿ Restricted cone å¯¹ç«¯å£éƒ½æ²¡æœ‰ä»»ä½•é™åˆ¶ï¼Œæ‰€ä»¥ä¸Šè¿°æµç¨‹è‚¯å®šå¯ä»¥æˆåŠŸï¼› TBD ä¸€ä¸ªç©¿è¶Š Symmetric NATs çš„ STUN è‰æ¡ˆï¼šSymmetric NAT Traversal using STUN åœ¨ä½¿ç”¨ STUN/TURN è¿›è¡Œ NAT ç©¿è¶Šæ—¶ï¼Œæ”¯æŒçš„çš„ NAT ç±»å‹å¦‚ä¸‹è¡¨ã€‚è¡Œä¸åˆ—åˆ†åˆ«ä»£è¡¨åŒæ–¹çš„ NAT ç±»å‹ï¼Œâœ… è¡¨ç¤ºæ”¯æŒ UDP ç©¿è¶Šï¼ŒâŒ è¡¨ç¤º TURN æ— æ³•è¿›è¡Œ UDP ç©¿è¶Šï¼š NAT ç±»å‹ Full Cone Restricted Port-Restricted Symmetric Full Cone âœ… âœ… âœ… âœ… Restricted âœ… âœ… âœ… âœ… Port-Restricted âœ… âœ… âœ… âŒ Symmetric âœ… âœ… âŒ âŒ è¿™ç§åœºæ™¯ä¸‹ TURN åè®®ç»™å‡ºçš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œfallback åˆ°ä¸­ç»§æœåŠ¡å™¨ç­–ç•¥ä½œä¸ºå…œåº•æ–¹æ¡ˆï¼Œä¿è¯è¿æ¥èƒ½æˆåŠŸï¼Œä½†æ˜¯è¿™ä¼šç»™ä¸­ç»§æœåŠ¡å™¨å¸¦æ¥å¾ˆå¤§å‹åŠ›ï¼Œå»¶è¿Ÿç­‰å‚æ•°å°†ä¸å¯é¿å…åœ°å˜å·®ã€‚ 3. A ä¸ B ä¹‹é—´éš”ç€ä¸‰å±‚ä»¥ä¸Šçš„ NATè¿™ç§æƒ…å†µè¾ƒä¸ºå¸¸è§çš„æœ‰ï¼š ISP ä¸ºäº†èŠ‚çº¦ä½¿ç”¨å…¬ç½‘ IPï¼Œç»™ç”¨æˆ·åˆ†é…äº†ä¸ªå¹¿åŸŸç½‘ IPï¼Œä¸­é—´å°±å¤šäº†ä¸ªå¹¿åŸŸç½‘ NAT å¤§åŸå¸‚çš„å„ç§ç§Ÿæˆ¿å…¬å¯“é€šå¸¸åªä¼šä» ISP è´­ä¹°ä¸€ä¸¤æ ¹å®½å¸¦ï¼ŒäºŒæ¬¡åˆ†é”€ç»™æ•´æ ‹æ¥¼çš„ç§Ÿå®¢å…±ç”¨ï¼Œè¿™å°±é€ æˆä¸­é—´å¤šäº†ä¸€å±‚å…¬å¯“çš„ NAT è¿™æ˜¯æœ€å¤æ‚çš„ä¸€ç§æƒ…å†µï¼ŒåŸºæœ¬ä¸Šå°±æ²¡ä»€ä¹ˆ NAT ç©¿é€çš„å¸Œæœ›äº†ï¼Œåªèƒ½èµ°ä¸‹é¢ä»‹ç»çš„å…œåº•ç­–ç•¥â€”â€”æœåŠ¡å™¨ä¸­ç»§ã€‚ TBD å¾…ç»­ 4. ç‰¹æ®Šç©¿è¶Šæ–¹æ¡ˆ - æœåŠ¡å™¨ä¸­ç»§Relay æœåŠ¡å™¨ä¸­ç»§æ˜¯å…¼å®¹æ€§æœ€ä½³ï¼Œä½†æ˜¯æ€§èƒ½æœ€å·®çš„æ–¹æ¡ˆï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ¡ˆä¸‹ï¼Œæ‰€æœ‰çš„ P2P è¿æ¥éƒ½éœ€è¦ç»è¿‡ä¸­ç»§æœåŠ¡å™¨è½¬å‘ï¼Œåœ¨ä½¿ç”¨äººæ•°ä¼—å¤šæ—¶è¿™ä¼šç»™ä¸­ç»§æœåŠ¡å™¨é€ æˆå¾ˆå¤§çš„å‹åŠ›ã€‚ å› æ­¤è¿™ä¸ªæ–¹æ¡ˆé€šå¸¸æ˜¯ç”¨äºå…œåº•çš„ã€‚ ","date":"2022-05-13","objectID":"/posts/about-nat/:5:4","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["NAT","ç½‘ç»œ","NAT ç©¿è¶Š","å†…ç½‘ç©¿é€","è™šæ‹Ÿç½‘ç»œ","P2P","WebRTC"],"title":"NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ","uri":"/posts/about-nat/#2-a-ä¸-b-åˆ†åˆ«åœ¨ä¸åŒçš„å±€åŸŸç½‘ä¸­"},{"categories":["tech"],"content":" 4. NAT ç©¿è¶Šåè®® - STUN/TURN/ICEå¦‚æœå¾ˆä¸å¹¸å‰é¢æåˆ°çš„ã€ŒDMZ ä¸»æœºã€/ã€Œé™æ€ç«¯å£è½¬å‘ã€/ã€ŒUPnPã€ ä¸‰é¡¹æŠ€æœ¯ï¼Œä½ çš„è·¯ç”±å™¨éƒ½ä¸æ”¯æŒï¼Œ é‚£ä½ å°±åªèƒ½å€ŸåŠ© NAT ç©¿è¶Šåè®®äº†ã€‚ ç›®å‰æœ‰å¦‚ä¸‹å‡ ä¸ª NAT ç©¿è¶Šåè®®æ ‡å‡†ï¼š RFC3489 Classic STUN Classic STUN æ˜¯ä¸€ä¸ªæ—©æœŸçš„ STUN è§„èŒƒï¼Œå®ƒå®šä¹‰äº†ä¸€æ•´å¥—å®Œæ•´çš„ NAT ç©¿è¶Šæ–¹æ¡ˆï¼Œä½†æ˜¯å› ä¸ºå­˜åœ¨è®¸å¤šé—®é¢˜ï¼Œå·²ç»è¢«åºŸå¼ƒã€‚ RFC5389 - Simple Traversal of UDP Through NATs (STUN) RFC5389 æ‰€å®šä¹‰çš„ STUN åè®®æ˜¯å¯¹ Classic STUN çš„æ”¹è¿›ï¼Œå®ƒçš„å®šä½ä¸å†æ˜¯ä¸€ä¸ªå®Œæ•´çš„ NAT ç©¿è¶Šè§£å†³æ–¹æ¡ˆï¼Œè€Œæ˜¯ä½œä¸ºå…¶ä»–åè®®ï¼ˆä¾‹å¦‚SIPã€FTPã€DNSï¼‰å¤„ç† NAT ç©¿è¶Šé—®é¢˜çš„ä¸€ä¸ªå·¥å…·ã€‚ å…¶å¯ä»¥ç”¨äºæ£€æŸ¥ç½‘ç»œä¸­NATè®¾å¤‡çš„å­˜åœ¨ï¼Œå¹¶ç¡®å®šä¸¤ä¸ªé€šä¿¡ç«¯ç‚¹è¢«NATè®¾å¤‡åˆ†é…çš„IPåœ°å€å’Œç«¯å£å·ã€‚ç„¶åï¼Œé€šè¿‡ICEï¼ˆInteractive Connectivity Establishmentï¼‰ï¼Œè‡ªåŠ¨åˆ›å»ºä¸€æ¡èƒ½å¤Ÿè¿›è¡ŒNATç©¿è¶Šçš„æ•°æ®é€šé“ã€‚ STUN æ”¯æŒé™¤ Symmetric NAT ä¹‹å¤–çš„å¦å¤–ä¸‰ç§ NAT ç±»å‹ RFC5766 - Traversal Using Relays around NAT (TURN) TURN åœ¨ STUN åè®®ä¹‹ä¸Šæ·»åŠ äº†ä¸€ä¸ªä¸­ç»§ï¼Œä»¥ç¡®ä¿åœ¨æ— æ³•å®ç° NAT ç©¿è¶Šçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ fallback åˆ°ç›´æ¥ä½¿ç”¨ä¸­ç»§æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ã€‚ è¿™ä¸ªä¸­ç»§çš„åŸç†ç±»ä¼¼åå‘ä»£ç†ï¼Œå•çº¯è´Ÿè´£æ•°æ®çš„è½¬å‘ åœ¨ç¾å›½æœ‰ä¸€é¡¹æ•°æ®è¡¨ç¤ºåœ¨è¿›è¡Œ P2P ç©¿è¶Šçš„æ—¶å€™ï¼Œç©¿è¶ŠæˆåŠŸçš„æ¦‚ç‡ä¸º 70%ï¼Œä½†æ˜¯åœ¨å›½å†…è¿™ä¸ªæˆåŠŸç‡ 50% å¯èƒ½éƒ½åˆ°ä¸äº†ã€‚å› æ­¤å°±æœ‰å¿…è¦ä½¿ç”¨ TURN åè®®ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯åœ¨ç©¿è¶Šå¤±è´¥çš„æƒ…å†µä¸‹ï¼Œç”¨æˆ·ä»ç„¶èƒ½æ­£å¸¸é€šä¿¡ã€‚ RFC8445 - Interactive Connectivity Establishment (ICE) ä¸€ä¸ª NAT ç©¿è¶Šçš„åå•†åè®®ï¼Œå®ƒç»Ÿä¸€äº† STUN ä¸ TURN ä¸¤ç§åè®®ï¼Œä¼šå°è¯•éå†æ‰€æœ‰å¯èƒ½çš„è¿æ¥æ–¹æ¡ˆã€‚ æ€»çš„æ¥è¯´ï¼Œæ ‡å‡†çš„ NAT ç©¿è¶Šåè®®ä¼˜å…ˆä½¿ç”¨æ‰“æ´ ï¼ˆNAT Hole Pounchingï¼‰æŠ€æœ¯ï¼Œå¦‚æœæ‰“æ´å¤±è´¥ï¼Œå°±ä½¿ç”¨ä¸­ç»§æœåŠ¡å™¨æŠ€æœ¯å…œåº•ï¼Œç¡®ä¿èƒ½æˆåŠŸç©¿è¶Šã€‚ STUN/TURN/ICE çš„ NAT ç±»å‹æ£€æµ‹RFC5389 å®šä¹‰äº†å¯¹ NAT æ˜ å°„ç±»å‹ä»¥åŠè¿‡æ»¤ç±»å‹çš„æ£€æµ‹æ–¹æ³•ã€‚ TBD STUN/TURN/ICE åè®®å¦‚ä½•å®ç° NAT æ‰“æ´é¦–å…ˆ P2P åŒæ–¹å¦‚æœåªéš”ç€ 0-1 å±‚ NATï¼Œé‚£æ˜¯ä¸éœ€è¦ä½¿ç”¨ NAT æ‰“æ´æŠ€æœ¯çš„ï¼Œå¯ä»¥ç›´è¿æˆ–è€…åå‘è¿æ¥ã€‚ ä¸‹é¢å°±è®¨è®ºä¸‹ P2P åŒæ–¹éš”ç€ 2 å±‚åŠä»¥ä¸Š NAT çš„åœºæ™¯ä¸‹ï¼Œå¦‚ä½•åˆ©ç”¨ UDP åè®®å®ç° NAT æ‰“æ´ã€‚ ä¸€ä¸ªå®Œæ•´çš„ NAT æ‰“æ´æ–¹æ¡ˆï¼Œéœ€è¦åŒ…å«å¦‚ä¸‹åŠŸèƒ½ï¼š A è·Ÿ B éœ€è¦çŸ¥é“å¯¹æ–¹çš„å…¬ç½‘ IP ä»¥åŠç›‘å¬çš„ç«¯å£å· è§£å†³æ–¹æ³•ï¼šéœ€è¦ä¸€ä¸ªå…¬ç½‘ä¸­ä»‹æ¥ä»‹ç»åŒæ–¹è®¤è¯†ï¼ˆäº¤æ¢ IP/portï¼‰ NAT è¿é€šæ€§æµ‹è¯•ï¼Œéœ€è¦å€ŸåŠ©å…¬ç½‘ä¸»æœºï¼Œæ£€æµ‹åŒæ–¹ä¸­é—´ç½‘ç»œçš„ç±»å‹ é’ˆå¯¹ä¸åŒçš„ NAT ç±»å‹ï¼Œå­˜åœ¨å“ªäº›ç©¿è¶Šæ‰‹æ®µï¼Ÿä»¥ä½•ç§é¡ºåºè¿›è¡Œç©¿è¶Šå°è¯•ï¼Ÿ NAT æ‰“æ´å¯ä»¥ä½¿ç”¨ UDP/TCP ä¸¤ç§ L4 åè®®ï¼Œä½†æ˜¯ TCP é¢å‘è¿æ¥çš„ç‰¹æ€§ä½¿å®ƒåœ¨è¿™ä¸ªåœºæ™¯ä¸­é™åˆ¶æ€§æ›´å¤§ ï¼ˆå…·ä½“é™åˆ¶è§å‚è€ƒæ–‡ç« ï¼Œæˆ‘æœ‰ç©ºå†è¡¥å……ï¼‰ï¼Œå› æ­¤å„ç§ NAT ç©¿è¶Šåè®®é€šå¸¸éƒ½åŸºäº UDP å®ç°ã€‚ æ­¤å¤–ï¼Œå› ä¸º NAT çš„å…·ä½“è¡Œä¸ºæ˜¯éæ ‡å‡†åŒ–çš„ï¼Œè·¯ç”±å™¨çš„é˜²ç«å¢™ç­–ç•¥ä¹Ÿå­˜åœ¨å¾ˆå¤§å˜åŠ¨ç©ºé—´ï¼Œå†æœ‰å°±æ˜¯ RF3489 çš„è¿™ç§ NAT åˆ†ç±»æ–¹æ³•ä¸å¤Ÿç²¾ç¡®ï¼Œè¿™äº›å› ç´ å¯¼è‡´ NAT ç©¿é€èƒ½å¦æˆåŠŸé€šå¸¸éƒ½æ˜¯è°ˆæ¦‚ç‡ã€‚ 1. A ä¸ B åœ¨åŒä¸€å±€åŸŸç½‘ä¸­è¿™æ˜¯æœ€ç®€å•çš„æƒ…å†µï¼Œæœ€ä½³æ–¹æ¡ˆæ˜¯ç›´æ¥èµ°å†…ç½‘é€šè®¯ï¼Œä¸ç»è¿‡ NAT. ç¬¬äºŒä¸ªæ–¹æ¡ˆæ˜¯ï¼Œè¿™ä¸¤ä¸ªåŒä¸€å±€åŸŸç½‘å†…çš„å®¢æˆ·ç«¯ä¸èµ°å†…ç½‘ï¼Œä»ç„¶é€šè¿‡ NAT é€šè®¯ã€‚è¿™ç§é€šè®¯æ–¹å¼è¢«ç§°ä½œã€Œå›ç¯ NAT(Loopback NAT)ã€æˆ–è€…ã€Œå‘å¤¹ NAT(Hairpin NAT)ã€ã€‚å¯¹äºä¸æ”¯æŒæˆ–æœªå¯ç”¨ã€ŒHairpin NATã€çš„ç½‘å…³è®¾å¤‡è€Œè¨€ï¼Œè¿™æ ·çš„é€šè®¯å°è¯•å°†ä¼šå¤±è´¥ï¼ 2. A ä¸ B åˆ†åˆ«åœ¨ä¸åŒçš„å±€åŸŸç½‘ä¸­è¿™æ ·å®é™…ä¸Š A ä¸ B ä¸­é—´å°±éš”äº†ä¸¤ä¸ª NAT ç½‘å…³ï¼Œè¿™æ˜¯æœ€æ™®éçš„ä¸€ç§æƒ…å†µã€‚ STUN/TURN çš„ NAT ç©¿é€æµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š é¦–å…ˆï¼ŒA è·Ÿ B ä¸¤ä¸ªç¨‹åºå¯åŠ¨æ—¶ï¼Œéœ€è¦æŠŠè‡ªå·±çš„å†…å¤–ç½‘ IP åŠç«¯å£ä¿¡æ¯ä¸ŠæŠ¥åˆ°ä¸€å°ä¸­ä»‹æœåŠ¡å™¨ S ç°åœ¨å‡è®¾ A æƒ³è¦è·Ÿ B å»ºç«‹ä¸€ä¸ª P2P è¿æ¥ï¼Œé¦–å…ˆä»–ä»¬éœ€è¦ä» S è·å¾—å¯¹æ–¹çš„ ID A å°† B çš„ ID å‘é€ç»™ä¸­ä»‹æœåŠ¡å™¨ Sï¼Œè¯·æ±‚ä¸ B å»ºç«‹ P2P è¿æ¥ ä¸­ä»‹æœåŠ¡å™¨å°† B çš„å†…å¤–ç½‘ IP åŠç«¯å£ä¿¡æ¯å‘é€ç»™ Aï¼ŒåŒæ—¶å°† A çš„ç½‘ç»œä¿¡æ¯å‘é€ç»™ B A å°è¯•è¯·æ±‚ B çš„å…¬ç½‘åœ°å€ B_public_ip:B_public_port è¿™è‚¯å®šä¼šå¤±è´¥ï¼Œä½†æ˜¯ä¼šåœ¨ A çš„ NAT ç½‘å…³ä¸Šç•™ä¸‹è®°å½•ï¼šA æ›¾ç»è¯·æ±‚è¿‡è¿™ä¸ªåœ°å€ï¼Œé‚£ä¹‹åè¿™ä¸ªåœ°å€å‘åˆ° A çš„ NAT ç½‘å…³çš„æµé‡å°±å¯ä»¥è¿›æ¥äº†ã€‚ B å°è¯•è¯·æ±‚ A çš„å…¬ç½‘åœ°å€ A_public_ip:A_public_port åŒæ ·è¿™è‚¯å®šä¹Ÿä¼šå¤±è´¥ï¼Œä½†æ˜¯ä¼šåœ¨ B çš„ NAT ç½‘å…³ä¸Šæµé‡è®°å½•ï¼šB æ›¾ç»è¯·æ±‚è¿‡è¿™ä¸ªåœ°å€ï¼Œé‚£ä¹‹åè¿™ä¸ªåœ°å€å‘åˆ° B çš„ NAT ç½‘å…³çš„æµé‡å°±å¯ä»¥è¿›æ¥äº† ä¸­é—´çš„ä¸¤å±‚ NAT ç½‘å…³å‡å½¢æˆ NAT ç©¿è¶Šè®°å½•ï¼Œç©¿è¶Šå®Œæˆã€‚ ç°åœ¨ A å°è¯•è¯·æ±‚ B çš„å…¬ç½‘åœ°å€ B_public_ip:B_public_portï¼Œç”±äº B çš„ NAT å·²æœ‰è®°å½•ï¼Œæµé‡é¡ºåˆ©é€šè¿‡ NAT åˆ°è¾¾ç¨‹åº B B å‘é€ç»™ A çš„æ•°æ®ä¹ŸåŒæ ·ï¼Œå¯ä»¥é¡ºåˆ©åˆ°è¾¾ A ä¸Šè¿°æµç¨‹ä¸­çš„å…³é”®ç‚¹åœ¨äºï¼Œå¦‚ä½•æŸ¥å‡ºå†…ç½‘æœåŠ¡å™¨è¢« NAT åˆ†é…çš„å¤–éƒ¨ IP åŠç«¯å£ï¼Œåªè¦æœ‰äº†è¿™ä¸¤ä¸ªä¿¡æ¯ï¼Œå°±å¯ä»¥é€šè¿‡ STUN ä¸­ä»‹æœåŠ¡å™¨äº¤æ¢è¿™ä¸ªä¿¡æ¯ï¼Œç„¶åå®Œæˆè¿æ¥çš„å»ºç«‹äº†ã€‚å®¶åº­æœåŠ¡å™¨é€šå¸¸éƒ½åªæœ‰ä¸€ä¸ªå…¬ç½‘ IPï¼Œæ‰€ä»¥åŸºæœ¬å¯ä»¥è®¤ä¸º IP æ˜¯å›ºå®šçš„ï¼Œå› æ­¤æœ€å…³é”®çš„é—®é¢˜å°±æ˜¯ã€Œå¦‚ä½•çŸ¥é“ NAT ä¸ºä¼šè¯åˆ†é…çš„ç«¯å£åœ°å€ã€ã€‚ å¯¹ç«¯å£çš„é™åˆ¶ä¸¥æ ¼ç¨‹åº¦è·Ÿ NAPT çš„ç±»å‹æœ‰å…³ï¼ŒFull-cone è·Ÿ Restricted cone å¯¹ç«¯å£éƒ½æ²¡æœ‰ä»»ä½•é™åˆ¶ï¼Œæ‰€ä»¥ä¸Šè¿°æµç¨‹è‚¯å®šå¯ä»¥æˆåŠŸï¼› TBD ä¸€ä¸ªç©¿è¶Š Symmetric NATs çš„ STUN è‰æ¡ˆï¼šSymmetric NAT Traversal using STUN åœ¨ä½¿ç”¨ STUN/TURN è¿›è¡Œ NAT ç©¿è¶Šæ—¶ï¼Œæ”¯æŒçš„çš„ NAT ç±»å‹å¦‚ä¸‹è¡¨ã€‚è¡Œä¸åˆ—åˆ†åˆ«ä»£è¡¨åŒæ–¹çš„ NAT ç±»å‹ï¼Œâœ… è¡¨ç¤ºæ”¯æŒ UDP ç©¿è¶Šï¼ŒâŒ è¡¨ç¤º TURN æ— æ³•è¿›è¡Œ UDP ç©¿è¶Šï¼š NAT ç±»å‹ Full Cone Restricted Port-Restricted Symmetric Full Cone âœ… âœ… âœ… âœ… Restricted âœ… âœ… âœ… âœ… Port-Restricted âœ… âœ… âœ… âŒ Symmetric âœ… âœ… âŒ âŒ è¿™ç§åœºæ™¯ä¸‹ TURN åè®®ç»™å‡ºçš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œfallback åˆ°ä¸­ç»§æœåŠ¡å™¨ç­–ç•¥ä½œä¸ºå…œåº•æ–¹æ¡ˆï¼Œä¿è¯è¿æ¥èƒ½æˆåŠŸï¼Œä½†æ˜¯è¿™ä¼šç»™ä¸­ç»§æœåŠ¡å™¨å¸¦æ¥å¾ˆå¤§å‹åŠ›ï¼Œå»¶è¿Ÿç­‰å‚æ•°å°†ä¸å¯é¿å…åœ°å˜å·®ã€‚ 3. A ä¸ B ä¹‹é—´éš”ç€ä¸‰å±‚ä»¥ä¸Šçš„ NATè¿™ç§æƒ…å†µè¾ƒä¸ºå¸¸è§çš„æœ‰ï¼š ISP ä¸ºäº†èŠ‚çº¦ä½¿ç”¨å…¬ç½‘ IPï¼Œç»™ç”¨æˆ·åˆ†é…äº†ä¸ªå¹¿åŸŸç½‘ IPï¼Œä¸­é—´å°±å¤šäº†ä¸ªå¹¿åŸŸç½‘ NAT å¤§åŸå¸‚çš„å„ç§ç§Ÿæˆ¿å…¬å¯“é€šå¸¸åªä¼šä» ISP è´­ä¹°ä¸€ä¸¤æ ¹å®½å¸¦ï¼ŒäºŒæ¬¡åˆ†é”€ç»™æ•´æ ‹æ¥¼çš„ç§Ÿå®¢å…±ç”¨ï¼Œè¿™å°±é€ æˆä¸­é—´å¤šäº†ä¸€å±‚å…¬å¯“çš„ NAT è¿™æ˜¯æœ€å¤æ‚çš„ä¸€ç§æƒ…å†µï¼ŒåŸºæœ¬ä¸Šå°±æ²¡ä»€ä¹ˆ NAT ç©¿é€çš„å¸Œæœ›äº†ï¼Œåªèƒ½èµ°ä¸‹é¢ä»‹ç»çš„å…œåº•ç­–ç•¥â€”â€”æœåŠ¡å™¨ä¸­ç»§ã€‚ TBD å¾…ç»­ 4. ç‰¹æ®Šç©¿è¶Šæ–¹æ¡ˆ - æœåŠ¡å™¨ä¸­ç»§Relay æœåŠ¡å™¨ä¸­ç»§æ˜¯å…¼å®¹æ€§æœ€ä½³ï¼Œä½†æ˜¯æ€§èƒ½æœ€å·®çš„æ–¹æ¡ˆï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ¡ˆä¸‹ï¼Œæ‰€æœ‰çš„ P2P è¿æ¥éƒ½éœ€è¦ç»è¿‡ä¸­ç»§æœåŠ¡å™¨è½¬å‘ï¼Œåœ¨ä½¿ç”¨äººæ•°ä¼—å¤šæ—¶è¿™ä¼šç»™ä¸­ç»§æœåŠ¡å™¨é€ æˆå¾ˆå¤§çš„å‹åŠ›ã€‚ å› æ­¤è¿™ä¸ªæ–¹æ¡ˆé€šå¸¸æ˜¯ç”¨äºå…œåº•çš„ã€‚ ","date":"2022-05-13","objectID":"/posts/about-nat/:5:4","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["NAT","ç½‘ç»œ","NAT ç©¿è¶Š","å†…ç½‘ç©¿é€","è™šæ‹Ÿç½‘ç»œ","P2P","WebRTC"],"title":"NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ","uri":"/posts/about-nat/#3-a-ä¸-b-ä¹‹é—´éš”ç€ä¸‰å±‚ä»¥ä¸Šçš„-nat"},{"categories":["tech"],"content":" 4. NAT ç©¿è¶Šåè®® - STUN/TURN/ICEå¦‚æœå¾ˆä¸å¹¸å‰é¢æåˆ°çš„ã€ŒDMZ ä¸»æœºã€/ã€Œé™æ€ç«¯å£è½¬å‘ã€/ã€ŒUPnPã€ ä¸‰é¡¹æŠ€æœ¯ï¼Œä½ çš„è·¯ç”±å™¨éƒ½ä¸æ”¯æŒï¼Œ é‚£ä½ å°±åªèƒ½å€ŸåŠ© NAT ç©¿è¶Šåè®®äº†ã€‚ ç›®å‰æœ‰å¦‚ä¸‹å‡ ä¸ª NAT ç©¿è¶Šåè®®æ ‡å‡†ï¼š RFC3489 Classic STUN Classic STUN æ˜¯ä¸€ä¸ªæ—©æœŸçš„ STUN è§„èŒƒï¼Œå®ƒå®šä¹‰äº†ä¸€æ•´å¥—å®Œæ•´çš„ NAT ç©¿è¶Šæ–¹æ¡ˆï¼Œä½†æ˜¯å› ä¸ºå­˜åœ¨è®¸å¤šé—®é¢˜ï¼Œå·²ç»è¢«åºŸå¼ƒã€‚ RFC5389 - Simple Traversal of UDP Through NATs (STUN) RFC5389 æ‰€å®šä¹‰çš„ STUN åè®®æ˜¯å¯¹ Classic STUN çš„æ”¹è¿›ï¼Œå®ƒçš„å®šä½ä¸å†æ˜¯ä¸€ä¸ªå®Œæ•´çš„ NAT ç©¿è¶Šè§£å†³æ–¹æ¡ˆï¼Œè€Œæ˜¯ä½œä¸ºå…¶ä»–åè®®ï¼ˆä¾‹å¦‚SIPã€FTPã€DNSï¼‰å¤„ç† NAT ç©¿è¶Šé—®é¢˜çš„ä¸€ä¸ªå·¥å…·ã€‚ å…¶å¯ä»¥ç”¨äºæ£€æŸ¥ç½‘ç»œä¸­NATè®¾å¤‡çš„å­˜åœ¨ï¼Œå¹¶ç¡®å®šä¸¤ä¸ªé€šä¿¡ç«¯ç‚¹è¢«NATè®¾å¤‡åˆ†é…çš„IPåœ°å€å’Œç«¯å£å·ã€‚ç„¶åï¼Œé€šè¿‡ICEï¼ˆInteractive Connectivity Establishmentï¼‰ï¼Œè‡ªåŠ¨åˆ›å»ºä¸€æ¡èƒ½å¤Ÿè¿›è¡ŒNATç©¿è¶Šçš„æ•°æ®é€šé“ã€‚ STUN æ”¯æŒé™¤ Symmetric NAT ä¹‹å¤–çš„å¦å¤–ä¸‰ç§ NAT ç±»å‹ RFC5766 - Traversal Using Relays around NAT (TURN) TURN åœ¨ STUN åè®®ä¹‹ä¸Šæ·»åŠ äº†ä¸€ä¸ªä¸­ç»§ï¼Œä»¥ç¡®ä¿åœ¨æ— æ³•å®ç° NAT ç©¿è¶Šçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ fallback åˆ°ç›´æ¥ä½¿ç”¨ä¸­ç»§æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ã€‚ è¿™ä¸ªä¸­ç»§çš„åŸç†ç±»ä¼¼åå‘ä»£ç†ï¼Œå•çº¯è´Ÿè´£æ•°æ®çš„è½¬å‘ åœ¨ç¾å›½æœ‰ä¸€é¡¹æ•°æ®è¡¨ç¤ºåœ¨è¿›è¡Œ P2P ç©¿è¶Šçš„æ—¶å€™ï¼Œç©¿è¶ŠæˆåŠŸçš„æ¦‚ç‡ä¸º 70%ï¼Œä½†æ˜¯åœ¨å›½å†…è¿™ä¸ªæˆåŠŸç‡ 50% å¯èƒ½éƒ½åˆ°ä¸äº†ã€‚å› æ­¤å°±æœ‰å¿…è¦ä½¿ç”¨ TURN åè®®ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯åœ¨ç©¿è¶Šå¤±è´¥çš„æƒ…å†µä¸‹ï¼Œç”¨æˆ·ä»ç„¶èƒ½æ­£å¸¸é€šä¿¡ã€‚ RFC8445 - Interactive Connectivity Establishment (ICE) ä¸€ä¸ª NAT ç©¿è¶Šçš„åå•†åè®®ï¼Œå®ƒç»Ÿä¸€äº† STUN ä¸ TURN ä¸¤ç§åè®®ï¼Œä¼šå°è¯•éå†æ‰€æœ‰å¯èƒ½çš„è¿æ¥æ–¹æ¡ˆã€‚ æ€»çš„æ¥è¯´ï¼Œæ ‡å‡†çš„ NAT ç©¿è¶Šåè®®ä¼˜å…ˆä½¿ç”¨æ‰“æ´ ï¼ˆNAT Hole Pounchingï¼‰æŠ€æœ¯ï¼Œå¦‚æœæ‰“æ´å¤±è´¥ï¼Œå°±ä½¿ç”¨ä¸­ç»§æœåŠ¡å™¨æŠ€æœ¯å…œåº•ï¼Œç¡®ä¿èƒ½æˆåŠŸç©¿è¶Šã€‚ STUN/TURN/ICE çš„ NAT ç±»å‹æ£€æµ‹RFC5389 å®šä¹‰äº†å¯¹ NAT æ˜ å°„ç±»å‹ä»¥åŠè¿‡æ»¤ç±»å‹çš„æ£€æµ‹æ–¹æ³•ã€‚ TBD STUN/TURN/ICE åè®®å¦‚ä½•å®ç° NAT æ‰“æ´é¦–å…ˆ P2P åŒæ–¹å¦‚æœåªéš”ç€ 0-1 å±‚ NATï¼Œé‚£æ˜¯ä¸éœ€è¦ä½¿ç”¨ NAT æ‰“æ´æŠ€æœ¯çš„ï¼Œå¯ä»¥ç›´è¿æˆ–è€…åå‘è¿æ¥ã€‚ ä¸‹é¢å°±è®¨è®ºä¸‹ P2P åŒæ–¹éš”ç€ 2 å±‚åŠä»¥ä¸Š NAT çš„åœºæ™¯ä¸‹ï¼Œå¦‚ä½•åˆ©ç”¨ UDP åè®®å®ç° NAT æ‰“æ´ã€‚ ä¸€ä¸ªå®Œæ•´çš„ NAT æ‰“æ´æ–¹æ¡ˆï¼Œéœ€è¦åŒ…å«å¦‚ä¸‹åŠŸèƒ½ï¼š A è·Ÿ B éœ€è¦çŸ¥é“å¯¹æ–¹çš„å…¬ç½‘ IP ä»¥åŠç›‘å¬çš„ç«¯å£å· è§£å†³æ–¹æ³•ï¼šéœ€è¦ä¸€ä¸ªå…¬ç½‘ä¸­ä»‹æ¥ä»‹ç»åŒæ–¹è®¤è¯†ï¼ˆäº¤æ¢ IP/portï¼‰ NAT è¿é€šæ€§æµ‹è¯•ï¼Œéœ€è¦å€ŸåŠ©å…¬ç½‘ä¸»æœºï¼Œæ£€æµ‹åŒæ–¹ä¸­é—´ç½‘ç»œçš„ç±»å‹ é’ˆå¯¹ä¸åŒçš„ NAT ç±»å‹ï¼Œå­˜åœ¨å“ªäº›ç©¿è¶Šæ‰‹æ®µï¼Ÿä»¥ä½•ç§é¡ºåºè¿›è¡Œç©¿è¶Šå°è¯•ï¼Ÿ NAT æ‰“æ´å¯ä»¥ä½¿ç”¨ UDP/TCP ä¸¤ç§ L4 åè®®ï¼Œä½†æ˜¯ TCP é¢å‘è¿æ¥çš„ç‰¹æ€§ä½¿å®ƒåœ¨è¿™ä¸ªåœºæ™¯ä¸­é™åˆ¶æ€§æ›´å¤§ ï¼ˆå…·ä½“é™åˆ¶è§å‚è€ƒæ–‡ç« ï¼Œæˆ‘æœ‰ç©ºå†è¡¥å……ï¼‰ï¼Œå› æ­¤å„ç§ NAT ç©¿è¶Šåè®®é€šå¸¸éƒ½åŸºäº UDP å®ç°ã€‚ æ­¤å¤–ï¼Œå› ä¸º NAT çš„å…·ä½“è¡Œä¸ºæ˜¯éæ ‡å‡†åŒ–çš„ï¼Œè·¯ç”±å™¨çš„é˜²ç«å¢™ç­–ç•¥ä¹Ÿå­˜åœ¨å¾ˆå¤§å˜åŠ¨ç©ºé—´ï¼Œå†æœ‰å°±æ˜¯ RF3489 çš„è¿™ç§ NAT åˆ†ç±»æ–¹æ³•ä¸å¤Ÿç²¾ç¡®ï¼Œè¿™äº›å› ç´ å¯¼è‡´ NAT ç©¿é€èƒ½å¦æˆåŠŸé€šå¸¸éƒ½æ˜¯è°ˆæ¦‚ç‡ã€‚ 1. A ä¸ B åœ¨åŒä¸€å±€åŸŸç½‘ä¸­è¿™æ˜¯æœ€ç®€å•çš„æƒ…å†µï¼Œæœ€ä½³æ–¹æ¡ˆæ˜¯ç›´æ¥èµ°å†…ç½‘é€šè®¯ï¼Œä¸ç»è¿‡ NAT. ç¬¬äºŒä¸ªæ–¹æ¡ˆæ˜¯ï¼Œè¿™ä¸¤ä¸ªåŒä¸€å±€åŸŸç½‘å†…çš„å®¢æˆ·ç«¯ä¸èµ°å†…ç½‘ï¼Œä»ç„¶é€šè¿‡ NAT é€šè®¯ã€‚è¿™ç§é€šè®¯æ–¹å¼è¢«ç§°ä½œã€Œå›ç¯ NAT(Loopback NAT)ã€æˆ–è€…ã€Œå‘å¤¹ NAT(Hairpin NAT)ã€ã€‚å¯¹äºä¸æ”¯æŒæˆ–æœªå¯ç”¨ã€ŒHairpin NATã€çš„ç½‘å…³è®¾å¤‡è€Œè¨€ï¼Œè¿™æ ·çš„é€šè®¯å°è¯•å°†ä¼šå¤±è´¥ï¼ 2. A ä¸ B åˆ†åˆ«åœ¨ä¸åŒçš„å±€åŸŸç½‘ä¸­è¿™æ ·å®é™…ä¸Š A ä¸ B ä¸­é—´å°±éš”äº†ä¸¤ä¸ª NAT ç½‘å…³ï¼Œè¿™æ˜¯æœ€æ™®éçš„ä¸€ç§æƒ…å†µã€‚ STUN/TURN çš„ NAT ç©¿é€æµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š é¦–å…ˆï¼ŒA è·Ÿ B ä¸¤ä¸ªç¨‹åºå¯åŠ¨æ—¶ï¼Œéœ€è¦æŠŠè‡ªå·±çš„å†…å¤–ç½‘ IP åŠç«¯å£ä¿¡æ¯ä¸ŠæŠ¥åˆ°ä¸€å°ä¸­ä»‹æœåŠ¡å™¨ S ç°åœ¨å‡è®¾ A æƒ³è¦è·Ÿ B å»ºç«‹ä¸€ä¸ª P2P è¿æ¥ï¼Œé¦–å…ˆä»–ä»¬éœ€è¦ä» S è·å¾—å¯¹æ–¹çš„ ID A å°† B çš„ ID å‘é€ç»™ä¸­ä»‹æœåŠ¡å™¨ Sï¼Œè¯·æ±‚ä¸ B å»ºç«‹ P2P è¿æ¥ ä¸­ä»‹æœåŠ¡å™¨å°† B çš„å†…å¤–ç½‘ IP åŠç«¯å£ä¿¡æ¯å‘é€ç»™ Aï¼ŒåŒæ—¶å°† A çš„ç½‘ç»œä¿¡æ¯å‘é€ç»™ B A å°è¯•è¯·æ±‚ B çš„å…¬ç½‘åœ°å€ B_public_ip:B_public_port è¿™è‚¯å®šä¼šå¤±è´¥ï¼Œä½†æ˜¯ä¼šåœ¨ A çš„ NAT ç½‘å…³ä¸Šç•™ä¸‹è®°å½•ï¼šA æ›¾ç»è¯·æ±‚è¿‡è¿™ä¸ªåœ°å€ï¼Œé‚£ä¹‹åè¿™ä¸ªåœ°å€å‘åˆ° A çš„ NAT ç½‘å…³çš„æµé‡å°±å¯ä»¥è¿›æ¥äº†ã€‚ B å°è¯•è¯·æ±‚ A çš„å…¬ç½‘åœ°å€ A_public_ip:A_public_port åŒæ ·è¿™è‚¯å®šä¹Ÿä¼šå¤±è´¥ï¼Œä½†æ˜¯ä¼šåœ¨ B çš„ NAT ç½‘å…³ä¸Šæµé‡è®°å½•ï¼šB æ›¾ç»è¯·æ±‚è¿‡è¿™ä¸ªåœ°å€ï¼Œé‚£ä¹‹åè¿™ä¸ªåœ°å€å‘åˆ° B çš„ NAT ç½‘å…³çš„æµé‡å°±å¯ä»¥è¿›æ¥äº† ä¸­é—´çš„ä¸¤å±‚ NAT ç½‘å…³å‡å½¢æˆ NAT ç©¿è¶Šè®°å½•ï¼Œç©¿è¶Šå®Œæˆã€‚ ç°åœ¨ A å°è¯•è¯·æ±‚ B çš„å…¬ç½‘åœ°å€ B_public_ip:B_public_portï¼Œç”±äº B çš„ NAT å·²æœ‰è®°å½•ï¼Œæµé‡é¡ºåˆ©é€šè¿‡ NAT åˆ°è¾¾ç¨‹åº B B å‘é€ç»™ A çš„æ•°æ®ä¹ŸåŒæ ·ï¼Œå¯ä»¥é¡ºåˆ©åˆ°è¾¾ A ä¸Šè¿°æµç¨‹ä¸­çš„å…³é”®ç‚¹åœ¨äºï¼Œå¦‚ä½•æŸ¥å‡ºå†…ç½‘æœåŠ¡å™¨è¢« NAT åˆ†é…çš„å¤–éƒ¨ IP åŠç«¯å£ï¼Œåªè¦æœ‰äº†è¿™ä¸¤ä¸ªä¿¡æ¯ï¼Œå°±å¯ä»¥é€šè¿‡ STUN ä¸­ä»‹æœåŠ¡å™¨äº¤æ¢è¿™ä¸ªä¿¡æ¯ï¼Œç„¶åå®Œæˆè¿æ¥çš„å»ºç«‹äº†ã€‚å®¶åº­æœåŠ¡å™¨é€šå¸¸éƒ½åªæœ‰ä¸€ä¸ªå…¬ç½‘ IPï¼Œæ‰€ä»¥åŸºæœ¬å¯ä»¥è®¤ä¸º IP æ˜¯å›ºå®šçš„ï¼Œå› æ­¤æœ€å…³é”®çš„é—®é¢˜å°±æ˜¯ã€Œå¦‚ä½•çŸ¥é“ NAT ä¸ºä¼šè¯åˆ†é…çš„ç«¯å£åœ°å€ã€ã€‚ å¯¹ç«¯å£çš„é™åˆ¶ä¸¥æ ¼ç¨‹åº¦è·Ÿ NAPT çš„ç±»å‹æœ‰å…³ï¼ŒFull-cone è·Ÿ Restricted cone å¯¹ç«¯å£éƒ½æ²¡æœ‰ä»»ä½•é™åˆ¶ï¼Œæ‰€ä»¥ä¸Šè¿°æµç¨‹è‚¯å®šå¯ä»¥æˆåŠŸï¼› TBD ä¸€ä¸ªç©¿è¶Š Symmetric NATs çš„ STUN è‰æ¡ˆï¼šSymmetric NAT Traversal using STUN åœ¨ä½¿ç”¨ STUN/TURN è¿›è¡Œ NAT ç©¿è¶Šæ—¶ï¼Œæ”¯æŒçš„çš„ NAT ç±»å‹å¦‚ä¸‹è¡¨ã€‚è¡Œä¸åˆ—åˆ†åˆ«ä»£è¡¨åŒæ–¹çš„ NAT ç±»å‹ï¼Œâœ… è¡¨ç¤ºæ”¯æŒ UDP ç©¿è¶Šï¼ŒâŒ è¡¨ç¤º TURN æ— æ³•è¿›è¡Œ UDP ç©¿è¶Šï¼š NAT ç±»å‹ Full Cone Restricted Port-Restricted Symmetric Full Cone âœ… âœ… âœ… âœ… Restricted âœ… âœ… âœ… âœ… Port-Restricted âœ… âœ… âœ… âŒ Symmetric âœ… âœ… âŒ âŒ è¿™ç§åœºæ™¯ä¸‹ TURN åè®®ç»™å‡ºçš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œfallback åˆ°ä¸­ç»§æœåŠ¡å™¨ç­–ç•¥ä½œä¸ºå…œåº•æ–¹æ¡ˆï¼Œä¿è¯è¿æ¥èƒ½æˆåŠŸï¼Œä½†æ˜¯è¿™ä¼šç»™ä¸­ç»§æœåŠ¡å™¨å¸¦æ¥å¾ˆå¤§å‹åŠ›ï¼Œå»¶è¿Ÿç­‰å‚æ•°å°†ä¸å¯é¿å…åœ°å˜å·®ã€‚ 3. A ä¸ B ä¹‹é—´éš”ç€ä¸‰å±‚ä»¥ä¸Šçš„ NATè¿™ç§æƒ…å†µè¾ƒä¸ºå¸¸è§çš„æœ‰ï¼š ISP ä¸ºäº†èŠ‚çº¦ä½¿ç”¨å…¬ç½‘ IPï¼Œç»™ç”¨æˆ·åˆ†é…äº†ä¸ªå¹¿åŸŸç½‘ IPï¼Œä¸­é—´å°±å¤šäº†ä¸ªå¹¿åŸŸç½‘ NAT å¤§åŸå¸‚çš„å„ç§ç§Ÿæˆ¿å…¬å¯“é€šå¸¸åªä¼šä» ISP è´­ä¹°ä¸€ä¸¤æ ¹å®½å¸¦ï¼ŒäºŒæ¬¡åˆ†é”€ç»™æ•´æ ‹æ¥¼çš„ç§Ÿå®¢å…±ç”¨ï¼Œè¿™å°±é€ æˆä¸­é—´å¤šäº†ä¸€å±‚å…¬å¯“çš„ NAT è¿™æ˜¯æœ€å¤æ‚çš„ä¸€ç§æƒ…å†µï¼ŒåŸºæœ¬ä¸Šå°±æ²¡ä»€ä¹ˆ NAT ç©¿é€çš„å¸Œæœ›äº†ï¼Œåªèƒ½èµ°ä¸‹é¢ä»‹ç»çš„å…œåº•ç­–ç•¥â€”â€”æœåŠ¡å™¨ä¸­ç»§ã€‚ TBD å¾…ç»­ 4. ç‰¹æ®Šç©¿è¶Šæ–¹æ¡ˆ - æœåŠ¡å™¨ä¸­ç»§Relay æœåŠ¡å™¨ä¸­ç»§æ˜¯å…¼å®¹æ€§æœ€ä½³ï¼Œä½†æ˜¯æ€§èƒ½æœ€å·®çš„æ–¹æ¡ˆï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ¡ˆä¸‹ï¼Œæ‰€æœ‰çš„ P2P è¿æ¥éƒ½éœ€è¦ç»è¿‡ä¸­ç»§æœåŠ¡å™¨è½¬å‘ï¼Œåœ¨ä½¿ç”¨äººæ•°ä¼—å¤šæ—¶è¿™ä¼šç»™ä¸­ç»§æœåŠ¡å™¨é€ æˆå¾ˆå¤§çš„å‹åŠ›ã€‚ å› æ­¤è¿™ä¸ªæ–¹æ¡ˆé€šå¸¸æ˜¯ç”¨äºå…œåº•çš„ã€‚ ","date":"2022-05-13","objectID":"/posts/about-nat/:5:4","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["NAT","ç½‘ç»œ","NAT ç©¿è¶Š","å†…ç½‘ç©¿é€","è™šæ‹Ÿç½‘ç»œ","P2P","WebRTC"],"title":"NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ","uri":"/posts/about-nat/#4-ç‰¹æ®Šç©¿è¶Šæ–¹æ¡ˆ---æœåŠ¡å™¨ä¸­ç»§"},{"categories":["tech"],"content":" ç‰¹å®šåè®®çš„è‡ªç©¿è¶ŠæŠ€æœ¯åœ¨æ‰€æœ‰æ–¹æ³•ä¸­æœ€å¤æ‚ä¹Ÿæœ€å¯é çš„å°±æ˜¯è‡ªå·±è§£å†³è‡ªå·±çš„é—®é¢˜ã€‚æ¯”å¦‚ IKE å’Œ IPsec æŠ€æœ¯ï¼Œåœ¨è®¾è®¡æ—¶å°±è€ƒè™‘äº†åˆ°å¦‚ä½•ç©¿è¶Š NAT çš„é—®é¢˜ã€‚å› ä¸ºè¿™ä¸ªåè®®æ˜¯ä¸€ä¸ªè‡ªåŠ å¯†çš„åè®®å¹¶ä¸”å…·æœ‰æŠ¥æ–‡é˜²ä¿®æ”¹çš„é‰´åˆ«èƒ½åŠ›ï¼Œå…¶ä»–é€šç”¨æ–¹æ³•çˆ±è«èƒ½åŠ©ã€‚å› ä¸ºå®é™…åº”ç”¨çš„ NAT ç½‘å…³åŸºæœ¬éƒ½æ˜¯ NAPT æ–¹å¼ï¼Œæ‰€æœ‰é€šè¿‡ä¼ è¾“å±‚åè®®æ‰¿è½½çš„æŠ¥æ–‡å¯ä»¥é¡ºåˆ©é€šè¿‡ NATã€‚IKE å’Œ IPsec é‡‡ç”¨çš„æ–¹æ¡ˆå°±æ˜¯ç”¨ UDP åœ¨æŠ¥æ–‡å¤–é¢å†åŠ ä¸€å±‚å°è£…ï¼Œè€Œå†…éƒ¨çš„æŠ¥æ–‡å°±ä¸å†å—åˆ°å½±å“ã€‚IKE ä¸­è¿˜ä¸“é—¨å¢åŠ äº† NAT ç½‘å…³æ˜¯å¦å­˜åœ¨çš„æ£€æŸ¥èƒ½åŠ›ä»¥åŠç»•å¼€ NAT ç½‘å…³æ£€æµ‹ IKE åè®®çš„æ–¹æ³•ã€‚ ","date":"2022-05-13","objectID":"/posts/about-nat/:5:5","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["NAT","ç½‘ç»œ","NAT ç©¿è¶Š","å†…ç½‘ç©¿é€","è™šæ‹Ÿç½‘ç»œ","P2P","WebRTC"],"title":"NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ","uri":"/posts/about-nat/#ç‰¹å®šåè®®çš„è‡ªç©¿è¶ŠæŠ€æœ¯"},{"categories":["tech"],"content":" NAT ALG(Application Level Gateway)NAT ALG æ˜¯ä¸€ç§è§£å†³åº”ç”¨å±‚åè®®ï¼ˆä¾‹å¦‚DNSã€FTPï¼‰æŠ¥æ–‡ç©¿è¶Š NAT çš„æŠ€æœ¯ï¼Œå·²ç»è¢« NAT è®¾å¤‡äº§å•†å¹¿æ³›é‡‡ç”¨ï¼Œæ˜¯ NAT è®¾å¤‡çš„å¿…å¤‡åŠŸèƒ½ã€‚ TLDR ä¸€å¥è¯ä»‹ç»ï¼šNAT ALG é€šè¿‡è¯†åˆ«åè®®ï¼Œç›´æ¥ä¿®æ”¹æŠ¥æ–‡æ•°æ®éƒ¨åˆ†ï¼ˆpayloadï¼‰çš„ IP åœ°å€å’Œç«¯å£ä¿¡æ¯ï¼Œè§£å†³æŸäº›åº”ç”¨åè®®çš„æŠ¥æ–‡ç©¿è¶Š NAT é—®é¢˜ã€‚NAT ALG å·¥ä½œåœ¨ L3-L7 å±‚ã€‚ NAT ALG çš„åŸç†æ˜¯åˆ©ç”¨å¸¦æœ‰ ALG åŠŸèƒ½çš„ NAT è®¾å¤‡å¯¹ç‰¹å®šåº”ç”¨å±‚åè®®çš„æ”¯æŒï¼Œå½“è®¾å¤‡æ£€æµ‹åˆ°æ–°çš„è¿æ¥è¯·æ±‚æ—¶ï¼Œå…ˆæ ¹æ®ä¼ è¾“å±‚ç«¯å£ä¿¡æ¯åˆ¤æ–­æ˜¯å¦ä¸ºå·²çŸ¥åº”ç”¨ç±»å‹ã€‚å¦‚æœåˆ¤æ–­ä¸ºå·²çŸ¥åº”ç”¨ï¼Œåˆ™è°ƒç”¨è¯¥åº”ç”¨åè®®çš„ ALG åŠŸèƒ½å¯¹æŠ¥æ–‡çš„æ·±å±‚å†…å®¹è¿›è¡Œæ£€æŸ¥ã€‚è‹¥å‘ç°ä»»ä½•å½¢å¼è¡¨è¾¾çš„ IP åœ°å€å’Œç«¯å£ä¿¡æ¯ï¼ŒNAT éƒ½ä¼šå°†è¿™äº›ä¿¡æ¯åŒæ­¥è¿›è¡Œè½¬æ¢ï¼Œå¹¶ä¸ºè¿™ä¸ªæ–°çš„è¿æ¥å»ºç«‹ä¸€ä¸ªé™„åŠ çš„è½¬æ¢è¡¨é¡¹ã€‚å½“æŠ¥æ–‡åˆ°è¾¾å¤–ç½‘ä¾§çš„ç›®çš„ä¸»æœºæ—¶ï¼Œåº”ç”¨å±‚åè®®ä¸­æºå¸¦çš„ä¿¡æ¯å°±æ˜¯ NAT è®¾å¤‡è½¬æ¢åçš„IPåœ°å€å’Œç«¯å£å·ï¼Œè¿™æ ·ï¼Œå°±å¯ä»¥è§£å†³æŸäº›åº”ç”¨åè®®çš„æŠ¥æ–‡ç©¿è¶Š NAT é—®é¢˜ã€‚ ç›®å‰æ”¯æŒNAT ALGåŠŸèƒ½çš„åè®®åŒ…æ‹¬ï¼šDNSã€FTPã€SIPã€PPTPå’ŒRTSPã€‚NAT ALG åœ¨å¯¹è¿™äº›ç‰¹å®šåº”ç”¨å±‚åè®®è¿›è¡Œ NAT è½¬æ¢æ—¶ï¼Œé€šè¿‡ NAT çš„çŠ¶æ€ä¿¡æ¯æ¥æ”¹å˜å°è£…åœ¨ IP æŠ¥æ–‡æ•°æ®éƒ¨åˆ†çš„ç‰¹å®šæ•°æ®ï¼Œæœ€ç»ˆä½¿åº”ç”¨å±‚åè®®å¯ä»¥è·¨è¶Šä¸åŒèŒƒå›´è¿è¡Œã€‚ ","date":"2022-05-13","objectID":"/posts/about-nat/:5:6","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["NAT","ç½‘ç»œ","NAT ç©¿è¶Š","å†…ç½‘ç©¿é€","è™šæ‹Ÿç½‘ç»œ","P2P","WebRTC"],"title":"NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ","uri":"/posts/about-nat/#nat-algapplication-level-gateway"},{"categories":["tech"],"content":" ä½¿ç”¨ Go å®éªŒ NAT ç©¿é€Go å¯ç”¨çš„ NAT ç©¿è¶Šåº“æœ‰ï¼š coturn: è²Œä¼¼æ˜¯æœ€æµè¡Œçš„ STUN/TURN/ICE server go-stun: ä¸€ä¸ªç®€æ´çš„ stun client å®ç°ï¼Œå¤§æ¦‚é€‚åˆç”¨äºå­¦ä¹ ï¼Ÿ pion/turn: ä¸€ä¸ª STUN/TURN/ICE client/client å®ç° pion/ice: ä¸€ä¸ª ice å®ç° TBD å¾…å®Œå–„ ","date":"2022-05-13","objectID":"/posts/about-nat/:6:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["NAT","ç½‘ç»œ","NAT ç©¿è¶Š","å†…ç½‘ç©¿é€","è™šæ‹Ÿç½‘ç»œ","P2P","WebRTC"],"title":"NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ","uri":"/posts/about-nat/#ä½¿ç”¨-go-å®éªŒ-nat-ç©¿é€"},{"categories":["tech"],"content":" è™šæ‹Ÿç½‘ç»œã€Overlay ä¸ Underlayè™šæ‹Ÿç½‘ç»œå°±æ˜¯åœ¨ç‰©ç†ç½‘ç»œä¹‹ä¸Šï¼Œæ„å»ºçš„é€»è¾‘ç½‘ç»œï¼Œä¹Ÿè¢«ç§°ä½œ overlay ç½‘ç»œã€‚æ¯”å¦‚ AWS VPCã€Docker å®¹å™¨ç½‘ç»œã€QEMU çš„é»˜è®¤ç½‘ç»œï¼Œéƒ½æ˜¯è™šæ‹Ÿç½‘ç»œã€‚ è€Œ underlay ç½‘ç»œï¼Œåˆ™æ˜¯æŒ‡æ‰¿è½½ overlay ç½‘ç»œçš„åº•å±‚ç½‘ç»œã€‚æˆ‘ä¸ªäººç†è§£ï¼Œå®ƒæ˜¯ä¸€ä¸ªç›¸å¯¹çš„æ¦‚å¿µï¼Œç‰©ç†ç½‘ç»œä¸€å®šæ˜¯ underlay ç½‘ç»œï¼Œä½†æ˜¯è™šæ‹Ÿç½‘ç»œä¹‹ä¸Šå¦‚æœè¿˜æ‰¿è½½äº†å…¶ä»–è™šæ‹Ÿç½‘ç»œï¼ˆå¥—å¨ƒï¼‰ï¼Œé‚£å®ƒç›¸å¯¹ä¸Šå±‚ç½‘ç»œè€Œè¨€ï¼Œä¹Ÿæ˜¯ä¸€ä¸ª underlay ç½‘ç»œã€‚ overlay æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ç§éš§é“æŠ€æœ¯ï¼Œå°†åŸç”Ÿæ€çš„äºŒå±‚æ•°æ®å¸§æŠ¥æ–‡è¿›è¡Œå°è£…åé€šè¿‡éš§é“è¿›è¡Œä¼ è¾“ã€‚å¸¸è§çš„ overlay ç½‘ç»œåè®®ä¸»è¦æ˜¯ vxlan ä»¥åŠæ–°ä¸€ä»£çš„ geneveï¼Œå®ƒä¿©éƒ½æ˜¯ä½¿ç”¨ UDP åŒ…æ¥å°è£…é“¾è·¯å±‚çš„ä»¥å¤ªç½‘å¸§ã€‚ vxlan åœ¨ 2014 å¹´æ ‡å‡†åŒ–ï¼Œè€Œ geneve åœ¨ 2020 å¹´åº•æ‰é€šè¿‡è‰æ¡ˆé˜¶æ®µï¼Œç›®å‰å°šæœªå½¢æˆæœ€ç»ˆæ ‡å‡†ã€‚ä½†æ˜¯ç›®å‰ linux/cilium éƒ½å·²ç»æ”¯æŒäº† geneve. geneve ç›¸å¯¹ vxlan æœ€å¤§çš„å˜åŒ–ï¼Œæ˜¯å®ƒæ›´çµæ´»â€”â€”å®ƒçš„ header é•¿åº¦æ˜¯å¯å˜çš„ã€‚ ç›®å‰æ‰€æœ‰ overlay çš„è·¨ä¸»æœºå®¹å™¨ç½‘ç»œæ–¹æ¡ˆï¼Œå‡ ä¹éƒ½æ˜¯åŸºäº vxlan å®ç°çš„ï¼ˆä¾‹å¤–ï¼šcilium ä¹Ÿæ”¯æŒ geneveï¼‰ã€‚ vxlan/geneve çš„è¯¦ç»†ä»‹ç»ï¼Œå‚è§Linux ä¸­çš„è™šæ‹Ÿç½‘ç»œæ¥å£ - vxlan/geneve é¡ºå¸¦å†æä¸€å˜´ï¼Œcilium/calico/kube-ovn ç­‰ overlay å®¹å™¨ç½‘ç»œï¼Œéƒ½æ˜¯ SDN è½¯ä»¶å®šä¹‰ç½‘ç»œã€‚ ","date":"2022-05-13","objectID":"/posts/about-nat/:7:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["NAT","ç½‘ç»œ","NAT ç©¿è¶Š","å†…ç½‘ç©¿é€","è™šæ‹Ÿç½‘ç»œ","P2P","WebRTC"],"title":"NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ","uri":"/posts/about-nat/#è™šæ‹Ÿç½‘ç»œoverlay-ä¸-underlay"},{"categories":["tech"],"content":" ç›¸å…³å·¥å…·æœ‰ä¸€äº›ä¸“é—¨ç”¨äºè·¨ç½‘æ­å»ºç§æœ‰è™šæ‹Ÿç½‘ç»œçš„å·¥å…·ï¼Œç”±äºå®¶åº­ç½‘ç»œè®¾å¤‡å‰é¢é€šå¸¸éƒ½æœ‰è‡³å°‘ä¸€å±‚ NATï¼ˆå®¶åº­è·¯ç”±å™¨ï¼‰ï¼Œå› æ­¤è¿™äº›å·¥å…·éƒ½é‡åº¦ä¾èµ– NAT ç©¿è¶ŠæŠ€æœ¯ã€‚å¦‚æœ NAT å±‚æ•°å¤ªå¤šæ— æ³•ç©¿è¶Šï¼Œå®ƒä»¬ä¼š fallback åˆ°ä»£ç†æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯ç”±ä¸€å°å…¬ç½‘æœåŠ¡å™¨è¿›è¡Œæµé‡ä¸­ç»§ï¼Œä½†æ˜¯è¿™ä¼šå¯¹ä¸­ç»§æœåŠ¡å™¨é€ æˆå¾ˆå¤§å‹åŠ›ï¼Œå»¶è¿Ÿè·Ÿå¸¦å®½é€šå¸¸éƒ½ä¼šå·®å¾ˆå¤šã€‚ å¦‚ä¸‹æ˜¯ä¸¤ä¸ªæ¯”è¾ƒæµè¡Œçš„ VPN æ­å»ºå·¥å…·ï¼š zerotier: åœ¨ P2P ç½‘ç»œä¹‹ä¸Šæ­å»ºçš„ SDN overlay ç½‘ç»œï¼Œä½¿ç”¨è‡ªå®šä¹‰åè®®ã€‚ tailscales: åŸºäº wireguard åè®®å¿«é€Ÿæ­å»ºç§æœ‰è™šæ‹Ÿç½‘ç»œ VPN ","date":"2022-05-13","objectID":"/posts/about-nat/:7:1","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["NAT","ç½‘ç»œ","NAT ç©¿è¶Š","å†…ç½‘ç©¿é€","è™šæ‹Ÿç½‘ç»œ","P2P","WebRTC"],"title":"NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ","uri":"/posts/about-nat/#ç›¸å…³å·¥å…·"},{"categories":["tech"],"content":" VPN åè®®ä¸»æµçš„ VPN åè®®æœ‰ï¼šPPTPã€L2TPã€IPSecã€OpenVPNã€SSTPï¼Œä»¥åŠæœ€æ–°æ½®çš„ Wireguard. TBD ","date":"2022-05-13","objectID":"/posts/about-nat/:7:2","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["NAT","ç½‘ç»œ","NAT ç©¿è¶Š","å†…ç½‘ç©¿é€","è™šæ‹Ÿç½‘ç»œ","P2P","WebRTC"],"title":"NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ","uri":"/posts/about-nat/#vpn-åè®®"},{"categories":["tech"],"content":" æ‹“å±•çŸ¥è¯†","date":"2022-05-13","objectID":"/posts/about-nat/:8:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["NAT","ç½‘ç»œ","NAT ç©¿è¶Š","å†…ç½‘ç©¿é€","è™šæ‹Ÿç½‘ç»œ","P2P","WebRTC"],"title":"NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ","uri":"/posts/about-nat/#æ‹“å±•çŸ¥è¯†"},{"categories":["tech"],"content":" Symmetric NAT å…è®¸çš„æœ€å¤§å¹¶å‘ TCP è¿æ¥æ•°æ˜¯å¤šå°‘ï¼ŸTCP å¹¶å‘è¿æ¥æ•°å—è®¸å¤šå‚æ•°çš„é™åˆ¶ï¼Œä»¥ Linux æœåŠ¡å™¨ä¸ºä¾‹ï¼Œé»˜è®¤å‚æ•°æ— æ³•æ»¡è¶³éœ€è¦ï¼Œé€šå¸¸éƒ½ä¼šæ‰‹åŠ¨ä¿®æ”¹å®ƒçš„å‚æ•°ï¼Œæ”¾å®½æ–‡ä»¶æè¿°ç¬¦é™åˆ¶ä»¥åŠ TCP è¿æ¥é˜Ÿåˆ—ã€ç¼“å­˜ç›¸å…³çš„é™åˆ¶ã€‚ å•çº¯ä»ç½‘ç»œåè®®å±‚é¢åˆ†æï¼Œå¯¹äºä¸€ä¸ªä»…æœ‰ä¸€ä¸ªå…¬ç½‘ IP çš„ Symmetric NAT ç½‘å…³ï¼Œå®ƒä¸æŸä¸ªå¤–éƒ¨ç«™ç‚¹http://x.x.x.x:xx è¦å»ºç«‹è¿æ¥ã€‚è€ƒè™‘åˆ° TCP è¿æ¥çš„å®šä¹‰å®é™…ä¸Šæ˜¯ä¸€ä¸ªå››å…ƒç»„(srcIP, srcPort, dstIP, dstPort)ï¼Œå…¶ä¸­å°±åªæœ‰ NAT ç½‘å…³è‡ªå·±çš„ srcPort æ˜¯å”¯ä¸€çš„å˜é‡äº†ï¼Œè€Œç«¯å£å·æ˜¯ä¸€ä¸ª 16bits æ•°å­—ï¼Œå–å€¼èŒƒå›´ä¸º 0 - 65535ã€‚æ­¤å¤–ä½äº 1024 çš„æ•°å­—æ˜¯æ“ä½œç³»ç»Ÿçš„ä¿ç•™ç«¯å£ï¼Œ å› æ­¤ NAT ä¸€èˆ¬åªä¼šä½¿ç”¨ 1024-65535 è¿™ä¸ªåŒºé—´çš„ç«¯å£å·ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ª NAT ç½‘å…³æœ€å¤šåªèƒ½ä¸è¯¥ç«™ç‚¹å»ºç«‹ 64512 ä¸ªè¿æ¥ã€‚ é‚£ä¹ˆå¯¹äºä¸åŒçš„åè®® NAT æ˜¯å¦‚ä½•å¤„ç†çš„å‘¢ï¼ŸNAT è‚¯å®šå¯ä»¥é€šè¿‡åè®®ç‰¹å¾åŒºåˆ†ä¸åŒåè®®çš„æµé‡ï¼Œå› æ­¤ä¸åŒåè®®é€šè¿‡ NAT å»ºç«‹çš„å¹¶å‘è¿æ¥ä¸ä¼šç›¸äº’å½±å“ã€‚ å¯¹äºå®¶åº­ç½‘ç»œè€Œè¨€ 64512 ä¸ªè¿æ¥å·²ç»å®Œå…¨å¤Ÿç”¨äº†ï¼Œä½†æ˜¯å¯¹äºæ•°æ®ä¸­å¿ƒæˆ–è€…äº‘ä¸Šçš„ VPC è€Œè¨€ï¼Œå°±ä¸ä¸€å®šå¤Ÿç”¨äº†ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨AWS NAT ç½‘å…³çš„æ–‡æ¡£ä¸­å°±æœ‰æåˆ°ï¼ŒAWS NAT ç½‘å…³æœ€é«˜æ”¯æŒä¸æ¯ä¸ªä¸åŒçš„åœ°å€å»ºç«‹ 55000 ä¸ªå¹¶å‘è¿æ¥ã€‚destination çš„ IP åœ°å€ã€ç«¯å£å·ã€(TCP/UDP/ICMP) ä»»ä¸€ä¸ªå‘ç”Ÿæ”¹å˜ï¼Œéƒ½å¯ä»¥å†å»ºç«‹å…¶ä»– 55000 ä¸ªå¹¶å‘è¿æ¥ã€‚å¦‚æœè¶…è¿‡è¿™ä¸ªé™åˆ¶ï¼Œå°±ä¼šå‘ç”Ÿã€ŒErrorPortAllocationã€é”™è¯¯ã€‚å¦‚æœåœ¨ AWS ä¸Šé‡åˆ°è¿™ä¸ªé”™è¯¯ï¼Œé‚£å°±è¯´æ˜ä½ ä»¬çš„äº‘ä¸Šç½‘ç»œè§„åˆ’æœ‰é—®é¢˜äº†ã€‚ å½“ç„¶é™¤äº†ç«¯å£é™åˆ¶å¤–ï¼Œå—é™äº NAT ç¡¬ä»¶ã€ä»¥å¤ªç½‘åè®®ä»¥åŠå…¶ä»–å½±å“ï¼ŒNAT ç½‘å…³è‚¯å®šè¿˜æœ‰åŒ…å¤„ç†é€Ÿç‡ã€å¸¦å®½çš„é™åˆ¶ï¼Œè¿™ä¸ªå°±ç•¥è¿‡ä¸æäº†ã€‚ ","date":"2022-05-13","objectID":"/posts/about-nat/:8:1","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["NAT","ç½‘ç»œ","NAT ç©¿è¶Š","å†…ç½‘ç©¿é€","è™šæ‹Ÿç½‘ç»œ","P2P","WebRTC"],"title":"NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ","uri":"/posts/about-nat/#symmetric-nat-å…è®¸çš„æœ€å¤§å¹¶å‘-tcp-è¿æ¥æ•°æ˜¯å¤šå°‘"},{"categories":["tech"],"content":" AWS VPC ä¸ NATAWS VPC(virtual private cloud) æ˜¯ä¸€ä¸ªé€»è¾‘éš”ç¦»çš„è™šæ‹Ÿç§æœ‰ç½‘ç»œï¼Œäº‘æœåŠ¡æ¶æ„çš„æœ€ä½³å®è·µä¹‹ä¸€å°±æ˜¯é€šè¿‡ VPC æ­å»ºäº‘ä¸Šç§æœ‰ç½‘ç»œï¼Œæå‡ç½‘ç»œå®‰å…¨æ€§ã€‚ AWS VPC æä¾›ä¸¤ç§ç½‘å…³ç±»å‹ï¼š NAT ç½‘å…³ æ”¯æŒä¸‰ç§åè®®ï¼šTCP, UDP, ICMP æ”¯æŒ IPv4 ä¸ IPv6 ä¸¤ç§ IP åè®® æ”¯æŒ 5 Gbps å¸¦å®½ï¼Œå¯è‡ªåŠ¨æ‰©å±•åˆ° 45 Gbps å¯é€šè¿‡åˆ’åˆ†å­ç½‘å¹¶åœ¨å¤šä¸ªå­ç½‘ä¸­æ·»åŠ  NAT ç½‘å…³çš„æ–¹å¼ï¼Œè·å¾—è¶…è¿‡ 45Gbps çš„å¸¦å®½ æœ€é«˜æ”¯æŒä¸æ¯ä¸ªä¸åŒçš„åœ°å€å»ºç«‹ 55000 ä¸ªå¹¶å‘è¿æ¥ NAT ç½‘å…³ä»å±äº VPC çš„å­ç½‘ æ¯ä¸ª NAT ç½‘å…³åªèƒ½ç»‘å®šä¸€ä¸ª IP å¯é€šè¿‡åˆ’åˆ†å­ç½‘å¹¶åœ¨å¤šä¸ªå­ç½‘ä¸­æ·»åŠ  NAT ç½‘å…³çš„æ–¹å¼è·å¾—å¤šä¸ª IP å¯è¾¾åˆ° 100w packets æ¯ç§’çš„å¤„ç†é€Ÿåº¦ï¼Œå¹¶èƒ½è‡ªåŠ¨æ‰©å±•åˆ° 400w packets æ¯ç§’ åŒæ ·ï¼Œéœ€è¦æ›´é«˜çš„å¤„ç†é€Ÿåº¦ï¼Œè¯·æ·»åŠ æ›´å¤š NAT ç½‘å…³ æŒ‰å¤„ç†æ•°æ®é‡æ”¶è´¹ é»˜è®¤è·¯ç”±åˆ° NAT å­ç½‘ï¼Œè¢«ç§°ä¸ºã€Œç§æœ‰å­ç½‘ã€ï¼ˆæˆ–è€…æ²¡é»˜è®¤è·¯ç”±ï¼Œé‚£å°±æ˜¯æ— æ³•è®¿é—®å…¬ç½‘çš„ç§æœ‰å­ç½‘ï¼‰ï¼Œè¿æ¥åªèƒ½ç”±å†…ç½‘ç¨‹åºä¸»åŠ¨å‘èµ·ã€‚ NAT ç½‘å…³ä¸ºæµé‡æ‰§è¡Œã€ŒSymmetric NATã€ IGW å› ç‰¹ç½‘ç½‘å…³ IGW æ˜¯ä¸€ä¸ªé«˜åº¦å¯ç”¨çš„é€»è¾‘ç»„ä»¶ï¼Œä¸ä¼šé™åˆ¶ VPC çš„æ€»å¸¦å®½ã€å¤„ç†èƒ½åŠ›ã€‚ IGW å®ä¾‹ç›´æ¥å…³è” VPCï¼Œä¸ä»å±äºä»»ä½•å¯ç”¨åŒºæˆ–å­ç½‘ IGW å®è´¨ä¸Šæ˜¯ä¸€ä¸ª NAT è®¾å¤‡ï¼Œä¸ºç»‘å®šäº†å…¬ç½‘ IP åœ°å€çš„ ENI/EC2 å®ä¾‹ï¼Œæ‰§è¡Œã€Œä¸€å¯¹ä¸€ NATã€ é»˜è®¤è·¯ç”±åˆ° IGW çš„å­ç½‘ï¼Œè¢«ç§°ä¸ºã€Œå…¬æœ‰å­ç½‘ã€ ","date":"2022-05-13","objectID":"/posts/about-nat/:8:2","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["NAT","ç½‘ç»œ","NAT ç©¿è¶Š","å†…ç½‘ç©¿é€","è™šæ‹Ÿç½‘ç»œ","P2P","WebRTC"],"title":"NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ","uri":"/posts/about-nat/#aws-vpc-ä¸-nat"},{"categories":["tech"],"content":" å‚è€ƒ What Is Network Address Translation (NAT)? - Huawei Docs What Is STUN? - Huawei Docs NetEngine AR V300R019 é…ç½®æŒ‡å—-IPä¸šåŠ¡ - NAT ç©¿è¶Š - åä¸ºæ–‡æ¡£ P2PæŠ€æœ¯è¯¦è§£(ä¸€)ï¼šNATè¯¦è§£â€”â€”è¯¦ç»†åŸç†ã€P2Pç®€ä»‹ P2PæŠ€æœ¯è¯¦è§£(äºŒ)ï¼šP2Pä¸­çš„NATç©¿è¶Š(æ‰“æ´)æ–¹æ¡ˆè¯¦è§£ P2PæŠ€æœ¯è¯¦è§£(ä¸‰)ï¼šP2Pä¸­çš„NATç©¿è¶Š(æ‰“æ´)æ–¹æ¡ˆè¯¦è§£(è¿›é˜¶åˆ†æç¯‡) Connect to the internet using an internet gateway - AWS VPC Internet Gateway ä»DNATåˆ°netfilterå†…æ ¸å­ç³»ç»Ÿï¼Œæµ…è°ˆLinuxçš„Full Cone NATå®ç° Network address translation - wikipedia WebRTC NAT Traversal Methods: A Case for Embedded TURN WireGuard æ•™ç¨‹ï¼šä½¿ç”¨ DNS-SD è¿›è¡Œ NAT-to-NAT ç©¿é€ - äº‘åŸç”Ÿå®éªŒå®¤ ","date":"2022-05-13","objectID":"/posts/about-nat/:9:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["NAT","ç½‘ç»œ","NAT ç©¿è¶Š","å†…ç½‘ç©¿é€","è™šæ‹Ÿç½‘ç»œ","P2P","WebRTC"],"title":"NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ","uri":"/posts/about-nat/#å‚è€ƒ"},{"categories":["tech"],"content":" FinOps æ˜¯ä¸€ç§ä¸æ–­å‘å±•çš„äº‘è´¢åŠ¡ç®¡ç†å­¦ç§‘å’Œæ–‡åŒ–å®è·µï¼Œé€šè¿‡å¸®åŠ©å·¥ç¨‹ã€è´¢åŠ¡ã€æŠ€æœ¯å’Œä¸šåŠ¡å›¢é˜Ÿåœ¨æ•°æ®é©±åŠ¨çš„é¢„ç®—åˆ†é…ä¸Šè¿›è¡Œåä½œï¼Œä½¿æˆæœ¬é¢„ç®—èƒ½å¤Ÿäº§ç”Ÿæœ€å¤§çš„ä¸šåŠ¡ä»·å€¼ã€‚ ","date":"2022-05-04","objectID":"/posts/finops-for-kubernetes/:0:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Kubernetes","FinOps","æˆæœ¬åˆ†æ","Kubecost","MultiCloud","å¤šäº‘","å¤šäº‘è´¢åŠ¡ç®¡æ§"],"title":"FinOps for Kubernetes - å¦‚ä½•æ‹†åˆ† Kubernetes æˆæœ¬","uri":"/posts/finops-for-kubernetes/#"},{"categories":["tech"],"content":" äº‘è®¡ç®—æˆæœ¬ç®¡æ§éšç€è¶Šæ¥è¶Šå¤šçš„ä¼ä¸šä¸Šäº‘ï¼Œäº‘è®¡ç®—çš„æˆæœ¬ç®¡æ§ä¹Ÿè¶Šæ¥è¶Šå—å…³æ³¨ã€‚åœ¨è®¨è®º Kubernetes æˆæœ¬ä¹‹å‰ï¼Œå…ˆç®€å•èŠä¸‹å¦‚ä½•ç®¡æ§äº‘è®¡ç®—æˆæœ¬ï¼Œæœ‰ä¸€ä¸ªæ–°åè¯è¢«ç”¨äºå½¢å®¹è¿™é¡¹å·¥ä½œâ€”â€”FinOps. ä¼ ç»Ÿçš„æ•°æ®ä¸­å¿ƒçš„æˆæœ¬æ˜¯æ¯”è¾ƒå›ºå®šçš„ï¼Œæ‰€æœ‰çš„æˆæœ¬å˜åŠ¨é€šå¸¸éƒ½ä¼´éšç€ç¡¬ä»¶æ›´æ›¿ã€‚è€Œåœ¨äº‘ä¸Šç¯å¢ƒå°±å¾ˆä¸ä¸€æ ·äº†ï¼Œç”±äºäº‘æœåŠ¡çš„æŒ‰é‡æ”¶è´¹ç‰¹æ€§ï¼Œä»¥åŠäº”èŠ±å…«é—¨çš„è®¡è´¹è§„åˆ™ï¼Œå¼€å‘äººå‘˜ç¨æœ‰ä¸æ…ï¼Œäº‘æˆæœ¬å°±å¯èƒ½ä¼šå‡ºç°æ„æ–™ä¹‹å¤–çš„å˜åŒ–ã€‚å¦ä¸€æ–¹é¢ç”±äºè®¡è´¹çš„å¤æ‚æ€§ï¼Œä¸šåŠ¡æ‰©å®¹å¯¹æˆæœ¬çš„å½±å“ä¹Ÿå˜å¾—éš¾ä»¥é¢„æµ‹ã€‚ ç›®å‰çš„ä¸»æµäº‘æœåŠ¡å•†ï¼ˆAWS/GCP/Alicloud/â€¦ï¼‰åŸºæœ¬éƒ½æä¾›åŸºäºèµ„æºæ ‡ç­¾çš„æˆæœ¬æŸ¥è¯¢æ–¹æ³•ï¼Œä¹Ÿæ”¯æŒå°†æˆæœ¬å¯¼å‡ºå¹¶ä½¿ç”¨ SQL è¿›è¡Œç»†è‡´åˆ†æã€‚å› æ­¤å…¶å®è¦åšåˆ°å¿«é€Ÿé«˜æ•ˆçš„äº‘æˆæœ¬åˆ†æä¸ç®¡æ§ï¼Œä¸»è¦å°±æ¶‰åŠåˆ°å¦‚ä¸‹å‡ ä¸ªç‚¹ï¼š å¥‘åˆéœ€æ±‚çš„æ ‡ç­¾è§„èŒƒ: ä»å…¬å¸ä¸šåŠ¡ä¾§éœ€æ±‚å‡ºå‘ï¼Œåˆ¶å®šå‡ºåˆç†çš„ã€å¤šç»´åº¦çš„ ï¼ˆDepartment/Team/Product/â€¦ï¼‰ã€æœ‰æ‰©å±•ç©ºé—´çš„æ ‡ç­¾è§„èŒƒï¼Œè¿™æ ·æ‰èƒ½æŒ‰ä¸šåŠ¡ä¾§éœ€è¦è¿›è¡Œæˆæœ¬åˆ†æã€‚ èµ„æºæ ‡ç­¾çš„å‡†ç¡®ç‡: éšç€å…¬å¸ä¸šåŠ¡çš„å‘å±•ï¼Œæ ‡ç­¾è§„èŒƒçš„è¿­ä»£ï¼Œæ ‡ç­¾çš„å‡†ç¡®ç‡æ€»æ˜¯ä¼šä¸Šä¸‹æ³¢åŠ¨ã€‚è€Œæ ‡ç­¾å‡†ç¡®ç‡è¶Šé«˜ï¼Œæˆ‘ä»¬å¯¹äº‘è®¡ç®—æˆæœ¬çš„ç®¡æ§èƒ½åŠ›å°±è¶Šå¼ºã€‚ ä½†æ˜¯ä¹Ÿå­˜åœ¨è®¸å¤šç‰¹æ®Šçš„äº‘ä¸Šèµ„æºï¼Œäº‘æœåŠ¡å•†ç›®å‰å¹¶æœªæä¾›è‰¯å¥½çš„æˆæœ¬åˆ†ææ‰‹æ®µï¼ŒKubernetes é›†ç¾¤æˆæœ¬å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚ ","date":"2022-05-04","objectID":"/posts/finops-for-kubernetes/:1:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Kubernetes","FinOps","æˆæœ¬åˆ†æ","Kubecost","MultiCloud","å¤šäº‘","å¤šäº‘è´¢åŠ¡ç®¡æ§"],"title":"FinOps for Kubernetes - å¦‚ä½•æ‹†åˆ† Kubernetes æˆæœ¬","uri":"/posts/finops-for-kubernetes/#äº‘è®¡ç®—æˆæœ¬ç®¡æ§"},{"categories":["tech"],"content":" Kubernetes æˆæœ¬åˆ†æçš„éš¾ç‚¹ç›®å‰è®¸å¤šä¼ä¸šåº”è¯¥éƒ½é¢ä¸´ç€è¿™æ ·çš„åœºæ™¯ï¼šæ‰€æœ‰çš„æœåŠ¡éƒ½è¿è¡Œåœ¨ä¸€æˆ–å¤šä¸ª Kubernetes é›†ç¾¤ä¸Šï¼Œå…¶ä¸­åŒ…å«å¤šæ¡ä¸šåŠ¡çº¿ã€å¤šä¸ªäº§å“ã€å¤šä¸ªä¸šåŠ¡å›¢é˜Ÿçš„æœåŠ¡ï¼Œç”šè‡³é™¤äº†ä¸šåŠ¡æœåŠ¡ï¼Œå¯èƒ½è¿˜åŒ…å« CICDã€æ•°æ®åˆ†æã€æœºå™¨å­¦ä¹ ç­‰å¤šç§å…¶ä»–å·¥ä½œè´Ÿè½½ã€‚è€Œè¿™äº› Kubernetes é›†ç¾¤é€šå¸¸éƒ½ç”±ä¸€ä¸ªç‹¬ç«‹çš„ SRE éƒ¨é—¨ç®¡ç†ã€‚ ä½†æ˜¯ Kubernetes é›†ç¾¤æœ¬èº«å¹¶ä¸æä¾›æˆæœ¬æ‹†åˆ†çš„èƒ½åŠ›ï¼Œæˆ‘ä»¬åªèƒ½æŸ¥åˆ°é›†ç¾¤çš„æ•´ä½“æˆæœ¬ã€æ¯ä¸ªèŠ‚ç‚¹ç»„çš„æˆæœ¬ç­‰è¿™æ ·ç²—ç²’åº¦çš„æˆæœ¬ä¿¡æ¯ï¼Œç¼ºä¹ç»†ç²’åº¦çš„æˆæœ¬åˆ†æèƒ½åŠ›ã€‚æ­¤å¤–ï¼ŒKubernetes é›†ç¾¤æ˜¯ä¸€ä¸ªéå¸¸åŠ¨æ€çš„è¿è¡Œç¯å¢ƒï¼Œå…¶èŠ‚ç‚¹çš„æ•°é‡ã€èŠ‚ç‚¹è§„æ ¼ã€Pod æ‰€åœ¨çš„èŠ‚ç‚¹/Zone/Regionï¼Œéƒ½å¯èƒ½ä¼šéšç€æ—¶é—´åŠ¨æ€å˜åŠ¨ï¼Œè¿™ä¸ºæˆæœ¬åˆ†æå¸¦æ¥äº†æ›´å¤§çš„å›°éš¾ã€‚ è¿™å°±å¯¼è‡´æˆ‘ä»¬å¾ˆéš¾å›ç­”è¿™äº›é—®é¢˜ï¼šæ¯æ¡ä¸šåŠ¡çº¿ã€æ¯ä¸ªäº§å“ã€æ¯ä¸ªä¸šåŠ¡å›¢é˜Ÿã€æˆ–è€…æ¯ä¸ªæœåŠ¡åˆ†åˆ«èŠ±äº†å¤šå°‘é’±ï¼Ÿæ˜¯å¦å­˜åœ¨èµ„æºæµªè´¹ï¼Ÿæœ‰ä½•ä¼˜åŒ–æ‰‹æ®µï¼Ÿ è€Œ FinOps for Kubernetesï¼Œå°±æ˜¯é€šè¿‡å·¥ç¨‹åŒ–åˆ†æã€å¯è§†åŒ–æˆæœ¬åˆ†æç­‰æ‰‹æ®µï¼Œæ¥å›ç­”è¿™äº›æˆæœ¬é—®é¢˜ï¼Œåˆ†æä¸ç®¡æ§ Kubernetes çš„æˆæœ¬ã€‚ æ¥ä¸‹æ¥æˆ‘ä¼šå…ˆä»‹ç»ä¸‹äº‘ä¸Š Kubernetes æˆæœ¬åˆ†æçš„æ€è·¯ä¸æ‰‹æ®µï¼Œæœ€åå†ä»‹ç»å¦‚ä½•ä½¿ç”¨ Kubecost åˆ†æ Kubernetes é›†ç¾¤çš„æˆæœ¬ã€‚ è¦åšå¥½ Kubernetes æˆæœ¬å·¥ä½œï¼Œæœ‰å¦‚ä¸‹ä¸‰ä¸ªè¦ç‚¹ï¼š ç†è§£ Kubernetes æˆæœ¬çš„æ„æˆï¼Œææ‡‚å‡†ç¡®åˆ†æ Kubernetes æˆæœ¬æœ‰å“ªäº›éš¾ç‚¹ å¯»æ‰¾ä¼˜åŒ– Kubernetes é›†ç¾¤ã€ä¸šåŠ¡æœåŠ¡çš„æ‰‹æ®µ ç¡®å®š Kubernetes é›†ç¾¤çš„æˆæœ¬æ‹†åˆ†æ‰‹æ®µï¼Œå»ºç«‹èƒ½å¿«é€Ÿé«˜æ•ˆåœ°åˆ†æä¸ç®¡æ§é›†ç¾¤æˆæœ¬çš„æµç¨‹ ","date":"2022-05-04","objectID":"/posts/finops-for-kubernetes/:2:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Kubernetes","FinOps","æˆæœ¬åˆ†æ","Kubecost","MultiCloud","å¤šäº‘","å¤šäº‘è´¢åŠ¡ç®¡æ§"],"title":"FinOps for Kubernetes - å¦‚ä½•æ‹†åˆ† Kubernetes æˆæœ¬","uri":"/posts/finops-for-kubernetes/#kubernetes-æˆæœ¬åˆ†æçš„éš¾ç‚¹"},{"categories":["tech"],"content":" Kubernetes æˆæœ¬çš„æ„æˆä»¥ AWS EKS ä¸ºä¾‹ï¼Œå®ƒçš„æˆæœ¬æœ‰è¿™äº›ç»„æˆéƒ¨åˆ†ï¼š AWS EKS æœ¬èº«æœ‰ $0.1 per hour çš„å›ºå®šè´¹ç”¨ï¼Œè¿™ä¸ªå¾ˆä½ EKS çš„æ‰€æœ‰èŠ‚ç‚¹ä¼šæ”¶å¯¹åº”çš„ EC2 å®ä¾‹è¿è¡Œè´¹ç”¨ã€EBS æ•°æ®å·è´¹ç”¨ EKS ä¸­ä½¿ç”¨çš„ PV ä¼šå¸¦æ¥ EBS æ•°æ®å·çš„è´¹ç”¨ è·¨åŒºæµé‡ä¼ è¾“è´¹ç”¨ æ‰€æœ‰èŠ‚ç‚¹ä¹‹é—´çš„é€šè®¯ï¼ˆä¸»è¦æ˜¯æœåŠ¡ä¹‹é—´çš„äº’ç›¸è®¿é—®ï¼‰ï¼Œå¦‚æœè·¨äº†å¯ç”¨åŒºï¼Œä¼šæ”¶è·¨åŒºæµé‡ä¼ è¾“è´¹ç”¨ EKS ä¸­çš„æœåŠ¡è®¿é—®å…¶ä»– AWS æœåŠ¡å¦‚ RDS/ElastiCacheï¼Œå¦‚æœæ˜¯è·¨å¯ç”¨åŒºï¼Œä¼šæ”¶å–è·¨åŒºæµé‡è´¹ç”¨ å¦‚æœä½¿ç”¨äº† Istio IngressGateway æˆ– traefik ç­‰ç½‘å…³å±‚ä»£ç† Podï¼Œé‚£è¿™äº› Pod ä¸æœåŠ¡å®ä¾‹ä¹‹é—´ï¼Œæœ‰å¯èƒ½ä¼šäº§ç”Ÿè·¨åŒºæµé‡ NAT ç½‘å…³è´¹ç”¨ EKS ä¸­çš„å®¹å™¨å¦‚æœè¦è®¿é—®å› ç‰¹ç½‘ï¼Œå°±éœ€è¦é€šè¿‡ NAT ç½‘å…³ï¼Œäº§ç”Ÿ NAT è´¹ç”¨ å¦‚æœ VPC æœªé…ç½® endpoints ä½¿è®¿é—® AWS æœåŠ¡ï¼ˆdynamodb/s3 ç­‰ï¼‰æ—¶ç›´æ¥èµ° AWS å†…éƒ¨ç½‘ç»œï¼Œè¿™äº›æµé‡ä¼šç»è¿‡ VPC çš„ NAT ç½‘å…³ï¼Œä»è€Œäº§ç”Ÿ NAT ç½‘å…³è´¹ç”¨ å¯¹äºæ‰˜ç®¡ç‰ˆ NAT ç½‘å…³ï¼Œè´¹ç”¨åˆåŒ…å«ä¸¤éƒ¨åˆ†ï¼šå…¬ç½‘æµé‡è´¹ + NAT æ•°æ®å¤„ç†è´¹ç”¨ã€‚å…¶ä¸­æ•°æ®å¤„ç†è´¹ç”¨å¯é€šè¿‡è‡ªå»º NAT å®ä¾‹æ¥ç¼©å‡ã€‚ æœåŠ¡å¦‚æœè¦å¯¹å¤–æä¾›è®¿é—®ï¼Œæœ€ä½³å®è·µæ˜¯é€šè¿‡ aws-load-balancer-controller ç»‘å®š AWS ALB, è¿™é‡Œä¼šäº§ç”Ÿ ALB è´¹ç”¨ ç›‘æ§ç³»ç»Ÿæˆæœ¬ Kubernetes çš„ç›‘æ§ç³»ç»Ÿæ˜¯ä¸å¯æˆ–ç¼ºçš„ å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Datadog/NewRelic ç­‰äº‘æœåŠ¡ï¼Œä¼šé€ æˆäº‘æœåŠ¡çš„æˆæœ¬ï¼›å¦‚æœæ˜¯è‡ªå»º Prometheusï¼Œ ä¼šé€ æˆ Prometheus çš„è¿è¡Œæˆæœ¬ï¼Œä»¥åŠ Pull æŒ‡æ ‡é€ æˆçš„è·¨åŒºæµé‡æˆæœ¬ æ€»ç»“ä¸‹ï¼Œå…¶å®å°±æ˜¯ä¸‰éƒ¨åˆ†æˆæœ¬ï¼šè®¡ç®—ã€å­˜å‚¨ã€ç½‘ç»œã€‚å…¶ä¸­è®¡ç®—ä¸å­˜å‚¨æˆæœ¬æ˜¯ç›¸å¯¹å›ºå®šçš„ï¼Œè€Œç½‘ç»œæˆæœ¬å°±æ¯”è¾ƒåŠ¨æ€ï¼Œè·Ÿæ˜¯å¦è·¨åŒºã€æ˜¯å¦é€šè¿‡ NAT ç­‰è¯¸å¤šå› ç´ æœ‰å…³ã€‚ ","date":"2022-05-04","objectID":"/posts/finops-for-kubernetes/:3:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Kubernetes","FinOps","æˆæœ¬åˆ†æ","Kubecost","MultiCloud","å¤šäº‘","å¤šäº‘è´¢åŠ¡ç®¡æ§"],"title":"FinOps for Kubernetes - å¦‚ä½•æ‹†åˆ† Kubernetes æˆæœ¬","uri":"/posts/finops-for-kubernetes/#kubernetes-æˆæœ¬çš„æ„æˆ"},{"categories":["tech"],"content":" Kubernetes èµ„æºåˆ†é…çš„æ–¹å¼Kubernetes æä¾›äº†ä¸‰ç§èµ„æºåˆ†é…çš„æ–¹å¼ï¼Œå³æœåŠ¡è´¨é‡ QoSï¼Œä¸åŒçš„åˆ†é…æ–¹å¼ï¼Œæˆæœ¬çš„è®¡ç®—éš¾åº¦ä¹Ÿæœ‰åŒºåˆ«ï¼š Guaranteed resource allocation(ä¿è¯èµ„æºåˆ†é…): å³å°† requests ä¸ limits è®¾ç½®ä¸ºç›¸ç­‰ï¼Œç¡®ä¿é¢„ç•™æ‰€æœ‰æ‰€éœ€èµ„æº æœ€ä¿å®ˆçš„ç­–ç•¥ï¼ŒæœåŠ¡æ€§èƒ½æœ€å¯é ï¼Œä½†æ˜¯æˆæœ¬ä¹Ÿæœ€é«˜ è¿™ç§æ–¹å¼åˆ†é…çš„èµ„æºï¼Œæ‹†åˆ†èµ·æ¥æ˜¯æœ€æ–¹ä¾¿çš„ï¼Œå› ä¸ºå®ƒçš„è®¡ç®—æˆæœ¬æ˜¯é™æ€çš„ Burstable resource allocation(çªå‘æ€§èƒ½): å°† requests è®¾ç½®å¾—æ¯” limits ä½ï¼Œè¿™æ ·ç›¸å·®çš„è¿™ä¸€éƒ¨åˆ†å°±æ˜¯æœåŠ¡çš„å¯ Burst èµ„æºé‡ã€‚ æœ€ä½³å®è·µï¼Œé€‰æ‹©åˆé€‚çš„ requests ä¸ limitsï¼Œå¯è¾¾æˆæ€§èƒ½ä¸å¯é æ€§ä¹‹é—´çš„å¹³è¡¡ è¿™ç§èµ„æºï¼Œå®ƒ requests çš„è®¡ç®—æˆæœ¬æ˜¯é™æ€çš„ï¼ŒBurstable éƒ¨åˆ†çš„è®¡ç®—æˆæœ¬æ˜¯åŠ¨æ€çš„ Best effort resource allocation(å°½åŠ›è€Œä¸º): åªè®¾ç½® limitsï¼Œä¸è®¾ç½® requestsï¼Œè®© Pod å¯ä»¥è°ƒåº¦åˆ°ä»»ä½•å¯è°ƒåº¦çš„èŠ‚ç‚¹ä¸Š ä¸‹ç­–ï¼Œè¿™ä¸ªé€‰é¡¹ä¼šå¯¼è‡´æœåŠ¡çš„æ€§èƒ½æ— æ³•ä¿è¯ï¼Œé€šå¸¸åªåœ¨å¼€å‘æµ‹è¯•ç­‰èµ„æºå—é™çš„ç¯å¢ƒä½¿ç”¨ è¿™ç§æ–¹å¼åˆ†é…çš„èµ„æºï¼Œå®Œå…¨ä¾èµ–ç›‘æ§æŒ‡æ ‡è¿›è¡Œæˆæœ¬æ‹†åˆ† ","date":"2022-05-04","objectID":"/posts/finops-for-kubernetes/:4:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Kubernetes","FinOps","æˆæœ¬åˆ†æ","Kubecost","MultiCloud","å¤šäº‘","å¤šäº‘è´¢åŠ¡ç®¡æ§"],"title":"FinOps for Kubernetes - å¦‚ä½•æ‹†åˆ† Kubernetes æˆæœ¬","uri":"/posts/finops-for-kubernetes/#kubernetes-èµ„æºåˆ†é…çš„æ–¹å¼"},{"categories":["tech"],"content":" æœ€ä½³å®è·µè¦åšåˆ°ç»Ÿä¸€åˆ†æã€æ‹†åˆ† Kubernetes ä¸å…¶ä»–äº‘èµ„æºçš„æˆæœ¬ï¼Œå¦‚ä¸‹æ˜¯ä¸€äº›æœ€ä½³å®è·µï¼š æŒ‰äº§å“æˆ–è€…ä¸šåŠ¡çº¿æ¥åˆ’åˆ†åå­—ç©ºé—´ï¼Œä¸å…è®¸è·¨åå­—ç©ºé—´äº’ç›¸è®¿é—®ã€‚ å¦‚æœå­˜åœ¨å¤šä¸ªäº§å“æˆ–ä¸šåŠ¡çº¿å…±ç”¨çš„æœåŠ¡ï¼Œå¯ä»¥åœ¨æ¯ä¸ªäº§å“çš„åå­—ç©ºé—´åˆ†åˆ«éƒ¨ç½²ä¸€ä¸ªå‰¯æœ¬ï¼Œå¹¶æŠŠå®ƒä»¬å½“æˆä¸åŒçš„æœåŠ¡æ¥å¤„ç†ã€‚ è¿™æ ·åå­—ç©ºé—´å°±æ˜¯æˆæœ¬åˆ’åˆ†çš„ä¸€ä¸ªç»´åº¦ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨åå­—ç©ºé—´ä¸Šä¸ºæ¯ä¸ªäº§å“è®¾ç½®èµ„æºä¸Šé™ä¸é¢„è­¦ã€‚ æŒ‰äº§å“æˆ–ä¸šåŠ¡çº¿æ¥åˆ’åˆ†èŠ‚ç‚¹ç»„ï¼Œé€šè¿‡èŠ‚ç‚¹ç»„çš„æ ‡ç­¾æ¥è¿›è¡Œæˆæœ¬åˆ’åˆ† è¿™æ˜¯ç¬¬äºŒä¸ªç»´åº¦ï¼Œä½†æ˜¯èŠ‚ç‚¹ç»„åˆ’åˆ†å¾—å¤ªç»†ï¼Œå¯èƒ½ä¼šå¯¼è‡´èµ„æºåˆ©ç”¨ä¸å¤Ÿå……åˆ†ã€‚ è¿™ä¸ªæ–¹æ¡ˆä»…ä¾›å‚è€ƒï¼Œä¸ä¸€å®šå¥½ç”¨ ä¸º Kubernetes æœåŠ¡è®¾è®¡ä¸å…¶ä»–äº‘èµ„æºä¸€è‡´çš„æˆæœ¬æ ‡ç­¾ï¼Œæ·»åŠ åˆ° Pod çš„ label ä¸­ï¼Œé€šè¿‡ kubecost ç­‰æ‰‹æ®µï¼ŒåŸºäº label è¿›è¡Œæ›´ç»†è‡´çš„æˆæœ¬åˆ†æ æ ‡ç­¾ä¸€è‡´çš„å¥½å¤„æ˜¯å¯ä»¥ç»Ÿä¸€åˆ†æ Kubernetes ä¸å…¶ä»–äº‘èµ„æºçš„æˆæœ¬ å®šæœŸï¼ˆæ¯”å¦‚æ¯å‘¨ä¸€ï¼‰ check äº‘æˆæœ¬å˜åŒ–ï¼Œå®šä½å¹¶è§£å†³æˆæœ¬å¼‚å¸¸ å»ºç«‹è‡ªåŠ¨åŒ–çš„æˆæœ¬å¼‚å¸¸æ£€æµ‹ä¸å‘Šè­¦æœºåˆ¶ï¼ˆéƒ¨åˆ†äº‘æœåŠ¡æœ‰æä¾›ç±»ä¼¼çš„æœåŠ¡ï¼Œä¹Ÿå¯è‡ªå»ºï¼‰ï¼Œæ”¶åˆ°å‘Šè­¦å³è§¦å‘æˆæœ¬å¼‚å¸¸åˆ†æä»»åŠ¡ å§‹ç»ˆå°†èµ„æºæ ‡ç­¾å‡†ç¡®ç‡ç»´æŒåœ¨è¾ƒé«˜æ•°å€¼ï¼Œå‡†ç¡®ç‡ä½äºä¸€å®šæ•°å€¼å³è‡ªåŠ¨å‘Šè­¦ï¼Œè§¦å‘æ ‡ç­¾ä¿®æ­£ä»»åŠ¡ å°†æˆæœ¬ä¸Šå‡çš„å‹åŠ›ä¸æˆæœ¬ä¸‹é™çš„æ•ˆç›Šè¦†ç›–åˆ°å¼€å‘äººå‘˜ï¼Œæˆæƒä»–ä»¬è·Ÿè¸ªæœåŠ¡çš„ Kubernetes åˆ©ç”¨ç‡ä¸æˆæœ¬ï¼Œä»¥æ¿€åŠ±å¼€å‘äººå‘˜ä¸ SRE åˆä½œç®¡æ§æœåŠ¡æˆæœ¬ã€‚ æˆæœ¬ä¼˜åŒ–å®è·µï¼š å¤šç§å·¥ä½œè´Ÿè½½æ··åˆéƒ¨ç½²ï¼Œæå‡èµ„æºåˆ©ç”¨ç‡ã€‚ä½†æ˜¯éœ€è¦åˆç†è§„åˆ’é¿å…èµ„æºç«äº‰ è°ƒèŠ‚é›†ç¾¤ä¼¸ç¼©ç»„ä»¶ï¼Œåœ¨ä¿éšœ SLA çš„å‰æä¸‹æå‡èµ„æºåˆ©ç”¨ç‡ æ¯”å¦‚ aws å°±å¯ä»¥è€ƒè™‘åœ¨ä¸€äº›åœºæ™¯ä¸‹ç”¨ karpenter æ¥åšæ‰©ç¼©å®¹ã€å¼•å…¥AWS Node Termination Handler æå‡ Spot å®ä¾‹çš„ SLA å°½é‡ä½¿ç”¨ç«ä»·å®ä¾‹ï¼ŒAWS çš„ç«ä»·å®ä¾‹å•ä»·å¹³å‡ä¼˜æƒ è¶…è¿‡ 50% åˆç†åœ°è´­ä¹° Saving Plans ä¸ Reserved Instancesï¼Œè¾¾æˆæˆæœ¬èŠ‚çº¦ã€‚ ","date":"2022-05-04","objectID":"/posts/finops-for-kubernetes/:5:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Kubernetes","FinOps","æˆæœ¬åˆ†æ","Kubecost","MultiCloud","å¤šäº‘","å¤šäº‘è´¢åŠ¡ç®¡æ§"],"title":"FinOps for Kubernetes - å¦‚ä½•æ‹†åˆ† Kubernetes æˆæœ¬","uri":"/posts/finops-for-kubernetes/#æœ€ä½³å®è·µ"},{"categories":["tech"],"content":" å¤šäº‘ç¯å¢ƒä¸Šè¿°è®¨è®ºçš„ç»å¤§éƒ¨åˆ†ç­–ç•¥ï¼Œéƒ½é€‚ç”¨äºå¤šäº‘ç¯å¢ƒã€‚åœ¨è¿™ç§æ¶‰åŠå¤šä¸ªäº‘æœåŠ¡æä¾›å•†çš„åœºæ™¯ï¼Œæœ€é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼šæ­å»ºå¹³å°æ— å…³çš„æˆæœ¬åˆ†æä¸ç®¡æ§å¹³å°ã€‚è€Œå…¶æ ¸å¿ƒä»ç„¶æ˜¯æ–‡ç« æœ€å‰é¢æåˆ°çš„ä¸¤ç‚¹ï¼Œåªéœ€è¦è¡¥å……ä¸¤ä¸ªå­— ä¸€è‡´ï¼š ä¸€è‡´çš„èµ„æºæ ‡ç­¾è§„èŒƒ: ä»å…¬å¸ä¸šåŠ¡ä¾§éœ€æ±‚å‡ºå‘ï¼Œåˆ¶å®šå‡ºè·¨å¹³å°ä¸€è‡´çš„æ ‡ç­¾è§„èŒƒï¼Œè¿™æ ·æ‰èƒ½ç»Ÿä¸€åˆ†æå¤šäº‘æˆæœ¬ã€‚ èµ„æºæ ‡ç­¾çš„å‡†ç¡®ç‡: éšç€å…¬å¸ä¸šåŠ¡çš„å‘å±•ï¼Œæ ‡ç­¾è§„èŒƒçš„è¿­ä»£ï¼Œæ ‡ç­¾çš„å‡†ç¡®ç‡æ€»æ˜¯ä¼šä¸Šä¸‹æ³¢åŠ¨ã€‚è€Œæ ‡ç­¾å‡†ç¡®ç‡è¶Šé«˜ï¼Œæˆ‘ä»¬å¯¹äº‘è®¡ç®—æˆæœ¬çš„ç®¡æ§èƒ½åŠ›å°±è¶Šå¼ºã€‚ è¿™æ ·å°±å¯ä»¥æŠŠä¸åŒäº‘æœåŠ¡å•†çš„æ•°æ®è½¬æ¢æˆç»Ÿä¸€çš„æ ¼å¼ï¼Œç„¶ååœ¨è‡ªæœ‰çš„æˆæœ¬å¹³å°ä¸Šè¿›è¡Œç»Ÿä¸€çš„åˆ†æäº†ã€‚ æ­å»ºä¸€ä¸ªè¿™æ ·çš„æˆæœ¬åˆ†æå¹³å°å…¶å®å¹¶ä¸éš¾ï¼Œè®¸å¤šå¤§å…¬å¸éƒ½æ˜¯è¿™ä¹ˆå¹²çš„ï¼Œå°å…¬å¸ä¹Ÿå¯ä»¥ä»ä¸€ä¸ªæœ€å°çš„å¹³å°å¼€å§‹åšèµ·ï¼Œå†æ…¢æ…¢å®Œå–„åŠŸèƒ½ã€‚ ä»¥æˆ‘ç°æœ‰çš„ç»éªŒçœ‹ï¼Œå…¶å®ä¸»è¦å°±åŒ…å«è¿™ä¹ˆå‡ ä¸ªéƒ¨åˆ†ï¼š æˆæœ¬æ•°æ®è½¬æ¢æ¨¡å—ï¼šå°†æ¥è‡ªä¸åŒäº‘çš„æˆæœ¬æ•°æ®ï¼Œè½¬æ¢æˆä¸äº‘æœåŠ¡æ— å…³çš„æ ¼å¼ï¼Œæ–¹ä¾¿ç»Ÿä¸€å¤„ç† æŠ˜æ‰£æ¨¡å—ï¼šå¤„ç†ä¸åŒèµ„æºçš„æŠ˜æ‰£ æ¯”å¦‚ CDN åœ¨ç”¨é‡é«˜çš„æ—¶å€™é€šå¸¸ä¼šæœ‰å¾ˆé«˜çš„æŠ˜æ‰£æ¯”ä¾‹ è¿˜æœ‰ SavingPlans/CommitmentDiscounts ä¹Ÿéœ€è¦ç‰¹æ®Šçš„å¤„ç† æ ‡ç­¾ä¿®æ•´æ¨¡å— éšç€æ ‡ç­¾ä½“ç³»çš„å‘å±•ï¼Œæ€»ä¼šæœ‰äº›æ ‡ç­¾çš„å˜æ›´ï¼Œä¸æ–¹ä¾¿ç›´æ¥åœ¨èµ„æºä¸Šæ‰§è¡Œï¼Œå°±éœ€è¦åœ¨æˆæœ¬è®¡ç®—è¿™é‡Œè¿›è¡Œä¿®æ­£ã€å¢è¡¥æˆ–è€…åˆ é™¤ æˆæœ¬æ‹†åˆ†æ¨¡å— æœ‰äº›èµ„æºçš„æˆæœ¬æ˜¯å…±ç”¨çš„ï¼Œå°±éœ€è¦ç»“åˆå…¶ä»–æ¥æºçš„æ•°æ®è¿›è¡Œæˆæœ¬æ‹†åˆ†ï¼Œæ¯”å¦‚ Kubernetes é›†ç¾¤çš„æˆæœ¬ æˆæœ¬æŠ¥è¡¨ï¼šå°†æœ€ç»ˆçš„æ•°æ®åˆ¶ä½œæˆç¬¦åˆå„ç±»äººå‘˜éœ€æ±‚çš„å¯è§†åŒ–å›¾è¡¨ï¼ŒæŒ‰éœ€æ±‚è¿˜å¯ä»¥è€ƒè™‘æ·»åŠ äº¤äº’å¼ç‰¹å¾ å¯ä½¿ç”¨ Grafana/Google DataStudio ç­‰æŠ¥è¡¨å·¥å…· æ­¤å¤–è¿™æ ·ä¸€ä¸ªè·¨äº‘çš„æˆæœ¬ç®¡æ§å¹³å°ä¹Ÿä¸ä¸€å®šéœ€è¦å®Œå…¨è‡ªå·±æ¥åšï¼Œå·²ç»æœ‰å¾ˆå¤šå…¬å¸çœ‹åˆ°äº†è¿™å—çš„å‰æ™¯ï¼Œåšå‡ºäº†ç°æˆçš„æ–¹æ¡ˆï¼Œå¯ä»¥çœ‹çœ‹ Gartner çš„å¦‚ä¸‹æŠ¥å‘Šï¼š Cloud Management Tooling Reviews and Ratings - Gartner å¤šäº‘åœºæ™¯ä¸‹å…¶å®è¦è€ƒè™‘çš„è¿˜æœ‰å¾ˆå¤šï¼Œç›®å‰å¤šäº‘ç½‘ç»œï¼ˆmulticloud networkingï¼‰ã€å¤šäº‘è´¢åŠ¡ ï¼ˆmulticloud finopsï¼‰ã€å¤šäº‘åº”ç”¨ç®¡ç†ï¼ˆmulticloud application managementï¼‰é¢†åŸŸçš„éœ€æ±‚è¶Šæ¥è¶Šå¼ºåŠ²ï¼Œç›¸å…³äº§å“ä¹Ÿè¶Šæ¥è¶Šå¤šï¼Œæœ‰éœ€è¦å¯ä»¥è‡ªè¡Œç ”ç©¶ã€‚ ","date":"2022-05-04","objectID":"/posts/finops-for-kubernetes/:6:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Kubernetes","FinOps","æˆæœ¬åˆ†æ","Kubecost","MultiCloud","å¤šäº‘","å¤šäº‘è´¢åŠ¡ç®¡æ§"],"title":"FinOps for Kubernetes - å¦‚ä½•æ‹†åˆ† Kubernetes æˆæœ¬","uri":"/posts/finops-for-kubernetes/#å¤šäº‘ç¯å¢ƒ"},{"categories":["tech"],"content":" Kubernetes æˆæœ¬åˆ†æå‰é¢è®¨è®ºçš„å†…å®¹éƒ½å¾ˆã€Œè™šã€ï¼Œä¸‹é¢æ¥ç‚¹æ›´ã€ŒåŠ¡å®ã€çš„ï¼šKubernetes æˆæœ¬åˆ†æå®æˆ˜ã€‚ ç›®å‰æ®æˆ‘æ‰€çŸ¥ï¼Œä¸»è¦æœ‰å¦‚ä¸‹ä¸¤ä¸ªç›¸å…³çš„å¼€æºå·¥å…·ï¼š Kubecost/Opencost: kubecost åº”è¯¥æ˜¯ç›®å‰æœ€ä¼˜ç§€çš„å¼€æºæˆæœ¬åˆ†æå·¥å…·äº†ï¼Œself-hosted æ˜¯å…è´¹çš„ï¼Œæ”¯æŒæŒ‰ deployment/service/label ç­‰å¤šä¸ªç»´åº¦è¿›è¡Œæˆæœ¬æ‹†åˆ†ï¼Œè€Œä¸”æ”¯æŒæ‹†åˆ†ç½‘ç»œæˆæœ¬ã€‚æ”¶è´¹ç‰ˆæä¾›æ›´ä¸°å¯Œçš„åŠŸèƒ½ä»¥åŠæ›´é•¿çš„æ•°æ®å­˜å‚¨æ—¶é—´ã€‚ kubecost çš„æ ¸å¿ƒéƒ¨åˆ†å·²æçŒ®ç»™ CNCFï¼Œå¹¶æ”¹åä¸º opencost. crane: è…¾è®¯å¼€æºçš„ä¸€æ¬¾ Kubernetes æˆæœ¬ä¼˜åŒ–å·¥å…·ï¼Œæ”¯æŒæˆæœ¬æŠ¥è¡¨ä»¥åŠ EHPA ä¸¤ä¸ªåŠŸèƒ½ï¼Œï¼ˆæˆªæ­¢ 2022-05-04ï¼‰æ‰åˆšå¼€æºå‡ ä¸ªæœˆï¼Œç›®å‰è¿˜æ¯”è¾ƒç®€é™‹ã€‚ è…¾è®¯æ¨å‡ºå›½å†…é¦–ä¸ªäº‘åŸç”Ÿæˆæœ¬ä¼˜åŒ–å¼€æºé¡¹ç›® Crane è…¾è®¯äº‘åœ¨å›½å†…ä¸Šçº¿äº† crane çš„é—­æºç‰ˆæœ¬ã€Œå®¹å™¨æœåŠ¡æˆæœ¬å¤§å¸ˆã€ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯è…¾è®¯äº‘ï¼Œå¯ä»¥ä½“éªŒçœ‹çœ‹ï¼ˆæ„Ÿè§‰è·Ÿ kubecost å¾ˆåƒï¼‰ å…¶ä¸­ kubecost æ˜¯æœ€æˆç†Ÿçš„ä¸€ä¸ªï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥ä»¥ kubecost ä¸ºä¾‹ä»‹ç»ä¸‹å¦‚ä½•åˆ†æ Kubernetes æˆæœ¬ã€‚ ","date":"2022-05-04","objectID":"/posts/finops-for-kubernetes/:7:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Kubernetes","FinOps","æˆæœ¬åˆ†æ","Kubecost","MultiCloud","å¤šäº‘","å¤šäº‘è´¢åŠ¡ç®¡æ§"],"title":"FinOps for Kubernetes - å¦‚ä½•æ‹†åˆ† Kubernetes æˆæœ¬","uri":"/posts/finops-for-kubernetes/#kubernetes-æˆæœ¬åˆ†æ"},{"categories":["tech"],"content":" å®‰è£… kubecostkubecost æœ‰ä¸¤ç§æ¨èçš„å®‰è£…æ–¹æ³•ï¼š ä½¿ç”¨ helm å®‰è£…å…è´¹ç‰ˆ åŒ…å«å¦‚ä¸‹ç»„ä»¶ï¼š frontend å‰ç«¯ UI é¢æ¿ cost-model æ ¸å¿ƒç»„ä»¶ï¼Œæä¾›åŸºç¡€çš„æˆæœ¬æ‹†åˆ†èƒ½åŠ› postgres é•¿æœŸå­˜å‚¨ï¼Œä»…ä¼ä¸šç‰ˆæ”¯æŒ kubecost-network-costs ä¸€ä¸ª daemonsetï¼Œæä¾›ç½‘ç»œæŒ‡æ ‡ç”¨äºè®¡ç®—ç½‘ç»œæˆæœ¬ï¼ˆè²Œä¼¼æœªå¼€æºï¼‰ cluster-controller æä¾›é›†ç¾¤ã€Œå¤§å°è°ƒæ•´ï¼ˆRightSizingï¼‰ã€ä»¥åŠã€Œå®šæ—¶å…³é—­é›†ç¾¤ã€çš„èƒ½åŠ› åªä¿ç•™ 15 å¤©çš„æŒ‡æ ‡ï¼Œæ—  SSO/SAML ç™»å½•æ”¯æŒï¼Œæ—  alerts/notification, ä¸å¯ä¿å­˜ reporters æŠ¥è¡¨ æ¯ä¸ª kubecost åªå¯ç®¡ç†ä¸€ä¸ªé›†ç¾¤ åªå®‰è£… Apache License å¼€æºçš„ cost-modelï¼Œå®ƒä»…æä¾›åŸºç¡€çš„æˆæœ¬æ‹†åˆ†åŠŸèƒ½ä»¥åŠ APIï¼Œæ—  UI é¢æ¿ã€é•¿æœŸå­˜å‚¨ã€ç½‘ç»œæˆæœ¬æ‹†åˆ†ã€SAML æ¥å…¥åŠå…¶ä»–å•†ä¸šåŠŸèƒ½ã€‚ å¼€æºçš„ cost-model ç›´æ¥ä½¿ç”¨æ­¤é…ç½®æ–‡ä»¶å³å¯éƒ¨ç½²ï¼šhttps://github.com/kubecost/cost-model/blob/master/kubernetes/exporter/exporter.yaml è€Œå¦‚æœè¦éƒ¨ç½²å¸¦ UI çš„å•†ä¸šç‰ˆï¼Œéœ€è¦é¦–å…ˆè®¿é—®https://www.kubecost.com/install#show-instructions è·å–åˆ° kubecostTokenï¼Œç„¶åä½¿ç”¨ helm è¿›è¡Œéƒ¨ç½²ã€‚ é¦–å…ˆä¸‹è½½å¹¶ç¼–è¾‘ values.yaml é…ç½®æ–‡ä»¶ï¼šhttps://github.com/kubecost/cost-analyzer-helm-chart/blob/develop/cost-analyzer/values.yamlï¼Œ ç¤ºä¾‹å¦‚ä¸‹ï¼š yaml # kubecost-values.yaml # é€šè¿‡ http://kubecost.com/install è·å– tokenï¼Œç”¨äºè·Ÿè¸ªå•†ä¸šæˆæƒçŠ¶æ€ kubecostToken: \"xxx\" global: # è‡ªåŠ¨éƒ¨ç½² prometheus + nodeExporterï¼Œä¹Ÿå¯ä»¥ç›´æ¥å¯¹æ¥å¤–éƒ¨ prometheus prometheus: enabled: true # å¦‚æœ enable=falseï¼Œåˆ™ä½¿ç”¨å¦‚ä¸‹åœ°å€è¿æ¥å¤–éƒ¨ prometheus fqdn: http://cost-analyzer-prometheus-server.default.svc # è‡ªåŠ¨éƒ¨ç½² grafanaï¼Œä¹Ÿå¯å¯¹æ¥å¤–éƒ¨ grafana é¢æ¿ grafana: enabled: true # å¦‚æœ enable=falseï¼Œåˆ™ä½¿ç”¨å¦‚ä¸‹åœ°å€è¿æ¥å¤–éƒ¨ grafana domainName: cost-analyzer-grafana.default.svc scheme: \"http\" # http or https, for the domain name above. proxy: true # If true, the kubecost frontend will route to your grafana through its service endpoint # grafana å­ chart çš„é…ç½® ## æ›´å¥½çš„é€‰æ‹©æ˜¯å•ç‹¬éƒ¨ç½² grafanaï¼Œä¸ä½¿ç”¨ kubecost çš„ subchart grafana: image: repository: grafana/grafana # å»ºè®®æ›¿æ¢æˆç§æœ‰é•œåƒä»“åº“åœ°å€ tag: 8.3.2 # prometheus å­ chart çš„é…ç½® ## æ›´å¥½çš„é€‰æ‹©æ˜¯å•ç‹¬éƒ¨ç½² prometheusï¼Œä¸ä½¿ç”¨ kubecost çš„ subchart prometheus: server: persistentVolume: enabled: true size: 32Gi # è¿™ä¸ªå¤§å°å¾—è§†æƒ…å†µè°ƒæ•´ï¼Œé›†ç¾¤è¾ƒå¤§çš„è¯ 32Gi è‚¯å®šä¸å¤Ÿ retention: 15d # p8s æŒ‡æ ‡ä¿ç•™æ—¶é•¿ nodeExporter: enabled: true ## If true, node-exporter pods share the host network namespace hostNetwork: true ## If true, node-exporter pods share the host PID namespace hostPID: true ## node-exporter container name name: node-exporter ## node-exporter container image image: repository: quay.io/prometheus/node-exporter # æ›¿æ¢æˆ quay ä»“åº“é¿å… docker ä»“åº“æ‹‰å–é™åˆ¶ tag: v0.18.1 pullPolicy: IfNotPresent ## Monitors ConfigMap changes and POSTs to a URL ## Ref: https://github.com/jimmidyson/configmap-reload ## configmapReload: prometheus: ## If false, the configmap-reload container will not be deployed enabled: true ## configmap-reload container name name: configmap-reload ## configmap-reload container image image: repository: jimmidyson/configmap-reload # å»ºè®®æ›¿æ¢æˆç§æœ‰ä»“åº“é¿å… docker ä»“åº“æ‹‰å–é™åˆ¶ tag: v0.7.1 persistentVolume: enabled: true size: 32Gi # åŒå‰æ‰€è¿° # storageClass: \"-\" # # é…ç½® ingress å…¥å£ï¼Œä¾›å¤–éƒ¨è®¿é—® ingress: enabled: false # className: nginx annotations: # kubernetes.io/ingress.class: nginx # kubernetes.io/tls-acme: \"true\" paths: [\"/\"] # There's no need to route specifically to the pods-- we have an nginx deployed that handles routing pathType: ImplementationSpecific hosts: - cost-analyzer.local nodeSelector: {} # æå‡ç½‘ç»œå®‰å…¨æ€§çš„é…ç½® networkPolicy: enabled: false denyEgress: true # create a network policy that denies egress from kubecost sameNamespace: true # Set to true if cost analyser and prometheus are on the same namespace # namespace: kubecost # Namespace where prometheus is installed # åˆ†æç½‘ç»œæˆæœ¬ï¼Œéœ€è¦é¢å¤–éƒ¨ç½²ä¸€ä¸ª daemonset networkCosts: enabled: false config: {} # è¯¦è§ values.yaml å†…å®¹ serviceAccount: create: true annotations: # å¦‚æœæ˜¯ aws ä¸Šçš„é›†ç¾¤ï¼Œå¯ä»¥é€šè¿‡ serviceAccount æˆæƒè®¿é—® ec2 pricing API åŠ cur æ•°æ® # ä¹Ÿå¯ä»¥ç›´æ¥ä¸ºæœåŠ¡æä¾› AccessKeyID/Secret è¿›è¡Œæˆæƒ # ä¸ AWS çš„é›†æˆä¼šåœ¨åé¢è¯¦ç»†ä»‹ç» eks.amazonaws.com/role-arn: arn:aws:iam:112233445566:role/KubecostRole # æ³¨æ„æ›¿æ¢è¿™ä¸ª role-arn # å¦‚ä¸‹é…ç½®ä¹Ÿå¯é€šè¿‡ Kubecost product UI è°ƒæ•´ # ä½†æ˜¯æ­¤å¤„çš„é…ç½®ä¼˜å…ˆçº§æ›´é«˜ï¼Œå¦‚æœåœ¨è¿™é‡Œé…ç½®äº†é»˜è®¤å€¼ï¼Œå®¹å™¨é‡å¯åå°±ä¼šä½¿ç”¨æ­¤é»˜è®¤å€¼ï¼ŒUI ä¸Šçš„ä¿®æ”¹å°†å¤±æ•ˆ kubecostProductConfigs: {} ç„¶åéƒ¨ç½²ï¼š shell # æ·»åŠ  repo helm repo add kubecost https://kubecost.github.io/cost-analyzer/ # æŸ¥çœ‹ç‰ˆæœ¬å· helm search repo kubecost/cost-analyzer -l | head # ä¸‹è½½å¹¶è§£å‹æŸä¸ª chart helm pull kubecost/cost-analyzer --untar --version 1.92.0 # ä½¿ç”¨è‡ªå®šä¹‰ values é…ç½®å®‰è£…æˆ–æ›´æ–°æœ¬åœ°çš„ chart helm upgrade --create-namespace --install kubecost ./cost-analyzer -n kubecost -f kubecost-values.yaml é€šè¿‡ port-forward è®¿é—®ï¼š shell kubectl po","date":"2022-05-04","objectID":"/posts/finops-for-kubernetes/:7:1","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Kubernetes","FinOps","æˆæœ¬åˆ†æ","Kubecost","MultiCloud","å¤šäº‘","å¤šäº‘è´¢åŠ¡ç®¡æ§"],"title":"FinOps for Kubernetes - å¦‚ä½•æ‹†åˆ† Kubernetes æˆæœ¬","uri":"/posts/finops-for-kubernetes/#å®‰è£…-kubecost"},{"categories":["tech"],"content":" kubecost çš„æˆæœ¬ç»Ÿè®¡åŸç† 1. CPU/RAM/GPU/Storage æˆæœ¬åˆ†æKubecost é€šè¿‡ AWS/GCP ç­‰äº‘æœåŠ¡å•† API åŠ¨æ€è·å–å„ region/zone çš„ä¸Šè¿°å››é¡¹èµ„æºçš„æ¯å°æ—¶æˆæœ¬ï¼šCPU-hour, GPU-hour, Storage Gb-hour ä¸ RAM Gb-hourï¼Œæˆ–è€…é€šè¿‡ json æ–‡ä»¶é™æ€é…ç½®è¿™å‡ é¡¹èµ„æºçš„æˆæœ¬ã€‚OD æŒ‰éœ€å®ä¾‹çš„èµ„æºä»·æ ¼é€šå¸¸æ¯”è¾ƒå›ºå®šï¼Œè€Œ AWS Spot å®ä¾‹çš„æˆæœ¬æ³¢åŠ¨ä¼šæ¯”è¾ƒå¤§ï¼Œå¯ä»¥é€šè¿‡ SpotCPU/SpotRAM è¿™ä¸¤ä¸ªå‚æ•°æ¥è®¾ç½® spot çš„é»˜è®¤ä»·æ ¼ï¼Œä¹Ÿå¯ä»¥ä¸º kubecost æä¾›æƒé™ä½¿å®ƒåŠ¨æ€è·å–è¿™ä¸¤é¡¹èµ„æºçš„ä»·æ ¼ã€‚ kubecost æ ¹æ®æ¯ä¸ªå®¹å™¨çš„èµ„æºè¯·æ±‚ requests ä»¥åŠèµ„æºç”¨é‡ç›‘æ§è¿›è¡Œæˆæœ¬åˆ†é…ï¼Œå¯¹äºæœªé…ç½® requests çš„èµ„æºå°†ä»…æŒ‰å®é™…ç”¨é‡ç›‘æ§è¿›è¡Œæˆæœ¬åˆ†é…ã€‚ kubecost çš„æˆæœ¬ç»Ÿè®¡ç²’åº¦ä¸º containerï¼Œè€Œ deployment/service/namespace/label åªæ˜¯æŒ‰ä¸åŒçš„ç»´åº¦è¿›è¡Œæˆæœ¬èšåˆè€Œå·²ã€‚ 2. ç½‘ç»œæˆæœ¬çš„åˆ†æ https://github.com/kubecost/docs/blob/b7e9d25994ce3df6b3936a06023588f2249554e5/network-allocation.md å¯¹æä¾›çº¿ä¸ŠæœåŠ¡çš„äº‘ä¸Š Kubernetes é›†ç¾¤è€Œè¨€ï¼Œç½‘ç»œæˆæœ¬å¾ˆå¯èƒ½ç­‰äºç”šè‡³è¶…è¿‡è®¡ç®—æˆæœ¬ã€‚è¿™é‡Œé¢æœ€è´µçš„ï¼Œæ˜¯è·¨åŒº/è·¨åŸŸä¼ è¾“çš„æµé‡æˆæœ¬ï¼Œä»¥åŠ NAT ç½‘å…³æˆæœ¬ã€‚NAT ç½‘å…³æˆæœ¬å¯ä»¥é€šè¿‡è‡ªå»º NAT å®ä¾‹æ¥éƒ¨åˆ†ç¼©å‡ï¼ˆè¿™é‡Œä»…è€ƒå¯Ÿäº† AWS äº‘æœåŠ¡ï¼Œå…¶ä»–äº‘æœåŠ¡å•†çš„æ”¶è´¹æ¨¡å¼å¯èƒ½å­˜åœ¨åŒºåˆ«ï¼‰ã€‚ä½¿ç”¨å•ä¸ªå¯ç”¨åŒºé£é™©æ¯”è¾ƒé«˜ï¼Œèµ„æºæ± ä¹Ÿå¯èƒ½ä¸å¤Ÿç”¨ï¼Œå› æ­¤æˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨å¤šä¸ªå¯ç”¨åŒºï¼Œè¿™å°±å¯¼è‡´è·¨åŒºæµé‡æˆæœ¬æ¿€å¢ã€‚ kubecost ä¹Ÿæ”¯æŒä½¿ç”¨ Pod network ç›‘æ§æŒ‡æ ‡å¯¹æ•´ä¸ªé›†ç¾¤çš„æµé‡æˆæœ¬è¿›è¡Œæ‹†åˆ†ï¼Œkubecost ä¼šéƒ¨ç½²ä¸€ä¸ªç»‘å®š hostNetwork çš„ daemonset æ¥é‡‡é›†éœ€è¦çš„ç½‘ç»œæŒ‡æ ‡ï¼Œæä¾›ç»™ prometheus æ‹‰å–ï¼Œå†è¿›è¡Œè¿›ä¸€æ­¥çš„åˆ†æã€‚ kubecost å°†ç½‘ç»œæµé‡åˆ†æˆå¦‚ä¸‹å‡ ç±»ï¼š in-zone: å…è´¹æµé‡ in-region: è·¨åŒºæµé‡ï¼Œå›½å¤–çš„äº‘æœåŠ¡å•†åŸºæœ¬éƒ½ä¼šå¯¹è·¨åŒºæµé‡æ”¶è´¹ cross-region: è·¨åŸŸæµé‡ æ›´å¤šçš„å¾…ç ”ç©¶ï¼Œçœ‹ kubecost å®˜æ–¹æ–‡æ¡£å§ã€‚ å¦å¤–è¿˜çœ‹åˆ° kubecost æœ‰å¿½ç•¥ s3 æµé‡ï¼ˆå› ä¸ºä¸æ”¶è´¹ï¼‰çš„ issue:https://github.com/kubecost/cost-model/issues/517 ","date":"2022-05-04","objectID":"/posts/finops-for-kubernetes/:7:2","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Kubernetes","FinOps","æˆæœ¬åˆ†æ","Kubecost","MultiCloud","å¤šäº‘","å¤šäº‘è´¢åŠ¡ç®¡æ§"],"title":"FinOps for Kubernetes - å¦‚ä½•æ‹†åˆ† Kubernetes æˆæœ¬","uri":"/posts/finops-for-kubernetes/#kubecost-çš„æˆæœ¬ç»Ÿè®¡åŸç†"},{"categories":["tech"],"content":" kubecost çš„æˆæœ¬ç»Ÿè®¡åŸç† 1. CPU/RAM/GPU/Storage æˆæœ¬åˆ†æKubecost é€šè¿‡ AWS/GCP ç­‰äº‘æœåŠ¡å•† API åŠ¨æ€è·å–å„ region/zone çš„ä¸Šè¿°å››é¡¹èµ„æºçš„æ¯å°æ—¶æˆæœ¬ï¼šCPU-hour, GPU-hour, Storage Gb-hour ä¸ RAM Gb-hourï¼Œæˆ–è€…é€šè¿‡ json æ–‡ä»¶é™æ€é…ç½®è¿™å‡ é¡¹èµ„æºçš„æˆæœ¬ã€‚OD æŒ‰éœ€å®ä¾‹çš„èµ„æºä»·æ ¼é€šå¸¸æ¯”è¾ƒå›ºå®šï¼Œè€Œ AWS Spot å®ä¾‹çš„æˆæœ¬æ³¢åŠ¨ä¼šæ¯”è¾ƒå¤§ï¼Œå¯ä»¥é€šè¿‡ SpotCPU/SpotRAM è¿™ä¸¤ä¸ªå‚æ•°æ¥è®¾ç½® spot çš„é»˜è®¤ä»·æ ¼ï¼Œä¹Ÿå¯ä»¥ä¸º kubecost æä¾›æƒé™ä½¿å®ƒåŠ¨æ€è·å–è¿™ä¸¤é¡¹èµ„æºçš„ä»·æ ¼ã€‚ kubecost æ ¹æ®æ¯ä¸ªå®¹å™¨çš„èµ„æºè¯·æ±‚ requests ä»¥åŠèµ„æºç”¨é‡ç›‘æ§è¿›è¡Œæˆæœ¬åˆ†é…ï¼Œå¯¹äºæœªé…ç½® requests çš„èµ„æºå°†ä»…æŒ‰å®é™…ç”¨é‡ç›‘æ§è¿›è¡Œæˆæœ¬åˆ†é…ã€‚ kubecost çš„æˆæœ¬ç»Ÿè®¡ç²’åº¦ä¸º containerï¼Œè€Œ deployment/service/namespace/label åªæ˜¯æŒ‰ä¸åŒçš„ç»´åº¦è¿›è¡Œæˆæœ¬èšåˆè€Œå·²ã€‚ 2. ç½‘ç»œæˆæœ¬çš„åˆ†æ https://github.com/kubecost/docs/blob/b7e9d25994ce3df6b3936a06023588f2249554e5/network-allocation.md å¯¹æä¾›çº¿ä¸ŠæœåŠ¡çš„äº‘ä¸Š Kubernetes é›†ç¾¤è€Œè¨€ï¼Œç½‘ç»œæˆæœ¬å¾ˆå¯èƒ½ç­‰äºç”šè‡³è¶…è¿‡è®¡ç®—æˆæœ¬ã€‚è¿™é‡Œé¢æœ€è´µçš„ï¼Œæ˜¯è·¨åŒº/è·¨åŸŸä¼ è¾“çš„æµé‡æˆæœ¬ï¼Œä»¥åŠ NAT ç½‘å…³æˆæœ¬ã€‚NAT ç½‘å…³æˆæœ¬å¯ä»¥é€šè¿‡è‡ªå»º NAT å®ä¾‹æ¥éƒ¨åˆ†ç¼©å‡ï¼ˆè¿™é‡Œä»…è€ƒå¯Ÿäº† AWS äº‘æœåŠ¡ï¼Œå…¶ä»–äº‘æœåŠ¡å•†çš„æ”¶è´¹æ¨¡å¼å¯èƒ½å­˜åœ¨åŒºåˆ«ï¼‰ã€‚ä½¿ç”¨å•ä¸ªå¯ç”¨åŒºé£é™©æ¯”è¾ƒé«˜ï¼Œèµ„æºæ± ä¹Ÿå¯èƒ½ä¸å¤Ÿç”¨ï¼Œå› æ­¤æˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨å¤šä¸ªå¯ç”¨åŒºï¼Œè¿™å°±å¯¼è‡´è·¨åŒºæµé‡æˆæœ¬æ¿€å¢ã€‚ kubecost ä¹Ÿæ”¯æŒä½¿ç”¨ Pod network ç›‘æ§æŒ‡æ ‡å¯¹æ•´ä¸ªé›†ç¾¤çš„æµé‡æˆæœ¬è¿›è¡Œæ‹†åˆ†ï¼Œkubecost ä¼šéƒ¨ç½²ä¸€ä¸ªç»‘å®š hostNetwork çš„ daemonset æ¥é‡‡é›†éœ€è¦çš„ç½‘ç»œæŒ‡æ ‡ï¼Œæä¾›ç»™ prometheus æ‹‰å–ï¼Œå†è¿›è¡Œè¿›ä¸€æ­¥çš„åˆ†æã€‚ kubecost å°†ç½‘ç»œæµé‡åˆ†æˆå¦‚ä¸‹å‡ ç±»ï¼š in-zone: å…è´¹æµé‡ in-region: è·¨åŒºæµé‡ï¼Œå›½å¤–çš„äº‘æœåŠ¡å•†åŸºæœ¬éƒ½ä¼šå¯¹è·¨åŒºæµé‡æ”¶è´¹ cross-region: è·¨åŸŸæµé‡ æ›´å¤šçš„å¾…ç ”ç©¶ï¼Œçœ‹ kubecost å®˜æ–¹æ–‡æ¡£å§ã€‚ å¦å¤–è¿˜çœ‹åˆ° kubecost æœ‰å¿½ç•¥ s3 æµé‡ï¼ˆå› ä¸ºä¸æ”¶è´¹ï¼‰çš„ issue:https://github.com/kubecost/cost-model/issues/517 ","date":"2022-05-04","objectID":"/posts/finops-for-kubernetes/:7:2","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Kubernetes","FinOps","æˆæœ¬åˆ†æ","Kubecost","MultiCloud","å¤šäº‘","å¤šäº‘è´¢åŠ¡ç®¡æ§"],"title":"FinOps for Kubernetes - å¦‚ä½•æ‹†åˆ† Kubernetes æˆæœ¬","uri":"/posts/finops-for-kubernetes/#1-cpuramgpustorage-æˆæœ¬åˆ†æ"},{"categories":["tech"],"content":" kubecost çš„æˆæœ¬ç»Ÿè®¡åŸç† 1. CPU/RAM/GPU/Storage æˆæœ¬åˆ†æKubecost é€šè¿‡ AWS/GCP ç­‰äº‘æœåŠ¡å•† API åŠ¨æ€è·å–å„ region/zone çš„ä¸Šè¿°å››é¡¹èµ„æºçš„æ¯å°æ—¶æˆæœ¬ï¼šCPU-hour, GPU-hour, Storage Gb-hour ä¸ RAM Gb-hourï¼Œæˆ–è€…é€šè¿‡ json æ–‡ä»¶é™æ€é…ç½®è¿™å‡ é¡¹èµ„æºçš„æˆæœ¬ã€‚OD æŒ‰éœ€å®ä¾‹çš„èµ„æºä»·æ ¼é€šå¸¸æ¯”è¾ƒå›ºå®šï¼Œè€Œ AWS Spot å®ä¾‹çš„æˆæœ¬æ³¢åŠ¨ä¼šæ¯”è¾ƒå¤§ï¼Œå¯ä»¥é€šè¿‡ SpotCPU/SpotRAM è¿™ä¸¤ä¸ªå‚æ•°æ¥è®¾ç½® spot çš„é»˜è®¤ä»·æ ¼ï¼Œä¹Ÿå¯ä»¥ä¸º kubecost æä¾›æƒé™ä½¿å®ƒåŠ¨æ€è·å–è¿™ä¸¤é¡¹èµ„æºçš„ä»·æ ¼ã€‚ kubecost æ ¹æ®æ¯ä¸ªå®¹å™¨çš„èµ„æºè¯·æ±‚ requests ä»¥åŠèµ„æºç”¨é‡ç›‘æ§è¿›è¡Œæˆæœ¬åˆ†é…ï¼Œå¯¹äºæœªé…ç½® requests çš„èµ„æºå°†ä»…æŒ‰å®é™…ç”¨é‡ç›‘æ§è¿›è¡Œæˆæœ¬åˆ†é…ã€‚ kubecost çš„æˆæœ¬ç»Ÿè®¡ç²’åº¦ä¸º containerï¼Œè€Œ deployment/service/namespace/label åªæ˜¯æŒ‰ä¸åŒçš„ç»´åº¦è¿›è¡Œæˆæœ¬èšåˆè€Œå·²ã€‚ 2. ç½‘ç»œæˆæœ¬çš„åˆ†æ https://github.com/kubecost/docs/blob/b7e9d25994ce3df6b3936a06023588f2249554e5/network-allocation.md å¯¹æä¾›çº¿ä¸ŠæœåŠ¡çš„äº‘ä¸Š Kubernetes é›†ç¾¤è€Œè¨€ï¼Œç½‘ç»œæˆæœ¬å¾ˆå¯èƒ½ç­‰äºç”šè‡³è¶…è¿‡è®¡ç®—æˆæœ¬ã€‚è¿™é‡Œé¢æœ€è´µçš„ï¼Œæ˜¯è·¨åŒº/è·¨åŸŸä¼ è¾“çš„æµé‡æˆæœ¬ï¼Œä»¥åŠ NAT ç½‘å…³æˆæœ¬ã€‚NAT ç½‘å…³æˆæœ¬å¯ä»¥é€šè¿‡è‡ªå»º NAT å®ä¾‹æ¥éƒ¨åˆ†ç¼©å‡ï¼ˆè¿™é‡Œä»…è€ƒå¯Ÿäº† AWS äº‘æœåŠ¡ï¼Œå…¶ä»–äº‘æœåŠ¡å•†çš„æ”¶è´¹æ¨¡å¼å¯èƒ½å­˜åœ¨åŒºåˆ«ï¼‰ã€‚ä½¿ç”¨å•ä¸ªå¯ç”¨åŒºé£é™©æ¯”è¾ƒé«˜ï¼Œèµ„æºæ± ä¹Ÿå¯èƒ½ä¸å¤Ÿç”¨ï¼Œå› æ­¤æˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨å¤šä¸ªå¯ç”¨åŒºï¼Œè¿™å°±å¯¼è‡´è·¨åŒºæµé‡æˆæœ¬æ¿€å¢ã€‚ kubecost ä¹Ÿæ”¯æŒä½¿ç”¨ Pod network ç›‘æ§æŒ‡æ ‡å¯¹æ•´ä¸ªé›†ç¾¤çš„æµé‡æˆæœ¬è¿›è¡Œæ‹†åˆ†ï¼Œkubecost ä¼šéƒ¨ç½²ä¸€ä¸ªç»‘å®š hostNetwork çš„ daemonset æ¥é‡‡é›†éœ€è¦çš„ç½‘ç»œæŒ‡æ ‡ï¼Œæä¾›ç»™ prometheus æ‹‰å–ï¼Œå†è¿›è¡Œè¿›ä¸€æ­¥çš„åˆ†æã€‚ kubecost å°†ç½‘ç»œæµé‡åˆ†æˆå¦‚ä¸‹å‡ ç±»ï¼š in-zone: å…è´¹æµé‡ in-region: è·¨åŒºæµé‡ï¼Œå›½å¤–çš„äº‘æœåŠ¡å•†åŸºæœ¬éƒ½ä¼šå¯¹è·¨åŒºæµé‡æ”¶è´¹ cross-region: è·¨åŸŸæµé‡ æ›´å¤šçš„å¾…ç ”ç©¶ï¼Œçœ‹ kubecost å®˜æ–¹æ–‡æ¡£å§ã€‚ å¦å¤–è¿˜çœ‹åˆ° kubecost æœ‰å¿½ç•¥ s3 æµé‡ï¼ˆå› ä¸ºä¸æ”¶è´¹ï¼‰çš„ issue:https://github.com/kubecost/cost-model/issues/517 ","date":"2022-05-04","objectID":"/posts/finops-for-kubernetes/:7:2","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Kubernetes","FinOps","æˆæœ¬åˆ†æ","Kubecost","MultiCloud","å¤šäº‘","å¤šäº‘è´¢åŠ¡ç®¡æ§"],"title":"FinOps for Kubernetes - å¦‚ä½•æ‹†åˆ† Kubernetes æˆæœ¬","uri":"/posts/finops-for-kubernetes/#2-ç½‘ç»œæˆæœ¬çš„åˆ†æ"},{"categories":["tech"],"content":" kubecost API https://github.com/kubecost/docs/blob/b7e9d25994ce3df6b3936a06023588f2249554e5/apis.md æˆæœ¬æ‹†åˆ†æ–‡æ¡£ï¼šhttps://github.com/kubecost/docs/blob/b7e9d25994ce3df6b3936a06023588f2249554e5/cost-allocation.md æˆæœ¬æ‹†åˆ† API æ–‡æ¡£ï¼šhttps://github.com/kubecost/docs/blob/b7e9d25994ce3df6b3936a06023588f2249554e5/allocation.md æŸ¥è¯¢æˆæœ¬æ‹†åˆ†ç»“æœçš„ API ç¤ºä¾‹ï¼š python import requests resp = requests.get(\"http://localhost:9090/model/allocation\", params={ \"window\": \"2022-05-05T00:00:00Z,2022-05-06T00:00:00Z\", \"aggregate\": \"namespace,label:app\", # ä»¥è¿™å‡ ä¸ªçº¬åº¦è¿›è¡Œæˆæœ¬èšåˆ \"external\": True, # æ‹†åˆ†é›†ç¾¤å¤–éƒ¨çš„æˆæœ¬ï¼ˆæ¯”å¦‚ s3/rds/es ç­‰ï¼‰ï¼Œéœ€è¦é€šè¿‡å…¶ä»–æ‰‹æ®µæä¾›å¤–éƒ¨èµ„æºçš„æˆæœ¬ \"accumulate\": True, # ç´¯åŠ æŒ‡å®š window çš„æ‰€æœ‰æˆæœ¬ \"shareIdle\": False, # å°†ç©ºé—²æˆæœ¬æ‹†åˆ†åˆ°æ‰€æœ‰èµ„æºä¸Š \"idleByNode\": False, # åŸºäºèŠ‚ç‚¹è¿›è¡Œç©ºé—²èµ„æºçš„ç»Ÿè®¡ \"shareTenancyCosts\": True, # åœ¨é›†ç¾¤çš„å¤šä¸ªç§Ÿæˆ·ä¹‹é—´å…±äº«é›†ç¾¤ç®¡ç†æˆæœ¬ã€èŠ‚ç‚¹æ•°æ®å·æˆæœ¬ã€‚è¿™éƒ¨åˆ†æˆæœ¬å°†è¢«æ·»åŠ åˆ° `sharedCost` å­—æ®µä¸­ \"shareNamespaces\": \"kube-system,kubecost,istio-system,monitoring\", # å°†è¿™äº›åå­—ç©ºé—´çš„æˆæœ¬è®¾ä¸ºå…±äº«æˆæœ¬ \"shareLabels\": \"\", \"shareCost\": None, \"shareSplit\": \"weighted\", # å…±äº«æˆæœ¬çš„æ‹†åˆ†æ–¹æ³•ï¼Œweight åŠ æƒæ‹†åˆ†ï¼Œeven å‡åˆ† }) resp_json = resp.json() print(resp_json['code']) result = resp_json['data'] print(result[0]) æŸ¥è¯¢ç»“æœä¸­æœ‰è¿™å‡ ç§ç‰¹æ®Šæˆæœ¬ç±»åˆ«ï¼š __idle__: æœªè¢«å ç”¨çš„ç©ºé—²èµ„æºæ¶ˆè€—çš„æˆæœ¬ __unallocated_: ä¸å«æœ‰ aggregate å¯¹åº”ç»´åº¦çš„æˆæœ¬ï¼Œæ¯”å¦‚æŒ‰ label:app è¿›è¡Œèšåˆï¼Œä¸å«æœ‰app è¿™ä¸ª label çš„ pod æˆæœ¬å°±ä¼šè¢«åˆ†ç±»åˆ°æ­¤æ ‡ç­¾ __unmounted__: æœªæŒ‚è½½ PV çš„æˆæœ¬ æ­¤å¤–å¦‚æœä½¿ç”¨ kubecost å¯è§†åŒ–é¢æ¿ï¼Œå¯èƒ½è¿˜ä¼šçœ‹åˆ°ä¸€ä¸ª other ç±»åˆ«ï¼Œè¿™æ˜¯ä¸ºäº†æ–¹ä¾¿å¯è§†åŒ–ï¼ŒæŠŠæˆæœ¬å¤ªä½çš„ä¸€äº›æŒ‡æ ‡èšåˆå±•ç¤ºäº†ã€‚ ","date":"2022-05-04","objectID":"/posts/finops-for-kubernetes/:7:3","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Kubernetes","FinOps","æˆæœ¬åˆ†æ","Kubecost","MultiCloud","å¤šäº‘","å¤šäº‘è´¢åŠ¡ç®¡æ§"],"title":"FinOps for Kubernetes - å¦‚ä½•æ‹†åˆ† Kubernetes æˆæœ¬","uri":"/posts/finops-for-kubernetes/#kubecost-api"},{"categories":["tech"],"content":" Kubecost ä¸ AWS é›†æˆ https://github.com/kubecost/docs/blob/b7e9d25994ce3df6b3936a06023588f2249554e5/aws-cloud-integrations.md https://github.com/kubecost/docs/blob/main/aws-node-price-reconcilitation-methodology.md TBD ","date":"2022-05-04","objectID":"/posts/finops-for-kubernetes/:7:4","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Kubernetes","FinOps","æˆæœ¬åˆ†æ","Kubecost","MultiCloud","å¤šäº‘","å¤šäº‘è´¢åŠ¡ç®¡æ§"],"title":"FinOps for Kubernetes - å¦‚ä½•æ‹†åˆ† Kubernetes æˆæœ¬","uri":"/posts/finops-for-kubernetes/#kubecost-ä¸-aws-é›†æˆ"},{"categories":["tech"],"content":" å‚è€ƒ kubecost: kubecost åº”è¯¥æ˜¯ç›®å‰æœ€ä¼˜ç§€çš„å¼€æºæˆæœ¬åˆ†æå·¥å…·äº†ï¼Œself-hosted æ˜¯å…è´¹çš„ï¼Œä¹Ÿæä¾›æ”¶è´¹çš„äº‘ä¸Šç‰ˆæœ¬ï¼Œå€¼å¾—ç ”ç©¶ã€‚ æ–‡æ¡£ï¼šhttps://github.com/kubecost/docs crane: è…¾è®¯å¼€æºçš„ä¸€æ¬¾ Kubernetes æˆæœ¬ä¼˜åŒ–å·¥å…·ï¼Œæ”¯æŒæˆæœ¬æŠ¥è¡¨ä»¥åŠ EHPA ä¸¤ä¸ªåŠŸèƒ½ï¼Œæ‰åˆšå¼€æºå‡ ä¸ªæœˆï¼Œç›®å‰è¿˜æ¯”è¾ƒç®€é™‹ã€‚ Calculating Container Costs - FinOps CPUåˆ©ç”¨ç‡ä»10%æå‡è‡³60%ï¼šä¸­å‹ä¼ä¸šäº‘åŸç”Ÿæˆæœ¬ä¼˜åŒ–å®æˆ˜æŒ‡å— - æ˜Ÿæ±‰æœªæ¥(Galaxy-Future) èµ„æºåˆ©ç”¨ç‡åˆ†æå’Œä¼˜åŒ–å»ºè®® - è…¾è®¯äº‘å®¹å™¨æœåŠ¡ ","date":"2022-05-04","objectID":"/posts/finops-for-kubernetes/:8:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","Kubernetes","FinOps","æˆæœ¬åˆ†æ","Kubecost","MultiCloud","å¤šäº‘","å¤šäº‘è´¢åŠ¡ç®¡æ§"],"title":"FinOps for Kubernetes - å¦‚ä½•æ‹†åˆ† Kubernetes æˆæœ¬","uri":"/posts/finops-for-kubernetes/#å‚è€ƒ"},{"categories":["life","tech"],"content":"æœ€è¿‘åœ¨å­¦åŒºå—é“¾æŠ€æœ¯ï¼Œè·Ÿç¾¤å‹è®¨è®ºæ—¶ï¼Œä¸€ä½ç¾¤å‹æŠ›å‡ºäº†ä»–çš„è§‚ç‚¹ï¼šã€Œæ‰€ä»¥æ™ºèƒ½åˆçº¦ï¼Œæœ¬è´¨ä¸Šä¾ç„¶æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„åè®®å§ï¼Œåªæ˜¯å¥—ä¸Šäº†ä¸€ä¸ªçœ‹èµ·æ¥é«˜å¤§ä¸Šçš„è¯è¯­è€Œæœ¬è´¨ä¾ç„¶å±äºä¸€ç§é€šä¿¡åè®®çš„ä¸œè¥¿ï¼Œè¿™ä¹ˆä¸€æƒ³å¦‚æœæ‹†è§£å¼€æ¥å®é™…ä¸Šä¹Ÿåº”è¯¥æ²¡ä»€ä¹ˆç‰¹åˆ«çš„ã€‚ã€ æ˜¯å•Šï¼Œè¿™æ ·è¯´çš„è¯ï¼ŒåŒºå—é“¾æŠ€æœ¯ç¡®å®æŒºç®€å•çš„ï¼Œæ²¡å•¥æ–°çš„ä¸œè¥¿ã€‚åº•å±‚å°±æ˜¯å„ç§ç°ä»£å¯†ç å­¦ç®—æ³•è·Ÿé€šè®¯åè®®è€Œå·²ï¼Œè¿™äº›éƒ½æ˜¯ç»è¿‡äº†å‡ åå¹´å‘å±•ï¼Œå·²ç»å¾ˆæˆç†Ÿçš„æŠ€æœ¯æˆ–è€…æ¦‚å¿µäº†ã€‚ä½†æ˜¯ä¸­æœ¬èªæŠŠè¿™äº›æ—§æŠ€æœ¯ç»„åˆåˆ°ä¸€èµ·ï¼Œæäº†ä¸ªæ¯”ç‰¹å¸ï¼Œæ²¡å‡ å¹´å°±å¼•å‘äº†åŠ å¯†è´§å¸ç‹‚æ½®ï¼Œå°±è¿ GPU éƒ½å› ä¸ºåŠ å¯†è´§å¸çš„å‘å±•ä»·æ ¼ä¸€è·¯ç‹‚é£™ã€‚2015 å¹´ä»¥å¤ªåŠå¾€åŒºå—é“¾ä¸ŠåŠ äº†ä¸ªåŠŸèƒ½ï¼šå¯ä»¥è¿è¡Œä»»ä½•å›¾çµå®Œå¤‡çš„è®¡ç®—æœºç¨‹åºï¼ˆåˆçº¦ï¼‰ï¼Œç¼–è¯‘æˆ EVM å­—èŠ‚ç å³å¯ä¸¢åˆ°ä»¥å¤ªåŠåŒºå—é“¾ä¸Šè¿è¡Œã€‚è¿è¡Œç¨‹åºè¿™æ ·ä¸€ä»¶äº‹æœ¬èº«æœ‰ä»€ä¹ˆç‰¹æ®Šçš„ä¹ˆï¼Ÿæ˜¯å°è®¡ç®—æœºéƒ½å¯ä»¥è·‘ç¨‹åºï¼Œä½†æ˜¯ä»¥å¤ªåŠç¬¬ä¸€ä¸ªæå‡ºåœ¨åŒºå—é“¾ä¸Šè·‘å›¾çµå®Œå¤‡çš„ç¨‹åºï¼Œè¿™å¯¼è‡´ä»¥å¤ªåŠæˆä¸ºäº†ç›®å‰ä¸–ç•Œä¸Šç¬¬äºŒå¤§åŒºå—é“¾ç³»ç»Ÿï¼Œå¹¶ä¸”å½¢æˆäº†ä¸€ä¸ªåºå¤§çš„å¼€å‘è€…ç¤¾åŒºï¼Œç›®å‰ç½‘ç»œä¸Šæœ‰å¤šä¸èƒœæ•°çš„ä»¥å¤ªåŠå¼€å‘æ•™ç¨‹åŠèµ„æ–™ã€‚ åŒºå—é“¾æŠ€æœ¯ä»…ä»…åªæ˜¯ä»¥æ–°çš„æ–¹å¼ï¼Œç»„åˆä½¿ç”¨äº†ä¸€ç³»åˆ—æˆç†Ÿçš„å·¥å…·è€Œå·²ï¼Œä½†æ˜¯å´å¼•å‘äº†ä¸–ç•Œæ€§çš„é‡‘èå˜é©ï¼Œç”šè‡³ä»¥å¤ªåŠè¿˜åœ¨è¿™ä¹‹ä¸Šç ”ç©¶å‡ºäº†æ›´å¤šçš„å¦™ç”¨ï¼Œæå‡ºäº† Web3.0 çš„æ¦‚å¿µã€‚ ç°æœ‰æŠ€æœ¯çš„æ–°ç”¨æ³•ï¼Œä¹Ÿå®Œå…¨å¯ä»¥å½¢æˆä¸€åœºé©å‘½æ€§çš„å˜é©ï¼Œç”šè‡³è¿™ä¸ªæ–°ç”¨æ³•å¯ä»¥éå¸¸ç®€å•ï¼Œå…³é”®åœ¨äºä½ èƒ½å¦å‘ç°è¿™æ ·ä¸€ç§ç”¨æ³•ï¼Œå¹¶ä¸”æ„è¯†åˆ°å®ƒå¯èƒ½å­˜åœ¨çš„ä»·å€¼ã€‚è¿™ä¸ªæ˜¯éå¸¸éå¸¸éš¾çš„ï¼Œå¾®è½¯æ›¾ç»æ²¡çœ‹æ‡‚å¼€æºè·Ÿäº‘è®¡ç®—çš„å¨åŠ›ï¼Œè¯ºåŸºäºšæ›¾ç»è§‰å¾—å®‰å“å°±æ˜¯åƒåœ¾ä¸è¶³ä¸ºæƒ§ï¼Œå¾ˆå¤šæé‡‘èçš„æ›¾ç»è§‰å¾—åŠ å¯†è´§å¸å°±æ˜¯ä¸ªç¬‘è¯ã€‚æ°å¦‚å¾ˆå¤šç°åœ¨ä¸¢äº†å·¥ä½œçš„ä¼ ç»Ÿè¿ç»´ï¼Œå¯èƒ½ä»¥å‰ä¹Ÿæ˜¯è§‰å¾—å®¹å™¨è·Ÿäº‘è®¡ç®—æ²¡å•¥ç‰¹åˆ«çš„ï¼Œå½±å“ä¸åˆ°è‡ªå·±å§ã€‚ åœ¨æ²¡è¢«æ–°æŠ€æœ¯éª‘è„¸ä¹‹å‰ï¼Œä¸€èˆ¬äººæ˜¯å¾ˆéš¾æ„ŸçŸ¥åˆ°å®ƒå¯¹è‡ªå·±çš„å½±å“çš„ã€‚ æ‰€ä»¥ä½œä¸ºä¸€åæ™®é€šçš„æŠ€æœ¯äººï¼Œæˆ‘ä»¬ä¹Ÿåªèƒ½æ—¶æ—¶å…³æ³¨è‡ªå·±æ ¸å¿ƒé¢†åŸŸå†…å„é¡¹æ–°æŠ€æœ¯çš„å‘å±•ï¼Œè¯„ä¼°å®ƒä»¬çš„æ½œåŠ›ä¸ä»·å€¼ï¼Œå°½åŠ›çœ‹æ¸…å®ƒä»¬çš„æœ¬è´¨ã€‚ç”šè‡³å¶å°”ä¹Ÿè¦æ‹“å±•è‡ªå·±çš„è§†é‡å»äº†è§£ä¸‹å…¶ä»–å…³è”é¢†åŸŸçš„å˜åŒ–ï¼Œè¿™æ ·æ‰èƒ½é™ä½è‡ªå·±è¢«æ—¶ä»£æŠ›å¼ƒçš„æ¦‚ç‡ã€‚ æ¯ä¸ªæ–°å…´é¢†åŸŸéƒ½ä¸ç¼ºä¹æ—¶ä»£çš„å¼„æ½®å„¿ï¼Œè€Œæˆ‘ä»¬æ™®é€šäººï¼Œåªèƒ½æœªé›¨ç»¸ç¼ªï¼Œå°½é‡æ‰“é€ å¥½è‡ªå·±çš„æŠ€æœ¯å°èˆ¹ï¼Œä¸è‡´è¢«æ—¶ä»£çš„å¤§æ½®å€¾ç¿»ã€‚ æœ€åå›åˆ°æ­£é¢˜ï¼Œæˆ‘è¿™ä¸ªå‘¨æœ«æ‰åˆšå­¦äº†ä¸¤å¤©åŒºå—é“¾ï¼Œè¿˜æ²¡ææ˜ç™½æ™ºèƒ½åˆçº¦æ˜¯ä¸ªå•¥ï¼Œæ›´é‘è®ºçœ‹æ¸…ã€Œæ™ºèƒ½åˆçº¦çš„æ½œåœ¨ä»·å€¼ã€äº†ï¼Œä½†æ˜¯æ—¢ç„¶åŒºå—é“¾æ˜¯ç›®å‰çš„ä¸€ä¸ªé£å£ï¼Œè¿™ä¹ˆå¤šäººé¼“å¹ï¼Œæˆ‘è§‰å¾—æ˜¯å€¼å¾—èŠ±ç‚¹æ—¶é—´ææ¸…æ¥šå®ƒå¯¼è‡´æ˜¯ä¸ªå•¥çš„ã€‚åŒºå—é“¾ã€Web3.0 DAO NFT DeFi è¿™æ ·çš„æ–°æ¦‚å¿µï¼Œå•å•ç€çœ¼äºåˆ«äººçš„é¼“å¹æˆ–è€…è´¬ä½ï¼Œåªä¼šæ˜¯é›¾é‡Œçœ‹èŠ±ä¸€çŸ¥åŠè§£ã€‚åªæœ‰è‡ªå·±ææ‡‚å®ƒï¼Œæ‰æœ‰æœºä¼šæŠŠæ¡ä½å®ƒçš„æœ¬è´¨ã€‚ è·¯é€”æ¼«æ¼«ï¼Œè¯¸å›å…±å‹‰ã€‚ ","date":"2022-03-28","objectID":"/posts/revolution-and-innovation/:0:0","series":null,"tags":["åˆ›æ–°","å˜é©"],"title":"å˜é©ä¸åˆ›æ–°","uri":"/posts/revolution-and-innovation/#"},{"categories":["tech"],"content":" æœ¬æ–‡å¤§è‡´æ˜¯ä¸€ç¯‡åŸåˆ›æ–‡ç« ï¼Œä½†æ˜¯å‚è€ƒäº†è®¸å¤šç½‘ç»œèµ„æ–™ï¼Œéƒ½åˆ—åœ¨æ–‡æœ«çš„ã€Œå‚è€ƒã€ä¸­äº†ã€‚ ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:0:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#"},{"categories":["tech"],"content":" æ›´æ–°è®°å½• 2021-01-17: å®Œæˆ TLS åè®®ç®€ä»‹ã€æ•°å­—è¯ä¹¦ä»‹ç»ã€æ•°å­—è¯ä¹¦çš„ç”³è¯·æˆ–ç”Ÿæˆæ–¹æ³•ã€mTLS ä»‹ç»ã€TLS åè®®çš„ç ´è§£æ‰‹æ®µ 2022-03-13 ~ 2022-03-14: é‡æ–°æ•´ç†è¡¥å……ï¼Œæ”¹å†™ä¸ºã€Šå†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®ã€‹ï¼Œæ•´åˆè¿›æˆ‘çš„å®ç”¨å¯†ç å­¦ç³»åˆ—æ–‡ç« ä¸­ è¡¥å…… PKI å…¬é’¥åŸºç¡€æ¶æ„åŠ X509 è¯ä¹¦æ ‡å‡†ä»‹ç» TODO: è¡¥å…… ALPN åº”ç”¨å±‚åè®®åå•†çš„ä»‹ç» è¡¥å…… TLS åè®®çš„é€†å‘æ‰‹æ®µ åŸºäºcfssl è¯¦ç»†ä»‹ç» PKI çš„å„é¡¹ç»„ä»¶ åŸºäº PKI çš„åº”ç”¨æœåŠ¡é—´èº«ä»½è¯†åˆ«æŠ€æœ¯ï¼šSPIFF ID SPIFF ID æ˜¯äº‘åŸç”Ÿé¢†åŸŸçš„æ ‡å‡†ï¼ŒæœåŠ¡ç½‘æ ¼é¡¹ç›® Istio å°±ä½¿ç”¨äº† SPIFF ID ä½œä¸ºå®‰å…¨å‘½å ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:1:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#æ›´æ–°è®°å½•"},{"categories":["tech"],"content":" é›¶ã€å‰è¨€ç°ä»£äººçš„æ—¥å¸¸ç”Ÿæ´»ä¸­ï¼ŒHTTPS åè®®å‡ ä¹æ— å¤„ä¸åœ¨ï¼Œæˆ‘ä»¬æ¯å¤©æµè§ˆç½‘é¡µæ—¶ã€ç”¨æ‰‹æœºåˆ·äº¬ä¸œæ·˜å®æ—¶ã€ç”šè‡³æ¯å¤©ç§€è‡ªå·±ç»¿è‰²çš„å¥åº·ç æ—¶ï¼Œéƒ½åœ¨ä½¿ç”¨ HTTPS åè®®ã€‚ ä½œä¸ºä¸€ä¸ªå¼€å‘äººå‘˜ï¼Œæˆ‘æƒ³ä½ åº”è¯¥å¤šå¤šå°‘å°‘æœ‰äº†è§£ä¸€ç‚¹ HTTPS åè®®ã€‚ä½ å¯èƒ½çŸ¥é“ HTTPS æ˜¯ä¸€ç§åŠ å¯†ä¼ è¾“åè®®ï¼Œèƒ½ä¿è¯æ•°æ®ä¼ è¾“çš„ä¿å¯†æ€§ã€‚å¦‚æœä½ æ‹¥æœ‰éƒ¨ç½² HTTPS æœåŠ¡çš„ç»éªŒï¼Œé‚£ä½ æˆ–è®¸è¿˜æ‡‚å¦‚ä½•ç”³è¯·æƒå¨ HTTPS è¯ä¹¦ï¼Œå¹¶é…ç½®åœ¨ Nginx ç­‰ Web ç¨‹åºä¸Šã€‚ ä½†æ˜¯ä½ æ˜¯å¦æ¸…æ¥š HTTPS æ˜¯ç”± HTTP + TLS ä¸¤ç§åè®®ç»„åˆè€Œæˆçš„å‘¢ï¼Ÿæ›´è¿›ä¸€æ­¥ä½ æ˜¯å¦æœ‰æŠ“åŒ…äº†è§£è¿‡ TLS åè®®çš„å®Œæ•´æµç¨‹ï¼Ÿæ˜¯å¦æ¸…æ¥šå®ƒåŠ è§£å¯†çš„åº•å±‚åŸç†ï¼Ÿæ˜¯å¦æ¸…æ¥š Nginx ç­‰ Web æœåŠ¡å™¨çš„ HTTPS é…ç½®ä¸­ä¸€å †å¯†ç å­¦å‚æ•°çš„çœŸæ­£å«ä¹‰ï¼Ÿæ˜¯å¦çŸ¥é“ TLS åè®®æœ‰å“ªäº›å¼±ç‚¹ã€å­˜åœ¨å“ªäº›æ”»å‡»æ‰‹æ®µã€å¦‚ä½•é˜²èŒƒï¼Ÿ æˆ‘ä»¬åœ¨ã€Šå†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ã€‹çš„å‰ä¸ƒç¯‡æ–‡ç« ä¸­å·²ç»å­¦ä¹ äº†è®¸å¤šçš„å¯†ç å­¦æ¦‚å¿µä¸ç®—æ³•ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±åˆ©ç”¨è¿™äº›çŸ¥è¯†ï¼Œæ·±åº¦å‰–æä¸‹ HTTPS åè®®ä¸­çš„æ•°å­—è¯ä¹¦ä»¥åŠ TLS åè®®ã€‚ ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:2:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#preface"},{"categories":["tech"],"content":" ä¸€ã€æ•°å­—è¯ä¹¦ä¸ PKI å…¬é’¥åŸºç¡€æ¶æ„æˆ‘ä»¬åœ¨å‰é¢å·²ç»å­¦ä¹ äº†ã€Œå¯¹ç§°å¯†ç ç®—æ³•ã€ä¸ã€Œéå¯¹ç§°å¯†ç ç®—æ³•ã€ä¸¤ä¸ªå¯†ç å­¦ä½“ç³»ï¼Œè¿™é‡Œåšä¸ªç®€å•çš„æ€»ç»“ã€‚ å¯¹ç§°å¯†ç ç®—æ³•ï¼ˆå¦‚ AES/ChaCha20ï¼‰: è®¡ç®—é€Ÿåº¦å¿«ã€å®‰å…¨å¼ºåº¦é«˜ï¼Œä½†æ˜¯ç¼ºä¹å®‰å…¨äº¤æ¢å¯†é’¥çš„æ‰‹æ®µã€å¯†é’¥çš„ä¿å­˜å’Œç®¡ç†ä¹Ÿå¾ˆå›°éš¾ã€‚ éå¯¹ç§°å¯†ç ç®—æ³•ï¼ˆå¦‚ RSA/ECCï¼‰: è®¡ç®—é€Ÿåº¦æ…¢ï¼Œä½†æ˜¯å®ƒè§£å†³äº†ä¸Šè¿°å¯¹ç§°å¯†ç ç®—æ³•æœ€å¤§çš„ä¸¤ä¸ªç¼ºé™·ï¼Œ ä¸€æ˜¯ç»™å‡ºäº†å®‰å…¨çš„å¯†é’¥äº¤æ¢ç®—æ³• DHE/ECDHEï¼ŒäºŒå‘¢å®ƒçš„å…¬é’¥æ˜¯å¯å…¬å¼€çš„ï¼Œè¿™é™ä½äº†å¯†é’¥çš„ä¿å­˜ä¸ç®¡ç†éš¾åº¦ã€‚ ä½†æ˜¯éå¯¹ç§°å¯†ç ç®—æ³•ä»ç„¶å­˜åœ¨ä¸€äº›é—®é¢˜: å…¬é’¥è¯¥å¦‚ä½•åˆ†å‘ï¼Ÿæ¯”å¦‚ Alice è·Ÿ Bob äº¤æ¢å…¬é’¥æ—¶ï¼Œå¦‚ä½•ç¡®å®šæ”¶åˆ°çš„ç¡®å®æ˜¯å¯¹æ–¹çš„å…¬é’¥ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚ä½•ç¡®è®¤å…¬é’¥çš„çœŸå®æ€§ã€å®Œæ•´æ€§ã€è®¤è¯å…¶æ¥æºèº«ä»½ï¼Ÿ å‰é¢æˆ‘ä»¬å·²ç»å­¦ä¹ è¿‡ï¼ŒDH/ECDH å¯†é’¥äº¤æ¢åè®®å¯ä»¥é˜²èŒƒå—…æ¢æ”»å‡»ï¼ˆçªƒå¬ï¼‰ï¼Œä½†æ˜¯æ— æ³•æŠµæŒ¡ä¸­é—´äººæ”»å‡»ï¼ˆä¸­ç»§ï¼‰ã€‚ å¦‚æœ Alice çš„ç§é’¥æ³„æ¼äº†ï¼Œå¥¹è¯¥å¦‚ä½•ä½œåºŸè‡ªå·±æ—§çš„å…¬é’¥ï¼Ÿ æ•°å­—è¯ä¹¦ä¸å…¬é’¥åŸºç¡€æ¶æ„å°±æ˜¯ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜è€Œè®¾è®¡çš„ã€‚ é¦–å…ˆç®€å•ä»‹ç»ä¸‹å…¬é’¥åŸºç¡€æ¶æ„ï¼ˆPublic Key Infrastructureï¼‰ï¼Œå®ƒæ˜¯ä¸€ç»„ç”±ç¡¬ä»¶ã€è½¯ä»¶ã€å‚ä¸è€…ã€ç®¡ç†æ”¿ç­–ä¸æµç¨‹ç»„æˆçš„åŸºç¡€æ¶æ„ï¼Œå…¶ç›®çš„åœ¨äºåˆ›é€ ã€ç®¡ç†ã€åˆ†é…ã€ä½¿ç”¨ã€å­˜å‚¨ä»¥åŠæ’¤é”€æ•°å­—è¯ä¹¦ã€‚PKI æ˜¯ä¸€ä¸ªæ€»ç§°ï¼Œè€Œå¹¶éæŒ‡å•ç‹¬çš„æŸä¸€ä¸ªè§„èŒƒæˆ–æ ‡å‡†ï¼Œå› æ­¤æ˜¾ç„¶æ•°å­—è¯ä¹¦çš„è§„èŒƒï¼ˆX.509ï¼‰ã€å­˜å‚¨æ ¼å¼ï¼ˆPKCS ç³»åˆ—æ ‡å‡†ã€DERã€PEMï¼‰ã€TLS åè®®ç­‰éƒ½æ˜¯ PKI çš„ä¸€éƒ¨åˆ†ã€‚ æˆ‘ä»¬ä¸‹é¢ä»å…¬é’¥è¯ä¹¦å¼€å§‹é€æ­¥ä»‹ç» PKI ä¸­çš„å„ç§æ¦‚å¿µåŠæ¶æ„ã€‚ ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:3:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#pki"},{"categories":["tech"],"content":" 1. å…¬é’¥è¯ä¹¦å‰é¢æˆ‘ä»¬ä»‹ç»äº†å…¬é’¥å¯†ç ç³»ç»Ÿå­˜åœ¨çš„ä¸€ä¸ªé—®é¢˜æ˜¯ã€Œåœ¨åˆ†å‘å…¬é’¥æ—¶ï¼Œéš¾ä»¥ç¡®è®¤å…¬é’¥çš„çœŸå®æ€§ã€å®Œæ•´æ€§åŠå…¶æ¥æºèº«ä»½ã€ã€‚PKI é€šè¿‡ã€Œæ•°å­—è¯ä¹¦ã€+ã€Œè¯ä¹¦è®¤è¯æœºæ„ã€æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸‹é¢å…ˆç®€å•ä»‹ç»ä¸‹ã€Œæ•°å­—è¯ä¹¦ã€ã€‚ æ•°å­—è¯ä¹¦æŒ‡çš„å…¶å®å°±æ˜¯å…¬é’¥è¯ä¹¦ï¼ˆä¹Ÿå¯ç›´æ¥ç®€ç§°ä¸ºè¯ä¹¦ï¼‰ã€‚åœ¨ç°ä»£ç½‘ç»œé€šè®¯ä¸­é€šè¡Œçš„å…¬é’¥è¯ä¹¦æ ‡å‡†åä¸º X.509 v3, ç”±RFC5280 å®šä¹‰ã€‚X.509 v3 æ ¼å¼è¢«å¹¿æ³›åº”ç”¨åœ¨ TLS/SSL ç­‰ä¼—å¤šåŠ å¯†é€šè®¯åè®®ä¸­ï¼Œå®ƒè§„å®šå…¬é’¥è¯ä¹¦åº”è¯¥åŒ…å«å¦‚ä¸‹å†…å®¹: è¯ä¹¦ åºåˆ—å·ï¼ˆSerial Numberï¼‰: ç”¨ä»¥è¯†åˆ«æ¯ä¸€å¼ è¯ä¹¦ï¼Œåœ¨ä½œåºŸè¯ä¹¦çš„æ—¶å€™ä¼šç”¨åˆ°å®ƒ ç‰ˆæœ¬: è¯ä¹¦çš„è§„èŒƒç‰ˆæœ¬ å…¬é’¥ï¼ˆPublic Keyï¼‰: æˆ‘ä»¬çš„æ ¸å¿ƒç›®çš„å°±æ˜¯åˆ†å‘å…¬é’¥ï¼Œå› æ­¤æ˜¾ç„¶è¦æŠŠå…¬é’¥æ”¾åœ¨è¯ä¹¦é‡Œé¢ å…¬é’¥æŒ‡çº¹: å³å…¬é’¥çš„ Hash å€¼ï¼Œå½“å‰å¤§éƒ¨åˆ†è¯ä¹¦éƒ½ä½¿ç”¨ SHA256 è®¡ç®—æ­¤æŒ‡çº¹ å…¬é’¥ç”¨é€”ï¼ˆKey Usage + Extended Key Usageï¼‰: è®°å½•äº†æ­¤è¯ä¹¦å¯ç”¨äºå“ªäº›ç”¨é€”â€”â€”æ•°å­—ç­¾åã€èº«ä»½è®¤è¯ç­‰ ä¸»ä½“ï¼ˆSubjectï¼‰: å³å§“åã€ç»„ç»‡ã€é‚®ç®±ã€åœ°å€ç­‰è¯ä¹¦æ‹¥æœ‰è€…çš„ä¸ªäººä¿¡æ¯ã€‚ æœ‰äº†è¿™ä¸ªæˆ‘ä»¬å°±èƒ½ç¡®è®¤è¯ä¹¦çš„æ‹¥æœ‰è€…äº† è¯ä¹¦æœ‰æ•ˆæœŸçš„å¼€å§‹æ—¶é—´ã€ç»“æŸæ—¶é—´ï¼ˆNot Before + Not Afterï¼‰: ä¸ºäº†ç¡®ä¿å®‰å…¨æ€§ï¼Œæ¯ä¸ªè¯ä¹¦éƒ½ä¼šè®°å½•ä¸€ä¸ªè‡ªèº«çš„æœ‰æ•ˆæœŸ è¯ä¹¦ä¸€æ—¦ç­¾å‘å¹¶å…¬å¼€ï¼Œéšç€ç§‘æŠ€çš„å‘å±•ã€æ—¶é—´çš„æ¨ç§»ï¼Œå…¶å…¬é’¥çš„å®‰å…¨æ€§ä¼šæ…¢æ…¢å‡å¼± å› æ­¤æ¯ä¸ªè¯ä¹¦éƒ½åº”è¯¥åŒ…å«ä¸€ä¸ªåˆç†çš„æœ‰æ•ˆæœŸï¼Œè¯ä¹¦çš„æ‹¥æœ‰è€…åº”è¯¥åœ¨æœ‰æ•ˆæœŸæˆªæ­¢å‰æ›´æ¢è‡ªèº«çš„è¯ä¹¦ä»¥ç¡®ä¿å®‰å…¨æ€§ ç­¾å‘è€…ï¼ˆIssuerï¼‰: ç­¾å‘æ­¤è¯ä¹¦çš„ã€Œç­¾å‘è€…ã€ä¿¡æ¯ å…¶ä»–æ‹“å±•ä¿¡æ¯ æ•°å­—ç­¾åï¼ˆSignatureï¼‰: æˆ‘ä»¬è¿˜éœ€è¦å¯¹ä¸Šé¢æ•´ä¸ªè¯ä¹¦è®¡ç®—ä¸€ä¸ªæ•°å­—ç­¾åï¼Œæ¥ç¡®ä¿è¿™äº›æ•°æ®çš„çœŸå®æ€§ã€å®Œæ•´æ€§ï¼Œç¡®ä¿è¯ä¹¦æœªè¢«æ¶æ„ç¯¡æ”¹/ä¼ªé€  æ­¤æ•°å­—ç­¾åç”±ã€Œè¯ä¹¦ç­¾å‘è€…ï¼ˆIssuerï¼‰ã€ä½¿ç”¨å…¶ç§é’¥+è¯ä¹¦å†…å®¹è®¡ç®—å¾—å‡º æ•°å­—ç­¾åç®—æ³•ï¼ˆSignature Algorithmï¼‰: è¯ä¹¦æ‰€ä½¿ç”¨çš„ç­¾åç®—æ³•ï¼Œå¸¸ç”¨çš„æœ‰ RSA-SHA-256 ä¸ECDSA-SHA-256 æ¯ä¸ªè¯ä¹¦éƒ½æœ‰å”¯ä¸€çš„ IDï¼Œè¿™æ ·åœ¨ç§é’¥æ³„æ¼çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å…¬é’¥åŸºç¡€è®¾æ–½çš„ OCSPï¼ˆOnline Certificate Status Protocolï¼‰åè®®åŠé”€æŸä¸ªè¯ä¹¦ã€‚ åŠé”€è¯ä¹¦çš„æ“ä½œè¿˜æ˜¯æ¯”è¾ƒç½•è§çš„ï¼Œæ¯•ç«Ÿç§é’¥æ³„æ¼å¹¶ä¸å®¹æ˜“é‡åˆ°ï¼Œå› æ­¤è¿™é‡Œå°±ç•¥è¿‡ä¸æäº†ï¼Œæœ‰éœ€è¦çš„å¯ä»¥è‡ªè¡Œæœç´¢ã€‚ ä½¿ç”¨ Firefox æŸ¥çœ‹ç½‘ç«™ https://www.google.com çš„è¯ä¹¦ä¿¡æ¯å¦‚ä¸‹ï¼š Google è¯ä¹¦å†…å®¹ ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:3:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#public-key-certificate"},{"categories":["tech"],"content":" 2. è¯ä¹¦ä¿¡ä»»é“¾å‰é¢ä»‹ç»è¯ä¹¦å†…å®¹æ—¶ï¼Œæåˆ°äº†æ¯ä¸ªè¯ä¹¦éƒ½åŒ…å«ã€Œç­¾å‘è€…ï¼ˆIssuerï¼‰ã€ä¿¡æ¯ï¼Œå¹¶ä¸”è¿˜åŒ…å«ã€Œç­¾å‘è€…ã€ä½¿ç”¨ã€Œè¯ä¹¦å†…å®¹ã€ä¸ã€Œç­¾å‘è€…ç§é’¥ã€ç”Ÿæˆçš„æ•°å­—ç­¾åã€‚ é‚£ä¹ˆåœ¨è¯ä¹¦äº¤æ¢æ—¶ï¼Œå¦‚ä½•éªŒè¯è¯ä¹¦çš„çœŸå®æ€§ã€å®Œæ•´æ€§åŠæ¥æºèº«ä»½å‘¢ï¼Ÿæ ¹æ®ã€Œæ•°å­—ç­¾åã€ç®—æ³•çš„åŸç†ï¼Œæ˜¾ç„¶éœ€è¦ä½¿ç”¨ã€Œç­¾å‘è€…å…¬é’¥ã€æ¥éªŒè¯ã€Œè¢«ç­¾å‘è¯ä¹¦ã€ä¸­çš„ç­¾åã€‚ ä»ç„¶è¾›è‹¦ Alice ä¸ Bob æ¥æ¼”ç¤ºä¸‹è¿™ä¸ªæµç¨‹: å‡è®¾ç°åœ¨ Alice ç”Ÿæˆäº†è‡ªå·±çš„å…¬ç§é’¥å¯¹ï¼Œå¥¹æƒ³å°†å…¬é’¥å‘é€ç»™è¿œåœ¨åƒé‡Œä¹‹å¤–çš„ Bobï¼Œä»¥ä¾¿ä¸ Bob è¿›è¡ŒåŠ å¯†é€šè®¯ ä½†æ˜¯å¦‚æœ Alice ç›´æ¥å‘é€å…¬é’¥ç»™ Bobï¼ŒBob å¹¶æ— æ³•éªŒè¯å…¶æ¥æºæ˜¯ Aliceï¼Œä¹Ÿæ— æ³•éªŒè¯è¯¥å…¬é’¥æ˜¯å¦è¢«ä¸­é—´äººç¯¡æ”¹ PKI å¼•å…¥äº†ä¸€ä¸ªå¯ä¿¡èµ–çš„ç¬¬ä¸‰è€…ï¼ˆTrusted third partyï¼ŒTTPï¼‰æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚åœ¨ Alice ä¸ Bob çš„æ¡ˆä¾‹ä¸­ï¼Œå°±æ˜¯è¯´è¿˜æœ‰ä¸ªç¬¬ä¸‰è€… Eveï¼Œä»–ä½¿ç”¨è‡ªå·±çš„ç§é’¥ä¸ºè‡ªå·±çš„å…¬é’¥è¯ä¹¦ç­¾äº†åï¼Œç”Ÿæˆäº†ä¸€ä¸ªã€Œè‡ªç­¾åè¯ä¹¦ã€ï¼Œå¹¶ä¸”å·²ç»æå‰å°†è¿™ä¸ªã€Œè‡ªç­¾åè¯ä¹¦ã€åˆ†å‘ï¼ˆæ¯”å¦‚å½“é¢äº¤ä»˜ã€é¢„ç½®åœ¨æ“ä½œç³»ç»Ÿä¸­ç­‰æ‰‹æ®µï¼‰ç»™äº† Alice è·Ÿ Bob. ç°åœ¨ Alice é¦–å…ˆä½¿ç”¨è‡ªå·±çš„å…¬é’¥ä»¥åŠä¸ªäººä¿¡æ¯åˆ¶ä½œäº†è‡ªå·±çš„å…¬é’¥è¯ä¹¦ï¼Œä½†æ˜¯è¿™ä¸ªè¯ä¹¦è¿˜ç¼ºä¹ä¸€ä¸ª Issuer å±æ€§ä»¥åŠæ•°å­—ç­¾åï¼Œæˆ‘ä»¬æŠŠå®ƒå«åšã€Œè¯ä¹¦ç­¾åè¯·æ±‚ï¼ˆCertificate Signing Request, CSRï¼‰ã€ ä¸ºäº†å®ç°å°†è¯ä¹¦å®‰å…¨ä¼ é€’ç»™è¿œåœ¨åƒé‡Œä¹‹å¤–çš„ Bobï¼ŒAlice æ‰¾åˆ° Eveï¼Œå°†è¿™ä¸ª CSR æ–‡ä»¶æäº¤ç»™ Eve Eve éªŒè¯äº† Alice çš„èº«ä»½åï¼Œå†ä½¿ç”¨è¿™ä¸ª CSR ç­¾å‘å‡ºå®Œæ•´çš„è¯ä¹¦æ–‡ä»¶ï¼ˆIssuer å°±å¡« Eveï¼Œç„¶å Eve ä½¿ç”¨è‡ªå·±çš„ç§é’¥è®¡ç®—å‡ºè¯ä¹¦çš„æ•°å­—ç­¾åï¼Œè¿™æ ·å°±å¾—åˆ°äº†æœ€ç»ˆçš„è¯ä¹¦ï¼‰äº¤ä»˜ç»™ Alice Eve å¯æ˜¯æ›¾ç»è·¨è¶Šåƒé‡Œä¹‹é¥ï¼Œå°†è‡ªå·±çš„å…¬é’¥è¯ä¹¦åˆ†å‘ç»™äº† Bobï¼Œæ‰€ä»¥åœ¨ç»™ Alice ç­¾å‘è¯ä¹¦æ—¶ï¼Œä»–æ˜¾ç„¶å¯èƒ½ä¼šè¦æ±‚ Alice ç»™ä»˜ã€Œç­¾åè´¹ã€ã€‚ç›®å‰è®¸å¤šè¯ä¹¦æœºæ„å°±æ˜¯é è¿™ä¸ªèµšé’±çš„ï¼Œå½“ç„¶ä¹Ÿæœ‰éç›ˆåˆ©çš„è¯ä¹¦é¢å‘æœºæ„å¦‚ Letâ€™s Encrypt. ç°åœ¨ Alice å†å°†ç» Eve ç­¾åçš„è¯ä¹¦å‘é€ç»™ Bob Bob æ”¶åˆ°è¯ä¹¦åï¼Œçœ‹åˆ° Issuer æ˜¯ Eveï¼Œäºæ˜¯æ‰¾å‡ºä»¥å‰ Eve ç»™ä»–çš„ã€Œè‡ªç­¾åè¯ä¹¦ã€ï¼Œç„¶åä½¿ç”¨å…¶ä¸­çš„å…¬é’¥éªŒè¯æ”¶åˆ°çš„è¯ä¹¦ å¦‚æœéªŒè¯æˆåŠŸï¼Œå°±è¯´æ˜è¯ä¹¦çš„å†…å®¹æ˜¯ç»è¿‡ Eve è®¤è¯çš„ã€‚å¦‚æœ Eve æ²¡è€ç³Šæ¶‚äº†ï¼Œé‚£è¿™ä¸ªè¯ä¹¦åº”è¯¥ç¡®å®å°±æ˜¯ Alice çš„ã€‚ å¦‚æœéªŒè¯å¤±è´¥ï¼Œé‚£è¯´æ˜è¿™æ˜¯æŸä¸ªæ”»å‡»è€…ä¼ªé€ çš„è¯ä¹¦ã€‚ åœ¨ç°å®ä¸–ç•Œä¸­ï¼ŒEve è¿™ä¸ªè§’è‰²è¢«ç§°ä½œã€Œè¯ä¹¦è®¤è¯æœºæ„ï¼ˆCertification Authority, CAï¼‰ã€ï¼Œå…¨ä¸–ç•Œåªæœ‰å‡ åå®¶è¿™æ ·çš„æƒå¨æœºæ„ï¼Œå®ƒä»¬éƒ½é€šè¿‡äº†å„å¤§è½¯ä»¶å‚å•†çš„ä¸¥æ ¼å®¡æ ¸ï¼Œä»è€Œå°†æ ¹è¯ä¹¦ï¼ˆCA è¯ä¹¦ï¼‰ç›´æ¥å†…ç½®äºä¸»æµæ“ä½œç³»ç»Ÿä¸æµè§ˆå™¨ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´æ—©å°±æå‰åˆ†å‘ç»™äº†å› ç‰¹ç½‘ä¸–ç•Œçš„å‡ ä¹æ‰€æœ‰ç”¨æˆ·ã€‚ ç”±äºè®¸å¤šæ“ä½œç³»ç»Ÿæˆ–è½¯ä»¶çš„æ›´æ–°è¿­ä»£ç¼“æ…¢ï¼ˆ2022 å¹´äº†è¿˜æœ‰äººç”¨ XP ä½ æ•¢ä¿¡ï¼Ÿï¼‰ï¼Œæ ¹è¯ä¹¦çš„æœ‰æ•ˆæœŸé€šå¸¸éƒ½åœ¨åå¹´ä»¥ä¸Šã€‚ ä½†æ˜¯ï¼Œå¦‚æœ CA æœºæ„ç›´æ¥ä½¿ç”¨è‡ªå·±çš„ç§é’¥å¤„ç†å„ç§è¯ä¹¦ç­¾åè¯·æ±‚ï¼Œè¿™å°†æ˜¯éå¸¸å±é™©çš„ã€‚å› ä¸ºå…¨ä¸–ç•Œæœ‰æµ·é‡çš„ HTTPS ç½‘ç«™ï¼Œä¹Ÿå°±æ˜¯è¯´æœ‰æµ·é‡çš„è¯ä¹¦éœ€æ±‚ï¼Œå¯ä¸€å…±æ‰å‡ åå®¶ CA æœºæ„ã€‚é¢‘ç¹çš„åŠ¨ç”¨ç§é’¥ä¼šäº§ç”Ÿç§é’¥æ³„æ¼çš„é£é™©ï¼Œå¦‚æœè¿™ä¸ªç§é’¥æ³„æ¼äº†ï¼Œé‚£å°†ç›´æ¥å½±å“æµ·é‡ç½‘ç«™çš„å®‰å…¨æ€§ã€‚ PKI æ¶æ„ä½¿ç”¨ã€Œæ•°å­—è¯ä¹¦é“¾ï¼ˆä¹Ÿå«åšä¿¡ä»»é“¾ï¼‰ã€çš„æœºåˆ¶æ¥è§£å†³è¿™ä¸ªé—®é¢˜: CA æœºæ„é¦–å…ˆç”Ÿæˆè‡ªå·±çš„æ ¹è¯ä¹¦ä¸ç§é’¥ï¼Œå¹¶ä½¿ç”¨ç§é’¥ç»™æ ¹è¯ä¹¦ç­¾å å› ä¸ºç§é’¥è·Ÿè¯ä¹¦æœ¬èº«å°±æ˜¯ä¸€å¯¹ï¼Œå› æ­¤æ ¹è¯ä¹¦ä¹Ÿè¢«ç§°ä½œã€Œè‡ªç­¾åè¯ä¹¦ã€ CA æ ¹è¯ä¹¦è¢«ç›´æ¥äº¤ä»˜ç»™å„å¤§è½¯ç¡¬ä»¶å‚å•†ï¼Œå†…ç½®åœ¨ä¸»æµçš„æ“ä½œç³»ç»Ÿä¸æµè§ˆå™¨ä¸­ ç„¶å CA æœºæ„å†ä½¿ç”¨ç§é’¥ç­¾å‘ä¸€äº›æ‰€è°“çš„ã€Œä¸­é—´è¯ä¹¦ã€ï¼Œä¹‹åå°±æŠŠç§é’¥é›ªè—äº†ï¼Œéå¿…è¦ä¸ä¼šå†æ‹¿å‡ºæ¥ä½¿ç”¨ã€‚ æ ¹è¯ä¹¦çš„ç§é’¥é€šå¸¸ç¦»çº¿å­˜å‚¨åœ¨å®‰å…¨åœ°ç‚¹ ä¸­é—´è¯ä¹¦çš„æœ‰æ•ˆæœŸé€šå¸¸ä¼šæ¯”æ ¹è¯ä¹¦çŸ­ä¸€äº› éƒ¨åˆ†ä¸­é—´è¯ä¹¦ä¼šè¢«ä½œä¸ºå¤‡ä»½ä½¿ç”¨ï¼Œå¹³å¸¸ä¸ä¼šå¯ç”¨ CA æœºæ„ä½¿ç”¨è¿™äº›ä¸­é—´è¯ä¹¦çš„ç§é’¥ï¼Œä¸ºç”¨æˆ·æäº¤çš„æ‰€æœ‰ CSR è¯·æ±‚ç­¾å ç”»ä¸ªå›¾æ¥è¡¨ç¤ºå¤§æ¦‚æ˜¯è¿™ä¹ˆä¸ªæ ·å­ï¼š CA æœºæ„ä¹Ÿå¯èƒ½ä¼šåœ¨ç»è¿‡ä¸¥æ ¼å®¡æ ¸åï¼Œä¸ºå…¶ä»–æœºæ„ç­¾å‘ä¸­é—´è¯ä¹¦ï¼Œè¿™æ ·å°±èƒ½èµ‹äºˆå…¶ä»–æœºæ„ç­¾å‘è¯ä¹¦çš„æƒåˆ©ï¼Œè€Œä¸”æ ¹è¯ä¹¦çš„å®‰å…¨æ€§ä¸å—å½±å“ã€‚ å¦‚æœä½ è®¿é—®æŸä¸ª HTTPS ç«™ç‚¹å‘ç°æµè§ˆå™¨æ˜¾ç¤ºå°ç»¿é”ï¼Œé‚£å°±è¯´æ˜è¿™ä¸ªè¯ä¹¦æ˜¯ç”±æŸä¸ªæƒå¨è®¤è¯æœºæ„ç­¾å‘çš„ï¼Œå…¶ä¿¡æ¯æ˜¯ç»è¿‡è¿™äº›æœºæ„è®¤è¯çš„ã€‚ ä¸Šè¿°è¿™ä¸ªå…¨çƒäº’è”ç½‘ä¸Šï¼Œç”±è¯ä¹¦è®¤è¯æœºæ„ã€æ“ä½œç³»ç»Ÿä¸æµè§ˆå™¨å†…ç½®çš„æ ¹è¯ä¹¦ã€TLS åŠ å¯†è®¤è¯åè®®ã€OCSP è¯ä¹¦åŠé”€åè®®ç­‰ç­‰ç»„æˆçš„æ¶æ„ï¼Œæˆ‘ä»¬å¯ä»¥ç§°å®ƒä¸º Web PKI. Web PKI é€šå¸¸æ˜¯å¯ä¿¡çš„ï¼Œä½†æ˜¯å¹¶ä¸æ„å‘³ç€å®ƒä»¬å¯é ã€‚å†å²ä¸Šå‡ºç°è¿‡è®¸å¤šç”±äºå®‰å…¨æ¼æ´ ï¼ˆ2011 DigiNotar æ”»å‡»ï¼‰æˆ–è€…æ”¿åºœè¦æ±‚ï¼Œè¯ä¹¦è®¤è¯æœºæ„å°†å‡è¯ä¹¦é¢å‘ç»™é»‘å®¢æˆ–è€…æ”¿åºœæœºæ„çš„æƒ…å†µã€‚è·å¾—å‡è¯ä¹¦çš„äººå°†å¯ä»¥éšæ„ä¼ªé€ ç«™ç‚¹ï¼Œè€Œæ‰€æœ‰æ“ä½œç³»ç»Ÿæˆ–æµè§ˆå™¨éƒ½è®¤ä¸ºè¿™äº›å‡ç«™ç‚¹æ˜¯å®‰å…¨çš„ï¼ˆæ˜¾ç¤ºå°ç»¿é”ï¼‰ã€‚ å› ä¸ºè¯ä¹¦è®¤è¯æœºæ„çš„å¯é æ€§é—®é¢˜ä»¥åŠä¸€äº›å…¶ä»–çš„åŸå› ï¼Œéƒ¨åˆ†ä¸ªäººã€ä¼ä¸šæˆ–å…¶ä»–æœºæ„ï¼ˆæ¯”å¦‚é‡‘èæœºæ„ï¼‰ä¼šç”Ÿæˆè‡ªå·±çš„æ ¹è¯ä¹¦ä¸ä¸­é—´è¯ä¹¦ï¼Œç„¶åè‡ªè¡Œç­¾å‘è¯ä¹¦ï¼Œæ„å»ºå‡ºè‡ªå·±çš„ PKI è®¤è¯æ¶æ„ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒç§°ä½œå†…éƒ¨ PKIæˆ–è€…ç§æœ‰ PKIã€‚ä½†æ˜¯è¿™ç§è‡ªå·±ç”Ÿæˆçš„æ ¹è¯ä¹¦æ˜¯æœªå†…ç½®åœ¨æ“ä½œç³»ç»Ÿä¸æµè§ˆå™¨ä¸­çš„ï¼Œä¸ºäº†ç¡®ä¿å®‰å…¨æ€§ï¼Œç”¨æˆ·å°±éœ€è¦å…ˆæ‰‹åŠ¨åœ¨è®¾å¤‡ä¸Šå®‰è£…å¥½è¿™ä¸ªæ•°å­—è¯ä¹¦ã€‚è‡ªè¡Œç­¾å‘è¯ä¹¦çš„æ¡ˆä¾‹æœ‰ï¼š å¾®ä¿¡ã€æ”¯ä»˜å®åŠå„ç§é“¶è¡Œå®¢æˆ·ç«¯ä¸­çš„æ•°å­—è¯ä¹¦ä¸å®‰å…¨æ€§æ›´é«˜çš„ USB ç¡¬ä»¶è¯ä¹¦ï¼ˆU ç›¾ï¼‰ï¼Œè¿™ç§æ¶‰åŠæµ·é‡èµ„é‡‘å®‰å…¨ç”šè‡³å›½å®¶å®‰å…¨çš„åœºæ™¯ï¼Œæ˜¾ç„¶ä¸èƒ½ç›´æ¥ä½¿ç”¨å‰è¿°æ™®é€šæƒå¨ CA æœºæ„ç­¾å‘çš„è¯ä¹¦ã€‚ å±€åŸŸç½‘é€šä¿¡ï¼Œé€šå¸¸æ˜¯ç½‘ç»œç®¡ç†å‘˜ç”Ÿæˆä¸€ä¸ªæœ¬åœ° CA è¯ä¹¦å®‰è£…åˆ°æ‰€æœ‰å±€åŸŸç½‘è®¾å¤‡ä¸Šï¼Œå†ç”¨å®ƒçš„ç§é’¥ç­¾å‘å…¶ä»–è¯ä¹¦ç”¨äºå±€åŸŸç½‘å®‰å…¨é€šä¿¡ å…¸å‹çš„ä¾‹å­æ˜¯å„ä¼ä¸šçš„å†…éƒ¨é€šè®¯ç½‘ç»œï¼Œæ¯”å¦‚ Kubernetes å®¹å™¨é›†ç¾¤ ç°åœ¨å†æ‹¿å‡ºå‰é¢ https://www.google.com çš„è¯ä¹¦æˆªå›¾çœ‹çœ‹ï¼Œæœ€ä¸Šæ–¹æœ‰ä¸‰ä¸ªæ ‡ç­¾é¡µï¼Œä»å·¦è‡³å³ä¾æ¬¡æ˜¯ã€ŒæœåŠ¡å™¨è¯ä¹¦ã€ã€ã€Œä¸­é—´è¯ä¹¦ã€ã€ã€Œæ ¹è¯ä¹¦ã€ï¼Œå¯ä»¥ç‚¹è¿›å»åˆ†åˆ«æŸ¥çœ‹è¿™ä¸‰ä¸ªè¯ä¹¦çš„å„é¡¹å‚æ•°ï¼Œå„ä½çœ‹å®˜å¯ä»¥è‡ªè¡Œå°è¯•ï¼š Google è¯ä¹¦å†…å®¹ äº¤å‰ç­¾åæŒ‰å‰é¢çš„æè¿°ï¼Œæ¯ä¸ªæƒå¨è®¤è¯æœºæ„éƒ½æ‹¥æœ‰ä¸€ä¸ªæ­£åœ¨ä½¿ç”¨çš„æ ¹è¯ä¹¦ï¼Œä½¿ç”¨å®ƒç­¾å‘å‡ºå‡ ä¸ªä¸­é—´è¯ä¹¦åï¼Œå°±ä¼šæŠŠå®ƒç¦»çº¿å­˜å‚¨åœ¨å®‰å…¨åœ°ç‚¹ï¼Œå¹³å¸¸ä»…ä½¿ç”¨ä¸­é—´è¯ä¹¦ç­¾å‘ç»ˆç«¯å®ä½“è¯ä¹¦ã€‚è¿™æ ·å®é™…ä¸Šæ¯ä¸ªæƒå¨è®¤è¯æœºæ„çš„è¯ä¹¦éƒ½å½¢æˆä¸€é¢—è¯ä¹¦æ ‘ï¼Œæ ‘çš„é¡¶ç«¯å°±æ˜¯æ ¹è¯ä¹¦ã€‚ å®é™…ä¸Šåœ¨ PKI ä½“ç³»ä¸­ï¼Œä¸€äº›è¯ä¹¦é“¾ä¸Šçš„ä¸­é—´è¯ä¹¦ä¼šè¢«ä½¿ç”¨å¤šä¸ªæ ¹è¯ä¹¦è¿›è¡Œç­¾åâ€”â€”æˆ‘ä»¬ç§°è¿™ä¸ºäº¤å‰ç­¾åã€‚äº¤å‰ç­¾åçš„ä¸»è¦ç›®çš„æ˜¯æå‡è¯ä¹¦çš„å…¼å®¹æ€§â€”â€”å®¢æˆ·ç«¯åªè¦å®‰è£…æœ‰å…¶ä¸­ä»»ä½•ä¸€ä¸ªæ ¹è¯ä¹¦ï¼Œå°±èƒ½æ­£å¸¸éªŒè¯è¿™ä¸ªä¸­é—´è¯ä¹¦ã€‚ä»è€Œä½¿ä¸­é—´è¯ä¹¦åœ¨è¾ƒè€çš„è®¾å¤‡ä¹Ÿèƒ½é¡ºåˆ©é€šè¿‡è¯ä¹¦éªŒè¯ã€‚ ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:3:2","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#a-chain-of-trust"},{"categories":["tech"],"content":" 2. è¯ä¹¦ä¿¡ä»»é“¾å‰é¢ä»‹ç»è¯ä¹¦å†…å®¹æ—¶ï¼Œæåˆ°äº†æ¯ä¸ªè¯ä¹¦éƒ½åŒ…å«ã€Œç­¾å‘è€…ï¼ˆIssuerï¼‰ã€ä¿¡æ¯ï¼Œå¹¶ä¸”è¿˜åŒ…å«ã€Œç­¾å‘è€…ã€ä½¿ç”¨ã€Œè¯ä¹¦å†…å®¹ã€ä¸ã€Œç­¾å‘è€…ç§é’¥ã€ç”Ÿæˆçš„æ•°å­—ç­¾åã€‚ é‚£ä¹ˆåœ¨è¯ä¹¦äº¤æ¢æ—¶ï¼Œå¦‚ä½•éªŒè¯è¯ä¹¦çš„çœŸå®æ€§ã€å®Œæ•´æ€§åŠæ¥æºèº«ä»½å‘¢ï¼Ÿæ ¹æ®ã€Œæ•°å­—ç­¾åã€ç®—æ³•çš„åŸç†ï¼Œæ˜¾ç„¶éœ€è¦ä½¿ç”¨ã€Œç­¾å‘è€…å…¬é’¥ã€æ¥éªŒè¯ã€Œè¢«ç­¾å‘è¯ä¹¦ã€ä¸­çš„ç­¾åã€‚ ä»ç„¶è¾›è‹¦ Alice ä¸ Bob æ¥æ¼”ç¤ºä¸‹è¿™ä¸ªæµç¨‹: å‡è®¾ç°åœ¨ Alice ç”Ÿæˆäº†è‡ªå·±çš„å…¬ç§é’¥å¯¹ï¼Œå¥¹æƒ³å°†å…¬é’¥å‘é€ç»™è¿œåœ¨åƒé‡Œä¹‹å¤–çš„ Bobï¼Œä»¥ä¾¿ä¸ Bob è¿›è¡ŒåŠ å¯†é€šè®¯ ä½†æ˜¯å¦‚æœ Alice ç›´æ¥å‘é€å…¬é’¥ç»™ Bobï¼ŒBob å¹¶æ— æ³•éªŒè¯å…¶æ¥æºæ˜¯ Aliceï¼Œä¹Ÿæ— æ³•éªŒè¯è¯¥å…¬é’¥æ˜¯å¦è¢«ä¸­é—´äººç¯¡æ”¹ PKI å¼•å…¥äº†ä¸€ä¸ªå¯ä¿¡èµ–çš„ç¬¬ä¸‰è€…ï¼ˆTrusted third partyï¼ŒTTPï¼‰æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚åœ¨ Alice ä¸ Bob çš„æ¡ˆä¾‹ä¸­ï¼Œå°±æ˜¯è¯´è¿˜æœ‰ä¸ªç¬¬ä¸‰è€… Eveï¼Œä»–ä½¿ç”¨è‡ªå·±çš„ç§é’¥ä¸ºè‡ªå·±çš„å…¬é’¥è¯ä¹¦ç­¾äº†åï¼Œç”Ÿæˆäº†ä¸€ä¸ªã€Œè‡ªç­¾åè¯ä¹¦ã€ï¼Œå¹¶ä¸”å·²ç»æå‰å°†è¿™ä¸ªã€Œè‡ªç­¾åè¯ä¹¦ã€åˆ†å‘ï¼ˆæ¯”å¦‚å½“é¢äº¤ä»˜ã€é¢„ç½®åœ¨æ“ä½œç³»ç»Ÿä¸­ç­‰æ‰‹æ®µï¼‰ç»™äº† Alice è·Ÿ Bob. ç°åœ¨ Alice é¦–å…ˆä½¿ç”¨è‡ªå·±çš„å…¬é’¥ä»¥åŠä¸ªäººä¿¡æ¯åˆ¶ä½œäº†è‡ªå·±çš„å…¬é’¥è¯ä¹¦ï¼Œä½†æ˜¯è¿™ä¸ªè¯ä¹¦è¿˜ç¼ºä¹ä¸€ä¸ª Issuer å±æ€§ä»¥åŠæ•°å­—ç­¾åï¼Œæˆ‘ä»¬æŠŠå®ƒå«åšã€Œè¯ä¹¦ç­¾åè¯·æ±‚ï¼ˆCertificate Signing Request, CSRï¼‰ã€ ä¸ºäº†å®ç°å°†è¯ä¹¦å®‰å…¨ä¼ é€’ç»™è¿œåœ¨åƒé‡Œä¹‹å¤–çš„ Bobï¼ŒAlice æ‰¾åˆ° Eveï¼Œå°†è¿™ä¸ª CSR æ–‡ä»¶æäº¤ç»™ Eve Eve éªŒè¯äº† Alice çš„èº«ä»½åï¼Œå†ä½¿ç”¨è¿™ä¸ª CSR ç­¾å‘å‡ºå®Œæ•´çš„è¯ä¹¦æ–‡ä»¶ï¼ˆIssuer å°±å¡« Eveï¼Œç„¶å Eve ä½¿ç”¨è‡ªå·±çš„ç§é’¥è®¡ç®—å‡ºè¯ä¹¦çš„æ•°å­—ç­¾åï¼Œè¿™æ ·å°±å¾—åˆ°äº†æœ€ç»ˆçš„è¯ä¹¦ï¼‰äº¤ä»˜ç»™ Alice Eve å¯æ˜¯æ›¾ç»è·¨è¶Šåƒé‡Œä¹‹é¥ï¼Œå°†è‡ªå·±çš„å…¬é’¥è¯ä¹¦åˆ†å‘ç»™äº† Bobï¼Œæ‰€ä»¥åœ¨ç»™ Alice ç­¾å‘è¯ä¹¦æ—¶ï¼Œä»–æ˜¾ç„¶å¯èƒ½ä¼šè¦æ±‚ Alice ç»™ä»˜ã€Œç­¾åè´¹ã€ã€‚ç›®å‰è®¸å¤šè¯ä¹¦æœºæ„å°±æ˜¯é è¿™ä¸ªèµšé’±çš„ï¼Œå½“ç„¶ä¹Ÿæœ‰éç›ˆåˆ©çš„è¯ä¹¦é¢å‘æœºæ„å¦‚ Letâ€™s Encrypt. ç°åœ¨ Alice å†å°†ç» Eve ç­¾åçš„è¯ä¹¦å‘é€ç»™ Bob Bob æ”¶åˆ°è¯ä¹¦åï¼Œçœ‹åˆ° Issuer æ˜¯ Eveï¼Œäºæ˜¯æ‰¾å‡ºä»¥å‰ Eve ç»™ä»–çš„ã€Œè‡ªç­¾åè¯ä¹¦ã€ï¼Œç„¶åä½¿ç”¨å…¶ä¸­çš„å…¬é’¥éªŒè¯æ”¶åˆ°çš„è¯ä¹¦ å¦‚æœéªŒè¯æˆåŠŸï¼Œå°±è¯´æ˜è¯ä¹¦çš„å†…å®¹æ˜¯ç»è¿‡ Eve è®¤è¯çš„ã€‚å¦‚æœ Eve æ²¡è€ç³Šæ¶‚äº†ï¼Œé‚£è¿™ä¸ªè¯ä¹¦åº”è¯¥ç¡®å®å°±æ˜¯ Alice çš„ã€‚ å¦‚æœéªŒè¯å¤±è´¥ï¼Œé‚£è¯´æ˜è¿™æ˜¯æŸä¸ªæ”»å‡»è€…ä¼ªé€ çš„è¯ä¹¦ã€‚ åœ¨ç°å®ä¸–ç•Œä¸­ï¼ŒEve è¿™ä¸ªè§’è‰²è¢«ç§°ä½œã€Œè¯ä¹¦è®¤è¯æœºæ„ï¼ˆCertification Authority, CAï¼‰ã€ï¼Œå…¨ä¸–ç•Œåªæœ‰å‡ åå®¶è¿™æ ·çš„æƒå¨æœºæ„ï¼Œå®ƒä»¬éƒ½é€šè¿‡äº†å„å¤§è½¯ä»¶å‚å•†çš„ä¸¥æ ¼å®¡æ ¸ï¼Œä»è€Œå°†æ ¹è¯ä¹¦ï¼ˆCA è¯ä¹¦ï¼‰ç›´æ¥å†…ç½®äºä¸»æµæ“ä½œç³»ç»Ÿä¸æµè§ˆå™¨ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´æ—©å°±æå‰åˆ†å‘ç»™äº†å› ç‰¹ç½‘ä¸–ç•Œçš„å‡ ä¹æ‰€æœ‰ç”¨æˆ·ã€‚ ç”±äºè®¸å¤šæ“ä½œç³»ç»Ÿæˆ–è½¯ä»¶çš„æ›´æ–°è¿­ä»£ç¼“æ…¢ï¼ˆ2022 å¹´äº†è¿˜æœ‰äººç”¨ XP ä½ æ•¢ä¿¡ï¼Ÿï¼‰ï¼Œæ ¹è¯ä¹¦çš„æœ‰æ•ˆæœŸé€šå¸¸éƒ½åœ¨åå¹´ä»¥ä¸Šã€‚ ä½†æ˜¯ï¼Œå¦‚æœ CA æœºæ„ç›´æ¥ä½¿ç”¨è‡ªå·±çš„ç§é’¥å¤„ç†å„ç§è¯ä¹¦ç­¾åè¯·æ±‚ï¼Œè¿™å°†æ˜¯éå¸¸å±é™©çš„ã€‚å› ä¸ºå…¨ä¸–ç•Œæœ‰æµ·é‡çš„ HTTPS ç½‘ç«™ï¼Œä¹Ÿå°±æ˜¯è¯´æœ‰æµ·é‡çš„è¯ä¹¦éœ€æ±‚ï¼Œå¯ä¸€å…±æ‰å‡ åå®¶ CA æœºæ„ã€‚é¢‘ç¹çš„åŠ¨ç”¨ç§é’¥ä¼šäº§ç”Ÿç§é’¥æ³„æ¼çš„é£é™©ï¼Œå¦‚æœè¿™ä¸ªç§é’¥æ³„æ¼äº†ï¼Œé‚£å°†ç›´æ¥å½±å“æµ·é‡ç½‘ç«™çš„å®‰å…¨æ€§ã€‚ PKI æ¶æ„ä½¿ç”¨ã€Œæ•°å­—è¯ä¹¦é“¾ï¼ˆä¹Ÿå«åšä¿¡ä»»é“¾ï¼‰ã€çš„æœºåˆ¶æ¥è§£å†³è¿™ä¸ªé—®é¢˜: CA æœºæ„é¦–å…ˆç”Ÿæˆè‡ªå·±çš„æ ¹è¯ä¹¦ä¸ç§é’¥ï¼Œå¹¶ä½¿ç”¨ç§é’¥ç»™æ ¹è¯ä¹¦ç­¾å å› ä¸ºç§é’¥è·Ÿè¯ä¹¦æœ¬èº«å°±æ˜¯ä¸€å¯¹ï¼Œå› æ­¤æ ¹è¯ä¹¦ä¹Ÿè¢«ç§°ä½œã€Œè‡ªç­¾åè¯ä¹¦ã€ CA æ ¹è¯ä¹¦è¢«ç›´æ¥äº¤ä»˜ç»™å„å¤§è½¯ç¡¬ä»¶å‚å•†ï¼Œå†…ç½®åœ¨ä¸»æµçš„æ“ä½œç³»ç»Ÿä¸æµè§ˆå™¨ä¸­ ç„¶å CA æœºæ„å†ä½¿ç”¨ç§é’¥ç­¾å‘ä¸€äº›æ‰€è°“çš„ã€Œä¸­é—´è¯ä¹¦ã€ï¼Œä¹‹åå°±æŠŠç§é’¥é›ªè—äº†ï¼Œéå¿…è¦ä¸ä¼šå†æ‹¿å‡ºæ¥ä½¿ç”¨ã€‚ æ ¹è¯ä¹¦çš„ç§é’¥é€šå¸¸ç¦»çº¿å­˜å‚¨åœ¨å®‰å…¨åœ°ç‚¹ ä¸­é—´è¯ä¹¦çš„æœ‰æ•ˆæœŸé€šå¸¸ä¼šæ¯”æ ¹è¯ä¹¦çŸ­ä¸€äº› éƒ¨åˆ†ä¸­é—´è¯ä¹¦ä¼šè¢«ä½œä¸ºå¤‡ä»½ä½¿ç”¨ï¼Œå¹³å¸¸ä¸ä¼šå¯ç”¨ CA æœºæ„ä½¿ç”¨è¿™äº›ä¸­é—´è¯ä¹¦çš„ç§é’¥ï¼Œä¸ºç”¨æˆ·æäº¤çš„æ‰€æœ‰ CSR è¯·æ±‚ç­¾å ç”»ä¸ªå›¾æ¥è¡¨ç¤ºå¤§æ¦‚æ˜¯è¿™ä¹ˆä¸ªæ ·å­ï¼š CA æœºæ„ä¹Ÿå¯èƒ½ä¼šåœ¨ç»è¿‡ä¸¥æ ¼å®¡æ ¸åï¼Œä¸ºå…¶ä»–æœºæ„ç­¾å‘ä¸­é—´è¯ä¹¦ï¼Œè¿™æ ·å°±èƒ½èµ‹äºˆå…¶ä»–æœºæ„ç­¾å‘è¯ä¹¦çš„æƒåˆ©ï¼Œè€Œä¸”æ ¹è¯ä¹¦çš„å®‰å…¨æ€§ä¸å—å½±å“ã€‚ å¦‚æœä½ è®¿é—®æŸä¸ª HTTPS ç«™ç‚¹å‘ç°æµè§ˆå™¨æ˜¾ç¤ºå°ç»¿é”ï¼Œé‚£å°±è¯´æ˜è¿™ä¸ªè¯ä¹¦æ˜¯ç”±æŸä¸ªæƒå¨è®¤è¯æœºæ„ç­¾å‘çš„ï¼Œå…¶ä¿¡æ¯æ˜¯ç»è¿‡è¿™äº›æœºæ„è®¤è¯çš„ã€‚ ä¸Šè¿°è¿™ä¸ªå…¨çƒäº’è”ç½‘ä¸Šï¼Œç”±è¯ä¹¦è®¤è¯æœºæ„ã€æ“ä½œç³»ç»Ÿä¸æµè§ˆå™¨å†…ç½®çš„æ ¹è¯ä¹¦ã€TLS åŠ å¯†è®¤è¯åè®®ã€OCSP è¯ä¹¦åŠé”€åè®®ç­‰ç­‰ç»„æˆçš„æ¶æ„ï¼Œæˆ‘ä»¬å¯ä»¥ç§°å®ƒä¸º Web PKI. Web PKI é€šå¸¸æ˜¯å¯ä¿¡çš„ï¼Œä½†æ˜¯å¹¶ä¸æ„å‘³ç€å®ƒä»¬å¯é ã€‚å†å²ä¸Šå‡ºç°è¿‡è®¸å¤šç”±äºå®‰å…¨æ¼æ´ ï¼ˆ2011 DigiNotar æ”»å‡»ï¼‰æˆ–è€…æ”¿åºœè¦æ±‚ï¼Œè¯ä¹¦è®¤è¯æœºæ„å°†å‡è¯ä¹¦é¢å‘ç»™é»‘å®¢æˆ–è€…æ”¿åºœæœºæ„çš„æƒ…å†µã€‚è·å¾—å‡è¯ä¹¦çš„äººå°†å¯ä»¥éšæ„ä¼ªé€ ç«™ç‚¹ï¼Œè€Œæ‰€æœ‰æ“ä½œç³»ç»Ÿæˆ–æµè§ˆå™¨éƒ½è®¤ä¸ºè¿™äº›å‡ç«™ç‚¹æ˜¯å®‰å…¨çš„ï¼ˆæ˜¾ç¤ºå°ç»¿é”ï¼‰ã€‚ å› ä¸ºè¯ä¹¦è®¤è¯æœºæ„çš„å¯é æ€§é—®é¢˜ä»¥åŠä¸€äº›å…¶ä»–çš„åŸå› ï¼Œéƒ¨åˆ†ä¸ªäººã€ä¼ä¸šæˆ–å…¶ä»–æœºæ„ï¼ˆæ¯”å¦‚é‡‘èæœºæ„ï¼‰ä¼šç”Ÿæˆè‡ªå·±çš„æ ¹è¯ä¹¦ä¸ä¸­é—´è¯ä¹¦ï¼Œç„¶åè‡ªè¡Œç­¾å‘è¯ä¹¦ï¼Œæ„å»ºå‡ºè‡ªå·±çš„ PKI è®¤è¯æ¶æ„ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒç§°ä½œå†…éƒ¨ PKIæˆ–è€…ç§æœ‰ PKIã€‚ä½†æ˜¯è¿™ç§è‡ªå·±ç”Ÿæˆçš„æ ¹è¯ä¹¦æ˜¯æœªå†…ç½®åœ¨æ“ä½œç³»ç»Ÿä¸æµè§ˆå™¨ä¸­çš„ï¼Œä¸ºäº†ç¡®ä¿å®‰å…¨æ€§ï¼Œç”¨æˆ·å°±éœ€è¦å…ˆæ‰‹åŠ¨åœ¨è®¾å¤‡ä¸Šå®‰è£…å¥½è¿™ä¸ªæ•°å­—è¯ä¹¦ã€‚è‡ªè¡Œç­¾å‘è¯ä¹¦çš„æ¡ˆä¾‹æœ‰ï¼š å¾®ä¿¡ã€æ”¯ä»˜å®åŠå„ç§é“¶è¡Œå®¢æˆ·ç«¯ä¸­çš„æ•°å­—è¯ä¹¦ä¸å®‰å…¨æ€§æ›´é«˜çš„ USB ç¡¬ä»¶è¯ä¹¦ï¼ˆU ç›¾ï¼‰ï¼Œè¿™ç§æ¶‰åŠæµ·é‡èµ„é‡‘å®‰å…¨ç”šè‡³å›½å®¶å®‰å…¨çš„åœºæ™¯ï¼Œæ˜¾ç„¶ä¸èƒ½ç›´æ¥ä½¿ç”¨å‰è¿°æ™®é€šæƒå¨ CA æœºæ„ç­¾å‘çš„è¯ä¹¦ã€‚ å±€åŸŸç½‘é€šä¿¡ï¼Œé€šå¸¸æ˜¯ç½‘ç»œç®¡ç†å‘˜ç”Ÿæˆä¸€ä¸ªæœ¬åœ° CA è¯ä¹¦å®‰è£…åˆ°æ‰€æœ‰å±€åŸŸç½‘è®¾å¤‡ä¸Šï¼Œå†ç”¨å®ƒçš„ç§é’¥ç­¾å‘å…¶ä»–è¯ä¹¦ç”¨äºå±€åŸŸç½‘å®‰å…¨é€šä¿¡ å…¸å‹çš„ä¾‹å­æ˜¯å„ä¼ä¸šçš„å†…éƒ¨é€šè®¯ç½‘ç»œï¼Œæ¯”å¦‚ Kubernetes å®¹å™¨é›†ç¾¤ ç°åœ¨å†æ‹¿å‡ºå‰é¢ https://www.google.com çš„è¯ä¹¦æˆªå›¾çœ‹çœ‹ï¼Œæœ€ä¸Šæ–¹æœ‰ä¸‰ä¸ªæ ‡ç­¾é¡µï¼Œä»å·¦è‡³å³ä¾æ¬¡æ˜¯ã€ŒæœåŠ¡å™¨è¯ä¹¦ã€ã€ã€Œä¸­é—´è¯ä¹¦ã€ã€ã€Œæ ¹è¯ä¹¦ã€ï¼Œå¯ä»¥ç‚¹è¿›å»åˆ†åˆ«æŸ¥çœ‹è¿™ä¸‰ä¸ªè¯ä¹¦çš„å„é¡¹å‚æ•°ï¼Œå„ä½çœ‹å®˜å¯ä»¥è‡ªè¡Œå°è¯•ï¼š Google è¯ä¹¦å†…å®¹ äº¤å‰ç­¾åæŒ‰å‰é¢çš„æè¿°ï¼Œæ¯ä¸ªæƒå¨è®¤è¯æœºæ„éƒ½æ‹¥æœ‰ä¸€ä¸ªæ­£åœ¨ä½¿ç”¨çš„æ ¹è¯ä¹¦ï¼Œä½¿ç”¨å®ƒç­¾å‘å‡ºå‡ ä¸ªä¸­é—´è¯ä¹¦åï¼Œå°±ä¼šæŠŠå®ƒç¦»çº¿å­˜å‚¨åœ¨å®‰å…¨åœ°ç‚¹ï¼Œå¹³å¸¸ä»…ä½¿ç”¨ä¸­é—´è¯ä¹¦ç­¾å‘ç»ˆç«¯å®ä½“è¯ä¹¦ã€‚è¿™æ ·å®é™…ä¸Šæ¯ä¸ªæƒå¨è®¤è¯æœºæ„çš„è¯ä¹¦éƒ½å½¢æˆä¸€é¢—è¯ä¹¦æ ‘ï¼Œæ ‘çš„é¡¶ç«¯å°±æ˜¯æ ¹è¯ä¹¦ã€‚ å®é™…ä¸Šåœ¨ PKI ä½“ç³»ä¸­ï¼Œä¸€äº›è¯ä¹¦é“¾ä¸Šçš„ä¸­é—´è¯ä¹¦ä¼šè¢«ä½¿ç”¨å¤šä¸ªæ ¹è¯ä¹¦è¿›è¡Œç­¾åâ€”â€”æˆ‘ä»¬ç§°è¿™ä¸ºäº¤å‰ç­¾åã€‚äº¤å‰ç­¾åçš„ä¸»è¦ç›®çš„æ˜¯æå‡è¯ä¹¦çš„å…¼å®¹æ€§â€”â€”å®¢æˆ·ç«¯åªè¦å®‰è£…æœ‰å…¶ä¸­ä»»ä½•ä¸€ä¸ªæ ¹è¯ä¹¦ï¼Œå°±èƒ½æ­£å¸¸éªŒè¯è¿™ä¸ªä¸­é—´è¯ä¹¦ã€‚ä»è€Œä½¿ä¸­é—´è¯ä¹¦åœ¨è¾ƒè€çš„è®¾å¤‡ä¹Ÿèƒ½é¡ºåˆ©é€šè¿‡è¯ä¹¦éªŒè¯ã€‚ ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:3:2","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#äº¤å‰ç­¾å"},{"categories":["tech"],"content":" 3. è¯ä¹¦çš„å­˜å‚¨æ ¼å¼ä¸ç¼–ç æ ‡å‡† è¯ä¹¦çš„æ ¼å¼è¿™ä¸€å—ï¼Œæ˜¯çœŸçš„äº”èŠ±å…«é—¨â€¦æ²‰é‡çš„å†å²åŒ…è¢±â€¦ X509 åªè§„å®šäº†è¯ä¹¦åº”è¯¥åŒ…å«å“ªäº›ä¿¡æ¯ï¼Œä½†æ˜¯æœªå®šä¹‰è¯ä¹¦è¯¥å¦‚ä½•å­˜å‚¨ã€‚ä¸ºäº†è§£å†³è¯ä¹¦çš„æè¿°ä¸ç¼–ç å­˜å‚¨é—®é¢˜ï¼Œåˆå‡ºç°äº†å¦‚ä¸‹æ ‡å‡†ï¼š ASN.1 ç»“æ„ï¼šæ˜¯ä¸€ç§æè¿°è¯ä¹¦æ ¼å¼çš„æ–¹æ³•ã€‚ å®ƒç±»ä¼¼ protobuf æ•°æ®æè¿°è¯­è¨€ã€SQL DDL ASN.1 åªè§„å®šäº†è¯¥å¦‚ä½•æè¿°è¯ä¹¦ï¼Œæœªå®šä¹‰è¯¥å¦‚ä½•ç¼–ç ã€‚ å°† ASN.1 ç»“æ„ç¼–ç å­˜å‚¨çš„æ ¼å¼æœ‰ DERï¼šä¸€ç§äºŒè¿›åˆ¶ç¼–ç æ ¼å¼ PEMï¼šDER æ˜¯äºŒè¿›åˆ¶æ ¼å¼ï¼Œä¸ä¾¿äºå¤åˆ¶ç²˜è´´ï¼Œå› æ­¤å‡ºç°äº† PEMï¼Œå®ƒæ˜¯ä¸€ä¸ªæ–‡æœ¬ç¼–ç æ ¼å¼ï¼ˆå…¶å®å°±æ˜¯æŠŠ DER ç¼–ç åçš„æ•°æ®å† Base64 ç¼–ç ä¸‹â€¦ï¼‰ æŸäº›åœºæ™¯ä¸‹ï¼ŒX.509 ä¿¡æ¯ä¸å¤Ÿä¸°å¯Œï¼Œå› æ­¤åˆè®¾è®¡äº†ä¸€äº›ä¿¡æ¯æ›´ä¸°å¯Œï¼ˆä¾‹å¦‚å¯ä»¥åŒ…å«è¯ä¹¦é“¾ã€å…¬ç§é’¥å¯¹ï¼‰çš„è¯ä¹¦å°è£…æ ¼å¼ï¼ŒåŒ…æ‹¬ PKCS #7 å’Œ PKCS #12 ä»ç„¶ç”¨ ASN.1 æ ¼å¼æè¿° åŸºæœ¬éƒ½æ˜¯ç”¨ DER ç¼–ç  ä¸‹é¢è¯¦ç»†ä»‹ç»ä¸‹è¿™äº›ç›¸å…³çš„æ ‡å‡†ä¸æ ¼å¼ã€‚ ç¼–ç å­˜å‚¨æ ¼å¼ DER ä¸ PEMDER æ˜¯ç”±å›½é™…ç”µä¿¡è”ç›Ÿï¼ˆITUï¼‰åœ¨ ITU-T X.690æ ‡å‡†ä¸­å®šä¹‰çš„ä¸€ç§æ•°æ®ç¼–ç è§„åˆ™ï¼Œç”¨äºå°† ASN.1 ç»“æ„çš„ä¿¡æ¯ç¼–ç ä¸ºäºŒè¿›åˆ¶æ•°æ®ã€‚ç›´æ¥ä»¥ DER æ ¼å¼å­˜å‚¨çš„è¯ä¹¦ï¼Œå¤§éƒ½ä½¿ç”¨ .cer .crt .der æ‹“å±•åï¼Œåœ¨ Windows ç³»ç»Ÿæ¯”è¾ƒå¸¸è§ã€‚ è€Œ PEM æ ¼å¼ï¼Œå³ Privacy-Enhanced Mailï¼Œæ˜¯ openssl é»˜è®¤ä½¿ç”¨çš„è¯ä¹¦æ ¼å¼ã€‚å¯ç”¨äºç¼–ç å…¬é’¥ã€ç§é’¥ã€å…¬é’¥è¯ä¹¦ç­‰å¤šç§å¯†ç å­¦ä¿¡æ¯ã€‚PEM å…¶å®å°±æ˜¯åœ¨ DER çš„åŸºç¡€ä¸Šå¤šåšä¸€æ­¥â€”â€”ä½¿ç”¨ Base64 å°† DER ç¼–ç å‡ºçš„äºŒè¿›åˆ¶æ•°æ®å†å¤„ç†ä¸€æ¬¡ï¼Œç¼–ç æˆå­—ç¬¦ä¸²å†å­˜å‚¨ã€‚å¥½å¤„æ˜¯å­˜å‚¨ã€ä¼ è¾“è¦æ–¹ä¾¿å¾ˆå¤šï¼Œå¯ä»¥ç›´æ¥å¤åˆ¶ç²˜è´´ã€‚ ä¸€ä¸ª 2048 ä½ RSA å…¬é’¥çš„ PEM æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š pem -----BEGIN PUBLIC KEY----- MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAyl6q6BkEcEUi9V1/Q7il bngnh1YzG1tM4Hd6XCZQ35OzDN4my9eXWtjoL8YvLYqlYTJqhTHpuptgjF/lmlhg WIMKNNcuDAbvmWExRyZateVrjO9OtgkyJCuGhaum0TIUC+dbZ9L9xsdK/fU1L5BB nPRSYMloH8uE1CbK/DhFUiKp36aHZFfqLPicY3c6/N+k2kIJCEWBY0SROqpqy2Iz yCIP54JSoOoGz6pdtWhd5cEeicr9e7f/WixEES6fgavqIHzhSJBVctpMgFPjFZ/x JJhQVf23WKb3YQQ/0Uc8O7OTDXoUfuJP9UgqvKNh4hPfJA+a4nxkDYhTPfrLHfKY YwIDAQAB -----END PUBLIC KEY----- PEM æ ¼å¼çš„æ•°æ®é€šå¸¸ä»¥ .pem .key .crt .cer ç­‰æ‹“å±•åå­˜å‚¨ï¼Œç›´æ¥ cat ä¸€ä¸‹æ˜¯ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œå°±èƒ½ç¡®è®¤è¯¥æ–‡ä»¶æ˜¯å¦æ˜¯ PEM æ ¼å¼äº†ã€‚ å› ä¸ºçº¯æ–‡æœ¬æ ¼å¼å¤„ç†èµ·æ¥å¾ˆæ–¹ä¾¿ï¼Œå¤§éƒ¨åˆ†åœºæ™¯ä¸‹è¯ä¹¦ã€å…¬é’¥ã€ç§é’¥ç­‰ä¿¡æ¯éƒ½ä¼šè¢«ç¼–ç æˆ PEM æ ¼å¼å†è¿›è¡Œå­˜å‚¨ã€ä¼ è¾“ã€‚ openssl é»˜è®¤ä½¿ç”¨çš„è¾“å…¥è¾“å‡ºå‡ PEM æ ¼å¼ã€‚ PKCS#1PKCS#1 æ˜¯ä¸“ç”¨äºç¼–ç  RSA å…¬ç§é’¥çš„æ ‡å‡†ï¼Œé€šå¸¸è¢«ç¼–ç ä¸º PEM æ ¼å¼å­˜å‚¨ã€‚openssl ç”Ÿæˆçš„ RSA å¯†é’¥å¯¹é»˜è®¤ä½¿ç”¨æ­¤æ ¼å¼ã€‚ è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒé™ˆæ—§çš„æ ¼å¼ï¼Œopenssl ä¹‹æ‰€ä»¥é»˜è®¤ä½¿ç”¨å®ƒï¼Œä¸»è¦æ˜¯ä¸ºäº†å…¼å®¹æ€§ã€‚é€šå¸¸å»ºè®®ä½¿ç”¨æ›´å®‰å…¨çš„ PKCS#8 è€Œä¸æ˜¯è¿™ä¸ªã€‚ ä¸€ä¸ªä½¿ç”¨ PKCS#1 æ ‡å‡†çš„ 2048 ä½ RSA å…¬é’¥æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š pem -----BEGIN PUBLIC KEY----- MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAyl6q6BkEcEUi9V1/Q7il bngnh1YzG1tM4Hd6XCZQ35OzDN4my9eXWtjoL8YvLYqlYTJqhTHpuptgjF/lmlhg WIMKNNcuDAbvmWExRyZateVrjO9OtgkyJCuGhaum0TIUC+dbZ9L9xsdK/fU1L5BB nPRSYMloH8uE1CbK/DhFUiKp36aHZFfqLPicY3c6/N+k2kIJCEWBY0SROqpqy2Iz yCIP54JSoOoGz6pdtWhd5cEeicr9e7f/WixEES6fgavqIHzhSJBVctpMgFPjFZ/x JJhQVf23WKb3YQQ/0Uc8O7OTDXoUfuJP9UgqvKNh4hPfJA+a4nxkDYhTPfrLHfKY YwIDAQAB -----END PUBLIC KEY----- PKCS#7 / CMS å¤´ç–¼â€¦ä¸ºä»€ä¹ˆè¿™ä¹ˆå¤šäº”èŠ±å…«é—¨çš„æ ¼å¼â€¦ PKCS#7/CMSï¼Œæ˜¯ä¸€ä¸ªå¤šç”¨é€”çš„è¯ä¹¦æè¿°æ ¼å¼ã€‚å®ƒåŒ…å«ä¸€ä¸ªæ•°æ®å¡«å……è§„åˆ™ï¼Œè¿™ä¸ªå¡«å……è§„åˆ™å¸¸è¢«ç”¨åœ¨éœ€è¦æ•°æ®å¡«å……çš„åˆ†ç»„åŠ å¯†ã€æ•°å­—ç­¾åç­‰ç®—æ³•ä¸­ã€‚ å¦å¤–æ®è¯´ PKCS#7 ä¹Ÿå¯ä»¥è¢«ç”¨æ¥æè¿°è¯ä¹¦ï¼Œå¹¶ä»¥ DER/PEM æ ¼å¼ä¿å­˜ï¼Œåç¼€é€šå¸¸ä½¿ç”¨ .p7b æˆ–è€….p7c, è¿™ä¸ªæš‚æ—¶å­˜ç–‘å§ï¼Œæœ‰éœ€è¦å†ç ”ç©¶äº†ã€‚ PKCS#8PKCS#8 æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºç¼–ç ç§é’¥çš„æ ‡å‡†ï¼Œå¯ç”¨äºç¼–ç  DSA/RSA/ECC ç§é’¥ã€‚å®ƒé€šå¸¸è¢«ç¼–ç æˆ PEM æ ¼å¼å­˜å‚¨ã€‚ å‰é¢ä»‹ç»äº†ä¸“é—¨ç”¨äºç¼–ç  RSA çš„ PKCS#1 æ ‡å‡†æ¯”è¾ƒé™ˆæ—§ï¼Œè€Œä¸”æ›¾ç»å‡ºè¿‡æ¼æ´ã€‚å› æ­¤é€šå¸¸å»ºè®®ä½¿ç”¨æ›´å®‰å…¨çš„ PKCS#8 æ¥å–ä»£ PKCS#1. C# Java ç­‰ç¼–ç¨‹è¯­è¨€é€šå¸¸è¦æ±‚ä½¿ç”¨æ­¤æ ¼å¼çš„ç§é’¥ï¼Œè€Œ Python çš„pyca/cryptography åˆ™æ”¯æŒå¤šç§ç¼–ç æ ¼å¼ã€‚ ä¸€ä¸ªéåŠ å¯† ECC ç§é’¥çš„ PKCS#8 æ ¼å¼å¦‚ä¸‹ï¼š text -----BEGIN PRIVATE KEY----- MIGHTAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBG0wawIBAQQglQanBRiYVPX7F2Rd 4CqyjEN0K4qfHw4tM/yMIh21wamhRANCAARsxaI4jT1b8zbDlFziuLngPcExbYzz ePAHUmgWL/ZCeqlODF/l/XvimkjaWC2huu1OSWB9EKuG+mKFY2Y5k+vF -----END PRIVATE KEY----- ä¸€ä¸ªåŠ å¯† PKCS#8 ç§é’¥çš„ PEM æ ¼å¼ç§é’¥å¦‚ä¸‹ï¼š text -----BEGIN ENCRYPTED PRIVATE KEY----- Base64 ç¼–ç å†…å®¹ -----END ENCRYPTED PRIVATE KEY----- å¯ä½¿ç”¨å¦‚ä¸‹ openssl å‘½ä»¤å°† RSA/ECC ç§é’¥è½¬æ¢ä¸º PKCS#8 æ ¼å¼ï¼š text # RSA openssl pkcs8 -topk8 -inform PEM -in rsa-private-key.pem -outform PEM -nocrypt -out rsa-private-key-pkcs8.pem # ECC çš„è½¬æ¢å‘½ä»¤ä¸ RSA å®Œå…¨ä¸€è‡´ openssl pkcs8 -topk8 -inform PEM -in ecc-private-key.pem -outform PEM -nocrypt -out ecc-private-key-pkcs8.pem PKCS#12PKCS#12 æ˜¯ä¸€ä¸ªå½’æ¡£æ–‡ä»¶æ ¼å¼ï¼Œç”¨äºå®ç°å­˜å‚¨å¤šä¸ªç§é’¥åŠç›¸å…³çš„ X.509 è¯ä¹¦ã€‚ å› ä¸ºä¿å­˜äº†ç§é’¥ï¼Œä¸ºäº†å®‰å…¨æ€§å®ƒé€šå¸¸æ˜¯åŠ å¯†çš„ï¼Œéœ€è¦ä½¿ç”¨ passphrase è§£å¯†åæ‰èƒ½ä½¿ç”¨ã€‚ PKCS#12 çš„å¸¸ç”¨æ‹“å±•åä¸º .p12 .pfx. PKCS#12 çš„ä¸»è¦ä½¿ç”¨åœºæ™¯æ˜¯å®‰å…¨åœ°ä¿å­˜ã€ä¼ è¾“ç§é’¥åŠç›¸å…³çš„ X.509 è¯ä¹¦ï¼Œæ¯”å¦‚ï¼š å¾®ä¿¡/æ”¯ä»˜å®ç­‰æ”¯ä»˜ç›¸å…³çš„æ•°å­—è¯ä¹¦ï¼Œé€šå¸¸ä½¿ç”¨ PKCS#12 æ ¼å¼å­˜å‚¨ï¼Œä½¿ç”¨å•†æˆ·å·åšåŠ å¯†å¯†ç ï¼Œç„¶åç¼–ç ä¸º base64 å†æä¾›ç»™ç”¨æˆ· å®‰å“çš„ APK ç­¾åè¯ä¹¦é€šå¸¸ä½¿ç”¨ PKCS#12 æ ¼å¼å­˜å‚¨ï¼Œæ‹“å±•åä¸º .keystore æˆ–è€… .jks. PEM æ ¼å¼è½¬ PKCS#12ï¼ˆå…¬é’¥å’Œç§é’¥éƒ½æ”¾é‡Œé¢ï¼‰: shell # openssl pkcs12 -export -in client.crt -inkey client.key -out client.p12 # æŒ‰æç¤ºè¾“å…¥ä¿æŠ¤å¯†ç  ä» PKCS#12 ä¸­åˆ†åˆ«æå–å‡º PEM æ ¼å¼çš„å…¬é’¥ä¸ç§é’¥: shell openssl pkcs12 -in xxx.p12 -out xxx.crt -clcerts -nokeys openssl pkcs12 -in xxx.p12 -out xxx.key -nocerts -nodes ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:3:3","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#3-è¯ä¹¦çš„å­˜å‚¨æ ¼å¼ä¸ç¼–ç æ ‡å‡†"},{"categories":["tech"],"content":" 3. è¯ä¹¦çš„å­˜å‚¨æ ¼å¼ä¸ç¼–ç æ ‡å‡† è¯ä¹¦çš„æ ¼å¼è¿™ä¸€å—ï¼Œæ˜¯çœŸçš„äº”èŠ±å…«é—¨â€¦æ²‰é‡çš„å†å²åŒ…è¢±â€¦ X509 åªè§„å®šäº†è¯ä¹¦åº”è¯¥åŒ…å«å“ªäº›ä¿¡æ¯ï¼Œä½†æ˜¯æœªå®šä¹‰è¯ä¹¦è¯¥å¦‚ä½•å­˜å‚¨ã€‚ä¸ºäº†è§£å†³è¯ä¹¦çš„æè¿°ä¸ç¼–ç å­˜å‚¨é—®é¢˜ï¼Œåˆå‡ºç°äº†å¦‚ä¸‹æ ‡å‡†ï¼š ASN.1 ç»“æ„ï¼šæ˜¯ä¸€ç§æè¿°è¯ä¹¦æ ¼å¼çš„æ–¹æ³•ã€‚ å®ƒç±»ä¼¼ protobuf æ•°æ®æè¿°è¯­è¨€ã€SQL DDL ASN.1 åªè§„å®šäº†è¯¥å¦‚ä½•æè¿°è¯ä¹¦ï¼Œæœªå®šä¹‰è¯¥å¦‚ä½•ç¼–ç ã€‚ å°† ASN.1 ç»“æ„ç¼–ç å­˜å‚¨çš„æ ¼å¼æœ‰ DERï¼šä¸€ç§äºŒè¿›åˆ¶ç¼–ç æ ¼å¼ PEMï¼šDER æ˜¯äºŒè¿›åˆ¶æ ¼å¼ï¼Œä¸ä¾¿äºå¤åˆ¶ç²˜è´´ï¼Œå› æ­¤å‡ºç°äº† PEMï¼Œå®ƒæ˜¯ä¸€ä¸ªæ–‡æœ¬ç¼–ç æ ¼å¼ï¼ˆå…¶å®å°±æ˜¯æŠŠ DER ç¼–ç åçš„æ•°æ®å† Base64 ç¼–ç ä¸‹â€¦ï¼‰ æŸäº›åœºæ™¯ä¸‹ï¼ŒX.509 ä¿¡æ¯ä¸å¤Ÿä¸°å¯Œï¼Œå› æ­¤åˆè®¾è®¡äº†ä¸€äº›ä¿¡æ¯æ›´ä¸°å¯Œï¼ˆä¾‹å¦‚å¯ä»¥åŒ…å«è¯ä¹¦é“¾ã€å…¬ç§é’¥å¯¹ï¼‰çš„è¯ä¹¦å°è£…æ ¼å¼ï¼ŒåŒ…æ‹¬ PKCS #7 å’Œ PKCS #12 ä»ç„¶ç”¨ ASN.1 æ ¼å¼æè¿° åŸºæœ¬éƒ½æ˜¯ç”¨ DER ç¼–ç  ä¸‹é¢è¯¦ç»†ä»‹ç»ä¸‹è¿™äº›ç›¸å…³çš„æ ‡å‡†ä¸æ ¼å¼ã€‚ ç¼–ç å­˜å‚¨æ ¼å¼ DER ä¸ PEMDER æ˜¯ç”±å›½é™…ç”µä¿¡è”ç›Ÿï¼ˆITUï¼‰åœ¨ ITU-T X.690æ ‡å‡†ä¸­å®šä¹‰çš„ä¸€ç§æ•°æ®ç¼–ç è§„åˆ™ï¼Œç”¨äºå°† ASN.1 ç»“æ„çš„ä¿¡æ¯ç¼–ç ä¸ºäºŒè¿›åˆ¶æ•°æ®ã€‚ç›´æ¥ä»¥ DER æ ¼å¼å­˜å‚¨çš„è¯ä¹¦ï¼Œå¤§éƒ½ä½¿ç”¨ .cer .crt .der æ‹“å±•åï¼Œåœ¨ Windows ç³»ç»Ÿæ¯”è¾ƒå¸¸è§ã€‚ è€Œ PEM æ ¼å¼ï¼Œå³ Privacy-Enhanced Mailï¼Œæ˜¯ openssl é»˜è®¤ä½¿ç”¨çš„è¯ä¹¦æ ¼å¼ã€‚å¯ç”¨äºç¼–ç å…¬é’¥ã€ç§é’¥ã€å…¬é’¥è¯ä¹¦ç­‰å¤šç§å¯†ç å­¦ä¿¡æ¯ã€‚PEM å…¶å®å°±æ˜¯åœ¨ DER çš„åŸºç¡€ä¸Šå¤šåšä¸€æ­¥â€”â€”ä½¿ç”¨ Base64 å°† DER ç¼–ç å‡ºçš„äºŒè¿›åˆ¶æ•°æ®å†å¤„ç†ä¸€æ¬¡ï¼Œç¼–ç æˆå­—ç¬¦ä¸²å†å­˜å‚¨ã€‚å¥½å¤„æ˜¯å­˜å‚¨ã€ä¼ è¾“è¦æ–¹ä¾¿å¾ˆå¤šï¼Œå¯ä»¥ç›´æ¥å¤åˆ¶ç²˜è´´ã€‚ ä¸€ä¸ª 2048 ä½ RSA å…¬é’¥çš„ PEM æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š pem -----BEGIN PUBLIC KEY----- MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAyl6q6BkEcEUi9V1/Q7il bngnh1YzG1tM4Hd6XCZQ35OzDN4my9eXWtjoL8YvLYqlYTJqhTHpuptgjF/lmlhg WIMKNNcuDAbvmWExRyZateVrjO9OtgkyJCuGhaum0TIUC+dbZ9L9xsdK/fU1L5BB nPRSYMloH8uE1CbK/DhFUiKp36aHZFfqLPicY3c6/N+k2kIJCEWBY0SROqpqy2Iz yCIP54JSoOoGz6pdtWhd5cEeicr9e7f/WixEES6fgavqIHzhSJBVctpMgFPjFZ/x JJhQVf23WKb3YQQ/0Uc8O7OTDXoUfuJP9UgqvKNh4hPfJA+a4nxkDYhTPfrLHfKY YwIDAQAB -----END PUBLIC KEY----- PEM æ ¼å¼çš„æ•°æ®é€šå¸¸ä»¥ .pem .key .crt .cer ç­‰æ‹“å±•åå­˜å‚¨ï¼Œç›´æ¥ cat ä¸€ä¸‹æ˜¯ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œå°±èƒ½ç¡®è®¤è¯¥æ–‡ä»¶æ˜¯å¦æ˜¯ PEM æ ¼å¼äº†ã€‚ å› ä¸ºçº¯æ–‡æœ¬æ ¼å¼å¤„ç†èµ·æ¥å¾ˆæ–¹ä¾¿ï¼Œå¤§éƒ¨åˆ†åœºæ™¯ä¸‹è¯ä¹¦ã€å…¬é’¥ã€ç§é’¥ç­‰ä¿¡æ¯éƒ½ä¼šè¢«ç¼–ç æˆ PEM æ ¼å¼å†è¿›è¡Œå­˜å‚¨ã€ä¼ è¾“ã€‚ openssl é»˜è®¤ä½¿ç”¨çš„è¾“å…¥è¾“å‡ºå‡ PEM æ ¼å¼ã€‚ PKCS#1PKCS#1 æ˜¯ä¸“ç”¨äºç¼–ç  RSA å…¬ç§é’¥çš„æ ‡å‡†ï¼Œé€šå¸¸è¢«ç¼–ç ä¸º PEM æ ¼å¼å­˜å‚¨ã€‚openssl ç”Ÿæˆçš„ RSA å¯†é’¥å¯¹é»˜è®¤ä½¿ç”¨æ­¤æ ¼å¼ã€‚ è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒé™ˆæ—§çš„æ ¼å¼ï¼Œopenssl ä¹‹æ‰€ä»¥é»˜è®¤ä½¿ç”¨å®ƒï¼Œä¸»è¦æ˜¯ä¸ºäº†å…¼å®¹æ€§ã€‚é€šå¸¸å»ºè®®ä½¿ç”¨æ›´å®‰å…¨çš„ PKCS#8 è€Œä¸æ˜¯è¿™ä¸ªã€‚ ä¸€ä¸ªä½¿ç”¨ PKCS#1 æ ‡å‡†çš„ 2048 ä½ RSA å…¬é’¥æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š pem -----BEGIN PUBLIC KEY----- MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAyl6q6BkEcEUi9V1/Q7il bngnh1YzG1tM4Hd6XCZQ35OzDN4my9eXWtjoL8YvLYqlYTJqhTHpuptgjF/lmlhg WIMKNNcuDAbvmWExRyZateVrjO9OtgkyJCuGhaum0TIUC+dbZ9L9xsdK/fU1L5BB nPRSYMloH8uE1CbK/DhFUiKp36aHZFfqLPicY3c6/N+k2kIJCEWBY0SROqpqy2Iz yCIP54JSoOoGz6pdtWhd5cEeicr9e7f/WixEES6fgavqIHzhSJBVctpMgFPjFZ/x JJhQVf23WKb3YQQ/0Uc8O7OTDXoUfuJP9UgqvKNh4hPfJA+a4nxkDYhTPfrLHfKY YwIDAQAB -----END PUBLIC KEY----- PKCS#7 / CMS å¤´ç–¼â€¦ä¸ºä»€ä¹ˆè¿™ä¹ˆå¤šäº”èŠ±å…«é—¨çš„æ ¼å¼â€¦ PKCS#7/CMSï¼Œæ˜¯ä¸€ä¸ªå¤šç”¨é€”çš„è¯ä¹¦æè¿°æ ¼å¼ã€‚å®ƒåŒ…å«ä¸€ä¸ªæ•°æ®å¡«å……è§„åˆ™ï¼Œè¿™ä¸ªå¡«å……è§„åˆ™å¸¸è¢«ç”¨åœ¨éœ€è¦æ•°æ®å¡«å……çš„åˆ†ç»„åŠ å¯†ã€æ•°å­—ç­¾åç­‰ç®—æ³•ä¸­ã€‚ å¦å¤–æ®è¯´ PKCS#7 ä¹Ÿå¯ä»¥è¢«ç”¨æ¥æè¿°è¯ä¹¦ï¼Œå¹¶ä»¥ DER/PEM æ ¼å¼ä¿å­˜ï¼Œåç¼€é€šå¸¸ä½¿ç”¨ .p7b æˆ–è€….p7c, è¿™ä¸ªæš‚æ—¶å­˜ç–‘å§ï¼Œæœ‰éœ€è¦å†ç ”ç©¶äº†ã€‚ PKCS#8PKCS#8 æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºç¼–ç ç§é’¥çš„æ ‡å‡†ï¼Œå¯ç”¨äºç¼–ç  DSA/RSA/ECC ç§é’¥ã€‚å®ƒé€šå¸¸è¢«ç¼–ç æˆ PEM æ ¼å¼å­˜å‚¨ã€‚ å‰é¢ä»‹ç»äº†ä¸“é—¨ç”¨äºç¼–ç  RSA çš„ PKCS#1 æ ‡å‡†æ¯”è¾ƒé™ˆæ—§ï¼Œè€Œä¸”æ›¾ç»å‡ºè¿‡æ¼æ´ã€‚å› æ­¤é€šå¸¸å»ºè®®ä½¿ç”¨æ›´å®‰å…¨çš„ PKCS#8 æ¥å–ä»£ PKCS#1. C# Java ç­‰ç¼–ç¨‹è¯­è¨€é€šå¸¸è¦æ±‚ä½¿ç”¨æ­¤æ ¼å¼çš„ç§é’¥ï¼Œè€Œ Python çš„pyca/cryptography åˆ™æ”¯æŒå¤šç§ç¼–ç æ ¼å¼ã€‚ ä¸€ä¸ªéåŠ å¯† ECC ç§é’¥çš„ PKCS#8 æ ¼å¼å¦‚ä¸‹ï¼š text -----BEGIN PRIVATE KEY----- MIGHTAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBG0wawIBAQQglQanBRiYVPX7F2Rd 4CqyjEN0K4qfHw4tM/yMIh21wamhRANCAARsxaI4jT1b8zbDlFziuLngPcExbYzz ePAHUmgWL/ZCeqlODF/l/XvimkjaWC2huu1OSWB9EKuG+mKFY2Y5k+vF -----END PRIVATE KEY----- ä¸€ä¸ªåŠ å¯† PKCS#8 ç§é’¥çš„ PEM æ ¼å¼ç§é’¥å¦‚ä¸‹ï¼š text -----BEGIN ENCRYPTED PRIVATE KEY----- Base64 ç¼–ç å†…å®¹ -----END ENCRYPTED PRIVATE KEY----- å¯ä½¿ç”¨å¦‚ä¸‹ openssl å‘½ä»¤å°† RSA/ECC ç§é’¥è½¬æ¢ä¸º PKCS#8 æ ¼å¼ï¼š text # RSA openssl pkcs8 -topk8 -inform PEM -in rsa-private-key.pem -outform PEM -nocrypt -out rsa-private-key-pkcs8.pem # ECC çš„è½¬æ¢å‘½ä»¤ä¸ RSA å®Œå…¨ä¸€è‡´ openssl pkcs8 -topk8 -inform PEM -in ecc-private-key.pem -outform PEM -nocrypt -out ecc-private-key-pkcs8.pem PKCS#12PKCS#12 æ˜¯ä¸€ä¸ªå½’æ¡£æ–‡ä»¶æ ¼å¼ï¼Œç”¨äºå®ç°å­˜å‚¨å¤šä¸ªç§é’¥åŠç›¸å…³çš„ X.509 è¯ä¹¦ã€‚ å› ä¸ºä¿å­˜äº†ç§é’¥ï¼Œä¸ºäº†å®‰å…¨æ€§å®ƒé€šå¸¸æ˜¯åŠ å¯†çš„ï¼Œéœ€è¦ä½¿ç”¨ passphrase è§£å¯†åæ‰èƒ½ä½¿ç”¨ã€‚ PKCS#12 çš„å¸¸ç”¨æ‹“å±•åä¸º .p12 .pfx. PKCS#12 çš„ä¸»è¦ä½¿ç”¨åœºæ™¯æ˜¯å®‰å…¨åœ°ä¿å­˜ã€ä¼ è¾“ç§é’¥åŠç›¸å…³çš„ X.509 è¯ä¹¦ï¼Œæ¯”å¦‚ï¼š å¾®ä¿¡/æ”¯ä»˜å®ç­‰æ”¯ä»˜ç›¸å…³çš„æ•°å­—è¯ä¹¦ï¼Œé€šå¸¸ä½¿ç”¨ PKCS#12 æ ¼å¼å­˜å‚¨ï¼Œä½¿ç”¨å•†æˆ·å·åšåŠ å¯†å¯†ç ï¼Œç„¶åç¼–ç ä¸º base64 å†æä¾›ç»™ç”¨æˆ· å®‰å“çš„ APK ç­¾åè¯ä¹¦é€šå¸¸ä½¿ç”¨ PKCS#12 æ ¼å¼å­˜å‚¨ï¼Œæ‹“å±•åä¸º .keystore æˆ–è€… .jks. PEM æ ¼å¼è½¬ PKCS#12ï¼ˆå…¬é’¥å’Œç§é’¥éƒ½æ”¾é‡Œé¢ï¼‰: shell # openssl pkcs12 -export -in client.crt -inkey client.key -out client.p12 # æŒ‰æç¤ºè¾“å…¥ä¿æŠ¤å¯†ç  ä» PKCS#12 ä¸­åˆ†åˆ«æå–å‡º PEM æ ¼å¼çš„å…¬é’¥ä¸ç§é’¥: shell openssl pkcs12 -in xxx.p12 -out xxx.crt -clcerts -nokeys openssl pkcs12 -in xxx.p12 -out xxx.key -nocerts -nodes ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:3:3","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#ç¼–ç å­˜å‚¨æ ¼å¼-der-ä¸-pem"},{"categories":["tech"],"content":" 3. è¯ä¹¦çš„å­˜å‚¨æ ¼å¼ä¸ç¼–ç æ ‡å‡† è¯ä¹¦çš„æ ¼å¼è¿™ä¸€å—ï¼Œæ˜¯çœŸçš„äº”èŠ±å…«é—¨â€¦æ²‰é‡çš„å†å²åŒ…è¢±â€¦ X509 åªè§„å®šäº†è¯ä¹¦åº”è¯¥åŒ…å«å“ªäº›ä¿¡æ¯ï¼Œä½†æ˜¯æœªå®šä¹‰è¯ä¹¦è¯¥å¦‚ä½•å­˜å‚¨ã€‚ä¸ºäº†è§£å†³è¯ä¹¦çš„æè¿°ä¸ç¼–ç å­˜å‚¨é—®é¢˜ï¼Œåˆå‡ºç°äº†å¦‚ä¸‹æ ‡å‡†ï¼š ASN.1 ç»“æ„ï¼šæ˜¯ä¸€ç§æè¿°è¯ä¹¦æ ¼å¼çš„æ–¹æ³•ã€‚ å®ƒç±»ä¼¼ protobuf æ•°æ®æè¿°è¯­è¨€ã€SQL DDL ASN.1 åªè§„å®šäº†è¯¥å¦‚ä½•æè¿°è¯ä¹¦ï¼Œæœªå®šä¹‰è¯¥å¦‚ä½•ç¼–ç ã€‚ å°† ASN.1 ç»“æ„ç¼–ç å­˜å‚¨çš„æ ¼å¼æœ‰ DERï¼šä¸€ç§äºŒè¿›åˆ¶ç¼–ç æ ¼å¼ PEMï¼šDER æ˜¯äºŒè¿›åˆ¶æ ¼å¼ï¼Œä¸ä¾¿äºå¤åˆ¶ç²˜è´´ï¼Œå› æ­¤å‡ºç°äº† PEMï¼Œå®ƒæ˜¯ä¸€ä¸ªæ–‡æœ¬ç¼–ç æ ¼å¼ï¼ˆå…¶å®å°±æ˜¯æŠŠ DER ç¼–ç åçš„æ•°æ®å† Base64 ç¼–ç ä¸‹â€¦ï¼‰ æŸäº›åœºæ™¯ä¸‹ï¼ŒX.509 ä¿¡æ¯ä¸å¤Ÿä¸°å¯Œï¼Œå› æ­¤åˆè®¾è®¡äº†ä¸€äº›ä¿¡æ¯æ›´ä¸°å¯Œï¼ˆä¾‹å¦‚å¯ä»¥åŒ…å«è¯ä¹¦é“¾ã€å…¬ç§é’¥å¯¹ï¼‰çš„è¯ä¹¦å°è£…æ ¼å¼ï¼ŒåŒ…æ‹¬ PKCS #7 å’Œ PKCS #12 ä»ç„¶ç”¨ ASN.1 æ ¼å¼æè¿° åŸºæœ¬éƒ½æ˜¯ç”¨ DER ç¼–ç  ä¸‹é¢è¯¦ç»†ä»‹ç»ä¸‹è¿™äº›ç›¸å…³çš„æ ‡å‡†ä¸æ ¼å¼ã€‚ ç¼–ç å­˜å‚¨æ ¼å¼ DER ä¸ PEMDER æ˜¯ç”±å›½é™…ç”µä¿¡è”ç›Ÿï¼ˆITUï¼‰åœ¨ ITU-T X.690æ ‡å‡†ä¸­å®šä¹‰çš„ä¸€ç§æ•°æ®ç¼–ç è§„åˆ™ï¼Œç”¨äºå°† ASN.1 ç»“æ„çš„ä¿¡æ¯ç¼–ç ä¸ºäºŒè¿›åˆ¶æ•°æ®ã€‚ç›´æ¥ä»¥ DER æ ¼å¼å­˜å‚¨çš„è¯ä¹¦ï¼Œå¤§éƒ½ä½¿ç”¨ .cer .crt .der æ‹“å±•åï¼Œåœ¨ Windows ç³»ç»Ÿæ¯”è¾ƒå¸¸è§ã€‚ è€Œ PEM æ ¼å¼ï¼Œå³ Privacy-Enhanced Mailï¼Œæ˜¯ openssl é»˜è®¤ä½¿ç”¨çš„è¯ä¹¦æ ¼å¼ã€‚å¯ç”¨äºç¼–ç å…¬é’¥ã€ç§é’¥ã€å…¬é’¥è¯ä¹¦ç­‰å¤šç§å¯†ç å­¦ä¿¡æ¯ã€‚PEM å…¶å®å°±æ˜¯åœ¨ DER çš„åŸºç¡€ä¸Šå¤šåšä¸€æ­¥â€”â€”ä½¿ç”¨ Base64 å°† DER ç¼–ç å‡ºçš„äºŒè¿›åˆ¶æ•°æ®å†å¤„ç†ä¸€æ¬¡ï¼Œç¼–ç æˆå­—ç¬¦ä¸²å†å­˜å‚¨ã€‚å¥½å¤„æ˜¯å­˜å‚¨ã€ä¼ è¾“è¦æ–¹ä¾¿å¾ˆå¤šï¼Œå¯ä»¥ç›´æ¥å¤åˆ¶ç²˜è´´ã€‚ ä¸€ä¸ª 2048 ä½ RSA å…¬é’¥çš„ PEM æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š pem -----BEGIN PUBLIC KEY----- MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAyl6q6BkEcEUi9V1/Q7il bngnh1YzG1tM4Hd6XCZQ35OzDN4my9eXWtjoL8YvLYqlYTJqhTHpuptgjF/lmlhg WIMKNNcuDAbvmWExRyZateVrjO9OtgkyJCuGhaum0TIUC+dbZ9L9xsdK/fU1L5BB nPRSYMloH8uE1CbK/DhFUiKp36aHZFfqLPicY3c6/N+k2kIJCEWBY0SROqpqy2Iz yCIP54JSoOoGz6pdtWhd5cEeicr9e7f/WixEES6fgavqIHzhSJBVctpMgFPjFZ/x JJhQVf23WKb3YQQ/0Uc8O7OTDXoUfuJP9UgqvKNh4hPfJA+a4nxkDYhTPfrLHfKY YwIDAQAB -----END PUBLIC KEY----- PEM æ ¼å¼çš„æ•°æ®é€šå¸¸ä»¥ .pem .key .crt .cer ç­‰æ‹“å±•åå­˜å‚¨ï¼Œç›´æ¥ cat ä¸€ä¸‹æ˜¯ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œå°±èƒ½ç¡®è®¤è¯¥æ–‡ä»¶æ˜¯å¦æ˜¯ PEM æ ¼å¼äº†ã€‚ å› ä¸ºçº¯æ–‡æœ¬æ ¼å¼å¤„ç†èµ·æ¥å¾ˆæ–¹ä¾¿ï¼Œå¤§éƒ¨åˆ†åœºæ™¯ä¸‹è¯ä¹¦ã€å…¬é’¥ã€ç§é’¥ç­‰ä¿¡æ¯éƒ½ä¼šè¢«ç¼–ç æˆ PEM æ ¼å¼å†è¿›è¡Œå­˜å‚¨ã€ä¼ è¾“ã€‚ openssl é»˜è®¤ä½¿ç”¨çš„è¾“å…¥è¾“å‡ºå‡ PEM æ ¼å¼ã€‚ PKCS#1PKCS#1 æ˜¯ä¸“ç”¨äºç¼–ç  RSA å…¬ç§é’¥çš„æ ‡å‡†ï¼Œé€šå¸¸è¢«ç¼–ç ä¸º PEM æ ¼å¼å­˜å‚¨ã€‚openssl ç”Ÿæˆçš„ RSA å¯†é’¥å¯¹é»˜è®¤ä½¿ç”¨æ­¤æ ¼å¼ã€‚ è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒé™ˆæ—§çš„æ ¼å¼ï¼Œopenssl ä¹‹æ‰€ä»¥é»˜è®¤ä½¿ç”¨å®ƒï¼Œä¸»è¦æ˜¯ä¸ºäº†å…¼å®¹æ€§ã€‚é€šå¸¸å»ºè®®ä½¿ç”¨æ›´å®‰å…¨çš„ PKCS#8 è€Œä¸æ˜¯è¿™ä¸ªã€‚ ä¸€ä¸ªä½¿ç”¨ PKCS#1 æ ‡å‡†çš„ 2048 ä½ RSA å…¬é’¥æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š pem -----BEGIN PUBLIC KEY----- MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAyl6q6BkEcEUi9V1/Q7il bngnh1YzG1tM4Hd6XCZQ35OzDN4my9eXWtjoL8YvLYqlYTJqhTHpuptgjF/lmlhg WIMKNNcuDAbvmWExRyZateVrjO9OtgkyJCuGhaum0TIUC+dbZ9L9xsdK/fU1L5BB nPRSYMloH8uE1CbK/DhFUiKp36aHZFfqLPicY3c6/N+k2kIJCEWBY0SROqpqy2Iz yCIP54JSoOoGz6pdtWhd5cEeicr9e7f/WixEES6fgavqIHzhSJBVctpMgFPjFZ/x JJhQVf23WKb3YQQ/0Uc8O7OTDXoUfuJP9UgqvKNh4hPfJA+a4nxkDYhTPfrLHfKY YwIDAQAB -----END PUBLIC KEY----- PKCS#7 / CMS å¤´ç–¼â€¦ä¸ºä»€ä¹ˆè¿™ä¹ˆå¤šäº”èŠ±å…«é—¨çš„æ ¼å¼â€¦ PKCS#7/CMSï¼Œæ˜¯ä¸€ä¸ªå¤šç”¨é€”çš„è¯ä¹¦æè¿°æ ¼å¼ã€‚å®ƒåŒ…å«ä¸€ä¸ªæ•°æ®å¡«å……è§„åˆ™ï¼Œè¿™ä¸ªå¡«å……è§„åˆ™å¸¸è¢«ç”¨åœ¨éœ€è¦æ•°æ®å¡«å……çš„åˆ†ç»„åŠ å¯†ã€æ•°å­—ç­¾åç­‰ç®—æ³•ä¸­ã€‚ å¦å¤–æ®è¯´ PKCS#7 ä¹Ÿå¯ä»¥è¢«ç”¨æ¥æè¿°è¯ä¹¦ï¼Œå¹¶ä»¥ DER/PEM æ ¼å¼ä¿å­˜ï¼Œåç¼€é€šå¸¸ä½¿ç”¨ .p7b æˆ–è€….p7c, è¿™ä¸ªæš‚æ—¶å­˜ç–‘å§ï¼Œæœ‰éœ€è¦å†ç ”ç©¶äº†ã€‚ PKCS#8PKCS#8 æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºç¼–ç ç§é’¥çš„æ ‡å‡†ï¼Œå¯ç”¨äºç¼–ç  DSA/RSA/ECC ç§é’¥ã€‚å®ƒé€šå¸¸è¢«ç¼–ç æˆ PEM æ ¼å¼å­˜å‚¨ã€‚ å‰é¢ä»‹ç»äº†ä¸“é—¨ç”¨äºç¼–ç  RSA çš„ PKCS#1 æ ‡å‡†æ¯”è¾ƒé™ˆæ—§ï¼Œè€Œä¸”æ›¾ç»å‡ºè¿‡æ¼æ´ã€‚å› æ­¤é€šå¸¸å»ºè®®ä½¿ç”¨æ›´å®‰å…¨çš„ PKCS#8 æ¥å–ä»£ PKCS#1. C# Java ç­‰ç¼–ç¨‹è¯­è¨€é€šå¸¸è¦æ±‚ä½¿ç”¨æ­¤æ ¼å¼çš„ç§é’¥ï¼Œè€Œ Python çš„pyca/cryptography åˆ™æ”¯æŒå¤šç§ç¼–ç æ ¼å¼ã€‚ ä¸€ä¸ªéåŠ å¯† ECC ç§é’¥çš„ PKCS#8 æ ¼å¼å¦‚ä¸‹ï¼š text -----BEGIN PRIVATE KEY----- MIGHTAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBG0wawIBAQQglQanBRiYVPX7F2Rd 4CqyjEN0K4qfHw4tM/yMIh21wamhRANCAARsxaI4jT1b8zbDlFziuLngPcExbYzz ePAHUmgWL/ZCeqlODF/l/XvimkjaWC2huu1OSWB9EKuG+mKFY2Y5k+vF -----END PRIVATE KEY----- ä¸€ä¸ªåŠ å¯† PKCS#8 ç§é’¥çš„ PEM æ ¼å¼ç§é’¥å¦‚ä¸‹ï¼š text -----BEGIN ENCRYPTED PRIVATE KEY----- Base64 ç¼–ç å†…å®¹ -----END ENCRYPTED PRIVATE KEY----- å¯ä½¿ç”¨å¦‚ä¸‹ openssl å‘½ä»¤å°† RSA/ECC ç§é’¥è½¬æ¢ä¸º PKCS#8 æ ¼å¼ï¼š text # RSA openssl pkcs8 -topk8 -inform PEM -in rsa-private-key.pem -outform PEM -nocrypt -out rsa-private-key-pkcs8.pem # ECC çš„è½¬æ¢å‘½ä»¤ä¸ RSA å®Œå…¨ä¸€è‡´ openssl pkcs8 -topk8 -inform PEM -in ecc-private-key.pem -outform PEM -nocrypt -out ecc-private-key-pkcs8.pem PKCS#12PKCS#12 æ˜¯ä¸€ä¸ªå½’æ¡£æ–‡ä»¶æ ¼å¼ï¼Œç”¨äºå®ç°å­˜å‚¨å¤šä¸ªç§é’¥åŠç›¸å…³çš„ X.509 è¯ä¹¦ã€‚ å› ä¸ºä¿å­˜äº†ç§é’¥ï¼Œä¸ºäº†å®‰å…¨æ€§å®ƒé€šå¸¸æ˜¯åŠ å¯†çš„ï¼Œéœ€è¦ä½¿ç”¨ passphrase è§£å¯†åæ‰èƒ½ä½¿ç”¨ã€‚ PKCS#12 çš„å¸¸ç”¨æ‹“å±•åä¸º .p12 .pfx. PKCS#12 çš„ä¸»è¦ä½¿ç”¨åœºæ™¯æ˜¯å®‰å…¨åœ°ä¿å­˜ã€ä¼ è¾“ç§é’¥åŠç›¸å…³çš„ X.509 è¯ä¹¦ï¼Œæ¯”å¦‚ï¼š å¾®ä¿¡/æ”¯ä»˜å®ç­‰æ”¯ä»˜ç›¸å…³çš„æ•°å­—è¯ä¹¦ï¼Œé€šå¸¸ä½¿ç”¨ PKCS#12 æ ¼å¼å­˜å‚¨ï¼Œä½¿ç”¨å•†æˆ·å·åšåŠ å¯†å¯†ç ï¼Œç„¶åç¼–ç ä¸º base64 å†æä¾›ç»™ç”¨æˆ· å®‰å“çš„ APK ç­¾åè¯ä¹¦é€šå¸¸ä½¿ç”¨ PKCS#12 æ ¼å¼å­˜å‚¨ï¼Œæ‹“å±•åä¸º .keystore æˆ–è€… .jks. PEM æ ¼å¼è½¬ PKCS#12ï¼ˆå…¬é’¥å’Œç§é’¥éƒ½æ”¾é‡Œé¢ï¼‰: shell # openssl pkcs12 -export -in client.crt -inkey client.key -out client.p12 # æŒ‰æç¤ºè¾“å…¥ä¿æŠ¤å¯†ç  ä» PKCS#12 ä¸­åˆ†åˆ«æå–å‡º PEM æ ¼å¼çš„å…¬é’¥ä¸ç§é’¥: shell openssl pkcs12 -in xxx.p12 -out xxx.crt -clcerts -nokeys openssl pkcs12 -in xxx.p12 -out xxx.key -nocerts -nodes ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:3:3","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#pkcs1"},{"categories":["tech"],"content":" 3. è¯ä¹¦çš„å­˜å‚¨æ ¼å¼ä¸ç¼–ç æ ‡å‡† è¯ä¹¦çš„æ ¼å¼è¿™ä¸€å—ï¼Œæ˜¯çœŸçš„äº”èŠ±å…«é—¨â€¦æ²‰é‡çš„å†å²åŒ…è¢±â€¦ X509 åªè§„å®šäº†è¯ä¹¦åº”è¯¥åŒ…å«å“ªäº›ä¿¡æ¯ï¼Œä½†æ˜¯æœªå®šä¹‰è¯ä¹¦è¯¥å¦‚ä½•å­˜å‚¨ã€‚ä¸ºäº†è§£å†³è¯ä¹¦çš„æè¿°ä¸ç¼–ç å­˜å‚¨é—®é¢˜ï¼Œåˆå‡ºç°äº†å¦‚ä¸‹æ ‡å‡†ï¼š ASN.1 ç»“æ„ï¼šæ˜¯ä¸€ç§æè¿°è¯ä¹¦æ ¼å¼çš„æ–¹æ³•ã€‚ å®ƒç±»ä¼¼ protobuf æ•°æ®æè¿°è¯­è¨€ã€SQL DDL ASN.1 åªè§„å®šäº†è¯¥å¦‚ä½•æè¿°è¯ä¹¦ï¼Œæœªå®šä¹‰è¯¥å¦‚ä½•ç¼–ç ã€‚ å°† ASN.1 ç»“æ„ç¼–ç å­˜å‚¨çš„æ ¼å¼æœ‰ DERï¼šä¸€ç§äºŒè¿›åˆ¶ç¼–ç æ ¼å¼ PEMï¼šDER æ˜¯äºŒè¿›åˆ¶æ ¼å¼ï¼Œä¸ä¾¿äºå¤åˆ¶ç²˜è´´ï¼Œå› æ­¤å‡ºç°äº† PEMï¼Œå®ƒæ˜¯ä¸€ä¸ªæ–‡æœ¬ç¼–ç æ ¼å¼ï¼ˆå…¶å®å°±æ˜¯æŠŠ DER ç¼–ç åçš„æ•°æ®å† Base64 ç¼–ç ä¸‹â€¦ï¼‰ æŸäº›åœºæ™¯ä¸‹ï¼ŒX.509 ä¿¡æ¯ä¸å¤Ÿä¸°å¯Œï¼Œå› æ­¤åˆè®¾è®¡äº†ä¸€äº›ä¿¡æ¯æ›´ä¸°å¯Œï¼ˆä¾‹å¦‚å¯ä»¥åŒ…å«è¯ä¹¦é“¾ã€å…¬ç§é’¥å¯¹ï¼‰çš„è¯ä¹¦å°è£…æ ¼å¼ï¼ŒåŒ…æ‹¬ PKCS #7 å’Œ PKCS #12 ä»ç„¶ç”¨ ASN.1 æ ¼å¼æè¿° åŸºæœ¬éƒ½æ˜¯ç”¨ DER ç¼–ç  ä¸‹é¢è¯¦ç»†ä»‹ç»ä¸‹è¿™äº›ç›¸å…³çš„æ ‡å‡†ä¸æ ¼å¼ã€‚ ç¼–ç å­˜å‚¨æ ¼å¼ DER ä¸ PEMDER æ˜¯ç”±å›½é™…ç”µä¿¡è”ç›Ÿï¼ˆITUï¼‰åœ¨ ITU-T X.690æ ‡å‡†ä¸­å®šä¹‰çš„ä¸€ç§æ•°æ®ç¼–ç è§„åˆ™ï¼Œç”¨äºå°† ASN.1 ç»“æ„çš„ä¿¡æ¯ç¼–ç ä¸ºäºŒè¿›åˆ¶æ•°æ®ã€‚ç›´æ¥ä»¥ DER æ ¼å¼å­˜å‚¨çš„è¯ä¹¦ï¼Œå¤§éƒ½ä½¿ç”¨ .cer .crt .der æ‹“å±•åï¼Œåœ¨ Windows ç³»ç»Ÿæ¯”è¾ƒå¸¸è§ã€‚ è€Œ PEM æ ¼å¼ï¼Œå³ Privacy-Enhanced Mailï¼Œæ˜¯ openssl é»˜è®¤ä½¿ç”¨çš„è¯ä¹¦æ ¼å¼ã€‚å¯ç”¨äºç¼–ç å…¬é’¥ã€ç§é’¥ã€å…¬é’¥è¯ä¹¦ç­‰å¤šç§å¯†ç å­¦ä¿¡æ¯ã€‚PEM å…¶å®å°±æ˜¯åœ¨ DER çš„åŸºç¡€ä¸Šå¤šåšä¸€æ­¥â€”â€”ä½¿ç”¨ Base64 å°† DER ç¼–ç å‡ºçš„äºŒè¿›åˆ¶æ•°æ®å†å¤„ç†ä¸€æ¬¡ï¼Œç¼–ç æˆå­—ç¬¦ä¸²å†å­˜å‚¨ã€‚å¥½å¤„æ˜¯å­˜å‚¨ã€ä¼ è¾“è¦æ–¹ä¾¿å¾ˆå¤šï¼Œå¯ä»¥ç›´æ¥å¤åˆ¶ç²˜è´´ã€‚ ä¸€ä¸ª 2048 ä½ RSA å…¬é’¥çš„ PEM æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š pem -----BEGIN PUBLIC KEY----- MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAyl6q6BkEcEUi9V1/Q7il bngnh1YzG1tM4Hd6XCZQ35OzDN4my9eXWtjoL8YvLYqlYTJqhTHpuptgjF/lmlhg WIMKNNcuDAbvmWExRyZateVrjO9OtgkyJCuGhaum0TIUC+dbZ9L9xsdK/fU1L5BB nPRSYMloH8uE1CbK/DhFUiKp36aHZFfqLPicY3c6/N+k2kIJCEWBY0SROqpqy2Iz yCIP54JSoOoGz6pdtWhd5cEeicr9e7f/WixEES6fgavqIHzhSJBVctpMgFPjFZ/x JJhQVf23WKb3YQQ/0Uc8O7OTDXoUfuJP9UgqvKNh4hPfJA+a4nxkDYhTPfrLHfKY YwIDAQAB -----END PUBLIC KEY----- PEM æ ¼å¼çš„æ•°æ®é€šå¸¸ä»¥ .pem .key .crt .cer ç­‰æ‹“å±•åå­˜å‚¨ï¼Œç›´æ¥ cat ä¸€ä¸‹æ˜¯ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œå°±èƒ½ç¡®è®¤è¯¥æ–‡ä»¶æ˜¯å¦æ˜¯ PEM æ ¼å¼äº†ã€‚ å› ä¸ºçº¯æ–‡æœ¬æ ¼å¼å¤„ç†èµ·æ¥å¾ˆæ–¹ä¾¿ï¼Œå¤§éƒ¨åˆ†åœºæ™¯ä¸‹è¯ä¹¦ã€å…¬é’¥ã€ç§é’¥ç­‰ä¿¡æ¯éƒ½ä¼šè¢«ç¼–ç æˆ PEM æ ¼å¼å†è¿›è¡Œå­˜å‚¨ã€ä¼ è¾“ã€‚ openssl é»˜è®¤ä½¿ç”¨çš„è¾“å…¥è¾“å‡ºå‡ PEM æ ¼å¼ã€‚ PKCS#1PKCS#1 æ˜¯ä¸“ç”¨äºç¼–ç  RSA å…¬ç§é’¥çš„æ ‡å‡†ï¼Œé€šå¸¸è¢«ç¼–ç ä¸º PEM æ ¼å¼å­˜å‚¨ã€‚openssl ç”Ÿæˆçš„ RSA å¯†é’¥å¯¹é»˜è®¤ä½¿ç”¨æ­¤æ ¼å¼ã€‚ è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒé™ˆæ—§çš„æ ¼å¼ï¼Œopenssl ä¹‹æ‰€ä»¥é»˜è®¤ä½¿ç”¨å®ƒï¼Œä¸»è¦æ˜¯ä¸ºäº†å…¼å®¹æ€§ã€‚é€šå¸¸å»ºè®®ä½¿ç”¨æ›´å®‰å…¨çš„ PKCS#8 è€Œä¸æ˜¯è¿™ä¸ªã€‚ ä¸€ä¸ªä½¿ç”¨ PKCS#1 æ ‡å‡†çš„ 2048 ä½ RSA å…¬é’¥æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š pem -----BEGIN PUBLIC KEY----- MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAyl6q6BkEcEUi9V1/Q7il bngnh1YzG1tM4Hd6XCZQ35OzDN4my9eXWtjoL8YvLYqlYTJqhTHpuptgjF/lmlhg WIMKNNcuDAbvmWExRyZateVrjO9OtgkyJCuGhaum0TIUC+dbZ9L9xsdK/fU1L5BB nPRSYMloH8uE1CbK/DhFUiKp36aHZFfqLPicY3c6/N+k2kIJCEWBY0SROqpqy2Iz yCIP54JSoOoGz6pdtWhd5cEeicr9e7f/WixEES6fgavqIHzhSJBVctpMgFPjFZ/x JJhQVf23WKb3YQQ/0Uc8O7OTDXoUfuJP9UgqvKNh4hPfJA+a4nxkDYhTPfrLHfKY YwIDAQAB -----END PUBLIC KEY----- PKCS#7 / CMS å¤´ç–¼â€¦ä¸ºä»€ä¹ˆè¿™ä¹ˆå¤šäº”èŠ±å…«é—¨çš„æ ¼å¼â€¦ PKCS#7/CMSï¼Œæ˜¯ä¸€ä¸ªå¤šç”¨é€”çš„è¯ä¹¦æè¿°æ ¼å¼ã€‚å®ƒåŒ…å«ä¸€ä¸ªæ•°æ®å¡«å……è§„åˆ™ï¼Œè¿™ä¸ªå¡«å……è§„åˆ™å¸¸è¢«ç”¨åœ¨éœ€è¦æ•°æ®å¡«å……çš„åˆ†ç»„åŠ å¯†ã€æ•°å­—ç­¾åç­‰ç®—æ³•ä¸­ã€‚ å¦å¤–æ®è¯´ PKCS#7 ä¹Ÿå¯ä»¥è¢«ç”¨æ¥æè¿°è¯ä¹¦ï¼Œå¹¶ä»¥ DER/PEM æ ¼å¼ä¿å­˜ï¼Œåç¼€é€šå¸¸ä½¿ç”¨ .p7b æˆ–è€….p7c, è¿™ä¸ªæš‚æ—¶å­˜ç–‘å§ï¼Œæœ‰éœ€è¦å†ç ”ç©¶äº†ã€‚ PKCS#8PKCS#8 æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºç¼–ç ç§é’¥çš„æ ‡å‡†ï¼Œå¯ç”¨äºç¼–ç  DSA/RSA/ECC ç§é’¥ã€‚å®ƒé€šå¸¸è¢«ç¼–ç æˆ PEM æ ¼å¼å­˜å‚¨ã€‚ å‰é¢ä»‹ç»äº†ä¸“é—¨ç”¨äºç¼–ç  RSA çš„ PKCS#1 æ ‡å‡†æ¯”è¾ƒé™ˆæ—§ï¼Œè€Œä¸”æ›¾ç»å‡ºè¿‡æ¼æ´ã€‚å› æ­¤é€šå¸¸å»ºè®®ä½¿ç”¨æ›´å®‰å…¨çš„ PKCS#8 æ¥å–ä»£ PKCS#1. C# Java ç­‰ç¼–ç¨‹è¯­è¨€é€šå¸¸è¦æ±‚ä½¿ç”¨æ­¤æ ¼å¼çš„ç§é’¥ï¼Œè€Œ Python çš„pyca/cryptography åˆ™æ”¯æŒå¤šç§ç¼–ç æ ¼å¼ã€‚ ä¸€ä¸ªéåŠ å¯† ECC ç§é’¥çš„ PKCS#8 æ ¼å¼å¦‚ä¸‹ï¼š text -----BEGIN PRIVATE KEY----- MIGHTAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBG0wawIBAQQglQanBRiYVPX7F2Rd 4CqyjEN0K4qfHw4tM/yMIh21wamhRANCAARsxaI4jT1b8zbDlFziuLngPcExbYzz ePAHUmgWL/ZCeqlODF/l/XvimkjaWC2huu1OSWB9EKuG+mKFY2Y5k+vF -----END PRIVATE KEY----- ä¸€ä¸ªåŠ å¯† PKCS#8 ç§é’¥çš„ PEM æ ¼å¼ç§é’¥å¦‚ä¸‹ï¼š text -----BEGIN ENCRYPTED PRIVATE KEY----- Base64 ç¼–ç å†…å®¹ -----END ENCRYPTED PRIVATE KEY----- å¯ä½¿ç”¨å¦‚ä¸‹ openssl å‘½ä»¤å°† RSA/ECC ç§é’¥è½¬æ¢ä¸º PKCS#8 æ ¼å¼ï¼š text # RSA openssl pkcs8 -topk8 -inform PEM -in rsa-private-key.pem -outform PEM -nocrypt -out rsa-private-key-pkcs8.pem # ECC çš„è½¬æ¢å‘½ä»¤ä¸ RSA å®Œå…¨ä¸€è‡´ openssl pkcs8 -topk8 -inform PEM -in ecc-private-key.pem -outform PEM -nocrypt -out ecc-private-key-pkcs8.pem PKCS#12PKCS#12 æ˜¯ä¸€ä¸ªå½’æ¡£æ–‡ä»¶æ ¼å¼ï¼Œç”¨äºå®ç°å­˜å‚¨å¤šä¸ªç§é’¥åŠç›¸å…³çš„ X.509 è¯ä¹¦ã€‚ å› ä¸ºä¿å­˜äº†ç§é’¥ï¼Œä¸ºäº†å®‰å…¨æ€§å®ƒé€šå¸¸æ˜¯åŠ å¯†çš„ï¼Œéœ€è¦ä½¿ç”¨ passphrase è§£å¯†åæ‰èƒ½ä½¿ç”¨ã€‚ PKCS#12 çš„å¸¸ç”¨æ‹“å±•åä¸º .p12 .pfx. PKCS#12 çš„ä¸»è¦ä½¿ç”¨åœºæ™¯æ˜¯å®‰å…¨åœ°ä¿å­˜ã€ä¼ è¾“ç§é’¥åŠç›¸å…³çš„ X.509 è¯ä¹¦ï¼Œæ¯”å¦‚ï¼š å¾®ä¿¡/æ”¯ä»˜å®ç­‰æ”¯ä»˜ç›¸å…³çš„æ•°å­—è¯ä¹¦ï¼Œé€šå¸¸ä½¿ç”¨ PKCS#12 æ ¼å¼å­˜å‚¨ï¼Œä½¿ç”¨å•†æˆ·å·åšåŠ å¯†å¯†ç ï¼Œç„¶åç¼–ç ä¸º base64 å†æä¾›ç»™ç”¨æˆ· å®‰å“çš„ APK ç­¾åè¯ä¹¦é€šå¸¸ä½¿ç”¨ PKCS#12 æ ¼å¼å­˜å‚¨ï¼Œæ‹“å±•åä¸º .keystore æˆ–è€… .jks. PEM æ ¼å¼è½¬ PKCS#12ï¼ˆå…¬é’¥å’Œç§é’¥éƒ½æ”¾é‡Œé¢ï¼‰: shell # openssl pkcs12 -export -in client.crt -inkey client.key -out client.p12 # æŒ‰æç¤ºè¾“å…¥ä¿æŠ¤å¯†ç  ä» PKCS#12 ä¸­åˆ†åˆ«æå–å‡º PEM æ ¼å¼çš„å…¬é’¥ä¸ç§é’¥: shell openssl pkcs12 -in xxx.p12 -out xxx.crt -clcerts -nokeys openssl pkcs12 -in xxx.p12 -out xxx.key -nocerts -nodes ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:3:3","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#pkcs7--cms"},{"categories":["tech"],"content":" 3. è¯ä¹¦çš„å­˜å‚¨æ ¼å¼ä¸ç¼–ç æ ‡å‡† è¯ä¹¦çš„æ ¼å¼è¿™ä¸€å—ï¼Œæ˜¯çœŸçš„äº”èŠ±å…«é—¨â€¦æ²‰é‡çš„å†å²åŒ…è¢±â€¦ X509 åªè§„å®šäº†è¯ä¹¦åº”è¯¥åŒ…å«å“ªäº›ä¿¡æ¯ï¼Œä½†æ˜¯æœªå®šä¹‰è¯ä¹¦è¯¥å¦‚ä½•å­˜å‚¨ã€‚ä¸ºäº†è§£å†³è¯ä¹¦çš„æè¿°ä¸ç¼–ç å­˜å‚¨é—®é¢˜ï¼Œåˆå‡ºç°äº†å¦‚ä¸‹æ ‡å‡†ï¼š ASN.1 ç»“æ„ï¼šæ˜¯ä¸€ç§æè¿°è¯ä¹¦æ ¼å¼çš„æ–¹æ³•ã€‚ å®ƒç±»ä¼¼ protobuf æ•°æ®æè¿°è¯­è¨€ã€SQL DDL ASN.1 åªè§„å®šäº†è¯¥å¦‚ä½•æè¿°è¯ä¹¦ï¼Œæœªå®šä¹‰è¯¥å¦‚ä½•ç¼–ç ã€‚ å°† ASN.1 ç»“æ„ç¼–ç å­˜å‚¨çš„æ ¼å¼æœ‰ DERï¼šä¸€ç§äºŒè¿›åˆ¶ç¼–ç æ ¼å¼ PEMï¼šDER æ˜¯äºŒè¿›åˆ¶æ ¼å¼ï¼Œä¸ä¾¿äºå¤åˆ¶ç²˜è´´ï¼Œå› æ­¤å‡ºç°äº† PEMï¼Œå®ƒæ˜¯ä¸€ä¸ªæ–‡æœ¬ç¼–ç æ ¼å¼ï¼ˆå…¶å®å°±æ˜¯æŠŠ DER ç¼–ç åçš„æ•°æ®å† Base64 ç¼–ç ä¸‹â€¦ï¼‰ æŸäº›åœºæ™¯ä¸‹ï¼ŒX.509 ä¿¡æ¯ä¸å¤Ÿä¸°å¯Œï¼Œå› æ­¤åˆè®¾è®¡äº†ä¸€äº›ä¿¡æ¯æ›´ä¸°å¯Œï¼ˆä¾‹å¦‚å¯ä»¥åŒ…å«è¯ä¹¦é“¾ã€å…¬ç§é’¥å¯¹ï¼‰çš„è¯ä¹¦å°è£…æ ¼å¼ï¼ŒåŒ…æ‹¬ PKCS #7 å’Œ PKCS #12 ä»ç„¶ç”¨ ASN.1 æ ¼å¼æè¿° åŸºæœ¬éƒ½æ˜¯ç”¨ DER ç¼–ç  ä¸‹é¢è¯¦ç»†ä»‹ç»ä¸‹è¿™äº›ç›¸å…³çš„æ ‡å‡†ä¸æ ¼å¼ã€‚ ç¼–ç å­˜å‚¨æ ¼å¼ DER ä¸ PEMDER æ˜¯ç”±å›½é™…ç”µä¿¡è”ç›Ÿï¼ˆITUï¼‰åœ¨ ITU-T X.690æ ‡å‡†ä¸­å®šä¹‰çš„ä¸€ç§æ•°æ®ç¼–ç è§„åˆ™ï¼Œç”¨äºå°† ASN.1 ç»“æ„çš„ä¿¡æ¯ç¼–ç ä¸ºäºŒè¿›åˆ¶æ•°æ®ã€‚ç›´æ¥ä»¥ DER æ ¼å¼å­˜å‚¨çš„è¯ä¹¦ï¼Œå¤§éƒ½ä½¿ç”¨ .cer .crt .der æ‹“å±•åï¼Œåœ¨ Windows ç³»ç»Ÿæ¯”è¾ƒå¸¸è§ã€‚ è€Œ PEM æ ¼å¼ï¼Œå³ Privacy-Enhanced Mailï¼Œæ˜¯ openssl é»˜è®¤ä½¿ç”¨çš„è¯ä¹¦æ ¼å¼ã€‚å¯ç”¨äºç¼–ç å…¬é’¥ã€ç§é’¥ã€å…¬é’¥è¯ä¹¦ç­‰å¤šç§å¯†ç å­¦ä¿¡æ¯ã€‚PEM å…¶å®å°±æ˜¯åœ¨ DER çš„åŸºç¡€ä¸Šå¤šåšä¸€æ­¥â€”â€”ä½¿ç”¨ Base64 å°† DER ç¼–ç å‡ºçš„äºŒè¿›åˆ¶æ•°æ®å†å¤„ç†ä¸€æ¬¡ï¼Œç¼–ç æˆå­—ç¬¦ä¸²å†å­˜å‚¨ã€‚å¥½å¤„æ˜¯å­˜å‚¨ã€ä¼ è¾“è¦æ–¹ä¾¿å¾ˆå¤šï¼Œå¯ä»¥ç›´æ¥å¤åˆ¶ç²˜è´´ã€‚ ä¸€ä¸ª 2048 ä½ RSA å…¬é’¥çš„ PEM æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š pem -----BEGIN PUBLIC KEY----- MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAyl6q6BkEcEUi9V1/Q7il bngnh1YzG1tM4Hd6XCZQ35OzDN4my9eXWtjoL8YvLYqlYTJqhTHpuptgjF/lmlhg WIMKNNcuDAbvmWExRyZateVrjO9OtgkyJCuGhaum0TIUC+dbZ9L9xsdK/fU1L5BB nPRSYMloH8uE1CbK/DhFUiKp36aHZFfqLPicY3c6/N+k2kIJCEWBY0SROqpqy2Iz yCIP54JSoOoGz6pdtWhd5cEeicr9e7f/WixEES6fgavqIHzhSJBVctpMgFPjFZ/x JJhQVf23WKb3YQQ/0Uc8O7OTDXoUfuJP9UgqvKNh4hPfJA+a4nxkDYhTPfrLHfKY YwIDAQAB -----END PUBLIC KEY----- PEM æ ¼å¼çš„æ•°æ®é€šå¸¸ä»¥ .pem .key .crt .cer ç­‰æ‹“å±•åå­˜å‚¨ï¼Œç›´æ¥ cat ä¸€ä¸‹æ˜¯ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œå°±èƒ½ç¡®è®¤è¯¥æ–‡ä»¶æ˜¯å¦æ˜¯ PEM æ ¼å¼äº†ã€‚ å› ä¸ºçº¯æ–‡æœ¬æ ¼å¼å¤„ç†èµ·æ¥å¾ˆæ–¹ä¾¿ï¼Œå¤§éƒ¨åˆ†åœºæ™¯ä¸‹è¯ä¹¦ã€å…¬é’¥ã€ç§é’¥ç­‰ä¿¡æ¯éƒ½ä¼šè¢«ç¼–ç æˆ PEM æ ¼å¼å†è¿›è¡Œå­˜å‚¨ã€ä¼ è¾“ã€‚ openssl é»˜è®¤ä½¿ç”¨çš„è¾“å…¥è¾“å‡ºå‡ PEM æ ¼å¼ã€‚ PKCS#1PKCS#1 æ˜¯ä¸“ç”¨äºç¼–ç  RSA å…¬ç§é’¥çš„æ ‡å‡†ï¼Œé€šå¸¸è¢«ç¼–ç ä¸º PEM æ ¼å¼å­˜å‚¨ã€‚openssl ç”Ÿæˆçš„ RSA å¯†é’¥å¯¹é»˜è®¤ä½¿ç”¨æ­¤æ ¼å¼ã€‚ è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒé™ˆæ—§çš„æ ¼å¼ï¼Œopenssl ä¹‹æ‰€ä»¥é»˜è®¤ä½¿ç”¨å®ƒï¼Œä¸»è¦æ˜¯ä¸ºäº†å…¼å®¹æ€§ã€‚é€šå¸¸å»ºè®®ä½¿ç”¨æ›´å®‰å…¨çš„ PKCS#8 è€Œä¸æ˜¯è¿™ä¸ªã€‚ ä¸€ä¸ªä½¿ç”¨ PKCS#1 æ ‡å‡†çš„ 2048 ä½ RSA å…¬é’¥æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š pem -----BEGIN PUBLIC KEY----- MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAyl6q6BkEcEUi9V1/Q7il bngnh1YzG1tM4Hd6XCZQ35OzDN4my9eXWtjoL8YvLYqlYTJqhTHpuptgjF/lmlhg WIMKNNcuDAbvmWExRyZateVrjO9OtgkyJCuGhaum0TIUC+dbZ9L9xsdK/fU1L5BB nPRSYMloH8uE1CbK/DhFUiKp36aHZFfqLPicY3c6/N+k2kIJCEWBY0SROqpqy2Iz yCIP54JSoOoGz6pdtWhd5cEeicr9e7f/WixEES6fgavqIHzhSJBVctpMgFPjFZ/x JJhQVf23WKb3YQQ/0Uc8O7OTDXoUfuJP9UgqvKNh4hPfJA+a4nxkDYhTPfrLHfKY YwIDAQAB -----END PUBLIC KEY----- PKCS#7 / CMS å¤´ç–¼â€¦ä¸ºä»€ä¹ˆè¿™ä¹ˆå¤šäº”èŠ±å…«é—¨çš„æ ¼å¼â€¦ PKCS#7/CMSï¼Œæ˜¯ä¸€ä¸ªå¤šç”¨é€”çš„è¯ä¹¦æè¿°æ ¼å¼ã€‚å®ƒåŒ…å«ä¸€ä¸ªæ•°æ®å¡«å……è§„åˆ™ï¼Œè¿™ä¸ªå¡«å……è§„åˆ™å¸¸è¢«ç”¨åœ¨éœ€è¦æ•°æ®å¡«å……çš„åˆ†ç»„åŠ å¯†ã€æ•°å­—ç­¾åç­‰ç®—æ³•ä¸­ã€‚ å¦å¤–æ®è¯´ PKCS#7 ä¹Ÿå¯ä»¥è¢«ç”¨æ¥æè¿°è¯ä¹¦ï¼Œå¹¶ä»¥ DER/PEM æ ¼å¼ä¿å­˜ï¼Œåç¼€é€šå¸¸ä½¿ç”¨ .p7b æˆ–è€….p7c, è¿™ä¸ªæš‚æ—¶å­˜ç–‘å§ï¼Œæœ‰éœ€è¦å†ç ”ç©¶äº†ã€‚ PKCS#8PKCS#8 æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºç¼–ç ç§é’¥çš„æ ‡å‡†ï¼Œå¯ç”¨äºç¼–ç  DSA/RSA/ECC ç§é’¥ã€‚å®ƒé€šå¸¸è¢«ç¼–ç æˆ PEM æ ¼å¼å­˜å‚¨ã€‚ å‰é¢ä»‹ç»äº†ä¸“é—¨ç”¨äºç¼–ç  RSA çš„ PKCS#1 æ ‡å‡†æ¯”è¾ƒé™ˆæ—§ï¼Œè€Œä¸”æ›¾ç»å‡ºè¿‡æ¼æ´ã€‚å› æ­¤é€šå¸¸å»ºè®®ä½¿ç”¨æ›´å®‰å…¨çš„ PKCS#8 æ¥å–ä»£ PKCS#1. C# Java ç­‰ç¼–ç¨‹è¯­è¨€é€šå¸¸è¦æ±‚ä½¿ç”¨æ­¤æ ¼å¼çš„ç§é’¥ï¼Œè€Œ Python çš„pyca/cryptography åˆ™æ”¯æŒå¤šç§ç¼–ç æ ¼å¼ã€‚ ä¸€ä¸ªéåŠ å¯† ECC ç§é’¥çš„ PKCS#8 æ ¼å¼å¦‚ä¸‹ï¼š text -----BEGIN PRIVATE KEY----- MIGHTAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBG0wawIBAQQglQanBRiYVPX7F2Rd 4CqyjEN0K4qfHw4tM/yMIh21wamhRANCAARsxaI4jT1b8zbDlFziuLngPcExbYzz ePAHUmgWL/ZCeqlODF/l/XvimkjaWC2huu1OSWB9EKuG+mKFY2Y5k+vF -----END PRIVATE KEY----- ä¸€ä¸ªåŠ å¯† PKCS#8 ç§é’¥çš„ PEM æ ¼å¼ç§é’¥å¦‚ä¸‹ï¼š text -----BEGIN ENCRYPTED PRIVATE KEY----- Base64 ç¼–ç å†…å®¹ -----END ENCRYPTED PRIVATE KEY----- å¯ä½¿ç”¨å¦‚ä¸‹ openssl å‘½ä»¤å°† RSA/ECC ç§é’¥è½¬æ¢ä¸º PKCS#8 æ ¼å¼ï¼š text # RSA openssl pkcs8 -topk8 -inform PEM -in rsa-private-key.pem -outform PEM -nocrypt -out rsa-private-key-pkcs8.pem # ECC çš„è½¬æ¢å‘½ä»¤ä¸ RSA å®Œå…¨ä¸€è‡´ openssl pkcs8 -topk8 -inform PEM -in ecc-private-key.pem -outform PEM -nocrypt -out ecc-private-key-pkcs8.pem PKCS#12PKCS#12 æ˜¯ä¸€ä¸ªå½’æ¡£æ–‡ä»¶æ ¼å¼ï¼Œç”¨äºå®ç°å­˜å‚¨å¤šä¸ªç§é’¥åŠç›¸å…³çš„ X.509 è¯ä¹¦ã€‚ å› ä¸ºä¿å­˜äº†ç§é’¥ï¼Œä¸ºäº†å®‰å…¨æ€§å®ƒé€šå¸¸æ˜¯åŠ å¯†çš„ï¼Œéœ€è¦ä½¿ç”¨ passphrase è§£å¯†åæ‰èƒ½ä½¿ç”¨ã€‚ PKCS#12 çš„å¸¸ç”¨æ‹“å±•åä¸º .p12 .pfx. PKCS#12 çš„ä¸»è¦ä½¿ç”¨åœºæ™¯æ˜¯å®‰å…¨åœ°ä¿å­˜ã€ä¼ è¾“ç§é’¥åŠç›¸å…³çš„ X.509 è¯ä¹¦ï¼Œæ¯”å¦‚ï¼š å¾®ä¿¡/æ”¯ä»˜å®ç­‰æ”¯ä»˜ç›¸å…³çš„æ•°å­—è¯ä¹¦ï¼Œé€šå¸¸ä½¿ç”¨ PKCS#12 æ ¼å¼å­˜å‚¨ï¼Œä½¿ç”¨å•†æˆ·å·åšåŠ å¯†å¯†ç ï¼Œç„¶åç¼–ç ä¸º base64 å†æä¾›ç»™ç”¨æˆ· å®‰å“çš„ APK ç­¾åè¯ä¹¦é€šå¸¸ä½¿ç”¨ PKCS#12 æ ¼å¼å­˜å‚¨ï¼Œæ‹“å±•åä¸º .keystore æˆ–è€… .jks. PEM æ ¼å¼è½¬ PKCS#12ï¼ˆå…¬é’¥å’Œç§é’¥éƒ½æ”¾é‡Œé¢ï¼‰: shell # openssl pkcs12 -export -in client.crt -inkey client.key -out client.p12 # æŒ‰æç¤ºè¾“å…¥ä¿æŠ¤å¯†ç  ä» PKCS#12 ä¸­åˆ†åˆ«æå–å‡º PEM æ ¼å¼çš„å…¬é’¥ä¸ç§é’¥: shell openssl pkcs12 -in xxx.p12 -out xxx.crt -clcerts -nokeys openssl pkcs12 -in xxx.p12 -out xxx.key -nocerts -nodes ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:3:3","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#pkcs8"},{"categories":["tech"],"content":" 3. è¯ä¹¦çš„å­˜å‚¨æ ¼å¼ä¸ç¼–ç æ ‡å‡† è¯ä¹¦çš„æ ¼å¼è¿™ä¸€å—ï¼Œæ˜¯çœŸçš„äº”èŠ±å…«é—¨â€¦æ²‰é‡çš„å†å²åŒ…è¢±â€¦ X509 åªè§„å®šäº†è¯ä¹¦åº”è¯¥åŒ…å«å“ªäº›ä¿¡æ¯ï¼Œä½†æ˜¯æœªå®šä¹‰è¯ä¹¦è¯¥å¦‚ä½•å­˜å‚¨ã€‚ä¸ºäº†è§£å†³è¯ä¹¦çš„æè¿°ä¸ç¼–ç å­˜å‚¨é—®é¢˜ï¼Œåˆå‡ºç°äº†å¦‚ä¸‹æ ‡å‡†ï¼š ASN.1 ç»“æ„ï¼šæ˜¯ä¸€ç§æè¿°è¯ä¹¦æ ¼å¼çš„æ–¹æ³•ã€‚ å®ƒç±»ä¼¼ protobuf æ•°æ®æè¿°è¯­è¨€ã€SQL DDL ASN.1 åªè§„å®šäº†è¯¥å¦‚ä½•æè¿°è¯ä¹¦ï¼Œæœªå®šä¹‰è¯¥å¦‚ä½•ç¼–ç ã€‚ å°† ASN.1 ç»“æ„ç¼–ç å­˜å‚¨çš„æ ¼å¼æœ‰ DERï¼šä¸€ç§äºŒè¿›åˆ¶ç¼–ç æ ¼å¼ PEMï¼šDER æ˜¯äºŒè¿›åˆ¶æ ¼å¼ï¼Œä¸ä¾¿äºå¤åˆ¶ç²˜è´´ï¼Œå› æ­¤å‡ºç°äº† PEMï¼Œå®ƒæ˜¯ä¸€ä¸ªæ–‡æœ¬ç¼–ç æ ¼å¼ï¼ˆå…¶å®å°±æ˜¯æŠŠ DER ç¼–ç åçš„æ•°æ®å† Base64 ç¼–ç ä¸‹â€¦ï¼‰ æŸäº›åœºæ™¯ä¸‹ï¼ŒX.509 ä¿¡æ¯ä¸å¤Ÿä¸°å¯Œï¼Œå› æ­¤åˆè®¾è®¡äº†ä¸€äº›ä¿¡æ¯æ›´ä¸°å¯Œï¼ˆä¾‹å¦‚å¯ä»¥åŒ…å«è¯ä¹¦é“¾ã€å…¬ç§é’¥å¯¹ï¼‰çš„è¯ä¹¦å°è£…æ ¼å¼ï¼ŒåŒ…æ‹¬ PKCS #7 å’Œ PKCS #12 ä»ç„¶ç”¨ ASN.1 æ ¼å¼æè¿° åŸºæœ¬éƒ½æ˜¯ç”¨ DER ç¼–ç  ä¸‹é¢è¯¦ç»†ä»‹ç»ä¸‹è¿™äº›ç›¸å…³çš„æ ‡å‡†ä¸æ ¼å¼ã€‚ ç¼–ç å­˜å‚¨æ ¼å¼ DER ä¸ PEMDER æ˜¯ç”±å›½é™…ç”µä¿¡è”ç›Ÿï¼ˆITUï¼‰åœ¨ ITU-T X.690æ ‡å‡†ä¸­å®šä¹‰çš„ä¸€ç§æ•°æ®ç¼–ç è§„åˆ™ï¼Œç”¨äºå°† ASN.1 ç»“æ„çš„ä¿¡æ¯ç¼–ç ä¸ºäºŒè¿›åˆ¶æ•°æ®ã€‚ç›´æ¥ä»¥ DER æ ¼å¼å­˜å‚¨çš„è¯ä¹¦ï¼Œå¤§éƒ½ä½¿ç”¨ .cer .crt .der æ‹“å±•åï¼Œåœ¨ Windows ç³»ç»Ÿæ¯”è¾ƒå¸¸è§ã€‚ è€Œ PEM æ ¼å¼ï¼Œå³ Privacy-Enhanced Mailï¼Œæ˜¯ openssl é»˜è®¤ä½¿ç”¨çš„è¯ä¹¦æ ¼å¼ã€‚å¯ç”¨äºç¼–ç å…¬é’¥ã€ç§é’¥ã€å…¬é’¥è¯ä¹¦ç­‰å¤šç§å¯†ç å­¦ä¿¡æ¯ã€‚PEM å…¶å®å°±æ˜¯åœ¨ DER çš„åŸºç¡€ä¸Šå¤šåšä¸€æ­¥â€”â€”ä½¿ç”¨ Base64 å°† DER ç¼–ç å‡ºçš„äºŒè¿›åˆ¶æ•°æ®å†å¤„ç†ä¸€æ¬¡ï¼Œç¼–ç æˆå­—ç¬¦ä¸²å†å­˜å‚¨ã€‚å¥½å¤„æ˜¯å­˜å‚¨ã€ä¼ è¾“è¦æ–¹ä¾¿å¾ˆå¤šï¼Œå¯ä»¥ç›´æ¥å¤åˆ¶ç²˜è´´ã€‚ ä¸€ä¸ª 2048 ä½ RSA å…¬é’¥çš„ PEM æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š pem -----BEGIN PUBLIC KEY----- MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAyl6q6BkEcEUi9V1/Q7il bngnh1YzG1tM4Hd6XCZQ35OzDN4my9eXWtjoL8YvLYqlYTJqhTHpuptgjF/lmlhg WIMKNNcuDAbvmWExRyZateVrjO9OtgkyJCuGhaum0TIUC+dbZ9L9xsdK/fU1L5BB nPRSYMloH8uE1CbK/DhFUiKp36aHZFfqLPicY3c6/N+k2kIJCEWBY0SROqpqy2Iz yCIP54JSoOoGz6pdtWhd5cEeicr9e7f/WixEES6fgavqIHzhSJBVctpMgFPjFZ/x JJhQVf23WKb3YQQ/0Uc8O7OTDXoUfuJP9UgqvKNh4hPfJA+a4nxkDYhTPfrLHfKY YwIDAQAB -----END PUBLIC KEY----- PEM æ ¼å¼çš„æ•°æ®é€šå¸¸ä»¥ .pem .key .crt .cer ç­‰æ‹“å±•åå­˜å‚¨ï¼Œç›´æ¥ cat ä¸€ä¸‹æ˜¯ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œå°±èƒ½ç¡®è®¤è¯¥æ–‡ä»¶æ˜¯å¦æ˜¯ PEM æ ¼å¼äº†ã€‚ å› ä¸ºçº¯æ–‡æœ¬æ ¼å¼å¤„ç†èµ·æ¥å¾ˆæ–¹ä¾¿ï¼Œå¤§éƒ¨åˆ†åœºæ™¯ä¸‹è¯ä¹¦ã€å…¬é’¥ã€ç§é’¥ç­‰ä¿¡æ¯éƒ½ä¼šè¢«ç¼–ç æˆ PEM æ ¼å¼å†è¿›è¡Œå­˜å‚¨ã€ä¼ è¾“ã€‚ openssl é»˜è®¤ä½¿ç”¨çš„è¾“å…¥è¾“å‡ºå‡ PEM æ ¼å¼ã€‚ PKCS#1PKCS#1 æ˜¯ä¸“ç”¨äºç¼–ç  RSA å…¬ç§é’¥çš„æ ‡å‡†ï¼Œé€šå¸¸è¢«ç¼–ç ä¸º PEM æ ¼å¼å­˜å‚¨ã€‚openssl ç”Ÿæˆçš„ RSA å¯†é’¥å¯¹é»˜è®¤ä½¿ç”¨æ­¤æ ¼å¼ã€‚ è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒé™ˆæ—§çš„æ ¼å¼ï¼Œopenssl ä¹‹æ‰€ä»¥é»˜è®¤ä½¿ç”¨å®ƒï¼Œä¸»è¦æ˜¯ä¸ºäº†å…¼å®¹æ€§ã€‚é€šå¸¸å»ºè®®ä½¿ç”¨æ›´å®‰å…¨çš„ PKCS#8 è€Œä¸æ˜¯è¿™ä¸ªã€‚ ä¸€ä¸ªä½¿ç”¨ PKCS#1 æ ‡å‡†çš„ 2048 ä½ RSA å…¬é’¥æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š pem -----BEGIN PUBLIC KEY----- MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAyl6q6BkEcEUi9V1/Q7il bngnh1YzG1tM4Hd6XCZQ35OzDN4my9eXWtjoL8YvLYqlYTJqhTHpuptgjF/lmlhg WIMKNNcuDAbvmWExRyZateVrjO9OtgkyJCuGhaum0TIUC+dbZ9L9xsdK/fU1L5BB nPRSYMloH8uE1CbK/DhFUiKp36aHZFfqLPicY3c6/N+k2kIJCEWBY0SROqpqy2Iz yCIP54JSoOoGz6pdtWhd5cEeicr9e7f/WixEES6fgavqIHzhSJBVctpMgFPjFZ/x JJhQVf23WKb3YQQ/0Uc8O7OTDXoUfuJP9UgqvKNh4hPfJA+a4nxkDYhTPfrLHfKY YwIDAQAB -----END PUBLIC KEY----- PKCS#7 / CMS å¤´ç–¼â€¦ä¸ºä»€ä¹ˆè¿™ä¹ˆå¤šäº”èŠ±å…«é—¨çš„æ ¼å¼â€¦ PKCS#7/CMSï¼Œæ˜¯ä¸€ä¸ªå¤šç”¨é€”çš„è¯ä¹¦æè¿°æ ¼å¼ã€‚å®ƒåŒ…å«ä¸€ä¸ªæ•°æ®å¡«å……è§„åˆ™ï¼Œè¿™ä¸ªå¡«å……è§„åˆ™å¸¸è¢«ç”¨åœ¨éœ€è¦æ•°æ®å¡«å……çš„åˆ†ç»„åŠ å¯†ã€æ•°å­—ç­¾åç­‰ç®—æ³•ä¸­ã€‚ å¦å¤–æ®è¯´ PKCS#7 ä¹Ÿå¯ä»¥è¢«ç”¨æ¥æè¿°è¯ä¹¦ï¼Œå¹¶ä»¥ DER/PEM æ ¼å¼ä¿å­˜ï¼Œåç¼€é€šå¸¸ä½¿ç”¨ .p7b æˆ–è€….p7c, è¿™ä¸ªæš‚æ—¶å­˜ç–‘å§ï¼Œæœ‰éœ€è¦å†ç ”ç©¶äº†ã€‚ PKCS#8PKCS#8 æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºç¼–ç ç§é’¥çš„æ ‡å‡†ï¼Œå¯ç”¨äºç¼–ç  DSA/RSA/ECC ç§é’¥ã€‚å®ƒé€šå¸¸è¢«ç¼–ç æˆ PEM æ ¼å¼å­˜å‚¨ã€‚ å‰é¢ä»‹ç»äº†ä¸“é—¨ç”¨äºç¼–ç  RSA çš„ PKCS#1 æ ‡å‡†æ¯”è¾ƒé™ˆæ—§ï¼Œè€Œä¸”æ›¾ç»å‡ºè¿‡æ¼æ´ã€‚å› æ­¤é€šå¸¸å»ºè®®ä½¿ç”¨æ›´å®‰å…¨çš„ PKCS#8 æ¥å–ä»£ PKCS#1. C# Java ç­‰ç¼–ç¨‹è¯­è¨€é€šå¸¸è¦æ±‚ä½¿ç”¨æ­¤æ ¼å¼çš„ç§é’¥ï¼Œè€Œ Python çš„pyca/cryptography åˆ™æ”¯æŒå¤šç§ç¼–ç æ ¼å¼ã€‚ ä¸€ä¸ªéåŠ å¯† ECC ç§é’¥çš„ PKCS#8 æ ¼å¼å¦‚ä¸‹ï¼š text -----BEGIN PRIVATE KEY----- MIGHTAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBG0wawIBAQQglQanBRiYVPX7F2Rd 4CqyjEN0K4qfHw4tM/yMIh21wamhRANCAARsxaI4jT1b8zbDlFziuLngPcExbYzz ePAHUmgWL/ZCeqlODF/l/XvimkjaWC2huu1OSWB9EKuG+mKFY2Y5k+vF -----END PRIVATE KEY----- ä¸€ä¸ªåŠ å¯† PKCS#8 ç§é’¥çš„ PEM æ ¼å¼ç§é’¥å¦‚ä¸‹ï¼š text -----BEGIN ENCRYPTED PRIVATE KEY----- Base64 ç¼–ç å†…å®¹ -----END ENCRYPTED PRIVATE KEY----- å¯ä½¿ç”¨å¦‚ä¸‹ openssl å‘½ä»¤å°† RSA/ECC ç§é’¥è½¬æ¢ä¸º PKCS#8 æ ¼å¼ï¼š text # RSA openssl pkcs8 -topk8 -inform PEM -in rsa-private-key.pem -outform PEM -nocrypt -out rsa-private-key-pkcs8.pem # ECC çš„è½¬æ¢å‘½ä»¤ä¸ RSA å®Œå…¨ä¸€è‡´ openssl pkcs8 -topk8 -inform PEM -in ecc-private-key.pem -outform PEM -nocrypt -out ecc-private-key-pkcs8.pem PKCS#12PKCS#12 æ˜¯ä¸€ä¸ªå½’æ¡£æ–‡ä»¶æ ¼å¼ï¼Œç”¨äºå®ç°å­˜å‚¨å¤šä¸ªç§é’¥åŠç›¸å…³çš„ X.509 è¯ä¹¦ã€‚ å› ä¸ºä¿å­˜äº†ç§é’¥ï¼Œä¸ºäº†å®‰å…¨æ€§å®ƒé€šå¸¸æ˜¯åŠ å¯†çš„ï¼Œéœ€è¦ä½¿ç”¨ passphrase è§£å¯†åæ‰èƒ½ä½¿ç”¨ã€‚ PKCS#12 çš„å¸¸ç”¨æ‹“å±•åä¸º .p12 .pfx. PKCS#12 çš„ä¸»è¦ä½¿ç”¨åœºæ™¯æ˜¯å®‰å…¨åœ°ä¿å­˜ã€ä¼ è¾“ç§é’¥åŠç›¸å…³çš„ X.509 è¯ä¹¦ï¼Œæ¯”å¦‚ï¼š å¾®ä¿¡/æ”¯ä»˜å®ç­‰æ”¯ä»˜ç›¸å…³çš„æ•°å­—è¯ä¹¦ï¼Œé€šå¸¸ä½¿ç”¨ PKCS#12 æ ¼å¼å­˜å‚¨ï¼Œä½¿ç”¨å•†æˆ·å·åšåŠ å¯†å¯†ç ï¼Œç„¶åç¼–ç ä¸º base64 å†æä¾›ç»™ç”¨æˆ· å®‰å“çš„ APK ç­¾åè¯ä¹¦é€šå¸¸ä½¿ç”¨ PKCS#12 æ ¼å¼å­˜å‚¨ï¼Œæ‹“å±•åä¸º .keystore æˆ–è€… .jks. PEM æ ¼å¼è½¬ PKCS#12ï¼ˆå…¬é’¥å’Œç§é’¥éƒ½æ”¾é‡Œé¢ï¼‰: shell # openssl pkcs12 -export -in client.crt -inkey client.key -out client.p12 # æŒ‰æç¤ºè¾“å…¥ä¿æŠ¤å¯†ç  ä» PKCS#12 ä¸­åˆ†åˆ«æå–å‡º PEM æ ¼å¼çš„å…¬é’¥ä¸ç§é’¥: shell openssl pkcs12 -in xxx.p12 -out xxx.crt -clcerts -nokeys openssl pkcs12 -in xxx.p12 -out xxx.key -nocerts -nodes ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:3:3","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#pkcs12"},{"categories":["tech"],"content":" 4. è¯ä¹¦æ”¯æŒä¿æŠ¤çš„åŸŸåç±»å‹TLS è¯ä¹¦æ”¯æŒé…ç½®å¤šä¸ªåŸŸåï¼Œå¹¶ä¸”æ”¯æŒæ‰€è°“çš„é€šé…ç¬¦ï¼ˆæ³›ï¼‰åŸŸåã€‚ä½†æ˜¯é€šé…ç¬¦åŸŸåè¯ä¹¦çš„åŒ¹é…è§„åˆ™ï¼Œå’Œ DNS è§£æä¸­çš„åŒ¹é…è§„åˆ™å¹¶ä¸ä¸€è‡´ï¼ æ ¹æ®è¯ä¹¦é€‰å‹å’Œè´­ä¹° - é˜¿é‡Œäº‘æ–‡æ¡£ çš„è§£é‡Šï¼Œé€šé…ç¬¦è¯ä¹¦åªæ”¯æŒåŒçº§åŒ¹é…ï¼Œï¼Œä¹Ÿå°±æ˜¯è¯´ * ä¸èƒ½åŒ¹é…åŸŸåä¸­çš„ . è¿™ä¸ªå­—ç¬¦ï¼Œè¯¦ç»†è¯´æ˜å¦‚ä¸‹: *.aliyun.com èƒ½ç”¨äº xx.aliyun.com å’Œ abc.aliyun.comï¼Œä½†ä¸èƒ½ç”¨äº aliyun.com,a.b.aliyun.com æˆ– bb.xx.aliyun.com.ã€‚ ä¸€ä¸ªè¯ä¹¦èƒ½æ”¯æŒå¤šä¸ªåŸŸåé…ç½®ï¼Œæ¯”å¦‚ä¸€ä¸ªåŒ…å«äº† aliyun.com, *.a.aliyun.com,*.b.aliyun.com ä¸‰ä¸ªåŸŸåçš„è¯ä¹¦ï¼Œå¯ä»¥åŒæ—¶ç”¨äº aliyun.com, xx.a.aliyun.com,yy.b.aliyun.comã€‚ è¦æƒ³ä¿æŠ¤å¤šä¸ªäºŒä¸‰çº§å­åŸŸï¼Œåªèƒ½åœ¨ç”Ÿæˆ TLS è¯ä¹¦æ—¶ï¼Œæ·»åŠ å¤šä¸ªé€šé…ç¬¦åŸŸåã€‚å› æ­¤è®¾è®¡åŸŸåè§„åˆ™æ—¶ï¼Œè¦è€ƒè™‘åˆ°è¿™ç‚¹ï¼Œå°½é‡ä¸è¦ä½¿ç”¨å±‚çº§å¤ªæ·±çš„åŸŸåï¼æœ‰äº›ä¿¡æ¯å¯ä»¥é€šè¿‡ - æ¥æ‹¼æ¥ä»¥å‡å°‘åŸŸåå±‚çº§ï¼Œæ¯”å¦‚é˜¿é‡Œäº‘çš„ oss åŸŸå: å…¬ç½‘: oss-cn-shenzhen.aliyuncs.com å†…ç½‘: oss-cn-shenzhen-internal.aliyuncs.com æ­¤å¤–ä¹Ÿå¯ç›´æ¥ä¸º IP åœ°å€ç­¾å‘è¯ä¹¦ï¼ŒIP åœ°å€å¯ä»¥è®°å½•åœ¨è¯ä¹¦çš„ SAN å±æ€§ä¸­ã€‚åœ¨è‡ªå·±ç”Ÿæˆçš„è¯ä¹¦é“¾ä¸­å¯ä»¥ä¸ºå±€åŸŸç½‘ IP æˆ–å±€åŸŸç½‘åŸŸåç”Ÿæˆæœ¬åœ°ç­¾åè¯ä¹¦ã€‚æ­¤å¤–åœ¨å› ç‰¹ç½‘ä¸­ä¹Ÿæœ‰ä¸€äº›æƒå¨è®¤è¯æœºæ„æä¾›ä¸ºå…¬ç½‘ IP ç­¾å‘è¯ä¹¦çš„æœåŠ¡ï¼Œä¸€ä¸ªä¾‹å­æ˜¯ Cloudflare çš„ https://1.1.1.1, ä½¿ç”¨ Firefox æŸ¥çœ‹å…¶è¯ä¹¦ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯ä¸€ä¸ªç”± DigiCert ç­¾å‘çš„ ECC è¯ä¹¦ï¼Œä½¿ç”¨äº† P-256 æ›²çº¿ï¼š Cloudflare çš„ IP è¯ä¹¦ ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:3:4","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#4-è¯ä¹¦æ”¯æŒä¿æŠ¤çš„åŸŸåç±»å‹"},{"categories":["tech"],"content":" 5. ç”Ÿæˆè‡ªå·±çš„è¯ä¹¦é“¾ OpenSSL æ˜¯ç›®å‰ä½¿ç”¨æœ€å¹¿æ³›çš„ç½‘ç»œåŠ å¯†ç®—æ³•åº“ï¼Œè¿™é‡Œä»¥å®ƒä¸ºä¾‹ä»‹ç»è¯ä¹¦çš„ç”Ÿæˆã€‚å¦å¤–ä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨ CloudFalre å¼€æºçš„ PKI å·¥å…·cfssl. å‰é¢ä»‹ç»äº†ï¼Œåœ¨å±€åŸŸç½‘é€šä¿¡ä¸­é€šå¸¸ä½¿ç”¨æœ¬åœ°è¯ä¹¦é“¾ï¼ˆç§æœ‰ PKIï¼‰æ¥ä¿éšœé€šä¿¡å®‰å…¨ï¼Œè¿™é€šå¸¸æœ‰å¦‚ä¸‹å‡ ä¸ªåŸå› ã€‚ åœ¨å†…ç½‘ç¯å¢ƒä¸‹ï¼Œç®¡ç†å‘˜å°†æœ¬åœ° CA è¯ä¹¦å®‰è£…åˆ°æ‰€æœ‰å±€åŸŸç½‘è®¾å¤‡ä¸Šï¼Œå› æ­¤å¹¶æ— å¿…è¦å‘æƒå¨ CA æœºæ„ç”³è¯·è¯ä¹¦ å†…ç½‘ç¯å¢ƒä½¿ç”¨çš„å¯èƒ½æ˜¯éå…¬ç½‘åŸŸåï¼ˆxxx.local/xxx.lan/xxx.srv ç­‰ï¼‰ï¼Œç”šè‡³å¯èƒ½ç›´æ¥ä½¿ç”¨å±€åŸŸç½‘ IP é€šä¿¡ï¼Œæƒå¨ CA æœºæ„ä¸ç­¾å‘è¿™ç§ç±»å‹çš„è¯ä¹¦ æœ¬åœ°è¯ä¹¦é“¾å®Œå…¨å—è‡ªå·±æ§åˆ¶ï¼Œå¯ä»¥è‡ªå·±è®¾ç½®å®‰å…¨å¼ºåº¦ã€è¯ä¹¦å¹´é™ç­‰ç­‰ï¼Œè€Œä¸”ä¸å—æƒå¨ CA æœºæ„å½±å“ã€‚ æƒå¨ CA æœºæ„ä¸ç­¾å‘å®¢æˆ·ç«¯è¯ä¹¦ï¼Œå› ä¸ºå®¢æˆ·ç«¯ä¸ä¸€å®šæœ‰å›ºå®šçš„ IP åœ°å€æˆ–è€…åŸŸåã€‚å®¢æˆ·ç«¯è¯ä¹¦éœ€è¦è‡ªå·±ç­¾å‘ã€‚ ä¸‹é¢ä»‹ç»ä¸‹å¦‚ä½•ä½¿ç”¨ OpenSSL ç”Ÿæˆä¸€ä¸ªæœ¬åœ° CA è¯ä¹¦é“¾ï¼Œå¹¶ç­¾å‘ç”¨äºå®‰å…¨é€šä¿¡çš„æœåŠ¡ç«¯è¯ä¹¦ï¼Œå¯ç”¨äº HTTPS/QUIC ç­‰åè®®ã€‚ 1. ç”Ÿæˆ RSA è¯ä¹¦é“¾åˆ°ç›®å‰ä¸ºæ­¢ RSA ä»ç„¶æ˜¯åº”ç”¨æœ€å¹¿æ³›çš„éå¯¹ç§°åŠ å¯†æ–¹æ¡ˆï¼Œå‡ ä¹æ‰€æœ‰çš„æ ¹è¯ä¹¦éƒ½æ˜¯ä½¿ç”¨çš„ 2048 ä½æˆ–è€… 4096 ä½çš„ RSA å¯†é’¥å¯¹ã€‚ å¯¹äº RSA ç®—æ³•è€Œè¨€ï¼Œè¶Šé•¿çš„å¯†é’¥èƒ½æä¾›è¶Šé«˜çš„å®‰å…¨æ€§ï¼Œå½“å‰ä½¿ç”¨æœ€å¤šçš„ RSA å¯†é’¥é•¿åº¦ä»ç„¶æ˜¯ 2048 ä½ï¼Œä½†æ˜¯ 2048 ä½å·²è¢«ä¸€äº›äººè®¤ä¸ºä¸å¤Ÿå®‰å…¨äº†ï¼Œå¯†ç å­¦å®¶æ›´å»ºè®®ä½¿ç”¨ 3072 ä½æˆ–è€… 4096 ä½çš„å¯†é’¥ã€‚ ç”Ÿæˆä¸€ä¸ª 2048 ä½çš„ RSA è¯ä¹¦é“¾çš„æµç¨‹å¦‚ä¸‹: OpenSSL çš„ CSR é…ç½®æ–‡ä»¶å®˜æ–¹æ–‡æ¡£:https://www.openssl.org/docs/manmaster/man1/openssl-req.html ç¼–å†™è¯ä¹¦ç­¾åè¯·æ±‚çš„é…ç½®æ–‡ä»¶ csr.conf: conf [ req ] prompt = no req_extensions = v3_ext distinguished_name = req_distinguished_name [ req_distinguished_name ] countryName = US stateOrProvinceName = NYK localityName = NYK organizationName = Ryan4Yin organizationalUnitName = Ryan4Yin commonName = writefor.fun # deprecated, use subjectAltName(SAN) instead emailAddress = rayn4yin@linux.com [ alt_names ] DNS.1 = writefor.fun DNS.2 = *.writefor.fun [ v3_ext ] subjectAltName=@alt_names basicConstraints = CA:false extendedKeyUsage = serverAuth æ­¤æ–‡ä»¶çš„è¯¦ç»†æ–‡æ¡£:OpenSSL file formats and conventions - OpenSSL 3.3 ç”Ÿæˆè¯ä¹¦é“¾ä¸æœåŠ¡ç«¯è¯ä¹¦: shell # 1. ç”Ÿæˆæœ¬åœ° CA æ ¹è¯ä¹¦çš„ç§é’¥ openssl genrsa -out ca.key 2048 # 2. ä½¿ç”¨ç§é’¥ç­¾å‘å‡º CA æ ¹è¯ä¹¦ ## CA æ ¹è¯ä¹¦çš„æœ‰æ•ˆæœŸå°½é‡è®¾é•¿ä¸€ç‚¹ï¼Œå› ä¸ºä¸æ–¹ä¾¿æ›´æ–°æ¢ä»£ã€‚ä½†å¤ªé•¿äº†ä¹Ÿä¸åˆé€‚ï¼Œå®‰å…¨æ€§æ¯”è¾ƒå·®ã€‚ ## è¿™é‡Œè®¾äº† 10 å¹´ openssl req -x509 -new -SHA512 -key ca.key -subj \"/CN=Ryan4Yin's Root CA 1\" -days 3650 -out ca.crt # 3. ç”ŸæˆæœåŠ¡ç«¯è¯ä¹¦çš„ RSA ç§é’¥ï¼ˆ2048 ä½ï¼‰ openssl genrsa -out server.key 2048 # 4. é€šè¿‡ç¬¬ä¸€æ­¥ç¼–å†™çš„é…ç½®æ–‡ä»¶ï¼Œç”Ÿæˆè¯ä¹¦ç­¾åè¯·æ±‚ï¼ˆå…¬é’¥+ç”³è¯·è€…ä¿¡æ¯ï¼‰ openssl req -new -SHA512 -key server.key -out server.csr -config csr.conf # 5. ä½¿ç”¨ CA æ ¹è¯ä¹¦ç›´æ¥ç­¾å‘æœåŠ¡ç«¯è¯ä¹¦ï¼Œè¿™é‡ŒæŒ‡å®šæœåŠ¡ç«¯è¯ä¹¦çš„æœ‰æ•ˆæœŸä¸º 3650 å¤© openssl x509 -req -SHA512 -in server.csr -CA ca.crt -CAkey ca.key \\ -CAcreateserial -out server.crt -days 3650 \\ -extensions v3_ext -extfile csr.conf # 6. æŸ¥çœ‹ç”Ÿæˆçš„è¯ä¹¦é“¾ openssl x509 -in ca.crt -noout -text openssl x509 -in server.crt -noout -text ç®€å•èµ·è§è¿™é‡Œæ²¡æœ‰ç”Ÿæˆä¸­é—´è¯ä¹¦ï¼Œç›´æ¥ä½¿ç”¨æ ¹è¯ä¹¦ç­¾å‘äº†ç”¨äºå®‰å…¨é€šä¿¡çš„æœåŠ¡ç«¯è¯ä¹¦ã€‚ 2. ç”Ÿæˆ ECC è¯ä¹¦é“¾åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬å·²ç»ä»‹ç»è¿‡äº†ï¼ŒECC åŠ å¯†æ–¹æ¡ˆæ˜¯æ–°ä¸€ä»£éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œæ˜¯ RSA çš„ç»§ä»»è€…ï¼Œåœ¨å®‰å…¨æ€§ç›¸åŒçš„æƒ…å†µä¸‹ï¼ŒECC æ‹¥æœ‰æ¯” RSA æ›´å¿«çš„è®¡ç®—é€Ÿåº¦ã€æ›´å°‘çš„å†…å­˜ä»¥åŠæ›´çŸ­çš„å¯†é’¥é•¿åº¦ã€‚ å¯¹äº ECC åŠ å¯†æ–¹æ¡ˆè€Œè¨€ï¼Œä¸åŒçš„æ¤­åœ†æ›²çº¿ç”Ÿæˆçš„å¯†é’¥å¯¹æä¾›äº†ä¸åŒç¨‹åº¦çš„å®‰å…¨æ€§ã€‚å„ä¸ªç»„ç»‡ï¼ˆANSI X9.62ã€NISTã€SECGï¼‰å‘½åäº†å¤šç§æ›²çº¿ï¼Œå¯é€šè¿‡å¦‚ä¸‹å‘½åæŸ¥çœ‹ openssl æ”¯æŒçš„æ‰€æœ‰æ¤­åœ†æ›²çº¿åç§°: shell openssl ecparam -list_curves ç›®å‰ï¼ˆ2022 å¹´ï¼‰åœ¨ TLS åè®®ä»¥åŠ JWT ç­¾åç®—æ³•ä¸­ï¼Œåº”ç”¨æœ€å¹¿æ³›çš„æ¤­åœ†æ›²çº¿ä»ç„¶æ˜¯ NIST ç³»åˆ—ï¼š P-256: ç›®å‰ä»ç„¶åº”ç”¨æœ€ä¸ºå¹¿æ³›çš„æ¤­åœ†æ›²çº¿ åœ¨ openssl ä¸­å¯¹åº”çš„åç§°ä¸º prime256v1 P-384 åœ¨ openssl ä¸­å¯¹åº”çš„åç§°ä¸º secp384r1 P-521 åœ¨ openssl ä¸­å¯¹åº”çš„åç§°ä¸º secp521r1 ä½†æ˜¯æˆ‘ä»¬ä¹Ÿçœ‹åˆ° X25519(Curve25519) æ­£åœ¨è¶Šæ¥è¶Šæµè¡Œï¼Œå› ä¸ºç¾å›½æ”¿åºœæœ‰å‰ç§‘ ï¼ˆNSA åœ¨ RSA åŠ å¯†ç®—æ³•ä¸­å®‰ç½®åé—¨æ˜¯æ€ä¹ˆä¸€å›äº‹ï¼Œæœ‰ä½•å½±å“ï¼Ÿâ€”â€”çŸ¥ä¹ï¼‰ï¼ŒNIST æ ‡å‡†è¢«æ€€ç–‘å¯èƒ½æœ‰åé—¨ï¼Œç›®å‰å¾ˆå¤šäººéƒ½åœ¨æ¨åŠ¨ä½¿ç”¨ Curve25519 ç­‰ç¤¾åŒºæ–¹æ¡ˆå–ä»£æ‰ NIST æ ‡å‡†æ›²çº¿ã€‚é™äºç¯‡å¹…ï¼Œæ„Ÿå…´è¶£è¯·è‡ªè¡Œäº†è§£ã€‚ ç”Ÿæˆä¸€ä¸ªä½¿ç”¨ P-384 æ›²çº¿çš„ ECC è¯ä¹¦çš„ç¤ºä¾‹å¦‚ä¸‹: ç¼–å†™è¯ä¹¦ç­¾åè¯·æ±‚çš„é…ç½®æ–‡ä»¶ ecc-csr.confï¼ˆè·Ÿå‰é¢ RSA ä½¿ç”¨çš„é…ç½®æ–‡ä»¶æ²¡ä»»ä½•åŒºåˆ«ï¼‰: conf [ req ] prompt = no req_extensions = v3_ext distinguished_name = req_distinguished_name [ req_distinguished_name ] countryName = US stateOrProvinceName = NYK localityName = NYK organizationName = Ryan4Yin organizationalUnitName = Ryan4Yin commonName = writefor.fun # deprecated, use subjectAltName(SAN) instead emailAddress = rayn4yin@linux.com [ alt_names ] DNS.1 = writefor.fun DNS.2 = *.writefor.fun [ v3_ext ] subjectAltName=@alt_names basicConstraints = CA:false extendedKeyUsage = serverAuth æ­¤æ–‡ä»¶çš„è¯¦ç»†æ–‡æ¡£:OpenSSL file formats and conventions - OpenSSL 3.3 ç”Ÿæˆè¯ä¹¦é“¾ä¸æœåŠ¡ç«¯è¯ä¹¦: shell # 1. ç”Ÿæˆæœ¬åœ° CA æ ¹è¯ä¹¦çš„ç§é’¥ï¼Œä½¿ç”¨ P-384 æ›²çº¿ï¼Œå¯†é’¥é•¿åº¦ 384 ä½ openssl ecparam -genkey -name secp384r1 -out ecc-ca.key # 2. ä½¿ç”¨ç§é’¥ç­¾å‘å‡º CA æ ¹è¯ä¹¦ ## CA æ ¹è¯ä¹¦çš„æœ‰æ•ˆæœŸå°½é‡è®¾é•¿ä¸€ç‚¹ï¼Œå› ä¸ºä¸æ–¹ä¾¿æ›´æ–°æ¢ä»£ï¼Œè¿™é‡Œè®¾äº† 100 å¹´ openssl req -x509 -new -SHA512 -key ecc-ca.key -subj \"/CN=Ryan4Yin's Root CA 1\" -days 36500 -out ecc-ca.crt # 3. ç”ŸæˆæœåŠ¡ç«¯è¯ä¹¦çš„ EC ç§é’¥ï¼Œä½¿ç”¨ P-384 æ›²çº¿ï¼Œå¯†é’¥é•¿åº¦ 384 ä½ openssl ecparam -genkey -name secp384r1 -out ecc-server.key # 4. é€šè¿‡ç¬¬ä¸€æ­¥ç¼–å†™çš„é…ç½®æ–‡ä»¶ï¼Œç”Ÿæˆè¯ä¹¦ç­¾åè¯·æ±‚ï¼ˆå…¬é’¥+ç”³è¯·è€…ä¿¡æ¯ï¼‰ openssl req -new -SHA512 -key ecc-server.key -out ecc-server.csr -config ecc-csr.conf # 5. ä½¿ç”¨ CA æ ¹è¯ä¹¦ç›´æ¥ç­¾å‘ ECC æœåŠ¡ç«¯è¯ä¹¦ï¼Œè¿™é‡ŒæŒ‡å®šæœåŠ¡ç«¯è¯ä¹¦çš„æœ‰æ•ˆæœŸä¸º 3650 å¤© openssl x509 -req -SHA512 -in ecc-server.csr -CA ecc-ca.crt -CAkey ecc-ca.key \\ -CAcreateserial -out ecc-server.crt -days 3650 \\ -extension","date":"2022-03-14","objectID":"/posts/about-tls-cert/:3:5","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#5-ç”Ÿæˆè‡ªå·±çš„è¯ä¹¦é“¾"},{"categories":["tech"],"content":" 5. ç”Ÿæˆè‡ªå·±çš„è¯ä¹¦é“¾ OpenSSL æ˜¯ç›®å‰ä½¿ç”¨æœ€å¹¿æ³›çš„ç½‘ç»œåŠ å¯†ç®—æ³•åº“ï¼Œè¿™é‡Œä»¥å®ƒä¸ºä¾‹ä»‹ç»è¯ä¹¦çš„ç”Ÿæˆã€‚å¦å¤–ä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨ CloudFalre å¼€æºçš„ PKI å·¥å…·cfssl. å‰é¢ä»‹ç»äº†ï¼Œåœ¨å±€åŸŸç½‘é€šä¿¡ä¸­é€šå¸¸ä½¿ç”¨æœ¬åœ°è¯ä¹¦é“¾ï¼ˆç§æœ‰ PKIï¼‰æ¥ä¿éšœé€šä¿¡å®‰å…¨ï¼Œè¿™é€šå¸¸æœ‰å¦‚ä¸‹å‡ ä¸ªåŸå› ã€‚ åœ¨å†…ç½‘ç¯å¢ƒä¸‹ï¼Œç®¡ç†å‘˜å°†æœ¬åœ° CA è¯ä¹¦å®‰è£…åˆ°æ‰€æœ‰å±€åŸŸç½‘è®¾å¤‡ä¸Šï¼Œå› æ­¤å¹¶æ— å¿…è¦å‘æƒå¨ CA æœºæ„ç”³è¯·è¯ä¹¦ å†…ç½‘ç¯å¢ƒä½¿ç”¨çš„å¯èƒ½æ˜¯éå…¬ç½‘åŸŸåï¼ˆxxx.local/xxx.lan/xxx.srv ç­‰ï¼‰ï¼Œç”šè‡³å¯èƒ½ç›´æ¥ä½¿ç”¨å±€åŸŸç½‘ IP é€šä¿¡ï¼Œæƒå¨ CA æœºæ„ä¸ç­¾å‘è¿™ç§ç±»å‹çš„è¯ä¹¦ æœ¬åœ°è¯ä¹¦é“¾å®Œå…¨å—è‡ªå·±æ§åˆ¶ï¼Œå¯ä»¥è‡ªå·±è®¾ç½®å®‰å…¨å¼ºåº¦ã€è¯ä¹¦å¹´é™ç­‰ç­‰ï¼Œè€Œä¸”ä¸å—æƒå¨ CA æœºæ„å½±å“ã€‚ æƒå¨ CA æœºæ„ä¸ç­¾å‘å®¢æˆ·ç«¯è¯ä¹¦ï¼Œå› ä¸ºå®¢æˆ·ç«¯ä¸ä¸€å®šæœ‰å›ºå®šçš„ IP åœ°å€æˆ–è€…åŸŸåã€‚å®¢æˆ·ç«¯è¯ä¹¦éœ€è¦è‡ªå·±ç­¾å‘ã€‚ ä¸‹é¢ä»‹ç»ä¸‹å¦‚ä½•ä½¿ç”¨ OpenSSL ç”Ÿæˆä¸€ä¸ªæœ¬åœ° CA è¯ä¹¦é“¾ï¼Œå¹¶ç­¾å‘ç”¨äºå®‰å…¨é€šä¿¡çš„æœåŠ¡ç«¯è¯ä¹¦ï¼Œå¯ç”¨äº HTTPS/QUIC ç­‰åè®®ã€‚ 1. ç”Ÿæˆ RSA è¯ä¹¦é“¾åˆ°ç›®å‰ä¸ºæ­¢ RSA ä»ç„¶æ˜¯åº”ç”¨æœ€å¹¿æ³›çš„éå¯¹ç§°åŠ å¯†æ–¹æ¡ˆï¼Œå‡ ä¹æ‰€æœ‰çš„æ ¹è¯ä¹¦éƒ½æ˜¯ä½¿ç”¨çš„ 2048 ä½æˆ–è€… 4096 ä½çš„ RSA å¯†é’¥å¯¹ã€‚ å¯¹äº RSA ç®—æ³•è€Œè¨€ï¼Œè¶Šé•¿çš„å¯†é’¥èƒ½æä¾›è¶Šé«˜çš„å®‰å…¨æ€§ï¼Œå½“å‰ä½¿ç”¨æœ€å¤šçš„ RSA å¯†é’¥é•¿åº¦ä»ç„¶æ˜¯ 2048 ä½ï¼Œä½†æ˜¯ 2048 ä½å·²è¢«ä¸€äº›äººè®¤ä¸ºä¸å¤Ÿå®‰å…¨äº†ï¼Œå¯†ç å­¦å®¶æ›´å»ºè®®ä½¿ç”¨ 3072 ä½æˆ–è€… 4096 ä½çš„å¯†é’¥ã€‚ ç”Ÿæˆä¸€ä¸ª 2048 ä½çš„ RSA è¯ä¹¦é“¾çš„æµç¨‹å¦‚ä¸‹: OpenSSL çš„ CSR é…ç½®æ–‡ä»¶å®˜æ–¹æ–‡æ¡£:https://www.openssl.org/docs/manmaster/man1/openssl-req.html ç¼–å†™è¯ä¹¦ç­¾åè¯·æ±‚çš„é…ç½®æ–‡ä»¶ csr.conf: conf [ req ] prompt = no req_extensions = v3_ext distinguished_name = req_distinguished_name [ req_distinguished_name ] countryName = US stateOrProvinceName = NYK localityName = NYK organizationName = Ryan4Yin organizationalUnitName = Ryan4Yin commonName = writefor.fun # deprecated, use subjectAltName(SAN) instead emailAddress = rayn4yin@linux.com [ alt_names ] DNS.1 = writefor.fun DNS.2 = *.writefor.fun [ v3_ext ] subjectAltName=@alt_names basicConstraints = CA:false extendedKeyUsage = serverAuth æ­¤æ–‡ä»¶çš„è¯¦ç»†æ–‡æ¡£:OpenSSL file formats and conventions - OpenSSL 3.3 ç”Ÿæˆè¯ä¹¦é“¾ä¸æœåŠ¡ç«¯è¯ä¹¦: shell # 1. ç”Ÿæˆæœ¬åœ° CA æ ¹è¯ä¹¦çš„ç§é’¥ openssl genrsa -out ca.key 2048 # 2. ä½¿ç”¨ç§é’¥ç­¾å‘å‡º CA æ ¹è¯ä¹¦ ## CA æ ¹è¯ä¹¦çš„æœ‰æ•ˆæœŸå°½é‡è®¾é•¿ä¸€ç‚¹ï¼Œå› ä¸ºä¸æ–¹ä¾¿æ›´æ–°æ¢ä»£ã€‚ä½†å¤ªé•¿äº†ä¹Ÿä¸åˆé€‚ï¼Œå®‰å…¨æ€§æ¯”è¾ƒå·®ã€‚ ## è¿™é‡Œè®¾äº† 10 å¹´ openssl req -x509 -new -SHA512 -key ca.key -subj \"/CN=Ryan4Yin's Root CA 1\" -days 3650 -out ca.crt # 3. ç”ŸæˆæœåŠ¡ç«¯è¯ä¹¦çš„ RSA ç§é’¥ï¼ˆ2048 ä½ï¼‰ openssl genrsa -out server.key 2048 # 4. é€šè¿‡ç¬¬ä¸€æ­¥ç¼–å†™çš„é…ç½®æ–‡ä»¶ï¼Œç”Ÿæˆè¯ä¹¦ç­¾åè¯·æ±‚ï¼ˆå…¬é’¥+ç”³è¯·è€…ä¿¡æ¯ï¼‰ openssl req -new -SHA512 -key server.key -out server.csr -config csr.conf # 5. ä½¿ç”¨ CA æ ¹è¯ä¹¦ç›´æ¥ç­¾å‘æœåŠ¡ç«¯è¯ä¹¦ï¼Œè¿™é‡ŒæŒ‡å®šæœåŠ¡ç«¯è¯ä¹¦çš„æœ‰æ•ˆæœŸä¸º 3650 å¤© openssl x509 -req -SHA512 -in server.csr -CA ca.crt -CAkey ca.key \\ -CAcreateserial -out server.crt -days 3650 \\ -extensions v3_ext -extfile csr.conf # 6. æŸ¥çœ‹ç”Ÿæˆçš„è¯ä¹¦é“¾ openssl x509 -in ca.crt -noout -text openssl x509 -in server.crt -noout -text ç®€å•èµ·è§è¿™é‡Œæ²¡æœ‰ç”Ÿæˆä¸­é—´è¯ä¹¦ï¼Œç›´æ¥ä½¿ç”¨æ ¹è¯ä¹¦ç­¾å‘äº†ç”¨äºå®‰å…¨é€šä¿¡çš„æœåŠ¡ç«¯è¯ä¹¦ã€‚ 2. ç”Ÿæˆ ECC è¯ä¹¦é“¾åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬å·²ç»ä»‹ç»è¿‡äº†ï¼ŒECC åŠ å¯†æ–¹æ¡ˆæ˜¯æ–°ä¸€ä»£éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œæ˜¯ RSA çš„ç»§ä»»è€…ï¼Œåœ¨å®‰å…¨æ€§ç›¸åŒçš„æƒ…å†µä¸‹ï¼ŒECC æ‹¥æœ‰æ¯” RSA æ›´å¿«çš„è®¡ç®—é€Ÿåº¦ã€æ›´å°‘çš„å†…å­˜ä»¥åŠæ›´çŸ­çš„å¯†é’¥é•¿åº¦ã€‚ å¯¹äº ECC åŠ å¯†æ–¹æ¡ˆè€Œè¨€ï¼Œä¸åŒçš„æ¤­åœ†æ›²çº¿ç”Ÿæˆçš„å¯†é’¥å¯¹æä¾›äº†ä¸åŒç¨‹åº¦çš„å®‰å…¨æ€§ã€‚å„ä¸ªç»„ç»‡ï¼ˆANSI X9.62ã€NISTã€SECGï¼‰å‘½åäº†å¤šç§æ›²çº¿ï¼Œå¯é€šè¿‡å¦‚ä¸‹å‘½åæŸ¥çœ‹ openssl æ”¯æŒçš„æ‰€æœ‰æ¤­åœ†æ›²çº¿åç§°: shell openssl ecparam -list_curves ç›®å‰ï¼ˆ2022 å¹´ï¼‰åœ¨ TLS åè®®ä»¥åŠ JWT ç­¾åç®—æ³•ä¸­ï¼Œåº”ç”¨æœ€å¹¿æ³›çš„æ¤­åœ†æ›²çº¿ä»ç„¶æ˜¯ NIST ç³»åˆ—ï¼š P-256: ç›®å‰ä»ç„¶åº”ç”¨æœ€ä¸ºå¹¿æ³›çš„æ¤­åœ†æ›²çº¿ åœ¨ openssl ä¸­å¯¹åº”çš„åç§°ä¸º prime256v1 P-384 åœ¨ openssl ä¸­å¯¹åº”çš„åç§°ä¸º secp384r1 P-521 åœ¨ openssl ä¸­å¯¹åº”çš„åç§°ä¸º secp521r1 ä½†æ˜¯æˆ‘ä»¬ä¹Ÿçœ‹åˆ° X25519(Curve25519) æ­£åœ¨è¶Šæ¥è¶Šæµè¡Œï¼Œå› ä¸ºç¾å›½æ”¿åºœæœ‰å‰ç§‘ ï¼ˆNSA åœ¨ RSA åŠ å¯†ç®—æ³•ä¸­å®‰ç½®åé—¨æ˜¯æ€ä¹ˆä¸€å›äº‹ï¼Œæœ‰ä½•å½±å“ï¼Ÿâ€”â€”çŸ¥ä¹ï¼‰ï¼ŒNIST æ ‡å‡†è¢«æ€€ç–‘å¯èƒ½æœ‰åé—¨ï¼Œç›®å‰å¾ˆå¤šäººéƒ½åœ¨æ¨åŠ¨ä½¿ç”¨ Curve25519 ç­‰ç¤¾åŒºæ–¹æ¡ˆå–ä»£æ‰ NIST æ ‡å‡†æ›²çº¿ã€‚é™äºç¯‡å¹…ï¼Œæ„Ÿå…´è¶£è¯·è‡ªè¡Œäº†è§£ã€‚ ç”Ÿæˆä¸€ä¸ªä½¿ç”¨ P-384 æ›²çº¿çš„ ECC è¯ä¹¦çš„ç¤ºä¾‹å¦‚ä¸‹: ç¼–å†™è¯ä¹¦ç­¾åè¯·æ±‚çš„é…ç½®æ–‡ä»¶ ecc-csr.confï¼ˆè·Ÿå‰é¢ RSA ä½¿ç”¨çš„é…ç½®æ–‡ä»¶æ²¡ä»»ä½•åŒºåˆ«ï¼‰: conf [ req ] prompt = no req_extensions = v3_ext distinguished_name = req_distinguished_name [ req_distinguished_name ] countryName = US stateOrProvinceName = NYK localityName = NYK organizationName = Ryan4Yin organizationalUnitName = Ryan4Yin commonName = writefor.fun # deprecated, use subjectAltName(SAN) instead emailAddress = rayn4yin@linux.com [ alt_names ] DNS.1 = writefor.fun DNS.2 = *.writefor.fun [ v3_ext ] subjectAltName=@alt_names basicConstraints = CA:false extendedKeyUsage = serverAuth æ­¤æ–‡ä»¶çš„è¯¦ç»†æ–‡æ¡£:OpenSSL file formats and conventions - OpenSSL 3.3 ç”Ÿæˆè¯ä¹¦é“¾ä¸æœåŠ¡ç«¯è¯ä¹¦: shell # 1. ç”Ÿæˆæœ¬åœ° CA æ ¹è¯ä¹¦çš„ç§é’¥ï¼Œä½¿ç”¨ P-384 æ›²çº¿ï¼Œå¯†é’¥é•¿åº¦ 384 ä½ openssl ecparam -genkey -name secp384r1 -out ecc-ca.key # 2. ä½¿ç”¨ç§é’¥ç­¾å‘å‡º CA æ ¹è¯ä¹¦ ## CA æ ¹è¯ä¹¦çš„æœ‰æ•ˆæœŸå°½é‡è®¾é•¿ä¸€ç‚¹ï¼Œå› ä¸ºä¸æ–¹ä¾¿æ›´æ–°æ¢ä»£ï¼Œè¿™é‡Œè®¾äº† 100 å¹´ openssl req -x509 -new -SHA512 -key ecc-ca.key -subj \"/CN=Ryan4Yin's Root CA 1\" -days 36500 -out ecc-ca.crt # 3. ç”ŸæˆæœåŠ¡ç«¯è¯ä¹¦çš„ EC ç§é’¥ï¼Œä½¿ç”¨ P-384 æ›²çº¿ï¼Œå¯†é’¥é•¿åº¦ 384 ä½ openssl ecparam -genkey -name secp384r1 -out ecc-server.key # 4. é€šè¿‡ç¬¬ä¸€æ­¥ç¼–å†™çš„é…ç½®æ–‡ä»¶ï¼Œç”Ÿæˆè¯ä¹¦ç­¾åè¯·æ±‚ï¼ˆå…¬é’¥+ç”³è¯·è€…ä¿¡æ¯ï¼‰ openssl req -new -SHA512 -key ecc-server.key -out ecc-server.csr -config ecc-csr.conf # 5. ä½¿ç”¨ CA æ ¹è¯ä¹¦ç›´æ¥ç­¾å‘ ECC æœåŠ¡ç«¯è¯ä¹¦ï¼Œè¿™é‡ŒæŒ‡å®šæœåŠ¡ç«¯è¯ä¹¦çš„æœ‰æ•ˆæœŸä¸º 3650 å¤© openssl x509 -req -SHA512 -in ecc-server.csr -CA ecc-ca.crt -CAkey ecc-ca.key \\ -CAcreateserial -out ecc-server.crt -days 3650 \\ -extension","date":"2022-03-14","objectID":"/posts/about-tls-cert/:3:5","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#1-ç”Ÿæˆ-rsa-è¯ä¹¦é“¾"},{"categories":["tech"],"content":" 5. ç”Ÿæˆè‡ªå·±çš„è¯ä¹¦é“¾ OpenSSL æ˜¯ç›®å‰ä½¿ç”¨æœ€å¹¿æ³›çš„ç½‘ç»œåŠ å¯†ç®—æ³•åº“ï¼Œè¿™é‡Œä»¥å®ƒä¸ºä¾‹ä»‹ç»è¯ä¹¦çš„ç”Ÿæˆã€‚å¦å¤–ä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨ CloudFalre å¼€æºçš„ PKI å·¥å…·cfssl. å‰é¢ä»‹ç»äº†ï¼Œåœ¨å±€åŸŸç½‘é€šä¿¡ä¸­é€šå¸¸ä½¿ç”¨æœ¬åœ°è¯ä¹¦é“¾ï¼ˆç§æœ‰ PKIï¼‰æ¥ä¿éšœé€šä¿¡å®‰å…¨ï¼Œè¿™é€šå¸¸æœ‰å¦‚ä¸‹å‡ ä¸ªåŸå› ã€‚ åœ¨å†…ç½‘ç¯å¢ƒä¸‹ï¼Œç®¡ç†å‘˜å°†æœ¬åœ° CA è¯ä¹¦å®‰è£…åˆ°æ‰€æœ‰å±€åŸŸç½‘è®¾å¤‡ä¸Šï¼Œå› æ­¤å¹¶æ— å¿…è¦å‘æƒå¨ CA æœºæ„ç”³è¯·è¯ä¹¦ å†…ç½‘ç¯å¢ƒä½¿ç”¨çš„å¯èƒ½æ˜¯éå…¬ç½‘åŸŸåï¼ˆxxx.local/xxx.lan/xxx.srv ç­‰ï¼‰ï¼Œç”šè‡³å¯èƒ½ç›´æ¥ä½¿ç”¨å±€åŸŸç½‘ IP é€šä¿¡ï¼Œæƒå¨ CA æœºæ„ä¸ç­¾å‘è¿™ç§ç±»å‹çš„è¯ä¹¦ æœ¬åœ°è¯ä¹¦é“¾å®Œå…¨å—è‡ªå·±æ§åˆ¶ï¼Œå¯ä»¥è‡ªå·±è®¾ç½®å®‰å…¨å¼ºåº¦ã€è¯ä¹¦å¹´é™ç­‰ç­‰ï¼Œè€Œä¸”ä¸å—æƒå¨ CA æœºæ„å½±å“ã€‚ æƒå¨ CA æœºæ„ä¸ç­¾å‘å®¢æˆ·ç«¯è¯ä¹¦ï¼Œå› ä¸ºå®¢æˆ·ç«¯ä¸ä¸€å®šæœ‰å›ºå®šçš„ IP åœ°å€æˆ–è€…åŸŸåã€‚å®¢æˆ·ç«¯è¯ä¹¦éœ€è¦è‡ªå·±ç­¾å‘ã€‚ ä¸‹é¢ä»‹ç»ä¸‹å¦‚ä½•ä½¿ç”¨ OpenSSL ç”Ÿæˆä¸€ä¸ªæœ¬åœ° CA è¯ä¹¦é“¾ï¼Œå¹¶ç­¾å‘ç”¨äºå®‰å…¨é€šä¿¡çš„æœåŠ¡ç«¯è¯ä¹¦ï¼Œå¯ç”¨äº HTTPS/QUIC ç­‰åè®®ã€‚ 1. ç”Ÿæˆ RSA è¯ä¹¦é“¾åˆ°ç›®å‰ä¸ºæ­¢ RSA ä»ç„¶æ˜¯åº”ç”¨æœ€å¹¿æ³›çš„éå¯¹ç§°åŠ å¯†æ–¹æ¡ˆï¼Œå‡ ä¹æ‰€æœ‰çš„æ ¹è¯ä¹¦éƒ½æ˜¯ä½¿ç”¨çš„ 2048 ä½æˆ–è€… 4096 ä½çš„ RSA å¯†é’¥å¯¹ã€‚ å¯¹äº RSA ç®—æ³•è€Œè¨€ï¼Œè¶Šé•¿çš„å¯†é’¥èƒ½æä¾›è¶Šé«˜çš„å®‰å…¨æ€§ï¼Œå½“å‰ä½¿ç”¨æœ€å¤šçš„ RSA å¯†é’¥é•¿åº¦ä»ç„¶æ˜¯ 2048 ä½ï¼Œä½†æ˜¯ 2048 ä½å·²è¢«ä¸€äº›äººè®¤ä¸ºä¸å¤Ÿå®‰å…¨äº†ï¼Œå¯†ç å­¦å®¶æ›´å»ºè®®ä½¿ç”¨ 3072 ä½æˆ–è€… 4096 ä½çš„å¯†é’¥ã€‚ ç”Ÿæˆä¸€ä¸ª 2048 ä½çš„ RSA è¯ä¹¦é“¾çš„æµç¨‹å¦‚ä¸‹: OpenSSL çš„ CSR é…ç½®æ–‡ä»¶å®˜æ–¹æ–‡æ¡£:https://www.openssl.org/docs/manmaster/man1/openssl-req.html ç¼–å†™è¯ä¹¦ç­¾åè¯·æ±‚çš„é…ç½®æ–‡ä»¶ csr.conf: conf [ req ] prompt = no req_extensions = v3_ext distinguished_name = req_distinguished_name [ req_distinguished_name ] countryName = US stateOrProvinceName = NYK localityName = NYK organizationName = Ryan4Yin organizationalUnitName = Ryan4Yin commonName = writefor.fun # deprecated, use subjectAltName(SAN) instead emailAddress = rayn4yin@linux.com [ alt_names ] DNS.1 = writefor.fun DNS.2 = *.writefor.fun [ v3_ext ] subjectAltName=@alt_names basicConstraints = CA:false extendedKeyUsage = serverAuth æ­¤æ–‡ä»¶çš„è¯¦ç»†æ–‡æ¡£:OpenSSL file formats and conventions - OpenSSL 3.3 ç”Ÿæˆè¯ä¹¦é“¾ä¸æœåŠ¡ç«¯è¯ä¹¦: shell # 1. ç”Ÿæˆæœ¬åœ° CA æ ¹è¯ä¹¦çš„ç§é’¥ openssl genrsa -out ca.key 2048 # 2. ä½¿ç”¨ç§é’¥ç­¾å‘å‡º CA æ ¹è¯ä¹¦ ## CA æ ¹è¯ä¹¦çš„æœ‰æ•ˆæœŸå°½é‡è®¾é•¿ä¸€ç‚¹ï¼Œå› ä¸ºä¸æ–¹ä¾¿æ›´æ–°æ¢ä»£ã€‚ä½†å¤ªé•¿äº†ä¹Ÿä¸åˆé€‚ï¼Œå®‰å…¨æ€§æ¯”è¾ƒå·®ã€‚ ## è¿™é‡Œè®¾äº† 10 å¹´ openssl req -x509 -new -SHA512 -key ca.key -subj \"/CN=Ryan4Yin's Root CA 1\" -days 3650 -out ca.crt # 3. ç”ŸæˆæœåŠ¡ç«¯è¯ä¹¦çš„ RSA ç§é’¥ï¼ˆ2048 ä½ï¼‰ openssl genrsa -out server.key 2048 # 4. é€šè¿‡ç¬¬ä¸€æ­¥ç¼–å†™çš„é…ç½®æ–‡ä»¶ï¼Œç”Ÿæˆè¯ä¹¦ç­¾åè¯·æ±‚ï¼ˆå…¬é’¥+ç”³è¯·è€…ä¿¡æ¯ï¼‰ openssl req -new -SHA512 -key server.key -out server.csr -config csr.conf # 5. ä½¿ç”¨ CA æ ¹è¯ä¹¦ç›´æ¥ç­¾å‘æœåŠ¡ç«¯è¯ä¹¦ï¼Œè¿™é‡ŒæŒ‡å®šæœåŠ¡ç«¯è¯ä¹¦çš„æœ‰æ•ˆæœŸä¸º 3650 å¤© openssl x509 -req -SHA512 -in server.csr -CA ca.crt -CAkey ca.key \\ -CAcreateserial -out server.crt -days 3650 \\ -extensions v3_ext -extfile csr.conf # 6. æŸ¥çœ‹ç”Ÿæˆçš„è¯ä¹¦é“¾ openssl x509 -in ca.crt -noout -text openssl x509 -in server.crt -noout -text ç®€å•èµ·è§è¿™é‡Œæ²¡æœ‰ç”Ÿæˆä¸­é—´è¯ä¹¦ï¼Œç›´æ¥ä½¿ç”¨æ ¹è¯ä¹¦ç­¾å‘äº†ç”¨äºå®‰å…¨é€šä¿¡çš„æœåŠ¡ç«¯è¯ä¹¦ã€‚ 2. ç”Ÿæˆ ECC è¯ä¹¦é“¾åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬å·²ç»ä»‹ç»è¿‡äº†ï¼ŒECC åŠ å¯†æ–¹æ¡ˆæ˜¯æ–°ä¸€ä»£éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œæ˜¯ RSA çš„ç»§ä»»è€…ï¼Œåœ¨å®‰å…¨æ€§ç›¸åŒçš„æƒ…å†µä¸‹ï¼ŒECC æ‹¥æœ‰æ¯” RSA æ›´å¿«çš„è®¡ç®—é€Ÿåº¦ã€æ›´å°‘çš„å†…å­˜ä»¥åŠæ›´çŸ­çš„å¯†é’¥é•¿åº¦ã€‚ å¯¹äº ECC åŠ å¯†æ–¹æ¡ˆè€Œè¨€ï¼Œä¸åŒçš„æ¤­åœ†æ›²çº¿ç”Ÿæˆçš„å¯†é’¥å¯¹æä¾›äº†ä¸åŒç¨‹åº¦çš„å®‰å…¨æ€§ã€‚å„ä¸ªç»„ç»‡ï¼ˆANSI X9.62ã€NISTã€SECGï¼‰å‘½åäº†å¤šç§æ›²çº¿ï¼Œå¯é€šè¿‡å¦‚ä¸‹å‘½åæŸ¥çœ‹ openssl æ”¯æŒçš„æ‰€æœ‰æ¤­åœ†æ›²çº¿åç§°: shell openssl ecparam -list_curves ç›®å‰ï¼ˆ2022 å¹´ï¼‰åœ¨ TLS åè®®ä»¥åŠ JWT ç­¾åç®—æ³•ä¸­ï¼Œåº”ç”¨æœ€å¹¿æ³›çš„æ¤­åœ†æ›²çº¿ä»ç„¶æ˜¯ NIST ç³»åˆ—ï¼š P-256: ç›®å‰ä»ç„¶åº”ç”¨æœ€ä¸ºå¹¿æ³›çš„æ¤­åœ†æ›²çº¿ åœ¨ openssl ä¸­å¯¹åº”çš„åç§°ä¸º prime256v1 P-384 åœ¨ openssl ä¸­å¯¹åº”çš„åç§°ä¸º secp384r1 P-521 åœ¨ openssl ä¸­å¯¹åº”çš„åç§°ä¸º secp521r1 ä½†æ˜¯æˆ‘ä»¬ä¹Ÿçœ‹åˆ° X25519(Curve25519) æ­£åœ¨è¶Šæ¥è¶Šæµè¡Œï¼Œå› ä¸ºç¾å›½æ”¿åºœæœ‰å‰ç§‘ ï¼ˆNSA åœ¨ RSA åŠ å¯†ç®—æ³•ä¸­å®‰ç½®åé—¨æ˜¯æ€ä¹ˆä¸€å›äº‹ï¼Œæœ‰ä½•å½±å“ï¼Ÿâ€”â€”çŸ¥ä¹ï¼‰ï¼ŒNIST æ ‡å‡†è¢«æ€€ç–‘å¯èƒ½æœ‰åé—¨ï¼Œç›®å‰å¾ˆå¤šäººéƒ½åœ¨æ¨åŠ¨ä½¿ç”¨ Curve25519 ç­‰ç¤¾åŒºæ–¹æ¡ˆå–ä»£æ‰ NIST æ ‡å‡†æ›²çº¿ã€‚é™äºç¯‡å¹…ï¼Œæ„Ÿå…´è¶£è¯·è‡ªè¡Œäº†è§£ã€‚ ç”Ÿæˆä¸€ä¸ªä½¿ç”¨ P-384 æ›²çº¿çš„ ECC è¯ä¹¦çš„ç¤ºä¾‹å¦‚ä¸‹: ç¼–å†™è¯ä¹¦ç­¾åè¯·æ±‚çš„é…ç½®æ–‡ä»¶ ecc-csr.confï¼ˆè·Ÿå‰é¢ RSA ä½¿ç”¨çš„é…ç½®æ–‡ä»¶æ²¡ä»»ä½•åŒºåˆ«ï¼‰: conf [ req ] prompt = no req_extensions = v3_ext distinguished_name = req_distinguished_name [ req_distinguished_name ] countryName = US stateOrProvinceName = NYK localityName = NYK organizationName = Ryan4Yin organizationalUnitName = Ryan4Yin commonName = writefor.fun # deprecated, use subjectAltName(SAN) instead emailAddress = rayn4yin@linux.com [ alt_names ] DNS.1 = writefor.fun DNS.2 = *.writefor.fun [ v3_ext ] subjectAltName=@alt_names basicConstraints = CA:false extendedKeyUsage = serverAuth æ­¤æ–‡ä»¶çš„è¯¦ç»†æ–‡æ¡£:OpenSSL file formats and conventions - OpenSSL 3.3 ç”Ÿæˆè¯ä¹¦é“¾ä¸æœåŠ¡ç«¯è¯ä¹¦: shell # 1. ç”Ÿæˆæœ¬åœ° CA æ ¹è¯ä¹¦çš„ç§é’¥ï¼Œä½¿ç”¨ P-384 æ›²çº¿ï¼Œå¯†é’¥é•¿åº¦ 384 ä½ openssl ecparam -genkey -name secp384r1 -out ecc-ca.key # 2. ä½¿ç”¨ç§é’¥ç­¾å‘å‡º CA æ ¹è¯ä¹¦ ## CA æ ¹è¯ä¹¦çš„æœ‰æ•ˆæœŸå°½é‡è®¾é•¿ä¸€ç‚¹ï¼Œå› ä¸ºä¸æ–¹ä¾¿æ›´æ–°æ¢ä»£ï¼Œè¿™é‡Œè®¾äº† 100 å¹´ openssl req -x509 -new -SHA512 -key ecc-ca.key -subj \"/CN=Ryan4Yin's Root CA 1\" -days 36500 -out ecc-ca.crt # 3. ç”ŸæˆæœåŠ¡ç«¯è¯ä¹¦çš„ EC ç§é’¥ï¼Œä½¿ç”¨ P-384 æ›²çº¿ï¼Œå¯†é’¥é•¿åº¦ 384 ä½ openssl ecparam -genkey -name secp384r1 -out ecc-server.key # 4. é€šè¿‡ç¬¬ä¸€æ­¥ç¼–å†™çš„é…ç½®æ–‡ä»¶ï¼Œç”Ÿæˆè¯ä¹¦ç­¾åè¯·æ±‚ï¼ˆå…¬é’¥+ç”³è¯·è€…ä¿¡æ¯ï¼‰ openssl req -new -SHA512 -key ecc-server.key -out ecc-server.csr -config ecc-csr.conf # 5. ä½¿ç”¨ CA æ ¹è¯ä¹¦ç›´æ¥ç­¾å‘ ECC æœåŠ¡ç«¯è¯ä¹¦ï¼Œè¿™é‡ŒæŒ‡å®šæœåŠ¡ç«¯è¯ä¹¦çš„æœ‰æ•ˆæœŸä¸º 3650 å¤© openssl x509 -req -SHA512 -in ecc-server.csr -CA ecc-ca.crt -CAkey ecc-ca.key \\ -CAcreateserial -out ecc-server.crt -days 3650 \\ -extension","date":"2022-03-14","objectID":"/posts/about-tls-cert/:3:5","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#2-ç”Ÿæˆ-ecc-è¯ä¹¦é“¾"},{"categories":["tech"],"content":" 6. è¯ä¹¦çš„ç±»å‹æŒ‰ç…§æ•°å­—è¯ä¹¦çš„ç”Ÿæˆæ–¹å¼è¿›è¡Œåˆ†ç±»ï¼Œè¯ä¹¦æœ‰ä¸‰ç§ç±»å‹: å…¬ç½‘å—ä¿¡ä»»è¯ä¹¦ æˆ–è€…å« Web PKI è¯ä¹¦: å³ç”±æƒå¨è¯ä¹¦è®¤è¯æœºæ„ç­¾åçš„çš„è¯ä¹¦ã€‚ å‡ ä¹æ‰€æœ‰ç»ˆç«¯éƒ½é¢„è£…äº†è¿™äº›æƒå¨è¯ä¹¦è®¤è¯æœºæ„ï¼ˆCAï¼‰çš„æ ¹è¯ä¹¦ï¼Œå› æ­¤è¿™ç±»è¯ä¹¦ä¼šè¢«æµè§ˆå™¨ã€å°ç¨‹åºç­‰ç¬¬ä¸‰æ–¹åº”ç”¨/æœåŠ¡å•†éªŒè¯å¹¶ä¿¡ä»»ã€‚ ç”³è¯·è¯ä¹¦æ—¶éœ€è¦éªŒè¯ä½ å¯¹åŸŸå/IP çš„æ‰€æœ‰æƒï¼Œä¹Ÿå°±ä½¿è¯ä¹¦æ— æ³•ä¼ªé€  å¦‚æœä½ çš„ API éœ€è¦æä¾›ç»™ç¬¬ä¸‰æ–¹åº”ç”¨/æœåŠ¡å•†/ç”¨æˆ·è®¿é—®ï¼Œé‚£å°±éœ€è¦å‘æƒå¨ CA æœºæ„ç”³è¯·æ­¤ç±»è¯ä¹¦ æœ¬åœ°ç­¾åè¯ä¹¦: å³ç”±æœ¬åœ° CA è¯ä¹¦ç­¾åçš„æ•°å­—è¯ä¹¦ æœ¬åœ° CA è¯ä¹¦ï¼Œå°±æ˜¯è‡ªå·±ä½¿ç”¨ openssl ç­‰å·¥å…·ç”Ÿæˆçš„ CA è¯ä¹¦ è¿™ç±»è¯ä¹¦çš„ç¼ºç‚¹æ˜¯æ— æ³•ä¸ç¬¬ä¸‰æ–¹åº”ç”¨/æœåŠ¡å•†å»ºç«‹å®‰å…¨çš„è¿æ¥ å¦‚æœå®¢æˆ·ç«¯æ˜¯å®Œå…¨å¯æ§çš„ï¼ˆæ¯”å¦‚æ˜¯è‡ªå®¶çš„ APPï¼Œæˆ–è€…æ˜¯æ¥å…¥äº†åŸŸæ§çš„ä¼ä¸šå±€åŸŸç½‘è®¾å¤‡ï¼‰ï¼Œå®Œå…¨å¯ä»¥åœ¨æ‰€æœ‰å®¢æˆ·ç«¯éƒ½å®‰è£…ä¸Šè‡ªå·±ç”Ÿæˆçš„ CA è¯ä¹¦ã€‚è¿™ç§åœºæ™¯ä¸‹ä½¿ç”¨æ­¤ç±»è¯ä¹¦æ˜¯å®‰å…¨å¯é çš„ï¼Œå¯ä»¥ä¸å‘æƒå¨ CA æœºæ„ç”³è¯·è¯ä¹¦ è‡ªç­¾åè¯ä¹¦: å‰é¢ä»‹ç»äº†æ ¹è¯ä¹¦æ˜¯ä¸€ä¸ªè‡ªç­¾åè¯ä¹¦ï¼Œå®ƒä½¿ç”¨æ ¹è¯ä¹¦çš„ç§é’¥ä¸ºæ ¹è¯ä¹¦ç­¾å è¿™é‡Œçš„ã€Œè‡ªç­¾åè¯ä¹¦ã€æ˜¯æŒ‡ç›´æ¥ä½¿ç”¨æ ¹è¯ä¹¦è¿›è¡Œç½‘ç»œé€šè®¯ï¼Œç¼ºç‚¹æ˜¯è¯ä¹¦çš„æ›´æ–°è¿­ä»£ä¼šå¾ˆéº»çƒ¦ï¼Œè€Œä¸”å®‰å…¨æ€§ä½ã€‚ æ€»çš„æ¥è¯´ï¼Œæƒå¨ CA æœºæ„é¢å‘çš„ã€Œå…¬ç½‘å—ä¿¡ä»»è¯ä¹¦ã€ï¼Œå¯ä»¥è¢«ç¬¬ä¸‰æ–¹åº”ç”¨ä¿¡ä»»ï¼Œä½†æ˜¯è‡ªå·±ç”Ÿæˆçš„ä¸è¡Œã€‚è€Œè¶Šè´µçš„æƒå¨è¯ä¹¦ï¼Œå®‰å…¨æ€§ä¸å¯ä¿¡åº¦å°±è¶Šé«˜ï¼Œæˆ–è€…å¯ä»¥ä¿æŠ¤æ›´å¤šçš„åŸŸåã€‚ åœ¨å®¢æˆ·ç«¯å¯æ§çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥è€ƒè™‘è‡ªå·±ç”Ÿæˆè¯ä¹¦é“¾å¹¶ç­¾å‘ã€Œæœ¬åœ°ç­¾åè¯ä¹¦ã€ï¼Œå°†æœ¬åœ° CA è¯ä¹¦é¢„å…ˆå®‰è£…åœ¨å®¢æˆ·ç«¯ä¸­ç”¨äºéªŒè¯ã€‚ è€Œã€Œè‡ªç­¾åè¯ä¹¦ã€ä¸»è¦æ˜¯ç”Ÿæˆæ–¹ä¾¿ï¼Œèƒ½ä¸ç”¨è¿˜æ˜¯å°½é‡ä¸è¦ä½¿ç”¨ã€‚ ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:3:6","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#6-è¯ä¹¦çš„ç±»å‹"},{"categories":["tech"],"content":" 7. å‘æƒå¨ CA æœºæ„ç”³è¯·ã€Œå…¬ç½‘å—ä¿¡ä»»è¯ä¹¦ã€å‘æƒå¨æœºæ„ç”³è¯·çš„å…¬ç½‘å—ä¿¡ä»»è¯ä¹¦ï¼Œå¯ä»¥ç›´æ¥åº”ç”¨åœ¨è¾¹ç•Œç½‘å…³ä¸Šï¼Œç”¨äºç»™å…¬ç½‘ç”¨æˆ·æä¾› TLS åŠ å¯†è®¿é—®æœåŠ¡ï¼Œæ¯”å¦‚å„ç§ HTTPS ç«™ç‚¹ã€APIã€‚è¿™æ˜¯éœ€æ±‚æœ€å¹¿çš„ä¸€ç±»æ•°å­—è¯ä¹¦æœåŠ¡ã€‚ è€Œè¯ä¹¦çš„ç”³è¯·ä¸ç®¡ç†æ–¹å¼åˆåˆ†ä¸ºä¸¤ç§ï¼š é€šè¿‡ACMEv2ï¼ˆAutomated Certificate Management Environment (ACME) åè®®è¿›è¡Œè¯ä¹¦çš„è‡ªåŠ¨åŒ–ç”³è¯·ä¸ç®¡ç†ã€‚æœ‰è®¸å¤šæƒå¨æœºæ„æ”¯æŒä½¿ç”¨æ­¤å¼€æ”¾åè®®ç”³è¯·è¯ä¹¦ï¼ŒæŒ‰æ˜¯å¦æ”¶è´¹å¯åˆ†ä¸ºå¦‚ä¸‹ä¸¤ç±»ï¼š å…è´¹æœåŠ¡ Letâ€™s Encrypt: ä¼—æ‰€å‘¨çŸ¥ï¼Œå®ƒæä¾›ä¸‰ä¸ªæœˆæœ‰æ•ˆæœŸçš„å…è´¹è¯ä¹¦ã€‚ ZeroSSL: ä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒæœ‰åçš„ SSL è¯ä¹¦æœåŠ¡ï¼Œå®ƒæ—¢æœ‰å…è´¹æœåŠ¡ï¼Œä¹Ÿæœ‰ä»˜è´¹æœåŠ¡ã€‚ é€šè¿‡ ACME åè®®æ”¯æŒä¸é™æ•°é‡çš„ 90 å¤©è¯ä¹¦ï¼Œä¹Ÿæ”¯æŒå¤šåŸŸåè¯ä¹¦ä¸æ³›åŸŸåè¯ä¹¦ã€‚ å®ƒç›¸æ¯” Letâ€™s Encrypt çš„ä¼˜åŠ¿æ˜¯ï¼Œå®ƒæä¾›ä¸€ä¸ªè¯ä¹¦æ§åˆ¶å°ï¼Œå¯ä»¥æŸ¥çœ‹ä¸ç®¡ç†ç”¨æˆ·å½“å‰çš„æ‰€æœ‰è¯ä¹¦ï¼Œäº†è§£å…¶çŠ¶æ€ã€‚ ä»˜è´¹æœåŠ¡ DigiCert: è¿™ä¸ªéå¸¸æœ‰åï¼ˆä½†ä¹Ÿæ˜¯ç›¸å½“è´µï¼‰ï¼Œå®˜æ–¹æ–‡æ¡£Digicert - Third-party ACME client automation Google Trust Services: Google æ¨å‡ºçš„å…¬ç½‘è¯ä¹¦æœåŠ¡ï¼Œä¹Ÿæ˜¯ä¸‰ä¸ªæœˆæœ‰æ•ˆæœŸï¼Œå…¶æ ¹è¯ä¹¦äº¤å‰éªŒè¯äº† GlobalSignã€‚å®˜æ–¹æ–‡æ¡£Automate Public Certificates Lifecycle Management via RFC 8555 (ACME) Entrust: å®˜æ–¹æ–‡æ¡£Entrustâ€™s ACME implementation GlobalSign: å®˜æ–¹æ–‡æ¡£GlobalSign ACME Service ACME ç›¸å…³çš„è‡ªåŠ¨åŒ–å·¥å…· å¾ˆå¤šä»£ç†å·¥å…·éƒ½æœ‰æä¾›åŸºäº ACMEv2 åè®®çš„è¯ä¹¦ç”³è¯·ä¸è‡ªåŠ¨æ›´æ–°ï¼Œæ¯”å¦‚: Traefik Caddy docker-letsencrypt-nginx-proxy-companion ç½‘ä¸Šä¹Ÿæœ‰ä¸€äº› certbot æ’ä»¶ï¼Œå¯ä»¥é€šè¿‡ DNS æä¾›å•†çš„ API è¿›è¡Œ ACMEv2 è¯ä¹¦çš„ç”³è¯·ä¸è‡ªåŠ¨æ›´æ–°ï¼Œæ¯”å¦‚: certbot-dns-aliyun terraform ä¹Ÿæœ‰ç›¸å…³ provider:terraform-provider-acme cert-manager: kubernetes ä¸­çš„è¯ä¹¦ç®¡ç†å·¥å…·ï¼Œæ”¯æŒ ACMEv2ï¼Œä¹Ÿæ”¯æŒåˆ›å»ºä¸ç®¡ç†ç§æœ‰è¯ä¹¦ã€‚æˆ‘å†™è¿‡ä¸€ç¯‡æ–‡ç« ä»‹ç»æ­¤å·¥å…·çš„ä½¿ç”¨Kubernetes ä¸­çš„è¯ä¹¦ç®¡ç†å·¥å…· - cert-manager é€šè¿‡ä¸€äº›æƒå¨ CA æœºæ„æˆ–ä»£ç†å•†æä¾›çš„ Web ç½‘ç«™ï¼Œæ‰‹åŠ¨å¡«å†™ä¿¡æ¯æ¥ç”³è¯·ä¸æ›´æ–°è¯ä¹¦ã€‚ è¿™ä¸ªæµç¨‹ç›¸å¯¹ä¼šæ¯”è¾ƒç¹çã€‚ è¿™äº›æƒå¨æœºæ„æä¾›çš„è¯ä¹¦æœåŠ¡ï¼Œæä¾›çš„è¯ä¹¦åˆæœ‰ä¸åŒçš„åˆ†çº§ï¼Œè¿™é‡Œè¯¦ç»†ä»‹ç»ä¸‹ä¸‰ç§ä¸åŒçš„è¯ä¹¦çº§åˆ«ï¼Œä»¥åŠè¯¥å¦‚ä½•é€‰ç”¨ï¼š Domain Validatedï¼ˆDVï¼‰è¯ä¹¦ åº”ç”¨æœ€å¹¿æ³›çš„è¯ä¹¦ç±»å‹ï¼Œæˆ‘æ¥è§¦æœ€å¤šçš„å°±æ˜¯è¿™ç§ã€‚å„äº‘å‚å•†æä¾›çš„å…è´¹ SSL è¯ä¹¦ä¹Ÿéƒ½æ˜¯è¿™ç§ç±»å‹ã€‚ ä»…éªŒè¯åŸŸåæ‰€æœ‰æƒï¼ŒéªŒè¯æ­¥éª¤æœ€å°‘ï¼Œä»·æ ¼æœ€ä½ï¼Œä»…éœ€è¦æ•°åˆ†é’Ÿå³å¯ç­¾å‘ã€‚ ä¼˜ç‚¹å°±æ˜¯æ˜“äºç­¾å‘ï¼Œå¾ˆé€‚åˆåšè‡ªåŠ¨åŒ–ã€‚ å„äº‘å‚å•†ï¼ˆAWS/GCP/Cloudflareï¼Œä»¥åŠ Vercel/Github çš„ç«™ç‚¹æœåŠ¡ï¼‰ç»™è‡ªå®¶æœåŠ¡æä¾›çš„å…è´¹è¯ä¹¦éƒ½æ˜¯ DV è¯ä¹¦ï¼ŒLetâ€™s Encrypt çš„è¯ä¹¦ä¹Ÿæ˜¯è¿™ä¸ªç±»å‹ã€‚ å¾ˆæ˜æ˜¾è¿™äº›è¯ä¹¦çš„ç­¾å‘éƒ½éå¸¸æ–¹ä¾¿ï¼Œè€Œä¸”ä»…éªŒè¯åŸŸåæ‰€æœ‰æƒã€‚ ä½†æ˜¯ AWS/GCP/Cloudflare/Vercel/Github æä¾›çš„ DV è¯ä¹¦éƒ½ä»…èƒ½åœ¨å®ƒä»¬çš„äº‘æœåŠ¡ä¸Šä½¿ç”¨ï¼Œä¸æä¾›ç§é’¥å¯¼å‡ºåŠŸèƒ½ï¼ Organization Validated (OV) è¯ä¹¦ ï¼ˆè²Œä¼¼æˆ‘ä¹Ÿæ¥è§¦åœ°æ¯”è¾ƒå°‘ï¼Œä¸åšè¯„ä»·ï¼‰ æ®è¯´æ˜¯ä¼ä¸š SSL è¯ä¹¦çš„é¦–é€‰ï¼Œé€šè¿‡ä¼ä¸šè®¤è¯ç¡®ä¿ä¼ä¸š SSL è¯ä¹¦çš„çœŸå®æ€§ã€‚ é™¤åŸŸåæ‰€æœ‰æƒå¤–ï¼ŒCA æœºæ„è¿˜ä¼šå®¡æ ¸ç»„ç»‡åŠä¼ä¸šçš„çœŸå®æ€§ï¼ŒåŒ…æ‹¬æ³¨å†ŒçŠ¶å†µã€è”ç³»æ–¹å¼ã€æ¶æ„è½¯ä»¶ç­‰å†…å®¹ã€‚ å¦‚æœè¦åšåˆè§„åŒ–ï¼Œå¯èƒ½è‡³å°‘ä¹Ÿå¾—ç”¨ OV è¿™ä¸ªçº§åˆ«çš„è¯ä¹¦ã€‚ Extended Validationï¼ˆEVï¼‰è¯ä¹¦ ï¼ˆæˆ‘åŸºæœ¬æ²¡æ¥è§¦è¿‡ï¼‰ æœ€ä¸¥æ ¼çš„è®¤è¯æ–¹å¼ï¼ŒCA æœºæ„ä¼šæ·±åº¦å®¡æ ¸ç»„ç»‡åŠä¼ä¸šå„æ–¹é¢çš„ä¿¡æ¯ã€‚ è¢«è®¤ä¸ºé€‚åˆç”¨äºå¤§å‹ä¼ä¸šã€é‡‘èæœºæ„ç­‰ç»„ç»‡æˆ–ä¼ä¸šã€‚ è€Œä¸”ä»…æ”¯æŒç­¾å‘å•åŸŸåã€å¤šåŸŸåè¯ä¹¦ï¼Œä¸æ”¯æŒç­¾å‘æ³›åŸŸåè¯ä¹¦ï¼Œå®‰å…¨æ€§æ æ çš„ã€‚ å®Œæ•´çš„è¯ä¹¦ç”³è¯·æµç¨‹å¦‚ä¸‹: è¯ä¹¦ç”³è¯·æµç¨‹ ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·ï¼Œå›¾ä¸­çš„ç”³è¯·äººï¼ˆApplicantï¼‰è‡ªè¡Œå¤„ç†çš„éƒ¨åˆ†ï¼Œç›®å‰å¾ˆå¤šè¯ä¹¦ç”³è¯·ç½‘ç«™ä¹Ÿå¯ä»¥è‡ªåŠ¨å¤„ç†ï¼Œç”¨æˆ·åªéœ€è¦æä¾›ç›¸å…³ä¿¡æ¯å³å¯ã€‚ ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:3:7","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#7-å‘æƒå¨-ca-æœºæ„ç”³è¯·å…¬ç½‘å—ä¿¡ä»»è¯ä¹¦"},{"categories":["tech"],"content":" 8. è¯ä¹¦çš„å¯¿å‘½å¯¹äºå…¬å¼€æœåŠ¡ï¼ŒæœåŠ¡ç«¯è¯ä¹¦çš„æœ‰æ•ˆæœŸä¸è¦è¶…è¿‡ 825 å¤©ï¼ˆ27 ä¸ªæœˆï¼‰ï¼å¦å¤–ä» 2020 å¹´ 11 æœˆèµ·ï¼Œæ–°ç”³è¯·çš„æœåŠ¡ç«¯è¯ä¹¦æœ‰æ•ˆæœŸå·²ç»ç¼©çŸ­åˆ°äº† 398 å¤©ï¼ˆ13 ä¸ªæœˆï¼‰ã€‚ç›®å‰ Apple/Mozilla/Chrome éƒ½å‘è¡¨äº†ç›¸åº”å£°æ˜ï¼Œè¯ä¹¦æœ‰æ•ˆæœŸè¶…è¿‡ä¸Šè¿°é™åˆ¶çš„ï¼Œå°†è¢«æµè§ˆå™¨/Appleè®¾å¤‡ç¦æ­¢ä½¿ç”¨ã€‚ è€Œå¯¹äºå…¶ä»–ç”¨é€”çš„è¯ä¹¦ï¼Œå¦‚æœæ›´æ¢èµ·æ¥å¾ˆéº»çƒ¦ï¼Œå¯ä»¥è€ƒè™‘æ”¾å®½æ¡ä»¶ã€‚æ¯”å¦‚ kubernetes é›†ç¾¤çš„åŠ å¯†è¯ä¹¦ï¼Œå¯ä»¥è€ƒè™‘æœ‰æ•ˆæœŸè®¾é•¿ä¸€äº›ï¼Œæ¯”å¦‚ 10 å¹´ã€‚ æ®äº‘åŸç”Ÿå®‰å…¨ç ´å±€ï½œå¦‚ä½•ç®¡ç†å‘¨æœŸè¶Šæ¥è¶ŠçŸ­çš„æ•°å­—è¯ä¹¦ï¼Ÿæ‰€è¿°ï¼Œå¤§é‡çŸ¥åä¼ä¸šå¦‚ç‰¹æ–¯æ‹‰/å¾®è½¯/é¢†è‹±/çˆ±ç«‹ä¿¡éƒ½æ›¾å› æœªåŠæ—¶æ›´æ¢ TLS è¯ä¹¦å¯¼è‡´æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ã€‚ å› æ­¤ TLS è¯ä¹¦æœ€å¥½æ˜¯è®¾ç½®è‡ªåŠ¨è½®è½¬ï¼Œå¹¶ç¡®ä¿è¯ä¹¦æœ‰æ•ˆæœŸè¿‡çŸ­æ—¶èƒ½è§¦å‘å‘Šè­¦ï¼çº¯äººå·¥ç»´æŠ¤æˆ–çº¯è‡ªåŠ¨åŒ–éƒ½ä¸å¯é ï¼ ç›®å‰å¾ˆå¤š Web æœåŠ¡å™¨/ä»£ç†ï¼Œéƒ½æ”¯æŒè‡ªåŠ¨è½®è½¬ Letâ€™s Encrypt è¯ä¹¦ã€‚å¦å¤– Vault ç­‰å®‰å…¨å·¥å…·ï¼Œä¹Ÿæ”¯æŒè‡ªåŠ¨è½®è½¬ç§æœ‰è¯ä¹¦ã€‚ ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:3:8","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#8-è¯ä¹¦çš„å¯¿å‘½"},{"categories":["tech"],"content":" 9. ä½¿ç”¨ OpenSSL éªŒè¯è¯ä¹¦ã€æŸ¥çœ‹è¯ä¹¦ä¿¡æ¯ shell # æŸ¥çœ‹è¯ä¹¦(crt)ä¿¡æ¯ openssl x509 -noout -text -in server.crt # æŸ¥çœ‹è¯ä¹¦è¯·æ±‚(csr)ä¿¡æ¯ openssl req -noout -text -in server.csr # æŸ¥çœ‹ RSA ç§é’¥(key)ä¿¡æ¯ openssl rsa -noout -text -in server.key # éªŒè¯è¯ä¹¦æ˜¯å¦å¯ä¿¡ ## 1. ä½¿ç”¨ç³»ç»Ÿçš„è¯ä¹¦é“¾è¿›è¡ŒéªŒè¯ openssl verify server.crt ## 2. ä½¿ç”¨æŒ‡å®šçš„ CA è¯ä¹¦è¿›è¡ŒéªŒè¯ openssl verify -CAfile ca.crt server.crt ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:3:9","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#9-ä½¿ç”¨-openssl-éªŒè¯è¯ä¹¦æŸ¥çœ‹è¯ä¹¦ä¿¡æ¯"},{"categories":["tech"],"content":" äºŒã€TLS åè®®TLS åè®®ï¼Œä¸­æ–‡åä¸ºã€Œä¼ è¾“å±‚å®‰å…¨åè®®ã€ï¼Œæ˜¯ä¸€ä¸ªå®‰å…¨é€šä¿¡åè®®ï¼Œè¢«ç”¨äºåœ¨ç½‘ç»œä¸Šè¿›è¡Œå®‰å…¨é€šä¿¡ã€‚ TLS åè®®é€šå¸¸ä¸ HTTP / FTP / SMTP ç­‰åè®®ä¸€èµ·ä½¿ç”¨ä»¥å®ç°åŠ å¯†é€šè®¯ï¼Œè¿™ç§ç»„åˆåè®®é€šå¸¸è¢«ç¼©å†™ä¸º HTTPS / SFTP / SMTPS. åœ¨è®²TLS åè®®å‰ï¼Œ è¿˜æ˜¯å…ˆå¤ä¹ ä¸‹ã€Œå¯¹ç§°å¯†ç ç®—æ³•ã€ä¸ã€Œéå¯¹ç§°å¯†ç ç®—æ³•ã€ä¸¤ä¸ªå¯†ç ä½“ç³»çš„ç‰¹ç‚¹ã€‚ å¯¹ç§°å¯†ç ç®—æ³•ï¼ˆå¦‚ AES/ChaCha20ï¼‰: è®¡ç®—é€Ÿåº¦å¿«ã€å®‰å…¨å¼ºåº¦é«˜ï¼Œä½†æ˜¯ç¼ºä¹å®‰å…¨äº¤æ¢å¯†é’¥çš„æ‰‹æ®µã€å¯†é’¥çš„ä¿å­˜å’Œç®¡ç†ä¹Ÿå¾ˆå›°éš¾ éå¯¹ç§°å¯†ç ç®—æ³•ï¼ˆå¦‚ RSA/ECCï¼‰: è§£å†³äº†ä¸Šè¿°å¯¹ç§°å¯†ç ç®—æ³•çš„ä¸¤ä¸ªç¼ºé™·â€”â€”é€šè¿‡æ•°å­—è¯ä¹¦ + PKI å…¬é’¥åŸºç¡€æ¶æ„å®ç°äº†èº«ä»½è®¤è¯ï¼Œå†é€šè¿‡ DHE/ECDHE å®ç°äº†å®‰å…¨çš„å¯¹ç§°å¯†é’¥äº¤æ¢ã€‚ ä½†æ˜¯éå¯¹ç§°å¯†ç ç®—æ³•è¦æ¯”å¯¹ç§°å¯†ç ç®—æ³•æ›´å¤æ‚ï¼Œè®¡ç®—é€Ÿåº¦ä¹Ÿæ…¢å¾—å¤šã€‚å› æ­¤å®é™…ä½¿ç”¨ä¸Šé€šå¸¸ç»“åˆä½¿ç”¨è¿™ä¸¤ç§å¯†ç ç®—æ³•ï¼Œå„å–å…¶é•¿ï¼Œä»¥å®ç°é«˜é€Ÿä¸”å®‰å…¨çš„ç½‘ç»œé€šè®¯ã€‚æˆ‘ä»¬é€šå¸¸ç§°ç»“åˆä½¿ç”¨å¯¹ç§°å¯†ç ç®—æ³•ä»¥åŠéå¯¹ç§°å¯†ç ç®—æ³•çš„åŠ å¯†æ–¹æ¡ˆä¸ºã€Œæ··åˆåŠ å¯†æ–¹æ¡ˆã€ã€‚ TLS åè®®å°±æ˜¯ä¸€ä¸ªã€Œæ··åˆåŠ å¯†æ–¹æ¡ˆã€ï¼Œå®ƒå€ŸåŠ©æ•°å­—è¯ä¹¦ä¸ PKI å…¬é’¥åŸºç¡€æ¶æ„ã€DHE/ECDHE å¯†é’¥äº¤æ¢åè®®ä»¥åŠå¯¹ç§°åŠ å¯†æ–¹æ¡ˆè¿™ä¸‰è€…ï¼Œå®ç°äº†å®‰å…¨çš„åŠ å¯†é€šè®¯ã€‚ åŸºäºç»å…¸ DHKE åè®®çš„ TLS æ¡æ‰‹æµç¨‹å¦‚ä¸‹ï¼š åŸºäºç»å…¸ DHKE åè®®çš„ TLS æ¡æ‰‹ è€Œåœ¨æ”¯æŒã€Œå®Œç¾å‰å‘ä¿å¯†ï¼ˆPerfect Forward Secrecyï¼‰ã€çš„ TLS1.2 æˆ– TLS1.3 åè®®ä¸­ï¼Œç»å…¸ DH åè®®è¢« ECDHE åè®®å–ä»£ã€‚å˜åŒ–ä¹‹ä¸€æ˜¯è¿›è¡Œæœ€åˆçš„æ¡æ‰‹åè®®ä»ç»å…¸ DHKE æ¢æˆäº†åŸºäº ECC çš„ ECDH åè®®ï¼Œ å˜åŒ–ä¹‹äºŒæ˜¯åœ¨æ¯æ¬¡é€šè®¯è¿‡ç¨‹ä¸­ä¹Ÿåœ¨ä¸æ–­åœ°è¿›è¡Œå¯†é’¥äº¤æ¢ï¼Œç”Ÿæˆæ–°çš„å¯¹ç§°å¯†é’¥ä¾›ä¸‹æ¬¡é€šè®¯ä½¿ç”¨ï¼Œå…¶ç»†èŠ‚å‚è§å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆäº”ï¼‰â€”â€” å¯†é’¥äº¤æ¢ DHKE ä¸å®Œç¾å‰å‘ä¿å¯† PFSã€‚ TLS åè®®é€šè¿‡åº”ç”¨ ECDHE å¯†é’¥äº¤æ¢åè®®ï¼Œæä¾›äº†ã€Œå®Œç¾å‰å‘ä¿å¯†ï¼ˆPerfect Forward Secrecyï¼‰ã€ç‰¹æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒèƒ½å¤Ÿä¿æŠ¤è¿‡å»è¿›è¡Œçš„é€šè®¯ä¸å—å¯†é’¥åœ¨æœªæ¥æš´éœ²çš„å¨èƒã€‚å³ä½¿æ”»å‡»è€…ç ´è§£å‡ºäº†ä¸€ä¸ªã€Œå¯¹ç§°å¯†é’¥ã€ï¼Œä¹Ÿåªèƒ½è·å–åˆ°ä¸€æ¬¡äº‹åŠ¡ä¸­çš„æ•°æ®ï¼Œå…¶ä»–äº‹åŠ¡çš„æ•°æ®å®‰å…¨æ€§å®Œå…¨ä¸å—å½±å“ã€‚ å¦å¤–æ³¨æ„ä¸€ç‚¹æ˜¯ï¼ŒCA è¯ä¹¦å’ŒæœåŠ¡ç«¯è¯ä¹¦éƒ½åªåœ¨ TLS åè®®æ¡æ‰‹çš„å‰ä¸‰ä¸ªæ­¥éª¤ä¸­æœ‰ç”¨åˆ°ï¼Œä¹‹åçš„é€šä¿¡å°±ä¸å®ƒä»¬æ— å…³äº†ã€‚ ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:4:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#äºŒtls-åè®®"},{"categories":["tech"],"content":" 1. å¯†ç å¥—ä»¶ä¸ TLS å†å²ç‰ˆæœ¬å¯†ç å¥—ä»¶ï¼ˆCipher_suiteï¼‰æ˜¯ TLS åè®®ä¸­ä¸€ç»„ç”¨äºå®ç°å®‰å…¨é€šè®¯çš„å¯†ç å­¦ç®—æ³•ï¼Œç±»ä¼¼äºæˆ‘ä»¬å‰é¢å­¦ä¹ è¿‡çš„åŠ å¯†æ–¹æ¡ˆã€‚ä¸åŒå¯†ç å­¦ç®—æ³•çš„ç»„åˆå½¢æˆä¸åŒçš„å¯†ç å¥—ä»¶ï¼Œç®—æ³•ç»„åˆçš„å·®å¼‚ä½¿è¿™äº›å¯†ç å¥—ä»¶å…·æœ‰ä¸åŒçš„æ€§èƒ½ä¸å®‰å…¨æ€§ï¼Œå¦å¤– TLS åè®®çš„æ›´æ–°è¿­ä»£ä¹Ÿå¯¼è‡´å„å¯†ç å¥—ä»¶æ‹¥æœ‰ä¸åŒçš„å…¼å®¹æ€§ã€‚é€šå¸¸è¶Šæ–°æ¨å‡ºçš„å¯†ç å¥—ä»¶çš„å®‰å…¨æ€§è¶Šé«˜ï¼Œä½†æ˜¯å…¼å®¹æ€§å°±è¶Šå·®ï¼ˆæ—§è®¾å¤‡ä¸æ”¯æŒï¼‰ã€‚ å¯†ç å¥—ä»¶çš„åç§°ç”±å®ƒä½¿ç”¨çš„å„ç§å¯†ç å­¦ç®—æ³•åç§°ç»„æˆï¼Œè€Œä¸”æœ‰å›ºå®šçš„æ ¼å¼ï¼Œä»¥TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 ä¸ºä¾‹ä»‹ç»ä¸‹ï¼š TLS: å®šä¹‰äº†æ­¤å¥—ä»¶é€‚ç”¨çš„åè®®ï¼Œé€šå¸¸å›ºå®šä¸º TLS ECDHE: å¯†é’¥äº¤æ¢ç®—æ³• RSA: æ•°å­—è¯ä¹¦è®¤è¯ç®—æ³• AES_128_GCM: ä½¿ç”¨çš„å¯¹ç§°åŠ å¯†æ–¹æ¡ˆï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäº AES ä¸ GCM æ¨¡å¼çš„å¯¹ç§°è®¤è¯åŠ å¯†æ–¹æ¡ˆï¼Œä½¿ç”¨ 128 ä½å¯†é’¥ SHA256: å“ˆå¸Œå‡½æ•°ï¼Œç”¨äº HMAC ç®—æ³•å®ç°æ¶ˆæ¯è®¤è¯ TLS å›ºå®šä½¿ç”¨ HMAC ç®—æ³•è¿›è¡Œæ¶ˆæ¯è®¤è¯ TLS åè®®çš„å‰èº«æ˜¯ SSL åè®®ï¼ŒTLS/SSL çš„å‘å±•å†ç¨‹å±•ç¤ºå¦‚ä¸‹ï¼š SSL/TLS çš„å†å²ç‰ˆæœ¬ SSL åè®®æ—©åœ¨ 2015 å¹´å°±è¢«å„å¤§ä¸»æµæµè§ˆå™¨åºŸé™¤äº†ï¼ŒTLS1.0 æ„Ÿè§‰ä¹ŸåŸºæœ¬æ²¡ç«™ç‚¹åœ¨ç”¨äº†ï¼Œè¿™ä¿©å°±ç›´æ¥è·³è¿‡äº†ã€‚ ä¸‹é¢åˆ†åˆ«ä»‹ç»ä¸‹ TLS1.1 TLS1.2 ä¸ TLS1.3. TLS 1.1TLS 1.1 åœ¨ RFC4346 ä¸­å®šä¹‰ï¼Œäº 2006 å¹´ 4 æœˆå‘å¸ƒã€‚ TLS 1.1 æ˜¯ TLS 1.0 çš„ä¸€ä¸ªè¡¥ä¸ï¼Œä¸»è¦æ›´æ–°åŒ…æ‹¬ï¼š æ·»åŠ å¯¹CBCæ”»å‡»çš„ä¿æŠ¤ éšå¼åˆå§‹å‘é‡ IV è¢«æ›¿æ¢æˆä¸€ä¸ªæ˜¾å¼çš„ IV ä¿®å¤åˆ†ç»„å¯†ç æ¨¡å¼ä¸­å¡«å……ç®—æ³•çš„ bug æ”¯æŒ IANA ç™»è®°çš„å‚æ•° TLS 1.1åŠå…¶ä¹‹å‰çš„ç®—æ³•æ›¾ç»è¢«å¹¿æ³›åº”ç”¨ï¼Œå®ƒç›®å‰å·²çŸ¥çš„ç¼ºé™·å¦‚ä¸‹ï¼š ä¸æ”¯æŒ PFS å®Œå…¨å‰å‘ä¿å¯† ä¸æ”¯æŒ AEAD è®¤è¯åŠ å¯†ç®—æ³• ä¸ºäº†å…¼å®¹æ€§ï¼Œä¿ç•™äº†å¾ˆå¤šä¸å®‰å…¨çš„ç®—æ³• TLS 1.1 å·²ç»ä¸å¤Ÿå®‰å…¨äº†ï¼Œä¸è¿‡ä¸€äº›é™ˆå¹´è€ç«™ç‚¹æˆ–è®¸è¿˜åœ¨ä½¿ç”¨å®ƒã€‚ å„æ“ä½œç³»ç»Ÿï¼ˆAndroid/IOS/MacOS/Windowsï¼‰ä¸æµè§ˆå™¨åŸºæœ¬éƒ½åœ¨å¾ˆæ—©çš„ç‰ˆæœ¬ä¸­å°±å·²ç»æ”¯æŒ TLS1.2+ äº†ï¼Œ ç«™åœ¨ 2022 å¹´è¿™ä¸ªæ—¶é—´èŠ‚ç‚¹çœ‹ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥å®Œå…¨åºŸæ­¢ TLS1.1 åè®®ã€‚å®é™…ä¸Šå„å¤§äº‘å‚å•†ä¹Ÿæ˜¯è¿™ä¹ˆå¹²çš„ï¼Œæ¯”å¦‚ AWS è‡ªèº«çš„ API å¯¹ TLS1.1 çš„æ”¯æŒå°±å·²ç¡®å®šå°†åœ¨ 2023 å¹´ 6 æœˆåºŸæ­¢ï¼Œ2022 å¹´å°±å¼€å§‹é¢‘ç¹æ‰«æå¹¶æé†’å„ä½ä»ç„¶åœ¨ä½¿ç”¨ä½ç‰ˆæœ¬ TLS åè®®çš„å®¢æˆ·å‡çº§ã€‚ TLS 1.2TLS 1.2 åœ¨ RFC5246 ä¸­å®šä¹‰ï¼Œäº 2008 å¹´ 8 æœˆå‘å‘å¸ƒã€‚ å¯é€‰æ”¯æŒ PFS å®Œå…¨å‰å‘ä¿å¯† ç§»é™¤å¯¹ MD5 ä¸ SHA-1 ç­¾åç®—æ³•çš„æ”¯æŒ æ·»åŠ å¯¹ HMAC-SHA-256 åŠ HMAC-SHA-384 æ¶ˆæ¯è®¤è¯ç®—æ³•çš„æ”¯æŒ æ·»åŠ å¯¹ AEAD åŠ å¯†è®¤è¯æ–¹æ¡ˆçš„æ”¯æŒ å»é™¤ forback å›åˆ° SSL åè®®çš„èƒ½åŠ›ï¼Œæå‡å®‰å…¨æ€§ ä¸ºäº†å…¼å®¹æ€§ï¼Œä¿ç•™äº†å¾ˆå¤šä¸å®‰å…¨çš„ç®—æ³• å¦‚æœä½ ä½¿ç”¨ TLS 1.2ï¼Œéœ€è¦å°å¿ƒåœ°é€‰æ‹©å¯†ç å¥—ä»¶ï¼Œé¿å¼€ä¸å®‰å…¨çš„å¥—ä»¶ï¼Œå°±èƒ½å®ç°è¶³å¤Ÿé«˜çš„å®‰å…¨æ€§ã€‚ TLS 1.3TLS 1.3 åšäº†ä¸€æ¬¡å¤§åˆ€é˜”æ–§çš„æ›´æ–°ï¼Œæ˜¯ä¸€ä¸ªé‡Œç¨‹ç¢‘å¼çš„ç‰ˆæœ¬ï¼Œå…¶æ›´æ–°æ€»ç»“å¦‚ä¸‹ï¼š ç§»é™¤å¯¹å¦‚ä¸‹ç®—æ³•çš„æ”¯æŒ å“ˆå¸Œå‡½æ•° SHA1/MD5 æ‰€æœ‰é AEAD åŠ å¯†è®¤è¯çš„å¯†ç æ–¹æ¡ˆï¼ˆCBC æ¨¡å¼ï¼‰ ç§»é™¤å¯¹ RC4 ä¸ 3DES åŠ å¯†ç®—æ³•çš„æ”¯æŒ ç§»é™¤äº†é™æ€ RSA ä¸ DH å¯†é’¥äº¤æ¢ç®—æ³• æ”¯æŒé«˜æ€§èƒ½çš„ Ed25519/Ed448 ç­¾åè®¤è¯ç®—æ³•ã€X25519 å¯†é’¥åå•†ç®—æ³• æ”¯æŒé«˜æ€§èƒ½çš„ ChaCha20-Poly1305 å¯¹ç§°è®¤è¯åŠ å¯†æ–¹æ¡ˆ å°†å¯†é’¥äº¤æ¢ç®—æ³•ä¸å…¬é’¥è®¤è¯ç®—æ³•ä»å¯†ç å¥—ä»¶ä¸­åˆ†ç¦»å‡ºæ¥ æ¯”å¦‚åŸæ¥çš„ TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 å¯†ç å¥—ä»¶å°†è¢«æ‹†åˆ†ä¸º ECDHE ç®—æ³•ã€RSA èº«ä»½è®¤è¯ç®—æ³•ã€ä»¥åŠ TLS_AES_128_GCM_SHA256 å¯†ç å¥—ä»¶ è¿™æ ·å¯†ç å¥—ä»¶å°±åªåŒ…å«ä¸€ä¸ª AEAD è®¤è¯åŠ å¯†æ–¹æ¡ˆï¼Œä»¥åŠä¸€ä¸ªå“ˆå¸Œå‡½æ•°äº† ä»…æ”¯æŒå‰å‘å®‰å…¨çš„å¯†é’¥äº¤æ¢ç®—æ³• DHE æˆ– ECDHE æ”¯æŒæœ€çŸ­ 0-RTT çš„ TLS æ¡æ‰‹ï¼ˆä¼šè¯æ¢å¤ï¼‰ TLS 1.3 ä»åè®®ä¸­åˆ é™¤äº†æ‰€æœ‰ä¸å®‰å…¨çš„ç®—æ³•æˆ–åè®®ï¼Œå¯ä»¥è¯´åªè¦ä½ çš„é€šè®¯ç”¨äº† TLS 1.3ï¼Œé‚£ä½ çš„æ•°æ®å°±å®‰å…¨äº†ï¼ˆå½“ç„¶å‰ææ˜¯ä½ çš„ç§é’¥æ²¡æ³„æ¼ï¼‰ã€‚ å¦‚ä½•è®¾ç½® TLS åè®®çš„ç‰ˆæœ¬ã€å¯†ç å¥—ä»¶å‚æ•°æˆ‘ä»¬å‰é¢å·²ç»å­¦ä¹ äº†å¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†ã€å¯†é’¥äº¤æ¢ä¸‰éƒ¨åˆ†çŸ¥è¯†ï¼Œå¯¹ç…§ TLS å¥—ä»¶çš„åç§°ï¼Œåº”è¯¥èƒ½å¾ˆå®¹æ˜“åˆ¤æ–­å‡ºå“ªäº›æ˜¯å®‰å…¨çš„ã€å“ªäº›ä¸å¤Ÿå®‰å…¨ï¼Œå“ªäº›æ”¯æŒå‰å‘ä¿å¯†ã€å“ªäº›ä¸æ”¯æŒã€‚ ä¸€ä¸ªéå¸¸å¥½ç”¨çš„ã€Œç«™ç‚¹ HTTPS å®‰å…¨æ£€æµ‹ã€ç½‘ç«™æ˜¯ https://myssl.com/ï¼Œä½¿ç”¨å®ƒæµ‹è¯•çŸ¥ä¹ç½‘çš„æ£€æµ‹ç»“æœå¦‚ä¸‹ï¼š SSL/TLS çš„å†å²ç‰ˆæœ¬ èƒ½çœ‹åˆ°çŸ¥ä¹ä¸ºäº†å…¼å®¹æ€§ï¼Œç›®å‰ä»ç„¶æ”¯æŒ TLS1.0 ä¸ TLS1.1ï¼Œå¦å¤–ç›®å‰è¿˜ä¸æ”¯æŒ TLS1.3. æ­¤å¤–ï¼ŒçŸ¥ä¹ä»ç„¶æ”¯æŒå¾ˆå¤šå·²ç»ä¸å®‰å…¨çš„åŠ å¯†å¥—ä»¶ï¼Œmyssl.com ä¸“é—¨ä½¿ç”¨é»„è‰²æ ‡è¯†å‡ºäº†è¿™äº›ä¸å®‰å…¨çš„åŠ å¯†å¥—ä»¶ï¼Œæˆ‘ä»¬æ€»ç»“ä¸‹ä¸»è¦ç‰¹å¾ï¼š éƒ¨åˆ†å¯†ç å¥—ä»¶ä½¿ç”¨äº†ä¸å®‰å…¨çš„å¯¹ç§°åŠ å¯†ç®—æ³• 3DES å…¶ä»–è¢«æ ‡è¯†ä¸ºé»„è‰²çš„å¥—ä»¶è™½ç„¶ä½¿ç”¨äº†å®‰å…¨çš„å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œä½†æ˜¯ä¸æ”¯æŒ PFS å‰å‘ä¿å¯† æ­¤å¤– myssl.com è¿˜åˆ—å‡ºäº†è®¸å¤šç«™ç‚¹æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ TLS1.3 çš„ä¼šè¯æ¢å¤ï¼Œä»¥åŠåé¢å°†ä¼šä»‹ç»çš„å…¬é’¥å›ºå®šã€HTTPä¸¥æ ¼ä¼ è¾“å®‰å…¨ç­‰ä¿¡æ¯ï¼š SSL/TLS çš„å†å²ç‰ˆæœ¬ Nginx çš„ TLS åè®®é…ç½®ä»¥å‰ä¸º Nginx ç­‰ç¨‹åºé…ç½® HTTPS åè®®æ—¶ï¼Œæˆ‘æœ€å¤´ç–¼çš„å°±æ˜¯å…¶ä¸­å¯†ç å¥—ä»¶å‚æ•° ssl_ciphersï¼Œä¸ºäº†å®‰å…¨æ€§ï¼Œéœ€è¦é…ç½®è¶…é•¿çš„ä¸€å¤§å †é€‰ç”¨çš„å¯†ç å¥—ä»¶åç§°ï¼Œæˆ‘å¯ä»¥è¯´ä¸€ä¸ªéƒ½çœ‹ä¸æ‡‚ï¼Œä½†æ˜¯ä¸ºäº†æŠŠç½‘ç«™æå¥½è¿˜æ˜¯å¾—ç¡¬ç€å¤´çš®æœç´¢å¤åˆ¶ç²˜è´´ï¼Œå®é™…ä¸Šä¹Ÿä¸æ¸…æ¥šå®‰å…¨æ€§åˆ°åº•å¦‚ä½•ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒMozilla/DigitalOcean éƒ½æè¿‡æµè¡Œ Web æœåŠ¡å™¨çš„ TLS é…ç½®ç”Ÿæˆå·¥å…·ï¼Œæ¯”å¦‚ssl-config - mozillaï¼Œè¿™ä¸ªç½‘ç«™æä¾›ä¸‰ä¸ªå®‰å…¨ç­‰çº§çš„é…ç½®: ã€ŒIntermediateã€: æŸ¥çœ‹ç”Ÿæˆå‡ºçš„ ssl-cipher å±æ€§ï¼Œå‘ç°å®ƒåªæ”¯æŒ ECDHE/DHE å¼€å¤´çš„ç®—æ³•ã€‚å› æ­¤å®ƒä¿è¯å‰å‘ä¿å¯†ã€‚ å¯¹äºéœ€è¦é€šè¿‡æµè§ˆå™¨è®¿é—®çš„ APIï¼Œæ¨èé€‰æ‹©è¿™ä¸ªç­‰çº§ã€‚ ã€ŒModernã€: åªæ”¯æŒ TLSv1.3ï¼Œè¯¥åè®®åºŸå¼ƒæ‰äº†è¿‡å¾€æ‰€æœ‰ä¸å®‰å…¨çš„ç®—æ³•ï¼Œä¿è¯å‰å‘ä¿å¯†ï¼Œå®‰å…¨æ€§æé«˜ï¼Œæ€§èƒ½ä¹Ÿæ›´å¥½ã€‚ å¯¹äºä¸éœ€è¦é€šè¿‡æµè§ˆå™¨ç­‰æ—§ç»ˆç«¯è®¿é—®çš„ APIï¼Œè¯·ç›´æ¥é€‰æ‹©è¿™ä¸ªç­‰çº§ã€‚ ã€ŒOldã€: é™¤éä½ çš„ç”¨æˆ·ä½¿ç”¨éå¸¸è€çš„ç»ˆç«¯è¿›è¡Œè®¿é—®ï¼Œå¦åˆ™è¯·ä¸è¦è€ƒè™‘è¿™ä¸ªé€‰é¡¹ï¼ å¯ä»¥ç‚¹è¿›å»æŸ¥çœ‹è¯¦ç»†çš„ TLS å¥—ä»¶é…ç½®ã€‚ OCSP è¯ä¹¦éªŒè¯åè®® https://www.ssl.com/blogs/how-do-browsers-handle-revoked-ssl-tls-certificates/ https://imququ.com/post/why-can-not-turn-on-ocsp-stapling.html https://www.digicert.com/help/ å‰é¢æåˆ°é™¤äº†æ•°å­—è¯ä¹¦è‡ªå¸¦çš„æœ‰æ•ˆæœŸå¤–ï¼Œä¸ºäº†åœ¨ç§é’¥æ³„æ¼çš„æƒ…å†µä¸‹ï¼Œèƒ½å¤ŸåŠé”€å¯¹åº”çš„è¯ä¹¦ï¼ŒPKI å…¬é’¥åŸºç¡€è®¾æ–½è¿˜æä¾›äº† OCSPï¼ˆOnline Certificate Status Protocolï¼‰è¯ä¹¦çŠ¶æ€æŸ¥è¯¢åè®®ã€‚ è¿™å¯¼è‡´äº†ä¸€äº›é—®é¢˜ï¼š Chrome/Firefox ç­‰æµè§ˆå™¨éƒ½ä¼šå®šæœŸé€šè¿‡ OCSP åè®®å»è¯·æ±‚ CA æœºæ„çš„ OCSP æœåŠ¡å™¨éªŒè¯è¯ä¹¦çŠ¶æ€ï¼Œ è¿™å¯èƒ½ä¼šæ‹–æ…¢ HTTPS åè®®çš„å“åº”é€Ÿåº¦ã€‚ æ‰€è°“çš„å®šæœŸæ˜¯æŒ‡è¶…è¿‡ä¸Šä¸€ä¸ª OCSP å“åº”çš„ nextUpdate æ—¶é—´ï¼ˆä¸€èˆ¬ä¸º 7 å¤©ï¼‰ï¼Œæˆ–è€…å¦‚æœè¯¥å€¼ä¸ºç©ºçš„è¯ï¼ŒFirefox é»˜è®¤ 24h åä¼šé‡æ–°æŸ¥è¯¢ OCSP çŠ¶æ€ã€‚ å› ä¸ºå®¢æˆ·ç«¯ç›´æ¥å»è¯·æ±‚ CA æœºæ„çš„ OCSP åœ°å€è·å–è¯ä¹¦çŠ¶æ€ï¼Œè¿™å°±å¯¼è‡´ CA æœºæ„å¯ä»¥è·å–åˆ°ä¸€äº›å¯¹åº”ç«™ç‚¹çš„ç”¨æˆ·ä¿¡æ¯ï¼ˆIP åœ°å€ã€ç½‘ç»œçŠ¶æ€ç­‰ï¼‰ã€‚ ä¸ºäº†è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œrfc6066 å®šä¹‰äº† OCSP stapling åŠŸèƒ½ï¼Œå®ƒä½¿æœåŠ¡å™¨å¯ä»¥æå‰è®¿é—® OCSP è·å–è¯ä¹¦çŠ¶æ€ä¿¡æ¯å¹¶ç¼“å­˜åˆ°æœ¬åœ°ï¼ŒåŸºæœ¬ Nginx/Caddy ç­‰å„å¤§ Web æœåŠ¡å™¨æˆ–ç½‘å…³ï¼Œéƒ½æ”¯æŒ OCSP stapling åè®®ã€‚ åœ¨å®¢æˆ·ç«¯ä½¿ç”¨ TLS åè®®è®¿é—® HTTPS æœåŠ¡æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šç›´æ¥åœ¨æ¡æ‰‹é˜¶æ®µå°†ç¼“å­˜çš„ OCSP ä¿¡æ¯å‘é€ç»™å®¢æˆ·ç«¯ã€‚å› ä¸º OCSP ä¿¡æ¯ä¼šå¸¦æœ‰ CA è¯ä¹¦çš„ç­¾ååŠæœ‰æ•ˆæœŸï¼Œå®¢æˆ·ç«¯å¯ä»¥ç›´æ¥é€šè¿‡ç­¾åéªŒè¯ OCSP ä¿¡æ¯çš„çœŸå®æ€§ä¸æœ‰æ•ˆæ€§ï¼Œè¿™æ ·å°±é¿å…äº†å®¢æˆ·ç«¯è®¿é—® OCSP æœåŠ¡å™¨å¸¦æ¥çš„å¼€é”€ã€‚ è€Œå¦ä¸€ä¸ªæ–¹æ³•ï¼Œå°±æ˜¯é€‰ç”¨ ocsp æœåŠ¡å™¨åœ¨ç›®æ ‡ç”¨æˆ·åŒºåŸŸé€Ÿåº¦å¿«çš„ CA æœºæ„ç­¾å‘è¯ä¹¦ã€‚ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æµ‹è¯•ï¼Œç¡®è®¤ç«™ç‚¹æ˜¯å¦å¯ç”¨äº† ocsp stapling: conf $ openssl s_client -connect www.digicert.com:443 -servername www.digicert.com -status -tlsextdebug \u003c /dev/null 2\u003e\u00261 | grep -i \"OCSP response\" å¦‚æœè¾“å‡ºåŒ…å« OCSP Response Status: successful å°±è¯´æ˜ç«™ç‚¹æ”¯æŒ ocsp staplingï¼Œå¦‚æœè¾“å‡ºå†…å®¹ä¸º OCSP response: no response sent åˆ™è¯´æ˜ç«™ç‚¹ä¸æ”¯æŒocsp staplingã€‚ å®é™…ä¸Š Google/AWS ç­‰å¤§å¤šæ•°ç«™ç‚¹éƒ½ä¸ä¼šå¯ç”¨ä¹Ÿä¸éœ€è¦å¯ç”¨ ocsp staplingï¼Œä¸€æ˜¯å› ä¸ºå®ƒä»¬è‡ªå·±å°±æ˜¯è¯ä¹¦é¢å‘æœºæ„ï¼ŒOCSP æœåŠ¡å™¨ä¹Ÿå½’å®ƒä»¬è‡ªå·±ç®¡ï¼Œä¸å­˜åœ¨éšç§çš„é—®é¢˜ã€‚äºŒæ˜¯å®ƒä»¬çš„ OCSP æœåŠ¡å™¨éå¸ƒ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:4:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#1-å¯†ç å¥—ä»¶ä¸-tls-å†å²ç‰ˆæœ¬"},{"categories":["tech"],"content":" 1. å¯†ç å¥—ä»¶ä¸ TLS å†å²ç‰ˆæœ¬å¯†ç å¥—ä»¶ï¼ˆCipher_suiteï¼‰æ˜¯ TLS åè®®ä¸­ä¸€ç»„ç”¨äºå®ç°å®‰å…¨é€šè®¯çš„å¯†ç å­¦ç®—æ³•ï¼Œç±»ä¼¼äºæˆ‘ä»¬å‰é¢å­¦ä¹ è¿‡çš„åŠ å¯†æ–¹æ¡ˆã€‚ä¸åŒå¯†ç å­¦ç®—æ³•çš„ç»„åˆå½¢æˆä¸åŒçš„å¯†ç å¥—ä»¶ï¼Œç®—æ³•ç»„åˆçš„å·®å¼‚ä½¿è¿™äº›å¯†ç å¥—ä»¶å…·æœ‰ä¸åŒçš„æ€§èƒ½ä¸å®‰å…¨æ€§ï¼Œå¦å¤– TLS åè®®çš„æ›´æ–°è¿­ä»£ä¹Ÿå¯¼è‡´å„å¯†ç å¥—ä»¶æ‹¥æœ‰ä¸åŒçš„å…¼å®¹æ€§ã€‚é€šå¸¸è¶Šæ–°æ¨å‡ºçš„å¯†ç å¥—ä»¶çš„å®‰å…¨æ€§è¶Šé«˜ï¼Œä½†æ˜¯å…¼å®¹æ€§å°±è¶Šå·®ï¼ˆæ—§è®¾å¤‡ä¸æ”¯æŒï¼‰ã€‚ å¯†ç å¥—ä»¶çš„åç§°ç”±å®ƒä½¿ç”¨çš„å„ç§å¯†ç å­¦ç®—æ³•åç§°ç»„æˆï¼Œè€Œä¸”æœ‰å›ºå®šçš„æ ¼å¼ï¼Œä»¥TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 ä¸ºä¾‹ä»‹ç»ä¸‹ï¼š TLS: å®šä¹‰äº†æ­¤å¥—ä»¶é€‚ç”¨çš„åè®®ï¼Œé€šå¸¸å›ºå®šä¸º TLS ECDHE: å¯†é’¥äº¤æ¢ç®—æ³• RSA: æ•°å­—è¯ä¹¦è®¤è¯ç®—æ³• AES_128_GCM: ä½¿ç”¨çš„å¯¹ç§°åŠ å¯†æ–¹æ¡ˆï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäº AES ä¸ GCM æ¨¡å¼çš„å¯¹ç§°è®¤è¯åŠ å¯†æ–¹æ¡ˆï¼Œä½¿ç”¨ 128 ä½å¯†é’¥ SHA256: å“ˆå¸Œå‡½æ•°ï¼Œç”¨äº HMAC ç®—æ³•å®ç°æ¶ˆæ¯è®¤è¯ TLS å›ºå®šä½¿ç”¨ HMAC ç®—æ³•è¿›è¡Œæ¶ˆæ¯è®¤è¯ TLS åè®®çš„å‰èº«æ˜¯ SSL åè®®ï¼ŒTLS/SSL çš„å‘å±•å†ç¨‹å±•ç¤ºå¦‚ä¸‹ï¼š SSL/TLS çš„å†å²ç‰ˆæœ¬ SSL åè®®æ—©åœ¨ 2015 å¹´å°±è¢«å„å¤§ä¸»æµæµè§ˆå™¨åºŸé™¤äº†ï¼ŒTLS1.0 æ„Ÿè§‰ä¹ŸåŸºæœ¬æ²¡ç«™ç‚¹åœ¨ç”¨äº†ï¼Œè¿™ä¿©å°±ç›´æ¥è·³è¿‡äº†ã€‚ ä¸‹é¢åˆ†åˆ«ä»‹ç»ä¸‹ TLS1.1 TLS1.2 ä¸ TLS1.3. TLS 1.1TLS 1.1 åœ¨ RFC4346 ä¸­å®šä¹‰ï¼Œäº 2006 å¹´ 4 æœˆå‘å¸ƒã€‚ TLS 1.1 æ˜¯ TLS 1.0 çš„ä¸€ä¸ªè¡¥ä¸ï¼Œä¸»è¦æ›´æ–°åŒ…æ‹¬ï¼š æ·»åŠ å¯¹CBCæ”»å‡»çš„ä¿æŠ¤ éšå¼åˆå§‹å‘é‡ IV è¢«æ›¿æ¢æˆä¸€ä¸ªæ˜¾å¼çš„ IV ä¿®å¤åˆ†ç»„å¯†ç æ¨¡å¼ä¸­å¡«å……ç®—æ³•çš„ bug æ”¯æŒ IANA ç™»è®°çš„å‚æ•° TLS 1.1åŠå…¶ä¹‹å‰çš„ç®—æ³•æ›¾ç»è¢«å¹¿æ³›åº”ç”¨ï¼Œå®ƒç›®å‰å·²çŸ¥çš„ç¼ºé™·å¦‚ä¸‹ï¼š ä¸æ”¯æŒ PFS å®Œå…¨å‰å‘ä¿å¯† ä¸æ”¯æŒ AEAD è®¤è¯åŠ å¯†ç®—æ³• ä¸ºäº†å…¼å®¹æ€§ï¼Œä¿ç•™äº†å¾ˆå¤šä¸å®‰å…¨çš„ç®—æ³• TLS 1.1 å·²ç»ä¸å¤Ÿå®‰å…¨äº†ï¼Œä¸è¿‡ä¸€äº›é™ˆå¹´è€ç«™ç‚¹æˆ–è®¸è¿˜åœ¨ä½¿ç”¨å®ƒã€‚ å„æ“ä½œç³»ç»Ÿï¼ˆAndroid/IOS/MacOS/Windowsï¼‰ä¸æµè§ˆå™¨åŸºæœ¬éƒ½åœ¨å¾ˆæ—©çš„ç‰ˆæœ¬ä¸­å°±å·²ç»æ”¯æŒ TLS1.2+ äº†ï¼Œ ç«™åœ¨ 2022 å¹´è¿™ä¸ªæ—¶é—´èŠ‚ç‚¹çœ‹ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥å®Œå…¨åºŸæ­¢ TLS1.1 åè®®ã€‚å®é™…ä¸Šå„å¤§äº‘å‚å•†ä¹Ÿæ˜¯è¿™ä¹ˆå¹²çš„ï¼Œæ¯”å¦‚ AWS è‡ªèº«çš„ API å¯¹ TLS1.1 çš„æ”¯æŒå°±å·²ç¡®å®šå°†åœ¨ 2023 å¹´ 6 æœˆåºŸæ­¢ï¼Œ2022 å¹´å°±å¼€å§‹é¢‘ç¹æ‰«æå¹¶æé†’å„ä½ä»ç„¶åœ¨ä½¿ç”¨ä½ç‰ˆæœ¬ TLS åè®®çš„å®¢æˆ·å‡çº§ã€‚ TLS 1.2TLS 1.2 åœ¨ RFC5246 ä¸­å®šä¹‰ï¼Œäº 2008 å¹´ 8 æœˆå‘å‘å¸ƒã€‚ å¯é€‰æ”¯æŒ PFS å®Œå…¨å‰å‘ä¿å¯† ç§»é™¤å¯¹ MD5 ä¸ SHA-1 ç­¾åç®—æ³•çš„æ”¯æŒ æ·»åŠ å¯¹ HMAC-SHA-256 åŠ HMAC-SHA-384 æ¶ˆæ¯è®¤è¯ç®—æ³•çš„æ”¯æŒ æ·»åŠ å¯¹ AEAD åŠ å¯†è®¤è¯æ–¹æ¡ˆçš„æ”¯æŒ å»é™¤ forback å›åˆ° SSL åè®®çš„èƒ½åŠ›ï¼Œæå‡å®‰å…¨æ€§ ä¸ºäº†å…¼å®¹æ€§ï¼Œä¿ç•™äº†å¾ˆå¤šä¸å®‰å…¨çš„ç®—æ³• å¦‚æœä½ ä½¿ç”¨ TLS 1.2ï¼Œéœ€è¦å°å¿ƒåœ°é€‰æ‹©å¯†ç å¥—ä»¶ï¼Œé¿å¼€ä¸å®‰å…¨çš„å¥—ä»¶ï¼Œå°±èƒ½å®ç°è¶³å¤Ÿé«˜çš„å®‰å…¨æ€§ã€‚ TLS 1.3TLS 1.3 åšäº†ä¸€æ¬¡å¤§åˆ€é˜”æ–§çš„æ›´æ–°ï¼Œæ˜¯ä¸€ä¸ªé‡Œç¨‹ç¢‘å¼çš„ç‰ˆæœ¬ï¼Œå…¶æ›´æ–°æ€»ç»“å¦‚ä¸‹ï¼š ç§»é™¤å¯¹å¦‚ä¸‹ç®—æ³•çš„æ”¯æŒ å“ˆå¸Œå‡½æ•° SHA1/MD5 æ‰€æœ‰é AEAD åŠ å¯†è®¤è¯çš„å¯†ç æ–¹æ¡ˆï¼ˆCBC æ¨¡å¼ï¼‰ ç§»é™¤å¯¹ RC4 ä¸ 3DES åŠ å¯†ç®—æ³•çš„æ”¯æŒ ç§»é™¤äº†é™æ€ RSA ä¸ DH å¯†é’¥äº¤æ¢ç®—æ³• æ”¯æŒé«˜æ€§èƒ½çš„ Ed25519/Ed448 ç­¾åè®¤è¯ç®—æ³•ã€X25519 å¯†é’¥åå•†ç®—æ³• æ”¯æŒé«˜æ€§èƒ½çš„ ChaCha20-Poly1305 å¯¹ç§°è®¤è¯åŠ å¯†æ–¹æ¡ˆ å°†å¯†é’¥äº¤æ¢ç®—æ³•ä¸å…¬é’¥è®¤è¯ç®—æ³•ä»å¯†ç å¥—ä»¶ä¸­åˆ†ç¦»å‡ºæ¥ æ¯”å¦‚åŸæ¥çš„ TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 å¯†ç å¥—ä»¶å°†è¢«æ‹†åˆ†ä¸º ECDHE ç®—æ³•ã€RSA èº«ä»½è®¤è¯ç®—æ³•ã€ä»¥åŠ TLS_AES_128_GCM_SHA256 å¯†ç å¥—ä»¶ è¿™æ ·å¯†ç å¥—ä»¶å°±åªåŒ…å«ä¸€ä¸ª AEAD è®¤è¯åŠ å¯†æ–¹æ¡ˆï¼Œä»¥åŠä¸€ä¸ªå“ˆå¸Œå‡½æ•°äº† ä»…æ”¯æŒå‰å‘å®‰å…¨çš„å¯†é’¥äº¤æ¢ç®—æ³• DHE æˆ– ECDHE æ”¯æŒæœ€çŸ­ 0-RTT çš„ TLS æ¡æ‰‹ï¼ˆä¼šè¯æ¢å¤ï¼‰ TLS 1.3 ä»åè®®ä¸­åˆ é™¤äº†æ‰€æœ‰ä¸å®‰å…¨çš„ç®—æ³•æˆ–åè®®ï¼Œå¯ä»¥è¯´åªè¦ä½ çš„é€šè®¯ç”¨äº† TLS 1.3ï¼Œé‚£ä½ çš„æ•°æ®å°±å®‰å…¨äº†ï¼ˆå½“ç„¶å‰ææ˜¯ä½ çš„ç§é’¥æ²¡æ³„æ¼ï¼‰ã€‚ å¦‚ä½•è®¾ç½® TLS åè®®çš„ç‰ˆæœ¬ã€å¯†ç å¥—ä»¶å‚æ•°æˆ‘ä»¬å‰é¢å·²ç»å­¦ä¹ äº†å¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†ã€å¯†é’¥äº¤æ¢ä¸‰éƒ¨åˆ†çŸ¥è¯†ï¼Œå¯¹ç…§ TLS å¥—ä»¶çš„åç§°ï¼Œåº”è¯¥èƒ½å¾ˆå®¹æ˜“åˆ¤æ–­å‡ºå“ªäº›æ˜¯å®‰å…¨çš„ã€å“ªäº›ä¸å¤Ÿå®‰å…¨ï¼Œå“ªäº›æ”¯æŒå‰å‘ä¿å¯†ã€å“ªäº›ä¸æ”¯æŒã€‚ ä¸€ä¸ªéå¸¸å¥½ç”¨çš„ã€Œç«™ç‚¹ HTTPS å®‰å…¨æ£€æµ‹ã€ç½‘ç«™æ˜¯ https://myssl.com/ï¼Œä½¿ç”¨å®ƒæµ‹è¯•çŸ¥ä¹ç½‘çš„æ£€æµ‹ç»“æœå¦‚ä¸‹ï¼š SSL/TLS çš„å†å²ç‰ˆæœ¬ èƒ½çœ‹åˆ°çŸ¥ä¹ä¸ºäº†å…¼å®¹æ€§ï¼Œç›®å‰ä»ç„¶æ”¯æŒ TLS1.0 ä¸ TLS1.1ï¼Œå¦å¤–ç›®å‰è¿˜ä¸æ”¯æŒ TLS1.3. æ­¤å¤–ï¼ŒçŸ¥ä¹ä»ç„¶æ”¯æŒå¾ˆå¤šå·²ç»ä¸å®‰å…¨çš„åŠ å¯†å¥—ä»¶ï¼Œmyssl.com ä¸“é—¨ä½¿ç”¨é»„è‰²æ ‡è¯†å‡ºäº†è¿™äº›ä¸å®‰å…¨çš„åŠ å¯†å¥—ä»¶ï¼Œæˆ‘ä»¬æ€»ç»“ä¸‹ä¸»è¦ç‰¹å¾ï¼š éƒ¨åˆ†å¯†ç å¥—ä»¶ä½¿ç”¨äº†ä¸å®‰å…¨çš„å¯¹ç§°åŠ å¯†ç®—æ³• 3DES å…¶ä»–è¢«æ ‡è¯†ä¸ºé»„è‰²çš„å¥—ä»¶è™½ç„¶ä½¿ç”¨äº†å®‰å…¨çš„å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œä½†æ˜¯ä¸æ”¯æŒ PFS å‰å‘ä¿å¯† æ­¤å¤– myssl.com è¿˜åˆ—å‡ºäº†è®¸å¤šç«™ç‚¹æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ TLS1.3 çš„ä¼šè¯æ¢å¤ï¼Œä»¥åŠåé¢å°†ä¼šä»‹ç»çš„å…¬é’¥å›ºå®šã€HTTPä¸¥æ ¼ä¼ è¾“å®‰å…¨ç­‰ä¿¡æ¯ï¼š SSL/TLS çš„å†å²ç‰ˆæœ¬ Nginx çš„ TLS åè®®é…ç½®ä»¥å‰ä¸º Nginx ç­‰ç¨‹åºé…ç½® HTTPS åè®®æ—¶ï¼Œæˆ‘æœ€å¤´ç–¼çš„å°±æ˜¯å…¶ä¸­å¯†ç å¥—ä»¶å‚æ•° ssl_ciphersï¼Œä¸ºäº†å®‰å…¨æ€§ï¼Œéœ€è¦é…ç½®è¶…é•¿çš„ä¸€å¤§å †é€‰ç”¨çš„å¯†ç å¥—ä»¶åç§°ï¼Œæˆ‘å¯ä»¥è¯´ä¸€ä¸ªéƒ½çœ‹ä¸æ‡‚ï¼Œä½†æ˜¯ä¸ºäº†æŠŠç½‘ç«™æå¥½è¿˜æ˜¯å¾—ç¡¬ç€å¤´çš®æœç´¢å¤åˆ¶ç²˜è´´ï¼Œå®é™…ä¸Šä¹Ÿä¸æ¸…æ¥šå®‰å…¨æ€§åˆ°åº•å¦‚ä½•ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒMozilla/DigitalOcean éƒ½æè¿‡æµè¡Œ Web æœåŠ¡å™¨çš„ TLS é…ç½®ç”Ÿæˆå·¥å…·ï¼Œæ¯”å¦‚ssl-config - mozillaï¼Œè¿™ä¸ªç½‘ç«™æä¾›ä¸‰ä¸ªå®‰å…¨ç­‰çº§çš„é…ç½®: ã€ŒIntermediateã€: æŸ¥çœ‹ç”Ÿæˆå‡ºçš„ ssl-cipher å±æ€§ï¼Œå‘ç°å®ƒåªæ”¯æŒ ECDHE/DHE å¼€å¤´çš„ç®—æ³•ã€‚å› æ­¤å®ƒä¿è¯å‰å‘ä¿å¯†ã€‚ å¯¹äºéœ€è¦é€šè¿‡æµè§ˆå™¨è®¿é—®çš„ APIï¼Œæ¨èé€‰æ‹©è¿™ä¸ªç­‰çº§ã€‚ ã€ŒModernã€: åªæ”¯æŒ TLSv1.3ï¼Œè¯¥åè®®åºŸå¼ƒæ‰äº†è¿‡å¾€æ‰€æœ‰ä¸å®‰å…¨çš„ç®—æ³•ï¼Œä¿è¯å‰å‘ä¿å¯†ï¼Œå®‰å…¨æ€§æé«˜ï¼Œæ€§èƒ½ä¹Ÿæ›´å¥½ã€‚ å¯¹äºä¸éœ€è¦é€šè¿‡æµè§ˆå™¨ç­‰æ—§ç»ˆç«¯è®¿é—®çš„ APIï¼Œè¯·ç›´æ¥é€‰æ‹©è¿™ä¸ªç­‰çº§ã€‚ ã€ŒOldã€: é™¤éä½ çš„ç”¨æˆ·ä½¿ç”¨éå¸¸è€çš„ç»ˆç«¯è¿›è¡Œè®¿é—®ï¼Œå¦åˆ™è¯·ä¸è¦è€ƒè™‘è¿™ä¸ªé€‰é¡¹ï¼ å¯ä»¥ç‚¹è¿›å»æŸ¥çœ‹è¯¦ç»†çš„ TLS å¥—ä»¶é…ç½®ã€‚ OCSP è¯ä¹¦éªŒè¯åè®® https://www.ssl.com/blogs/how-do-browsers-handle-revoked-ssl-tls-certificates/ https://imququ.com/post/why-can-not-turn-on-ocsp-stapling.html https://www.digicert.com/help/ å‰é¢æåˆ°é™¤äº†æ•°å­—è¯ä¹¦è‡ªå¸¦çš„æœ‰æ•ˆæœŸå¤–ï¼Œä¸ºäº†åœ¨ç§é’¥æ³„æ¼çš„æƒ…å†µä¸‹ï¼Œèƒ½å¤ŸåŠé”€å¯¹åº”çš„è¯ä¹¦ï¼ŒPKI å…¬é’¥åŸºç¡€è®¾æ–½è¿˜æä¾›äº† OCSPï¼ˆOnline Certificate Status Protocolï¼‰è¯ä¹¦çŠ¶æ€æŸ¥è¯¢åè®®ã€‚ è¿™å¯¼è‡´äº†ä¸€äº›é—®é¢˜ï¼š Chrome/Firefox ç­‰æµè§ˆå™¨éƒ½ä¼šå®šæœŸé€šè¿‡ OCSP åè®®å»è¯·æ±‚ CA æœºæ„çš„ OCSP æœåŠ¡å™¨éªŒè¯è¯ä¹¦çŠ¶æ€ï¼Œ è¿™å¯èƒ½ä¼šæ‹–æ…¢ HTTPS åè®®çš„å“åº”é€Ÿåº¦ã€‚ æ‰€è°“çš„å®šæœŸæ˜¯æŒ‡è¶…è¿‡ä¸Šä¸€ä¸ª OCSP å“åº”çš„ nextUpdate æ—¶é—´ï¼ˆä¸€èˆ¬ä¸º 7 å¤©ï¼‰ï¼Œæˆ–è€…å¦‚æœè¯¥å€¼ä¸ºç©ºçš„è¯ï¼ŒFirefox é»˜è®¤ 24h åä¼šé‡æ–°æŸ¥è¯¢ OCSP çŠ¶æ€ã€‚ å› ä¸ºå®¢æˆ·ç«¯ç›´æ¥å»è¯·æ±‚ CA æœºæ„çš„ OCSP åœ°å€è·å–è¯ä¹¦çŠ¶æ€ï¼Œè¿™å°±å¯¼è‡´ CA æœºæ„å¯ä»¥è·å–åˆ°ä¸€äº›å¯¹åº”ç«™ç‚¹çš„ç”¨æˆ·ä¿¡æ¯ï¼ˆIP åœ°å€ã€ç½‘ç»œçŠ¶æ€ç­‰ï¼‰ã€‚ ä¸ºäº†è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œrfc6066 å®šä¹‰äº† OCSP stapling åŠŸèƒ½ï¼Œå®ƒä½¿æœåŠ¡å™¨å¯ä»¥æå‰è®¿é—® OCSP è·å–è¯ä¹¦çŠ¶æ€ä¿¡æ¯å¹¶ç¼“å­˜åˆ°æœ¬åœ°ï¼ŒåŸºæœ¬ Nginx/Caddy ç­‰å„å¤§ Web æœåŠ¡å™¨æˆ–ç½‘å…³ï¼Œéƒ½æ”¯æŒ OCSP stapling åè®®ã€‚ åœ¨å®¢æˆ·ç«¯ä½¿ç”¨ TLS åè®®è®¿é—® HTTPS æœåŠ¡æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šç›´æ¥åœ¨æ¡æ‰‹é˜¶æ®µå°†ç¼“å­˜çš„ OCSP ä¿¡æ¯å‘é€ç»™å®¢æˆ·ç«¯ã€‚å› ä¸º OCSP ä¿¡æ¯ä¼šå¸¦æœ‰ CA è¯ä¹¦çš„ç­¾ååŠæœ‰æ•ˆæœŸï¼Œå®¢æˆ·ç«¯å¯ä»¥ç›´æ¥é€šè¿‡ç­¾åéªŒè¯ OCSP ä¿¡æ¯çš„çœŸå®æ€§ä¸æœ‰æ•ˆæ€§ï¼Œè¿™æ ·å°±é¿å…äº†å®¢æˆ·ç«¯è®¿é—® OCSP æœåŠ¡å™¨å¸¦æ¥çš„å¼€é”€ã€‚ è€Œå¦ä¸€ä¸ªæ–¹æ³•ï¼Œå°±æ˜¯é€‰ç”¨ ocsp æœåŠ¡å™¨åœ¨ç›®æ ‡ç”¨æˆ·åŒºåŸŸé€Ÿåº¦å¿«çš„ CA æœºæ„ç­¾å‘è¯ä¹¦ã€‚ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æµ‹è¯•ï¼Œç¡®è®¤ç«™ç‚¹æ˜¯å¦å¯ç”¨äº† ocsp stapling: conf $ openssl s_client -connect www.digicert.com:443 -servername www.digicert.com -status -tlsextdebug \u003c /dev/null 2\u003e\u00261 | grep -i \"OCSP response\" å¦‚æœè¾“å‡ºåŒ…å« OCSP Response Status: successful å°±è¯´æ˜ç«™ç‚¹æ”¯æŒ ocsp staplingï¼Œå¦‚æœè¾“å‡ºå†…å®¹ä¸º OCSP response: no response sent åˆ™è¯´æ˜ç«™ç‚¹ä¸æ”¯æŒocsp staplingã€‚ å®é™…ä¸Š Google/AWS ç­‰å¤§å¤šæ•°ç«™ç‚¹éƒ½ä¸ä¼šå¯ç”¨ä¹Ÿä¸éœ€è¦å¯ç”¨ ocsp staplingï¼Œä¸€æ˜¯å› ä¸ºå®ƒä»¬è‡ªå·±å°±æ˜¯è¯ä¹¦é¢å‘æœºæ„ï¼ŒOCSP æœåŠ¡å™¨ä¹Ÿå½’å®ƒä»¬è‡ªå·±ç®¡ï¼Œä¸å­˜åœ¨éšç§çš„é—®é¢˜ã€‚äºŒæ˜¯å®ƒä»¬çš„ OCSP æœåŠ¡å™¨éå¸ƒ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:4:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#tls-11"},{"categories":["tech"],"content":" 1. å¯†ç å¥—ä»¶ä¸ TLS å†å²ç‰ˆæœ¬å¯†ç å¥—ä»¶ï¼ˆCipher_suiteï¼‰æ˜¯ TLS åè®®ä¸­ä¸€ç»„ç”¨äºå®ç°å®‰å…¨é€šè®¯çš„å¯†ç å­¦ç®—æ³•ï¼Œç±»ä¼¼äºæˆ‘ä»¬å‰é¢å­¦ä¹ è¿‡çš„åŠ å¯†æ–¹æ¡ˆã€‚ä¸åŒå¯†ç å­¦ç®—æ³•çš„ç»„åˆå½¢æˆä¸åŒçš„å¯†ç å¥—ä»¶ï¼Œç®—æ³•ç»„åˆçš„å·®å¼‚ä½¿è¿™äº›å¯†ç å¥—ä»¶å…·æœ‰ä¸åŒçš„æ€§èƒ½ä¸å®‰å…¨æ€§ï¼Œå¦å¤– TLS åè®®çš„æ›´æ–°è¿­ä»£ä¹Ÿå¯¼è‡´å„å¯†ç å¥—ä»¶æ‹¥æœ‰ä¸åŒçš„å…¼å®¹æ€§ã€‚é€šå¸¸è¶Šæ–°æ¨å‡ºçš„å¯†ç å¥—ä»¶çš„å®‰å…¨æ€§è¶Šé«˜ï¼Œä½†æ˜¯å…¼å®¹æ€§å°±è¶Šå·®ï¼ˆæ—§è®¾å¤‡ä¸æ”¯æŒï¼‰ã€‚ å¯†ç å¥—ä»¶çš„åç§°ç”±å®ƒä½¿ç”¨çš„å„ç§å¯†ç å­¦ç®—æ³•åç§°ç»„æˆï¼Œè€Œä¸”æœ‰å›ºå®šçš„æ ¼å¼ï¼Œä»¥TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 ä¸ºä¾‹ä»‹ç»ä¸‹ï¼š TLS: å®šä¹‰äº†æ­¤å¥—ä»¶é€‚ç”¨çš„åè®®ï¼Œé€šå¸¸å›ºå®šä¸º TLS ECDHE: å¯†é’¥äº¤æ¢ç®—æ³• RSA: æ•°å­—è¯ä¹¦è®¤è¯ç®—æ³• AES_128_GCM: ä½¿ç”¨çš„å¯¹ç§°åŠ å¯†æ–¹æ¡ˆï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäº AES ä¸ GCM æ¨¡å¼çš„å¯¹ç§°è®¤è¯åŠ å¯†æ–¹æ¡ˆï¼Œä½¿ç”¨ 128 ä½å¯†é’¥ SHA256: å“ˆå¸Œå‡½æ•°ï¼Œç”¨äº HMAC ç®—æ³•å®ç°æ¶ˆæ¯è®¤è¯ TLS å›ºå®šä½¿ç”¨ HMAC ç®—æ³•è¿›è¡Œæ¶ˆæ¯è®¤è¯ TLS åè®®çš„å‰èº«æ˜¯ SSL åè®®ï¼ŒTLS/SSL çš„å‘å±•å†ç¨‹å±•ç¤ºå¦‚ä¸‹ï¼š SSL/TLS çš„å†å²ç‰ˆæœ¬ SSL åè®®æ—©åœ¨ 2015 å¹´å°±è¢«å„å¤§ä¸»æµæµè§ˆå™¨åºŸé™¤äº†ï¼ŒTLS1.0 æ„Ÿè§‰ä¹ŸåŸºæœ¬æ²¡ç«™ç‚¹åœ¨ç”¨äº†ï¼Œè¿™ä¿©å°±ç›´æ¥è·³è¿‡äº†ã€‚ ä¸‹é¢åˆ†åˆ«ä»‹ç»ä¸‹ TLS1.1 TLS1.2 ä¸ TLS1.3. TLS 1.1TLS 1.1 åœ¨ RFC4346 ä¸­å®šä¹‰ï¼Œäº 2006 å¹´ 4 æœˆå‘å¸ƒã€‚ TLS 1.1 æ˜¯ TLS 1.0 çš„ä¸€ä¸ªè¡¥ä¸ï¼Œä¸»è¦æ›´æ–°åŒ…æ‹¬ï¼š æ·»åŠ å¯¹CBCæ”»å‡»çš„ä¿æŠ¤ éšå¼åˆå§‹å‘é‡ IV è¢«æ›¿æ¢æˆä¸€ä¸ªæ˜¾å¼çš„ IV ä¿®å¤åˆ†ç»„å¯†ç æ¨¡å¼ä¸­å¡«å……ç®—æ³•çš„ bug æ”¯æŒ IANA ç™»è®°çš„å‚æ•° TLS 1.1åŠå…¶ä¹‹å‰çš„ç®—æ³•æ›¾ç»è¢«å¹¿æ³›åº”ç”¨ï¼Œå®ƒç›®å‰å·²çŸ¥çš„ç¼ºé™·å¦‚ä¸‹ï¼š ä¸æ”¯æŒ PFS å®Œå…¨å‰å‘ä¿å¯† ä¸æ”¯æŒ AEAD è®¤è¯åŠ å¯†ç®—æ³• ä¸ºäº†å…¼å®¹æ€§ï¼Œä¿ç•™äº†å¾ˆå¤šä¸å®‰å…¨çš„ç®—æ³• TLS 1.1 å·²ç»ä¸å¤Ÿå®‰å…¨äº†ï¼Œä¸è¿‡ä¸€äº›é™ˆå¹´è€ç«™ç‚¹æˆ–è®¸è¿˜åœ¨ä½¿ç”¨å®ƒã€‚ å„æ“ä½œç³»ç»Ÿï¼ˆAndroid/IOS/MacOS/Windowsï¼‰ä¸æµè§ˆå™¨åŸºæœ¬éƒ½åœ¨å¾ˆæ—©çš„ç‰ˆæœ¬ä¸­å°±å·²ç»æ”¯æŒ TLS1.2+ äº†ï¼Œ ç«™åœ¨ 2022 å¹´è¿™ä¸ªæ—¶é—´èŠ‚ç‚¹çœ‹ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥å®Œå…¨åºŸæ­¢ TLS1.1 åè®®ã€‚å®é™…ä¸Šå„å¤§äº‘å‚å•†ä¹Ÿæ˜¯è¿™ä¹ˆå¹²çš„ï¼Œæ¯”å¦‚ AWS è‡ªèº«çš„ API å¯¹ TLS1.1 çš„æ”¯æŒå°±å·²ç¡®å®šå°†åœ¨ 2023 å¹´ 6 æœˆåºŸæ­¢ï¼Œ2022 å¹´å°±å¼€å§‹é¢‘ç¹æ‰«æå¹¶æé†’å„ä½ä»ç„¶åœ¨ä½¿ç”¨ä½ç‰ˆæœ¬ TLS åè®®çš„å®¢æˆ·å‡çº§ã€‚ TLS 1.2TLS 1.2 åœ¨ RFC5246 ä¸­å®šä¹‰ï¼Œäº 2008 å¹´ 8 æœˆå‘å‘å¸ƒã€‚ å¯é€‰æ”¯æŒ PFS å®Œå…¨å‰å‘ä¿å¯† ç§»é™¤å¯¹ MD5 ä¸ SHA-1 ç­¾åç®—æ³•çš„æ”¯æŒ æ·»åŠ å¯¹ HMAC-SHA-256 åŠ HMAC-SHA-384 æ¶ˆæ¯è®¤è¯ç®—æ³•çš„æ”¯æŒ æ·»åŠ å¯¹ AEAD åŠ å¯†è®¤è¯æ–¹æ¡ˆçš„æ”¯æŒ å»é™¤ forback å›åˆ° SSL åè®®çš„èƒ½åŠ›ï¼Œæå‡å®‰å…¨æ€§ ä¸ºäº†å…¼å®¹æ€§ï¼Œä¿ç•™äº†å¾ˆå¤šä¸å®‰å…¨çš„ç®—æ³• å¦‚æœä½ ä½¿ç”¨ TLS 1.2ï¼Œéœ€è¦å°å¿ƒåœ°é€‰æ‹©å¯†ç å¥—ä»¶ï¼Œé¿å¼€ä¸å®‰å…¨çš„å¥—ä»¶ï¼Œå°±èƒ½å®ç°è¶³å¤Ÿé«˜çš„å®‰å…¨æ€§ã€‚ TLS 1.3TLS 1.3 åšäº†ä¸€æ¬¡å¤§åˆ€é˜”æ–§çš„æ›´æ–°ï¼Œæ˜¯ä¸€ä¸ªé‡Œç¨‹ç¢‘å¼çš„ç‰ˆæœ¬ï¼Œå…¶æ›´æ–°æ€»ç»“å¦‚ä¸‹ï¼š ç§»é™¤å¯¹å¦‚ä¸‹ç®—æ³•çš„æ”¯æŒ å“ˆå¸Œå‡½æ•° SHA1/MD5 æ‰€æœ‰é AEAD åŠ å¯†è®¤è¯çš„å¯†ç æ–¹æ¡ˆï¼ˆCBC æ¨¡å¼ï¼‰ ç§»é™¤å¯¹ RC4 ä¸ 3DES åŠ å¯†ç®—æ³•çš„æ”¯æŒ ç§»é™¤äº†é™æ€ RSA ä¸ DH å¯†é’¥äº¤æ¢ç®—æ³• æ”¯æŒé«˜æ€§èƒ½çš„ Ed25519/Ed448 ç­¾åè®¤è¯ç®—æ³•ã€X25519 å¯†é’¥åå•†ç®—æ³• æ”¯æŒé«˜æ€§èƒ½çš„ ChaCha20-Poly1305 å¯¹ç§°è®¤è¯åŠ å¯†æ–¹æ¡ˆ å°†å¯†é’¥äº¤æ¢ç®—æ³•ä¸å…¬é’¥è®¤è¯ç®—æ³•ä»å¯†ç å¥—ä»¶ä¸­åˆ†ç¦»å‡ºæ¥ æ¯”å¦‚åŸæ¥çš„ TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 å¯†ç å¥—ä»¶å°†è¢«æ‹†åˆ†ä¸º ECDHE ç®—æ³•ã€RSA èº«ä»½è®¤è¯ç®—æ³•ã€ä»¥åŠ TLS_AES_128_GCM_SHA256 å¯†ç å¥—ä»¶ è¿™æ ·å¯†ç å¥—ä»¶å°±åªåŒ…å«ä¸€ä¸ª AEAD è®¤è¯åŠ å¯†æ–¹æ¡ˆï¼Œä»¥åŠä¸€ä¸ªå“ˆå¸Œå‡½æ•°äº† ä»…æ”¯æŒå‰å‘å®‰å…¨çš„å¯†é’¥äº¤æ¢ç®—æ³• DHE æˆ– ECDHE æ”¯æŒæœ€çŸ­ 0-RTT çš„ TLS æ¡æ‰‹ï¼ˆä¼šè¯æ¢å¤ï¼‰ TLS 1.3 ä»åè®®ä¸­åˆ é™¤äº†æ‰€æœ‰ä¸å®‰å…¨çš„ç®—æ³•æˆ–åè®®ï¼Œå¯ä»¥è¯´åªè¦ä½ çš„é€šè®¯ç”¨äº† TLS 1.3ï¼Œé‚£ä½ çš„æ•°æ®å°±å®‰å…¨äº†ï¼ˆå½“ç„¶å‰ææ˜¯ä½ çš„ç§é’¥æ²¡æ³„æ¼ï¼‰ã€‚ å¦‚ä½•è®¾ç½® TLS åè®®çš„ç‰ˆæœ¬ã€å¯†ç å¥—ä»¶å‚æ•°æˆ‘ä»¬å‰é¢å·²ç»å­¦ä¹ äº†å¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†ã€å¯†é’¥äº¤æ¢ä¸‰éƒ¨åˆ†çŸ¥è¯†ï¼Œå¯¹ç…§ TLS å¥—ä»¶çš„åç§°ï¼Œåº”è¯¥èƒ½å¾ˆå®¹æ˜“åˆ¤æ–­å‡ºå“ªäº›æ˜¯å®‰å…¨çš„ã€å“ªäº›ä¸å¤Ÿå®‰å…¨ï¼Œå“ªäº›æ”¯æŒå‰å‘ä¿å¯†ã€å“ªäº›ä¸æ”¯æŒã€‚ ä¸€ä¸ªéå¸¸å¥½ç”¨çš„ã€Œç«™ç‚¹ HTTPS å®‰å…¨æ£€æµ‹ã€ç½‘ç«™æ˜¯ https://myssl.com/ï¼Œä½¿ç”¨å®ƒæµ‹è¯•çŸ¥ä¹ç½‘çš„æ£€æµ‹ç»“æœå¦‚ä¸‹ï¼š SSL/TLS çš„å†å²ç‰ˆæœ¬ èƒ½çœ‹åˆ°çŸ¥ä¹ä¸ºäº†å…¼å®¹æ€§ï¼Œç›®å‰ä»ç„¶æ”¯æŒ TLS1.0 ä¸ TLS1.1ï¼Œå¦å¤–ç›®å‰è¿˜ä¸æ”¯æŒ TLS1.3. æ­¤å¤–ï¼ŒçŸ¥ä¹ä»ç„¶æ”¯æŒå¾ˆå¤šå·²ç»ä¸å®‰å…¨çš„åŠ å¯†å¥—ä»¶ï¼Œmyssl.com ä¸“é—¨ä½¿ç”¨é»„è‰²æ ‡è¯†å‡ºäº†è¿™äº›ä¸å®‰å…¨çš„åŠ å¯†å¥—ä»¶ï¼Œæˆ‘ä»¬æ€»ç»“ä¸‹ä¸»è¦ç‰¹å¾ï¼š éƒ¨åˆ†å¯†ç å¥—ä»¶ä½¿ç”¨äº†ä¸å®‰å…¨çš„å¯¹ç§°åŠ å¯†ç®—æ³• 3DES å…¶ä»–è¢«æ ‡è¯†ä¸ºé»„è‰²çš„å¥—ä»¶è™½ç„¶ä½¿ç”¨äº†å®‰å…¨çš„å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œä½†æ˜¯ä¸æ”¯æŒ PFS å‰å‘ä¿å¯† æ­¤å¤– myssl.com è¿˜åˆ—å‡ºäº†è®¸å¤šç«™ç‚¹æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ TLS1.3 çš„ä¼šè¯æ¢å¤ï¼Œä»¥åŠåé¢å°†ä¼šä»‹ç»çš„å…¬é’¥å›ºå®šã€HTTPä¸¥æ ¼ä¼ è¾“å®‰å…¨ç­‰ä¿¡æ¯ï¼š SSL/TLS çš„å†å²ç‰ˆæœ¬ Nginx çš„ TLS åè®®é…ç½®ä»¥å‰ä¸º Nginx ç­‰ç¨‹åºé…ç½® HTTPS åè®®æ—¶ï¼Œæˆ‘æœ€å¤´ç–¼çš„å°±æ˜¯å…¶ä¸­å¯†ç å¥—ä»¶å‚æ•° ssl_ciphersï¼Œä¸ºäº†å®‰å…¨æ€§ï¼Œéœ€è¦é…ç½®è¶…é•¿çš„ä¸€å¤§å †é€‰ç”¨çš„å¯†ç å¥—ä»¶åç§°ï¼Œæˆ‘å¯ä»¥è¯´ä¸€ä¸ªéƒ½çœ‹ä¸æ‡‚ï¼Œä½†æ˜¯ä¸ºäº†æŠŠç½‘ç«™æå¥½è¿˜æ˜¯å¾—ç¡¬ç€å¤´çš®æœç´¢å¤åˆ¶ç²˜è´´ï¼Œå®é™…ä¸Šä¹Ÿä¸æ¸…æ¥šå®‰å…¨æ€§åˆ°åº•å¦‚ä½•ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒMozilla/DigitalOcean éƒ½æè¿‡æµè¡Œ Web æœåŠ¡å™¨çš„ TLS é…ç½®ç”Ÿæˆå·¥å…·ï¼Œæ¯”å¦‚ssl-config - mozillaï¼Œè¿™ä¸ªç½‘ç«™æä¾›ä¸‰ä¸ªå®‰å…¨ç­‰çº§çš„é…ç½®: ã€ŒIntermediateã€: æŸ¥çœ‹ç”Ÿæˆå‡ºçš„ ssl-cipher å±æ€§ï¼Œå‘ç°å®ƒåªæ”¯æŒ ECDHE/DHE å¼€å¤´çš„ç®—æ³•ã€‚å› æ­¤å®ƒä¿è¯å‰å‘ä¿å¯†ã€‚ å¯¹äºéœ€è¦é€šè¿‡æµè§ˆå™¨è®¿é—®çš„ APIï¼Œæ¨èé€‰æ‹©è¿™ä¸ªç­‰çº§ã€‚ ã€ŒModernã€: åªæ”¯æŒ TLSv1.3ï¼Œè¯¥åè®®åºŸå¼ƒæ‰äº†è¿‡å¾€æ‰€æœ‰ä¸å®‰å…¨çš„ç®—æ³•ï¼Œä¿è¯å‰å‘ä¿å¯†ï¼Œå®‰å…¨æ€§æé«˜ï¼Œæ€§èƒ½ä¹Ÿæ›´å¥½ã€‚ å¯¹äºä¸éœ€è¦é€šè¿‡æµè§ˆå™¨ç­‰æ—§ç»ˆç«¯è®¿é—®çš„ APIï¼Œè¯·ç›´æ¥é€‰æ‹©è¿™ä¸ªç­‰çº§ã€‚ ã€ŒOldã€: é™¤éä½ çš„ç”¨æˆ·ä½¿ç”¨éå¸¸è€çš„ç»ˆç«¯è¿›è¡Œè®¿é—®ï¼Œå¦åˆ™è¯·ä¸è¦è€ƒè™‘è¿™ä¸ªé€‰é¡¹ï¼ å¯ä»¥ç‚¹è¿›å»æŸ¥çœ‹è¯¦ç»†çš„ TLS å¥—ä»¶é…ç½®ã€‚ OCSP è¯ä¹¦éªŒè¯åè®® https://www.ssl.com/blogs/how-do-browsers-handle-revoked-ssl-tls-certificates/ https://imququ.com/post/why-can-not-turn-on-ocsp-stapling.html https://www.digicert.com/help/ å‰é¢æåˆ°é™¤äº†æ•°å­—è¯ä¹¦è‡ªå¸¦çš„æœ‰æ•ˆæœŸå¤–ï¼Œä¸ºäº†åœ¨ç§é’¥æ³„æ¼çš„æƒ…å†µä¸‹ï¼Œèƒ½å¤ŸåŠé”€å¯¹åº”çš„è¯ä¹¦ï¼ŒPKI å…¬é’¥åŸºç¡€è®¾æ–½è¿˜æä¾›äº† OCSPï¼ˆOnline Certificate Status Protocolï¼‰è¯ä¹¦çŠ¶æ€æŸ¥è¯¢åè®®ã€‚ è¿™å¯¼è‡´äº†ä¸€äº›é—®é¢˜ï¼š Chrome/Firefox ç­‰æµè§ˆå™¨éƒ½ä¼šå®šæœŸé€šè¿‡ OCSP åè®®å»è¯·æ±‚ CA æœºæ„çš„ OCSP æœåŠ¡å™¨éªŒè¯è¯ä¹¦çŠ¶æ€ï¼Œ è¿™å¯èƒ½ä¼šæ‹–æ…¢ HTTPS åè®®çš„å“åº”é€Ÿåº¦ã€‚ æ‰€è°“çš„å®šæœŸæ˜¯æŒ‡è¶…è¿‡ä¸Šä¸€ä¸ª OCSP å“åº”çš„ nextUpdate æ—¶é—´ï¼ˆä¸€èˆ¬ä¸º 7 å¤©ï¼‰ï¼Œæˆ–è€…å¦‚æœè¯¥å€¼ä¸ºç©ºçš„è¯ï¼ŒFirefox é»˜è®¤ 24h åä¼šé‡æ–°æŸ¥è¯¢ OCSP çŠ¶æ€ã€‚ å› ä¸ºå®¢æˆ·ç«¯ç›´æ¥å»è¯·æ±‚ CA æœºæ„çš„ OCSP åœ°å€è·å–è¯ä¹¦çŠ¶æ€ï¼Œè¿™å°±å¯¼è‡´ CA æœºæ„å¯ä»¥è·å–åˆ°ä¸€äº›å¯¹åº”ç«™ç‚¹çš„ç”¨æˆ·ä¿¡æ¯ï¼ˆIP åœ°å€ã€ç½‘ç»œçŠ¶æ€ç­‰ï¼‰ã€‚ ä¸ºäº†è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œrfc6066 å®šä¹‰äº† OCSP stapling åŠŸèƒ½ï¼Œå®ƒä½¿æœåŠ¡å™¨å¯ä»¥æå‰è®¿é—® OCSP è·å–è¯ä¹¦çŠ¶æ€ä¿¡æ¯å¹¶ç¼“å­˜åˆ°æœ¬åœ°ï¼ŒåŸºæœ¬ Nginx/Caddy ç­‰å„å¤§ Web æœåŠ¡å™¨æˆ–ç½‘å…³ï¼Œéƒ½æ”¯æŒ OCSP stapling åè®®ã€‚ åœ¨å®¢æˆ·ç«¯ä½¿ç”¨ TLS åè®®è®¿é—® HTTPS æœåŠ¡æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šç›´æ¥åœ¨æ¡æ‰‹é˜¶æ®µå°†ç¼“å­˜çš„ OCSP ä¿¡æ¯å‘é€ç»™å®¢æˆ·ç«¯ã€‚å› ä¸º OCSP ä¿¡æ¯ä¼šå¸¦æœ‰ CA è¯ä¹¦çš„ç­¾ååŠæœ‰æ•ˆæœŸï¼Œå®¢æˆ·ç«¯å¯ä»¥ç›´æ¥é€šè¿‡ç­¾åéªŒè¯ OCSP ä¿¡æ¯çš„çœŸå®æ€§ä¸æœ‰æ•ˆæ€§ï¼Œè¿™æ ·å°±é¿å…äº†å®¢æˆ·ç«¯è®¿é—® OCSP æœåŠ¡å™¨å¸¦æ¥çš„å¼€é”€ã€‚ è€Œå¦ä¸€ä¸ªæ–¹æ³•ï¼Œå°±æ˜¯é€‰ç”¨ ocsp æœåŠ¡å™¨åœ¨ç›®æ ‡ç”¨æˆ·åŒºåŸŸé€Ÿåº¦å¿«çš„ CA æœºæ„ç­¾å‘è¯ä¹¦ã€‚ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æµ‹è¯•ï¼Œç¡®è®¤ç«™ç‚¹æ˜¯å¦å¯ç”¨äº† ocsp stapling: conf $ openssl s_client -connect www.digicert.com:443 -servername www.digicert.com -status -tlsextdebug \u003c /dev/null 2\u003e\u00261 | grep -i \"OCSP response\" å¦‚æœè¾“å‡ºåŒ…å« OCSP Response Status: successful å°±è¯´æ˜ç«™ç‚¹æ”¯æŒ ocsp staplingï¼Œå¦‚æœè¾“å‡ºå†…å®¹ä¸º OCSP response: no response sent åˆ™è¯´æ˜ç«™ç‚¹ä¸æ”¯æŒocsp staplingã€‚ å®é™…ä¸Š Google/AWS ç­‰å¤§å¤šæ•°ç«™ç‚¹éƒ½ä¸ä¼šå¯ç”¨ä¹Ÿä¸éœ€è¦å¯ç”¨ ocsp staplingï¼Œä¸€æ˜¯å› ä¸ºå®ƒä»¬è‡ªå·±å°±æ˜¯è¯ä¹¦é¢å‘æœºæ„ï¼ŒOCSP æœåŠ¡å™¨ä¹Ÿå½’å®ƒä»¬è‡ªå·±ç®¡ï¼Œä¸å­˜åœ¨éšç§çš„é—®é¢˜ã€‚äºŒæ˜¯å®ƒä»¬çš„ OCSP æœåŠ¡å™¨éå¸ƒ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:4:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#tls-12"},{"categories":["tech"],"content":" 1. å¯†ç å¥—ä»¶ä¸ TLS å†å²ç‰ˆæœ¬å¯†ç å¥—ä»¶ï¼ˆCipher_suiteï¼‰æ˜¯ TLS åè®®ä¸­ä¸€ç»„ç”¨äºå®ç°å®‰å…¨é€šè®¯çš„å¯†ç å­¦ç®—æ³•ï¼Œç±»ä¼¼äºæˆ‘ä»¬å‰é¢å­¦ä¹ è¿‡çš„åŠ å¯†æ–¹æ¡ˆã€‚ä¸åŒå¯†ç å­¦ç®—æ³•çš„ç»„åˆå½¢æˆä¸åŒçš„å¯†ç å¥—ä»¶ï¼Œç®—æ³•ç»„åˆçš„å·®å¼‚ä½¿è¿™äº›å¯†ç å¥—ä»¶å…·æœ‰ä¸åŒçš„æ€§èƒ½ä¸å®‰å…¨æ€§ï¼Œå¦å¤– TLS åè®®çš„æ›´æ–°è¿­ä»£ä¹Ÿå¯¼è‡´å„å¯†ç å¥—ä»¶æ‹¥æœ‰ä¸åŒçš„å…¼å®¹æ€§ã€‚é€šå¸¸è¶Šæ–°æ¨å‡ºçš„å¯†ç å¥—ä»¶çš„å®‰å…¨æ€§è¶Šé«˜ï¼Œä½†æ˜¯å…¼å®¹æ€§å°±è¶Šå·®ï¼ˆæ—§è®¾å¤‡ä¸æ”¯æŒï¼‰ã€‚ å¯†ç å¥—ä»¶çš„åç§°ç”±å®ƒä½¿ç”¨çš„å„ç§å¯†ç å­¦ç®—æ³•åç§°ç»„æˆï¼Œè€Œä¸”æœ‰å›ºå®šçš„æ ¼å¼ï¼Œä»¥TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 ä¸ºä¾‹ä»‹ç»ä¸‹ï¼š TLS: å®šä¹‰äº†æ­¤å¥—ä»¶é€‚ç”¨çš„åè®®ï¼Œé€šå¸¸å›ºå®šä¸º TLS ECDHE: å¯†é’¥äº¤æ¢ç®—æ³• RSA: æ•°å­—è¯ä¹¦è®¤è¯ç®—æ³• AES_128_GCM: ä½¿ç”¨çš„å¯¹ç§°åŠ å¯†æ–¹æ¡ˆï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäº AES ä¸ GCM æ¨¡å¼çš„å¯¹ç§°è®¤è¯åŠ å¯†æ–¹æ¡ˆï¼Œä½¿ç”¨ 128 ä½å¯†é’¥ SHA256: å“ˆå¸Œå‡½æ•°ï¼Œç”¨äº HMAC ç®—æ³•å®ç°æ¶ˆæ¯è®¤è¯ TLS å›ºå®šä½¿ç”¨ HMAC ç®—æ³•è¿›è¡Œæ¶ˆæ¯è®¤è¯ TLS åè®®çš„å‰èº«æ˜¯ SSL åè®®ï¼ŒTLS/SSL çš„å‘å±•å†ç¨‹å±•ç¤ºå¦‚ä¸‹ï¼š SSL/TLS çš„å†å²ç‰ˆæœ¬ SSL åè®®æ—©åœ¨ 2015 å¹´å°±è¢«å„å¤§ä¸»æµæµè§ˆå™¨åºŸé™¤äº†ï¼ŒTLS1.0 æ„Ÿè§‰ä¹ŸåŸºæœ¬æ²¡ç«™ç‚¹åœ¨ç”¨äº†ï¼Œè¿™ä¿©å°±ç›´æ¥è·³è¿‡äº†ã€‚ ä¸‹é¢åˆ†åˆ«ä»‹ç»ä¸‹ TLS1.1 TLS1.2 ä¸ TLS1.3. TLS 1.1TLS 1.1 åœ¨ RFC4346 ä¸­å®šä¹‰ï¼Œäº 2006 å¹´ 4 æœˆå‘å¸ƒã€‚ TLS 1.1 æ˜¯ TLS 1.0 çš„ä¸€ä¸ªè¡¥ä¸ï¼Œä¸»è¦æ›´æ–°åŒ…æ‹¬ï¼š æ·»åŠ å¯¹CBCæ”»å‡»çš„ä¿æŠ¤ éšå¼åˆå§‹å‘é‡ IV è¢«æ›¿æ¢æˆä¸€ä¸ªæ˜¾å¼çš„ IV ä¿®å¤åˆ†ç»„å¯†ç æ¨¡å¼ä¸­å¡«å……ç®—æ³•çš„ bug æ”¯æŒ IANA ç™»è®°çš„å‚æ•° TLS 1.1åŠå…¶ä¹‹å‰çš„ç®—æ³•æ›¾ç»è¢«å¹¿æ³›åº”ç”¨ï¼Œå®ƒç›®å‰å·²çŸ¥çš„ç¼ºé™·å¦‚ä¸‹ï¼š ä¸æ”¯æŒ PFS å®Œå…¨å‰å‘ä¿å¯† ä¸æ”¯æŒ AEAD è®¤è¯åŠ å¯†ç®—æ³• ä¸ºäº†å…¼å®¹æ€§ï¼Œä¿ç•™äº†å¾ˆå¤šä¸å®‰å…¨çš„ç®—æ³• TLS 1.1 å·²ç»ä¸å¤Ÿå®‰å…¨äº†ï¼Œä¸è¿‡ä¸€äº›é™ˆå¹´è€ç«™ç‚¹æˆ–è®¸è¿˜åœ¨ä½¿ç”¨å®ƒã€‚ å„æ“ä½œç³»ç»Ÿï¼ˆAndroid/IOS/MacOS/Windowsï¼‰ä¸æµè§ˆå™¨åŸºæœ¬éƒ½åœ¨å¾ˆæ—©çš„ç‰ˆæœ¬ä¸­å°±å·²ç»æ”¯æŒ TLS1.2+ äº†ï¼Œ ç«™åœ¨ 2022 å¹´è¿™ä¸ªæ—¶é—´èŠ‚ç‚¹çœ‹ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥å®Œå…¨åºŸæ­¢ TLS1.1 åè®®ã€‚å®é™…ä¸Šå„å¤§äº‘å‚å•†ä¹Ÿæ˜¯è¿™ä¹ˆå¹²çš„ï¼Œæ¯”å¦‚ AWS è‡ªèº«çš„ API å¯¹ TLS1.1 çš„æ”¯æŒå°±å·²ç¡®å®šå°†åœ¨ 2023 å¹´ 6 æœˆåºŸæ­¢ï¼Œ2022 å¹´å°±å¼€å§‹é¢‘ç¹æ‰«æå¹¶æé†’å„ä½ä»ç„¶åœ¨ä½¿ç”¨ä½ç‰ˆæœ¬ TLS åè®®çš„å®¢æˆ·å‡çº§ã€‚ TLS 1.2TLS 1.2 åœ¨ RFC5246 ä¸­å®šä¹‰ï¼Œäº 2008 å¹´ 8 æœˆå‘å‘å¸ƒã€‚ å¯é€‰æ”¯æŒ PFS å®Œå…¨å‰å‘ä¿å¯† ç§»é™¤å¯¹ MD5 ä¸ SHA-1 ç­¾åç®—æ³•çš„æ”¯æŒ æ·»åŠ å¯¹ HMAC-SHA-256 åŠ HMAC-SHA-384 æ¶ˆæ¯è®¤è¯ç®—æ³•çš„æ”¯æŒ æ·»åŠ å¯¹ AEAD åŠ å¯†è®¤è¯æ–¹æ¡ˆçš„æ”¯æŒ å»é™¤ forback å›åˆ° SSL åè®®çš„èƒ½åŠ›ï¼Œæå‡å®‰å…¨æ€§ ä¸ºäº†å…¼å®¹æ€§ï¼Œä¿ç•™äº†å¾ˆå¤šä¸å®‰å…¨çš„ç®—æ³• å¦‚æœä½ ä½¿ç”¨ TLS 1.2ï¼Œéœ€è¦å°å¿ƒåœ°é€‰æ‹©å¯†ç å¥—ä»¶ï¼Œé¿å¼€ä¸å®‰å…¨çš„å¥—ä»¶ï¼Œå°±èƒ½å®ç°è¶³å¤Ÿé«˜çš„å®‰å…¨æ€§ã€‚ TLS 1.3TLS 1.3 åšäº†ä¸€æ¬¡å¤§åˆ€é˜”æ–§çš„æ›´æ–°ï¼Œæ˜¯ä¸€ä¸ªé‡Œç¨‹ç¢‘å¼çš„ç‰ˆæœ¬ï¼Œå…¶æ›´æ–°æ€»ç»“å¦‚ä¸‹ï¼š ç§»é™¤å¯¹å¦‚ä¸‹ç®—æ³•çš„æ”¯æŒ å“ˆå¸Œå‡½æ•° SHA1/MD5 æ‰€æœ‰é AEAD åŠ å¯†è®¤è¯çš„å¯†ç æ–¹æ¡ˆï¼ˆCBC æ¨¡å¼ï¼‰ ç§»é™¤å¯¹ RC4 ä¸ 3DES åŠ å¯†ç®—æ³•çš„æ”¯æŒ ç§»é™¤äº†é™æ€ RSA ä¸ DH å¯†é’¥äº¤æ¢ç®—æ³• æ”¯æŒé«˜æ€§èƒ½çš„ Ed25519/Ed448 ç­¾åè®¤è¯ç®—æ³•ã€X25519 å¯†é’¥åå•†ç®—æ³• æ”¯æŒé«˜æ€§èƒ½çš„ ChaCha20-Poly1305 å¯¹ç§°è®¤è¯åŠ å¯†æ–¹æ¡ˆ å°†å¯†é’¥äº¤æ¢ç®—æ³•ä¸å…¬é’¥è®¤è¯ç®—æ³•ä»å¯†ç å¥—ä»¶ä¸­åˆ†ç¦»å‡ºæ¥ æ¯”å¦‚åŸæ¥çš„ TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 å¯†ç å¥—ä»¶å°†è¢«æ‹†åˆ†ä¸º ECDHE ç®—æ³•ã€RSA èº«ä»½è®¤è¯ç®—æ³•ã€ä»¥åŠ TLS_AES_128_GCM_SHA256 å¯†ç å¥—ä»¶ è¿™æ ·å¯†ç å¥—ä»¶å°±åªåŒ…å«ä¸€ä¸ª AEAD è®¤è¯åŠ å¯†æ–¹æ¡ˆï¼Œä»¥åŠä¸€ä¸ªå“ˆå¸Œå‡½æ•°äº† ä»…æ”¯æŒå‰å‘å®‰å…¨çš„å¯†é’¥äº¤æ¢ç®—æ³• DHE æˆ– ECDHE æ”¯æŒæœ€çŸ­ 0-RTT çš„ TLS æ¡æ‰‹ï¼ˆä¼šè¯æ¢å¤ï¼‰ TLS 1.3 ä»åè®®ä¸­åˆ é™¤äº†æ‰€æœ‰ä¸å®‰å…¨çš„ç®—æ³•æˆ–åè®®ï¼Œå¯ä»¥è¯´åªè¦ä½ çš„é€šè®¯ç”¨äº† TLS 1.3ï¼Œé‚£ä½ çš„æ•°æ®å°±å®‰å…¨äº†ï¼ˆå½“ç„¶å‰ææ˜¯ä½ çš„ç§é’¥æ²¡æ³„æ¼ï¼‰ã€‚ å¦‚ä½•è®¾ç½® TLS åè®®çš„ç‰ˆæœ¬ã€å¯†ç å¥—ä»¶å‚æ•°æˆ‘ä»¬å‰é¢å·²ç»å­¦ä¹ äº†å¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†ã€å¯†é’¥äº¤æ¢ä¸‰éƒ¨åˆ†çŸ¥è¯†ï¼Œå¯¹ç…§ TLS å¥—ä»¶çš„åç§°ï¼Œåº”è¯¥èƒ½å¾ˆå®¹æ˜“åˆ¤æ–­å‡ºå“ªäº›æ˜¯å®‰å…¨çš„ã€å“ªäº›ä¸å¤Ÿå®‰å…¨ï¼Œå“ªäº›æ”¯æŒå‰å‘ä¿å¯†ã€å“ªäº›ä¸æ”¯æŒã€‚ ä¸€ä¸ªéå¸¸å¥½ç”¨çš„ã€Œç«™ç‚¹ HTTPS å®‰å…¨æ£€æµ‹ã€ç½‘ç«™æ˜¯ https://myssl.com/ï¼Œä½¿ç”¨å®ƒæµ‹è¯•çŸ¥ä¹ç½‘çš„æ£€æµ‹ç»“æœå¦‚ä¸‹ï¼š SSL/TLS çš„å†å²ç‰ˆæœ¬ èƒ½çœ‹åˆ°çŸ¥ä¹ä¸ºäº†å…¼å®¹æ€§ï¼Œç›®å‰ä»ç„¶æ”¯æŒ TLS1.0 ä¸ TLS1.1ï¼Œå¦å¤–ç›®å‰è¿˜ä¸æ”¯æŒ TLS1.3. æ­¤å¤–ï¼ŒçŸ¥ä¹ä»ç„¶æ”¯æŒå¾ˆå¤šå·²ç»ä¸å®‰å…¨çš„åŠ å¯†å¥—ä»¶ï¼Œmyssl.com ä¸“é—¨ä½¿ç”¨é»„è‰²æ ‡è¯†å‡ºäº†è¿™äº›ä¸å®‰å…¨çš„åŠ å¯†å¥—ä»¶ï¼Œæˆ‘ä»¬æ€»ç»“ä¸‹ä¸»è¦ç‰¹å¾ï¼š éƒ¨åˆ†å¯†ç å¥—ä»¶ä½¿ç”¨äº†ä¸å®‰å…¨çš„å¯¹ç§°åŠ å¯†ç®—æ³• 3DES å…¶ä»–è¢«æ ‡è¯†ä¸ºé»„è‰²çš„å¥—ä»¶è™½ç„¶ä½¿ç”¨äº†å®‰å…¨çš„å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œä½†æ˜¯ä¸æ”¯æŒ PFS å‰å‘ä¿å¯† æ­¤å¤– myssl.com è¿˜åˆ—å‡ºäº†è®¸å¤šç«™ç‚¹æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ TLS1.3 çš„ä¼šè¯æ¢å¤ï¼Œä»¥åŠåé¢å°†ä¼šä»‹ç»çš„å…¬é’¥å›ºå®šã€HTTPä¸¥æ ¼ä¼ è¾“å®‰å…¨ç­‰ä¿¡æ¯ï¼š SSL/TLS çš„å†å²ç‰ˆæœ¬ Nginx çš„ TLS åè®®é…ç½®ä»¥å‰ä¸º Nginx ç­‰ç¨‹åºé…ç½® HTTPS åè®®æ—¶ï¼Œæˆ‘æœ€å¤´ç–¼çš„å°±æ˜¯å…¶ä¸­å¯†ç å¥—ä»¶å‚æ•° ssl_ciphersï¼Œä¸ºäº†å®‰å…¨æ€§ï¼Œéœ€è¦é…ç½®è¶…é•¿çš„ä¸€å¤§å †é€‰ç”¨çš„å¯†ç å¥—ä»¶åç§°ï¼Œæˆ‘å¯ä»¥è¯´ä¸€ä¸ªéƒ½çœ‹ä¸æ‡‚ï¼Œä½†æ˜¯ä¸ºäº†æŠŠç½‘ç«™æå¥½è¿˜æ˜¯å¾—ç¡¬ç€å¤´çš®æœç´¢å¤åˆ¶ç²˜è´´ï¼Œå®é™…ä¸Šä¹Ÿä¸æ¸…æ¥šå®‰å…¨æ€§åˆ°åº•å¦‚ä½•ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒMozilla/DigitalOcean éƒ½æè¿‡æµè¡Œ Web æœåŠ¡å™¨çš„ TLS é…ç½®ç”Ÿæˆå·¥å…·ï¼Œæ¯”å¦‚ssl-config - mozillaï¼Œè¿™ä¸ªç½‘ç«™æä¾›ä¸‰ä¸ªå®‰å…¨ç­‰çº§çš„é…ç½®: ã€ŒIntermediateã€: æŸ¥çœ‹ç”Ÿæˆå‡ºçš„ ssl-cipher å±æ€§ï¼Œå‘ç°å®ƒåªæ”¯æŒ ECDHE/DHE å¼€å¤´çš„ç®—æ³•ã€‚å› æ­¤å®ƒä¿è¯å‰å‘ä¿å¯†ã€‚ å¯¹äºéœ€è¦é€šè¿‡æµè§ˆå™¨è®¿é—®çš„ APIï¼Œæ¨èé€‰æ‹©è¿™ä¸ªç­‰çº§ã€‚ ã€ŒModernã€: åªæ”¯æŒ TLSv1.3ï¼Œè¯¥åè®®åºŸå¼ƒæ‰äº†è¿‡å¾€æ‰€æœ‰ä¸å®‰å…¨çš„ç®—æ³•ï¼Œä¿è¯å‰å‘ä¿å¯†ï¼Œå®‰å…¨æ€§æé«˜ï¼Œæ€§èƒ½ä¹Ÿæ›´å¥½ã€‚ å¯¹äºä¸éœ€è¦é€šè¿‡æµè§ˆå™¨ç­‰æ—§ç»ˆç«¯è®¿é—®çš„ APIï¼Œè¯·ç›´æ¥é€‰æ‹©è¿™ä¸ªç­‰çº§ã€‚ ã€ŒOldã€: é™¤éä½ çš„ç”¨æˆ·ä½¿ç”¨éå¸¸è€çš„ç»ˆç«¯è¿›è¡Œè®¿é—®ï¼Œå¦åˆ™è¯·ä¸è¦è€ƒè™‘è¿™ä¸ªé€‰é¡¹ï¼ å¯ä»¥ç‚¹è¿›å»æŸ¥çœ‹è¯¦ç»†çš„ TLS å¥—ä»¶é…ç½®ã€‚ OCSP è¯ä¹¦éªŒè¯åè®® https://www.ssl.com/blogs/how-do-browsers-handle-revoked-ssl-tls-certificates/ https://imququ.com/post/why-can-not-turn-on-ocsp-stapling.html https://www.digicert.com/help/ å‰é¢æåˆ°é™¤äº†æ•°å­—è¯ä¹¦è‡ªå¸¦çš„æœ‰æ•ˆæœŸå¤–ï¼Œä¸ºäº†åœ¨ç§é’¥æ³„æ¼çš„æƒ…å†µä¸‹ï¼Œèƒ½å¤ŸåŠé”€å¯¹åº”çš„è¯ä¹¦ï¼ŒPKI å…¬é’¥åŸºç¡€è®¾æ–½è¿˜æä¾›äº† OCSPï¼ˆOnline Certificate Status Protocolï¼‰è¯ä¹¦çŠ¶æ€æŸ¥è¯¢åè®®ã€‚ è¿™å¯¼è‡´äº†ä¸€äº›é—®é¢˜ï¼š Chrome/Firefox ç­‰æµè§ˆå™¨éƒ½ä¼šå®šæœŸé€šè¿‡ OCSP åè®®å»è¯·æ±‚ CA æœºæ„çš„ OCSP æœåŠ¡å™¨éªŒè¯è¯ä¹¦çŠ¶æ€ï¼Œ è¿™å¯èƒ½ä¼šæ‹–æ…¢ HTTPS åè®®çš„å“åº”é€Ÿåº¦ã€‚ æ‰€è°“çš„å®šæœŸæ˜¯æŒ‡è¶…è¿‡ä¸Šä¸€ä¸ª OCSP å“åº”çš„ nextUpdate æ—¶é—´ï¼ˆä¸€èˆ¬ä¸º 7 å¤©ï¼‰ï¼Œæˆ–è€…å¦‚æœè¯¥å€¼ä¸ºç©ºçš„è¯ï¼ŒFirefox é»˜è®¤ 24h åä¼šé‡æ–°æŸ¥è¯¢ OCSP çŠ¶æ€ã€‚ å› ä¸ºå®¢æˆ·ç«¯ç›´æ¥å»è¯·æ±‚ CA æœºæ„çš„ OCSP åœ°å€è·å–è¯ä¹¦çŠ¶æ€ï¼Œè¿™å°±å¯¼è‡´ CA æœºæ„å¯ä»¥è·å–åˆ°ä¸€äº›å¯¹åº”ç«™ç‚¹çš„ç”¨æˆ·ä¿¡æ¯ï¼ˆIP åœ°å€ã€ç½‘ç»œçŠ¶æ€ç­‰ï¼‰ã€‚ ä¸ºäº†è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œrfc6066 å®šä¹‰äº† OCSP stapling åŠŸèƒ½ï¼Œå®ƒä½¿æœåŠ¡å™¨å¯ä»¥æå‰è®¿é—® OCSP è·å–è¯ä¹¦çŠ¶æ€ä¿¡æ¯å¹¶ç¼“å­˜åˆ°æœ¬åœ°ï¼ŒåŸºæœ¬ Nginx/Caddy ç­‰å„å¤§ Web æœåŠ¡å™¨æˆ–ç½‘å…³ï¼Œéƒ½æ”¯æŒ OCSP stapling åè®®ã€‚ åœ¨å®¢æˆ·ç«¯ä½¿ç”¨ TLS åè®®è®¿é—® HTTPS æœåŠ¡æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šç›´æ¥åœ¨æ¡æ‰‹é˜¶æ®µå°†ç¼“å­˜çš„ OCSP ä¿¡æ¯å‘é€ç»™å®¢æˆ·ç«¯ã€‚å› ä¸º OCSP ä¿¡æ¯ä¼šå¸¦æœ‰ CA è¯ä¹¦çš„ç­¾ååŠæœ‰æ•ˆæœŸï¼Œå®¢æˆ·ç«¯å¯ä»¥ç›´æ¥é€šè¿‡ç­¾åéªŒè¯ OCSP ä¿¡æ¯çš„çœŸå®æ€§ä¸æœ‰æ•ˆæ€§ï¼Œè¿™æ ·å°±é¿å…äº†å®¢æˆ·ç«¯è®¿é—® OCSP æœåŠ¡å™¨å¸¦æ¥çš„å¼€é”€ã€‚ è€Œå¦ä¸€ä¸ªæ–¹æ³•ï¼Œå°±æ˜¯é€‰ç”¨ ocsp æœåŠ¡å™¨åœ¨ç›®æ ‡ç”¨æˆ·åŒºåŸŸé€Ÿåº¦å¿«çš„ CA æœºæ„ç­¾å‘è¯ä¹¦ã€‚ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æµ‹è¯•ï¼Œç¡®è®¤ç«™ç‚¹æ˜¯å¦å¯ç”¨äº† ocsp stapling: conf $ openssl s_client -connect www.digicert.com:443 -servername www.digicert.com -status -tlsextdebug \u003c /dev/null 2\u003e\u00261 | grep -i \"OCSP response\" å¦‚æœè¾“å‡ºåŒ…å« OCSP Response Status: successful å°±è¯´æ˜ç«™ç‚¹æ”¯æŒ ocsp staplingï¼Œå¦‚æœè¾“å‡ºå†…å®¹ä¸º OCSP response: no response sent åˆ™è¯´æ˜ç«™ç‚¹ä¸æ”¯æŒocsp staplingã€‚ å®é™…ä¸Š Google/AWS ç­‰å¤§å¤šæ•°ç«™ç‚¹éƒ½ä¸ä¼šå¯ç”¨ä¹Ÿä¸éœ€è¦å¯ç”¨ ocsp staplingï¼Œä¸€æ˜¯å› ä¸ºå®ƒä»¬è‡ªå·±å°±æ˜¯è¯ä¹¦é¢å‘æœºæ„ï¼ŒOCSP æœåŠ¡å™¨ä¹Ÿå½’å®ƒä»¬è‡ªå·±ç®¡ï¼Œä¸å­˜åœ¨éšç§çš„é—®é¢˜ã€‚äºŒæ˜¯å®ƒä»¬çš„ OCSP æœåŠ¡å™¨éå¸ƒ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:4:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#tls-13"},{"categories":["tech"],"content":" 1. å¯†ç å¥—ä»¶ä¸ TLS å†å²ç‰ˆæœ¬å¯†ç å¥—ä»¶ï¼ˆCipher_suiteï¼‰æ˜¯ TLS åè®®ä¸­ä¸€ç»„ç”¨äºå®ç°å®‰å…¨é€šè®¯çš„å¯†ç å­¦ç®—æ³•ï¼Œç±»ä¼¼äºæˆ‘ä»¬å‰é¢å­¦ä¹ è¿‡çš„åŠ å¯†æ–¹æ¡ˆã€‚ä¸åŒå¯†ç å­¦ç®—æ³•çš„ç»„åˆå½¢æˆä¸åŒçš„å¯†ç å¥—ä»¶ï¼Œç®—æ³•ç»„åˆçš„å·®å¼‚ä½¿è¿™äº›å¯†ç å¥—ä»¶å…·æœ‰ä¸åŒçš„æ€§èƒ½ä¸å®‰å…¨æ€§ï¼Œå¦å¤– TLS åè®®çš„æ›´æ–°è¿­ä»£ä¹Ÿå¯¼è‡´å„å¯†ç å¥—ä»¶æ‹¥æœ‰ä¸åŒçš„å…¼å®¹æ€§ã€‚é€šå¸¸è¶Šæ–°æ¨å‡ºçš„å¯†ç å¥—ä»¶çš„å®‰å…¨æ€§è¶Šé«˜ï¼Œä½†æ˜¯å…¼å®¹æ€§å°±è¶Šå·®ï¼ˆæ—§è®¾å¤‡ä¸æ”¯æŒï¼‰ã€‚ å¯†ç å¥—ä»¶çš„åç§°ç”±å®ƒä½¿ç”¨çš„å„ç§å¯†ç å­¦ç®—æ³•åç§°ç»„æˆï¼Œè€Œä¸”æœ‰å›ºå®šçš„æ ¼å¼ï¼Œä»¥TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 ä¸ºä¾‹ä»‹ç»ä¸‹ï¼š TLS: å®šä¹‰äº†æ­¤å¥—ä»¶é€‚ç”¨çš„åè®®ï¼Œé€šå¸¸å›ºå®šä¸º TLS ECDHE: å¯†é’¥äº¤æ¢ç®—æ³• RSA: æ•°å­—è¯ä¹¦è®¤è¯ç®—æ³• AES_128_GCM: ä½¿ç”¨çš„å¯¹ç§°åŠ å¯†æ–¹æ¡ˆï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäº AES ä¸ GCM æ¨¡å¼çš„å¯¹ç§°è®¤è¯åŠ å¯†æ–¹æ¡ˆï¼Œä½¿ç”¨ 128 ä½å¯†é’¥ SHA256: å“ˆå¸Œå‡½æ•°ï¼Œç”¨äº HMAC ç®—æ³•å®ç°æ¶ˆæ¯è®¤è¯ TLS å›ºå®šä½¿ç”¨ HMAC ç®—æ³•è¿›è¡Œæ¶ˆæ¯è®¤è¯ TLS åè®®çš„å‰èº«æ˜¯ SSL åè®®ï¼ŒTLS/SSL çš„å‘å±•å†ç¨‹å±•ç¤ºå¦‚ä¸‹ï¼š SSL/TLS çš„å†å²ç‰ˆæœ¬ SSL åè®®æ—©åœ¨ 2015 å¹´å°±è¢«å„å¤§ä¸»æµæµè§ˆå™¨åºŸé™¤äº†ï¼ŒTLS1.0 æ„Ÿè§‰ä¹ŸåŸºæœ¬æ²¡ç«™ç‚¹åœ¨ç”¨äº†ï¼Œè¿™ä¿©å°±ç›´æ¥è·³è¿‡äº†ã€‚ ä¸‹é¢åˆ†åˆ«ä»‹ç»ä¸‹ TLS1.1 TLS1.2 ä¸ TLS1.3. TLS 1.1TLS 1.1 åœ¨ RFC4346 ä¸­å®šä¹‰ï¼Œäº 2006 å¹´ 4 æœˆå‘å¸ƒã€‚ TLS 1.1 æ˜¯ TLS 1.0 çš„ä¸€ä¸ªè¡¥ä¸ï¼Œä¸»è¦æ›´æ–°åŒ…æ‹¬ï¼š æ·»åŠ å¯¹CBCæ”»å‡»çš„ä¿æŠ¤ éšå¼åˆå§‹å‘é‡ IV è¢«æ›¿æ¢æˆä¸€ä¸ªæ˜¾å¼çš„ IV ä¿®å¤åˆ†ç»„å¯†ç æ¨¡å¼ä¸­å¡«å……ç®—æ³•çš„ bug æ”¯æŒ IANA ç™»è®°çš„å‚æ•° TLS 1.1åŠå…¶ä¹‹å‰çš„ç®—æ³•æ›¾ç»è¢«å¹¿æ³›åº”ç”¨ï¼Œå®ƒç›®å‰å·²çŸ¥çš„ç¼ºé™·å¦‚ä¸‹ï¼š ä¸æ”¯æŒ PFS å®Œå…¨å‰å‘ä¿å¯† ä¸æ”¯æŒ AEAD è®¤è¯åŠ å¯†ç®—æ³• ä¸ºäº†å…¼å®¹æ€§ï¼Œä¿ç•™äº†å¾ˆå¤šä¸å®‰å…¨çš„ç®—æ³• TLS 1.1 å·²ç»ä¸å¤Ÿå®‰å…¨äº†ï¼Œä¸è¿‡ä¸€äº›é™ˆå¹´è€ç«™ç‚¹æˆ–è®¸è¿˜åœ¨ä½¿ç”¨å®ƒã€‚ å„æ“ä½œç³»ç»Ÿï¼ˆAndroid/IOS/MacOS/Windowsï¼‰ä¸æµè§ˆå™¨åŸºæœ¬éƒ½åœ¨å¾ˆæ—©çš„ç‰ˆæœ¬ä¸­å°±å·²ç»æ”¯æŒ TLS1.2+ äº†ï¼Œ ç«™åœ¨ 2022 å¹´è¿™ä¸ªæ—¶é—´èŠ‚ç‚¹çœ‹ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥å®Œå…¨åºŸæ­¢ TLS1.1 åè®®ã€‚å®é™…ä¸Šå„å¤§äº‘å‚å•†ä¹Ÿæ˜¯è¿™ä¹ˆå¹²çš„ï¼Œæ¯”å¦‚ AWS è‡ªèº«çš„ API å¯¹ TLS1.1 çš„æ”¯æŒå°±å·²ç¡®å®šå°†åœ¨ 2023 å¹´ 6 æœˆåºŸæ­¢ï¼Œ2022 å¹´å°±å¼€å§‹é¢‘ç¹æ‰«æå¹¶æé†’å„ä½ä»ç„¶åœ¨ä½¿ç”¨ä½ç‰ˆæœ¬ TLS åè®®çš„å®¢æˆ·å‡çº§ã€‚ TLS 1.2TLS 1.2 åœ¨ RFC5246 ä¸­å®šä¹‰ï¼Œäº 2008 å¹´ 8 æœˆå‘å‘å¸ƒã€‚ å¯é€‰æ”¯æŒ PFS å®Œå…¨å‰å‘ä¿å¯† ç§»é™¤å¯¹ MD5 ä¸ SHA-1 ç­¾åç®—æ³•çš„æ”¯æŒ æ·»åŠ å¯¹ HMAC-SHA-256 åŠ HMAC-SHA-384 æ¶ˆæ¯è®¤è¯ç®—æ³•çš„æ”¯æŒ æ·»åŠ å¯¹ AEAD åŠ å¯†è®¤è¯æ–¹æ¡ˆçš„æ”¯æŒ å»é™¤ forback å›åˆ° SSL åè®®çš„èƒ½åŠ›ï¼Œæå‡å®‰å…¨æ€§ ä¸ºäº†å…¼å®¹æ€§ï¼Œä¿ç•™äº†å¾ˆå¤šä¸å®‰å…¨çš„ç®—æ³• å¦‚æœä½ ä½¿ç”¨ TLS 1.2ï¼Œéœ€è¦å°å¿ƒåœ°é€‰æ‹©å¯†ç å¥—ä»¶ï¼Œé¿å¼€ä¸å®‰å…¨çš„å¥—ä»¶ï¼Œå°±èƒ½å®ç°è¶³å¤Ÿé«˜çš„å®‰å…¨æ€§ã€‚ TLS 1.3TLS 1.3 åšäº†ä¸€æ¬¡å¤§åˆ€é˜”æ–§çš„æ›´æ–°ï¼Œæ˜¯ä¸€ä¸ªé‡Œç¨‹ç¢‘å¼çš„ç‰ˆæœ¬ï¼Œå…¶æ›´æ–°æ€»ç»“å¦‚ä¸‹ï¼š ç§»é™¤å¯¹å¦‚ä¸‹ç®—æ³•çš„æ”¯æŒ å“ˆå¸Œå‡½æ•° SHA1/MD5 æ‰€æœ‰é AEAD åŠ å¯†è®¤è¯çš„å¯†ç æ–¹æ¡ˆï¼ˆCBC æ¨¡å¼ï¼‰ ç§»é™¤å¯¹ RC4 ä¸ 3DES åŠ å¯†ç®—æ³•çš„æ”¯æŒ ç§»é™¤äº†é™æ€ RSA ä¸ DH å¯†é’¥äº¤æ¢ç®—æ³• æ”¯æŒé«˜æ€§èƒ½çš„ Ed25519/Ed448 ç­¾åè®¤è¯ç®—æ³•ã€X25519 å¯†é’¥åå•†ç®—æ³• æ”¯æŒé«˜æ€§èƒ½çš„ ChaCha20-Poly1305 å¯¹ç§°è®¤è¯åŠ å¯†æ–¹æ¡ˆ å°†å¯†é’¥äº¤æ¢ç®—æ³•ä¸å…¬é’¥è®¤è¯ç®—æ³•ä»å¯†ç å¥—ä»¶ä¸­åˆ†ç¦»å‡ºæ¥ æ¯”å¦‚åŸæ¥çš„ TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 å¯†ç å¥—ä»¶å°†è¢«æ‹†åˆ†ä¸º ECDHE ç®—æ³•ã€RSA èº«ä»½è®¤è¯ç®—æ³•ã€ä»¥åŠ TLS_AES_128_GCM_SHA256 å¯†ç å¥—ä»¶ è¿™æ ·å¯†ç å¥—ä»¶å°±åªåŒ…å«ä¸€ä¸ª AEAD è®¤è¯åŠ å¯†æ–¹æ¡ˆï¼Œä»¥åŠä¸€ä¸ªå“ˆå¸Œå‡½æ•°äº† ä»…æ”¯æŒå‰å‘å®‰å…¨çš„å¯†é’¥äº¤æ¢ç®—æ³• DHE æˆ– ECDHE æ”¯æŒæœ€çŸ­ 0-RTT çš„ TLS æ¡æ‰‹ï¼ˆä¼šè¯æ¢å¤ï¼‰ TLS 1.3 ä»åè®®ä¸­åˆ é™¤äº†æ‰€æœ‰ä¸å®‰å…¨çš„ç®—æ³•æˆ–åè®®ï¼Œå¯ä»¥è¯´åªè¦ä½ çš„é€šè®¯ç”¨äº† TLS 1.3ï¼Œé‚£ä½ çš„æ•°æ®å°±å®‰å…¨äº†ï¼ˆå½“ç„¶å‰ææ˜¯ä½ çš„ç§é’¥æ²¡æ³„æ¼ï¼‰ã€‚ å¦‚ä½•è®¾ç½® TLS åè®®çš„ç‰ˆæœ¬ã€å¯†ç å¥—ä»¶å‚æ•°æˆ‘ä»¬å‰é¢å·²ç»å­¦ä¹ äº†å¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†ã€å¯†é’¥äº¤æ¢ä¸‰éƒ¨åˆ†çŸ¥è¯†ï¼Œå¯¹ç…§ TLS å¥—ä»¶çš„åç§°ï¼Œåº”è¯¥èƒ½å¾ˆå®¹æ˜“åˆ¤æ–­å‡ºå“ªäº›æ˜¯å®‰å…¨çš„ã€å“ªäº›ä¸å¤Ÿå®‰å…¨ï¼Œå“ªäº›æ”¯æŒå‰å‘ä¿å¯†ã€å“ªäº›ä¸æ”¯æŒã€‚ ä¸€ä¸ªéå¸¸å¥½ç”¨çš„ã€Œç«™ç‚¹ HTTPS å®‰å…¨æ£€æµ‹ã€ç½‘ç«™æ˜¯ https://myssl.com/ï¼Œä½¿ç”¨å®ƒæµ‹è¯•çŸ¥ä¹ç½‘çš„æ£€æµ‹ç»“æœå¦‚ä¸‹ï¼š SSL/TLS çš„å†å²ç‰ˆæœ¬ èƒ½çœ‹åˆ°çŸ¥ä¹ä¸ºäº†å…¼å®¹æ€§ï¼Œç›®å‰ä»ç„¶æ”¯æŒ TLS1.0 ä¸ TLS1.1ï¼Œå¦å¤–ç›®å‰è¿˜ä¸æ”¯æŒ TLS1.3. æ­¤å¤–ï¼ŒçŸ¥ä¹ä»ç„¶æ”¯æŒå¾ˆå¤šå·²ç»ä¸å®‰å…¨çš„åŠ å¯†å¥—ä»¶ï¼Œmyssl.com ä¸“é—¨ä½¿ç”¨é»„è‰²æ ‡è¯†å‡ºäº†è¿™äº›ä¸å®‰å…¨çš„åŠ å¯†å¥—ä»¶ï¼Œæˆ‘ä»¬æ€»ç»“ä¸‹ä¸»è¦ç‰¹å¾ï¼š éƒ¨åˆ†å¯†ç å¥—ä»¶ä½¿ç”¨äº†ä¸å®‰å…¨çš„å¯¹ç§°åŠ å¯†ç®—æ³• 3DES å…¶ä»–è¢«æ ‡è¯†ä¸ºé»„è‰²çš„å¥—ä»¶è™½ç„¶ä½¿ç”¨äº†å®‰å…¨çš„å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œä½†æ˜¯ä¸æ”¯æŒ PFS å‰å‘ä¿å¯† æ­¤å¤– myssl.com è¿˜åˆ—å‡ºäº†è®¸å¤šç«™ç‚¹æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ TLS1.3 çš„ä¼šè¯æ¢å¤ï¼Œä»¥åŠåé¢å°†ä¼šä»‹ç»çš„å…¬é’¥å›ºå®šã€HTTPä¸¥æ ¼ä¼ è¾“å®‰å…¨ç­‰ä¿¡æ¯ï¼š SSL/TLS çš„å†å²ç‰ˆæœ¬ Nginx çš„ TLS åè®®é…ç½®ä»¥å‰ä¸º Nginx ç­‰ç¨‹åºé…ç½® HTTPS åè®®æ—¶ï¼Œæˆ‘æœ€å¤´ç–¼çš„å°±æ˜¯å…¶ä¸­å¯†ç å¥—ä»¶å‚æ•° ssl_ciphersï¼Œä¸ºäº†å®‰å…¨æ€§ï¼Œéœ€è¦é…ç½®è¶…é•¿çš„ä¸€å¤§å †é€‰ç”¨çš„å¯†ç å¥—ä»¶åç§°ï¼Œæˆ‘å¯ä»¥è¯´ä¸€ä¸ªéƒ½çœ‹ä¸æ‡‚ï¼Œä½†æ˜¯ä¸ºäº†æŠŠç½‘ç«™æå¥½è¿˜æ˜¯å¾—ç¡¬ç€å¤´çš®æœç´¢å¤åˆ¶ç²˜è´´ï¼Œå®é™…ä¸Šä¹Ÿä¸æ¸…æ¥šå®‰å…¨æ€§åˆ°åº•å¦‚ä½•ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒMozilla/DigitalOcean éƒ½æè¿‡æµè¡Œ Web æœåŠ¡å™¨çš„ TLS é…ç½®ç”Ÿæˆå·¥å…·ï¼Œæ¯”å¦‚ssl-config - mozillaï¼Œè¿™ä¸ªç½‘ç«™æä¾›ä¸‰ä¸ªå®‰å…¨ç­‰çº§çš„é…ç½®: ã€ŒIntermediateã€: æŸ¥çœ‹ç”Ÿæˆå‡ºçš„ ssl-cipher å±æ€§ï¼Œå‘ç°å®ƒåªæ”¯æŒ ECDHE/DHE å¼€å¤´çš„ç®—æ³•ã€‚å› æ­¤å®ƒä¿è¯å‰å‘ä¿å¯†ã€‚ å¯¹äºéœ€è¦é€šè¿‡æµè§ˆå™¨è®¿é—®çš„ APIï¼Œæ¨èé€‰æ‹©è¿™ä¸ªç­‰çº§ã€‚ ã€ŒModernã€: åªæ”¯æŒ TLSv1.3ï¼Œè¯¥åè®®åºŸå¼ƒæ‰äº†è¿‡å¾€æ‰€æœ‰ä¸å®‰å…¨çš„ç®—æ³•ï¼Œä¿è¯å‰å‘ä¿å¯†ï¼Œå®‰å…¨æ€§æé«˜ï¼Œæ€§èƒ½ä¹Ÿæ›´å¥½ã€‚ å¯¹äºä¸éœ€è¦é€šè¿‡æµè§ˆå™¨ç­‰æ—§ç»ˆç«¯è®¿é—®çš„ APIï¼Œè¯·ç›´æ¥é€‰æ‹©è¿™ä¸ªç­‰çº§ã€‚ ã€ŒOldã€: é™¤éä½ çš„ç”¨æˆ·ä½¿ç”¨éå¸¸è€çš„ç»ˆç«¯è¿›è¡Œè®¿é—®ï¼Œå¦åˆ™è¯·ä¸è¦è€ƒè™‘è¿™ä¸ªé€‰é¡¹ï¼ å¯ä»¥ç‚¹è¿›å»æŸ¥çœ‹è¯¦ç»†çš„ TLS å¥—ä»¶é…ç½®ã€‚ OCSP è¯ä¹¦éªŒè¯åè®® https://www.ssl.com/blogs/how-do-browsers-handle-revoked-ssl-tls-certificates/ https://imququ.com/post/why-can-not-turn-on-ocsp-stapling.html https://www.digicert.com/help/ å‰é¢æåˆ°é™¤äº†æ•°å­—è¯ä¹¦è‡ªå¸¦çš„æœ‰æ•ˆæœŸå¤–ï¼Œä¸ºäº†åœ¨ç§é’¥æ³„æ¼çš„æƒ…å†µä¸‹ï¼Œèƒ½å¤ŸåŠé”€å¯¹åº”çš„è¯ä¹¦ï¼ŒPKI å…¬é’¥åŸºç¡€è®¾æ–½è¿˜æä¾›äº† OCSPï¼ˆOnline Certificate Status Protocolï¼‰è¯ä¹¦çŠ¶æ€æŸ¥è¯¢åè®®ã€‚ è¿™å¯¼è‡´äº†ä¸€äº›é—®é¢˜ï¼š Chrome/Firefox ç­‰æµè§ˆå™¨éƒ½ä¼šå®šæœŸé€šè¿‡ OCSP åè®®å»è¯·æ±‚ CA æœºæ„çš„ OCSP æœåŠ¡å™¨éªŒè¯è¯ä¹¦çŠ¶æ€ï¼Œ è¿™å¯èƒ½ä¼šæ‹–æ…¢ HTTPS åè®®çš„å“åº”é€Ÿåº¦ã€‚ æ‰€è°“çš„å®šæœŸæ˜¯æŒ‡è¶…è¿‡ä¸Šä¸€ä¸ª OCSP å“åº”çš„ nextUpdate æ—¶é—´ï¼ˆä¸€èˆ¬ä¸º 7 å¤©ï¼‰ï¼Œæˆ–è€…å¦‚æœè¯¥å€¼ä¸ºç©ºçš„è¯ï¼ŒFirefox é»˜è®¤ 24h åä¼šé‡æ–°æŸ¥è¯¢ OCSP çŠ¶æ€ã€‚ å› ä¸ºå®¢æˆ·ç«¯ç›´æ¥å»è¯·æ±‚ CA æœºæ„çš„ OCSP åœ°å€è·å–è¯ä¹¦çŠ¶æ€ï¼Œè¿™å°±å¯¼è‡´ CA æœºæ„å¯ä»¥è·å–åˆ°ä¸€äº›å¯¹åº”ç«™ç‚¹çš„ç”¨æˆ·ä¿¡æ¯ï¼ˆIP åœ°å€ã€ç½‘ç»œçŠ¶æ€ç­‰ï¼‰ã€‚ ä¸ºäº†è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œrfc6066 å®šä¹‰äº† OCSP stapling åŠŸèƒ½ï¼Œå®ƒä½¿æœåŠ¡å™¨å¯ä»¥æå‰è®¿é—® OCSP è·å–è¯ä¹¦çŠ¶æ€ä¿¡æ¯å¹¶ç¼“å­˜åˆ°æœ¬åœ°ï¼ŒåŸºæœ¬ Nginx/Caddy ç­‰å„å¤§ Web æœåŠ¡å™¨æˆ–ç½‘å…³ï¼Œéƒ½æ”¯æŒ OCSP stapling åè®®ã€‚ åœ¨å®¢æˆ·ç«¯ä½¿ç”¨ TLS åè®®è®¿é—® HTTPS æœåŠ¡æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šç›´æ¥åœ¨æ¡æ‰‹é˜¶æ®µå°†ç¼“å­˜çš„ OCSP ä¿¡æ¯å‘é€ç»™å®¢æˆ·ç«¯ã€‚å› ä¸º OCSP ä¿¡æ¯ä¼šå¸¦æœ‰ CA è¯ä¹¦çš„ç­¾ååŠæœ‰æ•ˆæœŸï¼Œå®¢æˆ·ç«¯å¯ä»¥ç›´æ¥é€šè¿‡ç­¾åéªŒè¯ OCSP ä¿¡æ¯çš„çœŸå®æ€§ä¸æœ‰æ•ˆæ€§ï¼Œè¿™æ ·å°±é¿å…äº†å®¢æˆ·ç«¯è®¿é—® OCSP æœåŠ¡å™¨å¸¦æ¥çš„å¼€é”€ã€‚ è€Œå¦ä¸€ä¸ªæ–¹æ³•ï¼Œå°±æ˜¯é€‰ç”¨ ocsp æœåŠ¡å™¨åœ¨ç›®æ ‡ç”¨æˆ·åŒºåŸŸé€Ÿåº¦å¿«çš„ CA æœºæ„ç­¾å‘è¯ä¹¦ã€‚ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æµ‹è¯•ï¼Œç¡®è®¤ç«™ç‚¹æ˜¯å¦å¯ç”¨äº† ocsp stapling: conf $ openssl s_client -connect www.digicert.com:443 -servername www.digicert.com -status -tlsextdebug \u003c /dev/null 2\u003e\u00261 | grep -i \"OCSP response\" å¦‚æœè¾“å‡ºåŒ…å« OCSP Response Status: successful å°±è¯´æ˜ç«™ç‚¹æ”¯æŒ ocsp staplingï¼Œå¦‚æœè¾“å‡ºå†…å®¹ä¸º OCSP response: no response sent åˆ™è¯´æ˜ç«™ç‚¹ä¸æ”¯æŒocsp staplingã€‚ å®é™…ä¸Š Google/AWS ç­‰å¤§å¤šæ•°ç«™ç‚¹éƒ½ä¸ä¼šå¯ç”¨ä¹Ÿä¸éœ€è¦å¯ç”¨ ocsp staplingï¼Œä¸€æ˜¯å› ä¸ºå®ƒä»¬è‡ªå·±å°±æ˜¯è¯ä¹¦é¢å‘æœºæ„ï¼ŒOCSP æœåŠ¡å™¨ä¹Ÿå½’å®ƒä»¬è‡ªå·±ç®¡ï¼Œä¸å­˜åœ¨éšç§çš„é—®é¢˜ã€‚äºŒæ˜¯å®ƒä»¬çš„ OCSP æœåŠ¡å™¨éå¸ƒ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:4:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#å¦‚ä½•è®¾ç½®-tls-åè®®çš„ç‰ˆæœ¬å¯†ç å¥—ä»¶å‚æ•°"},{"categories":["tech"],"content":" 1. å¯†ç å¥—ä»¶ä¸ TLS å†å²ç‰ˆæœ¬å¯†ç å¥—ä»¶ï¼ˆCipher_suiteï¼‰æ˜¯ TLS åè®®ä¸­ä¸€ç»„ç”¨äºå®ç°å®‰å…¨é€šè®¯çš„å¯†ç å­¦ç®—æ³•ï¼Œç±»ä¼¼äºæˆ‘ä»¬å‰é¢å­¦ä¹ è¿‡çš„åŠ å¯†æ–¹æ¡ˆã€‚ä¸åŒå¯†ç å­¦ç®—æ³•çš„ç»„åˆå½¢æˆä¸åŒçš„å¯†ç å¥—ä»¶ï¼Œç®—æ³•ç»„åˆçš„å·®å¼‚ä½¿è¿™äº›å¯†ç å¥—ä»¶å…·æœ‰ä¸åŒçš„æ€§èƒ½ä¸å®‰å…¨æ€§ï¼Œå¦å¤– TLS åè®®çš„æ›´æ–°è¿­ä»£ä¹Ÿå¯¼è‡´å„å¯†ç å¥—ä»¶æ‹¥æœ‰ä¸åŒçš„å…¼å®¹æ€§ã€‚é€šå¸¸è¶Šæ–°æ¨å‡ºçš„å¯†ç å¥—ä»¶çš„å®‰å…¨æ€§è¶Šé«˜ï¼Œä½†æ˜¯å…¼å®¹æ€§å°±è¶Šå·®ï¼ˆæ—§è®¾å¤‡ä¸æ”¯æŒï¼‰ã€‚ å¯†ç å¥—ä»¶çš„åç§°ç”±å®ƒä½¿ç”¨çš„å„ç§å¯†ç å­¦ç®—æ³•åç§°ç»„æˆï¼Œè€Œä¸”æœ‰å›ºå®šçš„æ ¼å¼ï¼Œä»¥TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 ä¸ºä¾‹ä»‹ç»ä¸‹ï¼š TLS: å®šä¹‰äº†æ­¤å¥—ä»¶é€‚ç”¨çš„åè®®ï¼Œé€šå¸¸å›ºå®šä¸º TLS ECDHE: å¯†é’¥äº¤æ¢ç®—æ³• RSA: æ•°å­—è¯ä¹¦è®¤è¯ç®—æ³• AES_128_GCM: ä½¿ç”¨çš„å¯¹ç§°åŠ å¯†æ–¹æ¡ˆï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäº AES ä¸ GCM æ¨¡å¼çš„å¯¹ç§°è®¤è¯åŠ å¯†æ–¹æ¡ˆï¼Œä½¿ç”¨ 128 ä½å¯†é’¥ SHA256: å“ˆå¸Œå‡½æ•°ï¼Œç”¨äº HMAC ç®—æ³•å®ç°æ¶ˆæ¯è®¤è¯ TLS å›ºå®šä½¿ç”¨ HMAC ç®—æ³•è¿›è¡Œæ¶ˆæ¯è®¤è¯ TLS åè®®çš„å‰èº«æ˜¯ SSL åè®®ï¼ŒTLS/SSL çš„å‘å±•å†ç¨‹å±•ç¤ºå¦‚ä¸‹ï¼š SSL/TLS çš„å†å²ç‰ˆæœ¬ SSL åè®®æ—©åœ¨ 2015 å¹´å°±è¢«å„å¤§ä¸»æµæµè§ˆå™¨åºŸé™¤äº†ï¼ŒTLS1.0 æ„Ÿè§‰ä¹ŸåŸºæœ¬æ²¡ç«™ç‚¹åœ¨ç”¨äº†ï¼Œè¿™ä¿©å°±ç›´æ¥è·³è¿‡äº†ã€‚ ä¸‹é¢åˆ†åˆ«ä»‹ç»ä¸‹ TLS1.1 TLS1.2 ä¸ TLS1.3. TLS 1.1TLS 1.1 åœ¨ RFC4346 ä¸­å®šä¹‰ï¼Œäº 2006 å¹´ 4 æœˆå‘å¸ƒã€‚ TLS 1.1 æ˜¯ TLS 1.0 çš„ä¸€ä¸ªè¡¥ä¸ï¼Œä¸»è¦æ›´æ–°åŒ…æ‹¬ï¼š æ·»åŠ å¯¹CBCæ”»å‡»çš„ä¿æŠ¤ éšå¼åˆå§‹å‘é‡ IV è¢«æ›¿æ¢æˆä¸€ä¸ªæ˜¾å¼çš„ IV ä¿®å¤åˆ†ç»„å¯†ç æ¨¡å¼ä¸­å¡«å……ç®—æ³•çš„ bug æ”¯æŒ IANA ç™»è®°çš„å‚æ•° TLS 1.1åŠå…¶ä¹‹å‰çš„ç®—æ³•æ›¾ç»è¢«å¹¿æ³›åº”ç”¨ï¼Œå®ƒç›®å‰å·²çŸ¥çš„ç¼ºé™·å¦‚ä¸‹ï¼š ä¸æ”¯æŒ PFS å®Œå…¨å‰å‘ä¿å¯† ä¸æ”¯æŒ AEAD è®¤è¯åŠ å¯†ç®—æ³• ä¸ºäº†å…¼å®¹æ€§ï¼Œä¿ç•™äº†å¾ˆå¤šä¸å®‰å…¨çš„ç®—æ³• TLS 1.1 å·²ç»ä¸å¤Ÿå®‰å…¨äº†ï¼Œä¸è¿‡ä¸€äº›é™ˆå¹´è€ç«™ç‚¹æˆ–è®¸è¿˜åœ¨ä½¿ç”¨å®ƒã€‚ å„æ“ä½œç³»ç»Ÿï¼ˆAndroid/IOS/MacOS/Windowsï¼‰ä¸æµè§ˆå™¨åŸºæœ¬éƒ½åœ¨å¾ˆæ—©çš„ç‰ˆæœ¬ä¸­å°±å·²ç»æ”¯æŒ TLS1.2+ äº†ï¼Œ ç«™åœ¨ 2022 å¹´è¿™ä¸ªæ—¶é—´èŠ‚ç‚¹çœ‹ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥å®Œå…¨åºŸæ­¢ TLS1.1 åè®®ã€‚å®é™…ä¸Šå„å¤§äº‘å‚å•†ä¹Ÿæ˜¯è¿™ä¹ˆå¹²çš„ï¼Œæ¯”å¦‚ AWS è‡ªèº«çš„ API å¯¹ TLS1.1 çš„æ”¯æŒå°±å·²ç¡®å®šå°†åœ¨ 2023 å¹´ 6 æœˆåºŸæ­¢ï¼Œ2022 å¹´å°±å¼€å§‹é¢‘ç¹æ‰«æå¹¶æé†’å„ä½ä»ç„¶åœ¨ä½¿ç”¨ä½ç‰ˆæœ¬ TLS åè®®çš„å®¢æˆ·å‡çº§ã€‚ TLS 1.2TLS 1.2 åœ¨ RFC5246 ä¸­å®šä¹‰ï¼Œäº 2008 å¹´ 8 æœˆå‘å‘å¸ƒã€‚ å¯é€‰æ”¯æŒ PFS å®Œå…¨å‰å‘ä¿å¯† ç§»é™¤å¯¹ MD5 ä¸ SHA-1 ç­¾åç®—æ³•çš„æ”¯æŒ æ·»åŠ å¯¹ HMAC-SHA-256 åŠ HMAC-SHA-384 æ¶ˆæ¯è®¤è¯ç®—æ³•çš„æ”¯æŒ æ·»åŠ å¯¹ AEAD åŠ å¯†è®¤è¯æ–¹æ¡ˆçš„æ”¯æŒ å»é™¤ forback å›åˆ° SSL åè®®çš„èƒ½åŠ›ï¼Œæå‡å®‰å…¨æ€§ ä¸ºäº†å…¼å®¹æ€§ï¼Œä¿ç•™äº†å¾ˆå¤šä¸å®‰å…¨çš„ç®—æ³• å¦‚æœä½ ä½¿ç”¨ TLS 1.2ï¼Œéœ€è¦å°å¿ƒåœ°é€‰æ‹©å¯†ç å¥—ä»¶ï¼Œé¿å¼€ä¸å®‰å…¨çš„å¥—ä»¶ï¼Œå°±èƒ½å®ç°è¶³å¤Ÿé«˜çš„å®‰å…¨æ€§ã€‚ TLS 1.3TLS 1.3 åšäº†ä¸€æ¬¡å¤§åˆ€é˜”æ–§çš„æ›´æ–°ï¼Œæ˜¯ä¸€ä¸ªé‡Œç¨‹ç¢‘å¼çš„ç‰ˆæœ¬ï¼Œå…¶æ›´æ–°æ€»ç»“å¦‚ä¸‹ï¼š ç§»é™¤å¯¹å¦‚ä¸‹ç®—æ³•çš„æ”¯æŒ å“ˆå¸Œå‡½æ•° SHA1/MD5 æ‰€æœ‰é AEAD åŠ å¯†è®¤è¯çš„å¯†ç æ–¹æ¡ˆï¼ˆCBC æ¨¡å¼ï¼‰ ç§»é™¤å¯¹ RC4 ä¸ 3DES åŠ å¯†ç®—æ³•çš„æ”¯æŒ ç§»é™¤äº†é™æ€ RSA ä¸ DH å¯†é’¥äº¤æ¢ç®—æ³• æ”¯æŒé«˜æ€§èƒ½çš„ Ed25519/Ed448 ç­¾åè®¤è¯ç®—æ³•ã€X25519 å¯†é’¥åå•†ç®—æ³• æ”¯æŒé«˜æ€§èƒ½çš„ ChaCha20-Poly1305 å¯¹ç§°è®¤è¯åŠ å¯†æ–¹æ¡ˆ å°†å¯†é’¥äº¤æ¢ç®—æ³•ä¸å…¬é’¥è®¤è¯ç®—æ³•ä»å¯†ç å¥—ä»¶ä¸­åˆ†ç¦»å‡ºæ¥ æ¯”å¦‚åŸæ¥çš„ TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 å¯†ç å¥—ä»¶å°†è¢«æ‹†åˆ†ä¸º ECDHE ç®—æ³•ã€RSA èº«ä»½è®¤è¯ç®—æ³•ã€ä»¥åŠ TLS_AES_128_GCM_SHA256 å¯†ç å¥—ä»¶ è¿™æ ·å¯†ç å¥—ä»¶å°±åªåŒ…å«ä¸€ä¸ª AEAD è®¤è¯åŠ å¯†æ–¹æ¡ˆï¼Œä»¥åŠä¸€ä¸ªå“ˆå¸Œå‡½æ•°äº† ä»…æ”¯æŒå‰å‘å®‰å…¨çš„å¯†é’¥äº¤æ¢ç®—æ³• DHE æˆ– ECDHE æ”¯æŒæœ€çŸ­ 0-RTT çš„ TLS æ¡æ‰‹ï¼ˆä¼šè¯æ¢å¤ï¼‰ TLS 1.3 ä»åè®®ä¸­åˆ é™¤äº†æ‰€æœ‰ä¸å®‰å…¨çš„ç®—æ³•æˆ–åè®®ï¼Œå¯ä»¥è¯´åªè¦ä½ çš„é€šè®¯ç”¨äº† TLS 1.3ï¼Œé‚£ä½ çš„æ•°æ®å°±å®‰å…¨äº†ï¼ˆå½“ç„¶å‰ææ˜¯ä½ çš„ç§é’¥æ²¡æ³„æ¼ï¼‰ã€‚ å¦‚ä½•è®¾ç½® TLS åè®®çš„ç‰ˆæœ¬ã€å¯†ç å¥—ä»¶å‚æ•°æˆ‘ä»¬å‰é¢å·²ç»å­¦ä¹ äº†å¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†ã€å¯†é’¥äº¤æ¢ä¸‰éƒ¨åˆ†çŸ¥è¯†ï¼Œå¯¹ç…§ TLS å¥—ä»¶çš„åç§°ï¼Œåº”è¯¥èƒ½å¾ˆå®¹æ˜“åˆ¤æ–­å‡ºå“ªäº›æ˜¯å®‰å…¨çš„ã€å“ªäº›ä¸å¤Ÿå®‰å…¨ï¼Œå“ªäº›æ”¯æŒå‰å‘ä¿å¯†ã€å“ªäº›ä¸æ”¯æŒã€‚ ä¸€ä¸ªéå¸¸å¥½ç”¨çš„ã€Œç«™ç‚¹ HTTPS å®‰å…¨æ£€æµ‹ã€ç½‘ç«™æ˜¯ https://myssl.com/ï¼Œä½¿ç”¨å®ƒæµ‹è¯•çŸ¥ä¹ç½‘çš„æ£€æµ‹ç»“æœå¦‚ä¸‹ï¼š SSL/TLS çš„å†å²ç‰ˆæœ¬ èƒ½çœ‹åˆ°çŸ¥ä¹ä¸ºäº†å…¼å®¹æ€§ï¼Œç›®å‰ä»ç„¶æ”¯æŒ TLS1.0 ä¸ TLS1.1ï¼Œå¦å¤–ç›®å‰è¿˜ä¸æ”¯æŒ TLS1.3. æ­¤å¤–ï¼ŒçŸ¥ä¹ä»ç„¶æ”¯æŒå¾ˆå¤šå·²ç»ä¸å®‰å…¨çš„åŠ å¯†å¥—ä»¶ï¼Œmyssl.com ä¸“é—¨ä½¿ç”¨é»„è‰²æ ‡è¯†å‡ºäº†è¿™äº›ä¸å®‰å…¨çš„åŠ å¯†å¥—ä»¶ï¼Œæˆ‘ä»¬æ€»ç»“ä¸‹ä¸»è¦ç‰¹å¾ï¼š éƒ¨åˆ†å¯†ç å¥—ä»¶ä½¿ç”¨äº†ä¸å®‰å…¨çš„å¯¹ç§°åŠ å¯†ç®—æ³• 3DES å…¶ä»–è¢«æ ‡è¯†ä¸ºé»„è‰²çš„å¥—ä»¶è™½ç„¶ä½¿ç”¨äº†å®‰å…¨çš„å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œä½†æ˜¯ä¸æ”¯æŒ PFS å‰å‘ä¿å¯† æ­¤å¤– myssl.com è¿˜åˆ—å‡ºäº†è®¸å¤šç«™ç‚¹æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ TLS1.3 çš„ä¼šè¯æ¢å¤ï¼Œä»¥åŠåé¢å°†ä¼šä»‹ç»çš„å…¬é’¥å›ºå®šã€HTTPä¸¥æ ¼ä¼ è¾“å®‰å…¨ç­‰ä¿¡æ¯ï¼š SSL/TLS çš„å†å²ç‰ˆæœ¬ Nginx çš„ TLS åè®®é…ç½®ä»¥å‰ä¸º Nginx ç­‰ç¨‹åºé…ç½® HTTPS åè®®æ—¶ï¼Œæˆ‘æœ€å¤´ç–¼çš„å°±æ˜¯å…¶ä¸­å¯†ç å¥—ä»¶å‚æ•° ssl_ciphersï¼Œä¸ºäº†å®‰å…¨æ€§ï¼Œéœ€è¦é…ç½®è¶…é•¿çš„ä¸€å¤§å †é€‰ç”¨çš„å¯†ç å¥—ä»¶åç§°ï¼Œæˆ‘å¯ä»¥è¯´ä¸€ä¸ªéƒ½çœ‹ä¸æ‡‚ï¼Œä½†æ˜¯ä¸ºäº†æŠŠç½‘ç«™æå¥½è¿˜æ˜¯å¾—ç¡¬ç€å¤´çš®æœç´¢å¤åˆ¶ç²˜è´´ï¼Œå®é™…ä¸Šä¹Ÿä¸æ¸…æ¥šå®‰å…¨æ€§åˆ°åº•å¦‚ä½•ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒMozilla/DigitalOcean éƒ½æè¿‡æµè¡Œ Web æœåŠ¡å™¨çš„ TLS é…ç½®ç”Ÿæˆå·¥å…·ï¼Œæ¯”å¦‚ssl-config - mozillaï¼Œè¿™ä¸ªç½‘ç«™æä¾›ä¸‰ä¸ªå®‰å…¨ç­‰çº§çš„é…ç½®: ã€ŒIntermediateã€: æŸ¥çœ‹ç”Ÿæˆå‡ºçš„ ssl-cipher å±æ€§ï¼Œå‘ç°å®ƒåªæ”¯æŒ ECDHE/DHE å¼€å¤´çš„ç®—æ³•ã€‚å› æ­¤å®ƒä¿è¯å‰å‘ä¿å¯†ã€‚ å¯¹äºéœ€è¦é€šè¿‡æµè§ˆå™¨è®¿é—®çš„ APIï¼Œæ¨èé€‰æ‹©è¿™ä¸ªç­‰çº§ã€‚ ã€ŒModernã€: åªæ”¯æŒ TLSv1.3ï¼Œè¯¥åè®®åºŸå¼ƒæ‰äº†è¿‡å¾€æ‰€æœ‰ä¸å®‰å…¨çš„ç®—æ³•ï¼Œä¿è¯å‰å‘ä¿å¯†ï¼Œå®‰å…¨æ€§æé«˜ï¼Œæ€§èƒ½ä¹Ÿæ›´å¥½ã€‚ å¯¹äºä¸éœ€è¦é€šè¿‡æµè§ˆå™¨ç­‰æ—§ç»ˆç«¯è®¿é—®çš„ APIï¼Œè¯·ç›´æ¥é€‰æ‹©è¿™ä¸ªç­‰çº§ã€‚ ã€ŒOldã€: é™¤éä½ çš„ç”¨æˆ·ä½¿ç”¨éå¸¸è€çš„ç»ˆç«¯è¿›è¡Œè®¿é—®ï¼Œå¦åˆ™è¯·ä¸è¦è€ƒè™‘è¿™ä¸ªé€‰é¡¹ï¼ å¯ä»¥ç‚¹è¿›å»æŸ¥çœ‹è¯¦ç»†çš„ TLS å¥—ä»¶é…ç½®ã€‚ OCSP è¯ä¹¦éªŒè¯åè®® https://www.ssl.com/blogs/how-do-browsers-handle-revoked-ssl-tls-certificates/ https://imququ.com/post/why-can-not-turn-on-ocsp-stapling.html https://www.digicert.com/help/ å‰é¢æåˆ°é™¤äº†æ•°å­—è¯ä¹¦è‡ªå¸¦çš„æœ‰æ•ˆæœŸå¤–ï¼Œä¸ºäº†åœ¨ç§é’¥æ³„æ¼çš„æƒ…å†µä¸‹ï¼Œèƒ½å¤ŸåŠé”€å¯¹åº”çš„è¯ä¹¦ï¼ŒPKI å…¬é’¥åŸºç¡€è®¾æ–½è¿˜æä¾›äº† OCSPï¼ˆOnline Certificate Status Protocolï¼‰è¯ä¹¦çŠ¶æ€æŸ¥è¯¢åè®®ã€‚ è¿™å¯¼è‡´äº†ä¸€äº›é—®é¢˜ï¼š Chrome/Firefox ç­‰æµè§ˆå™¨éƒ½ä¼šå®šæœŸé€šè¿‡ OCSP åè®®å»è¯·æ±‚ CA æœºæ„çš„ OCSP æœåŠ¡å™¨éªŒè¯è¯ä¹¦çŠ¶æ€ï¼Œ è¿™å¯èƒ½ä¼šæ‹–æ…¢ HTTPS åè®®çš„å“åº”é€Ÿåº¦ã€‚ æ‰€è°“çš„å®šæœŸæ˜¯æŒ‡è¶…è¿‡ä¸Šä¸€ä¸ª OCSP å“åº”çš„ nextUpdate æ—¶é—´ï¼ˆä¸€èˆ¬ä¸º 7 å¤©ï¼‰ï¼Œæˆ–è€…å¦‚æœè¯¥å€¼ä¸ºç©ºçš„è¯ï¼ŒFirefox é»˜è®¤ 24h åä¼šé‡æ–°æŸ¥è¯¢ OCSP çŠ¶æ€ã€‚ å› ä¸ºå®¢æˆ·ç«¯ç›´æ¥å»è¯·æ±‚ CA æœºæ„çš„ OCSP åœ°å€è·å–è¯ä¹¦çŠ¶æ€ï¼Œè¿™å°±å¯¼è‡´ CA æœºæ„å¯ä»¥è·å–åˆ°ä¸€äº›å¯¹åº”ç«™ç‚¹çš„ç”¨æˆ·ä¿¡æ¯ï¼ˆIP åœ°å€ã€ç½‘ç»œçŠ¶æ€ç­‰ï¼‰ã€‚ ä¸ºäº†è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œrfc6066 å®šä¹‰äº† OCSP stapling åŠŸèƒ½ï¼Œå®ƒä½¿æœåŠ¡å™¨å¯ä»¥æå‰è®¿é—® OCSP è·å–è¯ä¹¦çŠ¶æ€ä¿¡æ¯å¹¶ç¼“å­˜åˆ°æœ¬åœ°ï¼ŒåŸºæœ¬ Nginx/Caddy ç­‰å„å¤§ Web æœåŠ¡å™¨æˆ–ç½‘å…³ï¼Œéƒ½æ”¯æŒ OCSP stapling åè®®ã€‚ åœ¨å®¢æˆ·ç«¯ä½¿ç”¨ TLS åè®®è®¿é—® HTTPS æœåŠ¡æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šç›´æ¥åœ¨æ¡æ‰‹é˜¶æ®µå°†ç¼“å­˜çš„ OCSP ä¿¡æ¯å‘é€ç»™å®¢æˆ·ç«¯ã€‚å› ä¸º OCSP ä¿¡æ¯ä¼šå¸¦æœ‰ CA è¯ä¹¦çš„ç­¾ååŠæœ‰æ•ˆæœŸï¼Œå®¢æˆ·ç«¯å¯ä»¥ç›´æ¥é€šè¿‡ç­¾åéªŒè¯ OCSP ä¿¡æ¯çš„çœŸå®æ€§ä¸æœ‰æ•ˆæ€§ï¼Œè¿™æ ·å°±é¿å…äº†å®¢æˆ·ç«¯è®¿é—® OCSP æœåŠ¡å™¨å¸¦æ¥çš„å¼€é”€ã€‚ è€Œå¦ä¸€ä¸ªæ–¹æ³•ï¼Œå°±æ˜¯é€‰ç”¨ ocsp æœåŠ¡å™¨åœ¨ç›®æ ‡ç”¨æˆ·åŒºåŸŸé€Ÿåº¦å¿«çš„ CA æœºæ„ç­¾å‘è¯ä¹¦ã€‚ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æµ‹è¯•ï¼Œç¡®è®¤ç«™ç‚¹æ˜¯å¦å¯ç”¨äº† ocsp stapling: conf $ openssl s_client -connect www.digicert.com:443 -servername www.digicert.com -status -tlsextdebug \u003c /dev/null 2\u003e\u00261 | grep -i \"OCSP response\" å¦‚æœè¾“å‡ºåŒ…å« OCSP Response Status: successful å°±è¯´æ˜ç«™ç‚¹æ”¯æŒ ocsp staplingï¼Œå¦‚æœè¾“å‡ºå†…å®¹ä¸º OCSP response: no response sent åˆ™è¯´æ˜ç«™ç‚¹ä¸æ”¯æŒocsp staplingã€‚ å®é™…ä¸Š Google/AWS ç­‰å¤§å¤šæ•°ç«™ç‚¹éƒ½ä¸ä¼šå¯ç”¨ä¹Ÿä¸éœ€è¦å¯ç”¨ ocsp staplingï¼Œä¸€æ˜¯å› ä¸ºå®ƒä»¬è‡ªå·±å°±æ˜¯è¯ä¹¦é¢å‘æœºæ„ï¼ŒOCSP æœåŠ¡å™¨ä¹Ÿå½’å®ƒä»¬è‡ªå·±ç®¡ï¼Œä¸å­˜åœ¨éšç§çš„é—®é¢˜ã€‚äºŒæ˜¯å®ƒä»¬çš„ OCSP æœåŠ¡å™¨éå¸ƒ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:4:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#nginx-çš„-tls-åè®®é…ç½®"},{"categories":["tech"],"content":" 1. å¯†ç å¥—ä»¶ä¸ TLS å†å²ç‰ˆæœ¬å¯†ç å¥—ä»¶ï¼ˆCipher_suiteï¼‰æ˜¯ TLS åè®®ä¸­ä¸€ç»„ç”¨äºå®ç°å®‰å…¨é€šè®¯çš„å¯†ç å­¦ç®—æ³•ï¼Œç±»ä¼¼äºæˆ‘ä»¬å‰é¢å­¦ä¹ è¿‡çš„åŠ å¯†æ–¹æ¡ˆã€‚ä¸åŒå¯†ç å­¦ç®—æ³•çš„ç»„åˆå½¢æˆä¸åŒçš„å¯†ç å¥—ä»¶ï¼Œç®—æ³•ç»„åˆçš„å·®å¼‚ä½¿è¿™äº›å¯†ç å¥—ä»¶å…·æœ‰ä¸åŒçš„æ€§èƒ½ä¸å®‰å…¨æ€§ï¼Œå¦å¤– TLS åè®®çš„æ›´æ–°è¿­ä»£ä¹Ÿå¯¼è‡´å„å¯†ç å¥—ä»¶æ‹¥æœ‰ä¸åŒçš„å…¼å®¹æ€§ã€‚é€šå¸¸è¶Šæ–°æ¨å‡ºçš„å¯†ç å¥—ä»¶çš„å®‰å…¨æ€§è¶Šé«˜ï¼Œä½†æ˜¯å…¼å®¹æ€§å°±è¶Šå·®ï¼ˆæ—§è®¾å¤‡ä¸æ”¯æŒï¼‰ã€‚ å¯†ç å¥—ä»¶çš„åç§°ç”±å®ƒä½¿ç”¨çš„å„ç§å¯†ç å­¦ç®—æ³•åç§°ç»„æˆï¼Œè€Œä¸”æœ‰å›ºå®šçš„æ ¼å¼ï¼Œä»¥TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 ä¸ºä¾‹ä»‹ç»ä¸‹ï¼š TLS: å®šä¹‰äº†æ­¤å¥—ä»¶é€‚ç”¨çš„åè®®ï¼Œé€šå¸¸å›ºå®šä¸º TLS ECDHE: å¯†é’¥äº¤æ¢ç®—æ³• RSA: æ•°å­—è¯ä¹¦è®¤è¯ç®—æ³• AES_128_GCM: ä½¿ç”¨çš„å¯¹ç§°åŠ å¯†æ–¹æ¡ˆï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäº AES ä¸ GCM æ¨¡å¼çš„å¯¹ç§°è®¤è¯åŠ å¯†æ–¹æ¡ˆï¼Œä½¿ç”¨ 128 ä½å¯†é’¥ SHA256: å“ˆå¸Œå‡½æ•°ï¼Œç”¨äº HMAC ç®—æ³•å®ç°æ¶ˆæ¯è®¤è¯ TLS å›ºå®šä½¿ç”¨ HMAC ç®—æ³•è¿›è¡Œæ¶ˆæ¯è®¤è¯ TLS åè®®çš„å‰èº«æ˜¯ SSL åè®®ï¼ŒTLS/SSL çš„å‘å±•å†ç¨‹å±•ç¤ºå¦‚ä¸‹ï¼š SSL/TLS çš„å†å²ç‰ˆæœ¬ SSL åè®®æ—©åœ¨ 2015 å¹´å°±è¢«å„å¤§ä¸»æµæµè§ˆå™¨åºŸé™¤äº†ï¼ŒTLS1.0 æ„Ÿè§‰ä¹ŸåŸºæœ¬æ²¡ç«™ç‚¹åœ¨ç”¨äº†ï¼Œè¿™ä¿©å°±ç›´æ¥è·³è¿‡äº†ã€‚ ä¸‹é¢åˆ†åˆ«ä»‹ç»ä¸‹ TLS1.1 TLS1.2 ä¸ TLS1.3. TLS 1.1TLS 1.1 åœ¨ RFC4346 ä¸­å®šä¹‰ï¼Œäº 2006 å¹´ 4 æœˆå‘å¸ƒã€‚ TLS 1.1 æ˜¯ TLS 1.0 çš„ä¸€ä¸ªè¡¥ä¸ï¼Œä¸»è¦æ›´æ–°åŒ…æ‹¬ï¼š æ·»åŠ å¯¹CBCæ”»å‡»çš„ä¿æŠ¤ éšå¼åˆå§‹å‘é‡ IV è¢«æ›¿æ¢æˆä¸€ä¸ªæ˜¾å¼çš„ IV ä¿®å¤åˆ†ç»„å¯†ç æ¨¡å¼ä¸­å¡«å……ç®—æ³•çš„ bug æ”¯æŒ IANA ç™»è®°çš„å‚æ•° TLS 1.1åŠå…¶ä¹‹å‰çš„ç®—æ³•æ›¾ç»è¢«å¹¿æ³›åº”ç”¨ï¼Œå®ƒç›®å‰å·²çŸ¥çš„ç¼ºé™·å¦‚ä¸‹ï¼š ä¸æ”¯æŒ PFS å®Œå…¨å‰å‘ä¿å¯† ä¸æ”¯æŒ AEAD è®¤è¯åŠ å¯†ç®—æ³• ä¸ºäº†å…¼å®¹æ€§ï¼Œä¿ç•™äº†å¾ˆå¤šä¸å®‰å…¨çš„ç®—æ³• TLS 1.1 å·²ç»ä¸å¤Ÿå®‰å…¨äº†ï¼Œä¸è¿‡ä¸€äº›é™ˆå¹´è€ç«™ç‚¹æˆ–è®¸è¿˜åœ¨ä½¿ç”¨å®ƒã€‚ å„æ“ä½œç³»ç»Ÿï¼ˆAndroid/IOS/MacOS/Windowsï¼‰ä¸æµè§ˆå™¨åŸºæœ¬éƒ½åœ¨å¾ˆæ—©çš„ç‰ˆæœ¬ä¸­å°±å·²ç»æ”¯æŒ TLS1.2+ äº†ï¼Œ ç«™åœ¨ 2022 å¹´è¿™ä¸ªæ—¶é—´èŠ‚ç‚¹çœ‹ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥å®Œå…¨åºŸæ­¢ TLS1.1 åè®®ã€‚å®é™…ä¸Šå„å¤§äº‘å‚å•†ä¹Ÿæ˜¯è¿™ä¹ˆå¹²çš„ï¼Œæ¯”å¦‚ AWS è‡ªèº«çš„ API å¯¹ TLS1.1 çš„æ”¯æŒå°±å·²ç¡®å®šå°†åœ¨ 2023 å¹´ 6 æœˆåºŸæ­¢ï¼Œ2022 å¹´å°±å¼€å§‹é¢‘ç¹æ‰«æå¹¶æé†’å„ä½ä»ç„¶åœ¨ä½¿ç”¨ä½ç‰ˆæœ¬ TLS åè®®çš„å®¢æˆ·å‡çº§ã€‚ TLS 1.2TLS 1.2 åœ¨ RFC5246 ä¸­å®šä¹‰ï¼Œäº 2008 å¹´ 8 æœˆå‘å‘å¸ƒã€‚ å¯é€‰æ”¯æŒ PFS å®Œå…¨å‰å‘ä¿å¯† ç§»é™¤å¯¹ MD5 ä¸ SHA-1 ç­¾åç®—æ³•çš„æ”¯æŒ æ·»åŠ å¯¹ HMAC-SHA-256 åŠ HMAC-SHA-384 æ¶ˆæ¯è®¤è¯ç®—æ³•çš„æ”¯æŒ æ·»åŠ å¯¹ AEAD åŠ å¯†è®¤è¯æ–¹æ¡ˆçš„æ”¯æŒ å»é™¤ forback å›åˆ° SSL åè®®çš„èƒ½åŠ›ï¼Œæå‡å®‰å…¨æ€§ ä¸ºäº†å…¼å®¹æ€§ï¼Œä¿ç•™äº†å¾ˆå¤šä¸å®‰å…¨çš„ç®—æ³• å¦‚æœä½ ä½¿ç”¨ TLS 1.2ï¼Œéœ€è¦å°å¿ƒåœ°é€‰æ‹©å¯†ç å¥—ä»¶ï¼Œé¿å¼€ä¸å®‰å…¨çš„å¥—ä»¶ï¼Œå°±èƒ½å®ç°è¶³å¤Ÿé«˜çš„å®‰å…¨æ€§ã€‚ TLS 1.3TLS 1.3 åšäº†ä¸€æ¬¡å¤§åˆ€é˜”æ–§çš„æ›´æ–°ï¼Œæ˜¯ä¸€ä¸ªé‡Œç¨‹ç¢‘å¼çš„ç‰ˆæœ¬ï¼Œå…¶æ›´æ–°æ€»ç»“å¦‚ä¸‹ï¼š ç§»é™¤å¯¹å¦‚ä¸‹ç®—æ³•çš„æ”¯æŒ å“ˆå¸Œå‡½æ•° SHA1/MD5 æ‰€æœ‰é AEAD åŠ å¯†è®¤è¯çš„å¯†ç æ–¹æ¡ˆï¼ˆCBC æ¨¡å¼ï¼‰ ç§»é™¤å¯¹ RC4 ä¸ 3DES åŠ å¯†ç®—æ³•çš„æ”¯æŒ ç§»é™¤äº†é™æ€ RSA ä¸ DH å¯†é’¥äº¤æ¢ç®—æ³• æ”¯æŒé«˜æ€§èƒ½çš„ Ed25519/Ed448 ç­¾åè®¤è¯ç®—æ³•ã€X25519 å¯†é’¥åå•†ç®—æ³• æ”¯æŒé«˜æ€§èƒ½çš„ ChaCha20-Poly1305 å¯¹ç§°è®¤è¯åŠ å¯†æ–¹æ¡ˆ å°†å¯†é’¥äº¤æ¢ç®—æ³•ä¸å…¬é’¥è®¤è¯ç®—æ³•ä»å¯†ç å¥—ä»¶ä¸­åˆ†ç¦»å‡ºæ¥ æ¯”å¦‚åŸæ¥çš„ TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 å¯†ç å¥—ä»¶å°†è¢«æ‹†åˆ†ä¸º ECDHE ç®—æ³•ã€RSA èº«ä»½è®¤è¯ç®—æ³•ã€ä»¥åŠ TLS_AES_128_GCM_SHA256 å¯†ç å¥—ä»¶ è¿™æ ·å¯†ç å¥—ä»¶å°±åªåŒ…å«ä¸€ä¸ª AEAD è®¤è¯åŠ å¯†æ–¹æ¡ˆï¼Œä»¥åŠä¸€ä¸ªå“ˆå¸Œå‡½æ•°äº† ä»…æ”¯æŒå‰å‘å®‰å…¨çš„å¯†é’¥äº¤æ¢ç®—æ³• DHE æˆ– ECDHE æ”¯æŒæœ€çŸ­ 0-RTT çš„ TLS æ¡æ‰‹ï¼ˆä¼šè¯æ¢å¤ï¼‰ TLS 1.3 ä»åè®®ä¸­åˆ é™¤äº†æ‰€æœ‰ä¸å®‰å…¨çš„ç®—æ³•æˆ–åè®®ï¼Œå¯ä»¥è¯´åªè¦ä½ çš„é€šè®¯ç”¨äº† TLS 1.3ï¼Œé‚£ä½ çš„æ•°æ®å°±å®‰å…¨äº†ï¼ˆå½“ç„¶å‰ææ˜¯ä½ çš„ç§é’¥æ²¡æ³„æ¼ï¼‰ã€‚ å¦‚ä½•è®¾ç½® TLS åè®®çš„ç‰ˆæœ¬ã€å¯†ç å¥—ä»¶å‚æ•°æˆ‘ä»¬å‰é¢å·²ç»å­¦ä¹ äº†å¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†ã€å¯†é’¥äº¤æ¢ä¸‰éƒ¨åˆ†çŸ¥è¯†ï¼Œå¯¹ç…§ TLS å¥—ä»¶çš„åç§°ï¼Œåº”è¯¥èƒ½å¾ˆå®¹æ˜“åˆ¤æ–­å‡ºå“ªäº›æ˜¯å®‰å…¨çš„ã€å“ªäº›ä¸å¤Ÿå®‰å…¨ï¼Œå“ªäº›æ”¯æŒå‰å‘ä¿å¯†ã€å“ªäº›ä¸æ”¯æŒã€‚ ä¸€ä¸ªéå¸¸å¥½ç”¨çš„ã€Œç«™ç‚¹ HTTPS å®‰å…¨æ£€æµ‹ã€ç½‘ç«™æ˜¯ https://myssl.com/ï¼Œä½¿ç”¨å®ƒæµ‹è¯•çŸ¥ä¹ç½‘çš„æ£€æµ‹ç»“æœå¦‚ä¸‹ï¼š SSL/TLS çš„å†å²ç‰ˆæœ¬ èƒ½çœ‹åˆ°çŸ¥ä¹ä¸ºäº†å…¼å®¹æ€§ï¼Œç›®å‰ä»ç„¶æ”¯æŒ TLS1.0 ä¸ TLS1.1ï¼Œå¦å¤–ç›®å‰è¿˜ä¸æ”¯æŒ TLS1.3. æ­¤å¤–ï¼ŒçŸ¥ä¹ä»ç„¶æ”¯æŒå¾ˆå¤šå·²ç»ä¸å®‰å…¨çš„åŠ å¯†å¥—ä»¶ï¼Œmyssl.com ä¸“é—¨ä½¿ç”¨é»„è‰²æ ‡è¯†å‡ºäº†è¿™äº›ä¸å®‰å…¨çš„åŠ å¯†å¥—ä»¶ï¼Œæˆ‘ä»¬æ€»ç»“ä¸‹ä¸»è¦ç‰¹å¾ï¼š éƒ¨åˆ†å¯†ç å¥—ä»¶ä½¿ç”¨äº†ä¸å®‰å…¨çš„å¯¹ç§°åŠ å¯†ç®—æ³• 3DES å…¶ä»–è¢«æ ‡è¯†ä¸ºé»„è‰²çš„å¥—ä»¶è™½ç„¶ä½¿ç”¨äº†å®‰å…¨çš„å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œä½†æ˜¯ä¸æ”¯æŒ PFS å‰å‘ä¿å¯† æ­¤å¤– myssl.com è¿˜åˆ—å‡ºäº†è®¸å¤šç«™ç‚¹æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ TLS1.3 çš„ä¼šè¯æ¢å¤ï¼Œä»¥åŠåé¢å°†ä¼šä»‹ç»çš„å…¬é’¥å›ºå®šã€HTTPä¸¥æ ¼ä¼ è¾“å®‰å…¨ç­‰ä¿¡æ¯ï¼š SSL/TLS çš„å†å²ç‰ˆæœ¬ Nginx çš„ TLS åè®®é…ç½®ä»¥å‰ä¸º Nginx ç­‰ç¨‹åºé…ç½® HTTPS åè®®æ—¶ï¼Œæˆ‘æœ€å¤´ç–¼çš„å°±æ˜¯å…¶ä¸­å¯†ç å¥—ä»¶å‚æ•° ssl_ciphersï¼Œä¸ºäº†å®‰å…¨æ€§ï¼Œéœ€è¦é…ç½®è¶…é•¿çš„ä¸€å¤§å †é€‰ç”¨çš„å¯†ç å¥—ä»¶åç§°ï¼Œæˆ‘å¯ä»¥è¯´ä¸€ä¸ªéƒ½çœ‹ä¸æ‡‚ï¼Œä½†æ˜¯ä¸ºäº†æŠŠç½‘ç«™æå¥½è¿˜æ˜¯å¾—ç¡¬ç€å¤´çš®æœç´¢å¤åˆ¶ç²˜è´´ï¼Œå®é™…ä¸Šä¹Ÿä¸æ¸…æ¥šå®‰å…¨æ€§åˆ°åº•å¦‚ä½•ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒMozilla/DigitalOcean éƒ½æè¿‡æµè¡Œ Web æœåŠ¡å™¨çš„ TLS é…ç½®ç”Ÿæˆå·¥å…·ï¼Œæ¯”å¦‚ssl-config - mozillaï¼Œè¿™ä¸ªç½‘ç«™æä¾›ä¸‰ä¸ªå®‰å…¨ç­‰çº§çš„é…ç½®: ã€ŒIntermediateã€: æŸ¥çœ‹ç”Ÿæˆå‡ºçš„ ssl-cipher å±æ€§ï¼Œå‘ç°å®ƒåªæ”¯æŒ ECDHE/DHE å¼€å¤´çš„ç®—æ³•ã€‚å› æ­¤å®ƒä¿è¯å‰å‘ä¿å¯†ã€‚ å¯¹äºéœ€è¦é€šè¿‡æµè§ˆå™¨è®¿é—®çš„ APIï¼Œæ¨èé€‰æ‹©è¿™ä¸ªç­‰çº§ã€‚ ã€ŒModernã€: åªæ”¯æŒ TLSv1.3ï¼Œè¯¥åè®®åºŸå¼ƒæ‰äº†è¿‡å¾€æ‰€æœ‰ä¸å®‰å…¨çš„ç®—æ³•ï¼Œä¿è¯å‰å‘ä¿å¯†ï¼Œå®‰å…¨æ€§æé«˜ï¼Œæ€§èƒ½ä¹Ÿæ›´å¥½ã€‚ å¯¹äºä¸éœ€è¦é€šè¿‡æµè§ˆå™¨ç­‰æ—§ç»ˆç«¯è®¿é—®çš„ APIï¼Œè¯·ç›´æ¥é€‰æ‹©è¿™ä¸ªç­‰çº§ã€‚ ã€ŒOldã€: é™¤éä½ çš„ç”¨æˆ·ä½¿ç”¨éå¸¸è€çš„ç»ˆç«¯è¿›è¡Œè®¿é—®ï¼Œå¦åˆ™è¯·ä¸è¦è€ƒè™‘è¿™ä¸ªé€‰é¡¹ï¼ å¯ä»¥ç‚¹è¿›å»æŸ¥çœ‹è¯¦ç»†çš„ TLS å¥—ä»¶é…ç½®ã€‚ OCSP è¯ä¹¦éªŒè¯åè®® https://www.ssl.com/blogs/how-do-browsers-handle-revoked-ssl-tls-certificates/ https://imququ.com/post/why-can-not-turn-on-ocsp-stapling.html https://www.digicert.com/help/ å‰é¢æåˆ°é™¤äº†æ•°å­—è¯ä¹¦è‡ªå¸¦çš„æœ‰æ•ˆæœŸå¤–ï¼Œä¸ºäº†åœ¨ç§é’¥æ³„æ¼çš„æƒ…å†µä¸‹ï¼Œèƒ½å¤ŸåŠé”€å¯¹åº”çš„è¯ä¹¦ï¼ŒPKI å…¬é’¥åŸºç¡€è®¾æ–½è¿˜æä¾›äº† OCSPï¼ˆOnline Certificate Status Protocolï¼‰è¯ä¹¦çŠ¶æ€æŸ¥è¯¢åè®®ã€‚ è¿™å¯¼è‡´äº†ä¸€äº›é—®é¢˜ï¼š Chrome/Firefox ç­‰æµè§ˆå™¨éƒ½ä¼šå®šæœŸé€šè¿‡ OCSP åè®®å»è¯·æ±‚ CA æœºæ„çš„ OCSP æœåŠ¡å™¨éªŒè¯è¯ä¹¦çŠ¶æ€ï¼Œ è¿™å¯èƒ½ä¼šæ‹–æ…¢ HTTPS åè®®çš„å“åº”é€Ÿåº¦ã€‚ æ‰€è°“çš„å®šæœŸæ˜¯æŒ‡è¶…è¿‡ä¸Šä¸€ä¸ª OCSP å“åº”çš„ nextUpdate æ—¶é—´ï¼ˆä¸€èˆ¬ä¸º 7 å¤©ï¼‰ï¼Œæˆ–è€…å¦‚æœè¯¥å€¼ä¸ºç©ºçš„è¯ï¼ŒFirefox é»˜è®¤ 24h åä¼šé‡æ–°æŸ¥è¯¢ OCSP çŠ¶æ€ã€‚ å› ä¸ºå®¢æˆ·ç«¯ç›´æ¥å»è¯·æ±‚ CA æœºæ„çš„ OCSP åœ°å€è·å–è¯ä¹¦çŠ¶æ€ï¼Œè¿™å°±å¯¼è‡´ CA æœºæ„å¯ä»¥è·å–åˆ°ä¸€äº›å¯¹åº”ç«™ç‚¹çš„ç”¨æˆ·ä¿¡æ¯ï¼ˆIP åœ°å€ã€ç½‘ç»œçŠ¶æ€ç­‰ï¼‰ã€‚ ä¸ºäº†è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œrfc6066 å®šä¹‰äº† OCSP stapling åŠŸèƒ½ï¼Œå®ƒä½¿æœåŠ¡å™¨å¯ä»¥æå‰è®¿é—® OCSP è·å–è¯ä¹¦çŠ¶æ€ä¿¡æ¯å¹¶ç¼“å­˜åˆ°æœ¬åœ°ï¼ŒåŸºæœ¬ Nginx/Caddy ç­‰å„å¤§ Web æœåŠ¡å™¨æˆ–ç½‘å…³ï¼Œéƒ½æ”¯æŒ OCSP stapling åè®®ã€‚ åœ¨å®¢æˆ·ç«¯ä½¿ç”¨ TLS åè®®è®¿é—® HTTPS æœåŠ¡æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šç›´æ¥åœ¨æ¡æ‰‹é˜¶æ®µå°†ç¼“å­˜çš„ OCSP ä¿¡æ¯å‘é€ç»™å®¢æˆ·ç«¯ã€‚å› ä¸º OCSP ä¿¡æ¯ä¼šå¸¦æœ‰ CA è¯ä¹¦çš„ç­¾ååŠæœ‰æ•ˆæœŸï¼Œå®¢æˆ·ç«¯å¯ä»¥ç›´æ¥é€šè¿‡ç­¾åéªŒè¯ OCSP ä¿¡æ¯çš„çœŸå®æ€§ä¸æœ‰æ•ˆæ€§ï¼Œè¿™æ ·å°±é¿å…äº†å®¢æˆ·ç«¯è®¿é—® OCSP æœåŠ¡å™¨å¸¦æ¥çš„å¼€é”€ã€‚ è€Œå¦ä¸€ä¸ªæ–¹æ³•ï¼Œå°±æ˜¯é€‰ç”¨ ocsp æœåŠ¡å™¨åœ¨ç›®æ ‡ç”¨æˆ·åŒºåŸŸé€Ÿåº¦å¿«çš„ CA æœºæ„ç­¾å‘è¯ä¹¦ã€‚ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æµ‹è¯•ï¼Œç¡®è®¤ç«™ç‚¹æ˜¯å¦å¯ç”¨äº† ocsp stapling: conf $ openssl s_client -connect www.digicert.com:443 -servername www.digicert.com -status -tlsextdebug \u003c /dev/null 2\u003e\u00261 | grep -i \"OCSP response\" å¦‚æœè¾“å‡ºåŒ…å« OCSP Response Status: successful å°±è¯´æ˜ç«™ç‚¹æ”¯æŒ ocsp staplingï¼Œå¦‚æœè¾“å‡ºå†…å®¹ä¸º OCSP response: no response sent åˆ™è¯´æ˜ç«™ç‚¹ä¸æ”¯æŒocsp staplingã€‚ å®é™…ä¸Š Google/AWS ç­‰å¤§å¤šæ•°ç«™ç‚¹éƒ½ä¸ä¼šå¯ç”¨ä¹Ÿä¸éœ€è¦å¯ç”¨ ocsp staplingï¼Œä¸€æ˜¯å› ä¸ºå®ƒä»¬è‡ªå·±å°±æ˜¯è¯ä¹¦é¢å‘æœºæ„ï¼ŒOCSP æœåŠ¡å™¨ä¹Ÿå½’å®ƒä»¬è‡ªå·±ç®¡ï¼Œä¸å­˜åœ¨éšç§çš„é—®é¢˜ã€‚äºŒæ˜¯å®ƒä»¬çš„ OCSP æœåŠ¡å™¨éå¸ƒ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:4:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#ocsp-è¯ä¹¦éªŒè¯åè®®"},{"categories":["tech"],"content":" 1. å¯†ç å¥—ä»¶ä¸ TLS å†å²ç‰ˆæœ¬å¯†ç å¥—ä»¶ï¼ˆCipher_suiteï¼‰æ˜¯ TLS åè®®ä¸­ä¸€ç»„ç”¨äºå®ç°å®‰å…¨é€šè®¯çš„å¯†ç å­¦ç®—æ³•ï¼Œç±»ä¼¼äºæˆ‘ä»¬å‰é¢å­¦ä¹ è¿‡çš„åŠ å¯†æ–¹æ¡ˆã€‚ä¸åŒå¯†ç å­¦ç®—æ³•çš„ç»„åˆå½¢æˆä¸åŒçš„å¯†ç å¥—ä»¶ï¼Œç®—æ³•ç»„åˆçš„å·®å¼‚ä½¿è¿™äº›å¯†ç å¥—ä»¶å…·æœ‰ä¸åŒçš„æ€§èƒ½ä¸å®‰å…¨æ€§ï¼Œå¦å¤– TLS åè®®çš„æ›´æ–°è¿­ä»£ä¹Ÿå¯¼è‡´å„å¯†ç å¥—ä»¶æ‹¥æœ‰ä¸åŒçš„å…¼å®¹æ€§ã€‚é€šå¸¸è¶Šæ–°æ¨å‡ºçš„å¯†ç å¥—ä»¶çš„å®‰å…¨æ€§è¶Šé«˜ï¼Œä½†æ˜¯å…¼å®¹æ€§å°±è¶Šå·®ï¼ˆæ—§è®¾å¤‡ä¸æ”¯æŒï¼‰ã€‚ å¯†ç å¥—ä»¶çš„åç§°ç”±å®ƒä½¿ç”¨çš„å„ç§å¯†ç å­¦ç®—æ³•åç§°ç»„æˆï¼Œè€Œä¸”æœ‰å›ºå®šçš„æ ¼å¼ï¼Œä»¥TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 ä¸ºä¾‹ä»‹ç»ä¸‹ï¼š TLS: å®šä¹‰äº†æ­¤å¥—ä»¶é€‚ç”¨çš„åè®®ï¼Œé€šå¸¸å›ºå®šä¸º TLS ECDHE: å¯†é’¥äº¤æ¢ç®—æ³• RSA: æ•°å­—è¯ä¹¦è®¤è¯ç®—æ³• AES_128_GCM: ä½¿ç”¨çš„å¯¹ç§°åŠ å¯†æ–¹æ¡ˆï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäº AES ä¸ GCM æ¨¡å¼çš„å¯¹ç§°è®¤è¯åŠ å¯†æ–¹æ¡ˆï¼Œä½¿ç”¨ 128 ä½å¯†é’¥ SHA256: å“ˆå¸Œå‡½æ•°ï¼Œç”¨äº HMAC ç®—æ³•å®ç°æ¶ˆæ¯è®¤è¯ TLS å›ºå®šä½¿ç”¨ HMAC ç®—æ³•è¿›è¡Œæ¶ˆæ¯è®¤è¯ TLS åè®®çš„å‰èº«æ˜¯ SSL åè®®ï¼ŒTLS/SSL çš„å‘å±•å†ç¨‹å±•ç¤ºå¦‚ä¸‹ï¼š SSL/TLS çš„å†å²ç‰ˆæœ¬ SSL åè®®æ—©åœ¨ 2015 å¹´å°±è¢«å„å¤§ä¸»æµæµè§ˆå™¨åºŸé™¤äº†ï¼ŒTLS1.0 æ„Ÿè§‰ä¹ŸåŸºæœ¬æ²¡ç«™ç‚¹åœ¨ç”¨äº†ï¼Œè¿™ä¿©å°±ç›´æ¥è·³è¿‡äº†ã€‚ ä¸‹é¢åˆ†åˆ«ä»‹ç»ä¸‹ TLS1.1 TLS1.2 ä¸ TLS1.3. TLS 1.1TLS 1.1 åœ¨ RFC4346 ä¸­å®šä¹‰ï¼Œäº 2006 å¹´ 4 æœˆå‘å¸ƒã€‚ TLS 1.1 æ˜¯ TLS 1.0 çš„ä¸€ä¸ªè¡¥ä¸ï¼Œä¸»è¦æ›´æ–°åŒ…æ‹¬ï¼š æ·»åŠ å¯¹CBCæ”»å‡»çš„ä¿æŠ¤ éšå¼åˆå§‹å‘é‡ IV è¢«æ›¿æ¢æˆä¸€ä¸ªæ˜¾å¼çš„ IV ä¿®å¤åˆ†ç»„å¯†ç æ¨¡å¼ä¸­å¡«å……ç®—æ³•çš„ bug æ”¯æŒ IANA ç™»è®°çš„å‚æ•° TLS 1.1åŠå…¶ä¹‹å‰çš„ç®—æ³•æ›¾ç»è¢«å¹¿æ³›åº”ç”¨ï¼Œå®ƒç›®å‰å·²çŸ¥çš„ç¼ºé™·å¦‚ä¸‹ï¼š ä¸æ”¯æŒ PFS å®Œå…¨å‰å‘ä¿å¯† ä¸æ”¯æŒ AEAD è®¤è¯åŠ å¯†ç®—æ³• ä¸ºäº†å…¼å®¹æ€§ï¼Œä¿ç•™äº†å¾ˆå¤šä¸å®‰å…¨çš„ç®—æ³• TLS 1.1 å·²ç»ä¸å¤Ÿå®‰å…¨äº†ï¼Œä¸è¿‡ä¸€äº›é™ˆå¹´è€ç«™ç‚¹æˆ–è®¸è¿˜åœ¨ä½¿ç”¨å®ƒã€‚ å„æ“ä½œç³»ç»Ÿï¼ˆAndroid/IOS/MacOS/Windowsï¼‰ä¸æµè§ˆå™¨åŸºæœ¬éƒ½åœ¨å¾ˆæ—©çš„ç‰ˆæœ¬ä¸­å°±å·²ç»æ”¯æŒ TLS1.2+ äº†ï¼Œ ç«™åœ¨ 2022 å¹´è¿™ä¸ªæ—¶é—´èŠ‚ç‚¹çœ‹ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥å®Œå…¨åºŸæ­¢ TLS1.1 åè®®ã€‚å®é™…ä¸Šå„å¤§äº‘å‚å•†ä¹Ÿæ˜¯è¿™ä¹ˆå¹²çš„ï¼Œæ¯”å¦‚ AWS è‡ªèº«çš„ API å¯¹ TLS1.1 çš„æ”¯æŒå°±å·²ç¡®å®šå°†åœ¨ 2023 å¹´ 6 æœˆåºŸæ­¢ï¼Œ2022 å¹´å°±å¼€å§‹é¢‘ç¹æ‰«æå¹¶æé†’å„ä½ä»ç„¶åœ¨ä½¿ç”¨ä½ç‰ˆæœ¬ TLS åè®®çš„å®¢æˆ·å‡çº§ã€‚ TLS 1.2TLS 1.2 åœ¨ RFC5246 ä¸­å®šä¹‰ï¼Œäº 2008 å¹´ 8 æœˆå‘å‘å¸ƒã€‚ å¯é€‰æ”¯æŒ PFS å®Œå…¨å‰å‘ä¿å¯† ç§»é™¤å¯¹ MD5 ä¸ SHA-1 ç­¾åç®—æ³•çš„æ”¯æŒ æ·»åŠ å¯¹ HMAC-SHA-256 åŠ HMAC-SHA-384 æ¶ˆæ¯è®¤è¯ç®—æ³•çš„æ”¯æŒ æ·»åŠ å¯¹ AEAD åŠ å¯†è®¤è¯æ–¹æ¡ˆçš„æ”¯æŒ å»é™¤ forback å›åˆ° SSL åè®®çš„èƒ½åŠ›ï¼Œæå‡å®‰å…¨æ€§ ä¸ºäº†å…¼å®¹æ€§ï¼Œä¿ç•™äº†å¾ˆå¤šä¸å®‰å…¨çš„ç®—æ³• å¦‚æœä½ ä½¿ç”¨ TLS 1.2ï¼Œéœ€è¦å°å¿ƒåœ°é€‰æ‹©å¯†ç å¥—ä»¶ï¼Œé¿å¼€ä¸å®‰å…¨çš„å¥—ä»¶ï¼Œå°±èƒ½å®ç°è¶³å¤Ÿé«˜çš„å®‰å…¨æ€§ã€‚ TLS 1.3TLS 1.3 åšäº†ä¸€æ¬¡å¤§åˆ€é˜”æ–§çš„æ›´æ–°ï¼Œæ˜¯ä¸€ä¸ªé‡Œç¨‹ç¢‘å¼çš„ç‰ˆæœ¬ï¼Œå…¶æ›´æ–°æ€»ç»“å¦‚ä¸‹ï¼š ç§»é™¤å¯¹å¦‚ä¸‹ç®—æ³•çš„æ”¯æŒ å“ˆå¸Œå‡½æ•° SHA1/MD5 æ‰€æœ‰é AEAD åŠ å¯†è®¤è¯çš„å¯†ç æ–¹æ¡ˆï¼ˆCBC æ¨¡å¼ï¼‰ ç§»é™¤å¯¹ RC4 ä¸ 3DES åŠ å¯†ç®—æ³•çš„æ”¯æŒ ç§»é™¤äº†é™æ€ RSA ä¸ DH å¯†é’¥äº¤æ¢ç®—æ³• æ”¯æŒé«˜æ€§èƒ½çš„ Ed25519/Ed448 ç­¾åè®¤è¯ç®—æ³•ã€X25519 å¯†é’¥åå•†ç®—æ³• æ”¯æŒé«˜æ€§èƒ½çš„ ChaCha20-Poly1305 å¯¹ç§°è®¤è¯åŠ å¯†æ–¹æ¡ˆ å°†å¯†é’¥äº¤æ¢ç®—æ³•ä¸å…¬é’¥è®¤è¯ç®—æ³•ä»å¯†ç å¥—ä»¶ä¸­åˆ†ç¦»å‡ºæ¥ æ¯”å¦‚åŸæ¥çš„ TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 å¯†ç å¥—ä»¶å°†è¢«æ‹†åˆ†ä¸º ECDHE ç®—æ³•ã€RSA èº«ä»½è®¤è¯ç®—æ³•ã€ä»¥åŠ TLS_AES_128_GCM_SHA256 å¯†ç å¥—ä»¶ è¿™æ ·å¯†ç å¥—ä»¶å°±åªåŒ…å«ä¸€ä¸ª AEAD è®¤è¯åŠ å¯†æ–¹æ¡ˆï¼Œä»¥åŠä¸€ä¸ªå“ˆå¸Œå‡½æ•°äº† ä»…æ”¯æŒå‰å‘å®‰å…¨çš„å¯†é’¥äº¤æ¢ç®—æ³• DHE æˆ– ECDHE æ”¯æŒæœ€çŸ­ 0-RTT çš„ TLS æ¡æ‰‹ï¼ˆä¼šè¯æ¢å¤ï¼‰ TLS 1.3 ä»åè®®ä¸­åˆ é™¤äº†æ‰€æœ‰ä¸å®‰å…¨çš„ç®—æ³•æˆ–åè®®ï¼Œå¯ä»¥è¯´åªè¦ä½ çš„é€šè®¯ç”¨äº† TLS 1.3ï¼Œé‚£ä½ çš„æ•°æ®å°±å®‰å…¨äº†ï¼ˆå½“ç„¶å‰ææ˜¯ä½ çš„ç§é’¥æ²¡æ³„æ¼ï¼‰ã€‚ å¦‚ä½•è®¾ç½® TLS åè®®çš„ç‰ˆæœ¬ã€å¯†ç å¥—ä»¶å‚æ•°æˆ‘ä»¬å‰é¢å·²ç»å­¦ä¹ äº†å¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†ã€å¯†é’¥äº¤æ¢ä¸‰éƒ¨åˆ†çŸ¥è¯†ï¼Œå¯¹ç…§ TLS å¥—ä»¶çš„åç§°ï¼Œåº”è¯¥èƒ½å¾ˆå®¹æ˜“åˆ¤æ–­å‡ºå“ªäº›æ˜¯å®‰å…¨çš„ã€å“ªäº›ä¸å¤Ÿå®‰å…¨ï¼Œå“ªäº›æ”¯æŒå‰å‘ä¿å¯†ã€å“ªäº›ä¸æ”¯æŒã€‚ ä¸€ä¸ªéå¸¸å¥½ç”¨çš„ã€Œç«™ç‚¹ HTTPS å®‰å…¨æ£€æµ‹ã€ç½‘ç«™æ˜¯ https://myssl.com/ï¼Œä½¿ç”¨å®ƒæµ‹è¯•çŸ¥ä¹ç½‘çš„æ£€æµ‹ç»“æœå¦‚ä¸‹ï¼š SSL/TLS çš„å†å²ç‰ˆæœ¬ èƒ½çœ‹åˆ°çŸ¥ä¹ä¸ºäº†å…¼å®¹æ€§ï¼Œç›®å‰ä»ç„¶æ”¯æŒ TLS1.0 ä¸ TLS1.1ï¼Œå¦å¤–ç›®å‰è¿˜ä¸æ”¯æŒ TLS1.3. æ­¤å¤–ï¼ŒçŸ¥ä¹ä»ç„¶æ”¯æŒå¾ˆå¤šå·²ç»ä¸å®‰å…¨çš„åŠ å¯†å¥—ä»¶ï¼Œmyssl.com ä¸“é—¨ä½¿ç”¨é»„è‰²æ ‡è¯†å‡ºäº†è¿™äº›ä¸å®‰å…¨çš„åŠ å¯†å¥—ä»¶ï¼Œæˆ‘ä»¬æ€»ç»“ä¸‹ä¸»è¦ç‰¹å¾ï¼š éƒ¨åˆ†å¯†ç å¥—ä»¶ä½¿ç”¨äº†ä¸å®‰å…¨çš„å¯¹ç§°åŠ å¯†ç®—æ³• 3DES å…¶ä»–è¢«æ ‡è¯†ä¸ºé»„è‰²çš„å¥—ä»¶è™½ç„¶ä½¿ç”¨äº†å®‰å…¨çš„å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œä½†æ˜¯ä¸æ”¯æŒ PFS å‰å‘ä¿å¯† æ­¤å¤– myssl.com è¿˜åˆ—å‡ºäº†è®¸å¤šç«™ç‚¹æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ TLS1.3 çš„ä¼šè¯æ¢å¤ï¼Œä»¥åŠåé¢å°†ä¼šä»‹ç»çš„å…¬é’¥å›ºå®šã€HTTPä¸¥æ ¼ä¼ è¾“å®‰å…¨ç­‰ä¿¡æ¯ï¼š SSL/TLS çš„å†å²ç‰ˆæœ¬ Nginx çš„ TLS åè®®é…ç½®ä»¥å‰ä¸º Nginx ç­‰ç¨‹åºé…ç½® HTTPS åè®®æ—¶ï¼Œæˆ‘æœ€å¤´ç–¼çš„å°±æ˜¯å…¶ä¸­å¯†ç å¥—ä»¶å‚æ•° ssl_ciphersï¼Œä¸ºäº†å®‰å…¨æ€§ï¼Œéœ€è¦é…ç½®è¶…é•¿çš„ä¸€å¤§å †é€‰ç”¨çš„å¯†ç å¥—ä»¶åç§°ï¼Œæˆ‘å¯ä»¥è¯´ä¸€ä¸ªéƒ½çœ‹ä¸æ‡‚ï¼Œä½†æ˜¯ä¸ºäº†æŠŠç½‘ç«™æå¥½è¿˜æ˜¯å¾—ç¡¬ç€å¤´çš®æœç´¢å¤åˆ¶ç²˜è´´ï¼Œå®é™…ä¸Šä¹Ÿä¸æ¸…æ¥šå®‰å…¨æ€§åˆ°åº•å¦‚ä½•ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒMozilla/DigitalOcean éƒ½æè¿‡æµè¡Œ Web æœåŠ¡å™¨çš„ TLS é…ç½®ç”Ÿæˆå·¥å…·ï¼Œæ¯”å¦‚ssl-config - mozillaï¼Œè¿™ä¸ªç½‘ç«™æä¾›ä¸‰ä¸ªå®‰å…¨ç­‰çº§çš„é…ç½®: ã€ŒIntermediateã€: æŸ¥çœ‹ç”Ÿæˆå‡ºçš„ ssl-cipher å±æ€§ï¼Œå‘ç°å®ƒåªæ”¯æŒ ECDHE/DHE å¼€å¤´çš„ç®—æ³•ã€‚å› æ­¤å®ƒä¿è¯å‰å‘ä¿å¯†ã€‚ å¯¹äºéœ€è¦é€šè¿‡æµè§ˆå™¨è®¿é—®çš„ APIï¼Œæ¨èé€‰æ‹©è¿™ä¸ªç­‰çº§ã€‚ ã€ŒModernã€: åªæ”¯æŒ TLSv1.3ï¼Œè¯¥åè®®åºŸå¼ƒæ‰äº†è¿‡å¾€æ‰€æœ‰ä¸å®‰å…¨çš„ç®—æ³•ï¼Œä¿è¯å‰å‘ä¿å¯†ï¼Œå®‰å…¨æ€§æé«˜ï¼Œæ€§èƒ½ä¹Ÿæ›´å¥½ã€‚ å¯¹äºä¸éœ€è¦é€šè¿‡æµè§ˆå™¨ç­‰æ—§ç»ˆç«¯è®¿é—®çš„ APIï¼Œè¯·ç›´æ¥é€‰æ‹©è¿™ä¸ªç­‰çº§ã€‚ ã€ŒOldã€: é™¤éä½ çš„ç”¨æˆ·ä½¿ç”¨éå¸¸è€çš„ç»ˆç«¯è¿›è¡Œè®¿é—®ï¼Œå¦åˆ™è¯·ä¸è¦è€ƒè™‘è¿™ä¸ªé€‰é¡¹ï¼ å¯ä»¥ç‚¹è¿›å»æŸ¥çœ‹è¯¦ç»†çš„ TLS å¥—ä»¶é…ç½®ã€‚ OCSP è¯ä¹¦éªŒè¯åè®® https://www.ssl.com/blogs/how-do-browsers-handle-revoked-ssl-tls-certificates/ https://imququ.com/post/why-can-not-turn-on-ocsp-stapling.html https://www.digicert.com/help/ å‰é¢æåˆ°é™¤äº†æ•°å­—è¯ä¹¦è‡ªå¸¦çš„æœ‰æ•ˆæœŸå¤–ï¼Œä¸ºäº†åœ¨ç§é’¥æ³„æ¼çš„æƒ…å†µä¸‹ï¼Œèƒ½å¤ŸåŠé”€å¯¹åº”çš„è¯ä¹¦ï¼ŒPKI å…¬é’¥åŸºç¡€è®¾æ–½è¿˜æä¾›äº† OCSPï¼ˆOnline Certificate Status Protocolï¼‰è¯ä¹¦çŠ¶æ€æŸ¥è¯¢åè®®ã€‚ è¿™å¯¼è‡´äº†ä¸€äº›é—®é¢˜ï¼š Chrome/Firefox ç­‰æµè§ˆå™¨éƒ½ä¼šå®šæœŸé€šè¿‡ OCSP åè®®å»è¯·æ±‚ CA æœºæ„çš„ OCSP æœåŠ¡å™¨éªŒè¯è¯ä¹¦çŠ¶æ€ï¼Œ è¿™å¯èƒ½ä¼šæ‹–æ…¢ HTTPS åè®®çš„å“åº”é€Ÿåº¦ã€‚ æ‰€è°“çš„å®šæœŸæ˜¯æŒ‡è¶…è¿‡ä¸Šä¸€ä¸ª OCSP å“åº”çš„ nextUpdate æ—¶é—´ï¼ˆä¸€èˆ¬ä¸º 7 å¤©ï¼‰ï¼Œæˆ–è€…å¦‚æœè¯¥å€¼ä¸ºç©ºçš„è¯ï¼ŒFirefox é»˜è®¤ 24h åä¼šé‡æ–°æŸ¥è¯¢ OCSP çŠ¶æ€ã€‚ å› ä¸ºå®¢æˆ·ç«¯ç›´æ¥å»è¯·æ±‚ CA æœºæ„çš„ OCSP åœ°å€è·å–è¯ä¹¦çŠ¶æ€ï¼Œè¿™å°±å¯¼è‡´ CA æœºæ„å¯ä»¥è·å–åˆ°ä¸€äº›å¯¹åº”ç«™ç‚¹çš„ç”¨æˆ·ä¿¡æ¯ï¼ˆIP åœ°å€ã€ç½‘ç»œçŠ¶æ€ç­‰ï¼‰ã€‚ ä¸ºäº†è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œrfc6066 å®šä¹‰äº† OCSP stapling åŠŸèƒ½ï¼Œå®ƒä½¿æœåŠ¡å™¨å¯ä»¥æå‰è®¿é—® OCSP è·å–è¯ä¹¦çŠ¶æ€ä¿¡æ¯å¹¶ç¼“å­˜åˆ°æœ¬åœ°ï¼ŒåŸºæœ¬ Nginx/Caddy ç­‰å„å¤§ Web æœåŠ¡å™¨æˆ–ç½‘å…³ï¼Œéƒ½æ”¯æŒ OCSP stapling åè®®ã€‚ åœ¨å®¢æˆ·ç«¯ä½¿ç”¨ TLS åè®®è®¿é—® HTTPS æœåŠ¡æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šç›´æ¥åœ¨æ¡æ‰‹é˜¶æ®µå°†ç¼“å­˜çš„ OCSP ä¿¡æ¯å‘é€ç»™å®¢æˆ·ç«¯ã€‚å› ä¸º OCSP ä¿¡æ¯ä¼šå¸¦æœ‰ CA è¯ä¹¦çš„ç­¾ååŠæœ‰æ•ˆæœŸï¼Œå®¢æˆ·ç«¯å¯ä»¥ç›´æ¥é€šè¿‡ç­¾åéªŒè¯ OCSP ä¿¡æ¯çš„çœŸå®æ€§ä¸æœ‰æ•ˆæ€§ï¼Œè¿™æ ·å°±é¿å…äº†å®¢æˆ·ç«¯è®¿é—® OCSP æœåŠ¡å™¨å¸¦æ¥çš„å¼€é”€ã€‚ è€Œå¦ä¸€ä¸ªæ–¹æ³•ï¼Œå°±æ˜¯é€‰ç”¨ ocsp æœåŠ¡å™¨åœ¨ç›®æ ‡ç”¨æˆ·åŒºåŸŸé€Ÿåº¦å¿«çš„ CA æœºæ„ç­¾å‘è¯ä¹¦ã€‚ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æµ‹è¯•ï¼Œç¡®è®¤ç«™ç‚¹æ˜¯å¦å¯ç”¨äº† ocsp stapling: conf $ openssl s_client -connect www.digicert.com:443 -servername www.digicert.com -status -tlsextdebug \u003c /dev/null 2\u003e\u00261 | grep -i \"OCSP response\" å¦‚æœè¾“å‡ºåŒ…å« OCSP Response Status: successful å°±è¯´æ˜ç«™ç‚¹æ”¯æŒ ocsp staplingï¼Œå¦‚æœè¾“å‡ºå†…å®¹ä¸º OCSP response: no response sent åˆ™è¯´æ˜ç«™ç‚¹ä¸æ”¯æŒocsp staplingã€‚ å®é™…ä¸Š Google/AWS ç­‰å¤§å¤šæ•°ç«™ç‚¹éƒ½ä¸ä¼šå¯ç”¨ä¹Ÿä¸éœ€è¦å¯ç”¨ ocsp staplingï¼Œä¸€æ˜¯å› ä¸ºå®ƒä»¬è‡ªå·±å°±æ˜¯è¯ä¹¦é¢å‘æœºæ„ï¼ŒOCSP æœåŠ¡å™¨ä¹Ÿå½’å®ƒä»¬è‡ªå·±ç®¡ï¼Œä¸å­˜åœ¨éšç§çš„é—®é¢˜ã€‚äºŒæ˜¯å®ƒä»¬çš„ OCSP æœåŠ¡å™¨éå¸ƒ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:4:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#alpn-åº”ç”¨å±‚åè®®åå•†"},{"categories":["tech"],"content":" 2. mTLS åŒå‘è®¤è¯TLS åè®®ï¼ˆtls1.0+ï¼ŒRFC:TLS1.2 - RFC5246ï¼‰ä¹Ÿå®šä¹‰äº†å¯é€‰çš„æœåŠ¡ç«¯è¯·æ±‚éªŒè¯å®¢æˆ·ç«¯è¯ä¹¦çš„æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯å¯é€‰çš„ã€‚å¦‚æœä½¿ç”¨ä¸Šè¿™ä¸ªæ–¹æ³•ï¼Œé‚£å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å°±ä¼šåœ¨ TLS åè®®çš„æ¡æ‰‹é˜¶æ®µè¿›è¡Œäº’ç›¸è®¤è¯ã€‚è¿™ç§éªŒè¯æ–¹å¼è¢«ç§°ä¸ºåŒå‘ TLS è®¤è¯(mTLS, mutual TLS)ã€‚ ä¼ ç»Ÿçš„ã€ŒTLS å•å‘è®¤è¯ã€æŠ€æœ¯ï¼Œåªåœ¨å®¢æˆ·ç«¯å»éªŒè¯æœåŠ¡ç«¯æ˜¯å¦å¯ä¿¡ã€‚è€Œã€ŒTLS åŒå‘è®¤è¯ï¼ˆmTLSï¼‰ã€ï¼Œåˆ™æ·»åŠ äº†æœåŠ¡ç«¯éªŒè¯å®¢æˆ·ç«¯æ˜¯å¦å¯ä¿¡çš„æ­¥éª¤ï¼ˆç¬¬ä¸‰æ­¥ï¼‰: å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚ ã€ŒéªŒè¯æœåŠ¡ç«¯æ˜¯å¦å¯ä¿¡ã€: æœåŠ¡ç«¯å°†è‡ªå·±çš„ TLS è¯ä¹¦å‘é€ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯é€šè¿‡è‡ªå·±çš„ CA è¯ä¹¦é“¾éªŒè¯è¿™ä¸ªæœåŠ¡ç«¯è¯ä¹¦ã€‚ ã€ŒéªŒè¯å®¢æˆ·ç«¯æ˜¯å¦å¯ä¿¡ã€: å®¢æˆ·ç«¯å°†è‡ªå·±çš„ TLS è¯ä¹¦å‘é€ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯ä½¿ç”¨å®ƒçš„ CA è¯ä¹¦é“¾éªŒè¯è¯¥å®¢æˆ·ç«¯è¯ä¹¦ã€‚ åå•†å¯¹ç§°åŠ å¯†ç®—æ³•åŠå¯†é’¥ ä½¿ç”¨å¯¹ç§°åŠ å¯†è¿›è¡Œåç»­é€šä¿¡ã€‚ å› ä¸ºç›¸æ¯”ä¼ ç»Ÿçš„ TLSï¼ŒmTLS åªæ˜¯æ·»åŠ äº†ã€ŒéªŒè¯å®¢æˆ·ç«¯ã€è¿™æ ·ä¸€ä¸ªæ­¥éª¤ï¼Œæ‰€ä»¥è¿™é¡¹æŠ€æœ¯ä¹Ÿè¢«ç§°ä¸ºã€ŒClient Authenticationã€. mTLS éœ€è¦ç”¨åˆ°ä¸¤å¥— TLS è¯ä¹¦: æœåŠ¡ç«¯è¯ä¹¦: è¿™ä¸ªè¯ä¹¦çš„å†…å®¹ä»¥åŠç”³è¯·æµç¨‹ï¼Œå‰é¢ä»‹ç»è¿‡äº†ã€‚ å®¢æˆ·ç«¯è¯ä¹¦: å®¢æˆ·ç«¯è¯ä¹¦è²Œä¼¼å¯¹è¯ä¹¦ä¿¡æ¯ï¼ˆå¦‚ CN/SAN åŸŸåï¼‰æ²¡æœ‰ä»»ä½•è¦æ±‚ï¼Œåªè¦è¯ä¹¦èƒ½é€šè¿‡æœåŠ¡ç«¯çš„ CA ç­¾åéªŒè¯å°±è¡Œã€‚ ä½¿ç”¨ openssl ç”Ÿæˆ TLS å®¢æˆ·ç«¯è¯ä¹¦ï¼ˆca å’Œ csr.conf å¯ä»¥ç›´æ¥ä½¿ç”¨å‰é¢ç”ŸæˆæœåŠ¡ç«¯è¯ä¹¦ç”¨åˆ°çš„ï¼Œä¹Ÿå¯ä»¥å¦å¤–ç”Ÿæˆï¼‰: shell # 1. ç”Ÿæˆ 2048 ä½ çš„ RSA å¯†é’¥ openssl genrsa -out client.key 2048 # 2. é€šè¿‡ç¬¬ä¸€æ­¥ç¼–å†™çš„é…ç½®æ–‡ä»¶ï¼Œç”Ÿæˆè¯ä¹¦ç­¾åè¯·æ±‚ openssl req -new -key client.key -out client.csr -config csr.conf # 3. ç”Ÿæˆæœ€ç»ˆçš„è¯ä¹¦ï¼Œè¿™é‡ŒæŒ‡å®šè¯ä¹¦æœ‰æ•ˆæœŸ 3650 å¤© ### ä½¿ç”¨å‰é¢ç”Ÿæˆçš„ ca è¯ä¹¦å¯¹å®¢æˆ·ç«¯è¯ä¹¦è¿›è¡Œç­¾åï¼ˆå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å…±ç”¨ ca è¯ä¹¦ï¼‰ openssl x509 -req -in client.csr -CA ca.crt -CAkey ca.key \\ -CAcreateserial -out client.crt -days 3650 \\ -extensions v3_ext -extfile csr.conf mTLS çš„åº”ç”¨åœºæ™¯ä¸»è¦åœ¨ã€Œé›¶ä¿¡ä»»ç½‘ç»œæ¶æ„ã€ï¼Œæˆ–è€…å«ã€Œæ— è¾¹ç•Œç½‘ç»œã€ä¸­ã€‚æ¯”å¦‚å¾®æœåŠ¡ä¹‹é—´çš„äº’ç›¸è®¿é—®ï¼Œå°±å¯ä»¥ä½¿ç”¨ mTLSã€‚è¿™æ ·å°±èƒ½ä¿è¯æ¯ä¸ª RPC è°ƒç”¨çš„å®¢æˆ·ç«¯ï¼Œéƒ½æ˜¯å…¶ä»–å¾®æœåŠ¡ï¼ˆæˆ–è€…åˆ«çš„å¯ä¿¡æ–¹ï¼‰ï¼Œ é˜²æ­¢é»‘å®¢å…¥ä¾µåä¸ºæ‰€æ¬²ä¸ºã€‚ ç›®å‰æŸ¥åˆ°å¦‚ä¸‹å‡ ä¸ªWebæœåŠ¡å™¨/ä»£ç†æ”¯æŒ mTLS: Traefik:Docs - Client Authentication (mTLS) Nginx:Using NGINX Reverse Proxy for client certificate authentication ä¸»è¦å‚æ•°æ˜¯ä¸¤ä¸ª: ssl_client_certificate /etc/nginx/client-ca.pem å’Œssl_verify_client on mTLS çš„å®‰å…¨æ€§å¦‚æœå°† mTLS ç”¨åœ¨ App å®‰å…¨ä¸Šï¼Œå­˜åœ¨çš„é£é™©æ˜¯: å®¢æˆ·ç«¯ä¸­éšè—çš„è¯ä¹¦æ˜¯å¦å¯ä»¥è¢«æå–å‡ºæ¥ï¼Œæˆ–è€…é»‘å®¢èƒ½å¦ Hook è¿› App ä¸­ï¼Œç›´æ¥ä½¿ç”¨è¯ä¹¦å‘é€ä¿¡æ¯ã€‚ å¦‚æœå®¢æˆ·ç«¯ç§é’¥è®¾ç½®äº†ã€Œå¯†ç ï¼ˆpassphraseï¼‰ã€ï¼Œé‚£è¿™ä¸ªå¯†ç æ˜¯å¦èƒ½å¾ˆå®¹æ˜“è¢«é€†å‘å‡ºæ¥ï¼Ÿ mTLS å’Œã€Œå…¬é’¥é”å®š/è¯ä¹¦é”å®šã€å¯¹æ¯”: å…¬é’¥é”å®š/è¯ä¹¦é”å®š: åªåœ¨å®¢æˆ·ç«¯è¿›è¡ŒéªŒè¯ã€‚ ä½†æ˜¯åœ¨æœåŠ¡ç«¯æ²¡æœ‰è¿›è¡ŒéªŒè¯ã€‚è¿™æ ·å°±æ— æ³•é‰´åˆ«å¹¶æ‹’ç»ç¬¬ä¸‰æ–¹åº”ç”¨ï¼ˆçˆ¬è™«ï¼‰çš„è¯·æ±‚ã€‚ åŠ å¼ºå®‰å…¨çš„æ–¹æ³•ï¼Œæ˜¯é€šè¿‡æŸç§ç®—æ³•ç”ŸæˆåŠ¨æ€çš„ç­¾åã€‚çˆ¬è™«ç”Ÿæˆä¸å‡ºæ¥è¿™ä¸ªç­¾åï¼Œè¯·æ±‚å°±è¢«æ‹’ç»ã€‚ mTLS: æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯éƒ½è¦éªŒè¯å¯¹æ–¹ã€‚ ä¿è¯åŒè¾¹å¯ä¿¡ï¼Œåœ¨å®¢æˆ·ç«¯è¯ä¹¦ä¸è¢«ç ´è§£çš„æƒ…å†µä¸‹ï¼Œå°±èƒ½ Ban æ‰æ‰€æœ‰çš„çˆ¬è™«æˆ–ä»£ç†æŠ€æœ¯ã€‚ ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:4:2","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#2-mtls-åŒå‘è®¤è¯"},{"categories":["tech"],"content":" 2. mTLS åŒå‘è®¤è¯TLS åè®®ï¼ˆtls1.0+ï¼ŒRFC:TLS1.2 - RFC5246ï¼‰ä¹Ÿå®šä¹‰äº†å¯é€‰çš„æœåŠ¡ç«¯è¯·æ±‚éªŒè¯å®¢æˆ·ç«¯è¯ä¹¦çš„æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯å¯é€‰çš„ã€‚å¦‚æœä½¿ç”¨ä¸Šè¿™ä¸ªæ–¹æ³•ï¼Œé‚£å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å°±ä¼šåœ¨ TLS åè®®çš„æ¡æ‰‹é˜¶æ®µè¿›è¡Œäº’ç›¸è®¤è¯ã€‚è¿™ç§éªŒè¯æ–¹å¼è¢«ç§°ä¸ºåŒå‘ TLS è®¤è¯(mTLS, mutual TLS)ã€‚ ä¼ ç»Ÿçš„ã€ŒTLS å•å‘è®¤è¯ã€æŠ€æœ¯ï¼Œåªåœ¨å®¢æˆ·ç«¯å»éªŒè¯æœåŠ¡ç«¯æ˜¯å¦å¯ä¿¡ã€‚è€Œã€ŒTLS åŒå‘è®¤è¯ï¼ˆmTLSï¼‰ã€ï¼Œåˆ™æ·»åŠ äº†æœåŠ¡ç«¯éªŒè¯å®¢æˆ·ç«¯æ˜¯å¦å¯ä¿¡çš„æ­¥éª¤ï¼ˆç¬¬ä¸‰æ­¥ï¼‰: å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚ ã€ŒéªŒè¯æœåŠ¡ç«¯æ˜¯å¦å¯ä¿¡ã€: æœåŠ¡ç«¯å°†è‡ªå·±çš„ TLS è¯ä¹¦å‘é€ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯é€šè¿‡è‡ªå·±çš„ CA è¯ä¹¦é“¾éªŒè¯è¿™ä¸ªæœåŠ¡ç«¯è¯ä¹¦ã€‚ ã€ŒéªŒè¯å®¢æˆ·ç«¯æ˜¯å¦å¯ä¿¡ã€: å®¢æˆ·ç«¯å°†è‡ªå·±çš„ TLS è¯ä¹¦å‘é€ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯ä½¿ç”¨å®ƒçš„ CA è¯ä¹¦é“¾éªŒè¯è¯¥å®¢æˆ·ç«¯è¯ä¹¦ã€‚ åå•†å¯¹ç§°åŠ å¯†ç®—æ³•åŠå¯†é’¥ ä½¿ç”¨å¯¹ç§°åŠ å¯†è¿›è¡Œåç»­é€šä¿¡ã€‚ å› ä¸ºç›¸æ¯”ä¼ ç»Ÿçš„ TLSï¼ŒmTLS åªæ˜¯æ·»åŠ äº†ã€ŒéªŒè¯å®¢æˆ·ç«¯ã€è¿™æ ·ä¸€ä¸ªæ­¥éª¤ï¼Œæ‰€ä»¥è¿™é¡¹æŠ€æœ¯ä¹Ÿè¢«ç§°ä¸ºã€ŒClient Authenticationã€. mTLS éœ€è¦ç”¨åˆ°ä¸¤å¥— TLS è¯ä¹¦: æœåŠ¡ç«¯è¯ä¹¦: è¿™ä¸ªè¯ä¹¦çš„å†…å®¹ä»¥åŠç”³è¯·æµç¨‹ï¼Œå‰é¢ä»‹ç»è¿‡äº†ã€‚ å®¢æˆ·ç«¯è¯ä¹¦: å®¢æˆ·ç«¯è¯ä¹¦è²Œä¼¼å¯¹è¯ä¹¦ä¿¡æ¯ï¼ˆå¦‚ CN/SAN åŸŸåï¼‰æ²¡æœ‰ä»»ä½•è¦æ±‚ï¼Œåªè¦è¯ä¹¦èƒ½é€šè¿‡æœåŠ¡ç«¯çš„ CA ç­¾åéªŒè¯å°±è¡Œã€‚ ä½¿ç”¨ openssl ç”Ÿæˆ TLS å®¢æˆ·ç«¯è¯ä¹¦ï¼ˆca å’Œ csr.conf å¯ä»¥ç›´æ¥ä½¿ç”¨å‰é¢ç”ŸæˆæœåŠ¡ç«¯è¯ä¹¦ç”¨åˆ°çš„ï¼Œä¹Ÿå¯ä»¥å¦å¤–ç”Ÿæˆï¼‰: shell # 1. ç”Ÿæˆ 2048 ä½ çš„ RSA å¯†é’¥ openssl genrsa -out client.key 2048 # 2. é€šè¿‡ç¬¬ä¸€æ­¥ç¼–å†™çš„é…ç½®æ–‡ä»¶ï¼Œç”Ÿæˆè¯ä¹¦ç­¾åè¯·æ±‚ openssl req -new -key client.key -out client.csr -config csr.conf # 3. ç”Ÿæˆæœ€ç»ˆçš„è¯ä¹¦ï¼Œè¿™é‡ŒæŒ‡å®šè¯ä¹¦æœ‰æ•ˆæœŸ 3650 å¤© ### ä½¿ç”¨å‰é¢ç”Ÿæˆçš„ ca è¯ä¹¦å¯¹å®¢æˆ·ç«¯è¯ä¹¦è¿›è¡Œç­¾åï¼ˆå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å…±ç”¨ ca è¯ä¹¦ï¼‰ openssl x509 -req -in client.csr -CA ca.crt -CAkey ca.key \\ -CAcreateserial -out client.crt -days 3650 \\ -extensions v3_ext -extfile csr.conf mTLS çš„åº”ç”¨åœºæ™¯ä¸»è¦åœ¨ã€Œé›¶ä¿¡ä»»ç½‘ç»œæ¶æ„ã€ï¼Œæˆ–è€…å«ã€Œæ— è¾¹ç•Œç½‘ç»œã€ä¸­ã€‚æ¯”å¦‚å¾®æœåŠ¡ä¹‹é—´çš„äº’ç›¸è®¿é—®ï¼Œå°±å¯ä»¥ä½¿ç”¨ mTLSã€‚è¿™æ ·å°±èƒ½ä¿è¯æ¯ä¸ª RPC è°ƒç”¨çš„å®¢æˆ·ç«¯ï¼Œéƒ½æ˜¯å…¶ä»–å¾®æœåŠ¡ï¼ˆæˆ–è€…åˆ«çš„å¯ä¿¡æ–¹ï¼‰ï¼Œ é˜²æ­¢é»‘å®¢å…¥ä¾µåä¸ºæ‰€æ¬²ä¸ºã€‚ ç›®å‰æŸ¥åˆ°å¦‚ä¸‹å‡ ä¸ªWebæœåŠ¡å™¨/ä»£ç†æ”¯æŒ mTLS: Traefik:Docs - Client Authentication (mTLS) Nginx:Using NGINX Reverse Proxy for client certificate authentication ä¸»è¦å‚æ•°æ˜¯ä¸¤ä¸ª: ssl_client_certificate /etc/nginx/client-ca.pem å’Œssl_verify_client on mTLS çš„å®‰å…¨æ€§å¦‚æœå°† mTLS ç”¨åœ¨ App å®‰å…¨ä¸Šï¼Œå­˜åœ¨çš„é£é™©æ˜¯: å®¢æˆ·ç«¯ä¸­éšè—çš„è¯ä¹¦æ˜¯å¦å¯ä»¥è¢«æå–å‡ºæ¥ï¼Œæˆ–è€…é»‘å®¢èƒ½å¦ Hook è¿› App ä¸­ï¼Œç›´æ¥ä½¿ç”¨è¯ä¹¦å‘é€ä¿¡æ¯ã€‚ å¦‚æœå®¢æˆ·ç«¯ç§é’¥è®¾ç½®äº†ã€Œå¯†ç ï¼ˆpassphraseï¼‰ã€ï¼Œé‚£è¿™ä¸ªå¯†ç æ˜¯å¦èƒ½å¾ˆå®¹æ˜“è¢«é€†å‘å‡ºæ¥ï¼Ÿ mTLS å’Œã€Œå…¬é’¥é”å®š/è¯ä¹¦é”å®šã€å¯¹æ¯”: å…¬é’¥é”å®š/è¯ä¹¦é”å®š: åªåœ¨å®¢æˆ·ç«¯è¿›è¡ŒéªŒè¯ã€‚ ä½†æ˜¯åœ¨æœåŠ¡ç«¯æ²¡æœ‰è¿›è¡ŒéªŒè¯ã€‚è¿™æ ·å°±æ— æ³•é‰´åˆ«å¹¶æ‹’ç»ç¬¬ä¸‰æ–¹åº”ç”¨ï¼ˆçˆ¬è™«ï¼‰çš„è¯·æ±‚ã€‚ åŠ å¼ºå®‰å…¨çš„æ–¹æ³•ï¼Œæ˜¯é€šè¿‡æŸç§ç®—æ³•ç”ŸæˆåŠ¨æ€çš„ç­¾åã€‚çˆ¬è™«ç”Ÿæˆä¸å‡ºæ¥è¿™ä¸ªç­¾åï¼Œè¯·æ±‚å°±è¢«æ‹’ç»ã€‚ mTLS: æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯éƒ½è¦éªŒè¯å¯¹æ–¹ã€‚ ä¿è¯åŒè¾¹å¯ä¿¡ï¼Œåœ¨å®¢æˆ·ç«¯è¯ä¹¦ä¸è¢«ç ´è§£çš„æƒ…å†µä¸‹ï¼Œå°±èƒ½ Ban æ‰æ‰€æœ‰çš„çˆ¬è™«æˆ–ä»£ç†æŠ€æœ¯ã€‚ ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:4:2","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#mtls-çš„å®‰å…¨æ€§"},{"categories":["tech"],"content":" 3. å…¶ä»–åŠ å¯†é€šè®¯åè®® SSH åè®®é¦–å…ˆæœ€å®¹æ˜“æƒ³åˆ°çš„åº”è¯¥å°±æ˜¯æ˜¯ SSH åè®®ï¼ˆSecure SHell protocolï¼‰ã€‚SSH ä¸ TLS ä¸€æ ·éƒ½èƒ½æä¾›åŠ å¯†é€šè®¯ï¼Œæ˜¯ PKI å…¬é’¥åŸºç¡€è®¾æ–½çš„æ—©æœŸå…ˆé©±è€…ä¹‹ä¸€ã€‚ SSH åè®®åº”ç”¨æœ€å¹¿æ³›çš„å®ç°æ˜¯ OpenSSHï¼Œå®ƒä½¿ç”¨ SSH Key è€Œéæ•°å­—è¯ä¹¦è¿›è¡Œèº«ä»½è®¤è¯ï¼Œè¿™ä¸»è¦æ˜¯å› ä¸º OpenSSH ä»…ç”¨äºç”¨æˆ·ä¸ä¸»æœºä¹‹é—´çš„å®‰å…¨é€šä¿¡ï¼Œä¸éœ€è¦è®°å½• X.509 è¿™ä¹ˆç¹å¤šçš„ä¿¡æ¯ã€‚ æˆ‘ä»¬æ¥æ‰‹åŠ¨ç”Ÿæˆä¸ª OpenSSH ed25519 å¯†é’¥å¯¹è¯•è¯•ï¼ˆRSA çš„ç”Ÿæˆå‘½ä»¤å®Œå…¨ç±»ä¼¼ï¼‰ï¼š shell â¯ ssh-keygen -t ed25519 Generating public/private ed25519 key pair. Enter file in which to save the key (/Users/admin/.ssh/id_ed25519): ed25519-key Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in ed25519-key. Your public key has been saved in ed25519-key.pub. The key fingerprint is: SHA256:jgeuWVflhNXXrDDzUtW6ZV1lpBWNAj0Rstizh9Lbyg0 admin@ryan-MacBook-Pro.local The key's randomart image is: +--[ED25519 256]--+ | oo++ *%| | o =B ++B| | . = oO.+o| | . B. + +| | . S = o. + | | . + o + . | | + + E . | | + o . + | | o o . | +----[SHA256]-----+ â¯ cat ed25519-key -----BEGIN OPENSSH PRIVATE KEY----- b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW QyNTUxOQAAACDux4KnrKXVs4iR9mPZnSpur5207ceyMiZP+CDnXdooMQAAAKDnHOSY5xzk mAAAAAtzc2gtZWQyNTUxOQAAACDux4KnrKXVs4iR9mPZnSpur5207ceyMiZP+CDnXdooMQ AAAEADkVL1gZHAvBx4M5+UjVVL7ltVOC4r9tdR23CoI9iV1O7HgqespdWziJH2Y9mdKm6v nbTtx7IyJk/4IOdd2igxAAAAHGFkbWluQHJ5YW4tTWFjQm9vay1Qcm8ubG9jYWwB -----END OPENSSH PRIVATE KEY----- â¯ cat ed25519-key.pub ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIO7HgqespdWziJH2Y9mdKm6vnbTtx7IyJk/4IOdd2igx admin@ryan-MacBook-Pro.local å¯ä»¥çœ‹åˆ° SSH Key çš„ç»“æ„éå¸¸ç®€å•ï¼Œä»…åŒ…å«å¦‚ä¸‹ä¸‰ä¸ªéƒ¨åˆ†ï¼š å¯†é’¥å¯¹ç±»å‹: æœ€å¸¸è§çš„æ˜¯ ssh-rsaï¼Œå¦å¤–ç”±äºå®‰å…¨æ€§ç›®å‰æ›´æ¨èä½¿ç”¨ ssh-ed25519 å…¬é’¥çš„ Base64 å­—ç¬¦ä¸² ä¸€ä¸ª Commentï¼Œé€šå¸¸åŒ…å«è¿™ä¸ª Key çš„ç”¨é€”ï¼Œæˆ–è€… Key æ‰€æœ‰è€…çš„é‚®ç®±åœ°å€ é€šè¿‡æˆ‘ä»¬å‰é¢å­¦çš„éå¯¹ç§°å¯†ç å­¦çŸ¥è¯†å¯ä»¥çŸ¥é“ï¼Œå…¬é’¥èƒ½ç›´æ¥ä»ç§é’¥ç”Ÿæˆï¼Œå‡è®¾ä½ çš„ ssh å…¬é’¥ä¸¢å¤±ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤é‡æ–°ç”Ÿæˆå‡ºå…¬é’¥ï¼š shell ssh-keygen -y -f xxx_rsa \u003e xxx_rsa.pub HTTP/3 ä¸ QUIC åè®®QUIC åè®®ï¼Œæ˜¯ Google ç ”å‘å¹¶æ¨åŠ¨æ ‡å‡†åŒ–çš„ TCP åè®®çš„æ›¿ä»£å“ï¼Œ QUIC æ˜¯åŸºäº UDP åè®®å®ç°çš„ã€‚åŸºäº QUIC æå‡ºçš„ HTTP over QUIC åè®®å·²è¢«æ ‡å‡†åŒ–ä¸ºRFC 9114 - HTTP/3ï¼Œå®ƒåšäº†å¾ˆå¤šå¤§åˆ€é˜”æ–§çš„æ”¹é©ï¼š ä¼ è¾“å±‚åè®®ä» TCP æ”¹æˆäº† UDPï¼ŒQUIC è‡ªå·±å®ç°çš„æ•°æ®çš„å¯é ä¼ è¾“ã€æŒ‰åºåˆ°è¾¾ã€æ‹¥å¡æ§åˆ¶ ä¹Ÿå°±æ˜¯è¯´ QUIC ç»•è¿‡äº†é™ˆæ—§çš„å†…æ ¸ TCP åè®®å®ç°ï¼Œç›´æ¥åœ¨ç”¨æˆ·ç©ºé—´å®ç°äº†è¿™äº›åŠŸèƒ½ é€šè¿‡å¦èµ·ç‚‰ç¶ï¼Œå®ƒè§£å†³äº†ä¸€äº› TCP åè®®çš„ç—›ç‚¹ï¼šé˜Ÿå¤´é˜»å¡ã€æ¡æ‰‹å»¶è¿Ÿé«˜ã€ç‰¹æ€§è¿­ä»£æ…¢ã€æ‹¥å¡æ§åˆ¶ç®—æ³•ä¸ä½³ç­‰é—®é¢˜ åœ¨ TLS1.3 å‡ºç°ä¹‹å‰ï¼ŒQUIC å®ç°äº†è‡ªå·±çš„åŠ å¯†æ–¹æ¡ˆQUIC Crypto ä»¥å–ä»£é™ˆæ—§çš„ TLS åè®®ï¼ŒåŒæ—¶å…¼å®¹ç°æœ‰çš„æ•°å­—è¯ä¹¦ä½“ç³» QUIC Crypto çš„ç‰¹ç‚¹æ˜¯å®ƒç›´æ¥åœ¨åº”ç”¨å±‚è¿›è¡ŒåŠ å¯†é€šè®¯çš„æ¡æ‰‹ï¼Œå¹¶ä¸”æ¢å¤é€šä¿¡æ—¶å¯ä»¥é€šè¿‡ç¼“å­˜å®ç° 0RTT æ¡æ‰‹ ä¹Ÿå°±è¯´ QUIC é€šè¿‡å¦èµ·ç‚‰ç¶ï¼Œè§£å†³äº† TLS çš„å®‰å…¨é—®é¢˜ï¼Œä»¥åŠæ¡æ‰‹å»¶è¿Ÿé«˜çš„é—®é¢˜ æ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼Œæ—§çš„å®éªŒæ€§ HTTP-over-QUIC åè®®ï¼Œé‡æ–°å®ç°äº† HTTP+TLS+TCP ä¸‰ç§åè®®å¹¶å°†å®ƒä»¬æ•´åˆåˆ°ä¸€èµ·ï¼Œè¿™å¸¦æ¥äº†æä½³çš„æ€§èƒ½ï¼Œä½†ä¹Ÿä½¿å®ƒå˜å¾—éå¸¸å¤æ‚ã€‚ QUIC çš„ 0RTT æ¡æ‰‹æ˜¯ä¸€ä¸ªéå¸¸å¦™çš„æƒ³æ³•ï¼Œå¯ä»¥æ˜¾è‘—é™ä½æ¡æ‰‹æ—¶å»¶ï¼ŒTLS1.3 çš„è®¾è®¡è€…ä»¬å°†å®ƒçº³å…¥äº† TLS1.3 æ ‡å‡†ä¸­ã€‚ ç”±äº TLS1.3 çš„è‰¯å¥½ç‰¹æ€§ï¼Œåœ¨ TLS1.3 åè®®å‘å¸ƒåï¼Œæ–°çš„ QUIC æ ‡å‡†RFC 9001 å·²ç»ä½¿ç”¨ TLS1.3 å–ä»£äº†å®éªŒé˜¶æ®µä½¿ç”¨çš„ QUIC Crypto åŠ å¯†æ–¹æ¡ˆï¼Œç›®å‰åªæœ‰ Chromium/Chrome ä»ç„¶æ”¯æŒ QUIC Cryptoï¼Œå…¶ä»– QUIC å®ç°åŸºæœ¬éƒ½åªæ”¯æŒ TLS1.3, è¯¦è§QUIC Implementations. ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:4:3","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#3-å…¶ä»–åŠ å¯†é€šè®¯åè®®"},{"categories":["tech"],"content":" 3. å…¶ä»–åŠ å¯†é€šè®¯åè®® SSH åè®®é¦–å…ˆæœ€å®¹æ˜“æƒ³åˆ°çš„åº”è¯¥å°±æ˜¯æ˜¯ SSH åè®®ï¼ˆSecure SHell protocolï¼‰ã€‚SSH ä¸ TLS ä¸€æ ·éƒ½èƒ½æä¾›åŠ å¯†é€šè®¯ï¼Œæ˜¯ PKI å…¬é’¥åŸºç¡€è®¾æ–½çš„æ—©æœŸå…ˆé©±è€…ä¹‹ä¸€ã€‚ SSH åè®®åº”ç”¨æœ€å¹¿æ³›çš„å®ç°æ˜¯ OpenSSHï¼Œå®ƒä½¿ç”¨ SSH Key è€Œéæ•°å­—è¯ä¹¦è¿›è¡Œèº«ä»½è®¤è¯ï¼Œè¿™ä¸»è¦æ˜¯å› ä¸º OpenSSH ä»…ç”¨äºç”¨æˆ·ä¸ä¸»æœºä¹‹é—´çš„å®‰å…¨é€šä¿¡ï¼Œä¸éœ€è¦è®°å½• X.509 è¿™ä¹ˆç¹å¤šçš„ä¿¡æ¯ã€‚ æˆ‘ä»¬æ¥æ‰‹åŠ¨ç”Ÿæˆä¸ª OpenSSH ed25519 å¯†é’¥å¯¹è¯•è¯•ï¼ˆRSA çš„ç”Ÿæˆå‘½ä»¤å®Œå…¨ç±»ä¼¼ï¼‰ï¼š shell â¯ ssh-keygen -t ed25519 Generating public/private ed25519 key pair. Enter file in which to save the key (/Users/admin/.ssh/id_ed25519): ed25519-key Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in ed25519-key. Your public key has been saved in ed25519-key.pub. The key fingerprint is: SHA256:jgeuWVflhNXXrDDzUtW6ZV1lpBWNAj0Rstizh9Lbyg0 admin@ryan-MacBook-Pro.local The key's randomart image is: +--[ED25519 256]--+ | oo++ *%| | o =B ++B| | . = oO.+o| | . B. + +| | . S = o. + | | . + o + . | | + + E . | | + o . + | | o o . | +----[SHA256]-----+ â¯ cat ed25519-key -----BEGIN OPENSSH PRIVATE KEY----- b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW QyNTUxOQAAACDux4KnrKXVs4iR9mPZnSpur5207ceyMiZP+CDnXdooMQAAAKDnHOSY5xzk mAAAAAtzc2gtZWQyNTUxOQAAACDux4KnrKXVs4iR9mPZnSpur5207ceyMiZP+CDnXdooMQ AAAEADkVL1gZHAvBx4M5+UjVVL7ltVOC4r9tdR23CoI9iV1O7HgqespdWziJH2Y9mdKm6v nbTtx7IyJk/4IOdd2igxAAAAHGFkbWluQHJ5YW4tTWFjQm9vay1Qcm8ubG9jYWwB -----END OPENSSH PRIVATE KEY----- â¯ cat ed25519-key.pub ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIO7HgqespdWziJH2Y9mdKm6vnbTtx7IyJk/4IOdd2igx admin@ryan-MacBook-Pro.local å¯ä»¥çœ‹åˆ° SSH Key çš„ç»“æ„éå¸¸ç®€å•ï¼Œä»…åŒ…å«å¦‚ä¸‹ä¸‰ä¸ªéƒ¨åˆ†ï¼š å¯†é’¥å¯¹ç±»å‹: æœ€å¸¸è§çš„æ˜¯ ssh-rsaï¼Œå¦å¤–ç”±äºå®‰å…¨æ€§ç›®å‰æ›´æ¨èä½¿ç”¨ ssh-ed25519 å…¬é’¥çš„ Base64 å­—ç¬¦ä¸² ä¸€ä¸ª Commentï¼Œé€šå¸¸åŒ…å«è¿™ä¸ª Key çš„ç”¨é€”ï¼Œæˆ–è€… Key æ‰€æœ‰è€…çš„é‚®ç®±åœ°å€ é€šè¿‡æˆ‘ä»¬å‰é¢å­¦çš„éå¯¹ç§°å¯†ç å­¦çŸ¥è¯†å¯ä»¥çŸ¥é“ï¼Œå…¬é’¥èƒ½ç›´æ¥ä»ç§é’¥ç”Ÿæˆï¼Œå‡è®¾ä½ çš„ ssh å…¬é’¥ä¸¢å¤±ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤é‡æ–°ç”Ÿæˆå‡ºå…¬é’¥ï¼š shell ssh-keygen -y -f xxx_rsa \u003e xxx_rsa.pub HTTP/3 ä¸ QUIC åè®®QUIC åè®®ï¼Œæ˜¯ Google ç ”å‘å¹¶æ¨åŠ¨æ ‡å‡†åŒ–çš„ TCP åè®®çš„æ›¿ä»£å“ï¼Œ QUIC æ˜¯åŸºäº UDP åè®®å®ç°çš„ã€‚åŸºäº QUIC æå‡ºçš„ HTTP over QUIC åè®®å·²è¢«æ ‡å‡†åŒ–ä¸ºRFC 9114 - HTTP/3ï¼Œå®ƒåšäº†å¾ˆå¤šå¤§åˆ€é˜”æ–§çš„æ”¹é©ï¼š ä¼ è¾“å±‚åè®®ä» TCP æ”¹æˆäº† UDPï¼ŒQUIC è‡ªå·±å®ç°çš„æ•°æ®çš„å¯é ä¼ è¾“ã€æŒ‰åºåˆ°è¾¾ã€æ‹¥å¡æ§åˆ¶ ä¹Ÿå°±æ˜¯è¯´ QUIC ç»•è¿‡äº†é™ˆæ—§çš„å†…æ ¸ TCP åè®®å®ç°ï¼Œç›´æ¥åœ¨ç”¨æˆ·ç©ºé—´å®ç°äº†è¿™äº›åŠŸèƒ½ é€šè¿‡å¦èµ·ç‚‰ç¶ï¼Œå®ƒè§£å†³äº†ä¸€äº› TCP åè®®çš„ç—›ç‚¹ï¼šé˜Ÿå¤´é˜»å¡ã€æ¡æ‰‹å»¶è¿Ÿé«˜ã€ç‰¹æ€§è¿­ä»£æ…¢ã€æ‹¥å¡æ§åˆ¶ç®—æ³•ä¸ä½³ç­‰é—®é¢˜ åœ¨ TLS1.3 å‡ºç°ä¹‹å‰ï¼ŒQUIC å®ç°äº†è‡ªå·±çš„åŠ å¯†æ–¹æ¡ˆQUIC Crypto ä»¥å–ä»£é™ˆæ—§çš„ TLS åè®®ï¼ŒåŒæ—¶å…¼å®¹ç°æœ‰çš„æ•°å­—è¯ä¹¦ä½“ç³» QUIC Crypto çš„ç‰¹ç‚¹æ˜¯å®ƒç›´æ¥åœ¨åº”ç”¨å±‚è¿›è¡ŒåŠ å¯†é€šè®¯çš„æ¡æ‰‹ï¼Œå¹¶ä¸”æ¢å¤é€šä¿¡æ—¶å¯ä»¥é€šè¿‡ç¼“å­˜å®ç° 0RTT æ¡æ‰‹ ä¹Ÿå°±è¯´ QUIC é€šè¿‡å¦èµ·ç‚‰ç¶ï¼Œè§£å†³äº† TLS çš„å®‰å…¨é—®é¢˜ï¼Œä»¥åŠæ¡æ‰‹å»¶è¿Ÿé«˜çš„é—®é¢˜ æ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼Œæ—§çš„å®éªŒæ€§ HTTP-over-QUIC åè®®ï¼Œé‡æ–°å®ç°äº† HTTP+TLS+TCP ä¸‰ç§åè®®å¹¶å°†å®ƒä»¬æ•´åˆåˆ°ä¸€èµ·ï¼Œè¿™å¸¦æ¥äº†æä½³çš„æ€§èƒ½ï¼Œä½†ä¹Ÿä½¿å®ƒå˜å¾—éå¸¸å¤æ‚ã€‚ QUIC çš„ 0RTT æ¡æ‰‹æ˜¯ä¸€ä¸ªéå¸¸å¦™çš„æƒ³æ³•ï¼Œå¯ä»¥æ˜¾è‘—é™ä½æ¡æ‰‹æ—¶å»¶ï¼ŒTLS1.3 çš„è®¾è®¡è€…ä»¬å°†å®ƒçº³å…¥äº† TLS1.3 æ ‡å‡†ä¸­ã€‚ ç”±äº TLS1.3 çš„è‰¯å¥½ç‰¹æ€§ï¼Œåœ¨ TLS1.3 åè®®å‘å¸ƒåï¼Œæ–°çš„ QUIC æ ‡å‡†RFC 9001 å·²ç»ä½¿ç”¨ TLS1.3 å–ä»£äº†å®éªŒé˜¶æ®µä½¿ç”¨çš„ QUIC Crypto åŠ å¯†æ–¹æ¡ˆï¼Œç›®å‰åªæœ‰ Chromium/Chrome ä»ç„¶æ”¯æŒ QUIC Cryptoï¼Œå…¶ä»– QUIC å®ç°åŸºæœ¬éƒ½åªæ”¯æŒ TLS1.3, è¯¦è§QUIC Implementations. ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:4:3","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#ssh-åè®®"},{"categories":["tech"],"content":" 3. å…¶ä»–åŠ å¯†é€šè®¯åè®® SSH åè®®é¦–å…ˆæœ€å®¹æ˜“æƒ³åˆ°çš„åº”è¯¥å°±æ˜¯æ˜¯ SSH åè®®ï¼ˆSecure SHell protocolï¼‰ã€‚SSH ä¸ TLS ä¸€æ ·éƒ½èƒ½æä¾›åŠ å¯†é€šè®¯ï¼Œæ˜¯ PKI å…¬é’¥åŸºç¡€è®¾æ–½çš„æ—©æœŸå…ˆé©±è€…ä¹‹ä¸€ã€‚ SSH åè®®åº”ç”¨æœ€å¹¿æ³›çš„å®ç°æ˜¯ OpenSSHï¼Œå®ƒä½¿ç”¨ SSH Key è€Œéæ•°å­—è¯ä¹¦è¿›è¡Œèº«ä»½è®¤è¯ï¼Œè¿™ä¸»è¦æ˜¯å› ä¸º OpenSSH ä»…ç”¨äºç”¨æˆ·ä¸ä¸»æœºä¹‹é—´çš„å®‰å…¨é€šä¿¡ï¼Œä¸éœ€è¦è®°å½• X.509 è¿™ä¹ˆç¹å¤šçš„ä¿¡æ¯ã€‚ æˆ‘ä»¬æ¥æ‰‹åŠ¨ç”Ÿæˆä¸ª OpenSSH ed25519 å¯†é’¥å¯¹è¯•è¯•ï¼ˆRSA çš„ç”Ÿæˆå‘½ä»¤å®Œå…¨ç±»ä¼¼ï¼‰ï¼š shell â¯ ssh-keygen -t ed25519 Generating public/private ed25519 key pair. Enter file in which to save the key (/Users/admin/.ssh/id_ed25519): ed25519-key Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in ed25519-key. Your public key has been saved in ed25519-key.pub. The key fingerprint is: SHA256:jgeuWVflhNXXrDDzUtW6ZV1lpBWNAj0Rstizh9Lbyg0 admin@ryan-MacBook-Pro.local The key's randomart image is: +--[ED25519 256]--+ | oo++ *%| | o =B ++B| | . = oO.+o| | . B. + +| | . S = o. + | | . + o + . | | + + E . | | + o . + | | o o . | +----[SHA256]-----+ â¯ cat ed25519-key -----BEGIN OPENSSH PRIVATE KEY----- b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW QyNTUxOQAAACDux4KnrKXVs4iR9mPZnSpur5207ceyMiZP+CDnXdooMQAAAKDnHOSY5xzk mAAAAAtzc2gtZWQyNTUxOQAAACDux4KnrKXVs4iR9mPZnSpur5207ceyMiZP+CDnXdooMQ AAAEADkVL1gZHAvBx4M5+UjVVL7ltVOC4r9tdR23CoI9iV1O7HgqespdWziJH2Y9mdKm6v nbTtx7IyJk/4IOdd2igxAAAAHGFkbWluQHJ5YW4tTWFjQm9vay1Qcm8ubG9jYWwB -----END OPENSSH PRIVATE KEY----- â¯ cat ed25519-key.pub ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIO7HgqespdWziJH2Y9mdKm6vnbTtx7IyJk/4IOdd2igx admin@ryan-MacBook-Pro.local å¯ä»¥çœ‹åˆ° SSH Key çš„ç»“æ„éå¸¸ç®€å•ï¼Œä»…åŒ…å«å¦‚ä¸‹ä¸‰ä¸ªéƒ¨åˆ†ï¼š å¯†é’¥å¯¹ç±»å‹: æœ€å¸¸è§çš„æ˜¯ ssh-rsaï¼Œå¦å¤–ç”±äºå®‰å…¨æ€§ç›®å‰æ›´æ¨èä½¿ç”¨ ssh-ed25519 å…¬é’¥çš„ Base64 å­—ç¬¦ä¸² ä¸€ä¸ª Commentï¼Œé€šå¸¸åŒ…å«è¿™ä¸ª Key çš„ç”¨é€”ï¼Œæˆ–è€… Key æ‰€æœ‰è€…çš„é‚®ç®±åœ°å€ é€šè¿‡æˆ‘ä»¬å‰é¢å­¦çš„éå¯¹ç§°å¯†ç å­¦çŸ¥è¯†å¯ä»¥çŸ¥é“ï¼Œå…¬é’¥èƒ½ç›´æ¥ä»ç§é’¥ç”Ÿæˆï¼Œå‡è®¾ä½ çš„ ssh å…¬é’¥ä¸¢å¤±ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤é‡æ–°ç”Ÿæˆå‡ºå…¬é’¥ï¼š shell ssh-keygen -y -f xxx_rsa \u003e xxx_rsa.pub HTTP/3 ä¸ QUIC åè®®QUIC åè®®ï¼Œæ˜¯ Google ç ”å‘å¹¶æ¨åŠ¨æ ‡å‡†åŒ–çš„ TCP åè®®çš„æ›¿ä»£å“ï¼Œ QUIC æ˜¯åŸºäº UDP åè®®å®ç°çš„ã€‚åŸºäº QUIC æå‡ºçš„ HTTP over QUIC åè®®å·²è¢«æ ‡å‡†åŒ–ä¸ºRFC 9114 - HTTP/3ï¼Œå®ƒåšäº†å¾ˆå¤šå¤§åˆ€é˜”æ–§çš„æ”¹é©ï¼š ä¼ è¾“å±‚åè®®ä» TCP æ”¹æˆäº† UDPï¼ŒQUIC è‡ªå·±å®ç°çš„æ•°æ®çš„å¯é ä¼ è¾“ã€æŒ‰åºåˆ°è¾¾ã€æ‹¥å¡æ§åˆ¶ ä¹Ÿå°±æ˜¯è¯´ QUIC ç»•è¿‡äº†é™ˆæ—§çš„å†…æ ¸ TCP åè®®å®ç°ï¼Œç›´æ¥åœ¨ç”¨æˆ·ç©ºé—´å®ç°äº†è¿™äº›åŠŸèƒ½ é€šè¿‡å¦èµ·ç‚‰ç¶ï¼Œå®ƒè§£å†³äº†ä¸€äº› TCP åè®®çš„ç—›ç‚¹ï¼šé˜Ÿå¤´é˜»å¡ã€æ¡æ‰‹å»¶è¿Ÿé«˜ã€ç‰¹æ€§è¿­ä»£æ…¢ã€æ‹¥å¡æ§åˆ¶ç®—æ³•ä¸ä½³ç­‰é—®é¢˜ åœ¨ TLS1.3 å‡ºç°ä¹‹å‰ï¼ŒQUIC å®ç°äº†è‡ªå·±çš„åŠ å¯†æ–¹æ¡ˆQUIC Crypto ä»¥å–ä»£é™ˆæ—§çš„ TLS åè®®ï¼ŒåŒæ—¶å…¼å®¹ç°æœ‰çš„æ•°å­—è¯ä¹¦ä½“ç³» QUIC Crypto çš„ç‰¹ç‚¹æ˜¯å®ƒç›´æ¥åœ¨åº”ç”¨å±‚è¿›è¡ŒåŠ å¯†é€šè®¯çš„æ¡æ‰‹ï¼Œå¹¶ä¸”æ¢å¤é€šä¿¡æ—¶å¯ä»¥é€šè¿‡ç¼“å­˜å®ç° 0RTT æ¡æ‰‹ ä¹Ÿå°±è¯´ QUIC é€šè¿‡å¦èµ·ç‚‰ç¶ï¼Œè§£å†³äº† TLS çš„å®‰å…¨é—®é¢˜ï¼Œä»¥åŠæ¡æ‰‹å»¶è¿Ÿé«˜çš„é—®é¢˜ æ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼Œæ—§çš„å®éªŒæ€§ HTTP-over-QUIC åè®®ï¼Œé‡æ–°å®ç°äº† HTTP+TLS+TCP ä¸‰ç§åè®®å¹¶å°†å®ƒä»¬æ•´åˆåˆ°ä¸€èµ·ï¼Œè¿™å¸¦æ¥äº†æä½³çš„æ€§èƒ½ï¼Œä½†ä¹Ÿä½¿å®ƒå˜å¾—éå¸¸å¤æ‚ã€‚ QUIC çš„ 0RTT æ¡æ‰‹æ˜¯ä¸€ä¸ªéå¸¸å¦™çš„æƒ³æ³•ï¼Œå¯ä»¥æ˜¾è‘—é™ä½æ¡æ‰‹æ—¶å»¶ï¼ŒTLS1.3 çš„è®¾è®¡è€…ä»¬å°†å®ƒçº³å…¥äº† TLS1.3 æ ‡å‡†ä¸­ã€‚ ç”±äº TLS1.3 çš„è‰¯å¥½ç‰¹æ€§ï¼Œåœ¨ TLS1.3 åè®®å‘å¸ƒåï¼Œæ–°çš„ QUIC æ ‡å‡†RFC 9001 å·²ç»ä½¿ç”¨ TLS1.3 å–ä»£äº†å®éªŒé˜¶æ®µä½¿ç”¨çš„ QUIC Crypto åŠ å¯†æ–¹æ¡ˆï¼Œç›®å‰åªæœ‰ Chromium/Chrome ä»ç„¶æ”¯æŒ QUIC Cryptoï¼Œå…¶ä»– QUIC å®ç°åŸºæœ¬éƒ½åªæ”¯æŒ TLS1.3, è¯¦è§QUIC Implementations. ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:4:3","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#http3-ä¸-quic-åè®®"},{"categories":["tech"],"content":" 4. TLS åè®®æ”»é˜²æˆ˜è™½ç„¶ TLS åè®®æ˜¯ä¸€ä¸ªå®‰å…¨çš„åŠ å¯†åè®®ï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“å‘whistle / charles / fiddler ç­‰ä»£ç†è°ƒè¯•å·¥å…·ã€ä»¥åŠæ·±ä¿¡æœçš„ä¼ä¸šå‘˜å·¥æµé‡ç›‘æµ‹å·¥å…·ï¼Œéƒ½èƒ½å®ç°å¯¹ HTTPS æµé‡çš„ç›‘å¬ã€‚ å…¶åŸç†æ˜¯è¿™äº›ä»£ç†å·¥å…·ä¼šåœ¨å¯åŠ¨æ—¶é¦–å…ˆè¦æ±‚å°†å®ƒè‡ªå·±çš„ç§æœ‰ CA è¯ä¹¦æ·»åŠ åˆ°ç³»ç»Ÿè¯ä¹¦ä¸­ï¼Œè¿™æ ·å®¢æˆ·ç«¯ ï¼ˆæ‰‹æœº APP / æµè§ˆå™¨ç­‰åº”ç”¨ï¼‰åœ¨å»ºç«‹ TLS è¿æ¥æ—¶ä¼šè¢«ä»£ç†å·¥å…·æ‹¦æˆªï¼Œä»£ç†å·¥å…·è¿”å›ä¸€ä¸ªå®ƒä¼ªé€ çš„è¯ä¹¦ï¼Œè¯¥è¯ä¹¦ä¼šåŒ¹é…ä¸Šä¸Šä¸€æ­¥æå‰æ·»åŠ åˆ°ç³»ç»Ÿä¸­çš„ CA è¯ä¹¦ä»è€ŒæˆåŠŸå»ºç«‹è¿æ¥ã€‚åç»­å†ç”±ä»£ç†å·¥å…·å°†è¯·æ±‚è½¬å‘ç»™çœŸæ­£çš„æœåŠ¡ç«¯ï¼Œè¿™æ ·ä»£ç†å·¥å…·å°±èƒ½å®ç°å¯¹ HTTPS æµé‡çš„ç›‘å¬ã€‚ è¿™å®è´¨æ˜¯ä¸€æ¬¡ä¸­ç»§æ”»å‡»ï¼Œå…¶ä¸­æœ€å…³é”®çš„ä¸€æ­¥å°±æ˜¯ï¼Œå®ƒéœ€è¦åœ¨å®¢æˆ·ç«¯ç³»ç»Ÿä¸Šæ·»åŠ è‡ªå·±çš„ CA è¯ä¹¦ï¼Œè¿™æ ·å®¢æˆ·ç«¯å°±ä¼šä¿¡ä»»å®ƒä¼ªé€ çš„è¯ä¹¦ã€‚ è¯»è€…å¦‚æœè¯»åˆ°äº†è¿™é‡Œï¼Œå»ºè®®æ£€æŸ¥ä¸€ä¸‹è‡ªå·±ç³»ç»Ÿä¸­çš„è¯ä¹¦åˆ—è¡¨ï¼Œçœ‹çœ‹æ˜¯å¦æœ‰è¿™ç±»è¢«æ’å…¥çš„æ¶æ„è¯ä¹¦ï¼Œè‡ªå·±æµé‡è¢«ç›‘å¬äº†è€Œä¸è‡ªçŸ¥ã€‚ æ—¢ç„¶æœ‰æ”»å‡»æ‰‹æ®µï¼Œé‚£å°±æœ‰é˜²å¾¡æ‰‹æ®µï¼Œè®¸å¤šå¤§å‚çš„ APP éƒ½ä¼šä½¿ç”¨ä¸€äº›æŠ€æœ¯æ¥é˜²æ­¢è‡ªå·±çš„æµé‡è¢«ç›‘å¬ï¼Œä¸‹é¢ä»‹ç»å‡ ç§å¸¸è§çš„é˜²å¾¡æ‰‹æ®µã€‚ 1. è¯ä¹¦é”å®šï¼ˆCertificate Piningï¼‰æŠ€æœ¯å³ä½¿ä½¿ç”¨äº† TLS åè®®å¯¹æµé‡è¿›è¡ŒåŠ å¯†ï¼Œå¹¶ä¸”ä¿è¯äº†å‰å‘ä¿å¯†ï¼Œä¹Ÿæ— æ³•ä¿è¯æµé‡ä¸è¢«ä»£ç†ï¼ è¿™æ˜¯å› ä¸ºå®¢æˆ·ç«¯å¤§å¤šæ˜¯ç›´æ¥ä¾é äº†æ“ä½œç³»ç»Ÿå†…ç½®çš„ CA è¯ä¹¦åº“è¿›è¡Œè¯ä¹¦éªŒè¯ï¼Œè€Œ Fiddler ç­‰ä»£ç†å·¥å…·å¯ä»¥å°†è‡ªå·±çš„ CA è¯ä¹¦æ·»åŠ åˆ°è¯¥è¯ä¹¦åº“ä¸­ã€‚ ä¸ºäº†é˜²æ­¢æµé‡è¢« Fiddler ç­‰å·¥å…·ä½¿ç”¨ä¸Šè¿°æ–¹å¼ç›‘å¬æµé‡ï¼Œå‡ºç°äº†ã€Œè¯ä¹¦é”å®šï¼ˆCertificate Pining, æˆ–è€… SSL Pinningï¼‰ã€æŠ€æœ¯ã€‚æ–¹æ³•æ˜¯åœ¨å®¢æˆ·ç«¯ä¸­ç¡¬ç¼–ç è¯ä¹¦çš„æŒ‡çº¹ï¼ˆHashå€¼ï¼Œæˆ–è€…ç›´æ¥ä¿å­˜æ•´ä¸ªè¯ä¹¦çš„å†…å®¹ä¹Ÿè¡Œï¼‰ï¼Œåœ¨å»ºç«‹ TLS è¿æ¥å‰ï¼Œå…ˆè®¡ç®—ä½¿ç”¨çš„è¯ä¹¦çš„æŒ‡çº¹æ˜¯å¦åŒ¹é…ï¼Œå¦åˆ™å°±ä¸­æ–­è¿æ¥ã€‚ è¿™ç§é”å®šæ–¹å¼éœ€è¦ä»¥ä¸‹å‡ ä¸ªå‰ææ‰èƒ½ç¡®ä¿æµé‡ä¸è¢«ç›‘å¬: å®¢æˆ·ç«¯ä¸­ç¡¬ç¼–ç çš„è¯ä¹¦æŒ‡çº¹ä¸ä¼šè¢«ç¯¡æ”¹ã€‚ æŒ‡çº¹éªŒè¯ä¸èƒ½è¢«ç»•è¿‡ã€‚ ç›®å‰æœ‰å…¬å¼€æŠ€æœ¯ï¼ˆXPosed+JustTrustMeï¼‰èƒ½ç ´è§£ Android ä¸Šå¸¸è§çš„ HTTPS è¯·æ±‚åº“ï¼Œç›´æ¥ç»•è¿‡è¯ä¹¦æ£€æŸ¥ã€‚ é’ˆå¯¹ä¸Šè¿°é—®é¢˜ï¼Œå¯ä»¥è€ƒè™‘åŠ å¤§ç»•è¿‡çš„éš¾åº¦ã€‚æˆ–è€… App æ£€æµ‹è‡ªå·±æ˜¯å¦è¿è¡Œåœ¨ Xposed ç­‰è™šæ‹Ÿç¯å¢ƒä¸‹ã€‚ ç”¨äº TLS åè®®çš„è¯ä¹¦ä¸ä¼šé¢‘ç¹æ›´æ¢ã€‚ï¼ˆå¦‚æœæ›´æ¢äº†ï¼ŒæŒ‡çº¹å°±å¯¹ä¸ä¸Šäº†ã€‚ï¼‰ è€Œå¯¹äºç¬¬ä¸‰æ–¹çš„ APIï¼Œå› ä¸ºæˆ‘ä»¬ä¸çŸ¥é“å®ƒä»¬ä¼šä¸ä¼šæ›´æ¢ TLS è¯ä¹¦ï¼Œå°±ä¸èƒ½ç›´æ¥å°†è¯ä¹¦æŒ‡çº¹ç¡¬ç¼–ç åœ¨å®¢æˆ·ç«¯ä¸­ã€‚è¿™æ—¶å¯ä»¥è€ƒè™‘ä»æœåŠ¡ç«¯è·å–è¿™äº› API çš„è¯ä¹¦æŒ‡çº¹ï¼ˆé™„å¸¦ç§é’¥ç­¾åç”¨äºé˜²ä¼ªé€ ï¼‰ã€‚ ä¸ºäº†å®ç°è¯ä¹¦çš„è½®è½¬(rotation)ï¼Œå¯ä»¥åœ¨æ–°ç‰ˆæœ¬çš„å®¢æˆ·ç«¯ä¸­åŒ…å«å¤šä¸ªè¯ä¹¦æŒ‡çº¹ï¼Œè¿™æ ·èƒ½ä¿è¯åŒæ—¶æœ‰å¤šä¸ªå¯ä¿¡è¯ä¹¦ï¼Œè¾¾æˆè¯ä¹¦çš„è½®è½¬ã€‚ï¼ˆç±»æ¯” JWT çš„å…¬é’¥è½®è½¬æœºåˆ¶ï¼‰ è¯ä¹¦é”å®šæŠ€æœ¯å‡ ä¹ç­‰åŒäº SSH åè®®çš„ StrictHostKeyChecking é€‰é¡¹ï¼Œå®¢æˆ·ç«¯ä¼šéªŒè¯æœåŠ¡ç«¯çš„å…¬é’¥æŒ‡çº¹ï¼ˆkey fingerprintï¼‰ï¼ŒéªŒè¯ä¸é€šè¿‡åˆ™æ–­å¼€è¿æ¥ã€‚ 2. å…¬é’¥é”å®šï¼ˆPublic Key Piningï¼‰æŠ€æœ¯å‰é¢ä»‹ç»è¿‡è¯ä¹¦çš„ç»“æ„ï¼Œå®ƒå…¶å®åŒ…å«äº†å…¬é’¥ã€æœ‰æ•ˆæœŸä¸ä¸€ç³»åˆ—çš„å…¶ä»–ä¿¡æ¯ã€‚ä½¿ç”¨äº†è¯ä¹¦é”å®šæŠ€æœ¯ï¼Œä¼šå¯¼è‡´è¯ä¹¦çš„æœ‰æ•ˆæœŸä¹Ÿè¢«é”å®šï¼ŒAPK å†…çš„è¯ä¹¦æŒ‡çº¹å°±å¿…é¡»éšç€è¯ä¹¦ä¸€èµ·æ›´æ–°ã€‚ æ›´å¥½çš„åšæ³•æ˜¯ä»…é”å®šè¯ä¹¦ä¸­çš„å…¬é’¥ï¼Œå³ã€Œå…¬é’¥é”å®šã€æŠ€æœ¯ã€‚ã€Œå…¬é’¥é”å®šã€æ¯”ã€Œè¯ä¹¦é”å®šã€æ›´çµæ´»ï¼Œè¿™æ ·è¯ä¹¦æœ¬èº«å…¶å®å°±å¯ä»¥ç›´æ¥è½®è½¬äº†ï¼ˆè¯ä¹¦æœ‰è¿‡æœŸæ—¶é—´ï¼‰ï¼Œè€Œä¸éœ€è¦ä¸€ä¸ªæ—§è¯ä¹¦å’Œæ–°è¯ä¹¦å…±å­˜çš„ä¸­é—´æ—¶æœŸã€‚ ã€Œå…¬é’¥é”å®šã€æ˜¯æ›´æ¨èçš„é”å®šæŠ€æœ¯ã€‚ 3. HTTPS ä¸¥æ ¼ä¼ è¾“å®‰å…¨ - HSTSHSTSï¼Œå³ HTTP Strict Transport Securityï¼Œæ˜¯ä¸€é¡¹å®‰å…¨æŠ€æœ¯ï¼Œå®ƒå…è®¸æœåŠ¡ç«¯åœ¨è¿”å› HTTPS å“åº”æ—¶ï¼Œ é€šè¿‡ Headers æ˜ç¡®è¦æ±‚å®¢æˆ·ç«¯ï¼Œåœ¨ä¹‹åçš„ä¸€æ®µæ—¶é—´å†…å¿…é¡»ä½¿ç”¨å®‰å…¨çš„ HTTPS åè®®è®¿é—®æœåŠ¡ç«¯ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ç«™ç‚¹ https://example.com/ çš„å“åº”å¤´ä¸­æœ‰Strict-Transport-Security: max-age=31536000; includeSubDomainsï¼Œè¿™è¡¨ç¤ºæœåŠ¡ç«¯è¦æ±‚å®¢æˆ·ç«¯ ï¼ˆæ¯”å¦‚æµè§ˆå™¨ï¼‰ï¼š åœ¨æ¥ä¸‹æ¥çš„ 31536000 ç§’ï¼ˆå³ä¸€å¹´ï¼‰ä¸­ï¼Œå®¢æˆ·ç«¯å‘ example.com æˆ–å…¶å­åŸŸåå‘é€ HTTP è¯·æ±‚æ—¶ï¼Œå¿…é¡»é‡‡ç”¨HTTPSæ¥å‘èµ·è¿æ¥ã€‚ æ¯”å¦‚ç”¨æˆ·åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥ http://example.com/ æ—¶ï¼Œæµè§ˆå™¨åº”è‡ªåŠ¨å°† http æ”¹å†™ä¸º https å†å‘èµ·è¯·æ±‚ åœ¨æ¥ä¸‹æ¥çš„ 31536000 ç§’ï¼ˆå³ä¸€å¹´ï¼‰ä¸­ï¼Œå¦‚æœ example.com æœåŠ¡å™¨æä¾›çš„è¯ä¹¦æ— æ•ˆï¼Œç”¨æˆ·ä¸èƒ½å¿½ç•¥æµè§ˆå™¨çš„è¯ä¹¦è­¦å‘Šç»§ç»­è®¿é—®ç½‘ç«™ã€‚ ä¹Ÿå°±æ˜¯è¯´ä¸€æ—¦è¯ä¹¦å¤±æ•ˆï¼Œç«™ç‚¹å°†å®Œå…¨æ— æ³•è®¿é—®ï¼Œç›´è‡³æœåŠ¡ç«¯ä¿®å¤è¯ä¹¦é—®é¢˜ã€‚ ä¸€æ—¦è¯ä¹¦å¤±æ•ˆï¼ŒHTTPS å…¶å®å°±ä¸æ˜¯ä¸¥æ ¼å®‰å…¨çš„äº†ï¼Œå¯èƒ½ä¼šé­é‡ä¸­é—´äººæ”»å‡»ã€‚ä¹Ÿå°±æ˜¯è¯´ HSTS é€šè¿‡ç‰ºç‰²ç«™ç‚¹çš„å¯è®¿é—®æ€§æ¥é¿å…ä¸­é—´äººæ”»å‡»ã€‚ 4. TLS åè®®çš„é€†å‘æ‰‹æ®µè¦è·å–ä¸€ä¸ªåº”ç”¨çš„ HTTPS æ•°æ®ï¼Œæœ‰ä¸¤ä¸ªæ–¹å‘: æœåŠ¡ç«¯å…¥ä¾µ: ç°ä»£åº”ç”¨çš„æœåŠ¡ç«¯çªç ´éš¾åº¦é€šå¸¸éƒ½æ¯”è¾ƒå®¢æˆ·ç«¯é«˜ï¼Œæ³¨å…¥ç­‰æ¼æ´åº•å±‚æ¡†æ¶å°±æœ‰å¤„ç†ã€‚ ä¸è¿‡å¦‚æœä½ è·å¾—äº†æœåŠ¡å™¨ root æƒé™ï¼Œå¯ä»¥åœ¨ openssl ä¸Šåšæ–‡ç« ï¼Œæ¯”å¦‚ç¯¡æ”¹ opensslï¼Ÿ å®¢æˆ·ç«¯é€†å‘+çˆ¬è™«: å®¢æˆ·ç«¯æ˜¯ç¦»ç”¨æˆ·æœ€è¿‘çš„åœ°æ–¹ï¼Œä¹Ÿæ˜¯æœ€å®¹æ˜“è¢«çªç ´çš„åœ°æ–¹ã€‚ æ–¹æ³•ä¸€åœ¨å‰é¢ä»‹ç»è¿‡äº†ï¼Œå°±æ˜¯åœ¨å®¢æˆ·ç«¯ç³»ç»Ÿä¸­æå‰å®‰è£…ç§æœ‰ CA è¯ä¹¦ï¼Œå†é€šè¿‡ä»£ç†å·¥å…·è¿›è¡Œç›‘å¬ï¼Œè¿™ç§æ–¹æ³•èƒ½ç›‘å¬åˆ°æ‰€æœ‰æ™®é€š HTTP æµé‡ã€‚ å®‰å“ä¸Šå¯ä»¥é€šè¿‡ XPosed+JustTrustMe ç­‰æŠ€æœ¯ï¼Œç›´æ¥ Hook åº•å±‚ HTTP åº“ç»•è¿‡è¯ä¹¦æ£€æŸ¥ï¼Œå®ç°ç›‘å¬ HTTPS æµé‡ã€‚è¿™ç§æ–¹æ³•çš„ç¼ºç‚¹æ˜¯åªèƒ½ç›‘å¬é€‚é…çš„åº“ï¼Œæ‰€ä»¥ä»¥å‰æœ‰äººè¯´ flutter åº”ç”¨å®‰å…¨æ€§å¥½ï¼Œå› ä¸ºå®ƒæ¯”è¾ƒæ–°é²œï¼Œé€†å‘èµ„æ–™å°‘ï¼Œé€†å‘éš¾åº¦å°±é«˜ã€‚ å¯¹ mTLS è¿™ç±»æ›´å®‰å…¨çš„åè®®ï¼Œä¼šæ›´å¤æ‚äº›ã€‚ æˆ‘è§è¿‡çš„ç ´è§£æ‰‹æ®µä¹‹ä¸€ï¼šæ‰¾åˆ°è€ç‰ˆæœ¬çš„å®‰è£…åŒ…ï¼Œå‘ç°å¾ˆå®¹æ˜“å°±èƒ½æå–å‡ºå®¢æˆ·ç«¯è¯ä¹¦â€¦ wiki åˆ—å‡ºäº†ä¸€äº› TLS åè®®çš„å®‰å…¨é—®é¢˜ï¼šhttps://en.wikipedia.org/wiki/Transport_Layer_Security#Security TO BE DONEâ€¦ ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:4:4","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#4-tls-åè®®æ”»é˜²æˆ˜"},{"categories":["tech"],"content":" 4. TLS åè®®æ”»é˜²æˆ˜è™½ç„¶ TLS åè®®æ˜¯ä¸€ä¸ªå®‰å…¨çš„åŠ å¯†åè®®ï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“å‘whistle / charles / fiddler ç­‰ä»£ç†è°ƒè¯•å·¥å…·ã€ä»¥åŠæ·±ä¿¡æœçš„ä¼ä¸šå‘˜å·¥æµé‡ç›‘æµ‹å·¥å…·ï¼Œéƒ½èƒ½å®ç°å¯¹ HTTPS æµé‡çš„ç›‘å¬ã€‚ å…¶åŸç†æ˜¯è¿™äº›ä»£ç†å·¥å…·ä¼šåœ¨å¯åŠ¨æ—¶é¦–å…ˆè¦æ±‚å°†å®ƒè‡ªå·±çš„ç§æœ‰ CA è¯ä¹¦æ·»åŠ åˆ°ç³»ç»Ÿè¯ä¹¦ä¸­ï¼Œè¿™æ ·å®¢æˆ·ç«¯ ï¼ˆæ‰‹æœº APP / æµè§ˆå™¨ç­‰åº”ç”¨ï¼‰åœ¨å»ºç«‹ TLS è¿æ¥æ—¶ä¼šè¢«ä»£ç†å·¥å…·æ‹¦æˆªï¼Œä»£ç†å·¥å…·è¿”å›ä¸€ä¸ªå®ƒä¼ªé€ çš„è¯ä¹¦ï¼Œè¯¥è¯ä¹¦ä¼šåŒ¹é…ä¸Šä¸Šä¸€æ­¥æå‰æ·»åŠ åˆ°ç³»ç»Ÿä¸­çš„ CA è¯ä¹¦ä»è€ŒæˆåŠŸå»ºç«‹è¿æ¥ã€‚åç»­å†ç”±ä»£ç†å·¥å…·å°†è¯·æ±‚è½¬å‘ç»™çœŸæ­£çš„æœåŠ¡ç«¯ï¼Œè¿™æ ·ä»£ç†å·¥å…·å°±èƒ½å®ç°å¯¹ HTTPS æµé‡çš„ç›‘å¬ã€‚ è¿™å®è´¨æ˜¯ä¸€æ¬¡ä¸­ç»§æ”»å‡»ï¼Œå…¶ä¸­æœ€å…³é”®çš„ä¸€æ­¥å°±æ˜¯ï¼Œå®ƒéœ€è¦åœ¨å®¢æˆ·ç«¯ç³»ç»Ÿä¸Šæ·»åŠ è‡ªå·±çš„ CA è¯ä¹¦ï¼Œè¿™æ ·å®¢æˆ·ç«¯å°±ä¼šä¿¡ä»»å®ƒä¼ªé€ çš„è¯ä¹¦ã€‚ è¯»è€…å¦‚æœè¯»åˆ°äº†è¿™é‡Œï¼Œå»ºè®®æ£€æŸ¥ä¸€ä¸‹è‡ªå·±ç³»ç»Ÿä¸­çš„è¯ä¹¦åˆ—è¡¨ï¼Œçœ‹çœ‹æ˜¯å¦æœ‰è¿™ç±»è¢«æ’å…¥çš„æ¶æ„è¯ä¹¦ï¼Œè‡ªå·±æµé‡è¢«ç›‘å¬äº†è€Œä¸è‡ªçŸ¥ã€‚ æ—¢ç„¶æœ‰æ”»å‡»æ‰‹æ®µï¼Œé‚£å°±æœ‰é˜²å¾¡æ‰‹æ®µï¼Œè®¸å¤šå¤§å‚çš„ APP éƒ½ä¼šä½¿ç”¨ä¸€äº›æŠ€æœ¯æ¥é˜²æ­¢è‡ªå·±çš„æµé‡è¢«ç›‘å¬ï¼Œä¸‹é¢ä»‹ç»å‡ ç§å¸¸è§çš„é˜²å¾¡æ‰‹æ®µã€‚ 1. è¯ä¹¦é”å®šï¼ˆCertificate Piningï¼‰æŠ€æœ¯å³ä½¿ä½¿ç”¨äº† TLS åè®®å¯¹æµé‡è¿›è¡ŒåŠ å¯†ï¼Œå¹¶ä¸”ä¿è¯äº†å‰å‘ä¿å¯†ï¼Œä¹Ÿæ— æ³•ä¿è¯æµé‡ä¸è¢«ä»£ç†ï¼ è¿™æ˜¯å› ä¸ºå®¢æˆ·ç«¯å¤§å¤šæ˜¯ç›´æ¥ä¾é äº†æ“ä½œç³»ç»Ÿå†…ç½®çš„ CA è¯ä¹¦åº“è¿›è¡Œè¯ä¹¦éªŒè¯ï¼Œè€Œ Fiddler ç­‰ä»£ç†å·¥å…·å¯ä»¥å°†è‡ªå·±çš„ CA è¯ä¹¦æ·»åŠ åˆ°è¯¥è¯ä¹¦åº“ä¸­ã€‚ ä¸ºäº†é˜²æ­¢æµé‡è¢« Fiddler ç­‰å·¥å…·ä½¿ç”¨ä¸Šè¿°æ–¹å¼ç›‘å¬æµé‡ï¼Œå‡ºç°äº†ã€Œè¯ä¹¦é”å®šï¼ˆCertificate Pining, æˆ–è€… SSL Pinningï¼‰ã€æŠ€æœ¯ã€‚æ–¹æ³•æ˜¯åœ¨å®¢æˆ·ç«¯ä¸­ç¡¬ç¼–ç è¯ä¹¦çš„æŒ‡çº¹ï¼ˆHashå€¼ï¼Œæˆ–è€…ç›´æ¥ä¿å­˜æ•´ä¸ªè¯ä¹¦çš„å†…å®¹ä¹Ÿè¡Œï¼‰ï¼Œåœ¨å»ºç«‹ TLS è¿æ¥å‰ï¼Œå…ˆè®¡ç®—ä½¿ç”¨çš„è¯ä¹¦çš„æŒ‡çº¹æ˜¯å¦åŒ¹é…ï¼Œå¦åˆ™å°±ä¸­æ–­è¿æ¥ã€‚ è¿™ç§é”å®šæ–¹å¼éœ€è¦ä»¥ä¸‹å‡ ä¸ªå‰ææ‰èƒ½ç¡®ä¿æµé‡ä¸è¢«ç›‘å¬: å®¢æˆ·ç«¯ä¸­ç¡¬ç¼–ç çš„è¯ä¹¦æŒ‡çº¹ä¸ä¼šè¢«ç¯¡æ”¹ã€‚ æŒ‡çº¹éªŒè¯ä¸èƒ½è¢«ç»•è¿‡ã€‚ ç›®å‰æœ‰å…¬å¼€æŠ€æœ¯ï¼ˆXPosed+JustTrustMeï¼‰èƒ½ç ´è§£ Android ä¸Šå¸¸è§çš„ HTTPS è¯·æ±‚åº“ï¼Œç›´æ¥ç»•è¿‡è¯ä¹¦æ£€æŸ¥ã€‚ é’ˆå¯¹ä¸Šè¿°é—®é¢˜ï¼Œå¯ä»¥è€ƒè™‘åŠ å¤§ç»•è¿‡çš„éš¾åº¦ã€‚æˆ–è€… App æ£€æµ‹è‡ªå·±æ˜¯å¦è¿è¡Œåœ¨ Xposed ç­‰è™šæ‹Ÿç¯å¢ƒä¸‹ã€‚ ç”¨äº TLS åè®®çš„è¯ä¹¦ä¸ä¼šé¢‘ç¹æ›´æ¢ã€‚ï¼ˆå¦‚æœæ›´æ¢äº†ï¼ŒæŒ‡çº¹å°±å¯¹ä¸ä¸Šäº†ã€‚ï¼‰ è€Œå¯¹äºç¬¬ä¸‰æ–¹çš„ APIï¼Œå› ä¸ºæˆ‘ä»¬ä¸çŸ¥é“å®ƒä»¬ä¼šä¸ä¼šæ›´æ¢ TLS è¯ä¹¦ï¼Œå°±ä¸èƒ½ç›´æ¥å°†è¯ä¹¦æŒ‡çº¹ç¡¬ç¼–ç åœ¨å®¢æˆ·ç«¯ä¸­ã€‚è¿™æ—¶å¯ä»¥è€ƒè™‘ä»æœåŠ¡ç«¯è·å–è¿™äº› API çš„è¯ä¹¦æŒ‡çº¹ï¼ˆé™„å¸¦ç§é’¥ç­¾åç”¨äºé˜²ä¼ªé€ ï¼‰ã€‚ ä¸ºäº†å®ç°è¯ä¹¦çš„è½®è½¬(rotation)ï¼Œå¯ä»¥åœ¨æ–°ç‰ˆæœ¬çš„å®¢æˆ·ç«¯ä¸­åŒ…å«å¤šä¸ªè¯ä¹¦æŒ‡çº¹ï¼Œè¿™æ ·èƒ½ä¿è¯åŒæ—¶æœ‰å¤šä¸ªå¯ä¿¡è¯ä¹¦ï¼Œè¾¾æˆè¯ä¹¦çš„è½®è½¬ã€‚ï¼ˆç±»æ¯” JWT çš„å…¬é’¥è½®è½¬æœºåˆ¶ï¼‰ è¯ä¹¦é”å®šæŠ€æœ¯å‡ ä¹ç­‰åŒäº SSH åè®®çš„ StrictHostKeyChecking é€‰é¡¹ï¼Œå®¢æˆ·ç«¯ä¼šéªŒè¯æœåŠ¡ç«¯çš„å…¬é’¥æŒ‡çº¹ï¼ˆkey fingerprintï¼‰ï¼ŒéªŒè¯ä¸é€šè¿‡åˆ™æ–­å¼€è¿æ¥ã€‚ 2. å…¬é’¥é”å®šï¼ˆPublic Key Piningï¼‰æŠ€æœ¯å‰é¢ä»‹ç»è¿‡è¯ä¹¦çš„ç»“æ„ï¼Œå®ƒå…¶å®åŒ…å«äº†å…¬é’¥ã€æœ‰æ•ˆæœŸä¸ä¸€ç³»åˆ—çš„å…¶ä»–ä¿¡æ¯ã€‚ä½¿ç”¨äº†è¯ä¹¦é”å®šæŠ€æœ¯ï¼Œä¼šå¯¼è‡´è¯ä¹¦çš„æœ‰æ•ˆæœŸä¹Ÿè¢«é”å®šï¼ŒAPK å†…çš„è¯ä¹¦æŒ‡çº¹å°±å¿…é¡»éšç€è¯ä¹¦ä¸€èµ·æ›´æ–°ã€‚ æ›´å¥½çš„åšæ³•æ˜¯ä»…é”å®šè¯ä¹¦ä¸­çš„å…¬é’¥ï¼Œå³ã€Œå…¬é’¥é”å®šã€æŠ€æœ¯ã€‚ã€Œå…¬é’¥é”å®šã€æ¯”ã€Œè¯ä¹¦é”å®šã€æ›´çµæ´»ï¼Œè¿™æ ·è¯ä¹¦æœ¬èº«å…¶å®å°±å¯ä»¥ç›´æ¥è½®è½¬äº†ï¼ˆè¯ä¹¦æœ‰è¿‡æœŸæ—¶é—´ï¼‰ï¼Œè€Œä¸éœ€è¦ä¸€ä¸ªæ—§è¯ä¹¦å’Œæ–°è¯ä¹¦å…±å­˜çš„ä¸­é—´æ—¶æœŸã€‚ ã€Œå…¬é’¥é”å®šã€æ˜¯æ›´æ¨èçš„é”å®šæŠ€æœ¯ã€‚ 3. HTTPS ä¸¥æ ¼ä¼ è¾“å®‰å…¨ - HSTSHSTSï¼Œå³ HTTP Strict Transport Securityï¼Œæ˜¯ä¸€é¡¹å®‰å…¨æŠ€æœ¯ï¼Œå®ƒå…è®¸æœåŠ¡ç«¯åœ¨è¿”å› HTTPS å“åº”æ—¶ï¼Œ é€šè¿‡ Headers æ˜ç¡®è¦æ±‚å®¢æˆ·ç«¯ï¼Œåœ¨ä¹‹åçš„ä¸€æ®µæ—¶é—´å†…å¿…é¡»ä½¿ç”¨å®‰å…¨çš„ HTTPS åè®®è®¿é—®æœåŠ¡ç«¯ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ç«™ç‚¹ https://example.com/ çš„å“åº”å¤´ä¸­æœ‰Strict-Transport-Security: max-age=31536000; includeSubDomainsï¼Œè¿™è¡¨ç¤ºæœåŠ¡ç«¯è¦æ±‚å®¢æˆ·ç«¯ ï¼ˆæ¯”å¦‚æµè§ˆå™¨ï¼‰ï¼š åœ¨æ¥ä¸‹æ¥çš„ 31536000 ç§’ï¼ˆå³ä¸€å¹´ï¼‰ä¸­ï¼Œå®¢æˆ·ç«¯å‘ example.com æˆ–å…¶å­åŸŸåå‘é€ HTTP è¯·æ±‚æ—¶ï¼Œå¿…é¡»é‡‡ç”¨HTTPSæ¥å‘èµ·è¿æ¥ã€‚ æ¯”å¦‚ç”¨æˆ·åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥ http://example.com/ æ—¶ï¼Œæµè§ˆå™¨åº”è‡ªåŠ¨å°† http æ”¹å†™ä¸º https å†å‘èµ·è¯·æ±‚ åœ¨æ¥ä¸‹æ¥çš„ 31536000 ç§’ï¼ˆå³ä¸€å¹´ï¼‰ä¸­ï¼Œå¦‚æœ example.com æœåŠ¡å™¨æä¾›çš„è¯ä¹¦æ— æ•ˆï¼Œç”¨æˆ·ä¸èƒ½å¿½ç•¥æµè§ˆå™¨çš„è¯ä¹¦è­¦å‘Šç»§ç»­è®¿é—®ç½‘ç«™ã€‚ ä¹Ÿå°±æ˜¯è¯´ä¸€æ—¦è¯ä¹¦å¤±æ•ˆï¼Œç«™ç‚¹å°†å®Œå…¨æ— æ³•è®¿é—®ï¼Œç›´è‡³æœåŠ¡ç«¯ä¿®å¤è¯ä¹¦é—®é¢˜ã€‚ ä¸€æ—¦è¯ä¹¦å¤±æ•ˆï¼ŒHTTPS å…¶å®å°±ä¸æ˜¯ä¸¥æ ¼å®‰å…¨çš„äº†ï¼Œå¯èƒ½ä¼šé­é‡ä¸­é—´äººæ”»å‡»ã€‚ä¹Ÿå°±æ˜¯è¯´ HSTS é€šè¿‡ç‰ºç‰²ç«™ç‚¹çš„å¯è®¿é—®æ€§æ¥é¿å…ä¸­é—´äººæ”»å‡»ã€‚ 4. TLS åè®®çš„é€†å‘æ‰‹æ®µè¦è·å–ä¸€ä¸ªåº”ç”¨çš„ HTTPS æ•°æ®ï¼Œæœ‰ä¸¤ä¸ªæ–¹å‘: æœåŠ¡ç«¯å…¥ä¾µ: ç°ä»£åº”ç”¨çš„æœåŠ¡ç«¯çªç ´éš¾åº¦é€šå¸¸éƒ½æ¯”è¾ƒå®¢æˆ·ç«¯é«˜ï¼Œæ³¨å…¥ç­‰æ¼æ´åº•å±‚æ¡†æ¶å°±æœ‰å¤„ç†ã€‚ ä¸è¿‡å¦‚æœä½ è·å¾—äº†æœåŠ¡å™¨ root æƒé™ï¼Œå¯ä»¥åœ¨ openssl ä¸Šåšæ–‡ç« ï¼Œæ¯”å¦‚ç¯¡æ”¹ opensslï¼Ÿ å®¢æˆ·ç«¯é€†å‘+çˆ¬è™«: å®¢æˆ·ç«¯æ˜¯ç¦»ç”¨æˆ·æœ€è¿‘çš„åœ°æ–¹ï¼Œä¹Ÿæ˜¯æœ€å®¹æ˜“è¢«çªç ´çš„åœ°æ–¹ã€‚ æ–¹æ³•ä¸€åœ¨å‰é¢ä»‹ç»è¿‡äº†ï¼Œå°±æ˜¯åœ¨å®¢æˆ·ç«¯ç³»ç»Ÿä¸­æå‰å®‰è£…ç§æœ‰ CA è¯ä¹¦ï¼Œå†é€šè¿‡ä»£ç†å·¥å…·è¿›è¡Œç›‘å¬ï¼Œè¿™ç§æ–¹æ³•èƒ½ç›‘å¬åˆ°æ‰€æœ‰æ™®é€š HTTP æµé‡ã€‚ å®‰å“ä¸Šå¯ä»¥é€šè¿‡ XPosed+JustTrustMe ç­‰æŠ€æœ¯ï¼Œç›´æ¥ Hook åº•å±‚ HTTP åº“ç»•è¿‡è¯ä¹¦æ£€æŸ¥ï¼Œå®ç°ç›‘å¬ HTTPS æµé‡ã€‚è¿™ç§æ–¹æ³•çš„ç¼ºç‚¹æ˜¯åªèƒ½ç›‘å¬é€‚é…çš„åº“ï¼Œæ‰€ä»¥ä»¥å‰æœ‰äººè¯´ flutter åº”ç”¨å®‰å…¨æ€§å¥½ï¼Œå› ä¸ºå®ƒæ¯”è¾ƒæ–°é²œï¼Œé€†å‘èµ„æ–™å°‘ï¼Œé€†å‘éš¾åº¦å°±é«˜ã€‚ å¯¹ mTLS è¿™ç±»æ›´å®‰å…¨çš„åè®®ï¼Œä¼šæ›´å¤æ‚äº›ã€‚ æˆ‘è§è¿‡çš„ç ´è§£æ‰‹æ®µä¹‹ä¸€ï¼šæ‰¾åˆ°è€ç‰ˆæœ¬çš„å®‰è£…åŒ…ï¼Œå‘ç°å¾ˆå®¹æ˜“å°±èƒ½æå–å‡ºå®¢æˆ·ç«¯è¯ä¹¦â€¦ wiki åˆ—å‡ºäº†ä¸€äº› TLS åè®®çš„å®‰å…¨é—®é¢˜ï¼šhttps://en.wikipedia.org/wiki/Transport_Layer_Security#Security TO BE DONEâ€¦ ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:4:4","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#1-è¯ä¹¦é”å®šcertificate-piningæŠ€æœ¯"},{"categories":["tech"],"content":" 4. TLS åè®®æ”»é˜²æˆ˜è™½ç„¶ TLS åè®®æ˜¯ä¸€ä¸ªå®‰å…¨çš„åŠ å¯†åè®®ï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“å‘whistle / charles / fiddler ç­‰ä»£ç†è°ƒè¯•å·¥å…·ã€ä»¥åŠæ·±ä¿¡æœçš„ä¼ä¸šå‘˜å·¥æµé‡ç›‘æµ‹å·¥å…·ï¼Œéƒ½èƒ½å®ç°å¯¹ HTTPS æµé‡çš„ç›‘å¬ã€‚ å…¶åŸç†æ˜¯è¿™äº›ä»£ç†å·¥å…·ä¼šåœ¨å¯åŠ¨æ—¶é¦–å…ˆè¦æ±‚å°†å®ƒè‡ªå·±çš„ç§æœ‰ CA è¯ä¹¦æ·»åŠ åˆ°ç³»ç»Ÿè¯ä¹¦ä¸­ï¼Œè¿™æ ·å®¢æˆ·ç«¯ ï¼ˆæ‰‹æœº APP / æµè§ˆå™¨ç­‰åº”ç”¨ï¼‰åœ¨å»ºç«‹ TLS è¿æ¥æ—¶ä¼šè¢«ä»£ç†å·¥å…·æ‹¦æˆªï¼Œä»£ç†å·¥å…·è¿”å›ä¸€ä¸ªå®ƒä¼ªé€ çš„è¯ä¹¦ï¼Œè¯¥è¯ä¹¦ä¼šåŒ¹é…ä¸Šä¸Šä¸€æ­¥æå‰æ·»åŠ åˆ°ç³»ç»Ÿä¸­çš„ CA è¯ä¹¦ä»è€ŒæˆåŠŸå»ºç«‹è¿æ¥ã€‚åç»­å†ç”±ä»£ç†å·¥å…·å°†è¯·æ±‚è½¬å‘ç»™çœŸæ­£çš„æœåŠ¡ç«¯ï¼Œè¿™æ ·ä»£ç†å·¥å…·å°±èƒ½å®ç°å¯¹ HTTPS æµé‡çš„ç›‘å¬ã€‚ è¿™å®è´¨æ˜¯ä¸€æ¬¡ä¸­ç»§æ”»å‡»ï¼Œå…¶ä¸­æœ€å…³é”®çš„ä¸€æ­¥å°±æ˜¯ï¼Œå®ƒéœ€è¦åœ¨å®¢æˆ·ç«¯ç³»ç»Ÿä¸Šæ·»åŠ è‡ªå·±çš„ CA è¯ä¹¦ï¼Œè¿™æ ·å®¢æˆ·ç«¯å°±ä¼šä¿¡ä»»å®ƒä¼ªé€ çš„è¯ä¹¦ã€‚ è¯»è€…å¦‚æœè¯»åˆ°äº†è¿™é‡Œï¼Œå»ºè®®æ£€æŸ¥ä¸€ä¸‹è‡ªå·±ç³»ç»Ÿä¸­çš„è¯ä¹¦åˆ—è¡¨ï¼Œçœ‹çœ‹æ˜¯å¦æœ‰è¿™ç±»è¢«æ’å…¥çš„æ¶æ„è¯ä¹¦ï¼Œè‡ªå·±æµé‡è¢«ç›‘å¬äº†è€Œä¸è‡ªçŸ¥ã€‚ æ—¢ç„¶æœ‰æ”»å‡»æ‰‹æ®µï¼Œé‚£å°±æœ‰é˜²å¾¡æ‰‹æ®µï¼Œè®¸å¤šå¤§å‚çš„ APP éƒ½ä¼šä½¿ç”¨ä¸€äº›æŠ€æœ¯æ¥é˜²æ­¢è‡ªå·±çš„æµé‡è¢«ç›‘å¬ï¼Œä¸‹é¢ä»‹ç»å‡ ç§å¸¸è§çš„é˜²å¾¡æ‰‹æ®µã€‚ 1. è¯ä¹¦é”å®šï¼ˆCertificate Piningï¼‰æŠ€æœ¯å³ä½¿ä½¿ç”¨äº† TLS åè®®å¯¹æµé‡è¿›è¡ŒåŠ å¯†ï¼Œå¹¶ä¸”ä¿è¯äº†å‰å‘ä¿å¯†ï¼Œä¹Ÿæ— æ³•ä¿è¯æµé‡ä¸è¢«ä»£ç†ï¼ è¿™æ˜¯å› ä¸ºå®¢æˆ·ç«¯å¤§å¤šæ˜¯ç›´æ¥ä¾é äº†æ“ä½œç³»ç»Ÿå†…ç½®çš„ CA è¯ä¹¦åº“è¿›è¡Œè¯ä¹¦éªŒè¯ï¼Œè€Œ Fiddler ç­‰ä»£ç†å·¥å…·å¯ä»¥å°†è‡ªå·±çš„ CA è¯ä¹¦æ·»åŠ åˆ°è¯¥è¯ä¹¦åº“ä¸­ã€‚ ä¸ºäº†é˜²æ­¢æµé‡è¢« Fiddler ç­‰å·¥å…·ä½¿ç”¨ä¸Šè¿°æ–¹å¼ç›‘å¬æµé‡ï¼Œå‡ºç°äº†ã€Œè¯ä¹¦é”å®šï¼ˆCertificate Pining, æˆ–è€… SSL Pinningï¼‰ã€æŠ€æœ¯ã€‚æ–¹æ³•æ˜¯åœ¨å®¢æˆ·ç«¯ä¸­ç¡¬ç¼–ç è¯ä¹¦çš„æŒ‡çº¹ï¼ˆHashå€¼ï¼Œæˆ–è€…ç›´æ¥ä¿å­˜æ•´ä¸ªè¯ä¹¦çš„å†…å®¹ä¹Ÿè¡Œï¼‰ï¼Œåœ¨å»ºç«‹ TLS è¿æ¥å‰ï¼Œå…ˆè®¡ç®—ä½¿ç”¨çš„è¯ä¹¦çš„æŒ‡çº¹æ˜¯å¦åŒ¹é…ï¼Œå¦åˆ™å°±ä¸­æ–­è¿æ¥ã€‚ è¿™ç§é”å®šæ–¹å¼éœ€è¦ä»¥ä¸‹å‡ ä¸ªå‰ææ‰èƒ½ç¡®ä¿æµé‡ä¸è¢«ç›‘å¬: å®¢æˆ·ç«¯ä¸­ç¡¬ç¼–ç çš„è¯ä¹¦æŒ‡çº¹ä¸ä¼šè¢«ç¯¡æ”¹ã€‚ æŒ‡çº¹éªŒè¯ä¸èƒ½è¢«ç»•è¿‡ã€‚ ç›®å‰æœ‰å…¬å¼€æŠ€æœ¯ï¼ˆXPosed+JustTrustMeï¼‰èƒ½ç ´è§£ Android ä¸Šå¸¸è§çš„ HTTPS è¯·æ±‚åº“ï¼Œç›´æ¥ç»•è¿‡è¯ä¹¦æ£€æŸ¥ã€‚ é’ˆå¯¹ä¸Šè¿°é—®é¢˜ï¼Œå¯ä»¥è€ƒè™‘åŠ å¤§ç»•è¿‡çš„éš¾åº¦ã€‚æˆ–è€… App æ£€æµ‹è‡ªå·±æ˜¯å¦è¿è¡Œåœ¨ Xposed ç­‰è™šæ‹Ÿç¯å¢ƒä¸‹ã€‚ ç”¨äº TLS åè®®çš„è¯ä¹¦ä¸ä¼šé¢‘ç¹æ›´æ¢ã€‚ï¼ˆå¦‚æœæ›´æ¢äº†ï¼ŒæŒ‡çº¹å°±å¯¹ä¸ä¸Šäº†ã€‚ï¼‰ è€Œå¯¹äºç¬¬ä¸‰æ–¹çš„ APIï¼Œå› ä¸ºæˆ‘ä»¬ä¸çŸ¥é“å®ƒä»¬ä¼šä¸ä¼šæ›´æ¢ TLS è¯ä¹¦ï¼Œå°±ä¸èƒ½ç›´æ¥å°†è¯ä¹¦æŒ‡çº¹ç¡¬ç¼–ç åœ¨å®¢æˆ·ç«¯ä¸­ã€‚è¿™æ—¶å¯ä»¥è€ƒè™‘ä»æœåŠ¡ç«¯è·å–è¿™äº› API çš„è¯ä¹¦æŒ‡çº¹ï¼ˆé™„å¸¦ç§é’¥ç­¾åç”¨äºé˜²ä¼ªé€ ï¼‰ã€‚ ä¸ºäº†å®ç°è¯ä¹¦çš„è½®è½¬(rotation)ï¼Œå¯ä»¥åœ¨æ–°ç‰ˆæœ¬çš„å®¢æˆ·ç«¯ä¸­åŒ…å«å¤šä¸ªè¯ä¹¦æŒ‡çº¹ï¼Œè¿™æ ·èƒ½ä¿è¯åŒæ—¶æœ‰å¤šä¸ªå¯ä¿¡è¯ä¹¦ï¼Œè¾¾æˆè¯ä¹¦çš„è½®è½¬ã€‚ï¼ˆç±»æ¯” JWT çš„å…¬é’¥è½®è½¬æœºåˆ¶ï¼‰ è¯ä¹¦é”å®šæŠ€æœ¯å‡ ä¹ç­‰åŒäº SSH åè®®çš„ StrictHostKeyChecking é€‰é¡¹ï¼Œå®¢æˆ·ç«¯ä¼šéªŒè¯æœåŠ¡ç«¯çš„å…¬é’¥æŒ‡çº¹ï¼ˆkey fingerprintï¼‰ï¼ŒéªŒè¯ä¸é€šè¿‡åˆ™æ–­å¼€è¿æ¥ã€‚ 2. å…¬é’¥é”å®šï¼ˆPublic Key Piningï¼‰æŠ€æœ¯å‰é¢ä»‹ç»è¿‡è¯ä¹¦çš„ç»“æ„ï¼Œå®ƒå…¶å®åŒ…å«äº†å…¬é’¥ã€æœ‰æ•ˆæœŸä¸ä¸€ç³»åˆ—çš„å…¶ä»–ä¿¡æ¯ã€‚ä½¿ç”¨äº†è¯ä¹¦é”å®šæŠ€æœ¯ï¼Œä¼šå¯¼è‡´è¯ä¹¦çš„æœ‰æ•ˆæœŸä¹Ÿè¢«é”å®šï¼ŒAPK å†…çš„è¯ä¹¦æŒ‡çº¹å°±å¿…é¡»éšç€è¯ä¹¦ä¸€èµ·æ›´æ–°ã€‚ æ›´å¥½çš„åšæ³•æ˜¯ä»…é”å®šè¯ä¹¦ä¸­çš„å…¬é’¥ï¼Œå³ã€Œå…¬é’¥é”å®šã€æŠ€æœ¯ã€‚ã€Œå…¬é’¥é”å®šã€æ¯”ã€Œè¯ä¹¦é”å®šã€æ›´çµæ´»ï¼Œè¿™æ ·è¯ä¹¦æœ¬èº«å…¶å®å°±å¯ä»¥ç›´æ¥è½®è½¬äº†ï¼ˆè¯ä¹¦æœ‰è¿‡æœŸæ—¶é—´ï¼‰ï¼Œè€Œä¸éœ€è¦ä¸€ä¸ªæ—§è¯ä¹¦å’Œæ–°è¯ä¹¦å…±å­˜çš„ä¸­é—´æ—¶æœŸã€‚ ã€Œå…¬é’¥é”å®šã€æ˜¯æ›´æ¨èçš„é”å®šæŠ€æœ¯ã€‚ 3. HTTPS ä¸¥æ ¼ä¼ è¾“å®‰å…¨ - HSTSHSTSï¼Œå³ HTTP Strict Transport Securityï¼Œæ˜¯ä¸€é¡¹å®‰å…¨æŠ€æœ¯ï¼Œå®ƒå…è®¸æœåŠ¡ç«¯åœ¨è¿”å› HTTPS å“åº”æ—¶ï¼Œ é€šè¿‡ Headers æ˜ç¡®è¦æ±‚å®¢æˆ·ç«¯ï¼Œåœ¨ä¹‹åçš„ä¸€æ®µæ—¶é—´å†…å¿…é¡»ä½¿ç”¨å®‰å…¨çš„ HTTPS åè®®è®¿é—®æœåŠ¡ç«¯ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ç«™ç‚¹ https://example.com/ çš„å“åº”å¤´ä¸­æœ‰Strict-Transport-Security: max-age=31536000; includeSubDomainsï¼Œè¿™è¡¨ç¤ºæœåŠ¡ç«¯è¦æ±‚å®¢æˆ·ç«¯ ï¼ˆæ¯”å¦‚æµè§ˆå™¨ï¼‰ï¼š åœ¨æ¥ä¸‹æ¥çš„ 31536000 ç§’ï¼ˆå³ä¸€å¹´ï¼‰ä¸­ï¼Œå®¢æˆ·ç«¯å‘ example.com æˆ–å…¶å­åŸŸåå‘é€ HTTP è¯·æ±‚æ—¶ï¼Œå¿…é¡»é‡‡ç”¨HTTPSæ¥å‘èµ·è¿æ¥ã€‚ æ¯”å¦‚ç”¨æˆ·åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥ http://example.com/ æ—¶ï¼Œæµè§ˆå™¨åº”è‡ªåŠ¨å°† http æ”¹å†™ä¸º https å†å‘èµ·è¯·æ±‚ åœ¨æ¥ä¸‹æ¥çš„ 31536000 ç§’ï¼ˆå³ä¸€å¹´ï¼‰ä¸­ï¼Œå¦‚æœ example.com æœåŠ¡å™¨æä¾›çš„è¯ä¹¦æ— æ•ˆï¼Œç”¨æˆ·ä¸èƒ½å¿½ç•¥æµè§ˆå™¨çš„è¯ä¹¦è­¦å‘Šç»§ç»­è®¿é—®ç½‘ç«™ã€‚ ä¹Ÿå°±æ˜¯è¯´ä¸€æ—¦è¯ä¹¦å¤±æ•ˆï¼Œç«™ç‚¹å°†å®Œå…¨æ— æ³•è®¿é—®ï¼Œç›´è‡³æœåŠ¡ç«¯ä¿®å¤è¯ä¹¦é—®é¢˜ã€‚ ä¸€æ—¦è¯ä¹¦å¤±æ•ˆï¼ŒHTTPS å…¶å®å°±ä¸æ˜¯ä¸¥æ ¼å®‰å…¨çš„äº†ï¼Œå¯èƒ½ä¼šé­é‡ä¸­é—´äººæ”»å‡»ã€‚ä¹Ÿå°±æ˜¯è¯´ HSTS é€šè¿‡ç‰ºç‰²ç«™ç‚¹çš„å¯è®¿é—®æ€§æ¥é¿å…ä¸­é—´äººæ”»å‡»ã€‚ 4. TLS åè®®çš„é€†å‘æ‰‹æ®µè¦è·å–ä¸€ä¸ªåº”ç”¨çš„ HTTPS æ•°æ®ï¼Œæœ‰ä¸¤ä¸ªæ–¹å‘: æœåŠ¡ç«¯å…¥ä¾µ: ç°ä»£åº”ç”¨çš„æœåŠ¡ç«¯çªç ´éš¾åº¦é€šå¸¸éƒ½æ¯”è¾ƒå®¢æˆ·ç«¯é«˜ï¼Œæ³¨å…¥ç­‰æ¼æ´åº•å±‚æ¡†æ¶å°±æœ‰å¤„ç†ã€‚ ä¸è¿‡å¦‚æœä½ è·å¾—äº†æœåŠ¡å™¨ root æƒé™ï¼Œå¯ä»¥åœ¨ openssl ä¸Šåšæ–‡ç« ï¼Œæ¯”å¦‚ç¯¡æ”¹ opensslï¼Ÿ å®¢æˆ·ç«¯é€†å‘+çˆ¬è™«: å®¢æˆ·ç«¯æ˜¯ç¦»ç”¨æˆ·æœ€è¿‘çš„åœ°æ–¹ï¼Œä¹Ÿæ˜¯æœ€å®¹æ˜“è¢«çªç ´çš„åœ°æ–¹ã€‚ æ–¹æ³•ä¸€åœ¨å‰é¢ä»‹ç»è¿‡äº†ï¼Œå°±æ˜¯åœ¨å®¢æˆ·ç«¯ç³»ç»Ÿä¸­æå‰å®‰è£…ç§æœ‰ CA è¯ä¹¦ï¼Œå†é€šè¿‡ä»£ç†å·¥å…·è¿›è¡Œç›‘å¬ï¼Œè¿™ç§æ–¹æ³•èƒ½ç›‘å¬åˆ°æ‰€æœ‰æ™®é€š HTTP æµé‡ã€‚ å®‰å“ä¸Šå¯ä»¥é€šè¿‡ XPosed+JustTrustMe ç­‰æŠ€æœ¯ï¼Œç›´æ¥ Hook åº•å±‚ HTTP åº“ç»•è¿‡è¯ä¹¦æ£€æŸ¥ï¼Œå®ç°ç›‘å¬ HTTPS æµé‡ã€‚è¿™ç§æ–¹æ³•çš„ç¼ºç‚¹æ˜¯åªèƒ½ç›‘å¬é€‚é…çš„åº“ï¼Œæ‰€ä»¥ä»¥å‰æœ‰äººè¯´ flutter åº”ç”¨å®‰å…¨æ€§å¥½ï¼Œå› ä¸ºå®ƒæ¯”è¾ƒæ–°é²œï¼Œé€†å‘èµ„æ–™å°‘ï¼Œé€†å‘éš¾åº¦å°±é«˜ã€‚ å¯¹ mTLS è¿™ç±»æ›´å®‰å…¨çš„åè®®ï¼Œä¼šæ›´å¤æ‚äº›ã€‚ æˆ‘è§è¿‡çš„ç ´è§£æ‰‹æ®µä¹‹ä¸€ï¼šæ‰¾åˆ°è€ç‰ˆæœ¬çš„å®‰è£…åŒ…ï¼Œå‘ç°å¾ˆå®¹æ˜“å°±èƒ½æå–å‡ºå®¢æˆ·ç«¯è¯ä¹¦â€¦ wiki åˆ—å‡ºäº†ä¸€äº› TLS åè®®çš„å®‰å…¨é—®é¢˜ï¼šhttps://en.wikipedia.org/wiki/Transport_Layer_Security#Security TO BE DONEâ€¦ ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:4:4","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#2-å…¬é’¥é”å®špublic-key-piningæŠ€æœ¯"},{"categories":["tech"],"content":" 4. TLS åè®®æ”»é˜²æˆ˜è™½ç„¶ TLS åè®®æ˜¯ä¸€ä¸ªå®‰å…¨çš„åŠ å¯†åè®®ï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“å‘whistle / charles / fiddler ç­‰ä»£ç†è°ƒè¯•å·¥å…·ã€ä»¥åŠæ·±ä¿¡æœçš„ä¼ä¸šå‘˜å·¥æµé‡ç›‘æµ‹å·¥å…·ï¼Œéƒ½èƒ½å®ç°å¯¹ HTTPS æµé‡çš„ç›‘å¬ã€‚ å…¶åŸç†æ˜¯è¿™äº›ä»£ç†å·¥å…·ä¼šåœ¨å¯åŠ¨æ—¶é¦–å…ˆè¦æ±‚å°†å®ƒè‡ªå·±çš„ç§æœ‰ CA è¯ä¹¦æ·»åŠ åˆ°ç³»ç»Ÿè¯ä¹¦ä¸­ï¼Œè¿™æ ·å®¢æˆ·ç«¯ ï¼ˆæ‰‹æœº APP / æµè§ˆå™¨ç­‰åº”ç”¨ï¼‰åœ¨å»ºç«‹ TLS è¿æ¥æ—¶ä¼šè¢«ä»£ç†å·¥å…·æ‹¦æˆªï¼Œä»£ç†å·¥å…·è¿”å›ä¸€ä¸ªå®ƒä¼ªé€ çš„è¯ä¹¦ï¼Œè¯¥è¯ä¹¦ä¼šåŒ¹é…ä¸Šä¸Šä¸€æ­¥æå‰æ·»åŠ åˆ°ç³»ç»Ÿä¸­çš„ CA è¯ä¹¦ä»è€ŒæˆåŠŸå»ºç«‹è¿æ¥ã€‚åç»­å†ç”±ä»£ç†å·¥å…·å°†è¯·æ±‚è½¬å‘ç»™çœŸæ­£çš„æœåŠ¡ç«¯ï¼Œè¿™æ ·ä»£ç†å·¥å…·å°±èƒ½å®ç°å¯¹ HTTPS æµé‡çš„ç›‘å¬ã€‚ è¿™å®è´¨æ˜¯ä¸€æ¬¡ä¸­ç»§æ”»å‡»ï¼Œå…¶ä¸­æœ€å…³é”®çš„ä¸€æ­¥å°±æ˜¯ï¼Œå®ƒéœ€è¦åœ¨å®¢æˆ·ç«¯ç³»ç»Ÿä¸Šæ·»åŠ è‡ªå·±çš„ CA è¯ä¹¦ï¼Œè¿™æ ·å®¢æˆ·ç«¯å°±ä¼šä¿¡ä»»å®ƒä¼ªé€ çš„è¯ä¹¦ã€‚ è¯»è€…å¦‚æœè¯»åˆ°äº†è¿™é‡Œï¼Œå»ºè®®æ£€æŸ¥ä¸€ä¸‹è‡ªå·±ç³»ç»Ÿä¸­çš„è¯ä¹¦åˆ—è¡¨ï¼Œçœ‹çœ‹æ˜¯å¦æœ‰è¿™ç±»è¢«æ’å…¥çš„æ¶æ„è¯ä¹¦ï¼Œè‡ªå·±æµé‡è¢«ç›‘å¬äº†è€Œä¸è‡ªçŸ¥ã€‚ æ—¢ç„¶æœ‰æ”»å‡»æ‰‹æ®µï¼Œé‚£å°±æœ‰é˜²å¾¡æ‰‹æ®µï¼Œè®¸å¤šå¤§å‚çš„ APP éƒ½ä¼šä½¿ç”¨ä¸€äº›æŠ€æœ¯æ¥é˜²æ­¢è‡ªå·±çš„æµé‡è¢«ç›‘å¬ï¼Œä¸‹é¢ä»‹ç»å‡ ç§å¸¸è§çš„é˜²å¾¡æ‰‹æ®µã€‚ 1. è¯ä¹¦é”å®šï¼ˆCertificate Piningï¼‰æŠ€æœ¯å³ä½¿ä½¿ç”¨äº† TLS åè®®å¯¹æµé‡è¿›è¡ŒåŠ å¯†ï¼Œå¹¶ä¸”ä¿è¯äº†å‰å‘ä¿å¯†ï¼Œä¹Ÿæ— æ³•ä¿è¯æµé‡ä¸è¢«ä»£ç†ï¼ è¿™æ˜¯å› ä¸ºå®¢æˆ·ç«¯å¤§å¤šæ˜¯ç›´æ¥ä¾é äº†æ“ä½œç³»ç»Ÿå†…ç½®çš„ CA è¯ä¹¦åº“è¿›è¡Œè¯ä¹¦éªŒè¯ï¼Œè€Œ Fiddler ç­‰ä»£ç†å·¥å…·å¯ä»¥å°†è‡ªå·±çš„ CA è¯ä¹¦æ·»åŠ åˆ°è¯¥è¯ä¹¦åº“ä¸­ã€‚ ä¸ºäº†é˜²æ­¢æµé‡è¢« Fiddler ç­‰å·¥å…·ä½¿ç”¨ä¸Šè¿°æ–¹å¼ç›‘å¬æµé‡ï¼Œå‡ºç°äº†ã€Œè¯ä¹¦é”å®šï¼ˆCertificate Pining, æˆ–è€… SSL Pinningï¼‰ã€æŠ€æœ¯ã€‚æ–¹æ³•æ˜¯åœ¨å®¢æˆ·ç«¯ä¸­ç¡¬ç¼–ç è¯ä¹¦çš„æŒ‡çº¹ï¼ˆHashå€¼ï¼Œæˆ–è€…ç›´æ¥ä¿å­˜æ•´ä¸ªè¯ä¹¦çš„å†…å®¹ä¹Ÿè¡Œï¼‰ï¼Œåœ¨å»ºç«‹ TLS è¿æ¥å‰ï¼Œå…ˆè®¡ç®—ä½¿ç”¨çš„è¯ä¹¦çš„æŒ‡çº¹æ˜¯å¦åŒ¹é…ï¼Œå¦åˆ™å°±ä¸­æ–­è¿æ¥ã€‚ è¿™ç§é”å®šæ–¹å¼éœ€è¦ä»¥ä¸‹å‡ ä¸ªå‰ææ‰èƒ½ç¡®ä¿æµé‡ä¸è¢«ç›‘å¬: å®¢æˆ·ç«¯ä¸­ç¡¬ç¼–ç çš„è¯ä¹¦æŒ‡çº¹ä¸ä¼šè¢«ç¯¡æ”¹ã€‚ æŒ‡çº¹éªŒè¯ä¸èƒ½è¢«ç»•è¿‡ã€‚ ç›®å‰æœ‰å…¬å¼€æŠ€æœ¯ï¼ˆXPosed+JustTrustMeï¼‰èƒ½ç ´è§£ Android ä¸Šå¸¸è§çš„ HTTPS è¯·æ±‚åº“ï¼Œç›´æ¥ç»•è¿‡è¯ä¹¦æ£€æŸ¥ã€‚ é’ˆå¯¹ä¸Šè¿°é—®é¢˜ï¼Œå¯ä»¥è€ƒè™‘åŠ å¤§ç»•è¿‡çš„éš¾åº¦ã€‚æˆ–è€… App æ£€æµ‹è‡ªå·±æ˜¯å¦è¿è¡Œåœ¨ Xposed ç­‰è™šæ‹Ÿç¯å¢ƒä¸‹ã€‚ ç”¨äº TLS åè®®çš„è¯ä¹¦ä¸ä¼šé¢‘ç¹æ›´æ¢ã€‚ï¼ˆå¦‚æœæ›´æ¢äº†ï¼ŒæŒ‡çº¹å°±å¯¹ä¸ä¸Šäº†ã€‚ï¼‰ è€Œå¯¹äºç¬¬ä¸‰æ–¹çš„ APIï¼Œå› ä¸ºæˆ‘ä»¬ä¸çŸ¥é“å®ƒä»¬ä¼šä¸ä¼šæ›´æ¢ TLS è¯ä¹¦ï¼Œå°±ä¸èƒ½ç›´æ¥å°†è¯ä¹¦æŒ‡çº¹ç¡¬ç¼–ç åœ¨å®¢æˆ·ç«¯ä¸­ã€‚è¿™æ—¶å¯ä»¥è€ƒè™‘ä»æœåŠ¡ç«¯è·å–è¿™äº› API çš„è¯ä¹¦æŒ‡çº¹ï¼ˆé™„å¸¦ç§é’¥ç­¾åç”¨äºé˜²ä¼ªé€ ï¼‰ã€‚ ä¸ºäº†å®ç°è¯ä¹¦çš„è½®è½¬(rotation)ï¼Œå¯ä»¥åœ¨æ–°ç‰ˆæœ¬çš„å®¢æˆ·ç«¯ä¸­åŒ…å«å¤šä¸ªè¯ä¹¦æŒ‡çº¹ï¼Œè¿™æ ·èƒ½ä¿è¯åŒæ—¶æœ‰å¤šä¸ªå¯ä¿¡è¯ä¹¦ï¼Œè¾¾æˆè¯ä¹¦çš„è½®è½¬ã€‚ï¼ˆç±»æ¯” JWT çš„å…¬é’¥è½®è½¬æœºåˆ¶ï¼‰ è¯ä¹¦é”å®šæŠ€æœ¯å‡ ä¹ç­‰åŒäº SSH åè®®çš„ StrictHostKeyChecking é€‰é¡¹ï¼Œå®¢æˆ·ç«¯ä¼šéªŒè¯æœåŠ¡ç«¯çš„å…¬é’¥æŒ‡çº¹ï¼ˆkey fingerprintï¼‰ï¼ŒéªŒè¯ä¸é€šè¿‡åˆ™æ–­å¼€è¿æ¥ã€‚ 2. å…¬é’¥é”å®šï¼ˆPublic Key Piningï¼‰æŠ€æœ¯å‰é¢ä»‹ç»è¿‡è¯ä¹¦çš„ç»“æ„ï¼Œå®ƒå…¶å®åŒ…å«äº†å…¬é’¥ã€æœ‰æ•ˆæœŸä¸ä¸€ç³»åˆ—çš„å…¶ä»–ä¿¡æ¯ã€‚ä½¿ç”¨äº†è¯ä¹¦é”å®šæŠ€æœ¯ï¼Œä¼šå¯¼è‡´è¯ä¹¦çš„æœ‰æ•ˆæœŸä¹Ÿè¢«é”å®šï¼ŒAPK å†…çš„è¯ä¹¦æŒ‡çº¹å°±å¿…é¡»éšç€è¯ä¹¦ä¸€èµ·æ›´æ–°ã€‚ æ›´å¥½çš„åšæ³•æ˜¯ä»…é”å®šè¯ä¹¦ä¸­çš„å…¬é’¥ï¼Œå³ã€Œå…¬é’¥é”å®šã€æŠ€æœ¯ã€‚ã€Œå…¬é’¥é”å®šã€æ¯”ã€Œè¯ä¹¦é”å®šã€æ›´çµæ´»ï¼Œè¿™æ ·è¯ä¹¦æœ¬èº«å…¶å®å°±å¯ä»¥ç›´æ¥è½®è½¬äº†ï¼ˆè¯ä¹¦æœ‰è¿‡æœŸæ—¶é—´ï¼‰ï¼Œè€Œä¸éœ€è¦ä¸€ä¸ªæ—§è¯ä¹¦å’Œæ–°è¯ä¹¦å…±å­˜çš„ä¸­é—´æ—¶æœŸã€‚ ã€Œå…¬é’¥é”å®šã€æ˜¯æ›´æ¨èçš„é”å®šæŠ€æœ¯ã€‚ 3. HTTPS ä¸¥æ ¼ä¼ è¾“å®‰å…¨ - HSTSHSTSï¼Œå³ HTTP Strict Transport Securityï¼Œæ˜¯ä¸€é¡¹å®‰å…¨æŠ€æœ¯ï¼Œå®ƒå…è®¸æœåŠ¡ç«¯åœ¨è¿”å› HTTPS å“åº”æ—¶ï¼Œ é€šè¿‡ Headers æ˜ç¡®è¦æ±‚å®¢æˆ·ç«¯ï¼Œåœ¨ä¹‹åçš„ä¸€æ®µæ—¶é—´å†…å¿…é¡»ä½¿ç”¨å®‰å…¨çš„ HTTPS åè®®è®¿é—®æœåŠ¡ç«¯ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ç«™ç‚¹ https://example.com/ çš„å“åº”å¤´ä¸­æœ‰Strict-Transport-Security: max-age=31536000; includeSubDomainsï¼Œè¿™è¡¨ç¤ºæœåŠ¡ç«¯è¦æ±‚å®¢æˆ·ç«¯ ï¼ˆæ¯”å¦‚æµè§ˆå™¨ï¼‰ï¼š åœ¨æ¥ä¸‹æ¥çš„ 31536000 ç§’ï¼ˆå³ä¸€å¹´ï¼‰ä¸­ï¼Œå®¢æˆ·ç«¯å‘ example.com æˆ–å…¶å­åŸŸåå‘é€ HTTP è¯·æ±‚æ—¶ï¼Œå¿…é¡»é‡‡ç”¨HTTPSæ¥å‘èµ·è¿æ¥ã€‚ æ¯”å¦‚ç”¨æˆ·åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥ http://example.com/ æ—¶ï¼Œæµè§ˆå™¨åº”è‡ªåŠ¨å°† http æ”¹å†™ä¸º https å†å‘èµ·è¯·æ±‚ åœ¨æ¥ä¸‹æ¥çš„ 31536000 ç§’ï¼ˆå³ä¸€å¹´ï¼‰ä¸­ï¼Œå¦‚æœ example.com æœåŠ¡å™¨æä¾›çš„è¯ä¹¦æ— æ•ˆï¼Œç”¨æˆ·ä¸èƒ½å¿½ç•¥æµè§ˆå™¨çš„è¯ä¹¦è­¦å‘Šç»§ç»­è®¿é—®ç½‘ç«™ã€‚ ä¹Ÿå°±æ˜¯è¯´ä¸€æ—¦è¯ä¹¦å¤±æ•ˆï¼Œç«™ç‚¹å°†å®Œå…¨æ— æ³•è®¿é—®ï¼Œç›´è‡³æœåŠ¡ç«¯ä¿®å¤è¯ä¹¦é—®é¢˜ã€‚ ä¸€æ—¦è¯ä¹¦å¤±æ•ˆï¼ŒHTTPS å…¶å®å°±ä¸æ˜¯ä¸¥æ ¼å®‰å…¨çš„äº†ï¼Œå¯èƒ½ä¼šé­é‡ä¸­é—´äººæ”»å‡»ã€‚ä¹Ÿå°±æ˜¯è¯´ HSTS é€šè¿‡ç‰ºç‰²ç«™ç‚¹çš„å¯è®¿é—®æ€§æ¥é¿å…ä¸­é—´äººæ”»å‡»ã€‚ 4. TLS åè®®çš„é€†å‘æ‰‹æ®µè¦è·å–ä¸€ä¸ªåº”ç”¨çš„ HTTPS æ•°æ®ï¼Œæœ‰ä¸¤ä¸ªæ–¹å‘: æœåŠ¡ç«¯å…¥ä¾µ: ç°ä»£åº”ç”¨çš„æœåŠ¡ç«¯çªç ´éš¾åº¦é€šå¸¸éƒ½æ¯”è¾ƒå®¢æˆ·ç«¯é«˜ï¼Œæ³¨å…¥ç­‰æ¼æ´åº•å±‚æ¡†æ¶å°±æœ‰å¤„ç†ã€‚ ä¸è¿‡å¦‚æœä½ è·å¾—äº†æœåŠ¡å™¨ root æƒé™ï¼Œå¯ä»¥åœ¨ openssl ä¸Šåšæ–‡ç« ï¼Œæ¯”å¦‚ç¯¡æ”¹ opensslï¼Ÿ å®¢æˆ·ç«¯é€†å‘+çˆ¬è™«: å®¢æˆ·ç«¯æ˜¯ç¦»ç”¨æˆ·æœ€è¿‘çš„åœ°æ–¹ï¼Œä¹Ÿæ˜¯æœ€å®¹æ˜“è¢«çªç ´çš„åœ°æ–¹ã€‚ æ–¹æ³•ä¸€åœ¨å‰é¢ä»‹ç»è¿‡äº†ï¼Œå°±æ˜¯åœ¨å®¢æˆ·ç«¯ç³»ç»Ÿä¸­æå‰å®‰è£…ç§æœ‰ CA è¯ä¹¦ï¼Œå†é€šè¿‡ä»£ç†å·¥å…·è¿›è¡Œç›‘å¬ï¼Œè¿™ç§æ–¹æ³•èƒ½ç›‘å¬åˆ°æ‰€æœ‰æ™®é€š HTTP æµé‡ã€‚ å®‰å“ä¸Šå¯ä»¥é€šè¿‡ XPosed+JustTrustMe ç­‰æŠ€æœ¯ï¼Œç›´æ¥ Hook åº•å±‚ HTTP åº“ç»•è¿‡è¯ä¹¦æ£€æŸ¥ï¼Œå®ç°ç›‘å¬ HTTPS æµé‡ã€‚è¿™ç§æ–¹æ³•çš„ç¼ºç‚¹æ˜¯åªèƒ½ç›‘å¬é€‚é…çš„åº“ï¼Œæ‰€ä»¥ä»¥å‰æœ‰äººè¯´ flutter åº”ç”¨å®‰å…¨æ€§å¥½ï¼Œå› ä¸ºå®ƒæ¯”è¾ƒæ–°é²œï¼Œé€†å‘èµ„æ–™å°‘ï¼Œé€†å‘éš¾åº¦å°±é«˜ã€‚ å¯¹ mTLS è¿™ç±»æ›´å®‰å…¨çš„åè®®ï¼Œä¼šæ›´å¤æ‚äº›ã€‚ æˆ‘è§è¿‡çš„ç ´è§£æ‰‹æ®µä¹‹ä¸€ï¼šæ‰¾åˆ°è€ç‰ˆæœ¬çš„å®‰è£…åŒ…ï¼Œå‘ç°å¾ˆå®¹æ˜“å°±èƒ½æå–å‡ºå®¢æˆ·ç«¯è¯ä¹¦â€¦ wiki åˆ—å‡ºäº†ä¸€äº› TLS åè®®çš„å®‰å…¨é—®é¢˜ï¼šhttps://en.wikipedia.org/wiki/Transport_Layer_Security#Security TO BE DONEâ€¦ ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:4:4","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#3-https-ä¸¥æ ¼ä¼ è¾“å®‰å…¨---hsts"},{"categories":["tech"],"content":" 4. TLS åè®®æ”»é˜²æˆ˜è™½ç„¶ TLS åè®®æ˜¯ä¸€ä¸ªå®‰å…¨çš„åŠ å¯†åè®®ï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“å‘whistle / charles / fiddler ç­‰ä»£ç†è°ƒè¯•å·¥å…·ã€ä»¥åŠæ·±ä¿¡æœçš„ä¼ä¸šå‘˜å·¥æµé‡ç›‘æµ‹å·¥å…·ï¼Œéƒ½èƒ½å®ç°å¯¹ HTTPS æµé‡çš„ç›‘å¬ã€‚ å…¶åŸç†æ˜¯è¿™äº›ä»£ç†å·¥å…·ä¼šåœ¨å¯åŠ¨æ—¶é¦–å…ˆè¦æ±‚å°†å®ƒè‡ªå·±çš„ç§æœ‰ CA è¯ä¹¦æ·»åŠ åˆ°ç³»ç»Ÿè¯ä¹¦ä¸­ï¼Œè¿™æ ·å®¢æˆ·ç«¯ ï¼ˆæ‰‹æœº APP / æµè§ˆå™¨ç­‰åº”ç”¨ï¼‰åœ¨å»ºç«‹ TLS è¿æ¥æ—¶ä¼šè¢«ä»£ç†å·¥å…·æ‹¦æˆªï¼Œä»£ç†å·¥å…·è¿”å›ä¸€ä¸ªå®ƒä¼ªé€ çš„è¯ä¹¦ï¼Œè¯¥è¯ä¹¦ä¼šåŒ¹é…ä¸Šä¸Šä¸€æ­¥æå‰æ·»åŠ åˆ°ç³»ç»Ÿä¸­çš„ CA è¯ä¹¦ä»è€ŒæˆåŠŸå»ºç«‹è¿æ¥ã€‚åç»­å†ç”±ä»£ç†å·¥å…·å°†è¯·æ±‚è½¬å‘ç»™çœŸæ­£çš„æœåŠ¡ç«¯ï¼Œè¿™æ ·ä»£ç†å·¥å…·å°±èƒ½å®ç°å¯¹ HTTPS æµé‡çš„ç›‘å¬ã€‚ è¿™å®è´¨æ˜¯ä¸€æ¬¡ä¸­ç»§æ”»å‡»ï¼Œå…¶ä¸­æœ€å…³é”®çš„ä¸€æ­¥å°±æ˜¯ï¼Œå®ƒéœ€è¦åœ¨å®¢æˆ·ç«¯ç³»ç»Ÿä¸Šæ·»åŠ è‡ªå·±çš„ CA è¯ä¹¦ï¼Œè¿™æ ·å®¢æˆ·ç«¯å°±ä¼šä¿¡ä»»å®ƒä¼ªé€ çš„è¯ä¹¦ã€‚ è¯»è€…å¦‚æœè¯»åˆ°äº†è¿™é‡Œï¼Œå»ºè®®æ£€æŸ¥ä¸€ä¸‹è‡ªå·±ç³»ç»Ÿä¸­çš„è¯ä¹¦åˆ—è¡¨ï¼Œçœ‹çœ‹æ˜¯å¦æœ‰è¿™ç±»è¢«æ’å…¥çš„æ¶æ„è¯ä¹¦ï¼Œè‡ªå·±æµé‡è¢«ç›‘å¬äº†è€Œä¸è‡ªçŸ¥ã€‚ æ—¢ç„¶æœ‰æ”»å‡»æ‰‹æ®µï¼Œé‚£å°±æœ‰é˜²å¾¡æ‰‹æ®µï¼Œè®¸å¤šå¤§å‚çš„ APP éƒ½ä¼šä½¿ç”¨ä¸€äº›æŠ€æœ¯æ¥é˜²æ­¢è‡ªå·±çš„æµé‡è¢«ç›‘å¬ï¼Œä¸‹é¢ä»‹ç»å‡ ç§å¸¸è§çš„é˜²å¾¡æ‰‹æ®µã€‚ 1. è¯ä¹¦é”å®šï¼ˆCertificate Piningï¼‰æŠ€æœ¯å³ä½¿ä½¿ç”¨äº† TLS åè®®å¯¹æµé‡è¿›è¡ŒåŠ å¯†ï¼Œå¹¶ä¸”ä¿è¯äº†å‰å‘ä¿å¯†ï¼Œä¹Ÿæ— æ³•ä¿è¯æµé‡ä¸è¢«ä»£ç†ï¼ è¿™æ˜¯å› ä¸ºå®¢æˆ·ç«¯å¤§å¤šæ˜¯ç›´æ¥ä¾é äº†æ“ä½œç³»ç»Ÿå†…ç½®çš„ CA è¯ä¹¦åº“è¿›è¡Œè¯ä¹¦éªŒè¯ï¼Œè€Œ Fiddler ç­‰ä»£ç†å·¥å…·å¯ä»¥å°†è‡ªå·±çš„ CA è¯ä¹¦æ·»åŠ åˆ°è¯¥è¯ä¹¦åº“ä¸­ã€‚ ä¸ºäº†é˜²æ­¢æµé‡è¢« Fiddler ç­‰å·¥å…·ä½¿ç”¨ä¸Šè¿°æ–¹å¼ç›‘å¬æµé‡ï¼Œå‡ºç°äº†ã€Œè¯ä¹¦é”å®šï¼ˆCertificate Pining, æˆ–è€… SSL Pinningï¼‰ã€æŠ€æœ¯ã€‚æ–¹æ³•æ˜¯åœ¨å®¢æˆ·ç«¯ä¸­ç¡¬ç¼–ç è¯ä¹¦çš„æŒ‡çº¹ï¼ˆHashå€¼ï¼Œæˆ–è€…ç›´æ¥ä¿å­˜æ•´ä¸ªè¯ä¹¦çš„å†…å®¹ä¹Ÿè¡Œï¼‰ï¼Œåœ¨å»ºç«‹ TLS è¿æ¥å‰ï¼Œå…ˆè®¡ç®—ä½¿ç”¨çš„è¯ä¹¦çš„æŒ‡çº¹æ˜¯å¦åŒ¹é…ï¼Œå¦åˆ™å°±ä¸­æ–­è¿æ¥ã€‚ è¿™ç§é”å®šæ–¹å¼éœ€è¦ä»¥ä¸‹å‡ ä¸ªå‰ææ‰èƒ½ç¡®ä¿æµé‡ä¸è¢«ç›‘å¬: å®¢æˆ·ç«¯ä¸­ç¡¬ç¼–ç çš„è¯ä¹¦æŒ‡çº¹ä¸ä¼šè¢«ç¯¡æ”¹ã€‚ æŒ‡çº¹éªŒè¯ä¸èƒ½è¢«ç»•è¿‡ã€‚ ç›®å‰æœ‰å…¬å¼€æŠ€æœ¯ï¼ˆXPosed+JustTrustMeï¼‰èƒ½ç ´è§£ Android ä¸Šå¸¸è§çš„ HTTPS è¯·æ±‚åº“ï¼Œç›´æ¥ç»•è¿‡è¯ä¹¦æ£€æŸ¥ã€‚ é’ˆå¯¹ä¸Šè¿°é—®é¢˜ï¼Œå¯ä»¥è€ƒè™‘åŠ å¤§ç»•è¿‡çš„éš¾åº¦ã€‚æˆ–è€… App æ£€æµ‹è‡ªå·±æ˜¯å¦è¿è¡Œåœ¨ Xposed ç­‰è™šæ‹Ÿç¯å¢ƒä¸‹ã€‚ ç”¨äº TLS åè®®çš„è¯ä¹¦ä¸ä¼šé¢‘ç¹æ›´æ¢ã€‚ï¼ˆå¦‚æœæ›´æ¢äº†ï¼ŒæŒ‡çº¹å°±å¯¹ä¸ä¸Šäº†ã€‚ï¼‰ è€Œå¯¹äºç¬¬ä¸‰æ–¹çš„ APIï¼Œå› ä¸ºæˆ‘ä»¬ä¸çŸ¥é“å®ƒä»¬ä¼šä¸ä¼šæ›´æ¢ TLS è¯ä¹¦ï¼Œå°±ä¸èƒ½ç›´æ¥å°†è¯ä¹¦æŒ‡çº¹ç¡¬ç¼–ç åœ¨å®¢æˆ·ç«¯ä¸­ã€‚è¿™æ—¶å¯ä»¥è€ƒè™‘ä»æœåŠ¡ç«¯è·å–è¿™äº› API çš„è¯ä¹¦æŒ‡çº¹ï¼ˆé™„å¸¦ç§é’¥ç­¾åç”¨äºé˜²ä¼ªé€ ï¼‰ã€‚ ä¸ºäº†å®ç°è¯ä¹¦çš„è½®è½¬(rotation)ï¼Œå¯ä»¥åœ¨æ–°ç‰ˆæœ¬çš„å®¢æˆ·ç«¯ä¸­åŒ…å«å¤šä¸ªè¯ä¹¦æŒ‡çº¹ï¼Œè¿™æ ·èƒ½ä¿è¯åŒæ—¶æœ‰å¤šä¸ªå¯ä¿¡è¯ä¹¦ï¼Œè¾¾æˆè¯ä¹¦çš„è½®è½¬ã€‚ï¼ˆç±»æ¯” JWT çš„å…¬é’¥è½®è½¬æœºåˆ¶ï¼‰ è¯ä¹¦é”å®šæŠ€æœ¯å‡ ä¹ç­‰åŒäº SSH åè®®çš„ StrictHostKeyChecking é€‰é¡¹ï¼Œå®¢æˆ·ç«¯ä¼šéªŒè¯æœåŠ¡ç«¯çš„å…¬é’¥æŒ‡çº¹ï¼ˆkey fingerprintï¼‰ï¼ŒéªŒè¯ä¸é€šè¿‡åˆ™æ–­å¼€è¿æ¥ã€‚ 2. å…¬é’¥é”å®šï¼ˆPublic Key Piningï¼‰æŠ€æœ¯å‰é¢ä»‹ç»è¿‡è¯ä¹¦çš„ç»“æ„ï¼Œå®ƒå…¶å®åŒ…å«äº†å…¬é’¥ã€æœ‰æ•ˆæœŸä¸ä¸€ç³»åˆ—çš„å…¶ä»–ä¿¡æ¯ã€‚ä½¿ç”¨äº†è¯ä¹¦é”å®šæŠ€æœ¯ï¼Œä¼šå¯¼è‡´è¯ä¹¦çš„æœ‰æ•ˆæœŸä¹Ÿè¢«é”å®šï¼ŒAPK å†…çš„è¯ä¹¦æŒ‡çº¹å°±å¿…é¡»éšç€è¯ä¹¦ä¸€èµ·æ›´æ–°ã€‚ æ›´å¥½çš„åšæ³•æ˜¯ä»…é”å®šè¯ä¹¦ä¸­çš„å…¬é’¥ï¼Œå³ã€Œå…¬é’¥é”å®šã€æŠ€æœ¯ã€‚ã€Œå…¬é’¥é”å®šã€æ¯”ã€Œè¯ä¹¦é”å®šã€æ›´çµæ´»ï¼Œè¿™æ ·è¯ä¹¦æœ¬èº«å…¶å®å°±å¯ä»¥ç›´æ¥è½®è½¬äº†ï¼ˆè¯ä¹¦æœ‰è¿‡æœŸæ—¶é—´ï¼‰ï¼Œè€Œä¸éœ€è¦ä¸€ä¸ªæ—§è¯ä¹¦å’Œæ–°è¯ä¹¦å…±å­˜çš„ä¸­é—´æ—¶æœŸã€‚ ã€Œå…¬é’¥é”å®šã€æ˜¯æ›´æ¨èçš„é”å®šæŠ€æœ¯ã€‚ 3. HTTPS ä¸¥æ ¼ä¼ è¾“å®‰å…¨ - HSTSHSTSï¼Œå³ HTTP Strict Transport Securityï¼Œæ˜¯ä¸€é¡¹å®‰å…¨æŠ€æœ¯ï¼Œå®ƒå…è®¸æœåŠ¡ç«¯åœ¨è¿”å› HTTPS å“åº”æ—¶ï¼Œ é€šè¿‡ Headers æ˜ç¡®è¦æ±‚å®¢æˆ·ç«¯ï¼Œåœ¨ä¹‹åçš„ä¸€æ®µæ—¶é—´å†…å¿…é¡»ä½¿ç”¨å®‰å…¨çš„ HTTPS åè®®è®¿é—®æœåŠ¡ç«¯ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ç«™ç‚¹ https://example.com/ çš„å“åº”å¤´ä¸­æœ‰Strict-Transport-Security: max-age=31536000; includeSubDomainsï¼Œè¿™è¡¨ç¤ºæœåŠ¡ç«¯è¦æ±‚å®¢æˆ·ç«¯ ï¼ˆæ¯”å¦‚æµè§ˆå™¨ï¼‰ï¼š åœ¨æ¥ä¸‹æ¥çš„ 31536000 ç§’ï¼ˆå³ä¸€å¹´ï¼‰ä¸­ï¼Œå®¢æˆ·ç«¯å‘ example.com æˆ–å…¶å­åŸŸåå‘é€ HTTP è¯·æ±‚æ—¶ï¼Œå¿…é¡»é‡‡ç”¨HTTPSæ¥å‘èµ·è¿æ¥ã€‚ æ¯”å¦‚ç”¨æˆ·åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥ http://example.com/ æ—¶ï¼Œæµè§ˆå™¨åº”è‡ªåŠ¨å°† http æ”¹å†™ä¸º https å†å‘èµ·è¯·æ±‚ åœ¨æ¥ä¸‹æ¥çš„ 31536000 ç§’ï¼ˆå³ä¸€å¹´ï¼‰ä¸­ï¼Œå¦‚æœ example.com æœåŠ¡å™¨æä¾›çš„è¯ä¹¦æ— æ•ˆï¼Œç”¨æˆ·ä¸èƒ½å¿½ç•¥æµè§ˆå™¨çš„è¯ä¹¦è­¦å‘Šç»§ç»­è®¿é—®ç½‘ç«™ã€‚ ä¹Ÿå°±æ˜¯è¯´ä¸€æ—¦è¯ä¹¦å¤±æ•ˆï¼Œç«™ç‚¹å°†å®Œå…¨æ— æ³•è®¿é—®ï¼Œç›´è‡³æœåŠ¡ç«¯ä¿®å¤è¯ä¹¦é—®é¢˜ã€‚ ä¸€æ—¦è¯ä¹¦å¤±æ•ˆï¼ŒHTTPS å…¶å®å°±ä¸æ˜¯ä¸¥æ ¼å®‰å…¨çš„äº†ï¼Œå¯èƒ½ä¼šé­é‡ä¸­é—´äººæ”»å‡»ã€‚ä¹Ÿå°±æ˜¯è¯´ HSTS é€šè¿‡ç‰ºç‰²ç«™ç‚¹çš„å¯è®¿é—®æ€§æ¥é¿å…ä¸­é—´äººæ”»å‡»ã€‚ 4. TLS åè®®çš„é€†å‘æ‰‹æ®µè¦è·å–ä¸€ä¸ªåº”ç”¨çš„ HTTPS æ•°æ®ï¼Œæœ‰ä¸¤ä¸ªæ–¹å‘: æœåŠ¡ç«¯å…¥ä¾µ: ç°ä»£åº”ç”¨çš„æœåŠ¡ç«¯çªç ´éš¾åº¦é€šå¸¸éƒ½æ¯”è¾ƒå®¢æˆ·ç«¯é«˜ï¼Œæ³¨å…¥ç­‰æ¼æ´åº•å±‚æ¡†æ¶å°±æœ‰å¤„ç†ã€‚ ä¸è¿‡å¦‚æœä½ è·å¾—äº†æœåŠ¡å™¨ root æƒé™ï¼Œå¯ä»¥åœ¨ openssl ä¸Šåšæ–‡ç« ï¼Œæ¯”å¦‚ç¯¡æ”¹ opensslï¼Ÿ å®¢æˆ·ç«¯é€†å‘+çˆ¬è™«: å®¢æˆ·ç«¯æ˜¯ç¦»ç”¨æˆ·æœ€è¿‘çš„åœ°æ–¹ï¼Œä¹Ÿæ˜¯æœ€å®¹æ˜“è¢«çªç ´çš„åœ°æ–¹ã€‚ æ–¹æ³•ä¸€åœ¨å‰é¢ä»‹ç»è¿‡äº†ï¼Œå°±æ˜¯åœ¨å®¢æˆ·ç«¯ç³»ç»Ÿä¸­æå‰å®‰è£…ç§æœ‰ CA è¯ä¹¦ï¼Œå†é€šè¿‡ä»£ç†å·¥å…·è¿›è¡Œç›‘å¬ï¼Œè¿™ç§æ–¹æ³•èƒ½ç›‘å¬åˆ°æ‰€æœ‰æ™®é€š HTTP æµé‡ã€‚ å®‰å“ä¸Šå¯ä»¥é€šè¿‡ XPosed+JustTrustMe ç­‰æŠ€æœ¯ï¼Œç›´æ¥ Hook åº•å±‚ HTTP åº“ç»•è¿‡è¯ä¹¦æ£€æŸ¥ï¼Œå®ç°ç›‘å¬ HTTPS æµé‡ã€‚è¿™ç§æ–¹æ³•çš„ç¼ºç‚¹æ˜¯åªèƒ½ç›‘å¬é€‚é…çš„åº“ï¼Œæ‰€ä»¥ä»¥å‰æœ‰äººè¯´ flutter åº”ç”¨å®‰å…¨æ€§å¥½ï¼Œå› ä¸ºå®ƒæ¯”è¾ƒæ–°é²œï¼Œé€†å‘èµ„æ–™å°‘ï¼Œé€†å‘éš¾åº¦å°±é«˜ã€‚ å¯¹ mTLS è¿™ç±»æ›´å®‰å…¨çš„åè®®ï¼Œä¼šæ›´å¤æ‚äº›ã€‚ æˆ‘è§è¿‡çš„ç ´è§£æ‰‹æ®µä¹‹ä¸€ï¼šæ‰¾åˆ°è€ç‰ˆæœ¬çš„å®‰è£…åŒ…ï¼Œå‘ç°å¾ˆå®¹æ˜“å°±èƒ½æå–å‡ºå®¢æˆ·ç«¯è¯ä¹¦â€¦ wiki åˆ—å‡ºäº†ä¸€äº› TLS åè®®çš„å®‰å…¨é—®é¢˜ï¼šhttps://en.wikipedia.org/wiki/Transport_Layer_Security#Security TO BE DONEâ€¦ ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:4:4","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#4-tls-åè®®çš„é€†å‘æ‰‹æ®µ"},{"categories":["tech"],"content":" 5. åœ¨è¾¹ç¼˜ä¾§å¸è½½ TLSTLS åŠ å¯†æ˜¯ä¸€ä¸ªå®‰å…¨åè®®ï¼Œå·¥ç¨‹ä¸Šè™½ç„¶æœ‰ Google ç­‰å…¬å¸åŠ›æ¨æ‰€è°“ã€Œé›¶ä¿¡ä»»åŠ å¯†ã€æ–¹æ¡ˆï¼Œåœ¨æ‰€æœ‰é€šä¿¡åœºæ™¯ä¸‹éƒ½åº”ç”¨ mTLS ç­‰åŠ å¯†æŠ€æœ¯ã€‚ä½†æ˜¯ä¸ºäº†æˆæœ¬ä¸æ€§èƒ½è€ƒé‡ï¼Œç»å¤§éƒ¨åˆ†å…¬å¸éƒ½é€‰æ‹©ä»…åœ¨å…¬ç½‘ä½¿ç”¨ HTTPSï¼Œ åœ¨å¯ä¿¡å†…ç½‘åœºæ™¯ä¸‹ä½¿ç”¨çº¯ HTTPã€‚å…¶åšæ³•å°±æ˜¯åœ¨è¾¹ç¼˜ç½‘å…³å±‚å¸è½½ TLS åè®®ï¼Œå†å°†å†…éƒ¨çš„ HTTP è¯·æ±‚è´Ÿè½½å‡è¡¡åˆ°åç«¯æœåŠ¡ä¸Šã€‚ æ‰€è°“å¸è½½ TLS åè®®ï¼Œå°±æ˜¯æŒ‡å®ƒå¯¹å¤–æä¾› TLS åè®®ç«¯å£ï¼Œä½†æ˜¯ä½¿ç”¨ HTTP ç­‰è£¸åè®®ä¸ä¸Šæ¸¸æœåŠ¡é€šä¿¡ã€‚ åœ¨è¾¹ç¼˜ä¾§å¸è½½ HTTPS çš„å¥½å¤„ä¸»è¦æœ‰ï¼š å†…ç½‘ç¯å¢ƒéƒ½ä½¿ç”¨äº†çº¯ HTTPï¼Œæ€§èƒ½æ›´å¥½ï¼Œå»¶è¿Ÿæ›´ä½ï¼Œæˆæœ¬æ›´ä½ã€‚ å‚è§ä¸€ç¯‡è®² TLS çš„å¥½æ–‡åˆ†äº«ï¼Œå¦‚æœé€šè¿‡ CDN åœ¨è¾¹ç¼˜èŠ‚ç‚¹å¸è½½ TLSï¼Œç„¶åä½¿ç”¨çº¯ HTTP å›æºï¼Œèƒ½æ˜¾è‘—é™ä½è¯·æ±‚å»¶è¿Ÿã€‚ æˆ‘æœ¬äººå°±äº 2022 å¹´ï¼Œåœ¨ AWS ä¸Šé€šè¿‡è¿™ä¸ªæ‰‹æ®µä¼˜åŒ–äº†ä¸€æ³¢å¹¿å‘Šä¸šåŠ¡ API çš„å»¶è¿Ÿï¼Œå¹¿å‘Šæ”¶ç›Šæœ‰æ˜æ˜¾ä¸Šæ¶¨ã€‚ ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:4:5","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#5-åœ¨è¾¹ç¼˜ä¾§å¸è½½-tls"},{"categories":["tech"],"content":" ä¸‰ã€å…¶ä»–æ¨èè¯»ç‰© å†…å®¹ä¼šæœ‰äº›é‡å ï¼Œä½†å„æœ‰æ–°çŸ¥ å›¾è§£å¯†ç æŠ€æœ¯ - [æ—¥]ç»“åŸæµ© ç»™å·¥ç¨‹å¸ˆï¼šå…³äºè¯ä¹¦ï¼ˆcertificateï¼‰å’Œå…¬é’¥åŸºç¡€è®¾æ–½ï¼ˆPKIï¼‰çš„ä¸€åˆ‡ æœ‰å…³ TLS/SSL è¯ä¹¦ï¼ˆæˆ‘æ‰€çŸ¥é“çš„ï¼‰çš„ä¸€åˆ‡ - å¡ç“¦é‚¦å™¶ HTTPS éšç§å®‰å…¨çš„ä¸€äº›å®è·µ - Laisky ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:5:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#ä¸‰å…¶ä»–æ¨èè¯»ç‰©"},{"categories":["tech"],"content":" å››ã€å‚è€ƒ HTTPS æ¸©æ•…çŸ¥æ–°ï¼ˆä¸‰ï¼‰ â€”â€” ç›´è§‚æ„Ÿå— TLS æ¡æ‰‹æµç¨‹(ä¸Š) HTTPS æ¸©æ•…çŸ¥æ–°ï¼ˆäº”ï¼‰ â€”â€” TLS ä¸­çš„å¯†é’¥è®¡ç®— A complete overview of SSL/TLS and its cryptographic system Certificates - Kubernetes Docs è¯ä¹¦é€‰å‹å’Œè´­ä¹° - é˜¿é‡Œäº‘æ–‡æ¡£ äº‘åŸç”Ÿå®‰å…¨ç ´å±€ï½œå¦‚ä½•ç®¡ç†å‘¨æœŸè¶Šæ¥è¶ŠçŸ­çš„æ•°å­—è¯ä¹¦ï¼Ÿ å¦å¤–ä¸¤ä¸ªå…³äº CN(Common Name) å’Œ SAN(Subject Altnative Name) çš„é—®ç­”: Can not get rid of net::ERR_CERT_COMMON_NAME_INVALID error in chrome with self-signed certificates SSL - How do Common Names (CN) and Subject Alternative Names (SAN) work together? å…³äºè¯ä¹¦é”å®š/å…¬é’¥é”å®šæŠ€æœ¯: Certificate and Public Key Pinning - OWASP Difference between certificate pinning and public key pinning ","date":"2022-03-14","objectID":"/posts/about-tls-cert/:6:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","HTTPS","TLS","SSL","OpenSSL","PKI","æ•°å­—è¯ä¹¦","è¯ä¹¦","SSH","QUIC","HTTP/3","å®‰å…¨"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®®","uri":"/posts/about-tls-cert/#å››å‚è€ƒ"},{"categories":["tech"],"content":" æœ¬æ–‡éƒ¨åˆ†å†…å®¹ç¿»è¯‘è‡ª Practical-Cryptography-for-Developers-Bookï¼Œç¬”è€…è¡¥å……äº†å¯†ç å­¦å†å²ä»¥åŠ openssl å‘½ä»¤ç¤ºä¾‹ï¼Œå¹¶é‡å†™äº† RSA/ECC ç®—æ³•åŸç†ã€ä»£ç ç¤ºä¾‹ç­‰å†…å®¹ã€‚ è¿™ç¯‡æ–‡ç« ä¸­ä¼šæ¶‰åŠåˆ°ä¸€äº›æ•°è®ºçŸ¥è¯†ï¼Œæœ¬æ–‡ä¸ä¼šè¯¦ç»†ä»‹ç»è¿™äº›æ•°å­¦çŸ¥è¯†ï¼Œå¯ä»¥åœ¨æœ‰ç–‘æƒ‘çš„æ—¶å€™è‡ªè¡ŒæŸ¥æ‰¾ç›¸å…³çŸ¥è¯†ï¼Œæˆ–è€…é€‰æ‹©è·³è¿‡ç›¸å…³å†…å®¹ã€‚ ","date":"2022-03-09","objectID":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/:0:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","éå¯¹ç§°åŠ å¯†","å®‰å…¨","RSA","ECC"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC","uri":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/#"},{"categories":["tech"],"content":" ä¸€ã€å…¬é’¥å¯†ç å­¦ / éå¯¹ç§°å¯†ç å­¦åœ¨ä»‹ç»éå¯¹ç§°å¯†é’¥åŠ å¯†æ–¹æ¡ˆå’Œç®—æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆè¦äº†è§£å…¬é’¥å¯†ç å­¦çš„æ¦‚å¿µã€‚ ","date":"2022-03-09","objectID":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/:1:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","éå¯¹ç§°åŠ å¯†","å®‰å…¨","RSA","ECC"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC","uri":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/#ä¸€å…¬é’¥å¯†ç å­¦--éå¯¹ç§°å¯†ç å­¦"},{"categories":["tech"],"content":" å¯†ç å­¦çš„å†å²ä»ç¬¬ä¸€æ¬¡ä¸–ç•Œå¤§æˆ˜ã€ç¬¬äºŒæ¬¡ä¸–ç•Œå¤§æˆ˜åˆ° 1976 å¹´è¿™æ®µæ—¶æœŸå¯†ç çš„å‘å±•é˜¶æ®µï¼Œè¢«ç§°ä¸ºã€Œè¿‘ä»£å¯†ç é˜¶æ®µã€ã€‚åœ¨è¿‘ä»£å¯†ç é˜¶æ®µï¼Œæ‰€æœ‰çš„å¯†ç ç³»ç»Ÿéƒ½ä½¿ç”¨å¯¹ç§°å¯†ç ç®—æ³•â€”â€”ä½¿ç”¨ç›¸åŒçš„å¯†é’¥è¿›è¡ŒåŠ è§£å¯†ã€‚å½“æ—¶ä½¿ç”¨çš„å¯†ç ç®—æ³•åœ¨æ‹¥æœ‰æµ·é‡è®¡ç®—èµ„æºçš„ç°ä»£äººçœ‹æ¥éƒ½æ˜¯éå¸¸ç®€å•çš„ï¼Œæˆ‘ä»¬ç»å¸¸çœ‹åˆ°å„ç§è®²è¿°ä¸€äºŒæˆ˜çš„è°æˆ˜ç‰‡ï¼ŒåŸºæœ¬éƒ½åŒ…å«ç ´è¯‘ç”µæŠ¥çš„ç‰‡æ®µã€‚ ç¬¬ä¸€äºŒæ¬¡ä¸–ç•Œå¤§æˆ˜æœŸé—´ï¼Œæ— çº¿ç”µè¢«å¹¿æ³›åº”ç”¨äºå†›äº‹é€šè®¯ï¼Œå›´ç»•æ— çº¿ç”µé€šè®¯çš„åŠ å¯†ç ´è§£æ”»é˜²æˆ˜æå¤§åœ°å½±å“äº†æˆ˜å±€ã€‚ å…¬å…ƒ20ä¸–çºªåˆï¼Œç¬¬ä¸€æ¬¡ä¸–ç•Œå¤§æˆ˜è¿›è¡Œåˆ°å…³é”®æ—¶åˆ»ï¼Œè‹±å›½ç ´è¯‘å¯†ç çš„ä¸“é—¨æœºæ„ã€Œ40å·æˆ¿é—´ã€åˆ©ç”¨ç¼´è·çš„å¾·å›½å¯†ç æœ¬ç ´è¯‘äº†è‘—åçš„ã€Œé½é»˜å°”æ›¼ç”µæŠ¥ã€ï¼Œå…¶å†…å®¹æ˜¾ç¤ºå¾·å›½æ‰“ç®—è”åˆå¢¨è¥¿å“¥å¯¹æŠ—å¯èƒ½ä¼šå‚æˆ˜çš„ç¾å›½ï¼Œè¿™ä¿ƒä½¿ç¾å›½æ”¾å¼ƒä¸­ç«‹å¯¹å¾·å®£æˆ˜ï¼Œä»è€Œå½»åº•æ”¹å˜äº†ä¸€æˆ˜çš„èµ°åŠ¿ã€‚ 1943 å¹´ï¼Œç¾å›½ä»ç ´è¯‘çš„æ—¥æœ¬ç”µæŠ¥ä¸­å¾—çŸ¥å±±æœ¬äº”åå…­å°†äº 4 æœˆ 18 æ—¥ä¹˜ä¸­å‹è½°ç‚¸æœºï¼Œç”± 6 æ¶æˆ˜æ–—æœºæŠ¤èˆªï¼Œåˆ°ä¸­é€”å²›è§†å¯Ÿã€‚ç¾å›½æ€»ç»Ÿç½—æ–¯ç¦äº²è‡ªåšå‡ºå†³å®šæˆªå‡»å±±æœ¬ï¼Œå±±æœ¬ä¹˜åçš„é£æœºåœ¨å»å¾€ä¸­é€”å²›çš„è·¯ä¸Šè¢«ç¾å†›å‡»æ¯ï¼Œæˆ˜äº‰å¤©æ‰å±±æœ¬äº”åå…­æœºæ¯äººäº¡ï¼Œæ—¥æœ¬æµ·å†›ä»æ­¤ä¸€è¹¶ä¸æŒ¯ã€‚ æ­¤å¤–ï¼Œåœ¨äºŒæ¬¡ä¸–ç•Œå¤§æˆ˜ä¸­ï¼Œç¾å†›å°†å°ç¬¬å®‰çº³ç“¦éœåœŸè‘—è¯­è¨€ä½œä¸ºå¯†ç ä½¿ç”¨ï¼Œå¹¶ç‰¹åˆ«å¾å‹Ÿä½¿ç”¨å°ç¬¬å®‰çº³ç“¦éœé€šä¿¡å…µã€‚åœ¨äºŒæ¬¡ä¸–ç•Œå¤§æˆ˜æ—¥ç¾çš„å¤ªå¹³æ´‹æˆ˜åœºä¸Šï¼Œç¾å›½æµ·å†›å†›éƒ¨è®©åŒ—å¢¨è¥¿å“¥å’Œäºšå†æ¡‘é‚£å°ç¬¬å®‰çº³ç“¦éœæ—äººä½¿ç”¨çº³ç“¦éœè¯­è¿›è¡Œæƒ…æŠ¥ä¼ é€’ã€‚çº³ç“¦éœè¯­çš„è¯­æ³•ã€éŸ³è°ƒåŠè¯æ±‡éƒ½æä¸ºç‹¬ç‰¹ï¼Œä¸ä¸ºä¸–äººæ‰€çŸ¥é“ï¼Œå½“æ—¶çº³ç“¦éœæ—ä»¥å¤–çš„ç¾å›½äººä¸­ï¼Œèƒ½å¬æ‡‚è¿™ç§è¯­è¨€çš„ä¹Ÿå°±ä¸€äºŒåäººã€‚è¿™æ˜¯å¯†ç å­¦å’Œè¯­è¨€å­¦çš„æˆåŠŸç»“åˆï¼Œçº³ç“¦éœè¯­å¯†ç æˆä¸ºå†å²ä¸Šä»æœªè¢«ç ´è¯‘çš„å¯†ç ã€‚ åœ¨ 1976 å¹´ Malcolm J. Williamson å…¬å¼€å‘è¡¨äº†ç°åœ¨è¢«ç§°ä¸ºã€ŒDiffieâ€“Hellman å¯†é’¥äº¤æ¢ï¼ŒDHKEã€çš„ç®—æ³•ï¼Œå¹¶æå‡ºäº†ã€Œå…¬é’¥å¯†ç å­¦ã€çš„æ¦‚å¿µï¼Œè¿™æ˜¯å¯†ç å­¦é¢†åŸŸä¸€é¡¹åˆ’æ—¶ä»£çš„å‘æ˜ï¼Œå®ƒå®£å‘Šäº†ã€Œè¿‘ä»£å¯†ç é˜¶æ®µã€çš„ç»ˆç»“ï¼Œæ˜¯ã€Œç°ä»£å¯†ç å­¦ã€çš„èµ·ç‚¹ã€‚ è¨€å½’æ­£ä¼ ï¼Œå¯¹ç§°å¯†ç ç®—æ³•çš„é—®é¢˜æœ‰ä¸¤ç‚¹ï¼š ã€Œéœ€è¦å®‰å…¨çš„é€šé“è¿›è¡Œå¯†é’¥äº¤æ¢ã€ï¼Œæ—©æœŸæœ€å¸¸è§çš„æ˜¯é¢å¯¹é¢äº¤æ¢å¯†é’¥ æ¯ä¸ªç‚¹å¯¹ç‚¹é€šä¿¡éƒ½éœ€è¦ä½¿ç”¨ä¸åŒçš„å¯†é’¥ï¼Œå¯†é’¥çš„ç®¡ç†ä¼šå˜å¾—å¾ˆå›°éš¾ å¦‚æœä½ éœ€è¦è·Ÿ 100 ä¸ªæœ‹å‹å®‰å…¨é€šä¿¡ï¼Œä½ å°±è¦ç»´æŠ¤ 100 ä¸ªä¸åŒçš„å¯¹ç§°å¯†é’¥ï¼Œè€Œä¸”è¿˜å¾—ç¡®ä¿å®ƒä»¬ä¸æ³„æ¼ã€‚ è¿™ä¼šå¯¼è‡´å·¨å¤§çš„ã€Œå¯†é’¥äº¤æ¢ã€è·Ÿã€Œå¯†é’¥ä¿å­˜ä¸ç®¡ç†ã€çš„æˆæœ¬ã€‚ã€Œå…¬é’¥å¯†ç å­¦ã€æœ€å¤§çš„ä¼˜åŠ¿å°±æ˜¯ï¼Œå®ƒè§£å†³äº†è¿™ä¸¤ä¸ªé—®é¢˜ï¼š ã€Œå…¬é’¥å¯†ç å­¦ã€å¯ä»¥åœ¨ä¸å®‰å…¨çš„ä¿¡é“ä¸Šå®‰å…¨åœ°è¿›è¡Œå¯†é’¥äº¤æ¢ï¼Œç¬¬ä¸‰æ–¹å³ä½¿ç›‘å¬åˆ°é€šä¿¡è¿‡ç¨‹ï¼Œä½†æ˜¯ ï¼ˆå‡ ä¹ï¼‰æ— æ³•ç ´è§£å‡ºå¯†é’¥ã€‚ æ¯ä¸ªäººåªéœ€è¦å…¬å¼€è‡ªå·±çš„å…¬é’¥ï¼Œå°±å¯ä»¥è·Ÿå…¶ä»–ä»»ä½•äººå®‰å…¨åœ°é€šä¿¡ã€‚ å¦‚æœä½ éœ€è¦è·Ÿ 100 ä¸ªæœ‹å‹å®‰å…¨é€šä¿¡ï¼Œä½ ä»¬åªéœ€è¦å…¬å¼€è‡ªå·±çš„å…¬é’¥ã€‚å‘é€æ¶ˆæ¯æ—¶ä½¿ç”¨å¯¹æ–¹çš„å…¬é’¥åŠ å¯†ï¼Œæ¥æ”¶æ¶ˆæ¯æ—¶ä½¿ç”¨è‡ªå·±çš„ç§é’¥è§£å¯†å³å¯ã€‚ åªæœ‰ä½ è‡ªå·±çš„ç§é’¥éœ€è¦ä¿å¯†ï¼Œæ‰€æœ‰çš„å…¬é’¥éƒ½å¯ä»¥å…¬å¼€ï¼Œè¿™å°±æ˜¾è‘—é™ä½äº†å¯†é’¥çš„ç»´æŠ¤æˆæœ¬ã€‚ å› æ­¤å…¬é’¥å¯†ç å­¦æˆä¸ºäº†ç°ä»£å¯†ç å­¦çš„åŸºçŸ³ï¼Œè€Œã€Œå…¬é’¥å¯†ç å­¦ã€çš„è¯ç”Ÿæ—¶é—´ 1976 å¹´è¢«è®¤ä¸ºæ˜¯ç°ä»£å¯†ç å­¦çš„å¼€ç«¯ã€‚ ","date":"2022-03-09","objectID":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/:1:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","éå¯¹ç§°åŠ å¯†","å®‰å…¨","RSA","ECC"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC","uri":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/#å¯†ç å­¦çš„å†å²"},{"categories":["tech"],"content":" å…¬é’¥å¯†ç å­¦çš„æ¦‚å¿µå…¬é’¥å¯†ç ç³»ç»Ÿçš„å¯†é’¥å§‹ç»ˆä»¥å…¬é’¥ + ç§é’¥å¯¹çš„å½¢å¼å‡ºç°ï¼Œå…¬é’¥å¯†ç ç³»ç»Ÿæä¾›æ•°å­¦æ¡†æ¶å’Œç®—æ³•æ¥ç”Ÿæˆå…¬é’¥+ ç§é’¥å¯¹ã€‚å…¬é’¥é€šå¸¸ä¸æ‰€æœ‰äººå…±äº«ï¼Œè€Œç§é’¥åˆ™ä¿å¯†ã€‚å…¬é’¥å¯†ç ç³»ç»Ÿåœ¨è®¾è®¡æ—¶å°±ç¡®ä¿äº†åœ¨é¢„æœŸçš„ç®—åŠ›ä¸‹ï¼Œå‡ ä¹ä¸å¯èƒ½ä»å…¶å…¬å¼€çš„å…¬é’¥é€†å‘æ¼”ç®—å‡ºå¯¹åº”çš„ç§é’¥ã€‚ å…¬é’¥å¯†ç ç³»ç»Ÿä¸»è¦æœ‰ä¸‰å¤§ç”¨é€”ï¼šåŠ å¯†ä¸è§£å¯†ã€ç­¾åä¸éªŒè¯ã€å¯†é’¥äº¤æ¢ã€‚æ¯ç§ç®—æ³•éƒ½éœ€è¦ä½¿ç”¨åˆ°å…¬é’¥å’Œç§é’¥ï¼Œæ¯”å¦‚ç”±å…¬é’¥åŠ å¯†çš„æ¶ˆæ¯åªèƒ½ç”±ç§é’¥è§£å¯†ï¼Œç”±ç§é’¥ç­¾åçš„æ¶ˆæ¯éœ€è¦ç”¨å…¬é’¥éªŒè¯ã€‚ ç”±äºåŠ å¯†è§£å¯†ã€ç­¾åéªŒè¯å‡éœ€è¦ä¸¤ä¸ªä¸åŒçš„å¯†é’¥ï¼Œæ•…ã€Œå…¬é’¥å¯†ç å­¦ã€ä¹Ÿè¢«ç§°ä¸ºã€Œéå¯¹ç§°å¯†ç å­¦ã€ã€‚ æ¯”è¾ƒè‘—åçš„å…¬é’¥å¯†ç ç³»ç»Ÿæœ‰ï¼šRSAã€ECCï¼ˆæ¤­åœ†æ›²çº¿å¯†ç å­¦ï¼‰ã€ElGamalã€Diffie-Hellmanã€ECDHã€ECDSA å’Œ EdDSAã€‚è®¸å¤šå¯†ç ç®—æ³•éƒ½æ˜¯ä»¥è¿™äº›å¯†ç ç³»ç»Ÿä¸ºåŸºç¡€å®ç°çš„ï¼Œä¾‹å¦‚ RSA ç­¾åã€RSA åŠ å¯†/è§£å¯†ã€ECDH å¯†é’¥äº¤æ¢ä»¥åŠ ECDSA å’Œ EdDSA ç­¾åã€‚ ","date":"2022-03-09","objectID":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/:1:2","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","éå¯¹ç§°åŠ å¯†","å®‰å…¨","RSA","ECC"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC","uri":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/#å…¬é’¥å¯†ç å­¦çš„æ¦‚å¿µ"},{"categories":["tech"],"content":" é‡å­å®‰å…¨æ€§ å‚è€ƒæ–‡æ¡£ï¼šhttps://en.wikipedia.org/wiki/Post-quantum_cryptography ç›®å‰æµè¡Œçš„å…¬é’¥å¯†ç ç³»ç»ŸåŸºæœ¬éƒ½ä¾èµ–äº IFPï¼ˆæ•´æ•°åˆ†è§£é—®é¢˜ï¼‰ã€DLPï¼ˆç¦»æ•£å¯¹æ•°é—®é¢˜ï¼‰æˆ–è€… ECDLPï¼ˆæ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜ï¼‰ï¼Œè¿™å¯¼è‡´è¿™äº›ç®—æ³•éƒ½æ˜¯é‡å­ä¸å®‰å…¨ï¼ˆquantum-unsafeï¼‰çš„ã€‚ å¦‚æœäººç±»è¿›å…¥é‡å­æ—¶ä»£ï¼ŒIFP / DLP / ECDLP çš„éš¾åº¦å°†å¤§å¤§é™ä½ï¼Œç›®å‰æµè¡Œçš„ RSAã€ECCã€ElGamalã€Diffie-Hellmanã€ECDHã€ECDSA å’Œ EdDSA ç­‰å…¬é’¥å¯†ç ç®—æ³•éƒ½å°†è¢«æ·˜æ±°ã€‚ ç›®å‰å·²ç»æœ‰ä¸€äº›é‡å­å®‰å…¨çš„å…¬é’¥å¯†ç ç³»ç»Ÿé—®ä¸–ï¼Œä½†æ˜¯å› ä¸ºå®ƒä»¬éœ€è¦æ›´é•¿çš„å¯†é’¥ã€æ›´é•¿çš„ç­¾åç­‰åŸå› ï¼Œç›®å‰è¿˜æœªè¢«å¹¿æ³›ä½¿ç”¨ã€‚ ä¸€äº›é‡å­å®‰å…¨çš„å…¬é’¥å¯†ç ç®—æ³•ä¸¾ä¾‹ï¼šNewHopeã€NTRUã€GLYPHã€BLISSã€XMSSã€Picnic ç­‰ï¼Œ æœ‰å…´è¶£çš„å¯ä»¥è‡ªè¡Œæœç´¢ç›¸å…³æ–‡æ¡£ã€‚ ","date":"2022-03-09","objectID":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/:1:3","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","éå¯¹ç§°åŠ å¯†","å®‰å…¨","RSA","ECC"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC","uri":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/#é‡å­å®‰å…¨æ€§"},{"categories":["tech"],"content":" äºŒã€éå¯¹ç§°åŠ å¯†æ–¹æ¡ˆç®€ä»‹éå¯¹ç§°åŠ å¯†è¦æ¯”å¯¹ç§°åŠ å¯†å¤æ‚ï¼Œæœ‰å¦‚ä¸‹å‡ ä¸ªåŸå› ï¼š ä½¿ç”¨å¯†é’¥å¯¹è¿›è¡ŒåŠ è§£å¯†ï¼Œå¯¼è‡´å…¶ç®—æ³•æ›´ä¸ºå¤æ‚ åªèƒ½åŠ å¯†/è§£å¯†å¾ˆçŸ­çš„æ¶ˆæ¯ åœ¨ RSA ç³»ç»Ÿä¸­ï¼Œè¾“å…¥æ¶ˆæ¯éœ€è¦è¢«è½¬æ¢ä¸ºå¤§æ•´æ•°ï¼ˆä¾‹å¦‚ä½¿ç”¨ OAEP å¡«å……ï¼‰ï¼Œç„¶åæ‰èƒ½è¢«åŠ å¯†ä¸ºå¯†æ–‡ã€‚ï¼ˆå¯†æ–‡å®è´¨ä¸Šå°±æ˜¯å¦ä¸€ä¸ªå¤§æ•´æ•°ï¼‰ ä¸€äº›éå¯¹ç§°å¯†ç ç³»ç»Ÿï¼ˆå¦‚ ECCï¼‰ä¸ç›´æ¥æä¾›åŠ å¯†èƒ½åŠ›ï¼Œéœ€è¦ç»“åˆä½¿ç”¨æ›´å¤æ‚çš„æ–¹æ¡ˆæ‰èƒ½å®ç°åŠ è§£å¯† æ­¤å¤–ï¼Œéå¯¹ç§°å¯†ç æ¯”å¯¹ç§°å¯†ç æ…¢éå¸¸å¤šã€‚æ¯”å¦‚ RSA åŠ å¯†æ¯” AES æ…¢ 1000 å€ï¼Œè·Ÿ ChaCha20 å°±æ›´æ²¡æ³•æ¯”äº†ã€‚ ä¸ºäº†è§£å†³ä¸Šé¢æåˆ°çš„è¿™äº›å›°éš¾å¹¶æ”¯æŒåŠ å¯†ä»»æ„é•¿åº¦çš„æ¶ˆæ¯ï¼Œç°ä»£å¯†ç å­¦ä½¿ç”¨ã€Œéå¯¹ç§°åŠ å¯†æ–¹æ¡ˆã€æ¥å®ç°æ¶ˆæ¯åŠ è§£å¯†ã€‚åˆå› ä¸ºã€Œå¯¹ç§°åŠ å¯†æ–¹æ¡ˆã€å…·æœ‰é€Ÿåº¦å¿«ã€æ”¯æŒåŠ å¯†ä»»æ„é•¿åº¦æ¶ˆæ¯ç­‰ç‰¹æ€§ï¼Œã€Œéå¯¹ç§°åŠ å¯†æ–¹æ¡ˆã€é€šå¸¸ç»„åˆä½¿ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•ä¸éå¯¹ç§°åŠ å¯†ç®—æ³•ã€‚æ¯”å¦‚ã€Œå¯†é’¥å°è£…æœºåˆ¶ KEMï¼ˆkey encapsulation mechanisms)ï¼‰ã€ä¸ã€Œé›†æˆåŠ å¯†æ–¹æ¡ˆ IESï¼ˆIntegrated Encryption Schemeï¼‰ã€ ","date":"2022-03-09","objectID":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/:2:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","éå¯¹ç§°åŠ å¯†","å®‰å…¨","RSA","ECC"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC","uri":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/#äºŒéå¯¹ç§°åŠ å¯†æ–¹æ¡ˆç®€ä»‹"},{"categories":["tech"],"content":" 1. å¯†é’¥å°è£…æœºåˆ¶ KEMé¡¾åæ€ä¹‰ï¼ŒKEM å°±æ˜¯ä»…ä½¿ç”¨éå¯¹ç§°åŠ å¯†ç®—æ³•åŠ å¯†å¦ä¸€ä¸ªå¯†é’¥ï¼Œå®é™…æ•°æ®çš„åŠ è§£å¯†ç”±è¯¥å¯†é’¥å®Œæˆã€‚ å¯†é’¥å°è£…æœºåˆ¶ KEM çš„åŠ å¯†æµç¨‹ï¼ˆä½¿ç”¨å…¬é’¥åŠ å¯†ä¼ è¾“å¯¹ç§°å¯†é’¥ï¼‰ï¼š å¯†é’¥å°è£…æœºåˆ¶ KEM çš„è§£å¯†æµç¨‹ï¼ˆä½¿ç”¨ç§é’¥è§£å¯†å‡ºå¯¹ç§°å¯†é’¥ï¼Œç„¶åå†ä½¿ç”¨è¿™ä¸ªå¯¹ç§°å¯†é’¥è§£å¯†æ•°æ®ï¼‰ï¼š RSA-OAEP, RSA-KEM, ECIES-KEM å’Œ PSEC-KEM. éƒ½æ˜¯ KEM åŠ å¯†æ–¹æ¡ˆã€‚ å¯†é’¥å°è£…ï¼ˆKey encapsulationï¼‰ä¸å¯†é’¥åŒ…è£¹ï¼ˆKey wrappingï¼‰ä¸»è¦åŒºåˆ«åœ¨äºä½¿ç”¨çš„æ˜¯å¯¹ç§°åŠ å¯†ç®—æ³•ã€è¿˜æ˜¯éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼š å¯†é’¥å°è£…ï¼ˆKey encapsulationï¼‰æŒ‡ä½¿ç”¨éå¯¹ç§°å¯†ç ç®—æ³•çš„å…¬é’¥åŠ å¯†å¦ä¸€ä¸ªå¯†é’¥ã€‚ å¯†é’¥åŒ…è£¹ï¼ˆKey wrappingï¼‰æŒ‡ä½¿ç”¨å¯¹ç§°å¯†ç ç®—æ³•åŠ å¯†å¦ä¸€ä¸ªå¯†é’¥ã€‚ ","date":"2022-03-09","objectID":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/:2:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","éå¯¹ç§°åŠ å¯†","å®‰å…¨","RSA","ECC"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC","uri":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/#1-å¯†é’¥å°è£…æœºåˆ¶-kem"},{"categories":["tech"],"content":" 1. å¯†é’¥å°è£…æœºåˆ¶ KEMé¡¾åæ€ä¹‰ï¼ŒKEM å°±æ˜¯ä»…ä½¿ç”¨éå¯¹ç§°åŠ å¯†ç®—æ³•åŠ å¯†å¦ä¸€ä¸ªå¯†é’¥ï¼Œå®é™…æ•°æ®çš„åŠ è§£å¯†ç”±è¯¥å¯†é’¥å®Œæˆã€‚ å¯†é’¥å°è£…æœºåˆ¶ KEM çš„åŠ å¯†æµç¨‹ï¼ˆä½¿ç”¨å…¬é’¥åŠ å¯†ä¼ è¾“å¯¹ç§°å¯†é’¥ï¼‰ï¼š å¯†é’¥å°è£…æœºåˆ¶ KEM çš„è§£å¯†æµç¨‹ï¼ˆä½¿ç”¨ç§é’¥è§£å¯†å‡ºå¯¹ç§°å¯†é’¥ï¼Œç„¶åå†ä½¿ç”¨è¿™ä¸ªå¯¹ç§°å¯†é’¥è§£å¯†æ•°æ®ï¼‰ï¼š RSA-OAEP, RSA-KEM, ECIES-KEM å’Œ PSEC-KEM. éƒ½æ˜¯ KEM åŠ å¯†æ–¹æ¡ˆã€‚ å¯†é’¥å°è£…ï¼ˆKey encapsulationï¼‰ä¸å¯†é’¥åŒ…è£¹ï¼ˆKey wrappingï¼‰ä¸»è¦åŒºåˆ«åœ¨äºä½¿ç”¨çš„æ˜¯å¯¹ç§°åŠ å¯†ç®—æ³•ã€è¿˜æ˜¯éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼š å¯†é’¥å°è£…ï¼ˆKey encapsulationï¼‰æŒ‡ä½¿ç”¨éå¯¹ç§°å¯†ç ç®—æ³•çš„å…¬é’¥åŠ å¯†å¦ä¸€ä¸ªå¯†é’¥ã€‚ å¯†é’¥åŒ…è£¹ï¼ˆKey wrappingï¼‰æŒ‡ä½¿ç”¨å¯¹ç§°å¯†ç ç®—æ³•åŠ å¯†å¦ä¸€ä¸ªå¯†é’¥ã€‚ ","date":"2022-03-09","objectID":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/:2:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","éå¯¹ç§°åŠ å¯†","å®‰å…¨","RSA","ECC"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC","uri":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/#å¯†é’¥å°è£…key-encapsulationä¸å¯†é’¥åŒ…è£¹key-wrapping"},{"categories":["tech"],"content":" 2. é›†æˆåŠ å¯†æ–¹æ¡ˆ IESé›†æˆåŠ å¯†æ–¹æ¡ˆ (IES) åœ¨å¯†é’¥å°è£…æœºåˆ¶ï¼ˆKEMï¼‰çš„åŸºç¡€ä¸Šï¼Œæ·»åŠ äº†å¯†é’¥æ´¾ç”Ÿç®—æ³• KDFã€æ¶ˆæ¯è®¤è¯ç®—æ³• MAC ç­‰å…¶ä»–å¯†ç å­¦ç®—æ³•ä»¥è¾¾æˆæ›´é«˜çš„å®‰å…¨æ€§ã€‚ åœ¨ IES æ–¹æ¡ˆä¸­ï¼Œéå¯¹ç§°ç®—æ³•ï¼ˆå¦‚ RSA æˆ– ECCï¼‰è·Ÿ KEM ä¸€æ ·ï¼Œéƒ½æ˜¯ç”¨äºåŠ å¯†æˆ–å°è£…å¯¹ç§°å¯†é’¥ï¼Œç„¶åé€šè¿‡å¯¹ç§°å¯†é’¥ï¼ˆå¦‚ AES æˆ– Chacha20ï¼‰æ¥åŠ å¯†è¾“å…¥æ¶ˆæ¯ã€‚ DLIESï¼ˆç¦»æ•£å¯¹æ•°é›†æˆåŠ å¯†æ–¹æ¡ˆï¼‰å’Œ ECIESï¼ˆæ¤­åœ†æ›²çº¿é›†æˆåŠ å¯†æ–¹æ¡ˆï¼‰éƒ½æ˜¯ IES æ–¹æ¡ˆã€‚ ","date":"2022-03-09","objectID":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/:2:2","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","éå¯¹ç§°åŠ å¯†","å®‰å…¨","RSA","ECC"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC","uri":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/#2-é›†æˆåŠ å¯†æ–¹æ¡ˆ-ies"},{"categories":["tech"],"content":" ä¸‰ã€RSA å¯†ç ç³»ç»ŸRSA å¯†ç ç³»ç»Ÿæ˜¯æœ€æ—©çš„å…¬é’¥å¯†ç ç³»ç»Ÿä¹‹ä¸€ï¼Œå®ƒåŸºäºRSA é—®é¢˜å’Œæ•´æ•°åˆ†è§£é—®é¢˜ ï¼ˆIFPï¼‰çš„è®¡ç®—éš¾åº¦ã€‚RSA ç®—æ³•ä»¥å…¶ä½œè€…ï¼ˆRivestâ€“Shamirâ€“Adlemanï¼‰çš„é¦–å­—æ¯å‘½åã€‚ RSA ç®—æ³•åœ¨è®¡ç®—æœºå¯†ç å­¦çš„æ—©æœŸè¢«å¹¿æ³›ä½¿ç”¨ï¼Œè‡³ä»Šä»ç„¶æ˜¯æ•°å­—ä¸–ç•Œåº”ç”¨æœ€å¹¿æ³›çš„å¯†ç ç®—æ³•ã€‚ä½†æ˜¯éšç€ ECC å¯†ç å­¦çš„å‘å±•ï¼ŒECC æ­£åœ¨éå¯¹ç§°å¯†ç ç³»ç»Ÿä¸­æ…¢æ…¢å æ®ä¸»å¯¼åœ°ä½ï¼Œå› ä¸ºå®ƒæ¯” RSA å…·æœ‰æ›´é«˜çš„å®‰å…¨æ€§å’Œæ›´çŸ­çš„å¯†é’¥é•¿åº¦ã€‚ RSA ç®—æ³•æä¾›å¦‚ä¸‹å‡ ç§åŠŸèƒ½ï¼š å¯†é’¥å¯¹ç”Ÿæˆï¼šç”Ÿæˆéšæœºç§é’¥ï¼ˆé€šå¸¸å¤§å°ä¸º 1024-4096 ä½ï¼‰å’Œç›¸åº”çš„å…¬é’¥ã€‚ åŠ å¯†è§£å¯†ï¼šä½¿ç”¨å…¬é’¥åŠ å¯†æ¶ˆæ¯ï¼ˆæ¶ˆæ¯è¦å…ˆè½¬æ¢ä¸º [0â€¦key_length] èŒƒå›´å†…çš„æ•´æ•°ï¼‰ï¼Œç„¶åä½¿ç”¨å¯†é’¥è§£å¯†ã€‚ æ•°å­—ç­¾åï¼šç­¾ç½²æ¶ˆæ¯ï¼ˆä½¿ç”¨ç§é’¥ï¼‰å’ŒéªŒè¯æ¶ˆæ¯ç­¾åï¼ˆä½¿ç”¨å…¬é’¥ï¼‰ã€‚ æ•°å­—ç­¾åå®é™…ä¸Šæ˜¯é€šè¿‡ Hash ç®—æ³• + åŠ å¯†è§£å¯†åŠŸèƒ½å®ç°çš„ã€‚åé¢ä¼šä»‹ç»åˆ°ï¼Œå®ƒä¸ä¸€èˆ¬åŠ è§£å¯†æµç¨‹çš„åŒºåˆ«ï¼Œåœ¨äºæ•°å­—ç­¾åä½¿ç”¨ç§é’¥åŠ å¯†ï¼Œå†ä½¿ç”¨å…¬é’¥è§£å¯†ã€‚ å¯†é’¥äº¤æ¢ï¼šå®‰å…¨åœ°ä¼ è¾“å¯†é’¥ï¼Œç”¨äºä»¥åçš„åŠ å¯†é€šä¿¡ã€‚ RSA å¯ä»¥ä½¿ç”¨ä¸åŒé•¿åº¦çš„å¯†é’¥ï¼š1024ã€2048ã€3072ã€4096ã€8129ã€16384 ç”šè‡³æ›´å¤šä½ã€‚ç›®å‰ 3072 ä½åŠä»¥ä¸Šçš„å¯†é’¥é•¿åº¦è¢«è®¤ä¸ºæ˜¯å®‰å…¨çš„ï¼Œæ›¾ç»å¤§é‡ä½¿ç”¨çš„ 2048 ä½ RSA ç°åœ¨è¢«ç ´è§£çš„é£é™©åœ¨ä¸æ–­æå‡ï¼Œå·²ç»ä¸æ¨èä½¿ç”¨äº†ã€‚ æ›´é•¿çš„å¯†é’¥æä¾›æ›´é«˜çš„å®‰å…¨æ€§ï¼Œä½†ä¼šæ¶ˆè€—æ›´å¤šçš„è®¡ç®—æ—¶é—´ï¼ŒåŒæ—¶ç­¾åä¹Ÿä¼šå˜å¾—æ›´é•¿ï¼Œå› æ­¤éœ€è¦åœ¨å®‰å…¨æ€§å’Œé€Ÿåº¦ä¹‹é—´è¿›è¡Œæƒè¡¡ã€‚éå¸¸é•¿çš„ RSA å¯†é’¥ï¼ˆä¾‹å¦‚ 50000 ä½æˆ– 65536 ä½ï¼‰å¯¹äºå®é™…ä½¿ç”¨å¯èƒ½å¤ªæ…¢ï¼Œä¾‹å¦‚å¯†é’¥ç”Ÿæˆå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿåˆ°å‡ ä¸ªå°æ—¶ã€‚ ","date":"2022-03-09","objectID":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/:3:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","éå¯¹ç§°åŠ å¯†","å®‰å…¨","RSA","ECC"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC","uri":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/#ä¸‰rsa-å¯†ç ç³»ç»Ÿ"},{"categories":["tech"],"content":" RSA å¯†é’¥å¯¹ç”ŸæˆRSA å¯†é’¥å¯¹çš„ç”Ÿæˆè·Ÿæˆ‘ä»¬åœ¨æœ¬ç³»åˆ—æ–‡ç« çš„ç¬¬ 5 ç¯‡ä»‹ç»çš„ã€ŒDHKE å¯†é’¥äº¤æ¢ç®—æ³•ã€ä¼šæœ‰äº›ç±»ä¼¼ï¼Œä½†æ˜¯è¦æ›´å¤æ‚ä¸€ç‚¹ã€‚ é¦–å…ˆçœ‹ä¸‹æˆ‘ä»¬æ€ä¹ˆä½¿ç”¨ openssl ç”Ÿæˆä¸€ä¸ª 1024 ä½çš„ RSA å¯†é’¥å¯¹ï¼ˆä»…ç”¨åšæ¼”ç¤ºï¼Œå®é™…åº”ç”¨ä¸­å»ºè®® 3072 ä½ï¼‰ï¼š OpenSSL æ˜¯ç›®å‰ä½¿ç”¨æœ€å¹¿æ³›çš„ç½‘ç»œåŠ å¯†ç®—æ³•åº“ï¼Œæ”¯æŒéå¸¸å¤šæµè¡Œçš„ç°ä»£å¯†ç å­¦ç®—æ³•ï¼Œå‡ ä¹æ‰€æœ‰æ“ä½œç³»ç»Ÿéƒ½ä¼šå†…ç½® openssl. text # ç”Ÿæˆ 1024 ä½çš„ RSA ç§é’¥ â¯ openssl genrsa -out rsa-private-key.pem 1024 Generating RSA private key, 1024 bit long modulus .................+++ .....+++ e is 65537 (0x10001) # ä½¿ç”¨ç§é’¥ç”Ÿæˆå¯¹åº”çš„å…¬é’¥æ–‡ä»¶ â¯ openssl rsa -in rsa-private-key.pem -pubout -out rsa-public-key.pem writing RSA key # æŸ¥çœ‹ç§é’¥å†…å®¹ â¯ cat rsa-private-key.pem -----BEGIN RSA PRIVATE KEY----- MIICXAIBAAKBgQDNE8QZLJZXREOeWZ2ilAzGC4Kjq/PfsFzrXGj8g3IaS4/J3JrB o3qEq/k9XoRzOmNPyvWCj2FAY7A099d7qX4ztthBpUM2ePDIYDvhL0EpfQqbhe+Q aagcFpuKTshGR2wBjH0Cl1/WxJkfIUMmWYU+m4iKLw9KfLX6BjmSgWB6HQIDAQAB AoGADb5NXgKG8MI6ZdpLniGd2Yfb8WwMo+kF0SAYSRPmCa0WrciC9ocmJs3/ngU/ ixlWnnpTibRiKBaGMIaLglYRhvbvibUo8PH4woIidTho2e6swF2aqILk6YFJDpxX FCFdbXM4Cm2MqbD4VtmhCYqbvuiyEUci83YrRP0jJGNt0GECQQDyZgdi8JlFQFH8 1QRHjLN57v5bHQamv7Qb77hlbdbg1wTYO+H8tsOB181TEHA7uN8hxkzyYZy+goRx n0hvJcQXAkEA2JWhCb7oG1eal1aUdgofxhlWnkoFeWHay2zgDWSqmGKyDt0Cb1jq XTdN9dchnqfptWN2/QPLDgM+/9g39/zv6wJATC1sXNeoE29nVMHNGn9JWCSXoyK4 GGdevvjTRm0Cfp6UUzBekQEO6Btd16Du5JXw6bhcLkAm9mgmH18jcGq5+QJBALnr aDv3d0PRZdE372WMt03UfniOzjgueiVaJtMYcSEyx+reabKvvy+ZxACfVirdtU+S PJhhYzN6MeBp+VGV/VUCQBXz0LyM08roWi6DiaRwJIbYx+WCKEOGXQ9QsZND+sGr pOpugr3mcUge5dcZGKtsOUx2xRVmg88nSWMQVkTlsjQ= -----END RSA PRIVATE KEY----- # æŸ¥çœ‹ç§é’¥çš„è¯¦ç»†å‚æ•° â¯ openssl rsa -noout -text -in rsa-private-key.pem Private-Key: (1024 bit) modulus: 00:cd:13:c4:19:2c:96:57:44:43:9e:59:9d:a2:94: 0c:c6:0b:82:a3:ab:f3:df:b0:5c:eb:5c:68:fc:83: 72:1a:4b:8f:c9:dc:9a:c1:a3:7a:84:ab:f9:3d:5e: 84:73:3a:63:4f:ca:f5:82:8f:61:40:63:b0:34:f7: d7:7b:a9:7e:33:b6:d8:41:a5:43:36:78:f0:c8:60: 3b:e1:2f:41:29:7d:0a:9b:85:ef:90:69:a8:1c:16: 9b:8a:4e:c8:46:47:6c:01:8c:7d:02:97:5f:d6:c4: 99:1f:21:43:26:59:85:3e:9b:88:8a:2f:0f:4a:7c: b5:fa:06:39:92:81:60:7a:1d publicExponent: 65537 (0x10001) privateExponent: 0d:be:4d:5e:02:86:f0:c2:3a:65:da:4b:9e:21:9d: d9:87:db:f1:6c:0c:a3:e9:05:d1:20:18:49:13:e6: 09:ad:16:ad:c8:82:f6:87:26:26:cd:ff:9e:05:3f: 8b:19:56:9e:7a:53:89:b4:62:28:16:86:30:86:8b: 82:56:11:86:f6:ef:89:b5:28:f0:f1:f8:c2:82:22: 75:38:68:d9:ee:ac:c0:5d:9a:a8:82:e4:e9:81:49: 0e:9c:57:14:21:5d:6d:73:38:0a:6d:8c:a9:b0:f8: 56:d9:a1:09:8a:9b:be:e8:b2:11:47:22:f3:76:2b: 44:fd:23:24:63:6d:d0:61 prime1: 00:f2:66:07:62:f0:99:45:40:51:fc:d5:04:47:8c: b3:79:ee:fe:5b:1d:06:a6:bf:b4:1b:ef:b8:65:6d: d6:e0:d7:04:d8:3b:e1:fc:b6:c3:81:d7:cd:53:10: 70:3b:b8:df:21:c6:4c:f2:61:9c:be:82:84:71:9f: 48:6f:25:c4:17 prime2: 00:d8:95:a1:09:be:e8:1b:57:9a:97:56:94:76:0a: 1f:c6:19:56:9e:4a:05:79:61:da:cb:6c:e0:0d:64: aa:98:62:b2:0e:dd:02:6f:58:ea:5d:37:4d:f5:d7: 21:9e:a7:e9:b5:63:76:fd:03:cb:0e:03:3e:ff:d8: 37:f7:fc:ef:eb exponent1: 4c:2d:6c:5c:d7:a8:13:6f:67:54:c1:cd:1a:7f:49: 58:24:97:a3:22:b8:18:67:5e:be:f8:d3:46:6d:02: 7e:9e:94:53:30:5e:91:01:0e:e8:1b:5d:d7:a0:ee: e4:95:f0:e9:b8:5c:2e:40:26:f6:68:26:1f:5f:23: 70:6a:b9:f9 exponent2: 00:b9:eb:68:3b:f7:77:43:d1:65:d1:37:ef:65:8c: b7:4d:d4:7e:78:8e:ce:38:2e:7a:25:5a:26:d3:18: 71:21:32:c7:ea:de:69:b2:af:bf:2f:99:c4:00:9f: 56:2a:dd:b5:4f:92:3c:98:61:63:33:7a:31:e0:69: f9:51:95:fd:55 coefficient: 15:f3:d0:bc:8c:d3:ca:e8:5a:2e:83:89:a4:70:24: 86:d8:c7:e5:82:28:43:86:5d:0f:50:b1:93:43:fa: c1:ab:a4:ea:6e:82:bd:e6:71:48:1e:e5:d7:19:18: ab:6c:39:4c:76:c5:15:66:83:cf:27:49:63:10:56: 44:e5:b2:34 # æŸ¥çœ‹å…¬é’¥å†…å®¹ â¯ cat rsa-public-key.pem -----BEGIN PUBLIC KEY----- MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDNE8QZLJZXREOeWZ2ilAzGC4Kj q/PfsFzrXGj8g3IaS4/J3JrBo3qEq/k9XoRzOmNPyvWCj2FAY7A099d7qX4ztthB pUM2ePDIYDvhL0EpfQqbhe+QaagcFpuKTshGR2wBjH0Cl1/WxJkfIUMmWYU+m4iK Lw9KfLX6BjmSgWB6HQIDAQAB -----END PUBLIC KEY----- # æŸ¥çœ‹å…¬é’¥çš„å‚æ•° â¯ openssl rsa -noout -text -pubin -in rsa-public-key.pem Public-Key: (1024 bit) Modulus: 00:cd:13:c4:19:2c:96:57:44:43:9e:59:9d:a2:94: 0c:c6:0b:82:a3:ab:f3:df:b0:5c:eb:5c:68:fc:83: 72:1a:4b:8f:c9:dc:9a:c1:a3:7a:84:ab:f9:3d:5e: 84:73:3a:63:4f:ca:f5:82:8f:61:40:63:b0:34:f7: d7:7b:a9:7e:33:b6:d8:41:a5:43:36:78:f0:c8:60: 3b:","date":"2022-03-09","objectID":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/:3:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","éå¯¹ç§°åŠ å¯†","å®‰å…¨","RSA","ECC"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC","uri":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/#rsa-å¯†é’¥å¯¹ç”Ÿæˆ"},{"categories":["tech"],"content":" RSA åŠ å¯†ä¸è§£å¯†RSA åŠ å¯†ç®—æ³•ï¼Œä¸€æ¬¡åªèƒ½åŠ å¯†ä¸€ä¸ªå°äº $n$ çš„éè´Ÿæ•´æ•°ï¼Œå‡è®¾æ˜æ–‡ä¸ºæ•´æ•° $msg$ï¼ŒåŠ å¯†ç®—æ³•å¦‚ä¸‹ï¼š $$ \\text{encryptedMsg} = msg^e \\mod n $$ é€šå¸¸çš„æ‰‹æ®µæ˜¯ï¼Œå…ˆä½¿ç”¨EAOP å°†è¢«åŠ å¯†æ¶ˆæ¯ç¼–ç æˆä¸€ä¸ªä¸ªç¬¦åˆæ¡ä»¶çš„æ•´æ•°ï¼Œå†ä½¿ç”¨ä¸Šè¿°å…¬å¼ä¸€ä¸ªä¸ªåŠ å¯†ã€‚ è§£å¯†çš„æ–¹æ³•ï¼Œå°±æ˜¯å¯¹è¢«æ¯ä¸€æ®µåŠ å¯†çš„æ•°æ® $encryptedMsg$ï¼Œè¿›è¡Œå¦‚ä¸‹è¿ç®—ï¼š $$ \\text{decryptedMsg} = \\text{encryptedMsg}^d \\mod n $$ RSA è§£å¯†è¿ç®—çš„è¯æ˜ è¿™é‡Œçš„è¯æ˜éœ€è¦ç”¨åˆ°ä¸€äº›æ•°è®ºçŸ¥è¯†ï¼Œè§‰å¾—ä¸å®¹æ˜“ç†è§£çš„è¯ï¼Œå»ºè®®è‡ªè¡ŒæŸ¥æ‰¾ç›¸å…³èµ„æ–™ã€‚ è¯æ˜æµç¨‹å¦‚ä¸‹ï¼š $$ \\begin{alignedat}{2} \\text{decryptedMsg} \u0026= \u0026\\text{encryptedMsg}^d \u0026\\mod n \\\\ \u0026= \u0026{(msg^e \\mod n)}^d \u0026\\mod n \\\\ \u0026= \u0026{msg^{ed}} \u0026\\mod n \\\\ \u0026= \u0026{msg^{ed}} \u0026\\mod {pq} \\end{alignedat} $$ æ¥ä¸‹æ¥å°†ä¸‹é¢ä¸¤ä¸ªç­‰å¼ä»£å…¥ä¸Šè¿°è®¡ç®—ä¸­ï¼š æˆ‘ä»¬åœ¨å‰é¢çš„ã€Œå¯†é’¥å¯¹ç”Ÿæˆã€ä¸€èŠ‚ä¸­æœ‰ç»™å‡ºç­‰å¼ï¼š$ed = 1 + (p-1)(q-1) \\cdot k$ å› ä¸º $0 \\le msg \\lt n$ ä»¥åŠ $n = pq$ï¼Œæœ‰ $msg \\mod pq = msg$ è¿™æ ·å°±å¾—åˆ°ï¼š $$ \\begin{alignedat}{2} \\text{decryptedMsg} \u0026= \u0026{msg^{ed}} \u0026\\mod {pq} \\\\ \u0026= \u0026{(msg \\mod pq) \\cdot (msg^{ed-1} \\mod pq)} \u0026\\mod {pq} \\\\ \u0026= \u0026{msg \\cdot (msg^{(p-1)(q-1) \\cdot k} \\mod pq)} \u0026\\mod {pq} \\end{alignedat} $$ åˆæœ‰è´¹é©¬å°å®šç†æŒ‡å‡ºï¼Œåœ¨ $a$ ä¸ºæ•´æ•°ï¼Œ$p$ ä¸ºè´¨æ•°çš„æƒ…å†µä¸‹ï¼Œæœ‰åŒä½™ç­‰å¼ $$a^{p-1} \\equiv 1 {\\pmod p}$$ å› ä¸ºæˆ‘ä»¬çš„æ¨¡æ•° $n=pq$ å¹¶ä¸æ˜¯è´¨æ•°ï¼Œä¸èƒ½ç›´æ¥åˆ©ç”¨è´¹é©¬å°å®šç†ç»™å‡ºçš„åŒä½™å…¬å¼ã€‚ä½†æ˜¯ $p$, $q$ ä¸¤æ•°éƒ½ä¸ºè´¨æ•°ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†åˆ«è®¡ç®—æ–¹ç¨‹ å¯¹ $p$ ä»¥åŠ $q$ å–æ¨¡çš„ç»“æœï¼Œç„¶åå†æ ¹æ®ä¸­å›½å‰©ä½™å®šç†å¾—å‡ºé€šè§£ï¼Œä¹Ÿå°±å¾—åˆ°æˆ‘ä»¬éœ€è¦çš„ç»“æœã€‚ å¯¹äºæ¨¡ $p$ çš„æƒ…å†µï¼Œè®¡ç®—æ–¹æ³•å¦‚ä¸‹ï¼š å½“ $msg = 0 \\mod p$ æ—¶ï¼Œ${msg^{ed}} \\mod p = 0 \\equiv msg \\pmod p$ å½“ $msg \\ne 0 \\mod p$ æ—¶ï¼Œåˆ©ç”¨è´¹é©¬å°å®šç†ï¼Œæœ‰ $$ \\begin{alignedat}{2} msg^{ed} \u0026= \u0026{msg \\cdot (msg^{(p-1)(q-1) \\cdot k} \\mod p)} \u0026\\pmod {p} \\\\ \u0026= \u0026msg \\cdot (msg^{(p-1)} \\mod p)^{(q-1) \\cdot k} \u0026\\pmod p \\\\ \u0026= \u0026msg \\cdot 1^{(q-1) \\cdot k} \u0026\\pmod p \\\\ \u0026\\equiv \u0026msg \\pmod p \\end{alignedat} $$ åŒç†ï¼Œå¯¹æ¨¡ $q$ çš„æƒ…å†µï¼Œä¹Ÿèƒ½å¾—åˆ°ç­‰å¼ $$msg^{ed} \\equiv msg \\pmod q$$ æœ‰äº†ä¸Šé¢ä¸¤ä¸ªç»“æœï¼Œæ ¹æ®ä¸­å›½å‰©ä½™å®šç†ï¼Œå°±èƒ½å¾—åˆ° $$msg^{ed} \\equiv msg \\pmod {pq}$$ ç°åœ¨å†æ¥ç»­å‰é¢çš„è®¡ç®—ï¼š $$ \\begin{alignedat}{2} \\text{decryptedMsg} \u0026= \u0026{msg^{ed}} \u0026\\pmod {pq} \\\\ \u0026= \u0026msg \u0026\\pmod {pq} \\\\ \u0026= \u0026msg \\end{alignedat} $$ è¿™æ ·å°±è¯æ˜äº†ï¼Œè§£å¯†æ“ä½œå¾—åˆ°çš„å°±æ˜¯åŸå§‹ä¿¡æ¯ã€‚ å› ä¸ºéå¯¹ç§°åŠ è§£å¯†éå¸¸æ…¢ï¼Œå¯¹äºè¾ƒå¤§çš„æ–‡ä»¶ï¼Œé€šå¸¸ä¼šåˆ†æˆä¸¤æ­¥åŠ å¯†æ¥æå‡æ€§èƒ½ï¼šé¦–å…ˆç”¨ä½¿ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•æ¥åŠ å¯†æ•°æ®ï¼Œå†ä½¿ç”¨ RSA ç­‰éå¯¹ç§°åŠ å¯†ç®—æ³•åŠ å¯†ä¸Šä¸€æ­¥ç”¨åˆ°çš„ã€Œå¯¹ç§°å¯†é’¥ã€ã€‚ ä¸‹é¢æˆ‘ä»¬ç”¨ Python æ¥éªŒè¯ä¸‹ RSA ç®—æ³•çš„åŠ è§£å¯†æµç¨‹ï¼š python # pip install cryptography==36.0.1 from pathlib import Path from cryptography.hazmat.primitives import serialization # ç§é’¥ key_path = Path(\"./rsa-private-key.pem\") private_key = serialization.load_pem_private_key( key_path.read_bytes(), password=None, ) private = private_key.private_numbers() public = private_key.public_key().public_numbers() d = private.d # å…¬é’¥ n = public.n e = public.e def int_to_bytes(x: int) -\u003e bytes: return x.to_bytes((x.bit_length() + 7) // 8, 'big') def int_from_bytes(xbytes: bytes) -\u003e int: return int.from_bytes(xbytes, 'big') def fast_power_modular(b: int, p: int, m: int): \"\"\" å¿«é€Ÿæ¨¡å¹‚è¿ç®—ï¼šb^p % m å¤æ‚åº¦ï¼š O(log p) å› ä¸º RSA çš„åº•æ•°è·ŸæŒ‡æ•°éƒ½éå¸¸å¤§ï¼Œå¦‚æœå…ˆè¿›è¡Œå¹‚è¿ç®—ï¼Œæœ€åå†å–æ¨¡ï¼Œè®¡ç®—ç»“æœä¼šè¶Šæ¥è¶Šå¤§ï¼Œå¯¼è‡´é€Ÿåº¦éå¸¸éå¸¸æ…¢ æ ¹æ®æ¨¡å¹‚è¿ç®—çš„æ€§è´¨ b^(ab) % m = (b^a % m)^b % m, å¯ä»¥é€šè¿‡è¾¹è¿›è¡Œå¹‚è¿ç®—è¾¹å–æ¨¡ï¼Œæå¤§åœ°æå‡è®¡ç®—é€Ÿåº¦ \"\"\" res = 1 while p: if p \u0026 0x1: res *= b b = b ** 2 % m p \u003e\u003e= 1 return res % m # æ˜æ–‡ original_msg = b\"an example\" print(f\"{original_msg=}\") # åŠ å¯† msg_int = int_from_bytes(original_msg) encrypt_int = msg_int ** e % n encrypt_msg = int_to_bytes(encrypt_int) print(f\"{encrypt_msg=}\") # è§£å¯† # decrypt_int = encrypt_int ** d % n # å› ä¸º d éå¸¸å¤§ï¼Œç›´æ¥ä½¿ç”¨å…¬å¼è®¡ç®—ä¼šéå¸¸éå¸¸æ…¢ï¼Œæ‰€ä»¥ä¸èƒ½è¿™ä¹ˆç®— decrypt_int = fast_power_modular(encrypt_int, d, n) decrypt_msg = int_to_bytes(decrypt_int) print(f\"{decrypt_msg=}\") # åº”è¯¥ä¸åŸä¿¡æ¯å®Œå…¨ä¸€è‡´ ","date":"2022-03-09","objectID":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/:3:2","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","éå¯¹ç§°åŠ å¯†","å®‰å…¨","RSA","ECC"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC","uri":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/#rsa-åŠ å¯†ä¸è§£å¯†"},{"categories":["tech"],"content":" RSA åŠ å¯†ä¸è§£å¯†RSA åŠ å¯†ç®—æ³•ï¼Œä¸€æ¬¡åªèƒ½åŠ å¯†ä¸€ä¸ªå°äº $n$ çš„éè´Ÿæ•´æ•°ï¼Œå‡è®¾æ˜æ–‡ä¸ºæ•´æ•° $msg$ï¼ŒåŠ å¯†ç®—æ³•å¦‚ä¸‹ï¼š $$ \\text{encryptedMsg} = msg^e \\mod n $$ é€šå¸¸çš„æ‰‹æ®µæ˜¯ï¼Œå…ˆä½¿ç”¨EAOP å°†è¢«åŠ å¯†æ¶ˆæ¯ç¼–ç æˆä¸€ä¸ªä¸ªç¬¦åˆæ¡ä»¶çš„æ•´æ•°ï¼Œå†ä½¿ç”¨ä¸Šè¿°å…¬å¼ä¸€ä¸ªä¸ªåŠ å¯†ã€‚ è§£å¯†çš„æ–¹æ³•ï¼Œå°±æ˜¯å¯¹è¢«æ¯ä¸€æ®µåŠ å¯†çš„æ•°æ® $encryptedMsg$ï¼Œè¿›è¡Œå¦‚ä¸‹è¿ç®—ï¼š $$ \\text{decryptedMsg} = \\text{encryptedMsg}^d \\mod n $$ RSA è§£å¯†è¿ç®—çš„è¯æ˜ è¿™é‡Œçš„è¯æ˜éœ€è¦ç”¨åˆ°ä¸€äº›æ•°è®ºçŸ¥è¯†ï¼Œè§‰å¾—ä¸å®¹æ˜“ç†è§£çš„è¯ï¼Œå»ºè®®è‡ªè¡ŒæŸ¥æ‰¾ç›¸å…³èµ„æ–™ã€‚ è¯æ˜æµç¨‹å¦‚ä¸‹ï¼š $$ \\begin{alignedat}{2} \\text{decryptedMsg} \u0026= \u0026\\text{encryptedMsg}^d \u0026\\mod n \\\\ \u0026= \u0026{(msg^e \\mod n)}^d \u0026\\mod n \\\\ \u0026= \u0026{msg^{ed}} \u0026\\mod n \\\\ \u0026= \u0026{msg^{ed}} \u0026\\mod {pq} \\end{alignedat} $$ æ¥ä¸‹æ¥å°†ä¸‹é¢ä¸¤ä¸ªç­‰å¼ä»£å…¥ä¸Šè¿°è®¡ç®—ä¸­ï¼š æˆ‘ä»¬åœ¨å‰é¢çš„ã€Œå¯†é’¥å¯¹ç”Ÿæˆã€ä¸€èŠ‚ä¸­æœ‰ç»™å‡ºç­‰å¼ï¼š$ed = 1 + (p-1)(q-1) \\cdot k$ å› ä¸º $0 \\le msg \\lt n$ ä»¥åŠ $n = pq$ï¼Œæœ‰ $msg \\mod pq = msg$ è¿™æ ·å°±å¾—åˆ°ï¼š $$ \\begin{alignedat}{2} \\text{decryptedMsg} \u0026= \u0026{msg^{ed}} \u0026\\mod {pq} \\\\ \u0026= \u0026{(msg \\mod pq) \\cdot (msg^{ed-1} \\mod pq)} \u0026\\mod {pq} \\\\ \u0026= \u0026{msg \\cdot (msg^{(p-1)(q-1) \\cdot k} \\mod pq)} \u0026\\mod {pq} \\end{alignedat} $$ åˆæœ‰è´¹é©¬å°å®šç†æŒ‡å‡ºï¼Œåœ¨ $a$ ä¸ºæ•´æ•°ï¼Œ$p$ ä¸ºè´¨æ•°çš„æƒ…å†µä¸‹ï¼Œæœ‰åŒä½™ç­‰å¼ $$a^{p-1} \\equiv 1 {\\pmod p}$$ å› ä¸ºæˆ‘ä»¬çš„æ¨¡æ•° $n=pq$ å¹¶ä¸æ˜¯è´¨æ•°ï¼Œä¸èƒ½ç›´æ¥åˆ©ç”¨è´¹é©¬å°å®šç†ç»™å‡ºçš„åŒä½™å…¬å¼ã€‚ä½†æ˜¯ $p$, $q$ ä¸¤æ•°éƒ½ä¸ºè´¨æ•°ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†åˆ«è®¡ç®—æ–¹ç¨‹ å¯¹ $p$ ä»¥åŠ $q$ å–æ¨¡çš„ç»“æœï¼Œç„¶åå†æ ¹æ®ä¸­å›½å‰©ä½™å®šç†å¾—å‡ºé€šè§£ï¼Œä¹Ÿå°±å¾—åˆ°æˆ‘ä»¬éœ€è¦çš„ç»“æœã€‚ å¯¹äºæ¨¡ $p$ çš„æƒ…å†µï¼Œè®¡ç®—æ–¹æ³•å¦‚ä¸‹ï¼š å½“ $msg = 0 \\mod p$ æ—¶ï¼Œ${msg^{ed}} \\mod p = 0 \\equiv msg \\pmod p$ å½“ $msg \\ne 0 \\mod p$ æ—¶ï¼Œåˆ©ç”¨è´¹é©¬å°å®šç†ï¼Œæœ‰ $$ \\begin{alignedat}{2} msg^{ed} \u0026= \u0026{msg \\cdot (msg^{(p-1)(q-1) \\cdot k} \\mod p)} \u0026\\pmod {p} \\\\ \u0026= \u0026msg \\cdot (msg^{(p-1)} \\mod p)^{(q-1) \\cdot k} \u0026\\pmod p \\\\ \u0026= \u0026msg \\cdot 1^{(q-1) \\cdot k} \u0026\\pmod p \\\\ \u0026\\equiv \u0026msg \\pmod p \\end{alignedat} $$ åŒç†ï¼Œå¯¹æ¨¡ $q$ çš„æƒ…å†µï¼Œä¹Ÿèƒ½å¾—åˆ°ç­‰å¼ $$msg^{ed} \\equiv msg \\pmod q$$ æœ‰äº†ä¸Šé¢ä¸¤ä¸ªç»“æœï¼Œæ ¹æ®ä¸­å›½å‰©ä½™å®šç†ï¼Œå°±èƒ½å¾—åˆ° $$msg^{ed} \\equiv msg \\pmod {pq}$$ ç°åœ¨å†æ¥ç»­å‰é¢çš„è®¡ç®—ï¼š $$ \\begin{alignedat}{2} \\text{decryptedMsg} \u0026= \u0026{msg^{ed}} \u0026\\pmod {pq} \\\\ \u0026= \u0026msg \u0026\\pmod {pq} \\\\ \u0026= \u0026msg \\end{alignedat} $$ è¿™æ ·å°±è¯æ˜äº†ï¼Œè§£å¯†æ“ä½œå¾—åˆ°çš„å°±æ˜¯åŸå§‹ä¿¡æ¯ã€‚ å› ä¸ºéå¯¹ç§°åŠ è§£å¯†éå¸¸æ…¢ï¼Œå¯¹äºè¾ƒå¤§çš„æ–‡ä»¶ï¼Œé€šå¸¸ä¼šåˆ†æˆä¸¤æ­¥åŠ å¯†æ¥æå‡æ€§èƒ½ï¼šé¦–å…ˆç”¨ä½¿ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•æ¥åŠ å¯†æ•°æ®ï¼Œå†ä½¿ç”¨ RSA ç­‰éå¯¹ç§°åŠ å¯†ç®—æ³•åŠ å¯†ä¸Šä¸€æ­¥ç”¨åˆ°çš„ã€Œå¯¹ç§°å¯†é’¥ã€ã€‚ ä¸‹é¢æˆ‘ä»¬ç”¨ Python æ¥éªŒè¯ä¸‹ RSA ç®—æ³•çš„åŠ è§£å¯†æµç¨‹ï¼š python # pip install cryptography==36.0.1 from pathlib import Path from cryptography.hazmat.primitives import serialization # ç§é’¥ key_path = Path(\"./rsa-private-key.pem\") private_key = serialization.load_pem_private_key( key_path.read_bytes(), password=None, ) private = private_key.private_numbers() public = private_key.public_key().public_numbers() d = private.d # å…¬é’¥ n = public.n e = public.e def int_to_bytes(x: int) -\u003e bytes: return x.to_bytes((x.bit_length() + 7) // 8, 'big') def int_from_bytes(xbytes: bytes) -\u003e int: return int.from_bytes(xbytes, 'big') def fast_power_modular(b: int, p: int, m: int): \"\"\" å¿«é€Ÿæ¨¡å¹‚è¿ç®—ï¼šb^p % m å¤æ‚åº¦ï¼š O(log p) å› ä¸º RSA çš„åº•æ•°è·ŸæŒ‡æ•°éƒ½éå¸¸å¤§ï¼Œå¦‚æœå…ˆè¿›è¡Œå¹‚è¿ç®—ï¼Œæœ€åå†å–æ¨¡ï¼Œè®¡ç®—ç»“æœä¼šè¶Šæ¥è¶Šå¤§ï¼Œå¯¼è‡´é€Ÿåº¦éå¸¸éå¸¸æ…¢ æ ¹æ®æ¨¡å¹‚è¿ç®—çš„æ€§è´¨ b^(ab) % m = (b^a % m)^b % m, å¯ä»¥é€šè¿‡è¾¹è¿›è¡Œå¹‚è¿ç®—è¾¹å–æ¨¡ï¼Œæå¤§åœ°æå‡è®¡ç®—é€Ÿåº¦ \"\"\" res = 1 while p: if p \u0026 0x1: res *= b b = b ** 2 % m p \u003e\u003e= 1 return res % m # æ˜æ–‡ original_msg = b\"an example\" print(f\"{original_msg=}\") # åŠ å¯† msg_int = int_from_bytes(original_msg) encrypt_int = msg_int ** e % n encrypt_msg = int_to_bytes(encrypt_int) print(f\"{encrypt_msg=}\") # è§£å¯† # decrypt_int = encrypt_int ** d % n # å› ä¸º d éå¸¸å¤§ï¼Œç›´æ¥ä½¿ç”¨å…¬å¼è®¡ç®—ä¼šéå¸¸éå¸¸æ…¢ï¼Œæ‰€ä»¥ä¸èƒ½è¿™ä¹ˆç®— decrypt_int = fast_power_modular(encrypt_int, d, n) decrypt_msg = int_to_bytes(decrypt_int) print(f\"{decrypt_msg=}\") # åº”è¯¥ä¸åŸä¿¡æ¯å®Œå…¨ä¸€è‡´ ","date":"2022-03-09","objectID":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/:3:2","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","éå¯¹ç§°åŠ å¯†","å®‰å…¨","RSA","ECC"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC","uri":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/#rsa-è§£å¯†è¿ç®—çš„è¯æ˜"},{"categories":["tech"],"content":" RSA æ•°å­—ç­¾åå‰é¢è¯æ˜äº†å¯ä»¥ä½¿ç”¨å…¬é’¥åŠ å¯†ï¼Œå†ä½¿ç”¨ç§é’¥è§£å¯†ã€‚ å®é™…ä¸Šä»ä¸Šé¢çš„è¯æ˜ä¹Ÿå¯ä»¥çœ‹å‡ºæ¥ï¼Œé¡ºåºæ˜¯å®Œå…¨å¯é€†çš„ï¼Œå…ˆä½¿ç”¨ç§é’¥åŠ å¯†ï¼Œå†ä½¿ç”¨å…¬é’¥è§£å¯†ä¹Ÿå®Œå…¨æ˜¯å¯è¡Œçš„ã€‚è¿™ç§è¿ç®—è¢«æˆ‘ä»¬ç”¨åœ¨æ•°å­—ç­¾åç®—æ³•ä¸­ã€‚ æ•°å­—ç­¾åçš„æ–¹æ³•ä¸ºï¼š é¦–å…ˆè®¡ç®—åŸå§‹æ•°æ®çš„ Hash å€¼ï¼Œæ¯”å¦‚ SHA256 ä½¿ç”¨ç§é’¥å¯¹è®¡ç®—å‡ºçš„ Hash å€¼è¿›è¡ŒåŠ å¯†ï¼Œå¾—åˆ°æ•°å­—ç­¾å å…¶ä»–äººä½¿ç”¨å…¬å¼€çš„å…¬é’¥è¿›è¡Œè§£å¯†å‡º Hash å€¼ï¼Œå†å¯¹åŸå§‹æ•°æ®è®¡ç®— Hash å€¼å¯¹æ¯”ï¼Œå¦‚æœä¸€è‡´ï¼Œå°±è¯´æ˜æ•°æ®æœªè¢«ç¯¡æ”¹ Python æ¼”ç¤ºï¼š python # pip install cryptography==36.0.1 from hashlib import sha512 from pathlib import Path from cryptography.hazmat.primitives import serialization key_path = Path(\"./rsa-private-key.pem\") private_key = serialization.load_pem_private_key( key_path.read_bytes(), password=None, ) private = private_key.private_numbers() public = private_key.public_key().public_numbers() d = private.d n = public.n e = public.e # RSA sign the message msg = b'A message for signing' hash = int.from_bytes(sha512(msg).digest(), byteorder='big') signature = pow(hash, d, n) print(\"Signature:\", hex(signature)) # RSA verify signature msg = b'A message for signing' hash = int.from_bytes(sha512(msg).digest(), byteorder='big') hashFromSignature = pow(signature, e, n) print(\"Signature valid:\", hash == hashFromSignature) ","date":"2022-03-09","objectID":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/:3:3","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","éå¯¹ç§°åŠ å¯†","å®‰å…¨","RSA","ECC"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC","uri":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/#rsa-æ•°å­—ç­¾å"},{"categories":["tech"],"content":" å››ã€ECC å¯†ç ç³»ç»Ÿ ECC æ¤­åœ†æ›²çº¿å¯†ç å­¦ï¼Œäº 1985 å¹´è¢«é¦–æ¬¡æå‡ºï¼Œå¹¶äº 2004 å¹´å¼€å§‹è¢«å¹¿æ³›åº”ç”¨ã€‚ECC è¢«è®¤ä¸ºæ˜¯ RSA çš„ç»§ä»»è€…ï¼Œæ–°ä¸€ä»£çš„éå¯¹ç§°åŠ å¯†ç®—æ³•ã€‚ å…¶æœ€å¤§çš„ç‰¹ç‚¹åœ¨äºç›¸åŒå¯†ç å¼ºåº¦ä¸‹ï¼ŒECC çš„å¯†é’¥å’Œç­¾åçš„å¤§å°éƒ½è¦æ˜¾è‘—ä½äº RSA. 256bits çš„ ECC å¯†é’¥ï¼Œå®‰å…¨æ€§ä¸ 3072bits çš„ RSA å¯†é’¥å®‰å…¨æ€§ç›¸å½“ã€‚ å…¶æ¬¡ ECC çš„å¯†é’¥å¯¹ç”Ÿæˆã€å¯†é’¥äº¤æ¢ä¸ç­¾åç®—æ³•çš„é€Ÿåº¦éƒ½è¦æ¯” RSA å¿«ã€‚ ","date":"2022-03-09","objectID":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/:4:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","éå¯¹ç§°åŠ å¯†","å®‰å…¨","RSA","ECC"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC","uri":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/#å››ecc-å¯†ç ç³»ç»Ÿ"},{"categories":["tech"],"content":" æ¤­åœ†æ›²çº¿çš„æ•°å­¦åŸç†ç®€ä»‹åœ¨æ•°å­¦ä¸­ï¼Œæ¤­åœ†æ›²çº¿ï¼ˆElliptic Curvesï¼‰æ˜¯ä¸€ç§å¹³é¢æ›²çº¿ï¼Œç”±å¦‚ä¸‹æ–¹ç¨‹å®šä¹‰çš„ç‚¹çš„é›†åˆç»„æˆï¼ˆ$A-J$ å‡ä¸ºå¸¸æ•°ï¼‰ï¼š $$ Ax^3 + Bx^2y + Cxy^2 + Dy^3 + Ex^2 + Fxy + Gy^2 + Hx + Iy + J = 0 $$ è€Œ ECC åªä½¿ç”¨äº†å…¶ä¸­å¾ˆç®€å•çš„ä¸€ä¸ªå­é›†ï¼ˆ$a, b$ å‡ä¸ºå¸¸æ•°ï¼‰ï¼š $$ y^2 = x^3 + ax + b $$ æ¯”å¦‚è‘—åçš„ NIST æ›²çº¿ secp256k1 å°±æ˜¯åŸºäºå¦‚ä¸‹æ¤­åœ†æ›²çº¿æ–¹ç¨‹ï¼š $$ y^2 = x^3 + 7 $$ æ¤­åœ†æ›²çº¿å¤§æ¦‚é•¿è¿™ä¹ˆä¸ªå½¢çŠ¶ï¼š æ¤­åœ†æ›²çº¿è·Ÿæ¤­åœ†çš„å…³ç³»ï¼Œå°±çŠ¹å¦‚é›·é”‹è·Ÿé›·å³°å¡”ã€Java è·Ÿ JavaScriptâ€¦ ä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹ç½‘ç«™æ‰‹åŠ¨è°ƒæ•´ $a$ ä¸ $b$ çš„å€¼ï¼Œæ‹–åŠ¨æ›²çº¿çš„äº¤ç‚¹æŸ¥çœ‹å›¾å½¢çš„å˜åŒ–æƒ…å†µï¼šhttps://www.desmos.com/calculator/ialhd71we3?lang=zh-CN æ¤­åœ†æ›²çº¿ä¸Šçš„è¿ç®—æ•°å­¦å®¶åœ¨æ¤­åœ†æ›²çº¿ä¸Šå®šä¹‰äº†ä¸€äº›è¿ç®—è§„åˆ™ï¼ŒECC å°±ä¾èµ–äºè¿™äº›è§„åˆ™ï¼Œä¸‹é¢ç®€å•ä»‹ç»ä¸‹æˆ‘ä»¬ç”¨å¾—åˆ°çš„éƒ¨åˆ†ã€‚ æ¤­åœ†æ›²çº¿ä¸Šçš„è¿ç®—è·Ÿæˆ‘ä»¬æ‰€ç†ŸçŸ¥çš„å®æ•°åŸŸè¿ç®—ä¸å¤ªä¸€æ ·ï¼Œå®ƒåœ¨ç°å®ç”Ÿæ´»ä¸­å¹¶æ— å®é™…æ„ä¹‰ï¼Œä½†æ˜¯å®ƒçš„ä¸€äº›æ€§è´¨ä½¿å…¶å¾ˆé€‚åˆè¢«åº”ç”¨åœ¨å¯†ç å­¦ä¸­ã€‚ 1. åŠ æ³•ä¸è´Ÿå…ƒå¯¹äºæ›²çº¿ä¸Šçš„ä»»æ„ä¸¤ç‚¹ $A$ ä¸ $B$ï¼Œæˆ‘ä»¬å®šä¹‰è¿‡ $A, B$ çš„ç›´çº¿ä¸æ›²çº¿çš„äº¤ç‚¹ä¸º $-(A+B)$ï¼Œè€Œ $-(A+B)$ ç›¸å¯¹äº x è½´çš„å¯¹ç§°ç‚¹å³ä¸º $A+B$: ä¸Šè¿°æè¿°ä¸€æ˜¯å®šä¹‰äº†æ¤­åœ†æ›²çº¿çš„åŠ æ³•è§„åˆ™ï¼ŒäºŒæ˜¯å®šä¹‰äº†æ¤­åœ†æ›²çº¿ä¸Šçš„è´Ÿå…ƒè¿ç®—ã€‚ 2. äºŒå€è¿ç®—åœ¨åŠ æ³•è§„åˆ™ä¸­ï¼Œå¦‚æœ $A=B$ï¼Œæˆ‘ä»¬å®šä¹‰æ›²çº¿åœ¨ $A$ ç‚¹çš„åˆ‡çº¿ä¸æ›²çº¿çš„äº¤ç‚¹ä¸º $-2A$ï¼Œäºæ˜¯å¾—åˆ°äºŒå€è¿ç®—çš„è§„åˆ™ï¼š 3. æ— ç©·è¿œç‚¹å¯¹äº $(-A) + A$ è¿™ç§ä¸€ä¸ªå€¼ä¸å…¶è´Ÿå…ƒæœ¬èº«ç›¸åŠ çš„æƒ…å†µï¼Œæˆ‘ä»¬ä¼šå‘ç°è¿‡è¿™ä¸¤ç‚¹çš„ç›´çº¿ä¸æ¤­åœ†æ›²çº¿æ²¡æœ‰ç¬¬ä¸‰ä¸ªäº¤ç‚¹ï¼Œå‰é¢å®šä¹‰çš„åŠ æ³•è§„åˆ™åœ¨è¿™ç§æƒ…å†µä¸‹å¤±æ•ˆäº†ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å‡è®¾è¿™æ¡ç›´çº¿ä¸æ¤­åœ†æ›²çº¿ç›¸äº¤äºæ— ç©·è¿œç‚¹ $O_{\\infty}$. 4. k å€è¿ç®—æˆ‘ä»¬åœ¨å‰é¢å·²ç»å®šä¹‰äº†æ¤­åœ†æ›²çº¿ä¸Šçš„åŠ æ³•è¿ç®—ã€äºŒå€è¿ç®—ä»¥åŠæ— ç©·è¿œç‚¹ï¼Œæœ‰äº†è¿™ä¸‰ä¸ªæ¦‚å¿µï¼Œæˆ‘ä»¬å°±èƒ½å®šä¹‰k å€è¿ç®— äº†ã€‚ K å€è¿ç®—æœ€ç®€å•çš„è®¡ç®—æ–¹æ³•ï¼Œå°±æ˜¯ä¸æ–­åœ°è¿›è¡ŒåŠ æ³•è¿ç®—ï¼Œä½†æ˜¯ä¹Ÿæœ‰è®¸å¤šæ›´é«˜æ•ˆçš„ç®—æ³•ã€‚å…¶ä¸­æœ€ç®€å•çš„ç®—æ³•æ˜¯ã€Œdouble-and-addã€ï¼Œå®ƒè¦æ±‚é¦–å…ˆ $k$ æ‹†åˆ†æˆå¦‚ä¸‹å½¢å¼ $$ k = k_{0}+2k_{1}+2^{2}k_{2}+\\cdots +2^{m}k_{m} \\\\ \\text{å…¶ä¸­} k_{0}~..~k_{m}\\in {0,1},m=\\lfloor \\log _{2}{k}\\rfloor $$ ç„¶åå†è¿­ä»£è®¡ç®—å…¶ä¸­å„é¡¹çš„å€¼ï¼Œå®ƒçš„è¿ç®—å¤æ‚åº¦ä¸º $log_{2}(k)$. å›  Double å’Œ Add çš„æ‰§è¡Œæ—¶é—´ä¸åŒï¼Œæ ¹æ®æ‰§è¡Œæ—¶é—´å°±å¯ä»¥çŸ¥é“æ˜¯æ‰§è¡Œ Double è¿˜æ˜¯ Addï¼Œé—´æ¥å¯ä»¥æ¨ç®—å‡º $k$. å› æ­¤è¿™ä¸ªç®—æ³•ä¼šæœ‰è®¡æ—¶æ”»å‡»çš„é£é™©ã€‚åŸºäºã€Œdouble-and-addã€ä¿®æ”¹çš„è’™å“¥é©¬åˆ©é˜¶æ¢¯ ï¼ˆMontgomery Ladderï¼‰æ˜¯å¯ä»¥é¿å…è®¡æ—¶åˆ†æçš„ä½œæ³•ï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†ä»‹ç»äº†ã€‚ 5. æœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿æ¤­åœ†æ›²çº¿æ˜¯è¿ç»­ä¸”æ— é™çš„ï¼Œè€Œè®¡ç®—æœºå´æ›´æ“…é•¿å¤„ç†ç¦»æ•£çš„ã€å­˜åœ¨ä¸Šé™çš„æ•´æ•°ï¼Œå› æ­¤ ECC ä½¿ç”¨ã€Œæœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿ã€è¿›è¡Œè®¡ç®—ã€‚ ã€Œæœ‰é™åŸŸï¼ˆä¹Ÿè¢«ç§°ä½œ Galois Filed, ç¼©å†™ä¸º GFï¼‰ã€é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æŒ‡åªæœ‰æœ‰é™ä¸ªæ•°å€¼çš„åŸŸã€‚ æœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿æ–¹ç¨‹ï¼Œé€šè¿‡å–æ¨¡çš„æ–¹å¼å°†æ›²çº¿ä¸Šçš„æ‰€æœ‰å€¼éƒ½æ˜ å°„åˆ°åŒä¸€ä¸ªæœ‰é™åŸŸå†…ã€‚æœ‰é™åŸŸ $\\mathbb {F} _{p}$ ä¸Šçš„ EC æ¤­åœ†æ›²çº¿æ–¹ç¨‹ä¸ºï¼š $$ y^2 = x^3 + ax + b (\\mod p), 0 \\le x \\le p $$ ç›®å‰ä¸»è¦æœ‰ä¸¤ç§æœ‰é™åŸŸåœ¨ ECC ä¸­è¢«å¹¿æ³›åº”ç”¨ï¼š ä»¥ç´ æ•°ä¸ºæ¨¡çš„æ•´æ•°åŸŸ: $\\mathbb {F} _{p}$ åœ¨é€šç”¨å¤„ç†å™¨ä¸Šè®¡ç®—å¾ˆå¿« ä»¥ 2 çš„å¹‚ä¸ºæ¨¡çš„æ•´æ•°åŸŸ: $\\mathbb {F} _{2^{m}}$ å½“ä½¿ç”¨ä¸“ç”¨ç¡¬ä»¶æ—¶ï¼Œè®¡ç®—é€Ÿåº¦å¾ˆå¿« é€šè¿‡é™åˆ¶ x ä¸ºæ•´æ•°ï¼Œå¹¶ä½¿ç”¨å–æ¨¡è¿›è¡Œäº†æ˜ å°„åï¼Œæ¤­åœ†æ›²çº¿çš„å½¢çŠ¶å·²ç»é¢ç›®å…¨éäº†ï¼Œå®ƒçš„åŠ å‡æ³•ä¹Ÿä¸å†å…·æœ‰å‡ ä½•æ„ä¹‰ã€‚ä½†æ˜¯å®ƒçš„ä¸€äº›ç‰¹æ€§ä»ç„¶è·Ÿæ¤­åœ†æ›²çº¿å¾ˆç±»ä¼¼ï¼Œå„ç§å…¬å¼åŸºæœ¬åŠ ä¸ª $\\mod p$ å°±å˜æˆäº†å®ƒçš„æœ‰é™åŸŸç‰ˆæœ¬ï¼š æ— ç©·è¿œç‚¹ $O_{\\infty}$ æ˜¯é›¶å…ƒï¼Œ$O_{\\infty} + O_{\\infty} = O_{\\infty}$ï¼Œ$O_{\\infty} + P = P$ $P_{x, y}$ çš„è´Ÿå…ƒä¸º $P_{x, -y}$,ï¼Œå¹¶ä¸”æœ‰ $P + (-P) = O_{\\infty}$ $P * 0 = O_{\\infty}$ å¦‚æœ $P_{x1, y1} + Q_{x2, y2} = R_{x3, y3}$ï¼Œåˆ™å…¶åæ ‡æœ‰å¦‚ä¸‹å…³ç³» $x3 = (k^2 - x1 - x2) \\mod p$ $y3 = (k(x1 - x3) - y1) \\mod p$ æ–œç‡ $k$ çš„è®¡ç®— å¦‚æœ $P=Q$ï¼Œåˆ™ $k=\\dfrac {3x^{2}+a} {2y_{1}}$ å¦åˆ™ $k=\\dfrac {y*{2}-y*{1}} {x*{2}-x*{1}} $ ECDLP æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜å‰é¢å·²ç»ä»‹ç»äº†æ¤­åœ†æ›²çº¿ä¸Šçš„ k å€è¿ç®— åŠç›¸å…³çš„é«˜æ•ˆç®—æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ²¡æœ‰æ¶‰åŠåˆ°é™¤æ³•ã€‚ æ¤­åœ†æ›²çº¿ä¸Šçš„é™¤æ³•æ˜¯ä¸€ä¸ªå°šæœªè¢«è§£å†³çš„éš¾é¢˜â€”â€”ã€ŒECDLP æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜ã€ï¼š å·²çŸ¥ $kG$ ä¸åŸºç‚¹ $G$ï¼Œæ±‚æ•´æ•° $k$ çš„å€¼ã€‚ ç›®å‰å¹¶æ²¡æœ‰æœ‰æ•ˆçš„æ‰‹æ®µå¯ä»¥å¿«é€Ÿè®¡ç®—å‡º $k$ çš„å€¼ã€‚æ¯”è¾ƒç›´è§‚çš„æ–¹æ³•åº”è¯¥æ˜¯ä»åŸºç‚¹ $G$ å¼€å§‹ä¸æ–­è¿›è¡ŒåŠ æ³•è¿ç®—ï¼Œç›´åˆ°ç»“æœä¸ $kG$ ç›¸ç­‰ã€‚ ç›®å‰å·²çŸ¥çš„ ECDLP æœ€å¿«çš„è§£æ³•æ‰€éœ€æ­¥éª¤ä¸º $\\sqrt{k}$ï¼Œè€Œ k å€è¿ç®—é«˜æ•ˆç®—æ³•å‰é¢å·²ç»ä»‹ç»è¿‡äº†ï¼Œæ‰€éœ€æ­¥éª¤ä¸º $log_2(k)$ã€‚åœ¨ $k$ éå¸¸å¤§çš„æƒ…å†µä¸‹ï¼Œå®ƒä»¬çš„è®¡ç®—ç”¨æ—¶å°†ä¼šæœ‰æŒ‡æ•°çº§çš„å·®è·ã€‚ æ¤­åœ†æ›²çº¿ä¸Šçš„ k å€è¿ç®—ä¸ç´ æ•°ä¸Šçš„å¹‚è¿ç®—å¾ˆç±»ä¼¼ï¼Œå› æ­¤ ECC åº•å±‚çš„æ•°å­¦éš¾é¢˜ ECDLP ä¸ RSA çš„ç¦»æ•£å¯¹æ•°é—®é¢˜ DLP ä¹Ÿæœ‰å¾ˆå¤§ç›¸ä¼¼æ€§ã€‚ ","date":"2022-03-09","objectID":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/:4:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","éå¯¹ç§°åŠ å¯†","å®‰å…¨","RSA","ECC"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC","uri":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/#æ¤­åœ†æ›²çº¿çš„æ•°å­¦åŸç†ç®€ä»‹"},{"categories":["tech"],"content":" æ¤­åœ†æ›²çº¿çš„æ•°å­¦åŸç†ç®€ä»‹åœ¨æ•°å­¦ä¸­ï¼Œæ¤­åœ†æ›²çº¿ï¼ˆElliptic Curvesï¼‰æ˜¯ä¸€ç§å¹³é¢æ›²çº¿ï¼Œç”±å¦‚ä¸‹æ–¹ç¨‹å®šä¹‰çš„ç‚¹çš„é›†åˆç»„æˆï¼ˆ$A-J$ å‡ä¸ºå¸¸æ•°ï¼‰ï¼š $$ Ax^3 + Bx^2y + Cxy^2 + Dy^3 + Ex^2 + Fxy + Gy^2 + Hx + Iy + J = 0 $$ è€Œ ECC åªä½¿ç”¨äº†å…¶ä¸­å¾ˆç®€å•çš„ä¸€ä¸ªå­é›†ï¼ˆ$a, b$ å‡ä¸ºå¸¸æ•°ï¼‰ï¼š $$ y^2 = x^3 + ax + b $$ æ¯”å¦‚è‘—åçš„ NIST æ›²çº¿ secp256k1 å°±æ˜¯åŸºäºå¦‚ä¸‹æ¤­åœ†æ›²çº¿æ–¹ç¨‹ï¼š $$ y^2 = x^3 + 7 $$ æ¤­åœ†æ›²çº¿å¤§æ¦‚é•¿è¿™ä¹ˆä¸ªå½¢çŠ¶ï¼š æ¤­åœ†æ›²çº¿è·Ÿæ¤­åœ†çš„å…³ç³»ï¼Œå°±çŠ¹å¦‚é›·é”‹è·Ÿé›·å³°å¡”ã€Java è·Ÿ JavaScriptâ€¦ ä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹ç½‘ç«™æ‰‹åŠ¨è°ƒæ•´ $a$ ä¸ $b$ çš„å€¼ï¼Œæ‹–åŠ¨æ›²çº¿çš„äº¤ç‚¹æŸ¥çœ‹å›¾å½¢çš„å˜åŒ–æƒ…å†µï¼šhttps://www.desmos.com/calculator/ialhd71we3?lang=zh-CN æ¤­åœ†æ›²çº¿ä¸Šçš„è¿ç®—æ•°å­¦å®¶åœ¨æ¤­åœ†æ›²çº¿ä¸Šå®šä¹‰äº†ä¸€äº›è¿ç®—è§„åˆ™ï¼ŒECC å°±ä¾èµ–äºè¿™äº›è§„åˆ™ï¼Œä¸‹é¢ç®€å•ä»‹ç»ä¸‹æˆ‘ä»¬ç”¨å¾—åˆ°çš„éƒ¨åˆ†ã€‚ æ¤­åœ†æ›²çº¿ä¸Šçš„è¿ç®—è·Ÿæˆ‘ä»¬æ‰€ç†ŸçŸ¥çš„å®æ•°åŸŸè¿ç®—ä¸å¤ªä¸€æ ·ï¼Œå®ƒåœ¨ç°å®ç”Ÿæ´»ä¸­å¹¶æ— å®é™…æ„ä¹‰ï¼Œä½†æ˜¯å®ƒçš„ä¸€äº›æ€§è´¨ä½¿å…¶å¾ˆé€‚åˆè¢«åº”ç”¨åœ¨å¯†ç å­¦ä¸­ã€‚ 1. åŠ æ³•ä¸è´Ÿå…ƒå¯¹äºæ›²çº¿ä¸Šçš„ä»»æ„ä¸¤ç‚¹ $A$ ä¸ $B$ï¼Œæˆ‘ä»¬å®šä¹‰è¿‡ $A, B$ çš„ç›´çº¿ä¸æ›²çº¿çš„äº¤ç‚¹ä¸º $-(A+B)$ï¼Œè€Œ $-(A+B)$ ç›¸å¯¹äº x è½´çš„å¯¹ç§°ç‚¹å³ä¸º $A+B$: ä¸Šè¿°æè¿°ä¸€æ˜¯å®šä¹‰äº†æ¤­åœ†æ›²çº¿çš„åŠ æ³•è§„åˆ™ï¼ŒäºŒæ˜¯å®šä¹‰äº†æ¤­åœ†æ›²çº¿ä¸Šçš„è´Ÿå…ƒè¿ç®—ã€‚ 2. äºŒå€è¿ç®—åœ¨åŠ æ³•è§„åˆ™ä¸­ï¼Œå¦‚æœ $A=B$ï¼Œæˆ‘ä»¬å®šä¹‰æ›²çº¿åœ¨ $A$ ç‚¹çš„åˆ‡çº¿ä¸æ›²çº¿çš„äº¤ç‚¹ä¸º $-2A$ï¼Œäºæ˜¯å¾—åˆ°äºŒå€è¿ç®—çš„è§„åˆ™ï¼š 3. æ— ç©·è¿œç‚¹å¯¹äº $(-A) + A$ è¿™ç§ä¸€ä¸ªå€¼ä¸å…¶è´Ÿå…ƒæœ¬èº«ç›¸åŠ çš„æƒ…å†µï¼Œæˆ‘ä»¬ä¼šå‘ç°è¿‡è¿™ä¸¤ç‚¹çš„ç›´çº¿ä¸æ¤­åœ†æ›²çº¿æ²¡æœ‰ç¬¬ä¸‰ä¸ªäº¤ç‚¹ï¼Œå‰é¢å®šä¹‰çš„åŠ æ³•è§„åˆ™åœ¨è¿™ç§æƒ…å†µä¸‹å¤±æ•ˆäº†ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å‡è®¾è¿™æ¡ç›´çº¿ä¸æ¤­åœ†æ›²çº¿ç›¸äº¤äºæ— ç©·è¿œç‚¹ $O_{\\infty}$. 4. k å€è¿ç®—æˆ‘ä»¬åœ¨å‰é¢å·²ç»å®šä¹‰äº†æ¤­åœ†æ›²çº¿ä¸Šçš„åŠ æ³•è¿ç®—ã€äºŒå€è¿ç®—ä»¥åŠæ— ç©·è¿œç‚¹ï¼Œæœ‰äº†è¿™ä¸‰ä¸ªæ¦‚å¿µï¼Œæˆ‘ä»¬å°±èƒ½å®šä¹‰k å€è¿ç®— äº†ã€‚ K å€è¿ç®—æœ€ç®€å•çš„è®¡ç®—æ–¹æ³•ï¼Œå°±æ˜¯ä¸æ–­åœ°è¿›è¡ŒåŠ æ³•è¿ç®—ï¼Œä½†æ˜¯ä¹Ÿæœ‰è®¸å¤šæ›´é«˜æ•ˆçš„ç®—æ³•ã€‚å…¶ä¸­æœ€ç®€å•çš„ç®—æ³•æ˜¯ã€Œdouble-and-addã€ï¼Œå®ƒè¦æ±‚é¦–å…ˆ $k$ æ‹†åˆ†æˆå¦‚ä¸‹å½¢å¼ $$ k = k_{0}+2k_{1}+2^{2}k_{2}+\\cdots +2^{m}k_{m} \\\\ \\text{å…¶ä¸­} k_{0}~..~k_{m}\\in {0,1},m=\\lfloor \\log _{2}{k}\\rfloor $$ ç„¶åå†è¿­ä»£è®¡ç®—å…¶ä¸­å„é¡¹çš„å€¼ï¼Œå®ƒçš„è¿ç®—å¤æ‚åº¦ä¸º $log_{2}(k)$. å›  Double å’Œ Add çš„æ‰§è¡Œæ—¶é—´ä¸åŒï¼Œæ ¹æ®æ‰§è¡Œæ—¶é—´å°±å¯ä»¥çŸ¥é“æ˜¯æ‰§è¡Œ Double è¿˜æ˜¯ Addï¼Œé—´æ¥å¯ä»¥æ¨ç®—å‡º $k$. å› æ­¤è¿™ä¸ªç®—æ³•ä¼šæœ‰è®¡æ—¶æ”»å‡»çš„é£é™©ã€‚åŸºäºã€Œdouble-and-addã€ä¿®æ”¹çš„è’™å“¥é©¬åˆ©é˜¶æ¢¯ ï¼ˆMontgomery Ladderï¼‰æ˜¯å¯ä»¥é¿å…è®¡æ—¶åˆ†æçš„ä½œæ³•ï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†ä»‹ç»äº†ã€‚ 5. æœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿æ¤­åœ†æ›²çº¿æ˜¯è¿ç»­ä¸”æ— é™çš„ï¼Œè€Œè®¡ç®—æœºå´æ›´æ“…é•¿å¤„ç†ç¦»æ•£çš„ã€å­˜åœ¨ä¸Šé™çš„æ•´æ•°ï¼Œå› æ­¤ ECC ä½¿ç”¨ã€Œæœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿ã€è¿›è¡Œè®¡ç®—ã€‚ ã€Œæœ‰é™åŸŸï¼ˆä¹Ÿè¢«ç§°ä½œ Galois Filed, ç¼©å†™ä¸º GFï¼‰ã€é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æŒ‡åªæœ‰æœ‰é™ä¸ªæ•°å€¼çš„åŸŸã€‚ æœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿æ–¹ç¨‹ï¼Œé€šè¿‡å–æ¨¡çš„æ–¹å¼å°†æ›²çº¿ä¸Šçš„æ‰€æœ‰å€¼éƒ½æ˜ å°„åˆ°åŒä¸€ä¸ªæœ‰é™åŸŸå†…ã€‚æœ‰é™åŸŸ $\\mathbb {F} _{p}$ ä¸Šçš„ EC æ¤­åœ†æ›²çº¿æ–¹ç¨‹ä¸ºï¼š $$ y^2 = x^3 + ax + b (\\mod p), 0 \\le x \\le p $$ ç›®å‰ä¸»è¦æœ‰ä¸¤ç§æœ‰é™åŸŸåœ¨ ECC ä¸­è¢«å¹¿æ³›åº”ç”¨ï¼š ä»¥ç´ æ•°ä¸ºæ¨¡çš„æ•´æ•°åŸŸ: $\\mathbb {F} _{p}$ åœ¨é€šç”¨å¤„ç†å™¨ä¸Šè®¡ç®—å¾ˆå¿« ä»¥ 2 çš„å¹‚ä¸ºæ¨¡çš„æ•´æ•°åŸŸ: $\\mathbb {F} _{2^{m}}$ å½“ä½¿ç”¨ä¸“ç”¨ç¡¬ä»¶æ—¶ï¼Œè®¡ç®—é€Ÿåº¦å¾ˆå¿« é€šè¿‡é™åˆ¶ x ä¸ºæ•´æ•°ï¼Œå¹¶ä½¿ç”¨å–æ¨¡è¿›è¡Œäº†æ˜ å°„åï¼Œæ¤­åœ†æ›²çº¿çš„å½¢çŠ¶å·²ç»é¢ç›®å…¨éäº†ï¼Œå®ƒçš„åŠ å‡æ³•ä¹Ÿä¸å†å…·æœ‰å‡ ä½•æ„ä¹‰ã€‚ä½†æ˜¯å®ƒçš„ä¸€äº›ç‰¹æ€§ä»ç„¶è·Ÿæ¤­åœ†æ›²çº¿å¾ˆç±»ä¼¼ï¼Œå„ç§å…¬å¼åŸºæœ¬åŠ ä¸ª $\\mod p$ å°±å˜æˆäº†å®ƒçš„æœ‰é™åŸŸç‰ˆæœ¬ï¼š æ— ç©·è¿œç‚¹ $O_{\\infty}$ æ˜¯é›¶å…ƒï¼Œ$O_{\\infty} + O_{\\infty} = O_{\\infty}$ï¼Œ$O_{\\infty} + P = P$ $P_{x, y}$ çš„è´Ÿå…ƒä¸º $P_{x, -y}$,ï¼Œå¹¶ä¸”æœ‰ $P + (-P) = O_{\\infty}$ $P * 0 = O_{\\infty}$ å¦‚æœ $P_{x1, y1} + Q_{x2, y2} = R_{x3, y3}$ï¼Œåˆ™å…¶åæ ‡æœ‰å¦‚ä¸‹å…³ç³» $x3 = (k^2 - x1 - x2) \\mod p$ $y3 = (k(x1 - x3) - y1) \\mod p$ æ–œç‡ $k$ çš„è®¡ç®— å¦‚æœ $P=Q$ï¼Œåˆ™ $k=\\dfrac {3x^{2}+a} {2y_{1}}$ å¦åˆ™ $k=\\dfrac {y*{2}-y*{1}} {x*{2}-x*{1}} $ ECDLP æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜å‰é¢å·²ç»ä»‹ç»äº†æ¤­åœ†æ›²çº¿ä¸Šçš„ k å€è¿ç®— åŠç›¸å…³çš„é«˜æ•ˆç®—æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ²¡æœ‰æ¶‰åŠåˆ°é™¤æ³•ã€‚ æ¤­åœ†æ›²çº¿ä¸Šçš„é™¤æ³•æ˜¯ä¸€ä¸ªå°šæœªè¢«è§£å†³çš„éš¾é¢˜â€”â€”ã€ŒECDLP æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜ã€ï¼š å·²çŸ¥ $kG$ ä¸åŸºç‚¹ $G$ï¼Œæ±‚æ•´æ•° $k$ çš„å€¼ã€‚ ç›®å‰å¹¶æ²¡æœ‰æœ‰æ•ˆçš„æ‰‹æ®µå¯ä»¥å¿«é€Ÿè®¡ç®—å‡º $k$ çš„å€¼ã€‚æ¯”è¾ƒç›´è§‚çš„æ–¹æ³•åº”è¯¥æ˜¯ä»åŸºç‚¹ $G$ å¼€å§‹ä¸æ–­è¿›è¡ŒåŠ æ³•è¿ç®—ï¼Œç›´åˆ°ç»“æœä¸ $kG$ ç›¸ç­‰ã€‚ ç›®å‰å·²çŸ¥çš„ ECDLP æœ€å¿«çš„è§£æ³•æ‰€éœ€æ­¥éª¤ä¸º $\\sqrt{k}$ï¼Œè€Œ k å€è¿ç®—é«˜æ•ˆç®—æ³•å‰é¢å·²ç»ä»‹ç»è¿‡äº†ï¼Œæ‰€éœ€æ­¥éª¤ä¸º $log_2(k)$ã€‚åœ¨ $k$ éå¸¸å¤§çš„æƒ…å†µä¸‹ï¼Œå®ƒä»¬çš„è®¡ç®—ç”¨æ—¶å°†ä¼šæœ‰æŒ‡æ•°çº§çš„å·®è·ã€‚ æ¤­åœ†æ›²çº¿ä¸Šçš„ k å€è¿ç®—ä¸ç´ æ•°ä¸Šçš„å¹‚è¿ç®—å¾ˆç±»ä¼¼ï¼Œå› æ­¤ ECC åº•å±‚çš„æ•°å­¦éš¾é¢˜ ECDLP ä¸ RSA çš„ç¦»æ•£å¯¹æ•°é—®é¢˜ DLP ä¹Ÿæœ‰å¾ˆå¤§ç›¸ä¼¼æ€§ã€‚ ","date":"2022-03-09","objectID":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/:4:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","éå¯¹ç§°åŠ å¯†","å®‰å…¨","RSA","ECC"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC","uri":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/#æ¤­åœ†æ›²çº¿ä¸Šçš„è¿ç®—"},{"categories":["tech"],"content":" æ¤­åœ†æ›²çº¿çš„æ•°å­¦åŸç†ç®€ä»‹åœ¨æ•°å­¦ä¸­ï¼Œæ¤­åœ†æ›²çº¿ï¼ˆElliptic Curvesï¼‰æ˜¯ä¸€ç§å¹³é¢æ›²çº¿ï¼Œç”±å¦‚ä¸‹æ–¹ç¨‹å®šä¹‰çš„ç‚¹çš„é›†åˆç»„æˆï¼ˆ$A-J$ å‡ä¸ºå¸¸æ•°ï¼‰ï¼š $$ Ax^3 + Bx^2y + Cxy^2 + Dy^3 + Ex^2 + Fxy + Gy^2 + Hx + Iy + J = 0 $$ è€Œ ECC åªä½¿ç”¨äº†å…¶ä¸­å¾ˆç®€å•çš„ä¸€ä¸ªå­é›†ï¼ˆ$a, b$ å‡ä¸ºå¸¸æ•°ï¼‰ï¼š $$ y^2 = x^3 + ax + b $$ æ¯”å¦‚è‘—åçš„ NIST æ›²çº¿ secp256k1 å°±æ˜¯åŸºäºå¦‚ä¸‹æ¤­åœ†æ›²çº¿æ–¹ç¨‹ï¼š $$ y^2 = x^3 + 7 $$ æ¤­åœ†æ›²çº¿å¤§æ¦‚é•¿è¿™ä¹ˆä¸ªå½¢çŠ¶ï¼š æ¤­åœ†æ›²çº¿è·Ÿæ¤­åœ†çš„å…³ç³»ï¼Œå°±çŠ¹å¦‚é›·é”‹è·Ÿé›·å³°å¡”ã€Java è·Ÿ JavaScriptâ€¦ ä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹ç½‘ç«™æ‰‹åŠ¨è°ƒæ•´ $a$ ä¸ $b$ çš„å€¼ï¼Œæ‹–åŠ¨æ›²çº¿çš„äº¤ç‚¹æŸ¥çœ‹å›¾å½¢çš„å˜åŒ–æƒ…å†µï¼šhttps://www.desmos.com/calculator/ialhd71we3?lang=zh-CN æ¤­åœ†æ›²çº¿ä¸Šçš„è¿ç®—æ•°å­¦å®¶åœ¨æ¤­åœ†æ›²çº¿ä¸Šå®šä¹‰äº†ä¸€äº›è¿ç®—è§„åˆ™ï¼ŒECC å°±ä¾èµ–äºè¿™äº›è§„åˆ™ï¼Œä¸‹é¢ç®€å•ä»‹ç»ä¸‹æˆ‘ä»¬ç”¨å¾—åˆ°çš„éƒ¨åˆ†ã€‚ æ¤­åœ†æ›²çº¿ä¸Šçš„è¿ç®—è·Ÿæˆ‘ä»¬æ‰€ç†ŸçŸ¥çš„å®æ•°åŸŸè¿ç®—ä¸å¤ªä¸€æ ·ï¼Œå®ƒåœ¨ç°å®ç”Ÿæ´»ä¸­å¹¶æ— å®é™…æ„ä¹‰ï¼Œä½†æ˜¯å®ƒçš„ä¸€äº›æ€§è´¨ä½¿å…¶å¾ˆé€‚åˆè¢«åº”ç”¨åœ¨å¯†ç å­¦ä¸­ã€‚ 1. åŠ æ³•ä¸è´Ÿå…ƒå¯¹äºæ›²çº¿ä¸Šçš„ä»»æ„ä¸¤ç‚¹ $A$ ä¸ $B$ï¼Œæˆ‘ä»¬å®šä¹‰è¿‡ $A, B$ çš„ç›´çº¿ä¸æ›²çº¿çš„äº¤ç‚¹ä¸º $-(A+B)$ï¼Œè€Œ $-(A+B)$ ç›¸å¯¹äº x è½´çš„å¯¹ç§°ç‚¹å³ä¸º $A+B$: ä¸Šè¿°æè¿°ä¸€æ˜¯å®šä¹‰äº†æ¤­åœ†æ›²çº¿çš„åŠ æ³•è§„åˆ™ï¼ŒäºŒæ˜¯å®šä¹‰äº†æ¤­åœ†æ›²çº¿ä¸Šçš„è´Ÿå…ƒè¿ç®—ã€‚ 2. äºŒå€è¿ç®—åœ¨åŠ æ³•è§„åˆ™ä¸­ï¼Œå¦‚æœ $A=B$ï¼Œæˆ‘ä»¬å®šä¹‰æ›²çº¿åœ¨ $A$ ç‚¹çš„åˆ‡çº¿ä¸æ›²çº¿çš„äº¤ç‚¹ä¸º $-2A$ï¼Œäºæ˜¯å¾—åˆ°äºŒå€è¿ç®—çš„è§„åˆ™ï¼š 3. æ— ç©·è¿œç‚¹å¯¹äº $(-A) + A$ è¿™ç§ä¸€ä¸ªå€¼ä¸å…¶è´Ÿå…ƒæœ¬èº«ç›¸åŠ çš„æƒ…å†µï¼Œæˆ‘ä»¬ä¼šå‘ç°è¿‡è¿™ä¸¤ç‚¹çš„ç›´çº¿ä¸æ¤­åœ†æ›²çº¿æ²¡æœ‰ç¬¬ä¸‰ä¸ªäº¤ç‚¹ï¼Œå‰é¢å®šä¹‰çš„åŠ æ³•è§„åˆ™åœ¨è¿™ç§æƒ…å†µä¸‹å¤±æ•ˆäº†ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å‡è®¾è¿™æ¡ç›´çº¿ä¸æ¤­åœ†æ›²çº¿ç›¸äº¤äºæ— ç©·è¿œç‚¹ $O_{\\infty}$. 4. k å€è¿ç®—æˆ‘ä»¬åœ¨å‰é¢å·²ç»å®šä¹‰äº†æ¤­åœ†æ›²çº¿ä¸Šçš„åŠ æ³•è¿ç®—ã€äºŒå€è¿ç®—ä»¥åŠæ— ç©·è¿œç‚¹ï¼Œæœ‰äº†è¿™ä¸‰ä¸ªæ¦‚å¿µï¼Œæˆ‘ä»¬å°±èƒ½å®šä¹‰k å€è¿ç®— äº†ã€‚ K å€è¿ç®—æœ€ç®€å•çš„è®¡ç®—æ–¹æ³•ï¼Œå°±æ˜¯ä¸æ–­åœ°è¿›è¡ŒåŠ æ³•è¿ç®—ï¼Œä½†æ˜¯ä¹Ÿæœ‰è®¸å¤šæ›´é«˜æ•ˆçš„ç®—æ³•ã€‚å…¶ä¸­æœ€ç®€å•çš„ç®—æ³•æ˜¯ã€Œdouble-and-addã€ï¼Œå®ƒè¦æ±‚é¦–å…ˆ $k$ æ‹†åˆ†æˆå¦‚ä¸‹å½¢å¼ $$ k = k_{0}+2k_{1}+2^{2}k_{2}+\\cdots +2^{m}k_{m} \\\\ \\text{å…¶ä¸­} k_{0}~..~k_{m}\\in {0,1},m=\\lfloor \\log _{2}{k}\\rfloor $$ ç„¶åå†è¿­ä»£è®¡ç®—å…¶ä¸­å„é¡¹çš„å€¼ï¼Œå®ƒçš„è¿ç®—å¤æ‚åº¦ä¸º $log_{2}(k)$. å›  Double å’Œ Add çš„æ‰§è¡Œæ—¶é—´ä¸åŒï¼Œæ ¹æ®æ‰§è¡Œæ—¶é—´å°±å¯ä»¥çŸ¥é“æ˜¯æ‰§è¡Œ Double è¿˜æ˜¯ Addï¼Œé—´æ¥å¯ä»¥æ¨ç®—å‡º $k$. å› æ­¤è¿™ä¸ªç®—æ³•ä¼šæœ‰è®¡æ—¶æ”»å‡»çš„é£é™©ã€‚åŸºäºã€Œdouble-and-addã€ä¿®æ”¹çš„è’™å“¥é©¬åˆ©é˜¶æ¢¯ ï¼ˆMontgomery Ladderï¼‰æ˜¯å¯ä»¥é¿å…è®¡æ—¶åˆ†æçš„ä½œæ³•ï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†ä»‹ç»äº†ã€‚ 5. æœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿æ¤­åœ†æ›²çº¿æ˜¯è¿ç»­ä¸”æ— é™çš„ï¼Œè€Œè®¡ç®—æœºå´æ›´æ“…é•¿å¤„ç†ç¦»æ•£çš„ã€å­˜åœ¨ä¸Šé™çš„æ•´æ•°ï¼Œå› æ­¤ ECC ä½¿ç”¨ã€Œæœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿ã€è¿›è¡Œè®¡ç®—ã€‚ ã€Œæœ‰é™åŸŸï¼ˆä¹Ÿè¢«ç§°ä½œ Galois Filed, ç¼©å†™ä¸º GFï¼‰ã€é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æŒ‡åªæœ‰æœ‰é™ä¸ªæ•°å€¼çš„åŸŸã€‚ æœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿æ–¹ç¨‹ï¼Œé€šè¿‡å–æ¨¡çš„æ–¹å¼å°†æ›²çº¿ä¸Šçš„æ‰€æœ‰å€¼éƒ½æ˜ å°„åˆ°åŒä¸€ä¸ªæœ‰é™åŸŸå†…ã€‚æœ‰é™åŸŸ $\\mathbb {F} _{p}$ ä¸Šçš„ EC æ¤­åœ†æ›²çº¿æ–¹ç¨‹ä¸ºï¼š $$ y^2 = x^3 + ax + b (\\mod p), 0 \\le x \\le p $$ ç›®å‰ä¸»è¦æœ‰ä¸¤ç§æœ‰é™åŸŸåœ¨ ECC ä¸­è¢«å¹¿æ³›åº”ç”¨ï¼š ä»¥ç´ æ•°ä¸ºæ¨¡çš„æ•´æ•°åŸŸ: $\\mathbb {F} _{p}$ åœ¨é€šç”¨å¤„ç†å™¨ä¸Šè®¡ç®—å¾ˆå¿« ä»¥ 2 çš„å¹‚ä¸ºæ¨¡çš„æ•´æ•°åŸŸ: $\\mathbb {F} _{2^{m}}$ å½“ä½¿ç”¨ä¸“ç”¨ç¡¬ä»¶æ—¶ï¼Œè®¡ç®—é€Ÿåº¦å¾ˆå¿« é€šè¿‡é™åˆ¶ x ä¸ºæ•´æ•°ï¼Œå¹¶ä½¿ç”¨å–æ¨¡è¿›è¡Œäº†æ˜ å°„åï¼Œæ¤­åœ†æ›²çº¿çš„å½¢çŠ¶å·²ç»é¢ç›®å…¨éäº†ï¼Œå®ƒçš„åŠ å‡æ³•ä¹Ÿä¸å†å…·æœ‰å‡ ä½•æ„ä¹‰ã€‚ä½†æ˜¯å®ƒçš„ä¸€äº›ç‰¹æ€§ä»ç„¶è·Ÿæ¤­åœ†æ›²çº¿å¾ˆç±»ä¼¼ï¼Œå„ç§å…¬å¼åŸºæœ¬åŠ ä¸ª $\\mod p$ å°±å˜æˆäº†å®ƒçš„æœ‰é™åŸŸç‰ˆæœ¬ï¼š æ— ç©·è¿œç‚¹ $O_{\\infty}$ æ˜¯é›¶å…ƒï¼Œ$O_{\\infty} + O_{\\infty} = O_{\\infty}$ï¼Œ$O_{\\infty} + P = P$ $P_{x, y}$ çš„è´Ÿå…ƒä¸º $P_{x, -y}$,ï¼Œå¹¶ä¸”æœ‰ $P + (-P) = O_{\\infty}$ $P * 0 = O_{\\infty}$ å¦‚æœ $P_{x1, y1} + Q_{x2, y2} = R_{x3, y3}$ï¼Œåˆ™å…¶åæ ‡æœ‰å¦‚ä¸‹å…³ç³» $x3 = (k^2 - x1 - x2) \\mod p$ $y3 = (k(x1 - x3) - y1) \\mod p$ æ–œç‡ $k$ çš„è®¡ç®— å¦‚æœ $P=Q$ï¼Œåˆ™ $k=\\dfrac {3x^{2}+a} {2y_{1}}$ å¦åˆ™ $k=\\dfrac {y*{2}-y*{1}} {x*{2}-x*{1}} $ ECDLP æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜å‰é¢å·²ç»ä»‹ç»äº†æ¤­åœ†æ›²çº¿ä¸Šçš„ k å€è¿ç®— åŠç›¸å…³çš„é«˜æ•ˆç®—æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ²¡æœ‰æ¶‰åŠåˆ°é™¤æ³•ã€‚ æ¤­åœ†æ›²çº¿ä¸Šçš„é™¤æ³•æ˜¯ä¸€ä¸ªå°šæœªè¢«è§£å†³çš„éš¾é¢˜â€”â€”ã€ŒECDLP æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜ã€ï¼š å·²çŸ¥ $kG$ ä¸åŸºç‚¹ $G$ï¼Œæ±‚æ•´æ•° $k$ çš„å€¼ã€‚ ç›®å‰å¹¶æ²¡æœ‰æœ‰æ•ˆçš„æ‰‹æ®µå¯ä»¥å¿«é€Ÿè®¡ç®—å‡º $k$ çš„å€¼ã€‚æ¯”è¾ƒç›´è§‚çš„æ–¹æ³•åº”è¯¥æ˜¯ä»åŸºç‚¹ $G$ å¼€å§‹ä¸æ–­è¿›è¡ŒåŠ æ³•è¿ç®—ï¼Œç›´åˆ°ç»“æœä¸ $kG$ ç›¸ç­‰ã€‚ ç›®å‰å·²çŸ¥çš„ ECDLP æœ€å¿«çš„è§£æ³•æ‰€éœ€æ­¥éª¤ä¸º $\\sqrt{k}$ï¼Œè€Œ k å€è¿ç®—é«˜æ•ˆç®—æ³•å‰é¢å·²ç»ä»‹ç»è¿‡äº†ï¼Œæ‰€éœ€æ­¥éª¤ä¸º $log_2(k)$ã€‚åœ¨ $k$ éå¸¸å¤§çš„æƒ…å†µä¸‹ï¼Œå®ƒä»¬çš„è®¡ç®—ç”¨æ—¶å°†ä¼šæœ‰æŒ‡æ•°çº§çš„å·®è·ã€‚ æ¤­åœ†æ›²çº¿ä¸Šçš„ k å€è¿ç®—ä¸ç´ æ•°ä¸Šçš„å¹‚è¿ç®—å¾ˆç±»ä¼¼ï¼Œå› æ­¤ ECC åº•å±‚çš„æ•°å­¦éš¾é¢˜ ECDLP ä¸ RSA çš„ç¦»æ•£å¯¹æ•°é—®é¢˜ DLP ä¹Ÿæœ‰å¾ˆå¤§ç›¸ä¼¼æ€§ã€‚ ","date":"2022-03-09","objectID":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/:4:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","éå¯¹ç§°åŠ å¯†","å®‰å…¨","RSA","ECC"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC","uri":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/#1-åŠ æ³•ä¸è´Ÿå…ƒ"},{"categories":["tech"],"content":" æ¤­åœ†æ›²çº¿çš„æ•°å­¦åŸç†ç®€ä»‹åœ¨æ•°å­¦ä¸­ï¼Œæ¤­åœ†æ›²çº¿ï¼ˆElliptic Curvesï¼‰æ˜¯ä¸€ç§å¹³é¢æ›²çº¿ï¼Œç”±å¦‚ä¸‹æ–¹ç¨‹å®šä¹‰çš„ç‚¹çš„é›†åˆç»„æˆï¼ˆ$A-J$ å‡ä¸ºå¸¸æ•°ï¼‰ï¼š $$ Ax^3 + Bx^2y + Cxy^2 + Dy^3 + Ex^2 + Fxy + Gy^2 + Hx + Iy + J = 0 $$ è€Œ ECC åªä½¿ç”¨äº†å…¶ä¸­å¾ˆç®€å•çš„ä¸€ä¸ªå­é›†ï¼ˆ$a, b$ å‡ä¸ºå¸¸æ•°ï¼‰ï¼š $$ y^2 = x^3 + ax + b $$ æ¯”å¦‚è‘—åçš„ NIST æ›²çº¿ secp256k1 å°±æ˜¯åŸºäºå¦‚ä¸‹æ¤­åœ†æ›²çº¿æ–¹ç¨‹ï¼š $$ y^2 = x^3 + 7 $$ æ¤­åœ†æ›²çº¿å¤§æ¦‚é•¿è¿™ä¹ˆä¸ªå½¢çŠ¶ï¼š æ¤­åœ†æ›²çº¿è·Ÿæ¤­åœ†çš„å…³ç³»ï¼Œå°±çŠ¹å¦‚é›·é”‹è·Ÿé›·å³°å¡”ã€Java è·Ÿ JavaScriptâ€¦ ä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹ç½‘ç«™æ‰‹åŠ¨è°ƒæ•´ $a$ ä¸ $b$ çš„å€¼ï¼Œæ‹–åŠ¨æ›²çº¿çš„äº¤ç‚¹æŸ¥çœ‹å›¾å½¢çš„å˜åŒ–æƒ…å†µï¼šhttps://www.desmos.com/calculator/ialhd71we3?lang=zh-CN æ¤­åœ†æ›²çº¿ä¸Šçš„è¿ç®—æ•°å­¦å®¶åœ¨æ¤­åœ†æ›²çº¿ä¸Šå®šä¹‰äº†ä¸€äº›è¿ç®—è§„åˆ™ï¼ŒECC å°±ä¾èµ–äºè¿™äº›è§„åˆ™ï¼Œä¸‹é¢ç®€å•ä»‹ç»ä¸‹æˆ‘ä»¬ç”¨å¾—åˆ°çš„éƒ¨åˆ†ã€‚ æ¤­åœ†æ›²çº¿ä¸Šçš„è¿ç®—è·Ÿæˆ‘ä»¬æ‰€ç†ŸçŸ¥çš„å®æ•°åŸŸè¿ç®—ä¸å¤ªä¸€æ ·ï¼Œå®ƒåœ¨ç°å®ç”Ÿæ´»ä¸­å¹¶æ— å®é™…æ„ä¹‰ï¼Œä½†æ˜¯å®ƒçš„ä¸€äº›æ€§è´¨ä½¿å…¶å¾ˆé€‚åˆè¢«åº”ç”¨åœ¨å¯†ç å­¦ä¸­ã€‚ 1. åŠ æ³•ä¸è´Ÿå…ƒå¯¹äºæ›²çº¿ä¸Šçš„ä»»æ„ä¸¤ç‚¹ $A$ ä¸ $B$ï¼Œæˆ‘ä»¬å®šä¹‰è¿‡ $A, B$ çš„ç›´çº¿ä¸æ›²çº¿çš„äº¤ç‚¹ä¸º $-(A+B)$ï¼Œè€Œ $-(A+B)$ ç›¸å¯¹äº x è½´çš„å¯¹ç§°ç‚¹å³ä¸º $A+B$: ä¸Šè¿°æè¿°ä¸€æ˜¯å®šä¹‰äº†æ¤­åœ†æ›²çº¿çš„åŠ æ³•è§„åˆ™ï¼ŒäºŒæ˜¯å®šä¹‰äº†æ¤­åœ†æ›²çº¿ä¸Šçš„è´Ÿå…ƒè¿ç®—ã€‚ 2. äºŒå€è¿ç®—åœ¨åŠ æ³•è§„åˆ™ä¸­ï¼Œå¦‚æœ $A=B$ï¼Œæˆ‘ä»¬å®šä¹‰æ›²çº¿åœ¨ $A$ ç‚¹çš„åˆ‡çº¿ä¸æ›²çº¿çš„äº¤ç‚¹ä¸º $-2A$ï¼Œäºæ˜¯å¾—åˆ°äºŒå€è¿ç®—çš„è§„åˆ™ï¼š 3. æ— ç©·è¿œç‚¹å¯¹äº $(-A) + A$ è¿™ç§ä¸€ä¸ªå€¼ä¸å…¶è´Ÿå…ƒæœ¬èº«ç›¸åŠ çš„æƒ…å†µï¼Œæˆ‘ä»¬ä¼šå‘ç°è¿‡è¿™ä¸¤ç‚¹çš„ç›´çº¿ä¸æ¤­åœ†æ›²çº¿æ²¡æœ‰ç¬¬ä¸‰ä¸ªäº¤ç‚¹ï¼Œå‰é¢å®šä¹‰çš„åŠ æ³•è§„åˆ™åœ¨è¿™ç§æƒ…å†µä¸‹å¤±æ•ˆäº†ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å‡è®¾è¿™æ¡ç›´çº¿ä¸æ¤­åœ†æ›²çº¿ç›¸äº¤äºæ— ç©·è¿œç‚¹ $O_{\\infty}$. 4. k å€è¿ç®—æˆ‘ä»¬åœ¨å‰é¢å·²ç»å®šä¹‰äº†æ¤­åœ†æ›²çº¿ä¸Šçš„åŠ æ³•è¿ç®—ã€äºŒå€è¿ç®—ä»¥åŠæ— ç©·è¿œç‚¹ï¼Œæœ‰äº†è¿™ä¸‰ä¸ªæ¦‚å¿µï¼Œæˆ‘ä»¬å°±èƒ½å®šä¹‰k å€è¿ç®— äº†ã€‚ K å€è¿ç®—æœ€ç®€å•çš„è®¡ç®—æ–¹æ³•ï¼Œå°±æ˜¯ä¸æ–­åœ°è¿›è¡ŒåŠ æ³•è¿ç®—ï¼Œä½†æ˜¯ä¹Ÿæœ‰è®¸å¤šæ›´é«˜æ•ˆçš„ç®—æ³•ã€‚å…¶ä¸­æœ€ç®€å•çš„ç®—æ³•æ˜¯ã€Œdouble-and-addã€ï¼Œå®ƒè¦æ±‚é¦–å…ˆ $k$ æ‹†åˆ†æˆå¦‚ä¸‹å½¢å¼ $$ k = k_{0}+2k_{1}+2^{2}k_{2}+\\cdots +2^{m}k_{m} \\\\ \\text{å…¶ä¸­} k_{0}~..~k_{m}\\in {0,1},m=\\lfloor \\log _{2}{k}\\rfloor $$ ç„¶åå†è¿­ä»£è®¡ç®—å…¶ä¸­å„é¡¹çš„å€¼ï¼Œå®ƒçš„è¿ç®—å¤æ‚åº¦ä¸º $log_{2}(k)$. å›  Double å’Œ Add çš„æ‰§è¡Œæ—¶é—´ä¸åŒï¼Œæ ¹æ®æ‰§è¡Œæ—¶é—´å°±å¯ä»¥çŸ¥é“æ˜¯æ‰§è¡Œ Double è¿˜æ˜¯ Addï¼Œé—´æ¥å¯ä»¥æ¨ç®—å‡º $k$. å› æ­¤è¿™ä¸ªç®—æ³•ä¼šæœ‰è®¡æ—¶æ”»å‡»çš„é£é™©ã€‚åŸºäºã€Œdouble-and-addã€ä¿®æ”¹çš„è’™å“¥é©¬åˆ©é˜¶æ¢¯ ï¼ˆMontgomery Ladderï¼‰æ˜¯å¯ä»¥é¿å…è®¡æ—¶åˆ†æçš„ä½œæ³•ï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†ä»‹ç»äº†ã€‚ 5. æœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿æ¤­åœ†æ›²çº¿æ˜¯è¿ç»­ä¸”æ— é™çš„ï¼Œè€Œè®¡ç®—æœºå´æ›´æ“…é•¿å¤„ç†ç¦»æ•£çš„ã€å­˜åœ¨ä¸Šé™çš„æ•´æ•°ï¼Œå› æ­¤ ECC ä½¿ç”¨ã€Œæœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿ã€è¿›è¡Œè®¡ç®—ã€‚ ã€Œæœ‰é™åŸŸï¼ˆä¹Ÿè¢«ç§°ä½œ Galois Filed, ç¼©å†™ä¸º GFï¼‰ã€é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æŒ‡åªæœ‰æœ‰é™ä¸ªæ•°å€¼çš„åŸŸã€‚ æœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿æ–¹ç¨‹ï¼Œé€šè¿‡å–æ¨¡çš„æ–¹å¼å°†æ›²çº¿ä¸Šçš„æ‰€æœ‰å€¼éƒ½æ˜ å°„åˆ°åŒä¸€ä¸ªæœ‰é™åŸŸå†…ã€‚æœ‰é™åŸŸ $\\mathbb {F} _{p}$ ä¸Šçš„ EC æ¤­åœ†æ›²çº¿æ–¹ç¨‹ä¸ºï¼š $$ y^2 = x^3 + ax + b (\\mod p), 0 \\le x \\le p $$ ç›®å‰ä¸»è¦æœ‰ä¸¤ç§æœ‰é™åŸŸåœ¨ ECC ä¸­è¢«å¹¿æ³›åº”ç”¨ï¼š ä»¥ç´ æ•°ä¸ºæ¨¡çš„æ•´æ•°åŸŸ: $\\mathbb {F} _{p}$ åœ¨é€šç”¨å¤„ç†å™¨ä¸Šè®¡ç®—å¾ˆå¿« ä»¥ 2 çš„å¹‚ä¸ºæ¨¡çš„æ•´æ•°åŸŸ: $\\mathbb {F} _{2^{m}}$ å½“ä½¿ç”¨ä¸“ç”¨ç¡¬ä»¶æ—¶ï¼Œè®¡ç®—é€Ÿåº¦å¾ˆå¿« é€šè¿‡é™åˆ¶ x ä¸ºæ•´æ•°ï¼Œå¹¶ä½¿ç”¨å–æ¨¡è¿›è¡Œäº†æ˜ å°„åï¼Œæ¤­åœ†æ›²çº¿çš„å½¢çŠ¶å·²ç»é¢ç›®å…¨éäº†ï¼Œå®ƒçš„åŠ å‡æ³•ä¹Ÿä¸å†å…·æœ‰å‡ ä½•æ„ä¹‰ã€‚ä½†æ˜¯å®ƒçš„ä¸€äº›ç‰¹æ€§ä»ç„¶è·Ÿæ¤­åœ†æ›²çº¿å¾ˆç±»ä¼¼ï¼Œå„ç§å…¬å¼åŸºæœ¬åŠ ä¸ª $\\mod p$ å°±å˜æˆäº†å®ƒçš„æœ‰é™åŸŸç‰ˆæœ¬ï¼š æ— ç©·è¿œç‚¹ $O_{\\infty}$ æ˜¯é›¶å…ƒï¼Œ$O_{\\infty} + O_{\\infty} = O_{\\infty}$ï¼Œ$O_{\\infty} + P = P$ $P_{x, y}$ çš„è´Ÿå…ƒä¸º $P_{x, -y}$,ï¼Œå¹¶ä¸”æœ‰ $P + (-P) = O_{\\infty}$ $P * 0 = O_{\\infty}$ å¦‚æœ $P_{x1, y1} + Q_{x2, y2} = R_{x3, y3}$ï¼Œåˆ™å…¶åæ ‡æœ‰å¦‚ä¸‹å…³ç³» $x3 = (k^2 - x1 - x2) \\mod p$ $y3 = (k(x1 - x3) - y1) \\mod p$ æ–œç‡ $k$ çš„è®¡ç®— å¦‚æœ $P=Q$ï¼Œåˆ™ $k=\\dfrac {3x^{2}+a} {2y_{1}}$ å¦åˆ™ $k=\\dfrac {y*{2}-y*{1}} {x*{2}-x*{1}} $ ECDLP æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜å‰é¢å·²ç»ä»‹ç»äº†æ¤­åœ†æ›²çº¿ä¸Šçš„ k å€è¿ç®— åŠç›¸å…³çš„é«˜æ•ˆç®—æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ²¡æœ‰æ¶‰åŠåˆ°é™¤æ³•ã€‚ æ¤­åœ†æ›²çº¿ä¸Šçš„é™¤æ³•æ˜¯ä¸€ä¸ªå°šæœªè¢«è§£å†³çš„éš¾é¢˜â€”â€”ã€ŒECDLP æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜ã€ï¼š å·²çŸ¥ $kG$ ä¸åŸºç‚¹ $G$ï¼Œæ±‚æ•´æ•° $k$ çš„å€¼ã€‚ ç›®å‰å¹¶æ²¡æœ‰æœ‰æ•ˆçš„æ‰‹æ®µå¯ä»¥å¿«é€Ÿè®¡ç®—å‡º $k$ çš„å€¼ã€‚æ¯”è¾ƒç›´è§‚çš„æ–¹æ³•åº”è¯¥æ˜¯ä»åŸºç‚¹ $G$ å¼€å§‹ä¸æ–­è¿›è¡ŒåŠ æ³•è¿ç®—ï¼Œç›´åˆ°ç»“æœä¸ $kG$ ç›¸ç­‰ã€‚ ç›®å‰å·²çŸ¥çš„ ECDLP æœ€å¿«çš„è§£æ³•æ‰€éœ€æ­¥éª¤ä¸º $\\sqrt{k}$ï¼Œè€Œ k å€è¿ç®—é«˜æ•ˆç®—æ³•å‰é¢å·²ç»ä»‹ç»è¿‡äº†ï¼Œæ‰€éœ€æ­¥éª¤ä¸º $log_2(k)$ã€‚åœ¨ $k$ éå¸¸å¤§çš„æƒ…å†µä¸‹ï¼Œå®ƒä»¬çš„è®¡ç®—ç”¨æ—¶å°†ä¼šæœ‰æŒ‡æ•°çº§çš„å·®è·ã€‚ æ¤­åœ†æ›²çº¿ä¸Šçš„ k å€è¿ç®—ä¸ç´ æ•°ä¸Šçš„å¹‚è¿ç®—å¾ˆç±»ä¼¼ï¼Œå› æ­¤ ECC åº•å±‚çš„æ•°å­¦éš¾é¢˜ ECDLP ä¸ RSA çš„ç¦»æ•£å¯¹æ•°é—®é¢˜ DLP ä¹Ÿæœ‰å¾ˆå¤§ç›¸ä¼¼æ€§ã€‚ ","date":"2022-03-09","objectID":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/:4:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","éå¯¹ç§°åŠ å¯†","å®‰å…¨","RSA","ECC"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC","uri":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/#2-äºŒå€è¿ç®—"},{"categories":["tech"],"content":" æ¤­åœ†æ›²çº¿çš„æ•°å­¦åŸç†ç®€ä»‹åœ¨æ•°å­¦ä¸­ï¼Œæ¤­åœ†æ›²çº¿ï¼ˆElliptic Curvesï¼‰æ˜¯ä¸€ç§å¹³é¢æ›²çº¿ï¼Œç”±å¦‚ä¸‹æ–¹ç¨‹å®šä¹‰çš„ç‚¹çš„é›†åˆç»„æˆï¼ˆ$A-J$ å‡ä¸ºå¸¸æ•°ï¼‰ï¼š $$ Ax^3 + Bx^2y + Cxy^2 + Dy^3 + Ex^2 + Fxy + Gy^2 + Hx + Iy + J = 0 $$ è€Œ ECC åªä½¿ç”¨äº†å…¶ä¸­å¾ˆç®€å•çš„ä¸€ä¸ªå­é›†ï¼ˆ$a, b$ å‡ä¸ºå¸¸æ•°ï¼‰ï¼š $$ y^2 = x^3 + ax + b $$ æ¯”å¦‚è‘—åçš„ NIST æ›²çº¿ secp256k1 å°±æ˜¯åŸºäºå¦‚ä¸‹æ¤­åœ†æ›²çº¿æ–¹ç¨‹ï¼š $$ y^2 = x^3 + 7 $$ æ¤­åœ†æ›²çº¿å¤§æ¦‚é•¿è¿™ä¹ˆä¸ªå½¢çŠ¶ï¼š æ¤­åœ†æ›²çº¿è·Ÿæ¤­åœ†çš„å…³ç³»ï¼Œå°±çŠ¹å¦‚é›·é”‹è·Ÿé›·å³°å¡”ã€Java è·Ÿ JavaScriptâ€¦ ä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹ç½‘ç«™æ‰‹åŠ¨è°ƒæ•´ $a$ ä¸ $b$ çš„å€¼ï¼Œæ‹–åŠ¨æ›²çº¿çš„äº¤ç‚¹æŸ¥çœ‹å›¾å½¢çš„å˜åŒ–æƒ…å†µï¼šhttps://www.desmos.com/calculator/ialhd71we3?lang=zh-CN æ¤­åœ†æ›²çº¿ä¸Šçš„è¿ç®—æ•°å­¦å®¶åœ¨æ¤­åœ†æ›²çº¿ä¸Šå®šä¹‰äº†ä¸€äº›è¿ç®—è§„åˆ™ï¼ŒECC å°±ä¾èµ–äºè¿™äº›è§„åˆ™ï¼Œä¸‹é¢ç®€å•ä»‹ç»ä¸‹æˆ‘ä»¬ç”¨å¾—åˆ°çš„éƒ¨åˆ†ã€‚ æ¤­åœ†æ›²çº¿ä¸Šçš„è¿ç®—è·Ÿæˆ‘ä»¬æ‰€ç†ŸçŸ¥çš„å®æ•°åŸŸè¿ç®—ä¸å¤ªä¸€æ ·ï¼Œå®ƒåœ¨ç°å®ç”Ÿæ´»ä¸­å¹¶æ— å®é™…æ„ä¹‰ï¼Œä½†æ˜¯å®ƒçš„ä¸€äº›æ€§è´¨ä½¿å…¶å¾ˆé€‚åˆè¢«åº”ç”¨åœ¨å¯†ç å­¦ä¸­ã€‚ 1. åŠ æ³•ä¸è´Ÿå…ƒå¯¹äºæ›²çº¿ä¸Šçš„ä»»æ„ä¸¤ç‚¹ $A$ ä¸ $B$ï¼Œæˆ‘ä»¬å®šä¹‰è¿‡ $A, B$ çš„ç›´çº¿ä¸æ›²çº¿çš„äº¤ç‚¹ä¸º $-(A+B)$ï¼Œè€Œ $-(A+B)$ ç›¸å¯¹äº x è½´çš„å¯¹ç§°ç‚¹å³ä¸º $A+B$: ä¸Šè¿°æè¿°ä¸€æ˜¯å®šä¹‰äº†æ¤­åœ†æ›²çº¿çš„åŠ æ³•è§„åˆ™ï¼ŒäºŒæ˜¯å®šä¹‰äº†æ¤­åœ†æ›²çº¿ä¸Šçš„è´Ÿå…ƒè¿ç®—ã€‚ 2. äºŒå€è¿ç®—åœ¨åŠ æ³•è§„åˆ™ä¸­ï¼Œå¦‚æœ $A=B$ï¼Œæˆ‘ä»¬å®šä¹‰æ›²çº¿åœ¨ $A$ ç‚¹çš„åˆ‡çº¿ä¸æ›²çº¿çš„äº¤ç‚¹ä¸º $-2A$ï¼Œäºæ˜¯å¾—åˆ°äºŒå€è¿ç®—çš„è§„åˆ™ï¼š 3. æ— ç©·è¿œç‚¹å¯¹äº $(-A) + A$ è¿™ç§ä¸€ä¸ªå€¼ä¸å…¶è´Ÿå…ƒæœ¬èº«ç›¸åŠ çš„æƒ…å†µï¼Œæˆ‘ä»¬ä¼šå‘ç°è¿‡è¿™ä¸¤ç‚¹çš„ç›´çº¿ä¸æ¤­åœ†æ›²çº¿æ²¡æœ‰ç¬¬ä¸‰ä¸ªäº¤ç‚¹ï¼Œå‰é¢å®šä¹‰çš„åŠ æ³•è§„åˆ™åœ¨è¿™ç§æƒ…å†µä¸‹å¤±æ•ˆäº†ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å‡è®¾è¿™æ¡ç›´çº¿ä¸æ¤­åœ†æ›²çº¿ç›¸äº¤äºæ— ç©·è¿œç‚¹ $O_{\\infty}$. 4. k å€è¿ç®—æˆ‘ä»¬åœ¨å‰é¢å·²ç»å®šä¹‰äº†æ¤­åœ†æ›²çº¿ä¸Šçš„åŠ æ³•è¿ç®—ã€äºŒå€è¿ç®—ä»¥åŠæ— ç©·è¿œç‚¹ï¼Œæœ‰äº†è¿™ä¸‰ä¸ªæ¦‚å¿µï¼Œæˆ‘ä»¬å°±èƒ½å®šä¹‰k å€è¿ç®— äº†ã€‚ K å€è¿ç®—æœ€ç®€å•çš„è®¡ç®—æ–¹æ³•ï¼Œå°±æ˜¯ä¸æ–­åœ°è¿›è¡ŒåŠ æ³•è¿ç®—ï¼Œä½†æ˜¯ä¹Ÿæœ‰è®¸å¤šæ›´é«˜æ•ˆçš„ç®—æ³•ã€‚å…¶ä¸­æœ€ç®€å•çš„ç®—æ³•æ˜¯ã€Œdouble-and-addã€ï¼Œå®ƒè¦æ±‚é¦–å…ˆ $k$ æ‹†åˆ†æˆå¦‚ä¸‹å½¢å¼ $$ k = k_{0}+2k_{1}+2^{2}k_{2}+\\cdots +2^{m}k_{m} \\\\ \\text{å…¶ä¸­} k_{0}~..~k_{m}\\in {0,1},m=\\lfloor \\log _{2}{k}\\rfloor $$ ç„¶åå†è¿­ä»£è®¡ç®—å…¶ä¸­å„é¡¹çš„å€¼ï¼Œå®ƒçš„è¿ç®—å¤æ‚åº¦ä¸º $log_{2}(k)$. å›  Double å’Œ Add çš„æ‰§è¡Œæ—¶é—´ä¸åŒï¼Œæ ¹æ®æ‰§è¡Œæ—¶é—´å°±å¯ä»¥çŸ¥é“æ˜¯æ‰§è¡Œ Double è¿˜æ˜¯ Addï¼Œé—´æ¥å¯ä»¥æ¨ç®—å‡º $k$. å› æ­¤è¿™ä¸ªç®—æ³•ä¼šæœ‰è®¡æ—¶æ”»å‡»çš„é£é™©ã€‚åŸºäºã€Œdouble-and-addã€ä¿®æ”¹çš„è’™å“¥é©¬åˆ©é˜¶æ¢¯ ï¼ˆMontgomery Ladderï¼‰æ˜¯å¯ä»¥é¿å…è®¡æ—¶åˆ†æçš„ä½œæ³•ï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†ä»‹ç»äº†ã€‚ 5. æœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿æ¤­åœ†æ›²çº¿æ˜¯è¿ç»­ä¸”æ— é™çš„ï¼Œè€Œè®¡ç®—æœºå´æ›´æ“…é•¿å¤„ç†ç¦»æ•£çš„ã€å­˜åœ¨ä¸Šé™çš„æ•´æ•°ï¼Œå› æ­¤ ECC ä½¿ç”¨ã€Œæœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿ã€è¿›è¡Œè®¡ç®—ã€‚ ã€Œæœ‰é™åŸŸï¼ˆä¹Ÿè¢«ç§°ä½œ Galois Filed, ç¼©å†™ä¸º GFï¼‰ã€é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æŒ‡åªæœ‰æœ‰é™ä¸ªæ•°å€¼çš„åŸŸã€‚ æœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿æ–¹ç¨‹ï¼Œé€šè¿‡å–æ¨¡çš„æ–¹å¼å°†æ›²çº¿ä¸Šçš„æ‰€æœ‰å€¼éƒ½æ˜ å°„åˆ°åŒä¸€ä¸ªæœ‰é™åŸŸå†…ã€‚æœ‰é™åŸŸ $\\mathbb {F} _{p}$ ä¸Šçš„ EC æ¤­åœ†æ›²çº¿æ–¹ç¨‹ä¸ºï¼š $$ y^2 = x^3 + ax + b (\\mod p), 0 \\le x \\le p $$ ç›®å‰ä¸»è¦æœ‰ä¸¤ç§æœ‰é™åŸŸåœ¨ ECC ä¸­è¢«å¹¿æ³›åº”ç”¨ï¼š ä»¥ç´ æ•°ä¸ºæ¨¡çš„æ•´æ•°åŸŸ: $\\mathbb {F} _{p}$ åœ¨é€šç”¨å¤„ç†å™¨ä¸Šè®¡ç®—å¾ˆå¿« ä»¥ 2 çš„å¹‚ä¸ºæ¨¡çš„æ•´æ•°åŸŸ: $\\mathbb {F} _{2^{m}}$ å½“ä½¿ç”¨ä¸“ç”¨ç¡¬ä»¶æ—¶ï¼Œè®¡ç®—é€Ÿåº¦å¾ˆå¿« é€šè¿‡é™åˆ¶ x ä¸ºæ•´æ•°ï¼Œå¹¶ä½¿ç”¨å–æ¨¡è¿›è¡Œäº†æ˜ å°„åï¼Œæ¤­åœ†æ›²çº¿çš„å½¢çŠ¶å·²ç»é¢ç›®å…¨éäº†ï¼Œå®ƒçš„åŠ å‡æ³•ä¹Ÿä¸å†å…·æœ‰å‡ ä½•æ„ä¹‰ã€‚ä½†æ˜¯å®ƒçš„ä¸€äº›ç‰¹æ€§ä»ç„¶è·Ÿæ¤­åœ†æ›²çº¿å¾ˆç±»ä¼¼ï¼Œå„ç§å…¬å¼åŸºæœ¬åŠ ä¸ª $\\mod p$ å°±å˜æˆäº†å®ƒçš„æœ‰é™åŸŸç‰ˆæœ¬ï¼š æ— ç©·è¿œç‚¹ $O_{\\infty}$ æ˜¯é›¶å…ƒï¼Œ$O_{\\infty} + O_{\\infty} = O_{\\infty}$ï¼Œ$O_{\\infty} + P = P$ $P_{x, y}$ çš„è´Ÿå…ƒä¸º $P_{x, -y}$,ï¼Œå¹¶ä¸”æœ‰ $P + (-P) = O_{\\infty}$ $P * 0 = O_{\\infty}$ å¦‚æœ $P_{x1, y1} + Q_{x2, y2} = R_{x3, y3}$ï¼Œåˆ™å…¶åæ ‡æœ‰å¦‚ä¸‹å…³ç³» $x3 = (k^2 - x1 - x2) \\mod p$ $y3 = (k(x1 - x3) - y1) \\mod p$ æ–œç‡ $k$ çš„è®¡ç®— å¦‚æœ $P=Q$ï¼Œåˆ™ $k=\\dfrac {3x^{2}+a} {2y_{1}}$ å¦åˆ™ $k=\\dfrac {y*{2}-y*{1}} {x*{2}-x*{1}} $ ECDLP æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜å‰é¢å·²ç»ä»‹ç»äº†æ¤­åœ†æ›²çº¿ä¸Šçš„ k å€è¿ç®— åŠç›¸å…³çš„é«˜æ•ˆç®—æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ²¡æœ‰æ¶‰åŠåˆ°é™¤æ³•ã€‚ æ¤­åœ†æ›²çº¿ä¸Šçš„é™¤æ³•æ˜¯ä¸€ä¸ªå°šæœªè¢«è§£å†³çš„éš¾é¢˜â€”â€”ã€ŒECDLP æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜ã€ï¼š å·²çŸ¥ $kG$ ä¸åŸºç‚¹ $G$ï¼Œæ±‚æ•´æ•° $k$ çš„å€¼ã€‚ ç›®å‰å¹¶æ²¡æœ‰æœ‰æ•ˆçš„æ‰‹æ®µå¯ä»¥å¿«é€Ÿè®¡ç®—å‡º $k$ çš„å€¼ã€‚æ¯”è¾ƒç›´è§‚çš„æ–¹æ³•åº”è¯¥æ˜¯ä»åŸºç‚¹ $G$ å¼€å§‹ä¸æ–­è¿›è¡ŒåŠ æ³•è¿ç®—ï¼Œç›´åˆ°ç»“æœä¸ $kG$ ç›¸ç­‰ã€‚ ç›®å‰å·²çŸ¥çš„ ECDLP æœ€å¿«çš„è§£æ³•æ‰€éœ€æ­¥éª¤ä¸º $\\sqrt{k}$ï¼Œè€Œ k å€è¿ç®—é«˜æ•ˆç®—æ³•å‰é¢å·²ç»ä»‹ç»è¿‡äº†ï¼Œæ‰€éœ€æ­¥éª¤ä¸º $log_2(k)$ã€‚åœ¨ $k$ éå¸¸å¤§çš„æƒ…å†µä¸‹ï¼Œå®ƒä»¬çš„è®¡ç®—ç”¨æ—¶å°†ä¼šæœ‰æŒ‡æ•°çº§çš„å·®è·ã€‚ æ¤­åœ†æ›²çº¿ä¸Šçš„ k å€è¿ç®—ä¸ç´ æ•°ä¸Šçš„å¹‚è¿ç®—å¾ˆç±»ä¼¼ï¼Œå› æ­¤ ECC åº•å±‚çš„æ•°å­¦éš¾é¢˜ ECDLP ä¸ RSA çš„ç¦»æ•£å¯¹æ•°é—®é¢˜ DLP ä¹Ÿæœ‰å¾ˆå¤§ç›¸ä¼¼æ€§ã€‚ ","date":"2022-03-09","objectID":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/:4:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","éå¯¹ç§°åŠ å¯†","å®‰å…¨","RSA","ECC"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC","uri":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/#3-æ— ç©·è¿œç‚¹"},{"categories":["tech"],"content":" æ¤­åœ†æ›²çº¿çš„æ•°å­¦åŸç†ç®€ä»‹åœ¨æ•°å­¦ä¸­ï¼Œæ¤­åœ†æ›²çº¿ï¼ˆElliptic Curvesï¼‰æ˜¯ä¸€ç§å¹³é¢æ›²çº¿ï¼Œç”±å¦‚ä¸‹æ–¹ç¨‹å®šä¹‰çš„ç‚¹çš„é›†åˆç»„æˆï¼ˆ$A-J$ å‡ä¸ºå¸¸æ•°ï¼‰ï¼š $$ Ax^3 + Bx^2y + Cxy^2 + Dy^3 + Ex^2 + Fxy + Gy^2 + Hx + Iy + J = 0 $$ è€Œ ECC åªä½¿ç”¨äº†å…¶ä¸­å¾ˆç®€å•çš„ä¸€ä¸ªå­é›†ï¼ˆ$a, b$ å‡ä¸ºå¸¸æ•°ï¼‰ï¼š $$ y^2 = x^3 + ax + b $$ æ¯”å¦‚è‘—åçš„ NIST æ›²çº¿ secp256k1 å°±æ˜¯åŸºäºå¦‚ä¸‹æ¤­åœ†æ›²çº¿æ–¹ç¨‹ï¼š $$ y^2 = x^3 + 7 $$ æ¤­åœ†æ›²çº¿å¤§æ¦‚é•¿è¿™ä¹ˆä¸ªå½¢çŠ¶ï¼š æ¤­åœ†æ›²çº¿è·Ÿæ¤­åœ†çš„å…³ç³»ï¼Œå°±çŠ¹å¦‚é›·é”‹è·Ÿé›·å³°å¡”ã€Java è·Ÿ JavaScriptâ€¦ ä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹ç½‘ç«™æ‰‹åŠ¨è°ƒæ•´ $a$ ä¸ $b$ çš„å€¼ï¼Œæ‹–åŠ¨æ›²çº¿çš„äº¤ç‚¹æŸ¥çœ‹å›¾å½¢çš„å˜åŒ–æƒ…å†µï¼šhttps://www.desmos.com/calculator/ialhd71we3?lang=zh-CN æ¤­åœ†æ›²çº¿ä¸Šçš„è¿ç®—æ•°å­¦å®¶åœ¨æ¤­åœ†æ›²çº¿ä¸Šå®šä¹‰äº†ä¸€äº›è¿ç®—è§„åˆ™ï¼ŒECC å°±ä¾èµ–äºè¿™äº›è§„åˆ™ï¼Œä¸‹é¢ç®€å•ä»‹ç»ä¸‹æˆ‘ä»¬ç”¨å¾—åˆ°çš„éƒ¨åˆ†ã€‚ æ¤­åœ†æ›²çº¿ä¸Šçš„è¿ç®—è·Ÿæˆ‘ä»¬æ‰€ç†ŸçŸ¥çš„å®æ•°åŸŸè¿ç®—ä¸å¤ªä¸€æ ·ï¼Œå®ƒåœ¨ç°å®ç”Ÿæ´»ä¸­å¹¶æ— å®é™…æ„ä¹‰ï¼Œä½†æ˜¯å®ƒçš„ä¸€äº›æ€§è´¨ä½¿å…¶å¾ˆé€‚åˆè¢«åº”ç”¨åœ¨å¯†ç å­¦ä¸­ã€‚ 1. åŠ æ³•ä¸è´Ÿå…ƒå¯¹äºæ›²çº¿ä¸Šçš„ä»»æ„ä¸¤ç‚¹ $A$ ä¸ $B$ï¼Œæˆ‘ä»¬å®šä¹‰è¿‡ $A, B$ çš„ç›´çº¿ä¸æ›²çº¿çš„äº¤ç‚¹ä¸º $-(A+B)$ï¼Œè€Œ $-(A+B)$ ç›¸å¯¹äº x è½´çš„å¯¹ç§°ç‚¹å³ä¸º $A+B$: ä¸Šè¿°æè¿°ä¸€æ˜¯å®šä¹‰äº†æ¤­åœ†æ›²çº¿çš„åŠ æ³•è§„åˆ™ï¼ŒäºŒæ˜¯å®šä¹‰äº†æ¤­åœ†æ›²çº¿ä¸Šçš„è´Ÿå…ƒè¿ç®—ã€‚ 2. äºŒå€è¿ç®—åœ¨åŠ æ³•è§„åˆ™ä¸­ï¼Œå¦‚æœ $A=B$ï¼Œæˆ‘ä»¬å®šä¹‰æ›²çº¿åœ¨ $A$ ç‚¹çš„åˆ‡çº¿ä¸æ›²çº¿çš„äº¤ç‚¹ä¸º $-2A$ï¼Œäºæ˜¯å¾—åˆ°äºŒå€è¿ç®—çš„è§„åˆ™ï¼š 3. æ— ç©·è¿œç‚¹å¯¹äº $(-A) + A$ è¿™ç§ä¸€ä¸ªå€¼ä¸å…¶è´Ÿå…ƒæœ¬èº«ç›¸åŠ çš„æƒ…å†µï¼Œæˆ‘ä»¬ä¼šå‘ç°è¿‡è¿™ä¸¤ç‚¹çš„ç›´çº¿ä¸æ¤­åœ†æ›²çº¿æ²¡æœ‰ç¬¬ä¸‰ä¸ªäº¤ç‚¹ï¼Œå‰é¢å®šä¹‰çš„åŠ æ³•è§„åˆ™åœ¨è¿™ç§æƒ…å†µä¸‹å¤±æ•ˆäº†ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å‡è®¾è¿™æ¡ç›´çº¿ä¸æ¤­åœ†æ›²çº¿ç›¸äº¤äºæ— ç©·è¿œç‚¹ $O_{\\infty}$. 4. k å€è¿ç®—æˆ‘ä»¬åœ¨å‰é¢å·²ç»å®šä¹‰äº†æ¤­åœ†æ›²çº¿ä¸Šçš„åŠ æ³•è¿ç®—ã€äºŒå€è¿ç®—ä»¥åŠæ— ç©·è¿œç‚¹ï¼Œæœ‰äº†è¿™ä¸‰ä¸ªæ¦‚å¿µï¼Œæˆ‘ä»¬å°±èƒ½å®šä¹‰k å€è¿ç®— äº†ã€‚ K å€è¿ç®—æœ€ç®€å•çš„è®¡ç®—æ–¹æ³•ï¼Œå°±æ˜¯ä¸æ–­åœ°è¿›è¡ŒåŠ æ³•è¿ç®—ï¼Œä½†æ˜¯ä¹Ÿæœ‰è®¸å¤šæ›´é«˜æ•ˆçš„ç®—æ³•ã€‚å…¶ä¸­æœ€ç®€å•çš„ç®—æ³•æ˜¯ã€Œdouble-and-addã€ï¼Œå®ƒè¦æ±‚é¦–å…ˆ $k$ æ‹†åˆ†æˆå¦‚ä¸‹å½¢å¼ $$ k = k_{0}+2k_{1}+2^{2}k_{2}+\\cdots +2^{m}k_{m} \\\\ \\text{å…¶ä¸­} k_{0}~..~k_{m}\\in {0,1},m=\\lfloor \\log _{2}{k}\\rfloor $$ ç„¶åå†è¿­ä»£è®¡ç®—å…¶ä¸­å„é¡¹çš„å€¼ï¼Œå®ƒçš„è¿ç®—å¤æ‚åº¦ä¸º $log_{2}(k)$. å›  Double å’Œ Add çš„æ‰§è¡Œæ—¶é—´ä¸åŒï¼Œæ ¹æ®æ‰§è¡Œæ—¶é—´å°±å¯ä»¥çŸ¥é“æ˜¯æ‰§è¡Œ Double è¿˜æ˜¯ Addï¼Œé—´æ¥å¯ä»¥æ¨ç®—å‡º $k$. å› æ­¤è¿™ä¸ªç®—æ³•ä¼šæœ‰è®¡æ—¶æ”»å‡»çš„é£é™©ã€‚åŸºäºã€Œdouble-and-addã€ä¿®æ”¹çš„è’™å“¥é©¬åˆ©é˜¶æ¢¯ ï¼ˆMontgomery Ladderï¼‰æ˜¯å¯ä»¥é¿å…è®¡æ—¶åˆ†æçš„ä½œæ³•ï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†ä»‹ç»äº†ã€‚ 5. æœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿æ¤­åœ†æ›²çº¿æ˜¯è¿ç»­ä¸”æ— é™çš„ï¼Œè€Œè®¡ç®—æœºå´æ›´æ“…é•¿å¤„ç†ç¦»æ•£çš„ã€å­˜åœ¨ä¸Šé™çš„æ•´æ•°ï¼Œå› æ­¤ ECC ä½¿ç”¨ã€Œæœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿ã€è¿›è¡Œè®¡ç®—ã€‚ ã€Œæœ‰é™åŸŸï¼ˆä¹Ÿè¢«ç§°ä½œ Galois Filed, ç¼©å†™ä¸º GFï¼‰ã€é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æŒ‡åªæœ‰æœ‰é™ä¸ªæ•°å€¼çš„åŸŸã€‚ æœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿æ–¹ç¨‹ï¼Œé€šè¿‡å–æ¨¡çš„æ–¹å¼å°†æ›²çº¿ä¸Šçš„æ‰€æœ‰å€¼éƒ½æ˜ å°„åˆ°åŒä¸€ä¸ªæœ‰é™åŸŸå†…ã€‚æœ‰é™åŸŸ $\\mathbb {F} _{p}$ ä¸Šçš„ EC æ¤­åœ†æ›²çº¿æ–¹ç¨‹ä¸ºï¼š $$ y^2 = x^3 + ax + b (\\mod p), 0 \\le x \\le p $$ ç›®å‰ä¸»è¦æœ‰ä¸¤ç§æœ‰é™åŸŸåœ¨ ECC ä¸­è¢«å¹¿æ³›åº”ç”¨ï¼š ä»¥ç´ æ•°ä¸ºæ¨¡çš„æ•´æ•°åŸŸ: $\\mathbb {F} _{p}$ åœ¨é€šç”¨å¤„ç†å™¨ä¸Šè®¡ç®—å¾ˆå¿« ä»¥ 2 çš„å¹‚ä¸ºæ¨¡çš„æ•´æ•°åŸŸ: $\\mathbb {F} _{2^{m}}$ å½“ä½¿ç”¨ä¸“ç”¨ç¡¬ä»¶æ—¶ï¼Œè®¡ç®—é€Ÿåº¦å¾ˆå¿« é€šè¿‡é™åˆ¶ x ä¸ºæ•´æ•°ï¼Œå¹¶ä½¿ç”¨å–æ¨¡è¿›è¡Œäº†æ˜ å°„åï¼Œæ¤­åœ†æ›²çº¿çš„å½¢çŠ¶å·²ç»é¢ç›®å…¨éäº†ï¼Œå®ƒçš„åŠ å‡æ³•ä¹Ÿä¸å†å…·æœ‰å‡ ä½•æ„ä¹‰ã€‚ä½†æ˜¯å®ƒçš„ä¸€äº›ç‰¹æ€§ä»ç„¶è·Ÿæ¤­åœ†æ›²çº¿å¾ˆç±»ä¼¼ï¼Œå„ç§å…¬å¼åŸºæœ¬åŠ ä¸ª $\\mod p$ å°±å˜æˆäº†å®ƒçš„æœ‰é™åŸŸç‰ˆæœ¬ï¼š æ— ç©·è¿œç‚¹ $O_{\\infty}$ æ˜¯é›¶å…ƒï¼Œ$O_{\\infty} + O_{\\infty} = O_{\\infty}$ï¼Œ$O_{\\infty} + P = P$ $P_{x, y}$ çš„è´Ÿå…ƒä¸º $P_{x, -y}$,ï¼Œå¹¶ä¸”æœ‰ $P + (-P) = O_{\\infty}$ $P * 0 = O_{\\infty}$ å¦‚æœ $P_{x1, y1} + Q_{x2, y2} = R_{x3, y3}$ï¼Œåˆ™å…¶åæ ‡æœ‰å¦‚ä¸‹å…³ç³» $x3 = (k^2 - x1 - x2) \\mod p$ $y3 = (k(x1 - x3) - y1) \\mod p$ æ–œç‡ $k$ çš„è®¡ç®— å¦‚æœ $P=Q$ï¼Œåˆ™ $k=\\dfrac {3x^{2}+a} {2y_{1}}$ å¦åˆ™ $k=\\dfrac {y*{2}-y*{1}} {x*{2}-x*{1}} $ ECDLP æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜å‰é¢å·²ç»ä»‹ç»äº†æ¤­åœ†æ›²çº¿ä¸Šçš„ k å€è¿ç®— åŠç›¸å…³çš„é«˜æ•ˆç®—æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ²¡æœ‰æ¶‰åŠåˆ°é™¤æ³•ã€‚ æ¤­åœ†æ›²çº¿ä¸Šçš„é™¤æ³•æ˜¯ä¸€ä¸ªå°šæœªè¢«è§£å†³çš„éš¾é¢˜â€”â€”ã€ŒECDLP æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜ã€ï¼š å·²çŸ¥ $kG$ ä¸åŸºç‚¹ $G$ï¼Œæ±‚æ•´æ•° $k$ çš„å€¼ã€‚ ç›®å‰å¹¶æ²¡æœ‰æœ‰æ•ˆçš„æ‰‹æ®µå¯ä»¥å¿«é€Ÿè®¡ç®—å‡º $k$ çš„å€¼ã€‚æ¯”è¾ƒç›´è§‚çš„æ–¹æ³•åº”è¯¥æ˜¯ä»åŸºç‚¹ $G$ å¼€å§‹ä¸æ–­è¿›è¡ŒåŠ æ³•è¿ç®—ï¼Œç›´åˆ°ç»“æœä¸ $kG$ ç›¸ç­‰ã€‚ ç›®å‰å·²çŸ¥çš„ ECDLP æœ€å¿«çš„è§£æ³•æ‰€éœ€æ­¥éª¤ä¸º $\\sqrt{k}$ï¼Œè€Œ k å€è¿ç®—é«˜æ•ˆç®—æ³•å‰é¢å·²ç»ä»‹ç»è¿‡äº†ï¼Œæ‰€éœ€æ­¥éª¤ä¸º $log_2(k)$ã€‚åœ¨ $k$ éå¸¸å¤§çš„æƒ…å†µä¸‹ï¼Œå®ƒä»¬çš„è®¡ç®—ç”¨æ—¶å°†ä¼šæœ‰æŒ‡æ•°çº§çš„å·®è·ã€‚ æ¤­åœ†æ›²çº¿ä¸Šçš„ k å€è¿ç®—ä¸ç´ æ•°ä¸Šçš„å¹‚è¿ç®—å¾ˆç±»ä¼¼ï¼Œå› æ­¤ ECC åº•å±‚çš„æ•°å­¦éš¾é¢˜ ECDLP ä¸ RSA çš„ç¦»æ•£å¯¹æ•°é—®é¢˜ DLP ä¹Ÿæœ‰å¾ˆå¤§ç›¸ä¼¼æ€§ã€‚ ","date":"2022-03-09","objectID":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/:4:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","éå¯¹ç§°åŠ å¯†","å®‰å…¨","RSA","ECC"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC","uri":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/#4-k-å€è¿ç®—"},{"categories":["tech"],"content":" æ¤­åœ†æ›²çº¿çš„æ•°å­¦åŸç†ç®€ä»‹åœ¨æ•°å­¦ä¸­ï¼Œæ¤­åœ†æ›²çº¿ï¼ˆElliptic Curvesï¼‰æ˜¯ä¸€ç§å¹³é¢æ›²çº¿ï¼Œç”±å¦‚ä¸‹æ–¹ç¨‹å®šä¹‰çš„ç‚¹çš„é›†åˆç»„æˆï¼ˆ$A-J$ å‡ä¸ºå¸¸æ•°ï¼‰ï¼š $$ Ax^3 + Bx^2y + Cxy^2 + Dy^3 + Ex^2 + Fxy + Gy^2 + Hx + Iy + J = 0 $$ è€Œ ECC åªä½¿ç”¨äº†å…¶ä¸­å¾ˆç®€å•çš„ä¸€ä¸ªå­é›†ï¼ˆ$a, b$ å‡ä¸ºå¸¸æ•°ï¼‰ï¼š $$ y^2 = x^3 + ax + b $$ æ¯”å¦‚è‘—åçš„ NIST æ›²çº¿ secp256k1 å°±æ˜¯åŸºäºå¦‚ä¸‹æ¤­åœ†æ›²çº¿æ–¹ç¨‹ï¼š $$ y^2 = x^3 + 7 $$ æ¤­åœ†æ›²çº¿å¤§æ¦‚é•¿è¿™ä¹ˆä¸ªå½¢çŠ¶ï¼š æ¤­åœ†æ›²çº¿è·Ÿæ¤­åœ†çš„å…³ç³»ï¼Œå°±çŠ¹å¦‚é›·é”‹è·Ÿé›·å³°å¡”ã€Java è·Ÿ JavaScriptâ€¦ ä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹ç½‘ç«™æ‰‹åŠ¨è°ƒæ•´ $a$ ä¸ $b$ çš„å€¼ï¼Œæ‹–åŠ¨æ›²çº¿çš„äº¤ç‚¹æŸ¥çœ‹å›¾å½¢çš„å˜åŒ–æƒ…å†µï¼šhttps://www.desmos.com/calculator/ialhd71we3?lang=zh-CN æ¤­åœ†æ›²çº¿ä¸Šçš„è¿ç®—æ•°å­¦å®¶åœ¨æ¤­åœ†æ›²çº¿ä¸Šå®šä¹‰äº†ä¸€äº›è¿ç®—è§„åˆ™ï¼ŒECC å°±ä¾èµ–äºè¿™äº›è§„åˆ™ï¼Œä¸‹é¢ç®€å•ä»‹ç»ä¸‹æˆ‘ä»¬ç”¨å¾—åˆ°çš„éƒ¨åˆ†ã€‚ æ¤­åœ†æ›²çº¿ä¸Šçš„è¿ç®—è·Ÿæˆ‘ä»¬æ‰€ç†ŸçŸ¥çš„å®æ•°åŸŸè¿ç®—ä¸å¤ªä¸€æ ·ï¼Œå®ƒåœ¨ç°å®ç”Ÿæ´»ä¸­å¹¶æ— å®é™…æ„ä¹‰ï¼Œä½†æ˜¯å®ƒçš„ä¸€äº›æ€§è´¨ä½¿å…¶å¾ˆé€‚åˆè¢«åº”ç”¨åœ¨å¯†ç å­¦ä¸­ã€‚ 1. åŠ æ³•ä¸è´Ÿå…ƒå¯¹äºæ›²çº¿ä¸Šçš„ä»»æ„ä¸¤ç‚¹ $A$ ä¸ $B$ï¼Œæˆ‘ä»¬å®šä¹‰è¿‡ $A, B$ çš„ç›´çº¿ä¸æ›²çº¿çš„äº¤ç‚¹ä¸º $-(A+B)$ï¼Œè€Œ $-(A+B)$ ç›¸å¯¹äº x è½´çš„å¯¹ç§°ç‚¹å³ä¸º $A+B$: ä¸Šè¿°æè¿°ä¸€æ˜¯å®šä¹‰äº†æ¤­åœ†æ›²çº¿çš„åŠ æ³•è§„åˆ™ï¼ŒäºŒæ˜¯å®šä¹‰äº†æ¤­åœ†æ›²çº¿ä¸Šçš„è´Ÿå…ƒè¿ç®—ã€‚ 2. äºŒå€è¿ç®—åœ¨åŠ æ³•è§„åˆ™ä¸­ï¼Œå¦‚æœ $A=B$ï¼Œæˆ‘ä»¬å®šä¹‰æ›²çº¿åœ¨ $A$ ç‚¹çš„åˆ‡çº¿ä¸æ›²çº¿çš„äº¤ç‚¹ä¸º $-2A$ï¼Œäºæ˜¯å¾—åˆ°äºŒå€è¿ç®—çš„è§„åˆ™ï¼š 3. æ— ç©·è¿œç‚¹å¯¹äº $(-A) + A$ è¿™ç§ä¸€ä¸ªå€¼ä¸å…¶è´Ÿå…ƒæœ¬èº«ç›¸åŠ çš„æƒ…å†µï¼Œæˆ‘ä»¬ä¼šå‘ç°è¿‡è¿™ä¸¤ç‚¹çš„ç›´çº¿ä¸æ¤­åœ†æ›²çº¿æ²¡æœ‰ç¬¬ä¸‰ä¸ªäº¤ç‚¹ï¼Œå‰é¢å®šä¹‰çš„åŠ æ³•è§„åˆ™åœ¨è¿™ç§æƒ…å†µä¸‹å¤±æ•ˆäº†ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å‡è®¾è¿™æ¡ç›´çº¿ä¸æ¤­åœ†æ›²çº¿ç›¸äº¤äºæ— ç©·è¿œç‚¹ $O_{\\infty}$. 4. k å€è¿ç®—æˆ‘ä»¬åœ¨å‰é¢å·²ç»å®šä¹‰äº†æ¤­åœ†æ›²çº¿ä¸Šçš„åŠ æ³•è¿ç®—ã€äºŒå€è¿ç®—ä»¥åŠæ— ç©·è¿œç‚¹ï¼Œæœ‰äº†è¿™ä¸‰ä¸ªæ¦‚å¿µï¼Œæˆ‘ä»¬å°±èƒ½å®šä¹‰k å€è¿ç®— äº†ã€‚ K å€è¿ç®—æœ€ç®€å•çš„è®¡ç®—æ–¹æ³•ï¼Œå°±æ˜¯ä¸æ–­åœ°è¿›è¡ŒåŠ æ³•è¿ç®—ï¼Œä½†æ˜¯ä¹Ÿæœ‰è®¸å¤šæ›´é«˜æ•ˆçš„ç®—æ³•ã€‚å…¶ä¸­æœ€ç®€å•çš„ç®—æ³•æ˜¯ã€Œdouble-and-addã€ï¼Œå®ƒè¦æ±‚é¦–å…ˆ $k$ æ‹†åˆ†æˆå¦‚ä¸‹å½¢å¼ $$ k = k_{0}+2k_{1}+2^{2}k_{2}+\\cdots +2^{m}k_{m} \\\\ \\text{å…¶ä¸­} k_{0}~..~k_{m}\\in {0,1},m=\\lfloor \\log _{2}{k}\\rfloor $$ ç„¶åå†è¿­ä»£è®¡ç®—å…¶ä¸­å„é¡¹çš„å€¼ï¼Œå®ƒçš„è¿ç®—å¤æ‚åº¦ä¸º $log_{2}(k)$. å›  Double å’Œ Add çš„æ‰§è¡Œæ—¶é—´ä¸åŒï¼Œæ ¹æ®æ‰§è¡Œæ—¶é—´å°±å¯ä»¥çŸ¥é“æ˜¯æ‰§è¡Œ Double è¿˜æ˜¯ Addï¼Œé—´æ¥å¯ä»¥æ¨ç®—å‡º $k$. å› æ­¤è¿™ä¸ªç®—æ³•ä¼šæœ‰è®¡æ—¶æ”»å‡»çš„é£é™©ã€‚åŸºäºã€Œdouble-and-addã€ä¿®æ”¹çš„è’™å“¥é©¬åˆ©é˜¶æ¢¯ ï¼ˆMontgomery Ladderï¼‰æ˜¯å¯ä»¥é¿å…è®¡æ—¶åˆ†æçš„ä½œæ³•ï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†ä»‹ç»äº†ã€‚ 5. æœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿æ¤­åœ†æ›²çº¿æ˜¯è¿ç»­ä¸”æ— é™çš„ï¼Œè€Œè®¡ç®—æœºå´æ›´æ“…é•¿å¤„ç†ç¦»æ•£çš„ã€å­˜åœ¨ä¸Šé™çš„æ•´æ•°ï¼Œå› æ­¤ ECC ä½¿ç”¨ã€Œæœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿ã€è¿›è¡Œè®¡ç®—ã€‚ ã€Œæœ‰é™åŸŸï¼ˆä¹Ÿè¢«ç§°ä½œ Galois Filed, ç¼©å†™ä¸º GFï¼‰ã€é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æŒ‡åªæœ‰æœ‰é™ä¸ªæ•°å€¼çš„åŸŸã€‚ æœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿æ–¹ç¨‹ï¼Œé€šè¿‡å–æ¨¡çš„æ–¹å¼å°†æ›²çº¿ä¸Šçš„æ‰€æœ‰å€¼éƒ½æ˜ å°„åˆ°åŒä¸€ä¸ªæœ‰é™åŸŸå†…ã€‚æœ‰é™åŸŸ $\\mathbb {F} _{p}$ ä¸Šçš„ EC æ¤­åœ†æ›²çº¿æ–¹ç¨‹ä¸ºï¼š $$ y^2 = x^3 + ax + b (\\mod p), 0 \\le x \\le p $$ ç›®å‰ä¸»è¦æœ‰ä¸¤ç§æœ‰é™åŸŸåœ¨ ECC ä¸­è¢«å¹¿æ³›åº”ç”¨ï¼š ä»¥ç´ æ•°ä¸ºæ¨¡çš„æ•´æ•°åŸŸ: $\\mathbb {F} _{p}$ åœ¨é€šç”¨å¤„ç†å™¨ä¸Šè®¡ç®—å¾ˆå¿« ä»¥ 2 çš„å¹‚ä¸ºæ¨¡çš„æ•´æ•°åŸŸ: $\\mathbb {F} _{2^{m}}$ å½“ä½¿ç”¨ä¸“ç”¨ç¡¬ä»¶æ—¶ï¼Œè®¡ç®—é€Ÿåº¦å¾ˆå¿« é€šè¿‡é™åˆ¶ x ä¸ºæ•´æ•°ï¼Œå¹¶ä½¿ç”¨å–æ¨¡è¿›è¡Œäº†æ˜ å°„åï¼Œæ¤­åœ†æ›²çº¿çš„å½¢çŠ¶å·²ç»é¢ç›®å…¨éäº†ï¼Œå®ƒçš„åŠ å‡æ³•ä¹Ÿä¸å†å…·æœ‰å‡ ä½•æ„ä¹‰ã€‚ä½†æ˜¯å®ƒçš„ä¸€äº›ç‰¹æ€§ä»ç„¶è·Ÿæ¤­åœ†æ›²çº¿å¾ˆç±»ä¼¼ï¼Œå„ç§å…¬å¼åŸºæœ¬åŠ ä¸ª $\\mod p$ å°±å˜æˆäº†å®ƒçš„æœ‰é™åŸŸç‰ˆæœ¬ï¼š æ— ç©·è¿œç‚¹ $O_{\\infty}$ æ˜¯é›¶å…ƒï¼Œ$O_{\\infty} + O_{\\infty} = O_{\\infty}$ï¼Œ$O_{\\infty} + P = P$ $P_{x, y}$ çš„è´Ÿå…ƒä¸º $P_{x, -y}$,ï¼Œå¹¶ä¸”æœ‰ $P + (-P) = O_{\\infty}$ $P * 0 = O_{\\infty}$ å¦‚æœ $P_{x1, y1} + Q_{x2, y2} = R_{x3, y3}$ï¼Œåˆ™å…¶åæ ‡æœ‰å¦‚ä¸‹å…³ç³» $x3 = (k^2 - x1 - x2) \\mod p$ $y3 = (k(x1 - x3) - y1) \\mod p$ æ–œç‡ $k$ çš„è®¡ç®— å¦‚æœ $P=Q$ï¼Œåˆ™ $k=\\dfrac {3x^{2}+a} {2y_{1}}$ å¦åˆ™ $k=\\dfrac {y*{2}-y*{1}} {x*{2}-x*{1}} $ ECDLP æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜å‰é¢å·²ç»ä»‹ç»äº†æ¤­åœ†æ›²çº¿ä¸Šçš„ k å€è¿ç®— åŠç›¸å…³çš„é«˜æ•ˆç®—æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ²¡æœ‰æ¶‰åŠåˆ°é™¤æ³•ã€‚ æ¤­åœ†æ›²çº¿ä¸Šçš„é™¤æ³•æ˜¯ä¸€ä¸ªå°šæœªè¢«è§£å†³çš„éš¾é¢˜â€”â€”ã€ŒECDLP æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜ã€ï¼š å·²çŸ¥ $kG$ ä¸åŸºç‚¹ $G$ï¼Œæ±‚æ•´æ•° $k$ çš„å€¼ã€‚ ç›®å‰å¹¶æ²¡æœ‰æœ‰æ•ˆçš„æ‰‹æ®µå¯ä»¥å¿«é€Ÿè®¡ç®—å‡º $k$ çš„å€¼ã€‚æ¯”è¾ƒç›´è§‚çš„æ–¹æ³•åº”è¯¥æ˜¯ä»åŸºç‚¹ $G$ å¼€å§‹ä¸æ–­è¿›è¡ŒåŠ æ³•è¿ç®—ï¼Œç›´åˆ°ç»“æœä¸ $kG$ ç›¸ç­‰ã€‚ ç›®å‰å·²çŸ¥çš„ ECDLP æœ€å¿«çš„è§£æ³•æ‰€éœ€æ­¥éª¤ä¸º $\\sqrt{k}$ï¼Œè€Œ k å€è¿ç®—é«˜æ•ˆç®—æ³•å‰é¢å·²ç»ä»‹ç»è¿‡äº†ï¼Œæ‰€éœ€æ­¥éª¤ä¸º $log_2(k)$ã€‚åœ¨ $k$ éå¸¸å¤§çš„æƒ…å†µä¸‹ï¼Œå®ƒä»¬çš„è®¡ç®—ç”¨æ—¶å°†ä¼šæœ‰æŒ‡æ•°çº§çš„å·®è·ã€‚ æ¤­åœ†æ›²çº¿ä¸Šçš„ k å€è¿ç®—ä¸ç´ æ•°ä¸Šçš„å¹‚è¿ç®—å¾ˆç±»ä¼¼ï¼Œå› æ­¤ ECC åº•å±‚çš„æ•°å­¦éš¾é¢˜ ECDLP ä¸ RSA çš„ç¦»æ•£å¯¹æ•°é—®é¢˜ DLP ä¹Ÿæœ‰å¾ˆå¤§ç›¸ä¼¼æ€§ã€‚ ","date":"2022-03-09","objectID":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/:4:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","éå¯¹ç§°åŠ å¯†","å®‰å…¨","RSA","ECC"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC","uri":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/#5-æœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿"},{"categories":["tech"],"content":" æ¤­åœ†æ›²çº¿çš„æ•°å­¦åŸç†ç®€ä»‹åœ¨æ•°å­¦ä¸­ï¼Œæ¤­åœ†æ›²çº¿ï¼ˆElliptic Curvesï¼‰æ˜¯ä¸€ç§å¹³é¢æ›²çº¿ï¼Œç”±å¦‚ä¸‹æ–¹ç¨‹å®šä¹‰çš„ç‚¹çš„é›†åˆç»„æˆï¼ˆ$A-J$ å‡ä¸ºå¸¸æ•°ï¼‰ï¼š $$ Ax^3 + Bx^2y + Cxy^2 + Dy^3 + Ex^2 + Fxy + Gy^2 + Hx + Iy + J = 0 $$ è€Œ ECC åªä½¿ç”¨äº†å…¶ä¸­å¾ˆç®€å•çš„ä¸€ä¸ªå­é›†ï¼ˆ$a, b$ å‡ä¸ºå¸¸æ•°ï¼‰ï¼š $$ y^2 = x^3 + ax + b $$ æ¯”å¦‚è‘—åçš„ NIST æ›²çº¿ secp256k1 å°±æ˜¯åŸºäºå¦‚ä¸‹æ¤­åœ†æ›²çº¿æ–¹ç¨‹ï¼š $$ y^2 = x^3 + 7 $$ æ¤­åœ†æ›²çº¿å¤§æ¦‚é•¿è¿™ä¹ˆä¸ªå½¢çŠ¶ï¼š æ¤­åœ†æ›²çº¿è·Ÿæ¤­åœ†çš„å…³ç³»ï¼Œå°±çŠ¹å¦‚é›·é”‹è·Ÿé›·å³°å¡”ã€Java è·Ÿ JavaScriptâ€¦ ä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹ç½‘ç«™æ‰‹åŠ¨è°ƒæ•´ $a$ ä¸ $b$ çš„å€¼ï¼Œæ‹–åŠ¨æ›²çº¿çš„äº¤ç‚¹æŸ¥çœ‹å›¾å½¢çš„å˜åŒ–æƒ…å†µï¼šhttps://www.desmos.com/calculator/ialhd71we3?lang=zh-CN æ¤­åœ†æ›²çº¿ä¸Šçš„è¿ç®—æ•°å­¦å®¶åœ¨æ¤­åœ†æ›²çº¿ä¸Šå®šä¹‰äº†ä¸€äº›è¿ç®—è§„åˆ™ï¼ŒECC å°±ä¾èµ–äºè¿™äº›è§„åˆ™ï¼Œä¸‹é¢ç®€å•ä»‹ç»ä¸‹æˆ‘ä»¬ç”¨å¾—åˆ°çš„éƒ¨åˆ†ã€‚ æ¤­åœ†æ›²çº¿ä¸Šçš„è¿ç®—è·Ÿæˆ‘ä»¬æ‰€ç†ŸçŸ¥çš„å®æ•°åŸŸè¿ç®—ä¸å¤ªä¸€æ ·ï¼Œå®ƒåœ¨ç°å®ç”Ÿæ´»ä¸­å¹¶æ— å®é™…æ„ä¹‰ï¼Œä½†æ˜¯å®ƒçš„ä¸€äº›æ€§è´¨ä½¿å…¶å¾ˆé€‚åˆè¢«åº”ç”¨åœ¨å¯†ç å­¦ä¸­ã€‚ 1. åŠ æ³•ä¸è´Ÿå…ƒå¯¹äºæ›²çº¿ä¸Šçš„ä»»æ„ä¸¤ç‚¹ $A$ ä¸ $B$ï¼Œæˆ‘ä»¬å®šä¹‰è¿‡ $A, B$ çš„ç›´çº¿ä¸æ›²çº¿çš„äº¤ç‚¹ä¸º $-(A+B)$ï¼Œè€Œ $-(A+B)$ ç›¸å¯¹äº x è½´çš„å¯¹ç§°ç‚¹å³ä¸º $A+B$: ä¸Šè¿°æè¿°ä¸€æ˜¯å®šä¹‰äº†æ¤­åœ†æ›²çº¿çš„åŠ æ³•è§„åˆ™ï¼ŒäºŒæ˜¯å®šä¹‰äº†æ¤­åœ†æ›²çº¿ä¸Šçš„è´Ÿå…ƒè¿ç®—ã€‚ 2. äºŒå€è¿ç®—åœ¨åŠ æ³•è§„åˆ™ä¸­ï¼Œå¦‚æœ $A=B$ï¼Œæˆ‘ä»¬å®šä¹‰æ›²çº¿åœ¨ $A$ ç‚¹çš„åˆ‡çº¿ä¸æ›²çº¿çš„äº¤ç‚¹ä¸º $-2A$ï¼Œäºæ˜¯å¾—åˆ°äºŒå€è¿ç®—çš„è§„åˆ™ï¼š 3. æ— ç©·è¿œç‚¹å¯¹äº $(-A) + A$ è¿™ç§ä¸€ä¸ªå€¼ä¸å…¶è´Ÿå…ƒæœ¬èº«ç›¸åŠ çš„æƒ…å†µï¼Œæˆ‘ä»¬ä¼šå‘ç°è¿‡è¿™ä¸¤ç‚¹çš„ç›´çº¿ä¸æ¤­åœ†æ›²çº¿æ²¡æœ‰ç¬¬ä¸‰ä¸ªäº¤ç‚¹ï¼Œå‰é¢å®šä¹‰çš„åŠ æ³•è§„åˆ™åœ¨è¿™ç§æƒ…å†µä¸‹å¤±æ•ˆäº†ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å‡è®¾è¿™æ¡ç›´çº¿ä¸æ¤­åœ†æ›²çº¿ç›¸äº¤äºæ— ç©·è¿œç‚¹ $O_{\\infty}$. 4. k å€è¿ç®—æˆ‘ä»¬åœ¨å‰é¢å·²ç»å®šä¹‰äº†æ¤­åœ†æ›²çº¿ä¸Šçš„åŠ æ³•è¿ç®—ã€äºŒå€è¿ç®—ä»¥åŠæ— ç©·è¿œç‚¹ï¼Œæœ‰äº†è¿™ä¸‰ä¸ªæ¦‚å¿µï¼Œæˆ‘ä»¬å°±èƒ½å®šä¹‰k å€è¿ç®— äº†ã€‚ K å€è¿ç®—æœ€ç®€å•çš„è®¡ç®—æ–¹æ³•ï¼Œå°±æ˜¯ä¸æ–­åœ°è¿›è¡ŒåŠ æ³•è¿ç®—ï¼Œä½†æ˜¯ä¹Ÿæœ‰è®¸å¤šæ›´é«˜æ•ˆçš„ç®—æ³•ã€‚å…¶ä¸­æœ€ç®€å•çš„ç®—æ³•æ˜¯ã€Œdouble-and-addã€ï¼Œå®ƒè¦æ±‚é¦–å…ˆ $k$ æ‹†åˆ†æˆå¦‚ä¸‹å½¢å¼ $$ k = k_{0}+2k_{1}+2^{2}k_{2}+\\cdots +2^{m}k_{m} \\\\ \\text{å…¶ä¸­} k_{0}~..~k_{m}\\in {0,1},m=\\lfloor \\log _{2}{k}\\rfloor $$ ç„¶åå†è¿­ä»£è®¡ç®—å…¶ä¸­å„é¡¹çš„å€¼ï¼Œå®ƒçš„è¿ç®—å¤æ‚åº¦ä¸º $log_{2}(k)$. å›  Double å’Œ Add çš„æ‰§è¡Œæ—¶é—´ä¸åŒï¼Œæ ¹æ®æ‰§è¡Œæ—¶é—´å°±å¯ä»¥çŸ¥é“æ˜¯æ‰§è¡Œ Double è¿˜æ˜¯ Addï¼Œé—´æ¥å¯ä»¥æ¨ç®—å‡º $k$. å› æ­¤è¿™ä¸ªç®—æ³•ä¼šæœ‰è®¡æ—¶æ”»å‡»çš„é£é™©ã€‚åŸºäºã€Œdouble-and-addã€ä¿®æ”¹çš„è’™å“¥é©¬åˆ©é˜¶æ¢¯ ï¼ˆMontgomery Ladderï¼‰æ˜¯å¯ä»¥é¿å…è®¡æ—¶åˆ†æçš„ä½œæ³•ï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†ä»‹ç»äº†ã€‚ 5. æœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿æ¤­åœ†æ›²çº¿æ˜¯è¿ç»­ä¸”æ— é™çš„ï¼Œè€Œè®¡ç®—æœºå´æ›´æ“…é•¿å¤„ç†ç¦»æ•£çš„ã€å­˜åœ¨ä¸Šé™çš„æ•´æ•°ï¼Œå› æ­¤ ECC ä½¿ç”¨ã€Œæœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿ã€è¿›è¡Œè®¡ç®—ã€‚ ã€Œæœ‰é™åŸŸï¼ˆä¹Ÿè¢«ç§°ä½œ Galois Filed, ç¼©å†™ä¸º GFï¼‰ã€é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æŒ‡åªæœ‰æœ‰é™ä¸ªæ•°å€¼çš„åŸŸã€‚ æœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿æ–¹ç¨‹ï¼Œé€šè¿‡å–æ¨¡çš„æ–¹å¼å°†æ›²çº¿ä¸Šçš„æ‰€æœ‰å€¼éƒ½æ˜ å°„åˆ°åŒä¸€ä¸ªæœ‰é™åŸŸå†…ã€‚æœ‰é™åŸŸ $\\mathbb {F} _{p}$ ä¸Šçš„ EC æ¤­åœ†æ›²çº¿æ–¹ç¨‹ä¸ºï¼š $$ y^2 = x^3 + ax + b (\\mod p), 0 \\le x \\le p $$ ç›®å‰ä¸»è¦æœ‰ä¸¤ç§æœ‰é™åŸŸåœ¨ ECC ä¸­è¢«å¹¿æ³›åº”ç”¨ï¼š ä»¥ç´ æ•°ä¸ºæ¨¡çš„æ•´æ•°åŸŸ: $\\mathbb {F} _{p}$ åœ¨é€šç”¨å¤„ç†å™¨ä¸Šè®¡ç®—å¾ˆå¿« ä»¥ 2 çš„å¹‚ä¸ºæ¨¡çš„æ•´æ•°åŸŸ: $\\mathbb {F} _{2^{m}}$ å½“ä½¿ç”¨ä¸“ç”¨ç¡¬ä»¶æ—¶ï¼Œè®¡ç®—é€Ÿåº¦å¾ˆå¿« é€šè¿‡é™åˆ¶ x ä¸ºæ•´æ•°ï¼Œå¹¶ä½¿ç”¨å–æ¨¡è¿›è¡Œäº†æ˜ å°„åï¼Œæ¤­åœ†æ›²çº¿çš„å½¢çŠ¶å·²ç»é¢ç›®å…¨éäº†ï¼Œå®ƒçš„åŠ å‡æ³•ä¹Ÿä¸å†å…·æœ‰å‡ ä½•æ„ä¹‰ã€‚ä½†æ˜¯å®ƒçš„ä¸€äº›ç‰¹æ€§ä»ç„¶è·Ÿæ¤­åœ†æ›²çº¿å¾ˆç±»ä¼¼ï¼Œå„ç§å…¬å¼åŸºæœ¬åŠ ä¸ª $\\mod p$ å°±å˜æˆäº†å®ƒçš„æœ‰é™åŸŸç‰ˆæœ¬ï¼š æ— ç©·è¿œç‚¹ $O_{\\infty}$ æ˜¯é›¶å…ƒï¼Œ$O_{\\infty} + O_{\\infty} = O_{\\infty}$ï¼Œ$O_{\\infty} + P = P$ $P_{x, y}$ çš„è´Ÿå…ƒä¸º $P_{x, -y}$,ï¼Œå¹¶ä¸”æœ‰ $P + (-P) = O_{\\infty}$ $P * 0 = O_{\\infty}$ å¦‚æœ $P_{x1, y1} + Q_{x2, y2} = R_{x3, y3}$ï¼Œåˆ™å…¶åæ ‡æœ‰å¦‚ä¸‹å…³ç³» $x3 = (k^2 - x1 - x2) \\mod p$ $y3 = (k(x1 - x3) - y1) \\mod p$ æ–œç‡ $k$ çš„è®¡ç®— å¦‚æœ $P=Q$ï¼Œåˆ™ $k=\\dfrac {3x^{2}+a} {2y_{1}}$ å¦åˆ™ $k=\\dfrac {y*{2}-y*{1}} {x*{2}-x*{1}} $ ECDLP æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜å‰é¢å·²ç»ä»‹ç»äº†æ¤­åœ†æ›²çº¿ä¸Šçš„ k å€è¿ç®— åŠç›¸å…³çš„é«˜æ•ˆç®—æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ²¡æœ‰æ¶‰åŠåˆ°é™¤æ³•ã€‚ æ¤­åœ†æ›²çº¿ä¸Šçš„é™¤æ³•æ˜¯ä¸€ä¸ªå°šæœªè¢«è§£å†³çš„éš¾é¢˜â€”â€”ã€ŒECDLP æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜ã€ï¼š å·²çŸ¥ $kG$ ä¸åŸºç‚¹ $G$ï¼Œæ±‚æ•´æ•° $k$ çš„å€¼ã€‚ ç›®å‰å¹¶æ²¡æœ‰æœ‰æ•ˆçš„æ‰‹æ®µå¯ä»¥å¿«é€Ÿè®¡ç®—å‡º $k$ çš„å€¼ã€‚æ¯”è¾ƒç›´è§‚çš„æ–¹æ³•åº”è¯¥æ˜¯ä»åŸºç‚¹ $G$ å¼€å§‹ä¸æ–­è¿›è¡ŒåŠ æ³•è¿ç®—ï¼Œç›´åˆ°ç»“æœä¸ $kG$ ç›¸ç­‰ã€‚ ç›®å‰å·²çŸ¥çš„ ECDLP æœ€å¿«çš„è§£æ³•æ‰€éœ€æ­¥éª¤ä¸º $\\sqrt{k}$ï¼Œè€Œ k å€è¿ç®—é«˜æ•ˆç®—æ³•å‰é¢å·²ç»ä»‹ç»è¿‡äº†ï¼Œæ‰€éœ€æ­¥éª¤ä¸º $log_2(k)$ã€‚åœ¨ $k$ éå¸¸å¤§çš„æƒ…å†µä¸‹ï¼Œå®ƒä»¬çš„è®¡ç®—ç”¨æ—¶å°†ä¼šæœ‰æŒ‡æ•°çº§çš„å·®è·ã€‚ æ¤­åœ†æ›²çº¿ä¸Šçš„ k å€è¿ç®—ä¸ç´ æ•°ä¸Šçš„å¹‚è¿ç®—å¾ˆç±»ä¼¼ï¼Œå› æ­¤ ECC åº•å±‚çš„æ•°å­¦éš¾é¢˜ ECDLP ä¸ RSA çš„ç¦»æ•£å¯¹æ•°é—®é¢˜ DLP ä¹Ÿæœ‰å¾ˆå¤§ç›¸ä¼¼æ€§ã€‚ ","date":"2022-03-09","objectID":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/:4:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","éå¯¹ç§°åŠ å¯†","å®‰å…¨","RSA","ECC"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC","uri":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/#ecdlp-æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜"},{"categories":["tech"],"content":" ECC å¯†é’¥å¯¹ç”Ÿæˆé¦–å…ˆï¼Œè·Ÿ RSA ä¸€æ ·ï¼Œè®©æˆ‘ä»¬å…ˆçœ‹ä¸‹æ€ä¹ˆä½¿ç”¨ openssl ç”Ÿæˆä¸€ä¸ªä½¿ç”¨ prime256v1 æ›²çº¿çš„ ECC å¯†é’¥å¯¹ï¼š shell # åˆ—å‡º openssl æ”¯æŒçš„æ‰€æœ‰æ›²çº¿åç§° openssl ecparam -list_curves # ç”Ÿæˆ ec ç®—æ³•çš„ç§é’¥ï¼Œä½¿ç”¨ prime256v1 ç®—æ³•ï¼Œå¯†é’¥é•¿åº¦ 256 ä½ã€‚ï¼ˆå¼ºåº¦å¤§äº 2048 ä½çš„ RSA å¯†é’¥ï¼‰ openssl ecparam -genkey -name prime256v1 -out ecc-private-key.pem # é€šè¿‡å¯†é’¥ç”Ÿæˆå…¬é’¥ openssl ec -in ecc-private-key.pem -pubout -out ecc-public-key.pem # æŸ¥çœ‹ç§é’¥å†…å®¹ â¯ cat ecc-private-key.pem -----BEGIN EC PARAMETERS----- BggqhkjOPQMBBw== -----END EC PARAMETERS----- -----BEGIN EC PRIVATE KEY----- MHcCAQEEIGm3wT/m4gDaoJGKfAHDXV2BVtdyb/aPTITJR5B6KVEtoAoGCCqGSM49 AwEHoUQDQgAE5IEIorw0WU5+om/UgfyYSKosiGO6Hpe8hxkqL5GUVPyu4LJkfw/e 99zhNJatliZ1Az/yCKww5KrXC8bQ9wGQvw== -----END EC PRIVATE KEY----- # æŸ¥çœ‹ç§é’¥çš„è¯¦ç»†å‚æ•° â¯ openssl ec -noout -text -in ecc-private-key.pem read EC key Private-Key: (256 bit) priv: 69:b7:c1:3f:e6:e2:00:da:a0:91:8a:7c:01:c3:5d: 5d:81:56:d7:72:6f:f6:8f:4c:84:c9:47:90:7a:29: 51:2d pub: 04:e4:81:08:a2:bc:34:59:4e:7e:a2:6f:d4:81:fc: 98:48:aa:2c:88:63:ba:1e:97:bc:87:19:2a:2f:91: 94:54:fc:ae:e0:b2:64:7f:0f:de:f7:dc:e1:34:96: ad:96:26:75:03:3f:f2:08:ac:30:e4:aa:d7:0b:c6: d0:f7:01:90:bf ASN1 OID: prime256v1 NIST CURVE: P-256 # æŸ¥çœ‹å…¬é’¥å†…å®¹ â¯ cat ecc-public-key.pem -----BEGIN PUBLIC KEY----- MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAE5IEIorw0WU5+om/UgfyYSKosiGO6 Hpe8hxkqL5GUVPyu4LJkfw/e99zhNJatliZ1Az/yCKww5KrXC8bQ9wGQvw== -----END PUBLIC KEY----- # æŸ¥çœ‹å…¬é’¥çš„å‚æ•° â¯ openssl ec -noout -text -pubin -in ecc-public-key.pem read EC key Private-Key: (256 bit) pub: 04:e4:81:08:a2:bc:34:59:4e:7e:a2:6f:d4:81:fc: 98:48:aa:2c:88:63:ba:1e:97:bc:87:19:2a:2f:91: 94:54:fc:ae:e0:b2:64:7f:0f:de:f7:dc:e1:34:96: ad:96:26:75:03:3f:f2:08:ac:30:e4:aa:d7:0b:c6: d0:f7:01:90:bf ASN1 OID: prime256v1 NIST CURVE: P-256 å¯ä»¥çœ‹åˆ° ECC ç®—æ³•çš„å…¬é’¥ç§é’¥éƒ½æ¯” RSA å°äº†éå¸¸å¤šï¼Œæ•°æ®é‡å°ï¼Œå´èƒ½å¸¦æ¥åŒç­‰çš„å®‰å…¨å¼ºåº¦ï¼Œè¿™æ˜¯ ECC ç›¸æ¯” RSA æœ€å¤§çš„ä¼˜åŠ¿ã€‚ ç§é’¥çš„å‚æ•°ï¼š priv: ç§é’¥ï¼Œä¸€ä¸ª 256bits çš„å¤§æ•´æ•°ï¼Œå¯¹åº”æˆ‘ä»¬å‰é¢ä»‹ç»çš„ $k å€è¿ç®—$ä¸­çš„ $k$ pub: å…¬é’¥ï¼Œæ˜¯ä¸€ä¸ªæ¤­åœ†æ›²çº¿ï¼ˆECï¼‰ä¸Šçš„åæ ‡ ${x, y}$ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ well-known çš„åŸºç‚¹ $G$ ASN1 OID: prime256v1, æ¤­åœ†æ›²çº¿çš„åç§° NIST CURVE: P-256 ä½¿ç”¨å®‰å…¨éšæœºæ•°ç”Ÿæˆå™¨å³å¯ç›´æ¥ç”Ÿæˆå‡º ECC çš„ç§é’¥ privï¼Œå› æ­¤ ECC çš„å¯†é’¥å¯¹ç”Ÿæˆé€Ÿåº¦éå¸¸å¿«ã€‚ ","date":"2022-03-09","objectID":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/:4:2","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","éå¯¹ç§°åŠ å¯†","å®‰å…¨","RSA","ECC"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC","uri":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/#ecc-å¯†é’¥å¯¹ç”Ÿæˆ"},{"categories":["tech"],"content":" ECDH å¯†é’¥äº¤æ¢è¿™ä¸ªåœ¨å‰é¢å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆäº”ï¼‰â€”â€” å¯†é’¥äº¤æ¢ DHKE ä¸å®Œç¾å‰å‘ä¿å¯† PFSå·²ç»ä»‹ç»è¿‡äº†ï¼Œä¸è¿‡è¿™é‡Œå†å¤è¿°ä¸€éï¼š Alice è·Ÿ Bob åå•†å¥½æ¤­åœ†æ›²çº¿çš„å„é¡¹å‚æ•°ï¼Œä»¥åŠåŸºç‚¹ Gï¼Œè¿™äº›å‚æ•°éƒ½æ˜¯å…¬å¼€çš„ã€‚ Alice ç”Ÿæˆä¸€ä¸ªéšæœºçš„ ECC å¯†é’¥å¯¹ï¼ˆå…¬é’¥ï¼š$alicePrivate * G$, ç§é’¥: $alicePrivate$ï¼‰ Bob ç”Ÿæˆä¸€ä¸ªéšæœºçš„ ECC å¯†é’¥å¯¹ï¼ˆå…¬é’¥ï¼š$bobPrivate * G$, ç§é’¥: $bobPrivate$ï¼‰ ä¸¤äººé€šè¿‡ä¸å®‰å…¨çš„ä¿¡é“äº¤æ¢å…¬é’¥ Alice å°† Bob çš„å…¬é’¥ä¹˜ä¸Šè‡ªå·±çš„ç§é’¥ï¼Œå¾—åˆ°å…±äº«å¯†é’¥ $sharedKey = (bobPrivate * G) * alicePrivate$ Bob å°† Alice çš„å…¬é’¥ä¹˜ä¸Šè‡ªå·±çš„ç§é’¥ï¼Œå¾—åˆ°å…±äº«å¯†é’¥ $sharedKey = (alicePrivate * G) * bobPrivate$ å› ä¸º $(a * G) * b = (b * G) * a$ï¼ŒAlice ä¸ Bob è®¡ç®—å‡ºçš„å…±äº«å¯†é’¥åº”è¯¥æ˜¯ç›¸ç­‰çš„ è¿™æ ·ä¸¤æ–¹å°±é€šè¿‡ ECDH å®Œæˆäº†å¯†é’¥äº¤æ¢ã€‚è€Œ ECDH çš„å®‰å…¨æ€§ï¼Œåˆ™ç”± ECDLP é—®é¢˜æä¾›ä¿è¯ã€‚ ","date":"2022-03-09","objectID":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/:4:3","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","éå¯¹ç§°åŠ å¯†","å®‰å…¨","RSA","ECC"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC","uri":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/#ecdh-å¯†é’¥äº¤æ¢"},{"categories":["tech"],"content":" ECC åŠ å¯†ä¸è§£å¯†ECC æœ¬èº«å¹¶æ²¡æœ‰æä¾›åŠ å¯†ä¸è§£å¯†çš„åŠŸèƒ½ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å€ŸåŠ© ECDH è¿‚å›å®ç°åŠ è§£å¯†ã€‚æµç¨‹å¦‚ä¸‹ï¼š Bob æƒ³è¦å°†æ¶ˆæ¯ M å®‰å…¨åœ°å‘é€ç»™ Aliceï¼Œä»–æ‰‹ä¸Šå·²ç»æ‹¥æœ‰äº† Alice çš„ ECC å…¬é’¥ alicePubKey Bob é¦–å…ˆä½¿ç”¨å¦‚ä¸‹ç®—æ³•ç”Ÿæˆå‡ºã€Œå…±äº«å¯†é’¥ã€+ã€Œå¯†æ–‡å…¬é’¥ã€ éšæœºç”Ÿæˆä¸€ä¸ªä¸´æ—¶ç”¨çš„å¯†æ–‡ ECC å¯†é’¥å¯¹ å¯†æ–‡ç§é’¥ ciphertextPrivKeyï¼šç”Ÿæˆä¸€ä¸ªå®‰å…¨éšæœºæ•°ä½œä¸ºç§é’¥å³å¯ å¯†æ–‡å…¬é’¥ ciphertextPubKeyï¼šä½¿ç”¨æ­¤å…¬å¼ä»ç§é’¥ç”ŸæˆciphertextPubKey =ciphertextPrivKey * G ä½¿ç”¨ ECDH ç®—æ³•è®¡ç®—å‡ºã€Œå…±äº«å¯†é’¥ã€ï¼šsharedECCKey = alicePubKey * ciphertextPrivKey ä¸ºäº†ç¡®ä¿å®‰å…¨æ€§ï¼Œæ¯ä»½å¯†æ–‡éƒ½åº”è¯¥ä½¿ç”¨ä¸åŒçš„ã€Œä¸´æ—¶ ECC å¯†é’¥å¯¹ã€ä½œä¸ºã€Œå¯†æ–‡å¯†é’¥å¯¹ã€ï¼Œ ä¸åº”è¯¥ç›´æ¥ä½¿ç”¨ã€ŒBob çš„å¯†é’¥å¯¹ã€ï¼ã€ŒBob çš„å¯†é’¥å¯¹ã€åªåœ¨ Alice å›å¤å¯†æ–‡æ¶ˆæ¯ç»™ Bob æ—¶æ‰åº”è¯¥è¢«ç”¨åˆ°ã€‚ Bob ä½¿ç”¨ã€Œå…±äº«å¯†é’¥ã€ä¸å¯¹ç§°åŠ å¯†ç®—æ³•åŠ å¯†æ¶ˆæ¯ï¼Œå¾—åˆ°å¯†æ–‡ C æ¯”å¦‚ä½¿ç”¨ AES-256-GCM æˆ–è€… ChaCha20-Poly1305 è¿›è¡Œå¯¹ç§°åŠ å¯† Bob å°† C ä¸ã€Œå¯†æ–‡å…¬é’¥ ciphertextPubKeyã€æ‰“åŒ…ä¼ è¾“ç»™ Alice Alice ä½¿ç”¨ã€Œå¯†æ–‡å…¬é’¥ã€ä¸è‡ªå·±çš„ç§é’¥è®¡ç®—å‡ºã€Œå…±äº«å¯†é’¥ã€sharedECCKey = ciphertextPubKey * alicePrivKey æ ¹æ® ECDH ç®—æ³•å¯çŸ¥ï¼Œè¿™é‡Œè®¡ç®—å‡ºçš„å…±äº«å¯†é’¥ sharedECCKeyï¼Œè·Ÿ Bob åŠ å¯†æ•°æ®ä½¿ç”¨çš„å…±äº«å¯†é’¥æ˜¯å®Œå…¨ä¸€è‡´çš„ Alice ä½¿ç”¨è®¡ç®—å‡ºçš„å…±äº«å¯†é’¥è§£å¯† C å¾—åˆ°æ¶ˆæ¯ M å®é™…ä¸Šå°±æ˜¯æ¶ˆæ¯çš„å‘é€æ–¹å…ˆç”Ÿæˆä¸€ä¸ªä¸´æ—¶çš„ ECC å¯†é’¥å¯¹ï¼Œç„¶åå€ŸåŠ© ECDH åè®®è®¡ç®—å‡ºå…±äº«å¯†é’¥ç”¨äºåŠ å¯†ã€‚æ¶ˆæ¯çš„æ¥æ”¶æ–¹åŒæ ·é€šè¿‡ ECDH åè®®è®¡ç®—å‡ºå…±äº«å¯†é’¥å†è§£å¯†æ•°æ®ã€‚ ä½¿ç”¨ Python æ¼”ç¤ºå¦‚ä¸‹ï¼š python # pip install tinyec # \u003c= ECC æ›²çº¿åº“ from tinyec import registry import secrets # ä½¿ç”¨è¿™æ¡æ›²çº¿è¿›è¡Œæ¼”ç¤º curve = registry.get_curve('brainpoolP256r1') def compress_point(point): return hex(point.x) + hex(point.y % 2)[2:] def ecc_calc_encryption_keys(pubKey): \"\"\" å®‰å…¨åœ°ç”Ÿæˆä¸€ä¸ªéšæœº ECC å¯†é’¥å¯¹ï¼Œç„¶åæŒ‰ ECDH æµç¨‹è®¡ç®—å‡ºå…±äº«å¯†é’¥ sharedECCKey æœ€åè¿”å›ï¼ˆå…±äº«å¯†é’¥, ä¸´æ—¶ ECC å…¬é’¥ ciphertextPubKeyï¼‰ \"\"\" ciphertextPrivKey = secrets.randbelow(curve.field.n) ciphertextPubKey = ciphertextPrivKey * curve.g sharedECCKey = pubKey * ciphertextPrivKey return (sharedECCKey, ciphertextPubKey) def ecc_calc_decryption_key(privKey, ciphertextPubKey): sharedECCKey = ciphertextPubKey * privKey return sharedECCKey # 1. é¦–å…ˆç”Ÿæˆå‡º Alice çš„ ECC å¯†é’¥å¯¹ privKey = secrets.randbelow(curve.field.n) pubKey = privKey * curve.g print(\"private key:\", hex(privKey)) print(\"public key:\", compress_point(pubKey)) # 2. Alice å°†å…¬é’¥å‘é€ç»™ Bob # 3. Bob ä½¿ç”¨ Alice çš„å…¬é’¥ç”Ÿæˆå‡ºï¼ˆå…±äº«å¯†é’¥, ä¸´æ—¶ ECC å…¬é’¥ ciphertextPubKeyï¼‰ (encryptKey, ciphertextPubKey) = ecc_calc_encryption_keys(pubKey) print(\"ciphertext pubKey:\", compress_point(ciphertextPubKey)) print(\"encryption key:\", compress_point(encryptKey)) # 4. Bob ä½¿ç”¨å…±äº«å¯†é’¥ encryptKey åŠ å¯†æ•°æ®ï¼Œç„¶åå°†å¯†æ–‡ä¸ ciphertextPubKey ä¸€èµ·å‘é€ç»™ Alice # 5. Alice ä½¿ç”¨è‡ªå·±çš„ç§é’¥ + ciphertextPubKey è®¡ç®—å‡ºå…±äº«å¯†é’¥ decryptKey decryptKey = ecc_calc_decryption_key(privKey, ciphertextPubKey) print(\"decryption key:\", compress_point(decryptKey)) # 6. Alice ä½¿ç”¨ decryptKey è§£å¯†å¯†æ–‡å¾—åˆ°åŸå§‹æ¶ˆæ¯ ","date":"2022-03-09","objectID":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/:4:4","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","éå¯¹ç§°åŠ å¯†","å®‰å…¨","RSA","ECC"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC","uri":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/#ecc-åŠ å¯†ä¸è§£å¯†"},{"categories":["tech"],"content":" ECC æ•°å­—ç­¾åå‰é¢å·²ç»ä»‹ç»äº† RSA ç­¾åï¼Œè¿™é‡Œä»‹ç»ä¸‹åŸºäº ECC çš„ç­¾åç®—æ³•ã€‚ åŸºäº ECC çš„ç­¾åç®—æ³•ä¸»è¦æœ‰ä¸¤ç§ï¼šECDSA ä¸ EdDSAï¼Œä»¥åŠ EdDSA çš„å˜ä½“ã€‚å…¶ä¸­ ECDSA ç®—æ³•ç¨å¾®æœ‰ç‚¹å¤æ‚ï¼Œè€Œå®‰å…¨å¼ºåº¦è·Ÿå®ƒåŸºæœ¬ä¸€è‡´çš„ EdDSA çš„ç®—æ³•æ›´ç®€æ´æ›´æ˜“äºç†è§£ï¼Œåœ¨ä½¿ç”¨ç‰¹å®šæ›²çº¿çš„æƒ…å†µä¸‹ EdDSA è¿˜è¦æ¯” ECDSA æ›´å¿«ä¸€ç‚¹ï¼Œå› æ­¤ç°åœ¨é€šå¸¸æ›´æ¨èä½¿ç”¨ EdDSA ç®—æ³•ã€‚ EdDSA ä¸ Ed25519 ç­¾åç®—æ³•EdDSAï¼ˆEdwards-curve Digital Signature Algorithmï¼‰æ˜¯ä¸€ç§ç°ä»£çš„å®‰å…¨æ•°å­—ç­¾åç®—æ³•ï¼Œå®ƒä½¿ç”¨ä¸“ä¸ºæ€§èƒ½ä¼˜åŒ–çš„æ¤­åœ†æ›²çº¿ï¼Œå¦‚ 255bits æ›²çº¿ edwards25519 å’Œ 448bits æ›²çº¿ edwards448. EdDSA ç­¾åç®—æ³•åŠå…¶å˜ä½“ Ed25519 å’Œ Ed448 åœ¨æŠ€æœ¯ä¸Šåœ¨RFC8032 ä¸­è¿›è¡Œäº†æè¿°ã€‚ é¦–å…ˆï¼Œç”¨æˆ·éœ€è¦åŸºäº edwards25519 æˆ–è€… edwards448 æ›²çº¿ï¼Œç”Ÿæˆä¸€ä¸ª ECC å¯†é’¥å¯¹ã€‚ç”Ÿæˆç§é’¥çš„æ—¶å€™ï¼Œç®—æ³•é¦–å…ˆç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼Œç„¶åä¼šå¯¹éšæœºæ•°åšä¸€äº›å˜æ¢ä»¥ç¡®ä¿å®‰å…¨æ€§ï¼Œé˜²èŒƒè®¡æ—¶æ”»å‡»ç­‰æ”»å‡»æ‰‹æ®µã€‚å¯¹äº edwards25519 å…¬ç§é’¥éƒ½æ˜¯ 32 å­—èŠ‚ï¼Œè€Œå¯¹äº edwards448 å…¬ç§é’¥éƒ½æ˜¯ 57 å­—èŠ‚ã€‚ å¯¹äº edwards25519 è¾“å‡ºçš„ç­¾åé•¿åº¦ä¸º 64 å­—èŠ‚ï¼Œè€Œå¯¹äº Ed448 è¾“å‡ºä¸º 114 å­—èŠ‚ã€‚ å…·ä½“çš„ç®—æ³•è™½ç„¶æ¯” ECDSA ç®€å•ï¼Œä½†è¿˜æ˜¯æœ‰ç‚¹éš¾åº¦çš„ï¼Œè¿™é‡Œå°±ç›´æ¥ç•¥è¿‡äº†ã€‚ ä¸‹é¢ç»™å‡ºä¸ª ed25519 çš„è®¡ç®—ç¤ºä¾‹ï¼š python # pip install cryptography==36.0.1 from cryptography.hazmat.primitives.asymmetric.ed25519 import Ed25519PrivateKey # ä¹Ÿå¯ç”¨ openssl ç”Ÿæˆï¼Œéƒ½æ²¡å•¥æ¯›ç—… private_key = Ed25519PrivateKey.generate() # ç­¾å signature = private_key.sign(b\"my authenticated message\") # æ˜¾ç„¶ ECC çš„å…¬é’¥ kG ä¹Ÿèƒ½ç›´æ¥ä»ç§é’¥ k ç”Ÿæˆ public_key = private_key.public_key() # éªŒè¯ # Raises InvalidSignature if verification fails public_key.verify(signature, b\"my authenticated message\") ed448 çš„ä»£ç ä¹Ÿå®Œå…¨ç±»ä¼¼ï¼š python # pip install cryptography==36.0.1 from cryptography.hazmat.primitives.asymmetric.ed448 import Ed448PrivateKey private_key = Ed448PrivateKey.generate() signature = private_key.sign(b\"my authenticated message\") public_key = private_key.public_key() # Raises InvalidSignature if verification fails public_key.verify(signature, b\"my authenticated message\") ","date":"2022-03-09","objectID":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/:4:5","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","éå¯¹ç§°åŠ å¯†","å®‰å…¨","RSA","ECC"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC","uri":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/#ecc-æ•°å­—ç­¾å"},{"categories":["tech"],"content":" ECC æ•°å­—ç­¾åå‰é¢å·²ç»ä»‹ç»äº† RSA ç­¾åï¼Œè¿™é‡Œä»‹ç»ä¸‹åŸºäº ECC çš„ç­¾åç®—æ³•ã€‚ åŸºäº ECC çš„ç­¾åç®—æ³•ä¸»è¦æœ‰ä¸¤ç§ï¼šECDSA ä¸ EdDSAï¼Œä»¥åŠ EdDSA çš„å˜ä½“ã€‚å…¶ä¸­ ECDSA ç®—æ³•ç¨å¾®æœ‰ç‚¹å¤æ‚ï¼Œè€Œå®‰å…¨å¼ºåº¦è·Ÿå®ƒåŸºæœ¬ä¸€è‡´çš„ EdDSA çš„ç®—æ³•æ›´ç®€æ´æ›´æ˜“äºç†è§£ï¼Œåœ¨ä½¿ç”¨ç‰¹å®šæ›²çº¿çš„æƒ…å†µä¸‹ EdDSA è¿˜è¦æ¯” ECDSA æ›´å¿«ä¸€ç‚¹ï¼Œå› æ­¤ç°åœ¨é€šå¸¸æ›´æ¨èä½¿ç”¨ EdDSA ç®—æ³•ã€‚ EdDSA ä¸ Ed25519 ç­¾åç®—æ³•EdDSAï¼ˆEdwards-curve Digital Signature Algorithmï¼‰æ˜¯ä¸€ç§ç°ä»£çš„å®‰å…¨æ•°å­—ç­¾åç®—æ³•ï¼Œå®ƒä½¿ç”¨ä¸“ä¸ºæ€§èƒ½ä¼˜åŒ–çš„æ¤­åœ†æ›²çº¿ï¼Œå¦‚ 255bits æ›²çº¿ edwards25519 å’Œ 448bits æ›²çº¿ edwards448. EdDSA ç­¾åç®—æ³•åŠå…¶å˜ä½“ Ed25519 å’Œ Ed448 åœ¨æŠ€æœ¯ä¸Šåœ¨RFC8032 ä¸­è¿›è¡Œäº†æè¿°ã€‚ é¦–å…ˆï¼Œç”¨æˆ·éœ€è¦åŸºäº edwards25519 æˆ–è€… edwards448 æ›²çº¿ï¼Œç”Ÿæˆä¸€ä¸ª ECC å¯†é’¥å¯¹ã€‚ç”Ÿæˆç§é’¥çš„æ—¶å€™ï¼Œç®—æ³•é¦–å…ˆç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼Œç„¶åä¼šå¯¹éšæœºæ•°åšä¸€äº›å˜æ¢ä»¥ç¡®ä¿å®‰å…¨æ€§ï¼Œé˜²èŒƒè®¡æ—¶æ”»å‡»ç­‰æ”»å‡»æ‰‹æ®µã€‚å¯¹äº edwards25519 å…¬ç§é’¥éƒ½æ˜¯ 32 å­—èŠ‚ï¼Œè€Œå¯¹äº edwards448 å…¬ç§é’¥éƒ½æ˜¯ 57 å­—èŠ‚ã€‚ å¯¹äº edwards25519 è¾“å‡ºçš„ç­¾åé•¿åº¦ä¸º 64 å­—èŠ‚ï¼Œè€Œå¯¹äº Ed448 è¾“å‡ºä¸º 114 å­—èŠ‚ã€‚ å…·ä½“çš„ç®—æ³•è™½ç„¶æ¯” ECDSA ç®€å•ï¼Œä½†è¿˜æ˜¯æœ‰ç‚¹éš¾åº¦çš„ï¼Œè¿™é‡Œå°±ç›´æ¥ç•¥è¿‡äº†ã€‚ ä¸‹é¢ç»™å‡ºä¸ª ed25519 çš„è®¡ç®—ç¤ºä¾‹ï¼š python # pip install cryptography==36.0.1 from cryptography.hazmat.primitives.asymmetric.ed25519 import Ed25519PrivateKey # ä¹Ÿå¯ç”¨ openssl ç”Ÿæˆï¼Œéƒ½æ²¡å•¥æ¯›ç—… private_key = Ed25519PrivateKey.generate() # ç­¾å signature = private_key.sign(b\"my authenticated message\") # æ˜¾ç„¶ ECC çš„å…¬é’¥ kG ä¹Ÿèƒ½ç›´æ¥ä»ç§é’¥ k ç”Ÿæˆ public_key = private_key.public_key() # éªŒè¯ # Raises InvalidSignature if verification fails public_key.verify(signature, b\"my authenticated message\") ed448 çš„ä»£ç ä¹Ÿå®Œå…¨ç±»ä¼¼ï¼š python # pip install cryptography==36.0.1 from cryptography.hazmat.primitives.asymmetric.ed448 import Ed448PrivateKey private_key = Ed448PrivateKey.generate() signature = private_key.sign(b\"my authenticated message\") public_key = private_key.public_key() # Raises InvalidSignature if verification fails public_key.verify(signature, b\"my authenticated message\") ","date":"2022-03-09","objectID":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/:4:5","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","éå¯¹ç§°åŠ å¯†","å®‰å…¨","RSA","ECC"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC","uri":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/#eddsa-ä¸-ed25519-ç­¾åç®—æ³•"},{"categories":["tech"],"content":" å¯†ç å­¦å¸¸ç”¨æ¤­åœ†æ›²çº¿ä»‹ç»åœ¨ä»‹ç»å¯†ç å­¦ä¸­çš„å¸¸ç”¨æ¤­åœ†æ›²çº¿å‰ï¼Œéœ€è¦å…ˆä»‹ç»ä¸€ä¸‹æ¤­åœ†æ›²çº¿çš„é˜¶ï¼ˆorderï¼‰ä»¥åŠè¾…åŠ©å› å­ï¼ˆcofactorï¼‰è¿™ä¸¤ä¸ªæ¦‚å¿µã€‚ é¦–å…ˆè¿˜å¾—ä»‹ç»ä¸‹æ•°å­¦ä¸­ã€Œå¾ªç¯ç¾¤ã€çš„æ¦‚å¿µï¼Œå®ƒæ˜¯æŒ‡èƒ½ç”±å•ä¸ªå…ƒç´ æ‰€ç”Ÿæˆçš„ç¾¤ï¼Œåœ¨ ECC ä¸­è¿™å°±æ˜¯é¢„å…ˆå®šä¹‰å¥½çš„åŸºç‚¹ $G$. ä¸€ä¸ªæœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿å¯ä»¥å½¢æˆä¸€ä¸ªæœ‰é™ã€Œå¾ªç¯ä»£æ•°ç¾¤ã€ï¼Œå®ƒç”±æ›²çº¿ä¸Šçš„æ‰€æœ‰ç‚¹ç»„æˆã€‚æ¤­åœ†æ›²çº¿çš„é˜¶è¢«å®šä¹‰ä¸ºè¯¥æ›²çº¿ä¸Šæ‰€æœ‰ç‚¹çš„ä¸ªæ•°ï¼ˆåŒ…æ‹¬æ— ç©·è¿œç‚¹ï¼‰ã€‚ æœ‰äº›æ›²çº¿åŠ ä¸Š G ç‚¹å¯ä»¥å½¢æˆä¸€ä¸ªå•ä¸€å¾ªç¯ç¾¤ï¼Œè¿™ä¸€ä¸ªç¾¤åŒ…å«äº†æ›²çº¿ä¸Šçš„æ‰€æœ‰ç‚¹ã€‚è€Œå…¶ä»–çš„æ›²çº¿åŠ ä¸Š G ç‚¹åˆ™å½¢æˆå¤šä¸ªä¸ç›¸äº¤çš„å¾ªç¯å­ç¾¤ï¼Œæ¯ä¸ªå­ç¾¤åŒ…å«äº†æ›²çº¿çš„ä¸€ä¸ªå­é›†ã€‚å¯¹äºä¸Šè¿°ç¬¬äºŒç§æƒ…å†µï¼Œå‡è®¾æ›²çº¿ä¸Šçš„ç‚¹è¢«æ‹†åˆ†åˆ°äº† h ä¸ªå¾ªç¯å­ç¾¤ä¸­ï¼Œæ¯ä¸ªå­ç¾¤çš„é˜¶éƒ½æ˜¯ rï¼Œé‚£è¿™æ—¶æ•´ä¸ªç¾¤çš„é˜¶å°±æ˜¯ $n = h * r$ï¼Œå…¶ä¸­å­ç¾¤çš„ä¸ªæ•° h è¢«ç§°ä¸ºè¾…åŠ©å› å­ã€‚ æœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿çš„é˜¶éƒ½æ˜¯æœ‰é™çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹äºæ›²çº¿ä¸Šä»»æ„ä¸€ç‚¹ $G$ï¼Œæˆ‘ä»¬è®¡ç®—å®ƒçš„æ•°ä¹˜ $kG$ï¼Œ éšç€æ•´æ•° $k$ çš„å¢å¤§ï¼Œä¸€å®šä¼šå­˜åœ¨æŸä¸ª $k$ ä½¿ $kG = O_{\\infty}$ æˆç«‹ï¼Œç„¶å $k$ ç»§ç»­å¢å¤§æ—¶ï¼Œå› ä¸º $O_{\\infty} * P = O_{\\infty}$ï¼Œ$kG$ çš„å€¼å°±å›ºå®šä¸º $O_{\\infty}$ äº†ï¼Œæ›´å¤§çš„ $k$ å€¼å·²ç»å¤±å»äº†æ„ä¹‰ã€‚ å› æ­¤ ECC ä¸­è¦æ±‚ $kG$ ä¸­çš„ç§é’¥ $k$ ç¬¦åˆæ¡ä»¶ $0 \\le k \\le r$ï¼Œä¹Ÿå°±æ˜¯è¯´æ€»çš„ç§é’¥æ•°é‡æ˜¯å— $r$ é™åˆ¶çš„ã€‚ è¾…åŠ©å› å­é€šè¿‡ç”¨å¦‚ä¸‹å…¬å¼è¡¨ç¤ºï¼š $$ h = n / r $$ å…¶ä¸­ $n$ æ˜¯æ›²çº¿çš„é˜¶ï¼Œ$r$ æ˜¯æ¯ä¸ªå­ç¾¤çš„é˜¶ï¼Œ$h$ æ˜¯è¾…åŠ©å› å­ã€‚å¦‚æœæ›²çº¿å½¢æˆäº†ä¸€ä¸ªå•ä¸€å¾ªç¯ç¾¤ï¼Œé‚£æ˜¾ç„¶ $h = 1$ï¼Œå¦åˆ™ $h \u003e 1$ ä¸¾ä¾‹å¦‚ä¸‹ï¼š secp256k1 çš„è¾…åŠ©å› å­ä¸º 1 Curve25519 çš„è¾…åŠ©å› å­ä¸º 8 Curve448 çš„è¾…åŠ©å› å­ä¸º 4 ç”Ÿæˆç‚¹ Gç”Ÿæˆç‚¹ G çš„é€‰æ‹©æ˜¯å¾ˆæœ‰è®²ç©¶çš„ï¼Œè™½ç„¶æ¯ä¸ªå¾ªç¯å­ç¾¤éƒ½åŒ…å«æœ‰å¾ˆå¤šä¸ªç”Ÿæˆç‚¹ï¼Œä½†æ˜¯ ECC åªä¼šè°¨æ…çš„é€‰æ‹©å…¶ä¸­ä¸€ä¸ªã€‚é¦–å…ˆ G ç‚¹å¿…é¡»è¦èƒ½ç”Ÿæˆå‡ºæ•´ä¸ªå¾ªç¯å­ç¾¤ï¼Œå…¶æ¬¡è¿˜éœ€è¦æœ‰å°½å¯èƒ½é«˜çš„è®¡ç®—æ€§èƒ½ã€‚ æ•°å­¦ä¸Šå·²çŸ¥æŸäº›æ¤­åœ†æ›²çº¿ä¸Šï¼Œä¸åŒçš„ç”Ÿæˆç‚¹ç”Ÿæˆå‡ºçš„å¾ªç¯å­ç¾¤ï¼Œé˜¶ä¹Ÿæ˜¯ä¸åŒçš„ã€‚å¦‚æœ G ç‚¹é€‰å¾—ä¸å¥½ï¼Œ å¯èƒ½ä¼šå¯¼è‡´ç”Ÿæˆå‡ºçš„å­ç¾¤çš„é˜¶è¾ƒå°ã€‚å‰é¢æˆ‘ä»¬å·²ç»æè¿‡å­ç¾¤çš„é˜¶ $r$ ä¼šé™åˆ¶æ€»çš„ç§é’¥æ•°é‡ï¼Œå¯¼è‡´ç®—æ³•å¼ºåº¦å˜å¼±ï¼å› æ­¤ä¸æ°å½“çš„ $G$ ç‚¹å¯èƒ½ä¼šå¯¼è‡´æˆ‘ä»¬é­å—ã€Œå°å­ç¾¤æ”»å‡»ã€ã€‚ä¸ºäº†é¿å…è¿™ç§é£é™©ï¼Œå»ºè®®å°½é‡ä½¿ç”¨è¢«å¹¿æ³›ä½¿ç”¨çš„åŠ å¯†åº“ï¼Œè€Œä¸æ˜¯è‡ªå·±æ’¸ä¸€ä¸ªã€‚ æ¤­åœ†æ›²çº¿çš„åŸŸå‚æ•°ECCæ¤­åœ†æ›²çº¿ç”±ä¸€ç»„æ¤­åœ†æ›²çº¿åŸŸå‚æ•°æè¿°ï¼Œå¦‚æ›²çº¿æ–¹ç¨‹å‚æ•°ã€åœºå‚æ•°å’Œç”Ÿæˆç‚¹åæ ‡ã€‚è¿™äº›å‚æ•°åœ¨å„ç§å¯†ç å­¦æ ‡å‡†ä¸­æŒ‡å®šï¼Œä½ å¯ä»¥ç½‘ä¸Šæœåˆ°ç›¸åº”çš„ RFC æˆ– NIST æ–‡æ¡£ã€‚ è¿™äº›æ ‡å‡†å®šä¹‰äº†ä¸€ç»„å‘½åæ›²çº¿çš„å‚æ•°ï¼Œä¾‹å¦‚ secp256k1ã€P-521ã€brainpoolP512t1 å’Œ SM2. è¿™äº›åŠ å¯†æ ‡å‡†ä¸­æè¿°çš„æœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿å¾—åˆ°äº†å¯†ç å­¦å®¶çš„å……åˆ†ç ”ç©¶å’Œåˆ†æï¼Œå¹¶è¢«è®¤ä¸ºå…·æœ‰ä¸€å®šçš„å®‰å…¨å¼ºåº¦ã€‚ ä¹Ÿæœ‰ä¸€äº›å¯†ç å­¦å®¶ï¼ˆå¦‚ Daniel Bernsteinï¼‰è®¤ä¸ºï¼Œå®˜æ–¹å¯†ç æ ‡å‡†ä¸­æè¿°çš„å¤§å¤šæ•°æ›²çº¿éƒ½æ˜¯ã€Œä¸å®‰å…¨çš„ã€ï¼Œå¹¶å®šä¹‰äº†ä»–ä»¬è‡ªå·±çš„å¯†ç æ ‡å‡†ï¼Œè¿™äº›æ ‡å‡†åœ¨æ›´å¹¿æ³›çš„å±‚é¢ä¸Šè€ƒè™‘äº† ECC å®‰å…¨æ€§ã€‚ å¼€å‘äººå‘˜åº”è¯¥ä»…ä½¿ç”¨å„é¡¹æ ‡å‡†æ–‡æ¡£ç»™å‡ºçš„ã€ç»è¿‡å¯†ç å­¦å®¶å……åˆ†ç ”ç©¶çš„å‘½åæ›²çº¿ã€‚ secp256k1æ­¤æ›²çº¿è¢«åº”ç”¨åœ¨æ¯”ç‰¹å¸ä¸­ï¼Œå®ƒçš„åŸŸå‚æ•°å¦‚ä¸‹ï¼š p (modulus) =0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F n (order; size; the count of all possible EC points) =0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141 a (æ–¹ç¨‹ $y^2 â‰¡ x^3 + a*x + b (\\mod p)$ ä¸­çš„å¸¸æ•°) =0x0000000000000000000000000000000000000000000000000000000000000000 b (æ–¹ç¨‹ $y^2 â‰¡ x^3 + a*x + b (\\mod p)$ ä¸­çš„å¸¸æ•°)=0x0000000000000000000000000000000000000000000000000000000000000007 g (the curve generator point G {x, y}) = (0x79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798,0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8) h (cofactor, typically 1) = 01 Edwards æ›²çº¿æ¤­åœ†æ›²çº¿æ–¹ç¨‹é™¤äº†æˆ‘ä»¬å‰é¢ä½¿ç”¨çš„ Weierstrass å½¢å¼ $$y^2 = (x^3 + ax + b) \\mod p$$ å¤–ï¼Œè¿˜å¯ä»¥è¢«å†™æˆå…¶ä»–å¤šç§å½¢å¼ï¼Œè¿™äº›ä¸åŒçš„å½¢å¼æ˜¯åŒæœ‰ç†ç­‰ä»·çš„ ï¼ˆåˆ«é—®ï¼Œæˆ‘ä¹Ÿä¸æ‡‚ä»€ä¹ˆå«ã€ŒåŒæœ‰ç†ç­‰ä»·ã€â€¦ï¼‰ã€‚ä¸åŒçš„æ–¹ç¨‹å½¢å¼åœ¨è®¡ç®—æœºçš„æ•°å€¼è®¡ç®—ä¸Šå¯èƒ½ä¼šå­˜åœ¨åŒºåˆ«ã€‚ ä¸ºäº†æ€§èƒ½è€ƒè™‘ï¼ŒECC åœ¨éƒ¨åˆ†åœºæ™¯ä¸‹ä¼šè€ƒè™‘ä½¿ç”¨ Edwards æ›²çº¿å½¢å¼è¿›è¡Œè®¡ç®—ï¼Œè¯¥æ–¹ç¨‹å½¢å¼å¦‚ä¸‹ï¼š $$ x^{2}+y^{2}=1+dx^{2}y^{2} $$ ç”»ä¸ªå›¾é•¿è¿™æ ·ï¼š çŸ¥åçš„ Edwards æ›²çº¿æœ‰ï¼š Curve1174 (251-bit) Curve25519 (255-bit) Curve383187 (383-bit) Curve41417 (414-bit) Curve448 (448-bit) E-521 (521-bit) â€¦ Curve25519, X25519 å’Œ Ed25519 https://www.ietf.org/rfc/rfc7748.html#section-4.1 https://cryptography.io/en/latest/hazmat/primitives/asymmetric/ed25519/ åªè¦åŸŸå‚æ•°é€‰å¾—å¥½ï¼ŒEdwards å°±å¯ä»¥ä»¥éå¸¸é«˜çš„æ€§èƒ½å®ç° ECC å¯†é’¥äº¤æ¢ã€æ•°å­—ç­¾åã€æ··åˆåŠ å¯†æ–¹æ¡ˆã€‚ ä¸€ä¸ªä¾‹å­å°±æ˜¯ Curve25519ï¼Œå®ƒæ˜¯ Edwards æ›²çº¿ï¼Œå…¶ Montgomery å½¢å¼çš„å®šä¹‰å¦‚ä¸‹ï¼š $$ y^{2}=x^{3}+486662x^{2}+x $$ å…¶è¢«å®šä¹‰åœ¨æœ‰é™åŸŸ $\\mathbb {F} _{p}$ ä¸Šï¼Œ$p = 2^{255} - 19$, å…¶ä»–åŸŸå‚æ•°å¦‚ä¸‹ï¼š é˜¶ $n = 2^{252} + 0x14def9dea2f79cd65812631a5cf5d3ed$ è¾…å› å­ h = 8 è™½ç„¶æ­¤æ›²çº¿å¹¶æœªä»¥ Edwards å½¢å¼å®šä¹‰ï¼Œä½†æ˜¯å®ƒå·²è¢«è¯æ˜ä¸å¦‚ä¸‹æ‰­æ›² Edwards æ›²çº¿ï¼ˆedwards25519ï¼‰ åŒæœ‰ç†ç­‰ä»·ï¼š $$ -x^2 + y^2 = 1 + 37095705934669439343138083508754565189542113879843219016388785533085940283555 x^2 y^2 $$ ä¸Šé¢ç»™å‡ºçš„è¿™ç§ Edwards å½¢å¼ä¸å‰æ–‡ç»™å‡ºçš„ Weierstrass å½¢å¼å®Œå…¨ç­‰ä»·ï¼Œæ˜¯ä¸“ä¸ºè®¡ç®—é€Ÿåº¦ä¼˜åŒ–è€Œè®¾è®¡æˆè¿™æ ·çš„ã€‚ Curve25519 ç”± Daniel Bernstein é¢†å¯¼çš„å¯†ç å­¦å®¶å›¢é˜Ÿç²¾å¿ƒè®¾è®¡ï¼Œåœ¨å¤šä¸ªè®¾è®¡å’Œå®ç°å±‚é¢ä¸Šè¾¾æˆäº†éå¸¸é«˜çš„æ€§èƒ½ï¼ŒåŒæ—¶ä¸å½±å“å®‰å…¨æ€§ã€‚ Curve25519 çš„æ„é€ ä½¿å…¶é¿å…äº†è®¸å¤šæ½œåœ¨çš„å®ç°ç¼ºé™·ã€‚æ ¹æ®è®¾è®¡ï¼Œå®ƒä¸å—å®šæ—¶æ”»å‡»çš„å½±å“ï¼Œå¹¶ä¸”å®ƒæ¥å—ä»»ä½• 32 å­—èŠ‚çš„å­—ç¬¦ä¸²ä½œä¸ºæœ‰æ•ˆçš„å…¬é’¥ï¼Œå¹¶ä¸”ä¸éœ€è¦éªŒè¯ã€‚å®ƒèƒ½æä¾› 125.8bits çš„å®‰å…¨å¼ºåº¦ï¼ˆæœ‰æ—¶ç§°ä¸º ~ 128bits å®‰å…¨æ€§ï¼‰ Curve25519 çš„ç§é’¥ä¸º 251 ä½ï¼Œé€šå¸¸ç¼–ç ä¸º 256 ä½æ•´æ•°ï¼ˆ32 ä¸ªå­—èŠ‚ï¼Œ64 ä¸ªåå…­è¿›åˆ¶æ•°å­—ï¼‰ã€‚å…¬é’¥é€šå¸¸ä¹Ÿç¼–ç ä¸º 256 ä½æ•´æ•°ï¼ˆ255 ä½ y åæ ‡ + 1 ä½ x åæ ‡ï¼‰ï¼Œè¿™å¯¹å¼€å‘äººå‘˜æ¥è¯´éå¸¸æ–¹ä¾¿ã€‚ åŸºäº Curve25519 æ´¾ç”Ÿå‡ºäº†åä¸º X25519 çš„ ECDH ç®—æ³•ï¼Œä»¥åŠåŸºäº EdDSA çš„é«˜é€Ÿæ•°å­—ç­¾åç®—æ³•Ed25519. Curve448, X448 å’Œ Ed448 https://www.ietf.org/rfc/rfc7748.html#section-4.2 https://cryptography.io/en/latest/hazmat/primitives/asymmetric/ed448/ Curve448ï¼ˆCurve448-Goldilocksï¼‰æ˜¯ä¸€ç§éæ‰­æ›² Edwards æ›²çº¿ï¼Œå®ƒçš„æ–¹ç¨‹å®šä¹‰å¦‚ä¸‹ï¼š $$ x^2 + y^2 = 1 - 39081 x^2 y^2 $$ å…¶è¢«å®šä¹‰åœ¨æœ‰é™åŸŸ $\\mathbb {F} _{p}$ ä¸Šï¼Œ$p = 2^{448} - 2^{224} - 1$ï¼Œå…¶ä»–åŸŸå‚æ•°ï¼š é˜¶ $n = 2^{446} - 0x8335dc163bb124b65129c96fde933d8d723a70aadc873d6d54a7bb0d$ è¾…åŠ©å› å­ h = 4 ä¸ Curve25519 ä¸€æ ·ï¼ŒCurve448 ä¹Ÿç­‰ä»·äºå‰é¢ç»™å‡ºçš„ Weierstrass å½¢å¼ï¼Œé€‰æ‹© Edwards å½¢å¼ä¸»è¦æ˜¯å› ä¸ºå®ƒèƒ½æ˜¾è‘—æå‡æ€§èƒ½ã€‚ Curve448 æä¾› 222.8 ä½çš„å®‰å…¨å¼ºåº¦ã€‚Curve448 çš„ç§é’¥ä¸º 446 ä½ï¼Œé€šå¸¸ç¼–ç ä¸º 448 ä½æ•´æ•°ï¼ˆ56 ä¸ªå­—èŠ‚ï¼Œ112 ä¸ªåå…­è¿›åˆ¶æ•°å­—ï¼‰ã€‚å…¬é’¥ä¹Ÿè¢«ç¼–ç ä¸º 448 ä½æ•´æ•°ã€‚ åŸºäº Curve44","date":"2022-03-09","objectID":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/:4:6","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","éå¯¹ç§°åŠ å¯†","å®‰å…¨","RSA","ECC"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC","uri":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/#å¯†ç å­¦å¸¸ç”¨æ¤­åœ†æ›²çº¿ä»‹ç»"},{"categories":["tech"],"content":" å¯†ç å­¦å¸¸ç”¨æ¤­åœ†æ›²çº¿ä»‹ç»åœ¨ä»‹ç»å¯†ç å­¦ä¸­çš„å¸¸ç”¨æ¤­åœ†æ›²çº¿å‰ï¼Œéœ€è¦å…ˆä»‹ç»ä¸€ä¸‹æ¤­åœ†æ›²çº¿çš„é˜¶ï¼ˆorderï¼‰ä»¥åŠè¾…åŠ©å› å­ï¼ˆcofactorï¼‰è¿™ä¸¤ä¸ªæ¦‚å¿µã€‚ é¦–å…ˆè¿˜å¾—ä»‹ç»ä¸‹æ•°å­¦ä¸­ã€Œå¾ªç¯ç¾¤ã€çš„æ¦‚å¿µï¼Œå®ƒæ˜¯æŒ‡èƒ½ç”±å•ä¸ªå…ƒç´ æ‰€ç”Ÿæˆçš„ç¾¤ï¼Œåœ¨ ECC ä¸­è¿™å°±æ˜¯é¢„å…ˆå®šä¹‰å¥½çš„åŸºç‚¹ $G$. ä¸€ä¸ªæœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿å¯ä»¥å½¢æˆä¸€ä¸ªæœ‰é™ã€Œå¾ªç¯ä»£æ•°ç¾¤ã€ï¼Œå®ƒç”±æ›²çº¿ä¸Šçš„æ‰€æœ‰ç‚¹ç»„æˆã€‚æ¤­åœ†æ›²çº¿çš„é˜¶è¢«å®šä¹‰ä¸ºè¯¥æ›²çº¿ä¸Šæ‰€æœ‰ç‚¹çš„ä¸ªæ•°ï¼ˆåŒ…æ‹¬æ— ç©·è¿œç‚¹ï¼‰ã€‚ æœ‰äº›æ›²çº¿åŠ ä¸Š G ç‚¹å¯ä»¥å½¢æˆä¸€ä¸ªå•ä¸€å¾ªç¯ç¾¤ï¼Œè¿™ä¸€ä¸ªç¾¤åŒ…å«äº†æ›²çº¿ä¸Šçš„æ‰€æœ‰ç‚¹ã€‚è€Œå…¶ä»–çš„æ›²çº¿åŠ ä¸Š G ç‚¹åˆ™å½¢æˆå¤šä¸ªä¸ç›¸äº¤çš„å¾ªç¯å­ç¾¤ï¼Œæ¯ä¸ªå­ç¾¤åŒ…å«äº†æ›²çº¿çš„ä¸€ä¸ªå­é›†ã€‚å¯¹äºä¸Šè¿°ç¬¬äºŒç§æƒ…å†µï¼Œå‡è®¾æ›²çº¿ä¸Šçš„ç‚¹è¢«æ‹†åˆ†åˆ°äº† h ä¸ªå¾ªç¯å­ç¾¤ä¸­ï¼Œæ¯ä¸ªå­ç¾¤çš„é˜¶éƒ½æ˜¯ rï¼Œé‚£è¿™æ—¶æ•´ä¸ªç¾¤çš„é˜¶å°±æ˜¯ $n = h * r$ï¼Œå…¶ä¸­å­ç¾¤çš„ä¸ªæ•° h è¢«ç§°ä¸ºè¾…åŠ©å› å­ã€‚ æœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿çš„é˜¶éƒ½æ˜¯æœ‰é™çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹äºæ›²çº¿ä¸Šä»»æ„ä¸€ç‚¹ $G$ï¼Œæˆ‘ä»¬è®¡ç®—å®ƒçš„æ•°ä¹˜ $kG$ï¼Œ éšç€æ•´æ•° $k$ çš„å¢å¤§ï¼Œä¸€å®šä¼šå­˜åœ¨æŸä¸ª $k$ ä½¿ $kG = O_{\\infty}$ æˆç«‹ï¼Œç„¶å $k$ ç»§ç»­å¢å¤§æ—¶ï¼Œå› ä¸º $O_{\\infty} * P = O_{\\infty}$ï¼Œ$kG$ çš„å€¼å°±å›ºå®šä¸º $O_{\\infty}$ äº†ï¼Œæ›´å¤§çš„ $k$ å€¼å·²ç»å¤±å»äº†æ„ä¹‰ã€‚ å› æ­¤ ECC ä¸­è¦æ±‚ $kG$ ä¸­çš„ç§é’¥ $k$ ç¬¦åˆæ¡ä»¶ $0 \\le k \\le r$ï¼Œä¹Ÿå°±æ˜¯è¯´æ€»çš„ç§é’¥æ•°é‡æ˜¯å— $r$ é™åˆ¶çš„ã€‚ è¾…åŠ©å› å­é€šè¿‡ç”¨å¦‚ä¸‹å…¬å¼è¡¨ç¤ºï¼š $$ h = n / r $$ å…¶ä¸­ $n$ æ˜¯æ›²çº¿çš„é˜¶ï¼Œ$r$ æ˜¯æ¯ä¸ªå­ç¾¤çš„é˜¶ï¼Œ$h$ æ˜¯è¾…åŠ©å› å­ã€‚å¦‚æœæ›²çº¿å½¢æˆäº†ä¸€ä¸ªå•ä¸€å¾ªç¯ç¾¤ï¼Œé‚£æ˜¾ç„¶ $h = 1$ï¼Œå¦åˆ™ $h \u003e 1$ ä¸¾ä¾‹å¦‚ä¸‹ï¼š secp256k1 çš„è¾…åŠ©å› å­ä¸º 1 Curve25519 çš„è¾…åŠ©å› å­ä¸º 8 Curve448 çš„è¾…åŠ©å› å­ä¸º 4 ç”Ÿæˆç‚¹ Gç”Ÿæˆç‚¹ G çš„é€‰æ‹©æ˜¯å¾ˆæœ‰è®²ç©¶çš„ï¼Œè™½ç„¶æ¯ä¸ªå¾ªç¯å­ç¾¤éƒ½åŒ…å«æœ‰å¾ˆå¤šä¸ªç”Ÿæˆç‚¹ï¼Œä½†æ˜¯ ECC åªä¼šè°¨æ…çš„é€‰æ‹©å…¶ä¸­ä¸€ä¸ªã€‚é¦–å…ˆ G ç‚¹å¿…é¡»è¦èƒ½ç”Ÿæˆå‡ºæ•´ä¸ªå¾ªç¯å­ç¾¤ï¼Œå…¶æ¬¡è¿˜éœ€è¦æœ‰å°½å¯èƒ½é«˜çš„è®¡ç®—æ€§èƒ½ã€‚ æ•°å­¦ä¸Šå·²çŸ¥æŸäº›æ¤­åœ†æ›²çº¿ä¸Šï¼Œä¸åŒçš„ç”Ÿæˆç‚¹ç”Ÿæˆå‡ºçš„å¾ªç¯å­ç¾¤ï¼Œé˜¶ä¹Ÿæ˜¯ä¸åŒçš„ã€‚å¦‚æœ G ç‚¹é€‰å¾—ä¸å¥½ï¼Œ å¯èƒ½ä¼šå¯¼è‡´ç”Ÿæˆå‡ºçš„å­ç¾¤çš„é˜¶è¾ƒå°ã€‚å‰é¢æˆ‘ä»¬å·²ç»æè¿‡å­ç¾¤çš„é˜¶ $r$ ä¼šé™åˆ¶æ€»çš„ç§é’¥æ•°é‡ï¼Œå¯¼è‡´ç®—æ³•å¼ºåº¦å˜å¼±ï¼å› æ­¤ä¸æ°å½“çš„ $G$ ç‚¹å¯èƒ½ä¼šå¯¼è‡´æˆ‘ä»¬é­å—ã€Œå°å­ç¾¤æ”»å‡»ã€ã€‚ä¸ºäº†é¿å…è¿™ç§é£é™©ï¼Œå»ºè®®å°½é‡ä½¿ç”¨è¢«å¹¿æ³›ä½¿ç”¨çš„åŠ å¯†åº“ï¼Œè€Œä¸æ˜¯è‡ªå·±æ’¸ä¸€ä¸ªã€‚ æ¤­åœ†æ›²çº¿çš„åŸŸå‚æ•°ECCæ¤­åœ†æ›²çº¿ç”±ä¸€ç»„æ¤­åœ†æ›²çº¿åŸŸå‚æ•°æè¿°ï¼Œå¦‚æ›²çº¿æ–¹ç¨‹å‚æ•°ã€åœºå‚æ•°å’Œç”Ÿæˆç‚¹åæ ‡ã€‚è¿™äº›å‚æ•°åœ¨å„ç§å¯†ç å­¦æ ‡å‡†ä¸­æŒ‡å®šï¼Œä½ å¯ä»¥ç½‘ä¸Šæœåˆ°ç›¸åº”çš„ RFC æˆ– NIST æ–‡æ¡£ã€‚ è¿™äº›æ ‡å‡†å®šä¹‰äº†ä¸€ç»„å‘½åæ›²çº¿çš„å‚æ•°ï¼Œä¾‹å¦‚ secp256k1ã€P-521ã€brainpoolP512t1 å’Œ SM2. è¿™äº›åŠ å¯†æ ‡å‡†ä¸­æè¿°çš„æœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿å¾—åˆ°äº†å¯†ç å­¦å®¶çš„å……åˆ†ç ”ç©¶å’Œåˆ†æï¼Œå¹¶è¢«è®¤ä¸ºå…·æœ‰ä¸€å®šçš„å®‰å…¨å¼ºåº¦ã€‚ ä¹Ÿæœ‰ä¸€äº›å¯†ç å­¦å®¶ï¼ˆå¦‚ Daniel Bernsteinï¼‰è®¤ä¸ºï¼Œå®˜æ–¹å¯†ç æ ‡å‡†ä¸­æè¿°çš„å¤§å¤šæ•°æ›²çº¿éƒ½æ˜¯ã€Œä¸å®‰å…¨çš„ã€ï¼Œå¹¶å®šä¹‰äº†ä»–ä»¬è‡ªå·±çš„å¯†ç æ ‡å‡†ï¼Œè¿™äº›æ ‡å‡†åœ¨æ›´å¹¿æ³›çš„å±‚é¢ä¸Šè€ƒè™‘äº† ECC å®‰å…¨æ€§ã€‚ å¼€å‘äººå‘˜åº”è¯¥ä»…ä½¿ç”¨å„é¡¹æ ‡å‡†æ–‡æ¡£ç»™å‡ºçš„ã€ç»è¿‡å¯†ç å­¦å®¶å……åˆ†ç ”ç©¶çš„å‘½åæ›²çº¿ã€‚ secp256k1æ­¤æ›²çº¿è¢«åº”ç”¨åœ¨æ¯”ç‰¹å¸ä¸­ï¼Œå®ƒçš„åŸŸå‚æ•°å¦‚ä¸‹ï¼š p (modulus) =0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F n (order; size; the count of all possible EC points) =0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141 a (æ–¹ç¨‹ $y^2 â‰¡ x^3 + a*x + b (\\mod p)$ ä¸­çš„å¸¸æ•°) =0x0000000000000000000000000000000000000000000000000000000000000000 b (æ–¹ç¨‹ $y^2 â‰¡ x^3 + a*x + b (\\mod p)$ ä¸­çš„å¸¸æ•°)=0x0000000000000000000000000000000000000000000000000000000000000007 g (the curve generator point G {x, y}) = (0x79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798,0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8) h (cofactor, typically 1) = 01 Edwards æ›²çº¿æ¤­åœ†æ›²çº¿æ–¹ç¨‹é™¤äº†æˆ‘ä»¬å‰é¢ä½¿ç”¨çš„ Weierstrass å½¢å¼ $$y^2 = (x^3 + ax + b) \\mod p$$ å¤–ï¼Œè¿˜å¯ä»¥è¢«å†™æˆå…¶ä»–å¤šç§å½¢å¼ï¼Œè¿™äº›ä¸åŒçš„å½¢å¼æ˜¯åŒæœ‰ç†ç­‰ä»·çš„ ï¼ˆåˆ«é—®ï¼Œæˆ‘ä¹Ÿä¸æ‡‚ä»€ä¹ˆå«ã€ŒåŒæœ‰ç†ç­‰ä»·ã€â€¦ï¼‰ã€‚ä¸åŒçš„æ–¹ç¨‹å½¢å¼åœ¨è®¡ç®—æœºçš„æ•°å€¼è®¡ç®—ä¸Šå¯èƒ½ä¼šå­˜åœ¨åŒºåˆ«ã€‚ ä¸ºäº†æ€§èƒ½è€ƒè™‘ï¼ŒECC åœ¨éƒ¨åˆ†åœºæ™¯ä¸‹ä¼šè€ƒè™‘ä½¿ç”¨ Edwards æ›²çº¿å½¢å¼è¿›è¡Œè®¡ç®—ï¼Œè¯¥æ–¹ç¨‹å½¢å¼å¦‚ä¸‹ï¼š $$ x^{2}+y^{2}=1+dx^{2}y^{2} $$ ç”»ä¸ªå›¾é•¿è¿™æ ·ï¼š çŸ¥åçš„ Edwards æ›²çº¿æœ‰ï¼š Curve1174 (251-bit) Curve25519 (255-bit) Curve383187 (383-bit) Curve41417 (414-bit) Curve448 (448-bit) E-521 (521-bit) â€¦ Curve25519, X25519 å’Œ Ed25519 https://www.ietf.org/rfc/rfc7748.html#section-4.1 https://cryptography.io/en/latest/hazmat/primitives/asymmetric/ed25519/ åªè¦åŸŸå‚æ•°é€‰å¾—å¥½ï¼ŒEdwards å°±å¯ä»¥ä»¥éå¸¸é«˜çš„æ€§èƒ½å®ç° ECC å¯†é’¥äº¤æ¢ã€æ•°å­—ç­¾åã€æ··åˆåŠ å¯†æ–¹æ¡ˆã€‚ ä¸€ä¸ªä¾‹å­å°±æ˜¯ Curve25519ï¼Œå®ƒæ˜¯ Edwards æ›²çº¿ï¼Œå…¶ Montgomery å½¢å¼çš„å®šä¹‰å¦‚ä¸‹ï¼š $$ y^{2}=x^{3}+486662x^{2}+x $$ å…¶è¢«å®šä¹‰åœ¨æœ‰é™åŸŸ $\\mathbb {F} _{p}$ ä¸Šï¼Œ$p = 2^{255} - 19$, å…¶ä»–åŸŸå‚æ•°å¦‚ä¸‹ï¼š é˜¶ $n = 2^{252} + 0x14def9dea2f79cd65812631a5cf5d3ed$ è¾…å› å­ h = 8 è™½ç„¶æ­¤æ›²çº¿å¹¶æœªä»¥ Edwards å½¢å¼å®šä¹‰ï¼Œä½†æ˜¯å®ƒå·²è¢«è¯æ˜ä¸å¦‚ä¸‹æ‰­æ›² Edwards æ›²çº¿ï¼ˆedwards25519ï¼‰ åŒæœ‰ç†ç­‰ä»·ï¼š $$ -x^2 + y^2 = 1 + 37095705934669439343138083508754565189542113879843219016388785533085940283555 x^2 y^2 $$ ä¸Šé¢ç»™å‡ºçš„è¿™ç§ Edwards å½¢å¼ä¸å‰æ–‡ç»™å‡ºçš„ Weierstrass å½¢å¼å®Œå…¨ç­‰ä»·ï¼Œæ˜¯ä¸“ä¸ºè®¡ç®—é€Ÿåº¦ä¼˜åŒ–è€Œè®¾è®¡æˆè¿™æ ·çš„ã€‚ Curve25519 ç”± Daniel Bernstein é¢†å¯¼çš„å¯†ç å­¦å®¶å›¢é˜Ÿç²¾å¿ƒè®¾è®¡ï¼Œåœ¨å¤šä¸ªè®¾è®¡å’Œå®ç°å±‚é¢ä¸Šè¾¾æˆäº†éå¸¸é«˜çš„æ€§èƒ½ï¼ŒåŒæ—¶ä¸å½±å“å®‰å…¨æ€§ã€‚ Curve25519 çš„æ„é€ ä½¿å…¶é¿å…äº†è®¸å¤šæ½œåœ¨çš„å®ç°ç¼ºé™·ã€‚æ ¹æ®è®¾è®¡ï¼Œå®ƒä¸å—å®šæ—¶æ”»å‡»çš„å½±å“ï¼Œå¹¶ä¸”å®ƒæ¥å—ä»»ä½• 32 å­—èŠ‚çš„å­—ç¬¦ä¸²ä½œä¸ºæœ‰æ•ˆçš„å…¬é’¥ï¼Œå¹¶ä¸”ä¸éœ€è¦éªŒè¯ã€‚å®ƒèƒ½æä¾› 125.8bits çš„å®‰å…¨å¼ºåº¦ï¼ˆæœ‰æ—¶ç§°ä¸º ~ 128bits å®‰å…¨æ€§ï¼‰ Curve25519 çš„ç§é’¥ä¸º 251 ä½ï¼Œé€šå¸¸ç¼–ç ä¸º 256 ä½æ•´æ•°ï¼ˆ32 ä¸ªå­—èŠ‚ï¼Œ64 ä¸ªåå…­è¿›åˆ¶æ•°å­—ï¼‰ã€‚å…¬é’¥é€šå¸¸ä¹Ÿç¼–ç ä¸º 256 ä½æ•´æ•°ï¼ˆ255 ä½ y åæ ‡ + 1 ä½ x åæ ‡ï¼‰ï¼Œè¿™å¯¹å¼€å‘äººå‘˜æ¥è¯´éå¸¸æ–¹ä¾¿ã€‚ åŸºäº Curve25519 æ´¾ç”Ÿå‡ºäº†åä¸º X25519 çš„ ECDH ç®—æ³•ï¼Œä»¥åŠåŸºäº EdDSA çš„é«˜é€Ÿæ•°å­—ç­¾åç®—æ³•Ed25519. Curve448, X448 å’Œ Ed448 https://www.ietf.org/rfc/rfc7748.html#section-4.2 https://cryptography.io/en/latest/hazmat/primitives/asymmetric/ed448/ Curve448ï¼ˆCurve448-Goldilocksï¼‰æ˜¯ä¸€ç§éæ‰­æ›² Edwards æ›²çº¿ï¼Œå®ƒçš„æ–¹ç¨‹å®šä¹‰å¦‚ä¸‹ï¼š $$ x^2 + y^2 = 1 - 39081 x^2 y^2 $$ å…¶è¢«å®šä¹‰åœ¨æœ‰é™åŸŸ $\\mathbb {F} _{p}$ ä¸Šï¼Œ$p = 2^{448} - 2^{224} - 1$ï¼Œå…¶ä»–åŸŸå‚æ•°ï¼š é˜¶ $n = 2^{446} - 0x8335dc163bb124b65129c96fde933d8d723a70aadc873d6d54a7bb0d$ è¾…åŠ©å› å­ h = 4 ä¸ Curve25519 ä¸€æ ·ï¼ŒCurve448 ä¹Ÿç­‰ä»·äºå‰é¢ç»™å‡ºçš„ Weierstrass å½¢å¼ï¼Œé€‰æ‹© Edwards å½¢å¼ä¸»è¦æ˜¯å› ä¸ºå®ƒèƒ½æ˜¾è‘—æå‡æ€§èƒ½ã€‚ Curve448 æä¾› 222.8 ä½çš„å®‰å…¨å¼ºåº¦ã€‚Curve448 çš„ç§é’¥ä¸º 446 ä½ï¼Œé€šå¸¸ç¼–ç ä¸º 448 ä½æ•´æ•°ï¼ˆ56 ä¸ªå­—èŠ‚ï¼Œ112 ä¸ªåå…­è¿›åˆ¶æ•°å­—ï¼‰ã€‚å…¬é’¥ä¹Ÿè¢«ç¼–ç ä¸º 448 ä½æ•´æ•°ã€‚ åŸºäº Curve44","date":"2022-03-09","objectID":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/:4:6","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","éå¯¹ç§°åŠ å¯†","å®‰å…¨","RSA","ECC"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC","uri":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/#ç”Ÿæˆç‚¹-g"},{"categories":["tech"],"content":" å¯†ç å­¦å¸¸ç”¨æ¤­åœ†æ›²çº¿ä»‹ç»åœ¨ä»‹ç»å¯†ç å­¦ä¸­çš„å¸¸ç”¨æ¤­åœ†æ›²çº¿å‰ï¼Œéœ€è¦å…ˆä»‹ç»ä¸€ä¸‹æ¤­åœ†æ›²çº¿çš„é˜¶ï¼ˆorderï¼‰ä»¥åŠè¾…åŠ©å› å­ï¼ˆcofactorï¼‰è¿™ä¸¤ä¸ªæ¦‚å¿µã€‚ é¦–å…ˆè¿˜å¾—ä»‹ç»ä¸‹æ•°å­¦ä¸­ã€Œå¾ªç¯ç¾¤ã€çš„æ¦‚å¿µï¼Œå®ƒæ˜¯æŒ‡èƒ½ç”±å•ä¸ªå…ƒç´ æ‰€ç”Ÿæˆçš„ç¾¤ï¼Œåœ¨ ECC ä¸­è¿™å°±æ˜¯é¢„å…ˆå®šä¹‰å¥½çš„åŸºç‚¹ $G$. ä¸€ä¸ªæœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿å¯ä»¥å½¢æˆä¸€ä¸ªæœ‰é™ã€Œå¾ªç¯ä»£æ•°ç¾¤ã€ï¼Œå®ƒç”±æ›²çº¿ä¸Šçš„æ‰€æœ‰ç‚¹ç»„æˆã€‚æ¤­åœ†æ›²çº¿çš„é˜¶è¢«å®šä¹‰ä¸ºè¯¥æ›²çº¿ä¸Šæ‰€æœ‰ç‚¹çš„ä¸ªæ•°ï¼ˆåŒ…æ‹¬æ— ç©·è¿œç‚¹ï¼‰ã€‚ æœ‰äº›æ›²çº¿åŠ ä¸Š G ç‚¹å¯ä»¥å½¢æˆä¸€ä¸ªå•ä¸€å¾ªç¯ç¾¤ï¼Œè¿™ä¸€ä¸ªç¾¤åŒ…å«äº†æ›²çº¿ä¸Šçš„æ‰€æœ‰ç‚¹ã€‚è€Œå…¶ä»–çš„æ›²çº¿åŠ ä¸Š G ç‚¹åˆ™å½¢æˆå¤šä¸ªä¸ç›¸äº¤çš„å¾ªç¯å­ç¾¤ï¼Œæ¯ä¸ªå­ç¾¤åŒ…å«äº†æ›²çº¿çš„ä¸€ä¸ªå­é›†ã€‚å¯¹äºä¸Šè¿°ç¬¬äºŒç§æƒ…å†µï¼Œå‡è®¾æ›²çº¿ä¸Šçš„ç‚¹è¢«æ‹†åˆ†åˆ°äº† h ä¸ªå¾ªç¯å­ç¾¤ä¸­ï¼Œæ¯ä¸ªå­ç¾¤çš„é˜¶éƒ½æ˜¯ rï¼Œé‚£è¿™æ—¶æ•´ä¸ªç¾¤çš„é˜¶å°±æ˜¯ $n = h * r$ï¼Œå…¶ä¸­å­ç¾¤çš„ä¸ªæ•° h è¢«ç§°ä¸ºè¾…åŠ©å› å­ã€‚ æœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿çš„é˜¶éƒ½æ˜¯æœ‰é™çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹äºæ›²çº¿ä¸Šä»»æ„ä¸€ç‚¹ $G$ï¼Œæˆ‘ä»¬è®¡ç®—å®ƒçš„æ•°ä¹˜ $kG$ï¼Œ éšç€æ•´æ•° $k$ çš„å¢å¤§ï¼Œä¸€å®šä¼šå­˜åœ¨æŸä¸ª $k$ ä½¿ $kG = O_{\\infty}$ æˆç«‹ï¼Œç„¶å $k$ ç»§ç»­å¢å¤§æ—¶ï¼Œå› ä¸º $O_{\\infty} * P = O_{\\infty}$ï¼Œ$kG$ çš„å€¼å°±å›ºå®šä¸º $O_{\\infty}$ äº†ï¼Œæ›´å¤§çš„ $k$ å€¼å·²ç»å¤±å»äº†æ„ä¹‰ã€‚ å› æ­¤ ECC ä¸­è¦æ±‚ $kG$ ä¸­çš„ç§é’¥ $k$ ç¬¦åˆæ¡ä»¶ $0 \\le k \\le r$ï¼Œä¹Ÿå°±æ˜¯è¯´æ€»çš„ç§é’¥æ•°é‡æ˜¯å— $r$ é™åˆ¶çš„ã€‚ è¾…åŠ©å› å­é€šè¿‡ç”¨å¦‚ä¸‹å…¬å¼è¡¨ç¤ºï¼š $$ h = n / r $$ å…¶ä¸­ $n$ æ˜¯æ›²çº¿çš„é˜¶ï¼Œ$r$ æ˜¯æ¯ä¸ªå­ç¾¤çš„é˜¶ï¼Œ$h$ æ˜¯è¾…åŠ©å› å­ã€‚å¦‚æœæ›²çº¿å½¢æˆäº†ä¸€ä¸ªå•ä¸€å¾ªç¯ç¾¤ï¼Œé‚£æ˜¾ç„¶ $h = 1$ï¼Œå¦åˆ™ $h \u003e 1$ ä¸¾ä¾‹å¦‚ä¸‹ï¼š secp256k1 çš„è¾…åŠ©å› å­ä¸º 1 Curve25519 çš„è¾…åŠ©å› å­ä¸º 8 Curve448 çš„è¾…åŠ©å› å­ä¸º 4 ç”Ÿæˆç‚¹ Gç”Ÿæˆç‚¹ G çš„é€‰æ‹©æ˜¯å¾ˆæœ‰è®²ç©¶çš„ï¼Œè™½ç„¶æ¯ä¸ªå¾ªç¯å­ç¾¤éƒ½åŒ…å«æœ‰å¾ˆå¤šä¸ªç”Ÿæˆç‚¹ï¼Œä½†æ˜¯ ECC åªä¼šè°¨æ…çš„é€‰æ‹©å…¶ä¸­ä¸€ä¸ªã€‚é¦–å…ˆ G ç‚¹å¿…é¡»è¦èƒ½ç”Ÿæˆå‡ºæ•´ä¸ªå¾ªç¯å­ç¾¤ï¼Œå…¶æ¬¡è¿˜éœ€è¦æœ‰å°½å¯èƒ½é«˜çš„è®¡ç®—æ€§èƒ½ã€‚ æ•°å­¦ä¸Šå·²çŸ¥æŸäº›æ¤­åœ†æ›²çº¿ä¸Šï¼Œä¸åŒçš„ç”Ÿæˆç‚¹ç”Ÿæˆå‡ºçš„å¾ªç¯å­ç¾¤ï¼Œé˜¶ä¹Ÿæ˜¯ä¸åŒçš„ã€‚å¦‚æœ G ç‚¹é€‰å¾—ä¸å¥½ï¼Œ å¯èƒ½ä¼šå¯¼è‡´ç”Ÿæˆå‡ºçš„å­ç¾¤çš„é˜¶è¾ƒå°ã€‚å‰é¢æˆ‘ä»¬å·²ç»æè¿‡å­ç¾¤çš„é˜¶ $r$ ä¼šé™åˆ¶æ€»çš„ç§é’¥æ•°é‡ï¼Œå¯¼è‡´ç®—æ³•å¼ºåº¦å˜å¼±ï¼å› æ­¤ä¸æ°å½“çš„ $G$ ç‚¹å¯èƒ½ä¼šå¯¼è‡´æˆ‘ä»¬é­å—ã€Œå°å­ç¾¤æ”»å‡»ã€ã€‚ä¸ºäº†é¿å…è¿™ç§é£é™©ï¼Œå»ºè®®å°½é‡ä½¿ç”¨è¢«å¹¿æ³›ä½¿ç”¨çš„åŠ å¯†åº“ï¼Œè€Œä¸æ˜¯è‡ªå·±æ’¸ä¸€ä¸ªã€‚ æ¤­åœ†æ›²çº¿çš„åŸŸå‚æ•°ECCæ¤­åœ†æ›²çº¿ç”±ä¸€ç»„æ¤­åœ†æ›²çº¿åŸŸå‚æ•°æè¿°ï¼Œå¦‚æ›²çº¿æ–¹ç¨‹å‚æ•°ã€åœºå‚æ•°å’Œç”Ÿæˆç‚¹åæ ‡ã€‚è¿™äº›å‚æ•°åœ¨å„ç§å¯†ç å­¦æ ‡å‡†ä¸­æŒ‡å®šï¼Œä½ å¯ä»¥ç½‘ä¸Šæœåˆ°ç›¸åº”çš„ RFC æˆ– NIST æ–‡æ¡£ã€‚ è¿™äº›æ ‡å‡†å®šä¹‰äº†ä¸€ç»„å‘½åæ›²çº¿çš„å‚æ•°ï¼Œä¾‹å¦‚ secp256k1ã€P-521ã€brainpoolP512t1 å’Œ SM2. è¿™äº›åŠ å¯†æ ‡å‡†ä¸­æè¿°çš„æœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿å¾—åˆ°äº†å¯†ç å­¦å®¶çš„å……åˆ†ç ”ç©¶å’Œåˆ†æï¼Œå¹¶è¢«è®¤ä¸ºå…·æœ‰ä¸€å®šçš„å®‰å…¨å¼ºåº¦ã€‚ ä¹Ÿæœ‰ä¸€äº›å¯†ç å­¦å®¶ï¼ˆå¦‚ Daniel Bernsteinï¼‰è®¤ä¸ºï¼Œå®˜æ–¹å¯†ç æ ‡å‡†ä¸­æè¿°çš„å¤§å¤šæ•°æ›²çº¿éƒ½æ˜¯ã€Œä¸å®‰å…¨çš„ã€ï¼Œå¹¶å®šä¹‰äº†ä»–ä»¬è‡ªå·±çš„å¯†ç æ ‡å‡†ï¼Œè¿™äº›æ ‡å‡†åœ¨æ›´å¹¿æ³›çš„å±‚é¢ä¸Šè€ƒè™‘äº† ECC å®‰å…¨æ€§ã€‚ å¼€å‘äººå‘˜åº”è¯¥ä»…ä½¿ç”¨å„é¡¹æ ‡å‡†æ–‡æ¡£ç»™å‡ºçš„ã€ç»è¿‡å¯†ç å­¦å®¶å……åˆ†ç ”ç©¶çš„å‘½åæ›²çº¿ã€‚ secp256k1æ­¤æ›²çº¿è¢«åº”ç”¨åœ¨æ¯”ç‰¹å¸ä¸­ï¼Œå®ƒçš„åŸŸå‚æ•°å¦‚ä¸‹ï¼š p (modulus) =0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F n (order; size; the count of all possible EC points) =0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141 a (æ–¹ç¨‹ $y^2 â‰¡ x^3 + a*x + b (\\mod p)$ ä¸­çš„å¸¸æ•°) =0x0000000000000000000000000000000000000000000000000000000000000000 b (æ–¹ç¨‹ $y^2 â‰¡ x^3 + a*x + b (\\mod p)$ ä¸­çš„å¸¸æ•°)=0x0000000000000000000000000000000000000000000000000000000000000007 g (the curve generator point G {x, y}) = (0x79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798,0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8) h (cofactor, typically 1) = 01 Edwards æ›²çº¿æ¤­åœ†æ›²çº¿æ–¹ç¨‹é™¤äº†æˆ‘ä»¬å‰é¢ä½¿ç”¨çš„ Weierstrass å½¢å¼ $$y^2 = (x^3 + ax + b) \\mod p$$ å¤–ï¼Œè¿˜å¯ä»¥è¢«å†™æˆå…¶ä»–å¤šç§å½¢å¼ï¼Œè¿™äº›ä¸åŒçš„å½¢å¼æ˜¯åŒæœ‰ç†ç­‰ä»·çš„ ï¼ˆåˆ«é—®ï¼Œæˆ‘ä¹Ÿä¸æ‡‚ä»€ä¹ˆå«ã€ŒåŒæœ‰ç†ç­‰ä»·ã€â€¦ï¼‰ã€‚ä¸åŒçš„æ–¹ç¨‹å½¢å¼åœ¨è®¡ç®—æœºçš„æ•°å€¼è®¡ç®—ä¸Šå¯èƒ½ä¼šå­˜åœ¨åŒºåˆ«ã€‚ ä¸ºäº†æ€§èƒ½è€ƒè™‘ï¼ŒECC åœ¨éƒ¨åˆ†åœºæ™¯ä¸‹ä¼šè€ƒè™‘ä½¿ç”¨ Edwards æ›²çº¿å½¢å¼è¿›è¡Œè®¡ç®—ï¼Œè¯¥æ–¹ç¨‹å½¢å¼å¦‚ä¸‹ï¼š $$ x^{2}+y^{2}=1+dx^{2}y^{2} $$ ç”»ä¸ªå›¾é•¿è¿™æ ·ï¼š çŸ¥åçš„ Edwards æ›²çº¿æœ‰ï¼š Curve1174 (251-bit) Curve25519 (255-bit) Curve383187 (383-bit) Curve41417 (414-bit) Curve448 (448-bit) E-521 (521-bit) â€¦ Curve25519, X25519 å’Œ Ed25519 https://www.ietf.org/rfc/rfc7748.html#section-4.1 https://cryptography.io/en/latest/hazmat/primitives/asymmetric/ed25519/ åªè¦åŸŸå‚æ•°é€‰å¾—å¥½ï¼ŒEdwards å°±å¯ä»¥ä»¥éå¸¸é«˜çš„æ€§èƒ½å®ç° ECC å¯†é’¥äº¤æ¢ã€æ•°å­—ç­¾åã€æ··åˆåŠ å¯†æ–¹æ¡ˆã€‚ ä¸€ä¸ªä¾‹å­å°±æ˜¯ Curve25519ï¼Œå®ƒæ˜¯ Edwards æ›²çº¿ï¼Œå…¶ Montgomery å½¢å¼çš„å®šä¹‰å¦‚ä¸‹ï¼š $$ y^{2}=x^{3}+486662x^{2}+x $$ å…¶è¢«å®šä¹‰åœ¨æœ‰é™åŸŸ $\\mathbb {F} _{p}$ ä¸Šï¼Œ$p = 2^{255} - 19$, å…¶ä»–åŸŸå‚æ•°å¦‚ä¸‹ï¼š é˜¶ $n = 2^{252} + 0x14def9dea2f79cd65812631a5cf5d3ed$ è¾…å› å­ h = 8 è™½ç„¶æ­¤æ›²çº¿å¹¶æœªä»¥ Edwards å½¢å¼å®šä¹‰ï¼Œä½†æ˜¯å®ƒå·²è¢«è¯æ˜ä¸å¦‚ä¸‹æ‰­æ›² Edwards æ›²çº¿ï¼ˆedwards25519ï¼‰ åŒæœ‰ç†ç­‰ä»·ï¼š $$ -x^2 + y^2 = 1 + 37095705934669439343138083508754565189542113879843219016388785533085940283555 x^2 y^2 $$ ä¸Šé¢ç»™å‡ºçš„è¿™ç§ Edwards å½¢å¼ä¸å‰æ–‡ç»™å‡ºçš„ Weierstrass å½¢å¼å®Œå…¨ç­‰ä»·ï¼Œæ˜¯ä¸“ä¸ºè®¡ç®—é€Ÿåº¦ä¼˜åŒ–è€Œè®¾è®¡æˆè¿™æ ·çš„ã€‚ Curve25519 ç”± Daniel Bernstein é¢†å¯¼çš„å¯†ç å­¦å®¶å›¢é˜Ÿç²¾å¿ƒè®¾è®¡ï¼Œåœ¨å¤šä¸ªè®¾è®¡å’Œå®ç°å±‚é¢ä¸Šè¾¾æˆäº†éå¸¸é«˜çš„æ€§èƒ½ï¼ŒåŒæ—¶ä¸å½±å“å®‰å…¨æ€§ã€‚ Curve25519 çš„æ„é€ ä½¿å…¶é¿å…äº†è®¸å¤šæ½œåœ¨çš„å®ç°ç¼ºé™·ã€‚æ ¹æ®è®¾è®¡ï¼Œå®ƒä¸å—å®šæ—¶æ”»å‡»çš„å½±å“ï¼Œå¹¶ä¸”å®ƒæ¥å—ä»»ä½• 32 å­—èŠ‚çš„å­—ç¬¦ä¸²ä½œä¸ºæœ‰æ•ˆçš„å…¬é’¥ï¼Œå¹¶ä¸”ä¸éœ€è¦éªŒè¯ã€‚å®ƒèƒ½æä¾› 125.8bits çš„å®‰å…¨å¼ºåº¦ï¼ˆæœ‰æ—¶ç§°ä¸º ~ 128bits å®‰å…¨æ€§ï¼‰ Curve25519 çš„ç§é’¥ä¸º 251 ä½ï¼Œé€šå¸¸ç¼–ç ä¸º 256 ä½æ•´æ•°ï¼ˆ32 ä¸ªå­—èŠ‚ï¼Œ64 ä¸ªåå…­è¿›åˆ¶æ•°å­—ï¼‰ã€‚å…¬é’¥é€šå¸¸ä¹Ÿç¼–ç ä¸º 256 ä½æ•´æ•°ï¼ˆ255 ä½ y åæ ‡ + 1 ä½ x åæ ‡ï¼‰ï¼Œè¿™å¯¹å¼€å‘äººå‘˜æ¥è¯´éå¸¸æ–¹ä¾¿ã€‚ åŸºäº Curve25519 æ´¾ç”Ÿå‡ºäº†åä¸º X25519 çš„ ECDH ç®—æ³•ï¼Œä»¥åŠåŸºäº EdDSA çš„é«˜é€Ÿæ•°å­—ç­¾åç®—æ³•Ed25519. Curve448, X448 å’Œ Ed448 https://www.ietf.org/rfc/rfc7748.html#section-4.2 https://cryptography.io/en/latest/hazmat/primitives/asymmetric/ed448/ Curve448ï¼ˆCurve448-Goldilocksï¼‰æ˜¯ä¸€ç§éæ‰­æ›² Edwards æ›²çº¿ï¼Œå®ƒçš„æ–¹ç¨‹å®šä¹‰å¦‚ä¸‹ï¼š $$ x^2 + y^2 = 1 - 39081 x^2 y^2 $$ å…¶è¢«å®šä¹‰åœ¨æœ‰é™åŸŸ $\\mathbb {F} _{p}$ ä¸Šï¼Œ$p = 2^{448} - 2^{224} - 1$ï¼Œå…¶ä»–åŸŸå‚æ•°ï¼š é˜¶ $n = 2^{446} - 0x8335dc163bb124b65129c96fde933d8d723a70aadc873d6d54a7bb0d$ è¾…åŠ©å› å­ h = 4 ä¸ Curve25519 ä¸€æ ·ï¼ŒCurve448 ä¹Ÿç­‰ä»·äºå‰é¢ç»™å‡ºçš„ Weierstrass å½¢å¼ï¼Œé€‰æ‹© Edwards å½¢å¼ä¸»è¦æ˜¯å› ä¸ºå®ƒèƒ½æ˜¾è‘—æå‡æ€§èƒ½ã€‚ Curve448 æä¾› 222.8 ä½çš„å®‰å…¨å¼ºåº¦ã€‚Curve448 çš„ç§é’¥ä¸º 446 ä½ï¼Œé€šå¸¸ç¼–ç ä¸º 448 ä½æ•´æ•°ï¼ˆ56 ä¸ªå­—èŠ‚ï¼Œ112 ä¸ªåå…­è¿›åˆ¶æ•°å­—ï¼‰ã€‚å…¬é’¥ä¹Ÿè¢«ç¼–ç ä¸º 448 ä½æ•´æ•°ã€‚ åŸºäº Curve44","date":"2022-03-09","objectID":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/:4:6","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","éå¯¹ç§°åŠ å¯†","å®‰å…¨","RSA","ECC"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC","uri":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/#æ¤­åœ†æ›²çº¿çš„åŸŸå‚æ•°"},{"categories":["tech"],"content":" å¯†ç å­¦å¸¸ç”¨æ¤­åœ†æ›²çº¿ä»‹ç»åœ¨ä»‹ç»å¯†ç å­¦ä¸­çš„å¸¸ç”¨æ¤­åœ†æ›²çº¿å‰ï¼Œéœ€è¦å…ˆä»‹ç»ä¸€ä¸‹æ¤­åœ†æ›²çº¿çš„é˜¶ï¼ˆorderï¼‰ä»¥åŠè¾…åŠ©å› å­ï¼ˆcofactorï¼‰è¿™ä¸¤ä¸ªæ¦‚å¿µã€‚ é¦–å…ˆè¿˜å¾—ä»‹ç»ä¸‹æ•°å­¦ä¸­ã€Œå¾ªç¯ç¾¤ã€çš„æ¦‚å¿µï¼Œå®ƒæ˜¯æŒ‡èƒ½ç”±å•ä¸ªå…ƒç´ æ‰€ç”Ÿæˆçš„ç¾¤ï¼Œåœ¨ ECC ä¸­è¿™å°±æ˜¯é¢„å…ˆå®šä¹‰å¥½çš„åŸºç‚¹ $G$. ä¸€ä¸ªæœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿å¯ä»¥å½¢æˆä¸€ä¸ªæœ‰é™ã€Œå¾ªç¯ä»£æ•°ç¾¤ã€ï¼Œå®ƒç”±æ›²çº¿ä¸Šçš„æ‰€æœ‰ç‚¹ç»„æˆã€‚æ¤­åœ†æ›²çº¿çš„é˜¶è¢«å®šä¹‰ä¸ºè¯¥æ›²çº¿ä¸Šæ‰€æœ‰ç‚¹çš„ä¸ªæ•°ï¼ˆåŒ…æ‹¬æ— ç©·è¿œç‚¹ï¼‰ã€‚ æœ‰äº›æ›²çº¿åŠ ä¸Š G ç‚¹å¯ä»¥å½¢æˆä¸€ä¸ªå•ä¸€å¾ªç¯ç¾¤ï¼Œè¿™ä¸€ä¸ªç¾¤åŒ…å«äº†æ›²çº¿ä¸Šçš„æ‰€æœ‰ç‚¹ã€‚è€Œå…¶ä»–çš„æ›²çº¿åŠ ä¸Š G ç‚¹åˆ™å½¢æˆå¤šä¸ªä¸ç›¸äº¤çš„å¾ªç¯å­ç¾¤ï¼Œæ¯ä¸ªå­ç¾¤åŒ…å«äº†æ›²çº¿çš„ä¸€ä¸ªå­é›†ã€‚å¯¹äºä¸Šè¿°ç¬¬äºŒç§æƒ…å†µï¼Œå‡è®¾æ›²çº¿ä¸Šçš„ç‚¹è¢«æ‹†åˆ†åˆ°äº† h ä¸ªå¾ªç¯å­ç¾¤ä¸­ï¼Œæ¯ä¸ªå­ç¾¤çš„é˜¶éƒ½æ˜¯ rï¼Œé‚£è¿™æ—¶æ•´ä¸ªç¾¤çš„é˜¶å°±æ˜¯ $n = h * r$ï¼Œå…¶ä¸­å­ç¾¤çš„ä¸ªæ•° h è¢«ç§°ä¸ºè¾…åŠ©å› å­ã€‚ æœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿çš„é˜¶éƒ½æ˜¯æœ‰é™çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹äºæ›²çº¿ä¸Šä»»æ„ä¸€ç‚¹ $G$ï¼Œæˆ‘ä»¬è®¡ç®—å®ƒçš„æ•°ä¹˜ $kG$ï¼Œ éšç€æ•´æ•° $k$ çš„å¢å¤§ï¼Œä¸€å®šä¼šå­˜åœ¨æŸä¸ª $k$ ä½¿ $kG = O_{\\infty}$ æˆç«‹ï¼Œç„¶å $k$ ç»§ç»­å¢å¤§æ—¶ï¼Œå› ä¸º $O_{\\infty} * P = O_{\\infty}$ï¼Œ$kG$ çš„å€¼å°±å›ºå®šä¸º $O_{\\infty}$ äº†ï¼Œæ›´å¤§çš„ $k$ å€¼å·²ç»å¤±å»äº†æ„ä¹‰ã€‚ å› æ­¤ ECC ä¸­è¦æ±‚ $kG$ ä¸­çš„ç§é’¥ $k$ ç¬¦åˆæ¡ä»¶ $0 \\le k \\le r$ï¼Œä¹Ÿå°±æ˜¯è¯´æ€»çš„ç§é’¥æ•°é‡æ˜¯å— $r$ é™åˆ¶çš„ã€‚ è¾…åŠ©å› å­é€šè¿‡ç”¨å¦‚ä¸‹å…¬å¼è¡¨ç¤ºï¼š $$ h = n / r $$ å…¶ä¸­ $n$ æ˜¯æ›²çº¿çš„é˜¶ï¼Œ$r$ æ˜¯æ¯ä¸ªå­ç¾¤çš„é˜¶ï¼Œ$h$ æ˜¯è¾…åŠ©å› å­ã€‚å¦‚æœæ›²çº¿å½¢æˆäº†ä¸€ä¸ªå•ä¸€å¾ªç¯ç¾¤ï¼Œé‚£æ˜¾ç„¶ $h = 1$ï¼Œå¦åˆ™ $h \u003e 1$ ä¸¾ä¾‹å¦‚ä¸‹ï¼š secp256k1 çš„è¾…åŠ©å› å­ä¸º 1 Curve25519 çš„è¾…åŠ©å› å­ä¸º 8 Curve448 çš„è¾…åŠ©å› å­ä¸º 4 ç”Ÿæˆç‚¹ Gç”Ÿæˆç‚¹ G çš„é€‰æ‹©æ˜¯å¾ˆæœ‰è®²ç©¶çš„ï¼Œè™½ç„¶æ¯ä¸ªå¾ªç¯å­ç¾¤éƒ½åŒ…å«æœ‰å¾ˆå¤šä¸ªç”Ÿæˆç‚¹ï¼Œä½†æ˜¯ ECC åªä¼šè°¨æ…çš„é€‰æ‹©å…¶ä¸­ä¸€ä¸ªã€‚é¦–å…ˆ G ç‚¹å¿…é¡»è¦èƒ½ç”Ÿæˆå‡ºæ•´ä¸ªå¾ªç¯å­ç¾¤ï¼Œå…¶æ¬¡è¿˜éœ€è¦æœ‰å°½å¯èƒ½é«˜çš„è®¡ç®—æ€§èƒ½ã€‚ æ•°å­¦ä¸Šå·²çŸ¥æŸäº›æ¤­åœ†æ›²çº¿ä¸Šï¼Œä¸åŒçš„ç”Ÿæˆç‚¹ç”Ÿæˆå‡ºçš„å¾ªç¯å­ç¾¤ï¼Œé˜¶ä¹Ÿæ˜¯ä¸åŒçš„ã€‚å¦‚æœ G ç‚¹é€‰å¾—ä¸å¥½ï¼Œ å¯èƒ½ä¼šå¯¼è‡´ç”Ÿæˆå‡ºçš„å­ç¾¤çš„é˜¶è¾ƒå°ã€‚å‰é¢æˆ‘ä»¬å·²ç»æè¿‡å­ç¾¤çš„é˜¶ $r$ ä¼šé™åˆ¶æ€»çš„ç§é’¥æ•°é‡ï¼Œå¯¼è‡´ç®—æ³•å¼ºåº¦å˜å¼±ï¼å› æ­¤ä¸æ°å½“çš„ $G$ ç‚¹å¯èƒ½ä¼šå¯¼è‡´æˆ‘ä»¬é­å—ã€Œå°å­ç¾¤æ”»å‡»ã€ã€‚ä¸ºäº†é¿å…è¿™ç§é£é™©ï¼Œå»ºè®®å°½é‡ä½¿ç”¨è¢«å¹¿æ³›ä½¿ç”¨çš„åŠ å¯†åº“ï¼Œè€Œä¸æ˜¯è‡ªå·±æ’¸ä¸€ä¸ªã€‚ æ¤­åœ†æ›²çº¿çš„åŸŸå‚æ•°ECCæ¤­åœ†æ›²çº¿ç”±ä¸€ç»„æ¤­åœ†æ›²çº¿åŸŸå‚æ•°æè¿°ï¼Œå¦‚æ›²çº¿æ–¹ç¨‹å‚æ•°ã€åœºå‚æ•°å’Œç”Ÿæˆç‚¹åæ ‡ã€‚è¿™äº›å‚æ•°åœ¨å„ç§å¯†ç å­¦æ ‡å‡†ä¸­æŒ‡å®šï¼Œä½ å¯ä»¥ç½‘ä¸Šæœåˆ°ç›¸åº”çš„ RFC æˆ– NIST æ–‡æ¡£ã€‚ è¿™äº›æ ‡å‡†å®šä¹‰äº†ä¸€ç»„å‘½åæ›²çº¿çš„å‚æ•°ï¼Œä¾‹å¦‚ secp256k1ã€P-521ã€brainpoolP512t1 å’Œ SM2. è¿™äº›åŠ å¯†æ ‡å‡†ä¸­æè¿°çš„æœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿å¾—åˆ°äº†å¯†ç å­¦å®¶çš„å……åˆ†ç ”ç©¶å’Œåˆ†æï¼Œå¹¶è¢«è®¤ä¸ºå…·æœ‰ä¸€å®šçš„å®‰å…¨å¼ºåº¦ã€‚ ä¹Ÿæœ‰ä¸€äº›å¯†ç å­¦å®¶ï¼ˆå¦‚ Daniel Bernsteinï¼‰è®¤ä¸ºï¼Œå®˜æ–¹å¯†ç æ ‡å‡†ä¸­æè¿°çš„å¤§å¤šæ•°æ›²çº¿éƒ½æ˜¯ã€Œä¸å®‰å…¨çš„ã€ï¼Œå¹¶å®šä¹‰äº†ä»–ä»¬è‡ªå·±çš„å¯†ç æ ‡å‡†ï¼Œè¿™äº›æ ‡å‡†åœ¨æ›´å¹¿æ³›çš„å±‚é¢ä¸Šè€ƒè™‘äº† ECC å®‰å…¨æ€§ã€‚ å¼€å‘äººå‘˜åº”è¯¥ä»…ä½¿ç”¨å„é¡¹æ ‡å‡†æ–‡æ¡£ç»™å‡ºçš„ã€ç»è¿‡å¯†ç å­¦å®¶å……åˆ†ç ”ç©¶çš„å‘½åæ›²çº¿ã€‚ secp256k1æ­¤æ›²çº¿è¢«åº”ç”¨åœ¨æ¯”ç‰¹å¸ä¸­ï¼Œå®ƒçš„åŸŸå‚æ•°å¦‚ä¸‹ï¼š p (modulus) =0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F n (order; size; the count of all possible EC points) =0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141 a (æ–¹ç¨‹ $y^2 â‰¡ x^3 + a*x + b (\\mod p)$ ä¸­çš„å¸¸æ•°) =0x0000000000000000000000000000000000000000000000000000000000000000 b (æ–¹ç¨‹ $y^2 â‰¡ x^3 + a*x + b (\\mod p)$ ä¸­çš„å¸¸æ•°)=0x0000000000000000000000000000000000000000000000000000000000000007 g (the curve generator point G {x, y}) = (0x79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798,0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8) h (cofactor, typically 1) = 01 Edwards æ›²çº¿æ¤­åœ†æ›²çº¿æ–¹ç¨‹é™¤äº†æˆ‘ä»¬å‰é¢ä½¿ç”¨çš„ Weierstrass å½¢å¼ $$y^2 = (x^3 + ax + b) \\mod p$$ å¤–ï¼Œè¿˜å¯ä»¥è¢«å†™æˆå…¶ä»–å¤šç§å½¢å¼ï¼Œè¿™äº›ä¸åŒçš„å½¢å¼æ˜¯åŒæœ‰ç†ç­‰ä»·çš„ ï¼ˆåˆ«é—®ï¼Œæˆ‘ä¹Ÿä¸æ‡‚ä»€ä¹ˆå«ã€ŒåŒæœ‰ç†ç­‰ä»·ã€â€¦ï¼‰ã€‚ä¸åŒçš„æ–¹ç¨‹å½¢å¼åœ¨è®¡ç®—æœºçš„æ•°å€¼è®¡ç®—ä¸Šå¯èƒ½ä¼šå­˜åœ¨åŒºåˆ«ã€‚ ä¸ºäº†æ€§èƒ½è€ƒè™‘ï¼ŒECC åœ¨éƒ¨åˆ†åœºæ™¯ä¸‹ä¼šè€ƒè™‘ä½¿ç”¨ Edwards æ›²çº¿å½¢å¼è¿›è¡Œè®¡ç®—ï¼Œè¯¥æ–¹ç¨‹å½¢å¼å¦‚ä¸‹ï¼š $$ x^{2}+y^{2}=1+dx^{2}y^{2} $$ ç”»ä¸ªå›¾é•¿è¿™æ ·ï¼š çŸ¥åçš„ Edwards æ›²çº¿æœ‰ï¼š Curve1174 (251-bit) Curve25519 (255-bit) Curve383187 (383-bit) Curve41417 (414-bit) Curve448 (448-bit) E-521 (521-bit) â€¦ Curve25519, X25519 å’Œ Ed25519 https://www.ietf.org/rfc/rfc7748.html#section-4.1 https://cryptography.io/en/latest/hazmat/primitives/asymmetric/ed25519/ åªè¦åŸŸå‚æ•°é€‰å¾—å¥½ï¼ŒEdwards å°±å¯ä»¥ä»¥éå¸¸é«˜çš„æ€§èƒ½å®ç° ECC å¯†é’¥äº¤æ¢ã€æ•°å­—ç­¾åã€æ··åˆåŠ å¯†æ–¹æ¡ˆã€‚ ä¸€ä¸ªä¾‹å­å°±æ˜¯ Curve25519ï¼Œå®ƒæ˜¯ Edwards æ›²çº¿ï¼Œå…¶ Montgomery å½¢å¼çš„å®šä¹‰å¦‚ä¸‹ï¼š $$ y^{2}=x^{3}+486662x^{2}+x $$ å…¶è¢«å®šä¹‰åœ¨æœ‰é™åŸŸ $\\mathbb {F} _{p}$ ä¸Šï¼Œ$p = 2^{255} - 19$, å…¶ä»–åŸŸå‚æ•°å¦‚ä¸‹ï¼š é˜¶ $n = 2^{252} + 0x14def9dea2f79cd65812631a5cf5d3ed$ è¾…å› å­ h = 8 è™½ç„¶æ­¤æ›²çº¿å¹¶æœªä»¥ Edwards å½¢å¼å®šä¹‰ï¼Œä½†æ˜¯å®ƒå·²è¢«è¯æ˜ä¸å¦‚ä¸‹æ‰­æ›² Edwards æ›²çº¿ï¼ˆedwards25519ï¼‰ åŒæœ‰ç†ç­‰ä»·ï¼š $$ -x^2 + y^2 = 1 + 37095705934669439343138083508754565189542113879843219016388785533085940283555 x^2 y^2 $$ ä¸Šé¢ç»™å‡ºçš„è¿™ç§ Edwards å½¢å¼ä¸å‰æ–‡ç»™å‡ºçš„ Weierstrass å½¢å¼å®Œå…¨ç­‰ä»·ï¼Œæ˜¯ä¸“ä¸ºè®¡ç®—é€Ÿåº¦ä¼˜åŒ–è€Œè®¾è®¡æˆè¿™æ ·çš„ã€‚ Curve25519 ç”± Daniel Bernstein é¢†å¯¼çš„å¯†ç å­¦å®¶å›¢é˜Ÿç²¾å¿ƒè®¾è®¡ï¼Œåœ¨å¤šä¸ªè®¾è®¡å’Œå®ç°å±‚é¢ä¸Šè¾¾æˆäº†éå¸¸é«˜çš„æ€§èƒ½ï¼ŒåŒæ—¶ä¸å½±å“å®‰å…¨æ€§ã€‚ Curve25519 çš„æ„é€ ä½¿å…¶é¿å…äº†è®¸å¤šæ½œåœ¨çš„å®ç°ç¼ºé™·ã€‚æ ¹æ®è®¾è®¡ï¼Œå®ƒä¸å—å®šæ—¶æ”»å‡»çš„å½±å“ï¼Œå¹¶ä¸”å®ƒæ¥å—ä»»ä½• 32 å­—èŠ‚çš„å­—ç¬¦ä¸²ä½œä¸ºæœ‰æ•ˆçš„å…¬é’¥ï¼Œå¹¶ä¸”ä¸éœ€è¦éªŒè¯ã€‚å®ƒèƒ½æä¾› 125.8bits çš„å®‰å…¨å¼ºåº¦ï¼ˆæœ‰æ—¶ç§°ä¸º ~ 128bits å®‰å…¨æ€§ï¼‰ Curve25519 çš„ç§é’¥ä¸º 251 ä½ï¼Œé€šå¸¸ç¼–ç ä¸º 256 ä½æ•´æ•°ï¼ˆ32 ä¸ªå­—èŠ‚ï¼Œ64 ä¸ªåå…­è¿›åˆ¶æ•°å­—ï¼‰ã€‚å…¬é’¥é€šå¸¸ä¹Ÿç¼–ç ä¸º 256 ä½æ•´æ•°ï¼ˆ255 ä½ y åæ ‡ + 1 ä½ x åæ ‡ï¼‰ï¼Œè¿™å¯¹å¼€å‘äººå‘˜æ¥è¯´éå¸¸æ–¹ä¾¿ã€‚ åŸºäº Curve25519 æ´¾ç”Ÿå‡ºäº†åä¸º X25519 çš„ ECDH ç®—æ³•ï¼Œä»¥åŠåŸºäº EdDSA çš„é«˜é€Ÿæ•°å­—ç­¾åç®—æ³•Ed25519. Curve448, X448 å’Œ Ed448 https://www.ietf.org/rfc/rfc7748.html#section-4.2 https://cryptography.io/en/latest/hazmat/primitives/asymmetric/ed448/ Curve448ï¼ˆCurve448-Goldilocksï¼‰æ˜¯ä¸€ç§éæ‰­æ›² Edwards æ›²çº¿ï¼Œå®ƒçš„æ–¹ç¨‹å®šä¹‰å¦‚ä¸‹ï¼š $$ x^2 + y^2 = 1 - 39081 x^2 y^2 $$ å…¶è¢«å®šä¹‰åœ¨æœ‰é™åŸŸ $\\mathbb {F} _{p}$ ä¸Šï¼Œ$p = 2^{448} - 2^{224} - 1$ï¼Œå…¶ä»–åŸŸå‚æ•°ï¼š é˜¶ $n = 2^{446} - 0x8335dc163bb124b65129c96fde933d8d723a70aadc873d6d54a7bb0d$ è¾…åŠ©å› å­ h = 4 ä¸ Curve25519 ä¸€æ ·ï¼ŒCurve448 ä¹Ÿç­‰ä»·äºå‰é¢ç»™å‡ºçš„ Weierstrass å½¢å¼ï¼Œé€‰æ‹© Edwards å½¢å¼ä¸»è¦æ˜¯å› ä¸ºå®ƒèƒ½æ˜¾è‘—æå‡æ€§èƒ½ã€‚ Curve448 æä¾› 222.8 ä½çš„å®‰å…¨å¼ºåº¦ã€‚Curve448 çš„ç§é’¥ä¸º 446 ä½ï¼Œé€šå¸¸ç¼–ç ä¸º 448 ä½æ•´æ•°ï¼ˆ56 ä¸ªå­—èŠ‚ï¼Œ112 ä¸ªåå…­è¿›åˆ¶æ•°å­—ï¼‰ã€‚å…¬é’¥ä¹Ÿè¢«ç¼–ç ä¸º 448 ä½æ•´æ•°ã€‚ åŸºäº Curve44","date":"2022-03-09","objectID":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/:4:6","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","éå¯¹ç§°åŠ å¯†","å®‰å…¨","RSA","ECC"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC","uri":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/#secp256k1"},{"categories":["tech"],"content":" å¯†ç å­¦å¸¸ç”¨æ¤­åœ†æ›²çº¿ä»‹ç»åœ¨ä»‹ç»å¯†ç å­¦ä¸­çš„å¸¸ç”¨æ¤­åœ†æ›²çº¿å‰ï¼Œéœ€è¦å…ˆä»‹ç»ä¸€ä¸‹æ¤­åœ†æ›²çº¿çš„é˜¶ï¼ˆorderï¼‰ä»¥åŠè¾…åŠ©å› å­ï¼ˆcofactorï¼‰è¿™ä¸¤ä¸ªæ¦‚å¿µã€‚ é¦–å…ˆè¿˜å¾—ä»‹ç»ä¸‹æ•°å­¦ä¸­ã€Œå¾ªç¯ç¾¤ã€çš„æ¦‚å¿µï¼Œå®ƒæ˜¯æŒ‡èƒ½ç”±å•ä¸ªå…ƒç´ æ‰€ç”Ÿæˆçš„ç¾¤ï¼Œåœ¨ ECC ä¸­è¿™å°±æ˜¯é¢„å…ˆå®šä¹‰å¥½çš„åŸºç‚¹ $G$. ä¸€ä¸ªæœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿å¯ä»¥å½¢æˆä¸€ä¸ªæœ‰é™ã€Œå¾ªç¯ä»£æ•°ç¾¤ã€ï¼Œå®ƒç”±æ›²çº¿ä¸Šçš„æ‰€æœ‰ç‚¹ç»„æˆã€‚æ¤­åœ†æ›²çº¿çš„é˜¶è¢«å®šä¹‰ä¸ºè¯¥æ›²çº¿ä¸Šæ‰€æœ‰ç‚¹çš„ä¸ªæ•°ï¼ˆåŒ…æ‹¬æ— ç©·è¿œç‚¹ï¼‰ã€‚ æœ‰äº›æ›²çº¿åŠ ä¸Š G ç‚¹å¯ä»¥å½¢æˆä¸€ä¸ªå•ä¸€å¾ªç¯ç¾¤ï¼Œè¿™ä¸€ä¸ªç¾¤åŒ…å«äº†æ›²çº¿ä¸Šçš„æ‰€æœ‰ç‚¹ã€‚è€Œå…¶ä»–çš„æ›²çº¿åŠ ä¸Š G ç‚¹åˆ™å½¢æˆå¤šä¸ªä¸ç›¸äº¤çš„å¾ªç¯å­ç¾¤ï¼Œæ¯ä¸ªå­ç¾¤åŒ…å«äº†æ›²çº¿çš„ä¸€ä¸ªå­é›†ã€‚å¯¹äºä¸Šè¿°ç¬¬äºŒç§æƒ…å†µï¼Œå‡è®¾æ›²çº¿ä¸Šçš„ç‚¹è¢«æ‹†åˆ†åˆ°äº† h ä¸ªå¾ªç¯å­ç¾¤ä¸­ï¼Œæ¯ä¸ªå­ç¾¤çš„é˜¶éƒ½æ˜¯ rï¼Œé‚£è¿™æ—¶æ•´ä¸ªç¾¤çš„é˜¶å°±æ˜¯ $n = h * r$ï¼Œå…¶ä¸­å­ç¾¤çš„ä¸ªæ•° h è¢«ç§°ä¸ºè¾…åŠ©å› å­ã€‚ æœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿çš„é˜¶éƒ½æ˜¯æœ‰é™çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹äºæ›²çº¿ä¸Šä»»æ„ä¸€ç‚¹ $G$ï¼Œæˆ‘ä»¬è®¡ç®—å®ƒçš„æ•°ä¹˜ $kG$ï¼Œ éšç€æ•´æ•° $k$ çš„å¢å¤§ï¼Œä¸€å®šä¼šå­˜åœ¨æŸä¸ª $k$ ä½¿ $kG = O_{\\infty}$ æˆç«‹ï¼Œç„¶å $k$ ç»§ç»­å¢å¤§æ—¶ï¼Œå› ä¸º $O_{\\infty} * P = O_{\\infty}$ï¼Œ$kG$ çš„å€¼å°±å›ºå®šä¸º $O_{\\infty}$ äº†ï¼Œæ›´å¤§çš„ $k$ å€¼å·²ç»å¤±å»äº†æ„ä¹‰ã€‚ å› æ­¤ ECC ä¸­è¦æ±‚ $kG$ ä¸­çš„ç§é’¥ $k$ ç¬¦åˆæ¡ä»¶ $0 \\le k \\le r$ï¼Œä¹Ÿå°±æ˜¯è¯´æ€»çš„ç§é’¥æ•°é‡æ˜¯å— $r$ é™åˆ¶çš„ã€‚ è¾…åŠ©å› å­é€šè¿‡ç”¨å¦‚ä¸‹å…¬å¼è¡¨ç¤ºï¼š $$ h = n / r $$ å…¶ä¸­ $n$ æ˜¯æ›²çº¿çš„é˜¶ï¼Œ$r$ æ˜¯æ¯ä¸ªå­ç¾¤çš„é˜¶ï¼Œ$h$ æ˜¯è¾…åŠ©å› å­ã€‚å¦‚æœæ›²çº¿å½¢æˆäº†ä¸€ä¸ªå•ä¸€å¾ªç¯ç¾¤ï¼Œé‚£æ˜¾ç„¶ $h = 1$ï¼Œå¦åˆ™ $h \u003e 1$ ä¸¾ä¾‹å¦‚ä¸‹ï¼š secp256k1 çš„è¾…åŠ©å› å­ä¸º 1 Curve25519 çš„è¾…åŠ©å› å­ä¸º 8 Curve448 çš„è¾…åŠ©å› å­ä¸º 4 ç”Ÿæˆç‚¹ Gç”Ÿæˆç‚¹ G çš„é€‰æ‹©æ˜¯å¾ˆæœ‰è®²ç©¶çš„ï¼Œè™½ç„¶æ¯ä¸ªå¾ªç¯å­ç¾¤éƒ½åŒ…å«æœ‰å¾ˆå¤šä¸ªç”Ÿæˆç‚¹ï¼Œä½†æ˜¯ ECC åªä¼šè°¨æ…çš„é€‰æ‹©å…¶ä¸­ä¸€ä¸ªã€‚é¦–å…ˆ G ç‚¹å¿…é¡»è¦èƒ½ç”Ÿæˆå‡ºæ•´ä¸ªå¾ªç¯å­ç¾¤ï¼Œå…¶æ¬¡è¿˜éœ€è¦æœ‰å°½å¯èƒ½é«˜çš„è®¡ç®—æ€§èƒ½ã€‚ æ•°å­¦ä¸Šå·²çŸ¥æŸäº›æ¤­åœ†æ›²çº¿ä¸Šï¼Œä¸åŒçš„ç”Ÿæˆç‚¹ç”Ÿæˆå‡ºçš„å¾ªç¯å­ç¾¤ï¼Œé˜¶ä¹Ÿæ˜¯ä¸åŒçš„ã€‚å¦‚æœ G ç‚¹é€‰å¾—ä¸å¥½ï¼Œ å¯èƒ½ä¼šå¯¼è‡´ç”Ÿæˆå‡ºçš„å­ç¾¤çš„é˜¶è¾ƒå°ã€‚å‰é¢æˆ‘ä»¬å·²ç»æè¿‡å­ç¾¤çš„é˜¶ $r$ ä¼šé™åˆ¶æ€»çš„ç§é’¥æ•°é‡ï¼Œå¯¼è‡´ç®—æ³•å¼ºåº¦å˜å¼±ï¼å› æ­¤ä¸æ°å½“çš„ $G$ ç‚¹å¯èƒ½ä¼šå¯¼è‡´æˆ‘ä»¬é­å—ã€Œå°å­ç¾¤æ”»å‡»ã€ã€‚ä¸ºäº†é¿å…è¿™ç§é£é™©ï¼Œå»ºè®®å°½é‡ä½¿ç”¨è¢«å¹¿æ³›ä½¿ç”¨çš„åŠ å¯†åº“ï¼Œè€Œä¸æ˜¯è‡ªå·±æ’¸ä¸€ä¸ªã€‚ æ¤­åœ†æ›²çº¿çš„åŸŸå‚æ•°ECCæ¤­åœ†æ›²çº¿ç”±ä¸€ç»„æ¤­åœ†æ›²çº¿åŸŸå‚æ•°æè¿°ï¼Œå¦‚æ›²çº¿æ–¹ç¨‹å‚æ•°ã€åœºå‚æ•°å’Œç”Ÿæˆç‚¹åæ ‡ã€‚è¿™äº›å‚æ•°åœ¨å„ç§å¯†ç å­¦æ ‡å‡†ä¸­æŒ‡å®šï¼Œä½ å¯ä»¥ç½‘ä¸Šæœåˆ°ç›¸åº”çš„ RFC æˆ– NIST æ–‡æ¡£ã€‚ è¿™äº›æ ‡å‡†å®šä¹‰äº†ä¸€ç»„å‘½åæ›²çº¿çš„å‚æ•°ï¼Œä¾‹å¦‚ secp256k1ã€P-521ã€brainpoolP512t1 å’Œ SM2. è¿™äº›åŠ å¯†æ ‡å‡†ä¸­æè¿°çš„æœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿å¾—åˆ°äº†å¯†ç å­¦å®¶çš„å……åˆ†ç ”ç©¶å’Œåˆ†æï¼Œå¹¶è¢«è®¤ä¸ºå…·æœ‰ä¸€å®šçš„å®‰å…¨å¼ºåº¦ã€‚ ä¹Ÿæœ‰ä¸€äº›å¯†ç å­¦å®¶ï¼ˆå¦‚ Daniel Bernsteinï¼‰è®¤ä¸ºï¼Œå®˜æ–¹å¯†ç æ ‡å‡†ä¸­æè¿°çš„å¤§å¤šæ•°æ›²çº¿éƒ½æ˜¯ã€Œä¸å®‰å…¨çš„ã€ï¼Œå¹¶å®šä¹‰äº†ä»–ä»¬è‡ªå·±çš„å¯†ç æ ‡å‡†ï¼Œè¿™äº›æ ‡å‡†åœ¨æ›´å¹¿æ³›çš„å±‚é¢ä¸Šè€ƒè™‘äº† ECC å®‰å…¨æ€§ã€‚ å¼€å‘äººå‘˜åº”è¯¥ä»…ä½¿ç”¨å„é¡¹æ ‡å‡†æ–‡æ¡£ç»™å‡ºçš„ã€ç»è¿‡å¯†ç å­¦å®¶å……åˆ†ç ”ç©¶çš„å‘½åæ›²çº¿ã€‚ secp256k1æ­¤æ›²çº¿è¢«åº”ç”¨åœ¨æ¯”ç‰¹å¸ä¸­ï¼Œå®ƒçš„åŸŸå‚æ•°å¦‚ä¸‹ï¼š p (modulus) =0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F n (order; size; the count of all possible EC points) =0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141 a (æ–¹ç¨‹ $y^2 â‰¡ x^3 + a*x + b (\\mod p)$ ä¸­çš„å¸¸æ•°) =0x0000000000000000000000000000000000000000000000000000000000000000 b (æ–¹ç¨‹ $y^2 â‰¡ x^3 + a*x + b (\\mod p)$ ä¸­çš„å¸¸æ•°)=0x0000000000000000000000000000000000000000000000000000000000000007 g (the curve generator point G {x, y}) = (0x79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798,0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8) h (cofactor, typically 1) = 01 Edwards æ›²çº¿æ¤­åœ†æ›²çº¿æ–¹ç¨‹é™¤äº†æˆ‘ä»¬å‰é¢ä½¿ç”¨çš„ Weierstrass å½¢å¼ $$y^2 = (x^3 + ax + b) \\mod p$$ å¤–ï¼Œè¿˜å¯ä»¥è¢«å†™æˆå…¶ä»–å¤šç§å½¢å¼ï¼Œè¿™äº›ä¸åŒçš„å½¢å¼æ˜¯åŒæœ‰ç†ç­‰ä»·çš„ ï¼ˆåˆ«é—®ï¼Œæˆ‘ä¹Ÿä¸æ‡‚ä»€ä¹ˆå«ã€ŒåŒæœ‰ç†ç­‰ä»·ã€â€¦ï¼‰ã€‚ä¸åŒçš„æ–¹ç¨‹å½¢å¼åœ¨è®¡ç®—æœºçš„æ•°å€¼è®¡ç®—ä¸Šå¯èƒ½ä¼šå­˜åœ¨åŒºåˆ«ã€‚ ä¸ºäº†æ€§èƒ½è€ƒè™‘ï¼ŒECC åœ¨éƒ¨åˆ†åœºæ™¯ä¸‹ä¼šè€ƒè™‘ä½¿ç”¨ Edwards æ›²çº¿å½¢å¼è¿›è¡Œè®¡ç®—ï¼Œè¯¥æ–¹ç¨‹å½¢å¼å¦‚ä¸‹ï¼š $$ x^{2}+y^{2}=1+dx^{2}y^{2} $$ ç”»ä¸ªå›¾é•¿è¿™æ ·ï¼š çŸ¥åçš„ Edwards æ›²çº¿æœ‰ï¼š Curve1174 (251-bit) Curve25519 (255-bit) Curve383187 (383-bit) Curve41417 (414-bit) Curve448 (448-bit) E-521 (521-bit) â€¦ Curve25519, X25519 å’Œ Ed25519 https://www.ietf.org/rfc/rfc7748.html#section-4.1 https://cryptography.io/en/latest/hazmat/primitives/asymmetric/ed25519/ åªè¦åŸŸå‚æ•°é€‰å¾—å¥½ï¼ŒEdwards å°±å¯ä»¥ä»¥éå¸¸é«˜çš„æ€§èƒ½å®ç° ECC å¯†é’¥äº¤æ¢ã€æ•°å­—ç­¾åã€æ··åˆåŠ å¯†æ–¹æ¡ˆã€‚ ä¸€ä¸ªä¾‹å­å°±æ˜¯ Curve25519ï¼Œå®ƒæ˜¯ Edwards æ›²çº¿ï¼Œå…¶ Montgomery å½¢å¼çš„å®šä¹‰å¦‚ä¸‹ï¼š $$ y^{2}=x^{3}+486662x^{2}+x $$ å…¶è¢«å®šä¹‰åœ¨æœ‰é™åŸŸ $\\mathbb {F} _{p}$ ä¸Šï¼Œ$p = 2^{255} - 19$, å…¶ä»–åŸŸå‚æ•°å¦‚ä¸‹ï¼š é˜¶ $n = 2^{252} + 0x14def9dea2f79cd65812631a5cf5d3ed$ è¾…å› å­ h = 8 è™½ç„¶æ­¤æ›²çº¿å¹¶æœªä»¥ Edwards å½¢å¼å®šä¹‰ï¼Œä½†æ˜¯å®ƒå·²è¢«è¯æ˜ä¸å¦‚ä¸‹æ‰­æ›² Edwards æ›²çº¿ï¼ˆedwards25519ï¼‰ åŒæœ‰ç†ç­‰ä»·ï¼š $$ -x^2 + y^2 = 1 + 37095705934669439343138083508754565189542113879843219016388785533085940283555 x^2 y^2 $$ ä¸Šé¢ç»™å‡ºçš„è¿™ç§ Edwards å½¢å¼ä¸å‰æ–‡ç»™å‡ºçš„ Weierstrass å½¢å¼å®Œå…¨ç­‰ä»·ï¼Œæ˜¯ä¸“ä¸ºè®¡ç®—é€Ÿåº¦ä¼˜åŒ–è€Œè®¾è®¡æˆè¿™æ ·çš„ã€‚ Curve25519 ç”± Daniel Bernstein é¢†å¯¼çš„å¯†ç å­¦å®¶å›¢é˜Ÿç²¾å¿ƒè®¾è®¡ï¼Œåœ¨å¤šä¸ªè®¾è®¡å’Œå®ç°å±‚é¢ä¸Šè¾¾æˆäº†éå¸¸é«˜çš„æ€§èƒ½ï¼ŒåŒæ—¶ä¸å½±å“å®‰å…¨æ€§ã€‚ Curve25519 çš„æ„é€ ä½¿å…¶é¿å…äº†è®¸å¤šæ½œåœ¨çš„å®ç°ç¼ºé™·ã€‚æ ¹æ®è®¾è®¡ï¼Œå®ƒä¸å—å®šæ—¶æ”»å‡»çš„å½±å“ï¼Œå¹¶ä¸”å®ƒæ¥å—ä»»ä½• 32 å­—èŠ‚çš„å­—ç¬¦ä¸²ä½œä¸ºæœ‰æ•ˆçš„å…¬é’¥ï¼Œå¹¶ä¸”ä¸éœ€è¦éªŒè¯ã€‚å®ƒèƒ½æä¾› 125.8bits çš„å®‰å…¨å¼ºåº¦ï¼ˆæœ‰æ—¶ç§°ä¸º ~ 128bits å®‰å…¨æ€§ï¼‰ Curve25519 çš„ç§é’¥ä¸º 251 ä½ï¼Œé€šå¸¸ç¼–ç ä¸º 256 ä½æ•´æ•°ï¼ˆ32 ä¸ªå­—èŠ‚ï¼Œ64 ä¸ªåå…­è¿›åˆ¶æ•°å­—ï¼‰ã€‚å…¬é’¥é€šå¸¸ä¹Ÿç¼–ç ä¸º 256 ä½æ•´æ•°ï¼ˆ255 ä½ y åæ ‡ + 1 ä½ x åæ ‡ï¼‰ï¼Œè¿™å¯¹å¼€å‘äººå‘˜æ¥è¯´éå¸¸æ–¹ä¾¿ã€‚ åŸºäº Curve25519 æ´¾ç”Ÿå‡ºäº†åä¸º X25519 çš„ ECDH ç®—æ³•ï¼Œä»¥åŠåŸºäº EdDSA çš„é«˜é€Ÿæ•°å­—ç­¾åç®—æ³•Ed25519. Curve448, X448 å’Œ Ed448 https://www.ietf.org/rfc/rfc7748.html#section-4.2 https://cryptography.io/en/latest/hazmat/primitives/asymmetric/ed448/ Curve448ï¼ˆCurve448-Goldilocksï¼‰æ˜¯ä¸€ç§éæ‰­æ›² Edwards æ›²çº¿ï¼Œå®ƒçš„æ–¹ç¨‹å®šä¹‰å¦‚ä¸‹ï¼š $$ x^2 + y^2 = 1 - 39081 x^2 y^2 $$ å…¶è¢«å®šä¹‰åœ¨æœ‰é™åŸŸ $\\mathbb {F} _{p}$ ä¸Šï¼Œ$p = 2^{448} - 2^{224} - 1$ï¼Œå…¶ä»–åŸŸå‚æ•°ï¼š é˜¶ $n = 2^{446} - 0x8335dc163bb124b65129c96fde933d8d723a70aadc873d6d54a7bb0d$ è¾…åŠ©å› å­ h = 4 ä¸ Curve25519 ä¸€æ ·ï¼ŒCurve448 ä¹Ÿç­‰ä»·äºå‰é¢ç»™å‡ºçš„ Weierstrass å½¢å¼ï¼Œé€‰æ‹© Edwards å½¢å¼ä¸»è¦æ˜¯å› ä¸ºå®ƒèƒ½æ˜¾è‘—æå‡æ€§èƒ½ã€‚ Curve448 æä¾› 222.8 ä½çš„å®‰å…¨å¼ºåº¦ã€‚Curve448 çš„ç§é’¥ä¸º 446 ä½ï¼Œé€šå¸¸ç¼–ç ä¸º 448 ä½æ•´æ•°ï¼ˆ56 ä¸ªå­—èŠ‚ï¼Œ112 ä¸ªåå…­è¿›åˆ¶æ•°å­—ï¼‰ã€‚å…¬é’¥ä¹Ÿè¢«ç¼–ç ä¸º 448 ä½æ•´æ•°ã€‚ åŸºäº Curve44","date":"2022-03-09","objectID":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/:4:6","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","éå¯¹ç§°åŠ å¯†","å®‰å…¨","RSA","ECC"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC","uri":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/#edwards-æ›²çº¿"},{"categories":["tech"],"content":" å¯†ç å­¦å¸¸ç”¨æ¤­åœ†æ›²çº¿ä»‹ç»åœ¨ä»‹ç»å¯†ç å­¦ä¸­çš„å¸¸ç”¨æ¤­åœ†æ›²çº¿å‰ï¼Œéœ€è¦å…ˆä»‹ç»ä¸€ä¸‹æ¤­åœ†æ›²çº¿çš„é˜¶ï¼ˆorderï¼‰ä»¥åŠè¾…åŠ©å› å­ï¼ˆcofactorï¼‰è¿™ä¸¤ä¸ªæ¦‚å¿µã€‚ é¦–å…ˆè¿˜å¾—ä»‹ç»ä¸‹æ•°å­¦ä¸­ã€Œå¾ªç¯ç¾¤ã€çš„æ¦‚å¿µï¼Œå®ƒæ˜¯æŒ‡èƒ½ç”±å•ä¸ªå…ƒç´ æ‰€ç”Ÿæˆçš„ç¾¤ï¼Œåœ¨ ECC ä¸­è¿™å°±æ˜¯é¢„å…ˆå®šä¹‰å¥½çš„åŸºç‚¹ $G$. ä¸€ä¸ªæœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿å¯ä»¥å½¢æˆä¸€ä¸ªæœ‰é™ã€Œå¾ªç¯ä»£æ•°ç¾¤ã€ï¼Œå®ƒç”±æ›²çº¿ä¸Šçš„æ‰€æœ‰ç‚¹ç»„æˆã€‚æ¤­åœ†æ›²çº¿çš„é˜¶è¢«å®šä¹‰ä¸ºè¯¥æ›²çº¿ä¸Šæ‰€æœ‰ç‚¹çš„ä¸ªæ•°ï¼ˆåŒ…æ‹¬æ— ç©·è¿œç‚¹ï¼‰ã€‚ æœ‰äº›æ›²çº¿åŠ ä¸Š G ç‚¹å¯ä»¥å½¢æˆä¸€ä¸ªå•ä¸€å¾ªç¯ç¾¤ï¼Œè¿™ä¸€ä¸ªç¾¤åŒ…å«äº†æ›²çº¿ä¸Šçš„æ‰€æœ‰ç‚¹ã€‚è€Œå…¶ä»–çš„æ›²çº¿åŠ ä¸Š G ç‚¹åˆ™å½¢æˆå¤šä¸ªä¸ç›¸äº¤çš„å¾ªç¯å­ç¾¤ï¼Œæ¯ä¸ªå­ç¾¤åŒ…å«äº†æ›²çº¿çš„ä¸€ä¸ªå­é›†ã€‚å¯¹äºä¸Šè¿°ç¬¬äºŒç§æƒ…å†µï¼Œå‡è®¾æ›²çº¿ä¸Šçš„ç‚¹è¢«æ‹†åˆ†åˆ°äº† h ä¸ªå¾ªç¯å­ç¾¤ä¸­ï¼Œæ¯ä¸ªå­ç¾¤çš„é˜¶éƒ½æ˜¯ rï¼Œé‚£è¿™æ—¶æ•´ä¸ªç¾¤çš„é˜¶å°±æ˜¯ $n = h * r$ï¼Œå…¶ä¸­å­ç¾¤çš„ä¸ªæ•° h è¢«ç§°ä¸ºè¾…åŠ©å› å­ã€‚ æœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿çš„é˜¶éƒ½æ˜¯æœ‰é™çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹äºæ›²çº¿ä¸Šä»»æ„ä¸€ç‚¹ $G$ï¼Œæˆ‘ä»¬è®¡ç®—å®ƒçš„æ•°ä¹˜ $kG$ï¼Œ éšç€æ•´æ•° $k$ çš„å¢å¤§ï¼Œä¸€å®šä¼šå­˜åœ¨æŸä¸ª $k$ ä½¿ $kG = O_{\\infty}$ æˆç«‹ï¼Œç„¶å $k$ ç»§ç»­å¢å¤§æ—¶ï¼Œå› ä¸º $O_{\\infty} * P = O_{\\infty}$ï¼Œ$kG$ çš„å€¼å°±å›ºå®šä¸º $O_{\\infty}$ äº†ï¼Œæ›´å¤§çš„ $k$ å€¼å·²ç»å¤±å»äº†æ„ä¹‰ã€‚ å› æ­¤ ECC ä¸­è¦æ±‚ $kG$ ä¸­çš„ç§é’¥ $k$ ç¬¦åˆæ¡ä»¶ $0 \\le k \\le r$ï¼Œä¹Ÿå°±æ˜¯è¯´æ€»çš„ç§é’¥æ•°é‡æ˜¯å— $r$ é™åˆ¶çš„ã€‚ è¾…åŠ©å› å­é€šè¿‡ç”¨å¦‚ä¸‹å…¬å¼è¡¨ç¤ºï¼š $$ h = n / r $$ å…¶ä¸­ $n$ æ˜¯æ›²çº¿çš„é˜¶ï¼Œ$r$ æ˜¯æ¯ä¸ªå­ç¾¤çš„é˜¶ï¼Œ$h$ æ˜¯è¾…åŠ©å› å­ã€‚å¦‚æœæ›²çº¿å½¢æˆäº†ä¸€ä¸ªå•ä¸€å¾ªç¯ç¾¤ï¼Œé‚£æ˜¾ç„¶ $h = 1$ï¼Œå¦åˆ™ $h \u003e 1$ ä¸¾ä¾‹å¦‚ä¸‹ï¼š secp256k1 çš„è¾…åŠ©å› å­ä¸º 1 Curve25519 çš„è¾…åŠ©å› å­ä¸º 8 Curve448 çš„è¾…åŠ©å› å­ä¸º 4 ç”Ÿæˆç‚¹ Gç”Ÿæˆç‚¹ G çš„é€‰æ‹©æ˜¯å¾ˆæœ‰è®²ç©¶çš„ï¼Œè™½ç„¶æ¯ä¸ªå¾ªç¯å­ç¾¤éƒ½åŒ…å«æœ‰å¾ˆå¤šä¸ªç”Ÿæˆç‚¹ï¼Œä½†æ˜¯ ECC åªä¼šè°¨æ…çš„é€‰æ‹©å…¶ä¸­ä¸€ä¸ªã€‚é¦–å…ˆ G ç‚¹å¿…é¡»è¦èƒ½ç”Ÿæˆå‡ºæ•´ä¸ªå¾ªç¯å­ç¾¤ï¼Œå…¶æ¬¡è¿˜éœ€è¦æœ‰å°½å¯èƒ½é«˜çš„è®¡ç®—æ€§èƒ½ã€‚ æ•°å­¦ä¸Šå·²çŸ¥æŸäº›æ¤­åœ†æ›²çº¿ä¸Šï¼Œä¸åŒçš„ç”Ÿæˆç‚¹ç”Ÿæˆå‡ºçš„å¾ªç¯å­ç¾¤ï¼Œé˜¶ä¹Ÿæ˜¯ä¸åŒçš„ã€‚å¦‚æœ G ç‚¹é€‰å¾—ä¸å¥½ï¼Œ å¯èƒ½ä¼šå¯¼è‡´ç”Ÿæˆå‡ºçš„å­ç¾¤çš„é˜¶è¾ƒå°ã€‚å‰é¢æˆ‘ä»¬å·²ç»æè¿‡å­ç¾¤çš„é˜¶ $r$ ä¼šé™åˆ¶æ€»çš„ç§é’¥æ•°é‡ï¼Œå¯¼è‡´ç®—æ³•å¼ºåº¦å˜å¼±ï¼å› æ­¤ä¸æ°å½“çš„ $G$ ç‚¹å¯èƒ½ä¼šå¯¼è‡´æˆ‘ä»¬é­å—ã€Œå°å­ç¾¤æ”»å‡»ã€ã€‚ä¸ºäº†é¿å…è¿™ç§é£é™©ï¼Œå»ºè®®å°½é‡ä½¿ç”¨è¢«å¹¿æ³›ä½¿ç”¨çš„åŠ å¯†åº“ï¼Œè€Œä¸æ˜¯è‡ªå·±æ’¸ä¸€ä¸ªã€‚ æ¤­åœ†æ›²çº¿çš„åŸŸå‚æ•°ECCæ¤­åœ†æ›²çº¿ç”±ä¸€ç»„æ¤­åœ†æ›²çº¿åŸŸå‚æ•°æè¿°ï¼Œå¦‚æ›²çº¿æ–¹ç¨‹å‚æ•°ã€åœºå‚æ•°å’Œç”Ÿæˆç‚¹åæ ‡ã€‚è¿™äº›å‚æ•°åœ¨å„ç§å¯†ç å­¦æ ‡å‡†ä¸­æŒ‡å®šï¼Œä½ å¯ä»¥ç½‘ä¸Šæœåˆ°ç›¸åº”çš„ RFC æˆ– NIST æ–‡æ¡£ã€‚ è¿™äº›æ ‡å‡†å®šä¹‰äº†ä¸€ç»„å‘½åæ›²çº¿çš„å‚æ•°ï¼Œä¾‹å¦‚ secp256k1ã€P-521ã€brainpoolP512t1 å’Œ SM2. è¿™äº›åŠ å¯†æ ‡å‡†ä¸­æè¿°çš„æœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿å¾—åˆ°äº†å¯†ç å­¦å®¶çš„å……åˆ†ç ”ç©¶å’Œåˆ†æï¼Œå¹¶è¢«è®¤ä¸ºå…·æœ‰ä¸€å®šçš„å®‰å…¨å¼ºåº¦ã€‚ ä¹Ÿæœ‰ä¸€äº›å¯†ç å­¦å®¶ï¼ˆå¦‚ Daniel Bernsteinï¼‰è®¤ä¸ºï¼Œå®˜æ–¹å¯†ç æ ‡å‡†ä¸­æè¿°çš„å¤§å¤šæ•°æ›²çº¿éƒ½æ˜¯ã€Œä¸å®‰å…¨çš„ã€ï¼Œå¹¶å®šä¹‰äº†ä»–ä»¬è‡ªå·±çš„å¯†ç æ ‡å‡†ï¼Œè¿™äº›æ ‡å‡†åœ¨æ›´å¹¿æ³›çš„å±‚é¢ä¸Šè€ƒè™‘äº† ECC å®‰å…¨æ€§ã€‚ å¼€å‘äººå‘˜åº”è¯¥ä»…ä½¿ç”¨å„é¡¹æ ‡å‡†æ–‡æ¡£ç»™å‡ºçš„ã€ç»è¿‡å¯†ç å­¦å®¶å……åˆ†ç ”ç©¶çš„å‘½åæ›²çº¿ã€‚ secp256k1æ­¤æ›²çº¿è¢«åº”ç”¨åœ¨æ¯”ç‰¹å¸ä¸­ï¼Œå®ƒçš„åŸŸå‚æ•°å¦‚ä¸‹ï¼š p (modulus) =0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F n (order; size; the count of all possible EC points) =0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141 a (æ–¹ç¨‹ $y^2 â‰¡ x^3 + a*x + b (\\mod p)$ ä¸­çš„å¸¸æ•°) =0x0000000000000000000000000000000000000000000000000000000000000000 b (æ–¹ç¨‹ $y^2 â‰¡ x^3 + a*x + b (\\mod p)$ ä¸­çš„å¸¸æ•°)=0x0000000000000000000000000000000000000000000000000000000000000007 g (the curve generator point G {x, y}) = (0x79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798,0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8) h (cofactor, typically 1) = 01 Edwards æ›²çº¿æ¤­åœ†æ›²çº¿æ–¹ç¨‹é™¤äº†æˆ‘ä»¬å‰é¢ä½¿ç”¨çš„ Weierstrass å½¢å¼ $$y^2 = (x^3 + ax + b) \\mod p$$ å¤–ï¼Œè¿˜å¯ä»¥è¢«å†™æˆå…¶ä»–å¤šç§å½¢å¼ï¼Œè¿™äº›ä¸åŒçš„å½¢å¼æ˜¯åŒæœ‰ç†ç­‰ä»·çš„ ï¼ˆåˆ«é—®ï¼Œæˆ‘ä¹Ÿä¸æ‡‚ä»€ä¹ˆå«ã€ŒåŒæœ‰ç†ç­‰ä»·ã€â€¦ï¼‰ã€‚ä¸åŒçš„æ–¹ç¨‹å½¢å¼åœ¨è®¡ç®—æœºçš„æ•°å€¼è®¡ç®—ä¸Šå¯èƒ½ä¼šå­˜åœ¨åŒºåˆ«ã€‚ ä¸ºäº†æ€§èƒ½è€ƒè™‘ï¼ŒECC åœ¨éƒ¨åˆ†åœºæ™¯ä¸‹ä¼šè€ƒè™‘ä½¿ç”¨ Edwards æ›²çº¿å½¢å¼è¿›è¡Œè®¡ç®—ï¼Œè¯¥æ–¹ç¨‹å½¢å¼å¦‚ä¸‹ï¼š $$ x^{2}+y^{2}=1+dx^{2}y^{2} $$ ç”»ä¸ªå›¾é•¿è¿™æ ·ï¼š çŸ¥åçš„ Edwards æ›²çº¿æœ‰ï¼š Curve1174 (251-bit) Curve25519 (255-bit) Curve383187 (383-bit) Curve41417 (414-bit) Curve448 (448-bit) E-521 (521-bit) â€¦ Curve25519, X25519 å’Œ Ed25519 https://www.ietf.org/rfc/rfc7748.html#section-4.1 https://cryptography.io/en/latest/hazmat/primitives/asymmetric/ed25519/ åªè¦åŸŸå‚æ•°é€‰å¾—å¥½ï¼ŒEdwards å°±å¯ä»¥ä»¥éå¸¸é«˜çš„æ€§èƒ½å®ç° ECC å¯†é’¥äº¤æ¢ã€æ•°å­—ç­¾åã€æ··åˆåŠ å¯†æ–¹æ¡ˆã€‚ ä¸€ä¸ªä¾‹å­å°±æ˜¯ Curve25519ï¼Œå®ƒæ˜¯ Edwards æ›²çº¿ï¼Œå…¶ Montgomery å½¢å¼çš„å®šä¹‰å¦‚ä¸‹ï¼š $$ y^{2}=x^{3}+486662x^{2}+x $$ å…¶è¢«å®šä¹‰åœ¨æœ‰é™åŸŸ $\\mathbb {F} _{p}$ ä¸Šï¼Œ$p = 2^{255} - 19$, å…¶ä»–åŸŸå‚æ•°å¦‚ä¸‹ï¼š é˜¶ $n = 2^{252} + 0x14def9dea2f79cd65812631a5cf5d3ed$ è¾…å› å­ h = 8 è™½ç„¶æ­¤æ›²çº¿å¹¶æœªä»¥ Edwards å½¢å¼å®šä¹‰ï¼Œä½†æ˜¯å®ƒå·²è¢«è¯æ˜ä¸å¦‚ä¸‹æ‰­æ›² Edwards æ›²çº¿ï¼ˆedwards25519ï¼‰ åŒæœ‰ç†ç­‰ä»·ï¼š $$ -x^2 + y^2 = 1 + 37095705934669439343138083508754565189542113879843219016388785533085940283555 x^2 y^2 $$ ä¸Šé¢ç»™å‡ºçš„è¿™ç§ Edwards å½¢å¼ä¸å‰æ–‡ç»™å‡ºçš„ Weierstrass å½¢å¼å®Œå…¨ç­‰ä»·ï¼Œæ˜¯ä¸“ä¸ºè®¡ç®—é€Ÿåº¦ä¼˜åŒ–è€Œè®¾è®¡æˆè¿™æ ·çš„ã€‚ Curve25519 ç”± Daniel Bernstein é¢†å¯¼çš„å¯†ç å­¦å®¶å›¢é˜Ÿç²¾å¿ƒè®¾è®¡ï¼Œåœ¨å¤šä¸ªè®¾è®¡å’Œå®ç°å±‚é¢ä¸Šè¾¾æˆäº†éå¸¸é«˜çš„æ€§èƒ½ï¼ŒåŒæ—¶ä¸å½±å“å®‰å…¨æ€§ã€‚ Curve25519 çš„æ„é€ ä½¿å…¶é¿å…äº†è®¸å¤šæ½œåœ¨çš„å®ç°ç¼ºé™·ã€‚æ ¹æ®è®¾è®¡ï¼Œå®ƒä¸å—å®šæ—¶æ”»å‡»çš„å½±å“ï¼Œå¹¶ä¸”å®ƒæ¥å—ä»»ä½• 32 å­—èŠ‚çš„å­—ç¬¦ä¸²ä½œä¸ºæœ‰æ•ˆçš„å…¬é’¥ï¼Œå¹¶ä¸”ä¸éœ€è¦éªŒè¯ã€‚å®ƒèƒ½æä¾› 125.8bits çš„å®‰å…¨å¼ºåº¦ï¼ˆæœ‰æ—¶ç§°ä¸º ~ 128bits å®‰å…¨æ€§ï¼‰ Curve25519 çš„ç§é’¥ä¸º 251 ä½ï¼Œé€šå¸¸ç¼–ç ä¸º 256 ä½æ•´æ•°ï¼ˆ32 ä¸ªå­—èŠ‚ï¼Œ64 ä¸ªåå…­è¿›åˆ¶æ•°å­—ï¼‰ã€‚å…¬é’¥é€šå¸¸ä¹Ÿç¼–ç ä¸º 256 ä½æ•´æ•°ï¼ˆ255 ä½ y åæ ‡ + 1 ä½ x åæ ‡ï¼‰ï¼Œè¿™å¯¹å¼€å‘äººå‘˜æ¥è¯´éå¸¸æ–¹ä¾¿ã€‚ åŸºäº Curve25519 æ´¾ç”Ÿå‡ºäº†åä¸º X25519 çš„ ECDH ç®—æ³•ï¼Œä»¥åŠåŸºäº EdDSA çš„é«˜é€Ÿæ•°å­—ç­¾åç®—æ³•Ed25519. Curve448, X448 å’Œ Ed448 https://www.ietf.org/rfc/rfc7748.html#section-4.2 https://cryptography.io/en/latest/hazmat/primitives/asymmetric/ed448/ Curve448ï¼ˆCurve448-Goldilocksï¼‰æ˜¯ä¸€ç§éæ‰­æ›² Edwards æ›²çº¿ï¼Œå®ƒçš„æ–¹ç¨‹å®šä¹‰å¦‚ä¸‹ï¼š $$ x^2 + y^2 = 1 - 39081 x^2 y^2 $$ å…¶è¢«å®šä¹‰åœ¨æœ‰é™åŸŸ $\\mathbb {F} _{p}$ ä¸Šï¼Œ$p = 2^{448} - 2^{224} - 1$ï¼Œå…¶ä»–åŸŸå‚æ•°ï¼š é˜¶ $n = 2^{446} - 0x8335dc163bb124b65129c96fde933d8d723a70aadc873d6d54a7bb0d$ è¾…åŠ©å› å­ h = 4 ä¸ Curve25519 ä¸€æ ·ï¼ŒCurve448 ä¹Ÿç­‰ä»·äºå‰é¢ç»™å‡ºçš„ Weierstrass å½¢å¼ï¼Œé€‰æ‹© Edwards å½¢å¼ä¸»è¦æ˜¯å› ä¸ºå®ƒèƒ½æ˜¾è‘—æå‡æ€§èƒ½ã€‚ Curve448 æä¾› 222.8 ä½çš„å®‰å…¨å¼ºåº¦ã€‚Curve448 çš„ç§é’¥ä¸º 446 ä½ï¼Œé€šå¸¸ç¼–ç ä¸º 448 ä½æ•´æ•°ï¼ˆ56 ä¸ªå­—èŠ‚ï¼Œ112 ä¸ªåå…­è¿›åˆ¶æ•°å­—ï¼‰ã€‚å…¬é’¥ä¹Ÿè¢«ç¼–ç ä¸º 448 ä½æ•´æ•°ã€‚ åŸºäº Curve44","date":"2022-03-09","objectID":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/:4:6","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","éå¯¹ç§°åŠ å¯†","å®‰å…¨","RSA","ECC"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC","uri":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/#curve25519-x25519-å’Œ-ed25519"},{"categories":["tech"],"content":" å¯†ç å­¦å¸¸ç”¨æ¤­åœ†æ›²çº¿ä»‹ç»åœ¨ä»‹ç»å¯†ç å­¦ä¸­çš„å¸¸ç”¨æ¤­åœ†æ›²çº¿å‰ï¼Œéœ€è¦å…ˆä»‹ç»ä¸€ä¸‹æ¤­åœ†æ›²çº¿çš„é˜¶ï¼ˆorderï¼‰ä»¥åŠè¾…åŠ©å› å­ï¼ˆcofactorï¼‰è¿™ä¸¤ä¸ªæ¦‚å¿µã€‚ é¦–å…ˆè¿˜å¾—ä»‹ç»ä¸‹æ•°å­¦ä¸­ã€Œå¾ªç¯ç¾¤ã€çš„æ¦‚å¿µï¼Œå®ƒæ˜¯æŒ‡èƒ½ç”±å•ä¸ªå…ƒç´ æ‰€ç”Ÿæˆçš„ç¾¤ï¼Œåœ¨ ECC ä¸­è¿™å°±æ˜¯é¢„å…ˆå®šä¹‰å¥½çš„åŸºç‚¹ $G$. ä¸€ä¸ªæœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿å¯ä»¥å½¢æˆä¸€ä¸ªæœ‰é™ã€Œå¾ªç¯ä»£æ•°ç¾¤ã€ï¼Œå®ƒç”±æ›²çº¿ä¸Šçš„æ‰€æœ‰ç‚¹ç»„æˆã€‚æ¤­åœ†æ›²çº¿çš„é˜¶è¢«å®šä¹‰ä¸ºè¯¥æ›²çº¿ä¸Šæ‰€æœ‰ç‚¹çš„ä¸ªæ•°ï¼ˆåŒ…æ‹¬æ— ç©·è¿œç‚¹ï¼‰ã€‚ æœ‰äº›æ›²çº¿åŠ ä¸Š G ç‚¹å¯ä»¥å½¢æˆä¸€ä¸ªå•ä¸€å¾ªç¯ç¾¤ï¼Œè¿™ä¸€ä¸ªç¾¤åŒ…å«äº†æ›²çº¿ä¸Šçš„æ‰€æœ‰ç‚¹ã€‚è€Œå…¶ä»–çš„æ›²çº¿åŠ ä¸Š G ç‚¹åˆ™å½¢æˆå¤šä¸ªä¸ç›¸äº¤çš„å¾ªç¯å­ç¾¤ï¼Œæ¯ä¸ªå­ç¾¤åŒ…å«äº†æ›²çº¿çš„ä¸€ä¸ªå­é›†ã€‚å¯¹äºä¸Šè¿°ç¬¬äºŒç§æƒ…å†µï¼Œå‡è®¾æ›²çº¿ä¸Šçš„ç‚¹è¢«æ‹†åˆ†åˆ°äº† h ä¸ªå¾ªç¯å­ç¾¤ä¸­ï¼Œæ¯ä¸ªå­ç¾¤çš„é˜¶éƒ½æ˜¯ rï¼Œé‚£è¿™æ—¶æ•´ä¸ªç¾¤çš„é˜¶å°±æ˜¯ $n = h * r$ï¼Œå…¶ä¸­å­ç¾¤çš„ä¸ªæ•° h è¢«ç§°ä¸ºè¾…åŠ©å› å­ã€‚ æœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿çš„é˜¶éƒ½æ˜¯æœ‰é™çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹äºæ›²çº¿ä¸Šä»»æ„ä¸€ç‚¹ $G$ï¼Œæˆ‘ä»¬è®¡ç®—å®ƒçš„æ•°ä¹˜ $kG$ï¼Œ éšç€æ•´æ•° $k$ çš„å¢å¤§ï¼Œä¸€å®šä¼šå­˜åœ¨æŸä¸ª $k$ ä½¿ $kG = O_{\\infty}$ æˆç«‹ï¼Œç„¶å $k$ ç»§ç»­å¢å¤§æ—¶ï¼Œå› ä¸º $O_{\\infty} * P = O_{\\infty}$ï¼Œ$kG$ çš„å€¼å°±å›ºå®šä¸º $O_{\\infty}$ äº†ï¼Œæ›´å¤§çš„ $k$ å€¼å·²ç»å¤±å»äº†æ„ä¹‰ã€‚ å› æ­¤ ECC ä¸­è¦æ±‚ $kG$ ä¸­çš„ç§é’¥ $k$ ç¬¦åˆæ¡ä»¶ $0 \\le k \\le r$ï¼Œä¹Ÿå°±æ˜¯è¯´æ€»çš„ç§é’¥æ•°é‡æ˜¯å— $r$ é™åˆ¶çš„ã€‚ è¾…åŠ©å› å­é€šè¿‡ç”¨å¦‚ä¸‹å…¬å¼è¡¨ç¤ºï¼š $$ h = n / r $$ å…¶ä¸­ $n$ æ˜¯æ›²çº¿çš„é˜¶ï¼Œ$r$ æ˜¯æ¯ä¸ªå­ç¾¤çš„é˜¶ï¼Œ$h$ æ˜¯è¾…åŠ©å› å­ã€‚å¦‚æœæ›²çº¿å½¢æˆäº†ä¸€ä¸ªå•ä¸€å¾ªç¯ç¾¤ï¼Œé‚£æ˜¾ç„¶ $h = 1$ï¼Œå¦åˆ™ $h \u003e 1$ ä¸¾ä¾‹å¦‚ä¸‹ï¼š secp256k1 çš„è¾…åŠ©å› å­ä¸º 1 Curve25519 çš„è¾…åŠ©å› å­ä¸º 8 Curve448 çš„è¾…åŠ©å› å­ä¸º 4 ç”Ÿæˆç‚¹ Gç”Ÿæˆç‚¹ G çš„é€‰æ‹©æ˜¯å¾ˆæœ‰è®²ç©¶çš„ï¼Œè™½ç„¶æ¯ä¸ªå¾ªç¯å­ç¾¤éƒ½åŒ…å«æœ‰å¾ˆå¤šä¸ªç”Ÿæˆç‚¹ï¼Œä½†æ˜¯ ECC åªä¼šè°¨æ…çš„é€‰æ‹©å…¶ä¸­ä¸€ä¸ªã€‚é¦–å…ˆ G ç‚¹å¿…é¡»è¦èƒ½ç”Ÿæˆå‡ºæ•´ä¸ªå¾ªç¯å­ç¾¤ï¼Œå…¶æ¬¡è¿˜éœ€è¦æœ‰å°½å¯èƒ½é«˜çš„è®¡ç®—æ€§èƒ½ã€‚ æ•°å­¦ä¸Šå·²çŸ¥æŸäº›æ¤­åœ†æ›²çº¿ä¸Šï¼Œä¸åŒçš„ç”Ÿæˆç‚¹ç”Ÿæˆå‡ºçš„å¾ªç¯å­ç¾¤ï¼Œé˜¶ä¹Ÿæ˜¯ä¸åŒçš„ã€‚å¦‚æœ G ç‚¹é€‰å¾—ä¸å¥½ï¼Œ å¯èƒ½ä¼šå¯¼è‡´ç”Ÿæˆå‡ºçš„å­ç¾¤çš„é˜¶è¾ƒå°ã€‚å‰é¢æˆ‘ä»¬å·²ç»æè¿‡å­ç¾¤çš„é˜¶ $r$ ä¼šé™åˆ¶æ€»çš„ç§é’¥æ•°é‡ï¼Œå¯¼è‡´ç®—æ³•å¼ºåº¦å˜å¼±ï¼å› æ­¤ä¸æ°å½“çš„ $G$ ç‚¹å¯èƒ½ä¼šå¯¼è‡´æˆ‘ä»¬é­å—ã€Œå°å­ç¾¤æ”»å‡»ã€ã€‚ä¸ºäº†é¿å…è¿™ç§é£é™©ï¼Œå»ºè®®å°½é‡ä½¿ç”¨è¢«å¹¿æ³›ä½¿ç”¨çš„åŠ å¯†åº“ï¼Œè€Œä¸æ˜¯è‡ªå·±æ’¸ä¸€ä¸ªã€‚ æ¤­åœ†æ›²çº¿çš„åŸŸå‚æ•°ECCæ¤­åœ†æ›²çº¿ç”±ä¸€ç»„æ¤­åœ†æ›²çº¿åŸŸå‚æ•°æè¿°ï¼Œå¦‚æ›²çº¿æ–¹ç¨‹å‚æ•°ã€åœºå‚æ•°å’Œç”Ÿæˆç‚¹åæ ‡ã€‚è¿™äº›å‚æ•°åœ¨å„ç§å¯†ç å­¦æ ‡å‡†ä¸­æŒ‡å®šï¼Œä½ å¯ä»¥ç½‘ä¸Šæœåˆ°ç›¸åº”çš„ RFC æˆ– NIST æ–‡æ¡£ã€‚ è¿™äº›æ ‡å‡†å®šä¹‰äº†ä¸€ç»„å‘½åæ›²çº¿çš„å‚æ•°ï¼Œä¾‹å¦‚ secp256k1ã€P-521ã€brainpoolP512t1 å’Œ SM2. è¿™äº›åŠ å¯†æ ‡å‡†ä¸­æè¿°çš„æœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿å¾—åˆ°äº†å¯†ç å­¦å®¶çš„å……åˆ†ç ”ç©¶å’Œåˆ†æï¼Œå¹¶è¢«è®¤ä¸ºå…·æœ‰ä¸€å®šçš„å®‰å…¨å¼ºåº¦ã€‚ ä¹Ÿæœ‰ä¸€äº›å¯†ç å­¦å®¶ï¼ˆå¦‚ Daniel Bernsteinï¼‰è®¤ä¸ºï¼Œå®˜æ–¹å¯†ç æ ‡å‡†ä¸­æè¿°çš„å¤§å¤šæ•°æ›²çº¿éƒ½æ˜¯ã€Œä¸å®‰å…¨çš„ã€ï¼Œå¹¶å®šä¹‰äº†ä»–ä»¬è‡ªå·±çš„å¯†ç æ ‡å‡†ï¼Œè¿™äº›æ ‡å‡†åœ¨æ›´å¹¿æ³›çš„å±‚é¢ä¸Šè€ƒè™‘äº† ECC å®‰å…¨æ€§ã€‚ å¼€å‘äººå‘˜åº”è¯¥ä»…ä½¿ç”¨å„é¡¹æ ‡å‡†æ–‡æ¡£ç»™å‡ºçš„ã€ç»è¿‡å¯†ç å­¦å®¶å……åˆ†ç ”ç©¶çš„å‘½åæ›²çº¿ã€‚ secp256k1æ­¤æ›²çº¿è¢«åº”ç”¨åœ¨æ¯”ç‰¹å¸ä¸­ï¼Œå®ƒçš„åŸŸå‚æ•°å¦‚ä¸‹ï¼š p (modulus) =0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F n (order; size; the count of all possible EC points) =0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141 a (æ–¹ç¨‹ $y^2 â‰¡ x^3 + a*x + b (\\mod p)$ ä¸­çš„å¸¸æ•°) =0x0000000000000000000000000000000000000000000000000000000000000000 b (æ–¹ç¨‹ $y^2 â‰¡ x^3 + a*x + b (\\mod p)$ ä¸­çš„å¸¸æ•°)=0x0000000000000000000000000000000000000000000000000000000000000007 g (the curve generator point G {x, y}) = (0x79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798,0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8) h (cofactor, typically 1) = 01 Edwards æ›²çº¿æ¤­åœ†æ›²çº¿æ–¹ç¨‹é™¤äº†æˆ‘ä»¬å‰é¢ä½¿ç”¨çš„ Weierstrass å½¢å¼ $$y^2 = (x^3 + ax + b) \\mod p$$ å¤–ï¼Œè¿˜å¯ä»¥è¢«å†™æˆå…¶ä»–å¤šç§å½¢å¼ï¼Œè¿™äº›ä¸åŒçš„å½¢å¼æ˜¯åŒæœ‰ç†ç­‰ä»·çš„ ï¼ˆåˆ«é—®ï¼Œæˆ‘ä¹Ÿä¸æ‡‚ä»€ä¹ˆå«ã€ŒåŒæœ‰ç†ç­‰ä»·ã€â€¦ï¼‰ã€‚ä¸åŒçš„æ–¹ç¨‹å½¢å¼åœ¨è®¡ç®—æœºçš„æ•°å€¼è®¡ç®—ä¸Šå¯èƒ½ä¼šå­˜åœ¨åŒºåˆ«ã€‚ ä¸ºäº†æ€§èƒ½è€ƒè™‘ï¼ŒECC åœ¨éƒ¨åˆ†åœºæ™¯ä¸‹ä¼šè€ƒè™‘ä½¿ç”¨ Edwards æ›²çº¿å½¢å¼è¿›è¡Œè®¡ç®—ï¼Œè¯¥æ–¹ç¨‹å½¢å¼å¦‚ä¸‹ï¼š $$ x^{2}+y^{2}=1+dx^{2}y^{2} $$ ç”»ä¸ªå›¾é•¿è¿™æ ·ï¼š çŸ¥åçš„ Edwards æ›²çº¿æœ‰ï¼š Curve1174 (251-bit) Curve25519 (255-bit) Curve383187 (383-bit) Curve41417 (414-bit) Curve448 (448-bit) E-521 (521-bit) â€¦ Curve25519, X25519 å’Œ Ed25519 https://www.ietf.org/rfc/rfc7748.html#section-4.1 https://cryptography.io/en/latest/hazmat/primitives/asymmetric/ed25519/ åªè¦åŸŸå‚æ•°é€‰å¾—å¥½ï¼ŒEdwards å°±å¯ä»¥ä»¥éå¸¸é«˜çš„æ€§èƒ½å®ç° ECC å¯†é’¥äº¤æ¢ã€æ•°å­—ç­¾åã€æ··åˆåŠ å¯†æ–¹æ¡ˆã€‚ ä¸€ä¸ªä¾‹å­å°±æ˜¯ Curve25519ï¼Œå®ƒæ˜¯ Edwards æ›²çº¿ï¼Œå…¶ Montgomery å½¢å¼çš„å®šä¹‰å¦‚ä¸‹ï¼š $$ y^{2}=x^{3}+486662x^{2}+x $$ å…¶è¢«å®šä¹‰åœ¨æœ‰é™åŸŸ $\\mathbb {F} _{p}$ ä¸Šï¼Œ$p = 2^{255} - 19$, å…¶ä»–åŸŸå‚æ•°å¦‚ä¸‹ï¼š é˜¶ $n = 2^{252} + 0x14def9dea2f79cd65812631a5cf5d3ed$ è¾…å› å­ h = 8 è™½ç„¶æ­¤æ›²çº¿å¹¶æœªä»¥ Edwards å½¢å¼å®šä¹‰ï¼Œä½†æ˜¯å®ƒå·²è¢«è¯æ˜ä¸å¦‚ä¸‹æ‰­æ›² Edwards æ›²çº¿ï¼ˆedwards25519ï¼‰ åŒæœ‰ç†ç­‰ä»·ï¼š $$ -x^2 + y^2 = 1 + 37095705934669439343138083508754565189542113879843219016388785533085940283555 x^2 y^2 $$ ä¸Šé¢ç»™å‡ºçš„è¿™ç§ Edwards å½¢å¼ä¸å‰æ–‡ç»™å‡ºçš„ Weierstrass å½¢å¼å®Œå…¨ç­‰ä»·ï¼Œæ˜¯ä¸“ä¸ºè®¡ç®—é€Ÿåº¦ä¼˜åŒ–è€Œè®¾è®¡æˆè¿™æ ·çš„ã€‚ Curve25519 ç”± Daniel Bernstein é¢†å¯¼çš„å¯†ç å­¦å®¶å›¢é˜Ÿç²¾å¿ƒè®¾è®¡ï¼Œåœ¨å¤šä¸ªè®¾è®¡å’Œå®ç°å±‚é¢ä¸Šè¾¾æˆäº†éå¸¸é«˜çš„æ€§èƒ½ï¼ŒåŒæ—¶ä¸å½±å“å®‰å…¨æ€§ã€‚ Curve25519 çš„æ„é€ ä½¿å…¶é¿å…äº†è®¸å¤šæ½œåœ¨çš„å®ç°ç¼ºé™·ã€‚æ ¹æ®è®¾è®¡ï¼Œå®ƒä¸å—å®šæ—¶æ”»å‡»çš„å½±å“ï¼Œå¹¶ä¸”å®ƒæ¥å—ä»»ä½• 32 å­—èŠ‚çš„å­—ç¬¦ä¸²ä½œä¸ºæœ‰æ•ˆçš„å…¬é’¥ï¼Œå¹¶ä¸”ä¸éœ€è¦éªŒè¯ã€‚å®ƒèƒ½æä¾› 125.8bits çš„å®‰å…¨å¼ºåº¦ï¼ˆæœ‰æ—¶ç§°ä¸º ~ 128bits å®‰å…¨æ€§ï¼‰ Curve25519 çš„ç§é’¥ä¸º 251 ä½ï¼Œé€šå¸¸ç¼–ç ä¸º 256 ä½æ•´æ•°ï¼ˆ32 ä¸ªå­—èŠ‚ï¼Œ64 ä¸ªåå…­è¿›åˆ¶æ•°å­—ï¼‰ã€‚å…¬é’¥é€šå¸¸ä¹Ÿç¼–ç ä¸º 256 ä½æ•´æ•°ï¼ˆ255 ä½ y åæ ‡ + 1 ä½ x åæ ‡ï¼‰ï¼Œè¿™å¯¹å¼€å‘äººå‘˜æ¥è¯´éå¸¸æ–¹ä¾¿ã€‚ åŸºäº Curve25519 æ´¾ç”Ÿå‡ºäº†åä¸º X25519 çš„ ECDH ç®—æ³•ï¼Œä»¥åŠåŸºäº EdDSA çš„é«˜é€Ÿæ•°å­—ç­¾åç®—æ³•Ed25519. Curve448, X448 å’Œ Ed448 https://www.ietf.org/rfc/rfc7748.html#section-4.2 https://cryptography.io/en/latest/hazmat/primitives/asymmetric/ed448/ Curve448ï¼ˆCurve448-Goldilocksï¼‰æ˜¯ä¸€ç§éæ‰­æ›² Edwards æ›²çº¿ï¼Œå®ƒçš„æ–¹ç¨‹å®šä¹‰å¦‚ä¸‹ï¼š $$ x^2 + y^2 = 1 - 39081 x^2 y^2 $$ å…¶è¢«å®šä¹‰åœ¨æœ‰é™åŸŸ $\\mathbb {F} _{p}$ ä¸Šï¼Œ$p = 2^{448} - 2^{224} - 1$ï¼Œå…¶ä»–åŸŸå‚æ•°ï¼š é˜¶ $n = 2^{446} - 0x8335dc163bb124b65129c96fde933d8d723a70aadc873d6d54a7bb0d$ è¾…åŠ©å› å­ h = 4 ä¸ Curve25519 ä¸€æ ·ï¼ŒCurve448 ä¹Ÿç­‰ä»·äºå‰é¢ç»™å‡ºçš„ Weierstrass å½¢å¼ï¼Œé€‰æ‹© Edwards å½¢å¼ä¸»è¦æ˜¯å› ä¸ºå®ƒèƒ½æ˜¾è‘—æå‡æ€§èƒ½ã€‚ Curve448 æä¾› 222.8 ä½çš„å®‰å…¨å¼ºåº¦ã€‚Curve448 çš„ç§é’¥ä¸º 446 ä½ï¼Œé€šå¸¸ç¼–ç ä¸º 448 ä½æ•´æ•°ï¼ˆ56 ä¸ªå­—èŠ‚ï¼Œ112 ä¸ªåå…­è¿›åˆ¶æ•°å­—ï¼‰ã€‚å…¬é’¥ä¹Ÿè¢«ç¼–ç ä¸º 448 ä½æ•´æ•°ã€‚ åŸºäº Curve44","date":"2022-03-09","objectID":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/:4:6","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","éå¯¹ç§°åŠ å¯†","å®‰å…¨","RSA","ECC"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC","uri":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/#curve448-x448-å’Œ-ed448"},{"categories":["tech"],"content":" å¯†ç å­¦å¸¸ç”¨æ¤­åœ†æ›²çº¿ä»‹ç»åœ¨ä»‹ç»å¯†ç å­¦ä¸­çš„å¸¸ç”¨æ¤­åœ†æ›²çº¿å‰ï¼Œéœ€è¦å…ˆä»‹ç»ä¸€ä¸‹æ¤­åœ†æ›²çº¿çš„é˜¶ï¼ˆorderï¼‰ä»¥åŠè¾…åŠ©å› å­ï¼ˆcofactorï¼‰è¿™ä¸¤ä¸ªæ¦‚å¿µã€‚ é¦–å…ˆè¿˜å¾—ä»‹ç»ä¸‹æ•°å­¦ä¸­ã€Œå¾ªç¯ç¾¤ã€çš„æ¦‚å¿µï¼Œå®ƒæ˜¯æŒ‡èƒ½ç”±å•ä¸ªå…ƒç´ æ‰€ç”Ÿæˆçš„ç¾¤ï¼Œåœ¨ ECC ä¸­è¿™å°±æ˜¯é¢„å…ˆå®šä¹‰å¥½çš„åŸºç‚¹ $G$. ä¸€ä¸ªæœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿å¯ä»¥å½¢æˆä¸€ä¸ªæœ‰é™ã€Œå¾ªç¯ä»£æ•°ç¾¤ã€ï¼Œå®ƒç”±æ›²çº¿ä¸Šçš„æ‰€æœ‰ç‚¹ç»„æˆã€‚æ¤­åœ†æ›²çº¿çš„é˜¶è¢«å®šä¹‰ä¸ºè¯¥æ›²çº¿ä¸Šæ‰€æœ‰ç‚¹çš„ä¸ªæ•°ï¼ˆåŒ…æ‹¬æ— ç©·è¿œç‚¹ï¼‰ã€‚ æœ‰äº›æ›²çº¿åŠ ä¸Š G ç‚¹å¯ä»¥å½¢æˆä¸€ä¸ªå•ä¸€å¾ªç¯ç¾¤ï¼Œè¿™ä¸€ä¸ªç¾¤åŒ…å«äº†æ›²çº¿ä¸Šçš„æ‰€æœ‰ç‚¹ã€‚è€Œå…¶ä»–çš„æ›²çº¿åŠ ä¸Š G ç‚¹åˆ™å½¢æˆå¤šä¸ªä¸ç›¸äº¤çš„å¾ªç¯å­ç¾¤ï¼Œæ¯ä¸ªå­ç¾¤åŒ…å«äº†æ›²çº¿çš„ä¸€ä¸ªå­é›†ã€‚å¯¹äºä¸Šè¿°ç¬¬äºŒç§æƒ…å†µï¼Œå‡è®¾æ›²çº¿ä¸Šçš„ç‚¹è¢«æ‹†åˆ†åˆ°äº† h ä¸ªå¾ªç¯å­ç¾¤ä¸­ï¼Œæ¯ä¸ªå­ç¾¤çš„é˜¶éƒ½æ˜¯ rï¼Œé‚£è¿™æ—¶æ•´ä¸ªç¾¤çš„é˜¶å°±æ˜¯ $n = h * r$ï¼Œå…¶ä¸­å­ç¾¤çš„ä¸ªæ•° h è¢«ç§°ä¸ºè¾…åŠ©å› å­ã€‚ æœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿çš„é˜¶éƒ½æ˜¯æœ‰é™çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹äºæ›²çº¿ä¸Šä»»æ„ä¸€ç‚¹ $G$ï¼Œæˆ‘ä»¬è®¡ç®—å®ƒçš„æ•°ä¹˜ $kG$ï¼Œ éšç€æ•´æ•° $k$ çš„å¢å¤§ï¼Œä¸€å®šä¼šå­˜åœ¨æŸä¸ª $k$ ä½¿ $kG = O_{\\infty}$ æˆç«‹ï¼Œç„¶å $k$ ç»§ç»­å¢å¤§æ—¶ï¼Œå› ä¸º $O_{\\infty} * P = O_{\\infty}$ï¼Œ$kG$ çš„å€¼å°±å›ºå®šä¸º $O_{\\infty}$ äº†ï¼Œæ›´å¤§çš„ $k$ å€¼å·²ç»å¤±å»äº†æ„ä¹‰ã€‚ å› æ­¤ ECC ä¸­è¦æ±‚ $kG$ ä¸­çš„ç§é’¥ $k$ ç¬¦åˆæ¡ä»¶ $0 \\le k \\le r$ï¼Œä¹Ÿå°±æ˜¯è¯´æ€»çš„ç§é’¥æ•°é‡æ˜¯å— $r$ é™åˆ¶çš„ã€‚ è¾…åŠ©å› å­é€šè¿‡ç”¨å¦‚ä¸‹å…¬å¼è¡¨ç¤ºï¼š $$ h = n / r $$ å…¶ä¸­ $n$ æ˜¯æ›²çº¿çš„é˜¶ï¼Œ$r$ æ˜¯æ¯ä¸ªå­ç¾¤çš„é˜¶ï¼Œ$h$ æ˜¯è¾…åŠ©å› å­ã€‚å¦‚æœæ›²çº¿å½¢æˆäº†ä¸€ä¸ªå•ä¸€å¾ªç¯ç¾¤ï¼Œé‚£æ˜¾ç„¶ $h = 1$ï¼Œå¦åˆ™ $h \u003e 1$ ä¸¾ä¾‹å¦‚ä¸‹ï¼š secp256k1 çš„è¾…åŠ©å› å­ä¸º 1 Curve25519 çš„è¾…åŠ©å› å­ä¸º 8 Curve448 çš„è¾…åŠ©å› å­ä¸º 4 ç”Ÿæˆç‚¹ Gç”Ÿæˆç‚¹ G çš„é€‰æ‹©æ˜¯å¾ˆæœ‰è®²ç©¶çš„ï¼Œè™½ç„¶æ¯ä¸ªå¾ªç¯å­ç¾¤éƒ½åŒ…å«æœ‰å¾ˆå¤šä¸ªç”Ÿæˆç‚¹ï¼Œä½†æ˜¯ ECC åªä¼šè°¨æ…çš„é€‰æ‹©å…¶ä¸­ä¸€ä¸ªã€‚é¦–å…ˆ G ç‚¹å¿…é¡»è¦èƒ½ç”Ÿæˆå‡ºæ•´ä¸ªå¾ªç¯å­ç¾¤ï¼Œå…¶æ¬¡è¿˜éœ€è¦æœ‰å°½å¯èƒ½é«˜çš„è®¡ç®—æ€§èƒ½ã€‚ æ•°å­¦ä¸Šå·²çŸ¥æŸäº›æ¤­åœ†æ›²çº¿ä¸Šï¼Œä¸åŒçš„ç”Ÿæˆç‚¹ç”Ÿæˆå‡ºçš„å¾ªç¯å­ç¾¤ï¼Œé˜¶ä¹Ÿæ˜¯ä¸åŒçš„ã€‚å¦‚æœ G ç‚¹é€‰å¾—ä¸å¥½ï¼Œ å¯èƒ½ä¼šå¯¼è‡´ç”Ÿæˆå‡ºçš„å­ç¾¤çš„é˜¶è¾ƒå°ã€‚å‰é¢æˆ‘ä»¬å·²ç»æè¿‡å­ç¾¤çš„é˜¶ $r$ ä¼šé™åˆ¶æ€»çš„ç§é’¥æ•°é‡ï¼Œå¯¼è‡´ç®—æ³•å¼ºåº¦å˜å¼±ï¼å› æ­¤ä¸æ°å½“çš„ $G$ ç‚¹å¯èƒ½ä¼šå¯¼è‡´æˆ‘ä»¬é­å—ã€Œå°å­ç¾¤æ”»å‡»ã€ã€‚ä¸ºäº†é¿å…è¿™ç§é£é™©ï¼Œå»ºè®®å°½é‡ä½¿ç”¨è¢«å¹¿æ³›ä½¿ç”¨çš„åŠ å¯†åº“ï¼Œè€Œä¸æ˜¯è‡ªå·±æ’¸ä¸€ä¸ªã€‚ æ¤­åœ†æ›²çº¿çš„åŸŸå‚æ•°ECCæ¤­åœ†æ›²çº¿ç”±ä¸€ç»„æ¤­åœ†æ›²çº¿åŸŸå‚æ•°æè¿°ï¼Œå¦‚æ›²çº¿æ–¹ç¨‹å‚æ•°ã€åœºå‚æ•°å’Œç”Ÿæˆç‚¹åæ ‡ã€‚è¿™äº›å‚æ•°åœ¨å„ç§å¯†ç å­¦æ ‡å‡†ä¸­æŒ‡å®šï¼Œä½ å¯ä»¥ç½‘ä¸Šæœåˆ°ç›¸åº”çš„ RFC æˆ– NIST æ–‡æ¡£ã€‚ è¿™äº›æ ‡å‡†å®šä¹‰äº†ä¸€ç»„å‘½åæ›²çº¿çš„å‚æ•°ï¼Œä¾‹å¦‚ secp256k1ã€P-521ã€brainpoolP512t1 å’Œ SM2. è¿™äº›åŠ å¯†æ ‡å‡†ä¸­æè¿°çš„æœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿å¾—åˆ°äº†å¯†ç å­¦å®¶çš„å……åˆ†ç ”ç©¶å’Œåˆ†æï¼Œå¹¶è¢«è®¤ä¸ºå…·æœ‰ä¸€å®šçš„å®‰å…¨å¼ºåº¦ã€‚ ä¹Ÿæœ‰ä¸€äº›å¯†ç å­¦å®¶ï¼ˆå¦‚ Daniel Bernsteinï¼‰è®¤ä¸ºï¼Œå®˜æ–¹å¯†ç æ ‡å‡†ä¸­æè¿°çš„å¤§å¤šæ•°æ›²çº¿éƒ½æ˜¯ã€Œä¸å®‰å…¨çš„ã€ï¼Œå¹¶å®šä¹‰äº†ä»–ä»¬è‡ªå·±çš„å¯†ç æ ‡å‡†ï¼Œè¿™äº›æ ‡å‡†åœ¨æ›´å¹¿æ³›çš„å±‚é¢ä¸Šè€ƒè™‘äº† ECC å®‰å…¨æ€§ã€‚ å¼€å‘äººå‘˜åº”è¯¥ä»…ä½¿ç”¨å„é¡¹æ ‡å‡†æ–‡æ¡£ç»™å‡ºçš„ã€ç»è¿‡å¯†ç å­¦å®¶å……åˆ†ç ”ç©¶çš„å‘½åæ›²çº¿ã€‚ secp256k1æ­¤æ›²çº¿è¢«åº”ç”¨åœ¨æ¯”ç‰¹å¸ä¸­ï¼Œå®ƒçš„åŸŸå‚æ•°å¦‚ä¸‹ï¼š p (modulus) =0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F n (order; size; the count of all possible EC points) =0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141 a (æ–¹ç¨‹ $y^2 â‰¡ x^3 + a*x + b (\\mod p)$ ä¸­çš„å¸¸æ•°) =0x0000000000000000000000000000000000000000000000000000000000000000 b (æ–¹ç¨‹ $y^2 â‰¡ x^3 + a*x + b (\\mod p)$ ä¸­çš„å¸¸æ•°)=0x0000000000000000000000000000000000000000000000000000000000000007 g (the curve generator point G {x, y}) = (0x79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798,0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8) h (cofactor, typically 1) = 01 Edwards æ›²çº¿æ¤­åœ†æ›²çº¿æ–¹ç¨‹é™¤äº†æˆ‘ä»¬å‰é¢ä½¿ç”¨çš„ Weierstrass å½¢å¼ $$y^2 = (x^3 + ax + b) \\mod p$$ å¤–ï¼Œè¿˜å¯ä»¥è¢«å†™æˆå…¶ä»–å¤šç§å½¢å¼ï¼Œè¿™äº›ä¸åŒçš„å½¢å¼æ˜¯åŒæœ‰ç†ç­‰ä»·çš„ ï¼ˆåˆ«é—®ï¼Œæˆ‘ä¹Ÿä¸æ‡‚ä»€ä¹ˆå«ã€ŒåŒæœ‰ç†ç­‰ä»·ã€â€¦ï¼‰ã€‚ä¸åŒçš„æ–¹ç¨‹å½¢å¼åœ¨è®¡ç®—æœºçš„æ•°å€¼è®¡ç®—ä¸Šå¯èƒ½ä¼šå­˜åœ¨åŒºåˆ«ã€‚ ä¸ºäº†æ€§èƒ½è€ƒè™‘ï¼ŒECC åœ¨éƒ¨åˆ†åœºæ™¯ä¸‹ä¼šè€ƒè™‘ä½¿ç”¨ Edwards æ›²çº¿å½¢å¼è¿›è¡Œè®¡ç®—ï¼Œè¯¥æ–¹ç¨‹å½¢å¼å¦‚ä¸‹ï¼š $$ x^{2}+y^{2}=1+dx^{2}y^{2} $$ ç”»ä¸ªå›¾é•¿è¿™æ ·ï¼š çŸ¥åçš„ Edwards æ›²çº¿æœ‰ï¼š Curve1174 (251-bit) Curve25519 (255-bit) Curve383187 (383-bit) Curve41417 (414-bit) Curve448 (448-bit) E-521 (521-bit) â€¦ Curve25519, X25519 å’Œ Ed25519 https://www.ietf.org/rfc/rfc7748.html#section-4.1 https://cryptography.io/en/latest/hazmat/primitives/asymmetric/ed25519/ åªè¦åŸŸå‚æ•°é€‰å¾—å¥½ï¼ŒEdwards å°±å¯ä»¥ä»¥éå¸¸é«˜çš„æ€§èƒ½å®ç° ECC å¯†é’¥äº¤æ¢ã€æ•°å­—ç­¾åã€æ··åˆåŠ å¯†æ–¹æ¡ˆã€‚ ä¸€ä¸ªä¾‹å­å°±æ˜¯ Curve25519ï¼Œå®ƒæ˜¯ Edwards æ›²çº¿ï¼Œå…¶ Montgomery å½¢å¼çš„å®šä¹‰å¦‚ä¸‹ï¼š $$ y^{2}=x^{3}+486662x^{2}+x $$ å…¶è¢«å®šä¹‰åœ¨æœ‰é™åŸŸ $\\mathbb {F} _{p}$ ä¸Šï¼Œ$p = 2^{255} - 19$, å…¶ä»–åŸŸå‚æ•°å¦‚ä¸‹ï¼š é˜¶ $n = 2^{252} + 0x14def9dea2f79cd65812631a5cf5d3ed$ è¾…å› å­ h = 8 è™½ç„¶æ­¤æ›²çº¿å¹¶æœªä»¥ Edwards å½¢å¼å®šä¹‰ï¼Œä½†æ˜¯å®ƒå·²è¢«è¯æ˜ä¸å¦‚ä¸‹æ‰­æ›² Edwards æ›²çº¿ï¼ˆedwards25519ï¼‰ åŒæœ‰ç†ç­‰ä»·ï¼š $$ -x^2 + y^2 = 1 + 37095705934669439343138083508754565189542113879843219016388785533085940283555 x^2 y^2 $$ ä¸Šé¢ç»™å‡ºçš„è¿™ç§ Edwards å½¢å¼ä¸å‰æ–‡ç»™å‡ºçš„ Weierstrass å½¢å¼å®Œå…¨ç­‰ä»·ï¼Œæ˜¯ä¸“ä¸ºè®¡ç®—é€Ÿåº¦ä¼˜åŒ–è€Œè®¾è®¡æˆè¿™æ ·çš„ã€‚ Curve25519 ç”± Daniel Bernstein é¢†å¯¼çš„å¯†ç å­¦å®¶å›¢é˜Ÿç²¾å¿ƒè®¾è®¡ï¼Œåœ¨å¤šä¸ªè®¾è®¡å’Œå®ç°å±‚é¢ä¸Šè¾¾æˆäº†éå¸¸é«˜çš„æ€§èƒ½ï¼ŒåŒæ—¶ä¸å½±å“å®‰å…¨æ€§ã€‚ Curve25519 çš„æ„é€ ä½¿å…¶é¿å…äº†è®¸å¤šæ½œåœ¨çš„å®ç°ç¼ºé™·ã€‚æ ¹æ®è®¾è®¡ï¼Œå®ƒä¸å—å®šæ—¶æ”»å‡»çš„å½±å“ï¼Œå¹¶ä¸”å®ƒæ¥å—ä»»ä½• 32 å­—èŠ‚çš„å­—ç¬¦ä¸²ä½œä¸ºæœ‰æ•ˆçš„å…¬é’¥ï¼Œå¹¶ä¸”ä¸éœ€è¦éªŒè¯ã€‚å®ƒèƒ½æä¾› 125.8bits çš„å®‰å…¨å¼ºåº¦ï¼ˆæœ‰æ—¶ç§°ä¸º ~ 128bits å®‰å…¨æ€§ï¼‰ Curve25519 çš„ç§é’¥ä¸º 251 ä½ï¼Œé€šå¸¸ç¼–ç ä¸º 256 ä½æ•´æ•°ï¼ˆ32 ä¸ªå­—èŠ‚ï¼Œ64 ä¸ªåå…­è¿›åˆ¶æ•°å­—ï¼‰ã€‚å…¬é’¥é€šå¸¸ä¹Ÿç¼–ç ä¸º 256 ä½æ•´æ•°ï¼ˆ255 ä½ y åæ ‡ + 1 ä½ x åæ ‡ï¼‰ï¼Œè¿™å¯¹å¼€å‘äººå‘˜æ¥è¯´éå¸¸æ–¹ä¾¿ã€‚ åŸºäº Curve25519 æ´¾ç”Ÿå‡ºäº†åä¸º X25519 çš„ ECDH ç®—æ³•ï¼Œä»¥åŠåŸºäº EdDSA çš„é«˜é€Ÿæ•°å­—ç­¾åç®—æ³•Ed25519. Curve448, X448 å’Œ Ed448 https://www.ietf.org/rfc/rfc7748.html#section-4.2 https://cryptography.io/en/latest/hazmat/primitives/asymmetric/ed448/ Curve448ï¼ˆCurve448-Goldilocksï¼‰æ˜¯ä¸€ç§éæ‰­æ›² Edwards æ›²çº¿ï¼Œå®ƒçš„æ–¹ç¨‹å®šä¹‰å¦‚ä¸‹ï¼š $$ x^2 + y^2 = 1 - 39081 x^2 y^2 $$ å…¶è¢«å®šä¹‰åœ¨æœ‰é™åŸŸ $\\mathbb {F} _{p}$ ä¸Šï¼Œ$p = 2^{448} - 2^{224} - 1$ï¼Œå…¶ä»–åŸŸå‚æ•°ï¼š é˜¶ $n = 2^{446} - 0x8335dc163bb124b65129c96fde933d8d723a70aadc873d6d54a7bb0d$ è¾…åŠ©å› å­ h = 4 ä¸ Curve25519 ä¸€æ ·ï¼ŒCurve448 ä¹Ÿç­‰ä»·äºå‰é¢ç»™å‡ºçš„ Weierstrass å½¢å¼ï¼Œé€‰æ‹© Edwards å½¢å¼ä¸»è¦æ˜¯å› ä¸ºå®ƒèƒ½æ˜¾è‘—æå‡æ€§èƒ½ã€‚ Curve448 æä¾› 222.8 ä½çš„å®‰å…¨å¼ºåº¦ã€‚Curve448 çš„ç§é’¥ä¸º 446 ä½ï¼Œé€šå¸¸ç¼–ç ä¸º 448 ä½æ•´æ•°ï¼ˆ56 ä¸ªå­—èŠ‚ï¼Œ112 ä¸ªåå…­è¿›åˆ¶æ•°å­—ï¼‰ã€‚å…¬é’¥ä¹Ÿè¢«ç¼–ç ä¸º 448 ä½æ•´æ•°ã€‚ åŸºäº Curve44","date":"2022-03-09","objectID":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/:4:6","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","éå¯¹ç§°åŠ å¯†","å®‰å…¨","RSA","ECC"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC","uri":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/#è¯¥é€‰æ‹©å“ªç§æ¤­åœ†æ›²çº¿"},{"categories":["tech"],"content":" ECIES - é›†æˆåŠ å¯†æ–¹æ¡ˆåœ¨æ–‡ç« å¼€å¤´æˆ‘ä»¬å·²ç»ä»‹ç»äº†é›†æˆåŠ å¯†æ–¹æ¡ˆ (IES)ï¼Œå®ƒåœ¨å¯†é’¥å°è£…æœºåˆ¶ï¼ˆKEMï¼‰çš„åŸºç¡€ä¸Šï¼Œæ·»åŠ äº†å¯†é’¥æ´¾ç”Ÿç®—æ³• KDFã€æ¶ˆæ¯è®¤è¯ç®—æ³• MAC ç­‰å…¶ä»–å¯†ç å­¦ç®—æ³•ä»¥è¾¾æˆæˆ‘ä»¬å¯¹æ¶ˆæ¯çš„å®‰å…¨æ€§ã€çœŸå®æ€§ã€å®Œå…¨æ€§çš„éœ€æ±‚ã€‚ è€Œ ECIES ä¹Ÿå®Œå…¨ç±»ä¼¼ï¼Œæ˜¯åœ¨ ECC + å¯¹ç§°åŠ å¯†ç®—æ³•çš„åŸºç¡€ä¸Šï¼Œæ·»åŠ äº†è®¸å¤šå…¶ä»–çš„å¯†ç å­¦ç®—æ³•å®ç°çš„ã€‚ ECIES æ˜¯ä¸€ä¸ªåŠ å¯†æ¡†æ¶ï¼Œè€Œä¸æ˜¯æŸç§å›ºå®šçš„ç®—æ³•ã€‚å®ƒå¯ä»¥é€šè¿‡æ’æ‹”ä¸åŒçš„ç®—æ³•ï¼Œå½¢æˆä¸åŒçš„å®ç°ã€‚æ¯”å¦‚ã€Œsecp256k1 + Scrypt + AES-GCM + HMAC-SHA512ã€ã€‚ å¤§æ¦‚å°±ä»‹ç»åˆ°è¿™é‡Œå§ï¼Œåç»­å°±è¯·åœ¨éœ€è¦ç”¨åˆ°æ—¶è‡ªè¡Œæ¢ç´¢ç›¸å…³çš„ç»†èŠ‚å’¯ã€‚ ","date":"2022-03-09","objectID":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/:4:7","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","éå¯¹ç§°åŠ å¯†","å®‰å…¨","RSA","ECC"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC","uri":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/#ecies---é›†æˆåŠ å¯†æ–¹æ¡ˆ"},{"categories":["tech"],"content":" å‚è€ƒ Practical-Cryptography-for-Developers-Book A complete overview of SSL/TLS and its cryptographic system å¯†ç å‘å±•å²ä¹‹è¿‘ç°ä»£å¯†ç  - ä¸­å›½å›½å®¶å¯†ç ç®¡ç†å±€ RFC6090 - Fundamental Elliptic Curve Cryptography Algorithms Which elliptic curve should I use? ","date":"2022-03-09","objectID":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/:5:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","éå¯¹ç§°åŠ å¯†","å®‰å…¨","RSA","ECC"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC","uri":"/posts/practical-cryptography-basics-7-asymmetric-key-ciphers/#å‚è€ƒ"},{"categories":["tech"],"content":" æœ¬æ–‡ä¸»è¦ç¿»è¯‘è‡ª Practical-Cryptography-for-Developers-Bookï¼Œç¬”è€…è¡¥å……äº†éƒ¨åˆ†ä»£ç ç¤ºä¾‹ã€‚ ","date":"2022-03-06","objectID":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/:0:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","å¯¹ç§°åŠ å¯†","å®‰å…¨","AES","ChaCha20"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…­ï¼‰â€”â€” å¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³•","uri":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/#"},{"categories":["tech"],"content":" é›¶ã€æœ¯è¯­ä»‹ç»ä¸¤ä¸ªå¸¸ç”¨åŠ¨è¯ï¼š åŠ å¯†ï¼šcipher æˆ–è€… encrypt è§£å¯†ï¼šdecipher æˆ–è€… decrypt å¦å¤–æœ‰å‡ ä¸ªåè¯æœ‰å¿…è¦è§£é‡Šï¼š cipher: æŒ‡ç”¨äºåŠ è§£å¯†çš„ã€Œå¯†ç ç®—æ³•ã€ï¼Œæœ‰æ—¶ä¹Ÿè¢«ç›´æ¥ç¿»è¯‘æˆã€Œå¯†ç ã€ cryptographic algorithm: å¯†ç å­¦ç®—æ³•ï¼Œæ³›æŒ‡å¯†ç å­¦ç›¸å…³çš„å„ç±»ç®—æ³• ciphertext: å¯†æ–‡ï¼Œå³åŠ å¯†åçš„ä¿¡æ¯ã€‚å¯¹åº”çš„è¯æ˜¯æ˜æ–‡ plaintext password: è¿™ä¸ªåº”è¯¥ä¸éœ€è¦è§£é‡Šï¼Œå°±æ˜¯æˆ‘ä»¬æ—¥å¸¸ç”¨çš„å„ç§å­—ç¬¦æˆ–è€…æ•°å­—å¯†ç ï¼Œä¹Ÿå¯ç§°ä½œå£ä»¤ï¼Œé€šå¸¸éƒ½æ¯”è¾ƒçŸ­ï¼ˆç»å¤§éƒ¨åˆ†ç”¨æˆ·å¯†ç åº”è¯¥éƒ½åªæœ‰ 8 - 16 ä½ï¼‰ã€‚ å› ä¸ºç«™ç‚¹å¤ªå¤šï¼Œå¯†ç å¤ªéš¾è®°ï¼Œç°ä»£ç¤¾ä¼šæ­£åœ¨é€æ­¥æ¨èä½¿ç”¨ç”Ÿç‰©ç‰¹å¾ï¼ˆæŒ‡çº¹ã€é¢éƒ¨è¯†åˆ«ç­‰ï¼Œå¦‚ pass keyã€æ‰‹æœºæŒ‡çº¹è¯†åˆ«ï¼‰æˆ–è€…ç¡¬ä»¶å¯†é’¥ï¼ˆU2Fï¼‰æ¥æ›¿ä»£ä¼ ç»Ÿçš„å¯†ç ã€‚ passphrase: ç¿»è¯‘æˆã€Œå¯†ç è¯ç»„ã€ï¼Œä¹Ÿå°±æ˜¯ç”¨ä¸€ä¸ªä¸ªå•è¯ç»„åˆè€Œæˆçš„ Passwordï¼Œç‰¹ç‚¹æ˜¯é•¿åº¦æ¯”è¾ƒé•¿ï¼Œè€Œä¸”æ¯”éšæœºå¯†ç æ›´å®¹æ˜“è®°å¿†ã€‚ å¦‚æœä½ ç”¨ ssh/gnupg/openssl ç­‰å·¥å…·ç”Ÿæˆæˆ–ä½¿ç”¨è¿‡å¯†é’¥ï¼Œåº”è¯¥å¯¹å®ƒä¸é™Œç”Ÿï¼Œå®ƒä»¬çš„ passphrase é•¿åº¦ä¸å—é™ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ç±»ä¼¼ you-are-not-my-enemy-but-I'm-your-father è¿™æ ·çš„è¯ç»„æ–¹å¼ä½œä¸ºå…¶å¯†ç ï¼Œå¼ºåº¦é«˜ï¼Œè€Œä¸”å¥½è®°ã€‚ åœ¨å¯†ç å­¦é‡Œé¢ï¼Œæœ€å®¹æ˜“ææ··çš„è¯ä¼°è®¡å°±æ˜¯ã€Œå¯†ç ã€äº†ï¼Œcipher/password/passphrase éƒ½å¯ä»¥è¢«ç¿»è¯‘æˆã€Œå¯†ç ã€ï¼Œéœ€è¦æ³¨æ„ä¸‹å…¶ä¸­åŒºåˆ«ã€‚ ","date":"2022-03-06","objectID":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/:1:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","å¯¹ç§°åŠ å¯†","å®‰å…¨","AES","ChaCha20"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…­ï¼‰â€”â€” å¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³•","uri":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/#é›¶æœ¯è¯­ä»‹ç»"},{"categories":["tech"],"content":" ä¸€ã€ä»€ä¹ˆæ˜¯å¯¹ç§°åŠ å¯†åœ¨å¯†ç å­¦ä¸­ï¼Œæœ‰ä¸¤ç§åŠ å¯†æ–¹æ¡ˆè¢«å¹¿æ³›ä½¿ç”¨ï¼šã€Œå¯¹ç§°åŠ å¯†ã€ä¸ã€Œéå¯¹ç§°åŠ å¯†ã€ã€‚ å¯¹ç§°åŠ å¯†æ˜¯æŒ‡ï¼Œä½¿ç”¨ç›¸åŒçš„å¯†é’¥è¿›è¡Œæ¶ˆæ¯çš„åŠ å¯†ä¸è§£å¯†ã€‚å› ä¸ºè¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬ä¹Ÿç§°è¿™ä¸ªå¯†é’¥ä¸ºã€Œå…±äº«å¯†é’¥ï¼ˆShared Secret Keyï¼‰ã€ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š ç°ä»£å¯†ç å­¦ä¸­å¹¿æ³›ä½¿ç”¨çš„å¯¹ç§°åŠ å¯†ç®—æ³•ï¼ˆciphersï¼‰ æœ‰ï¼šAESï¼ˆAES-128ã€AES-192ã€AES-256ï¼‰ã€ChaCha20ã€Twofishã€IDEAã€Serpentã€Cameliaã€RC6ã€CAST ç­‰ã€‚å…¶ä¸­ç»å¤§å¤šæ•°éƒ½æ˜¯ã€Œå—å¯†ç ç®—æ³•ï¼ˆBlock Cipherï¼‰ã€æˆ–è€…å«ã€Œåˆ†ç»„å¯†ç ç®—æ³•ã€ï¼Œè¿™ç§ç®—æ³•ä¸€æ¬¡åªèƒ½åŠ å¯†å›ºå®šå¤§å°çš„å—ï¼ˆä¾‹å¦‚ 128 ä½ï¼‰ï¼›å°‘éƒ¨åˆ†æ˜¯ã€Œæµå¯†ç ç®—æ³•ï¼ˆStream Cipherï¼‰ã€ï¼Œæµå¯†ç ç®—æ³•å°†æ•°æ®é€å­—èŠ‚åœ°åŠ å¯†ä¸ºå¯†æ–‡æµã€‚ é€šè¿‡ä½¿ç”¨ç§°ä¸ºã€Œåˆ†ç»„å¯†ç å·¥ä½œæ¨¡å¼ã€çš„æŠ€æœ¯ï¼Œå¯ä»¥å°†ã€Œåˆ†ç»„å¯†ç ç®—æ³•ã€è½¬æ¢ä¸ºã€Œæµå¯†ç ç®—æ³•ã€ã€‚ ","date":"2022-03-06","objectID":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/:2:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","å¯¹ç§°åŠ å¯†","å®‰å…¨","AES","ChaCha20"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…­ï¼‰â€”â€” å¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³•","uri":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/#ä¸€ä»€ä¹ˆæ˜¯å¯¹ç§°åŠ å¯†"},{"categories":["tech"],"content":" é‡å­å®‰å…¨æ€§å³ä½¿è®¡ç®—æœºè¿›å…¥é‡å­æ—¶ä»£ï¼Œä»ç„¶å¯ä»¥æ²¿ç”¨å½“å‰çš„å¯¹ç§°å¯†ç ç®—æ³•ã€‚å› ä¸ºå¤§å¤šæ•°ç°ä»£å¯¹ç§°å¯†é’¥å¯†ç ç®—æ³•éƒ½æ˜¯æŠ—é‡å­çš„ï¼ˆquantum-resistantï¼‰ï¼Œè¿™æ„å‘³å½“ä½¿ç”¨é•¿åº¦è¶³å¤Ÿçš„å¯†é’¥æ—¶ï¼Œå¼ºå¤§çš„é‡å­è®¡ç®—æœºæ— æ³•ç ´åå…¶å®‰å…¨æ€§ã€‚ç›®å‰æ¥çœ‹ 256 ä½çš„ AES/Twofish åœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´å†…éƒ½å°†æ˜¯ é‡å­å®‰å…¨ çš„ã€‚ ","date":"2022-03-06","objectID":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/:2:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","å¯¹ç§°åŠ å¯†","å®‰å…¨","AES","ChaCha20"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…­ï¼‰â€”â€” å¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³•","uri":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/#é‡å­å®‰å…¨æ€§"},{"categories":["tech"],"content":" äºŒã€å¯¹ç§°åŠ å¯†æ–¹æ¡ˆçš„ç»“æ„æˆ‘ä»¬åœ¨ç¬¬ä¸€ç« ã€Œæ¦‚è§ˆã€é‡Œä»‹ç»è¿‡ï¼Œå•çº¯ä½¿ç”¨æ•°æ®åŠ å¯†ç®—æ³•åªèƒ½ä¿è¯æ•°æ®çš„å®‰å…¨æ€§ï¼Œå¹¶ä¸èƒ½æ»¡è¶³æˆ‘ä»¬å¯¹æ¶ˆæ¯çœŸå®æ€§ã€å®Œæ•´æ€§ä¸ä¸å¯å¦è®¤æ€§çš„éœ€æ±‚ï¼Œå› æ­¤é€šå¸¸æˆ‘ä»¬ä¼šå°†å¯¹ç§°åŠ å¯†ç®—æ³•è·Ÿå…¶ä»–ç®—æ³•ç»„åˆæˆä¸€ä¸ªã€Œå¯¹ç§°åŠ å¯†æ–¹æ¡ˆã€æ¥ä½¿ç”¨ï¼Œè¿™ç§å¤šä¸ªå¯†ç å­¦ç®—æ³•ç»„æˆçš„ã€ŒåŠ å¯†æ–¹æ¡ˆã€èƒ½åŒæ—¶ä¿è¯æ•°æ®çš„å®‰å…¨æ€§ã€çœŸå®æ€§ã€å®Œæ•´æ€§ä¸ä¸å¯å¦è®¤æ€§ã€‚ ä¸€ä¸ªåˆ†ç»„åŠ å¯†æ–¹æ¡ˆé€šå¸¸ä¼šåŒ…å«å¦‚ä¸‹å‡ ç§ç®—æ³•ï¼š å°†å¯†ç è½¬æ¢ä¸ºå¯†é’¥çš„å¯†é’¥æ´¾ç”Ÿç®—æ³• KDFï¼ˆå¦‚ Scrypt æˆ– Argon2ï¼‰ï¼šé€šè¿‡ä½¿ç”¨ KDFï¼ŒåŠ å¯†æ–¹æ¡ˆå¯ä»¥å…è®¸ç”¨æˆ·ä½¿ç”¨å­—ç¬¦å¯†ç ä½œä¸ºã€ŒShared Secret Keyã€ï¼Œå¹¶ä½¿å¯†ç çš„ç ´è§£å˜å¾—å›°éš¾å’Œç¼“æ…¢ åˆ†ç»„å¯†ç å·¥ä½œæ¨¡å¼ï¼ˆç”¨äºå°†åˆ†ç»„å¯†ç è½¬æ¢ä¸ºæµå¯†ç ï¼Œå¦‚ CBC æˆ– CTRï¼‰+ æ¶ˆæ¯å¡«å……ç®—æ³•ï¼ˆå¦‚ PKCS7ï¼‰ï¼šåˆ†ç»„å¯†ç ç®—æ³•ï¼ˆå¦‚ AESï¼‰éœ€è¦å€ŸåŠ©è¿™ä¸¤ç§ç®—æ³•ï¼Œæ‰èƒ½åŠ å¯†ä»»æ„å¤§å°çš„æ•°æ® åˆ†ç»„å¯†ç ç®—æ³•ï¼ˆå¦‚ AESï¼‰ï¼šä½¿ç”¨å¯†é’¥å®‰å…¨åœ°åŠ å¯†å›ºå®šé•¿åº¦çš„æ•°æ®å— å¤§å¤šæ•°æµè¡Œçš„å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œéƒ½æ˜¯åˆ†ç»„å¯†ç ç®—æ³• æ¶ˆæ¯è®¤è¯ç®—æ³•ï¼ˆå¦‚HMACï¼‰ï¼šç”¨äºéªŒè¯æ¶ˆæ¯çš„çœŸå®æ€§ã€å®Œæ•´æ€§ã€ä¸å¯å¦è®¤æ€§ è€Œä¸€ä¸ªæµå¯†ç åŠ å¯†æ–¹æ¡ˆæœ¬èº«å°±èƒ½åŠ å¯†ä»»æ„é•¿åº¦çš„æ•°æ®ï¼Œå› æ­¤ä¸éœ€è¦ã€Œåˆ†ç»„å¯†ç æ¨¡å¼ã€ä¸ã€Œæ¶ˆæ¯å¡«å……ç®—æ³•ã€ã€‚ å¦‚ AES-256-CTR-HMAC-SHA256 å°±è¡¨ç¤ºä¸€ä¸ªä½¿ç”¨ AES-256 ä¸ Counter åˆ†ç»„æ¨¡å¼è¿›è¡ŒåŠ å¯†ï¼Œä½¿ç”¨ HMAC-SHA256 è¿›è¡Œæ¶ˆæ¯è®¤è¯çš„åŠ å¯†æ–¹æ¡ˆã€‚å…¶ä»–æµè¡Œçš„å¯¹ç§°åŠ å¯†æ–¹æ¡ˆè¿˜æœ‰ ChaCha20-Poly1305 å’Œ AES-128-GCM ç­‰ï¼Œå…¶ä¸­ ChaCha20-Poly130 æ˜¯ä¸€ä¸ªæµå¯†ç åŠ å¯†æ–¹æ¡ˆã€‚æˆ‘ä»¬ä¼šåœ¨åé¢å•ç‹¬ä»‹ç»è¿™ä¸¤ç§åŠ å¯†æ–¹æ¡ˆã€‚ ","date":"2022-03-06","objectID":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/:3:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","å¯¹ç§°åŠ å¯†","å®‰å…¨","AES","ChaCha20"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…­ï¼‰â€”â€” å¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³•","uri":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/#äºŒå¯¹ç§°åŠ å¯†æ–¹æ¡ˆçš„ç»“æ„"},{"categories":["tech"],"content":" ä¸‰ã€åˆ†ç»„å¯†ç å·¥ä½œæ¨¡å¼å‰é¢ç®€å•ä»‹ç»äº†ã€Œåˆ†ç»„å¯†ç å·¥ä½œæ¨¡å¼ã€å¯ä»¥å°†ã€Œåˆ†ç»„å¯†ç ç®—æ³•ã€è½¬æ¢ä¸ºã€Œæµå¯†ç ç®—æ³•ã€ï¼Œä»è€Œå®ç°åŠ å¯†ä»»æ„é•¿åº¦çš„æ•°æ®ï¼Œè¿™é‡Œä¸»è¦å°±å…·ä½“ä»‹ç»ä¸‹è¿™ä¸ªåˆ†ç»„å¯†ç å·¥ä½œæ¨¡å¼ï¼ˆä¸‹æ–‡ç®€ç§°ä¸ºã€Œåˆ†ç»„æ¨¡å¼ã€æˆ–è€…ã€ŒXXX æ¨¡å¼ã€ï¼‰ã€‚ åŠ å¯†æ–¹æ¡ˆçš„åç§°ä¸­å°±å¸¦æœ‰å…·ä½“çš„ã€Œåˆ†ç»„æ¨¡å¼ã€åç§°ï¼Œå¦‚ï¼š AES-256-GCM - å…·æœ‰ 256 ä½åŠ å¯†å¯†é’¥å’Œ GCM åˆ†ç»„æ¨¡å¼çš„ AES å¯†ç  AES-128-CTR - å…·æœ‰ 128 ä½åŠ å¯†å¯†é’¥å’Œ CTR åˆ†ç»„æ¨¡å¼çš„ AES å¯†ç  Serpent-128-CBC - å…·æœ‰ 128 ä½åŠ å¯†å¯†é’¥å’Œ CBC åˆ†ç»„æ¨¡å¼çš„ Serpent å¯†ç  ã€Œåˆ†ç»„å¯†ç å·¥ä½œæ¨¡å¼ã€èƒŒåçš„ä¸»è¦æ€æƒ³æ˜¯æŠŠæ˜æ–‡åˆ†æˆå¤šä¸ªé•¿åº¦å›ºå®šçš„ç»„ï¼Œå†åœ¨è¿™äº›åˆ†ç»„ä¸Šé‡å¤åº”ç”¨åˆ†ç»„å¯†ç ç®—æ³•è¿›è¡ŒåŠ å¯†/è§£å¯†ï¼Œä»¥å®ç°å®‰å…¨åœ°åŠ å¯†/è§£å¯†ä»»æ„é•¿åº¦çš„æ•°æ®ã€‚ æŸäº›åˆ†ç»„æ¨¡å¼ï¼ˆå¦‚ CBCï¼‰è¦æ±‚å°†è¾“å…¥æ‹†åˆ†ä¸ºåˆ†ç»„ï¼Œå¹¶ä½¿ç”¨å¡«å……ç®—æ³•ï¼ˆä¾‹å¦‚æ·»åŠ ç‰¹æ®Šå¡«å……å­—ç¬¦ï¼‰å°†æœ€æœ«å°¾çš„åˆ†ç»„å¡«å……åˆ°å—å¤§å°ã€‚ä¹Ÿæœ‰äº›åˆ†ç»„æ¨¡å¼ï¼ˆå¦‚ CTRã€CFBã€OFBã€CCMã€EAX å’Œ GCMï¼‰æ ¹æœ¬ä¸éœ€è¦å¡«å……ï¼Œå› ä¸ºå®ƒä»¬åœ¨æ¯ä¸ªæ­¥éª¤ä¸­ï¼Œéƒ½ç›´æ¥åœ¨æ˜æ–‡éƒ¨åˆ†å’Œå†…éƒ¨å¯†ç çŠ¶æ€ä¹‹é—´æ‰§è¡Œå¼‚æˆ–ï¼ˆXORï¼‰è¿ç®—. ä½¿ç”¨ã€Œåˆ†ç»„æ¨¡å¼ã€åŠ å¯†å¤§é‡æ•°æ®çš„æµç¨‹åŸºæœ¬å¦‚ä¸‹ï¼š åˆå§‹åŒ–åŠ å¯†ç®—æ³•çŠ¶æ€ï¼ˆä½¿ç”¨åŠ å¯†å¯†é’¥ + åˆå§‹å‘é‡ IVï¼‰ åŠ å¯†æ•°æ®çš„ç¬¬ä¸€ä¸ªåˆ†ç»„ ä½¿ç”¨åŠ å¯†å¯†é’¥å’Œå…¶ä»–å‚æ•°è½¬æ¢åŠ å¯†ç®—æ³•çš„å½“å‰çŠ¶æ€ åŠ å¯†ä¸‹ä¸€ä¸ªåˆ†ç»„ å†æ¬¡è½¬æ¢åŠ å¯†çŠ¶æ€ å†åŠ å¯†ä¸‹ä¸€åˆ†ç»„ ä¾æ­¤ç±»æ¨ï¼Œç›´åˆ°å¤„ç†å®Œæ‰€æœ‰è¾“å…¥æ•°æ® è§£å¯†çš„æµç¨‹è·ŸåŠ å¯†å®Œå…¨ç±»ä¼¼ï¼šå…ˆåˆå§‹åŒ–ç®—æ³•ï¼Œç„¶åä¾æ¬¡è§£å¯†æ‰€æœ‰åˆ†ç»„ï¼Œä¸­é—´å¯èƒ½ä¼šæ¶‰åŠåˆ°åŠ å¯†çŠ¶æ€çš„è½¬æ¢ã€‚ ä¸‹é¢æˆ‘ä»¬æ¥å…·ä½“ä»‹ç»ä¸‹ CTR ä¸ GCM ä¸¤ä¸ªå¸¸è§çš„åˆ†ç»„æ¨¡å¼ã€‚ ","date":"2022-03-06","objectID":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/:4:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","å¯¹ç§°åŠ å¯†","å®‰å…¨","AES","ChaCha20"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…­ï¼‰â€”â€” å¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³•","uri":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/#ä¸‰åˆ†ç»„å¯†ç å·¥ä½œæ¨¡å¼"},{"categories":["tech"],"content":" 0. åˆå§‹å‘é‡ IVä»‹ç»å…·ä½“çš„åˆ†ç»„æ¨¡å¼å‰ï¼Œéœ€è¦å…ˆäº†è§£ä¸‹åˆå§‹å‘é‡ IVï¼ˆInitialization Vectorï¼‰è¿™ä¸ªæ¦‚å¿µï¼Œå®ƒæœ‰æ—¶ä¹Ÿè¢«ç§°ä½œ Salt æˆ–è€… Nonceã€‚åˆå§‹å‘é‡ IV é€šå¸¸æ˜¯ä¸€ä¸ªéšæœºæ•°ï¼Œä¸»è¦ä½œç”¨æ˜¯å¾€å¯†æ–‡ä¸­æ·»åŠ éšæœºæ€§ï¼Œä½¿åŒæ ·çš„æ˜æ–‡è¢«å¤šæ¬¡åŠ å¯†ä¹Ÿä¼šäº§ç”Ÿä¸åŒçš„å¯†æ–‡ï¼Œä»è€Œç¡®ä¿å¯†æ–‡çš„ä¸å¯é¢„æµ‹æ€§ã€‚ IV çš„å¤§å°åº”ä¸å¯†ç å—å¤§å°ç›¸åŒï¼Œä¾‹å¦‚ AESã€Serpent å’Œ Camellia éƒ½åªæ”¯æŒ 128 ä½å¯†ç å—ï¼Œé‚£ä¹ˆå®ƒä»¬éœ€è¦çš„ IV ä¹Ÿå¿…é¡»ä¹Ÿ 128 ä½ã€‚ IV é€šå¸¸æ— éœ€ä¿å¯†ï¼Œä½†æ˜¯åº”å½“è¶³å¤Ÿéšæœºï¼ˆæ— æ³•é¢„æµ‹ï¼‰ï¼Œè€Œä¸”ä¸å…è®¸é‡ç”¨ï¼Œåº”è¯¥å¯¹æ¯æ¡åŠ å¯†æ¶ˆæ¯ä½¿ç”¨éšæœºä¸”ä¸å¯é¢„æµ‹çš„ IVã€‚ ä¸€ä¸ªå¸¸è§é”™è¯¯æ˜¯ä½¿ç”¨ç›¸åŒçš„å¯¹ç§°å¯†é’¥å’Œç›¸åŒçš„ IV åŠ å¯†å¤šæ¡æ¶ˆæ¯ï¼Œè¿™ä½¿å¾—é’ˆå¯¹å¤§å¤šæ•°åˆ†ç»„æ¨¡å¼çš„å„ç§åŠ å¯†æ”»å‡»æˆä¸ºå¯èƒ½ã€‚ ","date":"2022-03-06","objectID":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/:4:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","å¯¹ç§°åŠ å¯†","å®‰å…¨","AES","ChaCha20"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…­ï¼‰â€”â€” å¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³•","uri":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/#0-åˆå§‹å‘é‡-iv"},{"categories":["tech"],"content":" 1. CTR (Counter) åˆ†ç»„æ¨¡å¼ å‚è€ƒæ–‡æ¡£: https://csrc.nist.gov/publications/detail/sp/800-38a/final ä¸‹å›¾è¯´æ˜äº†ã€ŒCTR åˆ†ç»„å·¥ä½œæ¨¡å¼ã€çš„åŠ å¯†è§£å¯†æµç¨‹ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯å°†æ˜æ–‡/å¯†æ–‡æ‹†åˆ†æˆä¸€ä¸ªä¸ªé•¿åº¦å›ºå®šçš„åˆ†ç»„ï¼Œç„¶åä½¿ç”¨ä¸€å®šçš„ç®—æ³•è¿›è¡ŒåŠ å¯†ä¸è§£å¯†ï¼š å¯ä»¥çœ‹åˆ°ä¸¤å›¾ä¸­å·¦è¾¹çš„ç¬¬ä¸€ä¸ªæ­¥éª¤ï¼Œæ¶‰åŠåˆ°ä¸‰ä¸ªå‚æ•°ï¼š Nonceï¼Œåˆå§‹å‘é‡ IV çš„åˆ«åï¼Œå‰é¢å·²ç»ä»‹ç»è¿‡äº†ã€‚ Counter: ä¸€ä¸ªè®¡æ•°å™¨ï¼Œæœ€å¸¸ç”¨çš„ Counter å®ç°æ˜¯ã€Œä» 0 å¼€å§‹ï¼Œæ¯æ¬¡è®¡ç®—éƒ½è‡ªå¢ 1ã€ Key: å¯¹ç§°åŠ å¯†çš„å¯†é’¥ Plaintext: æ˜æ–‡çš„ä¸€ä¸ªåˆ†ç»„ã€‚é™¤äº†æœ€åä¸€ä¸ªåˆ†ç»„å¤–ï¼Œå…¶ä»–åˆ†ç»„çš„é•¿åº¦åº”è¯¥è·Ÿ Key ç›¸åŒ CTR æ¨¡å¼åŠ è§£å¯†çš„ç®—æ³•ä½¿ç”¨å…¬å¼æ¥è¡¨ç¤ºå¦‚ä¸‹ï¼š $$ \\begin{alignedat}{2} C_i \u0026= P_i \\oplus O_i, \u0026\\text{for } i \u0026= 1, 2 â€¦ n-1 \\\\ P_i \u0026= C_i \\oplus O_i, \u0026\\text{for } i \u0026= 1, 2 â€¦ n-1 \\\\ O_i \u0026= \\text{CIPH}_{key}(\\text{Nonce} + I_i), \u0026\\text{for } i \u0026= 1, 2 â€¦ n-1 \\end{alignedat} $$ å…¬å¼çš„ç¬¦å·è¯´æ˜å¦‚ä¸‹ $C_i$ è¡¨ç¤ºå¯†æ–‡çš„ç¬¬ $i$ ä¸ªåˆ†ç»„ $P_i$ è¡¨ç¤ºæ˜æ–‡çš„ç¬¬ $i$ ä¸ª åˆ†ç»„ $O_i$ æ˜¯ä¸€ä¸ªä¸­é—´é‡ï¼Œç¬¬ä¸‰ä¸ªå…¬å¼æ˜¯å®ƒçš„è®¡ç®—æ–¹æ³• $I_i$ è¡¨ç¤ºè®¡æ•°å™¨è¿”å›çš„ç¬¬ $i$ ä¸ªå€¼ï¼Œå…¶é•¿åº¦åº”ä¸åˆ†ç»„çš„é•¿åº¦ç›¸åŒ $\\text{CIPH}_{key}$ è¡¨ç¤ºä½¿ç”¨å¯†é’¥ $key$ çš„å¯¹ç§°åŠ å¯†ç®—æ³• ä¸Šé¢çš„å…¬å¼åªæè¿°äº† $ 0 \\ge i \\le n-1$ çš„åœºæ™¯ï¼Œæœ€åä¸€ä¸ªåˆ†ç»„ $i = n$ è¦ç‰¹æ®Šä¸€äº›â€”â€”å®ƒçš„é•¿åº¦å¯èƒ½æ¯” Key è¦çŸ­ã€‚CTR æ¨¡å¼åŠ è§£å¯†è¿™æœ€åè¿™ä¸ªåˆ†ç»„æ—¶ï¼Œä¼šç›´æ¥å¿½ç•¥æ‰ $O_n$ æœ«å°¾å¤šä½™çš„ bytes. è¿™ç§å¤„ç†æ–¹å¼ä½¿å¾— CTR æ¨¡å¼ä¸éœ€è¦ä½¿ç”¨å¡«å……ç®—æ³•å¯¹æœ€åä¸€ä¸ªåˆ†ç»„è¿›è¡Œå¡«å……ï¼Œè€Œä¸”è¿˜ä½¿å¯†æ–‡è·Ÿæ˜æ–‡çš„é•¿åº¦å®Œå…¨ä¸€è‡´ã€‚æˆ‘ä»¬å‡è®¾æœ€åä¸€ä¸ªåˆ†ç»„çš„é•¿åº¦ä¸º $u$ï¼Œå®ƒçš„åŠ è§£å¯†ç®—æ³•æè¿°å¦‚ä¸‹ï¼ˆ$MSB_u(O_n)$ è¡¨ç¤ºå– $O_n$ çš„ u ä¸ªæœ€é«˜æœ‰æ•ˆä½ï¼‰ï¼š $$ \\begin{alignedat}{2} C_{n} \u0026= P_{n} \\oplus {MSB_u}(O_n) \\\\ P_{n} \u0026= C_{n} \\oplus {MSB_u}(O_n)\\\\ O_n \u0026= \\text{CIPH}_{key}(\\text{Nonce} + I_n) \\end{alignedat} $$ å¯ä»¥çœ‹åˆ°ï¼Œå› ä¸ºå¼‚æˆ– XOR çš„å¯¹ç§°æ€§ï¼ŒåŠ å¯†è·Ÿè§£å¯†çš„ç®—æ³•æ˜¯å®Œå…¨ç›¸åŒçš„ï¼Œç›´æ¥ XOR $O_i$ å³å¯ã€‚ Python ä¸­æœ€æµè¡Œçš„å¯†ç å­¦åº“æ˜¯cryptographyï¼Œrequests çš„åº•å±‚æ›¾ç»å°±ä½¿ç”¨äº†å®ƒï¼ˆæ–°ç‰ˆæœ¬å·²ç»æ¢æˆä½¿ç”¨æ ‡å‡†åº“ ssl äº†ï¼‰ï¼Œä¸‹é¢æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªåº“æ¥æ¼”ç¤ºä¸‹ AES-256-CTR ç®—æ³•ï¼š python # pip install cryptography==36.0.1 import os from cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes plaintext = b\"this is a test message, hahahahahaha~\" # ä½¿ç”¨ 32bytes çš„ keyï¼Œå³ä½¿ç”¨ç®—æ³• AES-256-CTR key = os.urandom(32) # key =\u003e b'\\x96\\xec.\\xc7\\xd5\\x1b/5\\xa1\\x10s\\x9d\\xd5\\x10z\\xdc\\x90\\xb5\\x1cm\"\u003ex\\xfd \\xd5\\xc5\\xaf\\x19\\xd1Z\\xbb' # AES ç®—æ³•çš„ block å¤§å°æ˜¯å›ºå®šçš„ 128bitsï¼Œå³ 16 bytes, IV é•¿åº¦éœ€è¦ä¸ block ä¸€è‡´ iv = os.urandom(16) # iv =\u003e b'\\x88[\\xc9\\n`\\xe4\\xc2^\\xaf\\xdc\\x1e\\xfd.c\u003e=' # 1. å‘é€æ–¹åŠ å¯†æ•°æ® ## æ„å»º AES-256-CTR çš„ cipherï¼Œç„¶ååŠ å¯†æ•°æ®ï¼Œå¾—åˆ°å¯†æ–‡ cipher = Cipher(algorithms.AES(key), modes.CTR(iv)) encryptor = cipher.encryptor() ciphertext = encryptor.update(plaintext) + encryptor.finalize() # ciphertext =\u003e b'\\x9b6(\\x1d\\xfd\\xde\\x96S\\x8b\\x8f\\x90\\xc5}ou\\x9e\\xb1\\xbd\\x9af\\xb8\\xdc\\xec\\xbf\\xa3\"\\x18^\\xac\\x14\\xc8s2*\\x1a\\xcf\\x1d' # 2. å‘é€æ–¹å°† iv + ciphertext å‘é€ç»™æ¥æ”¶æ–¹ # 3. æ¥æ”¶æ–¹è§£å¯†æ•°æ® # æ¥æ”¶æ–¹ä½¿ç”¨è‡ªå·±çš„ key + æ¥æ”¶åˆ°çš„ ivï¼Œæ„å»º cipherï¼Œç„¶åè§£å¯†å‡ºåŸå§‹æ•°æ® cipher = Cipher(algorithms.AES(key), modes.CTR(iv)) decryptor = cipher.decryptor() decryptor.update(ciphertext) + decryptor.finalize() ä»ä¸Šé¢çš„ç®—æ³•æè¿°èƒ½æ„Ÿè§‰åˆ°ï¼ŒCTR ç®—æ³•è¿˜è›®ç®€å•çš„ã€‚ä¸‹é¢æˆ‘ä½¿ç”¨ Python å†™ä¸€ä¸ªèƒ½å¤Ÿ work çš„ CTR å®ç°ï¼š python def xor_bytes(a, b): \"\"\"Returns a new byte array with the elements xor'ed. if len(a) != len(b), extra parts are discard. \"\"\" return bytes(i^j for i, j in zip(a, b)) def inc_bytes(a): \"\"\" Returns a new byte array with the value increment by 1 \"\"\" out = list(a) for i in reversed(range(len(out))): if out[i] == 0xFF: out[i] = 0 else: out[i] += 1 break return bytes(out) def split_blocks(message, block_size, require_padding=True): \"\"\" Split `message` with fixed length `block_size` \"\"\" assert len(message) % block_size == 0 or not require_padding return [message[i:i+16] for i in range(0, len(message), block_size)] def encrypt_ctr(block_cipher, plaintext, iv): \"\"\" Encrypts `plaintext` using CTR mode with the given nounce/IV. \"\"\" assert len(iv) == 16 blocks = [] nonce = iv for plaintext_block in split_blocks(plaintext, block_size=16, require_padding=False): # CTR mode encrypt: plaintext_block XOR encrypt(nonce) o = bytes(block_cipher.encrypt(nonce)) block = xor_bytes(plaintext_block, o) # extra parts of `o` are discard in this step blocks.append(block) nonce = inc_bytes(nonce) return b''.join(blocks) # åŠ å¯†ä¸è§£å¯†çš„ç®—æ³•å®Œå…¨ä¸€è‡´ decrypt_ctr = encrypt_ctr æ¥ä¸‹æ¥éªŒè¯ä¸‹ç®—æ³•çš„æ­£ç¡®æ€§ï¼š python # Python å®˜æ–¹åº“æœªæä¾› AES å®ç°ï¼Œå› æ­¤éœ€è¦å…ˆè£…ä¸‹è¿™ä¸ªåº“ï¼š # pip install pyaes==1.6.1 from pyaes import AES # AES-256-CTR - plaintext key éƒ½ä¸å‰é¢çš„æµ‹è¯•ä»£ç å®Œå…¨ä¸€è‡´ plaintext = b\"this is a test message, hahahahahaha~\" key = b'\\x96\\xec.\\xc7\\xd5\\x1b/5\\xa1\\x10s\\x9d\\xd5\\x10z\\xdc\\x90\\xb5\\x1cm\"\u003ex\\xfd \\xd5\\xc5\\xaf\\x19\\xd1Z\\xbb' # 1. å‘é€æ–¹åŠ å¯†æ•°æ® # é¦–å…ˆç”Ÿæˆä¸€ä¸ªéšæœº IVï¼Œä¸ºäº†å¯¹æ¯”ï¼Œè¿™é‡Œä½¿ç”¨å‰é¢ç”Ÿæˆå¥½çš„æ•°æ® iv = b'\\x88[\\xc9\\n`\\xe4\\xc2^\\xaf\\xdc\\x1e\\xfd.c\u003e=' aes_cipher = AES(key) ciphertext = encrypt_ctr(aes_cipher, plaintext, ","date":"2022-03-06","objectID":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/:4:2","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","å¯¹ç§°åŠ å¯†","å®‰å…¨","AES","ChaCha20"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…­ï¼‰â€”â€” å¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³•","uri":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/#counter_mode"},{"categories":["tech"],"content":" 2. GCM (Galois/Counter) åˆ†ç»„æ¨¡å¼GCM (Galois/Counter) æ¨¡å¼åœ¨ CTR æ¨¡å¼çš„åŸºç¡€ä¸Šï¼Œæ·»åŠ äº†æ¶ˆæ¯è®¤è¯çš„åŠŸèƒ½ï¼Œè€Œä¸”åŒæ—¶è¿˜å…·æœ‰ä¸ CTR æ¨¡å¼ç›¸åŒçš„å¹¶è¡Œè®¡ç®—èƒ½åŠ›ã€‚å› æ­¤ç›¸æ¯” CTR æ¨¡å¼ï¼ŒGCM ä¸ä»…é€Ÿåº¦ä¸€æ ·å¿«ï¼Œè¿˜èƒ½é¢å¤–æä¾›å¯¹æ¶ˆæ¯å®Œæ•´æ€§ã€çœŸå®æ€§çš„éªŒè¯èƒ½åŠ›ã€‚ ä¸‹å›¾ç›´è§‚åœ°è§£é‡Šäº† GCM å—æ¨¡å¼ï¼ˆGalois/Counter æ¨¡å¼ï¼‰çš„å·¥ä½œåŸç†ï¼š GCM æ¨¡å¼æ–°å¢çš„ Auth Tagï¼Œè®¡ç®—èµ·æ¥ä¼šæœ‰äº›å¤æ‚ï¼Œæˆ‘ä»¬å°±ç›´æ¥ç•¥è¿‡äº†ï¼Œå¯¹åŸç†æ„Ÿå…´è¶£çš„å¯ä»¥çœ‹ä¸‹Galois/Counter_Mode_wiki. ","date":"2022-03-06","objectID":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/:4:3","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","å¯¹ç§°åŠ å¯†","å®‰å…¨","AES","ChaCha20"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…­ï¼‰â€”â€” å¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³•","uri":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/#2-gcm-galoiscounter-åˆ†ç»„æ¨¡å¼"},{"categories":["tech"],"content":" 3. å¦‚ä½•é€‰ç”¨å—æ¨¡å¼ä¸€äº› Tips: å¸¸ç”¨çš„å®‰å…¨å—æ¨¡å¼æ˜¯ CBCï¼ˆå¯†ç å—é“¾æ¥ï¼‰ã€CTRï¼ˆè®¡æ•°å™¨ï¼‰å’Œ GCMï¼ˆä¼½ç½—ç“¦/è®¡æ•°å™¨æ¨¡å¼ï¼‰ï¼Œå®ƒä»¬éœ€è¦ä¸€ä¸ªéšæœºï¼ˆä¸å¯é¢„æµ‹çš„ï¼‰åˆå§‹åŒ–å‘é‡ (IV)ï¼Œä¹Ÿç§°ä¸º nonce æˆ– salt ã€ŒCTRï¼ˆCounterï¼‰ã€å—æ¨¡å¼åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œå› ä¸ºå®ƒå…·æœ‰å¾ˆå¼ºçš„å®‰å…¨æ€§å’Œå¹¶è¡Œå¤„ç†èƒ½åŠ›ï¼Œå…è®¸ä»»æ„è¾“å…¥æ•°æ®é•¿åº¦ï¼ˆæ— å¡«å……ï¼‰ã€‚ä½†å®ƒä¸æä¾›èº«ä»½éªŒè¯å’Œå®Œæ•´æ€§ï¼Œåªæä¾›åŠ å¯† GCMï¼ˆGalois/Counter Modeï¼‰å—æ¨¡å¼ç»§æ‰¿äº† CTR æ¨¡å¼çš„æ‰€æœ‰ä¼˜ç‚¹ï¼Œå¹¶å¢åŠ äº†åŠ å¯†æ¶ˆæ¯è®¤è¯èƒ½åŠ›ã€‚GCM æ˜¯åœ¨å¯¹ç§°å¯†ç ä¸­å®ç°è®¤è¯åŠ å¯†çš„å¿«é€Ÿæœ‰æ•ˆçš„æ–¹æ³•ï¼Œå¼ºçƒˆæ¨è CBC æ¨¡å¼åœ¨å›ºå®šå¤§å°çš„åˆ†ç»„ä¸Šå·¥ä½œã€‚å› æ­¤ï¼Œåœ¨å°†è¾“å…¥æ•°æ®æ‹†åˆ†ä¸ºåˆ†ç»„åï¼Œåº”ä½¿ç”¨å¡«å……ç®—æ³•ä½¿æœ€åä¸€ä¸ªåˆ†ç»„çš„é•¿åº¦ä¸€è‡´ã€‚å¤§å¤šæ•°åº”ç”¨ç¨‹åºä½¿ç”¨ PKCS7 å¡«å……æ–¹æ¡ˆæˆ– ANSI X.923. åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒCBC é˜»å¡æ¨¡å¼å¯èƒ½å®¹æ˜“å—åˆ°ã€Œpadding oracleã€æ”»å‡»ï¼Œå› æ­¤æœ€å¥½é¿å…ä½¿ç”¨ CBC æ¨¡å¼ ä¼—æ‰€å‘¨çŸ¥çš„ä¸å®‰å…¨å—æ¨¡å¼æ˜¯ ECBï¼ˆç”µå­å¯†ç æœ¬ï¼‰ï¼Œå®ƒå°†ç›¸ç­‰çš„è¾“å…¥å—åŠ å¯†ä¸ºç›¸ç­‰çš„è¾“å‡ºå—ï¼ˆæ— åŠ å¯†æ‰©æ•£èƒ½åŠ›ï¼‰ã€‚ä¸è¦ä½¿ç”¨ ECB å—æ¨¡å¼ï¼å®ƒå¯èƒ½ä¼šå±åŠæ•´ä¸ªåŠ å¯†æ–¹æ¡ˆã€‚ CBCã€CTR å’Œ GCM æ¨¡å¼ç­‰å¤§å¤šæ•°å—éƒ½æ”¯æŒã€Œéšæœºè®¿é—®ã€è§£å¯†ã€‚æ¯”å¦‚åœ¨è§†é¢‘æ’­æ”¾å™¨ä¸­çš„ä»»æ„æ—¶é—´åç§»å¤„å¯»æ‰¾ï¼Œæ’­æ”¾åŠ å¯†çš„è§†é¢‘æµ æ€»ä¹‹ï¼Œå»ºè®®ä½¿ç”¨ CTR (Counter) æˆ– GCM (Galois/Counter) åˆ†ç»„æ¨¡å¼ã€‚å…¶ä»–çš„åˆ†ç»„åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½ä¼šæœ‰æ‰€å¸®åŠ©ï¼Œä½†å¾ˆå¯èƒ½æœ‰å®‰å…¨éšæ‚£ï¼Œå› æ­¤é™¤éä½ å¾ˆæ¸…æ¥šè‡ªå·±åœ¨åšä»€ä¹ˆï¼Œå¦åˆ™ä¸è¦ä½¿ç”¨å…¶ä»–åˆ†ç»„æ¨¡å¼ï¼ CTR å’Œ GCM åŠ å¯†æ¨¡å¼æœ‰å¾ˆå¤šä¼˜ç‚¹ï¼šå®ƒä»¬æ˜¯å®‰å…¨çš„ï¼ˆç›®å‰æ²¡æœ‰å·²çŸ¥çš„é‡å¤§ç¼ºé™·ï¼‰ï¼Œå¯ä»¥åŠ å¯†ä»»æ„é•¿åº¦çš„æ•°æ®è€Œæ— éœ€å¡«å……ï¼Œå¯ä»¥å¹¶è¡ŒåŠ å¯†å’Œè§£å¯†åˆ†ç»„ï¼ˆåœ¨å¤šæ ¸ CPU ä¸­ï¼‰å¹¶å¯ä»¥ç›´æ¥è§£å¯†ä»»æ„ä¸€ä¸ªå¯†æ–‡åˆ†ç»„ã€‚å› æ­¤å®ƒä»¬é€‚ç”¨äºåŠ å¯†åŠ å¯†é’±åŒ…ã€æ–‡æ¡£å’Œæµè§†é¢‘ï¼ˆç”¨æˆ·å¯ä»¥æŒ‰æ—¶é—´æŸ¥æ‰¾ï¼‰ã€‚GCM è¿˜æä¾›æ¶ˆæ¯è®¤è¯ï¼Œæ˜¯ä¸€èˆ¬æƒ…å†µä¸‹å¯†ç å—æ¨¡å¼çš„æ¨èé€‰æ‹©ã€‚ è¯·æ³¨æ„ï¼ŒGCMã€CTR å’Œå…¶ä»–åˆ†ç»„æ¨¡å¼ä¼šæ³„æ¼åŸå§‹æ¶ˆæ¯çš„é•¿åº¦ï¼Œå› ä¸ºå®ƒä»¬ç”Ÿæˆçš„å¯†æ–‡é•¿åº¦ä¸æ˜æ–‡æ¶ˆæ¯çš„é•¿åº¦ç›¸åŒã€‚å¦‚æœæ‚¨æƒ³é¿å…æ³„éœ²åŸå§‹æ˜æ–‡é•¿åº¦ï¼Œå¯ä»¥åœ¨åŠ å¯†å‰å‘æ˜æ–‡æ·»åŠ ä¸€äº›éšæœºå­—èŠ‚ï¼ˆé¢å¤–çš„å¡«å……æ•°æ®ï¼‰ï¼Œå¹¶åœ¨è§£å¯†åå°†å…¶åˆ é™¤ã€‚ ","date":"2022-03-06","objectID":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/:4:4","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","å¯¹ç§°åŠ å¯†","å®‰å…¨","AES","ChaCha20"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…­ï¼‰â€”â€” å¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³•","uri":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/#3-å¦‚ä½•é€‰ç”¨å—æ¨¡å¼"},{"categories":["tech"],"content":" å››ã€å¯¹ç§°åŠ å¯†ç®—æ³•ä¸å¯¹ç§°åŠ å¯†æ–¹æ¡ˆå‰é¢å•°å—¦äº†è¿™ä¹ˆå¤šï¼Œä¸‹é¢è¿›å…¥æ­£é¢˜ï¼šå¯¹ç§°åŠ å¯†ç®—æ³• ","date":"2022-03-06","objectID":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/:5:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","å¯¹ç§°åŠ å¯†","å®‰å…¨","AES","ChaCha20"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…­ï¼‰â€”â€” å¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³•","uri":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/#å››å¯¹ç§°åŠ å¯†ç®—æ³•ä¸å¯¹ç§°åŠ å¯†æ–¹æ¡ˆ"},{"categories":["tech"],"content":" 1. å®‰å…¨çš„å¯¹ç§°åŠ å¯†ç®—æ³•ç›®å‰åº”ç”¨æœ€å¹¿æ³›çš„å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œæ˜¯ AES è·Ÿ Salsa20 / ChaCha20 è¿™ä¸¤ä¸ªç³»åˆ—ã€‚ 1. AES (Rijndael) wiki: https://en.wikipedia.org/wiki/Advanced_Encryption_Standard AESï¼ˆé«˜çº§åŠ å¯†æ ‡å‡†ï¼Œä¹Ÿç§°ä¸º Rijndaelï¼‰æ˜¯ç°ä»£ IT è¡Œä¸šä¸­æœ€æµè¡Œå’Œå¹¿æ³›ä½¿ç”¨çš„å¯¹ç§°åŠ å¯†ç®—æ³•ã€‚AES è¢«è¯æ˜æ˜¯é«˜åº¦å®‰å…¨ã€å¿«é€Ÿä¸”æ ‡å‡†åŒ–çš„ï¼Œåˆ°ç›®å‰ä¸ºæ­¢æ²¡æœ‰å‘ç°ä»»ä½•æ˜æ˜¾çš„å¼±ç‚¹æˆ–æ”»å‡»æ‰‹æ®µï¼Œè€Œä¸”å‡ ä¹åœ¨æ‰€æœ‰å¹³å°ä¸Šéƒ½å¾—åˆ°äº†å¾ˆå¥½çš„æ”¯æŒã€‚ AES æ˜¯ 128 ä½åˆ†ç»„å¯†ç ï¼Œä½¿ç”¨ 128ã€192 æˆ– 256 ä½å¯†é’¥ã€‚å®ƒé€šå¸¸ä¸åˆ†ç»„æ¨¡å¼ç»„åˆæˆåˆ†ç»„åŠ å¯†æ–¹æ¡ˆï¼ˆå¦‚ AES-CTR æˆ– AES-GCMï¼‰ä»¥å¤„ç†æµæ•°æ®ã€‚åœ¨å¤§å¤šæ•°åˆ†ç»„æ¨¡å¼ä¸­ï¼ŒAES è¿˜éœ€è¦ä¸€ä¸ªéšæœºçš„ 128 ä½åˆå§‹å‘é‡ IVã€‚ Rijndael (AES) ç®—æ³•å¯å…è´¹ç”¨äºä»»ä½•ç”¨é€”ï¼Œè€Œä¸”éå¸¸æµè¡Œã€‚å¾ˆå¤šç«™ç‚¹éƒ½é€‰æ‹© AES ä½œä¸º TLS åè®®çš„ä¸€éƒ¨åˆ†ï¼Œä»¥å®ç°å®‰å…¨é€šä¿¡ã€‚ç°ä»£ CPU ç¡¬ä»¶åŸºæœ¬éƒ½åœ¨å¾®å¤„ç†å™¨çº§åˆ«å®ç°äº† AES æŒ‡ä»¤ä»¥åŠ é€Ÿ AES åŠ å¯†è§£å¯†æ“ä½œã€‚ è¿™é‡Œæœ‰ä¸€ä¸ªçº¯ Python çš„ AES å®ç°å¯ä¾›å‚è€ƒ: AES encryption in pure Python - boppreh æˆ‘ä»¬åœ¨å‰é¢çš„ CTR åˆ†ç»„æ¨¡å¼ä¸­å·²ç»ä½¿ç”¨ Python å®è·µäº† AES-256-CTR åŠ å¯†æ–¹æ¡ˆã€‚è€Œå®é™…ä¸Šæ›´å¸¸ç”¨çš„æ˜¯æ”¯æŒé›†æˆèº«ä»½éªŒè¯åŠ å¯†ï¼ˆAEADï¼‰çš„ AES-256-GCM åŠ å¯†æ–¹æ¡ˆï¼Œå®ƒçš„ä¼˜åŠ¿æˆ‘ä»¬å‰é¢å·²ç»ä»‹ç»è¿‡äº†ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ Python æ¼”ç¤ºä¸‹å¦‚ä½•ä½¿ç”¨ï¼š python # pip install cryptography==36.0.1 import os from cryptography.hazmat.primitives.ciphers import ( Cipher, algorithms, modes ) def encrypt(key, plaintext, associated_data): # Generate a random 96-bit IV. iv = os.urandom(12) # Construct an AES-GCM Cipher object with the given key and a # randomly generated IV. encryptor = Cipher( algorithms.AES(key), modes.GCM(iv), ).encryptor() # associated_data will be authenticated but not encrypted, # it must also be passed in on decryption. encryptor.authenticate_additional_data(associated_data) # Encrypt the plaintext and get the associated ciphertext. # GCM does not require padding. ciphertext = encryptor.update(plaintext) + encryptor.finalize() return (iv, ciphertext, encryptor.tag) def decrypt(key, associated_data, iv, ciphertext, tag): # Construct a Cipher object, with the key, iv, and additionally the # GCM tag used for authenticating the message. decryptor = Cipher( algorithms.AES(key), modes.GCM(iv, tag), ).decryptor() # We put associated_data back in or the tag will fail to verify # when we finalize the decryptor. decryptor.authenticate_additional_data(associated_data) # Decryption gets us the authenticated plaintext. # If the tag does not match an InvalidTag exception will be raised. return decryptor.update(ciphertext) + decryptor.finalize() # æ¥ä¸‹æ¥è¿›è¡Œç®—æ³•éªŒè¯ plaintext = b\"this is a paintext, hahahahahaha~\" key = b'\\x96\\xec.\\xc7\\xd5\\x1b/5\\xa1\\x10s\\x9d\\xd5\\x10z\\xdc\\x90\\xb5\\x1cm\"\u003ex\\xfd \\xd5\\xc5\\xaf\\x19\\xd1Z\\xbb' associated_data = b\"authenticated but not encrypted payload\" # è¢«ç”¨äºæ¶ˆæ¯è®¤è¯çš„å…³è”æ•°æ® # 1. å‘é€æ–¹åŠ å¯†æ¶ˆæ¯ iv, ciphertext, tag = encrypt( key, plaintext, associated_data ) # 2. å‘é€æ–¹å°† associated_data iv ciphertext tag æ‰“åŒ…å‘é€ç»™æ¥æ”¶æ–¹ # 3. æ¥æ”¶æ–¹ä½¿ç”¨è‡ªå·±çš„ key éªŒè¯å¹¶è§£å¯†æ•°æ® descrypt_text = decrypt( key, associated_data, iv, ciphertext, tag ) 2. Salsa20 / ChaCha20 wiki: https://en.wikipedia.org/wiki/Salsa20#ChaCha_variant Salsa20 åŠå…¶æ”¹è¿›çš„å˜ä½“ ChaChaï¼ˆChaCha8ã€ChaCha12ã€ChaCha20ï¼‰å’Œ XSalsa20 æ˜¯ç”±å¯†ç å­¦å®¶ Daniel Bernstein è®¾è®¡çš„ç°ä»£ã€å¿«é€Ÿçš„å¯¹ç§°æµå¯†ç å®¶æ—ã€‚ Salsa20 å¯†ç æ˜¯å¯¹ç§°æµå¯†ç è®¾è®¡ç«èµ› eSTREAMï¼ˆ2004-2008ï¼‰çš„å†³èµ›é€‰æ‰‹ä¹‹ä¸€ï¼Œå®ƒéšåä¸ç›¸å…³çš„ BLAKE å“ˆå¸Œå‡½æ•°ä¸€èµ·è¢«å¹¿æ³›é‡‡ç”¨ã€‚ Salsa20 åŠå…¶å˜ä½“æ˜¯å…ç‰ˆç¨çš„ï¼Œæ²¡æœ‰ä¸“åˆ©ã€‚ Salsa20 å¯†ç å°† 128 ä½æˆ– 256 ä½å¯¹ç§°å¯†é’¥ + éšæœºç”Ÿæˆçš„ 64 ä½éšæœºæ•°ï¼ˆåˆå§‹å‘é‡ï¼‰å’Œæ— é™é•¿åº¦çš„æ•°æ®æµä½œä¸ºè¾“å…¥ï¼Œå¹¶ç”Ÿæˆé•¿åº¦ç›¸åŒçš„åŠ å¯†æ•°æ®æµä½œä¸ºè¾“å‡ºè¾“å…¥æµã€‚ ChaCha20-Poly1305Salsa20 åº”ç”¨æœ€ä¸ºå¹¿æ³›çš„æ˜¯è®¤è¯åŠ å¯†æ–¹æ¡ˆï¼šChaCha20-Poly1305ï¼Œå³ç»„åˆä½¿ç”¨ ChaCha20 ä¸æ¶ˆæ¯è®¤è¯ç®—æ³• Poly1305ï¼Œå®ƒä»¬éƒ½ç”±å¯†ç å­¦å®¶ Bernstein è®¾è®¡ã€‚ ChaCha20-Poly1305 å·²è¢«è¯æ˜è¶³å¤Ÿå®‰å…¨ï¼Œä¸è¿‡è·Ÿ GCM ä¸€æ ·å®ƒçš„å®‰å…¨æ€§ä¹Ÿä¾èµ–äºè¶³å¤Ÿéšæœºçš„åˆå§‹å‘é‡ IVï¼Œå¦å¤– ChaCha20-Poly1305 ä¹Ÿä¸å®¹æ˜“é­å—è®¡æ—¶æ”»å‡»ã€‚ ChaCha20 ç®—æ³•æ¯” AES è¦å¿«å¾—å¤šï¼Œä½†æ˜¯ç›®å‰ï¼ˆ2025 å¹´ï¼‰ä¸»æµçš„ PC ç«¯ x86_64 CPU ä¸ç§»åŠ¨ç«¯ ARM CPU åŸºæœ¬éƒ½åœ¨ç¡¬ä»¶å±‚é¢å®ç°äº† AES ç®—æ³•ï¼Œè¿™å¤§å¤§æå‡äº†è¯¥ç®—æ³•çš„æ€§èƒ½ï¼Œå› æ­¤ ChaCha20 ç®—æ³•ç›®å‰åè€Œå¹¶æ— æ€§èƒ½ä¼˜åŠ¿ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ª ChaCha20 çš„ Python ç¤ºä¾‹ï¼š python # pip install cryptography==36.0.1 import os from cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes plaintext = b\"this is a paintext, hahahahahaha~\" key = b'\\x96\\xec.\\xc7\\xd5\\x1b/5\\xa1\\x10s\\x9d\\xd5\\x10z\\xdc\\x90\\xb5\\x1cm\"\u003ex\\xfd \\xd5\\xc5\\xaf\\x19\\xd1Z\\xbb' nonce = os.urandom(16) algorithm = algorithms.ChaCha20(key, nonce) # ChaCha20 æ˜¯ä¸€ä¸ªæµå¯†ç ï¼Œmode å¿…é¡»ä¸º None cipher = Cipher(algorithm, mode=None) # 1. åŠ å¯† encryptor = cipher.encryptor() ct = encryptor.update(plaintext) # 2. è§£å¯† decryptor = cipher.decryptor() decryptor.update(ct) 3. å…¶ä»–æµè¡Œçš„å¯¹ç§°åŠ å¯†ç®—æ³•è¿˜æœ‰ä¸€äº›å…¶ä»–çš„ç°ä»£å®‰å…¨å¯¹ç§°å¯†ç ï¼Œå®ƒä»¬çš„åº”ç”¨ä¸å¦‚ AES å’Œ ChaCha20 è¿™ä¹ˆå¹¿æ³›ï¼Œä½†åœ¨ç¨‹åºå‘˜å’Œä¿¡æ¯å®‰å…¨ç¤¾åŒºä¸­ä»ç„¶å¾ˆæµè¡Œï¼š Serpent - å®‰å…¨å¯¹ç§°å¯†é’¥åˆ†ç»„å¯†ç ï¼ˆå¯†é’¥å¤§å°ï¼š128ã€192 æˆ– 256 ä½ï¼‰ï¼Œå…¬ä¼—æ‰€æœ‰ï¼ˆPublic Domainï¼‰ï¼Œå®Œå…¨å…è´¹ Twofish - å®‰å…¨å¯¹ç§°å¯†é’¥åˆ†ç»„å¯†ç ï¼ˆå¯†é’¥å¤§å°ï¼š128ã€192 æˆ– 256 ä½ï¼‰ï¼Œå…¬ä¼—æ‰€æœ‰ï¼ˆPublic Domainï¼‰ï¼Œå®Œå…¨å…è´¹ Camellia - å®‰å…¨å¯¹ç§°å¯†é’¥åˆ†ç»„å¯†ç ï¼ˆåˆ†ç»„å¤§å°ï¼š128 ä½ï¼›å¯†é’¥","date":"2022-03-06","objectID":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/:5:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","å¯¹ç§°åŠ å¯†","å®‰å…¨","AES","ChaCha20"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…­ï¼‰â€”â€” å¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³•","uri":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/#1-å®‰å…¨çš„å¯¹ç§°åŠ å¯†ç®—æ³•"},{"categories":["tech"],"content":" 1. å®‰å…¨çš„å¯¹ç§°åŠ å¯†ç®—æ³•ç›®å‰åº”ç”¨æœ€å¹¿æ³›çš„å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œæ˜¯ AES è·Ÿ Salsa20 / ChaCha20 è¿™ä¸¤ä¸ªç³»åˆ—ã€‚ 1. AES (Rijndael) wiki: https://en.wikipedia.org/wiki/Advanced_Encryption_Standard AESï¼ˆé«˜çº§åŠ å¯†æ ‡å‡†ï¼Œä¹Ÿç§°ä¸º Rijndaelï¼‰æ˜¯ç°ä»£ IT è¡Œä¸šä¸­æœ€æµè¡Œå’Œå¹¿æ³›ä½¿ç”¨çš„å¯¹ç§°åŠ å¯†ç®—æ³•ã€‚AES è¢«è¯æ˜æ˜¯é«˜åº¦å®‰å…¨ã€å¿«é€Ÿä¸”æ ‡å‡†åŒ–çš„ï¼Œåˆ°ç›®å‰ä¸ºæ­¢æ²¡æœ‰å‘ç°ä»»ä½•æ˜æ˜¾çš„å¼±ç‚¹æˆ–æ”»å‡»æ‰‹æ®µï¼Œè€Œä¸”å‡ ä¹åœ¨æ‰€æœ‰å¹³å°ä¸Šéƒ½å¾—åˆ°äº†å¾ˆå¥½çš„æ”¯æŒã€‚ AES æ˜¯ 128 ä½åˆ†ç»„å¯†ç ï¼Œä½¿ç”¨ 128ã€192 æˆ– 256 ä½å¯†é’¥ã€‚å®ƒé€šå¸¸ä¸åˆ†ç»„æ¨¡å¼ç»„åˆæˆåˆ†ç»„åŠ å¯†æ–¹æ¡ˆï¼ˆå¦‚ AES-CTR æˆ– AES-GCMï¼‰ä»¥å¤„ç†æµæ•°æ®ã€‚åœ¨å¤§å¤šæ•°åˆ†ç»„æ¨¡å¼ä¸­ï¼ŒAES è¿˜éœ€è¦ä¸€ä¸ªéšæœºçš„ 128 ä½åˆå§‹å‘é‡ IVã€‚ Rijndael (AES) ç®—æ³•å¯å…è´¹ç”¨äºä»»ä½•ç”¨é€”ï¼Œè€Œä¸”éå¸¸æµè¡Œã€‚å¾ˆå¤šç«™ç‚¹éƒ½é€‰æ‹© AES ä½œä¸º TLS åè®®çš„ä¸€éƒ¨åˆ†ï¼Œä»¥å®ç°å®‰å…¨é€šä¿¡ã€‚ç°ä»£ CPU ç¡¬ä»¶åŸºæœ¬éƒ½åœ¨å¾®å¤„ç†å™¨çº§åˆ«å®ç°äº† AES æŒ‡ä»¤ä»¥åŠ é€Ÿ AES åŠ å¯†è§£å¯†æ“ä½œã€‚ è¿™é‡Œæœ‰ä¸€ä¸ªçº¯ Python çš„ AES å®ç°å¯ä¾›å‚è€ƒ: AES encryption in pure Python - boppreh æˆ‘ä»¬åœ¨å‰é¢çš„ CTR åˆ†ç»„æ¨¡å¼ä¸­å·²ç»ä½¿ç”¨ Python å®è·µäº† AES-256-CTR åŠ å¯†æ–¹æ¡ˆã€‚è€Œå®é™…ä¸Šæ›´å¸¸ç”¨çš„æ˜¯æ”¯æŒé›†æˆèº«ä»½éªŒè¯åŠ å¯†ï¼ˆAEADï¼‰çš„ AES-256-GCM åŠ å¯†æ–¹æ¡ˆï¼Œå®ƒçš„ä¼˜åŠ¿æˆ‘ä»¬å‰é¢å·²ç»ä»‹ç»è¿‡äº†ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ Python æ¼”ç¤ºä¸‹å¦‚ä½•ä½¿ç”¨ï¼š python # pip install cryptography==36.0.1 import os from cryptography.hazmat.primitives.ciphers import ( Cipher, algorithms, modes ) def encrypt(key, plaintext, associated_data): # Generate a random 96-bit IV. iv = os.urandom(12) # Construct an AES-GCM Cipher object with the given key and a # randomly generated IV. encryptor = Cipher( algorithms.AES(key), modes.GCM(iv), ).encryptor() # associated_data will be authenticated but not encrypted, # it must also be passed in on decryption. encryptor.authenticate_additional_data(associated_data) # Encrypt the plaintext and get the associated ciphertext. # GCM does not require padding. ciphertext = encryptor.update(plaintext) + encryptor.finalize() return (iv, ciphertext, encryptor.tag) def decrypt(key, associated_data, iv, ciphertext, tag): # Construct a Cipher object, with the key, iv, and additionally the # GCM tag used for authenticating the message. decryptor = Cipher( algorithms.AES(key), modes.GCM(iv, tag), ).decryptor() # We put associated_data back in or the tag will fail to verify # when we finalize the decryptor. decryptor.authenticate_additional_data(associated_data) # Decryption gets us the authenticated plaintext. # If the tag does not match an InvalidTag exception will be raised. return decryptor.update(ciphertext) + decryptor.finalize() # æ¥ä¸‹æ¥è¿›è¡Œç®—æ³•éªŒè¯ plaintext = b\"this is a paintext, hahahahahaha~\" key = b'\\x96\\xec.\\xc7\\xd5\\x1b/5\\xa1\\x10s\\x9d\\xd5\\x10z\\xdc\\x90\\xb5\\x1cm\"\u003ex\\xfd \\xd5\\xc5\\xaf\\x19\\xd1Z\\xbb' associated_data = b\"authenticated but not encrypted payload\" # è¢«ç”¨äºæ¶ˆæ¯è®¤è¯çš„å…³è”æ•°æ® # 1. å‘é€æ–¹åŠ å¯†æ¶ˆæ¯ iv, ciphertext, tag = encrypt( key, plaintext, associated_data ) # 2. å‘é€æ–¹å°† associated_data iv ciphertext tag æ‰“åŒ…å‘é€ç»™æ¥æ”¶æ–¹ # 3. æ¥æ”¶æ–¹ä½¿ç”¨è‡ªå·±çš„ key éªŒè¯å¹¶è§£å¯†æ•°æ® descrypt_text = decrypt( key, associated_data, iv, ciphertext, tag ) 2. Salsa20 / ChaCha20 wiki: https://en.wikipedia.org/wiki/Salsa20#ChaCha_variant Salsa20 åŠå…¶æ”¹è¿›çš„å˜ä½“ ChaChaï¼ˆChaCha8ã€ChaCha12ã€ChaCha20ï¼‰å’Œ XSalsa20 æ˜¯ç”±å¯†ç å­¦å®¶ Daniel Bernstein è®¾è®¡çš„ç°ä»£ã€å¿«é€Ÿçš„å¯¹ç§°æµå¯†ç å®¶æ—ã€‚ Salsa20 å¯†ç æ˜¯å¯¹ç§°æµå¯†ç è®¾è®¡ç«èµ› eSTREAMï¼ˆ2004-2008ï¼‰çš„å†³èµ›é€‰æ‰‹ä¹‹ä¸€ï¼Œå®ƒéšåä¸ç›¸å…³çš„ BLAKE å“ˆå¸Œå‡½æ•°ä¸€èµ·è¢«å¹¿æ³›é‡‡ç”¨ã€‚ Salsa20 åŠå…¶å˜ä½“æ˜¯å…ç‰ˆç¨çš„ï¼Œæ²¡æœ‰ä¸“åˆ©ã€‚ Salsa20 å¯†ç å°† 128 ä½æˆ– 256 ä½å¯¹ç§°å¯†é’¥ + éšæœºç”Ÿæˆçš„ 64 ä½éšæœºæ•°ï¼ˆåˆå§‹å‘é‡ï¼‰å’Œæ— é™é•¿åº¦çš„æ•°æ®æµä½œä¸ºè¾“å…¥ï¼Œå¹¶ç”Ÿæˆé•¿åº¦ç›¸åŒçš„åŠ å¯†æ•°æ®æµä½œä¸ºè¾“å‡ºè¾“å…¥æµã€‚ ChaCha20-Poly1305Salsa20 åº”ç”¨æœ€ä¸ºå¹¿æ³›çš„æ˜¯è®¤è¯åŠ å¯†æ–¹æ¡ˆï¼šChaCha20-Poly1305ï¼Œå³ç»„åˆä½¿ç”¨ ChaCha20 ä¸æ¶ˆæ¯è®¤è¯ç®—æ³• Poly1305ï¼Œå®ƒä»¬éƒ½ç”±å¯†ç å­¦å®¶ Bernstein è®¾è®¡ã€‚ ChaCha20-Poly1305 å·²è¢«è¯æ˜è¶³å¤Ÿå®‰å…¨ï¼Œä¸è¿‡è·Ÿ GCM ä¸€æ ·å®ƒçš„å®‰å…¨æ€§ä¹Ÿä¾èµ–äºè¶³å¤Ÿéšæœºçš„åˆå§‹å‘é‡ IVï¼Œå¦å¤– ChaCha20-Poly1305 ä¹Ÿä¸å®¹æ˜“é­å—è®¡æ—¶æ”»å‡»ã€‚ ChaCha20 ç®—æ³•æ¯” AES è¦å¿«å¾—å¤šï¼Œä½†æ˜¯ç›®å‰ï¼ˆ2025 å¹´ï¼‰ä¸»æµçš„ PC ç«¯ x86_64 CPU ä¸ç§»åŠ¨ç«¯ ARM CPU åŸºæœ¬éƒ½åœ¨ç¡¬ä»¶å±‚é¢å®ç°äº† AES ç®—æ³•ï¼Œè¿™å¤§å¤§æå‡äº†è¯¥ç®—æ³•çš„æ€§èƒ½ï¼Œå› æ­¤ ChaCha20 ç®—æ³•ç›®å‰åè€Œå¹¶æ— æ€§èƒ½ä¼˜åŠ¿ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ª ChaCha20 çš„ Python ç¤ºä¾‹ï¼š python # pip install cryptography==36.0.1 import os from cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes plaintext = b\"this is a paintext, hahahahahaha~\" key = b'\\x96\\xec.\\xc7\\xd5\\x1b/5\\xa1\\x10s\\x9d\\xd5\\x10z\\xdc\\x90\\xb5\\x1cm\"\u003ex\\xfd \\xd5\\xc5\\xaf\\x19\\xd1Z\\xbb' nonce = os.urandom(16) algorithm = algorithms.ChaCha20(key, nonce) # ChaCha20 æ˜¯ä¸€ä¸ªæµå¯†ç ï¼Œmode å¿…é¡»ä¸º None cipher = Cipher(algorithm, mode=None) # 1. åŠ å¯† encryptor = cipher.encryptor() ct = encryptor.update(plaintext) # 2. è§£å¯† decryptor = cipher.decryptor() decryptor.update(ct) 3. å…¶ä»–æµè¡Œçš„å¯¹ç§°åŠ å¯†ç®—æ³•è¿˜æœ‰ä¸€äº›å…¶ä»–çš„ç°ä»£å®‰å…¨å¯¹ç§°å¯†ç ï¼Œå®ƒä»¬çš„åº”ç”¨ä¸å¦‚ AES å’Œ ChaCha20 è¿™ä¹ˆå¹¿æ³›ï¼Œä½†åœ¨ç¨‹åºå‘˜å’Œä¿¡æ¯å®‰å…¨ç¤¾åŒºä¸­ä»ç„¶å¾ˆæµè¡Œï¼š Serpent - å®‰å…¨å¯¹ç§°å¯†é’¥åˆ†ç»„å¯†ç ï¼ˆå¯†é’¥å¤§å°ï¼š128ã€192 æˆ– 256 ä½ï¼‰ï¼Œå…¬ä¼—æ‰€æœ‰ï¼ˆPublic Domainï¼‰ï¼Œå®Œå…¨å…è´¹ Twofish - å®‰å…¨å¯¹ç§°å¯†é’¥åˆ†ç»„å¯†ç ï¼ˆå¯†é’¥å¤§å°ï¼š128ã€192 æˆ– 256 ä½ï¼‰ï¼Œå…¬ä¼—æ‰€æœ‰ï¼ˆPublic Domainï¼‰ï¼Œå®Œå…¨å…è´¹ Camellia - å®‰å…¨å¯¹ç§°å¯†é’¥åˆ†ç»„å¯†ç ï¼ˆåˆ†ç»„å¤§å°ï¼š128 ä½ï¼›å¯†é’¥","date":"2022-03-06","objectID":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/:5:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","å¯¹ç§°åŠ å¯†","å®‰å…¨","AES","ChaCha20"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…­ï¼‰â€”â€” å¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³•","uri":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/#1-aes-rijndael"},{"categories":["tech"],"content":" 1. å®‰å…¨çš„å¯¹ç§°åŠ å¯†ç®—æ³•ç›®å‰åº”ç”¨æœ€å¹¿æ³›çš„å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œæ˜¯ AES è·Ÿ Salsa20 / ChaCha20 è¿™ä¸¤ä¸ªç³»åˆ—ã€‚ 1. AES (Rijndael) wiki: https://en.wikipedia.org/wiki/Advanced_Encryption_Standard AESï¼ˆé«˜çº§åŠ å¯†æ ‡å‡†ï¼Œä¹Ÿç§°ä¸º Rijndaelï¼‰æ˜¯ç°ä»£ IT è¡Œä¸šä¸­æœ€æµè¡Œå’Œå¹¿æ³›ä½¿ç”¨çš„å¯¹ç§°åŠ å¯†ç®—æ³•ã€‚AES è¢«è¯æ˜æ˜¯é«˜åº¦å®‰å…¨ã€å¿«é€Ÿä¸”æ ‡å‡†åŒ–çš„ï¼Œåˆ°ç›®å‰ä¸ºæ­¢æ²¡æœ‰å‘ç°ä»»ä½•æ˜æ˜¾çš„å¼±ç‚¹æˆ–æ”»å‡»æ‰‹æ®µï¼Œè€Œä¸”å‡ ä¹åœ¨æ‰€æœ‰å¹³å°ä¸Šéƒ½å¾—åˆ°äº†å¾ˆå¥½çš„æ”¯æŒã€‚ AES æ˜¯ 128 ä½åˆ†ç»„å¯†ç ï¼Œä½¿ç”¨ 128ã€192 æˆ– 256 ä½å¯†é’¥ã€‚å®ƒé€šå¸¸ä¸åˆ†ç»„æ¨¡å¼ç»„åˆæˆåˆ†ç»„åŠ å¯†æ–¹æ¡ˆï¼ˆå¦‚ AES-CTR æˆ– AES-GCMï¼‰ä»¥å¤„ç†æµæ•°æ®ã€‚åœ¨å¤§å¤šæ•°åˆ†ç»„æ¨¡å¼ä¸­ï¼ŒAES è¿˜éœ€è¦ä¸€ä¸ªéšæœºçš„ 128 ä½åˆå§‹å‘é‡ IVã€‚ Rijndael (AES) ç®—æ³•å¯å…è´¹ç”¨äºä»»ä½•ç”¨é€”ï¼Œè€Œä¸”éå¸¸æµè¡Œã€‚å¾ˆå¤šç«™ç‚¹éƒ½é€‰æ‹© AES ä½œä¸º TLS åè®®çš„ä¸€éƒ¨åˆ†ï¼Œä»¥å®ç°å®‰å…¨é€šä¿¡ã€‚ç°ä»£ CPU ç¡¬ä»¶åŸºæœ¬éƒ½åœ¨å¾®å¤„ç†å™¨çº§åˆ«å®ç°äº† AES æŒ‡ä»¤ä»¥åŠ é€Ÿ AES åŠ å¯†è§£å¯†æ“ä½œã€‚ è¿™é‡Œæœ‰ä¸€ä¸ªçº¯ Python çš„ AES å®ç°å¯ä¾›å‚è€ƒ: AES encryption in pure Python - boppreh æˆ‘ä»¬åœ¨å‰é¢çš„ CTR åˆ†ç»„æ¨¡å¼ä¸­å·²ç»ä½¿ç”¨ Python å®è·µäº† AES-256-CTR åŠ å¯†æ–¹æ¡ˆã€‚è€Œå®é™…ä¸Šæ›´å¸¸ç”¨çš„æ˜¯æ”¯æŒé›†æˆèº«ä»½éªŒè¯åŠ å¯†ï¼ˆAEADï¼‰çš„ AES-256-GCM åŠ å¯†æ–¹æ¡ˆï¼Œå®ƒçš„ä¼˜åŠ¿æˆ‘ä»¬å‰é¢å·²ç»ä»‹ç»è¿‡äº†ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ Python æ¼”ç¤ºä¸‹å¦‚ä½•ä½¿ç”¨ï¼š python # pip install cryptography==36.0.1 import os from cryptography.hazmat.primitives.ciphers import ( Cipher, algorithms, modes ) def encrypt(key, plaintext, associated_data): # Generate a random 96-bit IV. iv = os.urandom(12) # Construct an AES-GCM Cipher object with the given key and a # randomly generated IV. encryptor = Cipher( algorithms.AES(key), modes.GCM(iv), ).encryptor() # associated_data will be authenticated but not encrypted, # it must also be passed in on decryption. encryptor.authenticate_additional_data(associated_data) # Encrypt the plaintext and get the associated ciphertext. # GCM does not require padding. ciphertext = encryptor.update(plaintext) + encryptor.finalize() return (iv, ciphertext, encryptor.tag) def decrypt(key, associated_data, iv, ciphertext, tag): # Construct a Cipher object, with the key, iv, and additionally the # GCM tag used for authenticating the message. decryptor = Cipher( algorithms.AES(key), modes.GCM(iv, tag), ).decryptor() # We put associated_data back in or the tag will fail to verify # when we finalize the decryptor. decryptor.authenticate_additional_data(associated_data) # Decryption gets us the authenticated plaintext. # If the tag does not match an InvalidTag exception will be raised. return decryptor.update(ciphertext) + decryptor.finalize() # æ¥ä¸‹æ¥è¿›è¡Œç®—æ³•éªŒè¯ plaintext = b\"this is a paintext, hahahahahaha~\" key = b'\\x96\\xec.\\xc7\\xd5\\x1b/5\\xa1\\x10s\\x9d\\xd5\\x10z\\xdc\\x90\\xb5\\x1cm\"\u003ex\\xfd \\xd5\\xc5\\xaf\\x19\\xd1Z\\xbb' associated_data = b\"authenticated but not encrypted payload\" # è¢«ç”¨äºæ¶ˆæ¯è®¤è¯çš„å…³è”æ•°æ® # 1. å‘é€æ–¹åŠ å¯†æ¶ˆæ¯ iv, ciphertext, tag = encrypt( key, plaintext, associated_data ) # 2. å‘é€æ–¹å°† associated_data iv ciphertext tag æ‰“åŒ…å‘é€ç»™æ¥æ”¶æ–¹ # 3. æ¥æ”¶æ–¹ä½¿ç”¨è‡ªå·±çš„ key éªŒè¯å¹¶è§£å¯†æ•°æ® descrypt_text = decrypt( key, associated_data, iv, ciphertext, tag ) 2. Salsa20 / ChaCha20 wiki: https://en.wikipedia.org/wiki/Salsa20#ChaCha_variant Salsa20 åŠå…¶æ”¹è¿›çš„å˜ä½“ ChaChaï¼ˆChaCha8ã€ChaCha12ã€ChaCha20ï¼‰å’Œ XSalsa20 æ˜¯ç”±å¯†ç å­¦å®¶ Daniel Bernstein è®¾è®¡çš„ç°ä»£ã€å¿«é€Ÿçš„å¯¹ç§°æµå¯†ç å®¶æ—ã€‚ Salsa20 å¯†ç æ˜¯å¯¹ç§°æµå¯†ç è®¾è®¡ç«èµ› eSTREAMï¼ˆ2004-2008ï¼‰çš„å†³èµ›é€‰æ‰‹ä¹‹ä¸€ï¼Œå®ƒéšåä¸ç›¸å…³çš„ BLAKE å“ˆå¸Œå‡½æ•°ä¸€èµ·è¢«å¹¿æ³›é‡‡ç”¨ã€‚ Salsa20 åŠå…¶å˜ä½“æ˜¯å…ç‰ˆç¨çš„ï¼Œæ²¡æœ‰ä¸“åˆ©ã€‚ Salsa20 å¯†ç å°† 128 ä½æˆ– 256 ä½å¯¹ç§°å¯†é’¥ + éšæœºç”Ÿæˆçš„ 64 ä½éšæœºæ•°ï¼ˆåˆå§‹å‘é‡ï¼‰å’Œæ— é™é•¿åº¦çš„æ•°æ®æµä½œä¸ºè¾“å…¥ï¼Œå¹¶ç”Ÿæˆé•¿åº¦ç›¸åŒçš„åŠ å¯†æ•°æ®æµä½œä¸ºè¾“å‡ºè¾“å…¥æµã€‚ ChaCha20-Poly1305Salsa20 åº”ç”¨æœ€ä¸ºå¹¿æ³›çš„æ˜¯è®¤è¯åŠ å¯†æ–¹æ¡ˆï¼šChaCha20-Poly1305ï¼Œå³ç»„åˆä½¿ç”¨ ChaCha20 ä¸æ¶ˆæ¯è®¤è¯ç®—æ³• Poly1305ï¼Œå®ƒä»¬éƒ½ç”±å¯†ç å­¦å®¶ Bernstein è®¾è®¡ã€‚ ChaCha20-Poly1305 å·²è¢«è¯æ˜è¶³å¤Ÿå®‰å…¨ï¼Œä¸è¿‡è·Ÿ GCM ä¸€æ ·å®ƒçš„å®‰å…¨æ€§ä¹Ÿä¾èµ–äºè¶³å¤Ÿéšæœºçš„åˆå§‹å‘é‡ IVï¼Œå¦å¤– ChaCha20-Poly1305 ä¹Ÿä¸å®¹æ˜“é­å—è®¡æ—¶æ”»å‡»ã€‚ ChaCha20 ç®—æ³•æ¯” AES è¦å¿«å¾—å¤šï¼Œä½†æ˜¯ç›®å‰ï¼ˆ2025 å¹´ï¼‰ä¸»æµçš„ PC ç«¯ x86_64 CPU ä¸ç§»åŠ¨ç«¯ ARM CPU åŸºæœ¬éƒ½åœ¨ç¡¬ä»¶å±‚é¢å®ç°äº† AES ç®—æ³•ï¼Œè¿™å¤§å¤§æå‡äº†è¯¥ç®—æ³•çš„æ€§èƒ½ï¼Œå› æ­¤ ChaCha20 ç®—æ³•ç›®å‰åè€Œå¹¶æ— æ€§èƒ½ä¼˜åŠ¿ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ª ChaCha20 çš„ Python ç¤ºä¾‹ï¼š python # pip install cryptography==36.0.1 import os from cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes plaintext = b\"this is a paintext, hahahahahaha~\" key = b'\\x96\\xec.\\xc7\\xd5\\x1b/5\\xa1\\x10s\\x9d\\xd5\\x10z\\xdc\\x90\\xb5\\x1cm\"\u003ex\\xfd \\xd5\\xc5\\xaf\\x19\\xd1Z\\xbb' nonce = os.urandom(16) algorithm = algorithms.ChaCha20(key, nonce) # ChaCha20 æ˜¯ä¸€ä¸ªæµå¯†ç ï¼Œmode å¿…é¡»ä¸º None cipher = Cipher(algorithm, mode=None) # 1. åŠ å¯† encryptor = cipher.encryptor() ct = encryptor.update(plaintext) # 2. è§£å¯† decryptor = cipher.decryptor() decryptor.update(ct) 3. å…¶ä»–æµè¡Œçš„å¯¹ç§°åŠ å¯†ç®—æ³•è¿˜æœ‰ä¸€äº›å…¶ä»–çš„ç°ä»£å®‰å…¨å¯¹ç§°å¯†ç ï¼Œå®ƒä»¬çš„åº”ç”¨ä¸å¦‚ AES å’Œ ChaCha20 è¿™ä¹ˆå¹¿æ³›ï¼Œä½†åœ¨ç¨‹åºå‘˜å’Œä¿¡æ¯å®‰å…¨ç¤¾åŒºä¸­ä»ç„¶å¾ˆæµè¡Œï¼š Serpent - å®‰å…¨å¯¹ç§°å¯†é’¥åˆ†ç»„å¯†ç ï¼ˆå¯†é’¥å¤§å°ï¼š128ã€192 æˆ– 256 ä½ï¼‰ï¼Œå…¬ä¼—æ‰€æœ‰ï¼ˆPublic Domainï¼‰ï¼Œå®Œå…¨å…è´¹ Twofish - å®‰å…¨å¯¹ç§°å¯†é’¥åˆ†ç»„å¯†ç ï¼ˆå¯†é’¥å¤§å°ï¼š128ã€192 æˆ– 256 ä½ï¼‰ï¼Œå…¬ä¼—æ‰€æœ‰ï¼ˆPublic Domainï¼‰ï¼Œå®Œå…¨å…è´¹ Camellia - å®‰å…¨å¯¹ç§°å¯†é’¥åˆ†ç»„å¯†ç ï¼ˆåˆ†ç»„å¤§å°ï¼š128 ä½ï¼›å¯†é’¥","date":"2022-03-06","objectID":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/:5:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","å¯¹ç§°åŠ å¯†","å®‰å…¨","AES","ChaCha20"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…­ï¼‰â€”â€” å¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³•","uri":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/#2-salsa20--chacha20"},{"categories":["tech"],"content":" 1. å®‰å…¨çš„å¯¹ç§°åŠ å¯†ç®—æ³•ç›®å‰åº”ç”¨æœ€å¹¿æ³›çš„å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œæ˜¯ AES è·Ÿ Salsa20 / ChaCha20 è¿™ä¸¤ä¸ªç³»åˆ—ã€‚ 1. AES (Rijndael) wiki: https://en.wikipedia.org/wiki/Advanced_Encryption_Standard AESï¼ˆé«˜çº§åŠ å¯†æ ‡å‡†ï¼Œä¹Ÿç§°ä¸º Rijndaelï¼‰æ˜¯ç°ä»£ IT è¡Œä¸šä¸­æœ€æµè¡Œå’Œå¹¿æ³›ä½¿ç”¨çš„å¯¹ç§°åŠ å¯†ç®—æ³•ã€‚AES è¢«è¯æ˜æ˜¯é«˜åº¦å®‰å…¨ã€å¿«é€Ÿä¸”æ ‡å‡†åŒ–çš„ï¼Œåˆ°ç›®å‰ä¸ºæ­¢æ²¡æœ‰å‘ç°ä»»ä½•æ˜æ˜¾çš„å¼±ç‚¹æˆ–æ”»å‡»æ‰‹æ®µï¼Œè€Œä¸”å‡ ä¹åœ¨æ‰€æœ‰å¹³å°ä¸Šéƒ½å¾—åˆ°äº†å¾ˆå¥½çš„æ”¯æŒã€‚ AES æ˜¯ 128 ä½åˆ†ç»„å¯†ç ï¼Œä½¿ç”¨ 128ã€192 æˆ– 256 ä½å¯†é’¥ã€‚å®ƒé€šå¸¸ä¸åˆ†ç»„æ¨¡å¼ç»„åˆæˆåˆ†ç»„åŠ å¯†æ–¹æ¡ˆï¼ˆå¦‚ AES-CTR æˆ– AES-GCMï¼‰ä»¥å¤„ç†æµæ•°æ®ã€‚åœ¨å¤§å¤šæ•°åˆ†ç»„æ¨¡å¼ä¸­ï¼ŒAES è¿˜éœ€è¦ä¸€ä¸ªéšæœºçš„ 128 ä½åˆå§‹å‘é‡ IVã€‚ Rijndael (AES) ç®—æ³•å¯å…è´¹ç”¨äºä»»ä½•ç”¨é€”ï¼Œè€Œä¸”éå¸¸æµè¡Œã€‚å¾ˆå¤šç«™ç‚¹éƒ½é€‰æ‹© AES ä½œä¸º TLS åè®®çš„ä¸€éƒ¨åˆ†ï¼Œä»¥å®ç°å®‰å…¨é€šä¿¡ã€‚ç°ä»£ CPU ç¡¬ä»¶åŸºæœ¬éƒ½åœ¨å¾®å¤„ç†å™¨çº§åˆ«å®ç°äº† AES æŒ‡ä»¤ä»¥åŠ é€Ÿ AES åŠ å¯†è§£å¯†æ“ä½œã€‚ è¿™é‡Œæœ‰ä¸€ä¸ªçº¯ Python çš„ AES å®ç°å¯ä¾›å‚è€ƒ: AES encryption in pure Python - boppreh æˆ‘ä»¬åœ¨å‰é¢çš„ CTR åˆ†ç»„æ¨¡å¼ä¸­å·²ç»ä½¿ç”¨ Python å®è·µäº† AES-256-CTR åŠ å¯†æ–¹æ¡ˆã€‚è€Œå®é™…ä¸Šæ›´å¸¸ç”¨çš„æ˜¯æ”¯æŒé›†æˆèº«ä»½éªŒè¯åŠ å¯†ï¼ˆAEADï¼‰çš„ AES-256-GCM åŠ å¯†æ–¹æ¡ˆï¼Œå®ƒçš„ä¼˜åŠ¿æˆ‘ä»¬å‰é¢å·²ç»ä»‹ç»è¿‡äº†ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ Python æ¼”ç¤ºä¸‹å¦‚ä½•ä½¿ç”¨ï¼š python # pip install cryptography==36.0.1 import os from cryptography.hazmat.primitives.ciphers import ( Cipher, algorithms, modes ) def encrypt(key, plaintext, associated_data): # Generate a random 96-bit IV. iv = os.urandom(12) # Construct an AES-GCM Cipher object with the given key and a # randomly generated IV. encryptor = Cipher( algorithms.AES(key), modes.GCM(iv), ).encryptor() # associated_data will be authenticated but not encrypted, # it must also be passed in on decryption. encryptor.authenticate_additional_data(associated_data) # Encrypt the plaintext and get the associated ciphertext. # GCM does not require padding. ciphertext = encryptor.update(plaintext) + encryptor.finalize() return (iv, ciphertext, encryptor.tag) def decrypt(key, associated_data, iv, ciphertext, tag): # Construct a Cipher object, with the key, iv, and additionally the # GCM tag used for authenticating the message. decryptor = Cipher( algorithms.AES(key), modes.GCM(iv, tag), ).decryptor() # We put associated_data back in or the tag will fail to verify # when we finalize the decryptor. decryptor.authenticate_additional_data(associated_data) # Decryption gets us the authenticated plaintext. # If the tag does not match an InvalidTag exception will be raised. return decryptor.update(ciphertext) + decryptor.finalize() # æ¥ä¸‹æ¥è¿›è¡Œç®—æ³•éªŒè¯ plaintext = b\"this is a paintext, hahahahahaha~\" key = b'\\x96\\xec.\\xc7\\xd5\\x1b/5\\xa1\\x10s\\x9d\\xd5\\x10z\\xdc\\x90\\xb5\\x1cm\"\u003ex\\xfd \\xd5\\xc5\\xaf\\x19\\xd1Z\\xbb' associated_data = b\"authenticated but not encrypted payload\" # è¢«ç”¨äºæ¶ˆæ¯è®¤è¯çš„å…³è”æ•°æ® # 1. å‘é€æ–¹åŠ å¯†æ¶ˆæ¯ iv, ciphertext, tag = encrypt( key, plaintext, associated_data ) # 2. å‘é€æ–¹å°† associated_data iv ciphertext tag æ‰“åŒ…å‘é€ç»™æ¥æ”¶æ–¹ # 3. æ¥æ”¶æ–¹ä½¿ç”¨è‡ªå·±çš„ key éªŒè¯å¹¶è§£å¯†æ•°æ® descrypt_text = decrypt( key, associated_data, iv, ciphertext, tag ) 2. Salsa20 / ChaCha20 wiki: https://en.wikipedia.org/wiki/Salsa20#ChaCha_variant Salsa20 åŠå…¶æ”¹è¿›çš„å˜ä½“ ChaChaï¼ˆChaCha8ã€ChaCha12ã€ChaCha20ï¼‰å’Œ XSalsa20 æ˜¯ç”±å¯†ç å­¦å®¶ Daniel Bernstein è®¾è®¡çš„ç°ä»£ã€å¿«é€Ÿçš„å¯¹ç§°æµå¯†ç å®¶æ—ã€‚ Salsa20 å¯†ç æ˜¯å¯¹ç§°æµå¯†ç è®¾è®¡ç«èµ› eSTREAMï¼ˆ2004-2008ï¼‰çš„å†³èµ›é€‰æ‰‹ä¹‹ä¸€ï¼Œå®ƒéšåä¸ç›¸å…³çš„ BLAKE å“ˆå¸Œå‡½æ•°ä¸€èµ·è¢«å¹¿æ³›é‡‡ç”¨ã€‚ Salsa20 åŠå…¶å˜ä½“æ˜¯å…ç‰ˆç¨çš„ï¼Œæ²¡æœ‰ä¸“åˆ©ã€‚ Salsa20 å¯†ç å°† 128 ä½æˆ– 256 ä½å¯¹ç§°å¯†é’¥ + éšæœºç”Ÿæˆçš„ 64 ä½éšæœºæ•°ï¼ˆåˆå§‹å‘é‡ï¼‰å’Œæ— é™é•¿åº¦çš„æ•°æ®æµä½œä¸ºè¾“å…¥ï¼Œå¹¶ç”Ÿæˆé•¿åº¦ç›¸åŒçš„åŠ å¯†æ•°æ®æµä½œä¸ºè¾“å‡ºè¾“å…¥æµã€‚ ChaCha20-Poly1305Salsa20 åº”ç”¨æœ€ä¸ºå¹¿æ³›çš„æ˜¯è®¤è¯åŠ å¯†æ–¹æ¡ˆï¼šChaCha20-Poly1305ï¼Œå³ç»„åˆä½¿ç”¨ ChaCha20 ä¸æ¶ˆæ¯è®¤è¯ç®—æ³• Poly1305ï¼Œå®ƒä»¬éƒ½ç”±å¯†ç å­¦å®¶ Bernstein è®¾è®¡ã€‚ ChaCha20-Poly1305 å·²è¢«è¯æ˜è¶³å¤Ÿå®‰å…¨ï¼Œä¸è¿‡è·Ÿ GCM ä¸€æ ·å®ƒçš„å®‰å…¨æ€§ä¹Ÿä¾èµ–äºè¶³å¤Ÿéšæœºçš„åˆå§‹å‘é‡ IVï¼Œå¦å¤– ChaCha20-Poly1305 ä¹Ÿä¸å®¹æ˜“é­å—è®¡æ—¶æ”»å‡»ã€‚ ChaCha20 ç®—æ³•æ¯” AES è¦å¿«å¾—å¤šï¼Œä½†æ˜¯ç›®å‰ï¼ˆ2025 å¹´ï¼‰ä¸»æµçš„ PC ç«¯ x86_64 CPU ä¸ç§»åŠ¨ç«¯ ARM CPU åŸºæœ¬éƒ½åœ¨ç¡¬ä»¶å±‚é¢å®ç°äº† AES ç®—æ³•ï¼Œè¿™å¤§å¤§æå‡äº†è¯¥ç®—æ³•çš„æ€§èƒ½ï¼Œå› æ­¤ ChaCha20 ç®—æ³•ç›®å‰åè€Œå¹¶æ— æ€§èƒ½ä¼˜åŠ¿ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ª ChaCha20 çš„ Python ç¤ºä¾‹ï¼š python # pip install cryptography==36.0.1 import os from cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes plaintext = b\"this is a paintext, hahahahahaha~\" key = b'\\x96\\xec.\\xc7\\xd5\\x1b/5\\xa1\\x10s\\x9d\\xd5\\x10z\\xdc\\x90\\xb5\\x1cm\"\u003ex\\xfd \\xd5\\xc5\\xaf\\x19\\xd1Z\\xbb' nonce = os.urandom(16) algorithm = algorithms.ChaCha20(key, nonce) # ChaCha20 æ˜¯ä¸€ä¸ªæµå¯†ç ï¼Œmode å¿…é¡»ä¸º None cipher = Cipher(algorithm, mode=None) # 1. åŠ å¯† encryptor = cipher.encryptor() ct = encryptor.update(plaintext) # 2. è§£å¯† decryptor = cipher.decryptor() decryptor.update(ct) 3. å…¶ä»–æµè¡Œçš„å¯¹ç§°åŠ å¯†ç®—æ³•è¿˜æœ‰ä¸€äº›å…¶ä»–çš„ç°ä»£å®‰å…¨å¯¹ç§°å¯†ç ï¼Œå®ƒä»¬çš„åº”ç”¨ä¸å¦‚ AES å’Œ ChaCha20 è¿™ä¹ˆå¹¿æ³›ï¼Œä½†åœ¨ç¨‹åºå‘˜å’Œä¿¡æ¯å®‰å…¨ç¤¾åŒºä¸­ä»ç„¶å¾ˆæµè¡Œï¼š Serpent - å®‰å…¨å¯¹ç§°å¯†é’¥åˆ†ç»„å¯†ç ï¼ˆå¯†é’¥å¤§å°ï¼š128ã€192 æˆ– 256 ä½ï¼‰ï¼Œå…¬ä¼—æ‰€æœ‰ï¼ˆPublic Domainï¼‰ï¼Œå®Œå…¨å…è´¹ Twofish - å®‰å…¨å¯¹ç§°å¯†é’¥åˆ†ç»„å¯†ç ï¼ˆå¯†é’¥å¤§å°ï¼š128ã€192 æˆ– 256 ä½ï¼‰ï¼Œå…¬ä¼—æ‰€æœ‰ï¼ˆPublic Domainï¼‰ï¼Œå®Œå…¨å…è´¹ Camellia - å®‰å…¨å¯¹ç§°å¯†é’¥åˆ†ç»„å¯†ç ï¼ˆåˆ†ç»„å¤§å°ï¼š128 ä½ï¼›å¯†é’¥","date":"2022-03-06","objectID":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/:5:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","å¯¹ç§°åŠ å¯†","å®‰å…¨","AES","ChaCha20"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…­ï¼‰â€”â€” å¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³•","uri":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/#chacha20-poly1305"},{"categories":["tech"],"content":" 1. å®‰å…¨çš„å¯¹ç§°åŠ å¯†ç®—æ³•ç›®å‰åº”ç”¨æœ€å¹¿æ³›çš„å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œæ˜¯ AES è·Ÿ Salsa20 / ChaCha20 è¿™ä¸¤ä¸ªç³»åˆ—ã€‚ 1. AES (Rijndael) wiki: https://en.wikipedia.org/wiki/Advanced_Encryption_Standard AESï¼ˆé«˜çº§åŠ å¯†æ ‡å‡†ï¼Œä¹Ÿç§°ä¸º Rijndaelï¼‰æ˜¯ç°ä»£ IT è¡Œä¸šä¸­æœ€æµè¡Œå’Œå¹¿æ³›ä½¿ç”¨çš„å¯¹ç§°åŠ å¯†ç®—æ³•ã€‚AES è¢«è¯æ˜æ˜¯é«˜åº¦å®‰å…¨ã€å¿«é€Ÿä¸”æ ‡å‡†åŒ–çš„ï¼Œåˆ°ç›®å‰ä¸ºæ­¢æ²¡æœ‰å‘ç°ä»»ä½•æ˜æ˜¾çš„å¼±ç‚¹æˆ–æ”»å‡»æ‰‹æ®µï¼Œè€Œä¸”å‡ ä¹åœ¨æ‰€æœ‰å¹³å°ä¸Šéƒ½å¾—åˆ°äº†å¾ˆå¥½çš„æ”¯æŒã€‚ AES æ˜¯ 128 ä½åˆ†ç»„å¯†ç ï¼Œä½¿ç”¨ 128ã€192 æˆ– 256 ä½å¯†é’¥ã€‚å®ƒé€šå¸¸ä¸åˆ†ç»„æ¨¡å¼ç»„åˆæˆåˆ†ç»„åŠ å¯†æ–¹æ¡ˆï¼ˆå¦‚ AES-CTR æˆ– AES-GCMï¼‰ä»¥å¤„ç†æµæ•°æ®ã€‚åœ¨å¤§å¤šæ•°åˆ†ç»„æ¨¡å¼ä¸­ï¼ŒAES è¿˜éœ€è¦ä¸€ä¸ªéšæœºçš„ 128 ä½åˆå§‹å‘é‡ IVã€‚ Rijndael (AES) ç®—æ³•å¯å…è´¹ç”¨äºä»»ä½•ç”¨é€”ï¼Œè€Œä¸”éå¸¸æµè¡Œã€‚å¾ˆå¤šç«™ç‚¹éƒ½é€‰æ‹© AES ä½œä¸º TLS åè®®çš„ä¸€éƒ¨åˆ†ï¼Œä»¥å®ç°å®‰å…¨é€šä¿¡ã€‚ç°ä»£ CPU ç¡¬ä»¶åŸºæœ¬éƒ½åœ¨å¾®å¤„ç†å™¨çº§åˆ«å®ç°äº† AES æŒ‡ä»¤ä»¥åŠ é€Ÿ AES åŠ å¯†è§£å¯†æ“ä½œã€‚ è¿™é‡Œæœ‰ä¸€ä¸ªçº¯ Python çš„ AES å®ç°å¯ä¾›å‚è€ƒ: AES encryption in pure Python - boppreh æˆ‘ä»¬åœ¨å‰é¢çš„ CTR åˆ†ç»„æ¨¡å¼ä¸­å·²ç»ä½¿ç”¨ Python å®è·µäº† AES-256-CTR åŠ å¯†æ–¹æ¡ˆã€‚è€Œå®é™…ä¸Šæ›´å¸¸ç”¨çš„æ˜¯æ”¯æŒé›†æˆèº«ä»½éªŒè¯åŠ å¯†ï¼ˆAEADï¼‰çš„ AES-256-GCM åŠ å¯†æ–¹æ¡ˆï¼Œå®ƒçš„ä¼˜åŠ¿æˆ‘ä»¬å‰é¢å·²ç»ä»‹ç»è¿‡äº†ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ Python æ¼”ç¤ºä¸‹å¦‚ä½•ä½¿ç”¨ï¼š python # pip install cryptography==36.0.1 import os from cryptography.hazmat.primitives.ciphers import ( Cipher, algorithms, modes ) def encrypt(key, plaintext, associated_data): # Generate a random 96-bit IV. iv = os.urandom(12) # Construct an AES-GCM Cipher object with the given key and a # randomly generated IV. encryptor = Cipher( algorithms.AES(key), modes.GCM(iv), ).encryptor() # associated_data will be authenticated but not encrypted, # it must also be passed in on decryption. encryptor.authenticate_additional_data(associated_data) # Encrypt the plaintext and get the associated ciphertext. # GCM does not require padding. ciphertext = encryptor.update(plaintext) + encryptor.finalize() return (iv, ciphertext, encryptor.tag) def decrypt(key, associated_data, iv, ciphertext, tag): # Construct a Cipher object, with the key, iv, and additionally the # GCM tag used for authenticating the message. decryptor = Cipher( algorithms.AES(key), modes.GCM(iv, tag), ).decryptor() # We put associated_data back in or the tag will fail to verify # when we finalize the decryptor. decryptor.authenticate_additional_data(associated_data) # Decryption gets us the authenticated plaintext. # If the tag does not match an InvalidTag exception will be raised. return decryptor.update(ciphertext) + decryptor.finalize() # æ¥ä¸‹æ¥è¿›è¡Œç®—æ³•éªŒè¯ plaintext = b\"this is a paintext, hahahahahaha~\" key = b'\\x96\\xec.\\xc7\\xd5\\x1b/5\\xa1\\x10s\\x9d\\xd5\\x10z\\xdc\\x90\\xb5\\x1cm\"\u003ex\\xfd \\xd5\\xc5\\xaf\\x19\\xd1Z\\xbb' associated_data = b\"authenticated but not encrypted payload\" # è¢«ç”¨äºæ¶ˆæ¯è®¤è¯çš„å…³è”æ•°æ® # 1. å‘é€æ–¹åŠ å¯†æ¶ˆæ¯ iv, ciphertext, tag = encrypt( key, plaintext, associated_data ) # 2. å‘é€æ–¹å°† associated_data iv ciphertext tag æ‰“åŒ…å‘é€ç»™æ¥æ”¶æ–¹ # 3. æ¥æ”¶æ–¹ä½¿ç”¨è‡ªå·±çš„ key éªŒè¯å¹¶è§£å¯†æ•°æ® descrypt_text = decrypt( key, associated_data, iv, ciphertext, tag ) 2. Salsa20 / ChaCha20 wiki: https://en.wikipedia.org/wiki/Salsa20#ChaCha_variant Salsa20 åŠå…¶æ”¹è¿›çš„å˜ä½“ ChaChaï¼ˆChaCha8ã€ChaCha12ã€ChaCha20ï¼‰å’Œ XSalsa20 æ˜¯ç”±å¯†ç å­¦å®¶ Daniel Bernstein è®¾è®¡çš„ç°ä»£ã€å¿«é€Ÿçš„å¯¹ç§°æµå¯†ç å®¶æ—ã€‚ Salsa20 å¯†ç æ˜¯å¯¹ç§°æµå¯†ç è®¾è®¡ç«èµ› eSTREAMï¼ˆ2004-2008ï¼‰çš„å†³èµ›é€‰æ‰‹ä¹‹ä¸€ï¼Œå®ƒéšåä¸ç›¸å…³çš„ BLAKE å“ˆå¸Œå‡½æ•°ä¸€èµ·è¢«å¹¿æ³›é‡‡ç”¨ã€‚ Salsa20 åŠå…¶å˜ä½“æ˜¯å…ç‰ˆç¨çš„ï¼Œæ²¡æœ‰ä¸“åˆ©ã€‚ Salsa20 å¯†ç å°† 128 ä½æˆ– 256 ä½å¯¹ç§°å¯†é’¥ + éšæœºç”Ÿæˆçš„ 64 ä½éšæœºæ•°ï¼ˆåˆå§‹å‘é‡ï¼‰å’Œæ— é™é•¿åº¦çš„æ•°æ®æµä½œä¸ºè¾“å…¥ï¼Œå¹¶ç”Ÿæˆé•¿åº¦ç›¸åŒçš„åŠ å¯†æ•°æ®æµä½œä¸ºè¾“å‡ºè¾“å…¥æµã€‚ ChaCha20-Poly1305Salsa20 åº”ç”¨æœ€ä¸ºå¹¿æ³›çš„æ˜¯è®¤è¯åŠ å¯†æ–¹æ¡ˆï¼šChaCha20-Poly1305ï¼Œå³ç»„åˆä½¿ç”¨ ChaCha20 ä¸æ¶ˆæ¯è®¤è¯ç®—æ³• Poly1305ï¼Œå®ƒä»¬éƒ½ç”±å¯†ç å­¦å®¶ Bernstein è®¾è®¡ã€‚ ChaCha20-Poly1305 å·²è¢«è¯æ˜è¶³å¤Ÿå®‰å…¨ï¼Œä¸è¿‡è·Ÿ GCM ä¸€æ ·å®ƒçš„å®‰å…¨æ€§ä¹Ÿä¾èµ–äºè¶³å¤Ÿéšæœºçš„åˆå§‹å‘é‡ IVï¼Œå¦å¤– ChaCha20-Poly1305 ä¹Ÿä¸å®¹æ˜“é­å—è®¡æ—¶æ”»å‡»ã€‚ ChaCha20 ç®—æ³•æ¯” AES è¦å¿«å¾—å¤šï¼Œä½†æ˜¯ç›®å‰ï¼ˆ2025 å¹´ï¼‰ä¸»æµçš„ PC ç«¯ x86_64 CPU ä¸ç§»åŠ¨ç«¯ ARM CPU åŸºæœ¬éƒ½åœ¨ç¡¬ä»¶å±‚é¢å®ç°äº† AES ç®—æ³•ï¼Œè¿™å¤§å¤§æå‡äº†è¯¥ç®—æ³•çš„æ€§èƒ½ï¼Œå› æ­¤ ChaCha20 ç®—æ³•ç›®å‰åè€Œå¹¶æ— æ€§èƒ½ä¼˜åŠ¿ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ª ChaCha20 çš„ Python ç¤ºä¾‹ï¼š python # pip install cryptography==36.0.1 import os from cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes plaintext = b\"this is a paintext, hahahahahaha~\" key = b'\\x96\\xec.\\xc7\\xd5\\x1b/5\\xa1\\x10s\\x9d\\xd5\\x10z\\xdc\\x90\\xb5\\x1cm\"\u003ex\\xfd \\xd5\\xc5\\xaf\\x19\\xd1Z\\xbb' nonce = os.urandom(16) algorithm = algorithms.ChaCha20(key, nonce) # ChaCha20 æ˜¯ä¸€ä¸ªæµå¯†ç ï¼Œmode å¿…é¡»ä¸º None cipher = Cipher(algorithm, mode=None) # 1. åŠ å¯† encryptor = cipher.encryptor() ct = encryptor.update(plaintext) # 2. è§£å¯† decryptor = cipher.decryptor() decryptor.update(ct) 3. å…¶ä»–æµè¡Œçš„å¯¹ç§°åŠ å¯†ç®—æ³•è¿˜æœ‰ä¸€äº›å…¶ä»–çš„ç°ä»£å®‰å…¨å¯¹ç§°å¯†ç ï¼Œå®ƒä»¬çš„åº”ç”¨ä¸å¦‚ AES å’Œ ChaCha20 è¿™ä¹ˆå¹¿æ³›ï¼Œä½†åœ¨ç¨‹åºå‘˜å’Œä¿¡æ¯å®‰å…¨ç¤¾åŒºä¸­ä»ç„¶å¾ˆæµè¡Œï¼š Serpent - å®‰å…¨å¯¹ç§°å¯†é’¥åˆ†ç»„å¯†ç ï¼ˆå¯†é’¥å¤§å°ï¼š128ã€192 æˆ– 256 ä½ï¼‰ï¼Œå…¬ä¼—æ‰€æœ‰ï¼ˆPublic Domainï¼‰ï¼Œå®Œå…¨å…è´¹ Twofish - å®‰å…¨å¯¹ç§°å¯†é’¥åˆ†ç»„å¯†ç ï¼ˆå¯†é’¥å¤§å°ï¼š128ã€192 æˆ– 256 ä½ï¼‰ï¼Œå…¬ä¼—æ‰€æœ‰ï¼ˆPublic Domainï¼‰ï¼Œå®Œå…¨å…è´¹ Camellia - å®‰å…¨å¯¹ç§°å¯†é’¥åˆ†ç»„å¯†ç ï¼ˆåˆ†ç»„å¤§å°ï¼š128 ä½ï¼›å¯†é’¥","date":"2022-03-06","objectID":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/:5:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","å¯¹ç§°åŠ å¯†","å®‰å…¨","AES","ChaCha20"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…­ï¼‰â€”â€” å¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³•","uri":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/#3-å…¶ä»–æµè¡Œçš„å¯¹ç§°åŠ å¯†ç®—æ³•"},{"categories":["tech"],"content":" 2. ä¸å®‰å…¨çš„å¯¹ç§°åŠ å¯†ç®—æ³•å¦‚ä¸‹è¿™äº›å¯¹ç§°åŠ å¯†ç®—æ³•æ›¾ç»å¾ˆæµè¡Œï¼Œä½†ç°åœ¨è¢«è®¤ä¸ºæ˜¯ä¸å®‰å…¨çš„æˆ–æœ‰äº‰è®®çš„å®‰å…¨æ€§ï¼Œä¸å»ºè®®å†ä½¿ç”¨ï¼š DES - 56 ä½å¯†é’¥å¤§å°ï¼Œå¯ä»¥è¢«æš´åŠ›ç ´è§£ 3DESï¼ˆä¸‰é‡ DES, TDESï¼‰- 64 ä½å¯†ç ï¼Œè¢«è®¤ä¸ºä¸å®‰å…¨ï¼Œå·²åœ¨ 2017 å¹´è¢« NIST å¼ƒç”¨. RC2 - 64 ä½å¯†ç ï¼Œè¢«è®¤ä¸ºä¸å®‰å…¨ RC4 - æµå¯†ç ï¼Œå·²è¢«ç ´è§£ï¼Œç½‘ä¸Šå­˜åœ¨å¤§é‡å®ƒçš„ç ´è§£èµ„æ–™ Blowfish - æ—§çš„ 64 ä½å¯†ç ï¼Œå·²è¢«ç ´å Sweet32: Birthday attacks on 64-bit block ciphers in TLS and OpenVPN GHOST - ä¿„ç½—æ–¯ 64 ä½åˆ†ç»„å¯†ç ï¼Œæœ‰äº‰è®®çš„å®‰å…¨æ€§ï¼Œè¢«è®¤ä¸ºæœ‰é£é™© ","date":"2022-03-06","objectID":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/:5:2","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","å¯¹ç§°åŠ å¯†","å®‰å…¨","AES","ChaCha20"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…­ï¼‰â€”â€” å¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³•","uri":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/#2-ä¸å®‰å…¨çš„å¯¹ç§°åŠ å¯†ç®—æ³•"},{"categories":["tech"],"content":" å¯¹ç§°è®¤è¯åŠ å¯†ç®—æ³• AE / AEADæˆ‘ä»¬åœ¨å‰é¢ç¬¬ä¸‰ç¯‡æ–‡ç« ã€ŒMAC ä¸å¯†é’¥æ´¾ç”Ÿå‡½æ•° KDFã€ä¸­ä»‹ç»è¿‡ AE è®¤è¯åŠ å¯†åŠå…¶å˜ä½“ AEAD. ä¸€äº›å¯¹ç§°åŠ å¯†æ–¹æ¡ˆæä¾›é›†æˆèº«ä»½éªŒè¯åŠ å¯†ï¼ˆAEADï¼‰ï¼Œæ¯”å¦‚ä½¿ç”¨äº† GCM åˆ†ç»„æ¨¡å¼çš„åŠ å¯†æ–¹æ¡ˆ AES-GCMï¼Œ è€Œå…¶ä»–åŠ å¯†æ–¹æ¡ˆï¼ˆå¦‚ AES-CBC å’Œ AES-CTRï¼‰è‡ªèº«ä¸æä¾›èº«ä»½éªŒè¯èƒ½åŠ›ï¼Œéœ€è¦é¢å¤–æ·»åŠ ã€‚ æœ€æµè¡Œçš„è®¤è¯åŠ å¯†ï¼ˆAEADï¼‰æ–¹æ¡ˆæœ‰å¦‚ä¸‹å‡ ä¸ªï¼Œæˆ‘ä»¬åœ¨ä¹‹å‰å·²ç»ç®€å•ä»‹ç»è¿‡å®ƒä»¬ï¼š ChaCha20-Poly1305 å…·æœ‰é›†æˆ Poly1305 èº«ä»½éªŒè¯å™¨çš„ ChaCha20 æµå¯†ç ï¼ˆé›†æˆèº«ä»½éªŒè¯ AEAD åŠ å¯†ï¼‰ ä½¿ç”¨ 256 ä½å¯†é’¥å’Œ 96 ä½éšæœºæ•°ï¼ˆåˆå§‹å‘é‡ï¼‰ æé«˜çš„æ€§èƒ½ åœ¨ç¡¬ä»¶ä¸æ”¯æŒ AES åŠ é€ŸæŒ‡ä»¤æ—¶ï¼ˆå¦‚è·¯ç”±å™¨ã€æ—§æ‰‹æœºç­‰ç¡¬ä»¶ä¸Šï¼‰ï¼Œæ¨èä½¿ç”¨æ­¤ç®—æ³• AES-256-GCM æˆ‘ä»¬åœ¨å‰é¢çš„ GCM æ¨¡å¼ä¸€èŠ‚ï¼Œä½¿ç”¨ Python å®ç°å¹¶éªŒè¯äº†è¿™ä¸ª AES-256-GCM åŠ å¯†æ–¹æ¡ˆ ä½¿ç”¨ 256 ä½å¯†é’¥å’Œ 128 ä½éšæœºæ•°ï¼ˆåˆå§‹å‘é‡ï¼‰ è¾ƒé«˜çš„æ€§èƒ½ åœ¨ç¡¬ä»¶æ”¯æŒ AES åŠ é€Ÿæ—¶ï¼ˆå¦‚æ¡Œé¢ã€æœåŠ¡å™¨ç­‰åœºæ™¯ï¼‰ï¼Œæ›´æ¨èä½¿ç”¨æ­¤ç®—æ³• AES-128-GCM è·Ÿ AES-256-GCM ä¸€æ ·ï¼ŒåŒºåˆ«åœ¨äºå®ƒä½¿ç”¨ 128 ä½å¯†é’¥ï¼Œå®‰å…¨æ€§å¼±äº ChaCha20-Poly1305 ä¸ AES-256-GCM. ç›®å‰è¢«å¹¿æ³›åº”ç”¨åœ¨ HTTPS ç­‰å¤šç§åŠ å¯†åœºæ™¯ä¸‹ï¼Œä½†æ˜¯æ­£åœ¨æ…¢æ…¢è¢«å‰é¢ä¸¤ç§æ–¹æ¡ˆå–ä»£ ä»Šå¤©çš„å¤§å¤šæ•°åº”ç”¨ç¨‹åºåº”è¯¥ä¼˜å…ˆé€‰ç”¨ä¸Šé¢è¿™äº›åŠ å¯†æ–¹æ¡ˆè¿›è¡Œå¯¹ç§°åŠ å¯†ï¼Œè€Œä¸æ˜¯è‡ªå·±é€ è½®å­ã€‚ä¸Šè¿°æ–¹æ¡ˆæ˜¯é«˜åº¦å®‰å…¨çš„ã€ç»è¿‡éªŒè¯çš„ã€ç»è¿‡è‰¯å¥½æµ‹è¯•çš„ï¼Œå¹¶ä¸”å¤§å¤šæ•°åŠ å¯†åº“éƒ½å·²ç»æä¾›äº†é«˜æ•ˆçš„å®ç°ï¼Œå¯ä»¥è¯´æ˜¯å¼€ç®±å³ç”¨ã€‚ ç›®å‰åº”ç”¨æœ€å¹¿æ³›çš„å¯¹ç§°åŠ å¯†æ–¹æ¡ˆåº”è¯¥æ˜¯ AES-128-GCMï¼Œè€Œ ChaCha20-Poly1305 å› ä¸ºå…¶æé«˜çš„æ€§èƒ½ï¼Œä¹Ÿè¶Šæ¥è¶Šå¤šåœ°è¢«åº”ç”¨åœ¨ TLS1.2ã€TLS1.3ã€QUIC/HTTP3ã€Wireguardã€SSH ç­‰åè®®ä¸­ã€‚ ","date":"2022-03-06","objectID":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/:5:3","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","å¯¹ç§°åŠ å¯†","å®‰å…¨","AES","ChaCha20"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…­ï¼‰â€”â€” å¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³•","uri":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/#å¯¹ç§°è®¤è¯åŠ å¯†ç®—æ³•-ae--aead"},{"categories":["tech"],"content":" äº”ã€AES ç®—æ³•æ¡ˆä¾‹ï¼šä»¥å¤ªåŠé’±åŒ…åŠ å¯†åœ¨è¿™ä¸€å°èŠ‚æˆ‘ä»¬ç ”ç©¶ä¸€ä¸ªç°å®ä¸­çš„ AES åº”ç”¨åœºæ™¯ï¼šä»¥å¤ªåŠåŒºå—é“¾çš„æ ‡å‡†åŠ å¯†é’±åŒ…æ–‡ä»¶æ ¼å¼ã€‚æˆ‘ä»¬å°†çœ‹åˆ° AES-128-CTR å¯†ç æ–¹æ¡ˆå¦‚ä½•ä¸ Scrypt å’Œ MAC ç›¸ç»“åˆï¼Œé€šè¿‡å­—ç¬¦å¯†ç å®‰å…¨åœ°å®ç°ç»è¿‡èº«ä»½éªŒè¯çš„å¯¹ç§°å¯†é’¥åŠ å¯†ã€‚ ä»¥å¤ªåŠ UTC / JSON é’±åŒ…åœ¨æ¯”ç‰¹å¸å’Œä»¥å¤ªåŠç­‰åŒºå—é“¾ç½‘ç»œä¸­ï¼ŒåŒºå—é“¾èµ„äº§æŒæœ‰è€…çš„ç§é’¥å­˜å‚¨åœ¨ç§°ä¸ºåŠ å¯†é’±åŒ…çš„ç‰¹æ®Šå¯†é’¥åº“ä¸­ã€‚é€šå¸¸ï¼Œè¿™äº›åŠ å¯†é’±åŒ…æ˜¯æœ¬åœ°ç¡¬ç›˜ä¸Šçš„æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨å­—ç¬¦å¯†ç åŠ å¯†ã€‚ åœ¨ä»¥å¤ªåŠåŒºå—é“¾ä¸­ï¼ŒåŠ å¯†é’±åŒ…ä»¥ä¸€ç§ç‰¹æ®Šçš„åŠ å¯†æ ¼å¼åœ¨å†…éƒ¨å­˜å‚¨ï¼Œç§°ä¸ºã€ŒUTC / JSON é’±åŒ…ï¼ˆå¯†é’¥åº“æ–‡ä»¶ï¼‰ã€æˆ–ã€ŒWeb3 ç§˜å¯†å­˜å‚¨å®šä¹‰ã€ã€‚è¿™æ˜¯ä¸€ç§åŠ å¯†é’±åŒ…çš„æ–‡ä»¶æ ¼å¼ï¼Œè¢«å¹¿æ³›åº”ç”¨åœ¨ geth å’Œ Parityï¼ˆä»¥å¤ªåŠçš„ä¸»è¦åè®®å®ç°ï¼‰ã€MyEtherWalletï¼ˆæµè¡Œçš„åœ¨çº¿å®¢æˆ·ç«¯ä»¥å¤ªåŠé’±åŒ…ï¼‰ã€MetaMaskï¼ˆå¹¿æ³›ä½¿ç”¨çš„æµè§ˆå™¨å†…ä»¥å¤ªåŠé’±åŒ…ï¼‰ã€ethers.js å’Œ Nethereum åº“ä»¥åŠè®¸å¤šå…¶ä»–ä¸ä»¥å¤ªåŠç›¸å…³çš„æŠ€æœ¯å’Œå·¥å…·ä¸­ã€‚ ä»¥å¤ªåŠ UTC/JSON å¯†é’¥åº“å°†åŠ å¯†çš„ç§é’¥ã€åŠ å¯†æ•°æ®ã€åŠ å¯†ç®—æ³•åŠå…¶å‚æ•°ä¿å­˜ä¸º JSON æ–‡æœ¬æ–‡æ¡£ã€‚ UTC / JSON é’±åŒ…çš„ä¸€ä¸ªç¤ºä¾‹å¦‚ä¸‹ï¼š yaml { \"version\": 3, \"id\": \"07a9f767-93c5-4842-9afd-b3b083659f04\", \"address\": \"aef8cad64d29fcc4ed07629b9e896ebc3160a8d0\", \"Crypto\": { \"ciphertext\": \"99d0e66c67941a08690e48222a58843ef2481e110969325db7ff5284cd3d3093\", \"cipherparams\": { \"iv\": \"7d7fabf8dee2e77f0d7e3ff3b965fc23\" }, \"cipher\": \"aes-128-ctr\", \"kdf\": \"scrypt\", \"kdfparams\": { \"dklen\": 32, \"salt\": \"85ad073989d461c72358ccaea3551f7ecb8e672503cb05c2ee80cfb6b922f4d4\", \"n\": 8192, \"r\": 8, \"p\": 1, }, \"mac\": \"06dcf1cc4bffe1616fafe94a2a7087fd79df444756bb17c93af588c3ab02a913\", }, } ä¸Šè¿° json å†…å®¹ä¹Ÿæ˜¯è®¤è¯å¯¹ç§°åŠ å¯†çš„ä¸€ä¸ªå…¸å‹ç¤ºä¾‹ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åˆ†æå‡ºå®ƒçš„ä¸€äº›ç»„æˆæˆåˆ†ï¼š kdf: ç”¨äºä»å­—ç¬¦å¯†ç æ´¾ç”Ÿå‡ºå¯†é’¥çš„ KDF ç®—æ³•åç§°ï¼Œè¿™é‡Œç”¨çš„æ˜¯ scrypt kdfparams: KDF ç®—æ³•çš„å‚æ•°ï¼Œå¦‚è¿­ä»£å‚æ•°ã€ç›ç­‰â€¦ ciphertext: é’±åŒ…å†…å®¹çš„å¯†æ–‡ï¼Œé€šå¸¸è¿™å°±æ˜¯ä¸€ä¸ªè¢«åŠ å¯†çš„ 256 ä½ç§é’¥ cipher + cipherparams: å¯¹ç§°åŠ å¯†ç®—æ³•çš„åç§°åŠå‚æ•°ï¼Œè¿™é‡Œä½¿ç”¨äº† AES-128-CTRï¼Œå¹¶ç»™å‡ºäº†åˆå§‹å‘é‡ IV mac: ç”± MAC ç®—æ³•ç”Ÿæˆçš„æ¶ˆæ¯è®¤è¯ç ï¼Œè¢«ç”¨äºéªŒè¯è§£å¯†å¯†ç çš„æ­£ç¡®æ€§ ä»¥å¤ªåŠä½¿ç”¨æˆªå–æ´¾ç”Ÿå¯†é’¥çš„ä¸€éƒ¨åˆ†ï¼Œæ‹¼æ¥ä¸Šå®Œæ•´å¯†æ–‡ï¼Œç„¶åè¿›è¡Œ keccak-256 å“ˆå¸Œè¿ç®—å¾—åˆ° MAC å€¼ å…¶ä»–é’±åŒ…ç›¸å…³çš„ä¿¡æ¯ é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯†é’¥æ´¾ç”Ÿå‡½æ•°æ˜¯ scrypt å¹¶ä½¿ç”¨çš„æ˜¯å¼± scrypt å‚æ•°ï¼ˆn=8192 æˆæœ¬å› å­ï¼Œr=8 å—å¤§å°ï¼Œp=1 å¹¶è¡ŒåŒ–ï¼‰ï¼Œå› æ­¤å»ºè®®ä½¿ç”¨é•¿è€Œå¤æ‚çš„å¯†ç ä»¥é¿å…é’±åŒ…è¢«æš´åŠ›è§£å¯†ã€‚ ","date":"2022-03-06","objectID":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/:6:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","å¯¹ç§°åŠ å¯†","å®‰å…¨","AES","ChaCha20"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…­ï¼‰â€”â€” å¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³•","uri":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/#äº”aes-ç®—æ³•æ¡ˆä¾‹ä»¥å¤ªåŠé’±åŒ…åŠ å¯†"},{"categories":["tech"],"content":" äº”ã€AES ç®—æ³•æ¡ˆä¾‹ï¼šä»¥å¤ªåŠé’±åŒ…åŠ å¯†åœ¨è¿™ä¸€å°èŠ‚æˆ‘ä»¬ç ”ç©¶ä¸€ä¸ªç°å®ä¸­çš„ AES åº”ç”¨åœºæ™¯ï¼šä»¥å¤ªåŠåŒºå—é“¾çš„æ ‡å‡†åŠ å¯†é’±åŒ…æ–‡ä»¶æ ¼å¼ã€‚æˆ‘ä»¬å°†çœ‹åˆ° AES-128-CTR å¯†ç æ–¹æ¡ˆå¦‚ä½•ä¸ Scrypt å’Œ MAC ç›¸ç»“åˆï¼Œé€šè¿‡å­—ç¬¦å¯†ç å®‰å…¨åœ°å®ç°ç»è¿‡èº«ä»½éªŒè¯çš„å¯¹ç§°å¯†é’¥åŠ å¯†ã€‚ ä»¥å¤ªåŠ UTC / JSON é’±åŒ…åœ¨æ¯”ç‰¹å¸å’Œä»¥å¤ªåŠç­‰åŒºå—é“¾ç½‘ç»œä¸­ï¼ŒåŒºå—é“¾èµ„äº§æŒæœ‰è€…çš„ç§é’¥å­˜å‚¨åœ¨ç§°ä¸ºåŠ å¯†é’±åŒ…çš„ç‰¹æ®Šå¯†é’¥åº“ä¸­ã€‚é€šå¸¸ï¼Œè¿™äº›åŠ å¯†é’±åŒ…æ˜¯æœ¬åœ°ç¡¬ç›˜ä¸Šçš„æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨å­—ç¬¦å¯†ç åŠ å¯†ã€‚ åœ¨ä»¥å¤ªåŠåŒºå—é“¾ä¸­ï¼ŒåŠ å¯†é’±åŒ…ä»¥ä¸€ç§ç‰¹æ®Šçš„åŠ å¯†æ ¼å¼åœ¨å†…éƒ¨å­˜å‚¨ï¼Œç§°ä¸ºã€ŒUTC / JSON é’±åŒ…ï¼ˆå¯†é’¥åº“æ–‡ä»¶ï¼‰ã€æˆ–ã€ŒWeb3 ç§˜å¯†å­˜å‚¨å®šä¹‰ã€ã€‚è¿™æ˜¯ä¸€ç§åŠ å¯†é’±åŒ…çš„æ–‡ä»¶æ ¼å¼ï¼Œè¢«å¹¿æ³›åº”ç”¨åœ¨ geth å’Œ Parityï¼ˆä»¥å¤ªåŠçš„ä¸»è¦åè®®å®ç°ï¼‰ã€MyEtherWalletï¼ˆæµè¡Œçš„åœ¨çº¿å®¢æˆ·ç«¯ä»¥å¤ªåŠé’±åŒ…ï¼‰ã€MetaMaskï¼ˆå¹¿æ³›ä½¿ç”¨çš„æµè§ˆå™¨å†…ä»¥å¤ªåŠé’±åŒ…ï¼‰ã€ethers.js å’Œ Nethereum åº“ä»¥åŠè®¸å¤šå…¶ä»–ä¸ä»¥å¤ªåŠç›¸å…³çš„æŠ€æœ¯å’Œå·¥å…·ä¸­ã€‚ ä»¥å¤ªåŠ UTC/JSON å¯†é’¥åº“å°†åŠ å¯†çš„ç§é’¥ã€åŠ å¯†æ•°æ®ã€åŠ å¯†ç®—æ³•åŠå…¶å‚æ•°ä¿å­˜ä¸º JSON æ–‡æœ¬æ–‡æ¡£ã€‚ UTC / JSON é’±åŒ…çš„ä¸€ä¸ªç¤ºä¾‹å¦‚ä¸‹ï¼š yaml { \"version\": 3, \"id\": \"07a9f767-93c5-4842-9afd-b3b083659f04\", \"address\": \"aef8cad64d29fcc4ed07629b9e896ebc3160a8d0\", \"Crypto\": { \"ciphertext\": \"99d0e66c67941a08690e48222a58843ef2481e110969325db7ff5284cd3d3093\", \"cipherparams\": { \"iv\": \"7d7fabf8dee2e77f0d7e3ff3b965fc23\" }, \"cipher\": \"aes-128-ctr\", \"kdf\": \"scrypt\", \"kdfparams\": { \"dklen\": 32, \"salt\": \"85ad073989d461c72358ccaea3551f7ecb8e672503cb05c2ee80cfb6b922f4d4\", \"n\": 8192, \"r\": 8, \"p\": 1, }, \"mac\": \"06dcf1cc4bffe1616fafe94a2a7087fd79df444756bb17c93af588c3ab02a913\", }, } ä¸Šè¿° json å†…å®¹ä¹Ÿæ˜¯è®¤è¯å¯¹ç§°åŠ å¯†çš„ä¸€ä¸ªå…¸å‹ç¤ºä¾‹ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åˆ†æå‡ºå®ƒçš„ä¸€äº›ç»„æˆæˆåˆ†ï¼š kdf: ç”¨äºä»å­—ç¬¦å¯†ç æ´¾ç”Ÿå‡ºå¯†é’¥çš„ KDF ç®—æ³•åç§°ï¼Œè¿™é‡Œç”¨çš„æ˜¯ scrypt kdfparams: KDF ç®—æ³•çš„å‚æ•°ï¼Œå¦‚è¿­ä»£å‚æ•°ã€ç›ç­‰â€¦ ciphertext: é’±åŒ…å†…å®¹çš„å¯†æ–‡ï¼Œé€šå¸¸è¿™å°±æ˜¯ä¸€ä¸ªè¢«åŠ å¯†çš„ 256 ä½ç§é’¥ cipher + cipherparams: å¯¹ç§°åŠ å¯†ç®—æ³•çš„åç§°åŠå‚æ•°ï¼Œè¿™é‡Œä½¿ç”¨äº† AES-128-CTRï¼Œå¹¶ç»™å‡ºäº†åˆå§‹å‘é‡ IV mac: ç”± MAC ç®—æ³•ç”Ÿæˆçš„æ¶ˆæ¯è®¤è¯ç ï¼Œè¢«ç”¨äºéªŒè¯è§£å¯†å¯†ç çš„æ­£ç¡®æ€§ ä»¥å¤ªåŠä½¿ç”¨æˆªå–æ´¾ç”Ÿå¯†é’¥çš„ä¸€éƒ¨åˆ†ï¼Œæ‹¼æ¥ä¸Šå®Œæ•´å¯†æ–‡ï¼Œç„¶åè¿›è¡Œ keccak-256 å“ˆå¸Œè¿ç®—å¾—åˆ° MAC å€¼ å…¶ä»–é’±åŒ…ç›¸å…³çš„ä¿¡æ¯ é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯†é’¥æ´¾ç”Ÿå‡½æ•°æ˜¯ scrypt å¹¶ä½¿ç”¨çš„æ˜¯å¼± scrypt å‚æ•°ï¼ˆn=8192 æˆæœ¬å› å­ï¼Œr=8 å—å¤§å°ï¼Œp=1 å¹¶è¡ŒåŒ–ï¼‰ï¼Œå› æ­¤å»ºè®®ä½¿ç”¨é•¿è€Œå¤æ‚çš„å¯†ç ä»¥é¿å…é’±åŒ…è¢«æš´åŠ›è§£å¯†ã€‚ ","date":"2022-03-06","objectID":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/:6:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","å¯¹ç§°åŠ å¯†","å®‰å…¨","AES","ChaCha20"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…­ï¼‰â€”â€” å¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³•","uri":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/#ä»¥å¤ªåŠ-utc--json-é’±åŒ…"},{"categories":["tech"],"content":" å‚è€ƒ Practical-Cryptography-for-Developers-Book A complete overview of SSL/TLS and its cryptographic system AES encryption in pure Python - boppreh Block_cipher_mode_of_operation_wiki Galois/Counter_Mode_wiki ","date":"2022-03-06","objectID":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/:7:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","å¯¹ç§°åŠ å¯†","å®‰å…¨","AES","ChaCha20"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…­ï¼‰â€”â€” å¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³•","uri":"/posts/practical-cryptography-basics-6-symmetric-key-ciphers/#å‚è€ƒ"},{"categories":["life"],"content":" åŸæ–‡ï¼šå“ªä¸€åˆ»ä½ å‘ç°å¹´è½»äººæ­£åœ¨æ‚„æ‚„æ”¹å˜ç¤¾ä¼šï¼Ÿ - èµ¦å·± æˆ‘çš„è¯»åæ„Ÿï¼šä»–çš„çœ¼é‡Œæœ‰å…‰ï¼ ä¹‹å‰è§è¿‡ä¸€ä¸ªç‰¹åˆ«å‰å®³çš„é¢è¯•è€…ï¼Œè®©æˆ‘è§‰å¾—ï¼Œè€ä¸€è¾ˆçœŸçš„æ˜¯è€ä¸€è¾ˆäº†ï¼Œä»–æ”¾å¼ƒäº†ä¸€ä¸ªæœˆè–ªä¸€ä¸‡ä¸‰ï¼Œåä¸‰è–ªçš„å·¥ä½œï¼Œä»–çš„æ¼”è®²è®©æˆ‘è®°å¿†éå¸¸æ·±åˆ»ï¼Œä¹Ÿä½¿å¾—é¢è¯•å®˜é¢é¢ç›¸è§‘ã€‚ è¿™ä¸ªå²—ä½ç®—æ˜¯ä¸‡äººè¿‡ç‹¬æœ¨æ¡¥ï¼Œä¸ä»…æµ·å†…çš„å¾ˆå¤šå¤§å­¦ç”Ÿåœ¨ç«äº‰ï¼Œæµ·å¤–çš„å¾ˆå¤šå¤§å­¦ç”Ÿä¹Ÿåœ¨åŠªåŠ›ï¼Œæ•´ä¸ªè¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼šç®€å†ç­›é€‰-çº¿ä¸Šä¸€é¢-çº¿ä¸ŠhräºŒé¢-çº¿ä¸‹ä¸»ç®¡é¢è¯•-æ€»è£è½®é¢è¯•ï¼ˆå‹åŠ›è½®ï¼‰ã€‚ æˆ‘ä»¬éƒ½åˆ°äº†æœ€åçš„ä¸€è½®é¢è¯•,æœ¬æ¥å°±æ˜¯å‹åŠ›è½®é¢è¯•ï¼Œä½†æ˜¯é‚£å¤©ä¸çŸ¥é“ä¸ºä»€ä¹ˆæ€»è£çš„è„¾æ°”å¾ˆæš´èºï¼Œå¯¹ä»–å†·å˜²çƒ­è®½ï¼Œè¯´äº†ä¸€äº›æ¯”è¾ƒéš¾å¬çš„è¯ï¼Œå¤§æ¦‚çš„æ„æ€å°±æ˜¯ã€Œä½ è¿˜å°ï¼Œä»¥åéœ€è¦è®¤çœŸå­¦ï¼Œä½ ä»¬å¤ªå«©äº†ã€ï¼Œå…¶å®æ€»è£çš„æ„æ€éå¸¸æ˜ç¡®äº†ï¼Œä¼šæ‹›ä»–ï¼Œä½†æ˜¯ä»–å¤ªå«©éœ€è¦å­¦å¾ˆå¤šä¸œè¥¿ï¼Œä½†æ˜¯å°±æ˜¯ä»–è¿™æ ·å¤§äººçœ‹å°å±å­©çš„æ„Ÿè§‰æƒ¹æ€’äº†ä»–ï¼Œåé¢ä»–çš„æ¼”è®²å°±æ˜¯ååˆ†é«˜èƒ½äº†ï¼Œæˆ‘å°½é‡åŸæ–‡å¤è¿°ã€‚ ã€Œä½ ååœ¨æˆ‘å‰é¢ä¼šä¸ä¼šæœ‰ç‚¹ç‚¹å®³æ€•å‘¢ï¼Ÿä½ çœ‹çœ‹ä½ èº«è¾¹æœ‰ä»€ä¹ˆäººå¯ä»¥ç»™ä½ å‚è€ƒå—ï¼Ÿä½ æ²¡æœ‰ï¼Œä½ åªèƒ½æˆ˜æˆ˜å…¢å…¢å¦‚å±¥è–„å†°ï¼Œèµ°é”™ä¸€æ­¥éƒ½æ˜¯æ·±æ¸Šã€‚ä½ çŸ¥é“ä½ åœ¨æˆ‘çœ¼é‡Œæ˜¯ä»€ä¹ˆå—ï¼Ÿä½ åªæ˜¯ä¸€ä¸ªçŒç‰©ï¼Œä¸€ä¸ªæˆ‘è¿½é€çš„ã€çŒæ€çš„çš„ç›®æ ‡ï¼Œå…¶å®ä½ å“ªé‡Œæ¥çš„è‡ªä¿¡å‘¢ï¼Ÿå°±å‡­ä½ æ˜¯è¿™ä¸ªå…¬å¸çš„æ€»è£å—ï¼Ÿæ¥è‡ªèŒçº§å’Œåˆ¶åº¦çš„å‹åŠ›æˆ‘ä¸€æ¦‚ä¸å±‘ï¼Œ åè€Œè§‰å¾—æ˜¯é»”é©´æŠ€ç©·ï¼Œå°äººåšæ³•ï¼Œæˆ‘ä¸ä¼šæœæ°”ï¼Œåªæ˜¯ç…§åšè€Œå·²ã€‚ å…¶å®æˆ‘ä¹Ÿå¾ˆäº«å—è¢«ç»Ÿæ²»çš„æ„Ÿè§‰ï¼Œä¸Šä¸€ä¸ªèƒ½ç»Ÿæ²»æˆ‘çš„äººå·²ç»å¾ˆä¹…äº†ï¼Œä½ çŸ¥é“é‚£ç§çº¯ç²¹çš„å®åŠ›å‹æœå—ï¼Ÿæˆ‘å¯ä»¥æ¯«æ— ä¿ç•™åœ°é¡ºä»ä»–çš„ä»»ä½•æ„è§ï¼Œæˆ‘ä»æ¥ä¸æ€€ç–‘ä»–çš„ä»»ä½•å†³å®šï¼Œå“ªæ€•è¡ŒåŠ¨åé¢å¤±è´¥äº†æˆ‘ä¹Ÿè§‰å¾—ä»–æ˜¯å¯¹çš„ã€‚ä½†æ˜¯ä½ å‘¢ï¼Ÿåªæ˜¯æ¥è‡ªåˆ¶åº¦çš„å¨åŠ›ï¼Œä½ çš„æ¯ä¸€ä¸ªå†³å®šéƒ½ä¼šé­åˆ°æˆ‘çš„è´¨ç–‘ã€‚ æˆ‘æœ€è®¨åŒçš„å°±æ˜¯åˆ«äººå’Œæˆ‘è¯´ï¼Œæˆ‘æƒ³è®©ä½ å»åšç‚¹ä»€ä¹ˆä½†æ˜¯ä½ èƒ½åŠ›è¿˜ä¸å¤Ÿï¼Œç®€ç›´çæ‰¯æ·¡ï¼Œå…¶å®æ˜¯ä½ èƒ½åŠ›ä¸å¤Ÿï¼Œä½œä¸ºä¸€ä¸ªç®¡ç†è€…ï¼Œä½ ç”šè‡³ä¸çŸ¥é“æ€ä¹ˆç”¨æˆ‘ï¼Œæˆ‘å¦‚ä½•ä¸ºä½ å–å‘½å•Šï¼Ÿ æˆ‘æ¸´æœ›çš„æ˜¯åœ¨ä¸€ä¸ªç¨³å®šçš„ç¯å¢ƒé»˜é»˜è€•è€˜ï¼ŒæŠŠåçš„å˜æˆå¥½çš„ï¼Œä½†æ˜¯å‰ææ˜¯æˆ‘ä»¬å¤Ÿå›¢é˜Ÿï¼Œä½ å‘¢ï¼Ÿå‡­ä½ ä½œä¸ºä¸€ä¸ªè¿‡æ¥äººçš„ç»éªŒå—ï¼Ÿè¿™äº›ä¸œè¥¿ç»è¿‡æ—¶é—´å¤§å®¶éƒ½ä¼šæœ‰çš„ï¼Œä½ è¿˜æœ‰å…¶ä»–çš„å—ï¼Ÿä½ çœŸçš„æœ‰èƒ½åŠ›æŠŠæˆ‘å˜æˆä½ çš„ä¸‰å¤´å…­è‡‚å—ï¼Ÿä½ çœŸçš„æ§åˆ¶å¾—ä½æˆ‘å—ï¼Ÿã€ å¤è¿°å…¶å®æ²¡é‚£ä¹ˆç²¾å½©äº†ï¼Œä»–æ”¯ç€æ‰‹ç›®å…‰çªç€æ€»è£çš„çœ¼ç›çš„æ—¶å€™è¶…çº§ç²¾å½©ï¼Œåé¢ä»–å»äº†ä¸€ä¸ªå¯¹æ‰‹å°å…¬å¸ï¼Œ ç›¸å½“äºè¿™è¾¹çš„å¸‚å€¼æ¥äº†ï¼Œç›¸å·®äº†åå€ä¹‹å¤šï¼Œä½†æ˜¯ä¸ƒä¸ªæœˆä¹‹åå†è§é¢å·²æ˜¯å…µåˆƒäº¤æ¥ï¼Œä»–æˆäº†å…­ä¸ªäººå›¢é˜Ÿçš„å°ä¸»ç®¡ï¼Œè€€æ­¦æ‰¬å¨åœ°å›´ç€æˆ‘ä»¬æ€»éƒ¨åŠå…¬åœ°ç›˜ä¸‹äº†ä¸€åœˆå¹¿å‘Šã€‚ ","date":"2022-03-04","objectID":"/posts/the-thoughtful-youth/:0:0","series":null,"tags":[],"title":"ã€Œè½¬ã€ä¸”çœ‹æœ‰æ€æƒ³çš„å¹´è½»äºº","uri":"/posts/the-thoughtful-youth/#"},{"categories":["tech"],"content":" æœ¬æ–‡ä¸»è¦ç¿»è¯‘è‡ª Practical-Cryptography-for-Developers-Bookï¼Œç¬”è€…é¢å¤–è¡¥å……äº† DHKE/ECDH çš„ä»£ç ç¤ºä¾‹ï¼Œä»¥åŠã€ŒPFS å®Œç¾å‰å‘ä¿å¯†åè®® DHE/ECDHEã€ä¸€èŠ‚ã€‚ ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-5-key-exchange/:0:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","å¯†é’¥äº¤æ¢","å®‰å…¨","DH","DHE","ECDH","ECDHE"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆäº”ï¼‰â€”â€” å¯†é’¥äº¤æ¢ DHKE ä¸å®Œç¾å‰å‘ä¿å¯† PFS","uri":"/posts/practical-cryptography-basics-5-key-exchange/#"},{"categories":["tech"],"content":" ä¸€ã€å‰è¨€åœ¨å¯†ç å­¦ä¸­å¯†é’¥äº¤æ¢æ˜¯ä¸€ç§åè®®ï¼ŒåŠŸèƒ½æ˜¯åœ¨ä¸¤æ–¹ä¹‹é—´å®‰å…¨åœ°äº¤æ¢åŠ å¯†å¯†é’¥ï¼Œå…¶ä»–ä»»ä½•äººéƒ½æ— æ³•è·å¾—å¯†é’¥çš„å‰¯æœ¬ã€‚é€šå¸¸å„ç§åŠ å¯†é€šè®¯åè®®çš„ç¬¬ä¸€æ­¥éƒ½æ˜¯å¯†é’¥äº¤æ¢ã€‚å¯†é’¥äº¤æ¢æŠ€æœ¯å…·ä½“æ¥è¯´æœ‰ä¸¤ç§æ–¹æ¡ˆï¼š å¯†é’¥åå•†ï¼šåè®®ä¸­çš„åŒæ–¹éƒ½å‚ä¸äº†å…±äº«å¯†é’¥çš„ç”Ÿæˆï¼Œä¸¤ä¸ªä»£è¡¨ç®—æ³•æ˜¯ Diffie-Hellman (DHKE) å’Œ Elliptic-Curve Diffie-Hellman (ECDH) å¯†é’¥ä¼ è¾“ï¼šåŒæ–¹ä¸­å…¶ä¸­ä¸€æ–¹ç”Ÿæˆå‡ºå…±äº«å¯†é’¥ï¼Œå¹¶é€šè¿‡æ­¤æ–¹æ¡ˆå°†å…±äº«å¯†é’¥ä¼ è¾“ç»™å¦ä¸€æ–¹ã€‚å¯†é’¥ä¼ è¾“æ–¹æ¡ˆé€šå¸¸éƒ½é€šè¿‡å…¬é’¥å¯†ç ç³»ç»Ÿå®ç°ã€‚æ¯”å¦‚åœ¨ RSA å¯†é’¥äº¤æ¢ä¸­ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨å®ƒçš„ç§é’¥åŠ å¯†ä¸€ä¸ªéšæœºç”Ÿæˆçš„ä¼šè¯å¯†é’¥ï¼Œç„¶åå°†å¯†æ–‡å‘é€ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å†ä½¿ç”¨å®ƒçš„å…¬é’¥è§£å¯†å‡ºä¼šè¯å¯†é’¥ã€‚ å¯†é’¥äº¤æ¢åè®®æ— æ—¶æ— åˆ»ä¸åœ¨æ•°å­—ä¸–ç•Œä¸­è¿è¡Œï¼Œåœ¨ä½ è¿æ¥ WiFi æ—¶ï¼Œæˆ–è€…ä½¿ç”¨ HTTPS åè®®è®¿é—®ä¸€ä¸ªç½‘ç«™ï¼Œéƒ½ä¼šæ‰§è¡Œå¯†é’¥äº¤æ¢åè®®ã€‚å¯†é’¥äº¤æ¢æœ‰å¾ˆå¤šæ‰‹æ®µï¼Œå¸¸è§æ‰‹æ®µæœ‰åŒ¿åçš„ DHKE å¯†é’¥åå•†åè®®ã€å¯†ç æˆ–é¢„å…±äº«å¯†é’¥ã€æ•°å­—è¯ä¹¦ç­‰ç­‰ã€‚æœ‰äº›é€šè®¯åè®®åªåœ¨å¼€å§‹æ—¶äº¤æ¢ä¸€æ¬¡å¯†é’¥ï¼Œè€Œæœ‰äº›åè®®åˆ™ä¼šéšç€æ—¶é—´çš„æ¨ç§»ä¸æ–­åœ°äº¤æ¢å¯†é’¥ã€‚ è®¤è¯å¯†é’¥äº¤æ¢ï¼ˆACHEï¼‰æ˜¯ä¸€ç§ä¼šåŒæ—¶è®¤è¯ç›¸å…³æ–¹èº«ä»½çš„å¯†é’¥äº¤æ¢åè®®ï¼Œæ¯”å¦‚ä¸ªäºº WiFi é€šå¸¸å°±ä¼šä½¿ç”¨ password-authenticated key agreement (PAKE)ï¼Œè€Œå¦‚æœä½ è¿æ¥çš„æ˜¯å…¬å¼€ WiFiï¼Œåˆ™ä¼šä½¿ç”¨åŒ¿åå¯†é’¥äº¤æ¢åè®®ã€‚ ç›®å‰æœ‰è®¸å¤šç”¨äºå¯†é’¥äº¤æ¢çš„å¯†ç ç®—æ³•ã€‚å…¶ä¸­ä¸€äº›ä½¿ç”¨å…¬é’¥å¯†ç ç³»ç»Ÿï¼Œè€Œå¦ä¸€äº›åˆ™ä½¿ç”¨æ›´ç®€å•çš„å¯†é’¥äº¤æ¢æ–¹æ¡ˆï¼ˆå¦‚ Diffie-Hellman å¯†é’¥äº¤æ¢ï¼‰ï¼›å…¶ä¸­æœ‰äº›ç®—æ³•æ¶‰åŠæœåŠ¡å™¨èº«ä»½éªŒè¯ï¼Œä¹Ÿæœ‰äº›æ¶‰åŠå®¢æˆ·ç«¯èº«ä»½éªŒè¯ï¼›å…¶ä¸­éƒ¨åˆ†ç®—æ³•ä½¿ç”¨å¯†ç ï¼Œå¦ä¸€éƒ¨åˆ†ä½¿ç”¨æ•°å­—è¯ä¹¦æˆ–å…¶ä»–èº«ä»½éªŒè¯æœºåˆ¶ã€‚ä¸‹é¢åˆ—ä¸¾ä¸€äº›çŸ¥åçš„å¯†é’¥äº¤æ¢ç®—æ³•ï¼š Diffie-Hellman Key Exchange (DHĞšĞ•)ï¼šä¼ ç»Ÿçš„ã€åº”ç”¨æœ€ä¸ºå¹¿æ³›çš„å¯†é’¥äº¤æ¢åè®® Elliptic-curve Diffieâ€“Hellman (ECDH)ï¼šåŸºäºæ¤­åœ†æ›²çº¿å¯†ç å­¦çš„å¯†é’¥äº¤æ¢ç®—æ³•ï¼ŒDHKE çš„ç»§ä»»è€… RSA-OAEP å’Œ RSA-KEMï¼ˆRSA å¯†é’¥ä¼ è¾“ï¼‰ PSKï¼ˆé¢„å…±äº«å¯†é’¥ï¼‰ SRPï¼ˆå®‰å…¨è¿œç¨‹å¯†ç åè®®ï¼‰ FHMQVï¼ˆFully Hashed Menezes-Qu-Vanstoneï¼‰ ECMQVï¼ˆEllictic-Curve Menezes-Qu-Vanstoneï¼‰ CECPQ1ï¼ˆé‡å­å®‰å…¨å¯†é’¥åè®®ï¼‰ ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-5-key-exchange/:1:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","å¯†é’¥äº¤æ¢","å®‰å…¨","DH","DHE","ECDH","ECDHE"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆäº”ï¼‰â€”â€” å¯†é’¥äº¤æ¢ DHKE ä¸å®Œç¾å‰å‘ä¿å¯† PFS","uri":"/posts/practical-cryptography-basics-5-key-exchange/#ä¸€å‰è¨€"},{"categories":["tech"],"content":" äºŒã€Diffieâ€“Hellman å¯†é’¥äº¤æ¢è¿ªè²-èµ«å°”æ›¼å¯†é’¥äº¤æ¢ï¼ˆDiffieâ€“Hellman Key Exchangeï¼‰æ˜¯ä¸€ç§å®‰å…¨åè®®ï¼Œå®ƒå¯ä»¥è®©åŒæ–¹åœ¨å®Œå…¨æ²¡æœ‰å¯¹æ–¹ä»»ä½•é¢„å…ˆä¿¡æ¯çš„æ¡ä»¶ä¸‹é€šè¿‡ä¸å®‰å…¨ä¿¡é“å®‰å…¨åœ°åå•†å‡ºä¸€ä¸ªå®‰å…¨å¯†é’¥ï¼Œè€Œä¸”ä»»ä½•çªƒå¬è€…éƒ½æ— æ³•å¾—çŸ¥å¯†é’¥ä¿¡æ¯ã€‚è¿™ä¸ªå¯†é’¥å¯ä»¥åœ¨åç»­çš„é€šè®¯ä¸­ä½œä¸ºå¯¹ç§°å¯†é’¥æ¥åŠ å¯†é€šè®¯å†…å®¹ã€‚ DHKE å¯ä»¥é˜²èŒƒå—…æ¢æ”»å‡»ï¼ˆçªƒå¬ï¼‰ï¼Œä½†æ˜¯æ— æ³•æŠµæŒ¡ä¸­é—´äººæ”»å‡»ï¼ˆä¸­ç»§ï¼‰ã€‚ DHKE æœ‰ä¸¤ç§å®ç°æ–¹æ¡ˆï¼š ä¼ ç»Ÿçš„ DHKE ç®—æ³•ï¼šä½¿ç”¨ç¦»æ•£å¯¹æ•°å®ç° åŸºäºæ¤­åœ†æ›²çº¿å¯†ç å­¦çš„ ECDH ä¸ºäº†ç†è§£ DHKE å¦‚ä½•å®ç°åœ¨ã€Œå¤§åº­å¹¿ä¼—ä¹‹ä¸‹ã€å®‰å…¨åœ°åå•†å‡ºå¯†é’¥ï¼Œæˆ‘ä»¬é¦–å…ˆä½¿ç”¨è‰²å½©æ··åˆæ¥å½¢è±¡åœ°è§£é‡Šä¸‹å®ƒå¤§è‡´çš„æ€è·¯ã€‚ è·Ÿç¼–ç¨‹è¯­è¨€çš„ Hello World ä¸€æ ·ï¼Œå¯†é’¥äº¤æ¢çš„è§£é‡Šé€šå¸¸ä¼šä½¿ç”¨ Alice è·Ÿ Bob æ¥ä½œä¸ºé€šä¿¡åŒæ–¹ã€‚ç°åœ¨ä»–ä¿©æƒ³è¦åœ¨å…¬å¼€çš„ä¿¡é“ä¸Šï¼Œåå•†å‡ºä¸€ä¸ªç§˜å¯†è‰²å½©å‡ºæ¥ï¼Œä½†æ˜¯ä¸å¸Œæœ›å…¶ä»–ä»»ä½•äººçŸ¥é“è¿™ä¸ªç§˜å¯†è‰²å½©ã€‚ä»–ä»¬å¯ä»¥è¿™æ ·åšï¼š åˆ†æ­¥è§£é‡Šå¦‚ä¸‹ï¼š é¦–å…ˆ Alice è·Ÿ Bob æ²Ÿé€šï¼Œç¡®å®šä¸€ä¸ªåˆå§‹çš„è‰²å½©ï¼Œæ¯”å¦‚é»„è‰²ã€‚è¿™ä¸ªæ²Ÿé€šä¸éœ€è¦ä¿å¯†ã€‚ ç„¶åï¼ŒAlice è·Ÿ Bob åˆ†åˆ«å·å·åœ°é€‰æ‹©å‡ºä¸€ä¸ªè‡ªå·±çš„ç§˜å¯†è‰²å½©ï¼Œè¿™ä¸ªå°±å¾—ä¿å¯†å•¦ã€‚ ç°åœ¨ Alice è·Ÿ Bobï¼Œåˆ†åˆ«å°†åˆå§‹è‰²å½©è·Ÿè‡ªå·±é€‰æ‹©çš„ç§˜å¯†è‰²å½©æ··åˆï¼Œåˆ†åˆ«å¾—åˆ°ä¸¤ä¸ªæ··åˆè‰²å½©ã€‚ ä¹‹åï¼ŒAlice è·Ÿ Bob å†å›åˆ°å…¬å¼€ä¿¡é“ä¸Šï¼Œäº¤æ¢åŒæ–¹çš„æ··åˆè‰²å½©ã€‚ æˆ‘ä»¬å‡è®¾åœ¨ä»…çŸ¥é“åˆå§‹è‰²å½©è·Ÿæ··åˆè‰²å½©çš„æƒ…å†µä¸‹ï¼Œå¾ˆéš¾æ¨å¯¼å‡ºè¢«æ··åˆçš„ç§˜å¯†è‰²å½©ã€‚è¿™æ ·ç¬¬ä¸‰æ–¹å°±çŒœä¸å‡º Bob è·Ÿ Alice åˆ†åˆ«é€‰æ‹©äº†ä»€ä¹ˆç§˜å¯†è‰²å½©äº†ã€‚ æœ€å Alice è·Ÿ Bob å†åˆ†åˆ«å°†è‡ªå·±çš„ç§˜å¯†è‰²å½©ï¼Œè·Ÿå¯¹æ–¹çš„æ··åˆè‰²å½©æ··åˆï¼Œå°±å¾—åˆ°äº†æœ€ç»ˆçš„ç§˜å¯†è‰²å½©ã€‚è¿™ä¸ªæœ€ç»ˆè‰²å½©åªæœ‰ Alice è·Ÿ Bob çŸ¥é“ï¼Œä¿¡é“ä¸Šçš„ä»»ä½•äººéƒ½æ— æ³•çŒœå‡ºæ¥ã€‚ DHKE åè®®ä¹Ÿæ˜¯åŸºäºç±»ä¼¼çš„åŸç†ï¼Œä½†æ˜¯ä½¿ç”¨çš„æ˜¯ç¦»æ•£å¯¹æ•°ï¼ˆdiscrete logarithmsï¼‰è·Ÿæ¨¡å¹‚ï¼ˆmodular exponentiationsï¼‰è€Œä¸æ˜¯è‰²å½©æ··åˆã€‚ ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-5-key-exchange/:2:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","å¯†é’¥äº¤æ¢","å®‰å…¨","DH","DHE","ECDH","ECDHE"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆäº”ï¼‰â€”â€” å¯†é’¥äº¤æ¢ DHKE ä¸å®Œç¾å‰å‘ä¿å¯† PFS","uri":"/posts/practical-cryptography-basics-5-key-exchange/#äºŒdiffiehellman-å¯†é’¥äº¤æ¢"},{"categories":["tech"],"content":" ä¸‰ã€ç»å…¸ DHKE åè®®","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-5-key-exchange/:3:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","å¯†é’¥äº¤æ¢","å®‰å…¨","DH","DHE","ECDH","ECDHE"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆäº”ï¼‰â€”â€” å¯†é’¥äº¤æ¢ DHKE ä¸å®Œç¾å‰å‘ä¿å¯† PFS","uri":"/posts/practical-cryptography-basics-5-key-exchange/#ä¸‰ç»å…¸-dhke-åè®®"},{"categories":["tech"],"content":" åŸºç¡€æ•°å­¦çŸ¥è¯†é¦–å…ˆä»‹ç»ä¸‹ã€Œæ¨¡å¹‚ï¼ˆmodular exponentiationsï¼‰ã€ï¼Œå®ƒæ˜¯æŒ‡æ±‚ $g$ çš„ $a$ æ¬¡å¹‚æ¨¡ $p$ çš„å€¼ $c$ çš„è¿‡ç¨‹ï¼Œå…¶ä¸­ $g$ $a$ $p$ $c$ å‡ä¸ºæ•´æ•°ï¼Œå…¬å¼å¦‚ä¸‹ï¼š $$ g^a \\mod p = c $$ è€Œã€Œç¦»æ•£å¯¹æ•°ï¼ˆdiscrete logarithmsï¼‰ã€ï¼Œå…¶å®å°±æ˜¯æŒ‡æ¨¡å¹‚çš„é€†è¿ç®—ï¼Œå®ƒä½¿ç”¨å¦‚ä¸‹å…¬å¼è¡¨ç¤ºï¼š $$ Ind_{g}c \\equiv a {\\pmod {p}} $$ ä¸Šè¿°å…¬å¼ï¼Œå³æŒ‡åœ¨å·²çŸ¥æ•´æ•° $g$ï¼Œè´¨æ•° $p$ï¼Œä»¥åŠä½™æ•°ï¼ˆp çš„ä¸€ä¸ªåŸæ ¹ï¼‰ $c$ çš„æƒ…å†µä¸‹ï¼Œæ±‚ä½¿å‰é¢çš„æ¨¡å¹‚ç­‰å¼æˆç«‹çš„å¹‚æŒ‡æ•° $a$ã€‚ å·²çŸ¥ä½¿ç”¨è®¡ç®—æœºè®¡ç®—ä¸Šè¿°ã€Œæ¨¡å¹‚ã€æ˜¯éå¸¸å¿«é€Ÿçš„ï¼Œä½†æ˜¯åœ¨è´¨æ•° $p$ éå¸¸å¤§çš„æƒ…å†µä¸‹ï¼Œæ±‚ã€Œç¦»æ•£å¯¹æ•°ã€å´æ˜¯éå¸¸éš¾çš„ï¼Œè¿™å°±æ˜¯ã€Œç¦»æ•£å¯¹æ•°éš¾é¢˜ã€ã€‚ ç„¶åä¸ºäº†ç†è§£ DHKE çš„åŸç†ï¼Œæˆ‘ä»¬è¿˜éœ€è¦äº†è§£ä¸‹æ¨¡å¹‚è¿ç®—çš„ä¸€ä¸ªæ€§è´¨ï¼š $$ g^{ab} \\mod p = {(g^a \\mod p)}^b \\mod p $$ æ‡‚äº†ä¸Šé¢è¿™äº›åŸºç¡€æ•°å­¦çŸ¥è¯†ï¼Œä¸‹é¢å°±å¼€å§‹ä»‹ç» DHKE ç®—æ³•ã€‚ ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-5-key-exchange/:3:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","å¯†é’¥äº¤æ¢","å®‰å…¨","DH","DHE","ECDH","ECDHE"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆäº”ï¼‰â€”â€” å¯†é’¥äº¤æ¢ DHKE ä¸å®Œç¾å‰å‘ä¿å¯† PFS","uri":"/posts/practical-cryptography-basics-5-key-exchange/#åŸºç¡€æ•°å­¦çŸ¥è¯†"},{"categories":["tech"],"content":" DHKE å¯†é’¥äº¤æ¢æµç¨‹ä¸‹é¢è¯¥è½®åˆ° Alice è·Ÿ Bob å‡ºåœºæ¥ä»‹ç» DHKE çš„è¿‡ç¨‹äº†ï¼Œå…ˆçœ‹å›¾ï¼ˆä¸‹é¢ç»¿è‰²è¡¨ç¤ºéç§˜å¯†ä¿¡æ¯ï¼Œçº¢è‰²è¡¨ç¤ºç§˜å¯†ä¿¡æ¯ï¼‰ï¼š Alice è·Ÿ Bob åå®šä½¿ç”¨ä¸¤ä¸ªæ¯”è¾ƒç‹¬ç‰¹çš„æ­£æ•´æ•° $p$ è·Ÿ$g$ å‡è®¾ $p=23$, $g=5$ Alice é€‰æ‹©ä¸€ä¸ªç§˜å¯†æ•´æ•° $a$ï¼Œè®¡ç®—$A$$= g^a \\mod p$ å¹¶å‘é€ç»™ Bob å‡è®¾ $a=4$ï¼Œåˆ™$A$$= 5^4 \\mod 23 = 4$ Bob ä¹Ÿé€‰æ‹©ä¸€ä¸ªç§˜å¯†æ•´æ•° $b$ï¼Œè®¡ç®—$B$$= g^b \\mod p$ å¹¶å‘é€ç»™ Alice å‡è®¾ $b=3$ï¼Œåˆ™$B$$= 5^3 \\mod 23 = 10$ Alice è®¡ç®— $S_1 = B^a \\mod p$ $S_1 = 10^4 \\mod 23 = 18$ Bob è®¡ç®— $S_2 = A^b \\mod p$ $S_2 = 4^3 \\mod 23 = 18$ å·²çŸ¥ $B^a \\mod p = g^{ab} \\mod p = A^b \\mod p$ï¼Œå› æ­¤$S_1 = S_2 = S$ è¿™æ · Alice è·Ÿ Bob å°±åå•†å‡ºäº†å¯†é’¥ $S$ å› ä¸ºç¦»æ•£å¯¹æ•°çš„è®¡ç®—éå¸¸éš¾ï¼Œä»»ä½•çªƒå¬è€…éƒ½å‡ ä¹ä¸å¯èƒ½é€šè¿‡å…¬å¼€çš„ $p$ $g$ $A$ $B$ é€†æ¨å‡º $S$ çš„å€¼ åœ¨æœ€å¸¸è§çš„ DHKE å®ç°ä¸­ï¼ˆRFC3526ï¼‰ï¼ŒåŸºæ•°æ˜¯ $g = 2$ï¼Œ æ¨¡æ•° $p$ æ˜¯ä¸€ä¸ª 1536 åˆ° 8192 æ¯”ç‰¹çš„å¤§ç´ æ•°ã€‚è€Œæ•´æ•° $A$ $B$ é€šå¸¸ä¼šä½¿ç”¨éå¸¸å¤§çš„æ•°å­—ï¼ˆ1024ã€2048 æˆ– 4096 æ¯”ç‰¹ç”šè‡³æ›´å¤§ï¼‰ä»¥é˜²èŒƒæš´åŠ›ç ´è§£ã€‚ DHKE åè®®åŸºäº Diffie-Hellman é—®é¢˜çš„å®é™…éš¾åº¦ï¼Œè¿™æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­ä¼—æ‰€å‘¨çŸ¥çš„ç¦»æ•£å¯¹æ•°é—®é¢˜ï¼ˆDLPï¼‰ çš„å˜ä½“ï¼Œç›®å‰è¿˜ä¸å­˜åœ¨æœ‰æ•ˆçš„ç®—æ³•ã€‚ ä½¿ç”¨ Python æ¼”ç¤ºä¸‹å¤§æ¦‚æ˜¯è¿™æ ·ï¼š python # pip install cryptography==36.0.1 from cryptography.hazmat.primitives import hashes from cryptography.hazmat.primitives.asymmetric import dh # 1. åŒæ–¹åå•†ä½¿ç”¨ä¸¤ä¸ªç‹¬ç‰¹çš„æ­£æ•´æ•° g ä¸ p ## generator =\u003e å³åŸºæ•° gï¼Œé€šå¸¸ä½¿ç”¨ 2, æœ‰æ—¶ä¹Ÿä½¿ç”¨ 5 ## key_size =\u003e æ¨¡æ•° p çš„é•¿åº¦ï¼Œé€šå¸¸ä½¿ç”¨ 2048-3072 ä½ï¼ˆ2048 ä½çš„å®‰å…¨æ€§æ­£åœ¨å‡å¼±ï¼‰ params = dh.generate_parameters(generator=2, key_size=2048) param_numbers = params.parameter_numbers() g = param_numbers.g # =\u003e è‚¯å®šæ˜¯ 2 p = param_numbers.p # =\u003e ä¸€ä¸ª 2048 ä½çš„æ•´æ•° print(f\"{g=}, {p=}\") # 2. Alice ç”Ÿæˆè‡ªå·±çš„ç§˜å¯†æ•´æ•° a ä¸å…¬å¼€æ•´æ•° A alice_priv_key = params.generate_private_key() a = alice_priv_key.private_numbers().x A = alice_priv_key.private_numbers().public_numbers.y print(f\"{a=}\") print(f\"{A=}\") # 3. Bob ç”Ÿæˆè‡ªå·±çš„ç§˜å¯†æ•´æ•° b ä¸å…¬å¼€æ•´æ•° B bob_priv_key = params.generate_private_key() b = bob_priv_key.private_numbers().x B = bob_priv_key.private_numbers().public_numbers.y print(f\"{b=}\") print(f\"{B=}\") # 4. Alice ä¸ Bob å…¬å¼€äº¤æ¢æ•´æ•° A è·Ÿ Bï¼ˆå³å„è‡ªçš„å…¬é’¥ï¼‰ # 5. Alice ä½¿ç”¨ a B ä¸ p è®¡ç®—å‡ºå…±äº«å¯†é’¥ ## é¦–å…ˆä½¿ç”¨ B p g æ„é€ å‡º bob çš„å…¬é’¥å¯¹è±¡ï¼ˆå®é™…ä¸Š g ä¸å‚ä¸è®¡ç®—ï¼‰ bob_pub_numbers = dh.DHPublicNumbers(B, param_numbers) bob_pub_key = bob_pub_numbers.public_key() ## è®¡ç®—å…±äº«å¯†é’¥ alice_shared_key = alice_priv_key.exchange(bob_pub_key) # 6. Bob ä½¿ç”¨ b A ä¸ p è®¡ç®—å‡ºå…±äº«å¯†é’¥ ## é¦–å…ˆä½¿ç”¨ A p g æ„é€ å‡º alice çš„å…¬é’¥å¯¹è±¡ï¼ˆå®é™…ä¸Š g ä¸å‚ä¸è®¡ç®—ï¼‰ alice_pub_numbers = dh.DHPublicNumbers(A, param_numbers) alice_pub_key = alice_pub_numbers.public_key() ## è®¡ç®—å…±äº«å¯†é’¥ bob_shared_key = bob_priv_key.exchange(alice_pub_key) # ä¸¤è€…åº”è¯¥å®Œå…¨ç›¸ç­‰ï¼Œ Alice ä¸ Bob å®Œæˆç¬¬ä¸€æ¬¡å¯†é’¥äº¤æ¢ alice_shared_key == bob_shared_key # 7. Alice ä¸ Bob ä½¿ç”¨ shared_key è¿›è¡Œå¯¹ç§°åŠ å¯†é€šè®¯ ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-5-key-exchange/:3:2","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","å¯†é’¥äº¤æ¢","å®‰å…¨","DH","DHE","ECDH","ECDHE"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆäº”ï¼‰â€”â€” å¯†é’¥äº¤æ¢ DHKE ä¸å®Œç¾å‰å‘ä¿å¯† PFS","uri":"/posts/practical-cryptography-basics-5-key-exchange/#dhke-å¯†é’¥äº¤æ¢æµç¨‹"},{"categories":["tech"],"content":" å››ã€æ–°ä¸€ä»£ ECDH åè®®Elliptic-Curve Diffie-Hellman (ECDH) æ˜¯ä¸€ç§åŒ¿åå¯†é’¥åå•†åè®®ï¼Œå®ƒå…è®¸ä¸¤æ–¹ï¼Œæ¯æ–¹éƒ½æœ‰ä¸€ä¸ªæ¤­åœ†æ›²çº¿å…¬é’¥-ç§é’¥å¯¹ï¼Œå®ƒçš„åŠŸèƒ½ä¹Ÿæ˜¯è®©åŒæ–¹åœ¨å®Œå…¨æ²¡æœ‰å¯¹æ–¹ä»»ä½•é¢„å…ˆä¿¡æ¯çš„æ¡ä»¶ä¸‹é€šè¿‡ä¸å®‰å…¨ä¿¡é“å®‰å…¨åœ°åå•†å‡ºä¸€ä¸ªå®‰å…¨å¯†é’¥ã€‚ ECDH æ˜¯ç»å…¸ DHKE åè®®çš„å˜ä½“ï¼Œå…¶ä¸­æ¨¡å¹‚è®¡ç®—è¢«æ¤­åœ†æ›²çº¿çš„ä¹˜æ³•è®¡ç®—å–ä»£ï¼Œä»¥æé«˜å®‰å…¨æ€§ã€‚ ECDH è·Ÿå‰é¢ä»‹ç»çš„ DHKE éå¸¸ç›¸ä¼¼ï¼Œåªè¦ä½ ç†è§£äº†æ¤­åœ†æ›²çº¿çš„æ•°å­¦åŸç†ï¼Œç»“åˆå‰é¢å·²ç»ä»‹ç»äº†çš„ DHKEï¼ŒåŸºæœ¬ä¸Šå¯ä»¥ç§’æ‡‚ã€‚æˆ‘ä¼šåœ¨åé¢ã€Œéå¯¹ç§°ç®—æ³•ã€ä¸€æ–‡ä¸­ç®€å•ä»‹ç»æ¤­åœ†æ›²çº¿çš„æ•°å­¦åŸç†ï¼Œä¸è¿‡è¿™é‡Œä¹Ÿå¯ä»¥å…ˆæä¸€ä¸‹ ECDH ä¾èµ–çš„å…¬å¼ï¼ˆå…¶ä¸­ $a, b$ ä¸ºå¸¸æ•°ï¼Œ$G$ ä¸ºæ¤­åœ†æ›²çº¿ä¸Šçš„æŸä¸€ç‚¹çš„åæ ‡ $(x, y)$ï¼‰ï¼š $$ (a * G) * b = (b * G) * a $$ è¿™ä¸ªå…¬å¼è¿˜æ˜¯æŒºç›´è§‚çš„å§ï¼Œæ„Ÿè§‰å°å­¦ç”Ÿä¹Ÿèƒ½ç†è§£ä¸ªå¤§æ¦‚ã€‚ä¸‹é¢ç®€å•ä»‹ç»ä¸‹ ECDH çš„æµç¨‹ï¼š Alice è·Ÿ Bob åå•†å¥½æ¤­åœ†æ›²çº¿çš„å„é¡¹å‚æ•°ï¼Œä»¥åŠåŸºç‚¹ Gï¼Œè¿™äº›å‚æ•°éƒ½æ˜¯å…¬å¼€çš„ã€‚ Alice ç”Ÿæˆä¸€ä¸ªéšæœºçš„ ECC å¯†é’¥å¯¹ï¼ˆå…¬é’¥ï¼š$alicePrivate * G$, ç§é’¥: $alicePrivate$ï¼‰ Bob ç”Ÿæˆä¸€ä¸ªéšæœºçš„ ECC å¯†é’¥å¯¹ï¼ˆå…¬é’¥ï¼š$bobPrivate * G$, ç§é’¥: $bobPrivate$ï¼‰ ä¸¤äººé€šè¿‡ä¸å®‰å…¨çš„ä¿¡é“äº¤æ¢å…¬é’¥ Alice å°† Bob çš„å…¬é’¥ä¹˜ä¸Šè‡ªå·±çš„ç§é’¥ï¼Œå¾—åˆ°å…±äº«å¯†é’¥ $sharedKey = (bobPrivate * G) * alicePrivate$ Bob å°† Alice çš„å…¬é’¥ä¹˜ä¸Šè‡ªå·±çš„ç§é’¥ï¼Œå¾—åˆ°å…±äº«å¯†é’¥ $sharedKey = (alicePrivate * G) * bobPrivate$ å› ä¸ºå‰é¢æåˆ°çš„å…¬å¼ï¼ŒAlice ä¸ Bob è®¡ç®—å‡ºçš„å…±äº«å¯†é’¥åº”è¯¥æ˜¯ç›¸ç­‰çš„ è¿™æ ·ä¸¤æ–¹å°±é€šè¿‡ ECDH å®Œæˆäº†å¯†é’¥äº¤æ¢ã€‚ è€Œ ECDH çš„å®‰å…¨æ€§ï¼Œåˆ™ç”± ECDLP é—®é¢˜æä¾›ä¿è¯ã€‚è¿™ä¸ªé—®é¢˜æ˜¯è¯´ï¼Œã€Œé€šè¿‡å…¬å¼€çš„ $kG$ ä»¥åŠ $G$ è¿™ä¸¤ä¸ªå‚æ•°ï¼Œç›®å‰æ²¡æœ‰æœ‰æ•ˆçš„æ‰‹æ®µèƒ½å¿«é€Ÿæ±‚è§£å‡º $k$ çš„å€¼ã€‚ã€ ä»ä¸Šé¢çš„æµç¨‹ä¸­èƒ½çœ‹åˆ°ï¼Œå…¬é’¥å°±æ˜¯ ECDLP ä¸­çš„ $kG$ï¼Œå¦å¤– $G$ ä¹Ÿæ˜¯å…¬å¼€çš„ï¼Œè€Œç§é’¥å°±æ˜¯ ECDLP ä¸­çš„ $k$ã€‚å› ä¸º ECDLP é—®é¢˜çš„å­˜åœ¨ï¼Œæ”»å‡»è€…ç ´è§£ä¸å‡º Alice è·Ÿ Bob çš„ç§é’¥ã€‚ ä»£ç ç¤ºä¾‹ï¼š python # pip install tinyec # ECC æ›²çº¿åº“ from tinyec import registry import secrets def compress(pubKey): return hex(pubKey.x) + hex(pubKey.y % 2)[2:] curve = registry.get_curve('brainpoolP256r1') alicePrivKey = secrets.randbelow(curve.field.n) alicePubKey = alicePrivKey * curve.g print(\"Alice public key:\", compress(alicePubKey)) bobPrivKey = secrets.randbelow(curve.field.n) bobPubKey = bobPrivKey * curve.g print(\"Bob public key:\", compress(bobPubKey)) print(\"Now exchange the public keys (e.g. through Internet)\") aliceSharedKey = alicePrivKey * bobPubKey print(\"Alice shared key:\", compress(aliceSharedKey)) bobSharedKey = bobPrivKey * alicePubKey print(\"Bob shared key:\", compress(bobSharedKey)) print(\"Equal shared keys:\", aliceSharedKey == bobSharedKey) ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-5-key-exchange/:4:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","å¯†é’¥äº¤æ¢","å®‰å…¨","DH","DHE","ECDH","ECDHE"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆäº”ï¼‰â€”â€” å¯†é’¥äº¤æ¢ DHKE ä¸å®Œç¾å‰å‘ä¿å¯† PFS","uri":"/posts/practical-cryptography-basics-5-key-exchange/#å››æ–°ä¸€ä»£-ecdh-åè®®"},{"categories":["tech"],"content":" äº”ã€PFS å®Œç¾å‰å‘ä¿å¯†åè®® DHE/ECDHEå‰é¢ä»‹ç»çš„ç»å…¸ DHKE ä¸ ECDH åè®®æµç¨‹ï¼Œéƒ½æ˜¯åœ¨æœ€å¼€å§‹æ—¶äº¤æ¢ä¸€æ¬¡å¯†é’¥ï¼Œä¹‹åå°±ä¸€ç›´ä½¿ç”¨è¯¥å¯†é’¥é€šè®¯ã€‚å› æ­¤å¦‚æœå¯†é’¥è¢«ç ´è§£ï¼Œæ•´ä¸ªä¼šè¯çš„æ‰€æœ‰ä¿¡æ¯å¯¹æ”»å‡»è€…è€Œè¨€å°±å®Œå…¨é€æ˜äº†ã€‚ ä¸ºäº†è¿›ä¸€æ­¥æé«˜å®‰å…¨æ€§ï¼Œå¯†ç å­¦å®¶æå‡ºäº†ã€Œå®Œå…¨å‰å‘ä¿å¯†ï¼ˆPerfect Forward Secrecyï¼ŒPFSï¼‰ã€çš„æ¦‚å¿µï¼Œå¹¶åœ¨ DHKE ä¸ ECDH çš„åŸºç¡€ä¸Šæå‡ºäº†æ”¯æŒ PFS çš„ DHE/ECDHE åè®®ï¼ˆæœ«å°¾çš„ E æ˜¯ephemeral çš„ç¼©å†™ï¼Œå³æŒ‡æ‰€æœ‰çš„å…±äº«å¯†é’¥éƒ½æ˜¯ä¸´æ—¶çš„ï¼‰ã€‚ ã€Œå®Œå…¨å‰å‘ä¿å¯† PFSã€æ˜¯æŒ‡é•¿æœŸä½¿ç”¨çš„ä¸»å¯†é’¥æ³„æ¼ä¸ä¼šå¯¼è‡´è¿‡å»çš„ä¼šè¯å¯†é’¥æ³„æ¼ï¼Œä»è€Œä¿æŠ¤è¿‡å»è¿›è¡Œçš„é€šè®¯ä¸å—å¯†ç æˆ–å¯†é’¥åœ¨æœªæ¥æš´éœ²çš„å¨èƒã€‚ ä¸‹é¢ä½¿ç”¨ Python æ¼”ç¤ºä¸‹ DHE åè®®çš„æµç¨‹ï¼ˆECDHE çš„æµç¨‹ä¹Ÿå®Œå…¨ç±»ä¼¼ï¼‰ï¼š python # pip install cryptography==36.0.1 from cryptography.hazmat.primitives import hashes from cryptography.hazmat.primitives.asymmetric import dh # 1. åŒæ–¹åå•†ä½¿ç”¨ä¸¤ä¸ªç‹¬ç‰¹çš„æ­£æ•´æ•° g ä¸ p ## generator =\u003e å³åŸºæ•° gï¼Œé€šå¸¸ä½¿ç”¨ 2, æœ‰æ—¶ä¹Ÿä½¿ç”¨ 5 ## key_size =\u003e æ¨¡æ•° p çš„é•¿åº¦ï¼Œé€šå¸¸ä½¿ç”¨ 2048-3072 ä½ï¼ˆ2048 ä½çš„å®‰å…¨æ€§æ­£åœ¨å‡å¼±ï¼‰ params = dh.generate_parameters(generator=2, key_size=2048) param_numbers = params.parameter_numbers() g = param_numbers.g # =\u003e è‚¯å®šæ˜¯ 2 p = param_numbers.p # =\u003e ä¸€ä¸ª 2048 ä½çš„æ•´æ•° print(f\"{g=}, {p=}\") # 2. Alice ç”Ÿæˆè‡ªå·±çš„ç§˜å¯†æ•´æ•° a ä¸å…¬å¼€æ•´æ•° A alice_priv_key = params.generate_private_key() a = alice_priv_key.private_numbers().x A = alice_priv_key.private_numbers().public_numbers.y print(f\"{a=}\") print(f\"{A=}\") # 3. Bob ç”Ÿæˆè‡ªå·±çš„ç§˜å¯†æ•´æ•° b ä¸å…¬å¼€æ•´æ•° B bob_priv_key = params.generate_private_key() b = bob_priv_key.private_numbers().x B = bob_priv_key.private_numbers().public_numbers.y print(f\"{b=}\") print(f\"{B=}\") # 4. Alice ä¸ Bob å…¬å¼€äº¤æ¢æ•´æ•° A è·Ÿ Bï¼ˆå³å„è‡ªçš„å…¬é’¥ï¼‰ # 5. Alice ä½¿ç”¨ a B ä¸ p è®¡ç®—å‡ºå…±äº«å¯†é’¥ ## é¦–å…ˆä½¿ç”¨ B p g æ„é€ å‡º bob çš„å…¬é’¥å¯¹è±¡ï¼ˆå®é™…ä¸Š g ä¸å‚ä¸è®¡ç®—ï¼‰ bob_pub_numbers = dh.DHPublicNumbers(B, param_numbers) bob_pub_key = bob_pub_numbers.public_key() ## è®¡ç®—å…±äº«å¯†é’¥ alice_shared_key = alice_priv_key.exchange(bob_pub_key) # 6. Bob ä½¿ç”¨ b A ä¸ p è®¡ç®—å‡ºå…±äº«å¯†é’¥ ## é¦–å…ˆä½¿ç”¨ A p g æ„é€ å‡º alice çš„å…¬é’¥å¯¹è±¡ï¼ˆå®é™…ä¸Š g ä¸å‚ä¸è®¡ç®—ï¼‰ alice_pub_numbers = dh.DHPublicNumbers(A, param_numbers) alice_pub_key = alice_pub_numbers.public_key() ## è®¡ç®—å…±äº«å¯†é’¥ bob_shared_key = bob_priv_key.exchange(alice_pub_key) # ä¸Šé¢çš„æµç¨‹è·Ÿç»å…¸ DHKE å®Œå…¨ä¸€è‡´ï¼Œä»£ç ä¹Ÿæ˜¯ä»å‰é¢ Copy ä¸‹æ¥çš„ # ä½†æ˜¯ä»è¿™é‡Œå¼€å§‹ï¼Œè¿›å…¥ DHE åè®®è¡¥å……çš„éƒ¨åˆ† shared_key_1 = bob_shared_key # ç¬¬ä¸€ä¸ªå…±äº«å¯†é’¥ # 7. å‡è®¾ Bob ç°åœ¨è¦å‘é€æ¶ˆæ¯ M_b_1 ç»™ Alice ## é¦–å…ˆ Bob ä½¿ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•åŠ å¯†æ¶ˆæ¯ M_b M_b_1 = \"Hello Alice, I'm bob~\" C_b_1 = Encrypt(M_b_1, shared_key_1) # Encrypt æ˜¯æŸç§å¯¹ç§°åŠ å¯†æ–¹æ¡ˆçš„åŠ å¯†ç®—æ³•ï¼Œå¦‚ AES-256-CTR-HMAC-SHA-256 ## ç„¶å Bob éœ€è¦ç”Ÿæˆä¸€ä¸ªæ–°çš„å…¬ç§é’¥ b_2 ä¸ B_2ï¼ˆæ³¨æ„ g ä¸ p ä¸¤ä¸ªå‚æ•°æ˜¯ä¸å˜çš„ï¼‰ bob_priv_key_2 = parameters.generate_private_key() b_2 = bob_priv_key.private_numbers().x B_2 = bob_priv_key.private_numbers().public_numbers.y print(f\"{b_2=}\") print(f\"{B_2=}\") # 8. Bob å°† C_b_1 ä¸ B_2 ä¸€èµ·å‘é€ç»™ Alice # 9. Alice é¦–å…ˆè§£å¯†æ•°æ® C_b_1 å¾—åˆ°åŸå§‹æ¶ˆæ¯ M_b_1 assert M_b_1 == Decrypt(C_b_1, shared_key_1) # Dncrypt æ˜¯æŸç§å¯¹ç§°åŠ å¯†æ–¹æ¡ˆçš„è§£å¯†ç®—æ³•ï¼Œå¦‚ AES-256-CTR-HMAC-SHA-256 ## ç„¶å Alice ä¹Ÿç”Ÿæˆæ–°çš„å…¬ç§é’¥ a_2 ä¸ A_2 alice_priv_key_2 = parameters.generate_private_key() ## Alice ä½¿ç”¨ a_2 B_2 ä¸ p è®¡ç®—å‡ºæ–°çš„å…±äº«å¯†é’¥ shared_key_2 bob_pub_numbers_2 = dh.DHPublicNumbers(B_2, param_numbers) bob_pub_key_2 = bob_pub_numbers_2.public_key() shared_key_2 = alice_priv_key_2.exchange(bob_pub_key_2) # 10. Alice å›å¤ Bob æ¶ˆæ¯æ—¶ï¼Œä½¿ç”¨æ–°å…±äº«å¯†é’¥ shared_key_2 åŠ å¯†æ¶ˆæ¯å¾—åˆ° C_a_1 # ç„¶åå°†å¯†æ–‡ C_a_1 ä¸ A_2 ä¸€èµ·å‘é€ç»™ Bob # 11. Bob ä½¿ç”¨ b_2 A_2 ä¸ p è®¡ç®—å‡ºå…±äº«å¯†é’¥ shared_key_2 # ç„¶åå†ä½¿ç”¨ shared_key_2 è§£å¯†æ•°æ® # Bob åœ¨ä¸‹æ¬¡å‘é€æ¶ˆæ¯æ—¶ï¼Œä¼šç”Ÿæˆæ–°çš„ b_3 ä¸ B_3ï¼Œå°† B_3 éšå¯†æ–‡ä¸€èµ·å‘é€ ## ä¾æ¬¡ç±»æ¨ é€šè¿‡ä¸Šé¢çš„ä»£ç æè¿°æˆ‘ä»¬åº”è¯¥èƒ½ç†è§£åˆ°ï¼ŒAlice ä¸ Bob æ¯æ¬¡äº¤æ¢æ•°æ®ï¼Œå®é™…ä¸Šéƒ½ä¼šç”Ÿæˆæ–°çš„ä¸´æ—¶å…±äº«å¯†é’¥ï¼Œå…¬é’¥å¯†é’¥åœ¨æ¯æ¬¡æ•°æ®äº¤æ¢æ—¶éƒ½ä¼šæ›´æ–°ã€‚å³ä½¿æ”»å‡»è€…èŠ±äº†å¾ˆå¤§çš„ä»£ä»·ç ´è§£äº†å…¶ä¸­æŸä¸€ä¸ªä¸´æ—¶å…±äº«å¯†é’¥ shared_key_kï¼ˆæˆ–è€…è¯¥å¯†é’¥å› ä¸ºæŸç§åŸå› æ³„æ¼äº†ï¼‰ï¼ŒTA ä¹Ÿåªèƒ½è§£å¯†å‡ºå…¶ä¸­æŸä¸€æ¬¡æ•°æ®äº¤æ¢çš„ä¿¡æ¯ M_b_kï¼Œå…¶ä»–æ‰€æœ‰çš„æ¶ˆæ¯ä»ç„¶æ˜¯ä¿å¯†çš„ï¼Œä¸å—æ­¤æ¬¡æ”»å‡»ï¼ˆæˆ–æ³„æ¼ï¼‰çš„å½±å“ã€‚ ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-5-key-exchange/:5:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","å¯†é’¥äº¤æ¢","å®‰å…¨","DH","DHE","ECDH","ECDHE"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆäº”ï¼‰â€”â€” å¯†é’¥äº¤æ¢ DHKE ä¸å®Œç¾å‰å‘ä¿å¯† PFS","uri":"/posts/practical-cryptography-basics-5-key-exchange/#äº”pfs-å®Œç¾å‰å‘ä¿å¯†åè®®-dheecdhe"},{"categories":["tech"],"content":" å‚è€ƒ Practical-Cryptography-for-Developers-Book A complete overview of SSL/TLS and its cryptographic system ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-5-key-exchange/:6:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","å¯†é’¥äº¤æ¢","å®‰å…¨","DH","DHE","ECDH","ECDHE"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆäº”ï¼‰â€”â€” å¯†é’¥äº¤æ¢ DHKE ä¸å®Œç¾å‰å‘ä¿å¯† PFS","uri":"/posts/practical-cryptography-basics-5-key-exchange/#å‚è€ƒ"},{"categories":["tech"],"content":" æœ¬æ–‡ä¸»è¦ç¿»è¯‘è‡ª Practical-Cryptography-for-Developers-Book ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-4-secure-random-generators/:0:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","ä¼ªéšæœºæ•°","å®‰å…¨","PRNG","CSPRNG"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå››ï¼‰â€”â€” å®‰å…¨éšæœºæ•°ç”Ÿæˆå™¨ CSPRNG","uri":"/posts/practical-cryptography-basics-4-secure-random-generators/#"},{"categories":["tech"],"content":" ä¸€ã€å‰è¨€åœ¨å¯†ç å­¦ä¸­ï¼Œéšæœºæ€§ï¼ˆç†µï¼‰æ‰®æ¼”äº†ä¸€ä¸ªéå¸¸é‡è¦çš„è§’è‰²ï¼Œè®¸å¤šå¯†ç å­¦ç®—æ³•éƒ½è¦æ±‚ä½¿ç”¨ä¸€ä¸ªä¸å¯é¢„æµ‹çš„éšæœºæ•°ï¼Œåªæœ‰åœ¨ç”Ÿæˆçš„éšæœºæ•°ä¸å¯é¢„æµ‹æ—¶ï¼Œè¿™äº›ç®—æ³•æ‰èƒ½ä¿è¯å…¶å®‰å…¨æ€§ã€‚ æ¯”å¦‚ MAC ç®—æ³•ä¸­çš„ key å°±å¿…é¡»æ˜¯ä¸€ä¸ªä¸å¯é¢„æµ‹çš„å€¼ï¼Œåœ¨è¿™ä¸ªæ¡ä»¶ä¸‹ MAC å€¼æ‰æ˜¯ä¸å¯ä¼ªé€ çš„ã€‚ å¦å¤–è®¸å¤šçš„é«˜æ€§èƒ½ç®—æ³•å¦‚å¿«é€Ÿæ’åºã€å¸ƒéš†è¿‡æ»¤å™¨ã€è’™ç‰¹å¡æ´›æ–¹æ³•ç­‰ï¼Œéƒ½ä¾èµ–äºéšæœºæ€§ï¼Œå¦‚æœéšæœºæ€§å¯ä»¥è¢«é¢„æµ‹ï¼Œæˆ–è€…èƒ½å¤Ÿæ‰¾åˆ°ç‰¹å®šçš„è¾“å…¥å€¼ä½¿è¿™äº›ç®—æ³•å˜å¾—ç‰¹åˆ«æ…¢ï¼Œé‚£é»‘å®¢å°±èƒ½å€Ÿæ­¤å¯¹æœåŠ¡è¿›è¡Œ DDoS æ”»å‡»ï¼Œ ä»¥å¾ˆå°çš„æˆæœ¬è¾¾åˆ°è®©æœåŠ¡ä¸å¯ç”¨çš„ç›®çš„ã€‚ ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-4-secure-random-generators/:1:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","ä¼ªéšæœºæ•°","å®‰å…¨","PRNG","CSPRNG"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå››ï¼‰â€”â€” å®‰å…¨éšæœºæ•°ç”Ÿæˆå™¨ CSPRNG","uri":"/posts/practical-cryptography-basics-4-secure-random-generators/#ä¸€å‰è¨€"},{"categories":["tech"],"content":" äºŒã€PRNG ä¼ªéšæœºæ•°ç”Ÿæˆå™¨Pseudo-Random Number Generators(PRNG) æ˜¯ä¸€ç§æ•°å­—åºåˆ—çš„ç”Ÿæˆç®—æ³•ï¼Œå®ƒç”Ÿæˆå‡ºçš„æ•°å­—åºåˆ—çš„ç»Ÿè®¡å­¦å±æ€§è·ŸçœŸæ­£çš„éšæœºæ•°åºåˆ—éå¸¸ç›¸ä¼¼ï¼Œä½†å®ƒç”Ÿæˆçš„ä¼ªéšæœºæ•°åºåˆ—å¹¶ä¸æ˜¯çœŸæ­£çš„éšæœºæ•°åºåˆ—ï¼å› ä¸ºè¯¥åºåˆ—å®Œå…¨ä¾èµ–äºæä¾›ç»™ PRNG çš„åˆå§‹å€¼ï¼Œè¿™ä¸ªå€¼è¢«ç§°ä¸º PRNG çš„ç§å­ã€‚ ç®—æ³•æµç¨‹å¦‚ä¸‹ï¼Œç®—æ³•çš„æ¯æ¬¡è¿­ä»£éƒ½ç”Ÿæˆå‡ºä¸€ä¸ªæ–°çš„ä¼ªéšæœºæ•°ï¼š å¦‚æœè¾“å…¥çš„åˆå§‹ç§å­æ˜¯ç›¸åŒçš„ï¼ŒPRNG æ€»æ˜¯ä¼šç”Ÿæˆå‡ºç›¸åŒçš„ä¼ªéšæœºæ•°åºåˆ—ï¼Œå› æ­¤ PRNG ä¹Ÿè¢«ç§°ä¸º Deterministic Random Bit Generator (DRBG)ï¼Œå³ç¡®å®šæ€§éšæœºæ¯”ç‰¹ç”Ÿæˆå™¨ã€‚ å®é™…ä¸Šç›®å‰ä¹Ÿæœ‰æ‰€è°“çš„ã€Œç¡¬ä»¶éšæœºæ•°ç”Ÿæˆå™¨ TRNGã€èƒ½ç”Ÿæˆå‡ºçœŸæ­£çš„éšæœºæ•°ï¼Œä½†æ˜¯å› ä¸º PRNG çš„é«˜é€Ÿã€ä½æˆæœ¬ã€å¯å¤ç°ç­‰åŸå› ï¼Œå®ƒä»ç„¶è¢«å¤§é‡ä½¿ç”¨åœ¨ç°ä»£è½¯ä»¶å¼€å‘ä¸­ã€‚ PRNG å¯ç”¨äºä»ä¸€ä¸ªå¾ˆå°çš„åˆå§‹éšæœºæ€§ï¼ˆç†µï¼‰ç”Ÿæˆå‡ºå¤§é‡çš„ä¼ªéšæœºæ€§ï¼Œè¿™è¢«ç§°åšã€Œæ‹‰ä¼¸ ï¼ˆStretchingï¼‰ã€ã€‚ PRNG è¢«å¹¿æ³›åº”ç”¨åœ¨å‰é¢æåˆ°çš„å„ç§ä¾èµ–éšæœºæ€§çš„é«˜æ€§èƒ½ç®—æ³•ä»¥åŠå¯†ç å­¦ç®—æ³•ä¸­ã€‚ ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-4-secure-random-generators/:2:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","ä¼ªéšæœºæ•°","å®‰å…¨","PRNG","CSPRNG"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå››ï¼‰â€”â€” å®‰å…¨éšæœºæ•°ç”Ÿæˆå™¨ CSPRNG","uri":"/posts/practical-cryptography-basics-4-secure-random-generators/#äºŒprng-ä¼ªéšæœºæ•°ç”Ÿæˆå™¨"},{"categories":["tech"],"content":" PRNG çš„å®ç°æˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡æ–‡ç« çš„ã€ŒMAC çš„åº”ç”¨ã€ä¸€èŠ‚ä¸­æåˆ°ï¼Œä¸€ä¸ªæœ€ç®€å•çš„ PRNG å¯ä»¥ç›´æ¥ä½¿ç”¨ MAC ç®—æ³•å®ç°ï¼Œ ç”¨ Python å®ç°å¦‚ä¸‹ï¼š python import hmac, hashlib def random_number_generator(seed: bytes, max_num: int): state = seed counter = 0 while True: state = hmac.new(state, bytes(counter), hashlib.sha1).digest() counter += 1 # è¿™é‡Œå–ä½™å®é™…ä¸Šæ˜¯å‹ç¼©äº†ä¿¡æ¯ï¼ŒæŸç§ç¨‹åº¦ä¸Šè¯´ï¼Œè¿™å¯ä»¥ä¿è¯å†…éƒ¨çš„çœŸå®çŠ¶æ€ state ä¸è¢«é€†å‘å‡ºæ¥ yield int.from_bytes(state, byteorder=\"big\") % max_num # æµ‹è¯•ä¸‹ï¼Œè®¡ç®— 20 ä¸ª 100 ä»¥å†…çš„éšæœºæ•° gen = random_number_generator(b\"abc\", 100) print([next(gen) for _ in range(20)]) # =\u003e [71, 41, 52, 18, 51, 14, 58, 30, 70, 20, 59, 93, 3, 10, 81, 63, 48, 67, 18, 36] ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-4-secure-random-generators/:2:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","ä¼ªéšæœºæ•°","å®‰å…¨","PRNG","CSPRNG"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå››ï¼‰â€”â€” å®‰å…¨éšæœºæ•°ç”Ÿæˆå™¨ CSPRNG","uri":"/posts/practical-cryptography-basics-4-secure-random-generators/#prng-çš„å®ç°"},{"categories":["tech"],"content":" ä¸‰ã€éšæœºæ€§ - ç†µå¦‚æœåˆå§‹çš„ PRNG ç§å­æ˜¯å®Œå…¨ä¸å¯é¢„æµ‹çš„ï¼ŒPRNG å°±èƒ½ä¿è¯æ•´ä¸ªéšæœºåºåˆ—éƒ½ä¸å¯é¢„æµ‹ã€‚ å› æ­¤åœ¨ PRNG ä¸­ï¼Œç”Ÿæˆå‡ºä¸€ä¸ªè¶³å¤Ÿéšæœºçš„ç§å­ï¼Œå°±å˜å¾—éå¸¸é‡è¦äº†ã€‚ ä¸€ä¸ªæœ€ç®€å•çš„æ–¹æ³•ï¼Œå°±æ˜¯æ”¶é›†éšæœºæ€§ã€‚å¯¹äºæ¡Œé¢ç”µè„‘ï¼Œéšæœºæ€§å¯ä»¥ä»é¼ æ ‡çš„ç§»åŠ¨ç‚¹å‡»ã€æŒ‰é”®äº‹ä»¶ã€ç½‘ç»œçŠ¶å†µç­‰éšæœºè¾“å…¥æ¥æ”¶é›†ã€‚è¿™ä¸ªäº‹æƒ…æ˜¯ç”±æ“ä½œç³»ç»Ÿåœ¨å†…æ ¸ä¸­å¤„ç†çš„ï¼Œå†…æ ¸ä¼šç›´æ¥ä¸ºåº”ç”¨ç¨‹åºæä¾›éšæœºæ•°è·å–çš„ APIï¼Œæ¯”å¦‚ Linux/MacOSX çš„ /dev/random è™šæ‹Ÿè®¾å¤‡ã€‚ å¦‚æœè¿™ä¸ªç†µçš„ç”Ÿæˆæœ‰æ¼æ´ï¼Œå°±å¾ˆå¯èƒ½é€ æˆä¸¥é‡çš„é—®é¢˜ï¼Œä¸€ä¸ªç°å®äº‹ä»¶å°±æ˜¯å®‰å“çš„ java.security.SecureRandom æ¼æ´å¯¼è‡´å®‰å“ç”¨æˆ·çš„æ¯”ç‰¹å¸é’±åŒ…å¤±çªƒã€‚ Python çš„ random åº“é»˜è®¤ä¼šä½¿ç”¨å½“å‰æ—¶é—´ä½œä¸ºåˆå§‹ seedï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸å¤Ÿå®‰å…¨çš„â€”â€”é»‘å®¢å¦‚æœçŸ¥é“ä½ è¿è¡Œç¨‹åºçš„å¤§æ¦‚æ—¶é—´ï¼Œå°±èƒ½é€šè¿‡éå†çš„æ–¹å¼æš´åŠ›ç ´è§£å‡ºä½ çš„éšæœºæ•°æ¥ï¼ ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-4-secure-random-generators/:3:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","ä¼ªéšæœºæ•°","å®‰å…¨","PRNG","CSPRNG"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå››ï¼‰â€”â€” å®‰å…¨éšæœºæ•°ç”Ÿæˆå™¨ CSPRNG","uri":"/posts/practical-cryptography-basics-4-secure-random-generators/#ä¸‰éšæœºæ€§---ç†µ"},{"categories":["tech"],"content":" å››ã€CSPRNG å¯†ç å­¦å®‰å…¨éšæœºæ•°ç”Ÿæˆå™¨Cryptography Secure Random Number Generators(CSPRNG) æ˜¯ä¸€ç§é€‚ç”¨äºå¯†ç å­¦é¢†åŸŸçš„ PRNGï¼Œä¸€ä¸ª PRNG å¦‚æœèƒ½å¤Ÿå…·å¤‡å¦‚ä¸‹ä¸¤ä¸ªæ¡ä»¶ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ª CSPRNG: èƒ½é€šè¿‡ã€Œä¸‹ä¸€æ¯”ç‰¹æµ‹è¯• next-bit testã€ï¼šå³ä½¿æœ‰äººè·çŸ¥äº†è¯¥ PRNG çš„ k ä½ï¼Œä»–ä¹Ÿæ— æ³•ä½¿ç”¨åˆç†çš„èµ„æºé¢„æµ‹ç¬¬ k+1 ä½çš„å€¼ å¦‚æœæ”»å‡»è€…çŒœå‡ºäº† PRNG çš„å†…éƒ¨çŠ¶æ€æˆ–è¯¥çŠ¶æ€å› æŸç§åŸå› è€Œæ³„æ¼ï¼Œæ”»å‡»è€…ä¹Ÿæ— æ³•é‡å»ºå‡ºå†…éƒ¨çŠ¶æ€æ³„æ¼ä¹‹å‰ç”Ÿæˆçš„æ‰€æœ‰éšæœºæ•° æœ‰è®¸å¤šçš„è®¾è®¡éƒ½è¢«è¯æ˜å¯ä»¥ç”¨äºæ„é€ ä¸€ä¸ª CSPRNG: åŸºäºè®¡æ•°å™¨(CTR)æ¨¡å¼ä¸‹çš„å®‰å…¨åˆ†ç»„å¯†ç ã€æµå¯†ç æˆ–å®‰å…¨å“ˆå¸Œå‡½æ•°çš„ CSPRNG åŸºäºæ•°è®ºè®¾è®¡çš„ CSPRNGï¼Œå®ƒä¾é æ•´æ•°åˆ†è§£é—®é¢˜ï¼ˆIFPï¼‰ã€ç¦»æ•£å¯¹æ•°é—®é¢˜ï¼ˆDLPï¼‰æˆ–æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜ï¼ˆECDLPï¼‰çš„é«˜éš¾åº¦æ¥ç¡®ä¿å®‰å…¨æ€§ CSPRNG åŸºäºåŠ å¯†å®‰å…¨éšæœºæ€§çš„ç‰¹æ®Šè®¾è®¡ï¼Œä¾‹å¦‚ Yarrow algorithm å’Œ Fortunaï¼Œè¿™ä¿©åˆ†åˆ«è¢«ç”¨äº MacOS å’Œ FreeBSD. å¤§å¤šæ•°çš„ CSPRNG ç»“åˆä½¿ç”¨æ¥è‡ª OS çš„ç†µä¸é«˜è´¨é‡çš„ PRNGï¼Œå¹¶ä¸”ä¸€æ—¦ç³»ç»Ÿç”Ÿæˆäº†æ–°çš„ç†µï¼ˆè¿™å¯èƒ½æ¥è‡ªç”¨æˆ·è¾“å…¥ã€ç£ç›˜ IOã€ç³»ç»Ÿä¸­æ–­ã€æˆ–è€…ç¡¬ä»¶ RNGï¼‰ï¼ŒCSPRNG ä¼šç«‹å³ä½¿ç”¨æ–°çš„ç†µæ¥ä½œä¸º PRNG æ–°çš„ç§å­ã€‚è¿™ç§ä¸æ–­é‡ç½® PRNG ç§å­çš„è¡Œä¸ºï¼Œä½¿éšæœºæ•°å˜å¾—éå¸¸éš¾ä»¥é¢„æµ‹ã€‚ ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-4-secure-random-generators/:4:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","ä¼ªéšæœºæ•°","å®‰å…¨","PRNG","CSPRNG"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå››ï¼‰â€”â€” å®‰å…¨éšæœºæ•°ç”Ÿæˆå™¨ CSPRNG","uri":"/posts/practical-cryptography-basics-4-secure-random-generators/#å››csprng-å¯†ç å­¦å®‰å…¨éšæœºæ•°ç”Ÿæˆå™¨"},{"categories":["tech"],"content":" CSPRNG çš„ç”¨é€” åŠ å¯†ç¨‹åºï¼šå› ä¸º OS ä¸­ç†µçš„æ”¶é›†å¾ˆç¼“æ…¢ï¼Œç­‰å¾…æ”¶é›†åˆ°è¶³å¤Ÿå¤šçš„ç†µå†è¿›è¡Œè¿ç®—æ˜¯ä¸åˆ‡å®é™…çš„ï¼Œå› æ­¤å¾ˆå¤šçš„åŠ å¯†ç¨‹åºéƒ½ä½¿ç”¨ CSPRNG æ¥ä»ç³»ç»Ÿçš„åˆå§‹ç†µç”Ÿæˆå‡ºè¶³å¤Ÿå¤šçš„ä¼ªéšæœºç†µã€‚ å…¶ä»–éœ€è¦å®‰å…¨éšæœºæ•°çš„åœºæ™¯ emmmm ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-4-secure-random-generators/:4:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","ä¼ªéšæœºæ•°","å®‰å…¨","PRNG","CSPRNG"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå››ï¼‰â€”â€” å®‰å…¨éšæœºæ•°ç”Ÿæˆå™¨ CSPRNG","uri":"/posts/practical-cryptography-basics-4-secure-random-generators/#csprng-çš„ç”¨é€”"},{"categories":["tech"],"content":" å¦‚ä½•åœ¨ä»£ç ä¸­ä½¿ç”¨ CSPRNGå¤šæ•°ç³»ç»Ÿéƒ½å†…ç½®äº† CSPRNG ç®—æ³•å¹¶æä¾›äº†å†…æ ¸ APIï¼ŒUnix-like ç³»ç»Ÿéƒ½é€šè¿‡å¦‚ä¸‹ä¸¤ä¸ªè™šæ‹Ÿè®¾å¤‡æä¾› CSPRNG: /dev/randomï¼ˆå—é™é˜»å¡éšæœºç”Ÿæˆå™¨ï¼‰: ä»è¿™ä¸ªè®¾å¤‡ä¸­è¯»å–åˆ°çš„æ˜¯å†…æ ¸ç†µæ± ä¸­å·²ç»æ”¶é›†å¥½çš„ç†µï¼Œå¦‚æœç†µæ± ç©ºäº†ï¼Œæ­¤è®¾å¤‡ä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°æ”¶é›†åˆ°æ–°çš„ç¯å¢ƒå™ªå£°ã€‚ /dev/urandomï¼ˆä¸å—é™éé˜»å¡éšæœºç”Ÿæˆå™¨ï¼‰: å®ƒå¯èƒ½ä¼šè¿”å›å†…æ ¸ç†µæ± ä¸­çš„ç†µï¼Œä¹Ÿå¯èƒ½è¿”å›ä½¿ç”¨ã€Œä¹‹å‰æ”¶é›†çš„ç†µ + CSPRNGã€è®¡ç®—å‡ºçš„å®‰å…¨ä¼ªéšæœºæ•°ã€‚å®ƒä¸ä¼šé˜»å¡ã€‚ ç¼–ç¨‹è¯­è¨€çš„ CSPRNG æ¥å£æˆ–åº“å¦‚ä¸‹ï¼š Java: java.security.SecureRandom Python: secrets åº“æˆ–è€… os.urandom() C#: System.Security.Cryptography.RandomNumberGenerator.Create() JavaScript: å®¢æˆ·ç«¯å¯ä½¿ç”¨ window.crypto.getRandomValues(Uint8Array)ï¼ŒæœåŠ¡ç«¯å¯ä½¿ç”¨crypto.randomBytes() æ¯”å¦‚ä½¿ç”¨ Python å®ç°ä¸€ä¸ªç®€å•ä½†è¶³å¤Ÿå®‰å…¨çš„éšæœºå¯†ç ç”Ÿæˆå™¨ï¼š python import secrets import string chars = string.digits + \"your_custom_-content\" + string.ascii_letters def random_string(length: int): \"\"\"ç”Ÿæˆéšæœºå­—ç¬¦ä¸²\"\"\" # æ³¨æ„ï¼Œè¿™é‡Œä¸åº”è¯¥ä½¿ç”¨ random åº“ï¼è€Œåº”è¯¥ä½¿ç”¨ secrets code = \"\".join(secrets.choice(chars) for _ in range(length)) return code random_string(24) # =\u003e _rebBfgYs4OtkrPbYtnGmc4n ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-4-secure-random-generators/:5:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","ä¼ªéšæœºæ•°","å®‰å…¨","PRNG","CSPRNG"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå››ï¼‰â€”â€” å®‰å…¨éšæœºæ•°ç”Ÿæˆå™¨ CSPRNG","uri":"/posts/practical-cryptography-basics-4-secure-random-generators/#å¦‚ä½•åœ¨ä»£ç ä¸­ä½¿ç”¨-csprng"},{"categories":["tech"],"content":" å‚è€ƒ Practical-Cryptography-for-Developers-Book ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-4-secure-random-generators/:6:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","å¯†ç å­¦","ä¼ªéšæœºæ•°","å®‰å…¨","PRNG","CSPRNG"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå››ï¼‰â€”â€” å®‰å…¨éšæœºæ•°ç”Ÿæˆå™¨ CSPRNG","uri":"/posts/practical-cryptography-basics-4-secure-random-generators/#å‚è€ƒ"},{"categories":["tech"],"content":" æœ¬æ–‡ä¸»è¦ç¿»è¯‘è‡ª Practical-Cryptography-for-Developers-Bookï¼Œç¬”è€…è¡¥å……äº† HMAC çš„ Python å®ç°ä»¥åŠ scrypt ä½¿ç”¨ç¤ºä¾‹ã€‚ ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-3-key-derivation-function/:0:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","å“ˆå¸Œ","æ•£åˆ—","å¯†ç å­¦","å®‰å…¨","MAC","HMAC","KDF","Scrypt"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸‰ï¼‰â€”â€” MAC ä¸å¯†é’¥æ´¾ç”Ÿå‡½æ•° KDF","uri":"/posts/practical-cryptography-basics-3-key-derivation-function/#"},{"categories":["tech"],"content":" ä¸€ã€MAC æ¶ˆæ¯è®¤è¯ç MAC æ¶ˆæ¯è®¤è¯ç ï¼Œå³ Message Authentication Codeï¼Œæ˜¯ç”¨äºéªŒè¯æ¶ˆæ¯çš„ä¸€å°æ®µé™„åŠ æ•°æ®ã€‚æ¢å¥è¯è¯´ï¼Œ èƒ½ç”¨å®ƒç¡®è®¤æ¶ˆæ¯çš„çœŸå®æ€§â€”â€”æ¶ˆæ¯æ¥è‡ªæŒ‡å®šçš„å‘ä»¶äººå¹¶ä¸”æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚ MAC å€¼é€šè¿‡å…è®¸æ‹¥æœ‰å¯†é’¥çš„éªŒè¯è€…æ£€æµ‹æ¶ˆæ¯å†…å®¹çš„ä»»ä½•æ›´æ”¹æ¥ä¿æŠ¤æ¶ˆæ¯çš„æ•°æ®å®Œæ•´æ€§åŠå…¶çœŸå®æ€§ã€‚ ä¸€ä¸ªå®‰å…¨çš„ MAC å‡½æ•°ï¼Œè·ŸåŠ å¯†å“ˆå¸Œå‡½æ•°éå¸¸ç±»ä¼¼ï¼Œä¹Ÿæ‹¥æœ‰å¦‚ä¸‹ç‰¹æ€§ï¼š å¿«é€Ÿï¼šè®¡ç®—é€Ÿåº¦è¦è¶³å¤Ÿå¿« ç¡®å®šæ€§ï¼šå¯¹åŒæ ·çš„æ¶ˆæ¯è·Ÿå¯†é’¥ï¼Œåº”è¯¥æ€»æ˜¯äº§ç”ŸåŒæ ·çš„è¾“å‡º éš¾ä»¥åˆ†æï¼šå¯¹æ¶ˆæ¯æˆ–å¯†é’¥çš„ä»»ä½•å¾®å°æ”¹åŠ¨ï¼Œéƒ½åº”è¯¥ä½¿è¾“å‡ºå®Œå…¨å‘ç”Ÿå˜åŒ– ä¸å¯é€†ï¼šä» MAC å€¼é€†å‘æ¼”ç®—å‡ºæ¶ˆæ¯è·Ÿå¯†é’¥åº”è¯¥æ˜¯ä¸å¯è¡Œçš„ã€‚ æ— ç¢°æ’ï¼šæ‰¾åˆ°å…·æœ‰ç›¸åŒå“ˆå¸Œçš„ä¸¤æ¡ä¸åŒæ¶ˆæ¯åº”è¯¥éå¸¸å›°éš¾ï¼ˆæˆ–å‡ ä¹ä¸å¯èƒ½ï¼‰ ä½†æ˜¯ MAC ç®—æ³•æ¯”åŠ å¯†å“ˆå¸Œå‡½æ•°å¤šä¸€ä¸ªè¾“å…¥å€¼ï¼šå¯†é’¥ï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä¸º keyed hash functionsï¼Œå³ã€ŒåŠ å¯†é’¥çš„å“ˆå¸Œå‡½æ•°ã€ã€‚ å¦‚ä¸‹ Python ä»£ç ä½¿ç”¨ key è·Ÿæ¶ˆæ¯è®¡ç®—å‡ºå¯¹åº”çš„ HMAC-SHA256 å€¼ï¼š python import hashlib, hmac, binascii key = b\"key\" msg = b\"some msg\" mac = hmac.new(key, msg, hashlib.sha256).digest() print(f\"HMAC-SHA256({key}, {msg})\", binascii.hexlify(mac).decode('utf8')) # =\u003e HMAC-SHA256(b'key', b'some msg') = 32885b49c8a1009e6d66662f8462e7dd5df769a7b725d1d546574e6d5d6e76ad HMAC çš„ç®—æ³•å®é™…ä¸Šéå¸¸ç®€å•ï¼Œæˆ‘å‚è€ƒ wiki/HMAC ç»™å‡ºçš„ä¼ªç ï¼Œç¼–å†™äº†ä¸‹é¢è¿™ä¸ª Python å®ç°ï¼Œæ²¡å‡ è¡Œä»£ç ï¼Œä½†æ˜¯å®Œå…¨ workï¼š python import hashlib, binascii def xor_bytes(b1, b2): return bytes(a ^ c for a, c in zip(b1, b2)) def my_hmac(key, msg, hash_name): # hash =\u003e (block_size, output_size) # å•ä½æ˜¯ bytesï¼Œæ•°æ®æ¥æºäº https://en.wikipedia.org/wiki/HMAC hash_size_dict = { \"md5\": (64, 16), \"sha1\": (64, 20), \"sha224\": (64, 28), \"sha256\": (64, 32), # \"sha512/224\": (128, 28), # è¿™ä¿©ç®—æ³•æš‚æ—¶ä¸æ¸…æ¥šåœ¨ hashlib é‡Œå«å•¥å # \"sha512/256\": (128, 32), \"sha_384\": (128, 48), \"sha_512\": (128, 64), \"sha3_224\": (144, 28), \"sha3_256\": (136, 32), \"sha3_384\": (104, 48), \"sha3_512\": (72, 64), } if hash_name not in hash_size_dict: raise ValueError(\"unknown hash_name\") block_size, output_size = hash_size_dict[hash_name] hash_ = getattr(hashlib, hash_name) # ç¡®ä¿ key çš„é•¿åº¦ä¸º block_size block_sized_key = key if len(key) \u003e block_size: block_sized_key = hash_(key).digest() # ç”¨ hash å‡½æ•°è¿›è¡Œå‹ç¼© if len(key) \u003c block_size: block_sized_key += b'\\x00' * (block_size - len(key)) # æœ«å°¾è¡¥ 0 o_key_pad = xor_bytes(block_sized_key, (b\"\\x5c\" * block_size)) # Outer padded key i_key_pad = xor_bytes(block_sized_key, (b\"\\x36\" * block_size)) # Inner padded key return hash_(o_key_pad + hash_(i_key_pad + msg).digest()).digest() # ä¸‹é¢éªŒè¯ä¸‹ key = b\"key\" msg = b\"some msg\" mac_ = my_hmac(key, msg, \"sha256\") print(f\"HMAC-SHA256({key}, {msg})\", binascii.hexlify(mac_).decode('utf8')) # è¾“å‡ºè·Ÿæ ‡å‡†åº“å®Œå…¨ä¸€è‡´ï¼š # =\u003e HMAC-SHA256(b'key', b'some msg') = 32885b49c8a1009e6d66662f8462e7dd5df769a7b725d1d546574e6d5d6e76ad ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-3-key-derivation-function/:1:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","å“ˆå¸Œ","æ•£åˆ—","å¯†ç å­¦","å®‰å…¨","MAC","HMAC","KDF","Scrypt"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸‰ï¼‰â€”â€” MAC ä¸å¯†é’¥æ´¾ç”Ÿå‡½æ•° KDF","uri":"/posts/practical-cryptography-basics-3-key-derivation-function/#ä¸€mac-æ¶ˆæ¯è®¤è¯ç "},{"categories":["tech"],"content":" MAC ä¸å“ˆå¸Œå‡½æ•°ã€æ•°å­—ç­¾åçš„åŒºåˆ«ä¸Šä¸€ç¯‡æ–‡ç« æåˆ°è¿‡ï¼Œå“ˆå¸Œå‡½æ•°åªè´Ÿè´£ç”Ÿæˆå“ˆå¸Œå€¼ï¼Œä¸è´Ÿè´£å“ˆå¸Œå€¼çš„å¯é ä¼ é€’ã€‚ è€Œæ•°å­—ç­¾åå‘¢ï¼Œè·Ÿ MAC éå¸¸ç›¸ä¼¼ï¼Œä½†æ˜¯æ•°å­—ç­¾åä½¿ç”¨çš„æ˜¯å¯†é’¥å¯¹ï¼ˆéå¯¹ç§°åŠ å¯†ç³»ç»Ÿï¼‰ï¼ŒåŸç†æ›´å¤æ‚ï¼Œè®¡ç®—é€Ÿåº¦ä¹Ÿæ›´æ…¢ã€‚ MAC çš„åŠŸèƒ½è·Ÿæ•°å­—ç­¾åä¸€è‡´ï¼Œéƒ½æ˜¯éªŒè¯æ¶ˆæ¯çš„çœŸå®æ€§ï¼ˆauthenticityï¼‰ã€å®Œæ•´æ€§ï¼ˆintegrityï¼‰ã€ä¸å¯å¦è®¤æ€§ï¼ˆnon-repudiationï¼‰ï¼Œä½†æ˜¯ MAC ä½¿ç”¨å“ˆå¸Œå‡½æ•°ä¸é¢„å…±äº«å¯†é’¥ï¼ˆå¯¹ç§°å¯†ç ç³»ç»Ÿï¼‰æ¥åšè¿™ä»¶äº‹æƒ…ï¼Œé€Ÿåº¦è¦æ›´å¿«ï¼Œç®—æ³•ä¹Ÿæ›´ç®€å•ã€‚ ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-3-key-derivation-function/:1:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","å“ˆå¸Œ","æ•£åˆ—","å¯†ç å­¦","å®‰å…¨","MAC","HMAC","KDF","Scrypt"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸‰ï¼‰â€”â€” MAC ä¸å¯†é’¥æ´¾ç”Ÿå‡½æ•° KDF","uri":"/posts/practical-cryptography-basics-3-key-derivation-function/#mac-ä¸å“ˆå¸Œå‡½æ•°æ•°å­—ç­¾åçš„åŒºåˆ«"},{"categories":["tech"],"content":" MAC çš„åº”ç”¨ 1. éªŒè¯æ¶ˆæ¯çš„çœŸå®æ€§ã€å®Œæ•´æ€§è¿™æ˜¯æœ€ç®€å•çš„ä¸€ä¸ªåº”ç”¨åœºæ™¯ï¼Œåœ¨é€šä¿¡åŒå‘éƒ½æŒæœ‰ä¸€ä¸ªé¢„å…±äº«å¯†é’¥çš„å‰æä¸‹ï¼Œé€šä¿¡æ—¶éƒ½é™„å¸¦ä¸Šæ¶ˆæ¯çš„ MAC ç ã€‚æ¥æ”¶æ–¹ä¹Ÿä½¿ç”¨ã€Œæ”¶åˆ°çš„æ¶ˆæ¯+é¢„å…±äº«å¯†é’¥ã€è®¡ç®—å‡º MAC ç ï¼Œå¦‚æœè·Ÿæ”¶åˆ°çš„ä¸€è‡´ï¼Œå°±è¯´æ˜æ¶ˆæ¯çœŸå®æ— è¯¯ã€‚ æ³¨æ„è¿™ç§åº”ç”¨åœºæ™¯ä¸­ï¼Œæ¶ˆæ¯æ˜¯ä¸ä¿å¯†çš„ï¼ 2. AE è®¤è¯åŠ å¯† - Authenticated encryptionå¸¸ç”¨çš„åŠ å¯†æ–¹æ³•åªèƒ½ä¿è¯æ•°æ®çš„ä¿å¯†æ€§ï¼Œå¹¶ä¸èƒ½ä¿è¯æ•°æ®çš„å®Œæ•´æ€§ã€‚ è€Œè¿™é‡Œä»‹ç»çš„ MAC ç®—æ³•ï¼Œæˆ–è€…è¿˜æœªä»‹ç»çš„åŸºäºéå¯¹ç§°åŠ å¯†çš„æ•°å­—ç­¾åï¼Œéƒ½åªèƒ½ä¿è¯æ•°æ®çš„çœŸå®æ€§ã€å®Œæ•´æ€§ï¼Œä¸èƒ½ä¿è¯æ•°æ®è¢«å®‰å…¨ä¼ è¾“ã€‚ è€Œè®¤è¯åŠ å¯†ï¼Œå°±æ˜¯å°†åŠ å¯†ç®—æ³•ä¸ MAC ç®—æ³•ç»“åˆä½¿ç”¨çš„ä¸€ç§åŠ å¯†æ–¹æ¡ˆã€‚ åœ¨ç¡®ä¿ MAC ç ã€Œå¼ºä¸å¯ä¼ªé€ ã€çš„å‰æä¸‹ï¼Œé¦–å…ˆå¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œç„¶åè®¡ç®—å¯†æ–‡çš„ MAC ç ï¼Œå†åŒæ—¶ä¼ è¾“å¯†æ–‡ä¸ MAC ç ï¼Œå°±èƒ½åŒæ—¶ä¿è¯æ•°æ®çš„ä¿å¯†æ€§ã€å®Œæ•´æ€§ã€çœŸå®æ€§ï¼Œè¿™ç§æ–¹æ³•å« Encrypt-then-MAC, ç¼©å†™åš EtM. æ¥æ”¶æ–¹åœ¨è§£å¯†å‰å…ˆè®¡ç®—å¯†æ–‡çš„ MAC ç ä¸æ”¶åˆ°çš„å¯¹æ¯”ï¼Œå°±èƒ½éªŒè¯å¯†æ–‡çš„å®Œæ•´æ€§ä¸çœŸå®æ€§ã€‚ AE æœ‰ä¸€ç§æ›´å®‰å…¨çš„å˜ä½“â€”â€”å¸¦æœ‰å…³è”æ•°æ®çš„è®¤è¯åŠ å¯† (authenticated encryption with associated dataï¼ŒAEAD)ã€‚AEAD å°†ã€Œå…³è”æ•°æ®(Associated Data, AD)ã€â€”â€”ä¹Ÿç§°ä¸ºã€Œé™„åŠ éªŒè¯æ•°æ® ï¼ˆAdditional Authenticated Data, AADï¼‰ã€â€”â€”ç»‘å®šåˆ°å¯†æ–‡å’Œå®ƒåº”è¯¥å‡ºç°çš„ä¸Šä¸‹æ–‡ï¼Œä»¥ä¾¿å¯ä»¥æ£€æµ‹å’Œæ‹’ç»å°†æœ‰æ•ˆå¯†æ–‡ã€Œå‰ªåˆ‡å¹¶ç²˜è´´ã€åˆ°ä¸åŒä¸Šä¸‹æ–‡çš„å°è¯•ã€‚ AEAD ç”¨äºåŠ å¯†å’ŒæœªåŠ å¯†æ•°æ®ä¸€èµ·ä½¿ç”¨çš„åœºæ™¯ï¼ˆä¾‹å¦‚ï¼Œåœ¨åŠ å¯†çš„ç½‘ç»œåè®®ä¸­ï¼‰ï¼Œå¹¶ç¡®ä¿æ•´ä¸ªæ•°æ®æµç»è¿‡èº«ä»½éªŒè¯å’Œå®Œæ•´æ€§ä¿æŠ¤ã€‚æ¢å¥è¯è¯´ï¼ŒAEAD å¢åŠ äº†æ£€æŸ¥æŸäº›å†…å®¹çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§çš„èƒ½åŠ›ã€‚ æˆ‘ä»¬ä¼šåœ¨ç¬¬å…­ç« ã€Œå¯¹ç§°åŠ å¯†ç®—æ³•ã€ä¸­çœ‹åˆ°å¦‚ä½•é€šè¿‡ Python ä½¿ç”¨ AEAD åŠ å¯†æ–¹æ¡ˆ AES-256-GCM. 3. åŸºäº MAC çš„ä¼ªéšæœºæ•°ç”Ÿæˆå™¨MAC ç çš„å¦ä¸€ä¸ªç”¨é€”å°±æ˜¯ä¼ªéšæœºæ•°ç”Ÿæˆå‡½æ•°ï¼Œç›¸æ¯”ç›´æ¥ä½¿ç”¨ç†µ+å“ˆå¸Œå‡½æ•°çš„è¿›è¡Œä¼ªéšæœºæ•°è®¡ç®—ï¼ŒMAC ç å› ä¸ºå¤šå¼•å…¥äº†ä¸€ä¸ªå˜é‡ keyï¼Œç†è®ºä¸Šå®ƒä¼šæ›´å®‰å…¨ã€‚ è¿™ç§åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬ç§° MAC ä½¿ç”¨çš„å¯†é’¥ä¸º saltï¼Œå³ç›ã€‚ text next_seed = MAC(salt, seed) ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-3-key-derivation-function/:1:2","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","å“ˆå¸Œ","æ•£åˆ—","å¯†ç å­¦","å®‰å…¨","MAC","HMAC","KDF","Scrypt"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸‰ï¼‰â€”â€” MAC ä¸å¯†é’¥æ´¾ç”Ÿå‡½æ•° KDF","uri":"/posts/practical-cryptography-basics-3-key-derivation-function/#mac-çš„åº”ç”¨"},{"categories":["tech"],"content":" MAC çš„åº”ç”¨ 1. éªŒè¯æ¶ˆæ¯çš„çœŸå®æ€§ã€å®Œæ•´æ€§è¿™æ˜¯æœ€ç®€å•çš„ä¸€ä¸ªåº”ç”¨åœºæ™¯ï¼Œåœ¨é€šä¿¡åŒå‘éƒ½æŒæœ‰ä¸€ä¸ªé¢„å…±äº«å¯†é’¥çš„å‰æä¸‹ï¼Œé€šä¿¡æ—¶éƒ½é™„å¸¦ä¸Šæ¶ˆæ¯çš„ MAC ç ã€‚æ¥æ”¶æ–¹ä¹Ÿä½¿ç”¨ã€Œæ”¶åˆ°çš„æ¶ˆæ¯+é¢„å…±äº«å¯†é’¥ã€è®¡ç®—å‡º MAC ç ï¼Œå¦‚æœè·Ÿæ”¶åˆ°çš„ä¸€è‡´ï¼Œå°±è¯´æ˜æ¶ˆæ¯çœŸå®æ— è¯¯ã€‚ æ³¨æ„è¿™ç§åº”ç”¨åœºæ™¯ä¸­ï¼Œæ¶ˆæ¯æ˜¯ä¸ä¿å¯†çš„ï¼ 2. AE è®¤è¯åŠ å¯† - Authenticated encryptionå¸¸ç”¨çš„åŠ å¯†æ–¹æ³•åªèƒ½ä¿è¯æ•°æ®çš„ä¿å¯†æ€§ï¼Œå¹¶ä¸èƒ½ä¿è¯æ•°æ®çš„å®Œæ•´æ€§ã€‚ è€Œè¿™é‡Œä»‹ç»çš„ MAC ç®—æ³•ï¼Œæˆ–è€…è¿˜æœªä»‹ç»çš„åŸºäºéå¯¹ç§°åŠ å¯†çš„æ•°å­—ç­¾åï¼Œéƒ½åªèƒ½ä¿è¯æ•°æ®çš„çœŸå®æ€§ã€å®Œæ•´æ€§ï¼Œä¸èƒ½ä¿è¯æ•°æ®è¢«å®‰å…¨ä¼ è¾“ã€‚ è€Œè®¤è¯åŠ å¯†ï¼Œå°±æ˜¯å°†åŠ å¯†ç®—æ³•ä¸ MAC ç®—æ³•ç»“åˆä½¿ç”¨çš„ä¸€ç§åŠ å¯†æ–¹æ¡ˆã€‚ åœ¨ç¡®ä¿ MAC ç ã€Œå¼ºä¸å¯ä¼ªé€ ã€çš„å‰æä¸‹ï¼Œé¦–å…ˆå¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œç„¶åè®¡ç®—å¯†æ–‡çš„ MAC ç ï¼Œå†åŒæ—¶ä¼ è¾“å¯†æ–‡ä¸ MAC ç ï¼Œå°±èƒ½åŒæ—¶ä¿è¯æ•°æ®çš„ä¿å¯†æ€§ã€å®Œæ•´æ€§ã€çœŸå®æ€§ï¼Œè¿™ç§æ–¹æ³•å« Encrypt-then-MAC, ç¼©å†™åš EtM. æ¥æ”¶æ–¹åœ¨è§£å¯†å‰å…ˆè®¡ç®—å¯†æ–‡çš„ MAC ç ä¸æ”¶åˆ°çš„å¯¹æ¯”ï¼Œå°±èƒ½éªŒè¯å¯†æ–‡çš„å®Œæ•´æ€§ä¸çœŸå®æ€§ã€‚ AE æœ‰ä¸€ç§æ›´å®‰å…¨çš„å˜ä½“â€”â€”å¸¦æœ‰å…³è”æ•°æ®çš„è®¤è¯åŠ å¯† (authenticated encryption with associated dataï¼ŒAEAD)ã€‚AEAD å°†ã€Œå…³è”æ•°æ®(Associated Data, AD)ã€â€”â€”ä¹Ÿç§°ä¸ºã€Œé™„åŠ éªŒè¯æ•°æ® ï¼ˆAdditional Authenticated Data, AADï¼‰ã€â€”â€”ç»‘å®šåˆ°å¯†æ–‡å’Œå®ƒåº”è¯¥å‡ºç°çš„ä¸Šä¸‹æ–‡ï¼Œä»¥ä¾¿å¯ä»¥æ£€æµ‹å’Œæ‹’ç»å°†æœ‰æ•ˆå¯†æ–‡ã€Œå‰ªåˆ‡å¹¶ç²˜è´´ã€åˆ°ä¸åŒä¸Šä¸‹æ–‡çš„å°è¯•ã€‚ AEAD ç”¨äºåŠ å¯†å’ŒæœªåŠ å¯†æ•°æ®ä¸€èµ·ä½¿ç”¨çš„åœºæ™¯ï¼ˆä¾‹å¦‚ï¼Œåœ¨åŠ å¯†çš„ç½‘ç»œåè®®ä¸­ï¼‰ï¼Œå¹¶ç¡®ä¿æ•´ä¸ªæ•°æ®æµç»è¿‡èº«ä»½éªŒè¯å’Œå®Œæ•´æ€§ä¿æŠ¤ã€‚æ¢å¥è¯è¯´ï¼ŒAEAD å¢åŠ äº†æ£€æŸ¥æŸäº›å†…å®¹çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§çš„èƒ½åŠ›ã€‚ æˆ‘ä»¬ä¼šåœ¨ç¬¬å…­ç« ã€Œå¯¹ç§°åŠ å¯†ç®—æ³•ã€ä¸­çœ‹åˆ°å¦‚ä½•é€šè¿‡ Python ä½¿ç”¨ AEAD åŠ å¯†æ–¹æ¡ˆ AES-256-GCM. 3. åŸºäº MAC çš„ä¼ªéšæœºæ•°ç”Ÿæˆå™¨MAC ç çš„å¦ä¸€ä¸ªç”¨é€”å°±æ˜¯ä¼ªéšæœºæ•°ç”Ÿæˆå‡½æ•°ï¼Œç›¸æ¯”ç›´æ¥ä½¿ç”¨ç†µ+å“ˆå¸Œå‡½æ•°çš„è¿›è¡Œä¼ªéšæœºæ•°è®¡ç®—ï¼ŒMAC ç å› ä¸ºå¤šå¼•å…¥äº†ä¸€ä¸ªå˜é‡ keyï¼Œç†è®ºä¸Šå®ƒä¼šæ›´å®‰å…¨ã€‚ è¿™ç§åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬ç§° MAC ä½¿ç”¨çš„å¯†é’¥ä¸º saltï¼Œå³ç›ã€‚ text next_seed = MAC(salt, seed) ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-3-key-derivation-function/:1:2","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","å“ˆå¸Œ","æ•£åˆ—","å¯†ç å­¦","å®‰å…¨","MAC","HMAC","KDF","Scrypt"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸‰ï¼‰â€”â€” MAC ä¸å¯†é’¥æ´¾ç”Ÿå‡½æ•° KDF","uri":"/posts/practical-cryptography-basics-3-key-derivation-function/#1-éªŒè¯æ¶ˆæ¯çš„çœŸå®æ€§å®Œæ•´æ€§"},{"categories":["tech"],"content":" MAC çš„åº”ç”¨ 1. éªŒè¯æ¶ˆæ¯çš„çœŸå®æ€§ã€å®Œæ•´æ€§è¿™æ˜¯æœ€ç®€å•çš„ä¸€ä¸ªåº”ç”¨åœºæ™¯ï¼Œåœ¨é€šä¿¡åŒå‘éƒ½æŒæœ‰ä¸€ä¸ªé¢„å…±äº«å¯†é’¥çš„å‰æä¸‹ï¼Œé€šä¿¡æ—¶éƒ½é™„å¸¦ä¸Šæ¶ˆæ¯çš„ MAC ç ã€‚æ¥æ”¶æ–¹ä¹Ÿä½¿ç”¨ã€Œæ”¶åˆ°çš„æ¶ˆæ¯+é¢„å…±äº«å¯†é’¥ã€è®¡ç®—å‡º MAC ç ï¼Œå¦‚æœè·Ÿæ”¶åˆ°çš„ä¸€è‡´ï¼Œå°±è¯´æ˜æ¶ˆæ¯çœŸå®æ— è¯¯ã€‚ æ³¨æ„è¿™ç§åº”ç”¨åœºæ™¯ä¸­ï¼Œæ¶ˆæ¯æ˜¯ä¸ä¿å¯†çš„ï¼ 2. AE è®¤è¯åŠ å¯† - Authenticated encryptionå¸¸ç”¨çš„åŠ å¯†æ–¹æ³•åªèƒ½ä¿è¯æ•°æ®çš„ä¿å¯†æ€§ï¼Œå¹¶ä¸èƒ½ä¿è¯æ•°æ®çš„å®Œæ•´æ€§ã€‚ è€Œè¿™é‡Œä»‹ç»çš„ MAC ç®—æ³•ï¼Œæˆ–è€…è¿˜æœªä»‹ç»çš„åŸºäºéå¯¹ç§°åŠ å¯†çš„æ•°å­—ç­¾åï¼Œéƒ½åªèƒ½ä¿è¯æ•°æ®çš„çœŸå®æ€§ã€å®Œæ•´æ€§ï¼Œä¸èƒ½ä¿è¯æ•°æ®è¢«å®‰å…¨ä¼ è¾“ã€‚ è€Œè®¤è¯åŠ å¯†ï¼Œå°±æ˜¯å°†åŠ å¯†ç®—æ³•ä¸ MAC ç®—æ³•ç»“åˆä½¿ç”¨çš„ä¸€ç§åŠ å¯†æ–¹æ¡ˆã€‚ åœ¨ç¡®ä¿ MAC ç ã€Œå¼ºä¸å¯ä¼ªé€ ã€çš„å‰æä¸‹ï¼Œé¦–å…ˆå¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œç„¶åè®¡ç®—å¯†æ–‡çš„ MAC ç ï¼Œå†åŒæ—¶ä¼ è¾“å¯†æ–‡ä¸ MAC ç ï¼Œå°±èƒ½åŒæ—¶ä¿è¯æ•°æ®çš„ä¿å¯†æ€§ã€å®Œæ•´æ€§ã€çœŸå®æ€§ï¼Œè¿™ç§æ–¹æ³•å« Encrypt-then-MAC, ç¼©å†™åš EtM. æ¥æ”¶æ–¹åœ¨è§£å¯†å‰å…ˆè®¡ç®—å¯†æ–‡çš„ MAC ç ä¸æ”¶åˆ°çš„å¯¹æ¯”ï¼Œå°±èƒ½éªŒè¯å¯†æ–‡çš„å®Œæ•´æ€§ä¸çœŸå®æ€§ã€‚ AE æœ‰ä¸€ç§æ›´å®‰å…¨çš„å˜ä½“â€”â€”å¸¦æœ‰å…³è”æ•°æ®çš„è®¤è¯åŠ å¯† (authenticated encryption with associated dataï¼ŒAEAD)ã€‚AEAD å°†ã€Œå…³è”æ•°æ®(Associated Data, AD)ã€â€”â€”ä¹Ÿç§°ä¸ºã€Œé™„åŠ éªŒè¯æ•°æ® ï¼ˆAdditional Authenticated Data, AADï¼‰ã€â€”â€”ç»‘å®šåˆ°å¯†æ–‡å’Œå®ƒåº”è¯¥å‡ºç°çš„ä¸Šä¸‹æ–‡ï¼Œä»¥ä¾¿å¯ä»¥æ£€æµ‹å’Œæ‹’ç»å°†æœ‰æ•ˆå¯†æ–‡ã€Œå‰ªåˆ‡å¹¶ç²˜è´´ã€åˆ°ä¸åŒä¸Šä¸‹æ–‡çš„å°è¯•ã€‚ AEAD ç”¨äºåŠ å¯†å’ŒæœªåŠ å¯†æ•°æ®ä¸€èµ·ä½¿ç”¨çš„åœºæ™¯ï¼ˆä¾‹å¦‚ï¼Œåœ¨åŠ å¯†çš„ç½‘ç»œåè®®ä¸­ï¼‰ï¼Œå¹¶ç¡®ä¿æ•´ä¸ªæ•°æ®æµç»è¿‡èº«ä»½éªŒè¯å’Œå®Œæ•´æ€§ä¿æŠ¤ã€‚æ¢å¥è¯è¯´ï¼ŒAEAD å¢åŠ äº†æ£€æŸ¥æŸäº›å†…å®¹çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§çš„èƒ½åŠ›ã€‚ æˆ‘ä»¬ä¼šåœ¨ç¬¬å…­ç« ã€Œå¯¹ç§°åŠ å¯†ç®—æ³•ã€ä¸­çœ‹åˆ°å¦‚ä½•é€šè¿‡ Python ä½¿ç”¨ AEAD åŠ å¯†æ–¹æ¡ˆ AES-256-GCM. 3. åŸºäº MAC çš„ä¼ªéšæœºæ•°ç”Ÿæˆå™¨MAC ç çš„å¦ä¸€ä¸ªç”¨é€”å°±æ˜¯ä¼ªéšæœºæ•°ç”Ÿæˆå‡½æ•°ï¼Œç›¸æ¯”ç›´æ¥ä½¿ç”¨ç†µ+å“ˆå¸Œå‡½æ•°çš„è¿›è¡Œä¼ªéšæœºæ•°è®¡ç®—ï¼ŒMAC ç å› ä¸ºå¤šå¼•å…¥äº†ä¸€ä¸ªå˜é‡ keyï¼Œç†è®ºä¸Šå®ƒä¼šæ›´å®‰å…¨ã€‚ è¿™ç§åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬ç§° MAC ä½¿ç”¨çš„å¯†é’¥ä¸º saltï¼Œå³ç›ã€‚ text next_seed = MAC(salt, seed) ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-3-key-derivation-function/:1:2","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","å“ˆå¸Œ","æ•£åˆ—","å¯†ç å­¦","å®‰å…¨","MAC","HMAC","KDF","Scrypt"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸‰ï¼‰â€”â€” MAC ä¸å¯†é’¥æ´¾ç”Ÿå‡½æ•° KDF","uri":"/posts/practical-cryptography-basics-3-key-derivation-function/#2-ae-è®¤è¯åŠ å¯†---authenticated-encryption"},{"categories":["tech"],"content":" MAC çš„åº”ç”¨ 1. éªŒè¯æ¶ˆæ¯çš„çœŸå®æ€§ã€å®Œæ•´æ€§è¿™æ˜¯æœ€ç®€å•çš„ä¸€ä¸ªåº”ç”¨åœºæ™¯ï¼Œåœ¨é€šä¿¡åŒå‘éƒ½æŒæœ‰ä¸€ä¸ªé¢„å…±äº«å¯†é’¥çš„å‰æä¸‹ï¼Œé€šä¿¡æ—¶éƒ½é™„å¸¦ä¸Šæ¶ˆæ¯çš„ MAC ç ã€‚æ¥æ”¶æ–¹ä¹Ÿä½¿ç”¨ã€Œæ”¶åˆ°çš„æ¶ˆæ¯+é¢„å…±äº«å¯†é’¥ã€è®¡ç®—å‡º MAC ç ï¼Œå¦‚æœè·Ÿæ”¶åˆ°çš„ä¸€è‡´ï¼Œå°±è¯´æ˜æ¶ˆæ¯çœŸå®æ— è¯¯ã€‚ æ³¨æ„è¿™ç§åº”ç”¨åœºæ™¯ä¸­ï¼Œæ¶ˆæ¯æ˜¯ä¸ä¿å¯†çš„ï¼ 2. AE è®¤è¯åŠ å¯† - Authenticated encryptionå¸¸ç”¨çš„åŠ å¯†æ–¹æ³•åªèƒ½ä¿è¯æ•°æ®çš„ä¿å¯†æ€§ï¼Œå¹¶ä¸èƒ½ä¿è¯æ•°æ®çš„å®Œæ•´æ€§ã€‚ è€Œè¿™é‡Œä»‹ç»çš„ MAC ç®—æ³•ï¼Œæˆ–è€…è¿˜æœªä»‹ç»çš„åŸºäºéå¯¹ç§°åŠ å¯†çš„æ•°å­—ç­¾åï¼Œéƒ½åªèƒ½ä¿è¯æ•°æ®çš„çœŸå®æ€§ã€å®Œæ•´æ€§ï¼Œä¸èƒ½ä¿è¯æ•°æ®è¢«å®‰å…¨ä¼ è¾“ã€‚ è€Œè®¤è¯åŠ å¯†ï¼Œå°±æ˜¯å°†åŠ å¯†ç®—æ³•ä¸ MAC ç®—æ³•ç»“åˆä½¿ç”¨çš„ä¸€ç§åŠ å¯†æ–¹æ¡ˆã€‚ åœ¨ç¡®ä¿ MAC ç ã€Œå¼ºä¸å¯ä¼ªé€ ã€çš„å‰æä¸‹ï¼Œé¦–å…ˆå¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œç„¶åè®¡ç®—å¯†æ–‡çš„ MAC ç ï¼Œå†åŒæ—¶ä¼ è¾“å¯†æ–‡ä¸ MAC ç ï¼Œå°±èƒ½åŒæ—¶ä¿è¯æ•°æ®çš„ä¿å¯†æ€§ã€å®Œæ•´æ€§ã€çœŸå®æ€§ï¼Œè¿™ç§æ–¹æ³•å« Encrypt-then-MAC, ç¼©å†™åš EtM. æ¥æ”¶æ–¹åœ¨è§£å¯†å‰å…ˆè®¡ç®—å¯†æ–‡çš„ MAC ç ä¸æ”¶åˆ°çš„å¯¹æ¯”ï¼Œå°±èƒ½éªŒè¯å¯†æ–‡çš„å®Œæ•´æ€§ä¸çœŸå®æ€§ã€‚ AE æœ‰ä¸€ç§æ›´å®‰å…¨çš„å˜ä½“â€”â€”å¸¦æœ‰å…³è”æ•°æ®çš„è®¤è¯åŠ å¯† (authenticated encryption with associated dataï¼ŒAEAD)ã€‚AEAD å°†ã€Œå…³è”æ•°æ®(Associated Data, AD)ã€â€”â€”ä¹Ÿç§°ä¸ºã€Œé™„åŠ éªŒè¯æ•°æ® ï¼ˆAdditional Authenticated Data, AADï¼‰ã€â€”â€”ç»‘å®šåˆ°å¯†æ–‡å’Œå®ƒåº”è¯¥å‡ºç°çš„ä¸Šä¸‹æ–‡ï¼Œä»¥ä¾¿å¯ä»¥æ£€æµ‹å’Œæ‹’ç»å°†æœ‰æ•ˆå¯†æ–‡ã€Œå‰ªåˆ‡å¹¶ç²˜è´´ã€åˆ°ä¸åŒä¸Šä¸‹æ–‡çš„å°è¯•ã€‚ AEAD ç”¨äºåŠ å¯†å’ŒæœªåŠ å¯†æ•°æ®ä¸€èµ·ä½¿ç”¨çš„åœºæ™¯ï¼ˆä¾‹å¦‚ï¼Œåœ¨åŠ å¯†çš„ç½‘ç»œåè®®ä¸­ï¼‰ï¼Œå¹¶ç¡®ä¿æ•´ä¸ªæ•°æ®æµç»è¿‡èº«ä»½éªŒè¯å’Œå®Œæ•´æ€§ä¿æŠ¤ã€‚æ¢å¥è¯è¯´ï¼ŒAEAD å¢åŠ äº†æ£€æŸ¥æŸäº›å†…å®¹çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§çš„èƒ½åŠ›ã€‚ æˆ‘ä»¬ä¼šåœ¨ç¬¬å…­ç« ã€Œå¯¹ç§°åŠ å¯†ç®—æ³•ã€ä¸­çœ‹åˆ°å¦‚ä½•é€šè¿‡ Python ä½¿ç”¨ AEAD åŠ å¯†æ–¹æ¡ˆ AES-256-GCM. 3. åŸºäº MAC çš„ä¼ªéšæœºæ•°ç”Ÿæˆå™¨MAC ç çš„å¦ä¸€ä¸ªç”¨é€”å°±æ˜¯ä¼ªéšæœºæ•°ç”Ÿæˆå‡½æ•°ï¼Œç›¸æ¯”ç›´æ¥ä½¿ç”¨ç†µ+å“ˆå¸Œå‡½æ•°çš„è¿›è¡Œä¼ªéšæœºæ•°è®¡ç®—ï¼ŒMAC ç å› ä¸ºå¤šå¼•å…¥äº†ä¸€ä¸ªå˜é‡ keyï¼Œç†è®ºä¸Šå®ƒä¼šæ›´å®‰å…¨ã€‚ è¿™ç§åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬ç§° MAC ä½¿ç”¨çš„å¯†é’¥ä¸º saltï¼Œå³ç›ã€‚ text next_seed = MAC(salt, seed) ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-3-key-derivation-function/:1:2","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","å“ˆå¸Œ","æ•£åˆ—","å¯†ç å­¦","å®‰å…¨","MAC","HMAC","KDF","Scrypt"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸‰ï¼‰â€”â€” MAC ä¸å¯†é’¥æ´¾ç”Ÿå‡½æ•° KDF","uri":"/posts/practical-cryptography-basics-3-key-derivation-function/#3-åŸºäº-mac-çš„ä¼ªéšæœºæ•°ç”Ÿæˆå™¨"},{"categories":["tech"],"content":" äºŒã€KDF å¯†é’¥æ´¾ç”Ÿå‡½æ•°æˆ‘ä»¬éƒ½æ›´å–œæ¬¢ä½¿ç”¨å¯†ç æ¥ä¿æŠ¤è‡ªå·±çš„æ•°æ®è€Œä¸æ˜¯äºŒè¿›åˆ¶çš„å¯†é’¥ï¼Œå› ä¸ºç›¸æ¯”ä¹‹ä¸‹äºŒè¿›åˆ¶å¯†é’¥å¤ªéš¾è®°å¿†äº†ï¼Œ å­—ç¬¦å½¢å¼çš„å¯†ç æ‰æ˜¯ç¬¦åˆäººç±»æ€ç»´ä¹ æƒ¯çš„ä¸œè¥¿ã€‚ å¯å¯¹è®¡ç®—æœºè€Œè¨€å°±åˆšå¥½ç›¸åäº†ï¼Œç°ä»£å¯†ç å­¦çš„å¾ˆå¤šç®—æ³•éƒ½è¦æ±‚è¾“å…¥æ˜¯ä¸€ä¸ªå¤§çš„æ•°å­—ï¼ŒäºŒè¿›åˆ¶çš„å¯†é’¥å°±æ˜¯è¿™æ ·ä¸€ä¸ªå¤§çš„æ•°å­—ã€‚å› æ­¤æ˜¾ç„¶æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå°†å­—ç¬¦å¯†ç ï¼ˆPasswordï¼‰è½¬æ¢æˆå¯†é’¥ï¼ˆKeyï¼‰çš„å‡½æ•°ï¼Œè¿™å°±æ˜¯å¯†é’¥æ´¾ç”Ÿå‡½æ•° Key Derivation Function. KDF çš„åå­—ä¸­åŒ…å«äº†ã€ŒDerivationï¼ˆæ´¾ç”Ÿï¼‰ã€ï¼Œé¡¾åæ€ä¹‰ï¼Œå®ƒä¹Ÿå¯ä»¥ä»ä¸€ä¸ªå­—ç¬¦å¯†ç ä¸­ç”Ÿæˆå¤šä¸ªå¯†é’¥ï¼Œä¸€ä¸ªå¸¸è§çš„ç”Ÿæˆå¤šä¸ªå¯†é’¥çš„ç”¨æ³•å°±æ˜¯ BTC çš„ã€Œåˆ†å±‚ç¡®å®šæ€§é’±åŒ…ï¼ˆHierarchical Deterministic Walletï¼‰ã€ã€‚ ç›´æ¥ä½¿ç”¨ SHA256 ä¹‹ç±»çš„åŠ å¯†å“ˆå¸Œå‡½æ•°æ¥ç”Ÿæˆå¯†é’¥æ˜¯ä¸å®‰å…¨çš„ï¼Œå› ä¸ºä¸ºäº†æ–¹ä¾¿è®°å¿†ï¼Œé€šå¸¸å¯†ç å¹¶ä¸ä¼šå¾ˆé•¿ï¼Œç»å¤§å¤šæ•°äººçš„å¯†ç é•¿åº¦ä¼°è®¡éƒ½ä¸è¶…è¿‡ 15 ä½ã€‚ç”šè‡³å¾ˆå¤šäººéƒ½åœ¨ä½¿ç”¨éå¸¸å¸¸è§çš„å¼±å¯†ç ï¼Œå¦‚ 123456 admin ç”Ÿæ—¥ç­‰ç­‰ã€‚è¿™å°±å¯¼è‡´å¦‚æœç›´æ¥ä½¿ç”¨ SHA256 ä¹‹ç±»çš„ç®—æ³•ï¼Œè®¸å¤šå¯†ç å°†å¾ˆå®¹æ˜“è¢«æš´åŠ›ç ´è§£ã€å­—å…¸æ”»å‡»ã€å½©è™¹è¡¨æ”»å‡»ç­‰æ‰‹æ®µçŒœæµ‹å‡ºæ¥ï¼ ä¹Ÿæœ‰äº›å¦‚ HKDFï¼ˆHMAC-based KDFï¼‰ ä¹‹ç±»çš„ KDF ç®—æ³•ç”¨äºç”Ÿæˆå¯†é’¥ï¼Œä½†å®ƒä»¬ä¸é€‚åˆç”¨äºç”¨æˆ·å¯†ç ã€‚HKDF çš„ç‰¹ç‚¹æ˜¯è®¡ç®—é€Ÿåº¦å¿«ï¼Œå› æ­¤å®ƒåªé€‚åˆç”¨äºè¾“å…¥ç†µæ¯”è¾ƒé«˜çš„åœºæ™¯ï¼Œæ¯”å¦‚å°† DHKE çš„å…±äº«å¯†é’¥è½¬æ¢æˆå¯¹ç§°åŠ å¯†ç®—æ³•çš„å¯†é’¥ã€‚å¦‚æœç”¨ HKDF æ¥ä»ç”¨æˆ·å¯†ç ç”Ÿæˆå¯†é’¥ï¼Œé‚£ä¹ˆå¯†ç çš„ç†µå°±å¤ªä½äº†ï¼Œå°†å¾ˆå®¹æ˜“è¢«æš´åŠ›ç ´è§£ï¼ KDF ç›®å‰ä¸»è¦ä»å¦‚ä¸‹ä¸‰ä¸ªç»´åº¦æå‡ hash ç¢°æ’éš¾åº¦ï¼š æ—¶é—´å¤æ‚åº¦ï¼šå¯¹åº” CPU/GPU è®¡ç®—èµ„æº ç©ºé—´å¤æ‚åº¦ï¼šå¯¹åº” Memory å†…å­˜èµ„æº å¹¶è¡Œç»´åº¦ï¼šä½¿ç”¨æ— æ³•åˆ†è§£çš„ç®—æ³•ï¼Œé”å®šåªå…è®¸å•çº¿ç¨‹è¿ç®— ä¸»è¦æ‰‹æ®µæ˜¯åŠ ç›ï¼Œä»¥åŠå¤šæ¬¡è¿­ä»£ã€‚è¿™ç§è®¾è®¡æ–¹æ³•è¢«ç§°ä¸ºã€Œå¯†é’¥æ‹‰ä¼¸ Key stretchingã€ã€‚ KDF çš„å·¥ä½œç¤ºæ„å›¾å¦‚ä¸‹ï¼š å› ä¸ºç›¸æ¯”å…¶ä»–åŠ å¯†å“ˆå¸Œç®—æ³•ï¼ŒKDF å…·æœ‰ä¸€ä¸ªç‹¬ç‰¹å±æ€§â€”â€”è®¡ç®—é€Ÿåº¦å¾ˆæ…¢ï¼Œè€Œä¸”ä»è®¾è®¡ä¸Šå°±ä½¿å…¶è®¡ç®—é€Ÿåº¦éš¾ä»¥æå‡ï¼Œæ‰€ä»¥ KDF ä¹Ÿè¢«ç§°ä½œã€Œæ…¢å“ˆå¸Œç®—æ³•ã€ã€‚ KDF è®¡ç®—é€Ÿåº¦çš„ã€Œæ…¢ã€æ˜¯ç›¸å¯¹è€Œè¨€çš„ï¼Œå¯¹äº SSH ç­‰æœ¬åœ°åº”ç”¨è€Œè¨€ï¼ŒKDF é€šå¸¸åªéœ€è¦åœ¨ç™»å½•æ—¶è¢«æ‰§è¡Œä¸€æ¬¡ï¼Œå› æ­¤æ…¢è¿™ä¹ˆä¸€ç‚¹ç‚¹å®Œå…¨å¯ä»¥æ¥å—ï¼Œè€Œä¸”ç”¨æˆ·ä¹Ÿå®Œå…¨æœ‰è¶³å¤Ÿçš„èµ„æºæ‰§è¡Œè¿™ä¸ª KDF å‡½æ•°ã€‚å¯¹äº APP ç™»å½•è®¾è®¡è€Œè¨€ï¼Œç”¨æˆ·ç™»å½•å®Œæˆååç»­å°±ä¼šä½¿ç”¨ cookie è¿›è¡ŒéªŒè¯ï¼Œå•æ¬¡ç™»å½•æ—¶å¤šèŠ±è´¹ç‚¹èµ„æºå¹¶ä¸ä¼šé€ æˆå¤§é‡çš„èµ„æºæ¶ˆè€—ã€‚ä½†æ˜¯å¦‚æœä¸€ä¸ªé»‘å®¢è·å¾—äº†ä½ çš„åŠ å¯† SSH Key æˆ–è€…æ‹–åº“æ‹¿åˆ°äº† APP çš„å¯†ç æ•°æ®åº“ï¼Œæƒ³è¦é€šè¿‡ Hash ç¢°æ’æ¥çŒœæµ‹å‡ºç”¨æˆ·çš„å¯†ç ï¼Œé‚£å®ƒå°±å¿…é¡»æ‰§è¡Œæµ·é‡çš„ KDF è®¡ç®—ï¼Œè¿™ä¸ªæ—¶å€™ KDF çš„å¨åŠ›å°±æ˜¾ç°å‡ºæ¥äº†â€”â€”é»‘å®¢å°†éœ€è¦æä¾›æµ·é‡çš„ CPU/GPU è®¡ç®—èµ„æºã€æµ·é‡çš„å†…å­˜èµ„æºæ‰èƒ½å®Œæˆç›®æ ‡ï¼Œè€Œè¿™æ˜¾ç„¶å¾—ä¸å¿å¤±ï¼Œè¿™æ · KDF å°±ç¡®ä¿äº†ç”¨æˆ·å¯†ç çš„å®‰å…¨æ€§ã€‚ ç›®å‰æ¯”è¾ƒè‘—åçš„ KDF ç®—æ³•ä¸»è¦æœ‰å¦‚ä¸‹å‡ ä¸ªï¼š PBKDF2ï¼šè¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„åŠ å¯† KDF ç®—æ³•ï¼Œç›®å‰å·²ç»ä¸æ¨èä½¿ç”¨ã€‚ Bcryptï¼šå®‰å…¨æ€§åœ¨ä¸‹é™ï¼Œç”¨å¾—è¶Šæ¥è¶Šå°‘äº†ã€‚ä¸å»ºè®®ä½¿ç”¨ã€‚ æ ¹æ® Wikipedia è¯´æ˜ï¼Œåœ¨å†…å­˜å°äº 4MB æ—¶ bcrypt è¦å¼ºäº scryptï¼Œåœ¨è¿è¡Œæ—¶é—´å°äº 1 ç§’æ—¶å…¶å¼ºåº¦è¦é«˜äº argon2. å› æ­¤åœ¨ä¸€äº›æç«¯èµ„æºåœºæ™¯ä¸‹ï¼Œä»æ—§å¯ä»¥è€ƒè™‘ bcrypt ç®—æ³•ã€‚ å¦å¤–éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼ŒWikipedia è¯´ bcrypt å¹¶éå…¸å‹çš„ KDF ç®—æ³•ï¼Œå®ƒçš„è¾“å‡ºä¸é€‚åˆç›´æ¥ç”¨åšåŠ è§£å¯†æˆ–ç­¾åç”¨çš„ Key, å› æ­¤ OpenSSH çš„å®ç°æ˜¯å°† Bcrypt çš„è¾“å‡ºå†ç”¨ BPKDF2 åŠ ç›å¤„ç†ä¸€éè¾“å‡ºæœ€ç»ˆç”¨äºéªŒè¯çš„äºŒè¿›åˆ¶ Keyï¼Œä¹Ÿå³å®ƒçš„ bcrypt_pbkdf ç®—æ³•ã€‚ Scryptï¼šå¯ä»¥çµæ´»åœ°è®¾å®šä½¿ç”¨çš„å†…å­˜å¤§å°ï¼Œåœ¨ argon2 ä¸å¯ç”¨æ—¶ï¼Œå¯ä½¿ç”¨å®ƒã€‚ Scrypt æ˜¯ç›®å‰ç¤¾åŒºä½¿ç”¨çš„ä¸»æµç®—æ³•ï¼ŒçŸ¥åæ¡ˆä¾‹å¦‚ï¼šage,rclone,restic Argon2ï¼šç›®å‰æœ€å¼ºçš„å¯†ç  Hash ç®—æ³•ï¼Œåœ¨ 2015 å¹´èµ¢å¾—äº†å¯†ç  Hash ç«èµ›ã€‚ Linux çš„ç¡¬ç›˜åŠ å¯†æ¨¡å— LUKS2 å°±æ”¯æŒä½¿ç”¨ argon2id ä½œä¸ºå®ƒçš„ KDF ç®—æ³•ã€‚ å¦‚æœä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªæ–°çš„ç¨‹åºï¼Œéœ€è¦ä½¿ç”¨åˆ° KDFï¼Œå»ºè®®é€‰ç”¨ argon2/scrypt. Python ä¸­æœ€æµè¡Œçš„å¯†ç å­¦åº“æ˜¯cryptographyï¼Œrequests çš„åº•å±‚æ›¾ç»å°±ä½¿ç”¨äº†å®ƒï¼ˆæ–°ç‰ˆæœ¬å·²ç»æ¢æˆä½¿ç”¨æ ‡å‡†åº“ ssl äº†ï¼‰ï¼Œä¸‹é¢æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªåº“æ¥æ¼”ç¤ºä¸‹ Scrypt ç®—æ³•çš„ä½¿ç”¨ï¼š python # pip install cryptography==36.0.1 import os from cryptography.hazmat.primitives.kdf.scrypt import Scrypt salt = os.urandom(16) # derive kdf = Scrypt( salt=salt, length=32, n=2**14, r=8, p=1, ) key = kdf.derive(b\"my great password\") # verify kdf = Scrypt( salt=salt, length=32, n=2**14, r=8, p=1, ) kdf.verify(b\"my great password\", key) ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-3-key-derivation-function/:2:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","å“ˆå¸Œ","æ•£åˆ—","å¯†ç å­¦","å®‰å…¨","MAC","HMAC","KDF","Scrypt"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸‰ï¼‰â€”â€” MAC ä¸å¯†é’¥æ´¾ç”Ÿå‡½æ•° KDF","uri":"/posts/practical-cryptography-basics-3-key-derivation-function/#äºŒkdf-å¯†é’¥æ´¾ç”Ÿå‡½æ•°"},{"categories":["tech"],"content":" å‚è€ƒ Practical-Cryptography-for-Developers-Book A complete overview of SSL/TLS and its cryptographic system ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-3-key-derivation-function/:3:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","å“ˆå¸Œ","æ•£åˆ—","å¯†ç å­¦","å®‰å…¨","MAC","HMAC","KDF","Scrypt"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸‰ï¼‰â€”â€” MAC ä¸å¯†é’¥æ´¾ç”Ÿå‡½æ•° KDF","uri":"/posts/practical-cryptography-basics-3-key-derivation-function/#å‚è€ƒ"},{"categories":["tech"],"content":" æœ¬æ–‡ä¸»è¦ç¿»è¯‘è‡ª Practical-Cryptography-for-Developers-Bookï¼Œç¬”è€…é¢å¤–è¡¥å……äº†ã€ŒéåŠ å¯†å“ˆå¸Œå‡½æ•°ã€çš„ç®€å•ä»‹ç»ã€‚ ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-2-hash/:0:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","å¯†ç å­¦","å“ˆå¸Œ","æ•£åˆ—","å®‰å…¨","SHA-2","SHA-3"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆäºŒï¼‰â€”â€” å“ˆå¸Œå‡½æ•°","uri":"/posts/practical-cryptography-basics-2-hash/#"},{"categories":["tech"],"content":" ä¸€ã€ä»€ä¹ˆæ˜¯å“ˆå¸Œå‡½æ•°å“ˆå¸Œå‡½æ•°ï¼ˆHash Functionï¼‰ï¼Œæˆ–è€…å«æ•£åˆ—å‡½æ•°ï¼Œæ˜¯ä¸€ç§ä»ä»»ä½•è¾“å…¥æ•°æ®ä¸­åˆ›å»ºä¸€ä¸ªæ•°å­—æŒ‡çº¹ï¼ˆä¹Ÿå«æ•°å­—æ‘˜è¦ï¼‰çš„æ–¹æ³•ï¼Œå“ˆå¸Œå‡½æ•°æŠŠæ•°æ®å‹ç¼©ï¼ˆæˆ–è€…æ”¾å¤§ï¼‰æˆä¸€ä¸ªé•¿åº¦å›ºå®šçš„å­—ç¬¦ä¸²ã€‚ å“ˆå¸Œå‡½æ•°çš„è¾“å…¥ç©ºé—´ï¼ˆæ–‡æœ¬æˆ–è€…äºŒè¿›åˆ¶æ•°æ®ï¼‰æ˜¯æ— é™å¤§ï¼Œä½†æ˜¯è¾“å‡ºç©ºé—´ï¼ˆä¸€ä¸ªå›ºå®šé•¿åº¦çš„æ‘˜è¦ï¼‰å´æ˜¯æœ‰é™çš„ã€‚å°†ã€Œæ— é™ã€æ˜ å°„åˆ°ã€Œæœ‰é™ã€ï¼Œä¸å¯é¿å…çš„ä¼šæœ‰æ¦‚ç‡ä¸åŒçš„è¾“å…¥å¾—åˆ°ç›¸åŒçš„è¾“å‡ºï¼Œè¿™ç§æƒ…å†µæˆ‘ä»¬ç§°ä¸ºç¢°æ’ï¼ˆcollisionï¼‰ã€‚ ä¸€ä¸ªç®€å•çš„å“ˆå¸Œå‡½æ•°æ˜¯ç›´æ¥å¯¹è¾“å…¥æ•°æ®/æ–‡æœ¬çš„å­—èŠ‚æ±‚å’Œã€‚å®ƒä¼šå¯¼è‡´å¤§é‡çš„ç¢°æ’ï¼Œä¾‹å¦‚ hello å’Œ ehllo å°†å…·æœ‰ç›¸åŒçš„å“ˆå¸Œå€¼ã€‚ æ›´å¥½çš„å“ˆå¸Œå‡½æ•°å¯ä»¥ä½¿ç”¨è¿™æ ·çš„æ–¹æ¡ˆï¼šå®ƒå°†ç¬¬ä¸€ä¸ªå­—èŠ‚ä½œä¸ºçŠ¶æ€ï¼Œç„¶åè½¬æ¢çŠ¶æ€ï¼ˆä¾‹å¦‚ï¼Œå°†å®ƒä¹˜ä»¥åƒ 31 è¿™æ ·çš„ç´ æ•°ï¼‰ï¼Œç„¶åå°†ä¸‹ä¸€ä¸ªå­—èŠ‚æ·»åŠ åˆ°çŠ¶æ€ï¼Œç„¶åå†æ¬¡è½¬æ¢çŠ¶æ€å¹¶æ·»åŠ ä¸‹ä¸€ä¸ªå­—èŠ‚ç­‰ã€‚è¿™æ ·çš„æ“ä½œå¯ä»¥æ˜¾ç€é™ä½ç¢°æ’æ¦‚ç‡å¹¶äº§ç”Ÿæ›´å‡åŒ€çš„åˆ†å¸ƒã€‚ ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-2-hash/:1:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","å¯†ç å­¦","å“ˆå¸Œ","æ•£åˆ—","å®‰å…¨","SHA-2","SHA-3"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆäºŒï¼‰â€”â€” å“ˆå¸Œå‡½æ•°","uri":"/posts/practical-cryptography-basics-2-hash/#ä¸€ä»€ä¹ˆæ˜¯å“ˆå¸Œå‡½æ•°"},{"categories":["tech"],"content":" äºŒã€åŠ å¯†å“ˆå¸Œå‡½æ•°åŠ å¯†å“ˆå¸Œå‡½æ•°ï¼ˆä¹Ÿå«å¯†ç å­¦å“ˆå¸Œå‡½æ•°ï¼‰æ˜¯æŒ‡ä¸€ç±»æœ‰ç‰¹æ®Šå±æ€§çš„å“ˆå¸Œå‡½æ•°ã€‚ ä¸€ä¸ªå¥½çš„ã€ŒåŠ å¯†å“ˆå¸Œå‡½æ•°ã€å¿…é¡»æ»¡è¶³æŠ—ç¢°æ’ï¼ˆcollision-resistantï¼‰å’Œä¸å¯é€†ï¼ˆirreversibleï¼‰è¿™ä¸¤ä¸ªæ¡ä»¶ã€‚æŠ—ç¢°æ’æ˜¯æŒ‡æ”»å‡»è€…å¾ˆéš¾æˆ–è€…å‡ ä¹ä¸å¯èƒ½æ‰¾åˆ°ä¸¤ä¸ªå…·æœ‰ç›¸åŒå“ˆå¸Œå€¼çš„è¾“å…¥ï¼Œè€Œä¸å¯é€†åˆ™æ˜¯è¯´æ”»å‡»è€…å¾ˆéš¾æˆ–å‡ ä¹ä¸å¯èƒ½ä»ç®—æ³•å±‚é¢é€šè¿‡å“ˆå¸Œå€¼é€†å‘æ¼”ç®—å‡ºåŸå§‹æ•°æ®ã€‚ å…·ä½“è€Œè¨€ï¼Œä¸€ä¸ªç†æƒ³çš„åŠ å¯†å“ˆå¸Œå‡½æ•°ï¼Œåº”å½“å…·æœ‰å¦‚ä¸‹å±æ€§ï¼š å¿«é€Ÿï¼šè®¡ç®—é€Ÿåº¦è¦è¶³å¤Ÿå¿« ç¡®å®šæ€§ï¼šå¯¹åŒæ ·çš„è¾“å…¥ï¼Œåº”è¯¥æ€»æ˜¯äº§ç”ŸåŒæ ·çš„è¾“å‡º éš¾ä»¥åˆ†æï¼šå¯¹è¾“å…¥çš„ä»»ä½•å¾®å°æ”¹åŠ¨ï¼Œéƒ½åº”è¯¥ä½¿è¾“å‡ºå®Œå…¨å‘ç”Ÿå˜åŒ– ä¸å¯é€†ï¼šä»å…¶å“ˆå¸Œå€¼é€†å‘æ¼”ç®—å‡ºè¾“å…¥å€¼åº”è¯¥æ˜¯ä¸å¯è¡Œçš„ã€‚è¿™æ„å‘³ç€æ²¡æœ‰æ¯”æš´åŠ›ç ´è§£æ›´å¥½çš„ç ´è§£æ–¹æ³• æŠ—ç¢°æ’ï¼šæ‰¾åˆ°å…·æœ‰ç›¸åŒå“ˆå¸Œå€¼çš„ä¸¤æ¡ä¸åŒæ¶ˆæ¯åº”è¯¥éå¸¸å›°éš¾ï¼ˆæˆ–å‡ ä¹ä¸å¯èƒ½ï¼‰ ç°ä»£åŠ å¯†å“ˆå¸Œå‡½æ•°ï¼ˆå¦‚ SHA2 å’Œ SHA3ï¼‰éƒ½å…·æœ‰ä¸Šè¿°å‡ ä¸ªå±æ€§ï¼Œå¹¶è¢«å¹¿æ³›åº”ç”¨åœ¨å¤šä¸ªé¢†åŸŸï¼Œå„ç§ç°ä»£ç¼–ç¨‹è¯­è¨€å’Œå¹³å°çš„æ ‡å‡†åº“ä¸­åŸºæœ¬éƒ½åŒ…å«è¿™äº›å¸¸ç”¨çš„å“ˆå¸Œå‡½æ•°ã€‚ ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-2-hash/:2:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","å¯†ç å­¦","å“ˆå¸Œ","æ•£åˆ—","å®‰å…¨","SHA-2","SHA-3"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆäºŒï¼‰â€”â€” å“ˆå¸Œå‡½æ•°","uri":"/posts/practical-cryptography-basics-2-hash/#äºŒåŠ å¯†å“ˆå¸Œå‡½æ•°"},{"categories":["tech"],"content":" é‡å­å®‰å…¨æ€§ç°ä»£å¯†ç å­¦å“ˆå¸Œå‡½æ•°ï¼ˆå¦‚ SHA2, SHA3, BLAKE2ï¼‰éƒ½è¢«è®¤ä¸ºæ˜¯é‡å­å®‰å…¨çš„ï¼Œæ— æƒ§é‡å­è®¡ç®—æœºçš„å‘å±•ã€‚ ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-2-hash/:2:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","å¯†ç å­¦","å“ˆå¸Œ","æ•£åˆ—","å®‰å…¨","SHA-2","SHA-3"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆäºŒï¼‰â€”â€” å“ˆå¸Œå‡½æ•°","uri":"/posts/practical-cryptography-basics-2-hash/#é‡å­å®‰å…¨æ€§"},{"categories":["tech"],"content":" åŠ å¯†å“ˆå¸Œå‡½æ•°çš„åº”ç”¨ 1. æ•°æ®å®Œæ•´æ€§æ ¡éªŒåŠ å¯†å“ˆå¸Œå‡½æ•°è¢«å¹¿æ³›ç”¨äºæ–‡ä»¶å®Œæ•´æ€§æ ¡éªŒã€‚å¦‚æœä½ ä»ç½‘ä¸Šä¸‹è½½çš„æ–‡ä»¶è®¡ç®—å‡ºçš„ SHA256 æ ¡éªŒå’Œ ï¼ˆchecksumï¼‰è·Ÿå®˜æ–¹å…¬å¸ƒçš„ä¸€è‡´ï¼Œé‚£å°±è¯´æ˜æ–‡ä»¶æ²¡æœ‰æŸåã€‚ ä½†æ˜¯å“ˆå¸Œå‡½æ•°è‡ªèº«ä¸èƒ½ä¿è¯æ–‡ä»¶çš„çœŸå®æ€§ï¼Œç›®å‰æ¥è®²ï¼ŒçœŸå®æ€§é€šå¸¸æ˜¯ TLS åè®®è¦ä¿è¯çš„ï¼Œå®ƒç¡®ä¿ä½ åœ¨ openssl ç½‘ç«™ä¸Šçœ‹åˆ°çš„ã€ŒSHA256 æ ¡éªŒå’Œã€çœŸå®æ— è¯¯ï¼ˆæœªè¢«ç¯¡æ”¹ï¼‰ã€‚ ç°ä»£ç½‘ç»œåŸºæœ¬éƒ½å¾ˆéš¾é‡åˆ°æ–‡ä»¶æŸåçš„æƒ…å†µäº†ï¼Œä½†æ˜¯åœ¨å¤æ—©çš„ä½é€Ÿç½‘ç»œä¸­ï¼Œå³ä½¿ TCP è·Ÿåº•å±‚åè®®å·²ç»æœ‰å¤šç§æ•°æ®çº é”™æ‰‹æ®µï¼Œä¸‹è½½å®Œæˆçš„æ–‡ä»¶ä»ç„¶æ˜¯æœ‰å¯èƒ½æŸåçš„ã€‚è¿™ä¹Ÿæ˜¯ä»¥å‰ rar å‹ç¼©æ ¼å¼å¾ˆæµè¡Œçš„åŸå› ä¹‹ä¸€â€”â€” rar å‹ç¼©æ–‡ä»¶æ‹¥æœ‰ä¸€å®šç¨‹åº¦ä¸Šçš„è‡ªæˆ‘ä¿®å¤èƒ½åŠ›ï¼Œä¼ è¾“è¿‡ç¨‹ä¸­æŸåå°‘é‡æ•°æ®ï¼Œä»ç„¶èƒ½æ­£å¸¸è§£å‹ã€‚ 2. ä¿å­˜å¯†ç åŠ å¯†å“ˆå¸Œå‡½æ•°è¿˜è¢«ç”¨äºå¯†ç çš„å®‰å…¨å­˜å‚¨ï¼Œç°ä»£ç³»ç»Ÿä½¿ç”¨ä¸“é—¨è®¾è®¡çš„å®‰å…¨å“ˆå¸Œç®—æ³•ï¼ˆç›®å‰ä¸»è¦æ˜¯scryptï¼‰ è®¡ç®—ç”¨æˆ·å¯†ç çš„å“ˆå¸Œæ‘˜è¦ï¼Œä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œè¿™æ ·èƒ½ç¡®ä¿å¯†ç çš„å®‰å…¨æ€§ã€‚é™¤äº†ç”¨æˆ·è‡ªå·±ï¼Œæ²¡æœ‰äººæ¸…æ¥šè¯¥å¯†ç çš„åŸå§‹æ•°æ®ï¼Œå³ä½¿æ•°æ®åº“ç®¡ç†å‘˜ä¹Ÿåªèƒ½çœ‹åˆ°ä¸€ä¸ªå“ˆå¸Œæ‘˜è¦ã€‚ ç®€è¦è¯´æ˜ä¸‹ä¸€ä¸ªç°ä»£åŒ–ç«™ç‚¹çš„æ³¨å†Œç™»å½•æµç¨‹ï¼š ç”¨æˆ·ä¸ç«™ç‚¹äº¤äº’çš„å…¨æµç¨‹éƒ½éœ€ä½¿ç”¨ HTTPS å®‰å…¨ä¼ è¾“å¯†ç åŠå…¶ä»–ç”¨æˆ·ä¿¡æ¯ã€‚ åœ¨ç”¨æˆ·æ³¨å†Œæ—¶ï¼Œå¯†ç è¢«æäº¤åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯ç”Ÿæˆéšæœº Salt + å›ºå®šçš„å…¨å±€ Pepperï¼Œç„¶åä½¿ç”¨è¿™ä¸¤è€…åŠç”¨æˆ·å¯†ç è®¡ç®—å‡º password hash å€¼ï¼Œå¹¶å°† hash å€¼ä¸ salt å­˜å…¥æ•°æ®åº“ã€‚æ¥ç€æœåŠ¡ç«¯ç«‹å³ä»å†…å­˜ä¸­é”€æ¯ç”¨æˆ·å¯†ç ã€‚ åœ¨ç”¨æˆ·ç™»å½•æ—¶ï¼Œç”¨æˆ·å¯†ç ä¹Ÿé¦–å…ˆè¢«æäº¤åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯ä»æ•°æ®åº“ä¸­æŸ¥åˆ°å¯¹åº”çš„ Saltï¼Œä»ç¯å¢ƒå˜é‡ä¸­æ‹¿åˆ°å…¨å±€ Peppleï¼Œå¹¶ä½¿ç”¨è¿™ä¸¤è€…åŠç”¨æˆ·å¯†ç å†æ¬¡è®¡ç®— password hash å€¼ï¼Œå¦‚æœç»“æœä¸æ•°æ®åº“ä¸­çš„ password hash ç›¸åŒï¼Œåˆ™ç™»å½•æˆåŠŸï¼Œå¦åˆ™å¤±è´¥ã€‚ä¸è®ºæˆåŠŸä¸å¦ï¼Œè®¡ç®—ç»“æŸåç”¨æˆ·å¯†ç å°†è¢«ç«‹å³é”€æ¯ã€‚ ç”¨æˆ·ç™»å½•æˆåŠŸåï¼ŒæœåŠ¡ç«¯è¿”å›ä¸€ä¸ª JWT Token å®ç°ï¼Œå…¶ä¸­æ˜æ–‡ä¿å­˜äº†ç”¨æˆ·ä¿¡æ¯, æœ‰æ•ˆæœŸåŠä¸€ä¸ªç­¾åã€‚ åç»­ç”¨æˆ·æ¯æ¬¡è¯·æ±‚éƒ½ä¼šåœ¨ HTTP Header ä¸­å¸¦ä¸Šè¿™ä¸ª JWT Tokenï¼ŒæœåŠ¡ç«¯éªŒè¯ç­¾åæœ‰æ•ˆï¼Œè€Œä¸”å°šåœ¨æœ‰æ•ˆæœŸå†…ï¼Œåˆ™é€šè¿‡éªŒè¯ï¼Œå†è¿›è¡Œåç»­å¤„ç†ã€‚ 3. ç”Ÿæˆå”¯ä¸€ IDåŠ å¯†å“ˆå¸Œå‡½æ•°ä¹Ÿè¢«ç”¨äºä¸ºæ–‡æ¡£æˆ–æ¶ˆæ¯ç”Ÿæˆï¼ˆç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼‰å”¯ä¸€çš„ IDï¼Œå› æ­¤å“ˆå¸Œå€¼ä¹Ÿè¢«ç§°ä¸ºæ•°å­—æŒ‡çº¹ã€‚ æ³¨æ„è¿™é‡Œè¯´çš„æ˜¯æ•°å­—æŒ‡çº¹ï¼Œè€Œéæ•°å­—ç­¾åã€‚æ•°å­—ç­¾åæ˜¯ä¸ä¸‹ä¸€ç¯‡æ–‡ç« ä»‹ç»çš„ã€ŒMACã€ç æ¯”è¾ƒç±»ä¼¼çš„ï¼Œ ç”¨äºéªŒè¯æ¶ˆæ¯çš„çœŸå®ã€å®Œæ•´ã€è®¤è¯ä½œè€…èº«ä»½çš„ä¸€æ®µæ•°æ®ã€‚ åŠ å¯†å“ˆå¸Œå‡½æ•°è®¡ç®—å‡ºçš„å“ˆå¸Œå€¼ç†è®ºä¸Šç¡®å®æœ‰ç¢°æ’çš„æ¦‚ç‡ï¼Œä½†æ˜¯è¿™ä¸ªæ¦‚ç‡å®åœ¨å¤ªå°äº†ï¼Œå› æ­¤ç»å¤§å¤šæ•°ç³»ç»Ÿ ï¼ˆå¦‚ Gitï¼‰éƒ½å‡è®¾å“ˆå¸Œå‡½æ•°æ˜¯æ— ç¢°æ’çš„ï¼ˆcollision freeï¼‰ã€‚ æ–‡æ¡£çš„å“ˆå¸Œå€¼å¯ä»¥è¢«ç”¨äºè¯æ˜è¯¥æ–‡æ¡£çš„å­˜åœ¨æ€§ï¼Œæˆ–è€…è¢«å½“æˆä¸€ä¸ªç´¢å¼•ï¼Œç”¨äºä»å­˜å‚¨ç³»ç»Ÿä¸­æå–æ–‡æ¡£ã€‚ ä½¿ç”¨å“ˆå¸Œå€¼ä½œä¸ºå”¯ä¸€ ID çš„å…¸å‹ä¾‹å­ï¼ŒGit ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼ˆå¦‚3c3be25bc1757ca99aba55d4157596a8ea217698ï¼‰è‚¯å®šç®—ä¸€ä¸ªï¼Œæ¯”ç‰¹å¸åœ°å€ï¼ˆå¦‚1BvBMSEYstWetqTFn5Au4m4GFg7xJaNVN2ï¼‰ä¹Ÿç®—ã€‚ 4. ä¼ªéšæœºæ•°ç”Ÿæˆå“ˆå¸Œå€¼å¯ä»¥è¢«å½“ä½œä¸€ä¸ªéšæœºæ•°çœ‹å¾…ï¼Œç”Ÿæˆä¸€ä¸ªä¼ªéšæœºæ•°çš„ç®€å•æµç¨‹å¦‚ä¸‹ï¼š é€šè¿‡éšæœºäº‹ä»¶å¾—åˆ°ä¸€ä¸ªç†µï¼ˆä¾‹å¦‚é”®ç›˜ç‚¹å‡»æˆ–é¼ æ ‡ç§»åŠ¨ï¼‰ï¼Œå°†å®ƒä½œä¸ºæœ€åˆçš„éšæœºæ•°ç§å­ï¼ˆrandom seedï¼‰ã€‚ æ·»åŠ ä¸€ä¸ª 1 åˆ°ç†µä¸­ï¼Œè¿›è¡Œå“ˆå¸Œè®¡ç®—å¾—åˆ°ç¬¬ä¸€ä¸ªéšæœºæ•° å†æ·»åŠ ä¸€ä¸ª 2ï¼Œè¿›è¡Œå“ˆå¸Œè®¡ç®—å¾—åˆ°ç¬¬äºŒä¸ªéšæœºæ•° ä»¥æ­¤ç±»æ¨ å½“ç„¶ä¸ºäº†ç¡®ä¿å®‰å…¨æ€§ï¼Œå®é™…çš„åŠ å¯†éšæœºæ•°ç”Ÿæˆå™¨ä¼šæ¯”è¿™å†å¤æ‚ä¸€äº›ï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢çš„ã€Œéšæœºæ•°ç”Ÿæˆå™¨ã€ä¸€èŠ‚å­¦ä¹ å…¶ä¸­ç»†èŠ‚ã€‚ ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-2-hash/:2:2","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","å¯†ç å­¦","å“ˆå¸Œ","æ•£åˆ—","å®‰å…¨","SHA-2","SHA-3"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆäºŒï¼‰â€”â€” å“ˆå¸Œå‡½æ•°","uri":"/posts/practical-cryptography-basics-2-hash/#åŠ å¯†å“ˆå¸Œå‡½æ•°çš„åº”ç”¨"},{"categories":["tech"],"content":" åŠ å¯†å“ˆå¸Œå‡½æ•°çš„åº”ç”¨ 1. æ•°æ®å®Œæ•´æ€§æ ¡éªŒåŠ å¯†å“ˆå¸Œå‡½æ•°è¢«å¹¿æ³›ç”¨äºæ–‡ä»¶å®Œæ•´æ€§æ ¡éªŒã€‚å¦‚æœä½ ä»ç½‘ä¸Šä¸‹è½½çš„æ–‡ä»¶è®¡ç®—å‡ºçš„ SHA256 æ ¡éªŒå’Œ ï¼ˆchecksumï¼‰è·Ÿå®˜æ–¹å…¬å¸ƒçš„ä¸€è‡´ï¼Œé‚£å°±è¯´æ˜æ–‡ä»¶æ²¡æœ‰æŸåã€‚ ä½†æ˜¯å“ˆå¸Œå‡½æ•°è‡ªèº«ä¸èƒ½ä¿è¯æ–‡ä»¶çš„çœŸå®æ€§ï¼Œç›®å‰æ¥è®²ï¼ŒçœŸå®æ€§é€šå¸¸æ˜¯ TLS åè®®è¦ä¿è¯çš„ï¼Œå®ƒç¡®ä¿ä½ åœ¨ openssl ç½‘ç«™ä¸Šçœ‹åˆ°çš„ã€ŒSHA256 æ ¡éªŒå’Œã€çœŸå®æ— è¯¯ï¼ˆæœªè¢«ç¯¡æ”¹ï¼‰ã€‚ ç°ä»£ç½‘ç»œåŸºæœ¬éƒ½å¾ˆéš¾é‡åˆ°æ–‡ä»¶æŸåçš„æƒ…å†µäº†ï¼Œä½†æ˜¯åœ¨å¤æ—©çš„ä½é€Ÿç½‘ç»œä¸­ï¼Œå³ä½¿ TCP è·Ÿåº•å±‚åè®®å·²ç»æœ‰å¤šç§æ•°æ®çº é”™æ‰‹æ®µï¼Œä¸‹è½½å®Œæˆçš„æ–‡ä»¶ä»ç„¶æ˜¯æœ‰å¯èƒ½æŸåçš„ã€‚è¿™ä¹Ÿæ˜¯ä»¥å‰ rar å‹ç¼©æ ¼å¼å¾ˆæµè¡Œçš„åŸå› ä¹‹ä¸€â€”â€” rar å‹ç¼©æ–‡ä»¶æ‹¥æœ‰ä¸€å®šç¨‹åº¦ä¸Šçš„è‡ªæˆ‘ä¿®å¤èƒ½åŠ›ï¼Œä¼ è¾“è¿‡ç¨‹ä¸­æŸåå°‘é‡æ•°æ®ï¼Œä»ç„¶èƒ½æ­£å¸¸è§£å‹ã€‚ 2. ä¿å­˜å¯†ç åŠ å¯†å“ˆå¸Œå‡½æ•°è¿˜è¢«ç”¨äºå¯†ç çš„å®‰å…¨å­˜å‚¨ï¼Œç°ä»£ç³»ç»Ÿä½¿ç”¨ä¸“é—¨è®¾è®¡çš„å®‰å…¨å“ˆå¸Œç®—æ³•ï¼ˆç›®å‰ä¸»è¦æ˜¯scryptï¼‰ è®¡ç®—ç”¨æˆ·å¯†ç çš„å“ˆå¸Œæ‘˜è¦ï¼Œä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œè¿™æ ·èƒ½ç¡®ä¿å¯†ç çš„å®‰å…¨æ€§ã€‚é™¤äº†ç”¨æˆ·è‡ªå·±ï¼Œæ²¡æœ‰äººæ¸…æ¥šè¯¥å¯†ç çš„åŸå§‹æ•°æ®ï¼Œå³ä½¿æ•°æ®åº“ç®¡ç†å‘˜ä¹Ÿåªèƒ½çœ‹åˆ°ä¸€ä¸ªå“ˆå¸Œæ‘˜è¦ã€‚ ç®€è¦è¯´æ˜ä¸‹ä¸€ä¸ªç°ä»£åŒ–ç«™ç‚¹çš„æ³¨å†Œç™»å½•æµç¨‹ï¼š ç”¨æˆ·ä¸ç«™ç‚¹äº¤äº’çš„å…¨æµç¨‹éƒ½éœ€ä½¿ç”¨ HTTPS å®‰å…¨ä¼ è¾“å¯†ç åŠå…¶ä»–ç”¨æˆ·ä¿¡æ¯ã€‚ åœ¨ç”¨æˆ·æ³¨å†Œæ—¶ï¼Œå¯†ç è¢«æäº¤åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯ç”Ÿæˆéšæœº Salt + å›ºå®šçš„å…¨å±€ Pepperï¼Œç„¶åä½¿ç”¨è¿™ä¸¤è€…åŠç”¨æˆ·å¯†ç è®¡ç®—å‡º password hash å€¼ï¼Œå¹¶å°† hash å€¼ä¸ salt å­˜å…¥æ•°æ®åº“ã€‚æ¥ç€æœåŠ¡ç«¯ç«‹å³ä»å†…å­˜ä¸­é”€æ¯ç”¨æˆ·å¯†ç ã€‚ åœ¨ç”¨æˆ·ç™»å½•æ—¶ï¼Œç”¨æˆ·å¯†ç ä¹Ÿé¦–å…ˆè¢«æäº¤åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯ä»æ•°æ®åº“ä¸­æŸ¥åˆ°å¯¹åº”çš„ Saltï¼Œä»ç¯å¢ƒå˜é‡ä¸­æ‹¿åˆ°å…¨å±€ Peppleï¼Œå¹¶ä½¿ç”¨è¿™ä¸¤è€…åŠç”¨æˆ·å¯†ç å†æ¬¡è®¡ç®— password hash å€¼ï¼Œå¦‚æœç»“æœä¸æ•°æ®åº“ä¸­çš„ password hash ç›¸åŒï¼Œåˆ™ç™»å½•æˆåŠŸï¼Œå¦åˆ™å¤±è´¥ã€‚ä¸è®ºæˆåŠŸä¸å¦ï¼Œè®¡ç®—ç»“æŸåç”¨æˆ·å¯†ç å°†è¢«ç«‹å³é”€æ¯ã€‚ ç”¨æˆ·ç™»å½•æˆåŠŸåï¼ŒæœåŠ¡ç«¯è¿”å›ä¸€ä¸ª JWT Token å®ç°ï¼Œå…¶ä¸­æ˜æ–‡ä¿å­˜äº†ç”¨æˆ·ä¿¡æ¯, æœ‰æ•ˆæœŸåŠä¸€ä¸ªç­¾åã€‚ åç»­ç”¨æˆ·æ¯æ¬¡è¯·æ±‚éƒ½ä¼šåœ¨ HTTP Header ä¸­å¸¦ä¸Šè¿™ä¸ª JWT Tokenï¼ŒæœåŠ¡ç«¯éªŒè¯ç­¾åæœ‰æ•ˆï¼Œè€Œä¸”å°šåœ¨æœ‰æ•ˆæœŸå†…ï¼Œåˆ™é€šè¿‡éªŒè¯ï¼Œå†è¿›è¡Œåç»­å¤„ç†ã€‚ 3. ç”Ÿæˆå”¯ä¸€ IDåŠ å¯†å“ˆå¸Œå‡½æ•°ä¹Ÿè¢«ç”¨äºä¸ºæ–‡æ¡£æˆ–æ¶ˆæ¯ç”Ÿæˆï¼ˆç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼‰å”¯ä¸€çš„ IDï¼Œå› æ­¤å“ˆå¸Œå€¼ä¹Ÿè¢«ç§°ä¸ºæ•°å­—æŒ‡çº¹ã€‚ æ³¨æ„è¿™é‡Œè¯´çš„æ˜¯æ•°å­—æŒ‡çº¹ï¼Œè€Œéæ•°å­—ç­¾åã€‚æ•°å­—ç­¾åæ˜¯ä¸ä¸‹ä¸€ç¯‡æ–‡ç« ä»‹ç»çš„ã€ŒMACã€ç æ¯”è¾ƒç±»ä¼¼çš„ï¼Œ ç”¨äºéªŒè¯æ¶ˆæ¯çš„çœŸå®ã€å®Œæ•´ã€è®¤è¯ä½œè€…èº«ä»½çš„ä¸€æ®µæ•°æ®ã€‚ åŠ å¯†å“ˆå¸Œå‡½æ•°è®¡ç®—å‡ºçš„å“ˆå¸Œå€¼ç†è®ºä¸Šç¡®å®æœ‰ç¢°æ’çš„æ¦‚ç‡ï¼Œä½†æ˜¯è¿™ä¸ªæ¦‚ç‡å®åœ¨å¤ªå°äº†ï¼Œå› æ­¤ç»å¤§å¤šæ•°ç³»ç»Ÿ ï¼ˆå¦‚ Gitï¼‰éƒ½å‡è®¾å“ˆå¸Œå‡½æ•°æ˜¯æ— ç¢°æ’çš„ï¼ˆcollision freeï¼‰ã€‚ æ–‡æ¡£çš„å“ˆå¸Œå€¼å¯ä»¥è¢«ç”¨äºè¯æ˜è¯¥æ–‡æ¡£çš„å­˜åœ¨æ€§ï¼Œæˆ–è€…è¢«å½“æˆä¸€ä¸ªç´¢å¼•ï¼Œç”¨äºä»å­˜å‚¨ç³»ç»Ÿä¸­æå–æ–‡æ¡£ã€‚ ä½¿ç”¨å“ˆå¸Œå€¼ä½œä¸ºå”¯ä¸€ ID çš„å…¸å‹ä¾‹å­ï¼ŒGit ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼ˆå¦‚3c3be25bc1757ca99aba55d4157596a8ea217698ï¼‰è‚¯å®šç®—ä¸€ä¸ªï¼Œæ¯”ç‰¹å¸åœ°å€ï¼ˆå¦‚1BvBMSEYstWetqTFn5Au4m4GFg7xJaNVN2ï¼‰ä¹Ÿç®—ã€‚ 4. ä¼ªéšæœºæ•°ç”Ÿæˆå“ˆå¸Œå€¼å¯ä»¥è¢«å½“ä½œä¸€ä¸ªéšæœºæ•°çœ‹å¾…ï¼Œç”Ÿæˆä¸€ä¸ªä¼ªéšæœºæ•°çš„ç®€å•æµç¨‹å¦‚ä¸‹ï¼š é€šè¿‡éšæœºäº‹ä»¶å¾—åˆ°ä¸€ä¸ªç†µï¼ˆä¾‹å¦‚é”®ç›˜ç‚¹å‡»æˆ–é¼ æ ‡ç§»åŠ¨ï¼‰ï¼Œå°†å®ƒä½œä¸ºæœ€åˆçš„éšæœºæ•°ç§å­ï¼ˆrandom seedï¼‰ã€‚ æ·»åŠ ä¸€ä¸ª 1 åˆ°ç†µä¸­ï¼Œè¿›è¡Œå“ˆå¸Œè®¡ç®—å¾—åˆ°ç¬¬ä¸€ä¸ªéšæœºæ•° å†æ·»åŠ ä¸€ä¸ª 2ï¼Œè¿›è¡Œå“ˆå¸Œè®¡ç®—å¾—åˆ°ç¬¬äºŒä¸ªéšæœºæ•° ä»¥æ­¤ç±»æ¨ å½“ç„¶ä¸ºäº†ç¡®ä¿å®‰å…¨æ€§ï¼Œå®é™…çš„åŠ å¯†éšæœºæ•°ç”Ÿæˆå™¨ä¼šæ¯”è¿™å†å¤æ‚ä¸€äº›ï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢çš„ã€Œéšæœºæ•°ç”Ÿæˆå™¨ã€ä¸€èŠ‚å­¦ä¹ å…¶ä¸­ç»†èŠ‚ã€‚ ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-2-hash/:2:2","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","å¯†ç å­¦","å“ˆå¸Œ","æ•£åˆ—","å®‰å…¨","SHA-2","SHA-3"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆäºŒï¼‰â€”â€” å“ˆå¸Œå‡½æ•°","uri":"/posts/practical-cryptography-basics-2-hash/#1-æ•°æ®å®Œæ•´æ€§æ ¡éªŒ"},{"categories":["tech"],"content":" åŠ å¯†å“ˆå¸Œå‡½æ•°çš„åº”ç”¨ 1. æ•°æ®å®Œæ•´æ€§æ ¡éªŒåŠ å¯†å“ˆå¸Œå‡½æ•°è¢«å¹¿æ³›ç”¨äºæ–‡ä»¶å®Œæ•´æ€§æ ¡éªŒã€‚å¦‚æœä½ ä»ç½‘ä¸Šä¸‹è½½çš„æ–‡ä»¶è®¡ç®—å‡ºçš„ SHA256 æ ¡éªŒå’Œ ï¼ˆchecksumï¼‰è·Ÿå®˜æ–¹å…¬å¸ƒçš„ä¸€è‡´ï¼Œé‚£å°±è¯´æ˜æ–‡ä»¶æ²¡æœ‰æŸåã€‚ ä½†æ˜¯å“ˆå¸Œå‡½æ•°è‡ªèº«ä¸èƒ½ä¿è¯æ–‡ä»¶çš„çœŸå®æ€§ï¼Œç›®å‰æ¥è®²ï¼ŒçœŸå®æ€§é€šå¸¸æ˜¯ TLS åè®®è¦ä¿è¯çš„ï¼Œå®ƒç¡®ä¿ä½ åœ¨ openssl ç½‘ç«™ä¸Šçœ‹åˆ°çš„ã€ŒSHA256 æ ¡éªŒå’Œã€çœŸå®æ— è¯¯ï¼ˆæœªè¢«ç¯¡æ”¹ï¼‰ã€‚ ç°ä»£ç½‘ç»œåŸºæœ¬éƒ½å¾ˆéš¾é‡åˆ°æ–‡ä»¶æŸåçš„æƒ…å†µäº†ï¼Œä½†æ˜¯åœ¨å¤æ—©çš„ä½é€Ÿç½‘ç»œä¸­ï¼Œå³ä½¿ TCP è·Ÿåº•å±‚åè®®å·²ç»æœ‰å¤šç§æ•°æ®çº é”™æ‰‹æ®µï¼Œä¸‹è½½å®Œæˆçš„æ–‡ä»¶ä»ç„¶æ˜¯æœ‰å¯èƒ½æŸåçš„ã€‚è¿™ä¹Ÿæ˜¯ä»¥å‰ rar å‹ç¼©æ ¼å¼å¾ˆæµè¡Œçš„åŸå› ä¹‹ä¸€â€”â€” rar å‹ç¼©æ–‡ä»¶æ‹¥æœ‰ä¸€å®šç¨‹åº¦ä¸Šçš„è‡ªæˆ‘ä¿®å¤èƒ½åŠ›ï¼Œä¼ è¾“è¿‡ç¨‹ä¸­æŸåå°‘é‡æ•°æ®ï¼Œä»ç„¶èƒ½æ­£å¸¸è§£å‹ã€‚ 2. ä¿å­˜å¯†ç åŠ å¯†å“ˆå¸Œå‡½æ•°è¿˜è¢«ç”¨äºå¯†ç çš„å®‰å…¨å­˜å‚¨ï¼Œç°ä»£ç³»ç»Ÿä½¿ç”¨ä¸“é—¨è®¾è®¡çš„å®‰å…¨å“ˆå¸Œç®—æ³•ï¼ˆç›®å‰ä¸»è¦æ˜¯scryptï¼‰ è®¡ç®—ç”¨æˆ·å¯†ç çš„å“ˆå¸Œæ‘˜è¦ï¼Œä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œè¿™æ ·èƒ½ç¡®ä¿å¯†ç çš„å®‰å…¨æ€§ã€‚é™¤äº†ç”¨æˆ·è‡ªå·±ï¼Œæ²¡æœ‰äººæ¸…æ¥šè¯¥å¯†ç çš„åŸå§‹æ•°æ®ï¼Œå³ä½¿æ•°æ®åº“ç®¡ç†å‘˜ä¹Ÿåªèƒ½çœ‹åˆ°ä¸€ä¸ªå“ˆå¸Œæ‘˜è¦ã€‚ ç®€è¦è¯´æ˜ä¸‹ä¸€ä¸ªç°ä»£åŒ–ç«™ç‚¹çš„æ³¨å†Œç™»å½•æµç¨‹ï¼š ç”¨æˆ·ä¸ç«™ç‚¹äº¤äº’çš„å…¨æµç¨‹éƒ½éœ€ä½¿ç”¨ HTTPS å®‰å…¨ä¼ è¾“å¯†ç åŠå…¶ä»–ç”¨æˆ·ä¿¡æ¯ã€‚ åœ¨ç”¨æˆ·æ³¨å†Œæ—¶ï¼Œå¯†ç è¢«æäº¤åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯ç”Ÿæˆéšæœº Salt + å›ºå®šçš„å…¨å±€ Pepperï¼Œç„¶åä½¿ç”¨è¿™ä¸¤è€…åŠç”¨æˆ·å¯†ç è®¡ç®—å‡º password hash å€¼ï¼Œå¹¶å°† hash å€¼ä¸ salt å­˜å…¥æ•°æ®åº“ã€‚æ¥ç€æœåŠ¡ç«¯ç«‹å³ä»å†…å­˜ä¸­é”€æ¯ç”¨æˆ·å¯†ç ã€‚ åœ¨ç”¨æˆ·ç™»å½•æ—¶ï¼Œç”¨æˆ·å¯†ç ä¹Ÿé¦–å…ˆè¢«æäº¤åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯ä»æ•°æ®åº“ä¸­æŸ¥åˆ°å¯¹åº”çš„ Saltï¼Œä»ç¯å¢ƒå˜é‡ä¸­æ‹¿åˆ°å…¨å±€ Peppleï¼Œå¹¶ä½¿ç”¨è¿™ä¸¤è€…åŠç”¨æˆ·å¯†ç å†æ¬¡è®¡ç®— password hash å€¼ï¼Œå¦‚æœç»“æœä¸æ•°æ®åº“ä¸­çš„ password hash ç›¸åŒï¼Œåˆ™ç™»å½•æˆåŠŸï¼Œå¦åˆ™å¤±è´¥ã€‚ä¸è®ºæˆåŠŸä¸å¦ï¼Œè®¡ç®—ç»“æŸåç”¨æˆ·å¯†ç å°†è¢«ç«‹å³é”€æ¯ã€‚ ç”¨æˆ·ç™»å½•æˆåŠŸåï¼ŒæœåŠ¡ç«¯è¿”å›ä¸€ä¸ª JWT Token å®ç°ï¼Œå…¶ä¸­æ˜æ–‡ä¿å­˜äº†ç”¨æˆ·ä¿¡æ¯, æœ‰æ•ˆæœŸåŠä¸€ä¸ªç­¾åã€‚ åç»­ç”¨æˆ·æ¯æ¬¡è¯·æ±‚éƒ½ä¼šåœ¨ HTTP Header ä¸­å¸¦ä¸Šè¿™ä¸ª JWT Tokenï¼ŒæœåŠ¡ç«¯éªŒè¯ç­¾åæœ‰æ•ˆï¼Œè€Œä¸”å°šåœ¨æœ‰æ•ˆæœŸå†…ï¼Œåˆ™é€šè¿‡éªŒè¯ï¼Œå†è¿›è¡Œåç»­å¤„ç†ã€‚ 3. ç”Ÿæˆå”¯ä¸€ IDåŠ å¯†å“ˆå¸Œå‡½æ•°ä¹Ÿè¢«ç”¨äºä¸ºæ–‡æ¡£æˆ–æ¶ˆæ¯ç”Ÿæˆï¼ˆç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼‰å”¯ä¸€çš„ IDï¼Œå› æ­¤å“ˆå¸Œå€¼ä¹Ÿè¢«ç§°ä¸ºæ•°å­—æŒ‡çº¹ã€‚ æ³¨æ„è¿™é‡Œè¯´çš„æ˜¯æ•°å­—æŒ‡çº¹ï¼Œè€Œéæ•°å­—ç­¾åã€‚æ•°å­—ç­¾åæ˜¯ä¸ä¸‹ä¸€ç¯‡æ–‡ç« ä»‹ç»çš„ã€ŒMACã€ç æ¯”è¾ƒç±»ä¼¼çš„ï¼Œ ç”¨äºéªŒè¯æ¶ˆæ¯çš„çœŸå®ã€å®Œæ•´ã€è®¤è¯ä½œè€…èº«ä»½çš„ä¸€æ®µæ•°æ®ã€‚ åŠ å¯†å“ˆå¸Œå‡½æ•°è®¡ç®—å‡ºçš„å“ˆå¸Œå€¼ç†è®ºä¸Šç¡®å®æœ‰ç¢°æ’çš„æ¦‚ç‡ï¼Œä½†æ˜¯è¿™ä¸ªæ¦‚ç‡å®åœ¨å¤ªå°äº†ï¼Œå› æ­¤ç»å¤§å¤šæ•°ç³»ç»Ÿ ï¼ˆå¦‚ Gitï¼‰éƒ½å‡è®¾å“ˆå¸Œå‡½æ•°æ˜¯æ— ç¢°æ’çš„ï¼ˆcollision freeï¼‰ã€‚ æ–‡æ¡£çš„å“ˆå¸Œå€¼å¯ä»¥è¢«ç”¨äºè¯æ˜è¯¥æ–‡æ¡£çš„å­˜åœ¨æ€§ï¼Œæˆ–è€…è¢«å½“æˆä¸€ä¸ªç´¢å¼•ï¼Œç”¨äºä»å­˜å‚¨ç³»ç»Ÿä¸­æå–æ–‡æ¡£ã€‚ ä½¿ç”¨å“ˆå¸Œå€¼ä½œä¸ºå”¯ä¸€ ID çš„å…¸å‹ä¾‹å­ï¼ŒGit ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼ˆå¦‚3c3be25bc1757ca99aba55d4157596a8ea217698ï¼‰è‚¯å®šç®—ä¸€ä¸ªï¼Œæ¯”ç‰¹å¸åœ°å€ï¼ˆå¦‚1BvBMSEYstWetqTFn5Au4m4GFg7xJaNVN2ï¼‰ä¹Ÿç®—ã€‚ 4. ä¼ªéšæœºæ•°ç”Ÿæˆå“ˆå¸Œå€¼å¯ä»¥è¢«å½“ä½œä¸€ä¸ªéšæœºæ•°çœ‹å¾…ï¼Œç”Ÿæˆä¸€ä¸ªä¼ªéšæœºæ•°çš„ç®€å•æµç¨‹å¦‚ä¸‹ï¼š é€šè¿‡éšæœºäº‹ä»¶å¾—åˆ°ä¸€ä¸ªç†µï¼ˆä¾‹å¦‚é”®ç›˜ç‚¹å‡»æˆ–é¼ æ ‡ç§»åŠ¨ï¼‰ï¼Œå°†å®ƒä½œä¸ºæœ€åˆçš„éšæœºæ•°ç§å­ï¼ˆrandom seedï¼‰ã€‚ æ·»åŠ ä¸€ä¸ª 1 åˆ°ç†µä¸­ï¼Œè¿›è¡Œå“ˆå¸Œè®¡ç®—å¾—åˆ°ç¬¬ä¸€ä¸ªéšæœºæ•° å†æ·»åŠ ä¸€ä¸ª 2ï¼Œè¿›è¡Œå“ˆå¸Œè®¡ç®—å¾—åˆ°ç¬¬äºŒä¸ªéšæœºæ•° ä»¥æ­¤ç±»æ¨ å½“ç„¶ä¸ºäº†ç¡®ä¿å®‰å…¨æ€§ï¼Œå®é™…çš„åŠ å¯†éšæœºæ•°ç”Ÿæˆå™¨ä¼šæ¯”è¿™å†å¤æ‚ä¸€äº›ï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢çš„ã€Œéšæœºæ•°ç”Ÿæˆå™¨ã€ä¸€èŠ‚å­¦ä¹ å…¶ä¸­ç»†èŠ‚ã€‚ ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-2-hash/:2:2","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","å¯†ç å­¦","å“ˆå¸Œ","æ•£åˆ—","å®‰å…¨","SHA-2","SHA-3"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆäºŒï¼‰â€”â€” å“ˆå¸Œå‡½æ•°","uri":"/posts/practical-cryptography-basics-2-hash/#2-ä¿å­˜å¯†ç "},{"categories":["tech"],"content":" åŠ å¯†å“ˆå¸Œå‡½æ•°çš„åº”ç”¨ 1. æ•°æ®å®Œæ•´æ€§æ ¡éªŒåŠ å¯†å“ˆå¸Œå‡½æ•°è¢«å¹¿æ³›ç”¨äºæ–‡ä»¶å®Œæ•´æ€§æ ¡éªŒã€‚å¦‚æœä½ ä»ç½‘ä¸Šä¸‹è½½çš„æ–‡ä»¶è®¡ç®—å‡ºçš„ SHA256 æ ¡éªŒå’Œ ï¼ˆchecksumï¼‰è·Ÿå®˜æ–¹å…¬å¸ƒçš„ä¸€è‡´ï¼Œé‚£å°±è¯´æ˜æ–‡ä»¶æ²¡æœ‰æŸåã€‚ ä½†æ˜¯å“ˆå¸Œå‡½æ•°è‡ªèº«ä¸èƒ½ä¿è¯æ–‡ä»¶çš„çœŸå®æ€§ï¼Œç›®å‰æ¥è®²ï¼ŒçœŸå®æ€§é€šå¸¸æ˜¯ TLS åè®®è¦ä¿è¯çš„ï¼Œå®ƒç¡®ä¿ä½ åœ¨ openssl ç½‘ç«™ä¸Šçœ‹åˆ°çš„ã€ŒSHA256 æ ¡éªŒå’Œã€çœŸå®æ— è¯¯ï¼ˆæœªè¢«ç¯¡æ”¹ï¼‰ã€‚ ç°ä»£ç½‘ç»œåŸºæœ¬éƒ½å¾ˆéš¾é‡åˆ°æ–‡ä»¶æŸåçš„æƒ…å†µäº†ï¼Œä½†æ˜¯åœ¨å¤æ—©çš„ä½é€Ÿç½‘ç»œä¸­ï¼Œå³ä½¿ TCP è·Ÿåº•å±‚åè®®å·²ç»æœ‰å¤šç§æ•°æ®çº é”™æ‰‹æ®µï¼Œä¸‹è½½å®Œæˆçš„æ–‡ä»¶ä»ç„¶æ˜¯æœ‰å¯èƒ½æŸåçš„ã€‚è¿™ä¹Ÿæ˜¯ä»¥å‰ rar å‹ç¼©æ ¼å¼å¾ˆæµè¡Œçš„åŸå› ä¹‹ä¸€â€”â€” rar å‹ç¼©æ–‡ä»¶æ‹¥æœ‰ä¸€å®šç¨‹åº¦ä¸Šçš„è‡ªæˆ‘ä¿®å¤èƒ½åŠ›ï¼Œä¼ è¾“è¿‡ç¨‹ä¸­æŸåå°‘é‡æ•°æ®ï¼Œä»ç„¶èƒ½æ­£å¸¸è§£å‹ã€‚ 2. ä¿å­˜å¯†ç åŠ å¯†å“ˆå¸Œå‡½æ•°è¿˜è¢«ç”¨äºå¯†ç çš„å®‰å…¨å­˜å‚¨ï¼Œç°ä»£ç³»ç»Ÿä½¿ç”¨ä¸“é—¨è®¾è®¡çš„å®‰å…¨å“ˆå¸Œç®—æ³•ï¼ˆç›®å‰ä¸»è¦æ˜¯scryptï¼‰ è®¡ç®—ç”¨æˆ·å¯†ç çš„å“ˆå¸Œæ‘˜è¦ï¼Œä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œè¿™æ ·èƒ½ç¡®ä¿å¯†ç çš„å®‰å…¨æ€§ã€‚é™¤äº†ç”¨æˆ·è‡ªå·±ï¼Œæ²¡æœ‰äººæ¸…æ¥šè¯¥å¯†ç çš„åŸå§‹æ•°æ®ï¼Œå³ä½¿æ•°æ®åº“ç®¡ç†å‘˜ä¹Ÿåªèƒ½çœ‹åˆ°ä¸€ä¸ªå“ˆå¸Œæ‘˜è¦ã€‚ ç®€è¦è¯´æ˜ä¸‹ä¸€ä¸ªç°ä»£åŒ–ç«™ç‚¹çš„æ³¨å†Œç™»å½•æµç¨‹ï¼š ç”¨æˆ·ä¸ç«™ç‚¹äº¤äº’çš„å…¨æµç¨‹éƒ½éœ€ä½¿ç”¨ HTTPS å®‰å…¨ä¼ è¾“å¯†ç åŠå…¶ä»–ç”¨æˆ·ä¿¡æ¯ã€‚ åœ¨ç”¨æˆ·æ³¨å†Œæ—¶ï¼Œå¯†ç è¢«æäº¤åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯ç”Ÿæˆéšæœº Salt + å›ºå®šçš„å…¨å±€ Pepperï¼Œç„¶åä½¿ç”¨è¿™ä¸¤è€…åŠç”¨æˆ·å¯†ç è®¡ç®—å‡º password hash å€¼ï¼Œå¹¶å°† hash å€¼ä¸ salt å­˜å…¥æ•°æ®åº“ã€‚æ¥ç€æœåŠ¡ç«¯ç«‹å³ä»å†…å­˜ä¸­é”€æ¯ç”¨æˆ·å¯†ç ã€‚ åœ¨ç”¨æˆ·ç™»å½•æ—¶ï¼Œç”¨æˆ·å¯†ç ä¹Ÿé¦–å…ˆè¢«æäº¤åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯ä»æ•°æ®åº“ä¸­æŸ¥åˆ°å¯¹åº”çš„ Saltï¼Œä»ç¯å¢ƒå˜é‡ä¸­æ‹¿åˆ°å…¨å±€ Peppleï¼Œå¹¶ä½¿ç”¨è¿™ä¸¤è€…åŠç”¨æˆ·å¯†ç å†æ¬¡è®¡ç®— password hash å€¼ï¼Œå¦‚æœç»“æœä¸æ•°æ®åº“ä¸­çš„ password hash ç›¸åŒï¼Œåˆ™ç™»å½•æˆåŠŸï¼Œå¦åˆ™å¤±è´¥ã€‚ä¸è®ºæˆåŠŸä¸å¦ï¼Œè®¡ç®—ç»“æŸåç”¨æˆ·å¯†ç å°†è¢«ç«‹å³é”€æ¯ã€‚ ç”¨æˆ·ç™»å½•æˆåŠŸåï¼ŒæœåŠ¡ç«¯è¿”å›ä¸€ä¸ª JWT Token å®ç°ï¼Œå…¶ä¸­æ˜æ–‡ä¿å­˜äº†ç”¨æˆ·ä¿¡æ¯, æœ‰æ•ˆæœŸåŠä¸€ä¸ªç­¾åã€‚ åç»­ç”¨æˆ·æ¯æ¬¡è¯·æ±‚éƒ½ä¼šåœ¨ HTTP Header ä¸­å¸¦ä¸Šè¿™ä¸ª JWT Tokenï¼ŒæœåŠ¡ç«¯éªŒè¯ç­¾åæœ‰æ•ˆï¼Œè€Œä¸”å°šåœ¨æœ‰æ•ˆæœŸå†…ï¼Œåˆ™é€šè¿‡éªŒè¯ï¼Œå†è¿›è¡Œåç»­å¤„ç†ã€‚ 3. ç”Ÿæˆå”¯ä¸€ IDåŠ å¯†å“ˆå¸Œå‡½æ•°ä¹Ÿè¢«ç”¨äºä¸ºæ–‡æ¡£æˆ–æ¶ˆæ¯ç”Ÿæˆï¼ˆç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼‰å”¯ä¸€çš„ IDï¼Œå› æ­¤å“ˆå¸Œå€¼ä¹Ÿè¢«ç§°ä¸ºæ•°å­—æŒ‡çº¹ã€‚ æ³¨æ„è¿™é‡Œè¯´çš„æ˜¯æ•°å­—æŒ‡çº¹ï¼Œè€Œéæ•°å­—ç­¾åã€‚æ•°å­—ç­¾åæ˜¯ä¸ä¸‹ä¸€ç¯‡æ–‡ç« ä»‹ç»çš„ã€ŒMACã€ç æ¯”è¾ƒç±»ä¼¼çš„ï¼Œ ç”¨äºéªŒè¯æ¶ˆæ¯çš„çœŸå®ã€å®Œæ•´ã€è®¤è¯ä½œè€…èº«ä»½çš„ä¸€æ®µæ•°æ®ã€‚ åŠ å¯†å“ˆå¸Œå‡½æ•°è®¡ç®—å‡ºçš„å“ˆå¸Œå€¼ç†è®ºä¸Šç¡®å®æœ‰ç¢°æ’çš„æ¦‚ç‡ï¼Œä½†æ˜¯è¿™ä¸ªæ¦‚ç‡å®åœ¨å¤ªå°äº†ï¼Œå› æ­¤ç»å¤§å¤šæ•°ç³»ç»Ÿ ï¼ˆå¦‚ Gitï¼‰éƒ½å‡è®¾å“ˆå¸Œå‡½æ•°æ˜¯æ— ç¢°æ’çš„ï¼ˆcollision freeï¼‰ã€‚ æ–‡æ¡£çš„å“ˆå¸Œå€¼å¯ä»¥è¢«ç”¨äºè¯æ˜è¯¥æ–‡æ¡£çš„å­˜åœ¨æ€§ï¼Œæˆ–è€…è¢«å½“æˆä¸€ä¸ªç´¢å¼•ï¼Œç”¨äºä»å­˜å‚¨ç³»ç»Ÿä¸­æå–æ–‡æ¡£ã€‚ ä½¿ç”¨å“ˆå¸Œå€¼ä½œä¸ºå”¯ä¸€ ID çš„å…¸å‹ä¾‹å­ï¼ŒGit ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼ˆå¦‚3c3be25bc1757ca99aba55d4157596a8ea217698ï¼‰è‚¯å®šç®—ä¸€ä¸ªï¼Œæ¯”ç‰¹å¸åœ°å€ï¼ˆå¦‚1BvBMSEYstWetqTFn5Au4m4GFg7xJaNVN2ï¼‰ä¹Ÿç®—ã€‚ 4. ä¼ªéšæœºæ•°ç”Ÿæˆå“ˆå¸Œå€¼å¯ä»¥è¢«å½“ä½œä¸€ä¸ªéšæœºæ•°çœ‹å¾…ï¼Œç”Ÿæˆä¸€ä¸ªä¼ªéšæœºæ•°çš„ç®€å•æµç¨‹å¦‚ä¸‹ï¼š é€šè¿‡éšæœºäº‹ä»¶å¾—åˆ°ä¸€ä¸ªç†µï¼ˆä¾‹å¦‚é”®ç›˜ç‚¹å‡»æˆ–é¼ æ ‡ç§»åŠ¨ï¼‰ï¼Œå°†å®ƒä½œä¸ºæœ€åˆçš„éšæœºæ•°ç§å­ï¼ˆrandom seedï¼‰ã€‚ æ·»åŠ ä¸€ä¸ª 1 åˆ°ç†µä¸­ï¼Œè¿›è¡Œå“ˆå¸Œè®¡ç®—å¾—åˆ°ç¬¬ä¸€ä¸ªéšæœºæ•° å†æ·»åŠ ä¸€ä¸ª 2ï¼Œè¿›è¡Œå“ˆå¸Œè®¡ç®—å¾—åˆ°ç¬¬äºŒä¸ªéšæœºæ•° ä»¥æ­¤ç±»æ¨ å½“ç„¶ä¸ºäº†ç¡®ä¿å®‰å…¨æ€§ï¼Œå®é™…çš„åŠ å¯†éšæœºæ•°ç”Ÿæˆå™¨ä¼šæ¯”è¿™å†å¤æ‚ä¸€äº›ï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢çš„ã€Œéšæœºæ•°ç”Ÿæˆå™¨ã€ä¸€èŠ‚å­¦ä¹ å…¶ä¸­ç»†èŠ‚ã€‚ ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-2-hash/:2:2","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","å¯†ç å­¦","å“ˆå¸Œ","æ•£åˆ—","å®‰å…¨","SHA-2","SHA-3"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆäºŒï¼‰â€”â€” å“ˆå¸Œå‡½æ•°","uri":"/posts/practical-cryptography-basics-2-hash/#3-ç”Ÿæˆå”¯ä¸€-id"},{"categories":["tech"],"content":" åŠ å¯†å“ˆå¸Œå‡½æ•°çš„åº”ç”¨ 1. æ•°æ®å®Œæ•´æ€§æ ¡éªŒåŠ å¯†å“ˆå¸Œå‡½æ•°è¢«å¹¿æ³›ç”¨äºæ–‡ä»¶å®Œæ•´æ€§æ ¡éªŒã€‚å¦‚æœä½ ä»ç½‘ä¸Šä¸‹è½½çš„æ–‡ä»¶è®¡ç®—å‡ºçš„ SHA256 æ ¡éªŒå’Œ ï¼ˆchecksumï¼‰è·Ÿå®˜æ–¹å…¬å¸ƒçš„ä¸€è‡´ï¼Œé‚£å°±è¯´æ˜æ–‡ä»¶æ²¡æœ‰æŸåã€‚ ä½†æ˜¯å“ˆå¸Œå‡½æ•°è‡ªèº«ä¸èƒ½ä¿è¯æ–‡ä»¶çš„çœŸå®æ€§ï¼Œç›®å‰æ¥è®²ï¼ŒçœŸå®æ€§é€šå¸¸æ˜¯ TLS åè®®è¦ä¿è¯çš„ï¼Œå®ƒç¡®ä¿ä½ åœ¨ openssl ç½‘ç«™ä¸Šçœ‹åˆ°çš„ã€ŒSHA256 æ ¡éªŒå’Œã€çœŸå®æ— è¯¯ï¼ˆæœªè¢«ç¯¡æ”¹ï¼‰ã€‚ ç°ä»£ç½‘ç»œåŸºæœ¬éƒ½å¾ˆéš¾é‡åˆ°æ–‡ä»¶æŸåçš„æƒ…å†µäº†ï¼Œä½†æ˜¯åœ¨å¤æ—©çš„ä½é€Ÿç½‘ç»œä¸­ï¼Œå³ä½¿ TCP è·Ÿåº•å±‚åè®®å·²ç»æœ‰å¤šç§æ•°æ®çº é”™æ‰‹æ®µï¼Œä¸‹è½½å®Œæˆçš„æ–‡ä»¶ä»ç„¶æ˜¯æœ‰å¯èƒ½æŸåçš„ã€‚è¿™ä¹Ÿæ˜¯ä»¥å‰ rar å‹ç¼©æ ¼å¼å¾ˆæµè¡Œçš„åŸå› ä¹‹ä¸€â€”â€” rar å‹ç¼©æ–‡ä»¶æ‹¥æœ‰ä¸€å®šç¨‹åº¦ä¸Šçš„è‡ªæˆ‘ä¿®å¤èƒ½åŠ›ï¼Œä¼ è¾“è¿‡ç¨‹ä¸­æŸåå°‘é‡æ•°æ®ï¼Œä»ç„¶èƒ½æ­£å¸¸è§£å‹ã€‚ 2. ä¿å­˜å¯†ç åŠ å¯†å“ˆå¸Œå‡½æ•°è¿˜è¢«ç”¨äºå¯†ç çš„å®‰å…¨å­˜å‚¨ï¼Œç°ä»£ç³»ç»Ÿä½¿ç”¨ä¸“é—¨è®¾è®¡çš„å®‰å…¨å“ˆå¸Œç®—æ³•ï¼ˆç›®å‰ä¸»è¦æ˜¯scryptï¼‰ è®¡ç®—ç”¨æˆ·å¯†ç çš„å“ˆå¸Œæ‘˜è¦ï¼Œä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œè¿™æ ·èƒ½ç¡®ä¿å¯†ç çš„å®‰å…¨æ€§ã€‚é™¤äº†ç”¨æˆ·è‡ªå·±ï¼Œæ²¡æœ‰äººæ¸…æ¥šè¯¥å¯†ç çš„åŸå§‹æ•°æ®ï¼Œå³ä½¿æ•°æ®åº“ç®¡ç†å‘˜ä¹Ÿåªèƒ½çœ‹åˆ°ä¸€ä¸ªå“ˆå¸Œæ‘˜è¦ã€‚ ç®€è¦è¯´æ˜ä¸‹ä¸€ä¸ªç°ä»£åŒ–ç«™ç‚¹çš„æ³¨å†Œç™»å½•æµç¨‹ï¼š ç”¨æˆ·ä¸ç«™ç‚¹äº¤äº’çš„å…¨æµç¨‹éƒ½éœ€ä½¿ç”¨ HTTPS å®‰å…¨ä¼ è¾“å¯†ç åŠå…¶ä»–ç”¨æˆ·ä¿¡æ¯ã€‚ åœ¨ç”¨æˆ·æ³¨å†Œæ—¶ï¼Œå¯†ç è¢«æäº¤åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯ç”Ÿæˆéšæœº Salt + å›ºå®šçš„å…¨å±€ Pepperï¼Œç„¶åä½¿ç”¨è¿™ä¸¤è€…åŠç”¨æˆ·å¯†ç è®¡ç®—å‡º password hash å€¼ï¼Œå¹¶å°† hash å€¼ä¸ salt å­˜å…¥æ•°æ®åº“ã€‚æ¥ç€æœåŠ¡ç«¯ç«‹å³ä»å†…å­˜ä¸­é”€æ¯ç”¨æˆ·å¯†ç ã€‚ åœ¨ç”¨æˆ·ç™»å½•æ—¶ï¼Œç”¨æˆ·å¯†ç ä¹Ÿé¦–å…ˆè¢«æäº¤åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯ä»æ•°æ®åº“ä¸­æŸ¥åˆ°å¯¹åº”çš„ Saltï¼Œä»ç¯å¢ƒå˜é‡ä¸­æ‹¿åˆ°å…¨å±€ Peppleï¼Œå¹¶ä½¿ç”¨è¿™ä¸¤è€…åŠç”¨æˆ·å¯†ç å†æ¬¡è®¡ç®— password hash å€¼ï¼Œå¦‚æœç»“æœä¸æ•°æ®åº“ä¸­çš„ password hash ç›¸åŒï¼Œåˆ™ç™»å½•æˆåŠŸï¼Œå¦åˆ™å¤±è´¥ã€‚ä¸è®ºæˆåŠŸä¸å¦ï¼Œè®¡ç®—ç»“æŸåç”¨æˆ·å¯†ç å°†è¢«ç«‹å³é”€æ¯ã€‚ ç”¨æˆ·ç™»å½•æˆåŠŸåï¼ŒæœåŠ¡ç«¯è¿”å›ä¸€ä¸ª JWT Token å®ç°ï¼Œå…¶ä¸­æ˜æ–‡ä¿å­˜äº†ç”¨æˆ·ä¿¡æ¯, æœ‰æ•ˆæœŸåŠä¸€ä¸ªç­¾åã€‚ åç»­ç”¨æˆ·æ¯æ¬¡è¯·æ±‚éƒ½ä¼šåœ¨ HTTP Header ä¸­å¸¦ä¸Šè¿™ä¸ª JWT Tokenï¼ŒæœåŠ¡ç«¯éªŒè¯ç­¾åæœ‰æ•ˆï¼Œè€Œä¸”å°šåœ¨æœ‰æ•ˆæœŸå†…ï¼Œåˆ™é€šè¿‡éªŒè¯ï¼Œå†è¿›è¡Œåç»­å¤„ç†ã€‚ 3. ç”Ÿæˆå”¯ä¸€ IDåŠ å¯†å“ˆå¸Œå‡½æ•°ä¹Ÿè¢«ç”¨äºä¸ºæ–‡æ¡£æˆ–æ¶ˆæ¯ç”Ÿæˆï¼ˆç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼‰å”¯ä¸€çš„ IDï¼Œå› æ­¤å“ˆå¸Œå€¼ä¹Ÿè¢«ç§°ä¸ºæ•°å­—æŒ‡çº¹ã€‚ æ³¨æ„è¿™é‡Œè¯´çš„æ˜¯æ•°å­—æŒ‡çº¹ï¼Œè€Œéæ•°å­—ç­¾åã€‚æ•°å­—ç­¾åæ˜¯ä¸ä¸‹ä¸€ç¯‡æ–‡ç« ä»‹ç»çš„ã€ŒMACã€ç æ¯”è¾ƒç±»ä¼¼çš„ï¼Œ ç”¨äºéªŒè¯æ¶ˆæ¯çš„çœŸå®ã€å®Œæ•´ã€è®¤è¯ä½œè€…èº«ä»½çš„ä¸€æ®µæ•°æ®ã€‚ åŠ å¯†å“ˆå¸Œå‡½æ•°è®¡ç®—å‡ºçš„å“ˆå¸Œå€¼ç†è®ºä¸Šç¡®å®æœ‰ç¢°æ’çš„æ¦‚ç‡ï¼Œä½†æ˜¯è¿™ä¸ªæ¦‚ç‡å®åœ¨å¤ªå°äº†ï¼Œå› æ­¤ç»å¤§å¤šæ•°ç³»ç»Ÿ ï¼ˆå¦‚ Gitï¼‰éƒ½å‡è®¾å“ˆå¸Œå‡½æ•°æ˜¯æ— ç¢°æ’çš„ï¼ˆcollision freeï¼‰ã€‚ æ–‡æ¡£çš„å“ˆå¸Œå€¼å¯ä»¥è¢«ç”¨äºè¯æ˜è¯¥æ–‡æ¡£çš„å­˜åœ¨æ€§ï¼Œæˆ–è€…è¢«å½“æˆä¸€ä¸ªç´¢å¼•ï¼Œç”¨äºä»å­˜å‚¨ç³»ç»Ÿä¸­æå–æ–‡æ¡£ã€‚ ä½¿ç”¨å“ˆå¸Œå€¼ä½œä¸ºå”¯ä¸€ ID çš„å…¸å‹ä¾‹å­ï¼ŒGit ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼ˆå¦‚3c3be25bc1757ca99aba55d4157596a8ea217698ï¼‰è‚¯å®šç®—ä¸€ä¸ªï¼Œæ¯”ç‰¹å¸åœ°å€ï¼ˆå¦‚1BvBMSEYstWetqTFn5Au4m4GFg7xJaNVN2ï¼‰ä¹Ÿç®—ã€‚ 4. ä¼ªéšæœºæ•°ç”Ÿæˆå“ˆå¸Œå€¼å¯ä»¥è¢«å½“ä½œä¸€ä¸ªéšæœºæ•°çœ‹å¾…ï¼Œç”Ÿæˆä¸€ä¸ªä¼ªéšæœºæ•°çš„ç®€å•æµç¨‹å¦‚ä¸‹ï¼š é€šè¿‡éšæœºäº‹ä»¶å¾—åˆ°ä¸€ä¸ªç†µï¼ˆä¾‹å¦‚é”®ç›˜ç‚¹å‡»æˆ–é¼ æ ‡ç§»åŠ¨ï¼‰ï¼Œå°†å®ƒä½œä¸ºæœ€åˆçš„éšæœºæ•°ç§å­ï¼ˆrandom seedï¼‰ã€‚ æ·»åŠ ä¸€ä¸ª 1 åˆ°ç†µä¸­ï¼Œè¿›è¡Œå“ˆå¸Œè®¡ç®—å¾—åˆ°ç¬¬ä¸€ä¸ªéšæœºæ•° å†æ·»åŠ ä¸€ä¸ª 2ï¼Œè¿›è¡Œå“ˆå¸Œè®¡ç®—å¾—åˆ°ç¬¬äºŒä¸ªéšæœºæ•° ä»¥æ­¤ç±»æ¨ å½“ç„¶ä¸ºäº†ç¡®ä¿å®‰å…¨æ€§ï¼Œå®é™…çš„åŠ å¯†éšæœºæ•°ç”Ÿæˆå™¨ä¼šæ¯”è¿™å†å¤æ‚ä¸€äº›ï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢çš„ã€Œéšæœºæ•°ç”Ÿæˆå™¨ã€ä¸€èŠ‚å­¦ä¹ å…¶ä¸­ç»†èŠ‚ã€‚ ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-2-hash/:2:2","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","å¯†ç å­¦","å“ˆå¸Œ","æ•£åˆ—","å®‰å…¨","SHA-2","SHA-3"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆäºŒï¼‰â€”â€” å“ˆå¸Œå‡½æ•°","uri":"/posts/practical-cryptography-basics-2-hash/#4-ä¼ªéšæœºæ•°ç”Ÿæˆ"},{"categories":["tech"],"content":" å®‰å…¨çš„åŠ å¯†å“ˆå¸Œç®—æ³• 1. SHA-2, SHA-256, SHA-512SHA-2ï¼Œå³ Secure Hash Algorithm 2ï¼Œæ˜¯ä¸€ç»„å¼ºå¯†ç å“ˆå¸Œå‡½æ•°ï¼Œå…¶ç‰ˆæœ¬åŒ…æ‹¬ï¼šSHA-256ï¼ˆ256ä½å“ˆå¸Œï¼‰ã€SHA-384ï¼ˆ384ä½å“ˆå¸Œï¼‰ã€SHA-512ï¼ˆ512ä½å“ˆå¸Œï¼‰ç­‰ã€‚åŸºäºå¯†ç æ¦‚å¿µã€ŒMerkleâ€“DamgÃ¥rd æ„é€ ã€ï¼Œç›®å‰è¢«è®¤ä¸ºé«˜åº¦å®‰å…¨ã€‚ SHA-2 æ˜¯ SHA-1 çš„ç»§ä»»è€…ï¼Œäº 2001 å¹´åœ¨ç¾å›½ä½œä¸ºå®˜æ–¹åŠ å¯†æ ‡å‡†å‘å¸ƒã€‚ SHA-2 åœ¨è½¯ä»¶å¼€å‘å’Œå¯†ç å­¦ä¸­è¢«å¹¿æ³›ä½¿ç”¨ï¼Œå¯ç”¨äºç°ä»£å•†ä¸šåº”ç”¨ã€‚å…¶ä¸­ SHA-256 è¢«å¹¿æ³›ç”¨äº HTTPS åè®®ã€æ–‡ä»¶å®Œæ•´æ€§æ ¡éªŒã€æ¯”ç‰¹å¸åŒºå—é“¾ç­‰å„ç§åœºæ™¯ã€‚ Python ä»£ç ç¤ºä¾‹ï¼š python import hashlib, binascii text = 'hello' data = text.encode(\"utf8\") sha256hash = hashlib.sha256(data).digest() print(f\"SHA-256({text}) = \", binascii.hexlify(sha256hash).decode(\"utf8\")) sha384hash = hashlib.sha384(data).digest() print(f\"SHA-384({text}) = \", binascii.hexlify(sha384hash).decode(\"utf8\")) sha512hash = hashlib.sha512(data).digest() print(f\"SHA-512({text}) = \", binascii.hexlify(sha512hash).decode(\"utf8\")) è¾“å‡ºå¦‚ä¸‹ï¼š text SHA-256('hello') = 2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824 SHA-384('hello') = 59e1748777448c69de6b800d7a33bbfb9ff1b463e44354c3553bcdb9c666fa90125a3c79f90397bdf5f6a13de828684f SHA-512('hello') = 9b71d224bd62f3785d96d46ad3ea3d73319bfbc2890caadae2dff72519673ca72323c3d99ba5c11d7c7acc6e14b8c5da0c4663475c2e5c3adef46f73bcdec043 2. æ›´é•¿çš„å“ˆå¸Œå€¼ == æ›´é«˜çš„æŠ—ç¢°æ’èƒ½åŠ›æŒ‰ç…§è®¾è®¡ï¼Œå“ˆå¸Œå‡½æ•°çš„è¾“å‡ºè¶Šé•¿ï¼Œå°±æœ‰æœ›å®ç°æ›´é«˜çš„å®‰å…¨æ€§å’ŒæŠ—ç¢°æ’èƒ½åŠ›ï¼ˆä½†ä¹Ÿæœ‰ä¸€äº›ä¾‹å¤–ï¼‰ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œ128 ä½å“ˆå¸Œç®—æ³•æ¯” 256 ä½å“ˆå¸Œç®—æ³•å¼±ï¼Œ256 ä½å“ˆå¸Œç®—æ³•æ¯” 512 ä½å“ˆå¸Œç®—æ³•å¼±ã€‚ å› æ­¤æ˜¾ç„¶ SHA-512 æ¯” SHA-256 æ›´å¼ºã€‚æˆ‘ä»¬å¯ä»¥é¢„æœŸï¼ŒSHA-512 çš„ç¢°æ’æ¦‚ç‡è¦æ¯” SHA-256 æ›´ä½ã€‚ 3. SHA-3, SHA3-256, SHA3-512, Keccak-256åœ¨è¾“å‡ºçš„å“ˆå¸Œé•¿åº¦ç›¸åŒæ—¶ï¼ŒSHA-3ï¼ˆåŠå…¶å˜ä½“ SHA3-224ã€SHA3-256ã€SHA3-384ã€SHA3-512ï¼‰è¢«è®¤ä¸ºæ‹¥æœ‰æ¯” SHA-2ï¼ˆSHA-224ã€SHA-256ã€SHA-384ã€SHA-512ï¼‰æ›´é«˜çš„åŠ å¯†å¼ºåº¦ã€‚ä¾‹å¦‚ï¼Œå¯¹äºç›¸åŒçš„å“ˆå¸Œé•¿åº¦ï¼ˆ256 ä½ï¼‰ï¼ŒSHA3-256 æä¾›æ¯” SHA-256 æ›´é«˜çš„åŠ å¯†å¼ºåº¦ã€‚ SHA-3 ç³»åˆ—å‡½æ•°æ˜¯ Keccak å“ˆå¸Œå®¶æ—çš„ä»£è¡¨ï¼Œå®ƒåŸºäºå¯†ç å­¦æ¦‚å¿µæµ·ç»µå‡½æ•°ã€‚è€ŒKeccak æ˜¯SHA3 NIST æ¯”èµ›çš„å† å†›ã€‚ ä¸ SHA-2 ä¸åŒï¼ŒSHA-3 ç³»åˆ—åŠ å¯†å“ˆå¸Œå‡½æ•°ä¸æ˜“å—åˆ°é•¿åº¦æ‹“å±•æ”»å‡» Length extension attack. SHA-3 è¢«è®¤ä¸ºæ˜¯é«˜åº¦å®‰å…¨çš„ï¼Œå¹¶äº 2015 å¹´ä½œä¸ºç¾å›½å®˜æ–¹æ¨èçš„åŠ å¯†æ ‡å‡†å‘å¸ƒã€‚ ä»¥å¤ªåŠï¼ˆEthereumï¼‰åŒºå—é“¾ä¸­ä½¿ç”¨çš„å“ˆå¸Œå‡½æ•° Keccak-256 æ˜¯ SHA3-256 çš„å˜ä½“ï¼Œåœ¨ä»£ç ä¸­æ›´æ”¹äº†ä¸€äº›å¸¸é‡ã€‚ å“ˆå¸Œå‡½æ•° SHAKE128(msg, length) å’Œ SHAKE256(msg, length) æ˜¯ SHA3-256 å’Œ SHA3-512 ç®—æ³•çš„å˜ä½“ï¼Œå®ƒä»¬è¾“å‡ºæ¶ˆæ¯çš„é•¿åº¦å¯ä»¥å˜åŒ–ã€‚ SHA3 çš„ Python ä»£ç ç¤ºä¾‹ï¼š python import hashlib, binascii text = 'hello' data = text.encode(\"utf8\") sha3_256hash = hashlib.sha3_256(data).digest() print(f\"SHA3-256('{text}') = \", binascii.hexlify(sha3_256hash).decode(\"utf8\")) sha3_512hash = hashlib.sha3_512(data).digest() print(f\"SHA3-512('{text}') = \", binascii.hexlify(sha3_512hash).decode(\"utf8\")) # SHAKE-128 with 256-bit output shake128_hash = hashlib.shake_128(data).digest(32) # 32 bytes = 256 bits print(f\"SHAKE-128('{text}', 256) = \", binascii.hexlify(shake128_hash).decode(\"utf8\")) # SHAKE-256 with 160-bit output shake256_hash = hashlib.shake_256(data).digest(20) # 20 bytes = 160 bits print(f\"SHAKE-256('{text}', 160) = \", binascii.hexlify(shake256_hash).decode(\"utf8\")) è¾“å‡ºï¼š text SHA3-256('hello') = 3338be694f50c5f338814986cdf0686453a888b84f424d792af4b9202398f392 SHA3-512('hello') = 75d527c368f2efe848ecf6b073a36767800805e9eef2b1857d5f984f036eb6df891d75f72d9b154518c1cd58835286d1da9a38deba3de98b5a53e5ed78a84976 SHAKE-128('hello', 256) = 8eb4b6a932f280335ee1a279f8c208a349e7bc65daf831d3021c213825292463 SHAKE-256('hello', 160) = 1234075ae4a1e77316cf2d8000974581a343b9eb 4. BLAKE2 / BLAKE2s / BLAKE2bBLAKE / BLAKE2 / BLAKE2s / BLAKE2b æ˜¯ä¸€ç³»åˆ—å¿«é€Ÿã€é«˜åº¦å®‰å…¨çš„å¯†ç å­¦å“ˆå¸Œå‡½æ•°ï¼Œæä¾› 160 ä½ã€224 ä½ã€256 ä½ã€384 ä½å’Œ 512 ä½æ‘˜è¦å¤§å°çš„è®¡ç®—ï¼Œåœ¨ç°ä»£å¯†ç å­¦ä¸­è¢«å¹¿æ³›åº”ç”¨ã€‚BLAKE è¿›å…¥äº†SHA3 NIST æ¯”èµ›çš„å†³èµ›ã€‚ BLAKE2 å‡½æ•°æ˜¯ BLAKE çš„æ”¹è¿›ç‰ˆæœ¬ã€‚ BLAKE2sï¼ˆé€šå¸¸ä¸º 256 ä½ï¼‰æ˜¯ BLAKE2 å®ç°ï¼Œé’ˆå¯¹ 32 ä½å¾®å¤„ç†å™¨è¿›è¡Œäº†æ€§èƒ½ä¼˜åŒ–ã€‚ BLAKE2bï¼ˆé€šå¸¸ä¸º 512 ä½ï¼‰æ˜¯ BLAKE2 å®ç°ï¼Œé’ˆå¯¹ 64 ä½å¾®å¤„ç†å™¨è¿›è¡Œäº†æ€§èƒ½ä¼˜åŒ–ã€‚ BLAKE2 å“ˆå¸Œå‡½æ•°å…·æœ‰ä¸ SHA-3 ç±»ä¼¼çš„å®‰å…¨å¼ºåº¦ï¼Œä½†å¼€å‘äººå‘˜ç›®å‰ä»ç„¶æ›´å€¾å‘äºä½¿ç”¨ SHA2 å’Œ SHA3ã€‚ BLAKE å“ˆå¸Œå€¼çš„ Python ç¤ºä¾‹ï¼š python import hashlib, binascii text = 'hello' data = text.encode(\"utf8\") blake2s = hashlib.new('blake2s', data).digest() print(\"BLAKE2s({text}) = \", binascii.hexlify(blake2s).decode(\"utf-8\")) blake2b = hashlib.new('blake2b', data).digest() print(\"BLAKE2b({text}) = \", binascii.hexlify(blake2b).decode(\"utf-8\")) è¾“å‡ºå¦‚ä¸‹ï¼š text BLAKE2s('hello') = 19213bacc58dee6dbde3ceb9a47cbb330b3d86f8cca8997eb00be456f140ca25 BLAKE2b('hello') = e4cfa39a3d37be31c59609e807970799caa68a19bfaa15135f165085e01d41a65ba1e1b146aeb6bd0092b49eac214c103ccfa3a365954bbbe52f74a2b3620c94 5. RIPEMD-160RIPEMD-160, RIPE Message Digest æ˜¯ä¸€ç§å®‰å…¨å“ˆå¸Œå‡½æ•°ï¼Œå‘å¸ƒäº 1996 å¹´ï¼Œç›®å‰ä¸»è¦è¢«åº”ç”¨åœ¨ PGP å’Œæ¯”ç‰¹å¸ä¸­ã€‚ RIPEMD çš„ 160 ä½å˜ä½“åœ¨å®è·µä¸­è¢«å¹¿æ³›ä½¿ç”¨ï¼Œè€Œ RIPEMD-128ã€RIPEMD-256 å’Œ RIPEMD-320 ç­‰å…¶ä»–å˜ä½“å¹¶","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-2-hash/:2:3","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","å¯†ç å­¦","å“ˆå¸Œ","æ•£åˆ—","å®‰å…¨","SHA-2","SHA-3"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆäºŒï¼‰â€”â€” å“ˆå¸Œå‡½æ•°","uri":"/posts/practical-cryptography-basics-2-hash/#å®‰å…¨çš„åŠ å¯†å“ˆå¸Œç®—æ³•"},{"categories":["tech"],"content":" å®‰å…¨çš„åŠ å¯†å“ˆå¸Œç®—æ³• 1. SHA-2, SHA-256, SHA-512SHA-2ï¼Œå³ Secure Hash Algorithm 2ï¼Œæ˜¯ä¸€ç»„å¼ºå¯†ç å“ˆå¸Œå‡½æ•°ï¼Œå…¶ç‰ˆæœ¬åŒ…æ‹¬ï¼šSHA-256ï¼ˆ256ä½å“ˆå¸Œï¼‰ã€SHA-384ï¼ˆ384ä½å“ˆå¸Œï¼‰ã€SHA-512ï¼ˆ512ä½å“ˆå¸Œï¼‰ç­‰ã€‚åŸºäºå¯†ç æ¦‚å¿µã€ŒMerkleâ€“DamgÃ¥rd æ„é€ ã€ï¼Œç›®å‰è¢«è®¤ä¸ºé«˜åº¦å®‰å…¨ã€‚ SHA-2 æ˜¯ SHA-1 çš„ç»§ä»»è€…ï¼Œäº 2001 å¹´åœ¨ç¾å›½ä½œä¸ºå®˜æ–¹åŠ å¯†æ ‡å‡†å‘å¸ƒã€‚ SHA-2 åœ¨è½¯ä»¶å¼€å‘å’Œå¯†ç å­¦ä¸­è¢«å¹¿æ³›ä½¿ç”¨ï¼Œå¯ç”¨äºç°ä»£å•†ä¸šåº”ç”¨ã€‚å…¶ä¸­ SHA-256 è¢«å¹¿æ³›ç”¨äº HTTPS åè®®ã€æ–‡ä»¶å®Œæ•´æ€§æ ¡éªŒã€æ¯”ç‰¹å¸åŒºå—é“¾ç­‰å„ç§åœºæ™¯ã€‚ Python ä»£ç ç¤ºä¾‹ï¼š python import hashlib, binascii text = 'hello' data = text.encode(\"utf8\") sha256hash = hashlib.sha256(data).digest() print(f\"SHA-256({text}) = \", binascii.hexlify(sha256hash).decode(\"utf8\")) sha384hash = hashlib.sha384(data).digest() print(f\"SHA-384({text}) = \", binascii.hexlify(sha384hash).decode(\"utf8\")) sha512hash = hashlib.sha512(data).digest() print(f\"SHA-512({text}) = \", binascii.hexlify(sha512hash).decode(\"utf8\")) è¾“å‡ºå¦‚ä¸‹ï¼š text SHA-256('hello') = 2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824 SHA-384('hello') = 59e1748777448c69de6b800d7a33bbfb9ff1b463e44354c3553bcdb9c666fa90125a3c79f90397bdf5f6a13de828684f SHA-512('hello') = 9b71d224bd62f3785d96d46ad3ea3d73319bfbc2890caadae2dff72519673ca72323c3d99ba5c11d7c7acc6e14b8c5da0c4663475c2e5c3adef46f73bcdec043 2. æ›´é•¿çš„å“ˆå¸Œå€¼ == æ›´é«˜çš„æŠ—ç¢°æ’èƒ½åŠ›æŒ‰ç…§è®¾è®¡ï¼Œå“ˆå¸Œå‡½æ•°çš„è¾“å‡ºè¶Šé•¿ï¼Œå°±æœ‰æœ›å®ç°æ›´é«˜çš„å®‰å…¨æ€§å’ŒæŠ—ç¢°æ’èƒ½åŠ›ï¼ˆä½†ä¹Ÿæœ‰ä¸€äº›ä¾‹å¤–ï¼‰ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œ128 ä½å“ˆå¸Œç®—æ³•æ¯” 256 ä½å“ˆå¸Œç®—æ³•å¼±ï¼Œ256 ä½å“ˆå¸Œç®—æ³•æ¯” 512 ä½å“ˆå¸Œç®—æ³•å¼±ã€‚ å› æ­¤æ˜¾ç„¶ SHA-512 æ¯” SHA-256 æ›´å¼ºã€‚æˆ‘ä»¬å¯ä»¥é¢„æœŸï¼ŒSHA-512 çš„ç¢°æ’æ¦‚ç‡è¦æ¯” SHA-256 æ›´ä½ã€‚ 3. SHA-3, SHA3-256, SHA3-512, Keccak-256åœ¨è¾“å‡ºçš„å“ˆå¸Œé•¿åº¦ç›¸åŒæ—¶ï¼ŒSHA-3ï¼ˆåŠå…¶å˜ä½“ SHA3-224ã€SHA3-256ã€SHA3-384ã€SHA3-512ï¼‰è¢«è®¤ä¸ºæ‹¥æœ‰æ¯” SHA-2ï¼ˆSHA-224ã€SHA-256ã€SHA-384ã€SHA-512ï¼‰æ›´é«˜çš„åŠ å¯†å¼ºåº¦ã€‚ä¾‹å¦‚ï¼Œå¯¹äºç›¸åŒçš„å“ˆå¸Œé•¿åº¦ï¼ˆ256 ä½ï¼‰ï¼ŒSHA3-256 æä¾›æ¯” SHA-256 æ›´é«˜çš„åŠ å¯†å¼ºåº¦ã€‚ SHA-3 ç³»åˆ—å‡½æ•°æ˜¯ Keccak å“ˆå¸Œå®¶æ—çš„ä»£è¡¨ï¼Œå®ƒåŸºäºå¯†ç å­¦æ¦‚å¿µæµ·ç»µå‡½æ•°ã€‚è€ŒKeccak æ˜¯SHA3 NIST æ¯”èµ›çš„å† å†›ã€‚ ä¸ SHA-2 ä¸åŒï¼ŒSHA-3 ç³»åˆ—åŠ å¯†å“ˆå¸Œå‡½æ•°ä¸æ˜“å—åˆ°é•¿åº¦æ‹“å±•æ”»å‡» Length extension attack. SHA-3 è¢«è®¤ä¸ºæ˜¯é«˜åº¦å®‰å…¨çš„ï¼Œå¹¶äº 2015 å¹´ä½œä¸ºç¾å›½å®˜æ–¹æ¨èçš„åŠ å¯†æ ‡å‡†å‘å¸ƒã€‚ ä»¥å¤ªåŠï¼ˆEthereumï¼‰åŒºå—é“¾ä¸­ä½¿ç”¨çš„å“ˆå¸Œå‡½æ•° Keccak-256 æ˜¯ SHA3-256 çš„å˜ä½“ï¼Œåœ¨ä»£ç ä¸­æ›´æ”¹äº†ä¸€äº›å¸¸é‡ã€‚ å“ˆå¸Œå‡½æ•° SHAKE128(msg, length) å’Œ SHAKE256(msg, length) æ˜¯ SHA3-256 å’Œ SHA3-512 ç®—æ³•çš„å˜ä½“ï¼Œå®ƒä»¬è¾“å‡ºæ¶ˆæ¯çš„é•¿åº¦å¯ä»¥å˜åŒ–ã€‚ SHA3 çš„ Python ä»£ç ç¤ºä¾‹ï¼š python import hashlib, binascii text = 'hello' data = text.encode(\"utf8\") sha3_256hash = hashlib.sha3_256(data).digest() print(f\"SHA3-256('{text}') = \", binascii.hexlify(sha3_256hash).decode(\"utf8\")) sha3_512hash = hashlib.sha3_512(data).digest() print(f\"SHA3-512('{text}') = \", binascii.hexlify(sha3_512hash).decode(\"utf8\")) # SHAKE-128 with 256-bit output shake128_hash = hashlib.shake_128(data).digest(32) # 32 bytes = 256 bits print(f\"SHAKE-128('{text}', 256) = \", binascii.hexlify(shake128_hash).decode(\"utf8\")) # SHAKE-256 with 160-bit output shake256_hash = hashlib.shake_256(data).digest(20) # 20 bytes = 160 bits print(f\"SHAKE-256('{text}', 160) = \", binascii.hexlify(shake256_hash).decode(\"utf8\")) è¾“å‡ºï¼š text SHA3-256('hello') = 3338be694f50c5f338814986cdf0686453a888b84f424d792af4b9202398f392 SHA3-512('hello') = 75d527c368f2efe848ecf6b073a36767800805e9eef2b1857d5f984f036eb6df891d75f72d9b154518c1cd58835286d1da9a38deba3de98b5a53e5ed78a84976 SHAKE-128('hello', 256) = 8eb4b6a932f280335ee1a279f8c208a349e7bc65daf831d3021c213825292463 SHAKE-256('hello', 160) = 1234075ae4a1e77316cf2d8000974581a343b9eb 4. BLAKE2 / BLAKE2s / BLAKE2bBLAKE / BLAKE2 / BLAKE2s / BLAKE2b æ˜¯ä¸€ç³»åˆ—å¿«é€Ÿã€é«˜åº¦å®‰å…¨çš„å¯†ç å­¦å“ˆå¸Œå‡½æ•°ï¼Œæä¾› 160 ä½ã€224 ä½ã€256 ä½ã€384 ä½å’Œ 512 ä½æ‘˜è¦å¤§å°çš„è®¡ç®—ï¼Œåœ¨ç°ä»£å¯†ç å­¦ä¸­è¢«å¹¿æ³›åº”ç”¨ã€‚BLAKE è¿›å…¥äº†SHA3 NIST æ¯”èµ›çš„å†³èµ›ã€‚ BLAKE2 å‡½æ•°æ˜¯ BLAKE çš„æ”¹è¿›ç‰ˆæœ¬ã€‚ BLAKE2sï¼ˆé€šå¸¸ä¸º 256 ä½ï¼‰æ˜¯ BLAKE2 å®ç°ï¼Œé’ˆå¯¹ 32 ä½å¾®å¤„ç†å™¨è¿›è¡Œäº†æ€§èƒ½ä¼˜åŒ–ã€‚ BLAKE2bï¼ˆé€šå¸¸ä¸º 512 ä½ï¼‰æ˜¯ BLAKE2 å®ç°ï¼Œé’ˆå¯¹ 64 ä½å¾®å¤„ç†å™¨è¿›è¡Œäº†æ€§èƒ½ä¼˜åŒ–ã€‚ BLAKE2 å“ˆå¸Œå‡½æ•°å…·æœ‰ä¸ SHA-3 ç±»ä¼¼çš„å®‰å…¨å¼ºåº¦ï¼Œä½†å¼€å‘äººå‘˜ç›®å‰ä»ç„¶æ›´å€¾å‘äºä½¿ç”¨ SHA2 å’Œ SHA3ã€‚ BLAKE å“ˆå¸Œå€¼çš„ Python ç¤ºä¾‹ï¼š python import hashlib, binascii text = 'hello' data = text.encode(\"utf8\") blake2s = hashlib.new('blake2s', data).digest() print(\"BLAKE2s({text}) = \", binascii.hexlify(blake2s).decode(\"utf-8\")) blake2b = hashlib.new('blake2b', data).digest() print(\"BLAKE2b({text}) = \", binascii.hexlify(blake2b).decode(\"utf-8\")) è¾“å‡ºå¦‚ä¸‹ï¼š text BLAKE2s('hello') = 19213bacc58dee6dbde3ceb9a47cbb330b3d86f8cca8997eb00be456f140ca25 BLAKE2b('hello') = e4cfa39a3d37be31c59609e807970799caa68a19bfaa15135f165085e01d41a65ba1e1b146aeb6bd0092b49eac214c103ccfa3a365954bbbe52f74a2b3620c94 5. RIPEMD-160RIPEMD-160, RIPE Message Digest æ˜¯ä¸€ç§å®‰å…¨å“ˆå¸Œå‡½æ•°ï¼Œå‘å¸ƒäº 1996 å¹´ï¼Œç›®å‰ä¸»è¦è¢«åº”ç”¨åœ¨ PGP å’Œæ¯”ç‰¹å¸ä¸­ã€‚ RIPEMD çš„ 160 ä½å˜ä½“åœ¨å®è·µä¸­è¢«å¹¿æ³›ä½¿ç”¨ï¼Œè€Œ RIPEMD-128ã€RIPEMD-256 å’Œ RIPEMD-320 ç­‰å…¶ä»–å˜ä½“å¹¶","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-2-hash/:2:3","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","å¯†ç å­¦","å“ˆå¸Œ","æ•£åˆ—","å®‰å…¨","SHA-2","SHA-3"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆäºŒï¼‰â€”â€” å“ˆå¸Œå‡½æ•°","uri":"/posts/practical-cryptography-basics-2-hash/#1-sha-2-sha-256-sha-512"},{"categories":["tech"],"content":" å®‰å…¨çš„åŠ å¯†å“ˆå¸Œç®—æ³• 1. SHA-2, SHA-256, SHA-512SHA-2ï¼Œå³ Secure Hash Algorithm 2ï¼Œæ˜¯ä¸€ç»„å¼ºå¯†ç å“ˆå¸Œå‡½æ•°ï¼Œå…¶ç‰ˆæœ¬åŒ…æ‹¬ï¼šSHA-256ï¼ˆ256ä½å“ˆå¸Œï¼‰ã€SHA-384ï¼ˆ384ä½å“ˆå¸Œï¼‰ã€SHA-512ï¼ˆ512ä½å“ˆå¸Œï¼‰ç­‰ã€‚åŸºäºå¯†ç æ¦‚å¿µã€ŒMerkleâ€“DamgÃ¥rd æ„é€ ã€ï¼Œç›®å‰è¢«è®¤ä¸ºé«˜åº¦å®‰å…¨ã€‚ SHA-2 æ˜¯ SHA-1 çš„ç»§ä»»è€…ï¼Œäº 2001 å¹´åœ¨ç¾å›½ä½œä¸ºå®˜æ–¹åŠ å¯†æ ‡å‡†å‘å¸ƒã€‚ SHA-2 åœ¨è½¯ä»¶å¼€å‘å’Œå¯†ç å­¦ä¸­è¢«å¹¿æ³›ä½¿ç”¨ï¼Œå¯ç”¨äºç°ä»£å•†ä¸šåº”ç”¨ã€‚å…¶ä¸­ SHA-256 è¢«å¹¿æ³›ç”¨äº HTTPS åè®®ã€æ–‡ä»¶å®Œæ•´æ€§æ ¡éªŒã€æ¯”ç‰¹å¸åŒºå—é“¾ç­‰å„ç§åœºæ™¯ã€‚ Python ä»£ç ç¤ºä¾‹ï¼š python import hashlib, binascii text = 'hello' data = text.encode(\"utf8\") sha256hash = hashlib.sha256(data).digest() print(f\"SHA-256({text}) = \", binascii.hexlify(sha256hash).decode(\"utf8\")) sha384hash = hashlib.sha384(data).digest() print(f\"SHA-384({text}) = \", binascii.hexlify(sha384hash).decode(\"utf8\")) sha512hash = hashlib.sha512(data).digest() print(f\"SHA-512({text}) = \", binascii.hexlify(sha512hash).decode(\"utf8\")) è¾“å‡ºå¦‚ä¸‹ï¼š text SHA-256('hello') = 2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824 SHA-384('hello') = 59e1748777448c69de6b800d7a33bbfb9ff1b463e44354c3553bcdb9c666fa90125a3c79f90397bdf5f6a13de828684f SHA-512('hello') = 9b71d224bd62f3785d96d46ad3ea3d73319bfbc2890caadae2dff72519673ca72323c3d99ba5c11d7c7acc6e14b8c5da0c4663475c2e5c3adef46f73bcdec043 2. æ›´é•¿çš„å“ˆå¸Œå€¼ == æ›´é«˜çš„æŠ—ç¢°æ’èƒ½åŠ›æŒ‰ç…§è®¾è®¡ï¼Œå“ˆå¸Œå‡½æ•°çš„è¾“å‡ºè¶Šé•¿ï¼Œå°±æœ‰æœ›å®ç°æ›´é«˜çš„å®‰å…¨æ€§å’ŒæŠ—ç¢°æ’èƒ½åŠ›ï¼ˆä½†ä¹Ÿæœ‰ä¸€äº›ä¾‹å¤–ï¼‰ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œ128 ä½å“ˆå¸Œç®—æ³•æ¯” 256 ä½å“ˆå¸Œç®—æ³•å¼±ï¼Œ256 ä½å“ˆå¸Œç®—æ³•æ¯” 512 ä½å“ˆå¸Œç®—æ³•å¼±ã€‚ å› æ­¤æ˜¾ç„¶ SHA-512 æ¯” SHA-256 æ›´å¼ºã€‚æˆ‘ä»¬å¯ä»¥é¢„æœŸï¼ŒSHA-512 çš„ç¢°æ’æ¦‚ç‡è¦æ¯” SHA-256 æ›´ä½ã€‚ 3. SHA-3, SHA3-256, SHA3-512, Keccak-256åœ¨è¾“å‡ºçš„å“ˆå¸Œé•¿åº¦ç›¸åŒæ—¶ï¼ŒSHA-3ï¼ˆåŠå…¶å˜ä½“ SHA3-224ã€SHA3-256ã€SHA3-384ã€SHA3-512ï¼‰è¢«è®¤ä¸ºæ‹¥æœ‰æ¯” SHA-2ï¼ˆSHA-224ã€SHA-256ã€SHA-384ã€SHA-512ï¼‰æ›´é«˜çš„åŠ å¯†å¼ºåº¦ã€‚ä¾‹å¦‚ï¼Œå¯¹äºç›¸åŒçš„å“ˆå¸Œé•¿åº¦ï¼ˆ256 ä½ï¼‰ï¼ŒSHA3-256 æä¾›æ¯” SHA-256 æ›´é«˜çš„åŠ å¯†å¼ºåº¦ã€‚ SHA-3 ç³»åˆ—å‡½æ•°æ˜¯ Keccak å“ˆå¸Œå®¶æ—çš„ä»£è¡¨ï¼Œå®ƒåŸºäºå¯†ç å­¦æ¦‚å¿µæµ·ç»µå‡½æ•°ã€‚è€ŒKeccak æ˜¯SHA3 NIST æ¯”èµ›çš„å† å†›ã€‚ ä¸ SHA-2 ä¸åŒï¼ŒSHA-3 ç³»åˆ—åŠ å¯†å“ˆå¸Œå‡½æ•°ä¸æ˜“å—åˆ°é•¿åº¦æ‹“å±•æ”»å‡» Length extension attack. SHA-3 è¢«è®¤ä¸ºæ˜¯é«˜åº¦å®‰å…¨çš„ï¼Œå¹¶äº 2015 å¹´ä½œä¸ºç¾å›½å®˜æ–¹æ¨èçš„åŠ å¯†æ ‡å‡†å‘å¸ƒã€‚ ä»¥å¤ªåŠï¼ˆEthereumï¼‰åŒºå—é“¾ä¸­ä½¿ç”¨çš„å“ˆå¸Œå‡½æ•° Keccak-256 æ˜¯ SHA3-256 çš„å˜ä½“ï¼Œåœ¨ä»£ç ä¸­æ›´æ”¹äº†ä¸€äº›å¸¸é‡ã€‚ å“ˆå¸Œå‡½æ•° SHAKE128(msg, length) å’Œ SHAKE256(msg, length) æ˜¯ SHA3-256 å’Œ SHA3-512 ç®—æ³•çš„å˜ä½“ï¼Œå®ƒä»¬è¾“å‡ºæ¶ˆæ¯çš„é•¿åº¦å¯ä»¥å˜åŒ–ã€‚ SHA3 çš„ Python ä»£ç ç¤ºä¾‹ï¼š python import hashlib, binascii text = 'hello' data = text.encode(\"utf8\") sha3_256hash = hashlib.sha3_256(data).digest() print(f\"SHA3-256('{text}') = \", binascii.hexlify(sha3_256hash).decode(\"utf8\")) sha3_512hash = hashlib.sha3_512(data).digest() print(f\"SHA3-512('{text}') = \", binascii.hexlify(sha3_512hash).decode(\"utf8\")) # SHAKE-128 with 256-bit output shake128_hash = hashlib.shake_128(data).digest(32) # 32 bytes = 256 bits print(f\"SHAKE-128('{text}', 256) = \", binascii.hexlify(shake128_hash).decode(\"utf8\")) # SHAKE-256 with 160-bit output shake256_hash = hashlib.shake_256(data).digest(20) # 20 bytes = 160 bits print(f\"SHAKE-256('{text}', 160) = \", binascii.hexlify(shake256_hash).decode(\"utf8\")) è¾“å‡ºï¼š text SHA3-256('hello') = 3338be694f50c5f338814986cdf0686453a888b84f424d792af4b9202398f392 SHA3-512('hello') = 75d527c368f2efe848ecf6b073a36767800805e9eef2b1857d5f984f036eb6df891d75f72d9b154518c1cd58835286d1da9a38deba3de98b5a53e5ed78a84976 SHAKE-128('hello', 256) = 8eb4b6a932f280335ee1a279f8c208a349e7bc65daf831d3021c213825292463 SHAKE-256('hello', 160) = 1234075ae4a1e77316cf2d8000974581a343b9eb 4. BLAKE2 / BLAKE2s / BLAKE2bBLAKE / BLAKE2 / BLAKE2s / BLAKE2b æ˜¯ä¸€ç³»åˆ—å¿«é€Ÿã€é«˜åº¦å®‰å…¨çš„å¯†ç å­¦å“ˆå¸Œå‡½æ•°ï¼Œæä¾› 160 ä½ã€224 ä½ã€256 ä½ã€384 ä½å’Œ 512 ä½æ‘˜è¦å¤§å°çš„è®¡ç®—ï¼Œåœ¨ç°ä»£å¯†ç å­¦ä¸­è¢«å¹¿æ³›åº”ç”¨ã€‚BLAKE è¿›å…¥äº†SHA3 NIST æ¯”èµ›çš„å†³èµ›ã€‚ BLAKE2 å‡½æ•°æ˜¯ BLAKE çš„æ”¹è¿›ç‰ˆæœ¬ã€‚ BLAKE2sï¼ˆé€šå¸¸ä¸º 256 ä½ï¼‰æ˜¯ BLAKE2 å®ç°ï¼Œé’ˆå¯¹ 32 ä½å¾®å¤„ç†å™¨è¿›è¡Œäº†æ€§èƒ½ä¼˜åŒ–ã€‚ BLAKE2bï¼ˆé€šå¸¸ä¸º 512 ä½ï¼‰æ˜¯ BLAKE2 å®ç°ï¼Œé’ˆå¯¹ 64 ä½å¾®å¤„ç†å™¨è¿›è¡Œäº†æ€§èƒ½ä¼˜åŒ–ã€‚ BLAKE2 å“ˆå¸Œå‡½æ•°å…·æœ‰ä¸ SHA-3 ç±»ä¼¼çš„å®‰å…¨å¼ºåº¦ï¼Œä½†å¼€å‘äººå‘˜ç›®å‰ä»ç„¶æ›´å€¾å‘äºä½¿ç”¨ SHA2 å’Œ SHA3ã€‚ BLAKE å“ˆå¸Œå€¼çš„ Python ç¤ºä¾‹ï¼š python import hashlib, binascii text = 'hello' data = text.encode(\"utf8\") blake2s = hashlib.new('blake2s', data).digest() print(\"BLAKE2s({text}) = \", binascii.hexlify(blake2s).decode(\"utf-8\")) blake2b = hashlib.new('blake2b', data).digest() print(\"BLAKE2b({text}) = \", binascii.hexlify(blake2b).decode(\"utf-8\")) è¾“å‡ºå¦‚ä¸‹ï¼š text BLAKE2s('hello') = 19213bacc58dee6dbde3ceb9a47cbb330b3d86f8cca8997eb00be456f140ca25 BLAKE2b('hello') = e4cfa39a3d37be31c59609e807970799caa68a19bfaa15135f165085e01d41a65ba1e1b146aeb6bd0092b49eac214c103ccfa3a365954bbbe52f74a2b3620c94 5. RIPEMD-160RIPEMD-160, RIPE Message Digest æ˜¯ä¸€ç§å®‰å…¨å“ˆå¸Œå‡½æ•°ï¼Œå‘å¸ƒäº 1996 å¹´ï¼Œç›®å‰ä¸»è¦è¢«åº”ç”¨åœ¨ PGP å’Œæ¯”ç‰¹å¸ä¸­ã€‚ RIPEMD çš„ 160 ä½å˜ä½“åœ¨å®è·µä¸­è¢«å¹¿æ³›ä½¿ç”¨ï¼Œè€Œ RIPEMD-128ã€RIPEMD-256 å’Œ RIPEMD-320 ç­‰å…¶ä»–å˜ä½“å¹¶","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-2-hash/:2:3","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","å¯†ç å­¦","å“ˆå¸Œ","æ•£åˆ—","å®‰å…¨","SHA-2","SHA-3"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆäºŒï¼‰â€”â€” å“ˆå¸Œå‡½æ•°","uri":"/posts/practical-cryptography-basics-2-hash/#2-æ›´é•¿çš„å“ˆå¸Œå€¼--æ›´é«˜çš„æŠ—ç¢°æ’èƒ½åŠ›"},{"categories":["tech"],"content":" å®‰å…¨çš„åŠ å¯†å“ˆå¸Œç®—æ³• 1. SHA-2, SHA-256, SHA-512SHA-2ï¼Œå³ Secure Hash Algorithm 2ï¼Œæ˜¯ä¸€ç»„å¼ºå¯†ç å“ˆå¸Œå‡½æ•°ï¼Œå…¶ç‰ˆæœ¬åŒ…æ‹¬ï¼šSHA-256ï¼ˆ256ä½å“ˆå¸Œï¼‰ã€SHA-384ï¼ˆ384ä½å“ˆå¸Œï¼‰ã€SHA-512ï¼ˆ512ä½å“ˆå¸Œï¼‰ç­‰ã€‚åŸºäºå¯†ç æ¦‚å¿µã€ŒMerkleâ€“DamgÃ¥rd æ„é€ ã€ï¼Œç›®å‰è¢«è®¤ä¸ºé«˜åº¦å®‰å…¨ã€‚ SHA-2 æ˜¯ SHA-1 çš„ç»§ä»»è€…ï¼Œäº 2001 å¹´åœ¨ç¾å›½ä½œä¸ºå®˜æ–¹åŠ å¯†æ ‡å‡†å‘å¸ƒã€‚ SHA-2 åœ¨è½¯ä»¶å¼€å‘å’Œå¯†ç å­¦ä¸­è¢«å¹¿æ³›ä½¿ç”¨ï¼Œå¯ç”¨äºç°ä»£å•†ä¸šåº”ç”¨ã€‚å…¶ä¸­ SHA-256 è¢«å¹¿æ³›ç”¨äº HTTPS åè®®ã€æ–‡ä»¶å®Œæ•´æ€§æ ¡éªŒã€æ¯”ç‰¹å¸åŒºå—é“¾ç­‰å„ç§åœºæ™¯ã€‚ Python ä»£ç ç¤ºä¾‹ï¼š python import hashlib, binascii text = 'hello' data = text.encode(\"utf8\") sha256hash = hashlib.sha256(data).digest() print(f\"SHA-256({text}) = \", binascii.hexlify(sha256hash).decode(\"utf8\")) sha384hash = hashlib.sha384(data).digest() print(f\"SHA-384({text}) = \", binascii.hexlify(sha384hash).decode(\"utf8\")) sha512hash = hashlib.sha512(data).digest() print(f\"SHA-512({text}) = \", binascii.hexlify(sha512hash).decode(\"utf8\")) è¾“å‡ºå¦‚ä¸‹ï¼š text SHA-256('hello') = 2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824 SHA-384('hello') = 59e1748777448c69de6b800d7a33bbfb9ff1b463e44354c3553bcdb9c666fa90125a3c79f90397bdf5f6a13de828684f SHA-512('hello') = 9b71d224bd62f3785d96d46ad3ea3d73319bfbc2890caadae2dff72519673ca72323c3d99ba5c11d7c7acc6e14b8c5da0c4663475c2e5c3adef46f73bcdec043 2. æ›´é•¿çš„å“ˆå¸Œå€¼ == æ›´é«˜çš„æŠ—ç¢°æ’èƒ½åŠ›æŒ‰ç…§è®¾è®¡ï¼Œå“ˆå¸Œå‡½æ•°çš„è¾“å‡ºè¶Šé•¿ï¼Œå°±æœ‰æœ›å®ç°æ›´é«˜çš„å®‰å…¨æ€§å’ŒæŠ—ç¢°æ’èƒ½åŠ›ï¼ˆä½†ä¹Ÿæœ‰ä¸€äº›ä¾‹å¤–ï¼‰ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œ128 ä½å“ˆå¸Œç®—æ³•æ¯” 256 ä½å“ˆå¸Œç®—æ³•å¼±ï¼Œ256 ä½å“ˆå¸Œç®—æ³•æ¯” 512 ä½å“ˆå¸Œç®—æ³•å¼±ã€‚ å› æ­¤æ˜¾ç„¶ SHA-512 æ¯” SHA-256 æ›´å¼ºã€‚æˆ‘ä»¬å¯ä»¥é¢„æœŸï¼ŒSHA-512 çš„ç¢°æ’æ¦‚ç‡è¦æ¯” SHA-256 æ›´ä½ã€‚ 3. SHA-3, SHA3-256, SHA3-512, Keccak-256åœ¨è¾“å‡ºçš„å“ˆå¸Œé•¿åº¦ç›¸åŒæ—¶ï¼ŒSHA-3ï¼ˆåŠå…¶å˜ä½“ SHA3-224ã€SHA3-256ã€SHA3-384ã€SHA3-512ï¼‰è¢«è®¤ä¸ºæ‹¥æœ‰æ¯” SHA-2ï¼ˆSHA-224ã€SHA-256ã€SHA-384ã€SHA-512ï¼‰æ›´é«˜çš„åŠ å¯†å¼ºåº¦ã€‚ä¾‹å¦‚ï¼Œå¯¹äºç›¸åŒçš„å“ˆå¸Œé•¿åº¦ï¼ˆ256 ä½ï¼‰ï¼ŒSHA3-256 æä¾›æ¯” SHA-256 æ›´é«˜çš„åŠ å¯†å¼ºåº¦ã€‚ SHA-3 ç³»åˆ—å‡½æ•°æ˜¯ Keccak å“ˆå¸Œå®¶æ—çš„ä»£è¡¨ï¼Œå®ƒåŸºäºå¯†ç å­¦æ¦‚å¿µæµ·ç»µå‡½æ•°ã€‚è€ŒKeccak æ˜¯SHA3 NIST æ¯”èµ›çš„å† å†›ã€‚ ä¸ SHA-2 ä¸åŒï¼ŒSHA-3 ç³»åˆ—åŠ å¯†å“ˆå¸Œå‡½æ•°ä¸æ˜“å—åˆ°é•¿åº¦æ‹“å±•æ”»å‡» Length extension attack. SHA-3 è¢«è®¤ä¸ºæ˜¯é«˜åº¦å®‰å…¨çš„ï¼Œå¹¶äº 2015 å¹´ä½œä¸ºç¾å›½å®˜æ–¹æ¨èçš„åŠ å¯†æ ‡å‡†å‘å¸ƒã€‚ ä»¥å¤ªåŠï¼ˆEthereumï¼‰åŒºå—é“¾ä¸­ä½¿ç”¨çš„å“ˆå¸Œå‡½æ•° Keccak-256 æ˜¯ SHA3-256 çš„å˜ä½“ï¼Œåœ¨ä»£ç ä¸­æ›´æ”¹äº†ä¸€äº›å¸¸é‡ã€‚ å“ˆå¸Œå‡½æ•° SHAKE128(msg, length) å’Œ SHAKE256(msg, length) æ˜¯ SHA3-256 å’Œ SHA3-512 ç®—æ³•çš„å˜ä½“ï¼Œå®ƒä»¬è¾“å‡ºæ¶ˆæ¯çš„é•¿åº¦å¯ä»¥å˜åŒ–ã€‚ SHA3 çš„ Python ä»£ç ç¤ºä¾‹ï¼š python import hashlib, binascii text = 'hello' data = text.encode(\"utf8\") sha3_256hash = hashlib.sha3_256(data).digest() print(f\"SHA3-256('{text}') = \", binascii.hexlify(sha3_256hash).decode(\"utf8\")) sha3_512hash = hashlib.sha3_512(data).digest() print(f\"SHA3-512('{text}') = \", binascii.hexlify(sha3_512hash).decode(\"utf8\")) # SHAKE-128 with 256-bit output shake128_hash = hashlib.shake_128(data).digest(32) # 32 bytes = 256 bits print(f\"SHAKE-128('{text}', 256) = \", binascii.hexlify(shake128_hash).decode(\"utf8\")) # SHAKE-256 with 160-bit output shake256_hash = hashlib.shake_256(data).digest(20) # 20 bytes = 160 bits print(f\"SHAKE-256('{text}', 160) = \", binascii.hexlify(shake256_hash).decode(\"utf8\")) è¾“å‡ºï¼š text SHA3-256('hello') = 3338be694f50c5f338814986cdf0686453a888b84f424d792af4b9202398f392 SHA3-512('hello') = 75d527c368f2efe848ecf6b073a36767800805e9eef2b1857d5f984f036eb6df891d75f72d9b154518c1cd58835286d1da9a38deba3de98b5a53e5ed78a84976 SHAKE-128('hello', 256) = 8eb4b6a932f280335ee1a279f8c208a349e7bc65daf831d3021c213825292463 SHAKE-256('hello', 160) = 1234075ae4a1e77316cf2d8000974581a343b9eb 4. BLAKE2 / BLAKE2s / BLAKE2bBLAKE / BLAKE2 / BLAKE2s / BLAKE2b æ˜¯ä¸€ç³»åˆ—å¿«é€Ÿã€é«˜åº¦å®‰å…¨çš„å¯†ç å­¦å“ˆå¸Œå‡½æ•°ï¼Œæä¾› 160 ä½ã€224 ä½ã€256 ä½ã€384 ä½å’Œ 512 ä½æ‘˜è¦å¤§å°çš„è®¡ç®—ï¼Œåœ¨ç°ä»£å¯†ç å­¦ä¸­è¢«å¹¿æ³›åº”ç”¨ã€‚BLAKE è¿›å…¥äº†SHA3 NIST æ¯”èµ›çš„å†³èµ›ã€‚ BLAKE2 å‡½æ•°æ˜¯ BLAKE çš„æ”¹è¿›ç‰ˆæœ¬ã€‚ BLAKE2sï¼ˆé€šå¸¸ä¸º 256 ä½ï¼‰æ˜¯ BLAKE2 å®ç°ï¼Œé’ˆå¯¹ 32 ä½å¾®å¤„ç†å™¨è¿›è¡Œäº†æ€§èƒ½ä¼˜åŒ–ã€‚ BLAKE2bï¼ˆé€šå¸¸ä¸º 512 ä½ï¼‰æ˜¯ BLAKE2 å®ç°ï¼Œé’ˆå¯¹ 64 ä½å¾®å¤„ç†å™¨è¿›è¡Œäº†æ€§èƒ½ä¼˜åŒ–ã€‚ BLAKE2 å“ˆå¸Œå‡½æ•°å…·æœ‰ä¸ SHA-3 ç±»ä¼¼çš„å®‰å…¨å¼ºåº¦ï¼Œä½†å¼€å‘äººå‘˜ç›®å‰ä»ç„¶æ›´å€¾å‘äºä½¿ç”¨ SHA2 å’Œ SHA3ã€‚ BLAKE å“ˆå¸Œå€¼çš„ Python ç¤ºä¾‹ï¼š python import hashlib, binascii text = 'hello' data = text.encode(\"utf8\") blake2s = hashlib.new('blake2s', data).digest() print(\"BLAKE2s({text}) = \", binascii.hexlify(blake2s).decode(\"utf-8\")) blake2b = hashlib.new('blake2b', data).digest() print(\"BLAKE2b({text}) = \", binascii.hexlify(blake2b).decode(\"utf-8\")) è¾“å‡ºå¦‚ä¸‹ï¼š text BLAKE2s('hello') = 19213bacc58dee6dbde3ceb9a47cbb330b3d86f8cca8997eb00be456f140ca25 BLAKE2b('hello') = e4cfa39a3d37be31c59609e807970799caa68a19bfaa15135f165085e01d41a65ba1e1b146aeb6bd0092b49eac214c103ccfa3a365954bbbe52f74a2b3620c94 5. RIPEMD-160RIPEMD-160, RIPE Message Digest æ˜¯ä¸€ç§å®‰å…¨å“ˆå¸Œå‡½æ•°ï¼Œå‘å¸ƒäº 1996 å¹´ï¼Œç›®å‰ä¸»è¦è¢«åº”ç”¨åœ¨ PGP å’Œæ¯”ç‰¹å¸ä¸­ã€‚ RIPEMD çš„ 160 ä½å˜ä½“åœ¨å®è·µä¸­è¢«å¹¿æ³›ä½¿ç”¨ï¼Œè€Œ RIPEMD-128ã€RIPEMD-256 å’Œ RIPEMD-320 ç­‰å…¶ä»–å˜ä½“å¹¶","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-2-hash/:2:3","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","å¯†ç å­¦","å“ˆå¸Œ","æ•£åˆ—","å®‰å…¨","SHA-2","SHA-3"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆäºŒï¼‰â€”â€” å“ˆå¸Œå‡½æ•°","uri":"/posts/practical-cryptography-basics-2-hash/#3-sha-3-sha3-256-sha3-512-keccak-256"},{"categories":["tech"],"content":" å®‰å…¨çš„åŠ å¯†å“ˆå¸Œç®—æ³• 1. SHA-2, SHA-256, SHA-512SHA-2ï¼Œå³ Secure Hash Algorithm 2ï¼Œæ˜¯ä¸€ç»„å¼ºå¯†ç å“ˆå¸Œå‡½æ•°ï¼Œå…¶ç‰ˆæœ¬åŒ…æ‹¬ï¼šSHA-256ï¼ˆ256ä½å“ˆå¸Œï¼‰ã€SHA-384ï¼ˆ384ä½å“ˆå¸Œï¼‰ã€SHA-512ï¼ˆ512ä½å“ˆå¸Œï¼‰ç­‰ã€‚åŸºäºå¯†ç æ¦‚å¿µã€ŒMerkleâ€“DamgÃ¥rd æ„é€ ã€ï¼Œç›®å‰è¢«è®¤ä¸ºé«˜åº¦å®‰å…¨ã€‚ SHA-2 æ˜¯ SHA-1 çš„ç»§ä»»è€…ï¼Œäº 2001 å¹´åœ¨ç¾å›½ä½œä¸ºå®˜æ–¹åŠ å¯†æ ‡å‡†å‘å¸ƒã€‚ SHA-2 åœ¨è½¯ä»¶å¼€å‘å’Œå¯†ç å­¦ä¸­è¢«å¹¿æ³›ä½¿ç”¨ï¼Œå¯ç”¨äºç°ä»£å•†ä¸šåº”ç”¨ã€‚å…¶ä¸­ SHA-256 è¢«å¹¿æ³›ç”¨äº HTTPS åè®®ã€æ–‡ä»¶å®Œæ•´æ€§æ ¡éªŒã€æ¯”ç‰¹å¸åŒºå—é“¾ç­‰å„ç§åœºæ™¯ã€‚ Python ä»£ç ç¤ºä¾‹ï¼š python import hashlib, binascii text = 'hello' data = text.encode(\"utf8\") sha256hash = hashlib.sha256(data).digest() print(f\"SHA-256({text}) = \", binascii.hexlify(sha256hash).decode(\"utf8\")) sha384hash = hashlib.sha384(data).digest() print(f\"SHA-384({text}) = \", binascii.hexlify(sha384hash).decode(\"utf8\")) sha512hash = hashlib.sha512(data).digest() print(f\"SHA-512({text}) = \", binascii.hexlify(sha512hash).decode(\"utf8\")) è¾“å‡ºå¦‚ä¸‹ï¼š text SHA-256('hello') = 2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824 SHA-384('hello') = 59e1748777448c69de6b800d7a33bbfb9ff1b463e44354c3553bcdb9c666fa90125a3c79f90397bdf5f6a13de828684f SHA-512('hello') = 9b71d224bd62f3785d96d46ad3ea3d73319bfbc2890caadae2dff72519673ca72323c3d99ba5c11d7c7acc6e14b8c5da0c4663475c2e5c3adef46f73bcdec043 2. æ›´é•¿çš„å“ˆå¸Œå€¼ == æ›´é«˜çš„æŠ—ç¢°æ’èƒ½åŠ›æŒ‰ç…§è®¾è®¡ï¼Œå“ˆå¸Œå‡½æ•°çš„è¾“å‡ºè¶Šé•¿ï¼Œå°±æœ‰æœ›å®ç°æ›´é«˜çš„å®‰å…¨æ€§å’ŒæŠ—ç¢°æ’èƒ½åŠ›ï¼ˆä½†ä¹Ÿæœ‰ä¸€äº›ä¾‹å¤–ï¼‰ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œ128 ä½å“ˆå¸Œç®—æ³•æ¯” 256 ä½å“ˆå¸Œç®—æ³•å¼±ï¼Œ256 ä½å“ˆå¸Œç®—æ³•æ¯” 512 ä½å“ˆå¸Œç®—æ³•å¼±ã€‚ å› æ­¤æ˜¾ç„¶ SHA-512 æ¯” SHA-256 æ›´å¼ºã€‚æˆ‘ä»¬å¯ä»¥é¢„æœŸï¼ŒSHA-512 çš„ç¢°æ’æ¦‚ç‡è¦æ¯” SHA-256 æ›´ä½ã€‚ 3. SHA-3, SHA3-256, SHA3-512, Keccak-256åœ¨è¾“å‡ºçš„å“ˆå¸Œé•¿åº¦ç›¸åŒæ—¶ï¼ŒSHA-3ï¼ˆåŠå…¶å˜ä½“ SHA3-224ã€SHA3-256ã€SHA3-384ã€SHA3-512ï¼‰è¢«è®¤ä¸ºæ‹¥æœ‰æ¯” SHA-2ï¼ˆSHA-224ã€SHA-256ã€SHA-384ã€SHA-512ï¼‰æ›´é«˜çš„åŠ å¯†å¼ºåº¦ã€‚ä¾‹å¦‚ï¼Œå¯¹äºç›¸åŒçš„å“ˆå¸Œé•¿åº¦ï¼ˆ256 ä½ï¼‰ï¼ŒSHA3-256 æä¾›æ¯” SHA-256 æ›´é«˜çš„åŠ å¯†å¼ºåº¦ã€‚ SHA-3 ç³»åˆ—å‡½æ•°æ˜¯ Keccak å“ˆå¸Œå®¶æ—çš„ä»£è¡¨ï¼Œå®ƒåŸºäºå¯†ç å­¦æ¦‚å¿µæµ·ç»µå‡½æ•°ã€‚è€ŒKeccak æ˜¯SHA3 NIST æ¯”èµ›çš„å† å†›ã€‚ ä¸ SHA-2 ä¸åŒï¼ŒSHA-3 ç³»åˆ—åŠ å¯†å“ˆå¸Œå‡½æ•°ä¸æ˜“å—åˆ°é•¿åº¦æ‹“å±•æ”»å‡» Length extension attack. SHA-3 è¢«è®¤ä¸ºæ˜¯é«˜åº¦å®‰å…¨çš„ï¼Œå¹¶äº 2015 å¹´ä½œä¸ºç¾å›½å®˜æ–¹æ¨èçš„åŠ å¯†æ ‡å‡†å‘å¸ƒã€‚ ä»¥å¤ªåŠï¼ˆEthereumï¼‰åŒºå—é“¾ä¸­ä½¿ç”¨çš„å“ˆå¸Œå‡½æ•° Keccak-256 æ˜¯ SHA3-256 çš„å˜ä½“ï¼Œåœ¨ä»£ç ä¸­æ›´æ”¹äº†ä¸€äº›å¸¸é‡ã€‚ å“ˆå¸Œå‡½æ•° SHAKE128(msg, length) å’Œ SHAKE256(msg, length) æ˜¯ SHA3-256 å’Œ SHA3-512 ç®—æ³•çš„å˜ä½“ï¼Œå®ƒä»¬è¾“å‡ºæ¶ˆæ¯çš„é•¿åº¦å¯ä»¥å˜åŒ–ã€‚ SHA3 çš„ Python ä»£ç ç¤ºä¾‹ï¼š python import hashlib, binascii text = 'hello' data = text.encode(\"utf8\") sha3_256hash = hashlib.sha3_256(data).digest() print(f\"SHA3-256('{text}') = \", binascii.hexlify(sha3_256hash).decode(\"utf8\")) sha3_512hash = hashlib.sha3_512(data).digest() print(f\"SHA3-512('{text}') = \", binascii.hexlify(sha3_512hash).decode(\"utf8\")) # SHAKE-128 with 256-bit output shake128_hash = hashlib.shake_128(data).digest(32) # 32 bytes = 256 bits print(f\"SHAKE-128('{text}', 256) = \", binascii.hexlify(shake128_hash).decode(\"utf8\")) # SHAKE-256 with 160-bit output shake256_hash = hashlib.shake_256(data).digest(20) # 20 bytes = 160 bits print(f\"SHAKE-256('{text}', 160) = \", binascii.hexlify(shake256_hash).decode(\"utf8\")) è¾“å‡ºï¼š text SHA3-256('hello') = 3338be694f50c5f338814986cdf0686453a888b84f424d792af4b9202398f392 SHA3-512('hello') = 75d527c368f2efe848ecf6b073a36767800805e9eef2b1857d5f984f036eb6df891d75f72d9b154518c1cd58835286d1da9a38deba3de98b5a53e5ed78a84976 SHAKE-128('hello', 256) = 8eb4b6a932f280335ee1a279f8c208a349e7bc65daf831d3021c213825292463 SHAKE-256('hello', 160) = 1234075ae4a1e77316cf2d8000974581a343b9eb 4. BLAKE2 / BLAKE2s / BLAKE2bBLAKE / BLAKE2 / BLAKE2s / BLAKE2b æ˜¯ä¸€ç³»åˆ—å¿«é€Ÿã€é«˜åº¦å®‰å…¨çš„å¯†ç å­¦å“ˆå¸Œå‡½æ•°ï¼Œæä¾› 160 ä½ã€224 ä½ã€256 ä½ã€384 ä½å’Œ 512 ä½æ‘˜è¦å¤§å°çš„è®¡ç®—ï¼Œåœ¨ç°ä»£å¯†ç å­¦ä¸­è¢«å¹¿æ³›åº”ç”¨ã€‚BLAKE è¿›å…¥äº†SHA3 NIST æ¯”èµ›çš„å†³èµ›ã€‚ BLAKE2 å‡½æ•°æ˜¯ BLAKE çš„æ”¹è¿›ç‰ˆæœ¬ã€‚ BLAKE2sï¼ˆé€šå¸¸ä¸º 256 ä½ï¼‰æ˜¯ BLAKE2 å®ç°ï¼Œé’ˆå¯¹ 32 ä½å¾®å¤„ç†å™¨è¿›è¡Œäº†æ€§èƒ½ä¼˜åŒ–ã€‚ BLAKE2bï¼ˆé€šå¸¸ä¸º 512 ä½ï¼‰æ˜¯ BLAKE2 å®ç°ï¼Œé’ˆå¯¹ 64 ä½å¾®å¤„ç†å™¨è¿›è¡Œäº†æ€§èƒ½ä¼˜åŒ–ã€‚ BLAKE2 å“ˆå¸Œå‡½æ•°å…·æœ‰ä¸ SHA-3 ç±»ä¼¼çš„å®‰å…¨å¼ºåº¦ï¼Œä½†å¼€å‘äººå‘˜ç›®å‰ä»ç„¶æ›´å€¾å‘äºä½¿ç”¨ SHA2 å’Œ SHA3ã€‚ BLAKE å“ˆå¸Œå€¼çš„ Python ç¤ºä¾‹ï¼š python import hashlib, binascii text = 'hello' data = text.encode(\"utf8\") blake2s = hashlib.new('blake2s', data).digest() print(\"BLAKE2s({text}) = \", binascii.hexlify(blake2s).decode(\"utf-8\")) blake2b = hashlib.new('blake2b', data).digest() print(\"BLAKE2b({text}) = \", binascii.hexlify(blake2b).decode(\"utf-8\")) è¾“å‡ºå¦‚ä¸‹ï¼š text BLAKE2s('hello') = 19213bacc58dee6dbde3ceb9a47cbb330b3d86f8cca8997eb00be456f140ca25 BLAKE2b('hello') = e4cfa39a3d37be31c59609e807970799caa68a19bfaa15135f165085e01d41a65ba1e1b146aeb6bd0092b49eac214c103ccfa3a365954bbbe52f74a2b3620c94 5. RIPEMD-160RIPEMD-160, RIPE Message Digest æ˜¯ä¸€ç§å®‰å…¨å“ˆå¸Œå‡½æ•°ï¼Œå‘å¸ƒäº 1996 å¹´ï¼Œç›®å‰ä¸»è¦è¢«åº”ç”¨åœ¨ PGP å’Œæ¯”ç‰¹å¸ä¸­ã€‚ RIPEMD çš„ 160 ä½å˜ä½“åœ¨å®è·µä¸­è¢«å¹¿æ³›ä½¿ç”¨ï¼Œè€Œ RIPEMD-128ã€RIPEMD-256 å’Œ RIPEMD-320 ç­‰å…¶ä»–å˜ä½“å¹¶","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-2-hash/:2:3","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","å¯†ç å­¦","å“ˆå¸Œ","æ•£åˆ—","å®‰å…¨","SHA-2","SHA-3"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆäºŒï¼‰â€”â€” å“ˆå¸Œå‡½æ•°","uri":"/posts/practical-cryptography-basics-2-hash/#4-blake2--blake2s--blake2b"},{"categories":["tech"],"content":" å®‰å…¨çš„åŠ å¯†å“ˆå¸Œç®—æ³• 1. SHA-2, SHA-256, SHA-512SHA-2ï¼Œå³ Secure Hash Algorithm 2ï¼Œæ˜¯ä¸€ç»„å¼ºå¯†ç å“ˆå¸Œå‡½æ•°ï¼Œå…¶ç‰ˆæœ¬åŒ…æ‹¬ï¼šSHA-256ï¼ˆ256ä½å“ˆå¸Œï¼‰ã€SHA-384ï¼ˆ384ä½å“ˆå¸Œï¼‰ã€SHA-512ï¼ˆ512ä½å“ˆå¸Œï¼‰ç­‰ã€‚åŸºäºå¯†ç æ¦‚å¿µã€ŒMerkleâ€“DamgÃ¥rd æ„é€ ã€ï¼Œç›®å‰è¢«è®¤ä¸ºé«˜åº¦å®‰å…¨ã€‚ SHA-2 æ˜¯ SHA-1 çš„ç»§ä»»è€…ï¼Œäº 2001 å¹´åœ¨ç¾å›½ä½œä¸ºå®˜æ–¹åŠ å¯†æ ‡å‡†å‘å¸ƒã€‚ SHA-2 åœ¨è½¯ä»¶å¼€å‘å’Œå¯†ç å­¦ä¸­è¢«å¹¿æ³›ä½¿ç”¨ï¼Œå¯ç”¨äºç°ä»£å•†ä¸šåº”ç”¨ã€‚å…¶ä¸­ SHA-256 è¢«å¹¿æ³›ç”¨äº HTTPS åè®®ã€æ–‡ä»¶å®Œæ•´æ€§æ ¡éªŒã€æ¯”ç‰¹å¸åŒºå—é“¾ç­‰å„ç§åœºæ™¯ã€‚ Python ä»£ç ç¤ºä¾‹ï¼š python import hashlib, binascii text = 'hello' data = text.encode(\"utf8\") sha256hash = hashlib.sha256(data).digest() print(f\"SHA-256({text}) = \", binascii.hexlify(sha256hash).decode(\"utf8\")) sha384hash = hashlib.sha384(data).digest() print(f\"SHA-384({text}) = \", binascii.hexlify(sha384hash).decode(\"utf8\")) sha512hash = hashlib.sha512(data).digest() print(f\"SHA-512({text}) = \", binascii.hexlify(sha512hash).decode(\"utf8\")) è¾“å‡ºå¦‚ä¸‹ï¼š text SHA-256('hello') = 2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824 SHA-384('hello') = 59e1748777448c69de6b800d7a33bbfb9ff1b463e44354c3553bcdb9c666fa90125a3c79f90397bdf5f6a13de828684f SHA-512('hello') = 9b71d224bd62f3785d96d46ad3ea3d73319bfbc2890caadae2dff72519673ca72323c3d99ba5c11d7c7acc6e14b8c5da0c4663475c2e5c3adef46f73bcdec043 2. æ›´é•¿çš„å“ˆå¸Œå€¼ == æ›´é«˜çš„æŠ—ç¢°æ’èƒ½åŠ›æŒ‰ç…§è®¾è®¡ï¼Œå“ˆå¸Œå‡½æ•°çš„è¾“å‡ºè¶Šé•¿ï¼Œå°±æœ‰æœ›å®ç°æ›´é«˜çš„å®‰å…¨æ€§å’ŒæŠ—ç¢°æ’èƒ½åŠ›ï¼ˆä½†ä¹Ÿæœ‰ä¸€äº›ä¾‹å¤–ï¼‰ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œ128 ä½å“ˆå¸Œç®—æ³•æ¯” 256 ä½å“ˆå¸Œç®—æ³•å¼±ï¼Œ256 ä½å“ˆå¸Œç®—æ³•æ¯” 512 ä½å“ˆå¸Œç®—æ³•å¼±ã€‚ å› æ­¤æ˜¾ç„¶ SHA-512 æ¯” SHA-256 æ›´å¼ºã€‚æˆ‘ä»¬å¯ä»¥é¢„æœŸï¼ŒSHA-512 çš„ç¢°æ’æ¦‚ç‡è¦æ¯” SHA-256 æ›´ä½ã€‚ 3. SHA-3, SHA3-256, SHA3-512, Keccak-256åœ¨è¾“å‡ºçš„å“ˆå¸Œé•¿åº¦ç›¸åŒæ—¶ï¼ŒSHA-3ï¼ˆåŠå…¶å˜ä½“ SHA3-224ã€SHA3-256ã€SHA3-384ã€SHA3-512ï¼‰è¢«è®¤ä¸ºæ‹¥æœ‰æ¯” SHA-2ï¼ˆSHA-224ã€SHA-256ã€SHA-384ã€SHA-512ï¼‰æ›´é«˜çš„åŠ å¯†å¼ºåº¦ã€‚ä¾‹å¦‚ï¼Œå¯¹äºç›¸åŒçš„å“ˆå¸Œé•¿åº¦ï¼ˆ256 ä½ï¼‰ï¼ŒSHA3-256 æä¾›æ¯” SHA-256 æ›´é«˜çš„åŠ å¯†å¼ºåº¦ã€‚ SHA-3 ç³»åˆ—å‡½æ•°æ˜¯ Keccak å“ˆå¸Œå®¶æ—çš„ä»£è¡¨ï¼Œå®ƒåŸºäºå¯†ç å­¦æ¦‚å¿µæµ·ç»µå‡½æ•°ã€‚è€ŒKeccak æ˜¯SHA3 NIST æ¯”èµ›çš„å† å†›ã€‚ ä¸ SHA-2 ä¸åŒï¼ŒSHA-3 ç³»åˆ—åŠ å¯†å“ˆå¸Œå‡½æ•°ä¸æ˜“å—åˆ°é•¿åº¦æ‹“å±•æ”»å‡» Length extension attack. SHA-3 è¢«è®¤ä¸ºæ˜¯é«˜åº¦å®‰å…¨çš„ï¼Œå¹¶äº 2015 å¹´ä½œä¸ºç¾å›½å®˜æ–¹æ¨èçš„åŠ å¯†æ ‡å‡†å‘å¸ƒã€‚ ä»¥å¤ªåŠï¼ˆEthereumï¼‰åŒºå—é“¾ä¸­ä½¿ç”¨çš„å“ˆå¸Œå‡½æ•° Keccak-256 æ˜¯ SHA3-256 çš„å˜ä½“ï¼Œåœ¨ä»£ç ä¸­æ›´æ”¹äº†ä¸€äº›å¸¸é‡ã€‚ å“ˆå¸Œå‡½æ•° SHAKE128(msg, length) å’Œ SHAKE256(msg, length) æ˜¯ SHA3-256 å’Œ SHA3-512 ç®—æ³•çš„å˜ä½“ï¼Œå®ƒä»¬è¾“å‡ºæ¶ˆæ¯çš„é•¿åº¦å¯ä»¥å˜åŒ–ã€‚ SHA3 çš„ Python ä»£ç ç¤ºä¾‹ï¼š python import hashlib, binascii text = 'hello' data = text.encode(\"utf8\") sha3_256hash = hashlib.sha3_256(data).digest() print(f\"SHA3-256('{text}') = \", binascii.hexlify(sha3_256hash).decode(\"utf8\")) sha3_512hash = hashlib.sha3_512(data).digest() print(f\"SHA3-512('{text}') = \", binascii.hexlify(sha3_512hash).decode(\"utf8\")) # SHAKE-128 with 256-bit output shake128_hash = hashlib.shake_128(data).digest(32) # 32 bytes = 256 bits print(f\"SHAKE-128('{text}', 256) = \", binascii.hexlify(shake128_hash).decode(\"utf8\")) # SHAKE-256 with 160-bit output shake256_hash = hashlib.shake_256(data).digest(20) # 20 bytes = 160 bits print(f\"SHAKE-256('{text}', 160) = \", binascii.hexlify(shake256_hash).decode(\"utf8\")) è¾“å‡ºï¼š text SHA3-256('hello') = 3338be694f50c5f338814986cdf0686453a888b84f424d792af4b9202398f392 SHA3-512('hello') = 75d527c368f2efe848ecf6b073a36767800805e9eef2b1857d5f984f036eb6df891d75f72d9b154518c1cd58835286d1da9a38deba3de98b5a53e5ed78a84976 SHAKE-128('hello', 256) = 8eb4b6a932f280335ee1a279f8c208a349e7bc65daf831d3021c213825292463 SHAKE-256('hello', 160) = 1234075ae4a1e77316cf2d8000974581a343b9eb 4. BLAKE2 / BLAKE2s / BLAKE2bBLAKE / BLAKE2 / BLAKE2s / BLAKE2b æ˜¯ä¸€ç³»åˆ—å¿«é€Ÿã€é«˜åº¦å®‰å…¨çš„å¯†ç å­¦å“ˆå¸Œå‡½æ•°ï¼Œæä¾› 160 ä½ã€224 ä½ã€256 ä½ã€384 ä½å’Œ 512 ä½æ‘˜è¦å¤§å°çš„è®¡ç®—ï¼Œåœ¨ç°ä»£å¯†ç å­¦ä¸­è¢«å¹¿æ³›åº”ç”¨ã€‚BLAKE è¿›å…¥äº†SHA3 NIST æ¯”èµ›çš„å†³èµ›ã€‚ BLAKE2 å‡½æ•°æ˜¯ BLAKE çš„æ”¹è¿›ç‰ˆæœ¬ã€‚ BLAKE2sï¼ˆé€šå¸¸ä¸º 256 ä½ï¼‰æ˜¯ BLAKE2 å®ç°ï¼Œé’ˆå¯¹ 32 ä½å¾®å¤„ç†å™¨è¿›è¡Œäº†æ€§èƒ½ä¼˜åŒ–ã€‚ BLAKE2bï¼ˆé€šå¸¸ä¸º 512 ä½ï¼‰æ˜¯ BLAKE2 å®ç°ï¼Œé’ˆå¯¹ 64 ä½å¾®å¤„ç†å™¨è¿›è¡Œäº†æ€§èƒ½ä¼˜åŒ–ã€‚ BLAKE2 å“ˆå¸Œå‡½æ•°å…·æœ‰ä¸ SHA-3 ç±»ä¼¼çš„å®‰å…¨å¼ºåº¦ï¼Œä½†å¼€å‘äººå‘˜ç›®å‰ä»ç„¶æ›´å€¾å‘äºä½¿ç”¨ SHA2 å’Œ SHA3ã€‚ BLAKE å“ˆå¸Œå€¼çš„ Python ç¤ºä¾‹ï¼š python import hashlib, binascii text = 'hello' data = text.encode(\"utf8\") blake2s = hashlib.new('blake2s', data).digest() print(\"BLAKE2s({text}) = \", binascii.hexlify(blake2s).decode(\"utf-8\")) blake2b = hashlib.new('blake2b', data).digest() print(\"BLAKE2b({text}) = \", binascii.hexlify(blake2b).decode(\"utf-8\")) è¾“å‡ºå¦‚ä¸‹ï¼š text BLAKE2s('hello') = 19213bacc58dee6dbde3ceb9a47cbb330b3d86f8cca8997eb00be456f140ca25 BLAKE2b('hello') = e4cfa39a3d37be31c59609e807970799caa68a19bfaa15135f165085e01d41a65ba1e1b146aeb6bd0092b49eac214c103ccfa3a365954bbbe52f74a2b3620c94 5. RIPEMD-160RIPEMD-160, RIPE Message Digest æ˜¯ä¸€ç§å®‰å…¨å“ˆå¸Œå‡½æ•°ï¼Œå‘å¸ƒäº 1996 å¹´ï¼Œç›®å‰ä¸»è¦è¢«åº”ç”¨åœ¨ PGP å’Œæ¯”ç‰¹å¸ä¸­ã€‚ RIPEMD çš„ 160 ä½å˜ä½“åœ¨å®è·µä¸­è¢«å¹¿æ³›ä½¿ç”¨ï¼Œè€Œ RIPEMD-128ã€RIPEMD-256 å’Œ RIPEMD-320 ç­‰å…¶ä»–å˜ä½“å¹¶","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-2-hash/:2:3","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","å¯†ç å­¦","å“ˆå¸Œ","æ•£åˆ—","å®‰å…¨","SHA-2","SHA-3"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆäºŒï¼‰â€”â€” å“ˆå¸Œå‡½æ•°","uri":"/posts/practical-cryptography-basics-2-hash/#5-ripemd-160"},{"categories":["tech"],"content":" å®‰å…¨çš„åŠ å¯†å“ˆå¸Œç®—æ³• 1. SHA-2, SHA-256, SHA-512SHA-2ï¼Œå³ Secure Hash Algorithm 2ï¼Œæ˜¯ä¸€ç»„å¼ºå¯†ç å“ˆå¸Œå‡½æ•°ï¼Œå…¶ç‰ˆæœ¬åŒ…æ‹¬ï¼šSHA-256ï¼ˆ256ä½å“ˆå¸Œï¼‰ã€SHA-384ï¼ˆ384ä½å“ˆå¸Œï¼‰ã€SHA-512ï¼ˆ512ä½å“ˆå¸Œï¼‰ç­‰ã€‚åŸºäºå¯†ç æ¦‚å¿µã€ŒMerkleâ€“DamgÃ¥rd æ„é€ ã€ï¼Œç›®å‰è¢«è®¤ä¸ºé«˜åº¦å®‰å…¨ã€‚ SHA-2 æ˜¯ SHA-1 çš„ç»§ä»»è€…ï¼Œäº 2001 å¹´åœ¨ç¾å›½ä½œä¸ºå®˜æ–¹åŠ å¯†æ ‡å‡†å‘å¸ƒã€‚ SHA-2 åœ¨è½¯ä»¶å¼€å‘å’Œå¯†ç å­¦ä¸­è¢«å¹¿æ³›ä½¿ç”¨ï¼Œå¯ç”¨äºç°ä»£å•†ä¸šåº”ç”¨ã€‚å…¶ä¸­ SHA-256 è¢«å¹¿æ³›ç”¨äº HTTPS åè®®ã€æ–‡ä»¶å®Œæ•´æ€§æ ¡éªŒã€æ¯”ç‰¹å¸åŒºå—é“¾ç­‰å„ç§åœºæ™¯ã€‚ Python ä»£ç ç¤ºä¾‹ï¼š python import hashlib, binascii text = 'hello' data = text.encode(\"utf8\") sha256hash = hashlib.sha256(data).digest() print(f\"SHA-256({text}) = \", binascii.hexlify(sha256hash).decode(\"utf8\")) sha384hash = hashlib.sha384(data).digest() print(f\"SHA-384({text}) = \", binascii.hexlify(sha384hash).decode(\"utf8\")) sha512hash = hashlib.sha512(data).digest() print(f\"SHA-512({text}) = \", binascii.hexlify(sha512hash).decode(\"utf8\")) è¾“å‡ºå¦‚ä¸‹ï¼š text SHA-256('hello') = 2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824 SHA-384('hello') = 59e1748777448c69de6b800d7a33bbfb9ff1b463e44354c3553bcdb9c666fa90125a3c79f90397bdf5f6a13de828684f SHA-512('hello') = 9b71d224bd62f3785d96d46ad3ea3d73319bfbc2890caadae2dff72519673ca72323c3d99ba5c11d7c7acc6e14b8c5da0c4663475c2e5c3adef46f73bcdec043 2. æ›´é•¿çš„å“ˆå¸Œå€¼ == æ›´é«˜çš„æŠ—ç¢°æ’èƒ½åŠ›æŒ‰ç…§è®¾è®¡ï¼Œå“ˆå¸Œå‡½æ•°çš„è¾“å‡ºè¶Šé•¿ï¼Œå°±æœ‰æœ›å®ç°æ›´é«˜çš„å®‰å…¨æ€§å’ŒæŠ—ç¢°æ’èƒ½åŠ›ï¼ˆä½†ä¹Ÿæœ‰ä¸€äº›ä¾‹å¤–ï¼‰ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œ128 ä½å“ˆå¸Œç®—æ³•æ¯” 256 ä½å“ˆå¸Œç®—æ³•å¼±ï¼Œ256 ä½å“ˆå¸Œç®—æ³•æ¯” 512 ä½å“ˆå¸Œç®—æ³•å¼±ã€‚ å› æ­¤æ˜¾ç„¶ SHA-512 æ¯” SHA-256 æ›´å¼ºã€‚æˆ‘ä»¬å¯ä»¥é¢„æœŸï¼ŒSHA-512 çš„ç¢°æ’æ¦‚ç‡è¦æ¯” SHA-256 æ›´ä½ã€‚ 3. SHA-3, SHA3-256, SHA3-512, Keccak-256åœ¨è¾“å‡ºçš„å“ˆå¸Œé•¿åº¦ç›¸åŒæ—¶ï¼ŒSHA-3ï¼ˆåŠå…¶å˜ä½“ SHA3-224ã€SHA3-256ã€SHA3-384ã€SHA3-512ï¼‰è¢«è®¤ä¸ºæ‹¥æœ‰æ¯” SHA-2ï¼ˆSHA-224ã€SHA-256ã€SHA-384ã€SHA-512ï¼‰æ›´é«˜çš„åŠ å¯†å¼ºåº¦ã€‚ä¾‹å¦‚ï¼Œå¯¹äºç›¸åŒçš„å“ˆå¸Œé•¿åº¦ï¼ˆ256 ä½ï¼‰ï¼ŒSHA3-256 æä¾›æ¯” SHA-256 æ›´é«˜çš„åŠ å¯†å¼ºåº¦ã€‚ SHA-3 ç³»åˆ—å‡½æ•°æ˜¯ Keccak å“ˆå¸Œå®¶æ—çš„ä»£è¡¨ï¼Œå®ƒåŸºäºå¯†ç å­¦æ¦‚å¿µæµ·ç»µå‡½æ•°ã€‚è€ŒKeccak æ˜¯SHA3 NIST æ¯”èµ›çš„å† å†›ã€‚ ä¸ SHA-2 ä¸åŒï¼ŒSHA-3 ç³»åˆ—åŠ å¯†å“ˆå¸Œå‡½æ•°ä¸æ˜“å—åˆ°é•¿åº¦æ‹“å±•æ”»å‡» Length extension attack. SHA-3 è¢«è®¤ä¸ºæ˜¯é«˜åº¦å®‰å…¨çš„ï¼Œå¹¶äº 2015 å¹´ä½œä¸ºç¾å›½å®˜æ–¹æ¨èçš„åŠ å¯†æ ‡å‡†å‘å¸ƒã€‚ ä»¥å¤ªåŠï¼ˆEthereumï¼‰åŒºå—é“¾ä¸­ä½¿ç”¨çš„å“ˆå¸Œå‡½æ•° Keccak-256 æ˜¯ SHA3-256 çš„å˜ä½“ï¼Œåœ¨ä»£ç ä¸­æ›´æ”¹äº†ä¸€äº›å¸¸é‡ã€‚ å“ˆå¸Œå‡½æ•° SHAKE128(msg, length) å’Œ SHAKE256(msg, length) æ˜¯ SHA3-256 å’Œ SHA3-512 ç®—æ³•çš„å˜ä½“ï¼Œå®ƒä»¬è¾“å‡ºæ¶ˆæ¯çš„é•¿åº¦å¯ä»¥å˜åŒ–ã€‚ SHA3 çš„ Python ä»£ç ç¤ºä¾‹ï¼š python import hashlib, binascii text = 'hello' data = text.encode(\"utf8\") sha3_256hash = hashlib.sha3_256(data).digest() print(f\"SHA3-256('{text}') = \", binascii.hexlify(sha3_256hash).decode(\"utf8\")) sha3_512hash = hashlib.sha3_512(data).digest() print(f\"SHA3-512('{text}') = \", binascii.hexlify(sha3_512hash).decode(\"utf8\")) # SHAKE-128 with 256-bit output shake128_hash = hashlib.shake_128(data).digest(32) # 32 bytes = 256 bits print(f\"SHAKE-128('{text}', 256) = \", binascii.hexlify(shake128_hash).decode(\"utf8\")) # SHAKE-256 with 160-bit output shake256_hash = hashlib.shake_256(data).digest(20) # 20 bytes = 160 bits print(f\"SHAKE-256('{text}', 160) = \", binascii.hexlify(shake256_hash).decode(\"utf8\")) è¾“å‡ºï¼š text SHA3-256('hello') = 3338be694f50c5f338814986cdf0686453a888b84f424d792af4b9202398f392 SHA3-512('hello') = 75d527c368f2efe848ecf6b073a36767800805e9eef2b1857d5f984f036eb6df891d75f72d9b154518c1cd58835286d1da9a38deba3de98b5a53e5ed78a84976 SHAKE-128('hello', 256) = 8eb4b6a932f280335ee1a279f8c208a349e7bc65daf831d3021c213825292463 SHAKE-256('hello', 160) = 1234075ae4a1e77316cf2d8000974581a343b9eb 4. BLAKE2 / BLAKE2s / BLAKE2bBLAKE / BLAKE2 / BLAKE2s / BLAKE2b æ˜¯ä¸€ç³»åˆ—å¿«é€Ÿã€é«˜åº¦å®‰å…¨çš„å¯†ç å­¦å“ˆå¸Œå‡½æ•°ï¼Œæä¾› 160 ä½ã€224 ä½ã€256 ä½ã€384 ä½å’Œ 512 ä½æ‘˜è¦å¤§å°çš„è®¡ç®—ï¼Œåœ¨ç°ä»£å¯†ç å­¦ä¸­è¢«å¹¿æ³›åº”ç”¨ã€‚BLAKE è¿›å…¥äº†SHA3 NIST æ¯”èµ›çš„å†³èµ›ã€‚ BLAKE2 å‡½æ•°æ˜¯ BLAKE çš„æ”¹è¿›ç‰ˆæœ¬ã€‚ BLAKE2sï¼ˆé€šå¸¸ä¸º 256 ä½ï¼‰æ˜¯ BLAKE2 å®ç°ï¼Œé’ˆå¯¹ 32 ä½å¾®å¤„ç†å™¨è¿›è¡Œäº†æ€§èƒ½ä¼˜åŒ–ã€‚ BLAKE2bï¼ˆé€šå¸¸ä¸º 512 ä½ï¼‰æ˜¯ BLAKE2 å®ç°ï¼Œé’ˆå¯¹ 64 ä½å¾®å¤„ç†å™¨è¿›è¡Œäº†æ€§èƒ½ä¼˜åŒ–ã€‚ BLAKE2 å“ˆå¸Œå‡½æ•°å…·æœ‰ä¸ SHA-3 ç±»ä¼¼çš„å®‰å…¨å¼ºåº¦ï¼Œä½†å¼€å‘äººå‘˜ç›®å‰ä»ç„¶æ›´å€¾å‘äºä½¿ç”¨ SHA2 å’Œ SHA3ã€‚ BLAKE å“ˆå¸Œå€¼çš„ Python ç¤ºä¾‹ï¼š python import hashlib, binascii text = 'hello' data = text.encode(\"utf8\") blake2s = hashlib.new('blake2s', data).digest() print(\"BLAKE2s({text}) = \", binascii.hexlify(blake2s).decode(\"utf-8\")) blake2b = hashlib.new('blake2b', data).digest() print(\"BLAKE2b({text}) = \", binascii.hexlify(blake2b).decode(\"utf-8\")) è¾“å‡ºå¦‚ä¸‹ï¼š text BLAKE2s('hello') = 19213bacc58dee6dbde3ceb9a47cbb330b3d86f8cca8997eb00be456f140ca25 BLAKE2b('hello') = e4cfa39a3d37be31c59609e807970799caa68a19bfaa15135f165085e01d41a65ba1e1b146aeb6bd0092b49eac214c103ccfa3a365954bbbe52f74a2b3620c94 5. RIPEMD-160RIPEMD-160, RIPE Message Digest æ˜¯ä¸€ç§å®‰å…¨å“ˆå¸Œå‡½æ•°ï¼Œå‘å¸ƒäº 1996 å¹´ï¼Œç›®å‰ä¸»è¦è¢«åº”ç”¨åœ¨ PGP å’Œæ¯”ç‰¹å¸ä¸­ã€‚ RIPEMD çš„ 160 ä½å˜ä½“åœ¨å®è·µä¸­è¢«å¹¿æ³›ä½¿ç”¨ï¼Œè€Œ RIPEMD-128ã€RIPEMD-256 å’Œ RIPEMD-320 ç­‰å…¶ä»–å˜ä½“å¹¶","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-2-hash/:2:3","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","å¯†ç å­¦","å“ˆå¸Œ","æ•£åˆ—","å®‰å…¨","SHA-2","SHA-3"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆäºŒï¼‰â€”â€” å“ˆå¸Œå‡½æ•°","uri":"/posts/practical-cryptography-basics-2-hash/#6-å…¶ä»–å®‰å…¨å“ˆå¸Œç®—æ³•"},{"categories":["tech"],"content":" ä¸å®‰å…¨çš„åŠ å¯†å“ˆå¸Œç®—æ³•ä¸€äº›è€ä¸€ä»£çš„åŠ å¯†å“ˆå¸Œç®—æ³•ï¼Œå¦‚ MD5, SHA-0 å’Œ SHA-1 è¢«è®¤ä¸ºæ˜¯ä¸å®‰å…¨çš„ï¼Œå¹¶ä¸”éƒ½å­˜åœ¨å·²è¢«å‘ç°çš„åŠ å¯†æ¼æ´ï¼ˆç¢°æ’ï¼‰ã€‚ä¸è¦ä½¿ç”¨ MD5ã€SHA-0 å’Œ SHA-1ï¼è¿™äº›å“ˆå¸Œå‡½æ•°éƒ½å·²è¢«è¯æ˜ä¸å¤Ÿå®‰å…¨ã€‚ ä½¿ç”¨è¿™äº›ä¸å®‰å…¨çš„å“ˆå¸Œç®—æ³•ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°å­—ç­¾åè¢«ä¼ªé€ ã€å¯†ç æ³„æ¼ç­‰ä¸¥é‡é—®é¢˜ï¼ å¦å¤–ä¹Ÿè¯·é¿å…ä½¿ç”¨ä»¥ä¸‹è¢«è®¤ä¸ºä¸å®‰å…¨æˆ–å®‰å…¨æ€§æœ‰äº‰è®®çš„å“ˆå¸Œç®—æ³•ï¼š MD2, MD4, MD5, SHA-0, SHA-1, Panama, HAVALï¼ˆæœ‰äº‰è®®çš„å®‰å…¨æ€§ï¼Œåœ¨ HAVAL-128 ä¸Šå‘ç°äº†ç¢°æ’ï¼‰ï¼ŒTigerï¼ˆæœ‰äº‰è®®ï¼Œå·²å‘ç°å…¶å¼±ç‚¹ï¼‰ï¼ŒSipHashï¼ˆå®ƒå±äºéåŠ å¯†å“ˆå¸Œå‡½æ•°ï¼‰ã€‚ ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-2-hash/:2:4","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","å¯†ç å­¦","å“ˆå¸Œ","æ•£åˆ—","å®‰å…¨","SHA-2","SHA-3"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆäºŒï¼‰â€”â€” å“ˆå¸Œå‡½æ•°","uri":"/posts/practical-cryptography-basics-2-hash/#ä¸å®‰å…¨çš„åŠ å¯†å“ˆå¸Œç®—æ³•"},{"categories":["tech"],"content":" PoW å·¥ä½œé‡è¯æ˜å“ˆå¸Œå‡½æ•°åŒºå—é“¾ä¸­çš„ Proof-of-Work å·¥ä½œé‡è¯æ˜æŒ–çŸ¿ç®—æ³•ä½¿ç”¨äº†ä¸€ç±»ç‰¹æ®Šçš„å“ˆå¸Œå‡½æ•°ï¼Œè¿™äº›å‡½æ•°æ˜¯è®¡ç®—å¯†é›†å‹å’Œå†…å­˜å¯†é›†å‹çš„ã€‚è¿™äº›å“ˆå¸Œå‡½æ•°è¢«è®¾è®¡æˆéœ€è¦æ¶ˆè€—å¤§é‡è®¡ç®—èµ„æºå’Œå¤§é‡å†…å­˜ï¼Œå¹¶ä¸”å¾ˆéš¾åœ¨ç¡¬ä»¶è®¾å¤‡ï¼ˆä¾‹å¦‚é›†æˆç”µè·¯æˆ–çŸ¿æœºï¼‰ä¸­å®ç°ï¼Œä¹Ÿå°±éš¾ä»¥è®¾è®¡ä¸“ç”¨ç¡¬ä»¶æ¥åŠ é€Ÿè®¡ç®—ã€‚è¿™ç§å“ˆå¸Œå‡½æ•°è¢«ç§°ä¸ºæŠ— ASICï¼ˆASIC-resistantï¼‰ã€‚ å¤§éƒ¨åˆ†å·¥ä½œé‡è¯æ˜ï¼ˆProof-of-Workï¼‰ç®—æ³•ï¼Œéƒ½æ˜¯è¦æ±‚è®¡ç®—å‡ºä¸€ä¸ªæ¯”ç‰¹å®šå€¼ï¼ˆç§°ä¸ºæŒ–æ˜éš¾åº¦ï¼‰æ›´å¤§çš„å“ˆå¸Œå€¼ã€‚å› ä¸ºå“ˆå¸Œå€¼æ˜¯ä¸å¯é¢„æµ‹çš„ï¼Œä¸ºäº†æ‰¾å‡ºç¬¦åˆæ¡ä»¶çš„å“ˆå¸Œå€¼ï¼ŒçŸ¿å·¥éœ€è¦è®¡ç®—æ•°åäº¿ä¸ªä¸åŒçš„å“ˆå¸Œå€¼ï¼Œ å†ä»ä¸­æ‰¾å‡ºæœ€å¤§çš„é‚£ä¸ªã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªå·¥ä½œé‡è¯æ˜é—®é¢˜å¯èƒ½ä¼šè¢«å®šä¹‰æˆè¿™æ ·ï¼šå·²æœ‰å¸¸æ•° xï¼Œè¦æ±‚æ‰¾åˆ°ä¸€ä¸ªæ•° pï¼Œä½¿ hash(x + p) çš„å‰åä¸ªæ¯”ç‰¹éƒ½ä¸º 0. æœ‰è®¸å¤šå“ˆå¸Œå‡½æ•°æ˜¯ä¸“ä¸ºå·¥ä½œé‡è¯æ˜æŒ–æ˜ç®—æ³•è®¾è®¡çš„ï¼Œä¾‹å¦‚ ETHashã€Equihashã€CryptoNight å’Œ Cuckoo Cycle. è¿™äº›å“ˆå¸Œå‡½æ•°çš„è®¡ç®—é€Ÿåº¦å¾ˆæ…¢ï¼Œé€šå¸¸ä½¿ç”¨ GPU ç¡¬ä»¶ï¼ˆå¦‚ NVIDIA GTX 1080 ç­‰æ˜¾å¡ï¼‰æˆ–å¼ºå¤§çš„ CPU ç¡¬ä»¶ï¼ˆå¦‚ Intel Core i7-8700Kï¼‰å’Œå¤§é‡å¿«é€Ÿ RAM å†…å­˜ï¼ˆå¦‚ DDR4 èŠ¯ç‰‡ï¼‰æ¥æ‰§è¡Œè¿™ç±»ç®—æ³•ã€‚è¿™äº›æŒ–çŸ¿ç®—æ³•çš„ç›®æ ‡æ˜¯é€šè¿‡åˆºæ¿€å°å‹çŸ¿å·¥ï¼ˆå®¶åº­ç”¨æˆ·å’Œå°å‹çŸ¿åœºï¼‰æ¥æœ€å¤§é™åº¦åœ°å‡å°‘æŒ–çŸ¿çš„é›†ä¸­åŒ–ï¼Œå¹¶é™åˆ¶æŒ–çŸ¿è¡Œä¸šä¸­é«˜çº§ç©å®¶ä»¬ï¼ˆä»–ä»¬æœ‰èƒ½åŠ›å»ºé€ å·¨å‹æŒ–çŸ¿è®¾æ–½å’Œæ•°æ®ä¸­å¿ƒï¼‰çš„åŠ›é‡ã€‚ä¸å°‘æ•°çš„é«˜ç©ç›¸æ¯”ï¼Œå¤§é‡å°ç©å®¶æ„å‘³ç€æ›´å¥½çš„å»ä¸­å¿ƒåŒ–ã€‚ ç›®å‰å¤§å‹è™šæ‹Ÿè´§å¸æŒ–çŸ¿å…¬å¸æ‰‹ä¸­çš„ä¸»è¦æ­¦å™¨æ˜¯ ASIC çŸ¿æœºï¼Œå› æ­¤ï¼Œç°ä»£åŠ å¯†è´§å¸é€šå¸¸ä¼šè¦æ±‚ä½¿ç”¨ã€ŒæŠ— ASIC å“ˆå¸Œç®—æ³•ã€æˆ–ã€Œæƒç›Šè¯æ˜ï¼ˆproof-of-stakeï¼‰å…±è¯†åè®®ã€è¿›è¡Œã€Œå·¥ä½œé‡è¯æ˜æŒ–çŸ¿ã€ï¼Œä»¥é™åˆ¶è¿™éƒ¨åˆ†é«˜çº§ç©å®¶ï¼Œè¾¾æˆæ›´å¥½çš„å»ä¸­å¿ƒåŒ–ã€‚ å› ä¸ºå·¥ä½œé‡è¯æ˜ç®—æ³•éœ€è¦æ¶ˆè€—å¤§é‡èƒ½æºï¼Œä¸å¤Ÿç¯ä¿ï¼Œä»¥å¤ªåŠç­‰åŒºå—é“¾å·²ç»å£°æ˜æœªæ¥å°†ä¼šå‡çº§åˆ°æƒç›Šè¯æ˜ï¼ˆProof-of-Sï¼‰è¿™ç±»æ›´ç¯ä¿çš„ç®—æ³•ã€‚ä¸è¿‡è¿™é‡Œæˆ‘ä»¬åªå…³æ³¨ PoW å¦‚ä½•åŸºäºå“ˆå¸Œå‡½æ•°å®ç°çš„ï¼Œä¸è®¨è®ºè¿™ä¸ªã€‚ 1. ETHashè¿™é‡Œç®€è¦è¯´æ˜ä¸‹ä»¥å¤ªåŠåŒºå—é“¾ä¸­ä½¿ç”¨çš„ ETHash å·¥ä½œé‡è¯æ˜æŒ–æ˜å“ˆå¸Œå‡½æ•°èƒŒåçš„æ€æƒ³ã€‚ ETHash æ˜¯ä»¥å¤ªåŠåŒºå—é“¾ä¸­çš„å·¥ä½œé‡è¯æ˜å“ˆå¸Œå‡½æ•°ã€‚å®ƒæ˜¯å†…å­˜å¯†é›†å‹å“ˆå¸Œå‡½æ•°ï¼ˆéœ€è¦å¤§é‡ RAM æ‰èƒ½å¿«é€Ÿè®¡ç®—ï¼‰ï¼Œå› æ­¤å®ƒè¢«è®¤ä¸ºæ˜¯æŠ— ASIC çš„ã€‚ ETHash çš„å·¥ä½œæµç¨‹ï¼š åŸºäºç›´åˆ°å½“å‰åŒºå—çš„æ•´ä¸ªé“¾ï¼Œä¸ºæ¯ä¸ªåŒºå—è®¡ç®—ä¸€ä¸ªã€Œç§å­ã€ ä»ç§å­ä¸­è®¡ç®—å‡ºä¸€ä¸ª 16 MB çš„ä¼ªéšæœºç¼“å­˜ ä»ç¼“å­˜ä¸­æå– 1 GB æ•°æ®é›†ä»¥ç”¨äºæŒ–æ˜ æŒ–æ˜æ¶‰åŠå°†æ•°æ®é›†çš„éšæœºåˆ‡ç‰‡ä¸€èµ·è¿›è¡Œå“ˆå¸Œ æ›´å¤šä¿¡æ¯å‚è§ eth.wiki - ethash 2. Equihashç®€è¦è§£é‡Šä¸€ä¸‹ Zcashã€Bitcoin Gold å’Œå…¶ä»–ä¸€äº›åŒºå—é“¾ä¸­ä½¿ç”¨çš„ Equihash å·¥ä½œé‡è¯æ˜æŒ–æ˜å“ˆå¸Œå‡½æ•°èƒŒåçš„æ€æƒ³ã€‚ Equihash æ˜¯ Zcash å’Œ Bitcoin Gold åŒºå—é“¾ä¸­çš„å·¥ä½œé‡è¯æ˜å“ˆå¸Œå‡½æ•°ã€‚å®ƒæ˜¯å†…å­˜å¯†é›†å‹å“ˆå¸Œå‡½æ•°ï¼ˆéœ€è¦å¤§é‡ RAM æ‰èƒ½è¿›è¡Œå¿«é€Ÿè®¡ç®—ï¼‰ï¼Œå› æ­¤å®ƒè¢«è®¤ä¸ºæ˜¯æŠ— ASIC çš„ã€‚ Equihash çš„å·¥ä½œæµç¨‹ï¼š åŸºäºç›´åˆ°å½“å‰åŒºå—çš„æ•´ä¸ªé“¾ï¼Œä½¿ç”¨ BLAKE2b è®¡ç®—å‡º 50 MB å“ˆå¸Œæ•°æ®é›† åœ¨ç”Ÿæˆçš„å“ˆå¸Œæ•°æ®é›†ä¸Šè§£å†³ã€Œå¹¿ä¹‰ç”Ÿæ—¥é—®é¢˜ã€ï¼ˆä» 2097152 ä¸­æŒ‘é€‰ 512 ä¸ªä¸åŒçš„å­—ç¬¦ä¸²ï¼Œä½¿å¾—å®ƒä»¬çš„äºŒè¿›åˆ¶ XOR ä¸ºé›¶ï¼‰ã€‚å·²çŸ¥æœ€ä½³çš„è§£å†³æ–¹æ¡ˆï¼ˆç“¦æ ¼çº³ç®—æ³•ï¼‰åœ¨æŒ‡æ•°æ—¶é—´å†…è¿è¡Œï¼Œå› æ­¤å®ƒéœ€è¦å¤§é‡çš„å†…å­˜å¯†é›†å‹å’Œè®¡ç®—å¯†é›†å‹è®¡ç®— å¯¹å‰é¢å¾—åˆ°çš„ç»“æœï¼Œè¿›è¡ŒåŒ SHA256 è®¡ç®—å¾—åˆ°æœ€ç»ˆç»“æœï¼Œå³ SHA256(SHA256(solution)) æ›´å¤šä¿¡æ¯å‚è§ https://github.com/tromp/equihash ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-2-hash/:2:5","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","å¯†ç å­¦","å“ˆå¸Œ","æ•£åˆ—","å®‰å…¨","SHA-2","SHA-3"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆäºŒï¼‰â€”â€” å“ˆå¸Œå‡½æ•°","uri":"/posts/practical-cryptography-basics-2-hash/#pow-å·¥ä½œé‡è¯æ˜å“ˆå¸Œå‡½æ•°"},{"categories":["tech"],"content":" PoW å·¥ä½œé‡è¯æ˜å“ˆå¸Œå‡½æ•°åŒºå—é“¾ä¸­çš„ Proof-of-Work å·¥ä½œé‡è¯æ˜æŒ–çŸ¿ç®—æ³•ä½¿ç”¨äº†ä¸€ç±»ç‰¹æ®Šçš„å“ˆå¸Œå‡½æ•°ï¼Œè¿™äº›å‡½æ•°æ˜¯è®¡ç®—å¯†é›†å‹å’Œå†…å­˜å¯†é›†å‹çš„ã€‚è¿™äº›å“ˆå¸Œå‡½æ•°è¢«è®¾è®¡æˆéœ€è¦æ¶ˆè€—å¤§é‡è®¡ç®—èµ„æºå’Œå¤§é‡å†…å­˜ï¼Œå¹¶ä¸”å¾ˆéš¾åœ¨ç¡¬ä»¶è®¾å¤‡ï¼ˆä¾‹å¦‚é›†æˆç”µè·¯æˆ–çŸ¿æœºï¼‰ä¸­å®ç°ï¼Œä¹Ÿå°±éš¾ä»¥è®¾è®¡ä¸“ç”¨ç¡¬ä»¶æ¥åŠ é€Ÿè®¡ç®—ã€‚è¿™ç§å“ˆå¸Œå‡½æ•°è¢«ç§°ä¸ºæŠ— ASICï¼ˆASIC-resistantï¼‰ã€‚ å¤§éƒ¨åˆ†å·¥ä½œé‡è¯æ˜ï¼ˆProof-of-Workï¼‰ç®—æ³•ï¼Œéƒ½æ˜¯è¦æ±‚è®¡ç®—å‡ºä¸€ä¸ªæ¯”ç‰¹å®šå€¼ï¼ˆç§°ä¸ºæŒ–æ˜éš¾åº¦ï¼‰æ›´å¤§çš„å“ˆå¸Œå€¼ã€‚å› ä¸ºå“ˆå¸Œå€¼æ˜¯ä¸å¯é¢„æµ‹çš„ï¼Œä¸ºäº†æ‰¾å‡ºç¬¦åˆæ¡ä»¶çš„å“ˆå¸Œå€¼ï¼ŒçŸ¿å·¥éœ€è¦è®¡ç®—æ•°åäº¿ä¸ªä¸åŒçš„å“ˆå¸Œå€¼ï¼Œ å†ä»ä¸­æ‰¾å‡ºæœ€å¤§çš„é‚£ä¸ªã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªå·¥ä½œé‡è¯æ˜é—®é¢˜å¯èƒ½ä¼šè¢«å®šä¹‰æˆè¿™æ ·ï¼šå·²æœ‰å¸¸æ•° xï¼Œè¦æ±‚æ‰¾åˆ°ä¸€ä¸ªæ•° pï¼Œä½¿ hash(x + p) çš„å‰åä¸ªæ¯”ç‰¹éƒ½ä¸º 0. æœ‰è®¸å¤šå“ˆå¸Œå‡½æ•°æ˜¯ä¸“ä¸ºå·¥ä½œé‡è¯æ˜æŒ–æ˜ç®—æ³•è®¾è®¡çš„ï¼Œä¾‹å¦‚ ETHashã€Equihashã€CryptoNight å’Œ Cuckoo Cycle. è¿™äº›å“ˆå¸Œå‡½æ•°çš„è®¡ç®—é€Ÿåº¦å¾ˆæ…¢ï¼Œé€šå¸¸ä½¿ç”¨ GPU ç¡¬ä»¶ï¼ˆå¦‚ NVIDIA GTX 1080 ç­‰æ˜¾å¡ï¼‰æˆ–å¼ºå¤§çš„ CPU ç¡¬ä»¶ï¼ˆå¦‚ Intel Core i7-8700Kï¼‰å’Œå¤§é‡å¿«é€Ÿ RAM å†…å­˜ï¼ˆå¦‚ DDR4 èŠ¯ç‰‡ï¼‰æ¥æ‰§è¡Œè¿™ç±»ç®—æ³•ã€‚è¿™äº›æŒ–çŸ¿ç®—æ³•çš„ç›®æ ‡æ˜¯é€šè¿‡åˆºæ¿€å°å‹çŸ¿å·¥ï¼ˆå®¶åº­ç”¨æˆ·å’Œå°å‹çŸ¿åœºï¼‰æ¥æœ€å¤§é™åº¦åœ°å‡å°‘æŒ–çŸ¿çš„é›†ä¸­åŒ–ï¼Œå¹¶é™åˆ¶æŒ–çŸ¿è¡Œä¸šä¸­é«˜çº§ç©å®¶ä»¬ï¼ˆä»–ä»¬æœ‰èƒ½åŠ›å»ºé€ å·¨å‹æŒ–çŸ¿è®¾æ–½å’Œæ•°æ®ä¸­å¿ƒï¼‰çš„åŠ›é‡ã€‚ä¸å°‘æ•°çš„é«˜ç©ç›¸æ¯”ï¼Œå¤§é‡å°ç©å®¶æ„å‘³ç€æ›´å¥½çš„å»ä¸­å¿ƒåŒ–ã€‚ ç›®å‰å¤§å‹è™šæ‹Ÿè´§å¸æŒ–çŸ¿å…¬å¸æ‰‹ä¸­çš„ä¸»è¦æ­¦å™¨æ˜¯ ASIC çŸ¿æœºï¼Œå› æ­¤ï¼Œç°ä»£åŠ å¯†è´§å¸é€šå¸¸ä¼šè¦æ±‚ä½¿ç”¨ã€ŒæŠ— ASIC å“ˆå¸Œç®—æ³•ã€æˆ–ã€Œæƒç›Šè¯æ˜ï¼ˆproof-of-stakeï¼‰å…±è¯†åè®®ã€è¿›è¡Œã€Œå·¥ä½œé‡è¯æ˜æŒ–çŸ¿ã€ï¼Œä»¥é™åˆ¶è¿™éƒ¨åˆ†é«˜çº§ç©å®¶ï¼Œè¾¾æˆæ›´å¥½çš„å»ä¸­å¿ƒåŒ–ã€‚ å› ä¸ºå·¥ä½œé‡è¯æ˜ç®—æ³•éœ€è¦æ¶ˆè€—å¤§é‡èƒ½æºï¼Œä¸å¤Ÿç¯ä¿ï¼Œä»¥å¤ªåŠç­‰åŒºå—é“¾å·²ç»å£°æ˜æœªæ¥å°†ä¼šå‡çº§åˆ°æƒç›Šè¯æ˜ï¼ˆProof-of-Sï¼‰è¿™ç±»æ›´ç¯ä¿çš„ç®—æ³•ã€‚ä¸è¿‡è¿™é‡Œæˆ‘ä»¬åªå…³æ³¨ PoW å¦‚ä½•åŸºäºå“ˆå¸Œå‡½æ•°å®ç°çš„ï¼Œä¸è®¨è®ºè¿™ä¸ªã€‚ 1. ETHashè¿™é‡Œç®€è¦è¯´æ˜ä¸‹ä»¥å¤ªåŠåŒºå—é“¾ä¸­ä½¿ç”¨çš„ ETHash å·¥ä½œé‡è¯æ˜æŒ–æ˜å“ˆå¸Œå‡½æ•°èƒŒåçš„æ€æƒ³ã€‚ ETHash æ˜¯ä»¥å¤ªåŠåŒºå—é“¾ä¸­çš„å·¥ä½œé‡è¯æ˜å“ˆå¸Œå‡½æ•°ã€‚å®ƒæ˜¯å†…å­˜å¯†é›†å‹å“ˆå¸Œå‡½æ•°ï¼ˆéœ€è¦å¤§é‡ RAM æ‰èƒ½å¿«é€Ÿè®¡ç®—ï¼‰ï¼Œå› æ­¤å®ƒè¢«è®¤ä¸ºæ˜¯æŠ— ASIC çš„ã€‚ ETHash çš„å·¥ä½œæµç¨‹ï¼š åŸºäºç›´åˆ°å½“å‰åŒºå—çš„æ•´ä¸ªé“¾ï¼Œä¸ºæ¯ä¸ªåŒºå—è®¡ç®—ä¸€ä¸ªã€Œç§å­ã€ ä»ç§å­ä¸­è®¡ç®—å‡ºä¸€ä¸ª 16 MB çš„ä¼ªéšæœºç¼“å­˜ ä»ç¼“å­˜ä¸­æå– 1 GB æ•°æ®é›†ä»¥ç”¨äºæŒ–æ˜ æŒ–æ˜æ¶‰åŠå°†æ•°æ®é›†çš„éšæœºåˆ‡ç‰‡ä¸€èµ·è¿›è¡Œå“ˆå¸Œ æ›´å¤šä¿¡æ¯å‚è§ eth.wiki - ethash 2. Equihashç®€è¦è§£é‡Šä¸€ä¸‹ Zcashã€Bitcoin Gold å’Œå…¶ä»–ä¸€äº›åŒºå—é“¾ä¸­ä½¿ç”¨çš„ Equihash å·¥ä½œé‡è¯æ˜æŒ–æ˜å“ˆå¸Œå‡½æ•°èƒŒåçš„æ€æƒ³ã€‚ Equihash æ˜¯ Zcash å’Œ Bitcoin Gold åŒºå—é“¾ä¸­çš„å·¥ä½œé‡è¯æ˜å“ˆå¸Œå‡½æ•°ã€‚å®ƒæ˜¯å†…å­˜å¯†é›†å‹å“ˆå¸Œå‡½æ•°ï¼ˆéœ€è¦å¤§é‡ RAM æ‰èƒ½è¿›è¡Œå¿«é€Ÿè®¡ç®—ï¼‰ï¼Œå› æ­¤å®ƒè¢«è®¤ä¸ºæ˜¯æŠ— ASIC çš„ã€‚ Equihash çš„å·¥ä½œæµç¨‹ï¼š åŸºäºç›´åˆ°å½“å‰åŒºå—çš„æ•´ä¸ªé“¾ï¼Œä½¿ç”¨ BLAKE2b è®¡ç®—å‡º 50 MB å“ˆå¸Œæ•°æ®é›† åœ¨ç”Ÿæˆçš„å“ˆå¸Œæ•°æ®é›†ä¸Šè§£å†³ã€Œå¹¿ä¹‰ç”Ÿæ—¥é—®é¢˜ã€ï¼ˆä» 2097152 ä¸­æŒ‘é€‰ 512 ä¸ªä¸åŒçš„å­—ç¬¦ä¸²ï¼Œä½¿å¾—å®ƒä»¬çš„äºŒè¿›åˆ¶ XOR ä¸ºé›¶ï¼‰ã€‚å·²çŸ¥æœ€ä½³çš„è§£å†³æ–¹æ¡ˆï¼ˆç“¦æ ¼çº³ç®—æ³•ï¼‰åœ¨æŒ‡æ•°æ—¶é—´å†…è¿è¡Œï¼Œå› æ­¤å®ƒéœ€è¦å¤§é‡çš„å†…å­˜å¯†é›†å‹å’Œè®¡ç®—å¯†é›†å‹è®¡ç®— å¯¹å‰é¢å¾—åˆ°çš„ç»“æœï¼Œè¿›è¡ŒåŒ SHA256 è®¡ç®—å¾—åˆ°æœ€ç»ˆç»“æœï¼Œå³ SHA256(SHA256(solution)) æ›´å¤šä¿¡æ¯å‚è§ https://github.com/tromp/equihash ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-2-hash/:2:5","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","å¯†ç å­¦","å“ˆå¸Œ","æ•£åˆ—","å®‰å…¨","SHA-2","SHA-3"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆäºŒï¼‰â€”â€” å“ˆå¸Œå‡½æ•°","uri":"/posts/practical-cryptography-basics-2-hash/#1-ethash"},{"categories":["tech"],"content":" PoW å·¥ä½œé‡è¯æ˜å“ˆå¸Œå‡½æ•°åŒºå—é“¾ä¸­çš„ Proof-of-Work å·¥ä½œé‡è¯æ˜æŒ–çŸ¿ç®—æ³•ä½¿ç”¨äº†ä¸€ç±»ç‰¹æ®Šçš„å“ˆå¸Œå‡½æ•°ï¼Œè¿™äº›å‡½æ•°æ˜¯è®¡ç®—å¯†é›†å‹å’Œå†…å­˜å¯†é›†å‹çš„ã€‚è¿™äº›å“ˆå¸Œå‡½æ•°è¢«è®¾è®¡æˆéœ€è¦æ¶ˆè€—å¤§é‡è®¡ç®—èµ„æºå’Œå¤§é‡å†…å­˜ï¼Œå¹¶ä¸”å¾ˆéš¾åœ¨ç¡¬ä»¶è®¾å¤‡ï¼ˆä¾‹å¦‚é›†æˆç”µè·¯æˆ–çŸ¿æœºï¼‰ä¸­å®ç°ï¼Œä¹Ÿå°±éš¾ä»¥è®¾è®¡ä¸“ç”¨ç¡¬ä»¶æ¥åŠ é€Ÿè®¡ç®—ã€‚è¿™ç§å“ˆå¸Œå‡½æ•°è¢«ç§°ä¸ºæŠ— ASICï¼ˆASIC-resistantï¼‰ã€‚ å¤§éƒ¨åˆ†å·¥ä½œé‡è¯æ˜ï¼ˆProof-of-Workï¼‰ç®—æ³•ï¼Œéƒ½æ˜¯è¦æ±‚è®¡ç®—å‡ºä¸€ä¸ªæ¯”ç‰¹å®šå€¼ï¼ˆç§°ä¸ºæŒ–æ˜éš¾åº¦ï¼‰æ›´å¤§çš„å“ˆå¸Œå€¼ã€‚å› ä¸ºå“ˆå¸Œå€¼æ˜¯ä¸å¯é¢„æµ‹çš„ï¼Œä¸ºäº†æ‰¾å‡ºç¬¦åˆæ¡ä»¶çš„å“ˆå¸Œå€¼ï¼ŒçŸ¿å·¥éœ€è¦è®¡ç®—æ•°åäº¿ä¸ªä¸åŒçš„å“ˆå¸Œå€¼ï¼Œ å†ä»ä¸­æ‰¾å‡ºæœ€å¤§çš„é‚£ä¸ªã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªå·¥ä½œé‡è¯æ˜é—®é¢˜å¯èƒ½ä¼šè¢«å®šä¹‰æˆè¿™æ ·ï¼šå·²æœ‰å¸¸æ•° xï¼Œè¦æ±‚æ‰¾åˆ°ä¸€ä¸ªæ•° pï¼Œä½¿ hash(x + p) çš„å‰åä¸ªæ¯”ç‰¹éƒ½ä¸º 0. æœ‰è®¸å¤šå“ˆå¸Œå‡½æ•°æ˜¯ä¸“ä¸ºå·¥ä½œé‡è¯æ˜æŒ–æ˜ç®—æ³•è®¾è®¡çš„ï¼Œä¾‹å¦‚ ETHashã€Equihashã€CryptoNight å’Œ Cuckoo Cycle. è¿™äº›å“ˆå¸Œå‡½æ•°çš„è®¡ç®—é€Ÿåº¦å¾ˆæ…¢ï¼Œé€šå¸¸ä½¿ç”¨ GPU ç¡¬ä»¶ï¼ˆå¦‚ NVIDIA GTX 1080 ç­‰æ˜¾å¡ï¼‰æˆ–å¼ºå¤§çš„ CPU ç¡¬ä»¶ï¼ˆå¦‚ Intel Core i7-8700Kï¼‰å’Œå¤§é‡å¿«é€Ÿ RAM å†…å­˜ï¼ˆå¦‚ DDR4 èŠ¯ç‰‡ï¼‰æ¥æ‰§è¡Œè¿™ç±»ç®—æ³•ã€‚è¿™äº›æŒ–çŸ¿ç®—æ³•çš„ç›®æ ‡æ˜¯é€šè¿‡åˆºæ¿€å°å‹çŸ¿å·¥ï¼ˆå®¶åº­ç”¨æˆ·å’Œå°å‹çŸ¿åœºï¼‰æ¥æœ€å¤§é™åº¦åœ°å‡å°‘æŒ–çŸ¿çš„é›†ä¸­åŒ–ï¼Œå¹¶é™åˆ¶æŒ–çŸ¿è¡Œä¸šä¸­é«˜çº§ç©å®¶ä»¬ï¼ˆä»–ä»¬æœ‰èƒ½åŠ›å»ºé€ å·¨å‹æŒ–çŸ¿è®¾æ–½å’Œæ•°æ®ä¸­å¿ƒï¼‰çš„åŠ›é‡ã€‚ä¸å°‘æ•°çš„é«˜ç©ç›¸æ¯”ï¼Œå¤§é‡å°ç©å®¶æ„å‘³ç€æ›´å¥½çš„å»ä¸­å¿ƒåŒ–ã€‚ ç›®å‰å¤§å‹è™šæ‹Ÿè´§å¸æŒ–çŸ¿å…¬å¸æ‰‹ä¸­çš„ä¸»è¦æ­¦å™¨æ˜¯ ASIC çŸ¿æœºï¼Œå› æ­¤ï¼Œç°ä»£åŠ å¯†è´§å¸é€šå¸¸ä¼šè¦æ±‚ä½¿ç”¨ã€ŒæŠ— ASIC å“ˆå¸Œç®—æ³•ã€æˆ–ã€Œæƒç›Šè¯æ˜ï¼ˆproof-of-stakeï¼‰å…±è¯†åè®®ã€è¿›è¡Œã€Œå·¥ä½œé‡è¯æ˜æŒ–çŸ¿ã€ï¼Œä»¥é™åˆ¶è¿™éƒ¨åˆ†é«˜çº§ç©å®¶ï¼Œè¾¾æˆæ›´å¥½çš„å»ä¸­å¿ƒåŒ–ã€‚ å› ä¸ºå·¥ä½œé‡è¯æ˜ç®—æ³•éœ€è¦æ¶ˆè€—å¤§é‡èƒ½æºï¼Œä¸å¤Ÿç¯ä¿ï¼Œä»¥å¤ªåŠç­‰åŒºå—é“¾å·²ç»å£°æ˜æœªæ¥å°†ä¼šå‡çº§åˆ°æƒç›Šè¯æ˜ï¼ˆProof-of-Sï¼‰è¿™ç±»æ›´ç¯ä¿çš„ç®—æ³•ã€‚ä¸è¿‡è¿™é‡Œæˆ‘ä»¬åªå…³æ³¨ PoW å¦‚ä½•åŸºäºå“ˆå¸Œå‡½æ•°å®ç°çš„ï¼Œä¸è®¨è®ºè¿™ä¸ªã€‚ 1. ETHashè¿™é‡Œç®€è¦è¯´æ˜ä¸‹ä»¥å¤ªåŠåŒºå—é“¾ä¸­ä½¿ç”¨çš„ ETHash å·¥ä½œé‡è¯æ˜æŒ–æ˜å“ˆå¸Œå‡½æ•°èƒŒåçš„æ€æƒ³ã€‚ ETHash æ˜¯ä»¥å¤ªåŠåŒºå—é“¾ä¸­çš„å·¥ä½œé‡è¯æ˜å“ˆå¸Œå‡½æ•°ã€‚å®ƒæ˜¯å†…å­˜å¯†é›†å‹å“ˆå¸Œå‡½æ•°ï¼ˆéœ€è¦å¤§é‡ RAM æ‰èƒ½å¿«é€Ÿè®¡ç®—ï¼‰ï¼Œå› æ­¤å®ƒè¢«è®¤ä¸ºæ˜¯æŠ— ASIC çš„ã€‚ ETHash çš„å·¥ä½œæµç¨‹ï¼š åŸºäºç›´åˆ°å½“å‰åŒºå—çš„æ•´ä¸ªé“¾ï¼Œä¸ºæ¯ä¸ªåŒºå—è®¡ç®—ä¸€ä¸ªã€Œç§å­ã€ ä»ç§å­ä¸­è®¡ç®—å‡ºä¸€ä¸ª 16 MB çš„ä¼ªéšæœºç¼“å­˜ ä»ç¼“å­˜ä¸­æå– 1 GB æ•°æ®é›†ä»¥ç”¨äºæŒ–æ˜ æŒ–æ˜æ¶‰åŠå°†æ•°æ®é›†çš„éšæœºåˆ‡ç‰‡ä¸€èµ·è¿›è¡Œå“ˆå¸Œ æ›´å¤šä¿¡æ¯å‚è§ eth.wiki - ethash 2. Equihashç®€è¦è§£é‡Šä¸€ä¸‹ Zcashã€Bitcoin Gold å’Œå…¶ä»–ä¸€äº›åŒºå—é“¾ä¸­ä½¿ç”¨çš„ Equihash å·¥ä½œé‡è¯æ˜æŒ–æ˜å“ˆå¸Œå‡½æ•°èƒŒåçš„æ€æƒ³ã€‚ Equihash æ˜¯ Zcash å’Œ Bitcoin Gold åŒºå—é“¾ä¸­çš„å·¥ä½œé‡è¯æ˜å“ˆå¸Œå‡½æ•°ã€‚å®ƒæ˜¯å†…å­˜å¯†é›†å‹å“ˆå¸Œå‡½æ•°ï¼ˆéœ€è¦å¤§é‡ RAM æ‰èƒ½è¿›è¡Œå¿«é€Ÿè®¡ç®—ï¼‰ï¼Œå› æ­¤å®ƒè¢«è®¤ä¸ºæ˜¯æŠ— ASIC çš„ã€‚ Equihash çš„å·¥ä½œæµç¨‹ï¼š åŸºäºç›´åˆ°å½“å‰åŒºå—çš„æ•´ä¸ªé“¾ï¼Œä½¿ç”¨ BLAKE2b è®¡ç®—å‡º 50 MB å“ˆå¸Œæ•°æ®é›† åœ¨ç”Ÿæˆçš„å“ˆå¸Œæ•°æ®é›†ä¸Šè§£å†³ã€Œå¹¿ä¹‰ç”Ÿæ—¥é—®é¢˜ã€ï¼ˆä» 2097152 ä¸­æŒ‘é€‰ 512 ä¸ªä¸åŒçš„å­—ç¬¦ä¸²ï¼Œä½¿å¾—å®ƒä»¬çš„äºŒè¿›åˆ¶ XOR ä¸ºé›¶ï¼‰ã€‚å·²çŸ¥æœ€ä½³çš„è§£å†³æ–¹æ¡ˆï¼ˆç“¦æ ¼çº³ç®—æ³•ï¼‰åœ¨æŒ‡æ•°æ—¶é—´å†…è¿è¡Œï¼Œå› æ­¤å®ƒéœ€è¦å¤§é‡çš„å†…å­˜å¯†é›†å‹å’Œè®¡ç®—å¯†é›†å‹è®¡ç®— å¯¹å‰é¢å¾—åˆ°çš„ç»“æœï¼Œè¿›è¡ŒåŒ SHA256 è®¡ç®—å¾—åˆ°æœ€ç»ˆç»“æœï¼Œå³ SHA256(SHA256(solution)) æ›´å¤šä¿¡æ¯å‚è§ https://github.com/tromp/equihash ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-2-hash/:2:5","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","å¯†ç å­¦","å“ˆå¸Œ","æ•£åˆ—","å®‰å…¨","SHA-2","SHA-3"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆäºŒï¼‰â€”â€” å“ˆå¸Œå‡½æ•°","uri":"/posts/practical-cryptography-basics-2-hash/#2-equihash"},{"categories":["tech"],"content":" ä¸‰ã€éåŠ å¯†å“ˆå¸Œå‡½æ•°åŠ å¯†å“ˆå¸Œå‡½æ•°éå¸¸çœ‹é‡ã€ŒåŠ å¯†ã€ï¼Œä¸ºäº†å®ç°æ›´é«˜çš„å®‰å…¨å¼ºåº¦ï¼Œè´¹äº†éå¸¸å¤šçš„å¿ƒæ€ã€ä¹Ÿä»˜å‡ºäº†å¾ˆå¤šä»£ä»·ã€‚ ä½†æ˜¯å®é™…åº”ç”¨ä¸­å¾ˆå¤šåœºæ™¯å¹¶ä¸éœ€è¦è¿™ä¹ˆé«˜çš„å®‰å…¨æ€§ï¼Œä½†å¯èƒ½ä¼šå¯¹é€Ÿåº¦ã€éšæœºå‡åŒ€æ€§ç­‰æœ‰æ›´é«˜çš„è¦æ±‚ã€‚è¿™å°±å‚¬ç”Ÿå‡ºäº†å¾ˆå¤šã€ŒéåŠ å¯†å“ˆå¸Œå‡½æ•°ã€ã€‚ éåŠ å¯†å“ˆå¸Œå‡½æ•°çš„åº”ç”¨åœºæ™¯æœ‰å¾ˆå¤šï¼š å“ˆå¸Œè¡¨ Hash Table: åœ¨å¾ˆå¤šè¯­è¨€ä¸­ä¹Ÿè¢«ç§°ä¸º map/dictï¼Œå®ƒä½¿ç”¨çš„ç®—æ³•å¾ˆç®€å•ï¼Œé€šå¸¸å°±æ˜¯æŠŠå¯¹è±¡çš„å„ç§å±æ€§ä¸æ–­ä¹˜ä¸ªè´¨æ•°ï¼ˆæ¯”å¦‚ 31ï¼‰å†ç›¸åŠ ï¼Œå“ˆå¸Œç©ºé—´ä¼šéšç€è¡¨çš„å˜åŒ–è€Œå˜åŒ–ã€‚è¿™é‡Œæœ€å¸Œæœ›çš„æ˜¯æ•°æ®çš„åˆ†å¸ƒè¶³å¤Ÿå‡åŒ€ã€é€Ÿåº¦è¶³å¤Ÿå¿«ã€‚ ä¸€è‡´æ€§å“ˆå¸Œï¼šç›®çš„æ˜¯è§£å†³åˆ†å¸ƒå¼ç¼“å­˜çš„é—®é¢˜ã€‚åœ¨ç§»é™¤æˆ–è€…æ·»åŠ ä¸€ä¸ªæœåŠ¡å™¨æ—¶ï¼Œèƒ½å¤Ÿå°½å¯èƒ½å°åœ°æ”¹å˜å·²å­˜åœ¨çš„æœåŠ¡è¯·æ±‚ä¸å¤„ç†è¯·æ±‚æœåŠ¡å™¨ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚ é«˜æ€§èƒ½å“ˆå¸Œç®—æ³•ï¼šSipHash MurMurHash3 ç­‰ï¼Œä½¿ç”¨å®ƒä»¬çš„ç›®çš„å¯èƒ½æ˜¯å¯¹æ•°æ®è¿›è¡Œå¿«é€Ÿå»é‡ï¼Œè¦æ±‚å°±æ˜¯è¶³å¤Ÿå¿«ï¼Œèƒ½å¤Ÿå®¹å¿ä¸€å®šçš„ç¢°æ’ã€‚ æœ‰æ—¶æˆ‘ä»¬ç”šè‡³å¯èƒ½ä¸å¤ªåœ¨æ„å“ˆå¸Œç¢°æ’çš„æ¦‚ç‡ã€‚ä¹Ÿæœ‰çš„åœºæ™¯è¾“å…¥æ˜¯æœ‰é™çš„ï¼Œè¿™æ—¶æˆ‘ä»¬å¯èƒ½ä¼šå¸Œæœ›å“ˆå¸Œå‡½æ•°å…·æœ‰ä¸€å®šå¯é€†æ€§ã€‚ æ€»ä¹‹éåŠ å¯†å“ˆå¸Œå‡½æ•°ä¹Ÿæœ‰éå¸¸å¤šçš„åº”ç”¨ï¼Œä½†ä¸æ˜¯æœ¬æ–‡çš„ä¸»é¢˜ã€‚è¿™é‡Œå°±ä¸è¯¦ç»†ä»‹ç»äº†ï¼Œæœ‰å…´è¶£çš„æœ‹å‹ä»¬å¯ä»¥è‡ªè¡Œå¯»æ‰¾å…¶ä»–èµ„æºã€‚ ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-2-hash/:3:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","å¯†ç å­¦","å“ˆå¸Œ","æ•£åˆ—","å®‰å…¨","SHA-2","SHA-3"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆäºŒï¼‰â€”â€” å“ˆå¸Œå‡½æ•°","uri":"/posts/practical-cryptography-basics-2-hash/#ä¸‰éåŠ å¯†å“ˆå¸Œå‡½æ•°"},{"categories":["tech"],"content":" å‚è€ƒ Practical-Cryptography-for-Developers-Book æ¼«è°ˆéåŠ å¯†å“ˆå¸Œç®—æ³• å¼€å‘ä¸­å¸¸è§çš„ä¸€äº›Hashå‡½æ•°ï¼ˆä¸€ï¼‰ ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-2-hash/:4:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","å¯†ç å­¦","å“ˆå¸Œ","æ•£åˆ—","å®‰å…¨","SHA-2","SHA-3"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆäºŒï¼‰â€”â€” å“ˆå¸Œå‡½æ•°","uri":"/posts/practical-cryptography-basics-2-hash/#å‚è€ƒ"},{"categories":["tech"],"content":" æœ¬æ–‡ä¸»è¦ç¿»è¯‘è‡ª Practical-Cryptography-for-Developers-Book ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-1/:0:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","KDF","å¯†ç å­¦","å®‰å…¨","å“ˆå¸Œ","åŠ è§£å¯†","ç­¾å"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸€ï¼‰â€”â€” æ¦‚è§ˆ","uri":"/posts/practical-cryptography-basics-1/#"},{"categories":["tech"],"content":" é›¶ã€å‰è¨€ä½ æ˜¯è½¯ä»¶å¼€å‘äººå‘˜å—ï¼Ÿæœ‰æ—¶ä½ ä¼šéœ€è¦åœ¨æ—¥å¸¸å·¥ä½œä¸­ä½¿ç”¨å“ˆå¸Œã€åŠ å¯†æˆ–æ•°å­—ç­¾åç­‰å¯†ç å­¦å·¥å…·å—ï¼Ÿä½ è®¤ä¸ºå¯†ç å­¦å¾ˆå¤æ‚ï¼Œå……æ»¡äº†æ•°å­¦çŸ¥è¯†ï¼Œè€Œä¸”åªé€‚åˆä¹¦å‘†å­å—ï¼Ÿä¸ï¼Œä¸æ˜¯è¿™æ ·æ»´ï¼Œæ¯ä¸ªå¼€å‘äººå‘˜éƒ½å¯ä»¥å­¦ä¹ å¦‚ä½•ä½¿ç”¨åŠ å¯†ç®—æ³•ã€‚ ä»å¼€å‘äººå‘˜çš„è§’åº¦ç†è§£å¯†ç å­¦æ¦‚å¿µä¸éœ€è¦ä½ æ˜¯ä¸€ä¸ªå‰å®³çš„æ•°å­¦å®¶ã€‚è¿™ä¸ªç³»åˆ—çš„æ–‡ç« å°†å°½é‡ä»¥æœ€æµ…æ˜¾çš„æ–¹å¼æ•™ä½ åº”ç”¨å¯†ç å­¦çš„åŸºç¡€çŸ¥è¯†ï¼Œè€Œä¸”åŒ…å«å¤§é‡å¾ªåºæ¸è¿›çš„ä»£ç ç¤ºä¾‹å’Œå®è·µç»ƒä¹ â€”â€”å°±åƒä½ å­¦ä¹  Web å¼€å‘ã€æ•°æ®åº“æˆ– APP å¼€å‘ä¸€æ ·ã€‚ æ²¡é”™ï¼Œå¦‚æœä½ èƒ½å¤Ÿå­¦ä¼š Web å¼€å‘æˆ– RESTful æœåŠ¡ï¼Œé‚£ä¹ˆä½ ä¹Ÿå®Œå…¨å¯ä»¥å­¦ä¼šå®ç”¨å¯†ç å­¦ã€‚è¿™å°±åƒå­¦ä¹ ä¸€ä¸ªæ–°çš„ API æˆ–ä¸€ä¸ªæ–°çš„ Web å¼€å‘æ¡†æ¶ï¼Œåªè¦æŒæ¡äº†æ¦‚å¿µ + åŠ å¯†åº“ API + å·¥å…· + æœ€ä½³å®è·µï¼Œä½ å°±å­¦ä¼šäº†å®ç”¨å¯†ç å­¦~ åœ¨è¿™ä¸ªç³»åˆ—ä¸­ï¼Œä½ å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨å¯†ç ç®—æ³•å’Œå¯†ç ç³»ç»Ÿï¼Œå¦‚å“ˆå¸Œã€MAC ç å’Œå¯†é’¥æ´¾ç”Ÿå‡½æ•° (KDF)ã€éšæœºç”Ÿæˆå™¨ã€å¯†é’¥äº¤æ¢åè®®ã€å¯¹ç§°å¯†ç ç®—æ³•ã€åŠ å¯†æ–¹æ¡ˆã€éå¯¹ç§°å¯†ç ç³»ç»Ÿã€å…¬é’¥å¯†ç å­¦ã€æ¤­åœ†æ›²çº¿ã€æ•°å­—ç­¾åå’Œé‡å­å®‰å…¨åŠ å¯†ç®—æ³•ï¼Œä»¥åŠç°ä»£åŠ å¯†å·¥å…·å’Œåº“ã€‚ ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-1/:1:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","KDF","å¯†ç å­¦","å®‰å…¨","å“ˆå¸Œ","åŠ è§£å¯†","ç­¾å"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸€ï¼‰â€”â€” æ¦‚è§ˆ","uri":"/posts/practical-cryptography-basics-1/#é›¶å‰è¨€"},{"categories":["tech"],"content":" ä¸€ã€ç°ä»£å¯†ç å­¦æ¦‚è§ˆå¯†ç å­¦å·²ç»ä»ç¬¬ä¸€ä»£å¹¿æ³›åº”ç”¨çš„å¯†ç å­¦ç®—æ³•ï¼ˆæ¯”å¦‚å·²ç»é€€å½¹çš„ MD5 è·Ÿ DESï¼‰ï¼Œå‘å±•åˆ°ç°ä»£å¯†ç å­¦ç®—æ³• ï¼ˆå¦‚ SHA-3, Argon2 ä»¥åŠ ChaCha20ï¼‰ã€‚ è®©æˆ‘ä»¬é¦–å…ˆè·Ÿä¸€äº›åŸºæœ¬çš„å¯†ç å­¦æ¦‚å¿µæ··ä¸ªè„¸ç†Ÿï¼š å“ˆå¸Œå‡½æ•°ï¼ˆHash Functionï¼Œä¹Ÿç§°æ•£åˆ—å‡½æ•°ï¼‰ï¼Œå¦‚ SHA-256, SHA3, RIPEMD ç­‰ å“ˆå¸Œæ¶ˆæ¯è®¤è¯ç  HMAC å¯†é’¥æ´¾ç”Ÿå‡½æ•° KDFï¼Œå¦‚ Scrypt å¯†é’¥äº¤æ¢ç®—æ³•ï¼Œå¦‚ Diffie-Hellman å¯†é’¥äº¤æ¢åè®® å¯¹ç§°å¯†é’¥åŠ å¯†æ–¹æ¡ˆï¼Œå¦‚ AES-256-CTR-HMAC-SHA-256 ä½¿ç”¨å…¬ç§é’¥çš„éå¯¹ç§°å¯†é’¥åŠ å¯†æ–¹æ¡ˆï¼Œå¦‚ RSA å’Œ ECC, secp256k1 æ›²çº¿è·Ÿ Ed25519 å¯†ç ç³»ç»Ÿ æ•°å­—ç­¾åç®—æ³•ï¼Œå¦‚ ECDSA ç†µï¼ˆentropyï¼‰ä¸å®‰å…¨éšæœºæ•°ç”Ÿæˆ é‡å­å®‰å…¨å¯†ç å­¦ ä¸Šè¿°è¿™äº›æ¦‚å¿µæ¶‰åŠåˆ°æŠ€æœ¯è¢«å¹¿æ³›åº”ç”¨åœ¨ IT é¢†åŸŸï¼Œå¦‚æœä½ æœ‰è¿‡ä¸€äº›å¼€å‘ç»éªŒï¼Œå¯èƒ½ä¼šå¾ˆç†Ÿæ‚‰å…¶ä¸­éƒ¨åˆ†åè¯ã€‚å¦‚æœä¸ç†Ÿä¹Ÿæ²¡ä»»ä½•å…³ç³»ï¼Œæœ¬ä¹¦çš„ç›®çš„å°±æ˜¯å¸®ä½ ææ¸…æ¥šè¿™äº›æ¦‚å¿µã€‚ è¿™ä¸ªç³»åˆ—çš„æ–‡ç« ä¼šæŒ‰ä¸Šé¢ç»™å‡ºçš„é¡ºåºï¼Œä¾æ¬¡ä»‹ç»è¿™äº›å¯†ç å­¦æ¦‚å¿µä»¥åŠå¦‚ä½•åœ¨æ—¥å¸¸å¼€å‘ä¸­ä½¿ç”¨å®ƒä»¬ã€‚ ä¸è¿‡åœ¨å¼€å§‹å­¦ä¹ ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯å¯†ç å­¦ï¼Œä»¥åŠå¯†ç å­¦çš„å‡ å¤§ç”¨é€”ã€‚ ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-1/:2:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","KDF","å¯†ç å­¦","å®‰å…¨","å“ˆå¸Œ","åŠ è§£å¯†","ç­¾å"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸€ï¼‰â€”â€” æ¦‚è§ˆ","uri":"/posts/practical-cryptography-basics-1/#ä¸€ç°ä»£å¯†ç å­¦æ¦‚è§ˆ"},{"categories":["tech"],"content":" äºŒã€ä»€ä¹ˆæ˜¯å¯†ç å­¦å¯†ç å­¦ï¼ˆCryptographyï¼‰æ˜¯æä¾›ä¿¡æ¯å®‰å…¨å’Œä¿æŠ¤çš„ç§‘å­¦ã€‚å®ƒåœ¨æˆ‘ä»¬çš„æ•°å­—ä¸–ç•Œä¸­æ— å¤„ä¸åœ¨ï¼Œå½“ä½ æ‰“å¼€ç½‘ç«™æ—¶ã€å‘é€ç”µå­é‚®ä»¶æ—¶ã€è¿æ¥åˆ° WiFi ç½‘ç»œæ—¶ï¼Œä½¿ç”¨è´¦å·å¯†ç ç™»å½• APP æ—¶ã€ä½¿ç”¨äºŒæ­¥è®¤è¯éªŒè¯ç è®¤è¯èº«ä»½æ—¶ï¼Œéƒ½æœ‰æ¶‰åŠåˆ°å¯†ç å­¦ç›¸å…³æŠ€æœ¯ã€‚å› æ­¤å¼€å‘äººå‘˜åº”è¯¥å¯¹å¯†ç å­¦æœ‰åŸºæœ¬çš„äº†è§£ï¼Œ ä»¥é¿å…å†™å‡ºä¸å®‰å…¨çš„ä»£ç ã€‚è‡³å°‘ä¹Ÿå¾—çŸ¥é“å¦‚ä½•ä½¿ç”¨å¯†ç ç®—æ³•å’Œå¯†ç åº“ï¼Œäº†è§£å“ˆå¸Œã€å¯¹ç§°å¯†ç ç®—æ³•ã€éå¯¹ç§°å¯†ç ç®—æ³•ï¼ˆcipherï¼‰ä¸åŠ å¯†æ–¹æ¡ˆè¿™äº›æ¦‚å¿µï¼ŒçŸ¥æ™“æ•°å­—ç­¾ååŠå…¶èƒŒåçš„å¯†ç ç³»ç»Ÿå’Œç®—æ³•ã€‚ ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-1/:3:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","KDF","å¯†ç å­¦","å®‰å…¨","å“ˆå¸Œ","åŠ è§£å¯†","ç­¾å"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸€ï¼‰â€”â€” æ¦‚è§ˆ","uri":"/posts/practical-cryptography-basics-1/#äºŒä»€ä¹ˆæ˜¯å¯†ç å­¦"},{"categories":["tech"],"content":" ä¸‰ã€å¯†ç å­¦çš„ç”¨é€”","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-1/:4:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","KDF","å¯†ç å­¦","å®‰å…¨","å“ˆå¸Œ","åŠ è§£å¯†","ç­¾å"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸€ï¼‰â€”â€” æ¦‚è§ˆ","uri":"/posts/practical-cryptography-basics-1/#ä¸‰å¯†ç å­¦çš„ç”¨é€”"},{"categories":["tech"],"content":" 1. åŠ å¯†ä¸å¯†é’¥å¯†ç å­¦çš„ä¸€å¤§ç”¨é€”ï¼Œå°±æ˜¯è¿›è¡Œæ•°æ®çš„å®‰å…¨å­˜å‚¨å’Œå®‰å…¨ä¼ è¾“ã€‚è¿™å¯èƒ½æ¶‰åŠä½¿ç”¨å¯¹ç§°æˆ–éå¯¹ç§°åŠ å¯†æ–¹æ¡ˆåŠ å¯†å’Œè§£å¯†æ•°æ®ï¼Œå…¶ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªå¯†é’¥ç”¨äºå°†æ•°æ®ä»æ˜æ–‡è½¬æ¢ä¸ºåŠ å¯†å½¢å¼æˆ–è€…ç›¸åã€‚ å¯¹ç§°åŠ å¯†ï¼ˆå¦‚ AESã€Twofish å’Œ ChaCha20ï¼‰æŒ‡åŠ å¯†å’Œè§£å¯†æ¶ˆæ¯éƒ½ä½¿ç”¨ä¸€ä¸ªç›¸åŒçš„å¯†é’¥ï¼Œè€Œéå¯¹ç§°åŠ å¯†ä½¿ç”¨å…¬é’¥å¯†ç ç³»ç»Ÿï¼ˆå¦‚ RSA æˆ– ECCï¼‰å’Œå¯†é’¥å¯¹æ¥è¿›è¡Œè¿™ä¸¤é¡¹æ“ä½œï¼Œä¸¤ä¸ªå¯†é’¥å‡‘æˆä¸€å¯¹ï¼Œç”¨å…¶ä¸­ä¸€æŠŠå¯†é’¥åŠ å¯†çš„æ¶ˆæ¯å¿…é¡»ä½¿ç”¨å¦ä¸€æŠŠè§£å¯†ã€‚ å•çº¯ä½¿ç”¨åŠ å¯†ç®—æ³•æ˜¯ä¸å¤Ÿçš„ï¼Œè¿™æ˜¯å› ä¸ºæœ‰çš„åŠ å¯†ç®—æ³•åªèƒ½æŒ‰å—è¿›è¡ŒåŠ å¯†ï¼Œè€Œä¸”å¾ˆå¤šåŠ å¯†ç®—æ³•å¹¶ä¸èƒ½ä¿è¯å¯†æ–‡çš„çœŸå®æ€§ã€å®Œæ•´æ€§ã€‚å› æ­¤ç°å®ä¸­æˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨åŠ å¯†æ–¹æ¡ˆè¿›è¡Œæ•°æ®çš„åŠ å¯†è§£å¯†ã€‚åŠ å¯†æ–¹æ¡ˆæ˜¯ç»“åˆäº†åŠ å¯†ç®—æ³•ã€æ¶ˆæ¯è®¤è¯æˆ–æ•°å­—ç­¾åç®—æ³•ã€å—å¯†ç æ¨¡å¼ç­‰å¤šç§ç®—æ³•ï¼Œèƒ½åŒæ—¶ä¿è¯æ•°æ®çš„å®‰å…¨æ€§ã€çœŸå®æ€§ã€å®Œæ•´æ€§çš„ä¸€å¥—åŠ å¯†æ–¹æ¡ˆï¼Œå¦‚ AES-256-CTR-HMAC-SHA-256ã€ChaCha20-Poly1305 æˆ– ECIES-secp256k1-AES-128-GCMã€‚åé¢æˆ‘ä»¬ä¼šå­¦åˆ°ï¼ŒåŠ å¯†æ–¹æ¡ˆçš„åç§°å°±æ˜¯ä½¿ç”¨åˆ°çš„å„ç§å¯†ç ç®—æ³•åç§°çš„ç»„åˆã€‚ ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-1/:4:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","KDF","å¯†ç å­¦","å®‰å…¨","å“ˆå¸Œ","åŠ è§£å¯†","ç­¾å"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸€ï¼‰â€”â€” æ¦‚è§ˆ","uri":"/posts/practical-cryptography-basics-1/#1-åŠ å¯†ä¸å¯†é’¥"},{"categories":["tech"],"content":" 2. æ•°å­—ç­¾åä¸æ¶ˆæ¯è®¤è¯å¯†ç å­¦æä¾›äº†ä¿è¯æ¶ˆæ¯çœŸå®æ€§ï¼ˆauthenticityï¼‰ã€å®Œæ•´æ€§ï¼ˆintegrityï¼‰å’Œä¸å¯å¦è®¤æ€§ ï¼ˆnon-repudiationï¼‰çš„æ–¹æ³•ï¼šæ•°å­—ç­¾åç®—æ³•ä¸æ¶ˆæ¯è®¤è¯ï¼ˆMACï¼‰ç®—æ³•ã€‚ å¤§å¤šæ•°æ•°å­—ç­¾åç®—æ³•ï¼ˆå¦‚ DSAã€ECDSA å’Œ EdDSAï¼‰ä½¿ç”¨éå¯¹ç§°å¯†é’¥å¯¹ï¼ˆç§é’¥å’Œå…¬é’¥ï¼‰å¹²è¿™ä¸ªæ´»ï¼šæ¶ˆæ¯ç”±ç§é’¥ç­¾åï¼Œç­¾åç”±ç›¸åº”çš„å…¬é’¥éªŒè¯ã€‚åœ¨é“¶è¡Œç³»ç»Ÿä¸­ï¼Œæ•°å­—ç­¾åç”¨äºç­¾ç½²å’Œæ‰¹å‡†ä»˜æ¬¾ã€‚åœ¨åŒºå—é“¾ç­¾åäº¤æ˜“ä¸­ï¼Œç”¨æˆ·å¯ä»¥å°†åŒºå—é“¾èµ„äº§ä»ä¸€ä¸ªåœ°å€è½¬ç§»åˆ°å¦ä¸€ä¸ªåœ°å€ï¼Œç¡®ä¿è½¬ç§»æ“ä½œçš„çœŸå®ã€å®Œæ•´ã€ä¸å¯å¦è®¤ã€‚ æ¶ˆæ¯è®¤è¯ç®—æ³•ï¼ˆå¦‚ HMACï¼‰å’Œæ¶ˆæ¯è®¤è¯ç ï¼ˆMAC ç ï¼‰ä¹Ÿæ˜¯å¯†ç å­¦çš„ä¸€éƒ¨åˆ†ã€‚MAC è·Ÿæ•°å­—ç­¾åçš„åŠŸèƒ½å®é™…ä¸Šæ˜¯ä¸€è‡´çš„ï¼ŒåŒºåˆ«åœ¨äº MAC ä½¿ç”¨å“ˆå¸Œç®—æ³•æˆ–è€…å¯¹ç§°åŠ å¯†ç³»ç»Ÿã€‚ ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-1/:4:2","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","KDF","å¯†ç å­¦","å®‰å…¨","å“ˆå¸Œ","åŠ è§£å¯†","ç­¾å"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸€ï¼‰â€”â€” æ¦‚è§ˆ","uri":"/posts/practical-cryptography-basics-1/#2-æ•°å­—ç­¾åä¸æ¶ˆæ¯è®¤è¯"},{"categories":["tech"],"content":" 3. å®‰å…¨éšæœºæ•°å¯†ç å­¦çš„å¦ä¸€ä¸ªéƒ¨åˆ†ï¼Œæ˜¯ç†µï¼ˆentropyï¼ŒæŒ‡ä¸å¯é¢„æµ‹çš„éšæœºæ€§ï¼‰å’Œéšæœºæ•°çš„å®‰å…¨ç”Ÿæˆï¼ˆä¾‹å¦‚ä½¿ç”¨ CSPRNGï¼‰ã€‚ å®‰å…¨éšæœºæ•°ç†è®ºä¸Šæ˜¯ä¸å¯é¢„æµ‹çš„ï¼Œå¼€å‘äººå‘˜éœ€è¦å…³å¿ƒçš„æ˜¯ä½ ä½¿ç”¨çš„éšæœºæ•°ç”Ÿæˆå™¨æ˜¯å¦è¶³å¤Ÿå®‰å…¨ã€‚å¾ˆå¤šç¼–ç¨‹è¯­è¨€ä¸­è¢«å¹¿æ³›ä½¿ç”¨çš„éšæœºæ•°ç”Ÿæˆå™¨éƒ½æ˜¯ä¸å®‰å…¨çš„ï¼ˆæ¯”å¦‚ Python çš„ random åº“ï¼‰ï¼Œå¦‚æœä½ åœ¨å¯¹å®‰å…¨æœ‰ä¸¥æ ¼è¦æ±‚çš„åœºæ™¯ä¸‹ä½¿ç”¨äº†è¿™ç§ä¸å®‰å…¨çš„éšæœºç”Ÿæˆå™¨ï¼Œå¯èƒ½ä¼šé»‘å®¢è¢«é¢„æµ‹åˆ°å®ƒç”Ÿæˆçš„éšæœºæ•°ï¼Œå¯¼è‡´ç³»ç»Ÿæˆ–è€… APP è¢«é»‘å®¢å…¥ä¾µã€‚ ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-1/:4:3","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","KDF","å¯†ç å­¦","å®‰å…¨","å“ˆå¸Œ","åŠ è§£å¯†","ç­¾å"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸€ï¼‰â€”â€” æ¦‚è§ˆ","uri":"/posts/practical-cryptography-basics-1/#3-å®‰å…¨éšæœºæ•°"},{"categories":["tech"],"content":" 4. å¯†é’¥äº¤æ¢å¯†ç å­¦å®šä¹‰äº†å¯†é’¥äº¤æ¢ç®—æ³•ï¼ˆå¦‚ Diffie-Hellman å¯†é’¥äº¤æ¢å’Œ ECDHï¼‰å’Œå¯†é’¥æ„å»ºæ–¹æ¡ˆï¼Œç”¨äºåœ¨éœ€è¦å®‰å…¨ä¼ è¾“æ¶ˆæ¯çš„ä¸¤æ–¹ä¹‹é—´å®‰å…¨åœ°æ„å»ºåŠ å¯†å¯†é’¥ã€‚è¿™ç§ç®—æ³•é€šå¸¸åœ¨ä¸¤æ–¹ä¹‹é—´å»ºç«‹æ–°çš„å®‰å…¨è¿æ¥æ—¶æ‰§è¡Œï¼Œ ä¾‹å¦‚å½“ä½ æ‰“å¼€ä¸€ä¸ªç°ä»£ HTTPS ç½‘ç«™æˆ–è¿æ¥åˆ° WiFi ç½‘ç»œæ—¶ã€‚ ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-1/:4:4","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","KDF","å¯†ç å­¦","å®‰å…¨","å“ˆå¸Œ","åŠ è§£å¯†","ç­¾å"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸€ï¼‰â€”â€” æ¦‚è§ˆ","uri":"/posts/practical-cryptography-basics-1/#4-å¯†é’¥äº¤æ¢"},{"categories":["tech"],"content":" 5. åŠ å¯†å“ˆå¸Œä¸ Password å“ˆå¸Œå¯†ç å­¦æä¾›äº†åŠ å¯†å“ˆå¸Œå‡½æ•°ï¼ˆå¦‚ SHA-3 å’Œ BLAKE2ï¼‰å°†æ¶ˆæ¯è½¬æ¢ä¸ºæ¶ˆæ¯æ‘˜è¦/æ•°å­—æŒ‡çº¹ï¼ˆå›ºå®šé•¿åº¦çš„æ•£åˆ—ï¼‰ï¼Œç¡®ä¿æ— æ³•é€†å‘å‡ºåŸå§‹æ¶ˆæ¯ï¼Œå¹¶ä¸”å‡ ä¹ä¸å¯èƒ½æ‰¾åˆ°å…·æœ‰ç›¸åŒå“ˆå¸Œå€¼çš„ä¸¤æ¡ä¸åŒæ¶ˆæ¯ã€‚ ä¾‹å¦‚ï¼Œåœ¨åŒºå—é“¾ç³»ç»Ÿä¸­ï¼Œå“ˆå¸Œç”¨äºç”ŸæˆåŒºå—é“¾åœ°å€ã€äº¤æ˜“ ID ä»¥åŠè®¸å¤šå…¶ä»–ç®—æ³•å’Œåè®®ã€‚åœ¨ Git ä¸­ï¼Œ åŠ å¯†å“ˆå¸Œç”¨äºä¸ºæ–‡ä»¶å’Œæäº¤ç”Ÿæˆå”¯ä¸€ IDã€‚ è€Œå¯†é’¥æ´¾ç”Ÿå‡½æ•°ï¼ˆå¦‚ Scrypt å’Œ Argon2ï¼‰é€šè¿‡ä»åŸºäºæ–‡æœ¬çš„ Password å®‰å…¨åœ°æ´¾ç”Ÿå‡ºå“ˆå¸Œå€¼ï¼ˆæˆ–å¯†é’¥ï¼‰ï¼Œå¹¶ä¸”è¿™ç§ç®—æ³•è¿˜é€šè¿‡æ³¨å…¥éšæœºå‚æ•°ï¼ˆç›ï¼‰å’Œä½¿ç”¨å¤§é‡è¿­ä»£å’Œè®¡ç®—èµ„æºä½¿å¯†ç ç ´è§£é€Ÿåº¦å˜æ…¢ã€‚ å¯†ç å­¦æä¾›å¯†é’¥çš„ç”Ÿæˆæ‰‹æ®µã€‚å› ä¸ºäººç±»åªæ“…é•¿è®°å¿†å­—ç¬¦å½¢å¼çš„å¯†ç ï¼Œä½†æ˜¯å„ç§åŠ å¯†ç®—æ³•éœ€è¦çš„å¯†é’¥éƒ½æ˜¯ä¸€ä¸ªéå¸¸å¤§çš„ã€ä¿å¯†çš„æ•°å­—ï¼Œæ‰€ä»¥å¯†ç å­¦éœ€è¦æä¾›æ‰‹æ®µå°†å­—ç¬¦ä¸²è½¬æ¢æˆå¯†é’¥ã€‚ ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-1/:5:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","KDF","å¯†ç å­¦","å®‰å…¨","å“ˆå¸Œ","åŠ è§£å¯†","ç­¾å"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸€ï¼‰â€”â€” æ¦‚è§ˆ","uri":"/posts/practical-cryptography-basics-1/#5-åŠ å¯†å“ˆå¸Œä¸-password-å“ˆå¸Œ"},{"categories":["tech"],"content":" å››ã€æ··æ·†ä¸æ‰©æ•£åœ¨å¯†ç å­¦å½“ä¸­ï¼Œé¦™å†œæå‡ºçš„æ··æ·†ï¼ˆconfusionï¼‰ä¸æ‰©æ•£ï¼ˆdiffusionï¼‰æ˜¯è®¾è®¡å®‰å…¨å¯†ç å­¦ç®—æ³•çš„ä¸¤ä¸ªåŸåˆ™ã€‚ æ··æ·†ä½¿å¯†æ–‡å’Œå¯¹ç§°åŠ å¯†ä¸­å¯†é’¥çš„æ˜ å°„å…³ç³»å˜å¾—å°½å¯èƒ½çš„å¤æ‚ï¼Œä½¿ä¹‹éš¾ä»¥åˆ†æã€‚å¦‚æœä½¿ç”¨äº†æ··æ·†ï¼Œé‚£ä¹ˆè¾“å‡ºå¯†æ–‡ä¸­çš„æ¯ä¸ªæ¯”ç‰¹ä½éƒ½åº”è¯¥ä¾èµ–äºå¯†é’¥å’Œè¾“å…¥æ•°æ®çš„å¤šä¸ªéƒ¨åˆ†ï¼Œç¡®ä¿ä¸¤è€…æ— æ³•å»ºç«‹ç›´æ¥æ˜ å°„ã€‚ æ··æ·†å¸¸ç”¨çš„æ–¹æ³•æ˜¯ã€Œæ›¿æ¢ã€ä¸ã€Œæ’åˆ—ã€ã€‚ ã€Œæ‰©æ•£ã€å°†æ˜æ–‡çš„ç»Ÿè®¡ç»“æ„æ‰©æ•£åˆ°å¤§é‡å¯†æ–‡ä¸­ï¼Œéšè—æ˜æ–‡ä¸å¯†æ–‡ä¹‹é—´çš„ç»Ÿè®¡å­¦å…³ç³»ã€‚ä½¿å•ä¸ªæ˜æ–‡æˆ–å¯†é’¥ä½çš„å½±å“å°½å¯èƒ½æ‰©å¤§åˆ°æ›´å¤šçš„å¯†æ–‡ä¸­å»ï¼Œç¡®ä¿æ”¹å˜è¾“å…¥ä¸­çš„ä»»æ„ä¸€ä½éƒ½åº”è¯¥å¯¼è‡´è¾“å‡ºä¸­å¤§çº¦ä¸€åŠçš„ä½å‘ç”Ÿå˜åŒ–ï¼Œåè¿‡æ¥æ”¹å˜è¾“å‡ºå¯†æ–‡çš„ä»»ä¸€ä½ï¼Œæ˜æ–‡ä¸­å¤§çº¦ä¸€åŠçš„ä½ä¹Ÿå¿…é¡»å‘ç”Ÿå˜åŒ–ã€‚ æ‰©æ•£å¸¸ç”¨çš„æ–¹æ³•æ˜¯ã€Œç½®æ¢ã€ã€‚ è¿™ä¸¤ä¸ªåŸåˆ™è¢«åŒ…å«åœ¨å¤§å¤šæ•°å“ˆå¸Œå‡½æ•°ã€MAC ç®—æ³•ã€éšæœºæ•°ç”Ÿæˆå™¨ã€å¯¹ç§°å’Œéå¯¹ç§°å¯†ç ç®—æ³•ä¸­ã€‚ ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-1/:6:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","KDF","å¯†ç å­¦","å®‰å…¨","å“ˆå¸Œ","åŠ è§£å¯†","ç­¾å"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸€ï¼‰â€”â€” æ¦‚è§ˆ","uri":"/posts/practical-cryptography-basics-1/#å››æ··æ·†ä¸æ‰©æ•£"},{"categories":["tech"],"content":" äº”ã€å¯†ç åº“è¯´äº†è¿™ä¹ˆå¤šï¼Œä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œæˆ‘å­¦ä¹ å¯†ç å­¦çš„ç›®çš„ï¼Œæ˜¯ä¸ºäº†ææ‡‚å¦‚ä½•åœ¨ç¼–ç¨‹è¯­è¨€ä¸­ä½¿ç”¨ç°ä»£å¯†ç åº“ï¼Œ å¹¶ä»ä¸­æŒ‘é€‰åˆé€‚çš„ç®—æ³•ã€ä½¿ç”¨åˆé€‚çš„ API å‚æ•°ã€‚ ç¨‹åºå‘˜ç»å¸¸ä¼šè‡ªå˜²æ—¥å¸¸å¤åˆ¶ç²˜è´´ï¼Œä½†æ˜¯åœ¨ç¼–å†™æ¶‰åŠåˆ°å¯†ç å­¦çš„ä»£ç æ—¶ï¼Œä¸€å®šè¦è°¨æ…å¤„ç†ï¼ç›²ç›®åœ°ä» Internet å¤åˆ¶/ç²˜è´´ä»£ç æˆ–éµå¾ªåšå®¢ä¸­çš„ç¤ºä¾‹å¯èƒ½ä¼šå¯¼è‡´å®‰å…¨é—®é¢˜ï¼›æ›¾ç»å®‰å…¨çš„ä»£ç ã€ç®—æ³•æˆ–è€…æœ€ä½³å®è·µï¼Œéšç€æ—¶é—´çš„æ¨ç§»ä¹Ÿå¯èƒ½å˜å¾—ä¸å†å®‰å…¨ã€‚ æœ¬ç³»åˆ—æ–‡ç« çš„åç»­éƒ¨åˆ†ï¼Œä¼šåˆ†åˆ«ä»‹ç»ä¸Šè¿°å¯†ç å­¦æ¦‚å¿µï¼Œå¹¶ä½¿ç”¨ Python æ¼”ç¤ºå…¶ç”¨æ³•ï¼Œå…¶ä»–è¯­è¨€çš„å†™æ³•ç½‘ä¸Šä¹Ÿå¾ˆå®¹æ˜“æ‰¾åˆ°ã€‚ ","date":"2022-03-01","objectID":"/posts/practical-cryptography-basics-1/:7:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["Cryptography","Hash","KDF","å¯†ç å­¦","å®‰å…¨","å“ˆå¸Œ","åŠ è§£å¯†","ç­¾å"],"title":"å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸€ï¼‰â€”â€” æ¦‚è§ˆ","uri":"/posts/practical-cryptography-basics-1/#äº”å¯†ç åº“"},{"categories":["life"],"content":" æœ¬æ–‡è½¬è½½è‡ªæœ‹å‹å†™çš„å†™ç»™ä¼˜ç§€ç¨‹åºå‘˜çœ‹çš„é©¬æ‹‰æ¾æŒ‡å—ğŸƒ - Chuanyiï¼Œ è¯»ä¸‹æ¥æ„Ÿè§‰å†™å¾—è¶…æ£’è¶…æ­£èƒ½é‡ï¼Œå¾å¾—ä»–åŒæ„åè½¬è½½è¿‡æ¥åˆ†äº«ä¸‹å˜¿å˜¿~ æ–‡ä¸­æœ¯è¯­ï¼šPB(Personal Best) PW(Personal Worst) BQ(Boston Qualify) 4 æœˆ 11 æ—¥ï¼Œæ°”æ¸© 16-19 åº¦ï¼Œä¸œé£ã€‚å‰ä¸¤å¤©çœ‹é¢„æŠ¥ï¼Œè¯´å¯èƒ½ä¼šæœ‰é›·é˜µé›¨ï¼Œå½“å¤©çœ‹é¢„æŠ¥ï¼Œé›·é˜µé›¨åˆå»¶ååˆ°äº†ä¸‹åˆä¸¤ç‚¹å¤šï¼ŒçœŸæ˜¯å¤©å…¬ä½œç¾å•Šã€‚æ—©ä¸Šå…«ç‚¹æ°”æ¸©éå¸¸èˆ’é€‚ï¼Œæˆ‘é¢„æ„Ÿåˆ°æˆ‘åˆè¦ PB äº†ã€‚ ä»Šå¹´ä»™é©¬çš„è·¯çº¿éå¸¸å¹³ç¨³ï¼Œèµ·ä¼ä¸åˆ°ä¸‰åç±³ã€‚æ­£æ˜¯å†œå†è‰é•¿èºé£äºŒæœˆå¤©ï¼Œæ²¿é€”æ˜¥æ„ç›ç„¶ï¼Œä»¤äººå¿ƒæƒ…æ„‰æ‚¦ã€‚åªæ˜¯åå…¬é‡Œå¤„çš„æŠ˜è¿”ç‚¹éå¸¸æ¼äººï¼Œæ‹å¼¯åè·‘å‡ºå‡ åç±³å°±ç«‹åˆ»æŠ˜è¿”å†æ¬¡æ‹å¼¯ï¼Œå‡é€Ÿåˆ° 0 å¹¶å†æ¬¡åŠ é€Ÿæµªè´¹äº†æ•°ç§’ã€‚æˆ‘çŸ¥é“æ­¤ä¸¾æ˜¯ä¸ºäº†å‡‘è·ç¦»ï¼Œä½†æ˜¯å®Œå…¨å¯ä»¥å–æ¶ˆè¿™ä¸ªæŠ˜è¿”ç‚¹ï¼Œå»¶é•¿ç»ˆç‚¹ã€‚è·¯çº¿ä¸Šçš„è¿™ä¸ªå‡¸èµ·ï¼Œä¸ç¦è®©æˆ‘è”æƒ³åˆ° Ph.D çš„ä½¿å‘½ã€‚ ä¸€ååšå£«çš„ä½¿å‘½ ä»™é©¬å››å¹´ï¼Œå£°åé¹Šèµ·ï¼Œä¸€è·¯æ‘˜å¾—é“œç‰Œã€é“¶ç‰Œã€é‡‘ç‰Œï¼Œä»Šå¹´åˆè¢«ã€Œä¸–ç•Œç”°å¾„ã€Œæ­£å¼åˆ—ä¸ºæ ‡ç‰Œèµ›äº‹ï¼Œè¿™äº›å¹´å‡ºåœˆçš„åŠªåŠ›å’Œæˆæœéƒ½è•´å«åœ¨è¿™ä¸ªå°–å°–ä¸Šäº†ï¼Œæˆ‘å¦‚æ­¤è§£è¯»ï¼Œç»„å§”ä¼šåº”è¯¥æ²¡æœ‰æ„è§å§ã€‚ 4 æœˆ 11 æ—¥æ—©ä¸Šï¼Œä¸œé£ä¸‰çº§ï¼Œèµ·æ­¥å‘ä¸œï¼Œæœ‰äº›é€†é£ï¼Œä¸åˆ©ã€‚å¹é¢ä¸å¯’æ¨æŸ³é£ï¼Œé€†é£å¸¦æ¥äº†å‡‰çˆ½ï¼Œä¸€è·¯æ±—æ°´éƒ½è¢«å¹å¹²ï¼Œå…¨èº«ä¸Šä¸‹å§‹ç»ˆéƒ½ä¿æŒç€å¹²ç‡¥èˆ’é€‚ã€‚ ç¬¬ä¸€å…¬é‡Œè®¡åˆ’æ˜¯äº”åˆ†é…ï¼Œä½†æ˜¯å¤ªè¿‡äºå…´å¥‹ï¼Œæœ‰äº›å¤±æ§ï¼Œä½†ä»ç„¶å‹ç€ 440ï¼›åäº”å…¬é‡ŒçŠ¶æ€æ¥ä¸´ï¼Œé€æ¸å°†é…é€Ÿæåˆ°å¹¶ä¿æŒåœ¨ 430ï¼›å…­å…¬é‡Œå¤šè¿æ¥ä¸€ä¸ªå—åŒ—èµ°å‘çš„ä¸‹å¡ï¼Œå€Ÿç€åŠ¿èƒ½çš„é‡Šæ”¾ï¼Œé…é€Ÿæ‹‰åˆ° 410 ä»¥å†…ã€‚ç”±å—å‘åŒ—ï¼Œæ˜¥é£æ‹‚é¢ï¼Œå¤¹é“æ¨±èŠ±ï¼Œè½è‹±ç¼¤çº·ï¼Œæˆ‘è¸©ç€ç¢³æ¿ï¼Œå¥½åƒè¸ç€ç²‰è‰²çš„äº‘éœã€‚æ­¤æ—¶æ‰‹è¡¨å´ä¸€ç›´åœ¨è€³æœºé‡Œæé†’æˆ‘é…é€Ÿè¿‡é«˜ï¼Œæœºå™¨ç»ˆå½’æ˜¯æ— æƒ…çš„ï¼Œä¸æ‡‚é£æœˆï¼Œéš¾çŸ¥æˆ‘å¿ƒï¼›ä¸ƒåˆ°åå…­å…¬é‡ŒæŠ˜è¿”ç‚¹ç»ˆäºå¼€å§‹é¡ºé£ï¼Œæ­¤æ—¶æˆ‘ç¨³å®šäº† 4:25 ä¸Šä¸‹é…é€Ÿï¼Œå–äº†ä¸¤æ¬¡æ°´ï¼Œæ„Ÿè§‰è¿˜ä¸é”™ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆç—›è‹¦ã€‚åäºŒå…¬é‡Œï¼Œä¸ºäº†é˜²æ­¢ä¸´è¿‘ç»ˆç‚¹åŠ›é‡ä¸è¶³ï¼Œæˆ‘æå‡ºä¸€ä¸ªæŸ æª¬å‘³èƒ½é‡èƒ¶ï¼Œè¿…é€ŸæŒ¤åœ¨å˜´é‡Œï¼Œå¹¶åœ¨åé¢çš„æ°´ç«™å–äº†ä¸€æ¯æ°´ã€‚åˆ°äº†åä¸‰å…¬é‡Œå¤–å·²ç»èƒ½çœ‹è§æŠ˜è¿”çš„ç¬¬ä¸€æ¢¯é˜Ÿäº†ï¼› åå…­å…¬é‡ŒæŠ˜è¿”å¼€å§‹ä¸€ä¸ªé•¿è¾¾ä¸‰å…¬é‡Œçš„ç¼“å¡ï¼Œä¸­é€”å¬è§ä¸€ä½å¤§å“¥åœ¨å’ŒåŒä¼´è°ˆè®ºåé¢å¦‚ä½•å¦‚ä½•éš¾è·‘ã€‚ä»¥æˆ‘çš„çŠ¶æ€çœ‹æ¥ï¼Œæˆ‘ä¸ä»¥ä¸ºç„¶ï¼Œç¼“å¡æ²¡è®©æˆ‘å¤±é€Ÿå¤ªå¤šã€‚åä¹å…¬é‡Œè·¯è¿‡æˆ‘çš„æ¯æ ¡åŒ—é—¨ï¼Œé—¨å£æœ‰æˆ‘æ ¡ä¼ ç»Ÿè‰ºèƒ½èˆé¾™èˆç‹®ï¼Œä¸è¿‡PB ç›®æ ‡ä¸å…è®¸æˆ‘é©»è¶³æ‹ä¸€å¼ ï¼Œæœ‰äº›é—æ†¾ï¼›è¶Šè·‘è¶Šæ¬¢ï¼Œè½¬çœ¼äºŒåå…¬é‡Œï¼Œå‰æ–¹æ˜¯ç†Ÿæ‚‰çš„æ ¡å‹å›¢æœï¼Œè¿½ä¸Šå‰å»çœ‹ï¼Œæ˜¯å¼ ä¹¦è®°ï¼Œæ‰“äº†æ‹›å‘¼åï¼Œæˆ‘ä¾¿å…¨åŠ›å†²åˆºï¼Œæœ€ç»ˆæˆç»© 133ï¼Œæ„æ–™ä¹‹å¤–ï¼Œæƒ…ç†ä¹‹ä¸­ï¼Œ å†¬å¤©å †æœ‰æ°§çš„æ•ˆæœä½“ç°äº†ã€‚ é’æ˜¥ä»™æ—ï¼Œå¤§çˆ±ä»™é©¬ã€‚17 å¹´é¦–å±Šï¼Œé—¨å¤–æ±‰ï¼Œé—¨å¤–çœ‹ï¼›18å¹´å…¥é—¨ï¼Œé™ˆå­è±ªï¼ˆ2016 å¹´å—äº¬å¸‚å¤§å­¦ç”Ÿè¿åŠ¨ä¼š 1500 ç±³å† å†›ç”°å¾„å°éœ¸ç‹2016å¹´å—äº¬å¸‚è¿ä¼š1500mä¸€éª‘ç»å°˜ï¼ï¼‰ å¸¦æˆ‘ä»¬åœ¨ä»™æ—æ ¡åŒºå¼€å§‹ç»ƒï¼Œä¸€åœˆåˆšå¥½å°±æ˜¯ 5km çš„ç»ä½³è·‘åœºã€‚19 å¹´ç»ˆäºå‚åŠ äº†æˆ‘çš„ç¬¬ä¸€æ¬¡ä»™é©¬ï¼Œå»å¹´ä»™é©¬å› ç–«æƒ…åœåŠä¸€å¹´ï¼Œæ—¶éš”ä¸€å¹´åå†æ¬¡å›å½’ã€‚æ•…åœ°é‡æ¸¸ï¼Œå–å¾— PBï¼Œè¿™æ®µä»™é©¬è®°å¿†æ°¸è¿œä¸ä¼šæ–‘é©³ã€‚ ä»™é©¬æˆç»©è¯ä¹¦ ç¬¬ä¸ƒåœºåŠç¨‹äº†, æˆç»©ä¸€è·¯æå‡ï¼Œ156 =\u003e 149 =\u003e 147 =\u003e null =\u003e 157 =\u003e 138 =\u003e 133ï¼Œæ¯æ¬¡çš„è¿›æ­¥éƒ½ä¼šä»¤æˆ‘æ— æ¯”æ¿€åŠ¨ã€‚ ç”Ÿæ´»å¥½ä¼¼ä¸€ä¸ªæ¹–æ³Šï¼Œå¹³æ°´å¦‚é‰´ï¼Œå²æœˆé™å¥½ï¼Œå›ºç„¶ä¼˜é›…ï¼›ä½†ä¸æµåŠ¨çš„æ°´æ˜¯å®¹æ˜“è…è´¥çš„ï¼Œéœ€è¦ä¸€äº›å¤–æ¥çš„æ‰°åŠ¨ï¼Œç‹‚é£éª¤é›¨ä¹‹ä¸‹ï¼ŒæµŠæµªç¿»æ»šï¼Œå´ä¹Ÿæ³¨å…¥äº†å…¨æ–°çš„ç”Ÿå‘½åŠ›ã€‚æ¯æ¬¡ PB éƒ½æ˜¯æˆ‘å¯¹è¿™å¹³é™ç”Ÿæ´»ç‹‚é£æš´é›¨ä¸€èˆ¬çš„æ‹·é—®ï¼Œæˆ‘çš„ç”Ÿå‘½åŠ›ä¸åº”è¯¥åªå±€é™åœ¨é’¢ç­‹æ°´æ³¥ä¹‹é—´ã€‚ ","date":"2022-02-26","objectID":"/posts/likenttt-2021-04-11-xianlin-half-marathon-1_33_12/:0:0","series":null,"tags":["é•¿è·‘","é©¬æ‹‰æ¾","è¿åŠ¨"],"title":"ã€Œè½¬ã€ä»™é©¬èµ›è®°â€”â€”æˆ‘åˆ PB äº†","uri":"/posts/likenttt-2021-04-11-xianlin-half-marathon-1_33_12/#"},{"categories":["life"],"content":" æœ¬æ–‡è½¬è½½è‡ªæœ‹å‹å†™çš„å†™ç»™ä¼˜ç§€ç¨‹åºå‘˜çœ‹çš„é©¬æ‹‰æ¾æŒ‡å—ğŸƒ - Chuanyiï¼Œ è¯»ä¸‹æ¥æ„Ÿè§‰å†™å¾—è¶…æ£’è¶…æ­£èƒ½é‡ï¼Œå¾å¾—ä»–åŒæ„åè½¬è½½è¿‡æ¥åˆ†äº«ä¸‹å˜¿å˜¿~ æœ¬æ–‡æ‰€æè¿°çš„å¹¿å·é©¬æ‹‰æ¾èµ›äº‹æ—¶é—´ä¸º 2020-12-13 æ–‡ä¸­æœ¯è¯­ï¼šPB(Personal Best) PW(Personal Worst) BQ(Boston Qualify) ","date":"2022-02-26","objectID":"/posts/likenttt-2020-12-13-guangzhou-marathon-3_30_15/:0:0","series":null,"tags":["é•¿è·‘","é©¬æ‹‰æ¾","è¿åŠ¨"],"title":"ã€Œè½¬ã€MIRTå‡ºå¾å¹¿é©¬â€”â€”é¦–æ¬¡æ‘¸åˆ°330çš„è¾¹å„¿","uri":"/posts/likenttt-2020-12-13-guangzhou-marathon-3_30_15/#"},{"categories":["life"],"content":" èµ›å‰è®¡åˆ’ç›®æ ‡æˆç»©ï¼š3:37 å¹³å‡é…é€Ÿï¼š5:08 å‰21km 5:13 åŠ å‡ 5s å21km 5:03 åŠ å‡ 5s å®é™…ï¼š3:30:15 ","date":"2022-02-26","objectID":"/posts/likenttt-2020-12-13-guangzhou-marathon-3_30_15/:1:0","series":null,"tags":["é•¿è·‘","é©¬æ‹‰æ¾","è¿åŠ¨"],"title":"ã€Œè½¬ã€MIRTå‡ºå¾å¹¿é©¬â€”â€”é¦–æ¬¡æ‘¸åˆ°330çš„è¾¹å„¿","uri":"/posts/likenttt-2020-12-13-guangzhou-marathon-3_30_15/#èµ›å‰è®¡åˆ’"},{"categories":["life"],"content":" è¡¥ç»™èƒ½é‡èƒ¶6æ”¯ ç»¿ç°ç»¿ç°é»„çº¢ æœç”¨æ—¶æœº é¢œè‰² èµ›å‰5åˆ†é’Ÿ ç»¿ 10 ç° 20 ç»¿ 30 ç° 35 é»„ 40 çº¢ ","date":"2022-02-26","objectID":"/posts/likenttt-2020-12-13-guangzhou-marathon-3_30_15/:2:0","series":null,"tags":["é•¿è·‘","é©¬æ‹‰æ¾","è¿åŠ¨"],"title":"ã€Œè½¬ã€MIRTå‡ºå¾å¹¿é©¬â€”â€”é¦–æ¬¡æ‘¸åˆ°330çš„è¾¹å„¿","uri":"/posts/likenttt-2020-12-13-guangzhou-marathon-3_30_15/#è¡¥ç»™"},{"categories":["life"],"content":" èµ›ä¸­ç®€è®°æˆ‘å’Œå…´å‹‡å¸ˆå…„ä¸€èµ·ä» C åŒºå‡ºå‘ï¼ŒæŒ‰ç…§ 500 é…é€Ÿè·‘ï¼Œè§‚å¯ŸçŠ¶æ€ã€‚ ä¹å…¬é‡Œå¤„è¿½ä¸Šæ—¦å“¥ï¼Œæ—¦å“¥æ­¤æ¬¡æ‹…ä»» 345 Pacer ï¼Œèµ›å‰ä»–å‘æˆ‘ä»¬è®¸è¯ºï¼Œå¦‚æœèƒ½è¿½ä¸Šä»–å°±èƒ½æ‘¸ä¸€æ‘¸ä»–çš„å…‰å¤´ã€‚è¯´å®è¯ï¼Œæˆ‘å¯¹è¿™é¢—å…‰å¤´æ˜¯å‚æ¶å·²ä¹…ï¼Œå¿ƒæƒ³è¿™æ˜¯ç½•æœ‰çš„æœºä¼šï¼Œèˆæˆ‘å…¶è°ã€‚å½“æˆ‘è¿œè¿œåœ°æœ›è§é£˜åŠ¨çš„æ°”çƒæ—¶ï¼Œæˆ‘å°±å¿ä¸ä½å…´å¥‹çš„å‘¼å–Šæ—¦å“¥ï¼Œæ¸æ¸è·ç¦»è¿«è¿‘åˆ°æ•°ç±³ï¼Œæ—¦å“¥å¿ƒç…§ä¸å®£åœ°å…‘ç°æ‰¿è¯ºï¼Œä¸»åŠ¨ä¼¸è¿‡ä»–çš„å¤´ï¼Œ è®©æˆ‘æ‘¸ã€‚ç´§å®çš„å…‰å¤´æ»¡æ˜¯æ±—æ°´ï¼Œå¾ˆæ»‘ï¼Œç«Ÿæ²¡æœ‰ä¸€ä¸å¤´å‘ï¼Œæ—¢ä¸æ‰æ‰‹ä¹Ÿæ²¡æœ‰é˜»æ»æ„Ÿï¼Œåƒæäº†ä¸€é¢—å‰¥äº†å£³çš„é¸¡è›‹ï¼Œæˆ‘ä¸€ä¸ªç¨‹åºå‘˜ä¹Ÿä¸ç¦ä¸ºä¹‹åŠ¨å®¹ï¼Œè®¾è®¡å¸ˆï¼ˆæ—¦å“¥æ˜¯ä¸€åå£°éŸ³è®¾è®¡å¸ˆï¼‰è¿™ä¹ˆä¼¤å¤´å‘å—ï¼Œå¹¸äºæˆ‘æ²¡å…¥è¿™è¡Œã€‚å¸ˆå…„å†³æ„ä¸€è·¯è·Ÿç€æ—¦å“¥ï¼Œæˆ‘é‚å’Œä»–åˆ†åˆ«ï¼Œå»è¿½èµ¶ 330 å…”å­ï¼Œé…é€Ÿå§‹ç»ˆç¨³å®šåœ¨ 450ï½500ã€‚ æ­¤åè‡³ 38km ä¹‹é—´é…é€Ÿç¨³å®šåœ¨è¿™ä¸ªåŒºé—´é‡Œï¼Œçœ‹çœ‹é£æ™¯ï¼Œèƒ¡æ€ä¹±æƒ³ã€‚çŒå¾·å¤§æ¡¥æ˜¯ä¸€ä¸ªä¸å°çš„æŒ‘æˆ˜ï¼Œè¿‚å›å†²å¡ä¸Šå¼•æ¡¥ï¼Œä¸‹æ¡¥å‡é€Ÿç»•å¼¯å¼¯ï¼Œèµ·ä¼ä¹‹é—´å®¹æ˜“è·‘å´©ï¼Œä½†æˆ‘å§‹ç»ˆå¹³ç¨³ã€‚ä¸‹äº†æ¡¥æ˜¯ä¸€ä¸ªè¶…é•¿çš„æŠ˜è¿”ï¼ŒåŒå‘è½¦é“è¢«ç»¿åŒ–å¸¦åˆ‡å¼€ï¼Œæœ¨æ£‰ï¼ˆä¹Ÿè®¸æ˜¯åˆæ¬¢ï¼‰ä¸€å­—æ’å¼€ï¼Œæ ‘å¹²è·Ÿä¿é¾„çƒä¸€æ ·è‡ƒè‚¿ç²—å£®ï¼Œè‰åœ°ä¸Šæ´’æ»¡äº†ç²‰çš„èŠ±ï¼Œç™½çš„ç©—ï¼Œè¿™å—å›½çš„å†¬å¤©ç«Ÿç„¶å¥½ä¼¼æ±Ÿå—çš„æ¨±èŠ±å­£ã€‚å»ç¨‹å·¦å‰æ–¹å·²ç»ç¨€ç¨€è½è½åœ°æœ‰äººæŠ˜å›ï¼Œèƒ½æ‹‰å¼€è¿™ä¹ˆå¤šè·ç¦»ï¼Œæ˜¯ç²¾è‹±é€‰æ‰‹æ— ç–‘äº†ï¼Œä»–ä»¬è·‘å§¿å¤§å¤šéƒ½å¾ˆç¾è§‚ï¼Œæœè£…ã€é…ä»¶ã€æ‘†è‡‚ã€è¸æ­¥ä»¤æˆ‘æ¬£èµäº†å¥½ä¸€é˜µã€‚ä½†æ˜¯ä¹Ÿæœ‰ä¸€äº›è·‘è€…ï¼Œè·‘å§¿ä¸é‚£ä¹ˆå…·æœ‰è§‚èµæ€§çš„ï¼Œç”¨åŠ›è¿‡åº¦ï¼Œå§¿åŠ¿åƒµç¡¬ï¼ŒåŠ›é‡è¿ç”¨åœ°ä¸å¤ªç»æµï¼Œè¿‘ä¼¼ä¸€ç§æš´åŠ›ç¾å­¦äº†ï¼Œæˆ‘è®¤ä¸ºä»–ä»¬ä¸­æœ‰ä¸€äº›äººåªæ˜¯æš‚æ—¶é¢†å…ˆè€Œå·²ã€‚åæ¥æˆ‘ä¹ŸæŠ˜è¿”äº†ï¼Œæ­¤æ—¶å†å¾€å·¦å‰æ–¹çœ‹ï¼Œäººç¾¤å¼€å§‹å¯†é›†äº†èµ·æ¥ï¼Œè¿™ç§è§†è§’ä»¿ä½›å’ŒåŸæ¥çš„è‡ªå·±æ‰“äº†ä¸ªç…§é¢ã€‚ç›®å…‰æ•°æ¬¡å’Œå‡ ä¸ªèšé›†çš„é…é€Ÿå‘˜é›†å›¢ç›¸é‡ï¼Œæˆ‘è¯•å›¾åœ¨äººç¾¤ä¸­åˆ†è¾¨å‡ºæˆ‘çš„é˜Ÿå‹ä»¬ï¼Œå´å§‹ç»ˆæœç´¢æ— è·ï¼Œæˆ‘æ•°åº¦æ€€ç–‘æ˜¯ä¸æ˜¯æˆ‘å·²ç»èµ°ç¥å„¿é”™è¿‡äº†ä»–ä»¬ã€‚21km é™„è¿‘å‡ ä¸ªéš§é“ä¹Ÿæ˜¯ä¸å°çš„æŒ‘æˆ˜ï¼ŒUå‹éš§é“èµ·ä¼å¤§ï¼Œä¸‹å¡è¦é€‚å½“åˆ©ç”¨åŠ¿èƒ½ä½†ä¹Ÿè¦é¿å…å¿ƒç‡è¿‡é«˜ï¼Œä¸Šå¡è¦é€‚å½“å‡é€Ÿå¢åŠ æŠ“åœ°åŠ›ï¼Œåœ°é¢æ¹¿æ»‘ï¼Œæ‘©æ“¦ç³»æ•°å‡å°ï¼Œè¦é˜²æ­¢æ»‘å€’ã€‚è¿‡äº†åŠç¨‹ä»¥åï¼Œå¹¿å·å¡”è¿‘åœ¨å’«å°ºï¼Œä»°ä¹‹å¼¥é«˜ï¼Œæˆ‘çš„ç²¾ç¥è¿˜å¾ˆè½»æ¾ï¼Œå†³å®šé’»ä¹‹å¼¥åšã€‚ ä»Šå¤©æ˜¯å›½å®¶å…¬ç¥­æ—¥ï¼Œåç‚¹ï¼Œè„‘å­é‡Œæƒ³åˆ°å—äº¬åŸæ­¤æ—¶åº”è¯¥é¸£ç¬›çš„ï¼Œä¸ç¦çƒ­æ³ªç›ˆçœ¶ï¼Œéšåå¿ƒä¸­é»˜å“€äº†ä¸€åˆ†å¤šé’Ÿã€‚æ˜­æ˜­å‰äº‹ï¼Œæƒ•æƒ•åäººã€‚æ°¸çŸ¢å¼—è°–ï¼Œç¥ˆæ„¿å’Œå¹³ã€‚ å¤©æ°”é¢„æŠ¥æ˜¾ç¤ºä»Šæ—¥æ°”æ¸©åœ¨ 21ï½22 åº¦ï¼Œä½†æ¹¿åº¦è¾ƒå¤§ï¼Œä½“æ„Ÿæ¸©åº¦é«˜äº 22 åº¦ã€‚å¥½åœ¨ç©¿çš„æ˜¯èƒŒå¿ƒï¼Œä½“è¡¨æ•£çƒ­é¢ç§¯å¤§ï¼Œå¿ƒç‡å§‹ç»ˆæ§åˆ¶åœ¨ 175 ä»¥ä¸‹ã€‚æ¯é€¢æ°´ç«™å–ä¸€å°æ¯æ°´ï¼Œæ¯äº”å…¬é‡Œåƒä¸¤ç‰‡ç›ä¸¸ï¼ŒæŒ‰ç€è®¡åˆ’åƒèƒ½é‡èƒ¶ã€‚å¾—ç›Šäºä»¥ä¸Šç§ç§åŠªåŠ›ï¼Œå‰ 38 å…¬é‡Œéƒ½è¿˜è½»æ¾ï¼Œç”šè‡³æ¸¸åˆƒæœ‰ä½™ã€‚ä½†æ˜¯ç¬¬ 39 å…¬é‡Œæˆ‘å¼€å§‹æ„Ÿåˆ°ç–²æƒ«ï¼Œæ„Ÿåˆ°åŒå€¦ï¼Œçœ‹çœ‹æ‰‹è¡¨ï¼Œå‘ç°å¿ƒç‡å·²ç»åˆ°è¾¾ 189ï¼Œå¿ƒä¸‹æƒ³è¿™æ˜¯ç»ˆç‚¹å‰è·‘å´©çš„å‰å…†å•Šã€‚ä¸€ä¸ªå¤šæœˆå‰æ— é”¡é©¬æ‹‰æ¾æŠ˜æˆŸçš„ç»å†è¿˜ä»¤æˆ‘å¿ƒæœ‰ä½™æ‚¸ã€‚ç¬¬ 39 å’Œ 40 å…¬é‡Œåˆ†åˆ«è·‘å‡ºäº† 521 å’Œ 523 çš„é…é€Ÿï¼Œå¿ƒé‡Œå¾ˆæ…Œã€‚åˆ°è¾¾æ°´ç«™åï¼Œå†åº¦è¡¥å……ç›ä¸¸å’Œèƒ½é‡èƒ¶ï¼Œå¹¶ä¸æ–­ç»™è‡ªå·±åšå¿ƒé‡Œå»ºè®¾å·¥ä½œï¼šè¿™æ˜¯éš¾å¾—çš„æœºé‡ï¼Œè·‘å›¢å—ä¸‹é¦–ç§€ï¼Œé›†å›¢ç»™äº†è«å¤§æ”¯æŒï¼Œè·‘å›¢ç»„å§”ä¼šä¹Ÿåšäº†å¤§é‡ç­¹å¤‡ï¼›å¹´åˆ PB(Personal Best)ï¼Œå¹´å°¾ PW(Personal Worst)ï¼Œæœ‰ç‚¹è™å¤´è›‡å°¾ï¼Œæ¥ä¸‹æ¥ï¼ŒåšæŒé–æˆ˜ï¼Œåæ‚”å‡ å¤©ï¼Œæ”¾å¼ƒèººå€’ï¼Œæ‡Šæ‚”åŠå¹´ã€‚åƒå®Œæœ€åä¸€æ”¯æŸ æª¬å‘³çš„èƒ½é‡èƒ¶ï¼Œå–é¥±äº†æ°´ï¼Œé‡æ–°å‡ºå‘ã€‚æœ€åä¸¤å…¬é‡Œè·‘å› 451 é…é€Ÿï¼Œå®‰å…¨å®Œèµ›å¹¶ PBã€‚å†²è¿‡ç»ˆç‚¹ï¼Œé¡¿æ—¶æ„Ÿåˆ°ä¸€ç§è¶…ç„¶ğŸ¤¯çš„è½»å¿«ï¼Œå¹¿å·æ˜¯ä¸€åº§å……æ»¡å¸Œæœ›çš„åŸå¸‚ï¼ä¸è¿‡å·® 15 ç§’å°±èƒ½è¾¾åˆ°å¹¿é©¬çš„ BQ(Boston Qualify)ï¼Œä»ç„¶æœ‰ä¸€ä¸é—æ†¾ã€‚ä½†æ— è®ºå¦‚ä½•ï¼Œå–å¾—è¿™æ ·çš„æˆç»©æˆ‘å·²ç»å¾ˆæ»¡æ„äº†ã€‚ æˆ‘å¾ˆåº†å¹¸ï¼Œä»å­¦ç”Ÿæ—¶ä»£å°±åŸ¹å…»èµ·æ¥çš„é•¿è·‘çˆ±å¥½ï¼Œå¯ä»¥é™ªä¼´æˆ‘èµ°è¿›èŒä¸šç”Ÿæ¶¯å¹¶é¡½å¼ºä¿æŒè‡³ä»Šï¼Œä¸€è·¯ä¸Šæˆ‘æ”¶è·ä¸€ç¾¤äº’ç›¸ç ¥ç ºæ”¯æŒçš„å¥½æœ‹å‹ã€‚æ˜“æ–¹è¾¾åŸºé‡‘çš„ sloganï¼šä¹äºåœ¨é•¿è·‘ä¸­å–å¾—èƒœåˆ©ï¼Œè¿™ä¹Ÿæ˜¯å¹¿é©¬é‡è¦æ”¶è·ä¹‹ä¸€ã€‚èƒœåˆ©ï¼ŒæŒ‡æŒ‘æˆ˜å¹¶è¶…è¶Šè¿‡å»çš„è‡ªå·±ï¼Œbeat yesterdayã€‚å¯„äºˆå¸Œæœ›ï¼Œå¹¶ä¸æ–­æŒ‘æˆ˜è¶…è¶Šï¼Œè¿™æ˜¯ä¸€ç§ç—›å¹¶å¿«ä¹ç€çš„å¹¸ç¦ã€‚é•¿è·‘å¦‚æ­¤ï¼Œç”Ÿæ´»èŒä¸šäº¦å¦‚æ˜¯ã€‚ ","date":"2022-02-26","objectID":"/posts/likenttt-2020-12-13-guangzhou-marathon-3_30_15/:3:0","series":null,"tags":["é•¿è·‘","é©¬æ‹‰æ¾","è¿åŠ¨"],"title":"ã€Œè½¬ã€MIRTå‡ºå¾å¹¿é©¬â€”â€”é¦–æ¬¡æ‘¸åˆ°330çš„è¾¹å„¿","uri":"/posts/likenttt-2020-12-13-guangzhou-marathon-3_30_15/#èµ›ä¸­ç®€è®°"},{"categories":["life"],"content":" æŠ€æœ¯æ€»ç»“ å¹¿é©¬å½“å¤©é«˜è¾¾äºŒåå¤šæ‘„æ°åº¦ï¼Œé€šå¸¸æ¥è¯´ï¼Œè¿™æ ·çš„æ¸©åº¦å¹¶ä¸ç‰¹åˆ«å‹å¥½ï¼Œæ— ç–‘ï¼Œè¿™ä¸°å¯Œäº†æˆ‘é«˜æ¸©ä½œæˆ˜çš„ç»éªŒã€‚åŠæ—¶è¡¥ç»™ï¼Œç›ä¸¸å’Œèƒ½é‡èƒ¶ï¼Œå¦‚æœå¤©çƒ­å°¤å…¶è¦è¡¥æ°´å’Œç›ä¸¸ã€‚åæ¥å’Œæ—¦å“¥å¤ç›˜ï¼Œæˆ‘æŠ±æ€¨é“ä¸­é€”è¡¥å……äº†ä¹æ¬¡æ°´ï¼Œåé¢å‡ ä¹é€¢æ°´ç«™å¿…åœã€‚æ—¦å“¥è¯´ï¼šå¦‚æœä½ ä¸è¡¥æ°´ï¼Œä½ æ€ä¹ˆä¿è¯åé¢ä¸ä¼šå´©å‘¢ï¼Ÿæˆ‘æç„¶å¤§æ‚Ÿï¼Œåƒåˆ°ç¬¬ä¸ªä¸‰é¦’å¤´é¥±äº†ï¼ŒåŠŸåŠ³ç»ä¸åªæ˜¯ç¬¬ä¸‰ä¸ªé¦’å¤´çš„ï¼Œå‰ä¸¤ä¸ªé¦’å¤´äº¦æ˜¯å…³é”®ã€‚ é¢„å…ˆè§„åˆ’å¥½æ—¶é—´å’Œé…é€Ÿã€‚æ ¹æ®ç›®çš„ä¼°ç®—å¹¶ä¸¥æ ¼æ‰§è¡Œã€‚å¦‚æœæ˜¯è·‘æˆç»©ï¼Œä¸è¦é«˜ä¼°ï¼Œé¿å…è¿‡åº¦é€æ”¯èƒ½åŠ›ï¼Œä¹Ÿä¸è¦ä½ä¼°ï¼Œä¸€ç›´èººåœ¨èˆ’é€‚çš„æˆç»©ä¸Šã€‚ çƒŸé›¾å¼¹è¿˜æ˜¯è¦æ”¾çš„ï¼Œè¿™æ˜¯èµ›å‰ä¹è¶£æ‰€åœ¨ï¼ŒçƒŸé›¾å¼¹æ”¾å‡ºå»äº†ï¼Œè¿›å¯å‡¡å­¦ï¼Œé€€å¯åŠ¡å®ã€‚ è®­ç»ƒéœ€è¦æ³¨æ„æé«˜ä½“èƒ½å’Œå¿ƒç†æ‰¿å—é˜ˆå€¼ã€‚ä½“èƒ½è€—å°½ï¼Œå…¶åæ˜¯å¿ƒæœ‰ä½™è€ŒåŠ›ä¸è¶³ï¼›å¿ƒæ€å´©æºƒï¼Œæ— å¿ƒå†æˆ˜ï¼Œå…ˆå‰åŠªåŠ›ä¾¿ä¿±ä»˜ä¸œæµã€‚ ","date":"2022-02-26","objectID":"/posts/likenttt-2020-12-13-guangzhou-marathon-3_30_15/:3:1","series":null,"tags":["é•¿è·‘","é©¬æ‹‰æ¾","è¿åŠ¨"],"title":"ã€Œè½¬ã€MIRTå‡ºå¾å¹¿é©¬â€”â€”é¦–æ¬¡æ‘¸åˆ°330çš„è¾¹å„¿","uri":"/posts/likenttt-2020-12-13-guangzhou-marathon-3_30_15/#æŠ€æœ¯æ€»ç»“"},{"categories":["tech"],"content":" ä¸ªäººç¬”è®°ï¼Œåªä¼šåˆ—å‡ºæˆ‘è‡ªå·±å®¹æ˜“å¿˜æ‰çš„å‘½ä»¤ï¼Œæ–¹ä¾¿æŸ¥é˜…ã€‚ å†…å®¹æ¯”è¾ƒå¤šï¼Œé€‚åˆå½“å‚è€ƒæ‰‹å†Œç”¨ã€‚å¯èƒ½ä¸å¤ªé€‚åˆä»å¤´è¯»åˆ°å°¾â€¦ æœ¬æ–‡ä¸»è¦ä»‹ç» Linux å‘½ä»¤ï¼Œé¡ºå¸¦ä»‹ç»ä¸‹ Windows/MacOSX. å…¶ä¸­ awk åªéœ€è¦å­¦ä¼šäº›å¸¸ç”¨çš„ç”¨æ³•å°±å¤Ÿäº†ï¼Œè¿™ç±»å‘½ä»¤è¡Œå·¥å…·æ¯”è¾ƒé€‚åˆä¸´æ—¶å¤„ç†ä¸€äº›æ–‡æœ¬ï¼Œå¯è¯»æ€§ä¸ç»´æŠ¤æ€§éƒ½æ¯”è¾ƒå·®ã€‚å¯¹äºéœ€æ±‚æ¯”è¾ƒå¤æ‚ï¼Œè€Œä¸”éœ€è¦é•¿æœŸä½¿ç”¨çš„è„šæœ¬ï¼Œå»ºè®®ä½¿ç”¨ Python/Go ç­‰è¯­è¨€ç¼–å†™ã€‚ ","date":"2022-02-13","objectID":"/posts/common-commands-for-various-operating-systems/:0:0","series":null,"tags":["Linux","MacOSX","Windows","CLI","Powershell","Shell","tmux","rsync","vim","awk"],"title":"Linux/Windows/MacOSX ç³»ç»Ÿå¸¸ç”¨å‘½ä»¤é›†é”¦","uri":"/posts/common-commands-for-various-operating-systems/#"},{"categories":["tech"],"content":" ä¸€ã€Linux","date":"2022-02-13","objectID":"/posts/common-commands-for-various-operating-systems/:1:0","series":null,"tags":["Linux","MacOSX","Windows","CLI","Powershell","Shell","tmux","rsync","vim","awk"],"title":"Linux/Windows/MacOSX ç³»ç»Ÿå¸¸ç”¨å‘½ä»¤é›†é”¦","uri":"/posts/common-commands-for-various-operating-systems/#ä¸€linux"},{"categories":["tech"],"content":" 1. åå°è¿è¡Œ shell # 1. åå°è¿è¡Œå‘½ä»¤ nohup python xxx.py \u0026 ä¹Ÿå¯ä»¥ä½¿ç”¨ tmuxï¼Œtmux æä¾›çš„ session åŠŸèƒ½æ¯” nohup æ›´å¥½ç”¨ï¼Œåé¢ä¼šä»‹ç» tmux ","date":"2022-02-13","objectID":"/posts/common-commands-for-various-operating-systems/:1:1","series":null,"tags":["Linux","MacOSX","Windows","CLI","Powershell","Shell","tmux","rsync","vim","awk"],"title":"Linux/Windows/MacOSX ç³»ç»Ÿå¸¸ç”¨å‘½ä»¤é›†é”¦","uri":"/posts/common-commands-for-various-operating-systems/#1-åå°è¿è¡Œ"},{"categories":["tech"],"content":" 2. æŸ¥æ‰¾æ›¿æ¢ sed/awk ä¸ json/yaml å¤„ç† jq/yqgrep å¸¸ç”¨å‘½ä»¤ï¼š bash ## åªåœ¨ç›®å½•ä¸­æ‰€æœ‰çš„ .py å’Œ .dart æ–‡ä»¶ä¸­é€’å½’æœç´¢å­—ç¬¦\"main()\" # -r è¡¨ç¤ºé€’å½’æœç´¢ grep \"main()\" . -r --include *.{py, dart} cat xxx | grep -10 \"main()\" # æ˜¾ç¤ºåŒ¹é…è¡Œçš„å‰å 10 è¡Œ cat xxx | grep -A 10 -B 5 \"main()\" # æ˜¾ç¤ºåŒ¹é…è¡Œçš„å‰ 5 è¡Œå’Œå 10 è¡Œ ## åœ¨ .js æ–‡ä»¶ä¸­æœç´¢å…³é”®å­— xxxxx å¹¶ä»…å±•ç¤ºå…³é”®å­—å‰å 40 ä¸ªå­—ç¬¦ï¼ˆç”¨åœ¨ .js ç­‰è¢«å‹ç¼©è¿‡çš„æ–‡æœ¬æ–‡ä»¶ä¸Šå¾ˆæœ‰æ•ˆï¼‰ cat *.js | grep -o -P '.{0,40}xxxxx.{0,40}' # æ­£åˆ™æœç´¢ï¼ˆ`egrep` æ˜¯ `grep -E` çš„ç®€å†™ï¼Œè¡¨ç¤ºä½¿ç”¨æ‰©å±•æ­£åˆ™è¡¨è¾¾å¼ï¼‰ cat xxx | egrep 'pattern1|pattern2|pattern3' # åå‘æœç´¢ï¼ˆä¸åŒ…å«æŸä¸ªå…³é”®å­—ï¼‰ cat xxx | grep -v 'pattern' # é«˜äº®æ˜¾ç¤ºæœç´¢ç»“æœ cat xxx | grep --color 'pattern' # é€šè¿‡ find æŸ¥æ‰¾æ‰€æœ‰å­æ–‡ä»¶å¤¹ä¸­çš„ config.xml æ–‡ä»¶ï¼Œå¹¶åœ¨å…¶ä¸­æŸ¥æ‰¾åŒ…å«å…³é”®å­— \u003crecipients\u003e çš„è¡Œ # å†é€šè¿‡ awk æå–å‡ºæ–‡ä»¶åå’Œéœ€è¦çš„å…³é”®å­— # -maxdepth 2 è¡¨ç¤ºæœ€å¤§é€’å½’æ·±åº¦ä¸º 2ï¼ˆå­æ–‡ä»¶å¤¹ï¼‰ # -exec echo \\'{}\\' \\; è¡¨ç¤ºå°† find å‘½ä»¤çš„è¾“å‡ºä½¿ç”¨ echo å‘½ä»¤æ·»åŠ å•å¼•å·åŒ…è£¹èµ·æ¥ï¼Œé˜²æ­¢æ–‡ä»¶åä¸­æœ‰ç©ºæ ¼å¯¼è‡´ grep å‘½ä»¤å‡ºé”™ # xargs grep '\u003crecipients\u003e' è¡¨ç¤ºå°† find å‘½ä»¤çš„è¾“å‡ºä½œä¸º grep å‘½ä»¤çš„è¾“å…¥ # awk -F '[:\u003c\u003e]' '{print $1,$4}' è¡¨ç¤ºä½¿ç”¨ : \u003c \u003e ä½œä¸ºåˆ†éš”ç¬¦ï¼Œæ‰“å°å‡ºç¬¬ 1 åˆ—å’Œç¬¬ 4 åˆ— find -maxdepth 2 -name \"config.xml\" -exec echo \\'{}\\' \\; | xargs grep '\u003crecipients\u003e' | awk -F '[:\u003c\u003e]' '{print $1,$4}' # åœ¨æ–‡ä»¶å¤¹ä¸­é€’å½’æŸ¥æ‰¾æ‰€æœ‰ä¸­æ–‡å­—ç¬¦ï¼ˆåœ¨åšä¸­è‹±åŒè¯­å†…å®¹ç»´æŠ¤æ—¶æ¯”è¾ƒæœ‰ç”¨ï¼‰ # -P è¡¨ç¤ºä½¿ç”¨ Perl æ­£åˆ™è¡¨è¾¾å¼ï¼Œ[\\x{4e00}-\\x{9f5a}] è¡¨ç¤ºåŒ¹é…æ‰€æœ‰ä¸­æ–‡å­—ç¬¦ grep -P '[\\x{4e00}-\\x{9f5a}]' -r . æ›´ morden çš„å‘½ä»¤æ˜¯ ripgrepï¼Œå®ƒçš„é€Ÿåº¦æ¯” grep å¿«å¾ˆå¤šï¼Œè€Œä¸”é»˜è®¤å°±æ˜¯æ­£åˆ™åŒ¹é…ã€é€’å½’æœç´¢ã€é«˜äº®æ˜¾ç¤ºæœç´¢ç»“æœï¼š bash # åœ¨å½“å‰æ–‡ä»¶å¤¹é€’å½’æœç´¢æ‰€æœ‰åŒ…å«å…³é”®å­— \"main()\" çš„æ–‡ä»¶ # æ³¨æ„ rg é»˜è®¤ä½¿ç”¨ rust çš„æ­£åˆ™åŒ¹é…åº“ # ä¹Ÿå¯é€šè¿‡ -P å‚æ•°ä½¿ç”¨ PCRE2 æ­£åˆ™åŒ¹é…åº“ rg \"main\\(\\)\" # åœ¨æŒ‡å®šæ–‡ä»¶å¤¹é€’å½’æœç´¢æ‰€æœ‰åŒ…å«å…³é”®å­— \"main()\" çš„æ–‡ä»¶ rg \"main\\(\\)\" \u003cpath\u003e # ç±»ä¼¼ sed çš„åŠŸèƒ½ï¼Œæ›¿æ¢æ–‡ä»¶ä¸­çš„å­—ç¬¦ä¸² # -N è¡¨ç¤ºä¸è¾“å‡ºåŒ¹é…çš„è¡Œï¼Œåªè¾“å‡ºæ›¿æ¢åçš„ç»“æœ # -r è¡¨ç¤º replace æ›¿æ¢ rg --passthru -N 'and' -r '\u0026' ip.txt \u003e ip2.txt sed å¸¸ç”¨å‘½ä»¤ï¼š bash ## 1ï¼‰ å…¨æ–‡æœç´¢å¹¶æ›¿æ¢ ### -i --in-place åŸåœ°æ›¿æ¢ï¼ˆä¿®æ”¹åŸæ–‡ä»¶ï¼‰ ### -i=SUFFIX æ›¿æ¢åçš„æ–‡ä»¶æ·»åŠ  SUFFIX è¿™ä¸ªåç¼€ ### -r ä½¿ç”¨æ‹“å±•çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ³¨æ„æ­¤æ­£åˆ™ä¸æ”¯æŒ \\d\\w\\s ç­‰è¯­æ³•ï¼Œå¿…é¡»ä½¿ç”¨ [0-9] [a-zA-Z] ç­‰æ¥æ›¿æ¢ï¼ï¼ï¼ sed -ri \"s/pattern_str/replace_str/g\" `grep \"key_pattern\" 'path_pattern' -rl` ## 2ï¼‰æ–‡ä»¶åæœç´¢ï¼Œæ›¿æ¢æ–‡ä»¶å†…å®¹ sed -ri \"s/pattern_str/replace_str/g\" `find . -name \"pattern\"` ## 3ï¼‰æ‰¹é‡è½¬æ¢å¤§å°å†™ # å°†å½“å‰æ–‡ä»¶å¤¹å†…ï¼Œæ‰€æœ‰çš„ gitlab URL éƒ½è½¬æ¢æˆå°å†™ # \\L è½¬å°å†™ \\U è½¬å¤§å†™ sed -ri 's@http://GITLAB.*.git@\\L\u0026@g' `find . -name pubspec*` # åªæœ‰åŒ…å« 2 çš„è¡Œæ‰ä¼šæ›¿æ¢é€—å·ä¸ºç ´æŠ˜å· printf '1,2,3,4\\na,b,c,d\\n' | sed '/2/ s/,/-/g' # åªæ‰“å°å‡ºè¢«æ›¿æ¢æˆåŠŸçš„è¡Œ sed -n 's/warm/cool/gp' rhymes.txt # åˆ é™¤æ‰ç¬¬ 3-8 è¡Œï¼Œä¿ç•™å…¶ä»–è¡Œ seq 15 24 | sed '3,8 d' # åˆ é™¤é™¤ 3-8 è¡Œä¹‹å¤–çš„æ‰€æœ‰è¡Œ seq 15 24 | sed '3,8! d' # åˆ é™¤æ‰ç¬¬ 3 è¡Œåˆ°ç¬¬ 11(3+8) è¡Œï¼Œä¿ç•™å…¶ä»–è¡Œ seq 15 24 | sed '3,+8 d' # å¯¹äºæ‰€æœ‰åŒ…å« 2 çš„è¡Œï¼Œéƒ½æ›¿æ¢é€—å·ä¸ºç ´æŠ˜å· printf '1,2,3,4\\na,b,c,d\\n' | sed '/2/ s/,/-/g' # å¯¹äºæ‰€æœ‰ä¸åŒ…å« 2 çš„è¡Œï¼Œéƒ½æ›¿æ¢é€—å·ä¸ºç ´æŠ˜å· printf '1,2,3,4\\na,b,c,d\\n' | sed '/2/! s/,/-/g' # åœ¨ç¬¬ 2 è¡Œä¹‹åæ’å…¥ä¸€è¡Œï¼Œå†…å®¹ä¸º hello seq 1 3 | sed '2a hello' # å°†ç¬¬ 2 è¡Œçš„å†…å®¹æ”¹ä¸º hello seq 1 3 | sed '2c hello' # å°†èƒ½åŒ¹é…ä¸ŠæŒ‡å®šæ­£åˆ™è¡¨è¾¾å¼çš„è¡Œï¼Œæ”¹ä¸º hello seq 1 5 | sed -E '/(11|22)/c hello' # åœ¨ç¬¬äºŒè¡Œçš„å‰é¢æ’å…¥ä¸€è¡Œï¼Œå†…å®¹ä¸º hello seq 1 3 | sed '2i hello' # å°†ç¬¬ 2-4 è¡Œçš„å†…å®¹æ”¹ä¸º helloï¼ˆæ”¹å®Œååªæœ‰ä¸€è¡Œï¼Œè€Œä¸æ˜¯ 3 è¡Œï¼‰ seq 5 | sed '2,4c hello' # å°†ç¬¬ 2-4 è¡Œæ¯ä¸€è¡Œçš„å†…å®¹éƒ½æ”¹ä¸º helloï¼ˆæ”¹å®Œåæ˜¯ 3 è¡Œï¼‰ seq 5 | sed '2,4 s/.*/hello/' # ä¸€æ¬¡ä½¿ç”¨å¤šæ¡æŒ‡ä»¤ seq 4 | sed -e '2c hi' -e '3a bye' ## 4) æ‹·è´æ–‡ä»¶ï¼Œå¹¶ä¸”ä¿æŒæ–‡ä»¶å¤¹ç»“æ„ï¼ˆ--parents è¡¨ç¤ºä¿æŒæ–‡ä»¶å¤¹ç»“æ„ï¼‰ cp --parents `find \u003csrc-dir\u003e -name *.py` \u003cdst-dir\u003e awk ç”¨äºæŒ‰åˆ—å¤„ç†æ–‡æœ¬ï¼Œå®ƒæ¯” sed æ›´å¼ºå¤§æ›´å¤æ‚ï¼Œå¸¸ç”¨å‘½ä»¤ï¼š bash ## 1. å•ç‹¬é€‰å‡ºç¬¬ 1 åˆ—çš„æ–‡æœ¬ cat xxx.txt | awk -F '{print $1}' | head ## 2. å¯ä»¥ä½¿ç”¨ -F æŒ‡å®šåˆ†éš”ç¬¦ï¼Œæ‰“å°å‡ºå¤šåˆ— awk -F ',' '{print $1,$2}'| head ### -F ä¹Ÿå¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æŒ‡å®šå¤šä¸ªåˆ†éš”ç¬¦ awk -F '[,;]' '{print $1,$2}'| head # åœ¨æ–‡ä»¶å¼€å¤´ä¸æœ«å°¾åˆ†åˆ«æ·»åŠ å­—ç¬¦ä¸² seq 2 | awk 'BEGIN{print \"---\"} 1; END{print \"%%%\"}' ## 3. æ‰“å°å‡ºè¡Œæ•° cat log_test | awk '{print NR,$1}' | more ## 4. if åˆ¤æ–­è¯­å¥ cat log_test | awk '{if($11\u003e300) print($1,$11)}' cat log_test | awk '{print $11}' | sort -n | uniq -c # æ±‚å’Œ cat data|awk '{sum+=$1} END {print \"Sum = \", sum}' # æ±‚å¹³å‡ cat data|awk '{sum+=$1} END {print \"Average = \", sum/NR}' # æ±‚æœ€å¤§å€¼ cat data|awk 'BEGIN {max = 0} {if ($1\u003emax) max=$1 fi} END {print \"Max=\", max}' # æ±‚æœ€å°å€¼ï¼ˆminçš„åˆå§‹å€¼è®¾ç½®ä¸€ä¸ªè¶…å¤§æ•°å³å¯ï¼‰ awk 'BEGIN {min = 1999999} {if ($1\u003cmin) min=$1 fi} END {print \"Min=\", min}' jq/yq å¸¸ç”¨å‘½ä»¤ï¼š bash # 1. jq æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œ json å¤„ç†å·¥å…· ## ä» json ä¸­æŸ¥è¯¢æŸä¸€ä¸ªå­—æ®µçš„å€¼ jq -r '.message' xxx.json ## ä¹Ÿå¯ä» stdin è¯»å– json cat xxx.json | jq -r '.message' ## ä» json å†…å®¹ä¸­åˆ é™¤å¤šä¸ª key ## -r è¡¨ç¤ºè¾“å‡ºæ–‡æœ¬é‡‡ç”¨ raw æ ¼å¼ jq -r \"del(.dataplane.insync, .dataplane.outdated)\" xxx.json ## æ›´å¤š jq çš„ç”¨æ³•å‚è§å®˜æ–¹æ–‡æ¡£ï¼šhttps://stedolan.github.io/jq/tutorial/ # 2. yq æ˜¯ç”¨äºå¤„ç† yaml é…ç½®çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå‚æ•°è·Ÿ jq é«˜åº¦ç›¸ä¼¼ ## ä» yaml é…ç½®ä¸­åˆ é™¤å¤šä¸ª key yq \"del(.dataplane.insync, .dataplane.outdated)\" xxx.yaml ## æˆ–è€…ä» stdin è¯»å–è¾“å…¥ cat xxx.yaml | yq \"del(.dataplane.insyn","date":"2022-02-13","objectID":"/posts/common-commands-for-various-operating-systems/:1:2","series":null,"tags":["Linux","MacOSX","Windows","CLI","Powershell","Shell","tmux","rsync","vim","awk"],"title":"Linux/Windows/MacOSX ç³»ç»Ÿå¸¸ç”¨å‘½ä»¤é›†é”¦","uri":"/posts/common-commands-for-various-operating-systems/#2-æŸ¥æ‰¾æ›¿æ¢-sedawk-ä¸-jsonyaml-å¤„ç†-jqyq"},{"categories":["tech"],"content":" 3. å‹ç¼©ç›¸å…³ shell # ç›´æ¥ cat å‹ç¼©æ–‡ä»¶çš„å†…å®¹ zcat xxx.gz | more # gzip xzcat xxx.xz | more # xz tar -axvf xxx.tar.* # é€šè¿‡åç¼€è¯†åˆ«å‹ç¼©æ ¼å¼ï¼Œæ™ºèƒ½è§£å‹ ä»¥åŠæ—¥å¸¸å¯é€šè¿‡å‹ç¼© + bas64 ç¼–ç æ¥é€šè¿‡ IM ç­‰èŠå¤©è½¯ä»¶å¿«é€Ÿä¼ è¾“æ•°æ®é‡ä¸å¤šçš„æ–‡ä»¶å¤¹ï¼š bash # å‹ç¼©æ–‡ä»¶å¤¹å¹¶é€šè¿‡ base64 ç¼–ç  tar czv \u003cfolder-name\u003e | base64 \u003e xxx # è§£å‹æ¶ˆæ¯åˆ°æ–‡ä»¶å¤¹ cat \"xxx\" | base64 -d | tar zxv æ›´å¤šå‘½ä»¤å‚è§å¸¸è§å‹ç¼©æ ¼å¼çš„åŒºåˆ«ï¼ŒåŠ Linux ä¸‹çš„å‹ç¼©ç›¸å…³æŒ‡ä»¤ ","date":"2022-02-13","objectID":"/posts/common-commands-for-various-operating-systems/:1:3","series":null,"tags":["Linux","MacOSX","Windows","CLI","Powershell","Shell","tmux","rsync","vim","awk"],"title":"Linux/Windows/MacOSX ç³»ç»Ÿå¸¸ç”¨å‘½ä»¤é›†é”¦","uri":"/posts/common-commands-for-various-operating-systems/#3-å‹ç¼©ç›¸å…³"},{"categories":["tech"],"content":" 4. æ–‡ä»¶æ‹·è´ä¸åŒæ­¥å„ç§ Linux å‘è¡Œç‰ˆéƒ½è‡ªå¸¦ scp/sshï¼Œè¿™ä¸¤ä¸ªå·¥å…·åŠŸèƒ½ç®€å•ï¼Œä¸€èˆ¬å¤Ÿç”¨ã€‚ å¦å¤–å°±æ˜¯æ›´å¼ºå¤§ä¹Ÿæ›´å¤æ‚çš„ rsyncï¼Œéƒ¨åˆ†å‘è¡Œç‰ˆä¼šè‡ªå¸¦ rsyncã€‚ ä¸‹é¢åˆ†åˆ«ä»‹ç»ä¸‹ã€‚ 1. ssh/scp shell # å¦‚æœä½¿ç”¨ ssh å‘½ä»¤è¿›è¡Œæ–‡ä»¶ä¼ è¾“ï¼Œå¯å®‰è£… pv å‘½ä»¤æŸ¥çœ‹ä¼ è¾“é€Ÿåº¦ï¼ˆpipeviewerï¼‰ ## ubuntu sudo apt-get install pv ## centos sudo yum install epel-release sudo yum install pv ## 1)ä»æœ¬åœ°ä¸Šä¼ åˆ°æœåŠ¡å™¨ ### ä½¿ç”¨ ssh çš„å¥½å¤„æ˜¯æµå¼ä¼ è¾“ä¸ä¼šå ç”¨ç›®æ ‡æœºå™¨çš„å­˜å‚¨ç©ºé—´ï¼Œé€‚åˆä¼ è¾“å¯èƒ½å¼•èµ·ç©ºé—´ä¸è¶³çš„å¤§æ–‡ä»¶ï¼Œå¹¶åœ¨ç›®æ ‡æœºå™¨ä¸Šå®æ—¶å¤„ç†è¯¥æ–‡ä»¶ã€‚ cat \u003cfilename\u003e | pv | ssh \u003cuser\u003e@\u003chost\u003e -p 22 \"cat - \u003e \u003cnew-filename\u003e\" tar cz \u003cfilename or foldername or glob\u003e | pv | ssh \u003cuser\u003e@\u003chost\u003e -p 22 \"tar xz\" # å‹ç¼©ä¼ è¾“ ## scp å‘½ä»¤æ¯” ssh å‘½ä»¤æ›´ç®€æ´ï¼ˆä½†æ˜¯ä¸é€‚åˆç”¨äºä¼ æ–‡ä»¶å¤¹ï¼Œå®ƒä¼šç ´åæ–‡ä»¶çš„æƒé™è®¾ç½®ï¼ŒæŠŠæ–‡ä»¶å¤¹å¼„å¾—ä¸€å›¢ç³Ÿï¼‰ scp -P 22 \u003cfilename\u003e \u003cuser\u003e@\u003chost\u003e:\u003cfolder-name or filename\u003e # é€šè¿‡ scp ä¼ è¾“ï¼Œä¼ æ–‡ä»¶å¤¹æ—¶è®°å¾—æ·»åŠ  -r å‚æ•°ï¼ˆrecursiveï¼‰ ## 2) ä»æœåŠ¡å™¨ä¸‹è½½åˆ°æœ¬åœ° ssh \u003cuser\u003e@\u003chost\u003e -p 22 \"tar cz \u003cfilename or foldername or glob\u003e\" | pv | tar xz # å‹ç¼©ä¼ è¾“ scp -P 22 \u003cuser\u003e@\u003chost\u003e:\u003cfolder-name or filename\u003e \u003cfilename\u003e # é€šè¿‡ scp ä¼ è¾“ï¼Œä¼ æ–‡ä»¶å¤¹æ—¶è®°å¾—æ·»åŠ  -r å‚æ•°ï¼ˆrecursiveï¼‰ 2. rsyncrsync çš„åŠŸèƒ½å…¶å®å’Œå‰é¢çš„ scp/(tar+ssh) æ˜¯ä¸€æ ·çš„ï¼Œå°†æ–‡ä»¶ä»ä¸€ä¸ªåœ°æ–¹æ‹·è´åˆ°å¦ä¸€ä¸ªåœ°æ–¹ã€‚åŒºåˆ«åœ¨äºå®ƒåªåšå¢é‡åŒæ­¥ï¼Œåœ¨å¤šæ¬¡æ‹·è´æ–‡ä»¶æ—¶ï¼Œåªæ‹·è´ï¼ˆåŒæ­¥ï¼‰ä¿®æ”¹è¿‡çš„éƒ¨åˆ†ï¼Œå¾ˆå¤šåœºæ™¯ä¸‹å¯ä»¥å¤§å¤§åŠ å¿«æ‹·è´ /å¤‡ä»½é€Ÿåº¦ã€‚ rsync çš„å¸¸ç”¨å‘½ä»¤ï¼š shell # å°†ä¸€ä¸ªæ–‡ä»¶å¤¹å½’æ¡£ã€å‹ç¼©ï¼Œå¹¶é€šè¿‡ ssh åè®®ï¼ˆé»˜è®¤ï¼‰åŒæ­¥åˆ°å¦ä¸€ä¸ªåœ°æ–¹ # -a, --archive # å½’æ¡£æ¨¡å¼ï¼Œä¿ç•™æ–‡ä»¶çš„æ‰€æœ‰å…ƒä¿¡æ¯ï¼Œç­‰åŒäº `-rlptgoD` # -r, --recursive # é€’å½’å¤åˆ¶æ–‡ä»¶å¤¹ï¼Œ`-a` éšå«äº†è¿™ä¸ªå‚æ•°ï¼Œé€šå¸¸éƒ½ç”¨ -aã€‚ # -v, --verbose # è¾“å‡ºè¯¦ç»†ä¿¡æ¯ # --progress # æ˜¾ç¤ºä¼ è¾“è¿›åº¦ # -z, --compress # ä¼ è¾“æ–‡ä»¶æ—¶è¿›è¡Œå‹ç¼© rsync -avz --progress src host:dest rsync -avz --progress -e \"ssh -p225\" /path/src user@host:dest # ä½¿ç”¨éé»˜è®¤çš„ ssh ç«¯å£è¿›è¡Œä¼ è¾“ rsync -avz --progress -e \"ssh -i id_xxx\" /path/src user@host:dest # ä½¿ç”¨æŒ‡å®šçš„ç§é’¥è¿æ¥ ssh æœåŠ¡ç«¯ï¼Œå…¶ä»–å„ç§ ssh å‚æ•°éƒ½å¯ä»¥åœ¨è¿™é‡ŒæŒ‡å®š # --exclude æ’é™¤æ‰æŸäº›ä¸éœ€è¦çš„æ–‡ä»¶(å¤¹) rsync -avz --progress --exclude \"foor/bar\" src user@host:dest # æœ‰æ—¶æˆ‘ä»¬å¸Œæœ›åœ¨åŒæ­¥æ•°æ®æ—¶ä¿®æ”¹æ–‡ä»¶çš„ user/group # --chown # è®¾ç½®æ–‡ä»¶çš„ user:groupï¼Œå¿…é¡»ä¸ `-og`/`--owner --group` åŒæ—¶ä½¿ç”¨ï¼ï¼ˆ`-a` éšå«äº† `-og`ï¼‰ rsync -avz --progress --chown=root:root src user@host:dest # ä¼ è¾“æ—¶ä¿®æ”¹ user/group ä¸º root # è¯¦ç»†è¯´æ˜ src å’Œ dest çš„ä½ç½® rsync -avz --progress path/src user@host:/tmp # å°† src æ‹·è´åˆ°è¿œç¨‹ä¸»æœºçš„ /tmp ä¸­ï¼ˆå¾—åˆ° /tmp/srcï¼‰ ## æ³¨æ„ src ç»“å°¾æœ‰ / rsync -avz --progress path/src/ user@host:/tmp/src # å°† src ç›®å½•ä¸­çš„æ–‡ä»¶æ‹·è´åˆ°è¿œç¨‹ä¸»æœºçš„ /tmp/src ç›®å½•ä¸­ï¼ˆåŒæ ·å¾—åˆ° /tmp/srcï¼‰ # æœ‰æ—¶å€™æˆ‘ä»¬åœ¨ä¼ è¾“æ–‡ä»¶æ—¶ä¸å¸Œæœ›ä¿ç•™æ–‡ä»¶çš„å…ƒä¿¡æ¯ # rsync é»˜è®¤ä¸ä¼šåˆ é™¤ dest ä¸­å¤šä½™çš„æ–‡ä»¶ï¼Œä½¿ç”¨ --delete å¯è®© rsync åˆ é™¤è¿™éƒ¨åˆ†æ— å…³çš„æ–‡ä»¶ # å¯¹ src æ–‡ä»¶å¤¹è¿›è¡Œå®Œå…¨é•œåƒï¼Œä¿è¯ä¸¤ä¸ªæ–‡ä»¶å¤¹çš„å†…å®¹ä¸€æ¨¡ä¸€æ ·ï¼Œä¸å¤šä¸å°‘ rsync -avz --progress --delete src user@host:dest # ä¹Ÿå¯ä»¥ä½¿ç”¨ --ignore-existing è®© rsync å¿½ç•¥æ‰ dest å·²ç»å­˜åœ¨çš„æ–‡ä»¶ã€‚å°±æ˜¯åªåŒæ­¥æ–°å¢çš„æ–‡ä»¶ã€‚ rsync -avz --progress --ignore-existing src user@host:dest å¦å¤–ä¹Ÿæœ‰ä½¿ç”¨åŒå†’å· :: åˆ†éš”çš„ä¼ è¾“å‘½ä»¤ï¼Œè¿™ç§å‘½ä»¤ä½¿ç”¨ rsync åè®®è¿›è¡Œä¼ è¾“ï¼Œè¦æ±‚ç›®æ ‡ä¸»æœºå¯ç”¨ rsync-daemonã€‚ç”¨å¾—ä¼šæ¯” ssh å°‘ä¸€äº›ï¼Œæš‚æ—¶ä¸åšä»‹ç»ã€‚ rsync è¯¦ç»†æ–‡æ¡£å‚è§ https://rsync.samba.org/documentation.htmlï¼Œæˆ–è€… man rsync. ","date":"2022-02-13","objectID":"/posts/common-commands-for-various-operating-systems/:1:4","series":null,"tags":["Linux","MacOSX","Windows","CLI","Powershell","Shell","tmux","rsync","vim","awk"],"title":"Linux/Windows/MacOSX ç³»ç»Ÿå¸¸ç”¨å‘½ä»¤é›†é”¦","uri":"/posts/common-commands-for-various-operating-systems/#4-æ–‡ä»¶æ‹·è´ä¸åŒæ­¥"},{"categories":["tech"],"content":" 4. æ–‡ä»¶æ‹·è´ä¸åŒæ­¥å„ç§ Linux å‘è¡Œç‰ˆéƒ½è‡ªå¸¦ scp/sshï¼Œè¿™ä¸¤ä¸ªå·¥å…·åŠŸèƒ½ç®€å•ï¼Œä¸€èˆ¬å¤Ÿç”¨ã€‚ å¦å¤–å°±æ˜¯æ›´å¼ºå¤§ä¹Ÿæ›´å¤æ‚çš„ rsyncï¼Œéƒ¨åˆ†å‘è¡Œç‰ˆä¼šè‡ªå¸¦ rsyncã€‚ ä¸‹é¢åˆ†åˆ«ä»‹ç»ä¸‹ã€‚ 1. ssh/scp shell # å¦‚æœä½¿ç”¨ ssh å‘½ä»¤è¿›è¡Œæ–‡ä»¶ä¼ è¾“ï¼Œå¯å®‰è£… pv å‘½ä»¤æŸ¥çœ‹ä¼ è¾“é€Ÿåº¦ï¼ˆpipeviewerï¼‰ ## ubuntu sudo apt-get install pv ## centos sudo yum install epel-release sudo yum install pv ## 1)ä»æœ¬åœ°ä¸Šä¼ åˆ°æœåŠ¡å™¨ ### ä½¿ç”¨ ssh çš„å¥½å¤„æ˜¯æµå¼ä¼ è¾“ä¸ä¼šå ç”¨ç›®æ ‡æœºå™¨çš„å­˜å‚¨ç©ºé—´ï¼Œé€‚åˆä¼ è¾“å¯èƒ½å¼•èµ·ç©ºé—´ä¸è¶³çš„å¤§æ–‡ä»¶ï¼Œå¹¶åœ¨ç›®æ ‡æœºå™¨ä¸Šå®æ—¶å¤„ç†è¯¥æ–‡ä»¶ã€‚ cat | pv | ssh @ -p 22 \"cat - \u003e \" tar cz | pv | ssh @ -p 22 \"tar xz\" # å‹ç¼©ä¼ è¾“ ## scp å‘½ä»¤æ¯” ssh å‘½ä»¤æ›´ç®€æ´ï¼ˆä½†æ˜¯ä¸é€‚åˆç”¨äºä¼ æ–‡ä»¶å¤¹ï¼Œå®ƒä¼šç ´åæ–‡ä»¶çš„æƒé™è®¾ç½®ï¼ŒæŠŠæ–‡ä»¶å¤¹å¼„å¾—ä¸€å›¢ç³Ÿï¼‰ scp -P 22 @: # é€šè¿‡ scp ä¼ è¾“ï¼Œä¼ æ–‡ä»¶å¤¹æ—¶è®°å¾—æ·»åŠ  -r å‚æ•°ï¼ˆrecursiveï¼‰ ## 2) ä»æœåŠ¡å™¨ä¸‹è½½åˆ°æœ¬åœ° ssh @ -p 22 \"tar cz \" | pv | tar xz # å‹ç¼©ä¼ è¾“ scp -P 22 @: # é€šè¿‡ scp ä¼ è¾“ï¼Œä¼ æ–‡ä»¶å¤¹æ—¶è®°å¾—æ·»åŠ  -r å‚æ•°ï¼ˆrecursiveï¼‰ 2. rsyncrsync çš„åŠŸèƒ½å…¶å®å’Œå‰é¢çš„ scp/(tar+ssh) æ˜¯ä¸€æ ·çš„ï¼Œå°†æ–‡ä»¶ä»ä¸€ä¸ªåœ°æ–¹æ‹·è´åˆ°å¦ä¸€ä¸ªåœ°æ–¹ã€‚åŒºåˆ«åœ¨äºå®ƒåªåšå¢é‡åŒæ­¥ï¼Œåœ¨å¤šæ¬¡æ‹·è´æ–‡ä»¶æ—¶ï¼Œåªæ‹·è´ï¼ˆåŒæ­¥ï¼‰ä¿®æ”¹è¿‡çš„éƒ¨åˆ†ï¼Œå¾ˆå¤šåœºæ™¯ä¸‹å¯ä»¥å¤§å¤§åŠ å¿«æ‹·è´ /å¤‡ä»½é€Ÿåº¦ã€‚ rsync çš„å¸¸ç”¨å‘½ä»¤ï¼š shell # å°†ä¸€ä¸ªæ–‡ä»¶å¤¹å½’æ¡£ã€å‹ç¼©ï¼Œå¹¶é€šè¿‡ ssh åè®®ï¼ˆé»˜è®¤ï¼‰åŒæ­¥åˆ°å¦ä¸€ä¸ªåœ°æ–¹ # -a, --archive # å½’æ¡£æ¨¡å¼ï¼Œä¿ç•™æ–‡ä»¶çš„æ‰€æœ‰å…ƒä¿¡æ¯ï¼Œç­‰åŒäº `-rlptgoD` # -r, --recursive # é€’å½’å¤åˆ¶æ–‡ä»¶å¤¹ï¼Œ`-a` éšå«äº†è¿™ä¸ªå‚æ•°ï¼Œé€šå¸¸éƒ½ç”¨ -aã€‚ # -v, --verbose # è¾“å‡ºè¯¦ç»†ä¿¡æ¯ # --progress # æ˜¾ç¤ºä¼ è¾“è¿›åº¦ # -z, --compress # ä¼ è¾“æ–‡ä»¶æ—¶è¿›è¡Œå‹ç¼© rsync -avz --progress src host:dest rsync -avz --progress -e \"ssh -p225\" /path/src user@host:dest # ä½¿ç”¨éé»˜è®¤çš„ ssh ç«¯å£è¿›è¡Œä¼ è¾“ rsync -avz --progress -e \"ssh -i id_xxx\" /path/src user@host:dest # ä½¿ç”¨æŒ‡å®šçš„ç§é’¥è¿æ¥ ssh æœåŠ¡ç«¯ï¼Œå…¶ä»–å„ç§ ssh å‚æ•°éƒ½å¯ä»¥åœ¨è¿™é‡ŒæŒ‡å®š # --exclude æ’é™¤æ‰æŸäº›ä¸éœ€è¦çš„æ–‡ä»¶(å¤¹) rsync -avz --progress --exclude \"foor/bar\" src user@host:dest # æœ‰æ—¶æˆ‘ä»¬å¸Œæœ›åœ¨åŒæ­¥æ•°æ®æ—¶ä¿®æ”¹æ–‡ä»¶çš„ user/group # --chown # è®¾ç½®æ–‡ä»¶çš„ user:groupï¼Œå¿…é¡»ä¸ `-og`/`--owner --group` åŒæ—¶ä½¿ç”¨ï¼ï¼ˆ`-a` éšå«äº† `-og`ï¼‰ rsync -avz --progress --chown=root:root src user@host:dest # ä¼ è¾“æ—¶ä¿®æ”¹ user/group ä¸º root # è¯¦ç»†è¯´æ˜ src å’Œ dest çš„ä½ç½® rsync -avz --progress path/src user@host:/tmp # å°† src æ‹·è´åˆ°è¿œç¨‹ä¸»æœºçš„ /tmp ä¸­ï¼ˆå¾—åˆ° /tmp/srcï¼‰ ## æ³¨æ„ src ç»“å°¾æœ‰ / rsync -avz --progress path/src/ user@host:/tmp/src # å°† src ç›®å½•ä¸­çš„æ–‡ä»¶æ‹·è´åˆ°è¿œç¨‹ä¸»æœºçš„ /tmp/src ç›®å½•ä¸­ï¼ˆåŒæ ·å¾—åˆ° /tmp/srcï¼‰ # æœ‰æ—¶å€™æˆ‘ä»¬åœ¨ä¼ è¾“æ–‡ä»¶æ—¶ä¸å¸Œæœ›ä¿ç•™æ–‡ä»¶çš„å…ƒä¿¡æ¯ # rsync é»˜è®¤ä¸ä¼šåˆ é™¤ dest ä¸­å¤šä½™çš„æ–‡ä»¶ï¼Œä½¿ç”¨ --delete å¯è®© rsync åˆ é™¤è¿™éƒ¨åˆ†æ— å…³çš„æ–‡ä»¶ # å¯¹ src æ–‡ä»¶å¤¹è¿›è¡Œå®Œå…¨é•œåƒï¼Œä¿è¯ä¸¤ä¸ªæ–‡ä»¶å¤¹çš„å†…å®¹ä¸€æ¨¡ä¸€æ ·ï¼Œä¸å¤šä¸å°‘ rsync -avz --progress --delete src user@host:dest # ä¹Ÿå¯ä»¥ä½¿ç”¨ --ignore-existing è®© rsync å¿½ç•¥æ‰ dest å·²ç»å­˜åœ¨çš„æ–‡ä»¶ã€‚å°±æ˜¯åªåŒæ­¥æ–°å¢çš„æ–‡ä»¶ã€‚ rsync -avz --progress --ignore-existing src user@host:dest å¦å¤–ä¹Ÿæœ‰ä½¿ç”¨åŒå†’å· :: åˆ†éš”çš„ä¼ è¾“å‘½ä»¤ï¼Œè¿™ç§å‘½ä»¤ä½¿ç”¨ rsync åè®®è¿›è¡Œä¼ è¾“ï¼Œè¦æ±‚ç›®æ ‡ä¸»æœºå¯ç”¨ rsync-daemonã€‚ç”¨å¾—ä¼šæ¯” ssh å°‘ä¸€äº›ï¼Œæš‚æ—¶ä¸åšä»‹ç»ã€‚ rsync è¯¦ç»†æ–‡æ¡£å‚è§ https://rsync.samba.org/documentation.htmlï¼Œæˆ–è€… man rsync. ","date":"2022-02-13","objectID":"/posts/common-commands-for-various-operating-systems/:1:4","series":null,"tags":["Linux","MacOSX","Windows","CLI","Powershell","Shell","tmux","rsync","vim","awk"],"title":"Linux/Windows/MacOSX ç³»ç»Ÿå¸¸ç”¨å‘½ä»¤é›†é”¦","uri":"/posts/common-commands-for-various-operating-systems/#1-sshscp"},{"categories":["tech"],"content":" 4. æ–‡ä»¶æ‹·è´ä¸åŒæ­¥å„ç§ Linux å‘è¡Œç‰ˆéƒ½è‡ªå¸¦ scp/sshï¼Œè¿™ä¸¤ä¸ªå·¥å…·åŠŸèƒ½ç®€å•ï¼Œä¸€èˆ¬å¤Ÿç”¨ã€‚ å¦å¤–å°±æ˜¯æ›´å¼ºå¤§ä¹Ÿæ›´å¤æ‚çš„ rsyncï¼Œéƒ¨åˆ†å‘è¡Œç‰ˆä¼šè‡ªå¸¦ rsyncã€‚ ä¸‹é¢åˆ†åˆ«ä»‹ç»ä¸‹ã€‚ 1. ssh/scp shell # å¦‚æœä½¿ç”¨ ssh å‘½ä»¤è¿›è¡Œæ–‡ä»¶ä¼ è¾“ï¼Œå¯å®‰è£… pv å‘½ä»¤æŸ¥çœ‹ä¼ è¾“é€Ÿåº¦ï¼ˆpipeviewerï¼‰ ## ubuntu sudo apt-get install pv ## centos sudo yum install epel-release sudo yum install pv ## 1)ä»æœ¬åœ°ä¸Šä¼ åˆ°æœåŠ¡å™¨ ### ä½¿ç”¨ ssh çš„å¥½å¤„æ˜¯æµå¼ä¼ è¾“ä¸ä¼šå ç”¨ç›®æ ‡æœºå™¨çš„å­˜å‚¨ç©ºé—´ï¼Œé€‚åˆä¼ è¾“å¯èƒ½å¼•èµ·ç©ºé—´ä¸è¶³çš„å¤§æ–‡ä»¶ï¼Œå¹¶åœ¨ç›®æ ‡æœºå™¨ä¸Šå®æ—¶å¤„ç†è¯¥æ–‡ä»¶ã€‚ cat | pv | ssh @ -p 22 \"cat - \u003e \" tar cz | pv | ssh @ -p 22 \"tar xz\" # å‹ç¼©ä¼ è¾“ ## scp å‘½ä»¤æ¯” ssh å‘½ä»¤æ›´ç®€æ´ï¼ˆä½†æ˜¯ä¸é€‚åˆç”¨äºä¼ æ–‡ä»¶å¤¹ï¼Œå®ƒä¼šç ´åæ–‡ä»¶çš„æƒé™è®¾ç½®ï¼ŒæŠŠæ–‡ä»¶å¤¹å¼„å¾—ä¸€å›¢ç³Ÿï¼‰ scp -P 22 @: # é€šè¿‡ scp ä¼ è¾“ï¼Œä¼ æ–‡ä»¶å¤¹æ—¶è®°å¾—æ·»åŠ  -r å‚æ•°ï¼ˆrecursiveï¼‰ ## 2) ä»æœåŠ¡å™¨ä¸‹è½½åˆ°æœ¬åœ° ssh @ -p 22 \"tar cz \" | pv | tar xz # å‹ç¼©ä¼ è¾“ scp -P 22 @: # é€šè¿‡ scp ä¼ è¾“ï¼Œä¼ æ–‡ä»¶å¤¹æ—¶è®°å¾—æ·»åŠ  -r å‚æ•°ï¼ˆrecursiveï¼‰ 2. rsyncrsync çš„åŠŸèƒ½å…¶å®å’Œå‰é¢çš„ scp/(tar+ssh) æ˜¯ä¸€æ ·çš„ï¼Œå°†æ–‡ä»¶ä»ä¸€ä¸ªåœ°æ–¹æ‹·è´åˆ°å¦ä¸€ä¸ªåœ°æ–¹ã€‚åŒºåˆ«åœ¨äºå®ƒåªåšå¢é‡åŒæ­¥ï¼Œåœ¨å¤šæ¬¡æ‹·è´æ–‡ä»¶æ—¶ï¼Œåªæ‹·è´ï¼ˆåŒæ­¥ï¼‰ä¿®æ”¹è¿‡çš„éƒ¨åˆ†ï¼Œå¾ˆå¤šåœºæ™¯ä¸‹å¯ä»¥å¤§å¤§åŠ å¿«æ‹·è´ /å¤‡ä»½é€Ÿåº¦ã€‚ rsync çš„å¸¸ç”¨å‘½ä»¤ï¼š shell # å°†ä¸€ä¸ªæ–‡ä»¶å¤¹å½’æ¡£ã€å‹ç¼©ï¼Œå¹¶é€šè¿‡ ssh åè®®ï¼ˆé»˜è®¤ï¼‰åŒæ­¥åˆ°å¦ä¸€ä¸ªåœ°æ–¹ # -a, --archive # å½’æ¡£æ¨¡å¼ï¼Œä¿ç•™æ–‡ä»¶çš„æ‰€æœ‰å…ƒä¿¡æ¯ï¼Œç­‰åŒäº `-rlptgoD` # -r, --recursive # é€’å½’å¤åˆ¶æ–‡ä»¶å¤¹ï¼Œ`-a` éšå«äº†è¿™ä¸ªå‚æ•°ï¼Œé€šå¸¸éƒ½ç”¨ -aã€‚ # -v, --verbose # è¾“å‡ºè¯¦ç»†ä¿¡æ¯ # --progress # æ˜¾ç¤ºä¼ è¾“è¿›åº¦ # -z, --compress # ä¼ è¾“æ–‡ä»¶æ—¶è¿›è¡Œå‹ç¼© rsync -avz --progress src host:dest rsync -avz --progress -e \"ssh -p225\" /path/src user@host:dest # ä½¿ç”¨éé»˜è®¤çš„ ssh ç«¯å£è¿›è¡Œä¼ è¾“ rsync -avz --progress -e \"ssh -i id_xxx\" /path/src user@host:dest # ä½¿ç”¨æŒ‡å®šçš„ç§é’¥è¿æ¥ ssh æœåŠ¡ç«¯ï¼Œå…¶ä»–å„ç§ ssh å‚æ•°éƒ½å¯ä»¥åœ¨è¿™é‡ŒæŒ‡å®š # --exclude æ’é™¤æ‰æŸäº›ä¸éœ€è¦çš„æ–‡ä»¶(å¤¹) rsync -avz --progress --exclude \"foor/bar\" src user@host:dest # æœ‰æ—¶æˆ‘ä»¬å¸Œæœ›åœ¨åŒæ­¥æ•°æ®æ—¶ä¿®æ”¹æ–‡ä»¶çš„ user/group # --chown # è®¾ç½®æ–‡ä»¶çš„ user:groupï¼Œå¿…é¡»ä¸ `-og`/`--owner --group` åŒæ—¶ä½¿ç”¨ï¼ï¼ˆ`-a` éšå«äº† `-og`ï¼‰ rsync -avz --progress --chown=root:root src user@host:dest # ä¼ è¾“æ—¶ä¿®æ”¹ user/group ä¸º root # è¯¦ç»†è¯´æ˜ src å’Œ dest çš„ä½ç½® rsync -avz --progress path/src user@host:/tmp # å°† src æ‹·è´åˆ°è¿œç¨‹ä¸»æœºçš„ /tmp ä¸­ï¼ˆå¾—åˆ° /tmp/srcï¼‰ ## æ³¨æ„ src ç»“å°¾æœ‰ / rsync -avz --progress path/src/ user@host:/tmp/src # å°† src ç›®å½•ä¸­çš„æ–‡ä»¶æ‹·è´åˆ°è¿œç¨‹ä¸»æœºçš„ /tmp/src ç›®å½•ä¸­ï¼ˆåŒæ ·å¾—åˆ° /tmp/srcï¼‰ # æœ‰æ—¶å€™æˆ‘ä»¬åœ¨ä¼ è¾“æ–‡ä»¶æ—¶ä¸å¸Œæœ›ä¿ç•™æ–‡ä»¶çš„å…ƒä¿¡æ¯ # rsync é»˜è®¤ä¸ä¼šåˆ é™¤ dest ä¸­å¤šä½™çš„æ–‡ä»¶ï¼Œä½¿ç”¨ --delete å¯è®© rsync åˆ é™¤è¿™éƒ¨åˆ†æ— å…³çš„æ–‡ä»¶ # å¯¹ src æ–‡ä»¶å¤¹è¿›è¡Œå®Œå…¨é•œåƒï¼Œä¿è¯ä¸¤ä¸ªæ–‡ä»¶å¤¹çš„å†…å®¹ä¸€æ¨¡ä¸€æ ·ï¼Œä¸å¤šä¸å°‘ rsync -avz --progress --delete src user@host:dest # ä¹Ÿå¯ä»¥ä½¿ç”¨ --ignore-existing è®© rsync å¿½ç•¥æ‰ dest å·²ç»å­˜åœ¨çš„æ–‡ä»¶ã€‚å°±æ˜¯åªåŒæ­¥æ–°å¢çš„æ–‡ä»¶ã€‚ rsync -avz --progress --ignore-existing src user@host:dest å¦å¤–ä¹Ÿæœ‰ä½¿ç”¨åŒå†’å· :: åˆ†éš”çš„ä¼ è¾“å‘½ä»¤ï¼Œè¿™ç§å‘½ä»¤ä½¿ç”¨ rsync åè®®è¿›è¡Œä¼ è¾“ï¼Œè¦æ±‚ç›®æ ‡ä¸»æœºå¯ç”¨ rsync-daemonã€‚ç”¨å¾—ä¼šæ¯” ssh å°‘ä¸€äº›ï¼Œæš‚æ—¶ä¸åšä»‹ç»ã€‚ rsync è¯¦ç»†æ–‡æ¡£å‚è§ https://rsync.samba.org/documentation.htmlï¼Œæˆ–è€… man rsync. ","date":"2022-02-13","objectID":"/posts/common-commands-for-various-operating-systems/:1:4","series":null,"tags":["Linux","MacOSX","Windows","CLI","Powershell","Shell","tmux","rsync","vim","awk"],"title":"Linux/Windows/MacOSX ç³»ç»Ÿå¸¸ç”¨å‘½ä»¤é›†é”¦","uri":"/posts/common-commands-for-various-operating-systems/#2-rsync"},{"categories":["tech"],"content":" 5. Tmux è¾“å…¥ tmux å¯åŠ¨ä¸€ä¸ª tmux ä¼šè¯ã€‚ï¼ˆæˆ–è€…ç”¨ tmux new -s \u003csession-name\u003e å¯åŠ¨ä¸€ä¸ªå‘½åä¼šè¯ï¼‰ è¾“å…¥ python xxx.pyï¼Œpython è¿›ç¨‹å¼€å§‹è¿è¡Œã€‚ æŒ‰å¿«æ·é”® ctrl+bï¼Œç„¶åå†æŒ‰ä¸€ä¸‹ d è„±ç¦»(detach)å½“å‰ä¼šè¯ã€‚æ­¤æ—¶ python è¿›ç¨‹è¿›å…¥åå°è¿è¡Œï¼Œå…³é—­å½“å‰ç»ˆç«¯å¯¹ python è¿›ç¨‹æ²¡æœ‰å½±å“ã€‚ è¾“å…¥ tmux ls å¯ä»¥æŸ¥çœ‹å½“å‰æ­£åœ¨åå°è¿è¡Œçš„ä¼šè¯ã€‚ï¼ˆå‘½åä¼šè¯ä¼šæ˜¾ç¤ºåç§°ï¼Œå¦åˆ™åªæ˜¾ç¤º idï¼‰ é€šè¿‡ tmux attach -t \u003csession-name/id\u003e é‡æ–°æ¥å…¥åå°ä¼šè¯ã€‚ ç¼©å†™ tmux a -t \u003csession\u003e æˆ–è€…é€šè¿‡ tmux kill-session -t \u003csession-name/id\u003e æ€æ­»ä¸€ä¸ªåå°ä¼šè¯ã€‚ å¸¸ç”¨å¿«æ·é”®ï¼š yaml # prefix è¡¨ç¤º `ctrl`+`b` # pane çš„åˆ‡åˆ†ä¸é€‰æ‹© prefix \" # åœ¨ä¸‹æ–¹æ–°å»ºä¸€ä¸ª pane prefix % # åœ¨å³ä¾§æ–°å»ºä¸€ä¸ª pane prefix `æ–¹å‘é”®` # å…‰æ ‡ç§»åŠ¨åˆ°æŒ‡å®šæ–¹å‘çš„ pane ä¸­ # ä½¿ç”¨æ–¹å‘é”®æ»šåŠ¨çª—å£å†…å®¹ prefix [ # è¿›å…¥ç¿»é¡µæ¨¡å¼ï¼Œå¯ä½¿ç”¨ page up/downï¼Œæˆ–è€…æ–¹å‘é”®æ¥æµè§ˆ pane çš„å†…å®¹ # ä½¿ç”¨é¼ æ ‡æ»šè½®æ¥æ»šåŠ¨çª—å£å†…å®¹ï¼ˆä¹Ÿå¯ä»¥æŠŠæ­¤å‘½ä»¤æ·»åŠ åˆ° `~/.tmux.conf` ä¸­ä½¿å®ƒæ°¸ä¹…ç”Ÿæ•ˆï¼‰ prefix `:` ç„¶åè¾“å…¥ `set-window-option -g mode-mouse on` # ï¼ˆè°ƒæ•´ pane å¤§å°ï¼‰å°†å½“å‰çš„ pane å‘ç»™å®šçš„æ–¹å‘æ‰©å®¹ 5 è¡Œæˆ–è€… 5 åˆ— # æŒ‰ä½ ALT æ—¶å¿«é€Ÿé‡å¤æ•²å‡»ã€Œæ–¹å‘é”®ã€ï¼Œèƒ½å¿«é€Ÿè°ƒæ•´ï¼Œå¦åˆ™å°±å¾—ä» prefix å¼€å§‹é‡æ–°è¾“å…¥ prefix `Alt` + `æ–¹å‘é”®` # å°†å½“å‰çª—æ ¼å…¨å±æ˜¾ç¤ºï¼Œç¬¬äºŒæ¬¡ä½¿ç”¨æ­¤å‘½ä»¤ï¼Œä¼šå°†çª—æ ¼è¿˜åŸ prefix z # äº¤æ¢ pane çš„ä½ç½® prefix { # å½“å‰çª—æ ¼ä¸ä¸Šä¸€ä¸ªçª—æ ¼äº¤æ¢ä½ç½® prefix } # å½“å‰çª—æ ¼ä¸ä¸‹ä¸€ä¸ªçª—æ ¼äº¤æ¢ä½ç½® # session ç›¸å…³æ“ä½œ prefix s # æŸ¥çœ‹ session åˆ—è¡¨ï¼Œå¹¶é€šè¿‡æ–¹å‘é”®é€‰æ‹© session prefix `number` # é€šè¿‡æ•°å­—æ ‡ç­¾é€‰æ‹© session # window ç›¸å…³æ“ä½œï¼ˆå…³ç³»ï¼šæ¯ä¸ª session å¯ä»¥åŒ…å«å¤šä¸ª windowï¼Œæ¯ä¸ª window é‡Œé¢åˆå¯ä»¥æœ‰å¤šä¸ª paneï¼‰ prefix c # æ–°å»º window prefix w # é€šè¿‡æ•°å­—æ ‡ç­¾é€‰æ‹© window å‚è€ƒæ–‡æ¡£ï¼š https://github.com/tmux/tmux/wiki/Getting-Started https://www.ruanyifeng.com/blog/2019/10/tmux.html ","date":"2022-02-13","objectID":"/posts/common-commands-for-various-operating-systems/:1:5","series":null,"tags":["Linux","MacOSX","Windows","CLI","Powershell","Shell","tmux","rsync","vim","awk"],"title":"Linux/Windows/MacOSX ç³»ç»Ÿå¸¸ç”¨å‘½ä»¤é›†é”¦","uri":"/posts/common-commands-for-various-operating-systems/#5-tmux"},{"categories":["tech"],"content":" 6. Bash Shell åŸºç¡€ç›®æ ‡ï¼šèƒ½ä½¿ç”¨ shell ç¼–å†™ 10 è¡Œä»¥å†…çš„è„šæœ¬ã€‚æ›´é•¿çš„è„šæœ¬å¯ä»¥ä½¿ç”¨ Python ç¼–å†™ï¼Œå°±æ²¡å¿…è¦æŠ˜è…¾ Shell äº†ã€‚ 1. For å¾ªç¯å•è¡Œ for å¾ªç¯ï¼Œæœ‰æ—¶å€™å¾ˆæœ‰ç”¨ï¼š shell # æ•°å­—æšä¸¾ for i in $(seq 1 5); do echo $i; done # sh/bash éƒ½æ”¯æŒ for i in {1..5}; do echo $i; done # sh ä¸æ”¯æŒæ­¤è¯­æ³• # æ–‡ä»¶æšä¸¾ï¼Œå¯ä½¿ç”¨ glob è¯­æ³•è¿›è¡Œæ–‡ä»¶åŒ¹é… for f in *; do echo $f; done for f in /etc/*.py; do echo $f; done # ä½¿ç”¨ find è¿›è¡Œæ–‡ä»¶æšä¸¾ for f in $(find . -name *.py); do echo $f; done å•è¡Œ for å¾ªç¯åŠ å‡ ä¸ªæ¢è¡Œå°±å¾—åˆ°å¤šè¡Œ for å¾ªç¯ï¼Œæ ¼å¼å¦‚ä¸‹ï¼šå†™è„šæœ¬ç”¨å¾—åˆ°ï¼Œä¸è¿‡æ›´å»ºè®®ç”¨ python: shell for i in $(seq 1 5) do echo $i done # sh/bash éƒ½æ”¯æŒ 2. if è¯­å¥ shell # å•è¡Œ if è¯­å¥ if [ true ]; then \u003ccommand\u003e; fi # if else if [ expression ] then Statement(s) to be executed if expression is true else Statement(s) to be executed if expression is not true fi 3. Shell è„šæœ¬ä¸­çš„ set æŒ‡ä»¤ï¼Œæ¯”å¦‚ set -x å’Œ set -eå‚è§ï¼šShell è„šæœ¬ä¸­çš„ set æŒ‡ä»¤ï¼Œæ¯”å¦‚ set -x å’Œ set -e 4. å®ç”¨å°å·¥å…· shell # URL ç¼–è§£ç  alias urldecode='python3 -c \"import sys, urllib.parse as ul; print(ul.unquote_plus(sys.stdin.read()))\"' alias urlencode='python3 -c \"import sys, urllib.parse as ul; print(ul.quote_plus(sys.stdin.read()))\"' # ä½¿ç”¨æ–¹æ³• echo \"xxx\" | urldecode cat file | urlencode 5. æŸ¥è¯¢å†å²è®°å½•ä¸´æ—¶ç‰ˆï¼š shell # æŸ¥è¯¢å‘½ä»¤è¡Œå†å²è®°å½•ï¼Œå¹¶å¸¦ä¸Šæ—¶é—´ HISTTIMEFORMAT=\"%F %T %z \" history ä¸€åŠ³æ°¸é€¸ç‰ˆï¼š shell # å°†ç¯å¢ƒå˜é‡åŠ å…¥ .bashrc echo 'HISTTIMEFORMAT=\"%F %T \"' \u003e\u003e ~/.bashrc source ~/.bashrc # æŸ¥è¯¢å†å²è®°å½• history 6. å…¶ä»–èµ„æ–™ shell_scripts: å®ç”¨ shell å°è„šæœ¬ ","date":"2022-02-13","objectID":"/posts/common-commands-for-various-operating-systems/:1:6","series":null,"tags":["Linux","MacOSX","Windows","CLI","Powershell","Shell","tmux","rsync","vim","awk"],"title":"Linux/Windows/MacOSX ç³»ç»Ÿå¸¸ç”¨å‘½ä»¤é›†é”¦","uri":"/posts/common-commands-for-various-operating-systems/#6-bash-shell-åŸºç¡€"},{"categories":["tech"],"content":" 6. Bash Shell åŸºç¡€ç›®æ ‡ï¼šèƒ½ä½¿ç”¨ shell ç¼–å†™ 10 è¡Œä»¥å†…çš„è„šæœ¬ã€‚æ›´é•¿çš„è„šæœ¬å¯ä»¥ä½¿ç”¨ Python ç¼–å†™ï¼Œå°±æ²¡å¿…è¦æŠ˜è…¾ Shell äº†ã€‚ 1. For å¾ªç¯å•è¡Œ for å¾ªç¯ï¼Œæœ‰æ—¶å€™å¾ˆæœ‰ç”¨ï¼š shell # æ•°å­—æšä¸¾ for i in $(seq 1 5); do echo $i; done # sh/bash éƒ½æ”¯æŒ for i in {1..5}; do echo $i; done # sh ä¸æ”¯æŒæ­¤è¯­æ³• # æ–‡ä»¶æšä¸¾ï¼Œå¯ä½¿ç”¨ glob è¯­æ³•è¿›è¡Œæ–‡ä»¶åŒ¹é… for f in *; do echo $f; done for f in /etc/*.py; do echo $f; done # ä½¿ç”¨ find è¿›è¡Œæ–‡ä»¶æšä¸¾ for f in $(find . -name *.py); do echo $f; done å•è¡Œ for å¾ªç¯åŠ å‡ ä¸ªæ¢è¡Œå°±å¾—åˆ°å¤šè¡Œ for å¾ªç¯ï¼Œæ ¼å¼å¦‚ä¸‹ï¼šå†™è„šæœ¬ç”¨å¾—åˆ°ï¼Œä¸è¿‡æ›´å»ºè®®ç”¨ python: shell for i in $(seq 1 5) do echo $i done # sh/bash éƒ½æ”¯æŒ 2. if è¯­å¥ shell # å•è¡Œ if è¯­å¥ if [ true ]; then ; fi # if else if [ expression ] then Statement(s) to be executed if expression is true else Statement(s) to be executed if expression is not true fi 3. Shell è„šæœ¬ä¸­çš„ set æŒ‡ä»¤ï¼Œæ¯”å¦‚ set -x å’Œ set -eå‚è§ï¼šShell è„šæœ¬ä¸­çš„ set æŒ‡ä»¤ï¼Œæ¯”å¦‚ set -x å’Œ set -e 4. å®ç”¨å°å·¥å…· shell # URL ç¼–è§£ç  alias urldecode='python3 -c \"import sys, urllib.parse as ul; print(ul.unquote_plus(sys.stdin.read()))\"' alias urlencode='python3 -c \"import sys, urllib.parse as ul; print(ul.quote_plus(sys.stdin.read()))\"' # ä½¿ç”¨æ–¹æ³• echo \"xxx\" | urldecode cat file | urlencode 5. æŸ¥è¯¢å†å²è®°å½•ä¸´æ—¶ç‰ˆï¼š shell # æŸ¥è¯¢å‘½ä»¤è¡Œå†å²è®°å½•ï¼Œå¹¶å¸¦ä¸Šæ—¶é—´ HISTTIMEFORMAT=\"%F %T %z \" history ä¸€åŠ³æ°¸é€¸ç‰ˆï¼š shell # å°†ç¯å¢ƒå˜é‡åŠ å…¥ .bashrc echo 'HISTTIMEFORMAT=\"%F %T \"' \u003e\u003e ~/.bashrc source ~/.bashrc # æŸ¥è¯¢å†å²è®°å½• history 6. å…¶ä»–èµ„æ–™ shell_scripts: å®ç”¨ shell å°è„šæœ¬ ","date":"2022-02-13","objectID":"/posts/common-commands-for-various-operating-systems/:1:6","series":null,"tags":["Linux","MacOSX","Windows","CLI","Powershell","Shell","tmux","rsync","vim","awk"],"title":"Linux/Windows/MacOSX ç³»ç»Ÿå¸¸ç”¨å‘½ä»¤é›†é”¦","uri":"/posts/common-commands-for-various-operating-systems/#1-for-å¾ªç¯"},{"categories":["tech"],"content":" 6. Bash Shell åŸºç¡€ç›®æ ‡ï¼šèƒ½ä½¿ç”¨ shell ç¼–å†™ 10 è¡Œä»¥å†…çš„è„šæœ¬ã€‚æ›´é•¿çš„è„šæœ¬å¯ä»¥ä½¿ç”¨ Python ç¼–å†™ï¼Œå°±æ²¡å¿…è¦æŠ˜è…¾ Shell äº†ã€‚ 1. For å¾ªç¯å•è¡Œ for å¾ªç¯ï¼Œæœ‰æ—¶å€™å¾ˆæœ‰ç”¨ï¼š shell # æ•°å­—æšä¸¾ for i in $(seq 1 5); do echo $i; done # sh/bash éƒ½æ”¯æŒ for i in {1..5}; do echo $i; done # sh ä¸æ”¯æŒæ­¤è¯­æ³• # æ–‡ä»¶æšä¸¾ï¼Œå¯ä½¿ç”¨ glob è¯­æ³•è¿›è¡Œæ–‡ä»¶åŒ¹é… for f in *; do echo $f; done for f in /etc/*.py; do echo $f; done # ä½¿ç”¨ find è¿›è¡Œæ–‡ä»¶æšä¸¾ for f in $(find . -name *.py); do echo $f; done å•è¡Œ for å¾ªç¯åŠ å‡ ä¸ªæ¢è¡Œå°±å¾—åˆ°å¤šè¡Œ for å¾ªç¯ï¼Œæ ¼å¼å¦‚ä¸‹ï¼šå†™è„šæœ¬ç”¨å¾—åˆ°ï¼Œä¸è¿‡æ›´å»ºè®®ç”¨ python: shell for i in $(seq 1 5) do echo $i done # sh/bash éƒ½æ”¯æŒ 2. if è¯­å¥ shell # å•è¡Œ if è¯­å¥ if [ true ]; then ; fi # if else if [ expression ] then Statement(s) to be executed if expression is true else Statement(s) to be executed if expression is not true fi 3. Shell è„šæœ¬ä¸­çš„ set æŒ‡ä»¤ï¼Œæ¯”å¦‚ set -x å’Œ set -eå‚è§ï¼šShell è„šæœ¬ä¸­çš„ set æŒ‡ä»¤ï¼Œæ¯”å¦‚ set -x å’Œ set -e 4. å®ç”¨å°å·¥å…· shell # URL ç¼–è§£ç  alias urldecode='python3 -c \"import sys, urllib.parse as ul; print(ul.unquote_plus(sys.stdin.read()))\"' alias urlencode='python3 -c \"import sys, urllib.parse as ul; print(ul.quote_plus(sys.stdin.read()))\"' # ä½¿ç”¨æ–¹æ³• echo \"xxx\" | urldecode cat file | urlencode 5. æŸ¥è¯¢å†å²è®°å½•ä¸´æ—¶ç‰ˆï¼š shell # æŸ¥è¯¢å‘½ä»¤è¡Œå†å²è®°å½•ï¼Œå¹¶å¸¦ä¸Šæ—¶é—´ HISTTIMEFORMAT=\"%F %T %z \" history ä¸€åŠ³æ°¸é€¸ç‰ˆï¼š shell # å°†ç¯å¢ƒå˜é‡åŠ å…¥ .bashrc echo 'HISTTIMEFORMAT=\"%F %T \"' \u003e\u003e ~/.bashrc source ~/.bashrc # æŸ¥è¯¢å†å²è®°å½• history 6. å…¶ä»–èµ„æ–™ shell_scripts: å®ç”¨ shell å°è„šæœ¬ ","date":"2022-02-13","objectID":"/posts/common-commands-for-various-operating-systems/:1:6","series":null,"tags":["Linux","MacOSX","Windows","CLI","Powershell","Shell","tmux","rsync","vim","awk"],"title":"Linux/Windows/MacOSX ç³»ç»Ÿå¸¸ç”¨å‘½ä»¤é›†é”¦","uri":"/posts/common-commands-for-various-operating-systems/#2-if-è¯­å¥"},{"categories":["tech"],"content":" 6. Bash Shell åŸºç¡€ç›®æ ‡ï¼šèƒ½ä½¿ç”¨ shell ç¼–å†™ 10 è¡Œä»¥å†…çš„è„šæœ¬ã€‚æ›´é•¿çš„è„šæœ¬å¯ä»¥ä½¿ç”¨ Python ç¼–å†™ï¼Œå°±æ²¡å¿…è¦æŠ˜è…¾ Shell äº†ã€‚ 1. For å¾ªç¯å•è¡Œ for å¾ªç¯ï¼Œæœ‰æ—¶å€™å¾ˆæœ‰ç”¨ï¼š shell # æ•°å­—æšä¸¾ for i in $(seq 1 5); do echo $i; done # sh/bash éƒ½æ”¯æŒ for i in {1..5}; do echo $i; done # sh ä¸æ”¯æŒæ­¤è¯­æ³• # æ–‡ä»¶æšä¸¾ï¼Œå¯ä½¿ç”¨ glob è¯­æ³•è¿›è¡Œæ–‡ä»¶åŒ¹é… for f in *; do echo $f; done for f in /etc/*.py; do echo $f; done # ä½¿ç”¨ find è¿›è¡Œæ–‡ä»¶æšä¸¾ for f in $(find . -name *.py); do echo $f; done å•è¡Œ for å¾ªç¯åŠ å‡ ä¸ªæ¢è¡Œå°±å¾—åˆ°å¤šè¡Œ for å¾ªç¯ï¼Œæ ¼å¼å¦‚ä¸‹ï¼šå†™è„šæœ¬ç”¨å¾—åˆ°ï¼Œä¸è¿‡æ›´å»ºè®®ç”¨ python: shell for i in $(seq 1 5) do echo $i done # sh/bash éƒ½æ”¯æŒ 2. if è¯­å¥ shell # å•è¡Œ if è¯­å¥ if [ true ]; then ; fi # if else if [ expression ] then Statement(s) to be executed if expression is true else Statement(s) to be executed if expression is not true fi 3. Shell è„šæœ¬ä¸­çš„ set æŒ‡ä»¤ï¼Œæ¯”å¦‚ set -x å’Œ set -eå‚è§ï¼šShell è„šæœ¬ä¸­çš„ set æŒ‡ä»¤ï¼Œæ¯”å¦‚ set -x å’Œ set -e 4. å®ç”¨å°å·¥å…· shell # URL ç¼–è§£ç  alias urldecode='python3 -c \"import sys, urllib.parse as ul; print(ul.unquote_plus(sys.stdin.read()))\"' alias urlencode='python3 -c \"import sys, urllib.parse as ul; print(ul.quote_plus(sys.stdin.read()))\"' # ä½¿ç”¨æ–¹æ³• echo \"xxx\" | urldecode cat file | urlencode 5. æŸ¥è¯¢å†å²è®°å½•ä¸´æ—¶ç‰ˆï¼š shell # æŸ¥è¯¢å‘½ä»¤è¡Œå†å²è®°å½•ï¼Œå¹¶å¸¦ä¸Šæ—¶é—´ HISTTIMEFORMAT=\"%F %T %z \" history ä¸€åŠ³æ°¸é€¸ç‰ˆï¼š shell # å°†ç¯å¢ƒå˜é‡åŠ å…¥ .bashrc echo 'HISTTIMEFORMAT=\"%F %T \"' \u003e\u003e ~/.bashrc source ~/.bashrc # æŸ¥è¯¢å†å²è®°å½• history 6. å…¶ä»–èµ„æ–™ shell_scripts: å®ç”¨ shell å°è„šæœ¬ ","date":"2022-02-13","objectID":"/posts/common-commands-for-various-operating-systems/:1:6","series":null,"tags":["Linux","MacOSX","Windows","CLI","Powershell","Shell","tmux","rsync","vim","awk"],"title":"Linux/Windows/MacOSX ç³»ç»Ÿå¸¸ç”¨å‘½ä»¤é›†é”¦","uri":"/posts/common-commands-for-various-operating-systems/#3-shell-è„šæœ¬ä¸­çš„-set-æŒ‡ä»¤æ¯”å¦‚-set--x-å’Œ-set--e"},{"categories":["tech"],"content":" 6. Bash Shell åŸºç¡€ç›®æ ‡ï¼šèƒ½ä½¿ç”¨ shell ç¼–å†™ 10 è¡Œä»¥å†…çš„è„šæœ¬ã€‚æ›´é•¿çš„è„šæœ¬å¯ä»¥ä½¿ç”¨ Python ç¼–å†™ï¼Œå°±æ²¡å¿…è¦æŠ˜è…¾ Shell äº†ã€‚ 1. For å¾ªç¯å•è¡Œ for å¾ªç¯ï¼Œæœ‰æ—¶å€™å¾ˆæœ‰ç”¨ï¼š shell # æ•°å­—æšä¸¾ for i in $(seq 1 5); do echo $i; done # sh/bash éƒ½æ”¯æŒ for i in {1..5}; do echo $i; done # sh ä¸æ”¯æŒæ­¤è¯­æ³• # æ–‡ä»¶æšä¸¾ï¼Œå¯ä½¿ç”¨ glob è¯­æ³•è¿›è¡Œæ–‡ä»¶åŒ¹é… for f in *; do echo $f; done for f in /etc/*.py; do echo $f; done # ä½¿ç”¨ find è¿›è¡Œæ–‡ä»¶æšä¸¾ for f in $(find . -name *.py); do echo $f; done å•è¡Œ for å¾ªç¯åŠ å‡ ä¸ªæ¢è¡Œå°±å¾—åˆ°å¤šè¡Œ for å¾ªç¯ï¼Œæ ¼å¼å¦‚ä¸‹ï¼šå†™è„šæœ¬ç”¨å¾—åˆ°ï¼Œä¸è¿‡æ›´å»ºè®®ç”¨ python: shell for i in $(seq 1 5) do echo $i done # sh/bash éƒ½æ”¯æŒ 2. if è¯­å¥ shell # å•è¡Œ if è¯­å¥ if [ true ]; then ; fi # if else if [ expression ] then Statement(s) to be executed if expression is true else Statement(s) to be executed if expression is not true fi 3. Shell è„šæœ¬ä¸­çš„ set æŒ‡ä»¤ï¼Œæ¯”å¦‚ set -x å’Œ set -eå‚è§ï¼šShell è„šæœ¬ä¸­çš„ set æŒ‡ä»¤ï¼Œæ¯”å¦‚ set -x å’Œ set -e 4. å®ç”¨å°å·¥å…· shell # URL ç¼–è§£ç  alias urldecode='python3 -c \"import sys, urllib.parse as ul; print(ul.unquote_plus(sys.stdin.read()))\"' alias urlencode='python3 -c \"import sys, urllib.parse as ul; print(ul.quote_plus(sys.stdin.read()))\"' # ä½¿ç”¨æ–¹æ³• echo \"xxx\" | urldecode cat file | urlencode 5. æŸ¥è¯¢å†å²è®°å½•ä¸´æ—¶ç‰ˆï¼š shell # æŸ¥è¯¢å‘½ä»¤è¡Œå†å²è®°å½•ï¼Œå¹¶å¸¦ä¸Šæ—¶é—´ HISTTIMEFORMAT=\"%F %T %z \" history ä¸€åŠ³æ°¸é€¸ç‰ˆï¼š shell # å°†ç¯å¢ƒå˜é‡åŠ å…¥ .bashrc echo 'HISTTIMEFORMAT=\"%F %T \"' \u003e\u003e ~/.bashrc source ~/.bashrc # æŸ¥è¯¢å†å²è®°å½• history 6. å…¶ä»–èµ„æ–™ shell_scripts: å®ç”¨ shell å°è„šæœ¬ ","date":"2022-02-13","objectID":"/posts/common-commands-for-various-operating-systems/:1:6","series":null,"tags":["Linux","MacOSX","Windows","CLI","Powershell","Shell","tmux","rsync","vim","awk"],"title":"Linux/Windows/MacOSX ç³»ç»Ÿå¸¸ç”¨å‘½ä»¤é›†é”¦","uri":"/posts/common-commands-for-various-operating-systems/#4-å®ç”¨å°å·¥å…·"},{"categories":["tech"],"content":" 6. Bash Shell åŸºç¡€ç›®æ ‡ï¼šèƒ½ä½¿ç”¨ shell ç¼–å†™ 10 è¡Œä»¥å†…çš„è„šæœ¬ã€‚æ›´é•¿çš„è„šæœ¬å¯ä»¥ä½¿ç”¨ Python ç¼–å†™ï¼Œå°±æ²¡å¿…è¦æŠ˜è…¾ Shell äº†ã€‚ 1. For å¾ªç¯å•è¡Œ for å¾ªç¯ï¼Œæœ‰æ—¶å€™å¾ˆæœ‰ç”¨ï¼š shell # æ•°å­—æšä¸¾ for i in $(seq 1 5); do echo $i; done # sh/bash éƒ½æ”¯æŒ for i in {1..5}; do echo $i; done # sh ä¸æ”¯æŒæ­¤è¯­æ³• # æ–‡ä»¶æšä¸¾ï¼Œå¯ä½¿ç”¨ glob è¯­æ³•è¿›è¡Œæ–‡ä»¶åŒ¹é… for f in *; do echo $f; done for f in /etc/*.py; do echo $f; done # ä½¿ç”¨ find è¿›è¡Œæ–‡ä»¶æšä¸¾ for f in $(find . -name *.py); do echo $f; done å•è¡Œ for å¾ªç¯åŠ å‡ ä¸ªæ¢è¡Œå°±å¾—åˆ°å¤šè¡Œ for å¾ªç¯ï¼Œæ ¼å¼å¦‚ä¸‹ï¼šå†™è„šæœ¬ç”¨å¾—åˆ°ï¼Œä¸è¿‡æ›´å»ºè®®ç”¨ python: shell for i in $(seq 1 5) do echo $i done # sh/bash éƒ½æ”¯æŒ 2. if è¯­å¥ shell # å•è¡Œ if è¯­å¥ if [ true ]; then ; fi # if else if [ expression ] then Statement(s) to be executed if expression is true else Statement(s) to be executed if expression is not true fi 3. Shell è„šæœ¬ä¸­çš„ set æŒ‡ä»¤ï¼Œæ¯”å¦‚ set -x å’Œ set -eå‚è§ï¼šShell è„šæœ¬ä¸­çš„ set æŒ‡ä»¤ï¼Œæ¯”å¦‚ set -x å’Œ set -e 4. å®ç”¨å°å·¥å…· shell # URL ç¼–è§£ç  alias urldecode='python3 -c \"import sys, urllib.parse as ul; print(ul.unquote_plus(sys.stdin.read()))\"' alias urlencode='python3 -c \"import sys, urllib.parse as ul; print(ul.quote_plus(sys.stdin.read()))\"' # ä½¿ç”¨æ–¹æ³• echo \"xxx\" | urldecode cat file | urlencode 5. æŸ¥è¯¢å†å²è®°å½•ä¸´æ—¶ç‰ˆï¼š shell # æŸ¥è¯¢å‘½ä»¤è¡Œå†å²è®°å½•ï¼Œå¹¶å¸¦ä¸Šæ—¶é—´ HISTTIMEFORMAT=\"%F %T %z \" history ä¸€åŠ³æ°¸é€¸ç‰ˆï¼š shell # å°†ç¯å¢ƒå˜é‡åŠ å…¥ .bashrc echo 'HISTTIMEFORMAT=\"%F %T \"' \u003e\u003e ~/.bashrc source ~/.bashrc # æŸ¥è¯¢å†å²è®°å½• history 6. å…¶ä»–èµ„æ–™ shell_scripts: å®ç”¨ shell å°è„šæœ¬ ","date":"2022-02-13","objectID":"/posts/common-commands-for-various-operating-systems/:1:6","series":null,"tags":["Linux","MacOSX","Windows","CLI","Powershell","Shell","tmux","rsync","vim","awk"],"title":"Linux/Windows/MacOSX ç³»ç»Ÿå¸¸ç”¨å‘½ä»¤é›†é”¦","uri":"/posts/common-commands-for-various-operating-systems/#5-æŸ¥è¯¢å†å²è®°å½•"},{"categories":["tech"],"content":" 6. Bash Shell åŸºç¡€ç›®æ ‡ï¼šèƒ½ä½¿ç”¨ shell ç¼–å†™ 10 è¡Œä»¥å†…çš„è„šæœ¬ã€‚æ›´é•¿çš„è„šæœ¬å¯ä»¥ä½¿ç”¨ Python ç¼–å†™ï¼Œå°±æ²¡å¿…è¦æŠ˜è…¾ Shell äº†ã€‚ 1. For å¾ªç¯å•è¡Œ for å¾ªç¯ï¼Œæœ‰æ—¶å€™å¾ˆæœ‰ç”¨ï¼š shell # æ•°å­—æšä¸¾ for i in $(seq 1 5); do echo $i; done # sh/bash éƒ½æ”¯æŒ for i in {1..5}; do echo $i; done # sh ä¸æ”¯æŒæ­¤è¯­æ³• # æ–‡ä»¶æšä¸¾ï¼Œå¯ä½¿ç”¨ glob è¯­æ³•è¿›è¡Œæ–‡ä»¶åŒ¹é… for f in *; do echo $f; done for f in /etc/*.py; do echo $f; done # ä½¿ç”¨ find è¿›è¡Œæ–‡ä»¶æšä¸¾ for f in $(find . -name *.py); do echo $f; done å•è¡Œ for å¾ªç¯åŠ å‡ ä¸ªæ¢è¡Œå°±å¾—åˆ°å¤šè¡Œ for å¾ªç¯ï¼Œæ ¼å¼å¦‚ä¸‹ï¼šå†™è„šæœ¬ç”¨å¾—åˆ°ï¼Œä¸è¿‡æ›´å»ºè®®ç”¨ python: shell for i in $(seq 1 5) do echo $i done # sh/bash éƒ½æ”¯æŒ 2. if è¯­å¥ shell # å•è¡Œ if è¯­å¥ if [ true ]; then ; fi # if else if [ expression ] then Statement(s) to be executed if expression is true else Statement(s) to be executed if expression is not true fi 3. Shell è„šæœ¬ä¸­çš„ set æŒ‡ä»¤ï¼Œæ¯”å¦‚ set -x å’Œ set -eå‚è§ï¼šShell è„šæœ¬ä¸­çš„ set æŒ‡ä»¤ï¼Œæ¯”å¦‚ set -x å’Œ set -e 4. å®ç”¨å°å·¥å…· shell # URL ç¼–è§£ç  alias urldecode='python3 -c \"import sys, urllib.parse as ul; print(ul.unquote_plus(sys.stdin.read()))\"' alias urlencode='python3 -c \"import sys, urllib.parse as ul; print(ul.quote_plus(sys.stdin.read()))\"' # ä½¿ç”¨æ–¹æ³• echo \"xxx\" | urldecode cat file | urlencode 5. æŸ¥è¯¢å†å²è®°å½•ä¸´æ—¶ç‰ˆï¼š shell # æŸ¥è¯¢å‘½ä»¤è¡Œå†å²è®°å½•ï¼Œå¹¶å¸¦ä¸Šæ—¶é—´ HISTTIMEFORMAT=\"%F %T %z \" history ä¸€åŠ³æ°¸é€¸ç‰ˆï¼š shell # å°†ç¯å¢ƒå˜é‡åŠ å…¥ .bashrc echo 'HISTTIMEFORMAT=\"%F %T \"' \u003e\u003e ~/.bashrc source ~/.bashrc # æŸ¥è¯¢å†å²è®°å½• history 6. å…¶ä»–èµ„æ–™ shell_scripts: å®ç”¨ shell å°è„šæœ¬ ","date":"2022-02-13","objectID":"/posts/common-commands-for-various-operating-systems/:1:6","series":null,"tags":["Linux","MacOSX","Windows","CLI","Powershell","Shell","tmux","rsync","vim","awk"],"title":"Linux/Windows/MacOSX ç³»ç»Ÿå¸¸ç”¨å‘½ä»¤é›†é”¦","uri":"/posts/common-commands-for-various-operating-systems/#6-å…¶ä»–èµ„æ–™"},{"categories":["tech"],"content":" 7. socket è¿æ¥æŸ¥è¯¢ - ss/netcat/lsofæŸ¥çœ‹ socket ä¿¡æ¯å¯ä»¥å¸®æˆ‘ä»¬å›ç­”ä¸‹åˆ—é—®é¢˜ï¼š æˆ‘çš„ç¨‹åºæ˜¯ä¸æ˜¯çœŸçš„åœ¨ç›‘å¬æˆ‘æŒ‡å®šçš„ç«¯å£ï¼Ÿ æˆ‘çš„ç¨‹åºæ˜¯åœ¨ç›‘å¬ 127.0.0.1ï¼ˆæœ¬æœºï¼‰ï¼Œè¿˜æ˜¯åœ¨ç›‘å¬ 0.0.0.0ï¼ˆæ•´ä¸ªç½‘ç»œï¼‰ è¿›ç¨‹ä»¬åˆ†åˆ«åœ¨ä½¿ç”¨å“ªäº›ç«¯å£ï¼Ÿ æˆ‘çš„è¿æ¥æ•°æ˜¯å¦è¾¾åˆ°äº†ä¸Šé™ï¼Ÿ ç°åœ¨è¾ƒæ–°ç‰ˆæœ¬çš„ Ubuntu å’Œ CentOS éƒ½å·²ç»ä½¿ç”¨ iproute2 æ›¿æ¢æ‰äº† net-toolsï¼Œå¦‚æœä½ è¿˜éœ€è¦ä½¿ç”¨é™ˆæ—§çš„ route netstat ç­‰å‘½ä»¤ï¼Œéœ€è¦æ‰‹åŠ¨å®‰è£… net-toolsã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ss(socket statistics) æˆ–è€… netstat å‘½ä»¤æ¥æŸ¥çœ‹ socket ä¿¡æ¯: shell # æŸ¥çœ‹ socket è¿æ¥çš„ç»Ÿè®¡ä¿¡æ¯ # ä¸»è¦ç»Ÿè®¡å¤„äºå„ç§çŠ¶æ€çš„ tcp sockets æ•°é‡ï¼Œä»¥åŠå…¶ä»– sockets çš„ç»Ÿè®¡ä¿¡æ¯ ss --summary ss -s # ç¼©å†™ # æŸ¥çœ‹å“ªä¸ªè¿›ç¨‹åœ¨ç›‘å¬ 80 ç«¯å£ # --listening åˆ—å‡ºæ‰€æœ‰æ­£åœ¨è¢«ç›‘å¬çš„ socket # --processes æ˜¾ç¤ºå‡ºæ¯ä¸ª socket å¯¹åº”çš„ process åç§°å’Œ pid # --numeric ç›´æ¥æ‰“å°æ•°å­—ç«¯å£å·ï¼ˆä¸è§£æåè®®åç§°ï¼‰ ss --listening --processes --numeric | grep 80 ss -nlp | grep 80 # ç¼©å†™ ss -lp | grep http # è§£æåè®®åç§°ï¼Œç„¶åé€šè¿‡åè®®åæœç´¢ç›‘å¬ ## ä½¿ç”¨è¿‡æ—¶çš„ netstat ### -t tcp ### -u udp netstat -tunlp | grep \":80\" # æŸ¥çœ‹ sshd å½“å‰ä½¿ç”¨çš„ç«¯å£å· ss --listening --processes | grep sshd ## ä½¿ç”¨è¿‡æ—¶çš„ netstat netstat -tunlp | grep \u003cpid\u003e # pid é€šè¿‡ ps å‘½ä»¤è·å¾— # åˆ—å‡ºæ‰€æœ‰çš„ tcp socketsï¼ŒåŒ…æ‹¬æ‰€æœ‰çš„ socket çŠ¶æ€ ss --tcp --all # åªåˆ—å‡ºæ­£åœ¨ listen çš„ socket ss --listening # åˆ—å‡ºæ‰€æœ‰ ESTABLISHED çš„ socketï¼ˆé»˜è®¤è¡Œä¸ºï¼‰ ss # ç»Ÿè®¡ TCP è¿æ¥æ•° ss | grep ESTAB | wc -l # åˆ—å‡ºæ‰€æœ‰ ESTABLISHED çš„ socketï¼Œå¹¶ä¸”ç»™å‡ºè¿æ¥çš„è®¡æ—¶å™¨ ss --options # æŸ¥çœ‹æ‰€æœ‰æ¥è‡ª 192.168.5 çš„ sockets ss dst 192.168.1.5 # æŸ¥çœ‹æœ¬æœºä¸æœåŠ¡å™¨ 192.168.1.100 å»ºç«‹çš„ sockets ss src 192.168.1.5 TCP è¿æ¥æ•°å— Linux æ–‡ä»¶æè¿°ç¬¦ä¸Šé™æ§åˆ¶ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹æ³•æŸ¥çœ‹å·²ç”¨æ–‡ä»¶å¥æŸ„çš„æ•°é‡ã€‚ shell # å·²ç”¨æ–‡ä»¶æè¿°ç¬¦æ•°é‡ lsof | wc -l # æ–‡ä»¶æè¿°ç¬¦ä¸Šé™ ulimit -n ","date":"2022-02-13","objectID":"/posts/common-commands-for-various-operating-systems/:1:7","series":null,"tags":["Linux","MacOSX","Windows","CLI","Powershell","Shell","tmux","rsync","vim","awk"],"title":"Linux/Windows/MacOSX ç³»ç»Ÿå¸¸ç”¨å‘½ä»¤é›†é”¦","uri":"/posts/common-commands-for-various-operating-systems/#socket-commands"},{"categories":["tech"],"content":" 8. å…¶ä»–ç½‘ç»œç›¸å…³å‘½ä»¤ä¸»è¦æ˜¯ iproute2 dhclient lsof ç­‰ shell # æŸ¥çœ‹è·¯ç”±è¡¨ routel # æ—§çš„ net-tools åŒ…ä¸­çš„å‘½ä»¤ ip route ls # iproute2 æä¾›çš„æ–°å‘½ä»¤ # DHCPï¼Œå…ˆé‡Šæ”¾æ—§ç§Ÿçº¦ï¼Œå†å»ºç«‹æ–°ç§Ÿçº¦ sudo dhclient -r eth0 \u0026\u0026 sudo dhclient eth0 # æŸ¥çœ‹ DHCP ç§ŸæœŸ cat /var/lib/dhcp/dhcpd.leases # æ¸…ç† DNS ç¼“å­˜ ## 1. å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ systemd-resolveï¼Œä½¿ç”¨æ­¤å‘½ä»¤ sudo systemd-resolve --flush-caches sudo systemd-resolve --statistics # æŸ¥çœ‹ç¼“å­˜çŠ¶æ€ ## 2. å¦‚æœä½¿ç”¨çš„æ˜¯ dnsmasqï¼Œä½¿ç”¨æ­¤å‘½ä»¤ sudo systemctl restart dnsmasq sudo killall -HUP dnsmasq # ç›´æ¥å‘é€ HUP ä¿¡å·ä¹Ÿå¯ä»¥ ","date":"2022-02-13","objectID":"/posts/common-commands-for-various-operating-systems/:1:8","series":null,"tags":["Linux","MacOSX","Windows","CLI","Powershell","Shell","tmux","rsync","vim","awk"],"title":"Linux/Windows/MacOSX ç³»ç»Ÿå¸¸ç”¨å‘½ä»¤é›†é”¦","uri":"/posts/common-commands-for-various-operating-systems/#8-å…¶ä»–ç½‘ç»œç›¸å…³å‘½ä»¤"},{"categories":["tech"],"content":" 9. å®¹å™¨ç½‘ç»œè¯Šæ–­ - nsenterDocker å®¹å™¨æœ‰è‡ªå·±çš„ namespaceï¼Œç›´æ¥é€šè¿‡å®¿ä¸»æœºçš„ ss å‘½ä»¤æ˜¯æŸ¥çœ‹ä¸åˆ°å®¹å™¨çš„ socket ä¿¡æ¯çš„ã€‚ æ¯”è¾ƒç›´è§‚çš„æ–¹æ³•æ˜¯ç›´æ¥é€šè¿‡ docker exec åœ¨å®¹å™¨ä¸­é€šè¿‡ ss å‘½ä»¤ã€‚ä½†æ˜¯è¿™è¦æ±‚å®¹å™¨ä¸­å¿…é¡»è‡ªå¸¦ ss ç­‰ç¨‹åºï¼Œæœ‰çš„ç²¾ç®€é•œåƒå¯èƒ½ä¸ä¼šè‡ªå¸¦å®ƒã€‚ é€šè¿‡ nsenter å¯ä»¥ç›´æ¥è¿›å…¥åˆ°å®¹å™¨çš„æŒ‡å®š namespace ä¸­ï¼Œè¿™æ ·å°±èƒ½ç›´æ¥æŸ¥è¯¢å®¹å™¨ç½‘ç»œç›¸å…³çš„ä¿¡æ¯äº†ã€‚ shell docker ps | grep xxx echo CONTAINER=xxx # å®¹å™¨åç§°æˆ– ID # 1. æŸ¥è¯¢åˆ°å®¹å™¨å¯¹åº”çš„ pid PID=$(docker inspect --format {{.State.Pid}} $CONTAINER) # 2. nsenter é€šè¿‡ pid è¿›å…¥å®¹å™¨çš„ network namespaceï¼Œæ‰§è¡Œ ss æŸ¥çœ‹ socket ä¿¡æ¯ nsenter --target $PID --net ss -s nsenter è¿™ä¸ªå·¥å…·è²Œä¼¼æ˜¯ docker è‡ªå¸¦çš„æˆ–è€…æ˜¯ç³»ç»Ÿå†…ç½®å‘½ä»¤ï¼Œåªè¦è£…äº† dockerï¼Œubuntu/centos éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ã€‚ nsenter æ˜¯ä¸€ä¸ªè¿›å…¥åå­—ç©ºé—´çš„å·¥å…·ï¼ŒåŠŸèƒ½ä¸ä»…ä»…å±€é™åœ¨ã€Œç½‘ç»œè¯Šæ–­ã€ï¼Œè¿˜æœ‰æ›´å¤šç”¨æ³•ã€‚ ","date":"2022-02-13","objectID":"/posts/common-commands-for-various-operating-systems/:1:9","series":null,"tags":["Linux","MacOSX","Windows","CLI","Powershell","Shell","tmux","rsync","vim","awk"],"title":"Linux/Windows/MacOSX ç³»ç»Ÿå¸¸ç”¨å‘½ä»¤é›†é”¦","uri":"/posts/common-commands-for-various-operating-systems/#9-å®¹å™¨ç½‘ç»œè¯Šæ–­---nsenter"},{"categories":["tech"],"content":" 10. ç”¨æˆ·ä¸ç¾¤ç»„ shell ## æŸ¥çœ‹ç”¨æˆ·å±äºå“ªäº›ç¾¤ç»„ groups \u003cuser-name\u003e # æ–¹æ³•ä¸€ id \u003cusername\u003e # æ–¹æ³•äºŒï¼Œå®ƒä¼šé¢å¤–åˆ—å‡º gid/uid cat /etc/group | grep \u003cuser-name\u003e # æ–¹æ³•ä¸‰ï¼Œç›´æ¥æŸ¥çœ‹é…ç½® ## æŸ¥çœ‹ç¾¤ç»„ä¸­æœ‰å“ªäº›ç”¨æˆ·ï¼Œç¬¬ä¸€åˆ—æ˜¯ç¾¤ç»„ï¼Œæœ€åä¸€åˆ—æ˜¯ç”¨æˆ·å cat /etc/group | grep \u003cgroup-name\u003e ","date":"2022-02-13","objectID":"/posts/common-commands-for-various-operating-systems/:1:10","series":null,"tags":["Linux","MacOSX","Windows","CLI","Powershell","Shell","tmux","rsync","vim","awk"],"title":"Linux/Windows/MacOSX ç³»ç»Ÿå¸¸ç”¨å‘½ä»¤é›†é”¦","uri":"/posts/common-commands-for-various-operating-systems/#10-ç”¨æˆ·ä¸ç¾¤ç»„"},{"categories":["tech"],"content":" äºŒã€PowershellPowershell æ˜¯å¾®è½¯æ¨å‡ºçš„ä¸€æ¬¾æ–°ä¸€ä»£ shellï¼Œå®ƒçš„ç‰¹ç‚¹ä¹‹ä¸€æ˜¯ï¼Œå‘½ä»¤éƒ½æœ‰ä¸€è‡´çš„å‘½åè§„åˆ™ï¼šè°“è¯-åè¯ï¼Œè°“è¯è¡¨ç¤ºåŠ¨ä½œï¼šGet/Set/Stop/Start ç­‰ï¼Œåè¯æŒ‡ç¤ºæ“ä½œå¯¹è±¡ï¼šService/Member/ChildItem/Command ç­‰ã€‚ è¿™æ ·çš„å‘½åæ ¼å¼ä½¿æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°çŒœæµ‹åˆ°è‡ªå·±éœ€è¦çš„å‘½ä»¤çš„åç§°ã€‚ ä¸ºäº†ä½¿ç”¨æ–¹ä¾¿ï¼Œpowershell è¿˜æä¾›äº†ä¸€äº›å¸¸ç”¨å‘½ä»¤çš„ç¼©å†™ï¼Œå¹¶ä¸”æ·»åŠ äº†å¤§é‡ç±»ä¼¼ Linux å‘½ä»¤çš„åˆ«åã€‚ è¿˜æœ‰å°±æ˜¯ï¼ŒWindows é»˜è®¤ä¸åŒºåˆ†å­—æ¯å¤§å°å†™ï¼Œæ—¥å¸¸ä½¿ç”¨å¯ä»¥å…¨éƒ¨å°å†™ã€‚ ","date":"2022-02-13","objectID":"/posts/common-commands-for-various-operating-systems/:2:0","series":null,"tags":["Linux","MacOSX","Windows","CLI","Powershell","Shell","tmux","rsync","vim","awk"],"title":"Linux/Windows/MacOSX ç³»ç»Ÿå¸¸ç”¨å‘½ä»¤é›†é”¦","uri":"/posts/common-commands-for-various-operating-systems/#äºŒpowershell"},{"categories":["tech"],"content":" 1. å®ç”¨å‘½ä»¤ powershell # åˆ é™¤æ–‡ä»¶/æ–‡ä»¶å¤¹ remove-item xxx -confirm ri xxx # åˆ«å1 rm xxx # åˆ«å2 rmdir xxx # etc... # å¤åˆ¶ copy-item xxx xx -r cp -r xxx xx # æ˜¾ç¤ºå·¥ä½œç›®å½• get-location gl pwd # åˆ‡æ¢å·¥ä½œç›®å½• set-location xxx sl xxx cd xxx # æŸ¥çœ‹ç¯å¢ƒå˜é‡ get-childitem env: gci env: gci env:PATH # æŸ¥çœ‹ PATH å˜é‡ $env:XXX=\"value\" # ä¸´æ—¶è®¾ç½®ç¯å¢ƒå˜é‡ $env:Path += \";SomeRandomPath\" # ä¸´æ—¶åœ¨ Path æœ«å°¾æ·»åŠ æ–°è·¯å¾„ ## ä»¥ä¸‹ä¸‰è¡Œå‘½ä»¤åªå¯¹ windows æœ‰æ•ˆï¼Œlinux ä¸‹æ— æ•ˆ [Environment]::SetEnvironmentVariable(\"XXX\", $env:XXX + \";value\", [EnvironmentVariableTarget]::User) # ä¿®æ”¹å½“å‰ç”¨æˆ·çš„ç¯å¢ƒå˜é‡ï¼ˆæ°¸ä¹…ï¼‰ï¼Œåªå¯¹æ–°è¿›ç¨‹æœ‰æ•ˆ [Environment]::SetEnvironmentVariable(\"XXX\", \"value\", [EnvironmentVariableTarget]::Machine) # ç»™è¿™å°ç”µè„‘è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆæ°¸ä¹…ï¼‰ï¼Œåªå¯¹æ–°è¿›ç¨‹æœ‰æ•ˆï¼Œéœ€è¦ç®¡ç†å‘˜æƒé™ [Environment]::SetEnvironmentVariable(\"XXX\", $env:XXX + \";value\", \"User\") # target ä¹Ÿå¯ç”¨å­—ç¬¦ä¸²æŒ‡å®š # åˆ é™¤æ–‡ä»¶/æ–‡ä»¶å¤¹ rm xxx # åˆ é™¤æ–‡ä»¶å¤¹æ—¶ä¼šè¿›å…¥äº¤äº’ç•Œé¢ï¼ŒæŒ‰æç¤ºè¾“å…¥å°±è¡Œã€‚ # æŸ¥çœ‹å‘½åä½ç½®ï¼ˆç±»ä¼¼ Linux Shell çš„ whichï¼‰ get-command xxx gcm xxx # é€šè¿‡å…³é”®å­—æŸ¥æ‰¾ powershell å‘½ä»¤ gcm | select-string \u003ckeyword\u003e # é€šè¿‡å…³é”®å­—æŸ¥æ‰¾ powershell å‘½ä»¤å’Œç¯å¢ƒå˜é‡ä¸­çš„ç¨‹åºï¼Œæ¯”è¾ƒæ…¢ gcm * | select-string \u003ckeyword\u003e # æŸ¥çœ‹åˆ«åå¯¹åº”çš„çœŸå®å‘½ä»¤ get-alias # ç±»ä¼¼ linux çš„ find/ls å‘½ä»¤ get-childitem -Recurse -Include *.py gci -r -i *.py # æ¸…ç©ºç»ˆç«¯çš„è¾“å‡º clear-host clear # æŸ¥çœ‹æ–‡ä»¶å†…å®¹ get-content xx.py | more get-content xx.py | out-host -paging cat xx.py gc xx.py # å­—ç¬¦ä¸²æœç´¢ï¼Œä¸èƒ½å¯¹å¯¹è±¡ä½¿ç”¨ # ç±»ä¼¼ linux çš„ grep å‘½ä»¤ cat xxx.log | select-string \u003cpattern\u003e gci env: | out-string -stream | select-string \u003cpattern\u003e # éœ€è¦å…ˆä½¿ç”¨ out-string å°†å¯¹è±¡è½¬æ¢æˆ string gci env: | where-object {$_.Name -like \u003cpattern\u003e} # è®¡ç®—è¾“å‡ºçš„è¡Œæ•°/å¯¹è±¡ä¸ªæ•° gci env: | measure-object gci env: | measure # è¿™æ˜¯ç¼©å†™ # å…³æœº/é‡å¯ stop-computer restart-computer # windows è®¡ç®— hash å€¼ # åŠŸèƒ½ç­‰åŒäº linux ä¸‹çš„ sha256sum/sha1sum/sha512sum/md5sum Get-FileHash -Path /path/to/file -Algorithm SHA256 Get-FileHash -Path /path/to/file -Algorithm SHA256 | Format-List # ç”¨ format ä¿®æ”¹æ ¼å¼åŒ–æ•ˆæœ # base64 ç¼–è§£ç  [Convert]::ToBase64String([Text.Encoding]::UTF8.GetBytes(\"xxx\")) # base64 ç¼–ç  [Text.Encoding]::UTF8.GetString([Convert]::FromBase64String(\"eHh4\")) # è§£ç  å¦å¤– windows åŒæ ·è‡ªå¸¦ ssh/scp å‘½ä»¤ï¼Œå‚æ•°ä¹Ÿå’Œ linux ä¸€è‡´ ","date":"2022-02-13","objectID":"/posts/common-commands-for-various-operating-systems/:2:1","series":null,"tags":["Linux","MacOSX","Windows","CLI","Powershell","Shell","tmux","rsync","vim","awk"],"title":"Linux/Windows/MacOSX ç³»ç»Ÿå¸¸ç”¨å‘½ä»¤é›†é”¦","uri":"/posts/common-commands-for-various-operating-systems/#1-å®ç”¨å‘½ä»¤"},{"categories":["tech"],"content":" 2. è¿›ç¨‹ç›¸å…³å‘½ä»¤ powershell # æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹ get-process | more ps | more # åˆ«å # æŸ¥æ‰¾æŸè¿›ç¨‹ï¼ˆæ›¿ä»£æ‰ tasklistï¼‰ get-process -name exp*,power* # ä½¿ç”¨æ­£åˆ™æŸ¥æ‰¾è¿›ç¨‹ get-process | select-string \u003cpattern\u003e # æ•ˆæœåŒä¸Š # é€šè¿‡ id æ€æ‰æŸè¿›ç¨‹ï¼ˆæ›¿ä»£æ‰ taskkillï¼‰ # ä¹Ÿå¯ä»¥é€šè¿‡ -Name ç”¨æ­£åˆ™åŒ¹é…è¿›ç¨‹ stop-process \u003cpid\u003e kill \u003cpid\u003e # åˆ«å ","date":"2022-02-13","objectID":"/posts/common-commands-for-various-operating-systems/:2:2","series":null,"tags":["Linux","MacOSX","Windows","CLI","Powershell","Shell","tmux","rsync","vim","awk"],"title":"Linux/Windows/MacOSX ç³»ç»Ÿå¸¸ç”¨å‘½ä»¤é›†é”¦","uri":"/posts/common-commands-for-various-operating-systems/#2-è¿›ç¨‹ç›¸å…³å‘½ä»¤"},{"categories":["tech"],"content":" 3. ç½‘ç»œç›¸å…³å‘½ä»¤ powershell ## 1. dns ç›¸å…³(dns-client) Clear-DnsClientCache # æ¸…é™¤ dns ç¼“å­˜ï¼ˆæ›¿æ¢æ‰ `ipconfig /flushdns`ï¼‰ Get-DnsClientCache # æŸ¥çœ‹ dns ç¼“å­˜ Resolve-DnsName baidu.com # è§£æåŸŸå # æ›´æ–° DHCP ç§Ÿçº¦ ipconfig /renew ## 2. TCP/IP ç›¸å…³å‘½ä»¤ Get-Command Get-Net* # æŸ¥çœ‹æ‰€æœ‰ TCP/IP ç›¸å…³çš„å‘½ä»¤ Get-NetIPAddress # æŸ¥çœ‹ IP åœ°å€ Get-NetIPInterface # æŸ¥çœ‹ IP æ¥å£ Get-NetRoute # æŸ¥çœ‹è·¯ç”±è¡¨ Get-NetNeighbor # è·å–é“¾è·¯å±‚ MAC åœ°å€ç¼“å­˜ Get-NetTCPConnection # æŸ¥çœ‹ TCP è¿æ¥ ### ä¹Ÿå¯ä»¥å¯¹ TCP/IP çš„ IP åœ°å€ã€æ¥å£ã€è·¯ç”±è¡¨è¿›è¡Œå¢åˆ æ”¹ New-NetRoute Remove-NetNeighbor # æ¸…é™¤ MAC åœ°å€ç¼“å­˜ ","date":"2022-02-13","objectID":"/posts/common-commands-for-various-operating-systems/:2:3","series":null,"tags":["Linux","MacOSX","Windows","CLI","Powershell","Shell","tmux","rsync","vim","awk"],"title":"Linux/Windows/MacOSX ç³»ç»Ÿå¸¸ç”¨å‘½ä»¤é›†é”¦","uri":"/posts/common-commands-for-various-operating-systems/#3-ç½‘ç»œç›¸å…³å‘½ä»¤"},{"categories":["tech"],"content":" 4. socket ä¿¡æ¯æŸ¥è¯¢ - netstatWindows ç³»ç»Ÿå’Œ macOS ä¸€æ ·ï¼Œä¹Ÿæ²¡æœ‰ ssï¼Œä½†æ˜¯è‡ªå¸¦ netstatï¼Œè¯¥å‘½ä»¤å’Œ Linux ä¸‹çš„ netstat æœ‰ä¸€å®šå·®åˆ«ï¼Œå…·ä½“ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š powershell netstat -? # æŸ¥çœ‹ä½¿ç”¨å¸®åŠ©ï¼Œå¾ˆæ¸…æ™°æ˜“æ‡‚ # æŸ¥çœ‹é‚£ä¸ªè¿›ç¨‹åœ¨ç›‘å¬ 80 ç«¯å£ï¼Œæœ€åä¸€åˆ—æ˜¯è¿›ç¨‹çš„ Pid netstat -ano | findstr 80 # windows å‘½ä»¤ netstat -ano | select-string 80 # powershell å‘½ä»¤ï¼Œå°±æ˜¯æŠŠ findstr æ›¿æ¢æˆ select-string # ä¸ä»…åˆ—å‡º Pidï¼Œè¿˜ç»™å‡º Pid å¯¹åº”çš„å¯æ‰§è¡Œæ–‡ä»¶åç§°ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰ netstat -ano -b | select-string 80 # powershell å‘½ä»¤ # åˆ—å‡ºæ‰€æœ‰ ESTABLISHED çš„ socketï¼ˆé»˜è®¤è¡Œä¸ºï¼‰ netstat # åˆ—å‡ºæ‰€æœ‰æ­£åœ¨ç›‘å¬çš„ç«¯å£ netstat -ano | findstr LISTENING # åªåˆ—å‡º TCP è¿æ¥ netstat -ano -p TCP # æŸ¥çœ‹è·¯ç”±è¡¨ route -? # æŸ¥çœ‹ä½¿ç”¨å¸®åŠ©ï¼Œå¾ˆæ¸…æ™°æ˜“æ‡‚ route print # æŸ¥çœ‹æ‰€æœ‰è·¯ç”±ä¿¡æ¯ route print -4 # ä»… ipv4 æ¯”å¦‚æˆ‘ä»¬é‡åˆ°ç«¯å£å ç”¨é—®é¢˜æ—¶ï¼Œå°±å¯ä»¥é€šè¿‡ä¸Šè¿°å‘½ä»¤æŸ¥æ‰¾åˆ°ç«¯å£å¯¹åº”çš„ Pidï¼Œç„¶åä½¿ç”¨ kill \u003cPid\u003e å‘½ä»¤ï¼ˆpowershell stop-process çš„åˆ«åï¼‰æ€æ­»å¯¹åº”çš„è¿›ç¨‹ã€‚ ","date":"2022-02-13","objectID":"/posts/common-commands-for-various-operating-systems/:2:4","series":null,"tags":["Linux","MacOSX","Windows","CLI","Powershell","Shell","tmux","rsync","vim","awk"],"title":"Linux/Windows/MacOSX ç³»ç»Ÿå¸¸ç”¨å‘½ä»¤é›†é”¦","uri":"/posts/common-commands-for-various-operating-systems/#4-socket-ä¿¡æ¯æŸ¥è¯¢---netstat"},{"categories":["tech"],"content":" ä¸‰ã€Mac OS XMac OS X ç³»ç»Ÿä¹Ÿæ˜¯ unix-like ç³»ç»Ÿï¼Œä¹Ÿä½¿ç”¨ zsh/bashï¼Œå› æ­¤å¤§éƒ¨åˆ†å‘½ä»¤åŸºæœ¬éƒ½è·Ÿ Linux æ²¡å•¥åŒºåˆ«ï¼Œ å¯ä»¥ç›´æ¥å‚è€ƒå‰é¢ Linux ä¸€èŠ‚çš„å†…å®¹ã€‚ ä½†æ˜¯è¦æ³¨æ„ä¸€äº›å‘ï¼š macos è‡ªå¸¦çš„ tar å¹¶ä¸æ˜¯ gnutarï¼Œå‘½ä»¤ä½¿ç”¨æ–¹å¼ä¸ä¸€æ ·ï¼ è§£å†³ï¼šbrew install gnu-tarï¼Œå®‰è£…å¥½åé€šè¿‡ gtar è°ƒç”¨ï¼Œå‚æ•°å°±è·Ÿ linux ä¸€è‡´äº†ã€‚ ç½‘ç»œç›¸å…³çš„å‘½ä»¤åŒºåˆ«è¾ƒå¤§ï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»ã€‚ MacOSX ä½¿ç”¨ launchpad ä½œä¸ºç³»ç»ŸæœåŠ¡ç®¡ç†å™¨ï¼Œè·Ÿ systemd åŒºåˆ«å¾ˆå¤§ã€‚ ","date":"2022-02-13","objectID":"/posts/common-commands-for-various-operating-systems/:3:0","series":null,"tags":["Linux","MacOSX","Windows","CLI","Powershell","Shell","tmux","rsync","vim","awk"],"title":"Linux/Windows/MacOSX ç³»ç»Ÿå¸¸ç”¨å‘½ä»¤é›†é”¦","uri":"/posts/common-commands-for-various-operating-systems/#ä¸‰mac-os-x"},{"categories":["tech"],"content":" 1. æŸ¥çœ‹ socket ä¿¡æ¯Mac OS X ç³»ç»Ÿç›®å‰æ²¡æœ‰ ssï¼Œä½†æ˜¯è‡ªå¸¦ netstatï¼Œè¯¥å‘½ä»¤å’Œ Linux ä¸‹çš„ netstat æœ‰ä¸€å®šå·®åˆ«ï¼Œ è€Œä¸”è¿˜å¾ˆæ…¢ï¼Œè¿˜ä¸èƒ½æ˜¾ç¤º pid. æ‰€ä»¥ stackoverflow ä¸Šæ›´æ¨èä½¿ç”¨ lsofï¼Œå‡ æ¡å¸¸ç”¨å‘½ä»¤è®°å½•å¦‚ä¸‹ shell # -n è¡¨ç¤ºä¸æ˜¾ç¤ºä¸»æœºå # -P è¡¨ç¤ºä¸æ˜¾ç¤ºç«¯å£ä¿—ç§° # ä¸åŠ  sudo åªèƒ½æŸ¥çœ‹ä»¥å½“å‰ç”¨æˆ·è¿è¡Œçš„ç¨‹åº # é€šç”¨æ ¼å¼ï¼š sudo lsof -nP -iTCP:ç«¯å£å· -sTCP:LISTEN # æŸ¥çœ‹æ‰€æœ‰ tcp è¿æ¥ lsof -nP -iTCP # æŸ¥çœ‹æ‰€æœ‰ç›‘å¬ç«¯å£ç›¸å…³çš„ä¿¡æ¯ï¼ˆcommand/pidï¼‰ lsof -nP -iTCP -sTCP:LISTEN ","date":"2022-02-13","objectID":"/posts/common-commands-for-various-operating-systems/:3:1","series":null,"tags":["Linux","MacOSX","Windows","CLI","Powershell","Shell","tmux","rsync","vim","awk"],"title":"Linux/Windows/MacOSX ç³»ç»Ÿå¸¸ç”¨å‘½ä»¤é›†é”¦","uri":"/posts/common-commands-for-various-operating-systems/#1-æŸ¥çœ‹-socket-ä¿¡æ¯"},{"categories":["tech"],"content":" 2. å…¶ä»–ç½‘ç»œç›¸å…³å‘½ä»¤æ¸…ç† DNS ç¼“å­˜ï¼š shell # macos 10.10+ sudo dscacheutil -flushcache sudo killall -HUP mDNSResponder # å…¶ä»–ç‰ˆæœ¬è¯·è‡ªå·±ç½‘ä¸Šæœ... shell # æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œæ¥å£åŠç›¸å…³å‚æ•°ï¼ˆip/mac/type...ï¼‰ ifconfig # æŸ¥çœ‹è·¯ç”±è¡¨ netstat -nr ","date":"2022-02-13","objectID":"/posts/common-commands-for-various-operating-systems/:3:2","series":null,"tags":["Linux","MacOSX","Windows","CLI","Powershell","Shell","tmux","rsync","vim","awk"],"title":"Linux/Windows/MacOSX ç³»ç»Ÿå¸¸ç”¨å‘½ä»¤é›†é”¦","uri":"/posts/common-commands-for-various-operating-systems/#2-å…¶ä»–ç½‘ç»œç›¸å…³å‘½ä»¤"},{"categories":["tech"],"content":" å››ã€è·¨å¹³å°ç¨‹åº","date":"2022-02-13","objectID":"/posts/common-commands-for-various-operating-systems/:4:0","series":null,"tags":["Linux","MacOSX","Windows","CLI","Powershell","Shell","tmux","rsync","vim","awk"],"title":"Linux/Windows/MacOSX ç³»ç»Ÿå¸¸ç”¨å‘½ä»¤é›†é”¦","uri":"/posts/common-commands-for-various-operating-systems/#å››è·¨å¹³å°ç¨‹åº"},{"categories":["tech"],"content":" 1. vim å¸¸ç”¨æŠ€å·§ç§»åŠ¨ï¼š 0/^ å›åˆ°è¡Œé¦–ï¼Œ$ å»åˆ°è¡Œæœ« w è·³åˆ°ä¸‹ä¸ªå•è¯çš„é¦–éƒ¨ï¼Œe è·³åˆ°ä¸‹ä¸ªå•è¯æœ«å°¾ ä¹Ÿèƒ½ä½¿ç”¨ 2w 2e è¿™ç§å‘½ä»¤æŒ‰å•è¯æ•°é‡è·³è½¬ åˆ é™¤ d æˆ–ä¿®æ”¹ c: dw åˆ é™¤å•è¯ï¼Œd2w åˆ é™¤ä¸¤ä¸ªå•è¯ d$ åˆ é™¤åˆ°è¡Œæœ«ï¼Œd0/d^ åˆ é™¤åˆ°è¡Œé¦– d(/d{/d[[ åˆ é™¤åˆ°æ–‡ä»¶é¦–éƒ¨ï¼Œd)/d}/d]] åˆ é™¤åˆ°æ–‡ä»¶æœ«å°¾ r æ›¿æ¢ä¸€ä¸ªå­—ç¬¦ï¼ŒR æŒç»­å¾€åæ›¿æ¢ å¤šè¡Œä¿®æ”¹å¤šè¡Œæ’å…¥ï¼Œä¸»è¦ç”¨äºåŠ æ³¨é‡Šä¹‹ç±»çš„ï¼š å…‰æ ‡åœç•™åœ¨ä½ éœ€è¦æ’å…¥æ–‡æœ¬çš„åœ°æ–¹ ctrl+v è¿›å…¥ visual block æ¨¡å¼ï¼Œé€‰ä¸­å¤šè¡Œ è¾“å…¥ Iï¼Œè¿›å…¥ç¼–è¾‘æ¨¡å¼ è¾“å…¥ # æ³¨é‡Šæˆ–è€…å…¶ä»–å­—ç¬¦ï¼Œä½†æ˜¯æ³¨æ„ä¸èƒ½è¾“å…¥æ¢è¡Œç¬¦ï¼ä¹Ÿä¸èƒ½åˆ é™¤ï¼Ÿ æŒ‰ä¸¤ä¸‹ Escï¼Œä¾æ¬¡é€€å‡º Insert å’Œ visual block æ¨¡å¼ï¼Œå°±æ’å…¥æˆåŠŸäº† å¤šè¡Œåˆ é™¤ï¼š v è¿›å…¥ visual æ¨¡å¼ï¼Œåœ¨ç¬¬ä¸€è¡Œï¼Œé€‰ä¸­ä½ æƒ³è¦åˆ é™¤çš„æ–‡æœ¬å— æˆ–è€…ä¹Ÿå¯ä»¥å…ˆè¿›å…¥ visual block æ¨¡å¼ï¼Œå†é€šè¿‡å·¦å³æ–¹å‘é”®é€‰æ‹©æ–‡æœ¬ã€‚ ctrl+v è¿›å…¥ visual block æ¨¡å¼ï¼Œé€‰ä¸­å¤šè¡Œ visual block çš„ç‰¹ç‚¹æ˜¯å®ƒæ˜¯å‚ç›´é€‰æ‹©ï¼Œè€Œ visual æ¨¡å¼æ˜¯æ®µè½é€‰æ‹© æŒ‰ d é”®å°±èƒ½åˆ é™¤è¢«é€‰ä¸­çš„æ‰€æœ‰å†…å®¹ã€‚ å¤šè¡Œæ›¿æ¢ï¼ˆåŸºæœ¬å’Œ sed ä¸€è‡´ï¼‰å¤šè¡Œè¡Œé¦–æ’å…¥æ³¨é‡Šç¬¦å· # :1,6 s/^/#/g :2,$ s/^/#/g æ³¨ï¼šæ­¤ä¸º2è¡Œè‡³å°¾è¡Œ :% s/^/#/g æ³¨ï¼šæ­¤ä¸ºæ‰€æœ‰è¡Œ è¿™é‡Œä½¿ç”¨äº†æ­£åˆ™è¡¨è¾¾å¼ ^ åŒ¹é…è¡Œé¦–ï¼Œæ”¹æˆ $ å°±å¯åœ¨è¡Œå°¾è¿›è¡Œæ‰¹é‡ä¿®æ”¹ã€‚ æ­¤å¤–ï¼Œå®ƒçš„åˆ†éš”ç¬¦ä¹Ÿä¸ä»…é™äº \\ï¼Œä¹Ÿå¯ä»¥ç”¨ @ ç­‰ç¬¦å·ï¼Œæ–¹ä¾¿é˜…è¯»ã€‚æ¯”å¦‚ï¼š :1,6 s@^@#@g :2,$ s@^@#@g æ³¨ï¼šæ­¤ä¸º2è¡Œè‡³å°¾è¡Œ :% s@^@#@g æ³¨ï¼šæ­¤ä¸ºæ‰€æœ‰è¡Œ ä½¿ç”¨ vim çš„è¿™ä¸ªæ­£åˆ™åŒ¹é…åŠŸèƒ½ï¼Œä¸ä»…èƒ½è¿›è¡Œæ’å…¥ï¼Œä¹Ÿèƒ½å®Œæˆåˆ é™¤ã€æ›¿æ¢çš„åŠŸèƒ½ã€‚ å°†é€‰ä¸­éƒ¨åˆ†å†™å…¥åˆ°æ–‡ä»¶ é¦–å…ˆæŒ‰ v è¿›å…¥ visual æ¨¡å¼ï¼Œé€‰ä¸­éœ€è¦çš„å†…å®¹ æŒ‰ :ï¼Œåº”è¯¥ä¼šæ˜¾ç¤º :'\u003c,'\u003eï¼Œè¡¨ç¤ºå¯¹é€‰ä¸­éƒ¨åˆ†è¿›è¡Œæ“ä½œ è¾“å…¥å†…å®¹ w new.txtï¼Œæ­¤æ—¶æ˜¾ç¤ºæ•ˆæœåº”è¯¥æ˜¯ :'\u003c,'\u003ew new.txt å›è½¦å°±èƒ½å®Œæˆæ–‡ä»¶å†™å…¥ é—®é¢˜ï¼šåœ¨ vim ä¸­ç²˜è´´ yaml æ—¶ç¼©è¿›ä¼šå˜å¾—ä¸€å›¢ç³Ÿè§£å†³æ–¹æ³•ï¼šåœ¨å‘½ä»¤æ¨¡å¼ä¸‹è¾“å…¥ :set paste è¿›å…¥ç²˜è´´æ¨¡å¼ï¼Œç„¶åå†ç²˜è´´ yaml å†…å®¹ã€‚ æ³¨æ„è¡Œé¦–å¯èƒ½ä¼šä¸¢å¤±å‡ ä¸ªå­—ç¬¦ï¼Œéœ€è¦æ‰‹åŠ¨è¡¥ä¸Šã€‚ ","date":"2022-02-13","objectID":"/posts/common-commands-for-various-operating-systems/:4:1","series":null,"tags":["Linux","MacOSX","Windows","CLI","Powershell","Shell","tmux","rsync","vim","awk"],"title":"Linux/Windows/MacOSX ç³»ç»Ÿå¸¸ç”¨å‘½ä»¤é›†é”¦","uri":"/posts/common-commands-for-various-operating-systems/#1-vim"},{"categories":["tech"],"content":" 1. vim å¸¸ç”¨æŠ€å·§ç§»åŠ¨ï¼š 0/^ å›åˆ°è¡Œé¦–ï¼Œ$ å»åˆ°è¡Œæœ« w è·³åˆ°ä¸‹ä¸ªå•è¯çš„é¦–éƒ¨ï¼Œe è·³åˆ°ä¸‹ä¸ªå•è¯æœ«å°¾ ä¹Ÿèƒ½ä½¿ç”¨ 2w 2e è¿™ç§å‘½ä»¤æŒ‰å•è¯æ•°é‡è·³è½¬ åˆ é™¤ d æˆ–ä¿®æ”¹ c: dw åˆ é™¤å•è¯ï¼Œd2w åˆ é™¤ä¸¤ä¸ªå•è¯ d$ åˆ é™¤åˆ°è¡Œæœ«ï¼Œd0/d^ åˆ é™¤åˆ°è¡Œé¦– d(/d{/d[[ åˆ é™¤åˆ°æ–‡ä»¶é¦–éƒ¨ï¼Œd)/d}/d]] åˆ é™¤åˆ°æ–‡ä»¶æœ«å°¾ r æ›¿æ¢ä¸€ä¸ªå­—ç¬¦ï¼ŒR æŒç»­å¾€åæ›¿æ¢ å¤šè¡Œä¿®æ”¹å¤šè¡Œæ’å…¥ï¼Œä¸»è¦ç”¨äºåŠ æ³¨é‡Šä¹‹ç±»çš„ï¼š å…‰æ ‡åœç•™åœ¨ä½ éœ€è¦æ’å…¥æ–‡æœ¬çš„åœ°æ–¹ ctrl+v è¿›å…¥ visual block æ¨¡å¼ï¼Œé€‰ä¸­å¤šè¡Œ è¾“å…¥ Iï¼Œè¿›å…¥ç¼–è¾‘æ¨¡å¼ è¾“å…¥ # æ³¨é‡Šæˆ–è€…å…¶ä»–å­—ç¬¦ï¼Œä½†æ˜¯æ³¨æ„ä¸èƒ½è¾“å…¥æ¢è¡Œç¬¦ï¼ä¹Ÿä¸èƒ½åˆ é™¤ï¼Ÿ æŒ‰ä¸¤ä¸‹ Escï¼Œä¾æ¬¡é€€å‡º Insert å’Œ visual block æ¨¡å¼ï¼Œå°±æ’å…¥æˆåŠŸäº† å¤šè¡Œåˆ é™¤ï¼š v è¿›å…¥ visual æ¨¡å¼ï¼Œåœ¨ç¬¬ä¸€è¡Œï¼Œé€‰ä¸­ä½ æƒ³è¦åˆ é™¤çš„æ–‡æœ¬å— æˆ–è€…ä¹Ÿå¯ä»¥å…ˆè¿›å…¥ visual block æ¨¡å¼ï¼Œå†é€šè¿‡å·¦å³æ–¹å‘é”®é€‰æ‹©æ–‡æœ¬ã€‚ ctrl+v è¿›å…¥ visual block æ¨¡å¼ï¼Œé€‰ä¸­å¤šè¡Œ visual block çš„ç‰¹ç‚¹æ˜¯å®ƒæ˜¯å‚ç›´é€‰æ‹©ï¼Œè€Œ visual æ¨¡å¼æ˜¯æ®µè½é€‰æ‹© æŒ‰ d é”®å°±èƒ½åˆ é™¤è¢«é€‰ä¸­çš„æ‰€æœ‰å†…å®¹ã€‚ å¤šè¡Œæ›¿æ¢ï¼ˆåŸºæœ¬å’Œ sed ä¸€è‡´ï¼‰å¤šè¡Œè¡Œé¦–æ’å…¥æ³¨é‡Šç¬¦å· # :1,6 s/^/#/g :2,$ s/^/#/g æ³¨ï¼šæ­¤ä¸º2è¡Œè‡³å°¾è¡Œ :% s/^/#/g æ³¨ï¼šæ­¤ä¸ºæ‰€æœ‰è¡Œ è¿™é‡Œä½¿ç”¨äº†æ­£åˆ™è¡¨è¾¾å¼ ^ åŒ¹é…è¡Œé¦–ï¼Œæ”¹æˆ $ å°±å¯åœ¨è¡Œå°¾è¿›è¡Œæ‰¹é‡ä¿®æ”¹ã€‚ æ­¤å¤–ï¼Œå®ƒçš„åˆ†éš”ç¬¦ä¹Ÿä¸ä»…é™äº \\ï¼Œä¹Ÿå¯ä»¥ç”¨ @ ç­‰ç¬¦å·ï¼Œæ–¹ä¾¿é˜…è¯»ã€‚æ¯”å¦‚ï¼š :1,6 s@^@#@g :2,$ s@^@#@g æ³¨ï¼šæ­¤ä¸º2è¡Œè‡³å°¾è¡Œ :% s@^@#@g æ³¨ï¼šæ­¤ä¸ºæ‰€æœ‰è¡Œ ä½¿ç”¨ vim çš„è¿™ä¸ªæ­£åˆ™åŒ¹é…åŠŸèƒ½ï¼Œä¸ä»…èƒ½è¿›è¡Œæ’å…¥ï¼Œä¹Ÿèƒ½å®Œæˆåˆ é™¤ã€æ›¿æ¢çš„åŠŸèƒ½ã€‚ å°†é€‰ä¸­éƒ¨åˆ†å†™å…¥åˆ°æ–‡ä»¶ é¦–å…ˆæŒ‰ v è¿›å…¥ visual æ¨¡å¼ï¼Œé€‰ä¸­éœ€è¦çš„å†…å®¹ æŒ‰ :ï¼Œåº”è¯¥ä¼šæ˜¾ç¤º :'\u003c,'\u003eï¼Œè¡¨ç¤ºå¯¹é€‰ä¸­éƒ¨åˆ†è¿›è¡Œæ“ä½œ è¾“å…¥å†…å®¹ w new.txtï¼Œæ­¤æ—¶æ˜¾ç¤ºæ•ˆæœåº”è¯¥æ˜¯ :'\u003c,'\u003ew new.txt å›è½¦å°±èƒ½å®Œæˆæ–‡ä»¶å†™å…¥ é—®é¢˜ï¼šåœ¨ vim ä¸­ç²˜è´´ yaml æ—¶ç¼©è¿›ä¼šå˜å¾—ä¸€å›¢ç³Ÿè§£å†³æ–¹æ³•ï¼šåœ¨å‘½ä»¤æ¨¡å¼ä¸‹è¾“å…¥ :set paste è¿›å…¥ç²˜è´´æ¨¡å¼ï¼Œç„¶åå†ç²˜è´´ yaml å†…å®¹ã€‚ æ³¨æ„è¡Œé¦–å¯èƒ½ä¼šä¸¢å¤±å‡ ä¸ªå­—ç¬¦ï¼Œéœ€è¦æ‰‹åŠ¨è¡¥ä¸Šã€‚ ","date":"2022-02-13","objectID":"/posts/common-commands-for-various-operating-systems/:4:1","series":null,"tags":["Linux","MacOSX","Windows","CLI","Powershell","Shell","tmux","rsync","vim","awk"],"title":"Linux/Windows/MacOSX ç³»ç»Ÿå¸¸ç”¨å‘½ä»¤é›†é”¦","uri":"/posts/common-commands-for-various-operating-systems/#å¸¸ç”¨æŠ€å·§"},{"categories":["tech"],"content":" 1. vim å¸¸ç”¨æŠ€å·§ç§»åŠ¨ï¼š 0/^ å›åˆ°è¡Œé¦–ï¼Œ$ å»åˆ°è¡Œæœ« w è·³åˆ°ä¸‹ä¸ªå•è¯çš„é¦–éƒ¨ï¼Œe è·³åˆ°ä¸‹ä¸ªå•è¯æœ«å°¾ ä¹Ÿèƒ½ä½¿ç”¨ 2w 2e è¿™ç§å‘½ä»¤æŒ‰å•è¯æ•°é‡è·³è½¬ åˆ é™¤ d æˆ–ä¿®æ”¹ c: dw åˆ é™¤å•è¯ï¼Œd2w åˆ é™¤ä¸¤ä¸ªå•è¯ d$ åˆ é™¤åˆ°è¡Œæœ«ï¼Œd0/d^ åˆ é™¤åˆ°è¡Œé¦– d(/d{/d[[ åˆ é™¤åˆ°æ–‡ä»¶é¦–éƒ¨ï¼Œd)/d}/d]] åˆ é™¤åˆ°æ–‡ä»¶æœ«å°¾ r æ›¿æ¢ä¸€ä¸ªå­—ç¬¦ï¼ŒR æŒç»­å¾€åæ›¿æ¢ å¤šè¡Œä¿®æ”¹å¤šè¡Œæ’å…¥ï¼Œä¸»è¦ç”¨äºåŠ æ³¨é‡Šä¹‹ç±»çš„ï¼š å…‰æ ‡åœç•™åœ¨ä½ éœ€è¦æ’å…¥æ–‡æœ¬çš„åœ°æ–¹ ctrl+v è¿›å…¥ visual block æ¨¡å¼ï¼Œé€‰ä¸­å¤šè¡Œ è¾“å…¥ Iï¼Œè¿›å…¥ç¼–è¾‘æ¨¡å¼ è¾“å…¥ # æ³¨é‡Šæˆ–è€…å…¶ä»–å­—ç¬¦ï¼Œä½†æ˜¯æ³¨æ„ä¸èƒ½è¾“å…¥æ¢è¡Œç¬¦ï¼ä¹Ÿä¸èƒ½åˆ é™¤ï¼Ÿ æŒ‰ä¸¤ä¸‹ Escï¼Œä¾æ¬¡é€€å‡º Insert å’Œ visual block æ¨¡å¼ï¼Œå°±æ’å…¥æˆåŠŸäº† å¤šè¡Œåˆ é™¤ï¼š v è¿›å…¥ visual æ¨¡å¼ï¼Œåœ¨ç¬¬ä¸€è¡Œï¼Œé€‰ä¸­ä½ æƒ³è¦åˆ é™¤çš„æ–‡æœ¬å— æˆ–è€…ä¹Ÿå¯ä»¥å…ˆè¿›å…¥ visual block æ¨¡å¼ï¼Œå†é€šè¿‡å·¦å³æ–¹å‘é”®é€‰æ‹©æ–‡æœ¬ã€‚ ctrl+v è¿›å…¥ visual block æ¨¡å¼ï¼Œé€‰ä¸­å¤šè¡Œ visual block çš„ç‰¹ç‚¹æ˜¯å®ƒæ˜¯å‚ç›´é€‰æ‹©ï¼Œè€Œ visual æ¨¡å¼æ˜¯æ®µè½é€‰æ‹© æŒ‰ d é”®å°±èƒ½åˆ é™¤è¢«é€‰ä¸­çš„æ‰€æœ‰å†…å®¹ã€‚ å¤šè¡Œæ›¿æ¢ï¼ˆåŸºæœ¬å’Œ sed ä¸€è‡´ï¼‰å¤šè¡Œè¡Œé¦–æ’å…¥æ³¨é‡Šç¬¦å· # :1,6 s/^/#/g :2,$ s/^/#/g æ³¨ï¼šæ­¤ä¸º2è¡Œè‡³å°¾è¡Œ :% s/^/#/g æ³¨ï¼šæ­¤ä¸ºæ‰€æœ‰è¡Œ è¿™é‡Œä½¿ç”¨äº†æ­£åˆ™è¡¨è¾¾å¼ ^ åŒ¹é…è¡Œé¦–ï¼Œæ”¹æˆ $ å°±å¯åœ¨è¡Œå°¾è¿›è¡Œæ‰¹é‡ä¿®æ”¹ã€‚ æ­¤å¤–ï¼Œå®ƒçš„åˆ†éš”ç¬¦ä¹Ÿä¸ä»…é™äº \\ï¼Œä¹Ÿå¯ä»¥ç”¨ @ ç­‰ç¬¦å·ï¼Œæ–¹ä¾¿é˜…è¯»ã€‚æ¯”å¦‚ï¼š :1,6 s@^@#@g :2,$ s@^@#@g æ³¨ï¼šæ­¤ä¸º2è¡Œè‡³å°¾è¡Œ :% s@^@#@g æ³¨ï¼šæ­¤ä¸ºæ‰€æœ‰è¡Œ ä½¿ç”¨ vim çš„è¿™ä¸ªæ­£åˆ™åŒ¹é…åŠŸèƒ½ï¼Œä¸ä»…èƒ½è¿›è¡Œæ’å…¥ï¼Œä¹Ÿèƒ½å®Œæˆåˆ é™¤ã€æ›¿æ¢çš„åŠŸèƒ½ã€‚ å°†é€‰ä¸­éƒ¨åˆ†å†™å…¥åˆ°æ–‡ä»¶ é¦–å…ˆæŒ‰ v è¿›å…¥ visual æ¨¡å¼ï¼Œé€‰ä¸­éœ€è¦çš„å†…å®¹ æŒ‰ :ï¼Œåº”è¯¥ä¼šæ˜¾ç¤º :'\u003c,'\u003eï¼Œè¡¨ç¤ºå¯¹é€‰ä¸­éƒ¨åˆ†è¿›è¡Œæ“ä½œ è¾“å…¥å†…å®¹ w new.txtï¼Œæ­¤æ—¶æ˜¾ç¤ºæ•ˆæœåº”è¯¥æ˜¯ :'\u003c,'\u003ew new.txt å›è½¦å°±èƒ½å®Œæˆæ–‡ä»¶å†™å…¥ é—®é¢˜ï¼šåœ¨ vim ä¸­ç²˜è´´ yaml æ—¶ç¼©è¿›ä¼šå˜å¾—ä¸€å›¢ç³Ÿè§£å†³æ–¹æ³•ï¼šåœ¨å‘½ä»¤æ¨¡å¼ä¸‹è¾“å…¥ :set paste è¿›å…¥ç²˜è´´æ¨¡å¼ï¼Œç„¶åå†ç²˜è´´ yaml å†…å®¹ã€‚ æ³¨æ„è¡Œé¦–å¯èƒ½ä¼šä¸¢å¤±å‡ ä¸ªå­—ç¬¦ï¼Œéœ€è¦æ‰‹åŠ¨è¡¥ä¸Šã€‚ ","date":"2022-02-13","objectID":"/posts/common-commands-for-various-operating-systems/:4:1","series":null,"tags":["Linux","MacOSX","Windows","CLI","Powershell","Shell","tmux","rsync","vim","awk"],"title":"Linux/Windows/MacOSX ç³»ç»Ÿå¸¸ç”¨å‘½ä»¤é›†é”¦","uri":"/posts/common-commands-for-various-operating-systems/#å¤šè¡Œä¿®æ”¹"},{"categories":["tech"],"content":" 1. vim å¸¸ç”¨æŠ€å·§ç§»åŠ¨ï¼š 0/^ å›åˆ°è¡Œé¦–ï¼Œ$ å»åˆ°è¡Œæœ« w è·³åˆ°ä¸‹ä¸ªå•è¯çš„é¦–éƒ¨ï¼Œe è·³åˆ°ä¸‹ä¸ªå•è¯æœ«å°¾ ä¹Ÿèƒ½ä½¿ç”¨ 2w 2e è¿™ç§å‘½ä»¤æŒ‰å•è¯æ•°é‡è·³è½¬ åˆ é™¤ d æˆ–ä¿®æ”¹ c: dw åˆ é™¤å•è¯ï¼Œd2w åˆ é™¤ä¸¤ä¸ªå•è¯ d$ åˆ é™¤åˆ°è¡Œæœ«ï¼Œd0/d^ åˆ é™¤åˆ°è¡Œé¦– d(/d{/d[[ åˆ é™¤åˆ°æ–‡ä»¶é¦–éƒ¨ï¼Œd)/d}/d]] åˆ é™¤åˆ°æ–‡ä»¶æœ«å°¾ r æ›¿æ¢ä¸€ä¸ªå­—ç¬¦ï¼ŒR æŒç»­å¾€åæ›¿æ¢ å¤šè¡Œä¿®æ”¹å¤šè¡Œæ’å…¥ï¼Œä¸»è¦ç”¨äºåŠ æ³¨é‡Šä¹‹ç±»çš„ï¼š å…‰æ ‡åœç•™åœ¨ä½ éœ€è¦æ’å…¥æ–‡æœ¬çš„åœ°æ–¹ ctrl+v è¿›å…¥ visual block æ¨¡å¼ï¼Œé€‰ä¸­å¤šè¡Œ è¾“å…¥ Iï¼Œè¿›å…¥ç¼–è¾‘æ¨¡å¼ è¾“å…¥ # æ³¨é‡Šæˆ–è€…å…¶ä»–å­—ç¬¦ï¼Œä½†æ˜¯æ³¨æ„ä¸èƒ½è¾“å…¥æ¢è¡Œç¬¦ï¼ä¹Ÿä¸èƒ½åˆ é™¤ï¼Ÿ æŒ‰ä¸¤ä¸‹ Escï¼Œä¾æ¬¡é€€å‡º Insert å’Œ visual block æ¨¡å¼ï¼Œå°±æ’å…¥æˆåŠŸäº† å¤šè¡Œåˆ é™¤ï¼š v è¿›å…¥ visual æ¨¡å¼ï¼Œåœ¨ç¬¬ä¸€è¡Œï¼Œé€‰ä¸­ä½ æƒ³è¦åˆ é™¤çš„æ–‡æœ¬å— æˆ–è€…ä¹Ÿå¯ä»¥å…ˆè¿›å…¥ visual block æ¨¡å¼ï¼Œå†é€šè¿‡å·¦å³æ–¹å‘é”®é€‰æ‹©æ–‡æœ¬ã€‚ ctrl+v è¿›å…¥ visual block æ¨¡å¼ï¼Œé€‰ä¸­å¤šè¡Œ visual block çš„ç‰¹ç‚¹æ˜¯å®ƒæ˜¯å‚ç›´é€‰æ‹©ï¼Œè€Œ visual æ¨¡å¼æ˜¯æ®µè½é€‰æ‹© æŒ‰ d é”®å°±èƒ½åˆ é™¤è¢«é€‰ä¸­çš„æ‰€æœ‰å†…å®¹ã€‚ å¤šè¡Œæ›¿æ¢ï¼ˆåŸºæœ¬å’Œ sed ä¸€è‡´ï¼‰å¤šè¡Œè¡Œé¦–æ’å…¥æ³¨é‡Šç¬¦å· # :1,6 s/^/#/g :2,$ s/^/#/g æ³¨ï¼šæ­¤ä¸º2è¡Œè‡³å°¾è¡Œ :% s/^/#/g æ³¨ï¼šæ­¤ä¸ºæ‰€æœ‰è¡Œ è¿™é‡Œä½¿ç”¨äº†æ­£åˆ™è¡¨è¾¾å¼ ^ åŒ¹é…è¡Œé¦–ï¼Œæ”¹æˆ $ å°±å¯åœ¨è¡Œå°¾è¿›è¡Œæ‰¹é‡ä¿®æ”¹ã€‚ æ­¤å¤–ï¼Œå®ƒçš„åˆ†éš”ç¬¦ä¹Ÿä¸ä»…é™äº \\ï¼Œä¹Ÿå¯ä»¥ç”¨ @ ç­‰ç¬¦å·ï¼Œæ–¹ä¾¿é˜…è¯»ã€‚æ¯”å¦‚ï¼š :1,6 s@^@#@g :2,$ s@^@#@g æ³¨ï¼šæ­¤ä¸º2è¡Œè‡³å°¾è¡Œ :% s@^@#@g æ³¨ï¼šæ­¤ä¸ºæ‰€æœ‰è¡Œ ä½¿ç”¨ vim çš„è¿™ä¸ªæ­£åˆ™åŒ¹é…åŠŸèƒ½ï¼Œä¸ä»…èƒ½è¿›è¡Œæ’å…¥ï¼Œä¹Ÿèƒ½å®Œæˆåˆ é™¤ã€æ›¿æ¢çš„åŠŸèƒ½ã€‚ å°†é€‰ä¸­éƒ¨åˆ†å†™å…¥åˆ°æ–‡ä»¶ é¦–å…ˆæŒ‰ v è¿›å…¥ visual æ¨¡å¼ï¼Œé€‰ä¸­éœ€è¦çš„å†…å®¹ æŒ‰ :ï¼Œåº”è¯¥ä¼šæ˜¾ç¤º :'\u003c,'\u003eï¼Œè¡¨ç¤ºå¯¹é€‰ä¸­éƒ¨åˆ†è¿›è¡Œæ“ä½œ è¾“å…¥å†…å®¹ w new.txtï¼Œæ­¤æ—¶æ˜¾ç¤ºæ•ˆæœåº”è¯¥æ˜¯ :'\u003c,'\u003ew new.txt å›è½¦å°±èƒ½å®Œæˆæ–‡ä»¶å†™å…¥ é—®é¢˜ï¼šåœ¨ vim ä¸­ç²˜è´´ yaml æ—¶ç¼©è¿›ä¼šå˜å¾—ä¸€å›¢ç³Ÿè§£å†³æ–¹æ³•ï¼šåœ¨å‘½ä»¤æ¨¡å¼ä¸‹è¾“å…¥ :set paste è¿›å…¥ç²˜è´´æ¨¡å¼ï¼Œç„¶åå†ç²˜è´´ yaml å†…å®¹ã€‚ æ³¨æ„è¡Œé¦–å¯èƒ½ä¼šä¸¢å¤±å‡ ä¸ªå­—ç¬¦ï¼Œéœ€è¦æ‰‹åŠ¨è¡¥ä¸Šã€‚ ","date":"2022-02-13","objectID":"/posts/common-commands-for-various-operating-systems/:4:1","series":null,"tags":["Linux","MacOSX","Windows","CLI","Powershell","Shell","tmux","rsync","vim","awk"],"title":"Linux/Windows/MacOSX ç³»ç»Ÿå¸¸ç”¨å‘½ä»¤é›†é”¦","uri":"/posts/common-commands-for-various-operating-systems/#å¤šè¡Œæ›¿æ¢åŸºæœ¬å’Œ-sed-ä¸€è‡´"},{"categories":["tech"],"content":" 1. vim å¸¸ç”¨æŠ€å·§ç§»åŠ¨ï¼š 0/^ å›åˆ°è¡Œé¦–ï¼Œ$ å»åˆ°è¡Œæœ« w è·³åˆ°ä¸‹ä¸ªå•è¯çš„é¦–éƒ¨ï¼Œe è·³åˆ°ä¸‹ä¸ªå•è¯æœ«å°¾ ä¹Ÿèƒ½ä½¿ç”¨ 2w 2e è¿™ç§å‘½ä»¤æŒ‰å•è¯æ•°é‡è·³è½¬ åˆ é™¤ d æˆ–ä¿®æ”¹ c: dw åˆ é™¤å•è¯ï¼Œd2w åˆ é™¤ä¸¤ä¸ªå•è¯ d$ åˆ é™¤åˆ°è¡Œæœ«ï¼Œd0/d^ åˆ é™¤åˆ°è¡Œé¦– d(/d{/d[[ åˆ é™¤åˆ°æ–‡ä»¶é¦–éƒ¨ï¼Œd)/d}/d]] åˆ é™¤åˆ°æ–‡ä»¶æœ«å°¾ r æ›¿æ¢ä¸€ä¸ªå­—ç¬¦ï¼ŒR æŒç»­å¾€åæ›¿æ¢ å¤šè¡Œä¿®æ”¹å¤šè¡Œæ’å…¥ï¼Œä¸»è¦ç”¨äºåŠ æ³¨é‡Šä¹‹ç±»çš„ï¼š å…‰æ ‡åœç•™åœ¨ä½ éœ€è¦æ’å…¥æ–‡æœ¬çš„åœ°æ–¹ ctrl+v è¿›å…¥ visual block æ¨¡å¼ï¼Œé€‰ä¸­å¤šè¡Œ è¾“å…¥ Iï¼Œè¿›å…¥ç¼–è¾‘æ¨¡å¼ è¾“å…¥ # æ³¨é‡Šæˆ–è€…å…¶ä»–å­—ç¬¦ï¼Œä½†æ˜¯æ³¨æ„ä¸èƒ½è¾“å…¥æ¢è¡Œç¬¦ï¼ä¹Ÿä¸èƒ½åˆ é™¤ï¼Ÿ æŒ‰ä¸¤ä¸‹ Escï¼Œä¾æ¬¡é€€å‡º Insert å’Œ visual block æ¨¡å¼ï¼Œå°±æ’å…¥æˆåŠŸäº† å¤šè¡Œåˆ é™¤ï¼š v è¿›å…¥ visual æ¨¡å¼ï¼Œåœ¨ç¬¬ä¸€è¡Œï¼Œé€‰ä¸­ä½ æƒ³è¦åˆ é™¤çš„æ–‡æœ¬å— æˆ–è€…ä¹Ÿå¯ä»¥å…ˆè¿›å…¥ visual block æ¨¡å¼ï¼Œå†é€šè¿‡å·¦å³æ–¹å‘é”®é€‰æ‹©æ–‡æœ¬ã€‚ ctrl+v è¿›å…¥ visual block æ¨¡å¼ï¼Œé€‰ä¸­å¤šè¡Œ visual block çš„ç‰¹ç‚¹æ˜¯å®ƒæ˜¯å‚ç›´é€‰æ‹©ï¼Œè€Œ visual æ¨¡å¼æ˜¯æ®µè½é€‰æ‹© æŒ‰ d é”®å°±èƒ½åˆ é™¤è¢«é€‰ä¸­çš„æ‰€æœ‰å†…å®¹ã€‚ å¤šè¡Œæ›¿æ¢ï¼ˆåŸºæœ¬å’Œ sed ä¸€è‡´ï¼‰å¤šè¡Œè¡Œé¦–æ’å…¥æ³¨é‡Šç¬¦å· # :1,6 s/^/#/g :2,$ s/^/#/g æ³¨ï¼šæ­¤ä¸º2è¡Œè‡³å°¾è¡Œ :% s/^/#/g æ³¨ï¼šæ­¤ä¸ºæ‰€æœ‰è¡Œ è¿™é‡Œä½¿ç”¨äº†æ­£åˆ™è¡¨è¾¾å¼ ^ åŒ¹é…è¡Œé¦–ï¼Œæ”¹æˆ $ å°±å¯åœ¨è¡Œå°¾è¿›è¡Œæ‰¹é‡ä¿®æ”¹ã€‚ æ­¤å¤–ï¼Œå®ƒçš„åˆ†éš”ç¬¦ä¹Ÿä¸ä»…é™äº \\ï¼Œä¹Ÿå¯ä»¥ç”¨ @ ç­‰ç¬¦å·ï¼Œæ–¹ä¾¿é˜…è¯»ã€‚æ¯”å¦‚ï¼š :1,6 s@^@#@g :2,$ s@^@#@g æ³¨ï¼šæ­¤ä¸º2è¡Œè‡³å°¾è¡Œ :% s@^@#@g æ³¨ï¼šæ­¤ä¸ºæ‰€æœ‰è¡Œ ä½¿ç”¨ vim çš„è¿™ä¸ªæ­£åˆ™åŒ¹é…åŠŸèƒ½ï¼Œä¸ä»…èƒ½è¿›è¡Œæ’å…¥ï¼Œä¹Ÿèƒ½å®Œæˆåˆ é™¤ã€æ›¿æ¢çš„åŠŸèƒ½ã€‚ å°†é€‰ä¸­éƒ¨åˆ†å†™å…¥åˆ°æ–‡ä»¶ é¦–å…ˆæŒ‰ v è¿›å…¥ visual æ¨¡å¼ï¼Œé€‰ä¸­éœ€è¦çš„å†…å®¹ æŒ‰ :ï¼Œåº”è¯¥ä¼šæ˜¾ç¤º :'\u003c,'\u003eï¼Œè¡¨ç¤ºå¯¹é€‰ä¸­éƒ¨åˆ†è¿›è¡Œæ“ä½œ è¾“å…¥å†…å®¹ w new.txtï¼Œæ­¤æ—¶æ˜¾ç¤ºæ•ˆæœåº”è¯¥æ˜¯ :'\u003c,'\u003ew new.txt å›è½¦å°±èƒ½å®Œæˆæ–‡ä»¶å†™å…¥ é—®é¢˜ï¼šåœ¨ vim ä¸­ç²˜è´´ yaml æ—¶ç¼©è¿›ä¼šå˜å¾—ä¸€å›¢ç³Ÿè§£å†³æ–¹æ³•ï¼šåœ¨å‘½ä»¤æ¨¡å¼ä¸‹è¾“å…¥ :set paste è¿›å…¥ç²˜è´´æ¨¡å¼ï¼Œç„¶åå†ç²˜è´´ yaml å†…å®¹ã€‚ æ³¨æ„è¡Œé¦–å¯èƒ½ä¼šä¸¢å¤±å‡ ä¸ªå­—ç¬¦ï¼Œéœ€è¦æ‰‹åŠ¨è¡¥ä¸Šã€‚ ","date":"2022-02-13","objectID":"/posts/common-commands-for-various-operating-systems/:4:1","series":null,"tags":["Linux","MacOSX","Windows","CLI","Powershell","Shell","tmux","rsync","vim","awk"],"title":"Linux/Windows/MacOSX ç³»ç»Ÿå¸¸ç”¨å‘½ä»¤é›†é”¦","uri":"/posts/common-commands-for-various-operating-systems/#å°†é€‰ä¸­éƒ¨åˆ†å†™å…¥åˆ°æ–‡ä»¶"},{"categories":["tech"],"content":" 1. vim å¸¸ç”¨æŠ€å·§ç§»åŠ¨ï¼š 0/^ å›åˆ°è¡Œé¦–ï¼Œ$ å»åˆ°è¡Œæœ« w è·³åˆ°ä¸‹ä¸ªå•è¯çš„é¦–éƒ¨ï¼Œe è·³åˆ°ä¸‹ä¸ªå•è¯æœ«å°¾ ä¹Ÿèƒ½ä½¿ç”¨ 2w 2e è¿™ç§å‘½ä»¤æŒ‰å•è¯æ•°é‡è·³è½¬ åˆ é™¤ d æˆ–ä¿®æ”¹ c: dw åˆ é™¤å•è¯ï¼Œd2w åˆ é™¤ä¸¤ä¸ªå•è¯ d$ åˆ é™¤åˆ°è¡Œæœ«ï¼Œd0/d^ åˆ é™¤åˆ°è¡Œé¦– d(/d{/d[[ åˆ é™¤åˆ°æ–‡ä»¶é¦–éƒ¨ï¼Œd)/d}/d]] åˆ é™¤åˆ°æ–‡ä»¶æœ«å°¾ r æ›¿æ¢ä¸€ä¸ªå­—ç¬¦ï¼ŒR æŒç»­å¾€åæ›¿æ¢ å¤šè¡Œä¿®æ”¹å¤šè¡Œæ’å…¥ï¼Œä¸»è¦ç”¨äºåŠ æ³¨é‡Šä¹‹ç±»çš„ï¼š å…‰æ ‡åœç•™åœ¨ä½ éœ€è¦æ’å…¥æ–‡æœ¬çš„åœ°æ–¹ ctrl+v è¿›å…¥ visual block æ¨¡å¼ï¼Œé€‰ä¸­å¤šè¡Œ è¾“å…¥ Iï¼Œè¿›å…¥ç¼–è¾‘æ¨¡å¼ è¾“å…¥ # æ³¨é‡Šæˆ–è€…å…¶ä»–å­—ç¬¦ï¼Œä½†æ˜¯æ³¨æ„ä¸èƒ½è¾“å…¥æ¢è¡Œç¬¦ï¼ä¹Ÿä¸èƒ½åˆ é™¤ï¼Ÿ æŒ‰ä¸¤ä¸‹ Escï¼Œä¾æ¬¡é€€å‡º Insert å’Œ visual block æ¨¡å¼ï¼Œå°±æ’å…¥æˆåŠŸäº† å¤šè¡Œåˆ é™¤ï¼š v è¿›å…¥ visual æ¨¡å¼ï¼Œåœ¨ç¬¬ä¸€è¡Œï¼Œé€‰ä¸­ä½ æƒ³è¦åˆ é™¤çš„æ–‡æœ¬å— æˆ–è€…ä¹Ÿå¯ä»¥å…ˆè¿›å…¥ visual block æ¨¡å¼ï¼Œå†é€šè¿‡å·¦å³æ–¹å‘é”®é€‰æ‹©æ–‡æœ¬ã€‚ ctrl+v è¿›å…¥ visual block æ¨¡å¼ï¼Œé€‰ä¸­å¤šè¡Œ visual block çš„ç‰¹ç‚¹æ˜¯å®ƒæ˜¯å‚ç›´é€‰æ‹©ï¼Œè€Œ visual æ¨¡å¼æ˜¯æ®µè½é€‰æ‹© æŒ‰ d é”®å°±èƒ½åˆ é™¤è¢«é€‰ä¸­çš„æ‰€æœ‰å†…å®¹ã€‚ å¤šè¡Œæ›¿æ¢ï¼ˆåŸºæœ¬å’Œ sed ä¸€è‡´ï¼‰å¤šè¡Œè¡Œé¦–æ’å…¥æ³¨é‡Šç¬¦å· # :1,6 s/^/#/g :2,$ s/^/#/g æ³¨ï¼šæ­¤ä¸º2è¡Œè‡³å°¾è¡Œ :% s/^/#/g æ³¨ï¼šæ­¤ä¸ºæ‰€æœ‰è¡Œ è¿™é‡Œä½¿ç”¨äº†æ­£åˆ™è¡¨è¾¾å¼ ^ åŒ¹é…è¡Œé¦–ï¼Œæ”¹æˆ $ å°±å¯åœ¨è¡Œå°¾è¿›è¡Œæ‰¹é‡ä¿®æ”¹ã€‚ æ­¤å¤–ï¼Œå®ƒçš„åˆ†éš”ç¬¦ä¹Ÿä¸ä»…é™äº \\ï¼Œä¹Ÿå¯ä»¥ç”¨ @ ç­‰ç¬¦å·ï¼Œæ–¹ä¾¿é˜…è¯»ã€‚æ¯”å¦‚ï¼š :1,6 s@^@#@g :2,$ s@^@#@g æ³¨ï¼šæ­¤ä¸º2è¡Œè‡³å°¾è¡Œ :% s@^@#@g æ³¨ï¼šæ­¤ä¸ºæ‰€æœ‰è¡Œ ä½¿ç”¨ vim çš„è¿™ä¸ªæ­£åˆ™åŒ¹é…åŠŸèƒ½ï¼Œä¸ä»…èƒ½è¿›è¡Œæ’å…¥ï¼Œä¹Ÿèƒ½å®Œæˆåˆ é™¤ã€æ›¿æ¢çš„åŠŸèƒ½ã€‚ å°†é€‰ä¸­éƒ¨åˆ†å†™å…¥åˆ°æ–‡ä»¶ é¦–å…ˆæŒ‰ v è¿›å…¥ visual æ¨¡å¼ï¼Œé€‰ä¸­éœ€è¦çš„å†…å®¹ æŒ‰ :ï¼Œåº”è¯¥ä¼šæ˜¾ç¤º :'\u003c,'\u003eï¼Œè¡¨ç¤ºå¯¹é€‰ä¸­éƒ¨åˆ†è¿›è¡Œæ“ä½œ è¾“å…¥å†…å®¹ w new.txtï¼Œæ­¤æ—¶æ˜¾ç¤ºæ•ˆæœåº”è¯¥æ˜¯ :'\u003c,'\u003ew new.txt å›è½¦å°±èƒ½å®Œæˆæ–‡ä»¶å†™å…¥ é—®é¢˜ï¼šåœ¨ vim ä¸­ç²˜è´´ yaml æ—¶ç¼©è¿›ä¼šå˜å¾—ä¸€å›¢ç³Ÿè§£å†³æ–¹æ³•ï¼šåœ¨å‘½ä»¤æ¨¡å¼ä¸‹è¾“å…¥ :set paste è¿›å…¥ç²˜è´´æ¨¡å¼ï¼Œç„¶åå†ç²˜è´´ yaml å†…å®¹ã€‚ æ³¨æ„è¡Œé¦–å¯èƒ½ä¼šä¸¢å¤±å‡ ä¸ªå­—ç¬¦ï¼Œéœ€è¦æ‰‹åŠ¨è¡¥ä¸Šã€‚ ","date":"2022-02-13","objectID":"/posts/common-commands-for-various-operating-systems/:4:1","series":null,"tags":["Linux","MacOSX","Windows","CLI","Powershell","Shell","tmux","rsync","vim","awk"],"title":"Linux/Windows/MacOSX ç³»ç»Ÿå¸¸ç”¨å‘½ä»¤é›†é”¦","uri":"/posts/common-commands-for-various-operating-systems/#é—®é¢˜åœ¨-vim-ä¸­ç²˜è´´-yaml-æ—¶ç¼©è¿›ä¼šå˜å¾—ä¸€å›¢ç³Ÿ"},{"categories":["tech"],"content":" å‚è€ƒ å¦‚ä½•åœ¨ Linux ä¸­æŸ¥çœ‹è¿›ç¨‹å ç”¨çš„ç«¯å£å· github - nsenter ä½¿ç”¨ lsof ä»£æ›¿ Mac OS X ä¸­çš„ netstat æŸ¥çœ‹å ç”¨ç«¯å£çš„ç¨‹åº aws å¸¸ç”¨å‘½ä»¤ ","date":"2022-02-13","objectID":"/posts/common-commands-for-various-operating-systems/:5:0","series":null,"tags":["Linux","MacOSX","Windows","CLI","Powershell","Shell","tmux","rsync","vim","awk"],"title":"Linux/Windows/MacOSX ç³»ç»Ÿå¸¸ç”¨å‘½ä»¤é›†é”¦","uri":"/posts/common-commands-for-various-operating-systems/#å‚è€ƒ"},{"categories":["tech"],"content":" ä¸ªäººç¬”è®°ï¼Œä¸ä¿è¯æ­£ç¡®ã€‚ å†…å®¹æ¯”è¾ƒå¤šï¼Œå»ºè®®å‚ç…§ç›®å½•æµè§ˆã€‚ ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:0:0","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#"},{"categories":["tech"],"content":" ä¸€ã€æ ‡å‡†åº“","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:1:0","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#ä¸€æ ‡å‡†åº“"},{"categories":["tech"],"content":" 1. æ–‡ä»¶è·¯å¾„ - pathlibæä¾›äº† OS æ— å…³çš„æ–‡ä»¶è·¯å¾„æŠ½è±¡ï¼Œå¯ä»¥å®Œå…¨æ›¿ä»£æ—§çš„ os.path å’Œ glob. å­¦ä¼šäº† pathlib.Pathï¼Œä½ å°±ä¼šäº† Python å¤„ç†æ–‡ä»¶è·¯å¾„çš„æ‰€æœ‰åŠŸèƒ½ã€‚ 1. è·¯å¾„è§£æä¸æ‹¼æ¥ python3 from pathlib import Path data_folder = Path(\"./source_data/text_files/\") data_file = data_folder / \"raw_data.txt\" # Path é‡è½½äº† / æ“ä½œç¬¦ï¼Œè·¯å¾„æ‹¼æ¥è¶…çº§æ–¹ä¾¿ # è·¯å¾„çš„è§£æ data_file.parent # è·å–çˆ¶è·¯å¾„ï¼Œè¿™é‡Œçš„ç»“æœå°±æ˜¯ data_folder data_folder.parent # ä¼šè¿”å› Path(\"source_data\") data_file.parents[1] # å³è·å–åˆ° data_file çš„ä¸Šä¸Šå±‚ç›®å½•ï¼Œç»“æœå’Œä¸Šé¢ä¸€æ ·æ˜¯ Path(\"source_data\") data_file.parents[2] # ä¸Šä¸Šä¸Šå±‚ç›®å½•ï¼ŒPath(\".\") dara_file.name # æ–‡ä»¶å \"raw_data.txt\" dara_file.suffix # æ–‡ä»¶çš„åç¼€ï¼ˆæœ€æœ«å°¾çš„ï¼‰\".txt\"ï¼Œè¿˜å¯ç”¨ suffixes è·å–æ‰€æœ‰åç¼€ data_file.stem # å»é™¤æ‰æœ€æœ«å°¾çš„åç¼€åï¼ˆåªå»é™¤ä¸€ä¸ªï¼‰ï¼Œå‰©ä¸‹çš„æ–‡ä»¶åï¼šraw_data # æ›¿æ¢æ–‡ä»¶åæˆ–è€…æ–‡ä»¶åç¼€ data_file.with_name(\"test.txt\") # å˜æˆ .../test.txt data_file.with_suffix(\".pdf\") # å˜æˆ .../raw_data.pdf # å½“å‰è·¯å¾„ä¸å¦ä¸€è·¯å¾„ çš„ç›¸å¯¹è·¯å¾„ data_file.relative_to(data_folder) # PosixPath('raw_data.txt') 2. pathlib å¸¸ç”¨å‡½æ•° python3 if not data_folder.exists(): data_folder.mkdir(parents=True) # ç›´æ¥åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œå¦‚æœçˆ¶æ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼Œä¹Ÿè‡ªåŠ¨åˆ›å»º if not filename.exists(): # æ–‡ä»¶æ˜¯å¦å­˜åœ¨ filename.touch() # ç›´æ¥åˆ›å»ºç©ºæ–‡ä»¶ï¼Œæˆ–è€…ç”¨ filename.open() ç›´æ¥è·å–æ–‡ä»¶å¥æŸ„ # è·¯å¾„ç±»å‹åˆ¤æ–­ if data_file.is_file(): # æ˜¯æ–‡ä»¶ print(data_file, \"is a file\") elif data_file.is_dir(): # æ˜¯æ–‡ä»¶å¤¹ for child in p.iterdir(): # é€šè¿‡ Path.iterdir() è¿­ä»£æ–‡ä»¶å¤¹ä¸­çš„å†…å®¹ print(child) # è·¯å¾„è§£æ # è·å–æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼ˆç¬¦å·é“¾æ¥ä¹Ÿä¼šè¢«è§£æåˆ°çœŸæ­£çš„æ–‡ä»¶ï¼‰ filename.resolve() # åœ¨ä¸åŒºåˆ†å¤§å°å†™çš„ç³»ç»Ÿä¸Šï¼ˆWindowsï¼‰ï¼Œè¿™ä¸ªå‡½æ•°ä¹Ÿä¼šå°†å¤§å°å†™è½¬æ¢æˆå®é™…çš„å½¢å¼ã€‚ # å¯ä»¥ç›´æ¥è·å– Home è·¯å¾„æˆ–è€…å½“å‰è·¯å¾„ Path.home() / \"file.txt\" # æœ‰æ—¶éœ€è¦ä»¥ home ä¸º base path æ¥æ„å»ºæ–‡ä»¶è·¯å¾„ Path.cwd() / \"file.txt\" # æˆ–è€…åŸºäºå½“å‰è·¯å¾„æ„å»º è¿˜æœ‰å¾ˆå¤šå…¶å®ƒçš„å®ç”¨å‡½æ•°ï¼Œå¯åœ¨ä½¿ç”¨ä¸­æ…¢æ…¢æ¢ç´¢ã€‚ 3. glob é€šé…ç¬¦pathlib ä¹Ÿæä¾›äº† glob æ”¯æŒï¼Œä¹Ÿå°±æ˜¯å¹¿æ³›ç”¨åœ¨è·¯å¾„åŒ¹é…ä¸Šçš„ä¸€ç§ç®€åŒ–æ­£åˆ™è¡¨è¾¾å¼ã€‚ python data_file.match(glob_pattern) # è¿”å› True æˆ– Falseï¼Œè¡¨ç¤ºæ–‡ä»¶è·¯å¾„ä¸ç»™å‡ºçš„ glob pattern æ˜¯å¦åŒ¹é… for py_file in data_folder.glob(\"*/*.py\"): # åŒ¹é…å½“å‰è·¯å¾„ä¸‹çš„å­æ–‡ä»¶å¤¹ä¸­çš„ py æ–‡ä»¶ï¼Œä¼šè¿”å›ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ print(py_file) # åå‘åŒ¹é…ï¼Œç›¸å½“äº glob æ¨¡å¼å¼€å¤´æ·»åŠ  \"**/\" for py_file in data_folder.glob(\"**/*.py\"): # åŒ¹é…å½“å‰è·¯å¾„ä¸‹çš„æ‰€æœ‰ py æ–‡ä»¶ï¼ˆæ‰€æœ‰å­æ–‡ä»¶å¤¹ä¹Ÿä¼šè¢«æœç´¢ï¼‰ï¼Œè¿”å›ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ print(py_file) glob ä¸­çš„ * è¡¨ç¤ºä»»æ„å­—ç¬¦ï¼Œè€Œ ** åˆ™è¡¨ç¤ºä»»æ„å±‚ç›®å½•ã€‚ï¼ˆåœ¨å¤§å‹æ–‡ä»¶æ ‘ä¸Šä½¿ç”¨ ** é€Ÿåº¦ä¼šå¾ˆæ…¢ï¼ï¼‰ ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:1:1","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#1-æ–‡ä»¶è·¯å¾„---pathlib"},{"categories":["tech"],"content":" 1. æ–‡ä»¶è·¯å¾„ - pathlibæä¾›äº† OS æ— å…³çš„æ–‡ä»¶è·¯å¾„æŠ½è±¡ï¼Œå¯ä»¥å®Œå…¨æ›¿ä»£æ—§çš„ os.path å’Œ glob. å­¦ä¼šäº† pathlib.Pathï¼Œä½ å°±ä¼šäº† Python å¤„ç†æ–‡ä»¶è·¯å¾„çš„æ‰€æœ‰åŠŸèƒ½ã€‚ 1. è·¯å¾„è§£æä¸æ‹¼æ¥ python3 from pathlib import Path data_folder = Path(\"./source_data/text_files/\") data_file = data_folder / \"raw_data.txt\" # Path é‡è½½äº† / æ“ä½œç¬¦ï¼Œè·¯å¾„æ‹¼æ¥è¶…çº§æ–¹ä¾¿ # è·¯å¾„çš„è§£æ data_file.parent # è·å–çˆ¶è·¯å¾„ï¼Œè¿™é‡Œçš„ç»“æœå°±æ˜¯ data_folder data_folder.parent # ä¼šè¿”å› Path(\"source_data\") data_file.parents[1] # å³è·å–åˆ° data_file çš„ä¸Šä¸Šå±‚ç›®å½•ï¼Œç»“æœå’Œä¸Šé¢ä¸€æ ·æ˜¯ Path(\"source_data\") data_file.parents[2] # ä¸Šä¸Šä¸Šå±‚ç›®å½•ï¼ŒPath(\".\") dara_file.name # æ–‡ä»¶å \"raw_data.txt\" dara_file.suffix # æ–‡ä»¶çš„åç¼€ï¼ˆæœ€æœ«å°¾çš„ï¼‰\".txt\"ï¼Œè¿˜å¯ç”¨ suffixes è·å–æ‰€æœ‰åç¼€ data_file.stem # å»é™¤æ‰æœ€æœ«å°¾çš„åç¼€åï¼ˆåªå»é™¤ä¸€ä¸ªï¼‰ï¼Œå‰©ä¸‹çš„æ–‡ä»¶åï¼šraw_data # æ›¿æ¢æ–‡ä»¶åæˆ–è€…æ–‡ä»¶åç¼€ data_file.with_name(\"test.txt\") # å˜æˆ .../test.txt data_file.with_suffix(\".pdf\") # å˜æˆ .../raw_data.pdf # å½“å‰è·¯å¾„ä¸å¦ä¸€è·¯å¾„ çš„ç›¸å¯¹è·¯å¾„ data_file.relative_to(data_folder) # PosixPath('raw_data.txt') 2. pathlib å¸¸ç”¨å‡½æ•° python3 if not data_folder.exists(): data_folder.mkdir(parents=True) # ç›´æ¥åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œå¦‚æœçˆ¶æ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼Œä¹Ÿè‡ªåŠ¨åˆ›å»º if not filename.exists(): # æ–‡ä»¶æ˜¯å¦å­˜åœ¨ filename.touch() # ç›´æ¥åˆ›å»ºç©ºæ–‡ä»¶ï¼Œæˆ–è€…ç”¨ filename.open() ç›´æ¥è·å–æ–‡ä»¶å¥æŸ„ # è·¯å¾„ç±»å‹åˆ¤æ–­ if data_file.is_file(): # æ˜¯æ–‡ä»¶ print(data_file, \"is a file\") elif data_file.is_dir(): # æ˜¯æ–‡ä»¶å¤¹ for child in p.iterdir(): # é€šè¿‡ Path.iterdir() è¿­ä»£æ–‡ä»¶å¤¹ä¸­çš„å†…å®¹ print(child) # è·¯å¾„è§£æ # è·å–æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼ˆç¬¦å·é“¾æ¥ä¹Ÿä¼šè¢«è§£æåˆ°çœŸæ­£çš„æ–‡ä»¶ï¼‰ filename.resolve() # åœ¨ä¸åŒºåˆ†å¤§å°å†™çš„ç³»ç»Ÿä¸Šï¼ˆWindowsï¼‰ï¼Œè¿™ä¸ªå‡½æ•°ä¹Ÿä¼šå°†å¤§å°å†™è½¬æ¢æˆå®é™…çš„å½¢å¼ã€‚ # å¯ä»¥ç›´æ¥è·å– Home è·¯å¾„æˆ–è€…å½“å‰è·¯å¾„ Path.home() / \"file.txt\" # æœ‰æ—¶éœ€è¦ä»¥ home ä¸º base path æ¥æ„å»ºæ–‡ä»¶è·¯å¾„ Path.cwd() / \"file.txt\" # æˆ–è€…åŸºäºå½“å‰è·¯å¾„æ„å»º è¿˜æœ‰å¾ˆå¤šå…¶å®ƒçš„å®ç”¨å‡½æ•°ï¼Œå¯åœ¨ä½¿ç”¨ä¸­æ…¢æ…¢æ¢ç´¢ã€‚ 3. glob é€šé…ç¬¦pathlib ä¹Ÿæä¾›äº† glob æ”¯æŒï¼Œä¹Ÿå°±æ˜¯å¹¿æ³›ç”¨åœ¨è·¯å¾„åŒ¹é…ä¸Šçš„ä¸€ç§ç®€åŒ–æ­£åˆ™è¡¨è¾¾å¼ã€‚ python data_file.match(glob_pattern) # è¿”å› True æˆ– Falseï¼Œè¡¨ç¤ºæ–‡ä»¶è·¯å¾„ä¸ç»™å‡ºçš„ glob pattern æ˜¯å¦åŒ¹é… for py_file in data_folder.glob(\"*/*.py\"): # åŒ¹é…å½“å‰è·¯å¾„ä¸‹çš„å­æ–‡ä»¶å¤¹ä¸­çš„ py æ–‡ä»¶ï¼Œä¼šè¿”å›ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ print(py_file) # åå‘åŒ¹é…ï¼Œç›¸å½“äº glob æ¨¡å¼å¼€å¤´æ·»åŠ  \"**/\" for py_file in data_folder.glob(\"**/*.py\"): # åŒ¹é…å½“å‰è·¯å¾„ä¸‹çš„æ‰€æœ‰ py æ–‡ä»¶ï¼ˆæ‰€æœ‰å­æ–‡ä»¶å¤¹ä¹Ÿä¼šè¢«æœç´¢ï¼‰ï¼Œè¿”å›ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ print(py_file) glob ä¸­çš„ * è¡¨ç¤ºä»»æ„å­—ç¬¦ï¼Œè€Œ ** åˆ™è¡¨ç¤ºä»»æ„å±‚ç›®å½•ã€‚ï¼ˆåœ¨å¤§å‹æ–‡ä»¶æ ‘ä¸Šä½¿ç”¨ ** é€Ÿåº¦ä¼šå¾ˆæ…¢ï¼ï¼‰ ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:1:1","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#1-è·¯å¾„è§£æä¸æ‹¼æ¥"},{"categories":["tech"],"content":" 1. æ–‡ä»¶è·¯å¾„ - pathlibæä¾›äº† OS æ— å…³çš„æ–‡ä»¶è·¯å¾„æŠ½è±¡ï¼Œå¯ä»¥å®Œå…¨æ›¿ä»£æ—§çš„ os.path å’Œ glob. å­¦ä¼šäº† pathlib.Pathï¼Œä½ å°±ä¼šäº† Python å¤„ç†æ–‡ä»¶è·¯å¾„çš„æ‰€æœ‰åŠŸèƒ½ã€‚ 1. è·¯å¾„è§£æä¸æ‹¼æ¥ python3 from pathlib import Path data_folder = Path(\"./source_data/text_files/\") data_file = data_folder / \"raw_data.txt\" # Path é‡è½½äº† / æ“ä½œç¬¦ï¼Œè·¯å¾„æ‹¼æ¥è¶…çº§æ–¹ä¾¿ # è·¯å¾„çš„è§£æ data_file.parent # è·å–çˆ¶è·¯å¾„ï¼Œè¿™é‡Œçš„ç»“æœå°±æ˜¯ data_folder data_folder.parent # ä¼šè¿”å› Path(\"source_data\") data_file.parents[1] # å³è·å–åˆ° data_file çš„ä¸Šä¸Šå±‚ç›®å½•ï¼Œç»“æœå’Œä¸Šé¢ä¸€æ ·æ˜¯ Path(\"source_data\") data_file.parents[2] # ä¸Šä¸Šä¸Šå±‚ç›®å½•ï¼ŒPath(\".\") dara_file.name # æ–‡ä»¶å \"raw_data.txt\" dara_file.suffix # æ–‡ä»¶çš„åç¼€ï¼ˆæœ€æœ«å°¾çš„ï¼‰\".txt\"ï¼Œè¿˜å¯ç”¨ suffixes è·å–æ‰€æœ‰åç¼€ data_file.stem # å»é™¤æ‰æœ€æœ«å°¾çš„åç¼€åï¼ˆåªå»é™¤ä¸€ä¸ªï¼‰ï¼Œå‰©ä¸‹çš„æ–‡ä»¶åï¼šraw_data # æ›¿æ¢æ–‡ä»¶åæˆ–è€…æ–‡ä»¶åç¼€ data_file.with_name(\"test.txt\") # å˜æˆ .../test.txt data_file.with_suffix(\".pdf\") # å˜æˆ .../raw_data.pdf # å½“å‰è·¯å¾„ä¸å¦ä¸€è·¯å¾„ çš„ç›¸å¯¹è·¯å¾„ data_file.relative_to(data_folder) # PosixPath('raw_data.txt') 2. pathlib å¸¸ç”¨å‡½æ•° python3 if not data_folder.exists(): data_folder.mkdir(parents=True) # ç›´æ¥åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œå¦‚æœçˆ¶æ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼Œä¹Ÿè‡ªåŠ¨åˆ›å»º if not filename.exists(): # æ–‡ä»¶æ˜¯å¦å­˜åœ¨ filename.touch() # ç›´æ¥åˆ›å»ºç©ºæ–‡ä»¶ï¼Œæˆ–è€…ç”¨ filename.open() ç›´æ¥è·å–æ–‡ä»¶å¥æŸ„ # è·¯å¾„ç±»å‹åˆ¤æ–­ if data_file.is_file(): # æ˜¯æ–‡ä»¶ print(data_file, \"is a file\") elif data_file.is_dir(): # æ˜¯æ–‡ä»¶å¤¹ for child in p.iterdir(): # é€šè¿‡ Path.iterdir() è¿­ä»£æ–‡ä»¶å¤¹ä¸­çš„å†…å®¹ print(child) # è·¯å¾„è§£æ # è·å–æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼ˆç¬¦å·é“¾æ¥ä¹Ÿä¼šè¢«è§£æåˆ°çœŸæ­£çš„æ–‡ä»¶ï¼‰ filename.resolve() # åœ¨ä¸åŒºåˆ†å¤§å°å†™çš„ç³»ç»Ÿä¸Šï¼ˆWindowsï¼‰ï¼Œè¿™ä¸ªå‡½æ•°ä¹Ÿä¼šå°†å¤§å°å†™è½¬æ¢æˆå®é™…çš„å½¢å¼ã€‚ # å¯ä»¥ç›´æ¥è·å– Home è·¯å¾„æˆ–è€…å½“å‰è·¯å¾„ Path.home() / \"file.txt\" # æœ‰æ—¶éœ€è¦ä»¥ home ä¸º base path æ¥æ„å»ºæ–‡ä»¶è·¯å¾„ Path.cwd() / \"file.txt\" # æˆ–è€…åŸºäºå½“å‰è·¯å¾„æ„å»º è¿˜æœ‰å¾ˆå¤šå…¶å®ƒçš„å®ç”¨å‡½æ•°ï¼Œå¯åœ¨ä½¿ç”¨ä¸­æ…¢æ…¢æ¢ç´¢ã€‚ 3. glob é€šé…ç¬¦pathlib ä¹Ÿæä¾›äº† glob æ”¯æŒï¼Œä¹Ÿå°±æ˜¯å¹¿æ³›ç”¨åœ¨è·¯å¾„åŒ¹é…ä¸Šçš„ä¸€ç§ç®€åŒ–æ­£åˆ™è¡¨è¾¾å¼ã€‚ python data_file.match(glob_pattern) # è¿”å› True æˆ– Falseï¼Œè¡¨ç¤ºæ–‡ä»¶è·¯å¾„ä¸ç»™å‡ºçš„ glob pattern æ˜¯å¦åŒ¹é… for py_file in data_folder.glob(\"*/*.py\"): # åŒ¹é…å½“å‰è·¯å¾„ä¸‹çš„å­æ–‡ä»¶å¤¹ä¸­çš„ py æ–‡ä»¶ï¼Œä¼šè¿”å›ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ print(py_file) # åå‘åŒ¹é…ï¼Œç›¸å½“äº glob æ¨¡å¼å¼€å¤´æ·»åŠ  \"**/\" for py_file in data_folder.glob(\"**/*.py\"): # åŒ¹é…å½“å‰è·¯å¾„ä¸‹çš„æ‰€æœ‰ py æ–‡ä»¶ï¼ˆæ‰€æœ‰å­æ–‡ä»¶å¤¹ä¹Ÿä¼šè¢«æœç´¢ï¼‰ï¼Œè¿”å›ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ print(py_file) glob ä¸­çš„ * è¡¨ç¤ºä»»æ„å­—ç¬¦ï¼Œè€Œ ** åˆ™è¡¨ç¤ºä»»æ„å±‚ç›®å½•ã€‚ï¼ˆåœ¨å¤§å‹æ–‡ä»¶æ ‘ä¸Šä½¿ç”¨ ** é€Ÿåº¦ä¼šå¾ˆæ…¢ï¼ï¼‰ ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:1:1","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#2-pathlib-å¸¸ç”¨å‡½æ•°"},{"categories":["tech"],"content":" 1. æ–‡ä»¶è·¯å¾„ - pathlibæä¾›äº† OS æ— å…³çš„æ–‡ä»¶è·¯å¾„æŠ½è±¡ï¼Œå¯ä»¥å®Œå…¨æ›¿ä»£æ—§çš„ os.path å’Œ glob. å­¦ä¼šäº† pathlib.Pathï¼Œä½ å°±ä¼šäº† Python å¤„ç†æ–‡ä»¶è·¯å¾„çš„æ‰€æœ‰åŠŸèƒ½ã€‚ 1. è·¯å¾„è§£æä¸æ‹¼æ¥ python3 from pathlib import Path data_folder = Path(\"./source_data/text_files/\") data_file = data_folder / \"raw_data.txt\" # Path é‡è½½äº† / æ“ä½œç¬¦ï¼Œè·¯å¾„æ‹¼æ¥è¶…çº§æ–¹ä¾¿ # è·¯å¾„çš„è§£æ data_file.parent # è·å–çˆ¶è·¯å¾„ï¼Œè¿™é‡Œçš„ç»“æœå°±æ˜¯ data_folder data_folder.parent # ä¼šè¿”å› Path(\"source_data\") data_file.parents[1] # å³è·å–åˆ° data_file çš„ä¸Šä¸Šå±‚ç›®å½•ï¼Œç»“æœå’Œä¸Šé¢ä¸€æ ·æ˜¯ Path(\"source_data\") data_file.parents[2] # ä¸Šä¸Šä¸Šå±‚ç›®å½•ï¼ŒPath(\".\") dara_file.name # æ–‡ä»¶å \"raw_data.txt\" dara_file.suffix # æ–‡ä»¶çš„åç¼€ï¼ˆæœ€æœ«å°¾çš„ï¼‰\".txt\"ï¼Œè¿˜å¯ç”¨ suffixes è·å–æ‰€æœ‰åç¼€ data_file.stem # å»é™¤æ‰æœ€æœ«å°¾çš„åç¼€åï¼ˆåªå»é™¤ä¸€ä¸ªï¼‰ï¼Œå‰©ä¸‹çš„æ–‡ä»¶åï¼šraw_data # æ›¿æ¢æ–‡ä»¶åæˆ–è€…æ–‡ä»¶åç¼€ data_file.with_name(\"test.txt\") # å˜æˆ .../test.txt data_file.with_suffix(\".pdf\") # å˜æˆ .../raw_data.pdf # å½“å‰è·¯å¾„ä¸å¦ä¸€è·¯å¾„ çš„ç›¸å¯¹è·¯å¾„ data_file.relative_to(data_folder) # PosixPath('raw_data.txt') 2. pathlib å¸¸ç”¨å‡½æ•° python3 if not data_folder.exists(): data_folder.mkdir(parents=True) # ç›´æ¥åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œå¦‚æœçˆ¶æ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼Œä¹Ÿè‡ªåŠ¨åˆ›å»º if not filename.exists(): # æ–‡ä»¶æ˜¯å¦å­˜åœ¨ filename.touch() # ç›´æ¥åˆ›å»ºç©ºæ–‡ä»¶ï¼Œæˆ–è€…ç”¨ filename.open() ç›´æ¥è·å–æ–‡ä»¶å¥æŸ„ # è·¯å¾„ç±»å‹åˆ¤æ–­ if data_file.is_file(): # æ˜¯æ–‡ä»¶ print(data_file, \"is a file\") elif data_file.is_dir(): # æ˜¯æ–‡ä»¶å¤¹ for child in p.iterdir(): # é€šè¿‡ Path.iterdir() è¿­ä»£æ–‡ä»¶å¤¹ä¸­çš„å†…å®¹ print(child) # è·¯å¾„è§£æ # è·å–æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼ˆç¬¦å·é“¾æ¥ä¹Ÿä¼šè¢«è§£æåˆ°çœŸæ­£çš„æ–‡ä»¶ï¼‰ filename.resolve() # åœ¨ä¸åŒºåˆ†å¤§å°å†™çš„ç³»ç»Ÿä¸Šï¼ˆWindowsï¼‰ï¼Œè¿™ä¸ªå‡½æ•°ä¹Ÿä¼šå°†å¤§å°å†™è½¬æ¢æˆå®é™…çš„å½¢å¼ã€‚ # å¯ä»¥ç›´æ¥è·å– Home è·¯å¾„æˆ–è€…å½“å‰è·¯å¾„ Path.home() / \"file.txt\" # æœ‰æ—¶éœ€è¦ä»¥ home ä¸º base path æ¥æ„å»ºæ–‡ä»¶è·¯å¾„ Path.cwd() / \"file.txt\" # æˆ–è€…åŸºäºå½“å‰è·¯å¾„æ„å»º è¿˜æœ‰å¾ˆå¤šå…¶å®ƒçš„å®ç”¨å‡½æ•°ï¼Œå¯åœ¨ä½¿ç”¨ä¸­æ…¢æ…¢æ¢ç´¢ã€‚ 3. glob é€šé…ç¬¦pathlib ä¹Ÿæä¾›äº† glob æ”¯æŒï¼Œä¹Ÿå°±æ˜¯å¹¿æ³›ç”¨åœ¨è·¯å¾„åŒ¹é…ä¸Šçš„ä¸€ç§ç®€åŒ–æ­£åˆ™è¡¨è¾¾å¼ã€‚ python data_file.match(glob_pattern) # è¿”å› True æˆ– Falseï¼Œè¡¨ç¤ºæ–‡ä»¶è·¯å¾„ä¸ç»™å‡ºçš„ glob pattern æ˜¯å¦åŒ¹é… for py_file in data_folder.glob(\"*/*.py\"): # åŒ¹é…å½“å‰è·¯å¾„ä¸‹çš„å­æ–‡ä»¶å¤¹ä¸­çš„ py æ–‡ä»¶ï¼Œä¼šè¿”å›ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ print(py_file) # åå‘åŒ¹é…ï¼Œç›¸å½“äº glob æ¨¡å¼å¼€å¤´æ·»åŠ  \"**/\" for py_file in data_folder.glob(\"**/*.py\"): # åŒ¹é…å½“å‰è·¯å¾„ä¸‹çš„æ‰€æœ‰ py æ–‡ä»¶ï¼ˆæ‰€æœ‰å­æ–‡ä»¶å¤¹ä¹Ÿä¼šè¢«æœç´¢ï¼‰ï¼Œè¿”å›ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ print(py_file) glob ä¸­çš„ * è¡¨ç¤ºä»»æ„å­—ç¬¦ï¼Œè€Œ ** åˆ™è¡¨ç¤ºä»»æ„å±‚ç›®å½•ã€‚ï¼ˆåœ¨å¤§å‹æ–‡ä»¶æ ‘ä¸Šä½¿ç”¨ ** é€Ÿåº¦ä¼šå¾ˆæ…¢ï¼ï¼‰ ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:1:1","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#3-glob-é€šé…ç¬¦"},{"categories":["tech"],"content":" 2. æ—¶é—´æ—¥æœŸå¤„ç†python3 åœ¨æ—¶é—´æ—¥æœŸå¤„ç†æ–¹é¢ï¼Œæœ‰æ ‡å‡†åº“ datetime è·Ÿ calenderï¼Œä¹Ÿæœ‰æµè¡Œçš„ç¬¬ä¸‰æ–¹åº“ arrow è·Ÿ maya. æ ‡å‡†åº“ datetime æœ‰æ—¶å€™ä¸å¤ªæ–¹ä¾¿ï¼Œæ¯”å¦‚æ²¡æœ‰æä¾›è§£æ iso æ ¼å¼çš„å‡½æ•°ã€‚å¦å¤–å°±æ˜¯ç”¨æ ‡å‡†åº“æ—¶ï¼Œç»å¸¸éœ€è¦è‡ªå®šä¹‰æ ¼å¼åŒ–ä¸²ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œmaya å’Œ arrow è¿™ä¸¤ä¸ªç¬¬ä¸‰æ–¹åº“ä¼šæ–¹ä¾¿å¾ˆå¤šã€‚ ä¸è¿‡ç¬¬ä¸‰æ–¹åº“å¹¶ä¸æ˜¯ä»»ä½•æ—¶å€™éƒ½å¯ç”¨ï¼Œè¿™é‡Œåªä»‹ç»æ ‡å‡†åº“ datetime çš„ç”¨æ³•ï¼Œmaya/arrow è¯·è‡ªè¡ŒæŸ¥æ‰¾å®˜æ–¹æ–‡æ¡£å­¦ä¹ ã€‚ 1. è·å–å½“å‰æ—¶é—´ python3 import time import datetime as dt # 1. è·å–å½“å‰æ—¶é—´çš„æ—¶é—´æˆ³ time.time() # ç›´æ¥è°ƒç”¨ c apiï¼Œå› æ­¤é€Ÿåº¦å¾ˆå¿«: 1582315203.537061 utcnow = dt.datetime.utcnow() # å½“å‰çš„ä¸–ç•Œæ ‡å‡†æ—¶é—´: datetime.datetime(2020, 2, 22, 4, 0, 3, 537061) utcnow.timestamp() # å°†æ ‡å‡†æ—¶è½¬æ¢æˆæ—¶é—´æˆ³ï¼šdatetime =\u003e 1582315203.537061 # 2. UTC ä¸–ç•Œæ ‡å‡†æ—¶é—´ time.gmtime() #è¾“å‡ºä¸ºï¼š time.struct_time(tm_year=2019, tm_mon=6, tm_mday=23, # tm_hour=3, tm_min=49, tm_sec=17, # tm_wday=6, tm_yday=174, tm_isdst=0) # è¿™å®é™…ä¸Šæ˜¯ä¸€ä¸ªå‘½åå…ƒç»„ # 3. æ„å»ºä¸€ä¸ªæŒ‡å®šçš„ datetime å®ä¾‹ time_1997 = dt.datetime(year=1997, month=1, day=1) # =\u003e datetime.datetime(1997, 1, 1, 0, 0) dt.datetime(year=1997, month=1, day=1, minute=11) # =\u003e datetime.datetime(1997, 1, 1, 0, 11) 2. æ—¶é—´æ—¥æœŸçš„ä¿®æ”¹ä¸è¿ç®— python3 # 0. æ—¥æœŸçš„ä¿®æ”¹ï¼ˆä¿®æ”¹å¹´æœˆæ—¶åˆ†ç§’ï¼‰ utcnow.replace(day=11) # =\u003e datetime.datetime(2020, 2, 11, 4, 0, 3, 537061) ä¿®æ”¹ day utcnow.replace(hour=11) # =\u003e datetime.datetime(2020, 2, 22, 11, 0, 3, 537061) ä¿®æ”¹ hour # 1. æ—¥æœŸä¸æ—¶é—´ date_utcnow = utcnow.date() # =\u003e datetime.date(2020, 2, 22) å¹´æœˆæ—¥ time_utcnow = utcnow.time() # =\u003e datetime.time(4, 0, 3, 537061) æ—¶åˆ†ç§’ # 2. è”ç»“æ—¶é—´å’Œæ—¥æœŸï¼ˆdate å’Œ time ä¸èƒ½ç”¨åŠ æ³•è”ç»“ï¼‰ dt.datetime.combine(date_utcnow, time_utcnow) # =\u003e datetime.datetime(2020, 2, 22, 4, 0, 3, 537061) # 3. æ—¥æœŸçš„è¿ç®— # 3.1 datetime ä¹‹é—´åªèƒ½è®¡ç®—æ—¶é—´å·®ï¼ˆå‡æ³•ï¼‰ï¼Œä¸èƒ½è¿›è¡Œå…¶ä»–è¿ç®— utcnow - time_1997 # =\u003e datetime.timedelta(days=8452, seconds=14403, microseconds=537061) # 3.2 ä½¿ç”¨ timedelta è¿›è¡Œæ—¶é—´çš„å¢å‡ days_step = dt.timedelta(days=1) # æ³¨æ„å‚æ•°æ˜¯å¤æ•°å½¢å¼ time_1997 + days_step # =\u003e datetime.datetime(1997, 1, 2, 0, 0) time_1997 - days_step # =\u003e datetime.datetime(1996, 12, 31, 0, 0) # 3.3 timedelta ä¹‹é—´ä¹Ÿå¯ä»¥è¿›è¡ŒåŠ å‡æ³• hours_step = dt.timedelta(hours=1) # =\u003e datetime.timedelta(seconds=3600) days_step + hours_step # =\u003e datetime.timedelta(days=1, seconds=3600) days_step - hours_step # =\u003e datetime.timedelta(seconds=82800) hours_step - days_step # =\u003e datetime.timedelta(days=-1, seconds=3600) # 3.4 timedelta è¿˜å¯ä»¥æŒ‰æ¯”ä¾‹å¢å‡ï¼ˆä¸æ•°å­—è¿›è¡Œä¹˜é™¤æ³•ï¼‰ hours_step * 2 # =\u003e datetime.timedelta(seconds=7200) days_step * -2 # =\u003e datetime.timedelta(days=-2) hours_step * 1.1 # =\u003e datetime.timedelta(seconds=3960) 3. æ—¶é—´æ—¥æœŸçš„æ ¼å¼åŒ–ä¸è§£æå…ˆä»‹ç»ä¸‹å¸¸ç”¨çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼š æ™®é€šæ ¼å¼ - â€˜%Y-%m-%d %H:%M:%Sâ€™ =\u003e â€˜2020-02-22 04:00:03â€™ ISO æ ¼å¼ - â€˜%Y-%m-%dT%H:%M:%S.%fZâ€™ =\u003e â€˜2020-02-22T04:00:03.537061Zâ€™ å¸¦æ—¶åŒºçš„æ ¼å¼ - â€˜%Y-%m-%dT%H:%M:%S%Zâ€™ =\u003e 2022-02-10T00:48:52UTC+08:00 éœ€è¦æ—¶é—´å¯¹è±¡è‡ªèº«æœ‰æ—¶åŒºå±æ€§æ‰è¡Œï¼å¦åˆ™æ ¼å¼åŒ–æ—¶ä¼šå¿½ç•¥ %Z å¦å¤–å†ä»‹ç»ä¸‹ Python ä¸¤ä¸ªæ—¶é—´æ ¼å¼åŒ–ä¸è§£æå‡½æ•°çš„å‘½åï¼š strftime: å³ string format time strptime: å³ string parse time python3 # 1. å°†æ—¶é—´æ ¼å¼åŒ–æˆå­—ç¬¦ä¸² # 1.1 å°† datetime æ ¼å¼åŒ–ä¸º iso æ ‡å‡†æ ¼å¼ utcnow.isoformat() # =\u003e '2020-02-22T04:00:03.537061' utcnow.strftime('%Y-%m-%dT%H:%M:%S.%fZ') # =\u003e '2020-02-22T04:00:03.537061Z' utcnow.date().strftime('%Y-%m-%dT%H:%M:%S.%fZ') # =\u003e '2020-02-22T00:00:00.000000Z' # 1.2 å°† time.struct_time æ ¼å¼åŒ–ä¸ºæ—¥æœŸå­—ç¬¦ä¸²ï¼ˆè²Œä¼¼ä¸æ”¯æŒ isoï¼Œå¯èƒ½æ˜¯ç²¾åº¦ä¸å¤Ÿï¼‰ time.strftime('%Y-%m-%dT%H:%M:%S', gm) # =\u003e '2020-02-22T04:00:03' # 1.3 å°† datetime æ ¼å¼åŒ–æˆæŒ‡å®šæ ¼å¼ utcnow.strftime('%Y-%m-%d %H:%M:%S') # =\u003e '2020-02-22 04:00:03' # 2. è§£ææ—¶é—´å­—ç¬¦ä¸² # 2.1 è§£æ iso æ ¼å¼çš„æ—¶é—´å­—ç¬¦ä¸²ï¼Œæ‰‹åŠ¨æŒ‡å®šæ ¼å¼ï¼ˆæ³¨æ„ %f åªå¯¹åº”å…­ä½å°æ•°ï¼Œå¯¹9ä½å°æ•°å®ƒæ— èƒ½ä¸ºåŠ›ã€‚ã€‚ï¼‰ dt.datetime.strptime('2020-02-22T04:00:03.537061Z', '%Y-%m-%dT%H:%M:%S.%fZ') # =\u003e datetime.datetime(2020, 2, 22, 4, 0, 3, 537061) # 2.2 è§£æ iso æ ¼å¼çš„æ—¶é—´å­—ç¬¦ä¸²(éœ€è¦ python 3.7+) dt.datetime.fromisoformat('2020-02-22T04:00:03.537061') # =\u003e datetime.datetime(2020, 2, 22, 4, 0, 3, 537061) dt.date.fromisoformat('2020-02-22') # =\u003e datetime.date(2020, 2, 22) dt.time.fromisoformat(\"04:00:03.537061\") # =\u003e datetime.time(4, 0, 3, 537061) # 2.3 è§£ææŒ‡å®šæ ¼å¼çš„å­—ç¬¦ä¸² dt.datetime.strptime('2020-02-22 04:00:03', '%Y-%m-%d %H:%M:%S') # =\u003e datetime.datetime(2020, 2, 22, 4, 0, 3) 4. æ—¶åŒºè½¬æ¢ä¸æ—¥æœŸæ ¼å¼åŒ– python3 # ä¸Šæµ·æ—¶åŒºï¼šä¸œå…«åŒº utc+8 tz_shanghai = dt.timezone(dt.timedelta(hours=8)) now_shanghai = dt.datetime.now(tz=tz_shanghai) now_shanghai.strftime('%Y-%m-%dT%H:%M:%S%Z') # =\u003e 2022-02-10T00:48:52UTC+08:00 ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:1:2","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#2-æ—¶é—´æ—¥æœŸå¤„ç†"},{"categories":["tech"],"content":" 2. æ—¶é—´æ—¥æœŸå¤„ç†python3 åœ¨æ—¶é—´æ—¥æœŸå¤„ç†æ–¹é¢ï¼Œæœ‰æ ‡å‡†åº“ datetime è·Ÿ calenderï¼Œä¹Ÿæœ‰æµè¡Œçš„ç¬¬ä¸‰æ–¹åº“ arrow è·Ÿ maya. æ ‡å‡†åº“ datetime æœ‰æ—¶å€™ä¸å¤ªæ–¹ä¾¿ï¼Œæ¯”å¦‚æ²¡æœ‰æä¾›è§£æ iso æ ¼å¼çš„å‡½æ•°ã€‚å¦å¤–å°±æ˜¯ç”¨æ ‡å‡†åº“æ—¶ï¼Œç»å¸¸éœ€è¦è‡ªå®šä¹‰æ ¼å¼åŒ–ä¸²ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œmaya å’Œ arrow è¿™ä¸¤ä¸ªç¬¬ä¸‰æ–¹åº“ä¼šæ–¹ä¾¿å¾ˆå¤šã€‚ ä¸è¿‡ç¬¬ä¸‰æ–¹åº“å¹¶ä¸æ˜¯ä»»ä½•æ—¶å€™éƒ½å¯ç”¨ï¼Œè¿™é‡Œåªä»‹ç»æ ‡å‡†åº“ datetime çš„ç”¨æ³•ï¼Œmaya/arrow è¯·è‡ªè¡ŒæŸ¥æ‰¾å®˜æ–¹æ–‡æ¡£å­¦ä¹ ã€‚ 1. è·å–å½“å‰æ—¶é—´ python3 import time import datetime as dt # 1. è·å–å½“å‰æ—¶é—´çš„æ—¶é—´æˆ³ time.time() # ç›´æ¥è°ƒç”¨ c apiï¼Œå› æ­¤é€Ÿåº¦å¾ˆå¿«: 1582315203.537061 utcnow = dt.datetime.utcnow() # å½“å‰çš„ä¸–ç•Œæ ‡å‡†æ—¶é—´: datetime.datetime(2020, 2, 22, 4, 0, 3, 537061) utcnow.timestamp() # å°†æ ‡å‡†æ—¶è½¬æ¢æˆæ—¶é—´æˆ³ï¼šdatetime =\u003e 1582315203.537061 # 2. UTC ä¸–ç•Œæ ‡å‡†æ—¶é—´ time.gmtime() #è¾“å‡ºä¸ºï¼š time.struct_time(tm_year=2019, tm_mon=6, tm_mday=23, # tm_hour=3, tm_min=49, tm_sec=17, # tm_wday=6, tm_yday=174, tm_isdst=0) # è¿™å®é™…ä¸Šæ˜¯ä¸€ä¸ªå‘½åå…ƒç»„ # 3. æ„å»ºä¸€ä¸ªæŒ‡å®šçš„ datetime å®ä¾‹ time_1997 = dt.datetime(year=1997, month=1, day=1) # =\u003e datetime.datetime(1997, 1, 1, 0, 0) dt.datetime(year=1997, month=1, day=1, minute=11) # =\u003e datetime.datetime(1997, 1, 1, 0, 11) 2. æ—¶é—´æ—¥æœŸçš„ä¿®æ”¹ä¸è¿ç®— python3 # 0. æ—¥æœŸçš„ä¿®æ”¹ï¼ˆä¿®æ”¹å¹´æœˆæ—¶åˆ†ç§’ï¼‰ utcnow.replace(day=11) # =\u003e datetime.datetime(2020, 2, 11, 4, 0, 3, 537061) ä¿®æ”¹ day utcnow.replace(hour=11) # =\u003e datetime.datetime(2020, 2, 22, 11, 0, 3, 537061) ä¿®æ”¹ hour # 1. æ—¥æœŸä¸æ—¶é—´ date_utcnow = utcnow.date() # =\u003e datetime.date(2020, 2, 22) å¹´æœˆæ—¥ time_utcnow = utcnow.time() # =\u003e datetime.time(4, 0, 3, 537061) æ—¶åˆ†ç§’ # 2. è”ç»“æ—¶é—´å’Œæ—¥æœŸï¼ˆdate å’Œ time ä¸èƒ½ç”¨åŠ æ³•è”ç»“ï¼‰ dt.datetime.combine(date_utcnow, time_utcnow) # =\u003e datetime.datetime(2020, 2, 22, 4, 0, 3, 537061) # 3. æ—¥æœŸçš„è¿ç®— # 3.1 datetime ä¹‹é—´åªèƒ½è®¡ç®—æ—¶é—´å·®ï¼ˆå‡æ³•ï¼‰ï¼Œä¸èƒ½è¿›è¡Œå…¶ä»–è¿ç®— utcnow - time_1997 # =\u003e datetime.timedelta(days=8452, seconds=14403, microseconds=537061) # 3.2 ä½¿ç”¨ timedelta è¿›è¡Œæ—¶é—´çš„å¢å‡ days_step = dt.timedelta(days=1) # æ³¨æ„å‚æ•°æ˜¯å¤æ•°å½¢å¼ time_1997 + days_step # =\u003e datetime.datetime(1997, 1, 2, 0, 0) time_1997 - days_step # =\u003e datetime.datetime(1996, 12, 31, 0, 0) # 3.3 timedelta ä¹‹é—´ä¹Ÿå¯ä»¥è¿›è¡ŒåŠ å‡æ³• hours_step = dt.timedelta(hours=1) # =\u003e datetime.timedelta(seconds=3600) days_step + hours_step # =\u003e datetime.timedelta(days=1, seconds=3600) days_step - hours_step # =\u003e datetime.timedelta(seconds=82800) hours_step - days_step # =\u003e datetime.timedelta(days=-1, seconds=3600) # 3.4 timedelta è¿˜å¯ä»¥æŒ‰æ¯”ä¾‹å¢å‡ï¼ˆä¸æ•°å­—è¿›è¡Œä¹˜é™¤æ³•ï¼‰ hours_step * 2 # =\u003e datetime.timedelta(seconds=7200) days_step * -2 # =\u003e datetime.timedelta(days=-2) hours_step * 1.1 # =\u003e datetime.timedelta(seconds=3960) 3. æ—¶é—´æ—¥æœŸçš„æ ¼å¼åŒ–ä¸è§£æå…ˆä»‹ç»ä¸‹å¸¸ç”¨çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼š æ™®é€šæ ¼å¼ - â€˜%Y-%m-%d %H:%M:%Sâ€™ =\u003e â€˜2020-02-22 04:00:03â€™ ISO æ ¼å¼ - â€˜%Y-%m-%dT%H:%M:%S.%fZâ€™ =\u003e â€˜2020-02-22T04:00:03.537061Zâ€™ å¸¦æ—¶åŒºçš„æ ¼å¼ - â€˜%Y-%m-%dT%H:%M:%S%Zâ€™ =\u003e 2022-02-10T00:48:52UTC+08:00 éœ€è¦æ—¶é—´å¯¹è±¡è‡ªèº«æœ‰æ—¶åŒºå±æ€§æ‰è¡Œï¼å¦åˆ™æ ¼å¼åŒ–æ—¶ä¼šå¿½ç•¥ %Z å¦å¤–å†ä»‹ç»ä¸‹ Python ä¸¤ä¸ªæ—¶é—´æ ¼å¼åŒ–ä¸è§£æå‡½æ•°çš„å‘½åï¼š strftime: å³ string format time strptime: å³ string parse time python3 # 1. å°†æ—¶é—´æ ¼å¼åŒ–æˆå­—ç¬¦ä¸² # 1.1 å°† datetime æ ¼å¼åŒ–ä¸º iso æ ‡å‡†æ ¼å¼ utcnow.isoformat() # =\u003e '2020-02-22T04:00:03.537061' utcnow.strftime('%Y-%m-%dT%H:%M:%S.%fZ') # =\u003e '2020-02-22T04:00:03.537061Z' utcnow.date().strftime('%Y-%m-%dT%H:%M:%S.%fZ') # =\u003e '2020-02-22T00:00:00.000000Z' # 1.2 å°† time.struct_time æ ¼å¼åŒ–ä¸ºæ—¥æœŸå­—ç¬¦ä¸²ï¼ˆè²Œä¼¼ä¸æ”¯æŒ isoï¼Œå¯èƒ½æ˜¯ç²¾åº¦ä¸å¤Ÿï¼‰ time.strftime('%Y-%m-%dT%H:%M:%S', gm) # =\u003e '2020-02-22T04:00:03' # 1.3 å°† datetime æ ¼å¼åŒ–æˆæŒ‡å®šæ ¼å¼ utcnow.strftime('%Y-%m-%d %H:%M:%S') # =\u003e '2020-02-22 04:00:03' # 2. è§£ææ—¶é—´å­—ç¬¦ä¸² # 2.1 è§£æ iso æ ¼å¼çš„æ—¶é—´å­—ç¬¦ä¸²ï¼Œæ‰‹åŠ¨æŒ‡å®šæ ¼å¼ï¼ˆæ³¨æ„ %f åªå¯¹åº”å…­ä½å°æ•°ï¼Œå¯¹9ä½å°æ•°å®ƒæ— èƒ½ä¸ºåŠ›ã€‚ã€‚ï¼‰ dt.datetime.strptime('2020-02-22T04:00:03.537061Z', '%Y-%m-%dT%H:%M:%S.%fZ') # =\u003e datetime.datetime(2020, 2, 22, 4, 0, 3, 537061) # 2.2 è§£æ iso æ ¼å¼çš„æ—¶é—´å­—ç¬¦ä¸²(éœ€è¦ python 3.7+) dt.datetime.fromisoformat('2020-02-22T04:00:03.537061') # =\u003e datetime.datetime(2020, 2, 22, 4, 0, 3, 537061) dt.date.fromisoformat('2020-02-22') # =\u003e datetime.date(2020, 2, 22) dt.time.fromisoformat(\"04:00:03.537061\") # =\u003e datetime.time(4, 0, 3, 537061) # 2.3 è§£ææŒ‡å®šæ ¼å¼çš„å­—ç¬¦ä¸² dt.datetime.strptime('2020-02-22 04:00:03', '%Y-%m-%d %H:%M:%S') # =\u003e datetime.datetime(2020, 2, 22, 4, 0, 3) 4. æ—¶åŒºè½¬æ¢ä¸æ—¥æœŸæ ¼å¼åŒ– python3 # ä¸Šæµ·æ—¶åŒºï¼šä¸œå…«åŒº utc+8 tz_shanghai = dt.timezone(dt.timedelta(hours=8)) now_shanghai = dt.datetime.now(tz=tz_shanghai) now_shanghai.strftime('%Y-%m-%dT%H:%M:%S%Z') # =\u003e 2022-02-10T00:48:52UTC+08:00 ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:1:2","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#1-è·å–å½“å‰æ—¶é—´"},{"categories":["tech"],"content":" 2. æ—¶é—´æ—¥æœŸå¤„ç†python3 åœ¨æ—¶é—´æ—¥æœŸå¤„ç†æ–¹é¢ï¼Œæœ‰æ ‡å‡†åº“ datetime è·Ÿ calenderï¼Œä¹Ÿæœ‰æµè¡Œçš„ç¬¬ä¸‰æ–¹åº“ arrow è·Ÿ maya. æ ‡å‡†åº“ datetime æœ‰æ—¶å€™ä¸å¤ªæ–¹ä¾¿ï¼Œæ¯”å¦‚æ²¡æœ‰æä¾›è§£æ iso æ ¼å¼çš„å‡½æ•°ã€‚å¦å¤–å°±æ˜¯ç”¨æ ‡å‡†åº“æ—¶ï¼Œç»å¸¸éœ€è¦è‡ªå®šä¹‰æ ¼å¼åŒ–ä¸²ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œmaya å’Œ arrow è¿™ä¸¤ä¸ªç¬¬ä¸‰æ–¹åº“ä¼šæ–¹ä¾¿å¾ˆå¤šã€‚ ä¸è¿‡ç¬¬ä¸‰æ–¹åº“å¹¶ä¸æ˜¯ä»»ä½•æ—¶å€™éƒ½å¯ç”¨ï¼Œè¿™é‡Œåªä»‹ç»æ ‡å‡†åº“ datetime çš„ç”¨æ³•ï¼Œmaya/arrow è¯·è‡ªè¡ŒæŸ¥æ‰¾å®˜æ–¹æ–‡æ¡£å­¦ä¹ ã€‚ 1. è·å–å½“å‰æ—¶é—´ python3 import time import datetime as dt # 1. è·å–å½“å‰æ—¶é—´çš„æ—¶é—´æˆ³ time.time() # ç›´æ¥è°ƒç”¨ c apiï¼Œå› æ­¤é€Ÿåº¦å¾ˆå¿«: 1582315203.537061 utcnow = dt.datetime.utcnow() # å½“å‰çš„ä¸–ç•Œæ ‡å‡†æ—¶é—´: datetime.datetime(2020, 2, 22, 4, 0, 3, 537061) utcnow.timestamp() # å°†æ ‡å‡†æ—¶è½¬æ¢æˆæ—¶é—´æˆ³ï¼šdatetime =\u003e 1582315203.537061 # 2. UTC ä¸–ç•Œæ ‡å‡†æ—¶é—´ time.gmtime() #è¾“å‡ºä¸ºï¼š time.struct_time(tm_year=2019, tm_mon=6, tm_mday=23, # tm_hour=3, tm_min=49, tm_sec=17, # tm_wday=6, tm_yday=174, tm_isdst=0) # è¿™å®é™…ä¸Šæ˜¯ä¸€ä¸ªå‘½åå…ƒç»„ # 3. æ„å»ºä¸€ä¸ªæŒ‡å®šçš„ datetime å®ä¾‹ time_1997 = dt.datetime(year=1997, month=1, day=1) # =\u003e datetime.datetime(1997, 1, 1, 0, 0) dt.datetime(year=1997, month=1, day=1, minute=11) # =\u003e datetime.datetime(1997, 1, 1, 0, 11) 2. æ—¶é—´æ—¥æœŸçš„ä¿®æ”¹ä¸è¿ç®— python3 # 0. æ—¥æœŸçš„ä¿®æ”¹ï¼ˆä¿®æ”¹å¹´æœˆæ—¶åˆ†ç§’ï¼‰ utcnow.replace(day=11) # =\u003e datetime.datetime(2020, 2, 11, 4, 0, 3, 537061) ä¿®æ”¹ day utcnow.replace(hour=11) # =\u003e datetime.datetime(2020, 2, 22, 11, 0, 3, 537061) ä¿®æ”¹ hour # 1. æ—¥æœŸä¸æ—¶é—´ date_utcnow = utcnow.date() # =\u003e datetime.date(2020, 2, 22) å¹´æœˆæ—¥ time_utcnow = utcnow.time() # =\u003e datetime.time(4, 0, 3, 537061) æ—¶åˆ†ç§’ # 2. è”ç»“æ—¶é—´å’Œæ—¥æœŸï¼ˆdate å’Œ time ä¸èƒ½ç”¨åŠ æ³•è”ç»“ï¼‰ dt.datetime.combine(date_utcnow, time_utcnow) # =\u003e datetime.datetime(2020, 2, 22, 4, 0, 3, 537061) # 3. æ—¥æœŸçš„è¿ç®— # 3.1 datetime ä¹‹é—´åªèƒ½è®¡ç®—æ—¶é—´å·®ï¼ˆå‡æ³•ï¼‰ï¼Œä¸èƒ½è¿›è¡Œå…¶ä»–è¿ç®— utcnow - time_1997 # =\u003e datetime.timedelta(days=8452, seconds=14403, microseconds=537061) # 3.2 ä½¿ç”¨ timedelta è¿›è¡Œæ—¶é—´çš„å¢å‡ days_step = dt.timedelta(days=1) # æ³¨æ„å‚æ•°æ˜¯å¤æ•°å½¢å¼ time_1997 + days_step # =\u003e datetime.datetime(1997, 1, 2, 0, 0) time_1997 - days_step # =\u003e datetime.datetime(1996, 12, 31, 0, 0) # 3.3 timedelta ä¹‹é—´ä¹Ÿå¯ä»¥è¿›è¡ŒåŠ å‡æ³• hours_step = dt.timedelta(hours=1) # =\u003e datetime.timedelta(seconds=3600) days_step + hours_step # =\u003e datetime.timedelta(days=1, seconds=3600) days_step - hours_step # =\u003e datetime.timedelta(seconds=82800) hours_step - days_step # =\u003e datetime.timedelta(days=-1, seconds=3600) # 3.4 timedelta è¿˜å¯ä»¥æŒ‰æ¯”ä¾‹å¢å‡ï¼ˆä¸æ•°å­—è¿›è¡Œä¹˜é™¤æ³•ï¼‰ hours_step * 2 # =\u003e datetime.timedelta(seconds=7200) days_step * -2 # =\u003e datetime.timedelta(days=-2) hours_step * 1.1 # =\u003e datetime.timedelta(seconds=3960) 3. æ—¶é—´æ—¥æœŸçš„æ ¼å¼åŒ–ä¸è§£æå…ˆä»‹ç»ä¸‹å¸¸ç”¨çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼š æ™®é€šæ ¼å¼ - â€˜%Y-%m-%d %H:%M:%Sâ€™ =\u003e â€˜2020-02-22 04:00:03â€™ ISO æ ¼å¼ - â€˜%Y-%m-%dT%H:%M:%S.%fZâ€™ =\u003e â€˜2020-02-22T04:00:03.537061Zâ€™ å¸¦æ—¶åŒºçš„æ ¼å¼ - â€˜%Y-%m-%dT%H:%M:%S%Zâ€™ =\u003e 2022-02-10T00:48:52UTC+08:00 éœ€è¦æ—¶é—´å¯¹è±¡è‡ªèº«æœ‰æ—¶åŒºå±æ€§æ‰è¡Œï¼å¦åˆ™æ ¼å¼åŒ–æ—¶ä¼šå¿½ç•¥ %Z å¦å¤–å†ä»‹ç»ä¸‹ Python ä¸¤ä¸ªæ—¶é—´æ ¼å¼åŒ–ä¸è§£æå‡½æ•°çš„å‘½åï¼š strftime: å³ string format time strptime: å³ string parse time python3 # 1. å°†æ—¶é—´æ ¼å¼åŒ–æˆå­—ç¬¦ä¸² # 1.1 å°† datetime æ ¼å¼åŒ–ä¸º iso æ ‡å‡†æ ¼å¼ utcnow.isoformat() # =\u003e '2020-02-22T04:00:03.537061' utcnow.strftime('%Y-%m-%dT%H:%M:%S.%fZ') # =\u003e '2020-02-22T04:00:03.537061Z' utcnow.date().strftime('%Y-%m-%dT%H:%M:%S.%fZ') # =\u003e '2020-02-22T00:00:00.000000Z' # 1.2 å°† time.struct_time æ ¼å¼åŒ–ä¸ºæ—¥æœŸå­—ç¬¦ä¸²ï¼ˆè²Œä¼¼ä¸æ”¯æŒ isoï¼Œå¯èƒ½æ˜¯ç²¾åº¦ä¸å¤Ÿï¼‰ time.strftime('%Y-%m-%dT%H:%M:%S', gm) # =\u003e '2020-02-22T04:00:03' # 1.3 å°† datetime æ ¼å¼åŒ–æˆæŒ‡å®šæ ¼å¼ utcnow.strftime('%Y-%m-%d %H:%M:%S') # =\u003e '2020-02-22 04:00:03' # 2. è§£ææ—¶é—´å­—ç¬¦ä¸² # 2.1 è§£æ iso æ ¼å¼çš„æ—¶é—´å­—ç¬¦ä¸²ï¼Œæ‰‹åŠ¨æŒ‡å®šæ ¼å¼ï¼ˆæ³¨æ„ %f åªå¯¹åº”å…­ä½å°æ•°ï¼Œå¯¹9ä½å°æ•°å®ƒæ— èƒ½ä¸ºåŠ›ã€‚ã€‚ï¼‰ dt.datetime.strptime('2020-02-22T04:00:03.537061Z', '%Y-%m-%dT%H:%M:%S.%fZ') # =\u003e datetime.datetime(2020, 2, 22, 4, 0, 3, 537061) # 2.2 è§£æ iso æ ¼å¼çš„æ—¶é—´å­—ç¬¦ä¸²(éœ€è¦ python 3.7+) dt.datetime.fromisoformat('2020-02-22T04:00:03.537061') # =\u003e datetime.datetime(2020, 2, 22, 4, 0, 3, 537061) dt.date.fromisoformat('2020-02-22') # =\u003e datetime.date(2020, 2, 22) dt.time.fromisoformat(\"04:00:03.537061\") # =\u003e datetime.time(4, 0, 3, 537061) # 2.3 è§£ææŒ‡å®šæ ¼å¼çš„å­—ç¬¦ä¸² dt.datetime.strptime('2020-02-22 04:00:03', '%Y-%m-%d %H:%M:%S') # =\u003e datetime.datetime(2020, 2, 22, 4, 0, 3) 4. æ—¶åŒºè½¬æ¢ä¸æ—¥æœŸæ ¼å¼åŒ– python3 # ä¸Šæµ·æ—¶åŒºï¼šä¸œå…«åŒº utc+8 tz_shanghai = dt.timezone(dt.timedelta(hours=8)) now_shanghai = dt.datetime.now(tz=tz_shanghai) now_shanghai.strftime('%Y-%m-%dT%H:%M:%S%Z') # =\u003e 2022-02-10T00:48:52UTC+08:00 ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:1:2","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#2-æ—¶é—´æ—¥æœŸçš„ä¿®æ”¹ä¸è¿ç®—"},{"categories":["tech"],"content":" 2. æ—¶é—´æ—¥æœŸå¤„ç†python3 åœ¨æ—¶é—´æ—¥æœŸå¤„ç†æ–¹é¢ï¼Œæœ‰æ ‡å‡†åº“ datetime è·Ÿ calenderï¼Œä¹Ÿæœ‰æµè¡Œçš„ç¬¬ä¸‰æ–¹åº“ arrow è·Ÿ maya. æ ‡å‡†åº“ datetime æœ‰æ—¶å€™ä¸å¤ªæ–¹ä¾¿ï¼Œæ¯”å¦‚æ²¡æœ‰æä¾›è§£æ iso æ ¼å¼çš„å‡½æ•°ã€‚å¦å¤–å°±æ˜¯ç”¨æ ‡å‡†åº“æ—¶ï¼Œç»å¸¸éœ€è¦è‡ªå®šä¹‰æ ¼å¼åŒ–ä¸²ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œmaya å’Œ arrow è¿™ä¸¤ä¸ªç¬¬ä¸‰æ–¹åº“ä¼šæ–¹ä¾¿å¾ˆå¤šã€‚ ä¸è¿‡ç¬¬ä¸‰æ–¹åº“å¹¶ä¸æ˜¯ä»»ä½•æ—¶å€™éƒ½å¯ç”¨ï¼Œè¿™é‡Œåªä»‹ç»æ ‡å‡†åº“ datetime çš„ç”¨æ³•ï¼Œmaya/arrow è¯·è‡ªè¡ŒæŸ¥æ‰¾å®˜æ–¹æ–‡æ¡£å­¦ä¹ ã€‚ 1. è·å–å½“å‰æ—¶é—´ python3 import time import datetime as dt # 1. è·å–å½“å‰æ—¶é—´çš„æ—¶é—´æˆ³ time.time() # ç›´æ¥è°ƒç”¨ c apiï¼Œå› æ­¤é€Ÿåº¦å¾ˆå¿«: 1582315203.537061 utcnow = dt.datetime.utcnow() # å½“å‰çš„ä¸–ç•Œæ ‡å‡†æ—¶é—´: datetime.datetime(2020, 2, 22, 4, 0, 3, 537061) utcnow.timestamp() # å°†æ ‡å‡†æ—¶è½¬æ¢æˆæ—¶é—´æˆ³ï¼šdatetime =\u003e 1582315203.537061 # 2. UTC ä¸–ç•Œæ ‡å‡†æ—¶é—´ time.gmtime() #è¾“å‡ºä¸ºï¼š time.struct_time(tm_year=2019, tm_mon=6, tm_mday=23, # tm_hour=3, tm_min=49, tm_sec=17, # tm_wday=6, tm_yday=174, tm_isdst=0) # è¿™å®é™…ä¸Šæ˜¯ä¸€ä¸ªå‘½åå…ƒç»„ # 3. æ„å»ºä¸€ä¸ªæŒ‡å®šçš„ datetime å®ä¾‹ time_1997 = dt.datetime(year=1997, month=1, day=1) # =\u003e datetime.datetime(1997, 1, 1, 0, 0) dt.datetime(year=1997, month=1, day=1, minute=11) # =\u003e datetime.datetime(1997, 1, 1, 0, 11) 2. æ—¶é—´æ—¥æœŸçš„ä¿®æ”¹ä¸è¿ç®— python3 # 0. æ—¥æœŸçš„ä¿®æ”¹ï¼ˆä¿®æ”¹å¹´æœˆæ—¶åˆ†ç§’ï¼‰ utcnow.replace(day=11) # =\u003e datetime.datetime(2020, 2, 11, 4, 0, 3, 537061) ä¿®æ”¹ day utcnow.replace(hour=11) # =\u003e datetime.datetime(2020, 2, 22, 11, 0, 3, 537061) ä¿®æ”¹ hour # 1. æ—¥æœŸä¸æ—¶é—´ date_utcnow = utcnow.date() # =\u003e datetime.date(2020, 2, 22) å¹´æœˆæ—¥ time_utcnow = utcnow.time() # =\u003e datetime.time(4, 0, 3, 537061) æ—¶åˆ†ç§’ # 2. è”ç»“æ—¶é—´å’Œæ—¥æœŸï¼ˆdate å’Œ time ä¸èƒ½ç”¨åŠ æ³•è”ç»“ï¼‰ dt.datetime.combine(date_utcnow, time_utcnow) # =\u003e datetime.datetime(2020, 2, 22, 4, 0, 3, 537061) # 3. æ—¥æœŸçš„è¿ç®— # 3.1 datetime ä¹‹é—´åªèƒ½è®¡ç®—æ—¶é—´å·®ï¼ˆå‡æ³•ï¼‰ï¼Œä¸èƒ½è¿›è¡Œå…¶ä»–è¿ç®— utcnow - time_1997 # =\u003e datetime.timedelta(days=8452, seconds=14403, microseconds=537061) # 3.2 ä½¿ç”¨ timedelta è¿›è¡Œæ—¶é—´çš„å¢å‡ days_step = dt.timedelta(days=1) # æ³¨æ„å‚æ•°æ˜¯å¤æ•°å½¢å¼ time_1997 + days_step # =\u003e datetime.datetime(1997, 1, 2, 0, 0) time_1997 - days_step # =\u003e datetime.datetime(1996, 12, 31, 0, 0) # 3.3 timedelta ä¹‹é—´ä¹Ÿå¯ä»¥è¿›è¡ŒåŠ å‡æ³• hours_step = dt.timedelta(hours=1) # =\u003e datetime.timedelta(seconds=3600) days_step + hours_step # =\u003e datetime.timedelta(days=1, seconds=3600) days_step - hours_step # =\u003e datetime.timedelta(seconds=82800) hours_step - days_step # =\u003e datetime.timedelta(days=-1, seconds=3600) # 3.4 timedelta è¿˜å¯ä»¥æŒ‰æ¯”ä¾‹å¢å‡ï¼ˆä¸æ•°å­—è¿›è¡Œä¹˜é™¤æ³•ï¼‰ hours_step * 2 # =\u003e datetime.timedelta(seconds=7200) days_step * -2 # =\u003e datetime.timedelta(days=-2) hours_step * 1.1 # =\u003e datetime.timedelta(seconds=3960) 3. æ—¶é—´æ—¥æœŸçš„æ ¼å¼åŒ–ä¸è§£æå…ˆä»‹ç»ä¸‹å¸¸ç”¨çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼š æ™®é€šæ ¼å¼ - â€˜%Y-%m-%d %H:%M:%Sâ€™ =\u003e â€˜2020-02-22 04:00:03â€™ ISO æ ¼å¼ - â€˜%Y-%m-%dT%H:%M:%S.%fZâ€™ =\u003e â€˜2020-02-22T04:00:03.537061Zâ€™ å¸¦æ—¶åŒºçš„æ ¼å¼ - â€˜%Y-%m-%dT%H:%M:%S%Zâ€™ =\u003e 2022-02-10T00:48:52UTC+08:00 éœ€è¦æ—¶é—´å¯¹è±¡è‡ªèº«æœ‰æ—¶åŒºå±æ€§æ‰è¡Œï¼å¦åˆ™æ ¼å¼åŒ–æ—¶ä¼šå¿½ç•¥ %Z å¦å¤–å†ä»‹ç»ä¸‹ Python ä¸¤ä¸ªæ—¶é—´æ ¼å¼åŒ–ä¸è§£æå‡½æ•°çš„å‘½åï¼š strftime: å³ string format time strptime: å³ string parse time python3 # 1. å°†æ—¶é—´æ ¼å¼åŒ–æˆå­—ç¬¦ä¸² # 1.1 å°† datetime æ ¼å¼åŒ–ä¸º iso æ ‡å‡†æ ¼å¼ utcnow.isoformat() # =\u003e '2020-02-22T04:00:03.537061' utcnow.strftime('%Y-%m-%dT%H:%M:%S.%fZ') # =\u003e '2020-02-22T04:00:03.537061Z' utcnow.date().strftime('%Y-%m-%dT%H:%M:%S.%fZ') # =\u003e '2020-02-22T00:00:00.000000Z' # 1.2 å°† time.struct_time æ ¼å¼åŒ–ä¸ºæ—¥æœŸå­—ç¬¦ä¸²ï¼ˆè²Œä¼¼ä¸æ”¯æŒ isoï¼Œå¯èƒ½æ˜¯ç²¾åº¦ä¸å¤Ÿï¼‰ time.strftime('%Y-%m-%dT%H:%M:%S', gm) # =\u003e '2020-02-22T04:00:03' # 1.3 å°† datetime æ ¼å¼åŒ–æˆæŒ‡å®šæ ¼å¼ utcnow.strftime('%Y-%m-%d %H:%M:%S') # =\u003e '2020-02-22 04:00:03' # 2. è§£ææ—¶é—´å­—ç¬¦ä¸² # 2.1 è§£æ iso æ ¼å¼çš„æ—¶é—´å­—ç¬¦ä¸²ï¼Œæ‰‹åŠ¨æŒ‡å®šæ ¼å¼ï¼ˆæ³¨æ„ %f åªå¯¹åº”å…­ä½å°æ•°ï¼Œå¯¹9ä½å°æ•°å®ƒæ— èƒ½ä¸ºåŠ›ã€‚ã€‚ï¼‰ dt.datetime.strptime('2020-02-22T04:00:03.537061Z', '%Y-%m-%dT%H:%M:%S.%fZ') # =\u003e datetime.datetime(2020, 2, 22, 4, 0, 3, 537061) # 2.2 è§£æ iso æ ¼å¼çš„æ—¶é—´å­—ç¬¦ä¸²(éœ€è¦ python 3.7+) dt.datetime.fromisoformat('2020-02-22T04:00:03.537061') # =\u003e datetime.datetime(2020, 2, 22, 4, 0, 3, 537061) dt.date.fromisoformat('2020-02-22') # =\u003e datetime.date(2020, 2, 22) dt.time.fromisoformat(\"04:00:03.537061\") # =\u003e datetime.time(4, 0, 3, 537061) # 2.3 è§£ææŒ‡å®šæ ¼å¼çš„å­—ç¬¦ä¸² dt.datetime.strptime('2020-02-22 04:00:03', '%Y-%m-%d %H:%M:%S') # =\u003e datetime.datetime(2020, 2, 22, 4, 0, 3) 4. æ—¶åŒºè½¬æ¢ä¸æ—¥æœŸæ ¼å¼åŒ– python3 # ä¸Šæµ·æ—¶åŒºï¼šä¸œå…«åŒº utc+8 tz_shanghai = dt.timezone(dt.timedelta(hours=8)) now_shanghai = dt.datetime.now(tz=tz_shanghai) now_shanghai.strftime('%Y-%m-%dT%H:%M:%S%Z') # =\u003e 2022-02-10T00:48:52UTC+08:00 ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:1:2","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#3-æ—¶é—´æ—¥æœŸçš„æ ¼å¼åŒ–ä¸è§£æ"},{"categories":["tech"],"content":" 2. æ—¶é—´æ—¥æœŸå¤„ç†python3 åœ¨æ—¶é—´æ—¥æœŸå¤„ç†æ–¹é¢ï¼Œæœ‰æ ‡å‡†åº“ datetime è·Ÿ calenderï¼Œä¹Ÿæœ‰æµè¡Œçš„ç¬¬ä¸‰æ–¹åº“ arrow è·Ÿ maya. æ ‡å‡†åº“ datetime æœ‰æ—¶å€™ä¸å¤ªæ–¹ä¾¿ï¼Œæ¯”å¦‚æ²¡æœ‰æä¾›è§£æ iso æ ¼å¼çš„å‡½æ•°ã€‚å¦å¤–å°±æ˜¯ç”¨æ ‡å‡†åº“æ—¶ï¼Œç»å¸¸éœ€è¦è‡ªå®šä¹‰æ ¼å¼åŒ–ä¸²ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œmaya å’Œ arrow è¿™ä¸¤ä¸ªç¬¬ä¸‰æ–¹åº“ä¼šæ–¹ä¾¿å¾ˆå¤šã€‚ ä¸è¿‡ç¬¬ä¸‰æ–¹åº“å¹¶ä¸æ˜¯ä»»ä½•æ—¶å€™éƒ½å¯ç”¨ï¼Œè¿™é‡Œåªä»‹ç»æ ‡å‡†åº“ datetime çš„ç”¨æ³•ï¼Œmaya/arrow è¯·è‡ªè¡ŒæŸ¥æ‰¾å®˜æ–¹æ–‡æ¡£å­¦ä¹ ã€‚ 1. è·å–å½“å‰æ—¶é—´ python3 import time import datetime as dt # 1. è·å–å½“å‰æ—¶é—´çš„æ—¶é—´æˆ³ time.time() # ç›´æ¥è°ƒç”¨ c apiï¼Œå› æ­¤é€Ÿåº¦å¾ˆå¿«: 1582315203.537061 utcnow = dt.datetime.utcnow() # å½“å‰çš„ä¸–ç•Œæ ‡å‡†æ—¶é—´: datetime.datetime(2020, 2, 22, 4, 0, 3, 537061) utcnow.timestamp() # å°†æ ‡å‡†æ—¶è½¬æ¢æˆæ—¶é—´æˆ³ï¼šdatetime =\u003e 1582315203.537061 # 2. UTC ä¸–ç•Œæ ‡å‡†æ—¶é—´ time.gmtime() #è¾“å‡ºä¸ºï¼š time.struct_time(tm_year=2019, tm_mon=6, tm_mday=23, # tm_hour=3, tm_min=49, tm_sec=17, # tm_wday=6, tm_yday=174, tm_isdst=0) # è¿™å®é™…ä¸Šæ˜¯ä¸€ä¸ªå‘½åå…ƒç»„ # 3. æ„å»ºä¸€ä¸ªæŒ‡å®šçš„ datetime å®ä¾‹ time_1997 = dt.datetime(year=1997, month=1, day=1) # =\u003e datetime.datetime(1997, 1, 1, 0, 0) dt.datetime(year=1997, month=1, day=1, minute=11) # =\u003e datetime.datetime(1997, 1, 1, 0, 11) 2. æ—¶é—´æ—¥æœŸçš„ä¿®æ”¹ä¸è¿ç®— python3 # 0. æ—¥æœŸçš„ä¿®æ”¹ï¼ˆä¿®æ”¹å¹´æœˆæ—¶åˆ†ç§’ï¼‰ utcnow.replace(day=11) # =\u003e datetime.datetime(2020, 2, 11, 4, 0, 3, 537061) ä¿®æ”¹ day utcnow.replace(hour=11) # =\u003e datetime.datetime(2020, 2, 22, 11, 0, 3, 537061) ä¿®æ”¹ hour # 1. æ—¥æœŸä¸æ—¶é—´ date_utcnow = utcnow.date() # =\u003e datetime.date(2020, 2, 22) å¹´æœˆæ—¥ time_utcnow = utcnow.time() # =\u003e datetime.time(4, 0, 3, 537061) æ—¶åˆ†ç§’ # 2. è”ç»“æ—¶é—´å’Œæ—¥æœŸï¼ˆdate å’Œ time ä¸èƒ½ç”¨åŠ æ³•è”ç»“ï¼‰ dt.datetime.combine(date_utcnow, time_utcnow) # =\u003e datetime.datetime(2020, 2, 22, 4, 0, 3, 537061) # 3. æ—¥æœŸçš„è¿ç®— # 3.1 datetime ä¹‹é—´åªèƒ½è®¡ç®—æ—¶é—´å·®ï¼ˆå‡æ³•ï¼‰ï¼Œä¸èƒ½è¿›è¡Œå…¶ä»–è¿ç®— utcnow - time_1997 # =\u003e datetime.timedelta(days=8452, seconds=14403, microseconds=537061) # 3.2 ä½¿ç”¨ timedelta è¿›è¡Œæ—¶é—´çš„å¢å‡ days_step = dt.timedelta(days=1) # æ³¨æ„å‚æ•°æ˜¯å¤æ•°å½¢å¼ time_1997 + days_step # =\u003e datetime.datetime(1997, 1, 2, 0, 0) time_1997 - days_step # =\u003e datetime.datetime(1996, 12, 31, 0, 0) # 3.3 timedelta ä¹‹é—´ä¹Ÿå¯ä»¥è¿›è¡ŒåŠ å‡æ³• hours_step = dt.timedelta(hours=1) # =\u003e datetime.timedelta(seconds=3600) days_step + hours_step # =\u003e datetime.timedelta(days=1, seconds=3600) days_step - hours_step # =\u003e datetime.timedelta(seconds=82800) hours_step - days_step # =\u003e datetime.timedelta(days=-1, seconds=3600) # 3.4 timedelta è¿˜å¯ä»¥æŒ‰æ¯”ä¾‹å¢å‡ï¼ˆä¸æ•°å­—è¿›è¡Œä¹˜é™¤æ³•ï¼‰ hours_step * 2 # =\u003e datetime.timedelta(seconds=7200) days_step * -2 # =\u003e datetime.timedelta(days=-2) hours_step * 1.1 # =\u003e datetime.timedelta(seconds=3960) 3. æ—¶é—´æ—¥æœŸçš„æ ¼å¼åŒ–ä¸è§£æå…ˆä»‹ç»ä¸‹å¸¸ç”¨çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼š æ™®é€šæ ¼å¼ - â€˜%Y-%m-%d %H:%M:%Sâ€™ =\u003e â€˜2020-02-22 04:00:03â€™ ISO æ ¼å¼ - â€˜%Y-%m-%dT%H:%M:%S.%fZâ€™ =\u003e â€˜2020-02-22T04:00:03.537061Zâ€™ å¸¦æ—¶åŒºçš„æ ¼å¼ - â€˜%Y-%m-%dT%H:%M:%S%Zâ€™ =\u003e 2022-02-10T00:48:52UTC+08:00 éœ€è¦æ—¶é—´å¯¹è±¡è‡ªèº«æœ‰æ—¶åŒºå±æ€§æ‰è¡Œï¼å¦åˆ™æ ¼å¼åŒ–æ—¶ä¼šå¿½ç•¥ %Z å¦å¤–å†ä»‹ç»ä¸‹ Python ä¸¤ä¸ªæ—¶é—´æ ¼å¼åŒ–ä¸è§£æå‡½æ•°çš„å‘½åï¼š strftime: å³ string format time strptime: å³ string parse time python3 # 1. å°†æ—¶é—´æ ¼å¼åŒ–æˆå­—ç¬¦ä¸² # 1.1 å°† datetime æ ¼å¼åŒ–ä¸º iso æ ‡å‡†æ ¼å¼ utcnow.isoformat() # =\u003e '2020-02-22T04:00:03.537061' utcnow.strftime('%Y-%m-%dT%H:%M:%S.%fZ') # =\u003e '2020-02-22T04:00:03.537061Z' utcnow.date().strftime('%Y-%m-%dT%H:%M:%S.%fZ') # =\u003e '2020-02-22T00:00:00.000000Z' # 1.2 å°† time.struct_time æ ¼å¼åŒ–ä¸ºæ—¥æœŸå­—ç¬¦ä¸²ï¼ˆè²Œä¼¼ä¸æ”¯æŒ isoï¼Œå¯èƒ½æ˜¯ç²¾åº¦ä¸å¤Ÿï¼‰ time.strftime('%Y-%m-%dT%H:%M:%S', gm) # =\u003e '2020-02-22T04:00:03' # 1.3 å°† datetime æ ¼å¼åŒ–æˆæŒ‡å®šæ ¼å¼ utcnow.strftime('%Y-%m-%d %H:%M:%S') # =\u003e '2020-02-22 04:00:03' # 2. è§£ææ—¶é—´å­—ç¬¦ä¸² # 2.1 è§£æ iso æ ¼å¼çš„æ—¶é—´å­—ç¬¦ä¸²ï¼Œæ‰‹åŠ¨æŒ‡å®šæ ¼å¼ï¼ˆæ³¨æ„ %f åªå¯¹åº”å…­ä½å°æ•°ï¼Œå¯¹9ä½å°æ•°å®ƒæ— èƒ½ä¸ºåŠ›ã€‚ã€‚ï¼‰ dt.datetime.strptime('2020-02-22T04:00:03.537061Z', '%Y-%m-%dT%H:%M:%S.%fZ') # =\u003e datetime.datetime(2020, 2, 22, 4, 0, 3, 537061) # 2.2 è§£æ iso æ ¼å¼çš„æ—¶é—´å­—ç¬¦ä¸²(éœ€è¦ python 3.7+) dt.datetime.fromisoformat('2020-02-22T04:00:03.537061') # =\u003e datetime.datetime(2020, 2, 22, 4, 0, 3, 537061) dt.date.fromisoformat('2020-02-22') # =\u003e datetime.date(2020, 2, 22) dt.time.fromisoformat(\"04:00:03.537061\") # =\u003e datetime.time(4, 0, 3, 537061) # 2.3 è§£ææŒ‡å®šæ ¼å¼çš„å­—ç¬¦ä¸² dt.datetime.strptime('2020-02-22 04:00:03', '%Y-%m-%d %H:%M:%S') # =\u003e datetime.datetime(2020, 2, 22, 4, 0, 3) 4. æ—¶åŒºè½¬æ¢ä¸æ—¥æœŸæ ¼å¼åŒ– python3 # ä¸Šæµ·æ—¶åŒºï¼šä¸œå…«åŒº utc+8 tz_shanghai = dt.timezone(dt.timedelta(hours=8)) now_shanghai = dt.datetime.now(tz=tz_shanghai) now_shanghai.strftime('%Y-%m-%dT%H:%M:%S%Z') # =\u003e 2022-02-10T00:48:52UTC+08:00 ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:1:2","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#4-æ—¶åŒºè½¬æ¢ä¸æ—¥æœŸæ ¼å¼åŒ–"},{"categories":["tech"],"content":" 3. æ’åºå¸¸ç”¨åº“ - operatoroperator æ¨¡å—åŒ…å«å››ç§ç±»å‹çš„æ–¹æ³•ï¼š 1. operator.itemgetterç»å¸¸è¢«ç”¨äº sorted/max/mix/itertools.groupby ç­‰ ä½¿ç”¨æ–¹æ³•ï¼š python3 # itemgetter f = itemgetter(2) f(r) # return r[2] # è¿˜èƒ½ä¸€æ¬¡è·å–å¤šä¸ªå€¼ï¼Œåƒ numpy é‚£æ ·ç´¢å¼• f2 = itemgetter(2,4,5) f2(r) # return (r[2], r[4], r[5]) # æˆ–è€…ä½¿ç”¨ slice åˆ‡ç‰‡ s = itemgetter(slice(2, None)) s[r] # return r[2:] # dict ç´¢å¼•ä¹Ÿèƒ½ç”¨ d = itemgetter('rank', 'name') d[r] # return d['rank'], d['name'] ç”¨é€”ï¼š python3 # ç”¨äºæŒ‡å®šç”¨äºæ¯”è¾ƒå¤§å°çš„å±æ€§ key = itemgetter(1) sorted(iterable, key=key) # ä½¿ç”¨ iterable[1] å¯¹ iterable è¿›è¡Œæ’åº max(iterable, key=key) # æ‰¾å‡ºæœ€å¤§çš„å…ƒç´ ï¼Œä½¿ç”¨ iterable[1] åšæ¯”è¾ƒ # ç”¨äºé«˜çº§åˆ‡ç‰‡ï¼ˆæ¯”å¦‚åƒ numpy é‚£æ ·çš„ï¼ŒæŒ‡å®šåªè·å–æŸå‡ åˆ—ï¼‰ s = itemgetter(1,3,4) matrix = [[0,1,2,3,4], [1,2,3,4,5]] map(s, matrix) # list åå¾—åˆ° [(1, 3, 4), (2,4,5)] 2. operator.attrgetterå¯ç”¨äºåŠ¨æ€è·å–å¯¹è±¡çš„å±æ€§ï¼Œä¸ç›´æ¥ç”¨ getattr() ä¸åŒçš„æ˜¯ï¼Œå®ƒå¯ä»¥åµŒå¥—è®¿é—®å±æ€§ã€‚ Python3 # åµŒå¥—è®¿é—®å±æ€§ att = attrgetter(\"a.b.c\") att(obj) # return obj.a.b.c # å’Œ itemgetter ä¸€æ ·ï¼Œä¹Ÿå¯ä»¥ä¸€æ¬¡è·å–å¤šä¸ªå±æ€§ att = attrgetter(\"a.b.c\", \"x.y\") att(obj) # return (obj.a.b.c, obj.x.y) # ä¸åµŒå¥—çš„è¯ï¼Œç”¨ getattr å°±è¡Œ getattr(obj, \"a\") # return obj.a è¿™é‡Œå¯ä»¥å›é¡¾ä¸€ä¸‹ç±»çš„ä¸¤ä¸ªé­”æ³•å‡½æ•°ï¼š __getattr__: å½“è¢«è®¿é—®çš„å±æ€§ä¸å­˜åœ¨æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œå®ƒçš„è¿”å›å€¼ä¼šæˆä¸ºå¯¹è±¡çš„è¯¥å±æ€§ã€‚ ç”¨äºåŠ¨æ€ç”Ÿæˆå®ä¾‹çš„å±æ€§/å‡½æ•° __getattribute__: ä¸ __getattr__ å”¯ä¸€çš„å·®åˆ«åœ¨äºï¼Œè®¿é—®å¯¹è±¡çš„ä»»ä½•å±æ€§ï¼Œéƒ½ä¼šç›´æ¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œä¸ç®¡å±æ€§å­˜ä¸å­˜åœ¨ã€‚ 3. operator.methodcallerå¯ç”¨äºè°ƒç”¨å‡½æ•°ï¼Œå®ƒå’Œ attrgetter å¾ˆåƒï¼Œå·®åˆ«åœ¨äº attrgetter åªæ˜¯è¿”å›æŒ‡å®šçš„å±æ€§ï¼Œè€Œ methodcaller ä¼šç›´æ¥æŠŠæŒ‡å®šçš„å±æ€§å½“æˆå‡½æ•°è°ƒç”¨ï¼Œç„¶åè¿”å›ç»“æœã€‚ ä¸¾ä¾‹ python3 f = methodcaller('name', 'foo', bar=1) f(b) # returns b.name('foo', bar=1) 4. å„ç§æ“ä½œç¬¦å¯¹åº”çš„å‡½æ•°operator.addã€operator.subã€operator.mulã€operator.div ç­‰ç­‰ï¼Œå‡½æ•°å¼ç¼–ç¨‹æœ‰æ—¶éœ€è¦ç”¨åˆ°ã€‚ ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:1:3","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#3-æ’åºå¸¸ç”¨åº“---operator"},{"categories":["tech"],"content":" 3. æ’åºå¸¸ç”¨åº“ - operatoroperator æ¨¡å—åŒ…å«å››ç§ç±»å‹çš„æ–¹æ³•ï¼š 1. operator.itemgetterç»å¸¸è¢«ç”¨äº sorted/max/mix/itertools.groupby ç­‰ ä½¿ç”¨æ–¹æ³•ï¼š python3 # itemgetter f = itemgetter(2) f(r) # return r[2] # è¿˜èƒ½ä¸€æ¬¡è·å–å¤šä¸ªå€¼ï¼Œåƒ numpy é‚£æ ·ç´¢å¼• f2 = itemgetter(2,4,5) f2(r) # return (r[2], r[4], r[5]) # æˆ–è€…ä½¿ç”¨ slice åˆ‡ç‰‡ s = itemgetter(slice(2, None)) s[r] # return r[2:] # dict ç´¢å¼•ä¹Ÿèƒ½ç”¨ d = itemgetter('rank', 'name') d[r] # return d['rank'], d['name'] ç”¨é€”ï¼š python3 # ç”¨äºæŒ‡å®šç”¨äºæ¯”è¾ƒå¤§å°çš„å±æ€§ key = itemgetter(1) sorted(iterable, key=key) # ä½¿ç”¨ iterable[1] å¯¹ iterable è¿›è¡Œæ’åº max(iterable, key=key) # æ‰¾å‡ºæœ€å¤§çš„å…ƒç´ ï¼Œä½¿ç”¨ iterable[1] åšæ¯”è¾ƒ # ç”¨äºé«˜çº§åˆ‡ç‰‡ï¼ˆæ¯”å¦‚åƒ numpy é‚£æ ·çš„ï¼ŒæŒ‡å®šåªè·å–æŸå‡ åˆ—ï¼‰ s = itemgetter(1,3,4) matrix = [[0,1,2,3,4], [1,2,3,4,5]] map(s, matrix) # list åå¾—åˆ° [(1, 3, 4), (2,4,5)] 2. operator.attrgetterå¯ç”¨äºåŠ¨æ€è·å–å¯¹è±¡çš„å±æ€§ï¼Œä¸ç›´æ¥ç”¨ getattr() ä¸åŒçš„æ˜¯ï¼Œå®ƒå¯ä»¥åµŒå¥—è®¿é—®å±æ€§ã€‚ Python3 # åµŒå¥—è®¿é—®å±æ€§ att = attrgetter(\"a.b.c\") att(obj) # return obj.a.b.c # å’Œ itemgetter ä¸€æ ·ï¼Œä¹Ÿå¯ä»¥ä¸€æ¬¡è·å–å¤šä¸ªå±æ€§ att = attrgetter(\"a.b.c\", \"x.y\") att(obj) # return (obj.a.b.c, obj.x.y) # ä¸åµŒå¥—çš„è¯ï¼Œç”¨ getattr å°±è¡Œ getattr(obj, \"a\") # return obj.a è¿™é‡Œå¯ä»¥å›é¡¾ä¸€ä¸‹ç±»çš„ä¸¤ä¸ªé­”æ³•å‡½æ•°ï¼š __getattr__: å½“è¢«è®¿é—®çš„å±æ€§ä¸å­˜åœ¨æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œå®ƒçš„è¿”å›å€¼ä¼šæˆä¸ºå¯¹è±¡çš„è¯¥å±æ€§ã€‚ ç”¨äºåŠ¨æ€ç”Ÿæˆå®ä¾‹çš„å±æ€§/å‡½æ•° __getattribute__: ä¸ __getattr__ å”¯ä¸€çš„å·®åˆ«åœ¨äºï¼Œè®¿é—®å¯¹è±¡çš„ä»»ä½•å±æ€§ï¼Œéƒ½ä¼šç›´æ¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œä¸ç®¡å±æ€§å­˜ä¸å­˜åœ¨ã€‚ 3. operator.methodcallerå¯ç”¨äºè°ƒç”¨å‡½æ•°ï¼Œå®ƒå’Œ attrgetter å¾ˆåƒï¼Œå·®åˆ«åœ¨äº attrgetter åªæ˜¯è¿”å›æŒ‡å®šçš„å±æ€§ï¼Œè€Œ methodcaller ä¼šç›´æ¥æŠŠæŒ‡å®šçš„å±æ€§å½“æˆå‡½æ•°è°ƒç”¨ï¼Œç„¶åè¿”å›ç»“æœã€‚ ä¸¾ä¾‹ python3 f = methodcaller('name', 'foo', bar=1) f(b) # returns b.name('foo', bar=1) 4. å„ç§æ“ä½œç¬¦å¯¹åº”çš„å‡½æ•°operator.addã€operator.subã€operator.mulã€operator.div ç­‰ç­‰ï¼Œå‡½æ•°å¼ç¼–ç¨‹æœ‰æ—¶éœ€è¦ç”¨åˆ°ã€‚ ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:1:3","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#1-operatoritemgetter"},{"categories":["tech"],"content":" 3. æ’åºå¸¸ç”¨åº“ - operatoroperator æ¨¡å—åŒ…å«å››ç§ç±»å‹çš„æ–¹æ³•ï¼š 1. operator.itemgetterç»å¸¸è¢«ç”¨äº sorted/max/mix/itertools.groupby ç­‰ ä½¿ç”¨æ–¹æ³•ï¼š python3 # itemgetter f = itemgetter(2) f(r) # return r[2] # è¿˜èƒ½ä¸€æ¬¡è·å–å¤šä¸ªå€¼ï¼Œåƒ numpy é‚£æ ·ç´¢å¼• f2 = itemgetter(2,4,5) f2(r) # return (r[2], r[4], r[5]) # æˆ–è€…ä½¿ç”¨ slice åˆ‡ç‰‡ s = itemgetter(slice(2, None)) s[r] # return r[2:] # dict ç´¢å¼•ä¹Ÿèƒ½ç”¨ d = itemgetter('rank', 'name') d[r] # return d['rank'], d['name'] ç”¨é€”ï¼š python3 # ç”¨äºæŒ‡å®šç”¨äºæ¯”è¾ƒå¤§å°çš„å±æ€§ key = itemgetter(1) sorted(iterable, key=key) # ä½¿ç”¨ iterable[1] å¯¹ iterable è¿›è¡Œæ’åº max(iterable, key=key) # æ‰¾å‡ºæœ€å¤§çš„å…ƒç´ ï¼Œä½¿ç”¨ iterable[1] åšæ¯”è¾ƒ # ç”¨äºé«˜çº§åˆ‡ç‰‡ï¼ˆæ¯”å¦‚åƒ numpy é‚£æ ·çš„ï¼ŒæŒ‡å®šåªè·å–æŸå‡ åˆ—ï¼‰ s = itemgetter(1,3,4) matrix = [[0,1,2,3,4], [1,2,3,4,5]] map(s, matrix) # list åå¾—åˆ° [(1, 3, 4), (2,4,5)] 2. operator.attrgetterå¯ç”¨äºåŠ¨æ€è·å–å¯¹è±¡çš„å±æ€§ï¼Œä¸ç›´æ¥ç”¨ getattr() ä¸åŒçš„æ˜¯ï¼Œå®ƒå¯ä»¥åµŒå¥—è®¿é—®å±æ€§ã€‚ Python3 # åµŒå¥—è®¿é—®å±æ€§ att = attrgetter(\"a.b.c\") att(obj) # return obj.a.b.c # å’Œ itemgetter ä¸€æ ·ï¼Œä¹Ÿå¯ä»¥ä¸€æ¬¡è·å–å¤šä¸ªå±æ€§ att = attrgetter(\"a.b.c\", \"x.y\") att(obj) # return (obj.a.b.c, obj.x.y) # ä¸åµŒå¥—çš„è¯ï¼Œç”¨ getattr å°±è¡Œ getattr(obj, \"a\") # return obj.a è¿™é‡Œå¯ä»¥å›é¡¾ä¸€ä¸‹ç±»çš„ä¸¤ä¸ªé­”æ³•å‡½æ•°ï¼š __getattr__: å½“è¢«è®¿é—®çš„å±æ€§ä¸å­˜åœ¨æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œå®ƒçš„è¿”å›å€¼ä¼šæˆä¸ºå¯¹è±¡çš„è¯¥å±æ€§ã€‚ ç”¨äºåŠ¨æ€ç”Ÿæˆå®ä¾‹çš„å±æ€§/å‡½æ•° __getattribute__: ä¸ __getattr__ å”¯ä¸€çš„å·®åˆ«åœ¨äºï¼Œè®¿é—®å¯¹è±¡çš„ä»»ä½•å±æ€§ï¼Œéƒ½ä¼šç›´æ¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œä¸ç®¡å±æ€§å­˜ä¸å­˜åœ¨ã€‚ 3. operator.methodcallerå¯ç”¨äºè°ƒç”¨å‡½æ•°ï¼Œå®ƒå’Œ attrgetter å¾ˆåƒï¼Œå·®åˆ«åœ¨äº attrgetter åªæ˜¯è¿”å›æŒ‡å®šçš„å±æ€§ï¼Œè€Œ methodcaller ä¼šç›´æ¥æŠŠæŒ‡å®šçš„å±æ€§å½“æˆå‡½æ•°è°ƒç”¨ï¼Œç„¶åè¿”å›ç»“æœã€‚ ä¸¾ä¾‹ python3 f = methodcaller('name', 'foo', bar=1) f(b) # returns b.name('foo', bar=1) 4. å„ç§æ“ä½œç¬¦å¯¹åº”çš„å‡½æ•°operator.addã€operator.subã€operator.mulã€operator.div ç­‰ç­‰ï¼Œå‡½æ•°å¼ç¼–ç¨‹æœ‰æ—¶éœ€è¦ç”¨åˆ°ã€‚ ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:1:3","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#2-operatorattrgetter"},{"categories":["tech"],"content":" 3. æ’åºå¸¸ç”¨åº“ - operatoroperator æ¨¡å—åŒ…å«å››ç§ç±»å‹çš„æ–¹æ³•ï¼š 1. operator.itemgetterç»å¸¸è¢«ç”¨äº sorted/max/mix/itertools.groupby ç­‰ ä½¿ç”¨æ–¹æ³•ï¼š python3 # itemgetter f = itemgetter(2) f(r) # return r[2] # è¿˜èƒ½ä¸€æ¬¡è·å–å¤šä¸ªå€¼ï¼Œåƒ numpy é‚£æ ·ç´¢å¼• f2 = itemgetter(2,4,5) f2(r) # return (r[2], r[4], r[5]) # æˆ–è€…ä½¿ç”¨ slice åˆ‡ç‰‡ s = itemgetter(slice(2, None)) s[r] # return r[2:] # dict ç´¢å¼•ä¹Ÿèƒ½ç”¨ d = itemgetter('rank', 'name') d[r] # return d['rank'], d['name'] ç”¨é€”ï¼š python3 # ç”¨äºæŒ‡å®šç”¨äºæ¯”è¾ƒå¤§å°çš„å±æ€§ key = itemgetter(1) sorted(iterable, key=key) # ä½¿ç”¨ iterable[1] å¯¹ iterable è¿›è¡Œæ’åº max(iterable, key=key) # æ‰¾å‡ºæœ€å¤§çš„å…ƒç´ ï¼Œä½¿ç”¨ iterable[1] åšæ¯”è¾ƒ # ç”¨äºé«˜çº§åˆ‡ç‰‡ï¼ˆæ¯”å¦‚åƒ numpy é‚£æ ·çš„ï¼ŒæŒ‡å®šåªè·å–æŸå‡ åˆ—ï¼‰ s = itemgetter(1,3,4) matrix = [[0,1,2,3,4], [1,2,3,4,5]] map(s, matrix) # list åå¾—åˆ° [(1, 3, 4), (2,4,5)] 2. operator.attrgetterå¯ç”¨äºåŠ¨æ€è·å–å¯¹è±¡çš„å±æ€§ï¼Œä¸ç›´æ¥ç”¨ getattr() ä¸åŒçš„æ˜¯ï¼Œå®ƒå¯ä»¥åµŒå¥—è®¿é—®å±æ€§ã€‚ Python3 # åµŒå¥—è®¿é—®å±æ€§ att = attrgetter(\"a.b.c\") att(obj) # return obj.a.b.c # å’Œ itemgetter ä¸€æ ·ï¼Œä¹Ÿå¯ä»¥ä¸€æ¬¡è·å–å¤šä¸ªå±æ€§ att = attrgetter(\"a.b.c\", \"x.y\") att(obj) # return (obj.a.b.c, obj.x.y) # ä¸åµŒå¥—çš„è¯ï¼Œç”¨ getattr å°±è¡Œ getattr(obj, \"a\") # return obj.a è¿™é‡Œå¯ä»¥å›é¡¾ä¸€ä¸‹ç±»çš„ä¸¤ä¸ªé­”æ³•å‡½æ•°ï¼š __getattr__: å½“è¢«è®¿é—®çš„å±æ€§ä¸å­˜åœ¨æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œå®ƒçš„è¿”å›å€¼ä¼šæˆä¸ºå¯¹è±¡çš„è¯¥å±æ€§ã€‚ ç”¨äºåŠ¨æ€ç”Ÿæˆå®ä¾‹çš„å±æ€§/å‡½æ•° __getattribute__: ä¸ __getattr__ å”¯ä¸€çš„å·®åˆ«åœ¨äºï¼Œè®¿é—®å¯¹è±¡çš„ä»»ä½•å±æ€§ï¼Œéƒ½ä¼šç›´æ¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œä¸ç®¡å±æ€§å­˜ä¸å­˜åœ¨ã€‚ 3. operator.methodcallerå¯ç”¨äºè°ƒç”¨å‡½æ•°ï¼Œå®ƒå’Œ attrgetter å¾ˆåƒï¼Œå·®åˆ«åœ¨äº attrgetter åªæ˜¯è¿”å›æŒ‡å®šçš„å±æ€§ï¼Œè€Œ methodcaller ä¼šç›´æ¥æŠŠæŒ‡å®šçš„å±æ€§å½“æˆå‡½æ•°è°ƒç”¨ï¼Œç„¶åè¿”å›ç»“æœã€‚ ä¸¾ä¾‹ python3 f = methodcaller('name', 'foo', bar=1) f(b) # returns b.name('foo', bar=1) 4. å„ç§æ“ä½œç¬¦å¯¹åº”çš„å‡½æ•°operator.addã€operator.subã€operator.mulã€operator.div ç­‰ç­‰ï¼Œå‡½æ•°å¼ç¼–ç¨‹æœ‰æ—¶éœ€è¦ç”¨åˆ°ã€‚ ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:1:3","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#3-operatormethodcaller"},{"categories":["tech"],"content":" 3. æ’åºå¸¸ç”¨åº“ - operatoroperator æ¨¡å—åŒ…å«å››ç§ç±»å‹çš„æ–¹æ³•ï¼š 1. operator.itemgetterç»å¸¸è¢«ç”¨äº sorted/max/mix/itertools.groupby ç­‰ ä½¿ç”¨æ–¹æ³•ï¼š python3 # itemgetter f = itemgetter(2) f(r) # return r[2] # è¿˜èƒ½ä¸€æ¬¡è·å–å¤šä¸ªå€¼ï¼Œåƒ numpy é‚£æ ·ç´¢å¼• f2 = itemgetter(2,4,5) f2(r) # return (r[2], r[4], r[5]) # æˆ–è€…ä½¿ç”¨ slice åˆ‡ç‰‡ s = itemgetter(slice(2, None)) s[r] # return r[2:] # dict ç´¢å¼•ä¹Ÿèƒ½ç”¨ d = itemgetter('rank', 'name') d[r] # return d['rank'], d['name'] ç”¨é€”ï¼š python3 # ç”¨äºæŒ‡å®šç”¨äºæ¯”è¾ƒå¤§å°çš„å±æ€§ key = itemgetter(1) sorted(iterable, key=key) # ä½¿ç”¨ iterable[1] å¯¹ iterable è¿›è¡Œæ’åº max(iterable, key=key) # æ‰¾å‡ºæœ€å¤§çš„å…ƒç´ ï¼Œä½¿ç”¨ iterable[1] åšæ¯”è¾ƒ # ç”¨äºé«˜çº§åˆ‡ç‰‡ï¼ˆæ¯”å¦‚åƒ numpy é‚£æ ·çš„ï¼ŒæŒ‡å®šåªè·å–æŸå‡ åˆ—ï¼‰ s = itemgetter(1,3,4) matrix = [[0,1,2,3,4], [1,2,3,4,5]] map(s, matrix) # list åå¾—åˆ° [(1, 3, 4), (2,4,5)] 2. operator.attrgetterå¯ç”¨äºåŠ¨æ€è·å–å¯¹è±¡çš„å±æ€§ï¼Œä¸ç›´æ¥ç”¨ getattr() ä¸åŒçš„æ˜¯ï¼Œå®ƒå¯ä»¥åµŒå¥—è®¿é—®å±æ€§ã€‚ Python3 # åµŒå¥—è®¿é—®å±æ€§ att = attrgetter(\"a.b.c\") att(obj) # return obj.a.b.c # å’Œ itemgetter ä¸€æ ·ï¼Œä¹Ÿå¯ä»¥ä¸€æ¬¡è·å–å¤šä¸ªå±æ€§ att = attrgetter(\"a.b.c\", \"x.y\") att(obj) # return (obj.a.b.c, obj.x.y) # ä¸åµŒå¥—çš„è¯ï¼Œç”¨ getattr å°±è¡Œ getattr(obj, \"a\") # return obj.a è¿™é‡Œå¯ä»¥å›é¡¾ä¸€ä¸‹ç±»çš„ä¸¤ä¸ªé­”æ³•å‡½æ•°ï¼š __getattr__: å½“è¢«è®¿é—®çš„å±æ€§ä¸å­˜åœ¨æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œå®ƒçš„è¿”å›å€¼ä¼šæˆä¸ºå¯¹è±¡çš„è¯¥å±æ€§ã€‚ ç”¨äºåŠ¨æ€ç”Ÿæˆå®ä¾‹çš„å±æ€§/å‡½æ•° __getattribute__: ä¸ __getattr__ å”¯ä¸€çš„å·®åˆ«åœ¨äºï¼Œè®¿é—®å¯¹è±¡çš„ä»»ä½•å±æ€§ï¼Œéƒ½ä¼šç›´æ¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œä¸ç®¡å±æ€§å­˜ä¸å­˜åœ¨ã€‚ 3. operator.methodcallerå¯ç”¨äºè°ƒç”¨å‡½æ•°ï¼Œå®ƒå’Œ attrgetter å¾ˆåƒï¼Œå·®åˆ«åœ¨äº attrgetter åªæ˜¯è¿”å›æŒ‡å®šçš„å±æ€§ï¼Œè€Œ methodcaller ä¼šç›´æ¥æŠŠæŒ‡å®šçš„å±æ€§å½“æˆå‡½æ•°è°ƒç”¨ï¼Œç„¶åè¿”å›ç»“æœã€‚ ä¸¾ä¾‹ python3 f = methodcaller('name', 'foo', bar=1) f(b) # returns b.name('foo', bar=1) 4. å„ç§æ“ä½œç¬¦å¯¹åº”çš„å‡½æ•°operator.addã€operator.subã€operator.mulã€operator.div ç­‰ç­‰ï¼Œå‡½æ•°å¼ç¼–ç¨‹æœ‰æ—¶éœ€è¦ç”¨åˆ°ã€‚ ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:1:3","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#4-å„ç§æ“ä½œç¬¦å¯¹åº”çš„å‡½æ•°"},{"categories":["tech"],"content":" 4. itertoolsitertools æä¾›äº†è®¸å¤šé’ˆå¯¹å¯è¿­ä»£å¯¹è±¡çš„å®ç”¨å‡½æ•° æ–¹æ³•å¾ˆå¤šï¼ŒåŸºæœ¬ä¸å¯èƒ½ä¸€æ¬¡å…¨è®°ä½ã€‚è¿˜æ˜¯è¦ç”¨åˆ°æ—¶å¤šæŸ¥å§ã€‚å¤§è‡´è®°ä½æœ‰æä¾›å“ªäº›åŠŸèƒ½ï¼Œéœ€è¦ç”¨åˆ°æ—¶èƒ½æƒ³èµ·å¯ä»¥æŸ¥è¿™ä¸ªæ¨¡å—å°±è¡Œã€‚ 1. æ— é™è¿­ä»£å™¨ count(start=0, step=1): ä» start å¼€å§‹ï¼Œæ¯æ¬¡è¿­ä»£æ—¶ï¼Œè¿”å›å€¼éƒ½åŠ ä¸€ä¸ª step é»˜è®¤è¿”å›åºåˆ—ä¸º 0 1 2 3â€¦ cycle(iterable): ä¸æ–­å¾ªç¯è¿­ä»£ iterable repeat(element, times=None): é»˜è®¤æ°¸è¿œè¿”å› elementã€‚ï¼ˆå¦‚æœ times ä¸ä¸º Noneï¼Œå°±è¿­ä»£ times åç»“æŸï¼‰ 2. æ’åˆ—ç»„åˆè¿­ä»£å™¨ product(p1, p2, â€¦, repeat=1)ï¼šp1, p2â€¦ çš„å…ƒç´ çš„ç¬›å¡å°”ç§¯ï¼Œç›¸å½“äºå¤šå±‚ for å¾ªç¯ repeat æŒ‡å‚æ•°é‡å¤æ¬¡æ•°ï¼Œæ¯”å¦‚ shell \u003e\u003e\u003e from itertools import product \u003e\u003e\u003e r = product([1, 2], [3, 4], [5, 6]) # é‡å¤ä¸€æ¬¡ï¼Œä¹Ÿå°±æ˜¯ (p1, p2, p3) çš„ç¬›å¡å°”ç§¯ \u003e\u003e\u003e pprint(list(r)) [(1, 3, 5), (1, 3, 6), (1, 4, 5), (1, 4, 6), (2, 3, 5), (2, 3, 6), (2, 4, 5), (2, 4, 6)] \u003e\u003e\u003e r2 = product([1, 2], [3, 4], [5, 6], repeat=2) # é‡å¤ä¸¤æ¬¡ï¼Œå³ (p1, p2, p3, p1, p2, p3) çš„ç¬›å¡å°”ç§¯ \u003e\u003e\u003e pprint(list(r2)) [(1, 3, 5, 1, 3, 5), (1, 3, 5, 1, 3, 6), (1, 3, 5, 1, 4, 5), (1, 3, 5, 1, 4, 6), (1, 3, 5, 2, 3, 5), ... permutations(p[, r])ï¼šp ä¸­å…ƒç´ ï¼Œé•¿åº¦ä¸º r çš„æ‰€æœ‰å¯èƒ½çš„æ’åˆ—ã€‚ç›¸å½“äº product å»é‡åçš„ç»“æœã€‚ combinations(p, r)ï¼šæ—¢ç„¶æœ‰æ’åˆ—ï¼Œå½“ç„¶å°±æœ‰ç»„åˆäº†ã€‚ 3. å…¶ä»– zip_longest(*iterables, fillvalue=None)ï¼šå’Œ zip çš„å·®åˆ«åœ¨äºï¼Œç¼ºå¤±çš„å…ƒç´ å®ƒä¼šç”¨ fillvalue è¡¥å…¨ï¼Œè€Œä¸æ˜¯ç›´æ¥ç»“æŸã€‚ takewhile() dropwhile() groupby() ç­‰ç­‰ç­‰ï¼Œç”¨å¾—åˆ°çš„æ—¶å€™å†æŸ¥äº†ã€‚ã€‚ã€‚ ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:1:4","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#4-itertools"},{"categories":["tech"],"content":" 4. itertoolsitertools æä¾›äº†è®¸å¤šé’ˆå¯¹å¯è¿­ä»£å¯¹è±¡çš„å®ç”¨å‡½æ•° æ–¹æ³•å¾ˆå¤šï¼ŒåŸºæœ¬ä¸å¯èƒ½ä¸€æ¬¡å…¨è®°ä½ã€‚è¿˜æ˜¯è¦ç”¨åˆ°æ—¶å¤šæŸ¥å§ã€‚å¤§è‡´è®°ä½æœ‰æä¾›å“ªäº›åŠŸèƒ½ï¼Œéœ€è¦ç”¨åˆ°æ—¶èƒ½æƒ³èµ·å¯ä»¥æŸ¥è¿™ä¸ªæ¨¡å—å°±è¡Œã€‚ 1. æ— é™è¿­ä»£å™¨ count(start=0, step=1): ä» start å¼€å§‹ï¼Œæ¯æ¬¡è¿­ä»£æ—¶ï¼Œè¿”å›å€¼éƒ½åŠ ä¸€ä¸ª step é»˜è®¤è¿”å›åºåˆ—ä¸º 0 1 2 3â€¦ cycle(iterable): ä¸æ–­å¾ªç¯è¿­ä»£ iterable repeat(element, times=None): é»˜è®¤æ°¸è¿œè¿”å› elementã€‚ï¼ˆå¦‚æœ times ä¸ä¸º Noneï¼Œå°±è¿­ä»£ times åç»“æŸï¼‰ 2. æ’åˆ—ç»„åˆè¿­ä»£å™¨ product(p1, p2, â€¦, repeat=1)ï¼šp1, p2â€¦ çš„å…ƒç´ çš„ç¬›å¡å°”ç§¯ï¼Œç›¸å½“äºå¤šå±‚ for å¾ªç¯ repeat æŒ‡å‚æ•°é‡å¤æ¬¡æ•°ï¼Œæ¯”å¦‚ shell \u003e\u003e\u003e from itertools import product \u003e\u003e\u003e r = product([1, 2], [3, 4], [5, 6]) # é‡å¤ä¸€æ¬¡ï¼Œä¹Ÿå°±æ˜¯ (p1, p2, p3) çš„ç¬›å¡å°”ç§¯ \u003e\u003e\u003e pprint(list(r)) [(1, 3, 5), (1, 3, 6), (1, 4, 5), (1, 4, 6), (2, 3, 5), (2, 3, 6), (2, 4, 5), (2, 4, 6)] \u003e\u003e\u003e r2 = product([1, 2], [3, 4], [5, 6], repeat=2) # é‡å¤ä¸¤æ¬¡ï¼Œå³ (p1, p2, p3, p1, p2, p3) çš„ç¬›å¡å°”ç§¯ \u003e\u003e\u003e pprint(list(r2)) [(1, 3, 5, 1, 3, 5), (1, 3, 5, 1, 3, 6), (1, 3, 5, 1, 4, 5), (1, 3, 5, 1, 4, 6), (1, 3, 5, 2, 3, 5), ... permutations(p[, r])ï¼šp ä¸­å…ƒç´ ï¼Œé•¿åº¦ä¸º r çš„æ‰€æœ‰å¯èƒ½çš„æ’åˆ—ã€‚ç›¸å½“äº product å»é‡åçš„ç»“æœã€‚ combinations(p, r)ï¼šæ—¢ç„¶æœ‰æ’åˆ—ï¼Œå½“ç„¶å°±æœ‰ç»„åˆäº†ã€‚ 3. å…¶ä»– zip_longest(*iterables, fillvalue=None)ï¼šå’Œ zip çš„å·®åˆ«åœ¨äºï¼Œç¼ºå¤±çš„å…ƒç´ å®ƒä¼šç”¨ fillvalue è¡¥å…¨ï¼Œè€Œä¸æ˜¯ç›´æ¥ç»“æŸã€‚ takewhile() dropwhile() groupby() ç­‰ç­‰ç­‰ï¼Œç”¨å¾—åˆ°çš„æ—¶å€™å†æŸ¥äº†ã€‚ã€‚ã€‚ ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:1:4","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#1-æ— é™è¿­ä»£å™¨"},{"categories":["tech"],"content":" 4. itertoolsitertools æä¾›äº†è®¸å¤šé’ˆå¯¹å¯è¿­ä»£å¯¹è±¡çš„å®ç”¨å‡½æ•° æ–¹æ³•å¾ˆå¤šï¼ŒåŸºæœ¬ä¸å¯èƒ½ä¸€æ¬¡å…¨è®°ä½ã€‚è¿˜æ˜¯è¦ç”¨åˆ°æ—¶å¤šæŸ¥å§ã€‚å¤§è‡´è®°ä½æœ‰æä¾›å“ªäº›åŠŸèƒ½ï¼Œéœ€è¦ç”¨åˆ°æ—¶èƒ½æƒ³èµ·å¯ä»¥æŸ¥è¿™ä¸ªæ¨¡å—å°±è¡Œã€‚ 1. æ— é™è¿­ä»£å™¨ count(start=0, step=1): ä» start å¼€å§‹ï¼Œæ¯æ¬¡è¿­ä»£æ—¶ï¼Œè¿”å›å€¼éƒ½åŠ ä¸€ä¸ª step é»˜è®¤è¿”å›åºåˆ—ä¸º 0 1 2 3â€¦ cycle(iterable): ä¸æ–­å¾ªç¯è¿­ä»£ iterable repeat(element, times=None): é»˜è®¤æ°¸è¿œè¿”å› elementã€‚ï¼ˆå¦‚æœ times ä¸ä¸º Noneï¼Œå°±è¿­ä»£ times åç»“æŸï¼‰ 2. æ’åˆ—ç»„åˆè¿­ä»£å™¨ product(p1, p2, â€¦, repeat=1)ï¼šp1, p2â€¦ çš„å…ƒç´ çš„ç¬›å¡å°”ç§¯ï¼Œç›¸å½“äºå¤šå±‚ for å¾ªç¯ repeat æŒ‡å‚æ•°é‡å¤æ¬¡æ•°ï¼Œæ¯”å¦‚ shell \u003e\u003e\u003e from itertools import product \u003e\u003e\u003e r = product([1, 2], [3, 4], [5, 6]) # é‡å¤ä¸€æ¬¡ï¼Œä¹Ÿå°±æ˜¯ (p1, p2, p3) çš„ç¬›å¡å°”ç§¯ \u003e\u003e\u003e pprint(list(r)) [(1, 3, 5), (1, 3, 6), (1, 4, 5), (1, 4, 6), (2, 3, 5), (2, 3, 6), (2, 4, 5), (2, 4, 6)] \u003e\u003e\u003e r2 = product([1, 2], [3, 4], [5, 6], repeat=2) # é‡å¤ä¸¤æ¬¡ï¼Œå³ (p1, p2, p3, p1, p2, p3) çš„ç¬›å¡å°”ç§¯ \u003e\u003e\u003e pprint(list(r2)) [(1, 3, 5, 1, 3, 5), (1, 3, 5, 1, 3, 6), (1, 3, 5, 1, 4, 5), (1, 3, 5, 1, 4, 6), (1, 3, 5, 2, 3, 5), ... permutations(p[, r])ï¼šp ä¸­å…ƒç´ ï¼Œé•¿åº¦ä¸º r çš„æ‰€æœ‰å¯èƒ½çš„æ’åˆ—ã€‚ç›¸å½“äº product å»é‡åçš„ç»“æœã€‚ combinations(p, r)ï¼šæ—¢ç„¶æœ‰æ’åˆ—ï¼Œå½“ç„¶å°±æœ‰ç»„åˆäº†ã€‚ 3. å…¶ä»– zip_longest(*iterables, fillvalue=None)ï¼šå’Œ zip çš„å·®åˆ«åœ¨äºï¼Œç¼ºå¤±çš„å…ƒç´ å®ƒä¼šç”¨ fillvalue è¡¥å…¨ï¼Œè€Œä¸æ˜¯ç›´æ¥ç»“æŸã€‚ takewhile() dropwhile() groupby() ç­‰ç­‰ç­‰ï¼Œç”¨å¾—åˆ°çš„æ—¶å€™å†æŸ¥äº†ã€‚ã€‚ã€‚ ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:1:4","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#2-æ’åˆ—ç»„åˆè¿­ä»£å™¨"},{"categories":["tech"],"content":" 4. itertoolsitertools æä¾›äº†è®¸å¤šé’ˆå¯¹å¯è¿­ä»£å¯¹è±¡çš„å®ç”¨å‡½æ•° æ–¹æ³•å¾ˆå¤šï¼ŒåŸºæœ¬ä¸å¯èƒ½ä¸€æ¬¡å…¨è®°ä½ã€‚è¿˜æ˜¯è¦ç”¨åˆ°æ—¶å¤šæŸ¥å§ã€‚å¤§è‡´è®°ä½æœ‰æä¾›å“ªäº›åŠŸèƒ½ï¼Œéœ€è¦ç”¨åˆ°æ—¶èƒ½æƒ³èµ·å¯ä»¥æŸ¥è¿™ä¸ªæ¨¡å—å°±è¡Œã€‚ 1. æ— é™è¿­ä»£å™¨ count(start=0, step=1): ä» start å¼€å§‹ï¼Œæ¯æ¬¡è¿­ä»£æ—¶ï¼Œè¿”å›å€¼éƒ½åŠ ä¸€ä¸ª step é»˜è®¤è¿”å›åºåˆ—ä¸º 0 1 2 3â€¦ cycle(iterable): ä¸æ–­å¾ªç¯è¿­ä»£ iterable repeat(element, times=None): é»˜è®¤æ°¸è¿œè¿”å› elementã€‚ï¼ˆå¦‚æœ times ä¸ä¸º Noneï¼Œå°±è¿­ä»£ times åç»“æŸï¼‰ 2. æ’åˆ—ç»„åˆè¿­ä»£å™¨ product(p1, p2, â€¦, repeat=1)ï¼šp1, p2â€¦ çš„å…ƒç´ çš„ç¬›å¡å°”ç§¯ï¼Œç›¸å½“äºå¤šå±‚ for å¾ªç¯ repeat æŒ‡å‚æ•°é‡å¤æ¬¡æ•°ï¼Œæ¯”å¦‚ shell \u003e\u003e\u003e from itertools import product \u003e\u003e\u003e r = product([1, 2], [3, 4], [5, 6]) # é‡å¤ä¸€æ¬¡ï¼Œä¹Ÿå°±æ˜¯ (p1, p2, p3) çš„ç¬›å¡å°”ç§¯ \u003e\u003e\u003e pprint(list(r)) [(1, 3, 5), (1, 3, 6), (1, 4, 5), (1, 4, 6), (2, 3, 5), (2, 3, 6), (2, 4, 5), (2, 4, 6)] \u003e\u003e\u003e r2 = product([1, 2], [3, 4], [5, 6], repeat=2) # é‡å¤ä¸¤æ¬¡ï¼Œå³ (p1, p2, p3, p1, p2, p3) çš„ç¬›å¡å°”ç§¯ \u003e\u003e\u003e pprint(list(r2)) [(1, 3, 5, 1, 3, 5), (1, 3, 5, 1, 3, 6), (1, 3, 5, 1, 4, 5), (1, 3, 5, 1, 4, 6), (1, 3, 5, 2, 3, 5), ... permutations(p[, r])ï¼šp ä¸­å…ƒç´ ï¼Œé•¿åº¦ä¸º r çš„æ‰€æœ‰å¯èƒ½çš„æ’åˆ—ã€‚ç›¸å½“äº product å»é‡åçš„ç»“æœã€‚ combinations(p, r)ï¼šæ—¢ç„¶æœ‰æ’åˆ—ï¼Œå½“ç„¶å°±æœ‰ç»„åˆäº†ã€‚ 3. å…¶ä»– zip_longest(*iterables, fillvalue=None)ï¼šå’Œ zip çš„å·®åˆ«åœ¨äºï¼Œç¼ºå¤±çš„å…ƒç´ å®ƒä¼šç”¨ fillvalue è¡¥å…¨ï¼Œè€Œä¸æ˜¯ç›´æ¥ç»“æŸã€‚ takewhile() dropwhile() groupby() ç­‰ç­‰ç­‰ï¼Œç”¨å¾—åˆ°çš„æ—¶å€™å†æŸ¥äº†ã€‚ã€‚ã€‚ ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:1:4","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#3-å…¶ä»–"},{"categories":["tech"],"content":" 5. collectionsæä¾›äº†ä¸€äº›å®ç”¨çš„é«˜çº§æ•°æ®ç»“æ„ï¼ˆå®¹å™¨ï¼‰ defaultdictï¼šè¿™ä¸ªæ„Ÿè§‰æ˜¯æœ€å¸¸ç”¨çš„ï¼Œå¯ä»¥ç»™å®š key çš„é»˜è®¤å€¼ Counterï¼šæ–¹ä¾¿ã€å¿«é€Ÿçš„è®¡æ•°å™¨ã€‚å¸¸ç”¨äºåˆ†ç±»ç»Ÿè®¡ dequeï¼šä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„åŒç«¯é˜Ÿåˆ— OrderedDictï¼šæœ‰æ—¶å€™ä¼šéœ€è¦æœ‰åºå­—å…¸ namedtupleï¼šå‘½åå…ƒç»„ï¼Œæœ‰æ—¶ç”¨äºå‚æ•°ä¼ é€’ã€‚ä¸ tuple çš„å·®åˆ«æ˜¯å®ƒæä¾›äº†å…³é”®å­—å‚æ•°å’Œé€šè¿‡åå­—è®¿é—®å±æ€§çš„åŠŸèƒ½ ChainMapï¼šå°†å¤šä¸ª map è¿æ¥ï¼ˆchainï¼‰åœ¨ä¸€èµ·ï¼Œæä¾›ä¸€ä¸ªç»Ÿä¸€çš„è§†å›¾ã€‚å› ä¸ºæ˜¯è§†å›¾ï¼Œæ‰€ä»¥åŸæ¥çš„ map ä¸ä¼šè¢«å½±å“ã€‚ ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:1:5","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#5-collections"},{"categories":["tech"],"content":" 6. å¸¸ç”¨å‡½æ•°è£…é¥°å™¨ functoolsfunctools æä¾›äº†å‡ ä¸ªæœ‰æ—¶å¾ˆæœ‰ç”¨çš„å‡½æ•°å’Œè£…é¥°å™¨ 1. @functools.wrapsè¿™ä¸ªè£…é¥°å™¨ç”¨äºä½¿è£…é¥°å™¨ copy è¢«è£…é¥°çš„å¯¹è±¡çš„ __module__, __name__, __qualname__,__annotations__ and __doc__ å±æ€§ï¼Œè¿™æ ·è£…é¥°å™¨å°±æ˜¾å¾—æ›´åŠ é€æ˜ã€‚ python3 from functools import wraps def my_decorator(f): @wraps(f) def wrapper(*args, **kwds): print('Calling decorated function') return f(*args, **kwds) return wrapper # ç”¨äº† wrapsï¼Œwrapper ä¼šå¤åˆ¶ f çš„å„ç§æ–‡æ¡£å±æ€§ @my_decorator def func(xx): \"\"\" this is func's docstring\"\"\" print(\"this is func~\") å¦‚æœä¸ç”¨ wraps çš„è¯ï¼Œå› ä¸ºå®é™…ä¸Šè¿”å›çš„æ˜¯ wrapperï¼Œè¢«è£…é¥°å¯¹è±¡çš„è¿™äº›æ–‡æ¡£å±æ€§éƒ½ä¼šä¸¢å¤±ã€‚ï¼ˆæ¯”å¦‚ docstringï¼‰ å› æ­¤åœ¨ä½¿ç”¨ wrapper è£…é¥°å™¨æ—¶ï¼Œæ·»åŠ  @wraps() è£…é¥°å™¨æ˜¯ä¸ªå¥½ä¹ æƒ¯ã€‚ 2. functools.partialè¿™ä¸ªæ„Ÿè§‰å’Œé«˜ç­‰æ•°å­¦çš„åå‡½æ•°å¾ˆåƒï¼šæ¯”å¦‚å‡½æ•° z = f(x, y) æœ‰ x å’Œ y ä¸¤ä¸ªå˜é‡ï¼Œç°åœ¨æŠŠ x çœ‹ä½œå¸¸æ•°ï¼Œå°±å¯ä»¥å¯¹ y è¿›è¡Œæ±‚å¯¼è¿ç®—ã€‚è€Œ python çš„ partial ä¹Ÿå·®ä¸å¤šï¼Œä¸è¿‡å®ƒä¸æ˜¯æŠŠ x çœ‹ä½œå¸¸æ•°ï¼Œè€Œæ˜¯å…ˆç»™å®š x çš„å€¼ã€‚ç”¨æ³•å¦‚ä¸‹ï¼š python3 from functools import partial basetwo = partial(int, base=2) # å…ˆç»™å®š int å‡½æ•°çš„ base å‚æ•°ä¸º 2 basetwo.__doc__ = 'Convert base 2 string to an int.' # å¦‚æœéœ€è¦æ–‡æ¡£ï¼Œå¯ä»¥æ·»åŠ  __doc__ å±æ€§ basetwo('10010') # return 18 æ­¤å¤–ï¼Œè¿˜æœ‰ä¸ª partialmethod å‡½æ•°ï¼Œå¾…äº†è§£ 3. @functools.lru_cache(maxsize=128, typed=False)å¦‚æœæŸæ–¹æ³•å¯èƒ½è¢«é¢‘ç¹è°ƒç”¨ï¼ˆä½¿ç”¨ç›¸åŒçš„å‚æ•°ï¼‰ï¼Œè€Œä¸”å®ƒçš„ç»“æœåœ¨ä¸€å®šæ—¶é—´å†…ä¸ä¼šæ”¹å˜ã€‚å¯ä»¥ç”¨ lru_cache è£…é¥°å®ƒï¼Œå‡å°‘è¿ç®—é‡æˆ– IO æ“ä½œã€‚ python3 from functools import lru_cache # ç¼“å­˜æœ€è¿‘çš„ï¼ˆleast recently usedï¼Œlruï¼‰ 64 æ¬¡å‚æ•°ä¸åŒçš„è°ƒç”¨ç»“æœã€‚ @lru_cache(maxsize=64) def my_sum(x): # åç»­çš„è°ƒç”¨ä¸­ï¼Œå¦‚æœå‚æ•°èƒ½åŒ¹é…åˆ°ç¼“å­˜ï¼Œå°±ç›´æ¥è¿”å›ç¼“å­˜ç»“æœ return sum(x) æ¯”å¦‚ç”¨é€’å½’è®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼Œæ•°å€¼è¾ƒä½çš„å‚æ•°ä¼šè¢«é¢‘ç¹ä½¿ç”¨ï¼Œäºæ˜¯å¯ä»¥ç”¨ lru_cache æ¥ç¼“å­˜å®ƒä»¬ã€‚æˆ–è€…çˆ¬å–ç½‘é¡µï¼Œå¯èƒ½ä¼šéœ€è¦é¢‘ç¹çˆ¬å–ä¸€ä¸ªå˜åŒ–ä¸å¿«çš„ç½‘é¡µï¼Œè¿™æ—¶å®Œå…¨å¯ä»¥ç”¨ cache ç¼“å­˜ã€‚ ä½†æ˜¯å®ƒä¸èƒ½æ§åˆ¶ç¼“å­˜å¤±æ•ˆæ—¶é—´ï¼Œå› æ­¤ä¸èƒ½ç”¨äº Web ç³»ç»Ÿçš„ç¼“å­˜ã€‚è¿˜æ˜¯å¾—è‡ªå·±å†™ä¸ªç®€å•çš„è£…é¥°å™¨ï¼ŒæŠŠç¼“å­˜å­˜åˆ° redis é‡Œå¹¶è®¾ç½® expiresã€‚æˆ–è€…ç›´æ¥ç”¨ Flask æˆ– Django çš„ caching æ’ä»¶ã€‚ 4. @functools.singledispatchå•é‡æ´¾å‘ï¼Œå³æ ¹æ®å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹ï¼Œæ¥å†³å®šè°ƒç”¨å“ªä¸€ä¸ªåŒåå‡½æ•°ã€‚ python3 @singledispatch def parse(arg): # é¦–å…ˆå®šä¹‰ä¸€ä¸ªé»˜è®¤å‡½æ•° print('æ²¡æœ‰åˆé€‚çš„ç±»å‹è¢«è°ƒç”¨') # å¦‚æœå‚æ•°ç±»å‹æ²¡æœ‰åŒ¹é…ä¸Šï¼Œå°±è°ƒç”¨è¿™ä¸ªé»˜è®¤å‡½æ•° @parse.register(type(None)) # ç¬¬ä¸€ä¸ªå‚æ•°ä¸º None def _(arg): print('å‡ºç° None äº†') @parse.register(int) # ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ•´æ•° def _(arg): print('è¿™æ¬¡è¾“å…¥çš„æ˜¯æ•´æ•°') @parse.register def _(arg: list): # python3.7 å¼€å§‹ï¼Œå¯ä»¥ç›´æ¥ç”¨ç±»å‹æ³¨è§£æ¥æ ‡æ³¨ç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹ print('è¿™æ¬¡è¾“å…¥çš„æ˜¯åˆ—è¡¨') ç”»å¤–ï¼šæœ‰å•é‡æ´¾å‘ï¼Œè‡ªç„¶å°±æœ‰å¤šé‡æ´¾å‘ï¼ŒJulia è¯­è¨€å°±æ”¯æŒå¤šé‡æ´¾å‘ï¼Œå³æ ¹æ®å‡½æ•°æ‰€æœ‰å‚æ•°çš„ç±»å‹ï¼Œæ¥å†³å®šè°ƒç”¨å“ªä¸€ä¸ªåŒåå‡½æ•°ã€‚Julia è¯­è¨€æ ¹æœ¬æ²¡æœ‰ç±»è¿™ä¸ªå®šä¹‰ï¼Œç±»å‹çš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯é€šè¿‡å¤šé‡æ´¾å‘æ¥å®šä¹‰çš„ã€‚ å…¶ä»– @functools.total_orderingï¼šç”¨äºè‡ªåŠ¨ç”Ÿæˆæ¯”è¾ƒå‡½æ•°ã€‚ functools.cmp_to_key(func)ï¼šç”¨äºå°†è€å¼çš„æ¯”è¾ƒå‡½æ•°ï¼Œè½¬æ¢æˆæ–°å¼çš„ key å‡½æ•°ã€‚ ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:1:6","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#6-å¸¸ç”¨å‡½æ•°è£…é¥°å™¨-functools"},{"categories":["tech"],"content":" 6. å¸¸ç”¨å‡½æ•°è£…é¥°å™¨ functoolsfunctools æä¾›äº†å‡ ä¸ªæœ‰æ—¶å¾ˆæœ‰ç”¨çš„å‡½æ•°å’Œè£…é¥°å™¨ 1. @functools.wrapsè¿™ä¸ªè£…é¥°å™¨ç”¨äºä½¿è£…é¥°å™¨ copy è¢«è£…é¥°çš„å¯¹è±¡çš„ __module__, __name__, __qualname__,__annotations__ and __doc__ å±æ€§ï¼Œè¿™æ ·è£…é¥°å™¨å°±æ˜¾å¾—æ›´åŠ é€æ˜ã€‚ python3 from functools import wraps def my_decorator(f): @wraps(f) def wrapper(*args, **kwds): print('Calling decorated function') return f(*args, **kwds) return wrapper # ç”¨äº† wrapsï¼Œwrapper ä¼šå¤åˆ¶ f çš„å„ç§æ–‡æ¡£å±æ€§ @my_decorator def func(xx): \"\"\" this is func's docstring\"\"\" print(\"this is func~\") å¦‚æœä¸ç”¨ wraps çš„è¯ï¼Œå› ä¸ºå®é™…ä¸Šè¿”å›çš„æ˜¯ wrapperï¼Œè¢«è£…é¥°å¯¹è±¡çš„è¿™äº›æ–‡æ¡£å±æ€§éƒ½ä¼šä¸¢å¤±ã€‚ï¼ˆæ¯”å¦‚ docstringï¼‰ å› æ­¤åœ¨ä½¿ç”¨ wrapper è£…é¥°å™¨æ—¶ï¼Œæ·»åŠ  @wraps() è£…é¥°å™¨æ˜¯ä¸ªå¥½ä¹ æƒ¯ã€‚ 2. functools.partialè¿™ä¸ªæ„Ÿè§‰å’Œé«˜ç­‰æ•°å­¦çš„åå‡½æ•°å¾ˆåƒï¼šæ¯”å¦‚å‡½æ•° z = f(x, y) æœ‰ x å’Œ y ä¸¤ä¸ªå˜é‡ï¼Œç°åœ¨æŠŠ x çœ‹ä½œå¸¸æ•°ï¼Œå°±å¯ä»¥å¯¹ y è¿›è¡Œæ±‚å¯¼è¿ç®—ã€‚è€Œ python çš„ partial ä¹Ÿå·®ä¸å¤šï¼Œä¸è¿‡å®ƒä¸æ˜¯æŠŠ x çœ‹ä½œå¸¸æ•°ï¼Œè€Œæ˜¯å…ˆç»™å®š x çš„å€¼ã€‚ç”¨æ³•å¦‚ä¸‹ï¼š python3 from functools import partial basetwo = partial(int, base=2) # å…ˆç»™å®š int å‡½æ•°çš„ base å‚æ•°ä¸º 2 basetwo.__doc__ = 'Convert base 2 string to an int.' # å¦‚æœéœ€è¦æ–‡æ¡£ï¼Œå¯ä»¥æ·»åŠ  __doc__ å±æ€§ basetwo('10010') # return 18 æ­¤å¤–ï¼Œè¿˜æœ‰ä¸ª partialmethod å‡½æ•°ï¼Œå¾…äº†è§£ 3. @functools.lru_cache(maxsize=128, typed=False)å¦‚æœæŸæ–¹æ³•å¯èƒ½è¢«é¢‘ç¹è°ƒç”¨ï¼ˆä½¿ç”¨ç›¸åŒçš„å‚æ•°ï¼‰ï¼Œè€Œä¸”å®ƒçš„ç»“æœåœ¨ä¸€å®šæ—¶é—´å†…ä¸ä¼šæ”¹å˜ã€‚å¯ä»¥ç”¨ lru_cache è£…é¥°å®ƒï¼Œå‡å°‘è¿ç®—é‡æˆ– IO æ“ä½œã€‚ python3 from functools import lru_cache # ç¼“å­˜æœ€è¿‘çš„ï¼ˆleast recently usedï¼Œlruï¼‰ 64 æ¬¡å‚æ•°ä¸åŒçš„è°ƒç”¨ç»“æœã€‚ @lru_cache(maxsize=64) def my_sum(x): # åç»­çš„è°ƒç”¨ä¸­ï¼Œå¦‚æœå‚æ•°èƒ½åŒ¹é…åˆ°ç¼“å­˜ï¼Œå°±ç›´æ¥è¿”å›ç¼“å­˜ç»“æœ return sum(x) æ¯”å¦‚ç”¨é€’å½’è®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼Œæ•°å€¼è¾ƒä½çš„å‚æ•°ä¼šè¢«é¢‘ç¹ä½¿ç”¨ï¼Œäºæ˜¯å¯ä»¥ç”¨ lru_cache æ¥ç¼“å­˜å®ƒä»¬ã€‚æˆ–è€…çˆ¬å–ç½‘é¡µï¼Œå¯èƒ½ä¼šéœ€è¦é¢‘ç¹çˆ¬å–ä¸€ä¸ªå˜åŒ–ä¸å¿«çš„ç½‘é¡µï¼Œè¿™æ—¶å®Œå…¨å¯ä»¥ç”¨ cache ç¼“å­˜ã€‚ ä½†æ˜¯å®ƒä¸èƒ½æ§åˆ¶ç¼“å­˜å¤±æ•ˆæ—¶é—´ï¼Œå› æ­¤ä¸èƒ½ç”¨äº Web ç³»ç»Ÿçš„ç¼“å­˜ã€‚è¿˜æ˜¯å¾—è‡ªå·±å†™ä¸ªç®€å•çš„è£…é¥°å™¨ï¼ŒæŠŠç¼“å­˜å­˜åˆ° redis é‡Œå¹¶è®¾ç½® expiresã€‚æˆ–è€…ç›´æ¥ç”¨ Flask æˆ– Django çš„ caching æ’ä»¶ã€‚ 4. @functools.singledispatchå•é‡æ´¾å‘ï¼Œå³æ ¹æ®å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹ï¼Œæ¥å†³å®šè°ƒç”¨å“ªä¸€ä¸ªåŒåå‡½æ•°ã€‚ python3 @singledispatch def parse(arg): # é¦–å…ˆå®šä¹‰ä¸€ä¸ªé»˜è®¤å‡½æ•° print('æ²¡æœ‰åˆé€‚çš„ç±»å‹è¢«è°ƒç”¨') # å¦‚æœå‚æ•°ç±»å‹æ²¡æœ‰åŒ¹é…ä¸Šï¼Œå°±è°ƒç”¨è¿™ä¸ªé»˜è®¤å‡½æ•° @parse.register(type(None)) # ç¬¬ä¸€ä¸ªå‚æ•°ä¸º None def _(arg): print('å‡ºç° None äº†') @parse.register(int) # ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ•´æ•° def _(arg): print('è¿™æ¬¡è¾“å…¥çš„æ˜¯æ•´æ•°') @parse.register def _(arg: list): # python3.7 å¼€å§‹ï¼Œå¯ä»¥ç›´æ¥ç”¨ç±»å‹æ³¨è§£æ¥æ ‡æ³¨ç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹ print('è¿™æ¬¡è¾“å…¥çš„æ˜¯åˆ—è¡¨') ç”»å¤–ï¼šæœ‰å•é‡æ´¾å‘ï¼Œè‡ªç„¶å°±æœ‰å¤šé‡æ´¾å‘ï¼ŒJulia è¯­è¨€å°±æ”¯æŒå¤šé‡æ´¾å‘ï¼Œå³æ ¹æ®å‡½æ•°æ‰€æœ‰å‚æ•°çš„ç±»å‹ï¼Œæ¥å†³å®šè°ƒç”¨å“ªä¸€ä¸ªåŒåå‡½æ•°ã€‚Julia è¯­è¨€æ ¹æœ¬æ²¡æœ‰ç±»è¿™ä¸ªå®šä¹‰ï¼Œç±»å‹çš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯é€šè¿‡å¤šé‡æ´¾å‘æ¥å®šä¹‰çš„ã€‚ å…¶ä»– @functools.total_orderingï¼šç”¨äºè‡ªåŠ¨ç”Ÿæˆæ¯”è¾ƒå‡½æ•°ã€‚ functools.cmp_to_key(func)ï¼šç”¨äºå°†è€å¼çš„æ¯”è¾ƒå‡½æ•°ï¼Œè½¬æ¢æˆæ–°å¼çš„ key å‡½æ•°ã€‚ ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:1:6","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#1-functoolswraps"},{"categories":["tech"],"content":" 6. å¸¸ç”¨å‡½æ•°è£…é¥°å™¨ functoolsfunctools æä¾›äº†å‡ ä¸ªæœ‰æ—¶å¾ˆæœ‰ç”¨çš„å‡½æ•°å’Œè£…é¥°å™¨ 1. @functools.wrapsè¿™ä¸ªè£…é¥°å™¨ç”¨äºä½¿è£…é¥°å™¨ copy è¢«è£…é¥°çš„å¯¹è±¡çš„ __module__, __name__, __qualname__,__annotations__ and __doc__ å±æ€§ï¼Œè¿™æ ·è£…é¥°å™¨å°±æ˜¾å¾—æ›´åŠ é€æ˜ã€‚ python3 from functools import wraps def my_decorator(f): @wraps(f) def wrapper(*args, **kwds): print('Calling decorated function') return f(*args, **kwds) return wrapper # ç”¨äº† wrapsï¼Œwrapper ä¼šå¤åˆ¶ f çš„å„ç§æ–‡æ¡£å±æ€§ @my_decorator def func(xx): \"\"\" this is func's docstring\"\"\" print(\"this is func~\") å¦‚æœä¸ç”¨ wraps çš„è¯ï¼Œå› ä¸ºå®é™…ä¸Šè¿”å›çš„æ˜¯ wrapperï¼Œè¢«è£…é¥°å¯¹è±¡çš„è¿™äº›æ–‡æ¡£å±æ€§éƒ½ä¼šä¸¢å¤±ã€‚ï¼ˆæ¯”å¦‚ docstringï¼‰ å› æ­¤åœ¨ä½¿ç”¨ wrapper è£…é¥°å™¨æ—¶ï¼Œæ·»åŠ  @wraps() è£…é¥°å™¨æ˜¯ä¸ªå¥½ä¹ æƒ¯ã€‚ 2. functools.partialè¿™ä¸ªæ„Ÿè§‰å’Œé«˜ç­‰æ•°å­¦çš„åå‡½æ•°å¾ˆåƒï¼šæ¯”å¦‚å‡½æ•° z = f(x, y) æœ‰ x å’Œ y ä¸¤ä¸ªå˜é‡ï¼Œç°åœ¨æŠŠ x çœ‹ä½œå¸¸æ•°ï¼Œå°±å¯ä»¥å¯¹ y è¿›è¡Œæ±‚å¯¼è¿ç®—ã€‚è€Œ python çš„ partial ä¹Ÿå·®ä¸å¤šï¼Œä¸è¿‡å®ƒä¸æ˜¯æŠŠ x çœ‹ä½œå¸¸æ•°ï¼Œè€Œæ˜¯å…ˆç»™å®š x çš„å€¼ã€‚ç”¨æ³•å¦‚ä¸‹ï¼š python3 from functools import partial basetwo = partial(int, base=2) # å…ˆç»™å®š int å‡½æ•°çš„ base å‚æ•°ä¸º 2 basetwo.__doc__ = 'Convert base 2 string to an int.' # å¦‚æœéœ€è¦æ–‡æ¡£ï¼Œå¯ä»¥æ·»åŠ  __doc__ å±æ€§ basetwo('10010') # return 18 æ­¤å¤–ï¼Œè¿˜æœ‰ä¸ª partialmethod å‡½æ•°ï¼Œå¾…äº†è§£ 3. @functools.lru_cache(maxsize=128, typed=False)å¦‚æœæŸæ–¹æ³•å¯èƒ½è¢«é¢‘ç¹è°ƒç”¨ï¼ˆä½¿ç”¨ç›¸åŒçš„å‚æ•°ï¼‰ï¼Œè€Œä¸”å®ƒçš„ç»“æœåœ¨ä¸€å®šæ—¶é—´å†…ä¸ä¼šæ”¹å˜ã€‚å¯ä»¥ç”¨ lru_cache è£…é¥°å®ƒï¼Œå‡å°‘è¿ç®—é‡æˆ– IO æ“ä½œã€‚ python3 from functools import lru_cache # ç¼“å­˜æœ€è¿‘çš„ï¼ˆleast recently usedï¼Œlruï¼‰ 64 æ¬¡å‚æ•°ä¸åŒçš„è°ƒç”¨ç»“æœã€‚ @lru_cache(maxsize=64) def my_sum(x): # åç»­çš„è°ƒç”¨ä¸­ï¼Œå¦‚æœå‚æ•°èƒ½åŒ¹é…åˆ°ç¼“å­˜ï¼Œå°±ç›´æ¥è¿”å›ç¼“å­˜ç»“æœ return sum(x) æ¯”å¦‚ç”¨é€’å½’è®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼Œæ•°å€¼è¾ƒä½çš„å‚æ•°ä¼šè¢«é¢‘ç¹ä½¿ç”¨ï¼Œäºæ˜¯å¯ä»¥ç”¨ lru_cache æ¥ç¼“å­˜å®ƒä»¬ã€‚æˆ–è€…çˆ¬å–ç½‘é¡µï¼Œå¯èƒ½ä¼šéœ€è¦é¢‘ç¹çˆ¬å–ä¸€ä¸ªå˜åŒ–ä¸å¿«çš„ç½‘é¡µï¼Œè¿™æ—¶å®Œå…¨å¯ä»¥ç”¨ cache ç¼“å­˜ã€‚ ä½†æ˜¯å®ƒä¸èƒ½æ§åˆ¶ç¼“å­˜å¤±æ•ˆæ—¶é—´ï¼Œå› æ­¤ä¸èƒ½ç”¨äº Web ç³»ç»Ÿçš„ç¼“å­˜ã€‚è¿˜æ˜¯å¾—è‡ªå·±å†™ä¸ªç®€å•çš„è£…é¥°å™¨ï¼ŒæŠŠç¼“å­˜å­˜åˆ° redis é‡Œå¹¶è®¾ç½® expiresã€‚æˆ–è€…ç›´æ¥ç”¨ Flask æˆ– Django çš„ caching æ’ä»¶ã€‚ 4. @functools.singledispatchå•é‡æ´¾å‘ï¼Œå³æ ¹æ®å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹ï¼Œæ¥å†³å®šè°ƒç”¨å“ªä¸€ä¸ªåŒåå‡½æ•°ã€‚ python3 @singledispatch def parse(arg): # é¦–å…ˆå®šä¹‰ä¸€ä¸ªé»˜è®¤å‡½æ•° print('æ²¡æœ‰åˆé€‚çš„ç±»å‹è¢«è°ƒç”¨') # å¦‚æœå‚æ•°ç±»å‹æ²¡æœ‰åŒ¹é…ä¸Šï¼Œå°±è°ƒç”¨è¿™ä¸ªé»˜è®¤å‡½æ•° @parse.register(type(None)) # ç¬¬ä¸€ä¸ªå‚æ•°ä¸º None def _(arg): print('å‡ºç° None äº†') @parse.register(int) # ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ•´æ•° def _(arg): print('è¿™æ¬¡è¾“å…¥çš„æ˜¯æ•´æ•°') @parse.register def _(arg: list): # python3.7 å¼€å§‹ï¼Œå¯ä»¥ç›´æ¥ç”¨ç±»å‹æ³¨è§£æ¥æ ‡æ³¨ç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹ print('è¿™æ¬¡è¾“å…¥çš„æ˜¯åˆ—è¡¨') ç”»å¤–ï¼šæœ‰å•é‡æ´¾å‘ï¼Œè‡ªç„¶å°±æœ‰å¤šé‡æ´¾å‘ï¼ŒJulia è¯­è¨€å°±æ”¯æŒå¤šé‡æ´¾å‘ï¼Œå³æ ¹æ®å‡½æ•°æ‰€æœ‰å‚æ•°çš„ç±»å‹ï¼Œæ¥å†³å®šè°ƒç”¨å“ªä¸€ä¸ªåŒåå‡½æ•°ã€‚Julia è¯­è¨€æ ¹æœ¬æ²¡æœ‰ç±»è¿™ä¸ªå®šä¹‰ï¼Œç±»å‹çš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯é€šè¿‡å¤šé‡æ´¾å‘æ¥å®šä¹‰çš„ã€‚ å…¶ä»– @functools.total_orderingï¼šç”¨äºè‡ªåŠ¨ç”Ÿæˆæ¯”è¾ƒå‡½æ•°ã€‚ functools.cmp_to_key(func)ï¼šç”¨äºå°†è€å¼çš„æ¯”è¾ƒå‡½æ•°ï¼Œè½¬æ¢æˆæ–°å¼çš„ key å‡½æ•°ã€‚ ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:1:6","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#2-functoolspartial"},{"categories":["tech"],"content":" 6. å¸¸ç”¨å‡½æ•°è£…é¥°å™¨ functoolsfunctools æä¾›äº†å‡ ä¸ªæœ‰æ—¶å¾ˆæœ‰ç”¨çš„å‡½æ•°å’Œè£…é¥°å™¨ 1. @functools.wrapsè¿™ä¸ªè£…é¥°å™¨ç”¨äºä½¿è£…é¥°å™¨ copy è¢«è£…é¥°çš„å¯¹è±¡çš„ __module__, __name__, __qualname__,__annotations__ and __doc__ å±æ€§ï¼Œè¿™æ ·è£…é¥°å™¨å°±æ˜¾å¾—æ›´åŠ é€æ˜ã€‚ python3 from functools import wraps def my_decorator(f): @wraps(f) def wrapper(*args, **kwds): print('Calling decorated function') return f(*args, **kwds) return wrapper # ç”¨äº† wrapsï¼Œwrapper ä¼šå¤åˆ¶ f çš„å„ç§æ–‡æ¡£å±æ€§ @my_decorator def func(xx): \"\"\" this is func's docstring\"\"\" print(\"this is func~\") å¦‚æœä¸ç”¨ wraps çš„è¯ï¼Œå› ä¸ºå®é™…ä¸Šè¿”å›çš„æ˜¯ wrapperï¼Œè¢«è£…é¥°å¯¹è±¡çš„è¿™äº›æ–‡æ¡£å±æ€§éƒ½ä¼šä¸¢å¤±ã€‚ï¼ˆæ¯”å¦‚ docstringï¼‰ å› æ­¤åœ¨ä½¿ç”¨ wrapper è£…é¥°å™¨æ—¶ï¼Œæ·»åŠ  @wraps() è£…é¥°å™¨æ˜¯ä¸ªå¥½ä¹ æƒ¯ã€‚ 2. functools.partialè¿™ä¸ªæ„Ÿè§‰å’Œé«˜ç­‰æ•°å­¦çš„åå‡½æ•°å¾ˆåƒï¼šæ¯”å¦‚å‡½æ•° z = f(x, y) æœ‰ x å’Œ y ä¸¤ä¸ªå˜é‡ï¼Œç°åœ¨æŠŠ x çœ‹ä½œå¸¸æ•°ï¼Œå°±å¯ä»¥å¯¹ y è¿›è¡Œæ±‚å¯¼è¿ç®—ã€‚è€Œ python çš„ partial ä¹Ÿå·®ä¸å¤šï¼Œä¸è¿‡å®ƒä¸æ˜¯æŠŠ x çœ‹ä½œå¸¸æ•°ï¼Œè€Œæ˜¯å…ˆç»™å®š x çš„å€¼ã€‚ç”¨æ³•å¦‚ä¸‹ï¼š python3 from functools import partial basetwo = partial(int, base=2) # å…ˆç»™å®š int å‡½æ•°çš„ base å‚æ•°ä¸º 2 basetwo.__doc__ = 'Convert base 2 string to an int.' # å¦‚æœéœ€è¦æ–‡æ¡£ï¼Œå¯ä»¥æ·»åŠ  __doc__ å±æ€§ basetwo('10010') # return 18 æ­¤å¤–ï¼Œè¿˜æœ‰ä¸ª partialmethod å‡½æ•°ï¼Œå¾…äº†è§£ 3. @functools.lru_cache(maxsize=128, typed=False)å¦‚æœæŸæ–¹æ³•å¯èƒ½è¢«é¢‘ç¹è°ƒç”¨ï¼ˆä½¿ç”¨ç›¸åŒçš„å‚æ•°ï¼‰ï¼Œè€Œä¸”å®ƒçš„ç»“æœåœ¨ä¸€å®šæ—¶é—´å†…ä¸ä¼šæ”¹å˜ã€‚å¯ä»¥ç”¨ lru_cache è£…é¥°å®ƒï¼Œå‡å°‘è¿ç®—é‡æˆ– IO æ“ä½œã€‚ python3 from functools import lru_cache # ç¼“å­˜æœ€è¿‘çš„ï¼ˆleast recently usedï¼Œlruï¼‰ 64 æ¬¡å‚æ•°ä¸åŒçš„è°ƒç”¨ç»“æœã€‚ @lru_cache(maxsize=64) def my_sum(x): # åç»­çš„è°ƒç”¨ä¸­ï¼Œå¦‚æœå‚æ•°èƒ½åŒ¹é…åˆ°ç¼“å­˜ï¼Œå°±ç›´æ¥è¿”å›ç¼“å­˜ç»“æœ return sum(x) æ¯”å¦‚ç”¨é€’å½’è®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼Œæ•°å€¼è¾ƒä½çš„å‚æ•°ä¼šè¢«é¢‘ç¹ä½¿ç”¨ï¼Œäºæ˜¯å¯ä»¥ç”¨ lru_cache æ¥ç¼“å­˜å®ƒä»¬ã€‚æˆ–è€…çˆ¬å–ç½‘é¡µï¼Œå¯èƒ½ä¼šéœ€è¦é¢‘ç¹çˆ¬å–ä¸€ä¸ªå˜åŒ–ä¸å¿«çš„ç½‘é¡µï¼Œè¿™æ—¶å®Œå…¨å¯ä»¥ç”¨ cache ç¼“å­˜ã€‚ ä½†æ˜¯å®ƒä¸èƒ½æ§åˆ¶ç¼“å­˜å¤±æ•ˆæ—¶é—´ï¼Œå› æ­¤ä¸èƒ½ç”¨äº Web ç³»ç»Ÿçš„ç¼“å­˜ã€‚è¿˜æ˜¯å¾—è‡ªå·±å†™ä¸ªç®€å•çš„è£…é¥°å™¨ï¼ŒæŠŠç¼“å­˜å­˜åˆ° redis é‡Œå¹¶è®¾ç½® expiresã€‚æˆ–è€…ç›´æ¥ç”¨ Flask æˆ– Django çš„ caching æ’ä»¶ã€‚ 4. @functools.singledispatchå•é‡æ´¾å‘ï¼Œå³æ ¹æ®å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹ï¼Œæ¥å†³å®šè°ƒç”¨å“ªä¸€ä¸ªåŒåå‡½æ•°ã€‚ python3 @singledispatch def parse(arg): # é¦–å…ˆå®šä¹‰ä¸€ä¸ªé»˜è®¤å‡½æ•° print('æ²¡æœ‰åˆé€‚çš„ç±»å‹è¢«è°ƒç”¨') # å¦‚æœå‚æ•°ç±»å‹æ²¡æœ‰åŒ¹é…ä¸Šï¼Œå°±è°ƒç”¨è¿™ä¸ªé»˜è®¤å‡½æ•° @parse.register(type(None)) # ç¬¬ä¸€ä¸ªå‚æ•°ä¸º None def _(arg): print('å‡ºç° None äº†') @parse.register(int) # ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ•´æ•° def _(arg): print('è¿™æ¬¡è¾“å…¥çš„æ˜¯æ•´æ•°') @parse.register def _(arg: list): # python3.7 å¼€å§‹ï¼Œå¯ä»¥ç›´æ¥ç”¨ç±»å‹æ³¨è§£æ¥æ ‡æ³¨ç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹ print('è¿™æ¬¡è¾“å…¥çš„æ˜¯åˆ—è¡¨') ç”»å¤–ï¼šæœ‰å•é‡æ´¾å‘ï¼Œè‡ªç„¶å°±æœ‰å¤šé‡æ´¾å‘ï¼ŒJulia è¯­è¨€å°±æ”¯æŒå¤šé‡æ´¾å‘ï¼Œå³æ ¹æ®å‡½æ•°æ‰€æœ‰å‚æ•°çš„ç±»å‹ï¼Œæ¥å†³å®šè°ƒç”¨å“ªä¸€ä¸ªåŒåå‡½æ•°ã€‚Julia è¯­è¨€æ ¹æœ¬æ²¡æœ‰ç±»è¿™ä¸ªå®šä¹‰ï¼Œç±»å‹çš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯é€šè¿‡å¤šé‡æ´¾å‘æ¥å®šä¹‰çš„ã€‚ å…¶ä»– @functools.total_orderingï¼šç”¨äºè‡ªåŠ¨ç”Ÿæˆæ¯”è¾ƒå‡½æ•°ã€‚ functools.cmp_to_key(func)ï¼šç”¨äºå°†è€å¼çš„æ¯”è¾ƒå‡½æ•°ï¼Œè½¬æ¢æˆæ–°å¼çš„ key å‡½æ•°ã€‚ ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:1:6","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#3-functoolslru_cachemaxsize128-typedfalse"},{"categories":["tech"],"content":" 6. å¸¸ç”¨å‡½æ•°è£…é¥°å™¨ functoolsfunctools æä¾›äº†å‡ ä¸ªæœ‰æ—¶å¾ˆæœ‰ç”¨çš„å‡½æ•°å’Œè£…é¥°å™¨ 1. @functools.wrapsè¿™ä¸ªè£…é¥°å™¨ç”¨äºä½¿è£…é¥°å™¨ copy è¢«è£…é¥°çš„å¯¹è±¡çš„ __module__, __name__, __qualname__,__annotations__ and __doc__ å±æ€§ï¼Œè¿™æ ·è£…é¥°å™¨å°±æ˜¾å¾—æ›´åŠ é€æ˜ã€‚ python3 from functools import wraps def my_decorator(f): @wraps(f) def wrapper(*args, **kwds): print('Calling decorated function') return f(*args, **kwds) return wrapper # ç”¨äº† wrapsï¼Œwrapper ä¼šå¤åˆ¶ f çš„å„ç§æ–‡æ¡£å±æ€§ @my_decorator def func(xx): \"\"\" this is func's docstring\"\"\" print(\"this is func~\") å¦‚æœä¸ç”¨ wraps çš„è¯ï¼Œå› ä¸ºå®é™…ä¸Šè¿”å›çš„æ˜¯ wrapperï¼Œè¢«è£…é¥°å¯¹è±¡çš„è¿™äº›æ–‡æ¡£å±æ€§éƒ½ä¼šä¸¢å¤±ã€‚ï¼ˆæ¯”å¦‚ docstringï¼‰ å› æ­¤åœ¨ä½¿ç”¨ wrapper è£…é¥°å™¨æ—¶ï¼Œæ·»åŠ  @wraps() è£…é¥°å™¨æ˜¯ä¸ªå¥½ä¹ æƒ¯ã€‚ 2. functools.partialè¿™ä¸ªæ„Ÿè§‰å’Œé«˜ç­‰æ•°å­¦çš„åå‡½æ•°å¾ˆåƒï¼šæ¯”å¦‚å‡½æ•° z = f(x, y) æœ‰ x å’Œ y ä¸¤ä¸ªå˜é‡ï¼Œç°åœ¨æŠŠ x çœ‹ä½œå¸¸æ•°ï¼Œå°±å¯ä»¥å¯¹ y è¿›è¡Œæ±‚å¯¼è¿ç®—ã€‚è€Œ python çš„ partial ä¹Ÿå·®ä¸å¤šï¼Œä¸è¿‡å®ƒä¸æ˜¯æŠŠ x çœ‹ä½œå¸¸æ•°ï¼Œè€Œæ˜¯å…ˆç»™å®š x çš„å€¼ã€‚ç”¨æ³•å¦‚ä¸‹ï¼š python3 from functools import partial basetwo = partial(int, base=2) # å…ˆç»™å®š int å‡½æ•°çš„ base å‚æ•°ä¸º 2 basetwo.__doc__ = 'Convert base 2 string to an int.' # å¦‚æœéœ€è¦æ–‡æ¡£ï¼Œå¯ä»¥æ·»åŠ  __doc__ å±æ€§ basetwo('10010') # return 18 æ­¤å¤–ï¼Œè¿˜æœ‰ä¸ª partialmethod å‡½æ•°ï¼Œå¾…äº†è§£ 3. @functools.lru_cache(maxsize=128, typed=False)å¦‚æœæŸæ–¹æ³•å¯èƒ½è¢«é¢‘ç¹è°ƒç”¨ï¼ˆä½¿ç”¨ç›¸åŒçš„å‚æ•°ï¼‰ï¼Œè€Œä¸”å®ƒçš„ç»“æœåœ¨ä¸€å®šæ—¶é—´å†…ä¸ä¼šæ”¹å˜ã€‚å¯ä»¥ç”¨ lru_cache è£…é¥°å®ƒï¼Œå‡å°‘è¿ç®—é‡æˆ– IO æ“ä½œã€‚ python3 from functools import lru_cache # ç¼“å­˜æœ€è¿‘çš„ï¼ˆleast recently usedï¼Œlruï¼‰ 64 æ¬¡å‚æ•°ä¸åŒçš„è°ƒç”¨ç»“æœã€‚ @lru_cache(maxsize=64) def my_sum(x): # åç»­çš„è°ƒç”¨ä¸­ï¼Œå¦‚æœå‚æ•°èƒ½åŒ¹é…åˆ°ç¼“å­˜ï¼Œå°±ç›´æ¥è¿”å›ç¼“å­˜ç»“æœ return sum(x) æ¯”å¦‚ç”¨é€’å½’è®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼Œæ•°å€¼è¾ƒä½çš„å‚æ•°ä¼šè¢«é¢‘ç¹ä½¿ç”¨ï¼Œäºæ˜¯å¯ä»¥ç”¨ lru_cache æ¥ç¼“å­˜å®ƒä»¬ã€‚æˆ–è€…çˆ¬å–ç½‘é¡µï¼Œå¯èƒ½ä¼šéœ€è¦é¢‘ç¹çˆ¬å–ä¸€ä¸ªå˜åŒ–ä¸å¿«çš„ç½‘é¡µï¼Œè¿™æ—¶å®Œå…¨å¯ä»¥ç”¨ cache ç¼“å­˜ã€‚ ä½†æ˜¯å®ƒä¸èƒ½æ§åˆ¶ç¼“å­˜å¤±æ•ˆæ—¶é—´ï¼Œå› æ­¤ä¸èƒ½ç”¨äº Web ç³»ç»Ÿçš„ç¼“å­˜ã€‚è¿˜æ˜¯å¾—è‡ªå·±å†™ä¸ªç®€å•çš„è£…é¥°å™¨ï¼ŒæŠŠç¼“å­˜å­˜åˆ° redis é‡Œå¹¶è®¾ç½® expiresã€‚æˆ–è€…ç›´æ¥ç”¨ Flask æˆ– Django çš„ caching æ’ä»¶ã€‚ 4. @functools.singledispatchå•é‡æ´¾å‘ï¼Œå³æ ¹æ®å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹ï¼Œæ¥å†³å®šè°ƒç”¨å“ªä¸€ä¸ªåŒåå‡½æ•°ã€‚ python3 @singledispatch def parse(arg): # é¦–å…ˆå®šä¹‰ä¸€ä¸ªé»˜è®¤å‡½æ•° print('æ²¡æœ‰åˆé€‚çš„ç±»å‹è¢«è°ƒç”¨') # å¦‚æœå‚æ•°ç±»å‹æ²¡æœ‰åŒ¹é…ä¸Šï¼Œå°±è°ƒç”¨è¿™ä¸ªé»˜è®¤å‡½æ•° @parse.register(type(None)) # ç¬¬ä¸€ä¸ªå‚æ•°ä¸º None def _(arg): print('å‡ºç° None äº†') @parse.register(int) # ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ•´æ•° def _(arg): print('è¿™æ¬¡è¾“å…¥çš„æ˜¯æ•´æ•°') @parse.register def _(arg: list): # python3.7 å¼€å§‹ï¼Œå¯ä»¥ç›´æ¥ç”¨ç±»å‹æ³¨è§£æ¥æ ‡æ³¨ç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹ print('è¿™æ¬¡è¾“å…¥çš„æ˜¯åˆ—è¡¨') ç”»å¤–ï¼šæœ‰å•é‡æ´¾å‘ï¼Œè‡ªç„¶å°±æœ‰å¤šé‡æ´¾å‘ï¼ŒJulia è¯­è¨€å°±æ”¯æŒå¤šé‡æ´¾å‘ï¼Œå³æ ¹æ®å‡½æ•°æ‰€æœ‰å‚æ•°çš„ç±»å‹ï¼Œæ¥å†³å®šè°ƒç”¨å“ªä¸€ä¸ªåŒåå‡½æ•°ã€‚Julia è¯­è¨€æ ¹æœ¬æ²¡æœ‰ç±»è¿™ä¸ªå®šä¹‰ï¼Œç±»å‹çš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯é€šè¿‡å¤šé‡æ´¾å‘æ¥å®šä¹‰çš„ã€‚ å…¶ä»– @functools.total_orderingï¼šç”¨äºè‡ªåŠ¨ç”Ÿæˆæ¯”è¾ƒå‡½æ•°ã€‚ functools.cmp_to_key(func)ï¼šç”¨äºå°†è€å¼çš„æ¯”è¾ƒå‡½æ•°ï¼Œè½¬æ¢æˆæ–°å¼çš„ key å‡½æ•°ã€‚ ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:1:6","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#4-functoolssingledispatch"},{"categories":["tech"],"content":" 6. å¸¸ç”¨å‡½æ•°è£…é¥°å™¨ functoolsfunctools æä¾›äº†å‡ ä¸ªæœ‰æ—¶å¾ˆæœ‰ç”¨çš„å‡½æ•°å’Œè£…é¥°å™¨ 1. @functools.wrapsè¿™ä¸ªè£…é¥°å™¨ç”¨äºä½¿è£…é¥°å™¨ copy è¢«è£…é¥°çš„å¯¹è±¡çš„ __module__, __name__, __qualname__,__annotations__ and __doc__ å±æ€§ï¼Œè¿™æ ·è£…é¥°å™¨å°±æ˜¾å¾—æ›´åŠ é€æ˜ã€‚ python3 from functools import wraps def my_decorator(f): @wraps(f) def wrapper(*args, **kwds): print('Calling decorated function') return f(*args, **kwds) return wrapper # ç”¨äº† wrapsï¼Œwrapper ä¼šå¤åˆ¶ f çš„å„ç§æ–‡æ¡£å±æ€§ @my_decorator def func(xx): \"\"\" this is func's docstring\"\"\" print(\"this is func~\") å¦‚æœä¸ç”¨ wraps çš„è¯ï¼Œå› ä¸ºå®é™…ä¸Šè¿”å›çš„æ˜¯ wrapperï¼Œè¢«è£…é¥°å¯¹è±¡çš„è¿™äº›æ–‡æ¡£å±æ€§éƒ½ä¼šä¸¢å¤±ã€‚ï¼ˆæ¯”å¦‚ docstringï¼‰ å› æ­¤åœ¨ä½¿ç”¨ wrapper è£…é¥°å™¨æ—¶ï¼Œæ·»åŠ  @wraps() è£…é¥°å™¨æ˜¯ä¸ªå¥½ä¹ æƒ¯ã€‚ 2. functools.partialè¿™ä¸ªæ„Ÿè§‰å’Œé«˜ç­‰æ•°å­¦çš„åå‡½æ•°å¾ˆåƒï¼šæ¯”å¦‚å‡½æ•° z = f(x, y) æœ‰ x å’Œ y ä¸¤ä¸ªå˜é‡ï¼Œç°åœ¨æŠŠ x çœ‹ä½œå¸¸æ•°ï¼Œå°±å¯ä»¥å¯¹ y è¿›è¡Œæ±‚å¯¼è¿ç®—ã€‚è€Œ python çš„ partial ä¹Ÿå·®ä¸å¤šï¼Œä¸è¿‡å®ƒä¸æ˜¯æŠŠ x çœ‹ä½œå¸¸æ•°ï¼Œè€Œæ˜¯å…ˆç»™å®š x çš„å€¼ã€‚ç”¨æ³•å¦‚ä¸‹ï¼š python3 from functools import partial basetwo = partial(int, base=2) # å…ˆç»™å®š int å‡½æ•°çš„ base å‚æ•°ä¸º 2 basetwo.__doc__ = 'Convert base 2 string to an int.' # å¦‚æœéœ€è¦æ–‡æ¡£ï¼Œå¯ä»¥æ·»åŠ  __doc__ å±æ€§ basetwo('10010') # return 18 æ­¤å¤–ï¼Œè¿˜æœ‰ä¸ª partialmethod å‡½æ•°ï¼Œå¾…äº†è§£ 3. @functools.lru_cache(maxsize=128, typed=False)å¦‚æœæŸæ–¹æ³•å¯èƒ½è¢«é¢‘ç¹è°ƒç”¨ï¼ˆä½¿ç”¨ç›¸åŒçš„å‚æ•°ï¼‰ï¼Œè€Œä¸”å®ƒçš„ç»“æœåœ¨ä¸€å®šæ—¶é—´å†…ä¸ä¼šæ”¹å˜ã€‚å¯ä»¥ç”¨ lru_cache è£…é¥°å®ƒï¼Œå‡å°‘è¿ç®—é‡æˆ– IO æ“ä½œã€‚ python3 from functools import lru_cache # ç¼“å­˜æœ€è¿‘çš„ï¼ˆleast recently usedï¼Œlruï¼‰ 64 æ¬¡å‚æ•°ä¸åŒçš„è°ƒç”¨ç»“æœã€‚ @lru_cache(maxsize=64) def my_sum(x): # åç»­çš„è°ƒç”¨ä¸­ï¼Œå¦‚æœå‚æ•°èƒ½åŒ¹é…åˆ°ç¼“å­˜ï¼Œå°±ç›´æ¥è¿”å›ç¼“å­˜ç»“æœ return sum(x) æ¯”å¦‚ç”¨é€’å½’è®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼Œæ•°å€¼è¾ƒä½çš„å‚æ•°ä¼šè¢«é¢‘ç¹ä½¿ç”¨ï¼Œäºæ˜¯å¯ä»¥ç”¨ lru_cache æ¥ç¼“å­˜å®ƒä»¬ã€‚æˆ–è€…çˆ¬å–ç½‘é¡µï¼Œå¯èƒ½ä¼šéœ€è¦é¢‘ç¹çˆ¬å–ä¸€ä¸ªå˜åŒ–ä¸å¿«çš„ç½‘é¡µï¼Œè¿™æ—¶å®Œå…¨å¯ä»¥ç”¨ cache ç¼“å­˜ã€‚ ä½†æ˜¯å®ƒä¸èƒ½æ§åˆ¶ç¼“å­˜å¤±æ•ˆæ—¶é—´ï¼Œå› æ­¤ä¸èƒ½ç”¨äº Web ç³»ç»Ÿçš„ç¼“å­˜ã€‚è¿˜æ˜¯å¾—è‡ªå·±å†™ä¸ªç®€å•çš„è£…é¥°å™¨ï¼ŒæŠŠç¼“å­˜å­˜åˆ° redis é‡Œå¹¶è®¾ç½® expiresã€‚æˆ–è€…ç›´æ¥ç”¨ Flask æˆ– Django çš„ caching æ’ä»¶ã€‚ 4. @functools.singledispatchå•é‡æ´¾å‘ï¼Œå³æ ¹æ®å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹ï¼Œæ¥å†³å®šè°ƒç”¨å“ªä¸€ä¸ªåŒåå‡½æ•°ã€‚ python3 @singledispatch def parse(arg): # é¦–å…ˆå®šä¹‰ä¸€ä¸ªé»˜è®¤å‡½æ•° print('æ²¡æœ‰åˆé€‚çš„ç±»å‹è¢«è°ƒç”¨') # å¦‚æœå‚æ•°ç±»å‹æ²¡æœ‰åŒ¹é…ä¸Šï¼Œå°±è°ƒç”¨è¿™ä¸ªé»˜è®¤å‡½æ•° @parse.register(type(None)) # ç¬¬ä¸€ä¸ªå‚æ•°ä¸º None def _(arg): print('å‡ºç° None äº†') @parse.register(int) # ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ•´æ•° def _(arg): print('è¿™æ¬¡è¾“å…¥çš„æ˜¯æ•´æ•°') @parse.register def _(arg: list): # python3.7 å¼€å§‹ï¼Œå¯ä»¥ç›´æ¥ç”¨ç±»å‹æ³¨è§£æ¥æ ‡æ³¨ç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹ print('è¿™æ¬¡è¾“å…¥çš„æ˜¯åˆ—è¡¨') ç”»å¤–ï¼šæœ‰å•é‡æ´¾å‘ï¼Œè‡ªç„¶å°±æœ‰å¤šé‡æ´¾å‘ï¼ŒJulia è¯­è¨€å°±æ”¯æŒå¤šé‡æ´¾å‘ï¼Œå³æ ¹æ®å‡½æ•°æ‰€æœ‰å‚æ•°çš„ç±»å‹ï¼Œæ¥å†³å®šè°ƒç”¨å“ªä¸€ä¸ªåŒåå‡½æ•°ã€‚Julia è¯­è¨€æ ¹æœ¬æ²¡æœ‰ç±»è¿™ä¸ªå®šä¹‰ï¼Œç±»å‹çš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯é€šè¿‡å¤šé‡æ´¾å‘æ¥å®šä¹‰çš„ã€‚ å…¶ä»– @functools.total_orderingï¼šç”¨äºè‡ªåŠ¨ç”Ÿæˆæ¯”è¾ƒå‡½æ•°ã€‚ functools.cmp_to_key(func)ï¼šç”¨äºå°†è€å¼çš„æ¯”è¾ƒå‡½æ•°ï¼Œè½¬æ¢æˆæ–°å¼çš„ key å‡½æ•°ã€‚ ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:1:6","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#å…¶ä»–"},{"categories":["tech"],"content":" 7. ä¸Šä¸‹æ–‡ç®¡ç† - contextlibå³å®ç°ä½¿ç”¨ with è¯­å¥è¿›è¡Œè‡ªå®šä¹‰çš„ä¸Šä¸‹æ–‡ç®¡ç†ã€‚ 1. ä½¿ç”¨ __enter__ å’Œ __exit__Java ä½¿ç”¨ try æ¥è‡ªåŠ¨ç®¡ç†èµ„æºï¼Œåªè¦å®ç°äº† AutoCloseable æ¥å£ï¼Œå°±å¯ä»¥éƒ¨åˆ†æ‘†è„±æ‰‹åŠ¨ colse çš„åœ°ç‹±äº†ã€‚ è€Œ Pythonï¼Œåˆ™æ˜¯å®šä¹‰äº†ä¸¤ä¸ª Protocolï¼š__enter__ å’Œ __exit__. ä¸‹é¢æ˜¯ä¸€ä¸ª open çš„æ¨¡æ‹Ÿå®ç°ï¼š python3 class OpenContext(object): def __init__(self, filename, mode): # è°ƒç”¨ open(filename, mode) è¿”å›ä¸€ä¸ªå®ä¾‹ self.fp = open(filename, mode) def __enter__(self): # ç”¨ with ç®¡ç† __init__ è¿”å›çš„å®ä¾‹æ—¶ï¼Œwith ä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³• return self.fp # é€€å‡º with ä»£ç å—æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚ def __exit__(self, exc_type, exc_value, traceback): self.fp.close() # è¿™é‡Œå…ˆæ„é€ äº† OpenContext å®ä¾‹ï¼Œç„¶åç”¨ with ç®¡ç†è¯¥å®ä¾‹ with OpenContext('/tmp/a', 'a') as f: f.write('hello world') è¿™é‡Œå”¯ä¸€æœ‰ç‚¹å¤æ‚çš„ï¼Œå°±æ˜¯ __exit__ æ–¹æ³•ã€‚å’Œ Java ä¸€æ ·ï¼Œ__exit__ ç›¸å½“äºtry - catch - finally çš„ finally ä»£ç å—ï¼Œåœ¨å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå®ƒä¹Ÿä¼šè¢«è°ƒç”¨ã€‚ å½“æ²¡æœ‰å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œ__exit__ çš„ä¸‰ä¸ªå‚æ•° exc_type, exc_value, traceback éƒ½ä¸º Noneï¼Œè€Œå½“å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå®ƒä»¬å°±å¯¹åº”å¼‚å¸¸çš„è¯¦ç»†ä¿¡æ¯ã€‚å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œ __exit__ çš„è¿”å›å€¼å°†è¢«ç”¨äºå†³å®šæ˜¯å¦å‘å¤–å±‚æŠ›å‡ºè¯¥å¼‚å¸¸ï¼Œè¿”å› True åˆ™æŠ›å‡ºï¼Œè¿”å› False åˆ™æŠ‘åˆ¶ï¼ˆswallow itï¼‰ã€‚ Note 1ï¼šPython 3.6 æä¾›äº† async with å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œå®ƒçš„ Protocol å’ŒåŒæ­¥çš„ with å®Œå…¨ç±»ä¼¼ï¼Œæ˜¯ __aenter__ å’Œ __aexit__ ä¸¤ä¸ªæ–¹æ³•ã€‚Note 2ï¼šä¸ Java ç›¸åŒï¼Œwith æ”¯æŒåŒæ—¶ç®¡ç†å¤šä¸ªèµ„æºï¼Œå› æ­¤å¯ä»¥ç›´æ¥å†™ with open(x) as a, open(y) as b: è¿™æ ·çš„å½¢å¼ã€‚ 2. æ¨èï¼šcontextlib 2.1 @contextlib.contextmanagerå¯¹äºç®€å•çš„ with èµ„æºç®¡ç†ï¼Œç¼–å†™ä¸€ä¸ªç±»å¯èƒ½ä¼šæ˜¾å¾—æ¯”è¾ƒç¹çï¼Œä¸ºæ­¤ contextlib æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„è£…é¥°å™¨ @contextlib.contextmanager ç”¨æ¥ç®€åŒ–ä»£ç ã€‚ ä½¿ç”¨å®ƒï¼Œä¸Šé¢çš„ OpenContext å¯ä»¥æ”¹å†™æˆè¿™æ ·ï¼š python3 from contextlib import contextmanager @contextmanager def make_open_context(filename, mode): fp = open(filename, mode) try: yield fp # æ²¡é”™ï¼Œè¿™æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•° finally: fp.close() with make_open_context('/tmp/a', 'a') as f: f.write('hello world') ä½¿ç”¨ contextmanager è£…é¥°ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°ï¼Œyield ä¹‹å‰çš„ä»£ç å¯¹åº” __enter__ï¼Œfinally ä»£ç å—å°±å¯¹åº” __exit__. Noteï¼šåŒæ ·ï¼Œä¹Ÿæœ‰å¼‚æ­¥ç‰ˆæœ¬çš„è£…é¥°å™¨ @contextlib.asynccontextmanager 2.2 contextlib.closing(thing)ç”¨äºå°†åŸæœ¬ä¸æ”¯æŒ with ç®¡ç†çš„èµ„æºï¼ŒåŒ…è£…æˆä¸€ä¸ª Context å¯¹è±¡ã€‚ python3 from contextlib import closing from urllib.request import urlopen with closing(urlopen('http://www.python.org')) as page: for line in page: print(line) # closing ç­‰åŒäº from contextlib import contextmanager @contextmanager def closing(thing): try: yield thing finally: thing.close() # å°±æ˜¯æ·»åŠ äº†ä¸€ä¸ªè‡ªåŠ¨ close çš„åŠŸèƒ½ 2.3 contextlib.suppress(*exceptions)ä½¿ with ç®¡ç†å™¨æŠ‘åˆ¶ä»£ç å—å†…ä»»ä½•è¢«æŒ‡å®šçš„å¼‚å¸¸ï¼š python3 from contextlib import suppress with suppress(FileNotFoundError): os.remove('somefile.tmp') # ç­‰åŒäº try: os.remove('somefile.tmp') except FileNotFoundError: pass 2.4 contextlib.redirect_stdout(new_target)å°† with ä»£ç å—å†…çš„ stdout é‡å®šå‘åˆ°æŒ‡å®šçš„ targetï¼ˆå¯ç”¨äºæ”¶é›† stdout çš„è¾“å‡ºï¼‰ python3 f = io.StringIO() with redirect_stdout(f): # å°†è¾“å‡ºç›´æ¥å†™å…¥åˆ° StringIO help(pow) s = f.getvalue() # æˆ–è€…ç›´æ¥å†™å…¥åˆ°æ–‡ä»¶ with open('help.txt', 'w') as f: with redirect_stdout(f): help(pow) redirect_stdout å‡½æ•°è¿”å›çš„ Context æ˜¯å¯é‡å…¥çš„ï¼ˆ reentrantï¼‰ï¼Œå¯ä»¥é‡å¤ä½¿ç”¨ã€‚ ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:1:7","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#7-ä¸Šä¸‹æ–‡ç®¡ç†---contextlib"},{"categories":["tech"],"content":" 7. ä¸Šä¸‹æ–‡ç®¡ç† - contextlibå³å®ç°ä½¿ç”¨ with è¯­å¥è¿›è¡Œè‡ªå®šä¹‰çš„ä¸Šä¸‹æ–‡ç®¡ç†ã€‚ 1. ä½¿ç”¨ __enter__ å’Œ __exit__Java ä½¿ç”¨ try æ¥è‡ªåŠ¨ç®¡ç†èµ„æºï¼Œåªè¦å®ç°äº† AutoCloseable æ¥å£ï¼Œå°±å¯ä»¥éƒ¨åˆ†æ‘†è„±æ‰‹åŠ¨ colse çš„åœ°ç‹±äº†ã€‚ è€Œ Pythonï¼Œåˆ™æ˜¯å®šä¹‰äº†ä¸¤ä¸ª Protocolï¼š__enter__ å’Œ __exit__. ä¸‹é¢æ˜¯ä¸€ä¸ª open çš„æ¨¡æ‹Ÿå®ç°ï¼š python3 class OpenContext(object): def __init__(self, filename, mode): # è°ƒç”¨ open(filename, mode) è¿”å›ä¸€ä¸ªå®ä¾‹ self.fp = open(filename, mode) def __enter__(self): # ç”¨ with ç®¡ç† __init__ è¿”å›çš„å®ä¾‹æ—¶ï¼Œwith ä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³• return self.fp # é€€å‡º with ä»£ç å—æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚ def __exit__(self, exc_type, exc_value, traceback): self.fp.close() # è¿™é‡Œå…ˆæ„é€ äº† OpenContext å®ä¾‹ï¼Œç„¶åç”¨ with ç®¡ç†è¯¥å®ä¾‹ with OpenContext('/tmp/a', 'a') as f: f.write('hello world') è¿™é‡Œå”¯ä¸€æœ‰ç‚¹å¤æ‚çš„ï¼Œå°±æ˜¯ __exit__ æ–¹æ³•ã€‚å’Œ Java ä¸€æ ·ï¼Œ__exit__ ç›¸å½“äºtry - catch - finally çš„ finally ä»£ç å—ï¼Œåœ¨å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå®ƒä¹Ÿä¼šè¢«è°ƒç”¨ã€‚ å½“æ²¡æœ‰å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œ__exit__ çš„ä¸‰ä¸ªå‚æ•° exc_type, exc_value, traceback éƒ½ä¸º Noneï¼Œè€Œå½“å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå®ƒä»¬å°±å¯¹åº”å¼‚å¸¸çš„è¯¦ç»†ä¿¡æ¯ã€‚å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œ __exit__ çš„è¿”å›å€¼å°†è¢«ç”¨äºå†³å®šæ˜¯å¦å‘å¤–å±‚æŠ›å‡ºè¯¥å¼‚å¸¸ï¼Œè¿”å› True åˆ™æŠ›å‡ºï¼Œè¿”å› False åˆ™æŠ‘åˆ¶ï¼ˆswallow itï¼‰ã€‚ Note 1ï¼šPython 3.6 æä¾›äº† async with å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œå®ƒçš„ Protocol å’ŒåŒæ­¥çš„ with å®Œå…¨ç±»ä¼¼ï¼Œæ˜¯ __aenter__ å’Œ __aexit__ ä¸¤ä¸ªæ–¹æ³•ã€‚Note 2ï¼šä¸ Java ç›¸åŒï¼Œwith æ”¯æŒåŒæ—¶ç®¡ç†å¤šä¸ªèµ„æºï¼Œå› æ­¤å¯ä»¥ç›´æ¥å†™ with open(x) as a, open(y) as b: è¿™æ ·çš„å½¢å¼ã€‚ 2. æ¨èï¼šcontextlib 2.1 @contextlib.contextmanagerå¯¹äºç®€å•çš„ with èµ„æºç®¡ç†ï¼Œç¼–å†™ä¸€ä¸ªç±»å¯èƒ½ä¼šæ˜¾å¾—æ¯”è¾ƒç¹çï¼Œä¸ºæ­¤ contextlib æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„è£…é¥°å™¨ @contextlib.contextmanager ç”¨æ¥ç®€åŒ–ä»£ç ã€‚ ä½¿ç”¨å®ƒï¼Œä¸Šé¢çš„ OpenContext å¯ä»¥æ”¹å†™æˆè¿™æ ·ï¼š python3 from contextlib import contextmanager @contextmanager def make_open_context(filename, mode): fp = open(filename, mode) try: yield fp # æ²¡é”™ï¼Œè¿™æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•° finally: fp.close() with make_open_context('/tmp/a', 'a') as f: f.write('hello world') ä½¿ç”¨ contextmanager è£…é¥°ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°ï¼Œyield ä¹‹å‰çš„ä»£ç å¯¹åº” __enter__ï¼Œfinally ä»£ç å—å°±å¯¹åº” __exit__. Noteï¼šåŒæ ·ï¼Œä¹Ÿæœ‰å¼‚æ­¥ç‰ˆæœ¬çš„è£…é¥°å™¨ @contextlib.asynccontextmanager 2.2 contextlib.closing(thing)ç”¨äºå°†åŸæœ¬ä¸æ”¯æŒ with ç®¡ç†çš„èµ„æºï¼ŒåŒ…è£…æˆä¸€ä¸ª Context å¯¹è±¡ã€‚ python3 from contextlib import closing from urllib.request import urlopen with closing(urlopen('http://www.python.org')) as page: for line in page: print(line) # closing ç­‰åŒäº from contextlib import contextmanager @contextmanager def closing(thing): try: yield thing finally: thing.close() # å°±æ˜¯æ·»åŠ äº†ä¸€ä¸ªè‡ªåŠ¨ close çš„åŠŸèƒ½ 2.3 contextlib.suppress(*exceptions)ä½¿ with ç®¡ç†å™¨æŠ‘åˆ¶ä»£ç å—å†…ä»»ä½•è¢«æŒ‡å®šçš„å¼‚å¸¸ï¼š python3 from contextlib import suppress with suppress(FileNotFoundError): os.remove('somefile.tmp') # ç­‰åŒäº try: os.remove('somefile.tmp') except FileNotFoundError: pass 2.4 contextlib.redirect_stdout(new_target)å°† with ä»£ç å—å†…çš„ stdout é‡å®šå‘åˆ°æŒ‡å®šçš„ targetï¼ˆå¯ç”¨äºæ”¶é›† stdout çš„è¾“å‡ºï¼‰ python3 f = io.StringIO() with redirect_stdout(f): # å°†è¾“å‡ºç›´æ¥å†™å…¥åˆ° StringIO help(pow) s = f.getvalue() # æˆ–è€…ç›´æ¥å†™å…¥åˆ°æ–‡ä»¶ with open('help.txt', 'w') as f: with redirect_stdout(f): help(pow) redirect_stdout å‡½æ•°è¿”å›çš„ Context æ˜¯å¯é‡å…¥çš„ï¼ˆ reentrantï¼‰ï¼Œå¯ä»¥é‡å¤ä½¿ç”¨ã€‚ ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:1:7","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#1-ä½¿ç”¨-__enter__-å’Œ-__exit__"},{"categories":["tech"],"content":" 7. ä¸Šä¸‹æ–‡ç®¡ç† - contextlibå³å®ç°ä½¿ç”¨ with è¯­å¥è¿›è¡Œè‡ªå®šä¹‰çš„ä¸Šä¸‹æ–‡ç®¡ç†ã€‚ 1. ä½¿ç”¨ __enter__ å’Œ __exit__Java ä½¿ç”¨ try æ¥è‡ªåŠ¨ç®¡ç†èµ„æºï¼Œåªè¦å®ç°äº† AutoCloseable æ¥å£ï¼Œå°±å¯ä»¥éƒ¨åˆ†æ‘†è„±æ‰‹åŠ¨ colse çš„åœ°ç‹±äº†ã€‚ è€Œ Pythonï¼Œåˆ™æ˜¯å®šä¹‰äº†ä¸¤ä¸ª Protocolï¼š__enter__ å’Œ __exit__. ä¸‹é¢æ˜¯ä¸€ä¸ª open çš„æ¨¡æ‹Ÿå®ç°ï¼š python3 class OpenContext(object): def __init__(self, filename, mode): # è°ƒç”¨ open(filename, mode) è¿”å›ä¸€ä¸ªå®ä¾‹ self.fp = open(filename, mode) def __enter__(self): # ç”¨ with ç®¡ç† __init__ è¿”å›çš„å®ä¾‹æ—¶ï¼Œwith ä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³• return self.fp # é€€å‡º with ä»£ç å—æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚ def __exit__(self, exc_type, exc_value, traceback): self.fp.close() # è¿™é‡Œå…ˆæ„é€ äº† OpenContext å®ä¾‹ï¼Œç„¶åç”¨ with ç®¡ç†è¯¥å®ä¾‹ with OpenContext('/tmp/a', 'a') as f: f.write('hello world') è¿™é‡Œå”¯ä¸€æœ‰ç‚¹å¤æ‚çš„ï¼Œå°±æ˜¯ __exit__ æ–¹æ³•ã€‚å’Œ Java ä¸€æ ·ï¼Œ__exit__ ç›¸å½“äºtry - catch - finally çš„ finally ä»£ç å—ï¼Œåœ¨å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå®ƒä¹Ÿä¼šè¢«è°ƒç”¨ã€‚ å½“æ²¡æœ‰å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œ__exit__ çš„ä¸‰ä¸ªå‚æ•° exc_type, exc_value, traceback éƒ½ä¸º Noneï¼Œè€Œå½“å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå®ƒä»¬å°±å¯¹åº”å¼‚å¸¸çš„è¯¦ç»†ä¿¡æ¯ã€‚å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œ __exit__ çš„è¿”å›å€¼å°†è¢«ç”¨äºå†³å®šæ˜¯å¦å‘å¤–å±‚æŠ›å‡ºè¯¥å¼‚å¸¸ï¼Œè¿”å› True åˆ™æŠ›å‡ºï¼Œè¿”å› False åˆ™æŠ‘åˆ¶ï¼ˆswallow itï¼‰ã€‚ Note 1ï¼šPython 3.6 æä¾›äº† async with å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œå®ƒçš„ Protocol å’ŒåŒæ­¥çš„ with å®Œå…¨ç±»ä¼¼ï¼Œæ˜¯ __aenter__ å’Œ __aexit__ ä¸¤ä¸ªæ–¹æ³•ã€‚Note 2ï¼šä¸ Java ç›¸åŒï¼Œwith æ”¯æŒåŒæ—¶ç®¡ç†å¤šä¸ªèµ„æºï¼Œå› æ­¤å¯ä»¥ç›´æ¥å†™ with open(x) as a, open(y) as b: è¿™æ ·çš„å½¢å¼ã€‚ 2. æ¨èï¼šcontextlib 2.1 @contextlib.contextmanagerå¯¹äºç®€å•çš„ with èµ„æºç®¡ç†ï¼Œç¼–å†™ä¸€ä¸ªç±»å¯èƒ½ä¼šæ˜¾å¾—æ¯”è¾ƒç¹çï¼Œä¸ºæ­¤ contextlib æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„è£…é¥°å™¨ @contextlib.contextmanager ç”¨æ¥ç®€åŒ–ä»£ç ã€‚ ä½¿ç”¨å®ƒï¼Œä¸Šé¢çš„ OpenContext å¯ä»¥æ”¹å†™æˆè¿™æ ·ï¼š python3 from contextlib import contextmanager @contextmanager def make_open_context(filename, mode): fp = open(filename, mode) try: yield fp # æ²¡é”™ï¼Œè¿™æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•° finally: fp.close() with make_open_context('/tmp/a', 'a') as f: f.write('hello world') ä½¿ç”¨ contextmanager è£…é¥°ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°ï¼Œyield ä¹‹å‰çš„ä»£ç å¯¹åº” __enter__ï¼Œfinally ä»£ç å—å°±å¯¹åº” __exit__. Noteï¼šåŒæ ·ï¼Œä¹Ÿæœ‰å¼‚æ­¥ç‰ˆæœ¬çš„è£…é¥°å™¨ @contextlib.asynccontextmanager 2.2 contextlib.closing(thing)ç”¨äºå°†åŸæœ¬ä¸æ”¯æŒ with ç®¡ç†çš„èµ„æºï¼ŒåŒ…è£…æˆä¸€ä¸ª Context å¯¹è±¡ã€‚ python3 from contextlib import closing from urllib.request import urlopen with closing(urlopen('http://www.python.org')) as page: for line in page: print(line) # closing ç­‰åŒäº from contextlib import contextmanager @contextmanager def closing(thing): try: yield thing finally: thing.close() # å°±æ˜¯æ·»åŠ äº†ä¸€ä¸ªè‡ªåŠ¨ close çš„åŠŸèƒ½ 2.3 contextlib.suppress(*exceptions)ä½¿ with ç®¡ç†å™¨æŠ‘åˆ¶ä»£ç å—å†…ä»»ä½•è¢«æŒ‡å®šçš„å¼‚å¸¸ï¼š python3 from contextlib import suppress with suppress(FileNotFoundError): os.remove('somefile.tmp') # ç­‰åŒäº try: os.remove('somefile.tmp') except FileNotFoundError: pass 2.4 contextlib.redirect_stdout(new_target)å°† with ä»£ç å—å†…çš„ stdout é‡å®šå‘åˆ°æŒ‡å®šçš„ targetï¼ˆå¯ç”¨äºæ”¶é›† stdout çš„è¾“å‡ºï¼‰ python3 f = io.StringIO() with redirect_stdout(f): # å°†è¾“å‡ºç›´æ¥å†™å…¥åˆ° StringIO help(pow) s = f.getvalue() # æˆ–è€…ç›´æ¥å†™å…¥åˆ°æ–‡ä»¶ with open('help.txt', 'w') as f: with redirect_stdout(f): help(pow) redirect_stdout å‡½æ•°è¿”å›çš„ Context æ˜¯å¯é‡å…¥çš„ï¼ˆ reentrantï¼‰ï¼Œå¯ä»¥é‡å¤ä½¿ç”¨ã€‚ ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:1:7","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#2-æ¨ècontextlib"},{"categories":["tech"],"content":" 7. ä¸Šä¸‹æ–‡ç®¡ç† - contextlibå³å®ç°ä½¿ç”¨ with è¯­å¥è¿›è¡Œè‡ªå®šä¹‰çš„ä¸Šä¸‹æ–‡ç®¡ç†ã€‚ 1. ä½¿ç”¨ __enter__ å’Œ __exit__Java ä½¿ç”¨ try æ¥è‡ªåŠ¨ç®¡ç†èµ„æºï¼Œåªè¦å®ç°äº† AutoCloseable æ¥å£ï¼Œå°±å¯ä»¥éƒ¨åˆ†æ‘†è„±æ‰‹åŠ¨ colse çš„åœ°ç‹±äº†ã€‚ è€Œ Pythonï¼Œåˆ™æ˜¯å®šä¹‰äº†ä¸¤ä¸ª Protocolï¼š__enter__ å’Œ __exit__. ä¸‹é¢æ˜¯ä¸€ä¸ª open çš„æ¨¡æ‹Ÿå®ç°ï¼š python3 class OpenContext(object): def __init__(self, filename, mode): # è°ƒç”¨ open(filename, mode) è¿”å›ä¸€ä¸ªå®ä¾‹ self.fp = open(filename, mode) def __enter__(self): # ç”¨ with ç®¡ç† __init__ è¿”å›çš„å®ä¾‹æ—¶ï¼Œwith ä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³• return self.fp # é€€å‡º with ä»£ç å—æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚ def __exit__(self, exc_type, exc_value, traceback): self.fp.close() # è¿™é‡Œå…ˆæ„é€ äº† OpenContext å®ä¾‹ï¼Œç„¶åç”¨ with ç®¡ç†è¯¥å®ä¾‹ with OpenContext('/tmp/a', 'a') as f: f.write('hello world') è¿™é‡Œå”¯ä¸€æœ‰ç‚¹å¤æ‚çš„ï¼Œå°±æ˜¯ __exit__ æ–¹æ³•ã€‚å’Œ Java ä¸€æ ·ï¼Œ__exit__ ç›¸å½“äºtry - catch - finally çš„ finally ä»£ç å—ï¼Œåœ¨å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå®ƒä¹Ÿä¼šè¢«è°ƒç”¨ã€‚ å½“æ²¡æœ‰å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œ__exit__ çš„ä¸‰ä¸ªå‚æ•° exc_type, exc_value, traceback éƒ½ä¸º Noneï¼Œè€Œå½“å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå®ƒä»¬å°±å¯¹åº”å¼‚å¸¸çš„è¯¦ç»†ä¿¡æ¯ã€‚å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œ __exit__ çš„è¿”å›å€¼å°†è¢«ç”¨äºå†³å®šæ˜¯å¦å‘å¤–å±‚æŠ›å‡ºè¯¥å¼‚å¸¸ï¼Œè¿”å› True åˆ™æŠ›å‡ºï¼Œè¿”å› False åˆ™æŠ‘åˆ¶ï¼ˆswallow itï¼‰ã€‚ Note 1ï¼šPython 3.6 æä¾›äº† async with å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œå®ƒçš„ Protocol å’ŒåŒæ­¥çš„ with å®Œå…¨ç±»ä¼¼ï¼Œæ˜¯ __aenter__ å’Œ __aexit__ ä¸¤ä¸ªæ–¹æ³•ã€‚Note 2ï¼šä¸ Java ç›¸åŒï¼Œwith æ”¯æŒåŒæ—¶ç®¡ç†å¤šä¸ªèµ„æºï¼Œå› æ­¤å¯ä»¥ç›´æ¥å†™ with open(x) as a, open(y) as b: è¿™æ ·çš„å½¢å¼ã€‚ 2. æ¨èï¼šcontextlib 2.1 @contextlib.contextmanagerå¯¹äºç®€å•çš„ with èµ„æºç®¡ç†ï¼Œç¼–å†™ä¸€ä¸ªç±»å¯èƒ½ä¼šæ˜¾å¾—æ¯”è¾ƒç¹çï¼Œä¸ºæ­¤ contextlib æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„è£…é¥°å™¨ @contextlib.contextmanager ç”¨æ¥ç®€åŒ–ä»£ç ã€‚ ä½¿ç”¨å®ƒï¼Œä¸Šé¢çš„ OpenContext å¯ä»¥æ”¹å†™æˆè¿™æ ·ï¼š python3 from contextlib import contextmanager @contextmanager def make_open_context(filename, mode): fp = open(filename, mode) try: yield fp # æ²¡é”™ï¼Œè¿™æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•° finally: fp.close() with make_open_context('/tmp/a', 'a') as f: f.write('hello world') ä½¿ç”¨ contextmanager è£…é¥°ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°ï¼Œyield ä¹‹å‰çš„ä»£ç å¯¹åº” __enter__ï¼Œfinally ä»£ç å—å°±å¯¹åº” __exit__. Noteï¼šåŒæ ·ï¼Œä¹Ÿæœ‰å¼‚æ­¥ç‰ˆæœ¬çš„è£…é¥°å™¨ @contextlib.asynccontextmanager 2.2 contextlib.closing(thing)ç”¨äºå°†åŸæœ¬ä¸æ”¯æŒ with ç®¡ç†çš„èµ„æºï¼ŒåŒ…è£…æˆä¸€ä¸ª Context å¯¹è±¡ã€‚ python3 from contextlib import closing from urllib.request import urlopen with closing(urlopen('http://www.python.org')) as page: for line in page: print(line) # closing ç­‰åŒäº from contextlib import contextmanager @contextmanager def closing(thing): try: yield thing finally: thing.close() # å°±æ˜¯æ·»åŠ äº†ä¸€ä¸ªè‡ªåŠ¨ close çš„åŠŸèƒ½ 2.3 contextlib.suppress(*exceptions)ä½¿ with ç®¡ç†å™¨æŠ‘åˆ¶ä»£ç å—å†…ä»»ä½•è¢«æŒ‡å®šçš„å¼‚å¸¸ï¼š python3 from contextlib import suppress with suppress(FileNotFoundError): os.remove('somefile.tmp') # ç­‰åŒäº try: os.remove('somefile.tmp') except FileNotFoundError: pass 2.4 contextlib.redirect_stdout(new_target)å°† with ä»£ç å—å†…çš„ stdout é‡å®šå‘åˆ°æŒ‡å®šçš„ targetï¼ˆå¯ç”¨äºæ”¶é›† stdout çš„è¾“å‡ºï¼‰ python3 f = io.StringIO() with redirect_stdout(f): # å°†è¾“å‡ºç›´æ¥å†™å…¥åˆ° StringIO help(pow) s = f.getvalue() # æˆ–è€…ç›´æ¥å†™å…¥åˆ°æ–‡ä»¶ with open('help.txt', 'w') as f: with redirect_stdout(f): help(pow) redirect_stdout å‡½æ•°è¿”å›çš„ Context æ˜¯å¯é‡å…¥çš„ï¼ˆ reentrantï¼‰ï¼Œå¯ä»¥é‡å¤ä½¿ç”¨ã€‚ ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:1:7","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#21-contextlibcontextmanager"},{"categories":["tech"],"content":" 7. ä¸Šä¸‹æ–‡ç®¡ç† - contextlibå³å®ç°ä½¿ç”¨ with è¯­å¥è¿›è¡Œè‡ªå®šä¹‰çš„ä¸Šä¸‹æ–‡ç®¡ç†ã€‚ 1. ä½¿ç”¨ __enter__ å’Œ __exit__Java ä½¿ç”¨ try æ¥è‡ªåŠ¨ç®¡ç†èµ„æºï¼Œåªè¦å®ç°äº† AutoCloseable æ¥å£ï¼Œå°±å¯ä»¥éƒ¨åˆ†æ‘†è„±æ‰‹åŠ¨ colse çš„åœ°ç‹±äº†ã€‚ è€Œ Pythonï¼Œåˆ™æ˜¯å®šä¹‰äº†ä¸¤ä¸ª Protocolï¼š__enter__ å’Œ __exit__. ä¸‹é¢æ˜¯ä¸€ä¸ª open çš„æ¨¡æ‹Ÿå®ç°ï¼š python3 class OpenContext(object): def __init__(self, filename, mode): # è°ƒç”¨ open(filename, mode) è¿”å›ä¸€ä¸ªå®ä¾‹ self.fp = open(filename, mode) def __enter__(self): # ç”¨ with ç®¡ç† __init__ è¿”å›çš„å®ä¾‹æ—¶ï¼Œwith ä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³• return self.fp # é€€å‡º with ä»£ç å—æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚ def __exit__(self, exc_type, exc_value, traceback): self.fp.close() # è¿™é‡Œå…ˆæ„é€ äº† OpenContext å®ä¾‹ï¼Œç„¶åç”¨ with ç®¡ç†è¯¥å®ä¾‹ with OpenContext('/tmp/a', 'a') as f: f.write('hello world') è¿™é‡Œå”¯ä¸€æœ‰ç‚¹å¤æ‚çš„ï¼Œå°±æ˜¯ __exit__ æ–¹æ³•ã€‚å’Œ Java ä¸€æ ·ï¼Œ__exit__ ç›¸å½“äºtry - catch - finally çš„ finally ä»£ç å—ï¼Œåœ¨å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå®ƒä¹Ÿä¼šè¢«è°ƒç”¨ã€‚ å½“æ²¡æœ‰å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œ__exit__ çš„ä¸‰ä¸ªå‚æ•° exc_type, exc_value, traceback éƒ½ä¸º Noneï¼Œè€Œå½“å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå®ƒä»¬å°±å¯¹åº”å¼‚å¸¸çš„è¯¦ç»†ä¿¡æ¯ã€‚å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œ __exit__ çš„è¿”å›å€¼å°†è¢«ç”¨äºå†³å®šæ˜¯å¦å‘å¤–å±‚æŠ›å‡ºè¯¥å¼‚å¸¸ï¼Œè¿”å› True åˆ™æŠ›å‡ºï¼Œè¿”å› False åˆ™æŠ‘åˆ¶ï¼ˆswallow itï¼‰ã€‚ Note 1ï¼šPython 3.6 æä¾›äº† async with å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œå®ƒçš„ Protocol å’ŒåŒæ­¥çš„ with å®Œå…¨ç±»ä¼¼ï¼Œæ˜¯ __aenter__ å’Œ __aexit__ ä¸¤ä¸ªæ–¹æ³•ã€‚Note 2ï¼šä¸ Java ç›¸åŒï¼Œwith æ”¯æŒåŒæ—¶ç®¡ç†å¤šä¸ªèµ„æºï¼Œå› æ­¤å¯ä»¥ç›´æ¥å†™ with open(x) as a, open(y) as b: è¿™æ ·çš„å½¢å¼ã€‚ 2. æ¨èï¼šcontextlib 2.1 @contextlib.contextmanagerå¯¹äºç®€å•çš„ with èµ„æºç®¡ç†ï¼Œç¼–å†™ä¸€ä¸ªç±»å¯èƒ½ä¼šæ˜¾å¾—æ¯”è¾ƒç¹çï¼Œä¸ºæ­¤ contextlib æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„è£…é¥°å™¨ @contextlib.contextmanager ç”¨æ¥ç®€åŒ–ä»£ç ã€‚ ä½¿ç”¨å®ƒï¼Œä¸Šé¢çš„ OpenContext å¯ä»¥æ”¹å†™æˆè¿™æ ·ï¼š python3 from contextlib import contextmanager @contextmanager def make_open_context(filename, mode): fp = open(filename, mode) try: yield fp # æ²¡é”™ï¼Œè¿™æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•° finally: fp.close() with make_open_context('/tmp/a', 'a') as f: f.write('hello world') ä½¿ç”¨ contextmanager è£…é¥°ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°ï¼Œyield ä¹‹å‰çš„ä»£ç å¯¹åº” __enter__ï¼Œfinally ä»£ç å—å°±å¯¹åº” __exit__. Noteï¼šåŒæ ·ï¼Œä¹Ÿæœ‰å¼‚æ­¥ç‰ˆæœ¬çš„è£…é¥°å™¨ @contextlib.asynccontextmanager 2.2 contextlib.closing(thing)ç”¨äºå°†åŸæœ¬ä¸æ”¯æŒ with ç®¡ç†çš„èµ„æºï¼ŒåŒ…è£…æˆä¸€ä¸ª Context å¯¹è±¡ã€‚ python3 from contextlib import closing from urllib.request import urlopen with closing(urlopen('http://www.python.org')) as page: for line in page: print(line) # closing ç­‰åŒäº from contextlib import contextmanager @contextmanager def closing(thing): try: yield thing finally: thing.close() # å°±æ˜¯æ·»åŠ äº†ä¸€ä¸ªè‡ªåŠ¨ close çš„åŠŸèƒ½ 2.3 contextlib.suppress(*exceptions)ä½¿ with ç®¡ç†å™¨æŠ‘åˆ¶ä»£ç å—å†…ä»»ä½•è¢«æŒ‡å®šçš„å¼‚å¸¸ï¼š python3 from contextlib import suppress with suppress(FileNotFoundError): os.remove('somefile.tmp') # ç­‰åŒäº try: os.remove('somefile.tmp') except FileNotFoundError: pass 2.4 contextlib.redirect_stdout(new_target)å°† with ä»£ç å—å†…çš„ stdout é‡å®šå‘åˆ°æŒ‡å®šçš„ targetï¼ˆå¯ç”¨äºæ”¶é›† stdout çš„è¾“å‡ºï¼‰ python3 f = io.StringIO() with redirect_stdout(f): # å°†è¾“å‡ºç›´æ¥å†™å…¥åˆ° StringIO help(pow) s = f.getvalue() # æˆ–è€…ç›´æ¥å†™å…¥åˆ°æ–‡ä»¶ with open('help.txt', 'w') as f: with redirect_stdout(f): help(pow) redirect_stdout å‡½æ•°è¿”å›çš„ Context æ˜¯å¯é‡å…¥çš„ï¼ˆ reentrantï¼‰ï¼Œå¯ä»¥é‡å¤ä½¿ç”¨ã€‚ ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:1:7","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#22-contextlibclosingthing"},{"categories":["tech"],"content":" 7. ä¸Šä¸‹æ–‡ç®¡ç† - contextlibå³å®ç°ä½¿ç”¨ with è¯­å¥è¿›è¡Œè‡ªå®šä¹‰çš„ä¸Šä¸‹æ–‡ç®¡ç†ã€‚ 1. ä½¿ç”¨ __enter__ å’Œ __exit__Java ä½¿ç”¨ try æ¥è‡ªåŠ¨ç®¡ç†èµ„æºï¼Œåªè¦å®ç°äº† AutoCloseable æ¥å£ï¼Œå°±å¯ä»¥éƒ¨åˆ†æ‘†è„±æ‰‹åŠ¨ colse çš„åœ°ç‹±äº†ã€‚ è€Œ Pythonï¼Œåˆ™æ˜¯å®šä¹‰äº†ä¸¤ä¸ª Protocolï¼š__enter__ å’Œ __exit__. ä¸‹é¢æ˜¯ä¸€ä¸ª open çš„æ¨¡æ‹Ÿå®ç°ï¼š python3 class OpenContext(object): def __init__(self, filename, mode): # è°ƒç”¨ open(filename, mode) è¿”å›ä¸€ä¸ªå®ä¾‹ self.fp = open(filename, mode) def __enter__(self): # ç”¨ with ç®¡ç† __init__ è¿”å›çš„å®ä¾‹æ—¶ï¼Œwith ä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³• return self.fp # é€€å‡º with ä»£ç å—æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚ def __exit__(self, exc_type, exc_value, traceback): self.fp.close() # è¿™é‡Œå…ˆæ„é€ äº† OpenContext å®ä¾‹ï¼Œç„¶åç”¨ with ç®¡ç†è¯¥å®ä¾‹ with OpenContext('/tmp/a', 'a') as f: f.write('hello world') è¿™é‡Œå”¯ä¸€æœ‰ç‚¹å¤æ‚çš„ï¼Œå°±æ˜¯ __exit__ æ–¹æ³•ã€‚å’Œ Java ä¸€æ ·ï¼Œ__exit__ ç›¸å½“äºtry - catch - finally çš„ finally ä»£ç å—ï¼Œåœ¨å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå®ƒä¹Ÿä¼šè¢«è°ƒç”¨ã€‚ å½“æ²¡æœ‰å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œ__exit__ çš„ä¸‰ä¸ªå‚æ•° exc_type, exc_value, traceback éƒ½ä¸º Noneï¼Œè€Œå½“å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå®ƒä»¬å°±å¯¹åº”å¼‚å¸¸çš„è¯¦ç»†ä¿¡æ¯ã€‚å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œ __exit__ çš„è¿”å›å€¼å°†è¢«ç”¨äºå†³å®šæ˜¯å¦å‘å¤–å±‚æŠ›å‡ºè¯¥å¼‚å¸¸ï¼Œè¿”å› True åˆ™æŠ›å‡ºï¼Œè¿”å› False åˆ™æŠ‘åˆ¶ï¼ˆswallow itï¼‰ã€‚ Note 1ï¼šPython 3.6 æä¾›äº† async with å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œå®ƒçš„ Protocol å’ŒåŒæ­¥çš„ with å®Œå…¨ç±»ä¼¼ï¼Œæ˜¯ __aenter__ å’Œ __aexit__ ä¸¤ä¸ªæ–¹æ³•ã€‚Note 2ï¼šä¸ Java ç›¸åŒï¼Œwith æ”¯æŒåŒæ—¶ç®¡ç†å¤šä¸ªèµ„æºï¼Œå› æ­¤å¯ä»¥ç›´æ¥å†™ with open(x) as a, open(y) as b: è¿™æ ·çš„å½¢å¼ã€‚ 2. æ¨èï¼šcontextlib 2.1 @contextlib.contextmanagerå¯¹äºç®€å•çš„ with èµ„æºç®¡ç†ï¼Œç¼–å†™ä¸€ä¸ªç±»å¯èƒ½ä¼šæ˜¾å¾—æ¯”è¾ƒç¹çï¼Œä¸ºæ­¤ contextlib æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„è£…é¥°å™¨ @contextlib.contextmanager ç”¨æ¥ç®€åŒ–ä»£ç ã€‚ ä½¿ç”¨å®ƒï¼Œä¸Šé¢çš„ OpenContext å¯ä»¥æ”¹å†™æˆè¿™æ ·ï¼š python3 from contextlib import contextmanager @contextmanager def make_open_context(filename, mode): fp = open(filename, mode) try: yield fp # æ²¡é”™ï¼Œè¿™æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•° finally: fp.close() with make_open_context('/tmp/a', 'a') as f: f.write('hello world') ä½¿ç”¨ contextmanager è£…é¥°ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°ï¼Œyield ä¹‹å‰çš„ä»£ç å¯¹åº” __enter__ï¼Œfinally ä»£ç å—å°±å¯¹åº” __exit__. Noteï¼šåŒæ ·ï¼Œä¹Ÿæœ‰å¼‚æ­¥ç‰ˆæœ¬çš„è£…é¥°å™¨ @contextlib.asynccontextmanager 2.2 contextlib.closing(thing)ç”¨äºå°†åŸæœ¬ä¸æ”¯æŒ with ç®¡ç†çš„èµ„æºï¼ŒåŒ…è£…æˆä¸€ä¸ª Context å¯¹è±¡ã€‚ python3 from contextlib import closing from urllib.request import urlopen with closing(urlopen('http://www.python.org')) as page: for line in page: print(line) # closing ç­‰åŒäº from contextlib import contextmanager @contextmanager def closing(thing): try: yield thing finally: thing.close() # å°±æ˜¯æ·»åŠ äº†ä¸€ä¸ªè‡ªåŠ¨ close çš„åŠŸèƒ½ 2.3 contextlib.suppress(*exceptions)ä½¿ with ç®¡ç†å™¨æŠ‘åˆ¶ä»£ç å—å†…ä»»ä½•è¢«æŒ‡å®šçš„å¼‚å¸¸ï¼š python3 from contextlib import suppress with suppress(FileNotFoundError): os.remove('somefile.tmp') # ç­‰åŒäº try: os.remove('somefile.tmp') except FileNotFoundError: pass 2.4 contextlib.redirect_stdout(new_target)å°† with ä»£ç å—å†…çš„ stdout é‡å®šå‘åˆ°æŒ‡å®šçš„ targetï¼ˆå¯ç”¨äºæ”¶é›† stdout çš„è¾“å‡ºï¼‰ python3 f = io.StringIO() with redirect_stdout(f): # å°†è¾“å‡ºç›´æ¥å†™å…¥åˆ° StringIO help(pow) s = f.getvalue() # æˆ–è€…ç›´æ¥å†™å…¥åˆ°æ–‡ä»¶ with open('help.txt', 'w') as f: with redirect_stdout(f): help(pow) redirect_stdout å‡½æ•°è¿”å›çš„ Context æ˜¯å¯é‡å…¥çš„ï¼ˆ reentrantï¼‰ï¼Œå¯ä»¥é‡å¤ä½¿ç”¨ã€‚ ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:1:7","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#23-contextlibsuppressexceptions"},{"categories":["tech"],"content":" 7. ä¸Šä¸‹æ–‡ç®¡ç† - contextlibå³å®ç°ä½¿ç”¨ with è¯­å¥è¿›è¡Œè‡ªå®šä¹‰çš„ä¸Šä¸‹æ–‡ç®¡ç†ã€‚ 1. ä½¿ç”¨ __enter__ å’Œ __exit__Java ä½¿ç”¨ try æ¥è‡ªåŠ¨ç®¡ç†èµ„æºï¼Œåªè¦å®ç°äº† AutoCloseable æ¥å£ï¼Œå°±å¯ä»¥éƒ¨åˆ†æ‘†è„±æ‰‹åŠ¨ colse çš„åœ°ç‹±äº†ã€‚ è€Œ Pythonï¼Œåˆ™æ˜¯å®šä¹‰äº†ä¸¤ä¸ª Protocolï¼š__enter__ å’Œ __exit__. ä¸‹é¢æ˜¯ä¸€ä¸ª open çš„æ¨¡æ‹Ÿå®ç°ï¼š python3 class OpenContext(object): def __init__(self, filename, mode): # è°ƒç”¨ open(filename, mode) è¿”å›ä¸€ä¸ªå®ä¾‹ self.fp = open(filename, mode) def __enter__(self): # ç”¨ with ç®¡ç† __init__ è¿”å›çš„å®ä¾‹æ—¶ï¼Œwith ä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³• return self.fp # é€€å‡º with ä»£ç å—æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚ def __exit__(self, exc_type, exc_value, traceback): self.fp.close() # è¿™é‡Œå…ˆæ„é€ äº† OpenContext å®ä¾‹ï¼Œç„¶åç”¨ with ç®¡ç†è¯¥å®ä¾‹ with OpenContext('/tmp/a', 'a') as f: f.write('hello world') è¿™é‡Œå”¯ä¸€æœ‰ç‚¹å¤æ‚çš„ï¼Œå°±æ˜¯ __exit__ æ–¹æ³•ã€‚å’Œ Java ä¸€æ ·ï¼Œ__exit__ ç›¸å½“äºtry - catch - finally çš„ finally ä»£ç å—ï¼Œåœ¨å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå®ƒä¹Ÿä¼šè¢«è°ƒç”¨ã€‚ å½“æ²¡æœ‰å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œ__exit__ çš„ä¸‰ä¸ªå‚æ•° exc_type, exc_value, traceback éƒ½ä¸º Noneï¼Œè€Œå½“å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå®ƒä»¬å°±å¯¹åº”å¼‚å¸¸çš„è¯¦ç»†ä¿¡æ¯ã€‚å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œ __exit__ çš„è¿”å›å€¼å°†è¢«ç”¨äºå†³å®šæ˜¯å¦å‘å¤–å±‚æŠ›å‡ºè¯¥å¼‚å¸¸ï¼Œè¿”å› True åˆ™æŠ›å‡ºï¼Œè¿”å› False åˆ™æŠ‘åˆ¶ï¼ˆswallow itï¼‰ã€‚ Note 1ï¼šPython 3.6 æä¾›äº† async with å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œå®ƒçš„ Protocol å’ŒåŒæ­¥çš„ with å®Œå…¨ç±»ä¼¼ï¼Œæ˜¯ __aenter__ å’Œ __aexit__ ä¸¤ä¸ªæ–¹æ³•ã€‚Note 2ï¼šä¸ Java ç›¸åŒï¼Œwith æ”¯æŒåŒæ—¶ç®¡ç†å¤šä¸ªèµ„æºï¼Œå› æ­¤å¯ä»¥ç›´æ¥å†™ with open(x) as a, open(y) as b: è¿™æ ·çš„å½¢å¼ã€‚ 2. æ¨èï¼šcontextlib 2.1 @contextlib.contextmanagerå¯¹äºç®€å•çš„ with èµ„æºç®¡ç†ï¼Œç¼–å†™ä¸€ä¸ªç±»å¯èƒ½ä¼šæ˜¾å¾—æ¯”è¾ƒç¹çï¼Œä¸ºæ­¤ contextlib æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„è£…é¥°å™¨ @contextlib.contextmanager ç”¨æ¥ç®€åŒ–ä»£ç ã€‚ ä½¿ç”¨å®ƒï¼Œä¸Šé¢çš„ OpenContext å¯ä»¥æ”¹å†™æˆè¿™æ ·ï¼š python3 from contextlib import contextmanager @contextmanager def make_open_context(filename, mode): fp = open(filename, mode) try: yield fp # æ²¡é”™ï¼Œè¿™æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•° finally: fp.close() with make_open_context('/tmp/a', 'a') as f: f.write('hello world') ä½¿ç”¨ contextmanager è£…é¥°ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°ï¼Œyield ä¹‹å‰çš„ä»£ç å¯¹åº” __enter__ï¼Œfinally ä»£ç å—å°±å¯¹åº” __exit__. Noteï¼šåŒæ ·ï¼Œä¹Ÿæœ‰å¼‚æ­¥ç‰ˆæœ¬çš„è£…é¥°å™¨ @contextlib.asynccontextmanager 2.2 contextlib.closing(thing)ç”¨äºå°†åŸæœ¬ä¸æ”¯æŒ with ç®¡ç†çš„èµ„æºï¼ŒåŒ…è£…æˆä¸€ä¸ª Context å¯¹è±¡ã€‚ python3 from contextlib import closing from urllib.request import urlopen with closing(urlopen('http://www.python.org')) as page: for line in page: print(line) # closing ç­‰åŒäº from contextlib import contextmanager @contextmanager def closing(thing): try: yield thing finally: thing.close() # å°±æ˜¯æ·»åŠ äº†ä¸€ä¸ªè‡ªåŠ¨ close çš„åŠŸèƒ½ 2.3 contextlib.suppress(*exceptions)ä½¿ with ç®¡ç†å™¨æŠ‘åˆ¶ä»£ç å—å†…ä»»ä½•è¢«æŒ‡å®šçš„å¼‚å¸¸ï¼š python3 from contextlib import suppress with suppress(FileNotFoundError): os.remove('somefile.tmp') # ç­‰åŒäº try: os.remove('somefile.tmp') except FileNotFoundError: pass 2.4 contextlib.redirect_stdout(new_target)å°† with ä»£ç å—å†…çš„ stdout é‡å®šå‘åˆ°æŒ‡å®šçš„ targetï¼ˆå¯ç”¨äºæ”¶é›† stdout çš„è¾“å‡ºï¼‰ python3 f = io.StringIO() with redirect_stdout(f): # å°†è¾“å‡ºç›´æ¥å†™å…¥åˆ° StringIO help(pow) s = f.getvalue() # æˆ–è€…ç›´æ¥å†™å…¥åˆ°æ–‡ä»¶ with open('help.txt', 'w') as f: with redirect_stdout(f): help(pow) redirect_stdout å‡½æ•°è¿”å›çš„ Context æ˜¯å¯é‡å…¥çš„ï¼ˆ reentrantï¼‰ï¼Œå¯ä»¥é‡å¤ä½¿ç”¨ã€‚ ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:1:7","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#24-contextlibredirect_stdoutnew_target"},{"categories":["tech"],"content":" äºŒã€å®ç”¨ä»£ç ç‰‡æ®µ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:2:0","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#äºŒå®ç”¨ä»£ç ç‰‡æ®µ"},{"categories":["tech"],"content":" 1. å…ƒç´ åˆ†ç»„/groupæ•°æ®å¤„ç†ä¸­ä¸€ä¸ªå¸¸è§çš„æ“ä½œï¼Œæ˜¯å°†åˆ—è¡¨ä¸­çš„å…ƒç´ ï¼Œä¾æ¬¡æ¯ k ä¸ªåˆ†ä½œä¸€ç»„ã€‚ ä¸‹é¢çš„å‡½æ•°ä½¿ç”¨éå¸¸ç®€æ´çš„ä»£ç å®ç°äº†å…ƒç´ åˆ†ç»„çš„åŠŸèƒ½ï¼š python3 from itertools import zip_longest def group_each(a, size: int, longest=False): \"\"\" å°†ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ a å†…çš„å…ƒç´ , æ¯ size ä¸ªåˆ†ä¸ºä¸€ç»„ group_each([1,2,3,4], 2) -\u003e [(1,2), (3,4)] \"\"\" iterators = [iter(a)] * size # å°†æ–°æ„é€ çš„ iterator å¤åˆ¶ size æ¬¡ï¼ˆæµ…å¤åˆ¶ï¼‰ func_zip = zip_longest if longest else zip return func_zip(*iterators) # ç„¶å zip a = \"abcdefghijk\" list(group_each(a, 3)) # =\u003e [('a', 'b', 'c'), ('d', 'e', 'f'), ('g', 'h', 'i')] list(group_each(a, 3, longest=True)) # =\u003e [('a', 'b', 'c'), ('d', 'e', 'f'), ('g', 'h', 'i'), ('j', 'k', None)] è¿™ä¸ªå‡½æ•°è¿˜å¯ä»¥è¿›ä¸€æ­¥ç®€åŒ–ä¸º zip(*[iter(a)] * 3)ï¼Œå¦‚æœæ²¡æƒ³åˆ°æµ…å¤åˆ¶ï¼ˆShallow Copyï¼‰ç‰¹æ€§çš„è¯ï¼Œä¼šå¾ˆéš¾ç†è§£å®ƒçš„é€»è¾‘ã€‚ æ­¤å¤–ï¼Œå¦‚æœæŸä¸ª size æ¯”è¾ƒå¸¸ç”¨ï¼ˆæ¯”å¦‚ 2ï¼‰ï¼Œè¿˜å¯ä»¥ç”¨ partial å°è£…ä¸€ä¸‹ï¼š python3 from functools import partial # æ¯ä¸¤ä¸ªåˆ†ä¸€ç»„ group_each_2 = partial(group_each, size=2) # ç­‰åŒäº group_each_2 = lambda a: group_each(a, 2) a = \"abcde\" list(group_each_2(a)) # =\u003e [('a', 'b'), ('c', 'd')] list(group_each_2(a, longest=True)) # =\u003e [('a', 'b'), ('c', 'd'), ('e', None)] ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:2:1","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#group_size"},{"categories":["tech"],"content":" 2. æ‰å¹³ç‰ˆæœ¬çš„ mapç¨å¾®æ¥è§¦è¿‡å‡½æ•°å¼åº”è¯¥éƒ½çŸ¥é“ flat_mapï¼Œå¯ Python æ ‡å‡†åº“å´æ²¡æœ‰æä¾›ã€‚ä¸‹é¢æ˜¯æˆ‘åœ¨ stackoverflow ä¸Šæ‰¾åˆ°çš„å®ç°ï¼Œå…¶å®å¾ˆç®€å• python3 from itertools import chain def flat_map(f, items): return chain.from_iterable(map(f, items)) å®ƒå’Œ map çš„å·®åˆ«åœ¨äºæ˜¯ä¸æ˜¯æ‰å¹³(flat) çš„ï¼ˆåºŸè¯ã€‚ã€‚ï¼‰ï¼Œä¸¾ä¸ªä¾‹å­ ipython \u003e\u003e\u003e list(map(list, ['123', '456'])) [['1', '2', '3'], ['4', '5', '6']] \u003e\u003e\u003e list(flat_map(list, ['123', '456'])) ['1', '2', '3', '4', '5', '6'] ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:2:2","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#2-æ‰å¹³ç‰ˆæœ¬çš„-map"},{"categories":["tech"],"content":" 3. è½®æµè¿­ä»£å¤šä¸ªè¿­ä»£å™¨å‡è®¾æˆ‘æœ‰å¤šä¸ªå¯è¿­ä»£å¯¹è±¡ï¼ˆè¿­ä»£å™¨ã€åˆ—è¡¨ç­‰ï¼‰ï¼Œç°åœ¨æˆ‘éœ€è¦æ¯æ¬¡ä»æ¯ä¸ªå¯¹è±¡ä¸­å–ä¸€ä¸ªå€¼ï¼Œç›´åˆ°æŸä¸ªå¯¹è±¡ä¸ºç©ºã€‚å¦‚æœç”¨å¾ªç¯å†™ä¼šæ¯”è¾ƒç¹çï¼Œä½†æ˜¯ç”¨ itertools å¯ä»¥è¿™æ ·å†™ï¼š python from itertools import chain def iter_one_by_one(items): return chain.from_iterable(zip(*items)) a = [1,2,3] b = [4,5,6] c = [7,8,9,10] list(iter_one_by_one([a,b,c])) # =\u003e [1, 4, 7, 2, 5, 8, 3, 6, 9] ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:2:3","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#3-è½®æµè¿­ä»£å¤šä¸ªè¿­ä»£å™¨"},{"categories":["tech"],"content":" 4. å¤š dict çš„å»é‡å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª dict çš„åˆ—è¡¨ï¼Œé‡Œé¢å¯èƒ½æœ‰å†…å®¹ä¸€æ¨¡ä¸€æ ·çš„ dictï¼Œæˆ‘ä»¬éœ€è¦å¯¹å®ƒåšå»é‡ã€‚å®¹æ˜“æƒ³åˆ°çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨ setï¼Œå¯æ˜¯ set ä¸­çš„å…ƒç´ å¿…é¡»æ˜¯ hashable çš„ï¼Œè€Œ dict æ˜¯ unhashable çš„ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥æ”¾è¿› set é‡Œã€‚ ipython \u003e\u003e\u003e a = [{'a': 1}, {'a': 1}, {'b': 2}] \u003e\u003e\u003e set(a) Traceback (most recent call last): File \"/usr/local/lib/python3.7/site-packages/IPython/core/interactiveshell.py\", line 2961, in run_code exec(code_obj, self.user_global_ns, self.user_ns) File \"\u003cipython-input-5-5b4c643a6feb\u003e\", line 1, in \u003cmodule\u003e set(a) TypeError: unhashable type: 'dict' éš¾é“å°±å¿…é¡»æ‰‹å†™é€’å½’äº†ä¹ˆï¼Ÿæœªå¿…ï¼Œæˆ‘åœ¨ stackoverflow çœ‹åˆ°è¿™æ ·ä¸€ä¸ªå°æŠ€å·§ python3 import json def unique_dicts(data_list: list): \"\"\"unique a list of dict dict æ˜¯ unhashable çš„ï¼Œä¸èƒ½æ”¾å…¥ set ä¸­ï¼Œæ‰€ä»¥å…ˆè½¬æ¢æˆ str unique_dicts([{'a': 1}, {'a': 1}, {'b': 2}]) -\u003e [{'a': 1}, {'b': 2}] \"\"\" data_json_set = set(json.dumps(item) for item in data_list) return [json.loads(item) for item in data_json_set] ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:2:4","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#4-å¤š-dict-çš„å»é‡"},{"categories":["tech"],"content":" 5. str çš„ startswith å’Œ endswith çš„å‚æ•°å¯ä»¥æ˜¯å…ƒç»„ ipython3 In[7]: a = \"bb.gif\" In[8]: b = 'a.jpg' In[9]: a.endswith(('.jpg', '.gif')) Out[9]: True In[10]: b.startswith(('bb', 'a')) Out[10]: True ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:2:5","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#5-str-çš„-startswith-å’Œ-endswith-çš„å‚æ•°å¯ä»¥æ˜¯å…ƒç»„"},{"categories":["tech"],"content":" 6. åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡çš„æ‰€æœ‰å±æ€§éƒ½ç›¸åŒpython å’Œ java ä¸€æ ·ï¼Œç›´æ¥ç”¨ == åšåˆ¤æ–­ï¼Œé»˜è®¤æ˜¯æ¯”è¾ƒçš„å¼•ç”¨ï¼Œç›¸å½“äº isã€‚å¯¹è‡ªå®šä¹‰çš„ç±»ï¼Œä½ éœ€è¦é‡å†™ __eq__ å‡½æ•°ã€‚åˆ¤æ–­å€¼ç›¸ç­‰çš„æ–¹æ³•å¾ˆç®€å•ï¼Œä¸€è¡Œä»£ç ï¼š python3 class A: ... def __eq__(self, obj): return self.__dict__ == obj.__dict__ # è½¬æˆ __dict__ å†æ¯”è¾ƒ ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:2:6","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#6-åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡çš„æ‰€æœ‰å±æ€§éƒ½ç›¸åŒ"},{"categories":["tech"],"content":" 7. æ¡ˆä¾‹ 7.1 html table å…ƒç´ çš„å¤„ç†åœ¨åšçˆ¬è™«å·¥ä½œæ—¶ï¼Œæœ‰æ—¶ä¼šé‡åˆ°è¿™æ ·çš„ table å…ƒç´ ï¼š å¯¹è¿™ç§ html å…ƒç´ ï¼Œæˆ‘ä¸€èˆ¬ä¼šç›´æ¥æŠŠå®ƒè½¬æ¢æˆ listï¼Œç»“æœå¦‚ä¸‹ï¼š python3 table = [['label1', 'value1', 'label2', 'value2'], ['label3', 'value3'], ['label4', 'value4', 'label5', 'value5'], ... ] ä¸ºäº†æ–¹ä¾¿ç´¢å¼•ï¼Œç°åœ¨æˆ‘éœ€è¦æŠŠä¸Šé¢çš„æ•°æ®è½¬æ¢æˆä¸‹é¢è¿™ä¸ªæ ·å­çš„ dict python { 'label1': 'value1', 'label2': 'value2', 'label3': 'value3', 'label4': 'value4', 'label5': 'value5' } å¦‚æœæ˜¯å¹³å¸¸ï¼Œå¤§æ¦‚éœ€è¦å†™å¾ªç¯äº†ã€‚ä¸è¿‡å¦‚æœç”¨åˆšåˆšè¯´åˆ°çš„å‡ ä¸ªå‡½æ•°çš„è¯ï¼Œä¼šå˜å¾—å¼‚å¸¸ç®€å• text # 1. åˆ†ç»„ groups = flat_map(group_each_2, table) # 1.1 flat_map è¿”å›çš„æ˜¯è¿­ä»£å™¨ï¼Œlist åå†…å®¹å¦‚ä¸‹ï¼š # [('label1', 'value1'), # ('label2', 'value2'), # ('label3', 'value3'), # ('label4', 'value4'), # ('label5', 'value5')] # 2. è½¬æ¢æˆ dict key_values = dict(groups) # å¾—åˆ°çš„ key_values ä¸ä¸Šé¢éœ€è¦çš„ dict åˆ«æ— äºŒè‡´ã€‚ ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:2:7","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#7-æ¡ˆä¾‹"},{"categories":["tech"],"content":" 7. æ¡ˆä¾‹ 7.1 html table å…ƒç´ çš„å¤„ç†åœ¨åšçˆ¬è™«å·¥ä½œæ—¶ï¼Œæœ‰æ—¶ä¼šé‡åˆ°è¿™æ ·çš„ table å…ƒç´ ï¼š å¯¹è¿™ç§ html å…ƒç´ ï¼Œæˆ‘ä¸€èˆ¬ä¼šç›´æ¥æŠŠå®ƒè½¬æ¢æˆ listï¼Œç»“æœå¦‚ä¸‹ï¼š python3 table = [['label1', 'value1', 'label2', 'value2'], ['label3', 'value3'], ['label4', 'value4', 'label5', 'value5'], ... ] ä¸ºäº†æ–¹ä¾¿ç´¢å¼•ï¼Œç°åœ¨æˆ‘éœ€è¦æŠŠä¸Šé¢çš„æ•°æ®è½¬æ¢æˆä¸‹é¢è¿™ä¸ªæ ·å­çš„ dict python { 'label1': 'value1', 'label2': 'value2', 'label3': 'value3', 'label4': 'value4', 'label5': 'value5' } å¦‚æœæ˜¯å¹³å¸¸ï¼Œå¤§æ¦‚éœ€è¦å†™å¾ªç¯äº†ã€‚ä¸è¿‡å¦‚æœç”¨åˆšåˆšè¯´åˆ°çš„å‡ ä¸ªå‡½æ•°çš„è¯ï¼Œä¼šå˜å¾—å¼‚å¸¸ç®€å• text # 1. åˆ†ç»„ groups = flat_map(group_each_2, table) # 1.1 flat_map è¿”å›çš„æ˜¯è¿­ä»£å™¨ï¼Œlist åå†…å®¹å¦‚ä¸‹ï¼š # [('label1', 'value1'), # ('label2', 'value2'), # ('label3', 'value3'), # ('label4', 'value4'), # ('label5', 'value5')] # 2. è½¬æ¢æˆ dict key_values = dict(groups) # å¾—åˆ°çš„ key_values ä¸ä¸Šé¢éœ€è¦çš„ dict åˆ«æ— äºŒè‡´ã€‚ ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:2:7","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#71-html-table-å…ƒç´ çš„å¤„ç†"},{"categories":["tech"],"content":" ä¸‰ã€å¸¸è§é”™è¯¯","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:3:0","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#ä¸‰å¸¸è§é”™è¯¯"},{"categories":["tech"],"content":" 1. æµ…å¤åˆ¶å¯¼è‡´é”™è¯¯åˆ©ç”¨å¥½æµ…å¤åˆ¶ï¼Œå¯ä»¥éå¸¸ç®€æ´çš„å®ç°å‰é¢æåˆ°çš„å…ƒç´ åˆ†ç»„/groupåŠŸèƒ½ï¼Œä½†æ˜¯å¦‚æœä¸æ³¨æ„ï¼Œä¹Ÿä¼šå¯¼è‡´éå¸¸éšæ™¦çš„é”™è¯¯ï¼ æ¯”å¦‚åœ¨ä½¿ç”¨ * ä½œä¸ºé‡å¤è¿ç®—ç¬¦æ—¶ï¼Œå¦‚æœç›®æ ‡æ˜¯ä¸€ä¸ªåµŒå¥—çš„å¯å˜å¯¹è±¡ï¼Œå°±ä¼šäº§ç”Ÿä»¤äººè´¹è§£çš„é—®é¢˜ï¼š python \u003e\u003e\u003e a = [1,2,3] \u003e\u003e\u003e b = a * 3 \u003e\u003e\u003e b [1, 2, 3, 1, 2, 3, 1, 2, 3] \u003e\u003e\u003e b = [a] * 3 # nested \u003e\u003e\u003e b [[1, 2, 3], [1, 2, 3], [1, 2, 3]] \u003e\u003e\u003e b[1][1] = 4 \u003e\u003e\u003e b [[1, 4, 3], [1, 4, 3], [1, 4, 3]] å› ä¸º _ å¹¶ä¸æ˜¯æ·±æ‹·è´ï¼Œå®ƒåªæ˜¯ç®€å•åœ°å¤åˆ¶äº† [a] è¿™ä¸ªåˆ—è¡¨ï¼Œé‡Œé¢çš„ [1,2,3] éƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥æ”¹äº†ä¸€ä¸ªï¼Œæ‰€æœ‰çš„éƒ½ä¼šæ”¹å˜ã€‚**è§£å†³æ–¹æ³•æ˜¯ä¸è¦ä½¿ç”¨ _ å·ï¼Œæ”¹ç”¨[a.copy() for i in range(3)] æ‰§è¡Œæ·±æ‹·è´ã€‚å¦‚æœä¸éœ€è¦ä¿®æ”¹ï¼Œè¯·ç›´æ¥ä½¿ç”¨ä¸å¯å˜å¯¹è±¡**ã€‚ ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:3:1","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#1-æµ…å¤åˆ¶å¯¼è‡´é”™è¯¯"},{"categories":["tech"],"content":" 2. å˜é‡ä½œç”¨åŸŸ Python ä¸­åªæœ‰æ¨¡å—ï¼Œç±»ä»¥åŠå‡½æ•°æ‰ä¼šå¼•å…¥æ–°çš„ä½œç”¨åŸŸï¼Œå…¶å®ƒçš„ä»£ç å—æ˜¯ä¸ä¼šå¼•å…¥æ–°çš„ä½œç”¨åŸŸçš„ã€‚ï¼ˆè€Œåœ¨ C/Java ä¸­ï¼Œä»»ä½•ä¸€ä¸ª {} å—å°±æ„æˆä¸€ä¸ªå±€éƒ¨ä½œç”¨åŸŸã€‚å¦å¤– Julia ä¸­ for/while/try-catch éƒ½æ˜¯å±€éƒ¨ä½œç”¨åŸŸï¼Œä½† if-else åˆä¸æ˜¯å±€éƒ¨ä½œç”¨åŸŸã€‚æ€»ä¹‹è¿™äº›å°å·®åˆ«è¦æ³¨æ„ã€‚ï¼‰ å±€éƒ¨å˜é‡å¯ä»¥ä¸å¤–éƒ¨å˜é‡åŒåï¼Œå¹¶ä¸”åœ¨å…¶ä½œç”¨åŸŸä¸­ï¼Œå±€éƒ¨å˜é‡ä¼šè¦†ç›–æ‰å¤–éƒ¨å˜é‡ã€‚ä¸çŸ¥æ˜¯å‡ºäºå®ç°ç®€å•æˆ–æ˜¯æ€§èƒ½ï¼Œè¿˜æ˜¯å…¶ä»–çš„åŸå› ï¼Œå¥½åƒæ‰€æœ‰çš„è¯­è¨€éƒ½æ˜¯è¿™æ ·çš„ã€‚å…¶å®æˆ‘æ›´å¸Œæœ›å˜é‡çš„ä½œç”¨åŸŸè¦†ç›–ä¼šæŠ¥é”™ã€‚ å¦‚æœæœ‰å‡½æ•°ä¸å…¶ä»–å‡½æ•°æˆ–å˜é‡ï¼ˆç”šè‡³æŸäº›ä¿ç•™å­—ï¼‰åŒåï¼Œåå®šä¹‰çš„ä¼šè¦†ç›–æ‰å…ˆå®šä¹‰çš„ã€‚ï¼ˆè¿™æ˜¯å› ä¸º Python ä¸­å‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡ã€‚è€Œåœ¨ C/Java ä¸­è¿™æ˜¯ä¼šæŠ¥é”™çš„ï¼‰ æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå°é—®é¢˜ï¼Œå…ˆçœ‹ä¸€ä¸ªä¾‹å­ï¼š python3 \u003e\u003e\u003e i = 4 \u003e\u003e\u003e def f(): # å•çº¯çš„ä»å‡½æ•°ä½œç”¨åŸŸè®¿é—®å¤–éƒ¨ä½œç”¨åŸŸæ˜¯æ²¡é—®é¢˜çš„ ... print(i) ... \u003e\u003e\u003e f() 4 å†çœ‹ä¸€ä¸ªé—®é¢˜ä¸¾ä¾‹ï¼š python3 \u003e\u003e\u003e i = 3 \u003e\u003e\u003e def f(): ... print(i) # è¿™é‡Œåº”è¯¥æ˜¯è®¿é—®å¤–éƒ¨ä½œç”¨åŸŸ ... i = 5 # å¯è¿™é‡Œåˆå®šä¹‰äº†ä¸€ä¸ªåŒåå±€éƒ¨å˜é‡ i ... \u003e\u003e\u003e f() # äºæ˜¯å°±å‡ºé”™äº† Traceback (most recent call last): File \"\u003cstdin\u003e\", line 1, in \u003cmodule\u003e File \"\u003cstdin\u003e\", line 2, in f UnboundLocalError: local variable 'i' referenced before assignment å¦‚æœåœ¨å†…éƒ¨ä½œç”¨åŸŸå…ˆè®¿é—®å¤–éƒ¨ä½œç”¨åŸŸï¼Œå†å®šä¹‰ä¸€ä¸ªåŒåçš„å±€éƒ¨å˜é‡ï¼Œè§£é‡Šå™¨å°±æ‡µé€¼äº†ã€‚å¦‚æœä½ å…¶å®æƒ³åšçš„æ˜¯æ”¹å˜å…¨å±€å˜é‡ i çš„å€¼ï¼Œå°±åº”è¯¥åœ¨å¼€å¤´å£°æ˜ global i. è€Œå¦‚æœ å¤–éƒ¨å˜é‡ i ä¸æ˜¯å­˜åœ¨äºå…¨å±€ä½œç”¨åŸŸï¼Œè€Œæ˜¯åœ¨æŸä¸ªé—­åˆä½œç”¨åŸŸå†…çš„è¯ï¼Œå°±è¯¥ç”¨ nonlocal i ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:3:2","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#2-å˜é‡ä½œç”¨åŸŸ"},{"categories":["tech"],"content":" å››ã€è‡ªå®šä¹‰è£…é¥°å™¨è£…é¥°å™¨æœ‰ä¸¤ç§ï¼šç”¨å‡½æ•°å®šä¹‰çš„è£…é¥°å™¨ï¼Œè¿˜æœ‰ç”¨ç±»å®šä¹‰çš„è£…é¥°å™¨ã€‚å‡½æ•°è£…é¥°å™¨æœ€å¸¸ç”¨ã€‚ è£…é¥°å™¨å¯ç”¨äºè£…é¥°å‡½æ•°ï¼Œä¿®æ”¹å‡½æ•°/ç±»çš„æŸäº›è¡Œä¸ºï¼Œæˆ–è€…å°†å‡½æ•°æ³¨å†Œåˆ°åˆ«çš„åœ°æ–¹ã€‚ ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:4:0","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#å››è‡ªå®šä¹‰è£…é¥°å™¨"},{"categories":["tech"],"content":" 1. å‡½æ•°å®šä¹‰è£…é¥°å™¨ python @decc def gg(xx): ... # ç­‰åŒäº def gg(xx) gg = decc(gg) å¸¦å‚çš„è£…é¥°å™¨ python @decorator(A, B) def F(arg): ... F(99) # ç­‰åŒäº def F(arg): ... F = decorator(A, B)(F) # Rebind F to result of decorator's return value F(99) # Essentially calls decorator(A, B)(F)(99) ä¸Šé¢æ¼”ç¤ºçš„æ˜¯ç”¨å‡½æ•°å®šä¹‰çš„è£…é¥°å™¨ï¼Œä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„è£…é¥°å™¨ã€‚è£…é¥°å™¨æ¥æ”¶çš„å‚æ•°å¯ä»¥æ˜¯å„ç§å„æ ·çš„ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªå¸¦å‚çš„è£…é¥°å™¨ï¼š python @on_command(\"info\") def get_info(): return \"è¿™å°±æ˜¯ä½ éœ€è¦çš„ info\" def on_command(name: str): # è°ƒç”¨æ­¤å‡½æ•°è·å¾—è£…é¥°å™¨ï¼Œè¿™æ ·å°±å®ç°äº†å¸¦å‚è£…é¥°å™¨ def deco(func: Callable) -\u003e Callable: # è¿™ä¸ªæ‰æ˜¯çœŸæ­£çš„è£…é¥°å™¨ # å°†å‘½ä»¤å¤„ç†å™¨æ³¨å†Œåˆ°å‘½ä»¤åˆ—è¡¨å†… return func # ç›´æ¥è¿”å›åŸå‡½æ•°ï¼Œè¿™æ ·çš„è¯ï¼Œå¤šä¸ªè£…é¥°å™¨å°±ä¸ä¼šç›¸äº’å½±å“äº†ã€‚ return deco # ä¸Šé¢çš„ç­‰åŒäºï¼š get_info = on_command(\"info\")(get_info) # on_command(\"info\") è¿”å›çœŸæ­£çš„è£…é¥°å™¨ å¦‚æœä½ çš„ on_command æœ‰é€šç”¨çš„éƒ¨åˆ†ï¼Œè¿˜å¯ä»¥å°†é€šç”¨çš„éƒ¨åˆ†æŠ½ç¦»å‡ºæ¥å¤ç”¨ï¼š python def _deco_maker(event_type: str) -\u003e Callable: # è°ƒç”¨è¿™ä¸ªï¼Œè·å– on_xxx çš„ deco_decoï¼Œ def deco_deco(self) -\u003e Callable: # è¿™ä¸ªå¯¹åº” on_xxx def deco(func: Callable) -\u003e Callable: # è¿™ä¸ªæ‰æ˜¯çœŸæ­£çš„è£…é¥°å™¨ # do something return func # è¿”å›åŸå‡½æ•° return deco return deco_deco æˆ‘ä»¬çŸ¥é“ Python çš„ç±»å®é™…ä¸Šæ˜¯å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä¿®æ”¹çš„ï¼Œå› æ­¤å‡½æ•°è£…é¥°å™¨ä¹Ÿèƒ½ç”¨äºè£…é¥°ç±»ï¼Œä¿®æ”¹ç±»çš„æŸäº›è¡Œä¸ºã€‚ python def log_getattribute(cls): # Get the original implementation orig_getattribute = cls.__getattribute__ # Make a new definition def new_getattribute(self, name): print('getting:', name) return orig_getattribute(self, name) # Attach to the class and return cls.__getattribute__ = new_getattribute # ä¿®æ”¹äº†è¢«è£…é¥°ç±» cls çš„ __getattribute__ return cls # Example use @log_getattribute class A: def __init__(self,x): self.x = x def spam(self): pass ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:4:1","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#1-å‡½æ•°å®šä¹‰è£…é¥°å™¨"},{"categories":["tech"],"content":" 1. å‡½æ•°å®šä¹‰è£…é¥°å™¨ python @decc def gg(xx): ... # ç­‰åŒäº def gg(xx) gg = decc(gg) å¸¦å‚çš„è£…é¥°å™¨ python @decorator(A, B) def F(arg): ... F(99) # ç­‰åŒäº def F(arg): ... F = decorator(A, B)(F) # Rebind F to result of decorator's return value F(99) # Essentially calls decorator(A, B)(F)(99) ä¸Šé¢æ¼”ç¤ºçš„æ˜¯ç”¨å‡½æ•°å®šä¹‰çš„è£…é¥°å™¨ï¼Œä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„è£…é¥°å™¨ã€‚è£…é¥°å™¨æ¥æ”¶çš„å‚æ•°å¯ä»¥æ˜¯å„ç§å„æ ·çš„ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªå¸¦å‚çš„è£…é¥°å™¨ï¼š python @on_command(\"info\") def get_info(): return \"è¿™å°±æ˜¯ä½ éœ€è¦çš„ info\" def on_command(name: str): # è°ƒç”¨æ­¤å‡½æ•°è·å¾—è£…é¥°å™¨ï¼Œè¿™æ ·å°±å®ç°äº†å¸¦å‚è£…é¥°å™¨ def deco(func: Callable) -\u003e Callable: # è¿™ä¸ªæ‰æ˜¯çœŸæ­£çš„è£…é¥°å™¨ # å°†å‘½ä»¤å¤„ç†å™¨æ³¨å†Œåˆ°å‘½ä»¤åˆ—è¡¨å†… return func # ç›´æ¥è¿”å›åŸå‡½æ•°ï¼Œè¿™æ ·çš„è¯ï¼Œå¤šä¸ªè£…é¥°å™¨å°±ä¸ä¼šç›¸äº’å½±å“äº†ã€‚ return deco # ä¸Šé¢çš„ç­‰åŒäºï¼š get_info = on_command(\"info\")(get_info) # on_command(\"info\") è¿”å›çœŸæ­£çš„è£…é¥°å™¨ å¦‚æœä½ çš„ on_command æœ‰é€šç”¨çš„éƒ¨åˆ†ï¼Œè¿˜å¯ä»¥å°†é€šç”¨çš„éƒ¨åˆ†æŠ½ç¦»å‡ºæ¥å¤ç”¨ï¼š python def _deco_maker(event_type: str) -\u003e Callable: # è°ƒç”¨è¿™ä¸ªï¼Œè·å– on_xxx çš„ deco_decoï¼Œ def deco_deco(self) -\u003e Callable: # è¿™ä¸ªå¯¹åº” on_xxx def deco(func: Callable) -\u003e Callable: # è¿™ä¸ªæ‰æ˜¯çœŸæ­£çš„è£…é¥°å™¨ # do something return func # è¿”å›åŸå‡½æ•° return deco return deco_deco æˆ‘ä»¬çŸ¥é“ Python çš„ç±»å®é™…ä¸Šæ˜¯å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä¿®æ”¹çš„ï¼Œå› æ­¤å‡½æ•°è£…é¥°å™¨ä¹Ÿèƒ½ç”¨äºè£…é¥°ç±»ï¼Œä¿®æ”¹ç±»çš„æŸäº›è¡Œä¸ºã€‚ python def log_getattribute(cls): # Get the original implementation orig_getattribute = cls.__getattribute__ # Make a new definition def new_getattribute(self, name): print('getting:', name) return orig_getattribute(self, name) # Attach to the class and return cls.__getattribute__ = new_getattribute # ä¿®æ”¹äº†è¢«è£…é¥°ç±» cls çš„ __getattribute__ return cls # Example use @log_getattribute class A: def __init__(self,x): self.x = x def spam(self): pass ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:4:1","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#å¸¦å‚çš„è£…é¥°å™¨"},{"categories":["tech"],"content":" 2. ç±»å®šä¹‰è£…é¥°å™¨ç±»å®šä¹‰è£…é¥°å™¨å’Œå‡½æ•°å®šä¹‰è£…é¥°å™¨çš„ä½¿ç”¨æ–¹å¼å®Œå…¨ä¸€è‡´ã€‚å®ƒä¹Ÿå¯ä»¥ç”¨äºè£…é¥°å‡½æ•°æˆ–è€…ç±»ã€‚ é‚£ä¹ˆä¸ºå•¥è¿˜éœ€è¦ç±»å®šä¹‰è£…é¥°å™¨å‘¢ï¼Ÿå®ƒçš„ä¼˜åŠ¿åœ¨äºç±»æ˜¯å¯ä»¥ç»§æ‰¿çš„ï¼Œè¿™æ ·çš„è¯ï¼Œå°±èƒ½ç”¨ç»§æ‰¿çš„æ–¹å¼å®šä¹‰è£…é¥°å™¨ï¼Œå°†é€šç”¨éƒ¨åˆ†å®šä¹‰æˆè¶…ç±»ã€‚ ç±»å®šä¹‰è£…é¥°å™¨çš„å®šä¹‰æ–¹æ³•å¦‚ä¸‹ï¼š python # PythonDecorators/entry_exit_class.py class entry_exit(object): def __init__(self, f): self.f = f def __call__(self): #å…³é”®åœ¨äºè¿™ä¸ªå‡½æ•°ï¼Œå®ƒä½¿æ­¤ç±»çš„å¯¹è±¡å˜æˆ Callable print(\"Entering\", self.f.__name__) self.f() print(\"Exited\", self.f.__name__) @entry_exit def func1(): print(\"inside func1()\") # ä¸Šé¢çš„è£…é¥°å™¨ç›¸å½“äº func1 = entry_exit(func1) # ä»è¿™é‡Œçœ‹çš„è¯ï¼Œè£…é¥°å™¨çš„è¡Œä¸ºå®Œå…¨ä¸€è‡´ # æ¥ä¸‹æ¥è°ƒç”¨è¯¥å‡½æ•°ï¼ˆå®é™…ä¸Šæ˜¯è°ƒç”¨äº† entry_exit å¯¹è±¡çš„ call å‡½æ•°ï¼‰ func1() è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š text Entering func1 inside func1() Exited func1 ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:4:2","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#2-ç±»å®šä¹‰è£…é¥°å™¨"},{"categories":["tech"],"content":" äº”ã€OOP è°ƒç”¨è¶…ç±»æ–¹æ³•ï¼š- ç›´æ¥é€šè¿‡è¶…ç±»å.__init__(self,xx)è°ƒç”¨ - é€šè¿‡super(__class__, self).__init__()è°ƒç”¨ã€‚ï¼ˆPython3 å¯ç›´æ¥ç”¨ super().__init__() ä½†æ˜¯è¦ææ¸…æ¥šï¼Œsuper() æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªä»£ç†ç±»ã€‚å¦å¤–è¢«ä»£ç†çš„ç±»ä¹Ÿä¸ä¸€å®šæ˜¯å…¶è¶…ç±»ã€‚å¦‚æœä¸æ¸…æ¥šè¿™äº›å·®åˆ«ï¼Œæœ€å¥½è¿˜æ˜¯æ˜¾å¼ç”¨æ–¹æ³•ä¸€æœ€å¥½ã€‚ï¼‰ æŠ½è±¡è¶…ç±»ï¼š@abstractmethod @staticmethod @classmethod ä¸ Java çš„ static æ–¹æ³•å¯¹æ¯” pythonçš„ç±»æ–¹æ³•ã€é™æ€æ–¹æ³•ï¼Œä¸ javaçš„é™æ€æ–¹æ³•ï¼š 1. java ä¸­ constantsã€utils è¿™æ ·çš„é™æ€ç±»ï¼Œå¯¹åº”çš„æ˜¯pythonçš„ä¸€ä¸ªæ¨¡å—ï¼ˆæ–‡ä»¶ï¼‰ï¼Œç±»å±æ€§å¯¹åº”æ¨¡å—çš„å…¨å±€å±æ€§ï¼Œé™æ€æ–¹æ³•å¯¹åº”æ¨¡å—çš„å‡½æ•° 2. å¯¹äº java ä¸­éœ€è¦è®¿é—®ç±»å±æ€§çš„é™æ€æ–¹æ³•ï¼Œå¦‚æœå®ƒä¸å±äºç¬¬ä¸€ç±»ï¼Œåº”è¯¥ç”¨ `@classmethod` å®ç°å®ƒã€‚classmethodæœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯ä¸€å®šæœ‰ä¸€ä¸ª cls ä¼ å…¥ã€‚è¿™ç§æ–¹æ³•çš„ä¸»è¦ç”¨é€”æ˜¯å®ç°å·¥å‚å‡½æ•°ã€‚ 3. å¯¹äºä¸éœ€è¦è®¿é—®ä»»ä½•ç±»å±æ€§ï¼Œä¹Ÿä¸å±äºç¬¬ä¸€ç±»çš„æ–¹æ³•ï¼Œåº”è¯¥ç”¨ `@staticmathod` å®ç°ã€‚è¿™ç§æ–¹æ³•å…¶å®å®Œå…¨ä¸éœ€è¦æ”¾åˆ°ç±»é‡Œé¢ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å‡½æ•°ã€‚ï¼ˆä»ç„¶æ”¾é‡Œé¢ï¼Œæ˜¯ä¸ºäº†æŠŠåŠŸèƒ½ç±»ä¼¼çš„å‡½æ•°ç»„ç»‡åˆ°ä¸€èµ·è€Œå·²ã€‚ï¼‰ __slots__: å±æ€§å¯¼å‡ºï¼Œä¸åœ¨è¯¥åˆ—è¡¨å†…çš„å±æ€§ï¼Œè‹¥å­˜åœ¨åˆ™ä¸ºåªè¯»ã€‚ä¸å­˜åœ¨çš„è¯ï¼Œå°±ä¸å­˜åœ¨ã€‚ã€‚6. __getattr__: æ‹¦æˆªå¯¹ä¸å­˜åœ¨çš„å±æ€§çš„è®¿é—®ï¼Œå¯ç”¨äºå®ç°åŠ¨æ€åˆ†é…å±æ€§ã€‚ __getattribute__: å’Œä¸Šé¢ç›¸åŒï¼Œä½†æ˜¯å®ƒæ‹¦æˆªå¯¹æ‰€æœ‰å±æ€§çš„è®¿é—®ï¼ŒåŒ…æ‹¬å¯¹å·²å­˜åœ¨çš„å±æ€§çš„è®¿é—®ã€‚ @property: æä¾›å¯¹å±æ€§è®¿é—®çš„å®‰å…¨æ£€æŸ¥ descriptor: get set delete æ§åˆ¶å¯¹ç±»çš„è®¿é—®ã€‚ï¼ˆä¸Šé¢çš„ getattr ç­‰æ˜¯æ§åˆ¶å¯¹ç±»çš„å±æ€§çš„è®¿é—®ï¼‰ ç±»æ„é€ å™¨ __new__ï¼šåœ¨ __init__ ä¹‹å‰è¿è¡Œï¼Œå®ƒæ¥æ”¶ä¸€ä¸ª cls å‚æ•°ï¼Œç„¶åä½¿ç”¨å®ƒæ„é€ å¹¶è¿”å›ç±»å®ä¾‹ selfã€‚ ç±»æ–¹æ³•çš„ cls å³æ˜¯å½“å‰ç±»ï¼Œæ˜¯ type çš„å®ä¾‹ï¼Œcls.xxx å’Œ \u003cç±»å\u003e.xxx è°ƒç”¨ç»“æœæ˜¯ä¸€è‡´çš„ã€‚è€Œ self ç”± __new__ æ„é€ ï¼Œæ˜¯ cls çš„å®ä¾‹ã€‚ ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:5:0","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#äº”oop"},{"categories":["tech"],"content":" å…ƒç±» metaclasseså…ƒç±»ï¼Œä¹Ÿå°±æ˜¯ç”¨äºåˆ›å»ºclass çš„ classï¼Œç®—æ˜¯å¾ˆé«˜çº§çš„è¯é¢˜äº†ï¼ˆIf you wonder whether you need metaclasses, you donâ€™t ï¼‰å…ƒç±»çš„å·¥ä½œæµç¨‹ï¼š æ‹¦æˆªç±»çš„åˆ›å»º ä¿®æ”¹ç±» è¿”å›ä¿®æ”¹ä¹‹åçš„ç±» è¯¦ç»†ç›´æ¥çœ‹ http://blog.jobbole.com/21351/ å§ã€‚ ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:5:1","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#å…ƒç±»-metaclasses"},{"categories":["tech"],"content":" å…­ã€æŸ¥çœ‹ Python æºç å¯¹ä¸€èˆ¬çš„æ ‡å‡†åº“çš„æ¨¡å—ï¼Œè¦æŸ¥çœ‹å…¶å…·ä½“çš„ Python å®ç°æ˜¯å¾ˆç®€å•çš„ï¼šç›´æ¥é€šè¿‡ __file__ å±æ€§å°±èƒ½çœ‹åˆ° .py æ–‡ä»¶çš„ä½ç½®ã€‚ ä½†æ˜¯ Python å¾ˆå¤šåŠŸèƒ½æ˜¯ C å†™çš„ï¼Œå¯¹äºè¿™ç±»å‡½æ•°/ç±»ï¼Œ__file__ å°±æ²¡å•¥ç”¨äº†ã€‚ å¦‚æœæ˜¯éœ€è¦æŸ¥çœ‹builtins æ¨¡å— çš„å…·ä½“å®ç°ï¼Œç›´æ¥æŸ¥çœ‹Python/bltinmodule.c å°±è¡Œã€‚ å…¶ä»– C æ¨¡å—çš„æºç ï¼Œå¾…è¡¥å……å…·ä½“çš„æŸ¥çœ‹æ–¹æ³•ã€‚ ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:6:0","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#å…­æŸ¥çœ‹-python-æºç "},{"categories":["tech"],"content":" ä¸ƒã€å‚è€ƒæ–‡æ¡£ Pythonä¸­ä¸€äº›ä¸ä¸ºäººçŸ¥çš„åŸºç¡€æŠ€å·§æ€»ç»“ Python3 å®˜æ–¹æ–‡æ¡£ ","date":"2022-02-13","objectID":"/posts/python-tips-and-tricks/:7:0","series":null,"tags":["Python","Tips","Tricks","å¸¸è§é”™è¯¯"],"title":"Python å®ç”¨æŠ€å·§ä¸å¸¸è§é”™è¯¯é›†é”¦","uri":"/posts/python-tips-and-tricks/#ä¸ƒå‚è€ƒæ–‡æ¡£"},{"categories":null,"content":" æ­¤é¡µé¢å—æå®¢å…”å…” - åšå®¢æŠ˜è…¾è®°(ä¸ƒ) - Gitalk Plus çš„å¯å‘è€Œåˆ›å»ºï¼Œå…¶æ ¸å¿ƒè¯‰æ±‚æ˜¯ã€Œå¸®åŠ©è®¿å®¢å‘ç°æœ¬ç«™çš„ä¼˜è´¨æ–‡ç« ã€ã€‚ æ­¤é¡µé¢çš„æ•°æ®ç”±Github Action è‡ªåŠ¨ä» Google Analytics è·å–ï¼Œæ›´æ–°é—´éš”ä¸º 6 å°æ—¶ï¼Œç›®å‰ç”±åšä¸»çœ‹å¿ƒæƒ…æ›´æ–°ã€‚ æ›´æ–°æ—¶é—´: 2025-12-21T23:34UTC+08:00 ","date":"2022-02-07","objectID":"/statistics/:0:0","series":null,"tags":null,"title":"æœ¬ç«™ç»Ÿè®¡æ•°æ®","uri":"/statistics/#"},{"categories":null,"content":" ä¸€ã€å…¨ç«™ç»Ÿè®¡ æ€»å­—æ•° æ€»è®¿å®¢æ•° UV æ€»è®¿é—®é‡ PV æ€»é˜…è¯»æ—¶é•¿ äººå‡é˜…è¯»æ—¶é•¿ 458788 169517 373934 194 days, 12h 38m 08s 01m 39s ","date":"2022-02-07","objectID":"/statistics/:1:0","series":null,"tags":null,"title":"æœ¬ç«™ç»Ÿè®¡æ•°æ®","uri":"/statistics/#ä¸€å…¨ç«™ç»Ÿè®¡"},{"categories":null,"content":" äºŒã€90 å¤©é˜…è¯»æ’è¡Œ é»˜è®¤æŒ‰ã€Œäººå‡é˜…è¯»æ—¶é•¿ã€æ’åºï¼Œå¯ç‚¹å‡»è¡¨å¤´åˆ‡æ¢æ’åºæ–¹å¼ã€‚ åºå· æ ‡é¢˜ äººå‡é˜…è¯»æ—¶é•¿ è®¿å®¢æ•° è®¿é—®é‡ 1 å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸‰ï¼‰â€”â€” MAC ä¸å¯†é’¥æ´¾ç”Ÿå‡½æ•° KDF 02m 56s 83 109 2 Kubernetes é›†ç¾¤ä¼¸ç¼©ç»„ä»¶ - Karpenter 02m 39s 31 40 3 NAT ç½‘å…³ã€NAT ç©¿è¶Šä»¥åŠè™šæ‹Ÿç½‘ç»œ 02m 35s 42 52 4 NixOS åœ¨ Lichee Pi 4A ä¸Šæ˜¯å¦‚ä½•å¯åŠ¨çš„ 02m 22s 38 45 5 æˆ‘çš„ 2023 - è®¤è¯†æ›´å¤šæœ‰è¶£çš„äººï¼Œè§è¯†æ›´å®½å¹¿çš„ä¸–ç•Œ 02m 18s 52 65 6 Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ 02m 17s 16 17 7 å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸ƒï¼‰â€”â€” éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• RSA/ECC 02m 14s 88 175 8 OS as Code - æˆ‘çš„ NixOS ä½¿ç”¨ä½“ä¼š 02m 04s 250 329 9 EE å…¥é—¨ï¼ˆä¸€ï¼‰ - ç”µå­ç”µè·¯åŸºç¡€çŸ¥è¯† 02m 02s 456 723 10 æˆ‘åœ¨åˆ›ä¸šå…¬å¸åšæŠ€æœ¯ä¸€å¹´å¤šçš„ä¸€ç‚¹ä½“ä¼š 01m 59s 17 19 11 æˆ‘çš„ 2024 - ç¨³ä¸­æ±‚è¿›ã€çƒ­çˆ±ç”Ÿæ´» 01m 47s 96 110 12 ä¸ªäººæ•°æ®å®‰å…¨ä¸å®Œå…¨æŒ‡å— 01m 45s 92 119 13 å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…­ï¼‰â€”â€” å¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³• 01m 45s 53 67 14 ä¸ºä»€ä¹ˆæˆ‘æŠ˜è…¾è¿™äº›å°ä¼—æŠ€æœ¯ï¼Ÿ 01m 43s 43 46 15 å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆäºŒï¼‰â€”â€” å“ˆå¸Œå‡½æ•° 01m 41s 74 90 16 OS as Code - My Experience of NixOS 01m 39s 182 215 17 å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®® 01m 38s 59 153 18 ä¸¤å²¸çŒ¿å£°å•¼ä¸ä½ï¼Œè½»èˆŸå·²è¿‡ä¸‡é‡å±±â€”â€”æˆ‘çš„å››åˆ†ä¹‹ä¸€äººç”Ÿ 01m 36s 246 300 19 å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆä¸€ï¼‰â€”â€” æ¦‚è§ˆ 01m 34s 113 232 20 Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ– 01m 29s 30 42 21 å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆäº”ï¼‰â€”â€” å¯†é’¥äº¤æ¢ DHKE ä¸å®Œç¾å‰å‘ä¿å¯† PFS 01m 26s 67 105 22 2019 å¹´å¹´ç»ˆæ€»ç»“ 01m 23s 12 15 23 KubeCon China 2025 è§é—» 01m 20s 86 110 24 2021 å¹´å¹´ç»ˆæ€»ç»“ 01m 20s 19 24 25 2020 å¹´å¹´ç»ˆæ€»ç»“ 01m 18s 11 15 26 Manjaro ä½¿ç”¨æŒ‡å— 01m 16s 12 11 27 Linux ä¸­çš„è™šæ‹Ÿç½‘ç»œæ¥å£ 01m 11s 54 86 28 SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰ï¼šORM ä¸­çš„å…³ç³»æ„å»º 01m 11s 6 10 29 åˆ†å¸ƒå¼æ•°æ®åº“çš„ä¸€è‡´æ€§é—®é¢˜ä¸å…±è¯†ç®—æ³• 01m 08s 36 43 30 secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨ 01m 07s 101 145 31 2022 å¹´å¹´ç»ˆæ€»ç»“ 01m 07s 24 28 32 iptables åŠ docker å®¹å™¨ç½‘ç»œåˆ†æ 01m 04s 57 85 33 å¸¸è§å‹ç¼©æ ¼å¼çš„åŒºåˆ«ï¼ŒåŠ Linux ä¸‹çš„å‹ç¼©ç›¸å…³æŒ‡ä»¤ 01m 04s 13 13 34 Proxmox Virtual Environment ä½¿ç”¨æŒ‡å— 01m 03s 211 242 35 å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå››ï¼‰â€”â€” å®‰å…¨éšæœºæ•°ç”Ÿæˆå™¨ CSPRNG 01m 03s 82 95 36 Why do I explore these niche technologies? 01m 01s 62 70 37 ä½¿ç”¨ Istio è¿›è¡Œ JWT èº«ä»½éªŒè¯ï¼ˆå……å½“ API ç½‘å…³ï¼‰ 01m 00s 21 21 38 QEMU/KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨ 59s 112 142 39 ä½¿ç”¨ tcpdump å’Œ Wireshark è¿›è¡Œè¿œç¨‹å®æ—¶æŠ“åŒ…åˆ†æ 59s 106 119 40 EE å…¥é—¨ï¼ˆäºŒï¼‰ - ä½¿ç”¨ ESP32 ä¸ SPI æ˜¾ç¤ºå±ç»˜å›¾ã€æ˜¾ç¤ºå›¾ç‰‡ã€è·‘è´ªåƒè›‡ 58s 184 230 41 Learn English Again 57s 39 50 42 FinOps for Kubernetes - å¦‚ä½•æ‹†åˆ† Kubernetes æˆæœ¬ 57s 20 27 43 Kubernetes å¸¸è§é”™è¯¯ã€åŸå› åŠå¤„ç†æ–¹æ³• 55s 26 34 44 éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤ 50s 18 20 45 openSUSE ä½¿ç”¨æŒ‡å— 47s 37 38 46 Linux ä¸Šçš„ WireGuard ç½‘ç»œåˆ†æï¼ˆä¸€ï¼‰ 46s 72 89 47 Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸‰ï¼‰ - æ¡Œé¢ä¼šè¯ä¸å›¾å½¢æ¸²æŸ“ 46s 21 25 48 Linux/Windows/MacOSX ç³»ç»Ÿå¸¸ç”¨å‘½ä»¤é›†é”¦ 46s 19 22 49 2024 å¹´é¦™æ¸¯å¾’æ­¥æ—…è¡Œè®°å½•ï¼ˆä¸€ï¼‰ 44s 52 53 50 Linux ç½‘ç»œå·¥å…·ä¸­çš„ç‘å£«å†›åˆ€ - socat \u0026 netcat 43s 53 57 51 ç˜¾çš„é€€å´ 43s 5 5 52 äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ 41s 48 60 53 Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹ 41s 41 48 54 é€ƒç¦»æˆ‘çš„å¤§å­¦ 41s 25 26 55 Linux æ¡Œé¢ç³»ç»Ÿç»„ä»¶æ¦‚è§ˆä¸æ•…éšœæ’æŸ¥æŒ‡å— 38s 89 115 56 Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäºŒï¼‰ - systemd å…¨å®¶æ¡¶ä¸æœåŠ¡ç®¡ç† 38s 34 36 57 å¤§æ¢¦ä¸€åœº 36s 561 688 58 WebSocketã€HTTP/2 ä¸ gRPC 34s 22 26 59 å­¦è‹±è¯­å•Šå­¦è‹±è¯­ 34s 16 16 60 è„šè¸å®åœ°ï¼Œä»°æœ›æ˜Ÿç©º 33s 11 11 61 Kubernetes ä¸­çš„è¯ä¹¦ç®¡ç†å·¥å…· - cert-manager 31s 52 59 62 SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šEngine ä¸ SQL è¡¨è¾¾å¼è¯­è¨€ 30s 13 16 63 Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆäº”ï¼‰ - ç½‘ç»œ 29s 22 23 64 Python è§†é¢‘è½¬å­—ç¬¦åŠ¨ç”»ï¼ˆä¸€ï¼‰60 è¡Œä»£ç  29s 9 23 65 MacOS çª—å£ç®¡ç†å™¨ yabai ç©è€ç¬”è®° 28s 130 150 66 JWT ç­¾åç®—æ³• HS256ã€RS256 åŠ ES256 åŠå¯†é’¥ç”Ÿæˆ 27s 57 63 67 Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆä¸€ï¼‰ - ç³»ç»Ÿå¯åŠ¨ä¸å®‰å…¨æ¡†æ¶ 27s 40 61 68 KubeCon China 2024 ä¹‹æ—… 26s 36 58 69 æ¬§å‡ é‡Œå¾—ç®—æ³•æ±‚æœ€å¤§å…¬çº¦æ•°(GCD)çš„æ•°å­¦åŸç† 25s 20 35 70 Linux æ¡Œé¢ç³»ç»Ÿæ•…éšœæ’æŸ¥æŒ‡å—ï¼ˆå…­ï¼‰ - ç³»ç»Ÿå…³æœºä¸ç”µæºç®¡ç† 24s 59 67 71 é€šè¿‡ systemctl è®¾ç½®è‡ªå®šä¹‰ Service 24s 9 8 72 Base64 ç¼–ç å¹¶ä¸å”¯ä¸€ 23s 11 14 73 åˆ»æ„ç»ƒä¹  23s 10 8 74 æˆ‘æ‚£ä¸Šäº†é˜…è¯»ç„¦è™‘ç—‡ 22s 18 19 75 KubeCon China 2025 Experience 21s 73 93 ","date":"2022-02-07","objectID":"/statistics/:2:0","series":null,"tags":null,"title":"æœ¬ç«™ç»Ÿè®¡æ•°æ®","uri":"/statistics/#äºŒ90-å¤©é˜…è¯»æ’è¡Œ"},{"categories":null,"content":" ä¸‰ã€æ–‡ç« å‘å¸ƒå‘¨æœŸä¸æ•°é‡ç»Ÿè®¡ ","date":"2022-02-07","objectID":"/statistics/:3:0","series":null,"tags":null,"title":"æœ¬ç«™ç»Ÿè®¡æ•°æ®","uri":"/statistics/#ä¸‰æ–‡ç« å‘å¸ƒå‘¨æœŸä¸æ•°é‡ç»Ÿè®¡"},{"categories":["tech"],"content":" æœ¬æ–‡å®Œæˆäº 2022-01-25ï¼Œå…¶ä¸­éƒ¨åˆ†å†…å®¹å·²ç»è¿‡æ—¶ï¼Œä»…ä¾›å‚è€ƒã€‚ æœ¬æ–‡ç”±ä¸ªäººç¬”è®°ryan4yin/knowledge æ•´ç†è€Œæ¥ï¼Œä¸ä¿è¯æ­£ç¡® ","date":"2022-01-25","objectID":"/posts/kubernetes-deployment-using-kubeadm/:0:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","äº‘åŸç”Ÿ"],"title":"éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤","uri":"/posts/kubernetes-deployment-using-kubeadm/#"},{"categories":["tech"],"content":" æœ¬åœ° Kubernetes é›†ç¾¤å®‰è£…å·¥å…· äº‘ä¸Šçš„ Kubernetes é›†ç¾¤ï¼ŒåŸºæœ¬ä¸Šå„äº‘å‚å•†éƒ½æ”¯æŒä¸€é”®éƒ¨ç½²ã€‚è¿™é‡Œä¸»è¦å…³æ³¨æœ¬åœ°éƒ¨ç½²ï¼Œæˆ–è€…å«åšè£¸æœº (baremetal)éƒ¨ç½² æœ¬æ–‡ä»‹ç»çš„æ–¹æ³•é€‚åˆå¼€å‘æµ‹è¯•ä½¿ç”¨ï¼Œå®‰å…¨æ€§ã€ç¨³å®šæ€§ã€é•¿æœŸå¯ç”¨æ€§ç­‰æ–¹æ¡ˆéƒ½å¯èƒ½è¿˜æœ‰é—®é¢˜ã€‚ kubernetes æ˜¯ä¸€ä¸ªç»„ä»¶åŒ–çš„ç³»ç»Ÿï¼Œå®‰è£…è¿‡ç¨‹æœ‰å¾ˆå¤§çš„çµæ´»æ€§ï¼Œå¾ˆå¤šç»„ä»¶éƒ½æœ‰å¤šç§å®ç°ï¼Œè¿™äº›å®ç°å„æœ‰ç‰¹ç‚¹ï¼Œè®©åˆå­¦è€…çœ¼èŠ±ç¼­ä¹±ã€‚ è€Œä¸”è¦æŠŠè¿™äº›ç»„ä»¶ä¸€ä¸ªä¸ªå®‰è£…é…ç½®å¥½å¹¶ä¸”èƒ½ååŒå·¥ä½œï¼Œä¹Ÿæ˜¯å¾ˆä¸å®¹æ˜“çš„ã€‚ å› æ­¤ç¤¾åŒºå‡ºç°äº†å„ç§å„æ ·çš„å®‰è£…æ–¹æ¡ˆï¼Œä¸‹é¢ä»‹ç»ä¸‹å‡ ç§æ”¯æŒè£¸æœºï¼ˆBaremetalï¼‰éƒ¨ç½²çš„å·¥å…·ï¼š kubeadm: ç¤¾åŒºçš„é›†ç¾¤å®‰è£…å·¥å…·ï¼Œç›®å‰å·²ç»å¾ˆæˆç†Ÿäº†ã€‚ ä½¿ç”¨éš¾åº¦ï¼šç®€å• k3s: è½»é‡çº§ kubernetesï¼Œèµ„æºéœ€æ±‚å°ï¼Œéƒ¨ç½²éå¸¸ç®€å•ï¼Œé€‚åˆå¼€å‘æµ‹è¯•ç”¨æˆ–è€…è¾¹ç¼˜ç¯å¢ƒ æ”¯æŒ airgap ç¦»çº¿éƒ¨ç½² ä½¿ç”¨éš¾åº¦ï¼šè¶…çº§ç®€å• alibaba/sealer: æ”¯æŒå°†æ•´ä¸ª kubernetes æ‰“åŒ…æˆä¸€ä¸ªé•œåƒè¿›è¡Œäº¤ä»˜ï¼Œè€Œä¸”éƒ¨ç½²ä¹Ÿéå¸¸ç®€å•ã€‚ ä½¿ç”¨éš¾åº¦ï¼šè¶…çº§ç®€å• è¿™ä¸ªé¡¹ç›®ç›®å‰è¿˜åœ¨å‘å±•ä¸­ï¼Œä¸è¿‡è²Œä¼¼å·²ç»æœ‰å¾ˆå¤š toB çš„å…¬å¸åœ¨ä½¿ç”¨å®ƒè¿›è¡Œ k8s åº”ç”¨çš„äº¤ä»˜äº†ã€‚ kubespray: é€‚åˆè‡ªå»ºç”Ÿäº§çº§åˆ«çš„é›†ç¾¤ï¼Œæ˜¯ä¸€ä¸ªå¤§è€Œå…¨çš„ kubernetes å®‰è£…æ–¹æ¡ˆï¼Œè‡ªåŠ¨å®‰è£…å®¹å™¨è¿è¡Œæ—¶ã€k8sã€ç½‘ç»œæ’ä»¶ç­‰ç»„ä»¶ï¼Œè€Œä¸”å„ç»„ä»¶éƒ½æœ‰å¾ˆå¤šæ–¹æ¡ˆå¯é€‰ï¼Œä½†æ˜¯æ„Ÿè§‰æœ‰ç‚¹å¤æ‚ã€‚ ä½¿ç”¨éš¾åº¦ï¼šä¸­ç­‰ æ”¯æŒ airgap ç¦»çº¿éƒ¨ç½²ï¼Œä½†æ˜¯ä»¥å‰æˆ‘è¯•ç”¨è¿‡æ˜¯æœ‰å‘ï¼Œç°åœ¨ä¸çŸ¥é“å’‹æ ·äº† åº•å±‚ä½¿ç”¨äº† kubeadm éƒ¨ç½²é›†ç¾¤ sealos: ä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œä¸€è¡Œå‘½ä»¤éƒ¨ç½² å…¶ä»–ç¤¾åŒºéƒ¨ç½²æ–¹æ¡ˆ è‡ªå·±å†™è„šæœ¬ï¼Œä½¿ç”¨å„ç»„ä»¶çš„äºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œéƒ¨ç½²ã€‚ ç¬”è€…ä¸ºäº†å­¦ä¹  Kubernetesï¼Œä¸‹é¢é‡‡ç”¨å®˜æ–¹çš„ kubeadm è¿›è¡Œéƒ¨ç½²ï¼Œå®¹å™¨è¿è¡Œæ—¶ä½¿ç”¨ containerdï¼Œç½‘ç»œæ’ä»¶åˆ™ä½¿ç”¨ç›®å‰æœ€æ½®çš„åŸºäº eBPF çš„ Cilium. kubernetes å®˜æ–¹ä»‹ç»äº†ä¸¤ç§é«˜å¯ç”¨é›†ç¾¤çš„æ‹“æ‰‘ç»“æ„ï¼šã€Œå †å  Etcd æ‹“æ‰‘ï¼ˆStacked Etcd Topologyï¼‰ã€å’Œã€Œå¤–éƒ¨ Etcd æ‹“æ‰‘ï¼ˆExternal Etcd Topologyï¼‰ã€ã€‚ã€Œå †å  Etcd æ‹“æ‰‘ã€æ˜¯æŒ‡ Etcd è·Ÿ Kubernetes Master çš„å…¶ä»–ç»„ä»¶éƒ¨ç½²åœ¨åŒä¸€èŠ‚ç‚¹ä¸Šï¼Œè€Œã€Œå¤–éƒ¨ Etcd æ‹“æ‰‘ï¼ˆExternal Etcd Topologyï¼‰ã€åˆ™æ˜¯æŒ‡ Etcd å•ç‹¬éƒ¨ç½²ï¼Œä¸ Kubernetes Master åˆ†å¼€ã€‚ ç®€å•èµ·è§ï¼Œæœ¬æ–‡ä½¿ç”¨ã€Œå †å  Etcd æ‹“æ‰‘ã€ç»“æ„ï¼Œåˆ›å»ºä¸€ä¸ª 3 master çš„é«˜å¯ç”¨é›†ç¾¤ã€‚ å‚è€ƒï¼š Kubernetes Docs - Installing kubeadm Kubernetes Docs - Creating Highly Available clusters with kubeadm ","date":"2022-01-25","objectID":"/posts/kubernetes-deployment-using-kubeadm/:1:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","äº‘åŸç”Ÿ"],"title":"éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤","uri":"/posts/kubernetes-deployment-using-kubeadm/#æœ¬åœ°-kubernetes-é›†ç¾¤å®‰è£…å·¥å…·"},{"categories":["tech"],"content":" 0. ç½‘ç»œç¯å¢ƒçš„å‡†å¤‡æœ¬æ–‡è¡Œæ–‡æœªè€ƒè™‘å›½å†…ç½‘ç»œç¯å¢ƒï¼Œä½†æ˜¯ Kubernetes ç”¨åˆ°çš„å¾ˆå¤šé•œåƒéƒ½åœ¨ gcr.io ä¸Šï¼Œåœ¨å›½å†…è®¿é—®ä¼šæœ‰å›°éš¾ï¼Œè¿™é‡Œæä¾›ä¸‰ä¸ªè§£å†³åŠæ³•ï¼š åœ¨å®¶åº­è·¯ç”±å™¨ä¸Šæ•´ä¸ªç§‘å­¦ä»£ç†ï¼Œå®ç°å…¨å±€ç§‘å­¦ä¸Šç½‘ã€‚ï¼ˆæˆ‘å°±æ˜¯è¿™ä¹ˆå¹²çš„ï¼‰ ä½¿ç”¨ liangyuanpeng å¤§ä½¬åœ¨è¯„è®ºåŒºæä¾›çš„ gcr å›½å†…é•œåƒåœ°å€ï¼Œè¿™éœ€è¦è¿›è¡Œå¦‚ä¸‹æ›¿æ¢ï¼š k8s.gcr.ioâ€”\u003e lank8s.cn è‡ªå·±ç»´æŠ¤ä¸€ä¸ªå›½å†…é•œåƒä»“åº“ï¼ˆæˆ–ç§æœ‰é•œåƒä»“åº“å¦‚ harborï¼‰ï¼Œä½¿ç”¨ skopeo ç­‰å·¥å…·æˆ–è„šæœ¬å°†ä¸Šè¿°é•œåƒåˆ—è¡¨æ‹·è´åˆ°ä½ çš„ç§æœ‰ä»“åº“ å¦‚æœå¯¹å¯é æ€§è¦æ±‚é«˜ï¼Œæœ€å¥½æ˜¯é€‰æ‹©ç¬¬ä¸‰ä¸ªæ–¹æ¡ˆâ€”â€”è‡ªå»ºç§æœ‰é•œåƒä»“åº“ï¼ŒæŠŠé•œåƒæ¨é€åˆ°ç§æœ‰ä»“åº“ã€‚å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤åˆ—å‡ºæ‰€æœ‰ kubeadm éœ€è¦ç”¨åˆ°çš„é•œåƒåœ°å€ï¼ˆéœ€è¦å…ˆå®‰è£…å¥½ kubeadmï¼Œå»ºè®®è¯»å®Œæœ¬ç¯‡æ–‡ç« å…¨æ–‡åå†å°è¯•ï¼‰ï¼š shell â¯ kubeadm config images list --kubernetes-version v1.22.1 k8s.gcr.io/kube-apiserver:v1.22.1 k8s.gcr.io/kube-controller-manager:v1.22.1 k8s.gcr.io/kube-scheduler:v1.22.1 k8s.gcr.io/kube-proxy:v1.22.1 k8s.gcr.io/pause:3.5 k8s.gcr.io/etcd:3.5.0-0 k8s.gcr.io/coredns/coredns:v1.8.4 ","date":"2022-01-25","objectID":"/posts/kubernetes-deployment-using-kubeadm/:2:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","äº‘åŸç”Ÿ"],"title":"éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤","uri":"/posts/kubernetes-deployment-using-kubeadm/#0-ç½‘ç»œç¯å¢ƒçš„å‡†å¤‡"},{"categories":["tech"],"content":" 1. èŠ‚ç‚¹çš„ç¯å¢ƒå‡†å¤‡é¦–å…ˆå‡†å¤‡ä¸‰å° Linux è™šæ‹Ÿæœºï¼Œç³»ç»ŸæŒ‰éœ€é€‰æ‹©ï¼Œç„¶åè°ƒæ•´è¿™ä¸‰å°æœºå™¨çš„è®¾ç½®ï¼š èŠ‚ç‚¹é…ç½®ï¼š masterï¼šä¸ä½äº 2c/3gï¼Œç¡¬ç›˜ 20G ä¸»èŠ‚ç‚¹æ€§èƒ½ä¹Ÿå—é›†ç¾¤ Pods ä¸ªæ•°çš„å½±å“ï¼Œä¸Šè¿°é…ç½®åº”è¯¥å¯ä»¥æ”¯æ’‘åˆ°æ¯ä¸ª Worker èŠ‚ç‚¹è·‘ 100 ä¸ª Pod. workerï¼šçœ‹éœ€æ±‚ï¼Œå»ºè®®ä¸ä½äº 2c/4gï¼Œç¡¬ç›˜ä¸å°äº 20Gï¼Œèµ„æºå……åˆ†çš„è¯å»ºè®® 40G ä»¥ä¸Šã€‚ å¤„äºåŒä¸€ç½‘ç»œå†…å¹¶å¯äº’é€šï¼ˆé€šå¸¸æ˜¯åŒä¸€å±€åŸŸç½‘ï¼‰ å„ä¸»æœºçš„ hostname å’Œ mac/ip åœ°å€ä»¥åŠ /sys/class/dmi/id/product_uuidï¼Œéƒ½å¿…é¡»å”¯ä¸€ è¿™é‡Œæ–°æ‰‹æœ€å®¹æ˜“é‡åˆ°çš„é—®é¢˜ï¼Œæ˜¯ hostname å†²çª å¿…é¡»å…³é—­ swap äº¤æ¢å†…å­˜ï¼Œkubelet æ‰èƒ½æ­£å¸¸å·¥ä½œ æ–¹ä¾¿èµ·è§ï¼Œæˆ‘ç›´æ¥ä½¿ç”¨ryan4yin/pulumi-libvirt è‡ªåŠ¨åˆ›å»ºäº†äº”ä¸ª opensuse leap 15.3 è™šæ‹Ÿæœºï¼Œå¹¶è®¾ç½®å¥½äº† ip/hostname. ","date":"2022-01-25","objectID":"/posts/kubernetes-deployment-using-kubeadm/:3:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","äº‘åŸç”Ÿ"],"title":"éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤","uri":"/posts/kubernetes-deployment-using-kubeadm/#1-èŠ‚ç‚¹çš„ç¯å¢ƒå‡†å¤‡"},{"categories":["tech"],"content":" 1.1 iptables è®¾ç½®ç›®å‰ kubernetes çš„å®¹å™¨ç½‘ç»œï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯ bridge æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼ä¸‹ï¼Œéœ€è¦ä½¿ iptables èƒ½å¤Ÿæ¥ç®¡ bridge ä¸Šçš„æµé‡ã€‚ é…ç½®å¦‚ä¸‹ï¼š shell sudo modprobe br_netfilter cat \u003c\u003cEOF | sudo tee /etc/modules-load.d/k8s.conf br_netfilter EOF cat \u003c\u003cEOF | sudo tee /etc/sysctl.d/k8s.conf net.bridge.bridge-nf-call-ip6tables = 1 net.bridge.bridge-nf-call-iptables = 1 EOF sudo sysctl --system ","date":"2022-01-25","objectID":"/posts/kubernetes-deployment-using-kubeadm/:3:1","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","äº‘åŸç”Ÿ"],"title":"éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤","uri":"/posts/kubernetes-deployment-using-kubeadm/#11-iptables-è®¾ç½®"},{"categories":["tech"],"content":" 1.2 å¼€æ”¾èŠ‚ç‚¹ç«¯å£ å±€åŸŸç½‘ç¯å¢ƒçš„è¯ï¼Œå»ºè®®ç›´æ¥å…³é—­é˜²ç«å¢™ã€‚è¿™æ ·æ‰€æœ‰ç«¯å£éƒ½å¯ç”¨ï¼Œæ–¹ä¾¿å¿«æ·ã€‚ é€šå¸¸æˆ‘ä»¬çš„äº‘ä¸Šé›†ç¾¤ï¼Œä¹Ÿæ˜¯å…³é—­é˜²ç«å¢™çš„ï¼Œåªæ˜¯ä¼šé€šè¿‡äº‘æœåŠ¡æä¾›çš„ã€Œå®‰å…¨ç»„ã€æ¥é™åˆ¶å®¢æˆ·ç«¯ ip Control-plane èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ masterï¼Œéœ€è¦å¼€æ”¾å¦‚ä¸‹ç«¯å£ï¼š Protocol Direction Port Range Purpose Used By TCP Inbound 6443* Kubernetes API server All TCP Inbound 2379-2380 etcd server client API kube-apiserver, etcd TCP Inbound 10250 kubelet API Self, Control plane TCP Inbound 10251 kube-scheduler Self TCP Inbound 10252 kube-controller-manager Self Worker èŠ‚ç‚¹éœ€è¦å¼€å‘å¦‚ä¸‹ç«¯å£ï¼š Protocol Direction Port Range Purpose Used By TCP Inbound 10250 kubelet API Self, Control plane TCP Inbound 30000-32767 NodePort Servicesâ€  All å¦å¤–é€šå¸¸æˆ‘ä»¬æœ¬åœ°æµ‹è¯•çš„æ—¶å€™ï¼Œå¯èƒ½æ›´æƒ³ç›´æ¥åœ¨ 80 443 8080 ç­‰ç«¯å£ä¸Šä½¿ç”¨ NodePortï¼Œå°±éœ€è¦ä¿®æ”¹ kube-apiserver çš„ --service-node-port-range å‚æ•°æ¥è‡ªå®šä¹‰ NodePort çš„ç«¯å£èŒƒå›´ï¼Œç›¸åº”çš„ Worker èŠ‚ç‚¹ä¹Ÿå¾—å¼€æ”¾è¿™äº›ç«¯å£ã€‚ ","date":"2022-01-25","objectID":"/posts/kubernetes-deployment-using-kubeadm/:3:2","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","äº‘åŸç”Ÿ"],"title":"éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤","uri":"/posts/kubernetes-deployment-using-kubeadm/#12-å¼€æ”¾èŠ‚ç‚¹ç«¯å£"},{"categories":["tech"],"content":" 2. å®‰è£…å®¹å™¨è¿è¡Œæ—¶ containerdé¦–å…ˆæ˜¯ç¯å¢ƒé…ç½®ï¼š shell cat \u003c\u003cEOF | sudo tee /etc/modules-load.d/containerd.conf overlay br_netfilter nf_conntrack EOF sudo modprobe overlay sudo modprobe br_netfilter sudo modprobe nf_conntrack # Setup required sysctl params, these persist across reboots. cat \u003c\u003cEOF | sudo tee /etc/sysctl.d/99-kubernetes-cri.conf net.bridge.bridge-nf-call-iptables = 1 net.ipv4.ip_forward = 1 net.bridge.bridge-nf-call-ip6tables = 1 EOF # Apply sysctl params without reboot sudo sysctl --system å®‰è£… containerd+nerdctl: shell wget https://github.com/containerd/nerdctl/releases/download/v0.11.1/nerdctl-full-0.11.1-linux-amd64.tar.gz tar -axvf nerdctl-full-0.11.1-linux-amd64.tar.gz # è¿™é‡Œç®€å•èµ·è§ï¼Œrootless ç›¸å…³çš„ä¸œè¥¿ä¹Ÿä¸€èµ·è£…è¿›å»äº†ï¼Œæµ‹è¯•å˜›å°±æ— æ‰€è°“äº†... mv bin/* /usr/local/bin/ mv lib/systemd/system/containerd.service /usr/lib/systemd/system/ systemctl enable containerd systemctl start containerd nerdctl æ˜¯ä¸€ä¸ª containerd çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œä½†æ˜¯å®ƒçš„å®¹å™¨ã€é•œåƒä¸ Kubernetes çš„å®¹å™¨ã€é•œåƒæ˜¯å®Œå…¨éš”ç¦»çš„ï¼Œä¸èƒ½äº’é€šï¼ ç›®å‰åªèƒ½é€šè¿‡ crictl æ¥æŸ¥çœ‹ã€æ‹‰å– Kubernetes çš„å®¹å™¨ã€é•œåƒï¼Œä¸‹ä¸€èŠ‚ä¼šä»‹ç» crictl çš„å®‰è£…ã€‚ ","date":"2022-01-25","objectID":"/posts/kubernetes-deployment-using-kubeadm/:4:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","äº‘åŸç”Ÿ"],"title":"éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤","uri":"/posts/kubernetes-deployment-using-kubeadm/#2-å®‰è£…å®¹å™¨è¿è¡Œæ—¶-containerd"},{"categories":["tech"],"content":" 3. å®‰è£… kubelet/kubeadm/kubectl shell # ä¸€äº›å…¨å±€éƒ½éœ€è¦ç”¨çš„å˜é‡ CNI_VERSION=\"v0.8.2\" CRICTL_VERSION=\"v1.17.0\" # kubernetes çš„ç‰ˆæœ¬å· # RELEASE=\"$(curl -sSL https://dl.k8s.io/release/stable.txt)\" RELEASE=\"1.22.1\" # kubelet é…ç½®æ–‡ä»¶çš„ç‰ˆæœ¬å· RELEASE_VERSION=\"v0.4.0\" # æ¶æ„ ARCH=\"amd64\" # å®‰è£…ç›®å½• DOWNLOAD_DIR=/usr/local/bin # CNI æ’ä»¶ sudo mkdir -p /opt/cni/bin curl -L \"https://github.com/containernetworking/plugins/releases/download/${CNI_VERSION}/cni-plugins-linux-${ARCH}-${CNI_VERSION}.tgz\" | sudo tar -C /opt/cni/bin -xz # crictl ç›¸å…³å·¥å…· curl -L \"https://github.com/kubernetes-sigs/cri-tools/releases/download/${CRICTL_VERSION}/crictl-${CRICTL_VERSION}-linux-${ARCH}.tar.gz\" | sudo tar -C $DOWNLOAD_DIR -xz # kubelet/kubeadm/kubectl cd $DOWNLOAD_DIR sudo curl -L --remote-name-all https://storage.googleapis.com/kubernetes-release/release/${RELEASE}/bin/linux/${ARCH}/{kubeadm,kubelet,kubectl} sudo chmod +x {kubeadm,kubelet,kubectl} # kubelet/kubeadm é…ç½® curl -sSL \"https://raw.githubusercontent.com/kubernetes/release/${RELEASE_VERSION}/cmd/kubepkg/templates/latest/deb/kubelet/lib/systemd/system/kubelet.service\" | sed \"s:/usr/bin:${DOWNLOAD_DIR}:g\" | sudo tee /etc/systemd/system/kubelet.service sudo mkdir -p /etc/systemd/system/kubelet.service.d curl -sSL \"https://raw.githubusercontent.com/kubernetes/release/${RELEASE_VERSION}/cmd/kubepkg/templates/latest/deb/kubeadm/10-kubeadm.conf\" | sed \"s:/usr/bin:${DOWNLOAD_DIR}:g\" | sudo tee /etc/systemd/system/kubelet.service.d/10-kubeadm.conf systemctl enable --now kubelet # éªŒè¯ kubelet å¯åŠ¨èµ·æ¥äº†ï¼Œä½†æ˜¯ç›®å‰è¿˜æ²¡æœ‰åˆå§‹åŒ–é…ç½®ï¼Œè¿‡ä¸€é˜µå°±ä¼šé‡å¯ä¸€æ¬¡ systemctl status kubelet è¯•ç”¨ crictl: shell export CONTAINER_RUNTIME_ENDPOINT='unix:///var/run/containerd/containerd.sock' # åˆ—å‡ºæ‰€æœ‰ podsï¼Œç°åœ¨åº”è¯¥å•¥ä¹Ÿæ²¡ crictl pods # åˆ—å‡ºæ‰€æœ‰é•œåƒ crictl images ","date":"2022-01-25","objectID":"/posts/kubernetes-deployment-using-kubeadm/:5:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","äº‘åŸç”Ÿ"],"title":"éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤","uri":"/posts/kubernetes-deployment-using-kubeadm/#3-å®‰è£…-kubeletkubeadmkubectl"},{"categories":["tech"],"content":" 4. ä¸º master çš„ kube-apiserver åˆ›å»ºè´Ÿè½½å‡è¡¡å®ç°é«˜å¯ç”¨æ ¹æ® kubeadm å®˜æ–¹æ–‡æ¡£Kubeadm Docs - High Availability Considerations ä»‹ç»ï¼Œè¦å®ç° kube-apiserver çš„é«˜å¯ç”¨ï¼Œç›®å‰æœ€çŸ¥åçš„è´Ÿè½½å‡è¡¡æ–¹å¼æ˜¯ keepalived+haproxyï¼Œå¦å¤–ä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨ kube-vip ç­‰æ›´ç®€å•çš„å·¥å…·ã€‚ ç®€å•èµ·è§ï¼Œæˆ‘ä»¬ç›´æ¥ç”¨ kube-vip å§ï¼Œå‚è€ƒäº† kube-vip çš„å®˜æ–¹æ–‡æ¡£ï¼šKube-vip as a Static Pod with Kubelet. P.S. æˆ‘ä¹Ÿè§è¿‡æœ‰çš„å®‰è£…å·¥å…·ä¼šç›´æ¥æŠ›å¼ƒ keepalivedï¼Œç›´æ¥åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè·‘ä¸€ä¸ª nginx åšè´Ÿè½½å‡è¡¡ï¼Œé…ç½®é‡Œå†™æ­»äº†æ‰€æœ‰ master çš„åœ°å€â€¦ é¦–å…ˆä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ç”Ÿæˆ kube-vip çš„é…ç½®æ–‡ä»¶ï¼Œä»¥ ARP ä¸ºä¾‹ï¼ˆç”Ÿäº§ç¯å¢ƒå»ºè®®æ¢æˆ BGPï¼‰ï¼š shell cat \u003c\u003cEOF | sudo tee add-kube-vip.sh # ä½ çš„è™šæ‹Ÿæœºç½‘å¡ï¼Œopensuse/centos ç­‰éƒ½æ˜¯ eth0ï¼Œä½†æ˜¯ ubuntu å¯èƒ½æ˜¯ ens3 export INTERFACE=eth0 # ç”¨äºå®ç°é«˜å¯ç”¨çš„ vipï¼Œéœ€è¦å’Œå‰é¢çš„ç½‘ç»œæ¥å£åœ¨åŒä¸€ç½‘æ®µå†…ï¼Œå¦åˆ™å°±æ— æ³•è·¯ç”±äº†ã€‚ export VIP=192.168.122.200 # ç”Ÿæˆ static-pod çš„é…ç½®æ–‡ä»¶ mkdir -p /etc/kubernetes/manifests nerdctl run --rm --network=host --entrypoint=/kube-vip ghcr.io/kube-vip/kube-vip:v0.3.8 \\ manifest pod \\ --interface $INTERFACE \\ --vip $VIP \\ --controlplane \\ --services \\ --arp \\ --leaderElection | tee /etc/kubernetes/manifests/kube-vip.yaml EOF bash add-kube-vip.sh ä¸‰ä¸ª master èŠ‚ç‚¹éƒ½éœ€è¦è·‘ä¸‹ä¸Šé¢çš„å‘½ä»¤ï¼ˆworker ä¸éœ€è¦ï¼‰ï¼Œåˆ›å»ºå¥½ kube-vip çš„ static-pod é…ç½®æ–‡ä»¶ã€‚åœ¨å®Œæˆ kubeadm åˆå§‹åŒ–åï¼Œkubelet ä¼šè‡ªåŠ¨æŠŠå®ƒä»¬æ‹‰èµ·ä¸º static pod. ","date":"2022-01-25","objectID":"/posts/kubernetes-deployment-using-kubeadm/:6:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","äº‘åŸç”Ÿ"],"title":"éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤","uri":"/posts/kubernetes-deployment-using-kubeadm/#4-ä¸º-master-çš„-kube-apiserver-åˆ›å»ºè´Ÿè½½å‡è¡¡å®ç°é«˜å¯ç”¨"},{"categories":["tech"],"content":" 5. ä½¿ç”¨ kubeadm åˆ›å»ºé›†ç¾¤å…¶å®éœ€è¦è¿è¡Œçš„å°±æ˜¯è¿™æ¡å‘½ä»¤ï¼š shell # æç®€é…ç½®ï¼š cat \u003c\u003cEOF | sudo tee kubeadm-config.yaml apiVersion: kubeadm.k8s.io/v1beta3 kind: InitConfiguration nodeRegistration: criSocket: \"/var/run/containerd/containerd.sock\" imagePullPolicy: IfNotPresent --- kind: ClusterConfiguration apiVersion: kubeadm.k8s.io/v1beta3 kubernetesVersion: v1.22.1 clusterName: kubernetes certificatesDir: /etc/kubernetes/pki imageRepository: k8s.gcr.io controlPlaneEndpoint: \"192.168.122.200:6443\" # å¡« apiserver çš„ vip åœ°å€ï¼Œæˆ–è€…æ•´ä¸ªåŸŸåä¹Ÿè¡Œï¼Œä½†æ˜¯å°±å¾—åŠ  /etc/hosts æˆ–è€…å†…ç½‘ DNS è§£æ networking: serviceSubnet: \"10.96.0.0/16\" podSubnet: \"10.244.0.0/16\" etcd: local: dataDir: /var/lib/etcd --- apiVersion: kubelet.config.k8s.io/v1beta1 kind: KubeletConfiguration cgroupDriver: systemd # è®© kubelet ä» certificates.k8s.io ç”³è¯·ç”±é›†ç¾¤ CA Root ç­¾åçš„ tls è¯ä¹¦ï¼Œè€Œéç›´æ¥ä½¿ç”¨è‡ªç­¾åè¯ä¹¦ # å¦‚æœä¸å¯ç”¨è¿™ä¸ªï¼Œ å®‰è£… metrics-server æ—¶å°±ä¼šé‡åˆ°è¯ä¹¦æŠ¥é”™ï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»ã€‚ serverTLSBootstrap: true EOF # æŸ¥çœ‹ kubeadm é»˜è®¤çš„å®Œæ•´é…ç½®ï¼Œä¾›å‚è€ƒ kubeadm config print init-defaults \u003e init.default.yaml # æ‰§è¡Œé›†ç¾¤çš„åˆå§‹åŒ–ï¼Œè¿™ä¼šç›´æ¥å°†å½“å‰èŠ‚ç‚¹åˆ›å»ºä¸º master # æˆåŠŸè¿è¡Œçš„å‰æï¼šå‰é¢è¯¥è£…çš„ä¸œè¥¿éƒ½è£…å¥½äº†ï¼Œè€Œä¸” kubelet å·²ç»åœ¨åå°è¿è¡Œäº† # `--upload-certs` ä¼šå°†ç”Ÿæˆçš„é›†ç¾¤è¯ä¹¦ä¸Šä¼ åˆ° kubeadm æœåŠ¡å™¨ï¼Œåœ¨ä¸¤å°æ—¶å†…åŠ å…¥é›†ç¾¤çš„ master èŠ‚ç‚¹ä¼šè‡ªåŠ¨æ‹‰è¯ä¹¦ï¼Œä¸»è¦æ˜¯æ–¹ä¾¿é›†ç¾¤åˆ›å»ºã€‚ kubeadm init --config kubeadm-config.yaml --upload-certs kubeadm åº”è¯¥ä¼šæŠ¥é”™ï¼Œæç¤ºä½ æœ‰äº›ä¾èµ–ä¸å­˜åœ¨ï¼Œä¸‹é¢å…ˆå®‰è£…å¥½ä¾èµ–é¡¹ã€‚ shell sudo zypper in -y socat ebtables conntrack-tools å†é‡æ–°è¿è¡Œå‰é¢çš„ kubeadm å‘½ä»¤ï¼Œåº”è¯¥å°±èƒ½æ­£å¸¸æ‰§è¡Œäº†ï¼Œå®ƒåšçš„æ“ä½œæœ‰ï¼š æ‹‰å–æ§åˆ¶é¢çš„å®¹å™¨é•œåƒ ç”Ÿæˆ ca æ ¹è¯ä¹¦ ä½¿ç”¨æ ¹è¯ä¹¦ä¸º etcd/apiserver ç­‰ä¸€ç¥¨å·¥å…·ç”Ÿæˆ tls è¯ä¹¦ ä¸ºæ§åˆ¶é¢çš„å„ä¸ªç»„ä»¶ç”Ÿæˆ kubeconfig é…ç½® ç”Ÿæˆ static pod é…ç½®ï¼Œkubelet ä¼šæ ¹æ®è¿™äº›é…ç½®è‡ªåŠ¨æ‹‰èµ· kube-proxy ä»¥åŠå…¶ä»–æ‰€æœ‰çš„ k8s master ç»„ä»¶ è¿è¡Œå®Œä¼šç»™å‡ºä¸‰éƒ¨åˆ†å‘½ä»¤ï¼š å°† kubeconfig æ”¾åˆ° $HOME/.kube/config ä¸‹ï¼Œkubectl éœ€è¦ä½¿ç”¨è¯¥é…ç½®æ–‡ä»¶è¿æ¥ kube-apiserver control-plane èŠ‚ç‚¹åŠ å…¥é›†ç¾¤çš„å‘½ä»¤: è¿™é‡Œç”±äºæˆ‘ä»¬æå‰æ·»åŠ äº† kube-vip çš„ static-pod é…ç½®ï¼Œè¿™é‡Œçš„ preflight-check ä¼šæŠ¥é”™ï¼Œéœ€è¦æ·»åŠ æ­¤å‚æ•°å¿½ç•¥è¯¥æŠ¥é”™ ---ignore-preflight-errors=DirAvailable--etc-kubernetes-manifests shell kubeadm join 192.168.122.200:6443 --token \u003ctoken\u003e \\ --discovery-token-ca-cert-hash sha256:\u003chash\u003e \\ --control-plane --certificate-key \u003ckey\u003e \\ --ignore-preflight-errors=DirAvailable--etc-kubernetes-manifests worker èŠ‚ç‚¹åŠ å…¥é›†ç¾¤çš„å‘½ä»¤: shell kubeadm join 192.168.122.200:6443 --token \u003ctoken\u003e \\ --discovery-token-ca-cert-hash sha256:\u003chash\u003e è·‘å®Œç¬¬ä¸€éƒ¨åˆ† kubeconfig çš„å¤„ç†å‘½ä»¤åï¼Œå°±å¯ä»¥ä½¿ç”¨ kubectl æŸ¥çœ‹é›†ç¾¤çŠ¶å†µäº†ï¼š shell k8s-master-0:~/kubeadm # kubectl get no NAME STATUS ROLES AGE VERSION k8s-master-0 NotReady control-plane,master 79s v1.22.1 k8s-master-0:~/kubeadm # kubectl get po --all-namespaces NAMESPACE NAME READY STATUS RESTARTS AGE kube-system coredns-78fcd69978-6tlnw 0/1 Pending 0 83s kube-system coredns-78fcd69978-hxtvs 0/1 Pending 0 83s kube-system etcd-k8s-master-0 1/1 Running 6 90s kube-system kube-apiserver-k8s-master-0 1/1 Running 4 90s kube-system kube-controller-manager-k8s-master-0 1/1 Running 4 90s kube-system kube-proxy-6w2bx 1/1 Running 0 83s kube-system kube-scheduler-k8s-master-0 1/1 Running 7 97s ç°åœ¨åœ¨å…¶ä»–èŠ‚ç‚¹è¿è¡Œå‰é¢æ‰“å°å‡ºçš„åŠ å…¥é›†ç¾¤çš„å‘½ä»¤ï¼Œå°±å¯ä»¥æ­å»ºå¥½ä¸€ä¸ªé«˜å¯ç”¨çš„é›†ç¾¤äº†ã€‚ æ‰€æœ‰èŠ‚ç‚¹éƒ½åŠ å…¥é›†ç¾¤åï¼Œé€šè¿‡ kubectl æŸ¥çœ‹ï¼Œåº”è¯¥æ˜¯ä¸‰ä¸ªæ§åˆ¶é¢ masterï¼Œä¸¤ä¸ª workerï¼š shell k8s-master-0:~/kubeadm # kubectl get node NAME STATUS ROLES AGE VERSION k8s-master-0 NotReady control-plane,master 26m v1.22.1 k8s-master-1 NotReady control-plane,master 7m2s v1.22.1 k8s-master-2 NotReady control-plane,master 2m10s v1.22.1 k8s-worker-0 NotReady \u003cnone\u003e 97s v1.22.1 k8s-worker-1 NotReady \u003cnone\u003e 86s v1.22.1 ç°åœ¨å®ƒä»¬éƒ½è¿˜å¤„äº NotReady çŠ¶æ€ï¼Œéœ€è¦ç­‰åˆ°æˆ‘ä»¬æŠŠç½‘ç»œæ’ä»¶å®‰è£…å¥½ï¼Œæ‰ä¼š Ready. ç°åœ¨å†çœ‹ä¸‹é›†ç¾¤çš„è¯ä¹¦ç­¾å‘çŠ¶æ€ï¼š shell â¯ kubectl get csr --sort-by='{.spec.username}' NAME AGE SIGNERNAME REQUESTER REQUESTEDDURATION CONDITION csr-95hll 6m58s kubernetes.io/kube-apiserver-client-kubelet system:bootstrap:q8ivnz \u003cnone\u003e Approved,Issued csr-tklnr 7m5s kubernetes.io/kube-apiserver-client-kubelet system:bootstrap:q8ivnz \u003cnone\u003e Approved,Issued csr-w92jv 9m15s kubernetes.io/kube-apiserver-client-kubelet system:bootstrap:q8ivnz \u003cnone\u003e Approved,Issued csr-rv7sj 8m11s kubernetes.io/kube-apiserver-client-kubelet system:bootstrap:q8ivnz \u003cnone\u003e Approved,Issued csr-nxkgx 10m kubernetes.io/kube-apiserver-client-kubelet system:node:k8s-master-0 \u003cnone\u003e Approved,Issued csr-cd22c 10m kubernetes.io/kubelet-serving system:node:k8s-master-0 \u003cnone\u003e Pending csr-wjrnr 9m53s kubernetes.io/kubelet-serving system:node:k8s-master-0 \u003cnone\u003e Pending ","date":"2022-01-25","objectID":"/posts/kubernetes-deployment-using-kubeadm/:7:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","äº‘åŸç”Ÿ"],"title":"éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤","uri":"/posts/kubernetes-deployment-using-kubeadm/#5-ä½¿ç”¨-kubeadm-åˆ›å»ºé›†ç¾¤"},{"categories":["tech"],"content":" 5.1 å¸¸è§é—®é¢˜ 5.1.1 é‡ç½®é›†ç¾¤é…ç½®åˆ›å»ºé›†ç¾¤çš„è¿‡ç¨‹ä¸­å‡ºç°ä»»ä½•é—®é¢˜ï¼Œéƒ½å¯ä»¥é€šè¿‡åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šè¿è¡Œ kubeadm reset æ¥è¿˜åŸé…ç½®ï¼Œç„¶åé‡æ–°èµ° kubeadm çš„é›†ç¾¤åˆ›å»ºæµç¨‹ã€‚ ä½†æ˜¯è¦æ³¨æ„å‡ ç‚¹ï¼š kubeadm reset ä¼šæ¸…é™¤åŒ…å« kube-vip é…ç½®åœ¨å†…çš„æ‰€æœ‰ static-pod é…ç½®æ–‡ä»¶ï¼Œæ‰€ä»¥ master èŠ‚ç‚¹éœ€è¦é‡æ–°è·‘ä¸‹å‰é¢ç»™çš„ kube-vip å‘½ä»¤ï¼Œç”Ÿæˆä¸‹ kube-vip é…ç½®ã€‚ kubeadm reset ä¸ä¼šé‡ç½®ç½‘ç»œæ¥å£çš„é…ç½®ï¼Œmaster èŠ‚ç‚¹éœ€è¦æ‰‹åŠ¨æ¸…ç†ä¸‹ kube-vip æ·»åŠ çš„ vip:ip addr del 192.168.122.200/32 dev eth0. å¦‚æœä½ åœ¨å®‰è£…äº†ç½‘ç»œæ’ä»¶ä¹‹åå¸Œæœ›é‡è£…é›†ç¾¤ï¼Œé¡ºåºå¦‚ä¸‹ï¼š é€šè¿‡ kubectl delete -f xxx.yaml/helm uninstall åˆ é™¤æ‰€æœ‰é™¤ç½‘ç»œä¹‹å¤–çš„å…¶ä»–åº”ç”¨é…ç½® åˆ é™¤ç½‘ç»œæ’ä»¶ å…ˆé‡å¯ä¸€éæ‰€æœ‰èŠ‚ç‚¹ï¼Œæˆ–è€…æ‰‹åŠ¨é‡ç½®æ‰€æœ‰èŠ‚ç‚¹çš„ç½‘ç»œé…ç½® å»ºè®®é‡å¯ï¼Œå› ä¸ºæˆ‘ä¸çŸ¥é“è¯¥æ€ä¹ˆæ‰‹åŠ¨é‡ç½®â€¦ è¯•äº† systemctl restart network å¹¶ä¸ä¼šæ¸…ç†æ‰€æœ‰è™šæ‹Ÿç½‘ç»œæ¥å£ã€‚ å¦‚æ­¤æ“ä½œåï¼Œå†é‡æ–°æ‰§è¡Œé›†ç¾¤å®‰è£…ï¼Œåº”è¯¥å°±æ²¡å•¥æ¯›ç—…äº†ã€‚ ","date":"2022-01-25","objectID":"/posts/kubernetes-deployment-using-kubeadm/:7:1","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","äº‘åŸç”Ÿ"],"title":"éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤","uri":"/posts/kubernetes-deployment-using-kubeadm/#51-å¸¸è§é—®é¢˜"},{"categories":["tech"],"content":" 5.1 å¸¸è§é—®é¢˜ 5.1.1 é‡ç½®é›†ç¾¤é…ç½®åˆ›å»ºé›†ç¾¤çš„è¿‡ç¨‹ä¸­å‡ºç°ä»»ä½•é—®é¢˜ï¼Œéƒ½å¯ä»¥é€šè¿‡åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šè¿è¡Œ kubeadm reset æ¥è¿˜åŸé…ç½®ï¼Œç„¶åé‡æ–°èµ° kubeadm çš„é›†ç¾¤åˆ›å»ºæµç¨‹ã€‚ ä½†æ˜¯è¦æ³¨æ„å‡ ç‚¹ï¼š kubeadm reset ä¼šæ¸…é™¤åŒ…å« kube-vip é…ç½®åœ¨å†…çš„æ‰€æœ‰ static-pod é…ç½®æ–‡ä»¶ï¼Œæ‰€ä»¥ master èŠ‚ç‚¹éœ€è¦é‡æ–°è·‘ä¸‹å‰é¢ç»™çš„ kube-vip å‘½ä»¤ï¼Œç”Ÿæˆä¸‹ kube-vip é…ç½®ã€‚ kubeadm reset ä¸ä¼šé‡ç½®ç½‘ç»œæ¥å£çš„é…ç½®ï¼Œmaster èŠ‚ç‚¹éœ€è¦æ‰‹åŠ¨æ¸…ç†ä¸‹ kube-vip æ·»åŠ çš„ vip:ip addr del 192.168.122.200/32 dev eth0. å¦‚æœä½ åœ¨å®‰è£…äº†ç½‘ç»œæ’ä»¶ä¹‹åå¸Œæœ›é‡è£…é›†ç¾¤ï¼Œé¡ºåºå¦‚ä¸‹ï¼š é€šè¿‡ kubectl delete -f xxx.yaml/helm uninstall åˆ é™¤æ‰€æœ‰é™¤ç½‘ç»œä¹‹å¤–çš„å…¶ä»–åº”ç”¨é…ç½® åˆ é™¤ç½‘ç»œæ’ä»¶ å…ˆé‡å¯ä¸€éæ‰€æœ‰èŠ‚ç‚¹ï¼Œæˆ–è€…æ‰‹åŠ¨é‡ç½®æ‰€æœ‰èŠ‚ç‚¹çš„ç½‘ç»œé…ç½® å»ºè®®é‡å¯ï¼Œå› ä¸ºæˆ‘ä¸çŸ¥é“è¯¥æ€ä¹ˆæ‰‹åŠ¨é‡ç½®â€¦ è¯•äº† systemctl restart network å¹¶ä¸ä¼šæ¸…ç†æ‰€æœ‰è™šæ‹Ÿç½‘ç»œæ¥å£ã€‚ å¦‚æ­¤æ“ä½œåï¼Œå†é‡æ–°æ‰§è¡Œé›†ç¾¤å®‰è£…ï¼Œåº”è¯¥å°±æ²¡å•¥æ¯›ç—…äº†ã€‚ ","date":"2022-01-25","objectID":"/posts/kubernetes-deployment-using-kubeadm/:7:1","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","äº‘åŸç”Ÿ"],"title":"éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤","uri":"/posts/kubernetes-deployment-using-kubeadm/#511-é‡ç½®é›†ç¾¤é…ç½®"},{"categories":["tech"],"content":" 6. éªŒè¯é›†ç¾¤çš„é«˜å¯ç”¨æ€§è™½ç„¶ç½‘ç»œæ’ä»¶è¿˜æ²¡è£…å¯¼è‡´é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹éƒ½è¿˜æ²¡ readyï¼Œä½†æ˜¯æˆ‘ä»¬å·²ç»å¯ä»¥é€šè¿‡ kubectl å‘½ä»¤æ¥ç®€å•éªŒè¯é›†ç¾¤çš„é«˜å¯ç”¨æ€§äº†ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬å°†å‰é¢æ”¾ç½®åœ¨ k8s-master-0 çš„è®¤è¯æ–‡ä»¶ $HOME/.kube/config ä»¥åŠ kunbectl å®‰è£…åœ¨å¦ä¸€å°æœºå™¨ä¸Šï¼Œæ¯”å¦‚æˆ‘ç›´æ¥æ”¾æˆ‘çš„å®¿ä¸»æœºã€‚ ç„¶ååœ¨å®¿ä¸»æœºä¸Šè·‘ kubectl get node å‘½ä»¤éªŒè¯é›†ç¾¤çš„é«˜å¯ç”¨æ€§ï¼š ä¸‰ä¸ªä¸»èŠ‚ç‚¹éƒ½æ­£å¸¸è¿è¡Œæ—¶ï¼Œkubectl å‘½ä»¤ä¹Ÿæ­£å¸¸ pause æˆ–è€… stop å…¶ä¸­ä¸€ä¸ª masterï¼Œkubectl å‘½ä»¤ä»ç„¶èƒ½æ­£å¸¸è¿è¡Œ å† pause ç¬¬äºŒä¸ª masterï¼Œkubectl å‘½ä»¤åº”è¯¥å°±ä¼šå¡ä½ï¼Œå¹¶ä¸”è¶…æ—¶ï¼Œæ— æ³•ä½¿ç”¨äº† resume æ¢å¤åœæ‰çš„ä¸¤ä¸ª master ä¹‹ä¸€ï¼Œä¼šå‘ç° kubectl å‘½ä»¤åˆèƒ½æ­£å¸¸è¿è¡Œäº† åˆ°è¿™é‡Œ kubeadm çš„å·¥ä½œå°±å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥å†å®‰è£…ç½‘ç»œæ’ä»¶ï¼Œé›†ç¾¤å°±å¯ç”¨äº†ã€‚ ","date":"2022-01-25","objectID":"/posts/kubernetes-deployment-using-kubeadm/:8:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","äº‘åŸç”Ÿ"],"title":"éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤","uri":"/posts/kubernetes-deployment-using-kubeadm/#6-éªŒè¯é›†ç¾¤çš„é«˜å¯ç”¨æ€§"},{"categories":["tech"],"content":" 7. å®‰è£…ç½‘ç»œæ’ä»¶ç¤¾åŒºæœ‰å¾ˆå¤šç§ç½‘ç»œæ’ä»¶å¯é€‰ï¼Œæ¯”è¾ƒçŸ¥åä¸”æ€§èƒ½ä¹Ÿä¸é”™çš„ï¼Œåº”è¯¥æ˜¯ Calico å’Œ Ciliumï¼Œå…¶ä¸­ Cilium ä¸»æ‰“åŸºäº eBPF çš„é«˜æ€§èƒ½ä¸é«˜å¯è§‚æµ‹æ€§ã€‚ ä¸‹é¢åˆ†åˆ«ä»‹ç»è¿™ä¸¤ä¸ªæ’ä»¶çš„å®‰è£…æ–¹æ³•ã€‚ï¼ˆæ³¨æ„åªèƒ½å®‰è£…å…¶ä¸­ä¸€ä¸ªç½‘ç»œæ’ä»¶ï¼Œä¸èƒ½é‡å¤å®‰è£…ã€‚ï¼‰ éœ€è¦æå‰åœ¨æœ¬æœºå®‰è£…å¥½ helmï¼Œæˆ‘è¿™é‡Œä½¿ç”¨å®¿ä¸»æœºï¼Œå› æ­¤åªéœ€è¦åœ¨å®¿ä¸»æœºå®‰è£…: shell # ä¸€è¡Œå‘½ä»¤å®‰è£…ï¼Œä¹Ÿå¯ä»¥è‡ªå·±æ‰‹åŠ¨ä¸‹è½½å®‰è£…åŒ…ï¼Œéƒ½è¡Œ curl https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3 | bash # æˆ–è€… opensuse ç›´æ¥ç”¨åŒ…ç®¡ç†å™¨å®‰è£… sudo zypper in helm ","date":"2022-01-25","objectID":"/posts/kubernetes-deployment-using-kubeadm/:9:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","äº‘åŸç”Ÿ"],"title":"éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤","uri":"/posts/kubernetes-deployment-using-kubeadm/#7-å®‰è£…ç½‘ç»œæ’ä»¶"},{"categories":["tech"],"content":" 7.1 å®‰è£… Cilium å®˜æ–¹æ–‡æ¡£ï¼šhttps://docs.cilium.io/en/v1.10/gettingstarted/k8s-install-kubeadm/ cilium é€šè¿‡ eBPF æä¾›äº†é«˜æ€§èƒ½ä¸é«˜å¯è§‚æµ‹çš„ k8s é›†ç¾¤ç½‘ç»œï¼Œå¦å¤– cilium è¿˜æä¾›äº†æ¯” kube-proxy æ›´é«˜æ•ˆçš„å®ç°ï¼Œå¯ä»¥å®Œå…¨æ›¿ä»£ kube-proxy. è¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯å…ˆä½¿ç”¨ kube-proxy æ¨¡å¼ï¼Œå…ˆç†Ÿæ‚‰ä¸‹ cilium çš„ä½¿ç”¨ï¼š shell helm repo add cilium https://helm.cilium.io/ helm search repo cilium/cilium -l | head helm install cilium cilium/cilium --version 1.10.4 --namespace kube-system å¯ä»¥é€šè¿‡ kubectl get pod -A æŸ¥çœ‹ cilium çš„å®‰è£…è¿›åº¦ï¼Œå½“æ‰€æœ‰ pod éƒ½ ready åï¼Œé›†ç¾¤å°± ready äº†~ cilium ä¹Ÿæä¾›äº†ä¸“ç”¨çš„å®¢æˆ·ç«¯ï¼š shell curl -L --remote-name-all https://github.com/cilium/cilium-cli/releases/latest/download/cilium-linux-amd64.tar.gz{,.sha256sum} sha256sum --check cilium-linux-amd64.tar.gz.sha256sum sudo tar xzvfC cilium-linux-amd64.tar.gz /usr/local/bin rm cilium-linux-amd64.tar.gz{,.sha256sum} ç„¶åä½¿ç”¨ cilium å®¢æˆ·ç«¯æ£€æŸ¥ç½‘ç»œæ’ä»¶çš„çŠ¶æ€ï¼š shell $ cilium status --wait /Â¯Â¯\\ /Â¯Â¯\\__/Â¯Â¯\\ Cilium: OK \\__/Â¯Â¯\\__/ Operator: OK /Â¯Â¯\\__/Â¯Â¯\\ Hubble: disabled \\__/Â¯Â¯\\__/ ClusterMesh: disabled \\__/ DaemonSet cilium Desired: 5, Ready: 5/5, Available: 5/5 Deployment cilium-operator Desired: 2, Ready: 2/2, Available: 2/2 Containers: cilium Running: 5 cilium-operator Running: 2 Cluster Pods: 2/2 managed by Cilium Image versions cilium quay.io/cilium/cilium:v1.10.4@sha256:7d354052ccf2a7445101d78cebd14444c7c40129ce7889f2f04b89374dbf8a1d: 5 cilium-operator quay.io/cilium/operator-generic:v1.10.4@sha256:c49a14e34634ff1a494c84b718641f27267fb3a0291ce3d74352b44f8a8d2f93: 2 cilium è¿˜æä¾›äº†å‘½ä»¤ï¼Œè‡ªåŠ¨åˆ›å»º pod è¿›è¡Œé›†ç¾¤ç½‘ç»œçš„è¿æ¥æ€§æµ‹è¯•ï¼š shell â¯ cilium connectivity test â„¹ï¸ Monitor aggregation detected, will skip some flow validation steps âœ¨ [kubernetes] Creating namespace for connectivity check... âœ¨ [kubernetes] Deploying echo-same-node service... âœ¨ [kubernetes] Deploying same-node deployment... âœ¨ [kubernetes] Deploying client deployment... âœ¨ [kubernetes] Deploying client2 deployment... âœ¨ [kubernetes] Deploying echo-other-node service... âœ¨ [kubernetes] Deploying other-node deployment... ... â„¹ï¸ Expose Relay locally with: cilium hubble enable cilium status --wait cilium hubble port-forward\u0026 ğŸƒ Running tests... ... --------------------------------------------------------------------------------------------------------------------- âœ… All 11 tests (134 actions) successful, 0 tests skipped, 0 scenarios skipped. é€šè¿‡ kubectl get po -A èƒ½è§‚å¯Ÿåˆ°ï¼Œè¿™ä¸ªæµ‹è¯•å‘½ä»¤ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª cilium-test åå­—ç©ºé—´ï¼Œå¹¶åœ¨å¯åŠ¨åˆ›å»ºè‹¥å¹² pod è¿›è¡Œè¯¦ç»†çš„æµ‹è¯•ã€‚ æ•´ä¸ªæµ‹è¯•æµç¨‹å¤§æ¦‚ä¼šæŒç»­ 5 åˆ†å¤šé’Ÿï¼Œæµ‹è¯•å®Œæˆåï¼Œç›¸å…³ Pod ä¸ä¼šè‡ªåŠ¨åˆ é™¤ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ‰‹åŠ¨åˆ é™¤ï¼š shell kubectl delete namespace cilium-test ","date":"2022-01-25","objectID":"/posts/kubernetes-deployment-using-kubeadm/:9:1","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","äº‘åŸç”Ÿ"],"title":"éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤","uri":"/posts/kubernetes-deployment-using-kubeadm/#71-å®‰è£…-cilium"},{"categories":["tech"],"content":" 7.2 å®‰è£… Calico å®˜æ–¹æ–‡æ¡£ï¼šhttps://docs.projectcalico.org/getting-started/kubernetes/self-managed-onprem/onpremises ä¹Ÿå°±ä¸¤ä¸‰è¡Œå‘½ä»¤ã€‚å®‰è£…ç¡®å®ç‰¹åˆ«ç®€å•ï¼Œæ‡’å¾—ä»‹ç»äº†ï¼Œçœ‹å®˜æ–¹æ–‡æ¡£å§ã€‚ ä½†æ˜¯å®é™…ä¸Š calico çš„ç»†èŠ‚è¿˜è›®å¤šçš„ï¼Œå»ºè®®é€šè¯»ä¸‹å®ƒçš„å®˜æ–¹æ–‡æ¡£ï¼Œäº†è§£ä¸‹ calico çš„æ¶æ„ã€‚ ","date":"2022-01-25","objectID":"/posts/kubernetes-deployment-using-kubeadm/:9:2","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","äº‘åŸç”Ÿ"],"title":"éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤","uri":"/posts/kubernetes-deployment-using-kubeadm/#72-å®‰è£…-calico"},{"categories":["tech"],"content":" 8. æŸ¥çœ‹é›†ç¾¤çŠ¶æ€å®˜æ–¹çš„ dashboard ä¸ªäººæ„Ÿè§‰ä¸å¤ªå¥½ç”¨ï¼Œå»ºè®®ç›´æ¥åœ¨æœ¬åœ°è£…ä¸ª k9s ç”¨ï¼Œç‰¹åˆ«çˆ½ã€‚ shell sudo zypper in k9s ç„¶åå°±å¯ä»¥æ„‰å¿«åœ°ç©è€äº†ã€‚ ","date":"2022-01-25","objectID":"/posts/kubernetes-deployment-using-kubeadm/:10:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","äº‘åŸç”Ÿ"],"title":"éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤","uri":"/posts/kubernetes-deployment-using-kubeadm/#8-æŸ¥çœ‹é›†ç¾¤çŠ¶æ€"},{"categories":["tech"],"content":" 9. å®‰è£… metrics-server è¿™ä¸€æ­¥å¯èƒ½é‡åˆ°çš„é—®é¢˜ï¼šEnabling signed kubelet serving certificates å¦‚æœéœ€è¦ä½¿ç”¨ HPA ä»¥åŠç®€å•çš„é›†ç¾¤ç›‘æ§ï¼Œé‚£ä¹ˆ metrics-server æ˜¯å¿…é¡»å®‰è£…çš„ï¼Œç°åœ¨æˆ‘ä»¬å®‰è£…ä¸€ä¸‹å®ƒã€‚ é¦–å…ˆï¼Œè·‘ kubectl çš„ç›‘æ§å‘½ä»¤åº”è¯¥ä¼šæŠ¥é”™ï¼š shell â¯ kubectl top node error: Metrics API not available k9s é‡Œé¢åº”è¯¥ä¹Ÿçœ‹ä¸åˆ°ä»»ä½•ç›‘æ§æŒ‡æ ‡ã€‚ ç°åœ¨é€šè¿‡ helm å®‰è£…å®ƒï¼š shell helm repo add metrics-server https://kubernetes-sigs.github.io/metrics-server/ helm search repo metrics-server/metrics-server -l | head helm upgrade --install metrics-server metrics-server/metrics-server --version 3.5.0 --namespace kube-system metrics-server é»˜è®¤åªä¼šéƒ¨ç½²ä¸€ä¸ªå®ä¾‹ï¼Œå¦‚æœå¸Œæœ›é«˜å¯ç”¨ï¼Œè¯·å‚è€ƒå®˜æ–¹é…ç½®ï¼šmetrics-server - high-availability manifests ç­‰ metrics-server å¯åŠ¨å¥½åï¼Œå°±å¯ä»¥ä½¿ç”¨ kubectl top å‘½ä»¤å•¦ï¼š shell â¯ kubectl top node NAME CPU(cores) CPU% MEMORY(bytes) MEMORY% k8s-master-0 327m 16% 1465Mi 50% k8s-master-1 263m 13% 1279Mi 44% k8s-master-2 289m 14% 1282Mi 44% k8s-worker-0 62m 3% 518Mi 13% k8s-worker-1 115m 2% 659Mi 8% â¯ kubectl top pod No resources found in default namespace. â¯ kubectl top pod -A NAMESPACE NAME CPU(cores) MEMORY(bytes) kube-system cilium-45nw4 9m 135Mi kube-system cilium-5x7jf 6m 154Mi kube-system cilium-84sr2 7m 160Mi kube-system cilium-operator-78f45675-dp4b6 2m 30Mi kube-system cilium-operator-78f45675-fpm5g 1m 30Mi kube-system cilium-tkhl4 6m 141Mi kube-system cilium-zxbvm 5m 138Mi kube-system coredns-78fcd69978-dpxxk 3m 16Mi kube-system coredns-78fcd69978-pdf9p 1m 18Mi kube-system etcd-k8s-master-0 61m 88Mi kube-system etcd-k8s-master-1 50m 85Mi kube-system etcd-k8s-master-2 55m 83Mi kube-system kube-apiserver-k8s-master-0 98m 462Mi kube-system kube-apiserver-k8s-master-1 85m 468Mi kube-system kube-apiserver-k8s-master-2 85m 423Mi kube-system kube-controller-manager-k8s-master-0 22m 57Mi kube-system kube-controller-manager-k8s-master-1 2m 23Mi kube-system kube-controller-manager-k8s-master-2 2m 23Mi kube-system kube-proxy-j2s76 1m 24Mi kube-system kube-proxy-k6d6z 1m 18Mi kube-system kube-proxy-k85rx 1m 23Mi kube-system kube-proxy-pknsc 1m 20Mi kube-system kube-proxy-xsq4m 1m 15Mi kube-system kube-scheduler-k8s-master-0 3m 25Mi kube-system kube-scheduler-k8s-master-1 4m 21Mi kube-system kube-scheduler-k8s-master-2 5m 21Mi kube-system kube-vip-k8s-master-0 4m 17Mi kube-system kube-vip-k8s-master-1 2m 16Mi kube-system kube-vip-k8s-master-2 2m 17Mi kube-system metrics-server-559f85484-5b6xf 7m 27Mi ","date":"2022-01-25","objectID":"/posts/kubernetes-deployment-using-kubeadm/:11:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","äº‘åŸç”Ÿ"],"title":"éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤","uri":"/posts/kubernetes-deployment-using-kubeadm/#9-å®‰è£…-metrics-server"},{"categories":["tech"],"content":" 10. ä¸º etcd æ·»åŠ å®šæœŸå¤‡ä»½èƒ½åŠ›è¯·ç§»æ­¥etcd çš„å¤‡ä»½ä¸æ¢å¤ ","date":"2022-01-25","objectID":"/posts/kubernetes-deployment-using-kubeadm/:12:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","äº‘åŸç”Ÿ"],"title":"éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤","uri":"/posts/kubernetes-deployment-using-kubeadm/#10-ä¸º-etcd-æ·»åŠ å®šæœŸå¤‡ä»½èƒ½åŠ›"},{"categories":["tech"],"content":" 11. å®‰è£… Volume Provisioneråœ¨æˆ‘ä»¬å­¦ä¹ ä½¿ç”¨ Prometheus/MinIO/Tekton ç­‰æœ‰çŠ¶æ€åº”ç”¨æ—¶ï¼Œå®ƒä»¬é»˜è®¤æƒ…å†µä¸‹ä¼šé€šè¿‡ PVC å£°æ˜éœ€è¦çš„æ•°æ®å·ã€‚ ä¸ºäº†æ”¯æŒè¿™ä¸ªèƒ½åŠ›ï¼Œæˆ‘ä»¬éœ€è¦åœ¨é›†ç¾¤ä¸­éƒ¨ç½²ä¸€ä¸ª Volume Provisioner. å¯¹äºäº‘ä¸Šç¯å¢ƒï¼Œç›´æ¥æ¥å…¥äº‘æœåŠ¡å•†æä¾›çš„ Volume Provisioner å°± OK äº†ï¼Œæ–¹ä¾¿çœäº‹è€Œä¸”è¶³å¤Ÿå¯é ã€‚ è€Œå¯¹äº bare-metal ç¯å¢ƒï¼Œæ¯”è¾ƒæœ‰åçš„åº”è¯¥æ˜¯ rook-cephï¼Œä½†æ˜¯è¿™ä¸ªç©æ„éƒ¨ç½²å¤æ‚ï¼Œç»´æŠ¤éš¾åº¦åˆé«˜ï¼Œä¸é€‚åˆç”¨æ¥æµ‹è¯•å­¦ä¹ ã€‚ å¯¹äºå¼€å‘ã€æµ‹è¯•ç¯å¢ƒï¼Œæˆ–è€…ä¸ªäººé›†ç¾¤ï¼Œå»ºè®®ä½¿ç”¨ï¼š local æ•°æ®å·ï¼Œé€‚åˆæ•°æ®å¯ä¸¢å¤±ï¼Œä¸”ä¸è¦æ±‚åˆ†å¸ƒå¼çš„åœºæ™¯ï¼Œå¦‚å¼€å‘æµ‹è¯•ç¯å¢ƒ https://github.com/kubernetes-sigs/sig-storage-local-static-provisioner https://github.com/rancher/local-path-provisioner NFS æ•°æ®å·ï¼Œé€‚åˆæ•°æ®å¯ä¸¢å¤±ï¼Œå¯¹æ€§èƒ½è¦æ±‚ä¸é«˜ï¼Œå¹¶ä¸”è¦æ±‚åˆ†å¸ƒå¼çš„åœºæ™¯ã€‚æ¯”å¦‚å¼€å‘æµ‹è¯•ç¯å¢ƒã€æˆ–è€…çº¿ä¸Šæ²¡å•¥å‹åŠ›çš„åº”ç”¨ https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner https://github.com/kubernetes-csi/csi-driver-nfs NFS æ•°æ®çš„å¯é æ€§ä¾èµ–äºå¤–éƒ¨ NFS æœåŠ¡å™¨ï¼Œä¼ä¸šé€šå¸¸ä½¿ç”¨ç¾¤æ™–ç­‰ NAS æ¥åš NFS æœåŠ¡å™¨ å¦‚æœå¤–éƒ¨ NFS æœåŠ¡å™¨å‡ºé—®é¢˜ï¼Œåº”ç”¨å°±ä¼šå´©ã€‚ ç›´æ¥ä½¿ç”¨äº‘ä¸Šçš„å¯¹è±¡å­˜å‚¨ï¼Œé€‚åˆå¸Œæœ›æ•°æ®ä¸ä¸¢å¤±ã€å¯¹æ€§èƒ½è¦æ±‚ä¸é«˜çš„åœºæ™¯ã€‚ ç›´æ¥ä½¿ç”¨ https://github.com/rclone/rclone mount æ¨¡å¼æ¥ä¿å­˜æ•°æ®ï¼Œæˆ–è€…ç›´æ¥åŒæ­¥æ–‡ä»¶å¤¹æ•°æ®åˆ°äº‘ç«¯ï¼ˆå¯èƒ½ä¼šæœ‰ä¸€å®šæ•°æ®ä¸¢å¤±ï¼‰ã€‚ ","date":"2022-01-25","objectID":"/posts/kubernetes-deployment-using-kubeadm/:13:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","äº‘åŸç”Ÿ"],"title":"éƒ¨ç½²ä¸€ä¸ª Kubernetes é›†ç¾¤","uri":"/posts/kubernetes-deployment-using-kubeadm/#11-å®‰è£…-volume-provisioner"},{"categories":["tech"],"content":" æœ¬æ–‡ç”±ä¸ªäººç¬”è®°ryan4yin/knowledge æ•´ç†è€Œæ¥ æœ¬æ–‡ä¸»è¦ä»‹ç»æˆ‘ä¸ªäººåœ¨ä½¿ç”¨ Kubernetes çš„è¿‡ç¨‹ä¸­ï¼Œæ€»ç»“å‡ºçš„ä¸€å¥—ã€ŒKubernetes é…ç½®ã€ï¼Œæ˜¯æˆ‘ä¸ªäººçš„ã€Œæœ€ä½³å®è·µã€ã€‚å…¶ä¸­å¤§éƒ¨åˆ†å†…å®¹éƒ½ç»å†è¿‡çº¿ä¸Šç¯å¢ƒçš„è€ƒéªŒï¼Œä½†æ˜¯ä¹Ÿæœ‰å°‘éƒ¨åˆ†è¿˜åªåœ¨æˆ‘è„‘å­é‡Œæ¨¡æ‹Ÿè¿‡ï¼Œè¯·è°¨æ…å‚è€ƒã€‚ é˜…è¯»å‰çš„å‡ ä¸ªæ³¨æ„äº‹é¡¹ï¼š è¿™ä»½æ–‡æ¡£æ¯”è¾ƒé•¿ï¼Œå›Šæ‹¬äº†å¾ˆå¤šå†…å®¹ï¼Œå»ºè®®å½“æˆå‚è€ƒæ‰‹å†Œä½¿ç”¨ï¼Œå…ˆå‚ç…§ç›®å½•ç®€å•è¯»ä¸€è¯»ï¼Œæœ‰éœ€è¦å†ç»†è¯»ç›¸å…³å†…å®¹ã€‚ è¿™ä»½æ–‡æ¡£éœ€è¦ä¸€å®šçš„ Kubernetes åŸºç¡€æ‰èƒ½ç†è§£ï¼Œè€Œä¸”å¦‚æœæ²¡æœ‰è¿‡å®è·µç»éªŒçš„è¯ï¼Œçœ‹ä¸Šå»å¯èƒ½ä¼šæ¯”è¾ƒæ¯ç‡¥ã€‚ è€Œæœ‰è¿‡å®è·µç»éªŒçš„å¤§ä½¬ï¼Œå¯èƒ½ä¼šè·Ÿæˆ‘æœ‰ä¸åŒçš„è§è§£ï¼Œæ¬¢è¿å„è·¯å¤§ä½¬è¯„è®º~ æˆ‘ä¼šè§†æƒ…å†µä¸å®šæœŸæ›´æ–°è¿™ä»½æ–‡æ¡£ã€‚ ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:0:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ","Cloud-Native"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/#"},{"categories":["tech"],"content":" é›¶ã€ç¤ºä¾‹é¦–å…ˆï¼Œè¿™é‡Œç»™å‡ºä¸€äº›æœ¬æ–‡éµå®ˆçš„å‰æï¼Œè¿™äº›å‰æåªæ˜¯å¥‘åˆæˆ‘é‡åˆ°çš„åœºæ™¯ï¼Œå¯çµæ´»å˜é€šï¼š è¿™é‡Œåªè®¨è®ºæ— çŠ¶æ€æœåŠ¡ï¼Œæœ‰çŠ¶æ€æœåŠ¡ä¸åœ¨è®¨è®ºèŒƒå›´å†… æˆ‘ä»¬ä¸ä½¿ç”¨ Deployment çš„æ»šåŠ¨æ›´æ–°èƒ½åŠ›ï¼Œè€Œæ˜¯ä¸ºæ¯ä¸ªæœåŠ¡çš„æ¯ä¸ªç‰ˆæœ¬ï¼Œéƒ½åˆ›å»ºä¸åŒçš„Deployment + HPA + PodDisruptionBudgetï¼Œè¿™æ˜¯ä¸ºäº†æ–¹ä¾¿åšé‡‘ä¸é›€/ç°åº¦å‘å¸ƒ æˆ‘ä»¬çš„æœåŠ¡å¯èƒ½ä¼šä½¿ç”¨ IngressController / Service Mesh æ¥è¿›è¡ŒæœåŠ¡çš„è´Ÿè½½å‡è¡¡ã€æµé‡åˆ‡åˆ† ä¸‹é¢å…ˆç»™å‡ºä¸€ä¸ª Deployment + HPA + PodDisruptionBudget çš„ demoï¼Œåé¢å†æ‹†å¼€è¯¦ç»†è¯´ä¸‹ï¼š yaml apiVersion: apps/v1 kind: Deployment metadata: name: my-app-v3 namespace: prod # å»ºè®®æŒ‰ä¸šåŠ¡é€»è¾‘åˆ’åˆ†åå­—ç©ºé—´ï¼Œprod ä»…ä¸ºç¤ºä¾‹ labels: app: my-app spec: replicas: 3 strategy: type: RollingUpdate # å› ä¸ºæœåŠ¡çš„æ¯ä¸ªç‰ˆæœ¬éƒ½ä½¿ç”¨å„è‡ªçš„ Deploymentï¼ŒæœåŠ¡æ›´æ–°æ—¶å…¶å®æ˜¯ç”¨ä¸ä¸Šè¿™é‡Œçš„æ»šåŠ¨æ›´æ–°ç­–ç•¥çš„ # è¿™ä¸ªé…ç½®åº”è¯¥åªåœ¨ SRE æ‰‹åŠ¨ä¿®æ”¹ Deployment é…ç½®æ—¶æ‰ä¼šç”Ÿæ•ˆï¼ˆé€šå¸¸ä¸åº”è¯¥å‘ç”Ÿè¿™ç§äº‹ï¼‰ rollingUpdate: maxSurge: 10% # æ»šåŠ¨æ›´æ–°æ—¶ï¼Œæ¯æ¬¡æœ€å¤šæ›´æ–° 10% çš„ Pods maxUnavailable: 0 # æ»šåŠ¨æ›´æ–°æ—¶ï¼Œä¸å…è®¸å‡ºç°ä¸å¯ç”¨çš„ Podsï¼Œä¹Ÿå°±æ˜¯è¯´å§‹ç»ˆè¦ç»´æŒ 3 ä¸ªå¯ç”¨å‰¯æœ¬ selector: matchLabels: app: my-app version: v3 template: metadata: labels: app: my-app version: v3 spec: affinity: # æ³¨æ„ï¼ŒpodAffinity/podAntiAffinity å¯èƒ½ä¸æ˜¯æœ€ä½³æ–¹æ¡ˆï¼Œè¿™éƒ¨åˆ†é…ç½®å¾…æ›´æ–° # topologySpreadConstraints å¯èƒ½æ˜¯æ›´å¥½çš„é€‰æ‹© podAffinity: preferredDuringSchedulingIgnoredDuringExecution: # éå¼ºåˆ¶æ€§æ¡ä»¶ - weight: 100 # weight ç”¨äºä¸ºèŠ‚ç‚¹è¯„åˆ†ï¼Œä¼šä¼˜å…ˆé€‰æ‹©è¯„åˆ†æœ€é«˜çš„èŠ‚ç‚¹ï¼ˆåªæœ‰ä¸€æ¡è§„åˆ™çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå€¼æ²¡å•¥æ„ä¹‰ï¼‰ podAffinityTerm: labelSelector: matchExpressions: - key: app operator: In values: - my-app - key: version operator: In values: - v3 # pod å°½é‡ä½¿ç”¨åŒä¸€ç§èŠ‚ç‚¹ç±»å‹ï¼Œä¹Ÿå°±æ˜¯å°½é‡ä¿è¯èŠ‚ç‚¹çš„æ€§èƒ½ä¸€è‡´ topologyKey: node.kubernetes.io/instance-type podAntiAffinity: preferredDuringSchedulingIgnoredDuringExecution: # éå¼ºåˆ¶æ€§æ¡ä»¶ - weight: 100 # weight ç”¨äºä¸ºèŠ‚ç‚¹è¯„åˆ†ï¼Œä¼šä¼˜å…ˆé€‰æ‹©è¯„åˆ†æœ€é«˜çš„èŠ‚ç‚¹ï¼ˆåªæœ‰ä¸€æ¡è§„åˆ™çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå€¼æ²¡å•¥æ„ä¹‰ï¼‰ podAffinityTerm: labelSelector: matchExpressions: - key: app operator: In values: - my-app - key: version operator: In values: - v3 # å°† pod å°½é‡æ‰“æ•£åœ¨å¤šä¸ªå¯ç”¨åŒº topologyKey: topology.kubernetes.io/zone requiredDuringSchedulingIgnoredDuringExecution: # å¼ºåˆ¶æ€§è¦æ±‚ï¼ˆè¿™ä¸ªå»ºè®®æŒ‰éœ€æ·»åŠ ï¼‰ # æ³¨æ„è¿™ä¸ªæ²¡æœ‰ weightsï¼Œå¿…é¡»æ»¡è¶³åˆ—è¡¨ä¸­çš„æ‰€æœ‰æ¡ä»¶ - labelSelector: matchExpressions: - key: app operator: In values: - my-app - key: version operator: In values: - v3 # Pod å¿…é¡»è¿è¡Œåœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸Š topologyKey: kubernetes.io/hostname securityContext: # runAsUser: 1000 # è®¾å®šç”¨æˆ· # runAsGroup: 1000 # è®¾å®šç”¨æˆ·ç»„ runAsNonRoot: true # Pod å¿…é¡»ä»¥é root ç”¨æˆ·è¿è¡Œ seccompProfile: # security compute mode type: RuntimeDefault nodeSelector: nodegroup: common # ä½¿ç”¨ä¸“ç”¨èŠ‚ç‚¹ç»„ï¼Œå¦‚æœå¸Œæœ›ä½¿ç”¨å¤šä¸ªèŠ‚ç‚¹ç»„ï¼Œå¯æ”¹ç”¨èŠ‚ç‚¹äº²å’Œæ€§ volumes: - name: tmp-dir emptyDir: {} containers: - name: my-app-v3 image: my-app:v3 # å»ºè®®ä½¿ç”¨ç§æœ‰é•œåƒä»“åº“ï¼Œè§„é¿ docker.io çš„é•œåƒæ‹‰å–é™åˆ¶ imagePullPolicy: IfNotPresent volumeMounts: - mountPath: /tmp name: tmp-dir lifecycle: preStop: # åœ¨å®¹å™¨è¢« kill ä¹‹å‰æ‰§è¡Œ exec: command: - /bin/sh - -c - \"while [ $(netstat -plunt | grep tcp | wc -l | xargs) -ne 0 ]; do sleep 1; done\" resources: # èµ„æºè¯·æ±‚ä¸é™åˆ¶ # å¯¹äºæ ¸å¿ƒæœåŠ¡ï¼Œå»ºè®®è®¾ç½® requests = limitsï¼Œé¿å…èµ„æºç«äº‰ requests: # HPA ä¼šä½¿ç”¨ requests è®¡ç®—èµ„æºåˆ©ç”¨ç‡ # å»ºè®®å°† requests è®¾ä¸ºæœåŠ¡æ­£å¸¸çŠ¶æ€ä¸‹çš„ CPU ä½¿ç”¨ç‡ï¼ŒHPA çš„ç›®å‰æŒ‡æ ‡è®¾ä¸º 80% # æ‰€æœ‰å®¹å™¨çš„ requests æ€»é‡ä¸å»ºè®®ä¸º 2c/4G 4c/8G ç­‰å¸¸è§å€¼ï¼Œå› ä¸ºèŠ‚ç‚¹é€šå¸¸ä¹Ÿæ˜¯è¿™ä¸ªé…ç½®ï¼Œè¿™ä¼šå¯¼è‡´ Pod åªèƒ½è°ƒåº¦åˆ°æ›´å¤§çš„èŠ‚ç‚¹ä¸Šï¼Œé€‚å½“è°ƒå° requests ç­‰æ‰©å……å¯ç”¨çš„èŠ‚ç‚¹ç±»å‹ï¼Œä»è€Œæ‰©å……èŠ‚ç‚¹æ± ã€‚ cpu: 1000m memory: 1Gi limits: # limits - requests ä¸ºå…è®¸è¶…å–çš„èµ„æºé‡ï¼Œå»ºè®®ä¸º requests çš„ 1 åˆ° 2 å€ï¼Œé…Œæƒ…é…ç½®ã€‚ cpu: 1000m memory: 1Gi securityContext: # å°†å®¹å™¨å±‚è®¾ä¸ºåªè¯»ï¼Œé˜²æ­¢å®¹å™¨æ–‡ä»¶è¢«ç¯¡æ”¹ ## å¦‚æœéœ€è¦å†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼Œå»ºè®®é¢å¤–æŒ‚è½½ emptyDir æ¥æä¾›å¯è¯»å†™çš„æ•°æ®å· readOnlyRootFilesystem: true # ç¦æ­¢ Pod åšä»»ä½•æƒé™æå‡ allowPrivilegeEscalation: false capabilities: # drop ALL çš„æƒé™æ¯”è¾ƒä¸¥æ ¼ï¼Œå¯æŒ‰éœ€ä¿®æ”¹ drop: - ALL startupProbe: # è¦æ±‚ kubernetes 1.18+ httpGet: path: /actuator/health # ç›´æ¥ä½¿ç”¨å¥åº·æ£€æŸ¥æ¥å£å³å¯ port: 8080 periodSeconds: 5 timeoutSeconds: 1 failureThreshold: 20 # æœ€å¤šæä¾›ç»™æœåŠ¡ 5s * 20 çš„å¯åŠ¨æ—¶é—´ successThreshold: 1 livenessProbe: httpGet: path: /actuator/health # spring çš„é€šç”¨å¥åº·æ£€æŸ¥è·¯å¾„ port: 8080 periodSeconds: 5 timeoutSeconds: 1 failureThreshold: 5 successThreshold: 1 # Readiness probes are very important for a RollingUpdate to work properly, readinessProbe: httpGet: path: /actuator/health # ç®€å•èµ·è§å¯ç›´æ¥ä½¿ç”¨ livenessProbe ç›¸åŒçš„æ¥å£ï¼Œå½“ç„¶ä¹Ÿå¯é¢å¤–å®šä¹‰ port: 8080 periodSeconds: 5 timeoutSeconds: 1 failureThreshold: 5 successThreshold: 1 --- apiVersion: autoscaling/v2beta2 kind: HorizontalPodAutoscaler metadata: labels: app: my-app name: my-app-v3 namespace: prod spec: scaleTargetRef: apiVersion: apps/v1 kind: Deployment name: my-app-v3 maxReplicas: 50 minReplicas: 3 metrics: - type: Resource resource: name: cpu target: type: Utilization averageUtilization: 70 --- apiVersion: policy/v1 kind: PodDisruptionBudget metadata: name: my-app-v3 namespac","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:1:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ","Cloud-Native"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/#é›¶ç¤ºä¾‹"},{"categories":["tech"],"content":" ä¸€ã€ä¼˜é›…åœæ­¢ï¼ˆGracful Shutdownï¼‰ä¸ 502/504 æŠ¥é”™å¦‚æœ Pod æ­£åœ¨å¤„ç†å¤§é‡è¯·æ±‚ï¼ˆæ¯”å¦‚ 1000 QPS+ï¼‰æ—¶ï¼Œå› ä¸ºèŠ‚ç‚¹æ•…éšœæˆ–ã€Œç«ä»·èŠ‚ç‚¹ã€è¢«å›æ”¶ç­‰åŸå› è¢«é‡æ–°è°ƒåº¦ï¼Œä½ å¯èƒ½ä¼šè§‚å¯Ÿåˆ°åœ¨å®¹å™¨è¢« terminate çš„ä¸€æ®µæ—¶é—´å†…å‡ºç°å°‘é‡ 502/504ã€‚ ä¸ºäº†ææ¸…æ¥šè¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦å…ˆç†è§£æ¸…æ¥š terminate ä¸€ä¸ª Pod çš„æµç¨‹ï¼š Pod çš„çŠ¶æ€è¢«è®¾ä¸º Terminatingï¼ˆå‡ ä¹ï¼‰åŒæ—¶è¯¥ Pod è¢«ä»æ‰€æœ‰å…³è”çš„ Service Endpoints ä¸­ç§»é™¤ å¦‚æœé…ç½®äº† preStop å‚æ•°ï¼Œå¼€å§‹æ‰§è¡Œå¦‚ä¸‹æ­¥éª¤ æ‰§è¡Œ preStop é’©å­ å®ƒçš„æ‰§è¡Œé˜¶æ®µå¾ˆå¥½ç†è§£ï¼šåœ¨å®¹å™¨è¢« stop ä¹‹å‰æ‰§è¡Œ å®ƒå¯ä»¥æ˜¯ä¸€ä¸ªå‘½ä»¤ï¼Œæˆ–è€…ä¸€ä¸ªå¯¹ Pod ä¸­å®¹å™¨çš„ http è°ƒç”¨ å¦‚æœåœ¨æ”¶åˆ° SIGTERM ä¿¡å·æ—¶ï¼Œæ— æ³•ä¼˜é›…é€€å‡ºï¼Œè¦æ”¯æŒä¼˜é›…é€€å‡ºæ¯”è¾ƒéº»çƒ¦çš„è¯ï¼Œç”¨ preStop å®ç°ä¼˜é›…é€€å‡ºæ˜¯ä¸€ä¸ªéå¸¸å¥½çš„æ–¹å¼ preStop çš„å®šä¹‰ä½ç½®ï¼šhttps://github.com/kubernetes/api/blob/master/core/v1/types.go#L2515 preStop æ‰§è¡Œå®Œæ¯•åï¼ŒSIGTERM ä¿¡å·è¢«å‘é€ç»™ Pod ä¸­çš„æ‰€æœ‰å®¹å™¨ å¦‚æœæœªé…ç½® preStopï¼Œåˆ™ SIGTERM ä¿¡å·å°†è¢«ç«‹å³å‘é€ç»™ Pod ä¸­çš„æ‰€æœ‰å®¹å™¨ ç»§ç»­ç­‰å¾…ï¼Œç›´åˆ°å®¹å™¨åœæ­¢æˆ–è€…è¶…æ—¶ã€‚ spec.terminationGracePeriodSeconds ä¸ºè¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º 30s éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªä¼˜é›…é€€å‡ºçš„ç­‰å¾…è®¡æ—¶æ˜¯ä¸ preStop åŒæ­¥å¼€å§‹çš„ï¼ å¦‚æœè¶…è¿‡äº† spec.terminationGracePeriodSeconds å®¹å™¨ä»ç„¶æ²¡æœ‰åœæ­¢ï¼Œk8s å°†ä¼šå‘é€ SIGKILL ä¿¡å·ç»™å®¹å™¨ è¿›ç¨‹å…¨éƒ¨ç»ˆæ­¢åï¼Œæ•´ä¸ª Pod å®Œå…¨è¢«æ¸…ç†æ‰ æ³¨æ„ï¼šã€Œä» Service Endpoints ä¸­ç§»é™¤ Pod IPã€è·Ÿåç»­çš„æ­¥éª¤æ˜¯å¼‚æ­¥å‘ç”Ÿçš„ï¼Œæ‰€ä»¥åœ¨æœªè®¾ç½®preStop æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°ã€ŒPod è¿˜åœ¨ Service Endpoints ä¸­ï¼Œä½†æ˜¯ SIGTERM å·²ç»è¢«å‘é€ç»™ Pod å¯¼è‡´å®¹å™¨éƒ½æŒ‚æ‰ã€çš„æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘åˆ°è¿™ç§çŠ¶å†µçš„å‘ç”Ÿã€‚ äº†è§£äº†ä¸Šé¢çš„æµç¨‹åï¼Œæˆ‘ä»¬å°±èƒ½åˆ†æå‡ºä¸¤ç§é”™è¯¯ç å‡ºç°çš„åŸå› ï¼š 502ï¼šåº”ç”¨ç¨‹åºåœ¨æ”¶åˆ° SIGTERM ä¿¡å·åç›´æ¥ç»ˆæ­¢äº†è¿è¡Œï¼Œå¯¼è‡´éƒ¨åˆ†è¿˜æ²¡æœ‰è¢«å¤„ç†å®Œçš„è¯·æ±‚ç›´æ¥ä¸­æ–­ï¼Œ ä»£ç†å±‚è¿”å› 502 è¡¨ç¤ºè¿™ç§æƒ…å†µ 504ï¼šService Endpoints ç§»é™¤ä¸å¤ŸåŠæ—¶ï¼Œåœ¨ Pod å·²ç»è¢«ç»ˆæ­¢åï¼Œä»ç„¶æœ‰ä¸ªåˆ«è¯·æ±‚è¢«è·¯ç”±åˆ°äº†è¯¥ Podï¼Œå¾—ä¸åˆ°å“åº”å¯¼è‡´ 504 é€šå¸¸çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œåœ¨ Pod çš„ preStop æ­¥éª¤åŠ ä¸€ä¸ª 15s çš„ç­‰å¾…æ—¶é—´ã€‚å…¶åŸç†æ˜¯ï¼šåœ¨ Pod å¤„ç† terminating çŠ¶æ€çš„æ—¶å€™ï¼Œå°±ä¼šè¢«ä» Service Endpoints ä¸­ç§»é™¤ï¼Œä¹Ÿå°±ä¸ä¼šå†æœ‰æ–°çš„è¯·æ±‚è¿‡æ¥äº†ã€‚åœ¨preStop ç­‰å¾… 15sï¼ŒåŸºæœ¬å°±èƒ½ä¿è¯æ‰€æœ‰çš„è¯·æ±‚éƒ½åœ¨å®¹å™¨æ­»æ‰ä¹‹å‰è¢«å¤„ç†å®Œæˆï¼ˆä¸€èˆ¬æ¥è¯´ï¼Œç»å¤§éƒ¨åˆ†è¯·æ±‚çš„å¤„ç†æ—¶é—´éƒ½åœ¨ 300ms ä»¥å†…å§ï¼‰ã€‚ ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹å¦‚ä¸‹ï¼Œå®ƒä½¿ Pod è¢« Terminate æ—¶ï¼Œæ€»æ˜¯åœ¨ stop å‰å…ˆç­‰å¾… 15sï¼Œå†å‘é€ SIGTERM ä¿¡å·ç»™å®¹å™¨ï¼š yaml containers: - name: my-app # æ·»åŠ ä¸‹é¢è¿™éƒ¨åˆ† lifecycle: preStop: exec: command: - /bin/sleep - \"15\" æ›´å¥½çš„è§£å†³åŠæ³•ï¼Œæ˜¯ç›´æ¥ç­‰å¾…æ‰€æœ‰ tcp è¿æ¥éƒ½å…³é—­ï¼ˆéœ€è¦é•œåƒä¸­æœ‰ netstatï¼‰ï¼š yaml containers: - name: my-app # æ·»åŠ ä¸‹é¢è¿™éƒ¨åˆ† lifecycle: preStop: exec: command: - /bin/sh - -c - \"while [ $(netstat -plunt | grep tcp | wc -l | xargs) -ne 0 ]; do sleep 1; done\" ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:2:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ","Cloud-Native"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/#ä¸€ä¼˜é›…åœæ­¢gracful-shutdownä¸-502504-æŠ¥é”™"},{"categories":["tech"],"content":" å¦‚æœæˆ‘çš„æœåŠ¡è¿˜ä½¿ç”¨äº† Sidecar ä»£ç†ç½‘ç»œè¯·æ±‚ï¼Œè¯¥æ€ä¹ˆå¤„ç†ï¼Ÿä»¥æœåŠ¡ç½‘æ ¼ Istio ä¸ºä¾‹ï¼Œåœ¨ Envoy ä»£ç†äº† Pod æµé‡çš„æƒ…å†µä¸‹ï¼Œ502/504 çš„é—®é¢˜ä¼šå˜å¾—æ›´å¤æ‚ä¸€ç‚¹â€”â€” è¿˜éœ€è¦è€ƒè™‘ Sidecar ä¸ä¸»å®¹å™¨çš„å…³é—­é¡ºåºï¼š å¦‚æœåœ¨ Envoy å·²å…³é—­åï¼Œæœ‰æ–°çš„è¯·æ±‚å†è¿›æ¥ï¼Œå°†ä¼šå¯¼è‡´ 504ï¼ˆæ²¡äººå“åº”è¿™ä¸ªè¯·æ±‚äº†ï¼‰ æ‰€ä»¥ Envoy æœ€å¥½åœ¨ Terminating è‡³å°‘ 3s åæ‰èƒ½å…³ï¼Œç¡®ä¿ Istio ç½‘æ ¼é…ç½®å·²å®Œå…¨æ›´æ–° å¦‚æœåœ¨ Envoy è¿˜æ²¡åœæ­¢æ—¶ï¼Œä¸»å®¹å™¨å…ˆå…³é—­ï¼Œç„¶ååˆæœ‰æ–°çš„è¯·æ±‚å†è¿›æ¥ï¼ŒEnvoy å°†å› ä¸ºæ— æ³•è¿æ¥åˆ° upstream å¯¼è‡´ 503 æ‰€ä»¥ä¸»å®¹å™¨ä¹Ÿæœ€å¥½åœ¨ Terminating è‡³å°‘ 3s åï¼Œæ‰èƒ½å…³é—­ã€‚ å¦‚æœä¸»å®¹å™¨å¤„ç†è¿˜æœªå¤„ç†å®Œé—ç•™è¯·æ±‚æ—¶ï¼ŒEnvoy æˆ–è€…ä¸»å®¹å™¨çš„å…¶ä¸­ä¸€ä¸ªåœæ­¢äº†ï¼Œä¼šå› ä¸º tcp è¿æ¥ç›´æ¥æ–­å¼€è¿æ¥å¯¼è‡´ 502 å› æ­¤ Envoy å¿…é¡»åœ¨ä¸»å®¹å™¨å¤„ç†å®Œé—ç•™è¯·æ±‚åï¼ˆå³æ²¡æœ‰ tcp è¿æ¥æ—¶ï¼‰ï¼Œæ‰èƒ½å…³é—­ æ‰€ä»¥æ€»ç»“ä¸‹ï¼šEnvoy åŠä¸»å®¹å™¨çš„ preStop éƒ½è‡³å°‘å¾—è®¾æˆ 3sï¼Œå¹¶ä¸”åœ¨ã€Œæ²¡æœ‰ tcp è¿æ¥ã€æ—¶ï¼Œæ‰èƒ½å…³é—­ï¼Œé¿å…å‡ºç° 502/503/504. ä¸»å®¹å™¨çš„ä¿®æ”¹æ–¹æ³•åœ¨å‰æ–‡ä¸­å·²ç»å†™è¿‡äº†ï¼Œä¸‹é¢ä»‹ç»ä¸‹ Envoy çš„ä¿®æ”¹æ–¹æ³•ã€‚ å’Œä¸»å®¹å™¨ä¸€æ ·ï¼ŒEnvoy ä¹Ÿèƒ½ç›´æ¥åŠ  preStopï¼Œä¿®æ”¹ istio-sidecar-injector è¿™ä¸ª configmapï¼Œ åœ¨ sidecar é‡Œæ·»åŠ  preStop sleep å‘½ä»¤: yaml containers: - name: istio-proxy # æ·»åŠ ä¸‹é¢è¿™éƒ¨åˆ† lifecycle: preStop: exec: command: - /bin/sh - -c - \"while [ $(netstat -plunt | grep tcp | grep -v envoy | wc -l | xargs) -ne 0 ]; do sleep 1; done\" ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:2:1","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ","Cloud-Native"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/#k8s-istio-pod-prestop"},{"categories":["tech"],"content":" å‚è€ƒ Kubernetes best practices: terminating with grace Graceful shutdown in Kubernetes is not always trivial ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:2:2","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ","Cloud-Native"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/#å‚è€ƒ"},{"categories":["tech"],"content":" äºŒã€æœåŠ¡çš„ä¼¸ç¼©é…ç½® - HPAKubernetes å®˜æ–¹ä¸»è¦æ”¯æŒåŸºäº Pod CPU çš„ä¼¸ç¼©ï¼Œè¿™æ˜¯åº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ä¼¸ç¼©æŒ‡æ ‡ï¼Œéœ€è¦éƒ¨ç½²metrics-server æ‰å¯ä½¿ç”¨ã€‚ å…ˆå›é¡¾ä¸‹å‰é¢ç»™å‡ºçš„ï¼ŒåŸºäº Pod CPU ä½¿ç”¨ç‡è¿›è¡Œä¼¸ç¼©çš„ç¤ºä¾‹ï¼š yaml apiVersion: autoscaling/v2beta2 # k8s 1.23+ æ­¤ API å·²ç» GA kind: HorizontalPodAutoscaler metadata: labels: app: my-app name: my-app-v3 namespace: prod spec: scaleTargetRef: apiVersion: apps/v1 kind: Deployment name: my-app-v3 maxReplicas: 50 minReplicas: 3 metrics: - type: Resource resource: name: cpu target: type: Utilization averageUtilization: 70 ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:3:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ","Cloud-Native"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/#k8s-hpa"},{"categories":["tech"],"content":" 1. å½“å‰æŒ‡æ ‡å€¼çš„è®¡ç®—æ–¹å¼æå‰æ€»ç»“ï¼šæ¯ä¸ª Pod çš„æŒ‡æ ‡æ˜¯å…¶ä¸­æ‰€æœ‰å®¹å™¨æŒ‡æ ‡ä¹‹å’Œï¼Œå¦‚æœè®¡ç®—ç™¾åˆ†æ¯”ï¼Œå°±å†é™¤ä»¥ Pod çš„ requests. HPA é»˜è®¤ä½¿ç”¨ Pod çš„å½“å‰æŒ‡æ ‡è¿›è¡Œè®¡ç®—ï¼Œä»¥ CPU ä½¿ç”¨ç‡ä¸ºä¾‹ï¼Œå…¶è®¡ç®—å…¬å¼ä¸ºï¼š text ã€ŒPod çš„ CPU ä½¿ç”¨ç‡ã€= 100% * ã€Œæ‰€æœ‰ Container çš„ CPU ç”¨é‡ä¹‹å’Œã€/ã€Œæ‰€æœ‰ Container çš„ CPU requests ä¹‹å’Œã€ æ³¨æ„åˆ†æ¯æ˜¯æ€»çš„ requests é‡ï¼Œè€Œä¸æ˜¯ limits. 1.1 å­˜åœ¨çš„é—®é¢˜ä¸è§£å†³æ–¹æ³•åœ¨ Pod åªæœ‰ä¸€ä¸ªå®¹å™¨æ—¶è¿™æ²¡å•¥é—®é¢˜ï¼Œä½†æ˜¯å½“ Pod æ³¨å…¥äº† envoy ç­‰ sidecar æ—¶ï¼Œè¿™å°±ä¼šæœ‰é—®é¢˜äº†ã€‚ å› ä¸º Istio çš„ Sidecar requests é»˜è®¤ä¸º 100m ä¹Ÿå°±æ˜¯ 0.1 æ ¸ã€‚åœ¨æœª tuning çš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡è´Ÿè½½ä¸€é«˜ï¼Œsidecar çš„å®é™…ç”¨é‡å¾ˆå®¹æ˜“å°±èƒ½æ¶¨åˆ° 0.2-0.4 æ ¸ã€‚æŠŠè¿™ä¸¤ä¸ªå€¼ä»£å…¥å‰é¢çš„å…¬å¼ï¼Œä¼šå‘ç° å¯¹äº QPS è¾ƒé«˜çš„æœåŠ¡ï¼Œæ·»åŠ  Sidecar åï¼Œã€ŒPod çš„ CPU åˆ©ç”¨ç‡ã€å¯èƒ½ä¼šé«˜äºã€Œåº”ç”¨å®¹å™¨çš„ CPU åˆ©ç”¨ç‡ã€ï¼Œé€ æˆä¸å¿…è¦çš„æ‰©å®¹ã€‚ä¸»å®¹å™¨çš„ requests ä¸ limits å·®è·è¶Šå°ï¼Œè¿™æ ·çš„æ‰©å®¹é€ æˆçš„èµ„æºæµªè´¹å°±è¶Šå¤§ã€‚ è€Œä¸”è¿˜æœ‰ä¸ªé—®é¢˜æ˜¯ï¼Œä¸åŒåº”ç”¨çš„ Podï¼Œæ•°æ®æµç‰¹å¾ã€åº”ç”¨è´Ÿè½½ç‰¹å¾ç­‰éƒ½æœ‰åŒºåˆ«ï¼ˆè¯·æ±‚/å“åº”çš„æ•°æ®é‡ã€å¤„ç†æ—¶é•¿ç­‰ï¼‰ï¼Œè¿™ä¼šé€ æˆ sidecar ä¸ä¸»å®¹å™¨çš„ cpu åˆ©ç”¨ç‡ä¸ä¸€ï¼ŒåŠ å¤§äº†ä¼˜åŒ– HPA æœºåˆ¶çš„å›°éš¾åº¦ã€‚ è§£å†³æ–¹æ³•ï¼š æ–¹æ³•ä¸€ï¼šHPA æ”¹ç”¨ç»å¯¹æŒ‡æ ‡è¿›è¡Œæ‰©ç¼©å®¹ï¼Œå³ Pod çš„æ€» CPU ç”¨é‡ã€‚è¿™ä½¿ HPA ä¸å—ä»»ä½•å®¹å™¨ requests è®¾ç½®çš„å½±å“ã€‚ ä½†æ˜¯å› ä¸ºä¸åŒæœåŠ¡è´Ÿè½½çš„åŒºåˆ«ï¼Œéœ€è¦æ ¹æ®å®é™…è´Ÿè½½ä¸ºæ¯ä¸ªæœåŠ¡è°ƒæ•´ HPA çš„æœŸæœ›æŒ‡æ ‡ã€‚ æ–¹æ³•äºŒï¼šHPA ä»ç„¶ä½¿ç”¨ Pod åˆ©ç”¨ç‡è¿›è¡Œæ‰©ç¼©å®¹ï¼Œä½†æ˜¯é’ˆå¯¹æ¯ä¸ªæœåŠ¡çš„ CPU ä½¿ç”¨æƒ…å†µï¼Œä¸ºæ¯ä¸ªæœåŠ¡çš„ sidecar è®¾ç½®ä¸åŒçš„ requests/limitsï¼Œé™ä½ sidecar å¯¹æ‰©ç¼©å®¹çš„å½±å“ã€‚ æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ KEDA ç­‰ç¬¬ä¸‰æ–¹ç»„ä»¶ï¼Œè·å–åˆ°åº”ç”¨å®¹å™¨çš„ CPU åˆ©ç”¨ç‡ï¼ˆæ’é™¤æ‰ Sidecarï¼‰ï¼Œä½¿ç”¨å®ƒè¿›è¡Œæ‰©ç¼©å®¹ æ–¹æ³•å››ï¼šä½¿ç”¨ k8s 1.20 æä¾›çš„ alpha ç‰¹æ€§ï¼šContainer Resource Metrics. è¿™ç§æ–¹å¼å¯ä»¥å°† Pod çš„ä¸åŒå®¹å™¨çš„æŒ‡æ ‡åŒºåˆ†çœ‹å¾…ï¼Œç®—æ˜¯æœ€ä½³çš„å¤„ç†æ–¹æ³•äº†ï¼Œä½†æ˜¯è¯¥ç‰¹æ€§ä»æœªè¿›å…¥ beta é˜¶æ®µï¼Œæ…ç”¨ã€‚ ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:3:1","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ","Cloud-Native"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/#1-å½“å‰æŒ‡æ ‡å€¼çš„è®¡ç®—æ–¹å¼"},{"categories":["tech"],"content":" 1. å½“å‰æŒ‡æ ‡å€¼çš„è®¡ç®—æ–¹å¼æå‰æ€»ç»“ï¼šæ¯ä¸ª Pod çš„æŒ‡æ ‡æ˜¯å…¶ä¸­æ‰€æœ‰å®¹å™¨æŒ‡æ ‡ä¹‹å’Œï¼Œå¦‚æœè®¡ç®—ç™¾åˆ†æ¯”ï¼Œå°±å†é™¤ä»¥ Pod çš„ requests. HPA é»˜è®¤ä½¿ç”¨ Pod çš„å½“å‰æŒ‡æ ‡è¿›è¡Œè®¡ç®—ï¼Œä»¥ CPU ä½¿ç”¨ç‡ä¸ºä¾‹ï¼Œå…¶è®¡ç®—å…¬å¼ä¸ºï¼š text ã€ŒPod çš„ CPU ä½¿ç”¨ç‡ã€= 100% * ã€Œæ‰€æœ‰ Container çš„ CPU ç”¨é‡ä¹‹å’Œã€/ã€Œæ‰€æœ‰ Container çš„ CPU requests ä¹‹å’Œã€ æ³¨æ„åˆ†æ¯æ˜¯æ€»çš„ requests é‡ï¼Œè€Œä¸æ˜¯ limits. 1.1 å­˜åœ¨çš„é—®é¢˜ä¸è§£å†³æ–¹æ³•åœ¨ Pod åªæœ‰ä¸€ä¸ªå®¹å™¨æ—¶è¿™æ²¡å•¥é—®é¢˜ï¼Œä½†æ˜¯å½“ Pod æ³¨å…¥äº† envoy ç­‰ sidecar æ—¶ï¼Œè¿™å°±ä¼šæœ‰é—®é¢˜äº†ã€‚ å› ä¸º Istio çš„ Sidecar requests é»˜è®¤ä¸º 100m ä¹Ÿå°±æ˜¯ 0.1 æ ¸ã€‚åœ¨æœª tuning çš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡è´Ÿè½½ä¸€é«˜ï¼Œsidecar çš„å®é™…ç”¨é‡å¾ˆå®¹æ˜“å°±èƒ½æ¶¨åˆ° 0.2-0.4 æ ¸ã€‚æŠŠè¿™ä¸¤ä¸ªå€¼ä»£å…¥å‰é¢çš„å…¬å¼ï¼Œä¼šå‘ç° å¯¹äº QPS è¾ƒé«˜çš„æœåŠ¡ï¼Œæ·»åŠ  Sidecar åï¼Œã€ŒPod çš„ CPU åˆ©ç”¨ç‡ã€å¯èƒ½ä¼šé«˜äºã€Œåº”ç”¨å®¹å™¨çš„ CPU åˆ©ç”¨ç‡ã€ï¼Œé€ æˆä¸å¿…è¦çš„æ‰©å®¹ã€‚ä¸»å®¹å™¨çš„ requests ä¸ limits å·®è·è¶Šå°ï¼Œè¿™æ ·çš„æ‰©å®¹é€ æˆçš„èµ„æºæµªè´¹å°±è¶Šå¤§ã€‚ è€Œä¸”è¿˜æœ‰ä¸ªé—®é¢˜æ˜¯ï¼Œä¸åŒåº”ç”¨çš„ Podï¼Œæ•°æ®æµç‰¹å¾ã€åº”ç”¨è´Ÿè½½ç‰¹å¾ç­‰éƒ½æœ‰åŒºåˆ«ï¼ˆè¯·æ±‚/å“åº”çš„æ•°æ®é‡ã€å¤„ç†æ—¶é•¿ç­‰ï¼‰ï¼Œè¿™ä¼šé€ æˆ sidecar ä¸ä¸»å®¹å™¨çš„ cpu åˆ©ç”¨ç‡ä¸ä¸€ï¼ŒåŠ å¤§äº†ä¼˜åŒ– HPA æœºåˆ¶çš„å›°éš¾åº¦ã€‚ è§£å†³æ–¹æ³•ï¼š æ–¹æ³•ä¸€ï¼šHPA æ”¹ç”¨ç»å¯¹æŒ‡æ ‡è¿›è¡Œæ‰©ç¼©å®¹ï¼Œå³ Pod çš„æ€» CPU ç”¨é‡ã€‚è¿™ä½¿ HPA ä¸å—ä»»ä½•å®¹å™¨ requests è®¾ç½®çš„å½±å“ã€‚ ä½†æ˜¯å› ä¸ºä¸åŒæœåŠ¡è´Ÿè½½çš„åŒºåˆ«ï¼Œéœ€è¦æ ¹æ®å®é™…è´Ÿè½½ä¸ºæ¯ä¸ªæœåŠ¡è°ƒæ•´ HPA çš„æœŸæœ›æŒ‡æ ‡ã€‚ æ–¹æ³•äºŒï¼šHPA ä»ç„¶ä½¿ç”¨ Pod åˆ©ç”¨ç‡è¿›è¡Œæ‰©ç¼©å®¹ï¼Œä½†æ˜¯é’ˆå¯¹æ¯ä¸ªæœåŠ¡çš„ CPU ä½¿ç”¨æƒ…å†µï¼Œä¸ºæ¯ä¸ªæœåŠ¡çš„ sidecar è®¾ç½®ä¸åŒçš„ requests/limitsï¼Œé™ä½ sidecar å¯¹æ‰©ç¼©å®¹çš„å½±å“ã€‚ æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ KEDA ç­‰ç¬¬ä¸‰æ–¹ç»„ä»¶ï¼Œè·å–åˆ°åº”ç”¨å®¹å™¨çš„ CPU åˆ©ç”¨ç‡ï¼ˆæ’é™¤æ‰ Sidecarï¼‰ï¼Œä½¿ç”¨å®ƒè¿›è¡Œæ‰©ç¼©å®¹ æ–¹æ³•å››ï¼šä½¿ç”¨ k8s 1.20 æä¾›çš„ alpha ç‰¹æ€§ï¼šContainer Resource Metrics. è¿™ç§æ–¹å¼å¯ä»¥å°† Pod çš„ä¸åŒå®¹å™¨çš„æŒ‡æ ‡åŒºåˆ†çœ‹å¾…ï¼Œç®—æ˜¯æœ€ä½³çš„å¤„ç†æ–¹æ³•äº†ï¼Œä½†æ˜¯è¯¥ç‰¹æ€§ä»æœªè¿›å…¥ beta é˜¶æ®µï¼Œæ…ç”¨ã€‚ ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:3:1","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ","Cloud-Native"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/#11-å­˜åœ¨çš„é—®é¢˜ä¸è§£å†³æ–¹æ³•"},{"categories":["tech"],"content":" 2. HPA çš„æ‰©ç¼©å®¹ç®—æ³•HPA ä»€ä¹ˆæ—¶å€™ä¼šæ‰©å®¹ï¼Œè¿™ä¸€ç‚¹æ˜¯å¾ˆå¥½ç†è§£çš„ã€‚ä½†æ˜¯ HPA çš„ç¼©å®¹ç­–ç•¥ï¼Œä¼šæœ‰äº›è¿·æƒ‘ï¼Œä¸‹é¢ç®€å•åˆ†æä¸‹ã€‚ HPA çš„ã€Œç›®æ ‡æŒ‡æ ‡ã€å¯ä»¥ä½¿ç”¨ä¸¤ç§å½¢å¼ï¼šç»å¯¹åº¦é‡æŒ‡æ ‡å’Œèµ„æºåˆ©ç”¨ç‡ã€‚ ç»å¯¹åº¦é‡æŒ‡æ ‡ï¼šæ¯”å¦‚ CPUï¼Œå°±æ˜¯æŒ‡ CPU çš„ä½¿ç”¨é‡ èµ„æºåˆ©ç”¨ç‡ï¼ˆèµ„æºä½¿ç”¨é‡/èµ„æºè¯·æ±‚ * 100%ï¼‰ï¼šåœ¨ Pod è®¾ç½®äº†èµ„æºè¯·æ±‚æ—¶ï¼Œå¯ä»¥ä½¿ç”¨èµ„æºåˆ©ç”¨ç‡è¿›è¡Œ Pod ä¼¸ç¼© HPA çš„ã€Œå½“å‰æŒ‡æ ‡ã€æ˜¯ä¸€æ®µæ—¶é—´å†…æ‰€æœ‰ Pods çš„å¹³å‡å€¼ï¼Œä¸æ˜¯å³°å€¼ã€‚ HPA çš„æ‰©ç¼©å®¹ç®—æ³•ä¸ºï¼š text æœŸæœ›å‰¯æœ¬æ•° = ceil[å½“å‰å‰¯æœ¬æ•° * ( å½“å‰æŒ‡æ ‡ / ç›®æ ‡æŒ‡æ ‡ )] ä»ä¸Šé¢çš„å‚æ•°å¯ä»¥çœ‹åˆ°ï¼š åªè¦ã€Œå½“å‰æŒ‡æ ‡ã€è¶…è¿‡äº†ç›®æ ‡æŒ‡æ ‡ï¼Œå°±ä¸€å®šä¼šå‘ç”Ÿæ‰©å®¹ã€‚ å½“å‰æŒ‡æ ‡ / ç›®æ ‡æŒ‡æ ‡è¦å°åˆ°ä¸€å®šçš„ç¨‹åº¦ï¼Œæ‰ä¼šè§¦å‘ç¼©å®¹ã€‚ æ¯”å¦‚åŒå‰¯æœ¬çš„æƒ…å†µä¸‹ï¼Œä¸Šè¿°æ¯”å€¼è¦å°äºç­‰äº 1/2ï¼Œæ‰ä¼šç¼©å®¹åˆ°å•å‰¯æœ¬ã€‚ ä¸‰å‰¯æœ¬çš„æƒ…å†µä¸‹ï¼Œä¸Šè¿°æ¯”å€¼çš„ä¸´ç•Œç‚¹æ˜¯ 2/3ã€‚ äº”å‰¯æœ¬æ—¶ä¸´ç•Œå€¼æ˜¯ 4/5ï¼Œ100å‰¯æœ¬æ—¶ä¸´ç•Œå€¼æ˜¯ 99/100ï¼Œä¾æ­¤ç±»æ¨ã€‚ å¦‚æœ å½“å‰æŒ‡æ ‡ / ç›®æ ‡æŒ‡æ ‡ ä» 1 é™åˆ° 0.5ï¼Œå‰¯æœ¬çš„æ•°é‡å°†ä¼šå‡åŠã€‚ï¼ˆè™½ç„¶è¯´å‰¯æœ¬æ•°è¶Šå¤šï¼Œå‘ç”Ÿè¿™ä¹ˆå¤§å˜åŒ–çš„å¯èƒ½æ€§å°±è¶Šå°ã€‚ï¼‰ å½“å‰å‰¯æœ¬æ•° / ç›®æ ‡æŒ‡æ ‡çš„å€¼è¶Šå¤§ï¼Œã€Œå½“å‰æŒ‡æ ‡ã€çš„æ³¢åŠ¨å¯¹ã€ŒæœŸæœ›å‰¯æœ¬æ•°ã€çš„å½±å“å°±è¶Šå¤§ã€‚ ä¸ºäº†é˜²æ­¢æ‰©ç¼©å®¹è¿‡äºæ•æ„Ÿï¼ŒHPA æœ‰å‡ ä¸ªç›¸å…³å‚æ•°ï¼š Hardcoded å‚æ•° HPA Loop å»¶æ—¶ï¼šé»˜è®¤ 15 ç§’ï¼Œæ¯ 15 ç§’é’Ÿè¿›è¡Œä¸€æ¬¡ HPA æ‰«æã€‚ ç¼©å®¹å†·å´æ—¶é—´ï¼šé»˜è®¤ 5 åˆ†é’Ÿã€‚ å¯¹äº K8s 1.18+ï¼ŒHPA é€šè¿‡ spec.behavior æä¾›äº†å¤šç§æ§åˆ¶æ‰©ç¼©å®¹è¡Œä¸ºçš„å‚æ•°ï¼Œåé¢ä¼šå…·ä½“ä»‹ç»ã€‚ ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:3:2","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ","Cloud-Native"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/#2-hpa-çš„æ‰©ç¼©å®¹ç®—æ³•"},{"categories":["tech"],"content":" 3. HPA çš„æœŸæœ›å€¼è®¾æˆå¤šå°‘åˆé€‚ï¼Ÿå¦‚ä½•å…¼é¡¾èµ„æºåˆ©ç”¨ç‡ä¸æœåŠ¡ç¨³å®šæ€§ï¼Ÿè¿™ä¸ªéœ€è¦é’ˆå¯¹æ¯ä¸ªæœåŠ¡çš„å…·ä½“æƒ…å†µï¼Œå…·ä½“åˆ†æã€‚ ä»¥æœ€å¸¸ç”¨çš„æŒ‰ CPU å€¼ä¼¸ç¼©ä¸ºä¾‹ï¼Œ æ ¸å¿ƒæœåŠ¡ requests/limits å€¼: å»ºè®®è®¾æˆç›¸ç­‰çš„ï¼Œä¿è¯æœåŠ¡è´¨é‡ç­‰çº§ä¸º Guaranteed éœ€è¦æ³¨æ„ CPU è·Ÿ Memory çš„ limits é™åˆ¶ç­–ç•¥æ˜¯ä¸åŒçš„ï¼ŒCPU æ˜¯çœŸæ­£åœ°é™åˆ¶äº†ä¸Šé™ï¼Œè€Œ Memory æ˜¯ç”¨è¶…äº†å°±å¹²æ‰å®¹å™¨ï¼ˆOOMKilledï¼‰ k8s ä¸€ç›´ä½¿ç”¨ cgroups v1 (cpu_shares/memory.limit_in_bytes)æ¥é™åˆ¶ cpu/memoryï¼Œä½†æ˜¯å¯¹äº Guaranteed çš„ Pods è€Œè¨€ï¼Œå†…å­˜å¹¶ä¸èƒ½å®Œå…¨é¢„ç•™ï¼Œèµ„æºç«äº‰æ€»æ˜¯æœ‰å¯èƒ½å‘ç”Ÿçš„ã€‚1.22 æœ‰ alpha ç‰¹æ€§æ”¹ç”¨ cgroups v2ï¼Œå¯ä»¥å…³æ³¨ä¸‹ã€‚ HPA: ä¸€èˆ¬æ¥è¯´ï¼ŒæœŸæœ›å€¼è®¾ä¸º 60% åˆ° 70% å¯èƒ½æ˜¯æ¯”è¾ƒåˆé€‚çš„ï¼Œæœ€å°å‰¯æœ¬æ•°å»ºè®®è®¾ä¸º 2 - 5. ï¼ˆä»…ä¾›å‚è€ƒï¼‰ PodDisruptionBudget: å»ºè®®æŒ‰æœåŠ¡çš„å¥å£®æ€§ä¸ HPA æœŸæœ›å€¼ï¼Œæ¥è®¾ç½® PDBï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»ï¼Œè¿™é‡Œå°±å…ˆç•¥è¿‡äº† éæ ¸å¿ƒæœåŠ¡ requests/limits å€¼: å»ºè®® requests è®¾ä¸º limits çš„ 0.6 - 0.9 å€ï¼ˆä»…ä¾›å‚è€ƒï¼‰ï¼Œå¯¹åº”çš„æœåŠ¡è´¨é‡ç­‰çº§ä¸º Burstable ä¹Ÿå°±æ˜¯è¶…å–äº†èµ„æºï¼Œè¿™æ ·åšä¸»è¦çš„è€ƒé‡ç‚¹æ˜¯ï¼Œå¾ˆå¤šéæ ¸å¿ƒæœåŠ¡è´Ÿè½½éƒ½å¾ˆä½ï¼Œæ ¹æœ¬è·‘ä¸åˆ° limits è¿™ä¹ˆé«˜ï¼Œé™ä½ requests å¯ä»¥æé«˜é›†ç¾¤èµ„æºåˆ©ç”¨ç‡ï¼Œä¹Ÿä¸ä¼šæŸå®³æœåŠ¡ç¨³å®šæ€§ã€‚ HPA: å› ä¸º requests é™ä½äº†ï¼Œè€Œ HPA æ˜¯ä»¥ requests ä¸º 100% è®¡ç®—ä½¿ç”¨ç‡çš„ï¼Œæˆ‘ä»¬å¯ä»¥æé«˜ HPA çš„æœŸæœ›å€¼ï¼ˆå¦‚æœä½¿ç”¨ç™¾åˆ†æ¯”ä¸ºæœŸæœ›å€¼çš„è¯ï¼‰ï¼Œæ¯”å¦‚ 80% ~ 90%ï¼Œæœ€å°å‰¯æœ¬æ•°å»ºè®®è®¾ä¸º 1 - 3. ï¼ˆä»…ä¾›å‚è€ƒï¼‰ PodDisruptionBudget: éæ ¸å¿ƒæœåŠ¡å˜›ï¼Œä¿è¯æœ€å°‘å‰¯æœ¬æ•°ä¸º 1 å°±è¡Œäº†ã€‚ ç›¸å…³èµ„æ–™ï¼š æœ€ä½³å®è·µï½œKubernetesé›†ç¾¤åˆ©ç”¨ç‡æå‡çš„æ€è·¯å’Œå®ç°æ–¹å¼ - è…¾è®¯äº‘åŸç”Ÿ ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:3:3","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ","Cloud-Native"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/#3-hpa-çš„æœŸæœ›å€¼è®¾æˆå¤šå°‘åˆé€‚å¦‚ä½•å…¼é¡¾èµ„æºåˆ©ç”¨ç‡ä¸æœåŠ¡ç¨³å®šæ€§"},{"categories":["tech"],"content":" 4. HPA çš„å¸¸è§é—®é¢˜ 4.1. Pod æ‰©å®¹ - VM é¢„çƒ­é™·é˜±Java/C# è¿™ç±»è¿è¡Œåœ¨ VM ä¸Šçš„è¯­è¨€ï¼Œåœ¨å¯åŠ¨é˜¶æ®µä¸ç¬¬ä¸€æ¬¡æ‰§è¡Œè¯·æ±‚æ—¶ï¼Œå¾€å¾€éœ€è¦åˆå§‹åŒ–ä¸€äº›èµ„æºã€‚è¿™å¯¼è‡´åœ¨å®¹å™¨åˆšå¯åŠ¨çš„ä¸€æ®µæ—¶é—´ï¼Œå®ƒéœ€è¦æ¶ˆè€—æ›´å¤šçš„ CPU å»å°†å­—èŠ‚ç ç¼–è¯‘æˆæœºå™¨ç å¹¶ç¼“å­˜èµ·æ¥ã€‚è¿™å°±æ˜¯ VM è¯­è¨€çš„ã€Œé¢„çƒ­ã€é—®é¢˜ã€‚ ç›¸å…³æ–‡æ¡£ï¼š How to Warm Up the JVM How to cold start fast a java service on k8s (EKS) å› ä¸ºä¸Šè¿°ã€Œé¢„çƒ­ã€é—®é¢˜åœ¨ä½¿ç”¨ HPA æ‰©ç¼©å®¹ Java/C# ç­‰è¿è¡Œåœ¨ VM ä¸Šçš„ç¨‹åºæ—¶ï¼ŒHPA ä¸€æ‰©å®¹ï¼ŒæœåŠ¡å¯ç”¨ç‡å°±ä¼šæŠ–åŠ¨ï¼Œç”šè‡³å¼•å‘é›ªå´©ã€‚ ä¸¾ä¾‹è¯´æ˜ï¼Œåœ¨æœ‰å¤§é‡ç”¨æˆ·è®¿é—®çš„æ—¶å€™ï¼Œåªè¦è¯·æ±‚è¢«è½¬å‘åˆ°æ–°å»ºçš„ Java Pod ä¸Šï¼Œè¿™ä¸ªè¯·æ±‚å°±ä¼šã€Œå¡ä½ã€ã€‚å¦‚æœè¯·æ±‚é€Ÿåº¦å¤ªå¿«ï¼ŒPod å¯åŠ¨çš„ç¬é—´ã€Œå¡ä½ã€çš„è¯·æ±‚å°±è¶Šå¤šï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æ–°å»º Pod å› ä¸ºå‹åŠ›è¿‡å¤§è€Œå®æ‰ã€‚ç„¶å Pod æ¯æ¬¡åˆšé‡å¯å°±è¢«æ‰“å®ï¼Œè¿›å…¥ CrashLoopBackoff å¾ªç¯ã€‚ å¦‚æœæ˜¯åœ¨ä½¿ç”¨å¤šçº¿ç¨‹åšè´Ÿè½½æµ‹è¯•æ—¶ï¼Œæ•ˆæœæ›´æ˜æ˜¾ï¼š50 ä¸ªçº¿ç¨‹åœ¨ä¸é—´æ–­åœ°è¯·æ±‚ï¼Œåˆ«çš„ Pod å“åº”æ—¶é—´æ˜¯ã€Œæ¯«ç§’çº§ã€ï¼Œè€Œæ–°å»ºçš„ Pod çš„é¦–æ¬¡å“åº”æ˜¯ã€Œç§’çº§ã€ã€‚å‡ ä¹æ˜¯ä¸€ç¬é—´ï¼Œ50 ä¸ªçº¿ç¨‹å°±ä¼šå…¨éƒ¨é™·åœ¨æ–°å»ºçš„ Pod è¿™é‡Œã€‚è€Œæ–°å»ºçš„ Pod åœ¨å¯åŠ¨çš„ç¬é—´å¯èƒ½ç‰¹åˆ«è„†å¼±ï¼Œç¬é—´çš„ 50 ä¸ªå¹¶å‘è¯·æ±‚å°±å¯ä»¥å°†å®ƒå‹å®ã€‚ç„¶å Pod ä¸€é‡å¯å°±è¢«å‹å®ï¼Œè¿›å…¥ CrashLoopBackoff å¾ªç¯ã€‚ è§£å†³æ–¹æ³•ï¼š å¯ä»¥åœ¨ã€Œåº”ç”¨å±‚é¢ã€è§£å†³ï¼š å¤§ Pod ç­–ç•¥ï¼šJVM é¢„çƒ­é˜¶æ®µéœ€è¦ä½¿ç”¨æ›´å¤šçš„ CPUï¼Œå‡è®¾åœ¨ HPA ä¸º 60% CPU çš„æƒ…å†µä¸‹ï¼Œè¶Šå¤§çš„ Pod å®ƒçš„å¯è¶…å– CPU ï¼ˆ40%ï¼‰æ˜¾ç„¶å°±æ›´å¤šï¼Œè¿™å°±èƒ½ç¼“è§£ JVM é¢„çƒ­é—®é¢˜ã€‚ å®æµ‹å°† Pod çš„ requests/limits ä» 3.7c/7.5G æ‰©å®¹åˆ° 7.4c/15Gï¼ŒæœåŠ¡çš„æ‰©å®¹æ˜æ˜¾æ›´å¹³æ»‘äº†ã€‚ JVM å‚æ•°è°ƒä¼˜ï¼šä¸å®Œå…¨ä¸¾ä¾‹å¦‚ä¸‹ æå‰åˆ†é… G1New å†…å­˜ï¼š-XX:+UnlockExperimentalVMOptions -XX:G1NewSizePercent=60ï¼Œé¿å… JVM å¯åŠ¨é˜¶æ®µå› ä¸ºå†…å­˜ä¸è¶³é¢‘ç¹ GC ä½¿ç”¨ã€ŒAOT é¢„ç¼–è¯‘ã€æŠ€æœ¯ï¼šé¢„çƒ­é€šå¸¸éƒ½æ˜¯å› ä¸ºã€ŒJIT å³æ—¶ç¼–è¯‘ã€å¯¼è‡´çš„é—®é¢˜ï¼Œåœ¨éœ€è¦ç”¨åˆ°æ—¶å®ƒæ‰ç¼–è¯‘ã€‚è€Œ AOT æ˜¯é¢„å…ˆç¼–è¯‘ï¼Œåœ¨ä½¿ç”¨å‰å®Œæˆç¼–è¯‘ï¼Œå› æ­¤ AOT èƒ½è§£å†³é¢„çƒ­çš„é—®é¢˜ã€‚æ¯”å¦‚è¯´ Java çš„ GraalVM. Sprint Native æ˜¯ä½¿ç”¨ GralalVM å®ç° çš„ï¼Œä½†è¿˜åœ¨ beta é˜¶æ®µï¼Œè€Œä¸”æœ‰äº›å…¼å®¹æ€§é—®é¢˜ å…¶ä»–èµ„æ–™ steinsag/warm-me-up How to Warm Up the JVM ä¹Ÿå¯ä»¥åœ¨ã€ŒåŸºç¡€è®¾æ–½å±‚é¢ã€è§£å†³ï¼š åƒ AWS ALB TargetGroup ä»¥åŠå…¶ä»–äº‘æœåŠ¡å•†çš„ ALB æœåŠ¡ï¼Œé€šå¸¸éƒ½å¯ä»¥è®¾ç½® slow_start æ—¶é•¿ï¼Œ å³å¯¹æ–°åŠ å…¥çš„å®ä¾‹ï¼Œä½¿ç”¨ä¸€å®šæ—¶é—´æ…¢æ…¢åœ°æŠŠæµé‡åˆ‡è¿‡å»ï¼Œæœ€ç»ˆè¾¾åˆ°é¢„æœŸçš„è´Ÿè½½å‡è¡¡çŠ¶æ€ã€‚è¿™ä¸ªå¯ä»¥è§£å†³æœåŠ¡é¢„çƒ­é—®é¢˜ã€‚ Envoy ä¹Ÿå·²ç»æ”¯æŒ slow_start æ¨¡å¼ï¼Œæ”¯æŒåœ¨ä¸€ä¸ªè®¾ç½®å¥½çš„æ—¶é—´çª—å£å†…ï¼ŒæŠŠæµé‡æ…¢æ…¢è´Ÿè½½åˆ°æ–°åŠ å…¥çš„å®ä¾‹ä¸Šï¼Œè¾¾æˆé¢„çƒ­æ•ˆæœã€‚ 4.2. HPA æ‰©ç¼©å®¹è¿‡äºæ•æ„Ÿï¼Œå¯¼è‡´ Pod æ•°é‡éœ‡è¡é€šå¸¸æ¥è®²ï¼ŒK8s ä¸Šç»å¤§éƒ¨åˆ†è´Ÿè½½éƒ½åº”è¯¥é€‰æ‹©ä½¿ç”¨ CPU è¿›è¡Œæ‰©ç¼©å®¹ã€‚å› ä¸º CPU é€šå¸¸èƒ½å¾ˆå¥½çš„åæ˜ æœåŠ¡çš„è´Ÿè½½æƒ…å†µ ä½†æ˜¯æœ‰äº›æœåŠ¡ä¼šå­˜åœ¨å…¶ä»–å½±å“ CPU ä½¿ç”¨ç‡çš„å› ç´ ï¼Œå¯¼è‡´ä½¿ç”¨ CPU æ‰©ç¼©å®¹å˜å¾—ä¸é‚£ä¹ˆå¯é ï¼Œæ¯”å¦‚ï¼š æœ‰äº› Java æœåŠ¡å †å†…å­˜è®¾å¾—å¾ˆå¤§ï¼ŒGC pause ä¹Ÿè®¾å¾—æ¯”è¾ƒé•¿ï¼Œå› æ­¤å†…å­˜ GC ä¼šé€ æˆ CPU é—´æ­‡æ€§é£™å‡ï¼ŒCPU ç›‘æ§ä¼šæœ‰å¤§é‡çš„å°–å³°ã€‚ æœ‰äº›æœåŠ¡æœ‰å®šæ—¶ä»»åŠ¡ï¼Œå®šæ—¶ä»»åŠ¡ä¸€è¿è¡Œ CPU å°±æ¶¨ï¼Œä½†æ˜¯è¿™è·ŸæœåŠ¡çš„ QPS æ˜¯æ— å…³çš„ æœ‰äº›æœåŠ¡å¯èƒ½ä¸€è¿è¡Œ CPU å°±ä¼šç«‹å³å¤„äºä¸€ä¸ªé«˜ä½çŠ¶æ€ï¼Œå®ƒå¯èƒ½å¸Œæœ›ä½¿ç”¨åˆ«çš„ä¸šåŠ¡ä¾§æŒ‡æ ‡æ¥è¿›è¡Œæ‰©å®¹ï¼Œè€Œä¸æ˜¯ CPU. å› ä¸ºä¸Šè¿°é—®é¢˜å­˜åœ¨ï¼Œä½¿ç”¨ CPU æ‰©ç¼©å®¹ï¼Œå°±å¯èƒ½ä¼šé€ æˆæœåŠ¡é¢‘ç¹çš„æ‰©å®¹ç„¶åç¼©å®¹ï¼Œæˆ–è€…æ— é™æ‰©å®¹ã€‚è€Œæœ‰äº›æœåŠ¡ï¼ˆå¦‚æˆ‘ä»¬çš„ã€Œæ¨èæœåŠ¡ã€ï¼‰ï¼Œå¯¹ã€Œæ‰©å®¹ã€å’Œã€Œç¼©å®¹ã€éƒ½æ˜¯æ¯”è¾ƒæ•æ„Ÿçš„ï¼Œæ¯æ¬¡æ‰©ç¼©éƒ½ä¼šé€ æˆæœåŠ¡å¯ç”¨ç‡æŠ–åŠ¨ã€‚ å¯¹è¿™ç±»æœåŠ¡è€Œè¨€ï¼ŒHPA æœ‰è¿™å‡ ç§è°ƒæ•´ç­–ç•¥ï¼š é€‰æ‹©ä½¿ç”¨ QPS ç­‰ç›¸å¯¹æ¯”è¾ƒå¹³æ»‘ï¼Œæ²¡æœ‰ GC è¿™ç±»å¹²æ‰°çš„æŒ‡æ ‡æ¥è¿›è¡Œæ‰©ç¼©å®¹ï¼Œè¿™éœ€è¦å€ŸåŠ© KEDA ç­‰ç¤¾åŒºç»„ä»¶ã€‚ å¯¹ kubernetes 1.18+ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ HPA çš„ behavior.scaleDown å’Œ behavior.scaleUp ä¸¤ä¸ªå‚æ•°ï¼Œæ§åˆ¶æ¯æ¬¡æ‰©ç¼©å®¹çš„æœ€å¤š pod æ•°é‡æˆ–è€…æ¯”ä¾‹ã€‚ ç¤ºä¾‹å¦‚ä¸‹ï¼š yaml --- apiVersion: autoscaling/v2beta2 kind: HorizontalPodAutoscaler metadata: name: podinfo namespace: default spec: scaleTargetRef: apiVersion: apps/v1 kind: Deployment name: podinfo minReplicas: 3 maxReplicas: 50 metrics: - type: Resource resource: name: cpu target: type: Utilization averageUtilization: 50 # æœŸæœ›çš„ CPU å¹³å‡å€¼ behavior: scaleUp: stabilizationWindowSeconds: 0 # é»˜è®¤ä¸º 0ï¼Œåªä½¿ç”¨å½“å‰å€¼è¿›è¡Œæ‰©ç¼©å®¹ policies: - periodSeconds: 180 # æ¯ 3 åˆ†é’Ÿæœ€å¤šæ‰©å®¹ 5% çš„ Pods type: Percent value: 5 - periodSeconds: 60 # æ¯åˆ†é’Ÿæœ€å¤šæ‰©å®¹ 1 ä¸ª Podï¼Œæ‰©çš„æ…¢ä¸€ç‚¹ä¸»è¦æ˜¯ä¸ºäº†ä¸€ä¸ªä¸ªåœ°é¢„çƒ­ï¼Œé¿å…ä¸€æ¬¡æ‰©å®¹å¤ªå¤šæœªé¢„çƒ­çš„ Pods å¯¼è‡´æœåŠ¡å¯ç”¨ç‡å‰§çƒˆæŠ–åŠ¨ type: Pods value: 1 selectPolicy: Min # é€‰æ‹©æœ€å°çš„ç­–ç•¥ # ä»¥ä¸‹çš„ä¸€åˆ‡é…ç½®ï¼Œéƒ½æ˜¯ä¸ºäº†æ›´å¹³æ»‘åœ°ç¼©å®¹ scaleDown: stabilizationWindowSeconds: 600 # ä½¿ç”¨è¿‡å» 10 mins çš„æœ€å¤§ cpu å€¼è¿›è¡Œç¼©å®¹è®¡ç®—ï¼Œé¿å…è¿‡å¿«ç¼©å®¹ policies: - type: Percent # æ¯ 3 mins æœ€å¤šç¼©å®¹ `ceil[å½“å‰å‰¯æœ¬æ•° * 5%]` ä¸ª podï¼ˆ20 ä¸ª pod ä»¥å†…ï¼Œä¸€æ¬¡åªç¼©å®¹ 1 ä¸ª podï¼‰ value: 5 periodSeconds: 180 - type: Pods # æ¯ 1 mins æœ€å¤šç¼©å®¹ 1 ä¸ª pod value: 1 periodSeconds: 60 selectPolicy: Min # ä¸Šé¢çš„ policies åˆ—è¡¨ï¼Œåªç”Ÿæ•ˆå…¶ä¸­æœ€å°çš„å€¼ä½œä¸ºç¼©å®¹é™åˆ¶ï¼ˆä¿è¯å¹³æ»‘ç¼©å®¹ï¼‰ è€Œå¯¹äºæ‰©å®¹ä¸å¤Ÿå¹³æ»‘è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥è€ƒè™‘æä¾›ç±»ä¼¼ AWS ALB TargetGroup slow_start çš„åŠŸèƒ½ï¼Œåœ¨æ‰©å®¹æ—¶ç¼“æ…¢å°†æµé‡åˆ‡åˆ°æ–° Pod ä¸Šï¼Œä»¥å®ç°é¢„çƒ­æœåŠ¡ï¼ˆJVM é¢„çƒ­ä»¥åŠæœ¬åœ°ç¼“å­˜é¢„çƒ­ï¼‰ï¼Œè¿™æ ·å°±èƒ½è¾¾åˆ°æ¯”è¾ƒå¥½çš„å¹³æ»‘æ‰©å®¹æ•ˆæœã€‚ ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:3:4","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ","Cloud-Native"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/#4-hpa-çš„å¸¸è§é—®é¢˜"},{"categories":["tech"],"content":" 4. HPA çš„å¸¸è§é—®é¢˜ 4.1. Pod æ‰©å®¹ - VM é¢„çƒ­é™·é˜±Java/C# è¿™ç±»è¿è¡Œåœ¨ VM ä¸Šçš„è¯­è¨€ï¼Œåœ¨å¯åŠ¨é˜¶æ®µä¸ç¬¬ä¸€æ¬¡æ‰§è¡Œè¯·æ±‚æ—¶ï¼Œå¾€å¾€éœ€è¦åˆå§‹åŒ–ä¸€äº›èµ„æºã€‚è¿™å¯¼è‡´åœ¨å®¹å™¨åˆšå¯åŠ¨çš„ä¸€æ®µæ—¶é—´ï¼Œå®ƒéœ€è¦æ¶ˆè€—æ›´å¤šçš„ CPU å»å°†å­—èŠ‚ç ç¼–è¯‘æˆæœºå™¨ç å¹¶ç¼“å­˜èµ·æ¥ã€‚è¿™å°±æ˜¯ VM è¯­è¨€çš„ã€Œé¢„çƒ­ã€é—®é¢˜ã€‚ ç›¸å…³æ–‡æ¡£ï¼š How to Warm Up the JVM How to cold start fast a java service on k8s (EKS) å› ä¸ºä¸Šè¿°ã€Œé¢„çƒ­ã€é—®é¢˜åœ¨ä½¿ç”¨ HPA æ‰©ç¼©å®¹ Java/C# ç­‰è¿è¡Œåœ¨ VM ä¸Šçš„ç¨‹åºæ—¶ï¼ŒHPA ä¸€æ‰©å®¹ï¼ŒæœåŠ¡å¯ç”¨ç‡å°±ä¼šæŠ–åŠ¨ï¼Œç”šè‡³å¼•å‘é›ªå´©ã€‚ ä¸¾ä¾‹è¯´æ˜ï¼Œåœ¨æœ‰å¤§é‡ç”¨æˆ·è®¿é—®çš„æ—¶å€™ï¼Œåªè¦è¯·æ±‚è¢«è½¬å‘åˆ°æ–°å»ºçš„ Java Pod ä¸Šï¼Œè¿™ä¸ªè¯·æ±‚å°±ä¼šã€Œå¡ä½ã€ã€‚å¦‚æœè¯·æ±‚é€Ÿåº¦å¤ªå¿«ï¼ŒPod å¯åŠ¨çš„ç¬é—´ã€Œå¡ä½ã€çš„è¯·æ±‚å°±è¶Šå¤šï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æ–°å»º Pod å› ä¸ºå‹åŠ›è¿‡å¤§è€Œå®æ‰ã€‚ç„¶å Pod æ¯æ¬¡åˆšé‡å¯å°±è¢«æ‰“å®ï¼Œè¿›å…¥ CrashLoopBackoff å¾ªç¯ã€‚ å¦‚æœæ˜¯åœ¨ä½¿ç”¨å¤šçº¿ç¨‹åšè´Ÿè½½æµ‹è¯•æ—¶ï¼Œæ•ˆæœæ›´æ˜æ˜¾ï¼š50 ä¸ªçº¿ç¨‹åœ¨ä¸é—´æ–­åœ°è¯·æ±‚ï¼Œåˆ«çš„ Pod å“åº”æ—¶é—´æ˜¯ã€Œæ¯«ç§’çº§ã€ï¼Œè€Œæ–°å»ºçš„ Pod çš„é¦–æ¬¡å“åº”æ˜¯ã€Œç§’çº§ã€ã€‚å‡ ä¹æ˜¯ä¸€ç¬é—´ï¼Œ50 ä¸ªçº¿ç¨‹å°±ä¼šå…¨éƒ¨é™·åœ¨æ–°å»ºçš„ Pod è¿™é‡Œã€‚è€Œæ–°å»ºçš„ Pod åœ¨å¯åŠ¨çš„ç¬é—´å¯èƒ½ç‰¹åˆ«è„†å¼±ï¼Œç¬é—´çš„ 50 ä¸ªå¹¶å‘è¯·æ±‚å°±å¯ä»¥å°†å®ƒå‹å®ã€‚ç„¶å Pod ä¸€é‡å¯å°±è¢«å‹å®ï¼Œè¿›å…¥ CrashLoopBackoff å¾ªç¯ã€‚ è§£å†³æ–¹æ³•ï¼š å¯ä»¥åœ¨ã€Œåº”ç”¨å±‚é¢ã€è§£å†³ï¼š å¤§ Pod ç­–ç•¥ï¼šJVM é¢„çƒ­é˜¶æ®µéœ€è¦ä½¿ç”¨æ›´å¤šçš„ CPUï¼Œå‡è®¾åœ¨ HPA ä¸º 60% CPU çš„æƒ…å†µä¸‹ï¼Œè¶Šå¤§çš„ Pod å®ƒçš„å¯è¶…å– CPU ï¼ˆ40%ï¼‰æ˜¾ç„¶å°±æ›´å¤šï¼Œè¿™å°±èƒ½ç¼“è§£ JVM é¢„çƒ­é—®é¢˜ã€‚ å®æµ‹å°† Pod çš„ requests/limits ä» 3.7c/7.5G æ‰©å®¹åˆ° 7.4c/15Gï¼ŒæœåŠ¡çš„æ‰©å®¹æ˜æ˜¾æ›´å¹³æ»‘äº†ã€‚ JVM å‚æ•°è°ƒä¼˜ï¼šä¸å®Œå…¨ä¸¾ä¾‹å¦‚ä¸‹ æå‰åˆ†é… G1New å†…å­˜ï¼š-XX:+UnlockExperimentalVMOptions -XX:G1NewSizePercent=60ï¼Œé¿å… JVM å¯åŠ¨é˜¶æ®µå› ä¸ºå†…å­˜ä¸è¶³é¢‘ç¹ GC ä½¿ç”¨ã€ŒAOT é¢„ç¼–è¯‘ã€æŠ€æœ¯ï¼šé¢„çƒ­é€šå¸¸éƒ½æ˜¯å› ä¸ºã€ŒJIT å³æ—¶ç¼–è¯‘ã€å¯¼è‡´çš„é—®é¢˜ï¼Œåœ¨éœ€è¦ç”¨åˆ°æ—¶å®ƒæ‰ç¼–è¯‘ã€‚è€Œ AOT æ˜¯é¢„å…ˆç¼–è¯‘ï¼Œåœ¨ä½¿ç”¨å‰å®Œæˆç¼–è¯‘ï¼Œå› æ­¤ AOT èƒ½è§£å†³é¢„çƒ­çš„é—®é¢˜ã€‚æ¯”å¦‚è¯´ Java çš„ GraalVM. Sprint Native æ˜¯ä½¿ç”¨ GralalVM å®ç° çš„ï¼Œä½†è¿˜åœ¨ beta é˜¶æ®µï¼Œè€Œä¸”æœ‰äº›å…¼å®¹æ€§é—®é¢˜ å…¶ä»–èµ„æ–™ steinsag/warm-me-up How to Warm Up the JVM ä¹Ÿå¯ä»¥åœ¨ã€ŒåŸºç¡€è®¾æ–½å±‚é¢ã€è§£å†³ï¼š åƒ AWS ALB TargetGroup ä»¥åŠå…¶ä»–äº‘æœåŠ¡å•†çš„ ALB æœåŠ¡ï¼Œé€šå¸¸éƒ½å¯ä»¥è®¾ç½® slow_start æ—¶é•¿ï¼Œ å³å¯¹æ–°åŠ å…¥çš„å®ä¾‹ï¼Œä½¿ç”¨ä¸€å®šæ—¶é—´æ…¢æ…¢åœ°æŠŠæµé‡åˆ‡è¿‡å»ï¼Œæœ€ç»ˆè¾¾åˆ°é¢„æœŸçš„è´Ÿè½½å‡è¡¡çŠ¶æ€ã€‚è¿™ä¸ªå¯ä»¥è§£å†³æœåŠ¡é¢„çƒ­é—®é¢˜ã€‚ Envoy ä¹Ÿå·²ç»æ”¯æŒ slow_start æ¨¡å¼ï¼Œæ”¯æŒåœ¨ä¸€ä¸ªè®¾ç½®å¥½çš„æ—¶é—´çª—å£å†…ï¼ŒæŠŠæµé‡æ…¢æ…¢è´Ÿè½½åˆ°æ–°åŠ å…¥çš„å®ä¾‹ä¸Šï¼Œè¾¾æˆé¢„çƒ­æ•ˆæœã€‚ 4.2. HPA æ‰©ç¼©å®¹è¿‡äºæ•æ„Ÿï¼Œå¯¼è‡´ Pod æ•°é‡éœ‡è¡é€šå¸¸æ¥è®²ï¼ŒK8s ä¸Šç»å¤§éƒ¨åˆ†è´Ÿè½½éƒ½åº”è¯¥é€‰æ‹©ä½¿ç”¨ CPU è¿›è¡Œæ‰©ç¼©å®¹ã€‚å› ä¸º CPU é€šå¸¸èƒ½å¾ˆå¥½çš„åæ˜ æœåŠ¡çš„è´Ÿè½½æƒ…å†µ ä½†æ˜¯æœ‰äº›æœåŠ¡ä¼šå­˜åœ¨å…¶ä»–å½±å“ CPU ä½¿ç”¨ç‡çš„å› ç´ ï¼Œå¯¼è‡´ä½¿ç”¨ CPU æ‰©ç¼©å®¹å˜å¾—ä¸é‚£ä¹ˆå¯é ï¼Œæ¯”å¦‚ï¼š æœ‰äº› Java æœåŠ¡å †å†…å­˜è®¾å¾—å¾ˆå¤§ï¼ŒGC pause ä¹Ÿè®¾å¾—æ¯”è¾ƒé•¿ï¼Œå› æ­¤å†…å­˜ GC ä¼šé€ æˆ CPU é—´æ­‡æ€§é£™å‡ï¼ŒCPU ç›‘æ§ä¼šæœ‰å¤§é‡çš„å°–å³°ã€‚ æœ‰äº›æœåŠ¡æœ‰å®šæ—¶ä»»åŠ¡ï¼Œå®šæ—¶ä»»åŠ¡ä¸€è¿è¡Œ CPU å°±æ¶¨ï¼Œä½†æ˜¯è¿™è·ŸæœåŠ¡çš„ QPS æ˜¯æ— å…³çš„ æœ‰äº›æœåŠ¡å¯èƒ½ä¸€è¿è¡Œ CPU å°±ä¼šç«‹å³å¤„äºä¸€ä¸ªé«˜ä½çŠ¶æ€ï¼Œå®ƒå¯èƒ½å¸Œæœ›ä½¿ç”¨åˆ«çš„ä¸šåŠ¡ä¾§æŒ‡æ ‡æ¥è¿›è¡Œæ‰©å®¹ï¼Œè€Œä¸æ˜¯ CPU. å› ä¸ºä¸Šè¿°é—®é¢˜å­˜åœ¨ï¼Œä½¿ç”¨ CPU æ‰©ç¼©å®¹ï¼Œå°±å¯èƒ½ä¼šé€ æˆæœåŠ¡é¢‘ç¹çš„æ‰©å®¹ç„¶åç¼©å®¹ï¼Œæˆ–è€…æ— é™æ‰©å®¹ã€‚è€Œæœ‰äº›æœåŠ¡ï¼ˆå¦‚æˆ‘ä»¬çš„ã€Œæ¨èæœåŠ¡ã€ï¼‰ï¼Œå¯¹ã€Œæ‰©å®¹ã€å’Œã€Œç¼©å®¹ã€éƒ½æ˜¯æ¯”è¾ƒæ•æ„Ÿçš„ï¼Œæ¯æ¬¡æ‰©ç¼©éƒ½ä¼šé€ æˆæœåŠ¡å¯ç”¨ç‡æŠ–åŠ¨ã€‚ å¯¹è¿™ç±»æœåŠ¡è€Œè¨€ï¼ŒHPA æœ‰è¿™å‡ ç§è°ƒæ•´ç­–ç•¥ï¼š é€‰æ‹©ä½¿ç”¨ QPS ç­‰ç›¸å¯¹æ¯”è¾ƒå¹³æ»‘ï¼Œæ²¡æœ‰ GC è¿™ç±»å¹²æ‰°çš„æŒ‡æ ‡æ¥è¿›è¡Œæ‰©ç¼©å®¹ï¼Œè¿™éœ€è¦å€ŸåŠ© KEDA ç­‰ç¤¾åŒºç»„ä»¶ã€‚ å¯¹ kubernetes 1.18+ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ HPA çš„ behavior.scaleDown å’Œ behavior.scaleUp ä¸¤ä¸ªå‚æ•°ï¼Œæ§åˆ¶æ¯æ¬¡æ‰©ç¼©å®¹çš„æœ€å¤š pod æ•°é‡æˆ–è€…æ¯”ä¾‹ã€‚ ç¤ºä¾‹å¦‚ä¸‹ï¼š yaml --- apiVersion: autoscaling/v2beta2 kind: HorizontalPodAutoscaler metadata: name: podinfo namespace: default spec: scaleTargetRef: apiVersion: apps/v1 kind: Deployment name: podinfo minReplicas: 3 maxReplicas: 50 metrics: - type: Resource resource: name: cpu target: type: Utilization averageUtilization: 50 # æœŸæœ›çš„ CPU å¹³å‡å€¼ behavior: scaleUp: stabilizationWindowSeconds: 0 # é»˜è®¤ä¸º 0ï¼Œåªä½¿ç”¨å½“å‰å€¼è¿›è¡Œæ‰©ç¼©å®¹ policies: - periodSeconds: 180 # æ¯ 3 åˆ†é’Ÿæœ€å¤šæ‰©å®¹ 5% çš„ Pods type: Percent value: 5 - periodSeconds: 60 # æ¯åˆ†é’Ÿæœ€å¤šæ‰©å®¹ 1 ä¸ª Podï¼Œæ‰©çš„æ…¢ä¸€ç‚¹ä¸»è¦æ˜¯ä¸ºäº†ä¸€ä¸ªä¸ªåœ°é¢„çƒ­ï¼Œé¿å…ä¸€æ¬¡æ‰©å®¹å¤ªå¤šæœªé¢„çƒ­çš„ Pods å¯¼è‡´æœåŠ¡å¯ç”¨ç‡å‰§çƒˆæŠ–åŠ¨ type: Pods value: 1 selectPolicy: Min # é€‰æ‹©æœ€å°çš„ç­–ç•¥ # ä»¥ä¸‹çš„ä¸€åˆ‡é…ç½®ï¼Œéƒ½æ˜¯ä¸ºäº†æ›´å¹³æ»‘åœ°ç¼©å®¹ scaleDown: stabilizationWindowSeconds: 600 # ä½¿ç”¨è¿‡å» 10 mins çš„æœ€å¤§ cpu å€¼è¿›è¡Œç¼©å®¹è®¡ç®—ï¼Œé¿å…è¿‡å¿«ç¼©å®¹ policies: - type: Percent # æ¯ 3 mins æœ€å¤šç¼©å®¹ `ceil[å½“å‰å‰¯æœ¬æ•° * 5%]` ä¸ª podï¼ˆ20 ä¸ª pod ä»¥å†…ï¼Œä¸€æ¬¡åªç¼©å®¹ 1 ä¸ª podï¼‰ value: 5 periodSeconds: 180 - type: Pods # æ¯ 1 mins æœ€å¤šç¼©å®¹ 1 ä¸ª pod value: 1 periodSeconds: 60 selectPolicy: Min # ä¸Šé¢çš„ policies åˆ—è¡¨ï¼Œåªç”Ÿæ•ˆå…¶ä¸­æœ€å°çš„å€¼ä½œä¸ºç¼©å®¹é™åˆ¶ï¼ˆä¿è¯å¹³æ»‘ç¼©å®¹ï¼‰ è€Œå¯¹äºæ‰©å®¹ä¸å¤Ÿå¹³æ»‘è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥è€ƒè™‘æä¾›ç±»ä¼¼ AWS ALB TargetGroup slow_start çš„åŠŸèƒ½ï¼Œåœ¨æ‰©å®¹æ—¶ç¼“æ…¢å°†æµé‡åˆ‡åˆ°æ–° Pod ä¸Šï¼Œä»¥å®ç°é¢„çƒ­æœåŠ¡ï¼ˆJVM é¢„çƒ­ä»¥åŠæœ¬åœ°ç¼“å­˜é¢„çƒ­ï¼‰ï¼Œè¿™æ ·å°±èƒ½è¾¾åˆ°æ¯”è¾ƒå¥½çš„å¹³æ»‘æ‰©å®¹æ•ˆæœã€‚ ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:3:4","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ","Cloud-Native"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/#41-pod-æ‰©å®¹---vm-é¢„çƒ­é™·é˜±"},{"categories":["tech"],"content":" 4. HPA çš„å¸¸è§é—®é¢˜ 4.1. Pod æ‰©å®¹ - VM é¢„çƒ­é™·é˜±Java/C# è¿™ç±»è¿è¡Œåœ¨ VM ä¸Šçš„è¯­è¨€ï¼Œåœ¨å¯åŠ¨é˜¶æ®µä¸ç¬¬ä¸€æ¬¡æ‰§è¡Œè¯·æ±‚æ—¶ï¼Œå¾€å¾€éœ€è¦åˆå§‹åŒ–ä¸€äº›èµ„æºã€‚è¿™å¯¼è‡´åœ¨å®¹å™¨åˆšå¯åŠ¨çš„ä¸€æ®µæ—¶é—´ï¼Œå®ƒéœ€è¦æ¶ˆè€—æ›´å¤šçš„ CPU å»å°†å­—èŠ‚ç ç¼–è¯‘æˆæœºå™¨ç å¹¶ç¼“å­˜èµ·æ¥ã€‚è¿™å°±æ˜¯ VM è¯­è¨€çš„ã€Œé¢„çƒ­ã€é—®é¢˜ã€‚ ç›¸å…³æ–‡æ¡£ï¼š How to Warm Up the JVM How to cold start fast a java service on k8s (EKS) å› ä¸ºä¸Šè¿°ã€Œé¢„çƒ­ã€é—®é¢˜åœ¨ä½¿ç”¨ HPA æ‰©ç¼©å®¹ Java/C# ç­‰è¿è¡Œåœ¨ VM ä¸Šçš„ç¨‹åºæ—¶ï¼ŒHPA ä¸€æ‰©å®¹ï¼ŒæœåŠ¡å¯ç”¨ç‡å°±ä¼šæŠ–åŠ¨ï¼Œç”šè‡³å¼•å‘é›ªå´©ã€‚ ä¸¾ä¾‹è¯´æ˜ï¼Œåœ¨æœ‰å¤§é‡ç”¨æˆ·è®¿é—®çš„æ—¶å€™ï¼Œåªè¦è¯·æ±‚è¢«è½¬å‘åˆ°æ–°å»ºçš„ Java Pod ä¸Šï¼Œè¿™ä¸ªè¯·æ±‚å°±ä¼šã€Œå¡ä½ã€ã€‚å¦‚æœè¯·æ±‚é€Ÿåº¦å¤ªå¿«ï¼ŒPod å¯åŠ¨çš„ç¬é—´ã€Œå¡ä½ã€çš„è¯·æ±‚å°±è¶Šå¤šï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æ–°å»º Pod å› ä¸ºå‹åŠ›è¿‡å¤§è€Œå®æ‰ã€‚ç„¶å Pod æ¯æ¬¡åˆšé‡å¯å°±è¢«æ‰“å®ï¼Œè¿›å…¥ CrashLoopBackoff å¾ªç¯ã€‚ å¦‚æœæ˜¯åœ¨ä½¿ç”¨å¤šçº¿ç¨‹åšè´Ÿè½½æµ‹è¯•æ—¶ï¼Œæ•ˆæœæ›´æ˜æ˜¾ï¼š50 ä¸ªçº¿ç¨‹åœ¨ä¸é—´æ–­åœ°è¯·æ±‚ï¼Œåˆ«çš„ Pod å“åº”æ—¶é—´æ˜¯ã€Œæ¯«ç§’çº§ã€ï¼Œè€Œæ–°å»ºçš„ Pod çš„é¦–æ¬¡å“åº”æ˜¯ã€Œç§’çº§ã€ã€‚å‡ ä¹æ˜¯ä¸€ç¬é—´ï¼Œ50 ä¸ªçº¿ç¨‹å°±ä¼šå…¨éƒ¨é™·åœ¨æ–°å»ºçš„ Pod è¿™é‡Œã€‚è€Œæ–°å»ºçš„ Pod åœ¨å¯åŠ¨çš„ç¬é—´å¯èƒ½ç‰¹åˆ«è„†å¼±ï¼Œç¬é—´çš„ 50 ä¸ªå¹¶å‘è¯·æ±‚å°±å¯ä»¥å°†å®ƒå‹å®ã€‚ç„¶å Pod ä¸€é‡å¯å°±è¢«å‹å®ï¼Œè¿›å…¥ CrashLoopBackoff å¾ªç¯ã€‚ è§£å†³æ–¹æ³•ï¼š å¯ä»¥åœ¨ã€Œåº”ç”¨å±‚é¢ã€è§£å†³ï¼š å¤§ Pod ç­–ç•¥ï¼šJVM é¢„çƒ­é˜¶æ®µéœ€è¦ä½¿ç”¨æ›´å¤šçš„ CPUï¼Œå‡è®¾åœ¨ HPA ä¸º 60% CPU çš„æƒ…å†µä¸‹ï¼Œè¶Šå¤§çš„ Pod å®ƒçš„å¯è¶…å– CPU ï¼ˆ40%ï¼‰æ˜¾ç„¶å°±æ›´å¤šï¼Œè¿™å°±èƒ½ç¼“è§£ JVM é¢„çƒ­é—®é¢˜ã€‚ å®æµ‹å°† Pod çš„ requests/limits ä» 3.7c/7.5G æ‰©å®¹åˆ° 7.4c/15Gï¼ŒæœåŠ¡çš„æ‰©å®¹æ˜æ˜¾æ›´å¹³æ»‘äº†ã€‚ JVM å‚æ•°è°ƒä¼˜ï¼šä¸å®Œå…¨ä¸¾ä¾‹å¦‚ä¸‹ æå‰åˆ†é… G1New å†…å­˜ï¼š-XX:+UnlockExperimentalVMOptions -XX:G1NewSizePercent=60ï¼Œé¿å… JVM å¯åŠ¨é˜¶æ®µå› ä¸ºå†…å­˜ä¸è¶³é¢‘ç¹ GC ä½¿ç”¨ã€ŒAOT é¢„ç¼–è¯‘ã€æŠ€æœ¯ï¼šé¢„çƒ­é€šå¸¸éƒ½æ˜¯å› ä¸ºã€ŒJIT å³æ—¶ç¼–è¯‘ã€å¯¼è‡´çš„é—®é¢˜ï¼Œåœ¨éœ€è¦ç”¨åˆ°æ—¶å®ƒæ‰ç¼–è¯‘ã€‚è€Œ AOT æ˜¯é¢„å…ˆç¼–è¯‘ï¼Œåœ¨ä½¿ç”¨å‰å®Œæˆç¼–è¯‘ï¼Œå› æ­¤ AOT èƒ½è§£å†³é¢„çƒ­çš„é—®é¢˜ã€‚æ¯”å¦‚è¯´ Java çš„ GraalVM. Sprint Native æ˜¯ä½¿ç”¨ GralalVM å®ç° çš„ï¼Œä½†è¿˜åœ¨ beta é˜¶æ®µï¼Œè€Œä¸”æœ‰äº›å…¼å®¹æ€§é—®é¢˜ å…¶ä»–èµ„æ–™ steinsag/warm-me-up How to Warm Up the JVM ä¹Ÿå¯ä»¥åœ¨ã€ŒåŸºç¡€è®¾æ–½å±‚é¢ã€è§£å†³ï¼š åƒ AWS ALB TargetGroup ä»¥åŠå…¶ä»–äº‘æœåŠ¡å•†çš„ ALB æœåŠ¡ï¼Œé€šå¸¸éƒ½å¯ä»¥è®¾ç½® slow_start æ—¶é•¿ï¼Œ å³å¯¹æ–°åŠ å…¥çš„å®ä¾‹ï¼Œä½¿ç”¨ä¸€å®šæ—¶é—´æ…¢æ…¢åœ°æŠŠæµé‡åˆ‡è¿‡å»ï¼Œæœ€ç»ˆè¾¾åˆ°é¢„æœŸçš„è´Ÿè½½å‡è¡¡çŠ¶æ€ã€‚è¿™ä¸ªå¯ä»¥è§£å†³æœåŠ¡é¢„çƒ­é—®é¢˜ã€‚ Envoy ä¹Ÿå·²ç»æ”¯æŒ slow_start æ¨¡å¼ï¼Œæ”¯æŒåœ¨ä¸€ä¸ªè®¾ç½®å¥½çš„æ—¶é—´çª—å£å†…ï¼ŒæŠŠæµé‡æ…¢æ…¢è´Ÿè½½åˆ°æ–°åŠ å…¥çš„å®ä¾‹ä¸Šï¼Œè¾¾æˆé¢„çƒ­æ•ˆæœã€‚ 4.2. HPA æ‰©ç¼©å®¹è¿‡äºæ•æ„Ÿï¼Œå¯¼è‡´ Pod æ•°é‡éœ‡è¡é€šå¸¸æ¥è®²ï¼ŒK8s ä¸Šç»å¤§éƒ¨åˆ†è´Ÿè½½éƒ½åº”è¯¥é€‰æ‹©ä½¿ç”¨ CPU è¿›è¡Œæ‰©ç¼©å®¹ã€‚å› ä¸º CPU é€šå¸¸èƒ½å¾ˆå¥½çš„åæ˜ æœåŠ¡çš„è´Ÿè½½æƒ…å†µ ä½†æ˜¯æœ‰äº›æœåŠ¡ä¼šå­˜åœ¨å…¶ä»–å½±å“ CPU ä½¿ç”¨ç‡çš„å› ç´ ï¼Œå¯¼è‡´ä½¿ç”¨ CPU æ‰©ç¼©å®¹å˜å¾—ä¸é‚£ä¹ˆå¯é ï¼Œæ¯”å¦‚ï¼š æœ‰äº› Java æœåŠ¡å †å†…å­˜è®¾å¾—å¾ˆå¤§ï¼ŒGC pause ä¹Ÿè®¾å¾—æ¯”è¾ƒé•¿ï¼Œå› æ­¤å†…å­˜ GC ä¼šé€ æˆ CPU é—´æ­‡æ€§é£™å‡ï¼ŒCPU ç›‘æ§ä¼šæœ‰å¤§é‡çš„å°–å³°ã€‚ æœ‰äº›æœåŠ¡æœ‰å®šæ—¶ä»»åŠ¡ï¼Œå®šæ—¶ä»»åŠ¡ä¸€è¿è¡Œ CPU å°±æ¶¨ï¼Œä½†æ˜¯è¿™è·ŸæœåŠ¡çš„ QPS æ˜¯æ— å…³çš„ æœ‰äº›æœåŠ¡å¯èƒ½ä¸€è¿è¡Œ CPU å°±ä¼šç«‹å³å¤„äºä¸€ä¸ªé«˜ä½çŠ¶æ€ï¼Œå®ƒå¯èƒ½å¸Œæœ›ä½¿ç”¨åˆ«çš„ä¸šåŠ¡ä¾§æŒ‡æ ‡æ¥è¿›è¡Œæ‰©å®¹ï¼Œè€Œä¸æ˜¯ CPU. å› ä¸ºä¸Šè¿°é—®é¢˜å­˜åœ¨ï¼Œä½¿ç”¨ CPU æ‰©ç¼©å®¹ï¼Œå°±å¯èƒ½ä¼šé€ æˆæœåŠ¡é¢‘ç¹çš„æ‰©å®¹ç„¶åç¼©å®¹ï¼Œæˆ–è€…æ— é™æ‰©å®¹ã€‚è€Œæœ‰äº›æœåŠ¡ï¼ˆå¦‚æˆ‘ä»¬çš„ã€Œæ¨èæœåŠ¡ã€ï¼‰ï¼Œå¯¹ã€Œæ‰©å®¹ã€å’Œã€Œç¼©å®¹ã€éƒ½æ˜¯æ¯”è¾ƒæ•æ„Ÿçš„ï¼Œæ¯æ¬¡æ‰©ç¼©éƒ½ä¼šé€ æˆæœåŠ¡å¯ç”¨ç‡æŠ–åŠ¨ã€‚ å¯¹è¿™ç±»æœåŠ¡è€Œè¨€ï¼ŒHPA æœ‰è¿™å‡ ç§è°ƒæ•´ç­–ç•¥ï¼š é€‰æ‹©ä½¿ç”¨ QPS ç­‰ç›¸å¯¹æ¯”è¾ƒå¹³æ»‘ï¼Œæ²¡æœ‰ GC è¿™ç±»å¹²æ‰°çš„æŒ‡æ ‡æ¥è¿›è¡Œæ‰©ç¼©å®¹ï¼Œè¿™éœ€è¦å€ŸåŠ© KEDA ç­‰ç¤¾åŒºç»„ä»¶ã€‚ å¯¹ kubernetes 1.18+ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ HPA çš„ behavior.scaleDown å’Œ behavior.scaleUp ä¸¤ä¸ªå‚æ•°ï¼Œæ§åˆ¶æ¯æ¬¡æ‰©ç¼©å®¹çš„æœ€å¤š pod æ•°é‡æˆ–è€…æ¯”ä¾‹ã€‚ ç¤ºä¾‹å¦‚ä¸‹ï¼š yaml --- apiVersion: autoscaling/v2beta2 kind: HorizontalPodAutoscaler metadata: name: podinfo namespace: default spec: scaleTargetRef: apiVersion: apps/v1 kind: Deployment name: podinfo minReplicas: 3 maxReplicas: 50 metrics: - type: Resource resource: name: cpu target: type: Utilization averageUtilization: 50 # æœŸæœ›çš„ CPU å¹³å‡å€¼ behavior: scaleUp: stabilizationWindowSeconds: 0 # é»˜è®¤ä¸º 0ï¼Œåªä½¿ç”¨å½“å‰å€¼è¿›è¡Œæ‰©ç¼©å®¹ policies: - periodSeconds: 180 # æ¯ 3 åˆ†é’Ÿæœ€å¤šæ‰©å®¹ 5% çš„ Pods type: Percent value: 5 - periodSeconds: 60 # æ¯åˆ†é’Ÿæœ€å¤šæ‰©å®¹ 1 ä¸ª Podï¼Œæ‰©çš„æ…¢ä¸€ç‚¹ä¸»è¦æ˜¯ä¸ºäº†ä¸€ä¸ªä¸ªåœ°é¢„çƒ­ï¼Œé¿å…ä¸€æ¬¡æ‰©å®¹å¤ªå¤šæœªé¢„çƒ­çš„ Pods å¯¼è‡´æœåŠ¡å¯ç”¨ç‡å‰§çƒˆæŠ–åŠ¨ type: Pods value: 1 selectPolicy: Min # é€‰æ‹©æœ€å°çš„ç­–ç•¥ # ä»¥ä¸‹çš„ä¸€åˆ‡é…ç½®ï¼Œéƒ½æ˜¯ä¸ºäº†æ›´å¹³æ»‘åœ°ç¼©å®¹ scaleDown: stabilizationWindowSeconds: 600 # ä½¿ç”¨è¿‡å» 10 mins çš„æœ€å¤§ cpu å€¼è¿›è¡Œç¼©å®¹è®¡ç®—ï¼Œé¿å…è¿‡å¿«ç¼©å®¹ policies: - type: Percent # æ¯ 3 mins æœ€å¤šç¼©å®¹ `ceil[å½“å‰å‰¯æœ¬æ•° * 5%]` ä¸ª podï¼ˆ20 ä¸ª pod ä»¥å†…ï¼Œä¸€æ¬¡åªç¼©å®¹ 1 ä¸ª podï¼‰ value: 5 periodSeconds: 180 - type: Pods # æ¯ 1 mins æœ€å¤šç¼©å®¹ 1 ä¸ª pod value: 1 periodSeconds: 60 selectPolicy: Min # ä¸Šé¢çš„ policies åˆ—è¡¨ï¼Œåªç”Ÿæ•ˆå…¶ä¸­æœ€å°çš„å€¼ä½œä¸ºç¼©å®¹é™åˆ¶ï¼ˆä¿è¯å¹³æ»‘ç¼©å®¹ï¼‰ è€Œå¯¹äºæ‰©å®¹ä¸å¤Ÿå¹³æ»‘è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥è€ƒè™‘æä¾›ç±»ä¼¼ AWS ALB TargetGroup slow_start çš„åŠŸèƒ½ï¼Œåœ¨æ‰©å®¹æ—¶ç¼“æ…¢å°†æµé‡åˆ‡åˆ°æ–° Pod ä¸Šï¼Œä»¥å®ç°é¢„çƒ­æœåŠ¡ï¼ˆJVM é¢„çƒ­ä»¥åŠæœ¬åœ°ç¼“å­˜é¢„çƒ­ï¼‰ï¼Œè¿™æ ·å°±èƒ½è¾¾åˆ°æ¯”è¾ƒå¥½çš„å¹³æ»‘æ‰©å®¹æ•ˆæœã€‚ ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:3:4","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ","Cloud-Native"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/#42-hpa-æ‰©ç¼©å®¹è¿‡äºæ•æ„Ÿå¯¼è‡´-pod-æ•°é‡éœ‡è¡"},{"categories":["tech"],"content":" 5. HPA æ³¨æ„äº‹é¡¹æ³¨æ„ kubectl 1.23 ä»¥ä¸‹çš„ç‰ˆæœ¬ï¼Œé»˜è®¤ä½¿ç”¨ hpa.v1.autoscaling æ¥æŸ¥è¯¢ HPA é…ç½®ï¼Œv2beta2 ç›¸å…³çš„å‚æ•°ä¼šè¢«ç¼–ç åˆ° metadata.annotations ä¸­ã€‚ æ¯”å¦‚ behavior å°±ä¼šè¢«ç¼–ç åˆ° autoscaling.alpha.kubernetes.io/behavior è¿™ä¸ª key æ‰€å¯¹åº”çš„å€¼ä¸­ã€‚ å› æ­¤å¦‚æœä½¿ç”¨äº† v2beta2 çš„ HPAï¼Œä¸€å®šè¦æ˜ç¡®æŒ‡å®šä½¿ç”¨ v2beta2 ç‰ˆæœ¬çš„ HPAï¼š shell kubectl get hpa.v2beta2.autoscaling å¦åˆ™ä¸å°å¿ƒåŠ¨åˆ° annotations ä¸­ç¼–ç çš„æŸäº›å‚æ•°ï¼Œå¯èƒ½ä¼šäº§ç”Ÿæ„æ–™ä¹‹å¤–çš„æ•ˆæœï¼Œç”šè‡³ç›´æ¥æŠŠæ§åˆ¶é¢æå´©â€¦ æ¯”å¦‚è¿™ä¸ª issue:Nil pointer dereference in KCM after v1 HPA patch request ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:3:5","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ","Cloud-Native"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/#5-hpa-æ³¨æ„äº‹é¡¹"},{"categories":["tech"],"content":" 6. å‚è€ƒ Pod æ°´å¹³è‡ªåŠ¨ä¼¸ç¼© - Kubernetes Docs Horizontal Pod Autoscaleræ¼”ç»ƒ - Kubernetes Docs ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:3:6","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ","Cloud-Native"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/#6-å‚è€ƒ"},{"categories":["tech"],"content":" ä¸‰ã€èŠ‚ç‚¹ç»´æŠ¤ä¸Podå¹²æ‰°é¢„ç®— https://kubernetes.io/zh/docs/tasks/run-application/configure-pdb/ åœ¨æˆ‘ä»¬é€šè¿‡ kubectl drain å°†æŸä¸ªèŠ‚ç‚¹ä¸Šçš„å®¹å™¨é©±é€èµ°çš„æ—¶å€™ï¼Œkubernetes ä¼šä¾æ® Pod çš„ã€ŒPodDistruptionBugetã€æ¥è¿›è¡Œ Pod çš„é©±é€ã€‚ å¦‚æœä¸è®¾ç½®ä»»ä½•æ˜ç¡®çš„ PodDistruptionBugetï¼ŒPod å°†ä¼šè¢«ç›´æ¥æ€æ­»ï¼Œç„¶ååœ¨åˆ«çš„èŠ‚ç‚¹é‡æ–°è°ƒåº¦ï¼Œè¿™å¯èƒ½å¯¼è‡´æœåŠ¡ä¸­æ–­ï¼ PDB æ˜¯ä¸€ä¸ªå•ç‹¬çš„ CR è‡ªå®šä¹‰èµ„æºï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š yaml apiVersion: policy/v1beta1 kind: PodDisruptionBudget metadata: name: podinfo-pdb spec: # å¦‚æœä¸æ»¡è¶³ PDBï¼ŒPod é©±é€å°†ä¼šå¤±è´¥ï¼ minAvailable: 1 # æœ€å°‘ä¹Ÿè¦ç»´æŒä¸€ä¸ª Pod å¯ç”¨ # maxUnavailable: 1 # æœ€å¤§ä¸å¯ç”¨çš„ Pod æ•°ï¼Œä¸ minAvailable ä¸èƒ½åŒæ—¶é…ç½®ï¼äºŒé€‰ä¸€ selector: matchLabels: app: podinfo å¦‚æœåœ¨è¿›è¡ŒèŠ‚ç‚¹ç»´æŠ¤æ—¶(kubectl drain)ï¼ŒPod ä¸æ»¡è¶³ PDBï¼Œdrain å°†ä¼šå¤±è´¥ï¼Œç¤ºä¾‹ï¼š shell \u003e kubectl drain node-205 --ignore-daemonsets --delete-local-data node/node-205 cordoned WARNING: ignoring DaemonSet-managed Pods: kube-system/calico-node-nfhj7, kube-system/kube-proxy-94dz5 evicting pod default/podinfo-7c84d8c94d-h9brq evicting pod default/podinfo-7c84d8c94d-gw6qf error when evicting pod \"podinfo-7c84d8c94d-h9brq\" (will retry after 5s): Cannot evict pod as it would violate the pod's disruption budget. evicting pod default/podinfo-7c84d8c94d-h9brq error when evicting pod \"podinfo-7c84d8c94d-h9brq\" (will retry after 5s): Cannot evict pod as it would violate the pod's disruption budget. evicting pod default/podinfo-7c84d8c94d-h9brq error when evicting pod \"podinfo-7c84d8c94d-h9brq\" (will retry after 5s): Cannot evict pod as it would violate the pod's disruption budget. evicting pod default/podinfo-7c84d8c94d-h9brq pod/podinfo-7c84d8c94d-gw6qf evicted pod/podinfo-7c84d8c94d-h9brq evicted node/node-205 evicted ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œpodinfo ä¸€å…±æœ‰ä¸¤ä¸ªå‰¯æœ¬ï¼Œéƒ½è¿è¡Œåœ¨ node-205 ä¸Šé¢ã€‚æˆ‘ç»™å®ƒè®¾ç½®äº†å¹²æ‰°é¢„ç®— PDBminAvailable: 1ã€‚ ç„¶åä½¿ç”¨ kubectl drain é©±é€ Pod æ—¶ï¼Œå…¶ä¸­ä¸€ä¸ª Pod è¢«ç«‹å³é©±é€èµ°äº†ï¼Œè€Œå¦ä¸€ä¸ª Pod å¤§æ¦‚åœ¨ 15 ç§’å†…ä¸€ç›´é©±é€å¤±è´¥ã€‚å› ä¸ºç¬¬ä¸€ä¸ª Pod è¿˜æ²¡æœ‰åœ¨æ–°çš„èŠ‚ç‚¹ä¸Šå¯åŠ¨å®Œæˆï¼Œå®ƒä¸æ»¡è¶³å¹²æ‰°é¢„ç®— PDBminAvailable: 1 è¿™ä¸ªæ¡ä»¶ã€‚ å¤§çº¦ 15 ç§’åï¼Œæœ€å…ˆè¢«é©±é€èµ°çš„ Pod åœ¨æ–°èŠ‚ç‚¹ä¸Šå¯åŠ¨å®Œæˆäº†ï¼Œå¦ä¸€ä¸ª Pod æ»¡è¶³äº† PDB æ‰€ä»¥ç»ˆäºä¹Ÿè¢«é©±é€äº†ã€‚è¿™æ‰å®Œæˆäº†ä¸€ä¸ªèŠ‚ç‚¹çš„ drain æ“ä½œã€‚ ClusterAutoscaler ç­‰é›†ç¾¤èŠ‚ç‚¹ä¼¸ç¼©ç»„ä»¶ï¼Œåœ¨ç¼©å®¹èŠ‚ç‚¹æ—¶ä¹Ÿä¼šè€ƒè™‘ PodDisruptionBudget. å¦‚æœä½ çš„é›†ç¾¤ä½¿ç”¨äº† ClusterAutoscaler ç­‰åŠ¨æ€æ‰©ç¼©å®¹èŠ‚ç‚¹çš„ç»„ä»¶ï¼Œå¼ºçƒˆå»ºè®®è®¾ç½®ä¸ºæ‰€æœ‰æœåŠ¡è®¾ç½® PodDisruptionBudget. åœ¨ PDB ä¸­ä½¿ç”¨ç™¾åˆ†æ¯”çš„æ³¨æ„äº‹é¡¹åœ¨ä½¿ç”¨ç™¾åˆ†æ¯”æ—¶ï¼Œè®¡ç®—å‡ºçš„å®ä¾‹æ•°éƒ½ä¼šè¢«å‘ä¸Šå–æ•´ï¼Œè¿™ä¼šé€ æˆä¸¤ä¸ªç°è±¡ï¼š å¦‚æœä½¿ç”¨ minAvailableï¼Œå®ä¾‹æ•°è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå¯¼è‡´ ALLOWED DISRUPTIONS ä¸º 0ï¼Œæ‰€æœ‰å®ä¾‹éƒ½æ— æ³•è¢«é©±é€äº†ã€‚ å¦‚æœä½¿ç”¨ maxUnavailableï¼Œå› ä¸ºæ˜¯å‘ä¸Šå–æ•´ï¼ŒALLOWED DISRUPTIONS çš„å€¼ä¸€å®šä¸ä¼šä½äº 1ï¼Œè‡³å°‘æœ‰ 1 ä¸ªå®ä¾‹å¯ä»¥è¢«é©±é€ã€‚ å› æ­¤ä»ã€Œä¾¿äºé©±é€ã€çš„è§’åº¦çœ‹ï¼Œå¦‚æœä½ çš„æœåŠ¡è‡³å°‘æœ‰ 2-3 ä¸ªå®ä¾‹ï¼Œå»ºè®®åœ¨ PDB ä¸­ä½¿ç”¨ç™¾åˆ†æ¯”é…ç½®maxUnavailableï¼Œè€Œä¸æ˜¯ minAvailable. ç›¸å¯¹çš„ä»ã€Œç¡®ä¿æœåŠ¡ç¨³å®šæ€§ã€çš„è§’åº¦çœ‹ï¼Œæˆ‘ä»¬åˆ™åº”è¯¥ä½¿ç”¨ minAvailableï¼Œç¡®ä¿è‡³å°‘æœ‰ 1 ä¸ªå®ä¾‹å¯ç”¨ã€‚ ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:4:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ","Cloud-Native"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/#k8s-PodDistruptionBuget"},{"categories":["tech"],"content":" ä¸‰ã€èŠ‚ç‚¹ç»´æŠ¤ä¸Podå¹²æ‰°é¢„ç®— https://kubernetes.io/zh/docs/tasks/run-application/configure-pdb/ åœ¨æˆ‘ä»¬é€šè¿‡ kubectl drain å°†æŸä¸ªèŠ‚ç‚¹ä¸Šçš„å®¹å™¨é©±é€èµ°çš„æ—¶å€™ï¼Œkubernetes ä¼šä¾æ® Pod çš„ã€ŒPodDistruptionBugetã€æ¥è¿›è¡Œ Pod çš„é©±é€ã€‚ å¦‚æœä¸è®¾ç½®ä»»ä½•æ˜ç¡®çš„ PodDistruptionBugetï¼ŒPod å°†ä¼šè¢«ç›´æ¥æ€æ­»ï¼Œç„¶ååœ¨åˆ«çš„èŠ‚ç‚¹é‡æ–°è°ƒåº¦ï¼Œè¿™å¯èƒ½å¯¼è‡´æœåŠ¡ä¸­æ–­ï¼ PDB æ˜¯ä¸€ä¸ªå•ç‹¬çš„ CR è‡ªå®šä¹‰èµ„æºï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š yaml apiVersion: policy/v1beta1 kind: PodDisruptionBudget metadata: name: podinfo-pdb spec: # å¦‚æœä¸æ»¡è¶³ PDBï¼ŒPod é©±é€å°†ä¼šå¤±è´¥ï¼ minAvailable: 1 # æœ€å°‘ä¹Ÿè¦ç»´æŒä¸€ä¸ª Pod å¯ç”¨ # maxUnavailable: 1 # æœ€å¤§ä¸å¯ç”¨çš„ Pod æ•°ï¼Œä¸ minAvailable ä¸èƒ½åŒæ—¶é…ç½®ï¼äºŒé€‰ä¸€ selector: matchLabels: app: podinfo å¦‚æœåœ¨è¿›è¡ŒèŠ‚ç‚¹ç»´æŠ¤æ—¶(kubectl drain)ï¼ŒPod ä¸æ»¡è¶³ PDBï¼Œdrain å°†ä¼šå¤±è´¥ï¼Œç¤ºä¾‹ï¼š shell \u003e kubectl drain node-205 --ignore-daemonsets --delete-local-data node/node-205 cordoned WARNING: ignoring DaemonSet-managed Pods: kube-system/calico-node-nfhj7, kube-system/kube-proxy-94dz5 evicting pod default/podinfo-7c84d8c94d-h9brq evicting pod default/podinfo-7c84d8c94d-gw6qf error when evicting pod \"podinfo-7c84d8c94d-h9brq\" (will retry after 5s): Cannot evict pod as it would violate the pod's disruption budget. evicting pod default/podinfo-7c84d8c94d-h9brq error when evicting pod \"podinfo-7c84d8c94d-h9brq\" (will retry after 5s): Cannot evict pod as it would violate the pod's disruption budget. evicting pod default/podinfo-7c84d8c94d-h9brq error when evicting pod \"podinfo-7c84d8c94d-h9brq\" (will retry after 5s): Cannot evict pod as it would violate the pod's disruption budget. evicting pod default/podinfo-7c84d8c94d-h9brq pod/podinfo-7c84d8c94d-gw6qf evicted pod/podinfo-7c84d8c94d-h9brq evicted node/node-205 evicted ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œpodinfo ä¸€å…±æœ‰ä¸¤ä¸ªå‰¯æœ¬ï¼Œéƒ½è¿è¡Œåœ¨ node-205 ä¸Šé¢ã€‚æˆ‘ç»™å®ƒè®¾ç½®äº†å¹²æ‰°é¢„ç®— PDBminAvailable: 1ã€‚ ç„¶åä½¿ç”¨ kubectl drain é©±é€ Pod æ—¶ï¼Œå…¶ä¸­ä¸€ä¸ª Pod è¢«ç«‹å³é©±é€èµ°äº†ï¼Œè€Œå¦ä¸€ä¸ª Pod å¤§æ¦‚åœ¨ 15 ç§’å†…ä¸€ç›´é©±é€å¤±è´¥ã€‚å› ä¸ºç¬¬ä¸€ä¸ª Pod è¿˜æ²¡æœ‰åœ¨æ–°çš„èŠ‚ç‚¹ä¸Šå¯åŠ¨å®Œæˆï¼Œå®ƒä¸æ»¡è¶³å¹²æ‰°é¢„ç®— PDBminAvailable: 1 è¿™ä¸ªæ¡ä»¶ã€‚ å¤§çº¦ 15 ç§’åï¼Œæœ€å…ˆè¢«é©±é€èµ°çš„ Pod åœ¨æ–°èŠ‚ç‚¹ä¸Šå¯åŠ¨å®Œæˆäº†ï¼Œå¦ä¸€ä¸ª Pod æ»¡è¶³äº† PDB æ‰€ä»¥ç»ˆäºä¹Ÿè¢«é©±é€äº†ã€‚è¿™æ‰å®Œæˆäº†ä¸€ä¸ªèŠ‚ç‚¹çš„ drain æ“ä½œã€‚ ClusterAutoscaler ç­‰é›†ç¾¤èŠ‚ç‚¹ä¼¸ç¼©ç»„ä»¶ï¼Œåœ¨ç¼©å®¹èŠ‚ç‚¹æ—¶ä¹Ÿä¼šè€ƒè™‘ PodDisruptionBudget. å¦‚æœä½ çš„é›†ç¾¤ä½¿ç”¨äº† ClusterAutoscaler ç­‰åŠ¨æ€æ‰©ç¼©å®¹èŠ‚ç‚¹çš„ç»„ä»¶ï¼Œå¼ºçƒˆå»ºè®®è®¾ç½®ä¸ºæ‰€æœ‰æœåŠ¡è®¾ç½® PodDisruptionBudget. åœ¨ PDB ä¸­ä½¿ç”¨ç™¾åˆ†æ¯”çš„æ³¨æ„äº‹é¡¹åœ¨ä½¿ç”¨ç™¾åˆ†æ¯”æ—¶ï¼Œè®¡ç®—å‡ºçš„å®ä¾‹æ•°éƒ½ä¼šè¢«å‘ä¸Šå–æ•´ï¼Œè¿™ä¼šé€ æˆä¸¤ä¸ªç°è±¡ï¼š å¦‚æœä½¿ç”¨ minAvailableï¼Œå®ä¾‹æ•°è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå¯¼è‡´ ALLOWED DISRUPTIONS ä¸º 0ï¼Œæ‰€æœ‰å®ä¾‹éƒ½æ— æ³•è¢«é©±é€äº†ã€‚ å¦‚æœä½¿ç”¨ maxUnavailableï¼Œå› ä¸ºæ˜¯å‘ä¸Šå–æ•´ï¼ŒALLOWED DISRUPTIONS çš„å€¼ä¸€å®šä¸ä¼šä½äº 1ï¼Œè‡³å°‘æœ‰ 1 ä¸ªå®ä¾‹å¯ä»¥è¢«é©±é€ã€‚ å› æ­¤ä»ã€Œä¾¿äºé©±é€ã€çš„è§’åº¦çœ‹ï¼Œå¦‚æœä½ çš„æœåŠ¡è‡³å°‘æœ‰ 2-3 ä¸ªå®ä¾‹ï¼Œå»ºè®®åœ¨ PDB ä¸­ä½¿ç”¨ç™¾åˆ†æ¯”é…ç½®maxUnavailableï¼Œè€Œä¸æ˜¯ minAvailable. ç›¸å¯¹çš„ä»ã€Œç¡®ä¿æœåŠ¡ç¨³å®šæ€§ã€çš„è§’åº¦çœ‹ï¼Œæˆ‘ä»¬åˆ™åº”è¯¥ä½¿ç”¨ minAvailableï¼Œç¡®ä¿è‡³å°‘æœ‰ 1 ä¸ªå®ä¾‹å¯ç”¨ã€‚ ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:4:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ","Cloud-Native"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/#åœ¨-pdb-ä¸­ä½¿ç”¨ç™¾åˆ†æ¯”çš„æ³¨æ„äº‹é¡¹"},{"categories":["tech"],"content":" æœ€ä½³å®è·µ Deployment + HPA + PodDisruptionBudgetä¸€èˆ¬è€Œè¨€ï¼Œä¸€ä¸ªæœåŠ¡çš„æ¯ä¸ªç‰ˆæœ¬ï¼Œéƒ½åº”è¯¥åŒ…å«å¦‚ä¸‹ä¸‰ä¸ªèµ„æºï¼š Deployment: ç®¡ç†æœåŠ¡è‡ªèº«çš„ Pods å˜› HPA: è´Ÿè´£ Pods çš„æ‰©ç¼©å®¹ï¼Œé€šå¸¸ä½¿ç”¨ CPU æŒ‡æ ‡è¿›è¡Œæ‰©ç¼©å®¹ PodDisruptionBudget(PDB): å»ºè®®æŒ‰ç…§ HPA çš„ç›®æ ‡å€¼ï¼Œæ¥è®¾ç½® PDB. æ¯”å¦‚ HPA CPU ç›®æ ‡å€¼ä¸º 60%ï¼Œå°±å¯ä»¥è€ƒè™‘è®¾ç½® PDB minAvailable=65%ï¼Œä¿è¯è‡³å°‘æœ‰ 65% çš„ Pod å¯ç”¨ã€‚è¿™æ ·ç†è®ºä¸Šæé™æƒ…å†µä¸‹ QPS å‡æ‘Šåˆ°å‰©ä¸‹ 65% çš„ Pods ä¸Šä¹Ÿä¸ä¼šé€ æˆé›ªå´©ï¼ˆè¿™é‡Œå‡è®¾ QPS å’Œ CPU æ˜¯å®Œå…¨çš„çº¿æ€§å…³ç³»ï¼‰ ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:4:1","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ","Cloud-Native"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/#æœ€ä½³å®è·µ-deployment--hpa--poddisruptionbudget"},{"categories":["tech"],"content":" å››ã€èŠ‚ç‚¹äº²å’Œæ€§ä¸èŠ‚ç‚¹ç»„æˆ‘ä»¬ä¸€ä¸ªé›†ç¾¤ï¼Œé€šå¸¸ä¼šä½¿ç”¨ä¸åŒçš„æ ‡ç­¾ä¸ºèŠ‚ç‚¹ç»„è¿›è¡Œåˆ†ç±»ï¼Œæ¯”å¦‚ kubernetes è‡ªåŠ¨ç”Ÿæˆçš„ä¸€äº›èŠ‚ç‚¹æ ‡ç­¾ï¼š kubernetes.io/os: é€šå¸¸éƒ½ç”¨ linux kubernetes.io/arch: amd64, arm64 topology.kubernetes.io/region å’Œ topology.kubernetes.io/zone: äº‘æœåŠ¡çš„åŒºåŸŸåŠå¯ç”¨åŒº æˆ‘ä»¬ä½¿ç”¨å¾—æ¯”è¾ƒå¤šçš„ï¼Œæ˜¯ã€ŒèŠ‚ç‚¹äº²å’Œæ€§ã€ä»¥åŠã€ŒPod åäº²å’Œæ€§ã€ï¼Œå¦å¤–ä¸¤ä¸ªç­–ç•¥è§†æƒ…å†µä½¿ç”¨ã€‚ ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:5:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ","Cloud-Native"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/#k8s-affinity"},{"categories":["tech"],"content":" 1. èŠ‚ç‚¹äº²å’Œæ€§å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ awsï¼Œé‚£ aws æœ‰ä¸€äº›è‡ªå®šä¹‰çš„èŠ‚ç‚¹æ ‡ç­¾ï¼š eks.amazonaws.com/nodegroup: aws eks èŠ‚ç‚¹ç»„çš„åç§°ï¼ŒåŒä¸€ä¸ªèŠ‚ç‚¹ç»„ä½¿ç”¨åŒæ ·çš„ aws ec2 å®ä¾‹æ¨¡æ¿ æ¯”å¦‚ arm64 èŠ‚ç‚¹ç»„ã€amd64/x64 èŠ‚ç‚¹ç»„ å†…å­˜æ¯”ä¾‹é«˜çš„èŠ‚ç‚¹ç»„å¦‚ m ç³»å®ä¾‹ï¼Œè®¡ç®—æ€§èƒ½é«˜çš„èŠ‚ç‚¹ç»„å¦‚ c ç³»åˆ— ç«ä»·å®ä¾‹èŠ‚ç‚¹ç»„ï¼šè¿™ä¸ªçœé’±å•Šï¼Œä½†æ˜¯åŠ¨æ€æ€§å¾ˆé«˜ï¼Œéšæ—¶å¯èƒ½è¢«å›æ”¶ æŒ‰é‡ä»˜è´¹èŠ‚ç‚¹ç»„ï¼šè¿™ç±»å®ä¾‹è´µï¼Œä½†æ˜¯ç¨³å®šã€‚ å‡è®¾ä½ å¸Œæœ›ä¼˜å…ˆé€‰æ‹©ç«ä»·å®ä¾‹è·‘ä½ çš„ Podï¼Œå¦‚æœç«ä»·å®ä¾‹æš‚æ—¶è·‘æ»¡äº†ï¼Œå°±é€‰æ‹©æŒ‰é‡ä»˜è´¹å®ä¾‹ã€‚é‚£nodeSelector å°±æ»¡è¶³ä¸äº†ä½ çš„éœ€æ±‚äº†ï¼Œä½ éœ€è¦ä½¿ç”¨ nodeAffinityï¼Œç¤ºä¾‹å¦‚ä¸‹: yaml apiVersion: apps/v1 kind: Deployment metadata: name: xxx namespace: xxx spec: # ... template: # ... spec: affinity: nodeAffinity: # ä¼˜å…ˆé€‰æ‹© spot-group-c çš„èŠ‚ç‚¹ preferredDuringSchedulingIgnoredDuringExecution: - preference: matchExpressions: - key: eks.amazonaws.com/nodegroup operator: In values: - spot-group-c weight: 80 # weight ç”¨äºä¸ºèŠ‚ç‚¹è¯„åˆ†ï¼Œä¼šä¼˜å…ˆé€‰æ‹©è¯„åˆ†æœ€é«˜çš„èŠ‚ç‚¹ - preference: matchExpressions: # ä¼˜å…ˆé€‰æ‹© aws c6i çš„æœºå™¨ - key: node.kubernetes.io/instance-type operator: In values: - \"c6i.xlarge\" - \"c6i.2xlarge\" - \"c6i.4xlarge\" - \"c6i.8xlarge\" weight: 70 - preference: matchExpressions: # å…¶æ¬¡é€‰æ‹© aws c5 çš„æœºå™¨ - key: node.kubernetes.io/instance-type operator: In values: - \"c5.xlarge\" - \"c5.2xlarge\" - \"c5.4xlarge\" - \"c5.9xlarge\" weight: 60 # å¦‚æœæ²¡ spot-group-c å¯ç”¨ï¼Œä¹Ÿå¯é€‰æ‹© ondemand-group-c çš„èŠ‚ç‚¹è·‘ requiredDuringSchedulingIgnoredDuringExecution: nodeSelectorTerms: - matchExpressions: - key: eks.amazonaws.com/nodegroup operator: In values: - spot-group-c - ondemand-group-c containers: # ... ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:5:1","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ","Cloud-Native"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/#1-èŠ‚ç‚¹äº²å’Œæ€§"},{"categories":["tech"],"content":" 2. Pod åäº²å’Œæ€§ Pod äº²å’Œæ€§ä¸åäº²å’Œæ€§å¯èƒ½ä¸æ˜¯æœ€ä½³çš„å®ç°æ‰‹æ®µï¼Œè¿™éƒ¨åˆ†å†…å®¹å¾…æ›´æ–° ç›¸å…³ Issue: https://github.com/kubernetes/kubernetes/issues/72479 ç›¸å…³æ›¿ä»£æ–¹æ¡ˆï¼šhttps://kubernetes.io/docs/concepts/workloads/pods/pod-topology-spread-constraints/ é€šå¸¸å»ºè®®ä¸ºæ¯ä¸ª Deployment çš„ template é…ç½® Pod åäº²å’Œæ€§ï¼ŒæŠŠ Pods æ‰“æ•£åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šï¼š yaml apiVersion: apps/v1 kind: Deployment metadata: name: xxx namespace: xxx spec: # ... template: # ... spec: replicas: 3 affinity: podAntiAffinity: preferredDuringSchedulingIgnoredDuringExecution: # éå¼ºåˆ¶æ€§æ¡ä»¶ - weight: 100 # weight ç”¨äºä¸ºèŠ‚ç‚¹è¯„åˆ†ï¼Œä¼šä¼˜å…ˆé€‰æ‹©è¯„åˆ†æœ€é«˜çš„èŠ‚ç‚¹ podAffinityTerm: labelSelector: matchExpressions: - key: app operator: In values: - xxx - key: version operator: In values: - v12 # å°† pod å°½é‡æ‰“æ•£åœ¨å¤šä¸ªå¯ç”¨åŒº topologyKey: topology.kubernetes.io/zone requiredDuringSchedulingIgnoredDuringExecution: # å¼ºåˆ¶æ€§è¦æ±‚ # æ³¨æ„è¿™ä¸ªæ²¡æœ‰ weightsï¼Œå¿…é¡»æ»¡è¶³åˆ—è¡¨ä¸­çš„æ‰€æœ‰æ¡ä»¶ - labelSelector: matchExpressions: - key: app operator: In values: - xxx - key: version operator: In values: - v12 # Pod å¿…é¡»è¿è¡Œåœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸Š topologyKey: kubernetes.io/hostname ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:5:2","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ","Cloud-Native"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/#2-pod-åäº²å’Œæ€§"},{"categories":["tech"],"content":" äº”ã€Pod çš„å°±ç»ªæ¢é’ˆã€å­˜æ´»æ¢é’ˆä¸å¯åŠ¨æ¢é’ˆPod æä¾›å¦‚ä¸‹ä¸‰ç§æ¢é’ˆï¼Œå‡æ”¯æŒä½¿ç”¨ Commandã€HTTP APIã€TCP Socket è¿™ä¸‰ç§æ‰‹æ®µæ¥è¿›è¡ŒæœåŠ¡å¯ç”¨æ€§æ¢æµ‹ã€‚ startupProbe å¯åŠ¨æ¢é’ˆï¼ˆKubernetes v1.18 [beta]ï¼‰: æ­¤æ¢é’ˆé€šè¿‡åï¼Œã€Œå°±ç»ªæ¢é’ˆã€ä¸ã€Œå­˜æ´»æ¢é’ˆã€æ‰ä¼šè¿›è¡Œå­˜æ´»æ€§ä¸å°±ç»ªæ£€æŸ¥ ç”¨äºå¯¹æ…¢å¯åŠ¨å®¹å™¨è¿›è¡Œå­˜æ´»æ€§æ£€æµ‹ï¼Œé¿å…å®ƒä»¬åœ¨å¯åŠ¨è¿è¡Œä¹‹å‰å°±è¢«æ€æ‰ startupProbe æ˜¾ç„¶æ¯” livenessProbe çš„ initialDelaySeconds å‚æ•°æ›´çµæ´»ã€‚ åŒæ—¶å®ƒä¹Ÿèƒ½å»¶è¿Ÿ readinessProbe çš„ç”Ÿæ•ˆæ—¶é—´ï¼Œè¿™ä¸»è¦æ˜¯ä¸ºäº†é¿å…æ— æ„ä¹‰çš„æ¢æµ‹ã€‚å®¹å™¨éƒ½è¿˜æ²¡ startUpï¼Œæ˜¾ç„¶æ˜¯ä¸å¯èƒ½å°±ç»ªçš„ã€‚ ç¨‹åºå°†æœ€å¤šæœ‰ failureThreshold * periodSeconds çš„æ—¶é—´ç”¨äºå¯åŠ¨ï¼Œæ¯”å¦‚è®¾ç½®failureThreshold=20ã€periodSeconds=5ï¼Œç¨‹åºå¯åŠ¨æ—¶é—´æœ€é•¿å°±ä¸º 100sï¼Œå¦‚æœè¶…è¿‡ 100s ä»ç„¶æœªé€šè¿‡ã€Œå¯åŠ¨æ¢æµ‹ã€ï¼Œå®¹å™¨ä¼šè¢«æ€æ­»ã€‚ readinessProbe å°±ç»ªæ¢é’ˆ: å°±ç»ªæ¢é’ˆå¤±è´¥æ¬¡æ•°è¶…è¿‡ failureThreshold é™åˆ¶ï¼ˆé»˜è®¤ä¸‰æ¬¡ï¼‰ï¼ŒæœåŠ¡å°†è¢«æš‚æ—¶ä» Service çš„ Endpoints ä¸­è¸¢å‡ºï¼Œç›´åˆ°æœåŠ¡å†æ¬¡æ»¡è¶³ successThreshold. livenessProbe å­˜æ´»æ¢é’ˆ: æ£€æµ‹æœåŠ¡æ˜¯å¦å­˜æ´»ï¼Œå®ƒå¯ä»¥æ•æ‰åˆ°æ­»é”ç­‰æƒ…å†µï¼ŒåŠæ—¶æ€æ­»è¿™ç§å®¹å™¨ã€‚ å­˜æ´»æ¢é’ˆå¤±è´¥å¯èƒ½çš„åŸå› ï¼š æœåŠ¡å‘ç”Ÿæ­»é”ï¼Œå¯¹æ‰€æœ‰è¯·æ±‚å‡æ— å“åº” æœåŠ¡çº¿ç¨‹å…¨éƒ¨å¡åœ¨å¯¹å¤–éƒ¨ redis/mysql ç­‰å¤–éƒ¨ä¾èµ–çš„ç­‰å¾…ä¸­ï¼Œå¯¼è‡´è¯·æ±‚æ— å“åº” å­˜æ´»æ¢é’ˆå¤±è´¥æ¬¡æ•°è¶…è¿‡ failureThreshold é™åˆ¶ï¼ˆé»˜è®¤ä¸‰æ¬¡ï¼‰ï¼Œå®¹å™¨å°†è¢«æ€æ­»ï¼Œéšåæ ¹æ®é‡å¯ç­–ç•¥æ‰§è¡Œé‡å¯ã€‚ kubectl describe pod ä¼šæ˜¾ç¤ºé‡å¯åŸå› ä¸ºState.Last State.Reason = Error, Exit Code=137ï¼ŒåŒæ—¶ Events ä¸­ä¼šæœ‰Liveness probe failed: ... è¿™æ ·çš„æè¿°ã€‚ ä¸Šè¿°ä¸‰ç±»æ¢æµ‹å™¨çš„å‚æ•°éƒ½æ˜¯é€šç”¨çš„ï¼Œäº”ä¸ªæ—¶é—´ç›¸å…³çš„å‚æ•°åˆ—ä¸¾å¦‚ä¸‹ï¼š yaml # ä¸‹é¢çš„å€¼å°±æ˜¯ k8s çš„é»˜è®¤å€¼ initialDelaySeconds: 0 # é»˜è®¤æ²¡æœ‰ delay æ—¶é—´ periodSeconds: 10 timeoutSeconds: 1 failureThreshold: 3 successThreshold: 1 ç¤ºä¾‹ï¼š yaml apiVersion: apps/v1 kind: Deployment metadata: name: my-app-v3 spec: # ... template: # ... spec: containers: - name: my-app-v3 image: xxx.com/app/my-app:v3 imagePullPolicy: IfNotPresent # ... çœç•¥è‹¥å¹²é…ç½® startupProbe: httpGet: path: /actuator/health # ç›´æ¥ä½¿ç”¨å¥åº·æ£€æŸ¥æ¥å£å³å¯ port: 8080 periodSeconds: 5 timeoutSeconds: 1 failureThreshold: 20 # æœ€å¤šæä¾›ç»™æœåŠ¡ 5s * 20 çš„å¯åŠ¨æ—¶é—´ successThreshold: 1 livenessProbe: httpGet: path: /actuator/health # spring çš„é€šç”¨å¥åº·æ£€æŸ¥è·¯å¾„ port: 8080 periodSeconds: 5 timeoutSeconds: 1 failureThreshold: 5 successThreshold: 1 # Readiness probes are very important for a RollingUpdate to work properly, readinessProbe: httpGet: path: /actuator/health # ç®€å•èµ·è§å¯ç›´æ¥ä½¿ç”¨ livenessProbe ç›¸åŒçš„æ¥å£ï¼Œå½“ç„¶ä¹Ÿå¯é¢å¤–å®šä¹‰ port: 8080 periodSeconds: 5 timeoutSeconds: 1 failureThreshold: 5 successThreshold: 1 åœ¨ Kubernetes 1.18 ä¹‹å‰ï¼Œé€šç”¨çš„æ‰‹æ®µæ˜¯ä¸ºã€Œå°±ç»ªæ¢é’ˆã€æ·»åŠ è¾ƒé•¿çš„ initialDelaySeconds æ¥å®ç°ç±»ä¼¼ã€Œå¯åŠ¨æ¢é’ˆã€çš„åŠŸèƒ½åŠ¨ï¼Œé¿å…å®¹å™¨å› ä¸ºå¯åŠ¨å¤ªæ…¢ï¼Œå­˜æ´»æ¢é’ˆå¤±è´¥å¯¼è‡´å®¹å™¨è¢«é‡å¯ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š yaml apiVersion: apps/v1 kind: Deployment metadata: name: my-app-v3 spec: # ... template: # ... spec: containers: - name: my-app-v3 image: xxx.com/app/my-app:v3 imagePullPolicy: IfNotPresent # ... çœç•¥è‹¥å¹²é…ç½® livenessProbe: httpGet: path: /actuator/health # spring çš„é€šç”¨å¥åº·æ£€æŸ¥è·¯å¾„ port: 8080 initialDelaySeconds: 120 # å‰ä¸¤åˆ†é’Ÿï¼Œéƒ½å‡è®¾æœåŠ¡å¥åº·ï¼Œé¿å… livenessProbe å¤±è´¥å¯¼è‡´æœåŠ¡é‡å¯ periodSeconds: 5 timeoutSeconds: 1 failureThreshold: 5 successThreshold: 1 # å®¹å™¨ä¸€å¯åŠ¨ï¼ŒReadiness probes å°±ä¼šä¸æ–­è¿›è¡Œæ£€æµ‹ readinessProbe: httpGet: path: /actuator/health port: 8080 initialDelaySeconds: 3 # readiness probe ä¸éœ€è¦è®¾å¤ªé•¿æ—¶é—´ï¼Œä½¿ Pod å°½å¿«åŠ å…¥åˆ° Endpoints. periodSeconds: 5 timeoutSeconds: 1 failureThreshold: 5 successThreshold: 1 ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:6:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ","Cloud-Native"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/#k8s-container-probe"},{"categories":["tech"],"content":" å…­ã€Pod å®‰å…¨è¿™é‡Œåªä»‹ç» Pod ä¸­å®‰å…¨ç›¸å…³çš„å‚æ•°ï¼Œå…¶ä»–è¯¸å¦‚é›†ç¾¤å…¨å±€çš„å®‰å…¨ç­–ç•¥ï¼Œä¸åœ¨è¿™é‡Œè®¨è®ºã€‚ ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:7:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ","Cloud-Native"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/#k8s-pod-security"},{"categories":["tech"],"content":" 1. Pod SecurityContext https://kubernetes.io/docs/tasks/configure-pod-container/security-context/ é€šè¿‡è®¾ç½® Pod çš„ SecurityContextï¼Œå¯ä»¥ä¸ºæ¯ä¸ª Pod è®¾ç½®ç‰¹å®šçš„å®‰å…¨ç­–ç•¥ã€‚ SecurityContext æœ‰ä¸¤ç§ç±»å‹ï¼š spec.securityContext: è¿™æ˜¯ä¸€ä¸ªPodSecurityContext å¯¹è±¡ é¡¾åæ€ä¹‰ï¼Œå®ƒå¯¹ Pod ä¸­çš„æ‰€æœ‰ containers éƒ½æœ‰æ•ˆã€‚ spec.containers[*].securityContext: è¿™æ˜¯ä¸€ä¸ªSecurityContext å¯¹è±¡ container ç§æœ‰çš„ SecurityContext è¿™ä¸¤ä¸ª SecurityContext çš„å‚æ•°åªæœ‰éƒ¨åˆ†é‡å ï¼Œé‡å çš„éƒ¨åˆ† spec.containers[*].securityContext ä¼˜å…ˆçº§æ›´é«˜ã€‚ æˆ‘ä»¬æ¯”è¾ƒå¸¸é‡åˆ°çš„ä¸€äº›æå‡æƒé™çš„å®‰å…¨ç­–ç•¥ï¼š ç‰¹æƒå®¹å™¨ï¼šspec.containers[*].securityContext.privileged æ·»åŠ ï¼ˆCapabilitiesï¼‰å¯é€‰çš„ç³»ç»Ÿçº§èƒ½åŠ›:spec.containers[*].securityContext.capabilities.add åªæœ‰ ntp åŒæ­¥æœåŠ¡ç­‰å°‘æ•°å®¹å™¨ï¼Œå¯ä»¥å¼€å¯è¿™é¡¹åŠŸèƒ½ã€‚è¯·æ³¨æ„è¿™éå¸¸å±é™©ã€‚ Sysctls: ç³»ç»Ÿå‚æ•°: spec.securityContext.sysctls æƒé™é™åˆ¶ç›¸å…³çš„å®‰å…¨ç­–ç•¥æœ‰ï¼ˆå¼ºçƒˆå»ºè®®åœ¨æ‰€æœ‰ Pod ä¸ŠæŒ‰éœ€é…ç½®å¦‚ä¸‹å®‰å…¨ç­–ç•¥ï¼ï¼‰ï¼š spec.volumes: æ‰€æœ‰çš„æ•°æ®å·éƒ½å¯ä»¥è®¾å®šè¯»å†™æƒé™ spec.securityContext.runAsNonRoot: true Pod å¿…é¡»ä»¥é root ç”¨æˆ·è¿è¡Œ spec.containers[*].securityContext.readOnlyRootFileSystem:true å°†å®¹å™¨å±‚è®¾ä¸ºåªè¯»ï¼Œé˜²æ­¢å®¹å™¨æ–‡ä»¶è¢«ç¯¡æ”¹ã€‚ å¦‚æœå¾®æœåŠ¡éœ€è¦è¯»å†™æ–‡ä»¶ï¼Œå»ºè®®é¢å¤–æŒ‚è½½ emptydir ç±»å‹çš„æ•°æ®å·ã€‚ spec.containers[*].securityContext.allowPrivilegeEscalation: false ä¸å…è®¸ Pod åšä»»ä½•æƒé™æå‡ï¼ spec.containers[*].securityContext.capabilities.drop: ç§»é™¤ï¼ˆCapabilitiesï¼‰å¯é€‰çš„ç³»ç»Ÿçº§èƒ½åŠ› è¿˜æœ‰å…¶ä»–è¯¸å¦‚æŒ‡å®šå®¹å™¨çš„è¿è¡Œç”¨æˆ·(user)/ç”¨æˆ·ç»„(group)ç­‰åŠŸèƒ½æœªåˆ—å‡ºï¼Œè¯·è‡ªè¡ŒæŸ¥é˜… Kubernetes ç›¸å…³æ–‡æ¡£ã€‚ ä¸€ä¸ªæ— çŠ¶æ€çš„å¾®æœåŠ¡ Pod é…ç½®ä¸¾ä¾‹ï¼š yaml apiVersion: v1 kind: Pod metadata: name: \u003cPod name\u003e spec: containers: -â€Šname: \u003ccontainer name\u003e image: \u003cimage\u003e imagePullPolicy: IfNotPresent # ......æ­¤å¤„çœç•¥ 500 å­— securityContext: readOnlyRootFilesystem: true # å°†å®¹å™¨å±‚è®¾ä¸ºåªè¯»ï¼Œé˜²æ­¢å®¹å™¨æ–‡ä»¶è¢«ç¯¡æ”¹ã€‚ allowPrivilegeEscalation: false # ç¦æ­¢ Pod åšä»»ä½•æƒé™æå‡ capabilities: drop: # ç¦æ­¢å®¹å™¨ä½¿ç”¨ raw å¥—æ¥å­—ï¼Œé€šå¸¸åªæœ‰ hacker æ‰ä¼šç”¨åˆ° raw å¥—æ¥å­—ã€‚ # raw_socket å¯è‡ªå®šä¹‰ç½‘ç»œå±‚æ•°æ®ï¼Œé¿å¼€ tcp/udp åè®®æ ˆï¼Œç›´æ¥æ“ä½œåº•å±‚çš„ ip/icmp æ•°æ®åŒ…ã€‚å¯å®ç° ip ä¼ªè£…ã€è‡ªå®šä¹‰åè®®ç­‰åŠŸèƒ½ã€‚ # å»æ‰ net_raw ä¼šå¯¼è‡´ tcpdump æ— æ³•ä½¿ç”¨ï¼Œæ— æ³•è¿›è¡Œå®¹å™¨å†…æŠ“åŒ…ã€‚éœ€è¦æŠ“åŒ…æ—¶å¯ä¸´æ—¶å»é™¤è¿™é¡¹é…ç½® - NET_RAW # æ›´å¥½çš„é€‰æ‹©ï¼šç›´æ¥ç¦ç”¨æ‰€æœ‰ capabilities # - ALL securityContext: # runAsUser: 1000 # è®¾å®šç”¨æˆ· # runAsGroup: 1000 # è®¾å®šç”¨æˆ·ç»„ runAsNonRoot: true # Pod å¿…é¡»ä»¥é root ç”¨æˆ·è¿è¡Œ seccompProfile: # security compute mode type: RuntimeDefault ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:7:1","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ","Cloud-Native"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/#1-pod-securitycontext"},{"categories":["tech"],"content":" 2. seccomp: security compute modeseccomp å’Œ seccomp-bpf å…è®¸å¯¹ç³»ç»Ÿè°ƒç”¨è¿›è¡Œè¿‡æ»¤ï¼Œå¯ä»¥é˜²æ­¢ç”¨æˆ·çš„äºŒè¿›åˆ¶æ–‡å¯¹ä¸»æœºæ“ä½œç³»ç»Ÿä»¶æ‰§è¡Œé€šå¸¸æƒ…å†µä¸‹å¹¶ä¸éœ€è¦çš„å±é™©æ“ä½œã€‚å®ƒå’Œ Falco æœ‰äº›ç±»ä¼¼ï¼Œä¸è¿‡ Seccomp æ²¡æœ‰ä¸ºå®¹å™¨æä¾›ç‰¹åˆ«çš„æ”¯æŒã€‚ è§†é¢‘: Seccomp: What Can It Do For You? - Justin Cormack, Docker ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:7:2","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ","Cloud-Native"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/#2-seccomp-security-compute-mode"},{"categories":["tech"],"content":" ä¸ƒã€ä¸šåŠ¡æœåŠ¡çš„æƒé™ç®¡æ§ åŸºäº K8s RBAC ç»™äºˆä¸šåŠ¡æœåŠ¡åˆé€‚çš„äº‘èµ„æºè®¿é—®æƒé™ ç»™æ¯ä¸ªä¸šåŠ¡æœåŠ¡è‡ªåŠ¨åŒ–åœ°åˆ›å»ºå„è‡ªçš„äº‘æœåŠ¡å•† Roleï¼ˆå¦‚ AWS IAM Roleï¼‰ä»¥åŠ Service Accountï¼Œå®ç°ç»†ç²’åº¦çš„æƒé™åˆ†é…ã€‚ æœ‰æ¡ä»¶å¯ä»¥ä¸Š vault ä¹‹ç±»çš„å·¥å…·ï¼Œç®¡ç†æ•°æ®åº“å¯†ç ç­‰æ•æ„Ÿä¿¡æ¯ ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:8:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ","Cloud-Native"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/#ä¸ƒä¸šåŠ¡æœåŠ¡çš„æƒé™ç®¡æ§"},{"categories":["tech"],"content":" å…«ã€éš”ç¦»æ€§è¿™ä¸ªæˆ‘çš„äº†è§£æš‚æ—¶æœ‰é™ï¼Œä¸è¿‡æœ‰å‡ ä¸ªå»ºè®®åº”è¯¥æ˜¯å€¼å¾—å‚è€ƒçš„ï¼š æ¨èæŒ‰ä¸šåŠ¡çº¿æˆ–è€…ä¸šåŠ¡å›¢é˜Ÿè¿›è¡Œåå­—ç©ºé—´åˆ’åˆ†ï¼Œæ–¹ä¾¿å¯¹æ¯ä¸ªä¸šåŠ¡çº¿/ä¸šåŠ¡å›¢é˜Ÿåˆ†åˆ«è¿›è¡Œèµ„æºé™åˆ¶ æ¨èä½¿ç”¨ network policy å¯¹æœåŠ¡å®æ–½å¼ºåŠ›çš„ç½‘ç»œç®¡æ§ï¼Œé¿å…é•¿æœŸå‘å±•è¿‡ç¨‹ä¸­ï¼Œä¸šåŠ¡æœåŠ¡ä¹‹é—´å‡ºç°æ··ä¹±çš„è·¨ä¸šåŠ¡çº¿ç›¸äº’è°ƒç”¨å…³ç³»ï¼Œä¹Ÿé¿å…æœåŠ¡è¢«é»‘åï¼Œå¾€æœªçŸ¥åœ°å€å‘é€æ•°æ®ã€‚ ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:9:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ","Cloud-Native"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/#å…«éš”ç¦»æ€§"},{"categories":["tech"],"content":" å…¶ä»–é—®é¢˜ ä¸åŒèŠ‚ç‚¹ç±»å‹çš„æ€§èƒ½æœ‰å·®è·ï¼Œå¯¼è‡´ QPS å‡è¡¡çš„æƒ…å†µä¸‹ï¼ŒCPU è´Ÿè½½ä¸å‡è¡¡ è§£å†³åŠæ³•ï¼ˆæœªéªŒè¯ï¼‰ï¼š å°½é‡ä½¿ç”¨æ€§èƒ½ç›¸åŒçš„å®ä¾‹ç±»å‹ï¼šé€šè¿‡ podAffinity åŠ nodeAffinity æ·»åŠ èŠ‚ç‚¹ç±»å‹çš„äº²å’Œæ€§ ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:10:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ","Cloud-Native"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/#å…¶ä»–é—®é¢˜"},{"categories":["tech"],"content":" å‚è€ƒ istio å®è·µæŒ‡å— - imroc.cc Kubernetes å®è·µæŒ‡å— - imroc.cc ","date":"2022-01-25","objectID":"/posts/kubernetes-best-practices/:11:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","æœ€ä½³å®è·µ","äº‘åŸç”Ÿ","Cloud-Native"],"title":"Kubernetes å¾®æœåŠ¡æœ€ä½³å®è·µ","uri":"/posts/kubernetes-best-practices/#å‚è€ƒ-1"},{"categories":["life","tech"],"content":" æ›´æ–°ï¼š2022/1/22 ","date":"2022-01-03","objectID":"/posts/2021-summary/:0:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"2021 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2021-summary/#"},{"categories":["life","tech"],"content":" é—²è¨€ç¢è¯­ä¸€æ™ƒä¸€å¹´åˆæ˜¯è¿‡å»äº†ï¼Œè¿™ä¸ªæ–°å¹´ï¼Œå…¨çƒç–«æƒ…å†åˆ›æ–°é«˜ï¼Œåœ£è¯èŠ‚åç¾å›½å•æ—¥æ–°å¢æ›´æ˜¯ç›´æ¥çªç ´ 50 ä¸‡ç›´é€¼ 60 ä¸‡å¤§å…³âŒ 100 ä¸‡âœ…ï¼Œå›½å†…ä¹Ÿæœ‰è¥¿å®‰ç®¡ç†ä¸åŠ›å¯¼è‡´æ°‘ä¼—å¿é¥¥æŒ¨é¥¿ã€‚ æ–°å† å·²ç»ä¸¤å¹´å¤šäº†å•Šã€‚ è¨€å½’æ­£ä¼ ï¼Œæˆ‘ä»Šå¹´å¹´åˆä» W å…¬å¸ç¦»èŒåï¼Œéå¸¸å¹¸è¿åœ°è¿›äº†ç°åœ¨çš„å…¬å¸â€”â€”å¤§å®‡æ— é™ï¼Œåœ¨èå…¥å¤§å®‡çš„è¿‡ç¨‹ä¸­ä¹Ÿæ˜¯äº”å‘³æ‚é™ˆã€‚ä¸è¿‡æ€»ä½“ç»“æœè¿˜æ˜¯æŒºæ»¡æ„çš„ï¼Œç›®å‰å·¥ä½œå·²ç»æ­¥å…¥æ­£è½¨ï¼Œä¹Ÿå‘ç°äº†éå¸¸å¤šçš„æœºä¼šï¼Œå¤§å®‡çš„åŸºç¡€è®¾æ–½é¢†åŸŸä»ç„¶å¤§æœ‰å¯ä¸ºã€‚ ä¸€äº›é‡è¦äº‹æƒ…è¿˜æ˜¯æ²¡æ€ä¹ˆæƒ³é€šï¼Œä¸è¿‡æ¯•ç«Ÿé£å£ä¸Šçš„çŒªéƒ½èƒ½é£ï¼Œä»Šå¹´å°å°åŠªåŠ›äº†ä¸€æŠŠï¼Œå¤§éƒ¨åˆ†æ—¶é—´ä»ç„¶éšæ³¢é€æµï¼Œå´ä¹Ÿæ¸å…¥ä½³å¢ƒã€‚ ","date":"2022-01-03","objectID":"/posts/2021-summary/:1:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"2021 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2021-summary/#é—²è¨€ç¢è¯­"},{"categories":["life","tech"],"content":" ç”Ÿæ´» 1 æœˆçš„æ—¶å€™ä»åšå®¢å›­è¿ç§»åˆ°è¿™ä¸ªç‹¬ç«‹åšå®¢ï¼Œè¿˜è®¤è¯†äº† @èŠå£«ï¼ŒèŠå£«å¸®æˆ‘è°ƒæ•´å¥½äº†åšå®¢ã€Œå‹é“¾ã€é¡µé¢çš„æ ·å¼ï¼Œè¶…çº§æ„Ÿè°¢~ 2 æœˆçš„æ—¶å€™ä» W å…¬å¸ç¦»èŒï¼Œç„¶åæ€ä¹ˆè¯´å‘¢ï¼Œç¬é—´æ„Ÿè§‰æµ·é˜”å¤©ç©ºï¼Œå¿ƒæ€ 180 åº¦è½¬å˜ï¼Œå¥½å¾—ä¸å¾—äº†ï¼Œä½†æ˜¯å…¶å®ä¹Ÿå¾ˆæ‹…å¿ƒè‡ªå·±å„æ–¹é¢çš„ä¸è¶³ã€‚æ€»ä¹‹å¿ƒé‡Œæœ‰å¥½å¤šçš„æƒ³æ³•ï¼Œè·Ÿ@æ˜¯æ ¼å­å•Šã€@èŠå£« ä»¥åŠå‰åŒäº‹èŠäº†å¥½å¤šï¼Œéå¸¸æ„Ÿè°¢è¿™å‡ ä½æœ‹å‹è·ŸåŒäº‹å¸®æˆ‘æ¢³ç†æ€è·¯ï¼Œç»™æˆ‘è‚¯å®šã€‚ä¹Ÿæ˜¯è¿™ä¸ªæ—¶é—´ç‚¹ï¼Œæˆ‘è¢«@èŠå£« æ‹‰è¿›äº†ä¸­æ–‡ twitter çš„åœˆå­ã€‚ è¿‡å¹´å“åº”å·å¬æ²¡å›å®¶ï¼ˆå…¶å®æ˜¯å«Œæ ¸é…¸æ£€æµ‹éº»çƒ¦ï¼Œå®¶é‡Œä¹Ÿå»ºè®®å…ˆåˆ«å›ï¼‰ï¼Œæ¯å¤©çˆ¬çˆ¬å±±çœ‹çœ‹é£æ™¯ï¼Œä¹°äº†ä¸ªåŠåºŠå»å…¬å›­åˆç¡ï¼Œç»ƒä¹ å£ç´ç«¹ç¬›ï¼Œå°±è¿™æ ·ç©äº†ä¸€ä¸ªæœˆã€‚ åˆ°äº† 3 æœˆä»½çš„æ—¶å€™æˆ‘å¼€å§‹æ‰¾å·¥ä½œï¼Œé¢äº†å‡ å®¶å…¬å¸åï¼Œéå¸¸å¹¸è¿åœ°è¿›å…¥äº†å¤§å®‡æ— é™ï¼Œæˆä¸ºäº†ä¸€å SRE èŒæ–°ã€‚åœ¨å¤§å®‡ä¸€å¹´çš„æ„Ÿå—ï¼Œå°±æ”¾åœ¨åé¢çš„ã€Œå·¥ä½œã€éƒ¨åˆ†å†™äº†ï¼Œè¿™é‡Œå…ˆç•¥è¿‡ã€‚ åŠ å…¥å¤§å®‡åï¼Œå…¨å¹´éƒ½æœ‰å®šæœŸçš„å›¢å»ºï¼Œè·Ÿ SRE å°ä¼™ä¼´å…¬æ¬¾åƒå–ï¼Œæˆ‘ 2021 å¹´ä¸‹é¦†å­æ¬¡æ•°ä¼°è®¡æ˜¯ä¸Šä¸€å¹´çš„ä¸ƒå…«å€ 3 æœˆåº•ï¼Œçœ‹äº†ç”µå½±â€”â€”ã€Šå¯»é¾™ä¼ è¯´ã€‹ï¼ˆ2021 å¹´çœ‹çš„å”¯ä¸€ä¸€éƒ¨ç”µå½±ï¼‰ï¼Œç‰‡å°¾æ›²è¶…å¥½å¬ã€‚ 4 æœˆä»½ï¼Œå„ç§å·§åˆä¸‹ï¼Œæ„å¤–å‘ç°åˆä¸­åŒå­¦ä½å¾—ç¦»æˆ‘ 1km ä¸åˆ°ï¼Œåœ¨ä»–å®¶åƒäº†é¡¿å®¶ä¹¡èœï¼Œè¿˜æœ‰æ¨æ¢…é…’ï¼Œ å‘³é“éå¸¸æ£’ï¼è¿˜æœ‰å›ç”˜å¼ºçƒˆçš„åŸæ­¥é’é’±æŸ³èŒ¶ï¼Œè®©æˆ‘å¿µå¿µä¸å¿˜ã€‚ 8 æœˆä»½ï¼Œå ‚å¼Ÿæ¥æ·±åœ³æš‘æœŸå®ä¹ ï¼Œè·Ÿä¸¤ä¸ªå ‚å¼Ÿä¸€èµ·ç©¿è¶Šæ·±åœ³ä¸œè¥¿å†²æµ·å²¸çº¿ï¼Œé£æ™¯éå¸¸æ£’ï¼Œä¸è¿‡è·¯ä¸Šä¹Ÿæ˜¯åˆçƒ­åˆæ¸´ 10 æœˆä»½ åŠ å…¥äº†å¤§å®‡çš„å†²æµªå°åˆ†é˜Ÿï¼Œç¬¬ä¸€æ¬¡å†²æµªã€æµ·è¾¹çƒ§çƒ¤ ä¹°äº†åŒè½®æ»‘é‹ï¼Œå­¦ä¼šäº†å€’æ»‘ã€å‹æ­¥è½¬å‘ï¼Œå¤ä¹ äº†å¤§å­¦æ—¶å­¦è¿‡çš„è‹¥å¹²åŸºç¡€æŠ€å·§ 12 æœˆï¼Œä¹°äº†å°äº‘ç±³æ³‰å…ˆå‡€é¥®æœºåï¼Œæœ‰äº†éšæ—¶éšåœ°çš„çŸ¿ç‰©è´¨çƒ­æ°´ï¼Œå°±æƒ³èµ·äº† 4 æœˆä»½åœ¨åˆä¸­åŒå­¦å®¶å–è¿‡çš„é’é’±æŸ³ï¼Œç„¶åå°±å–èŒ¶ä¸Šç˜¾äº†ï¼Œä¸€æ¡Œå­çš„æ»‡çº¢ã€ç¥é—¨çº¢èŒ¶ã€å®‰å‰ç™½èŒ¶ã€é»„å±±æ¯›å³°ã€é’é’±æŸ³ã€è“èŒ¶ã€æ¢…å­èâ€¦ç›®å‰æ„Ÿè§‰æ»‡çº¢è·Ÿç¥é—¨çº¢èŒ¶æœ€å¥½å–ï¼Œå®‰å‰ç™½èŒ¶è·Ÿé»„å±±æ¯›å³°éƒ½éå¸¸æ¸…é¦™ï¼Œé’é’±æŸ³å›ç”˜æœ€å¼ºçƒˆï¼Œè“èŒ¶æ€ä¹ˆè¯´å‘¢å‘³é“æ„Ÿè§‰ä¸å¤ªå¥½ï¼ˆä¹Ÿå¯èƒ½æ˜¯æ³¡çš„æ‰‹æ³•ä¸å¯¹ï¼Ÿï¼‰ æˆ‘çš„äº‘ç±³å‡€é¥®æœº æ¡Œé¢ä¸Šçš„å„ç§èŒ¶å¶ 2022 å¹´ 1 æœˆï¼Œç¬¬ä¸€æ¬¡ä¹°åŠ¨æ¼«æ‰‹åŠï¼Œå¦†ç‚¹åæ„Ÿè§‰æˆ¿é—´éƒ½å¢è‰²ä¸å°‘~ æˆ‘çš„æˆ¿é—´-æŒ‚ç”»-æ‰‹åŠ ","date":"2022-01-03","objectID":"/posts/2021-summary/:2:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"2021 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2021-summary/#ç”Ÿæ´»"},{"categories":["life","tech"],"content":" è¯»ä¹¦ å¹´åˆè¾èŒåæ¸¸å±±ç©æ°´ï¼Œå¿ƒæ€ç¨å¾®å®‰å®šäº†äº›ï¼Œçœ‹äº†å¤§åŠæœ¬ã€Šèµ°å‡ºè’é‡ã€‹ã€‚ 6 æœˆä»½ç¤¾åŒºç»„ç»‡æ‰“æ–°å† ç–«è‹—æ—¶ï¼Œåœ¨ç­‰å€™å®¤çœ‹äº†æœ¬ã€Šé’æ˜¥é©¿ç«™â€”â€”æ·±åœ³æ‰“å·¥å¦¹å†™çœŸã€‹ï¼Œè®²è¿°å…«ä¹åå¹´ä»£æ‰“å·¥å¦¹çš„ç”Ÿæ´»ã€‚å¾ˆçœŸå®ï¼Œæ„Ÿæƒ…å¾ˆç»†è…»ã€‚ å¹´æœ«äºŒçˆ·çˆ·å»ä¸–ï¼Œå‚åŠ å®Œè‘¬ç¤¼åï¼Œå¿ƒæ€æœ‰äº›å˜åŒ–ï¼Œçœ‹å®Œäº†å¤§ä¸€æ—¶ä¹°ä¸‹çš„ã€Šæœˆå®« Moon Palaceã€‹ï¼Œè®²è¿°ä¸»è§’çš„æ‚²å‰§äººç”Ÿã€‚ å…¶ä½™å¤§éƒ¨åˆ†ä¸šä½™æ—¶é—´ï¼Œæ— èŠï¼Œåˆä¸æƒ³å­¦ç‚¹ä¸œè¥¿ï¼Œä¹Ÿä¸æƒ³è¿åŠ¨ï¼Œäºæ˜¯çœ‹äº†éå¸¸å¤šçš„ç½‘ç»œå°è¯´æ‰“å‘æ—¶é—´ã€‚ ","date":"2022-01-03","objectID":"/posts/2021-summary/:3:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"2021 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2021-summary/#è¯»ä¹¦"},{"categories":["life","tech"],"content":" éŸ³ä¹å¹´åˆè¾èŒåï¼Œç»ƒäº†ä¸€æ®µæ—¶é—´çš„ç«¹ç¬›è·Ÿè“è°ƒå£ç´ï¼Œä½†åæ¥æ‰¾åˆ°å·¥ä½œåå°±åŸºæœ¬æ²‰å¯‚äº†ã€‚ æ€»çš„æ¥è¯´è¿˜æ˜¯åŸåœ°è¸æ­¥å§ã€‚ ","date":"2022-01-03","objectID":"/posts/2021-summary/:4:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"2021 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2021-summary/#éŸ³ä¹"},{"categories":["life","tech"],"content":" å·¥ä½œ - æˆ‘åœ¨å¤§å®‡æ— é™çš„è¿™ä¸€å¹´3 æœˆä»½åˆšè¿›å¤§å®‡çš„æˆ‘å……æ»¡å¥½å¥‡ï¼Œä½†ä¹Ÿå°å¿ƒè°¨æ…ï¼Œç”šè‡³æœ‰ç‚¹ä¸æ•¢ç›¸ä¿¡è‡ªå·±èƒ½è¿›åˆ°ä¸€å®¶è¿™ä¹ˆæ£’çš„å…¬å¸ï¼Œæ„Ÿè§‰è‡ªå·±è¿æ°”çˆ†æ£šã€‚æ¯•ç«Ÿå¤§å®‡æ— è®ºæ˜¯åŒäº‹æ°´å¹³è¿˜æ˜¯å·¥ä½œæ°›å›´ï¼Œäº¦æˆ–æ˜¯ç”¨æˆ·ä½“é‡ï¼Œç›¸æ¯”æˆ‘ä¸Šå®¶å…¬å¸éƒ½æ˜¯è´¨çš„å·®åˆ«ã€‚ æˆ‘åœ¨å¤§å®‡çš„ç¬¬ä¸€ä¸ªå·¥ä½ ä¹‹åæ…¢æ…¢ç†Ÿæ‚‰å·¥ä½œçš„å†…å®¹ä¸æ–¹æ³•ï¼Œleader å°½åŠ›æŠŠæœ€åŒ¹é…æˆ‘å…´è¶£çš„å·¥ä½œå®‰æ’ç»™æˆ‘ï¼Œå¸®æˆ‘æ’ç–‘è§£éš¾ï¼ŒåŒæ—¶åˆç»™æˆ‘æå¤§çš„è‡ªä¸»æ€§ï¼ŒçœŸçš„æ˜¯æ£’æäº†ã€‚ ç„¶è€Œè‡ªä¸»æ€§é«˜å¸¦æ¥çš„ä¹Ÿæ˜¯æ›´é«˜çš„å·¥ä½œéš¾åº¦ï¼Œé‡åˆ°å›°éš¾æ—¶ä¹Ÿæ›¾æ‰‹å¿™è„šä¹±ã€è¿·èŒ«ã€ç”šè‡³è‡ªæˆ‘æ€€ç–‘ï¼Œå¾ˆæ‹…å¿ƒæ˜¯ä¸æ˜¯éš”å¤©å°±å¾—è·‘è·¯äº†â€¦ ä½†å¥½åœ¨æˆ‘ç»ˆç©¶è¿˜æ˜¯èƒ½è°ƒèŠ‚å¥½å¿ƒæ€ï¼Œè´Ÿèµ·è´£ä»»ï¼Œä¸€æ­¥æ­¥æŠŠå·¥ä½œå®Œæˆã€‚ä¸­é—´æœ‰å‡ æ¬¡å·¥ä½œæœ‰å»¶è¯¯æ—¶ï¼Œleader è¿˜é™ªæˆ‘åŠ ç­ï¼Œäº‹æƒ…å¹²å®Œååˆå¸¦æˆ‘å»åƒå¤§é¤çŠ’åŠ³è‡ªå·±ï¼ŒçœŸçš„è¶…çº§æ„Ÿè°¢ä»–çš„å¸®åŠ©ä¸æ”¯æŒã€‚ æ¢åº§ä½åçš„æ–°å·¥ä½ï¼Œè½åœ°çª—é£æ™¯å¾ˆæ£’ è¿™æ ·ç»å†äº†å‡ ä¸ªé¡¹ç›®çš„æ´—ç¤¼åï¼Œç°åœ¨æˆ‘ç»ˆäºèƒ½è¯´è‡ªå·±æ˜¯è„šè¸å®åœ°äº†ï¼Œå¿ƒæ€ä»ã€Œæ˜å¤©æ˜¯ä¸æ˜¯å¾—ææ¡¶è·‘è·¯ã€è½¬å˜æˆäº†ã€Œå“‡è¿˜æœ‰è¿™ä¸ªå¯ä»¥æï¼Œé‚£ä¸ª ROI ä¹Ÿå¾ˆé«˜ï¼Œæœ‰å¥½å¤šæœ‰è¶£çš„äº‹å¯ä»¥åšå•Šã€ï¼Œæˆ‘ç»ˆäºèƒ½è¯´è‡ªå·±çœŸæ­£èå…¥äº†å¤§å®‡æ— é™è¿™å®¶å…¬å¸ï¼Œæˆä¸ºäº†å®ƒçš„ä¸€å‘˜ã€‚ å›çœ‹ä¸‹äº† 2020 å¹´çš„æ€»ç»“ä¸å±•æœ›ï¼Œä»Šå¹´å®é™…çš„è¿›æ­¥ï¼Œè·Ÿå»å¹´æœŸæœ›çš„å·®åˆ«å¾ˆå¤§ã€‚æœ€åˆçš„ç›®æ ‡å¤§æ¦‚åªå®ç°äº† 10%ï¼Œä½†æ˜¯æ¥è§¦åˆ°äº†è®¸å¤šæ„æ–™ä¹‹å¤–çš„ä¸œè¥¿ï¼Œæ€»ä½“è¿˜æ˜¯æ»¡æ„çš„ï¼š ç†Ÿæ‚‰äº†æ–°å…¬å¸çš„æ–‡åŒ–ä¸å·¥ä½œæ–¹å¼ï¼Œè¿™æ„Ÿè§‰æ˜¯ä¸ªå¾ˆå¤§çš„æ”¶è·ï¼Œæˆ‘çš„å·¥ä½œæ–¹å¼æœ‰äº†å¾ˆå¤§çš„æ”¹å–„ æ¥è§¦å¹¶ä¸”ç†Ÿæ‚‰äº†æ–°å…¬å¸çš„ AWS çº¿ä¸Šç¯å¢ƒ è´Ÿè´£ç»´æŠ¤çº¿ä¸Š Kubernetes ç®¡ç†å¹³å°ï¼Œç¬¬ä¸€æ¬¡æ¥è§¦åˆ°çš„çº¿ä¸Šé›†ç¾¤å³°å€¼ QPS å°±æœ‰å¥½å‡ ä¸‡ã€‚ä»ä¸€å¼€å§‹çš„å°å¿ƒç¿¼ç¿¼ï¼Œåˆ°ç°åœ¨ä¹Ÿè½¬å˜æˆäº†è€æ‰‹ï¼Œè¿™ç®—æ˜¯æ„ä¹‰é‡å¤§å§ ä½¿ç”¨ python å†™äº†å‡ ä¸ª Kubernetes ç®¡ç†å¹³å°çš„æœåŠ¡ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ç¬¬ä¸€æ¬¡å†™çº¿ä¸ŠæœåŠ¡ï¼Œå¾ˆæœ‰äº›æˆå°±æ„Ÿ èŠ±äº†æ¯”é¢„æœŸå¤šä¸‰å€çš„æ—¶é—´ï¼Œè¿˜åŠ äº†å¥½å‡ æ¬¡ç­æ‰æŠŠé—®é¢˜è§£å†³ã€‚å› æ­¤å¯¹ leader çš„æ„Ÿå¹å°è±¡æ·±åˆ»ï¼šè™½ç„¶ä½ æ—©å°±å¼ºè°ƒè¿‡ä½ å†™ä»£ç æ¯”è¾ƒæ…¢ï¼Œä½†æ˜¯æ²¡æƒ³åˆ°ä¼šè¿™ä¹ˆæ…¢â€¦ ä¸‹åŠå¹´åœ¨ AWS æˆæœ¬çš„åˆ†æä¸ç®¡æ§ä¸ŠèŠ±äº†å¾ˆå¤šç²¾åŠ›ï¼Œä¹Ÿæœ‰äº†ä¸€äº›ä¸é”™çš„æˆæœï¼Œå—ç›ŠåŒªæµ… å­¦ä¼šäº† Nginx çš„ç®€å•ä½¿ç”¨ï¼Œåˆšå¥½å¤Ÿç”¨äºç»´æŠ¤å…¬å¸å…ˆæœ‰çš„ Nginx ä»£ç†é…ç½® ä¸»å¯¼å®Œæˆäº†ã€Œæ–°å»º K8s é›†ç¾¤ï¼Œå°†æœåŠ¡è¿ç§»åˆ°æ–°é›†ç¾¤ã€ã€‚è™½ç„¶å¹¶ä¸æ˜¯ä¸€ä»¶å¾ˆéš¾çš„äº‹ï¼Œä½†è¿™åº”è¯¥ç®—æ˜¯æˆ‘ 2021 å¹´æœ€å¤§çš„æˆå°±äº†ã€‚ å‡çº§è¿‡ç¨‹ä¸­ä¹Ÿæ˜¯é‡åˆ°äº†å„ç§é—®é¢˜ï¼Œç¬¬ä¸€æ¬¡å‡çº§è¿ç§»æ—¶æˆ‘å‡†å¤‡äº†å¥½ä¹…ï¼Œæ…Œçš„ä¸è¡Œï¼Œç»“æœå‡çº§æ—¶éƒ¨åˆ†æœåŠ¡è¿˜æ˜¯å‡ºäº†é—®é¢˜ï¼Œå½“æ—¶è„‘å­çœŸçš„æ˜¯ä¸ªæ‡µçš„ï¼Œè·Ÿ leader æåˆ°åŠå¤œ 1 ç‚¹å¤šåè¿˜æ˜¯æ²¡è§£å†³ï¼Œå›é€€åˆ°äº†æ—§é›†ç¾¤ï¼Œå‡çº§å¤±è´¥ã€‚ å‡çº§å¤±è´¥åæœ‰ä¸€æ®µæ—¶é—´å¿ƒç°æ„å†·ï¼Œéå¸¸ä¸§æ°”ï¼Œéƒ½ä¸æ•¢é¢å¯¹å„ä½åŒäº‹ï¼Œæ„Ÿè§‰è¿™äº‹æƒ…æˆ‘æ˜¯æä¸å®šè¦ææ¡¶è·‘è·¯äº†ã€‚ä¸è¿‡åé¢è¿˜æ˜¯è°ƒæ•´å¥½äº†å¿ƒæƒ…ï¼Œæ¯•ç«Ÿäº‹æƒ…åˆ°æ‰‹ä¸Šäº†è‚¯å®šè¿˜æ˜¯è¦åšã€‚ ä¹‹åé€šè¿‡å„ç§æµ‹è¯•åˆ†æï¼Œç¡®è®¤åˆ°æ˜¯æŸä¸ªæœåŠ¡æ‰©ç¼©å®¹éœ‡è¡å¯¼è‡´å¯ç”¨ç‡æ— æ³•æ¢å¤ï¼Œå°è¯•é€šè¿‡ HPA çš„ behavior æ¥æ§åˆ¶æ‰©ç¼©å®¹é€Ÿç‡ï¼Œåˆæ„å¤–è§¦å‘äº† K8s HPA çš„ bug æŠŠé›†ç¾¤æ§åˆ¶é¢æå´©äº†â€¦ å†ä¹‹åæŠŠé—®é¢˜éƒ½ç¡®è®¤äº†ï¼Œç¬¬äºŒæ¬¡å°è¯•å‡çº§ï¼Œåˆæ˜¯æœ‰ä¸ªåˆ«æœåŠ¡å¯ç”¨ç‡æŠ–åŠ¨ï¼Œè°ƒè¯•äº†å¥½å‡ å¤©ã€‚é‚£å‡ å¤©ç¥ç»ä¸€ç›´ç´§ç»·ï¼Œæ¯å¤©æ—©ä¸Šéƒ½æ˜¯è¢«æœåŠ¡å¯ç”¨ç‡çš„å‘Šè­¦åµé†’çš„ã€‚ è·¨å¹´çš„é‚£å¤©æ™šä¸Šä¸šåŠ¡é‡ä¸Šæ¶¨ï¼Œä¸šåŠ¡ä¾§æŒ‡æ ‡åˆå¼€å§‹æŠ–åŠ¨ï¼Œä¸šåŠ¡ä¾§çš„åŒäº‹é¢†å¯¼å‹åŠ›ä¹Ÿå¾ˆå¤§ï¼Œå»ºè®®æˆ‘æŠŠæœåŠ¡å›æ»šåˆ°æ—§é›†ç¾¤ã€‚æˆ‘è·Ÿä¸šåŠ¡åŒäº‹è¯´å†è¯•ä¸€æ¬¡å‚æ•°è°ƒæ•´ï¼ˆæ”¹ HPA çš„ behavior å‚æ•°é™åˆ¶æ‰©ç¼©å®¹é€Ÿç‡ï¼‰ï¼Œæ”¹å®Œè¿™ä¸ªå‚æ•°å¦‚æœè¿˜æœ‰é—®é¢˜ï¼Œæˆ‘å°±ç«‹å³å›æ»šã€‚ç„¶åæˆ‘å°±åœ¨è§‚å¯ŸæœåŠ¡å¯ç”¨ç‡çš„è¿‡ç¨‹ä¸­è·¨å¹´äº†ï¼Œ å¯ç”¨ç‡çš„æ¯ä¸€æ¬¡æ³¢åŠ¨éƒ½è®©æˆ‘æå¿ƒåŠèƒ†ï¼Œä¸è¿‡ç»ˆäºè¿˜æ˜¯åŸºæœ¬ç¨³å®šäº†ã€‚è¿™æ ·æ‰ç»ˆäºå®Œæˆäº† K8s é›†ç¾¤çš„å‡çº§ï¼ŒæœŸé—´å„ä½åŒäº‹ä¹Ÿæœ‰å‚ä¸å¸®å¿™åˆ†ææ’æŸ¥å„ç§é—®é¢˜ï¼Œé¢†å¯¼è·Ÿä¸šåŠ¡ä¾§åŒäº‹ä¹Ÿè¶³å¤Ÿä¿¡ä»»æˆ‘ï¼ˆä¸šåŠ¡ä¾§ä¹Ÿè·Ÿæˆ‘ä¸€æ ·å¿å—äº†å¥½å¤šå¤©çš„è¿ç»­å‘Šè­¦ï¼‰ï¼Œéå¸¸æ„Ÿè°¢ä»–ä»¬ï¼Œè¿˜æœ‰åŠªåŠ›çš„æˆ‘è‡ªå·±ã€‚ éšä¾¿å†™äº†å‡ ä¸ª go çš„ demoï¼ŒåŸºæœ¬æ²¡å•¥è¿›æ­¥ å­¦äº†ä¸€ä¸ªæ˜ŸæœŸçš„ rust è¯­è¨€ï¼Œå¿«é€Ÿçœ‹å®Œäº† the bookï¼Œç”¨ rust é‡å†™äº†ä¸ª video2chars å­¦ä¹ äº† Linux å®¹å™¨çš„åº•å±‚åŸç†ï¼šcgroups/namespace æŠ€æœ¯ï¼Œå¹¶ä¸”ç”¨ go/rust å®ç°äº†ä¸ª demo å­¦ä¹ äº† Linux çš„å„ç§ç½‘ç»œæ¥å£ã€Iptables ç†Ÿæ‚‰äº† PromQL/Grafanaï¼Œç°åœ¨ä¹Ÿèƒ½æ‹·è´äº› PromQL æŸ¥å„ç§æ•°æ®äº† å¦‚æœè¦ç»™è‡ªå·±æ‰“åˆ†çš„è¯ï¼Œé‚£å°±æ˜¯ã€Œè‰¯å¥½ã€å§ã€‚å› ä¸ºå¹¶æ²¡æœ‰å¾ˆå¼ºçš„è¿›å–å¿ƒï¼Œæ‰€ä»¥å‡ºæ¥çš„ç»“æœä¹Ÿå¹¶ä¸èƒ½ç§°ä¹‹ä¸ºã€Œä¼˜ç§€ã€ã€‚ é¡ºä¾¿å…¬å¸çš„æ–°åŠå…¬åŒºçœŸçš„è¶…èµï¼Œè¯¦æƒ…è§æˆ‘çš„ twitterï¼š æ–°åŠå…¬åŒºçœŸå¥½å‘ï½ å€¼æ­¤è‰¯è¾°ç¾æ™¯ï¼Œå¥½æƒ³æ•´ä¸ªæ¦»æ¦»ç±³åå«ï¼Œååœ¨è§’è½çš„è½åœ°çª—è¾¹å·¥ä½œğŸ¤£ é‚£ç§ä½¿ç”¨å…¬å…±è®¾æ–½å·¥ï¼ˆmoï¼‰ä½œï¼ˆyuï¼‰çš„ä¹è¶£ï¼Œä»¥åŠå¹³å¸¸å·¥ä½è§ä¸åˆ°çš„æ™¯è‰²äº¤ç›¸è¾‰æ˜ ï¼Œæ˜¯ä¸å¤ªå¥½è¡¨è¿°çš„å¥‡å¦™ä½“éªŒ pic.twitter.com/FASffzw8N3 â€” ryan4yin | æ–¼æ¸…æ¨‚ (@ryan4yin) January 17, 2022 ","date":"2022-01-03","objectID":"/posts/2021-summary/:5:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"2021 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2021-summary/#å·¥ä½œ---æˆ‘åœ¨å¤§å®‡æ— é™çš„è¿™ä¸€å¹´"},{"categories":["life","tech"],"content":" æŠ€æœ¯æ–¹é¢çš„æ„Ÿå— Istio æœåŠ¡ç½‘æ ¼ï¼šä½“ä¼šåˆ°äº†å®ƒæœ‰ç‚¹é‡ï¼Œè€Œä¸”å®ƒçš„å‘å±•è·Ÿæˆ‘ä»¬çš„éœ€æ±‚ä¸ä¸€å®šåŒ¹é… Sidecar æ¨¡å¼çš„æˆæœ¬æ¯”è¾ƒé«˜ï¼Œåœ¨æœªè°ƒä¼˜çš„æƒ…å†µä¸‹ï¼Œå®ƒä¼šç»™æœåŠ¡å¸¦æ¥ 1/3 åˆ° 1/4 çš„æˆæœ¬æå‡ï¼Œä»¥åŠå»¶è¿Ÿä¸Šå‡ æ¯”å¦‚åˆ‡é‡æƒé‡å›ºå®šä¸º 100ï¼ˆæ–°ç‰ˆæœ¬å°†ä¼šæ”¾å®½é™åˆ¶ï¼‰ï¼Œä¸æ”¯æŒ pod çš„ warm upï¼ˆç¤¾åŒºå·²ç»æœ‰ PRï¼ŒæŒç»­è§‚æœ›å§ï¼‰ è€Œå®ƒé‡ç‚¹å‘å±•çš„è™šæ‹Ÿæœºæ”¯æŒæˆ‘ä»¬å´å®Œå…¨ä¸éœ€è¦ ä¸€ç›´åœ¨æ€è€ƒæ˜¯æŒç»­å¾€ Istio æŠ•å…¥ï¼Œè¿˜æ˜¯æ¢å…¶ä»–çš„æ–¹æ¡ˆ æœåŠ¡ç½‘æ ¼ä»ç„¶åœ¨å¿«é€Ÿå‘å±•ï¼Œæœªæ¥çš„è¶‹åŠ¿åº”è¯¥æ˜¯ eBPF + Envoy + WASM Cilium æ¨å‡ºçš„åŸºäº eBPF çš„ Service Mesh æ˜¯ä¸€ä¸ªæ–°è¶‹åŠ¿ï¼ˆå®ƒä½¿ç”¨é«˜çº§ç‰¹æ€§æ—¶ä¼šé€€åŒ–æˆ Per Node Proxy æ¨¡å¼ï¼‰ï¼Œæˆæœ¬ã€å»¶è¿Ÿæ–¹é¢éƒ½æœ‰æœ›åŠæ‰“ Sidecar æ¨¡å¼çš„å…¶ä»–æœåŠ¡ç½‘æ ¼ï¼Œæ˜¯ä»Šå¹´æœåŠ¡ç½‘æ ¼é¢†åŸŸçš„å¤§æ–°é—»ã€‚ æˆ‘ä»¬æ›¾å°è¯•ä½¿ç”¨ä¸­å¿ƒåŒ–ç½‘å…³æ¥æ›¿ä»£ Sidecar ä»¥é™ä½æˆæœ¬ã€‚ä½†æ˜¯è·¨åŒºæµé‡æˆæœ¬ã€HTTP/gRPC å¤šåè®®å…±å­˜ï¼Œè¿™äº›éƒ½æ˜¯æŒ‘æˆ˜ã€‚è€Œä¸”è¿™ä¹Ÿå¹¶ä¸æ˜¯ç¤¾åŒºçš„æœ€ä½³å®è·µï¼Œç°åœ¨æˆ‘è§‰å¾—ç»´æŒ Sidecar å…¶å®åè€Œèƒ½æå‡èµ„æºåˆ©ç”¨ç‡ï¼Œæˆ‘ä»¬çš„é›†ç¾¤èµ„æºåˆ©ç”¨ç‡ç›®å‰å¾ˆä½ã€‚å¦‚æœèƒ½æŠŠæ§å¥½ï¼Œè¿™éƒ¨åˆ†æˆæœ¬æˆ–è®¸æ˜¯å¯ä»¥æ¥å—çš„ã€‚ K8s é›†ç¾¤çš„æ—¥å¿—æ–¹é¢ï¼Œæˆ‘ä»¬ç›®å‰æ˜¯ä½¿ç”¨è‡ªç ”çš„åŸºäº gelf åè®®çš„ç³»ç»Ÿï¼Œä½†æ˜¯é—®é¢˜æŒºå¤šçš„ ä»æå‡ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€æ˜“ç”¨æ€§ç­‰è§’åº¦æ¥è¯´ï¼Œloki æ˜¯å€¼å¾—æ¢ç´¢ä¸‹çš„ K8s é›†ç¾¤ç®¡ç†æ–¹é¢ï¼Œè§‰å¾—é›†ç¾¤çš„å‡çº§è¿­ä»£ï¼Œå¯ä»¥åšå¾—æ›´è‡ªåŠ¨åŒ–ã€æ›´å¯é ã€‚æ˜å¹´å¯ä»¥åœ¨å¤šé›†ç¾¤ç®¡ç†è¿™ä¸ªæ–¹å‘ä¸Šå¤šæ¢ç´¢ä¸‹ã€‚ Pod æœåŠ¡è´¨é‡ï¼š å¯¹éæ ¸å¿ƒæœåŠ¡ï¼Œå¯ä»¥é€‚å½“è°ƒä½ requests çš„èµ„æºé‡ï¼Œè€Œä¸æ˜¯å®Œå…¨é¢„ç•™(Guaranteed)ï¼Œä»¥æå‡èµ„æºåˆ©ç”¨ç‡ã€‚ å®˜æ–¹çš„ HPA èƒ½åŠ›æ˜¯ä¸å¤Ÿç”¨çš„ï¼Œä¸šåŠ¡ä¾§å¯èƒ½ä¼šéœ€è¦åŸºäº QPS/Queue æˆ–è€…ä¸šåŠ¡ä¾§çš„å…¶ä»–å‚æ•°æ¥è¿›è¡Œæ‰©ç¼©å®¹ æ¨å¹¿åŸºäº KEDA çš„æ‰©ç¼©å®¹èƒ½åŠ› å…³æ³¨Container resource metrics çš„è¿›å±• æˆæœ¬æ§åˆ¶æ–¹é¢ï¼Œä½“ä¼šåˆ°äº† ARM æ¶æ„ä»¥åŠ Spot ç«ä»·å®ä¾‹çš„å¥½å¤„ 2022-02-17 æ›´æ–°ï¼šæ•°æ®åº“ç­‰ä¸­é—´ä»¶å¯ä»¥åˆ‡æ¢åˆ° ARMã€‚EKS æœåŠ¡ç›®å‰éƒ½æ˜¯ Spot å®ä¾‹ï¼Œå®ƒçš„ ARM åŒ– ROI å¹¶ä¸é«˜ã€‚ è·¨åŒºæµé‡æˆæœ¬æœ‰å¾ˆå¤§çš„æ½œåœ¨ä¼˜åŒ–ç©ºé—´ è·¨åŒºæµé‡æˆæœ¬æ˜¯è¿›å‡ºè¯¥å¯ç”¨åŒºéƒ½ä¼šæ”¶è´¹ï¼Œè€Œä¸”ä¸ä»…æ¶‰åŠ Kubernetes é›†ç¾¤å†…æœåŠ¡é—´çš„è°ƒç”¨ï¼Œè¿˜ä¼šæ¶‰åŠå¯¹ RDS/ES/ElastiCache/EC2 ç­‰å…¶ä»–èµ„æºçš„è°ƒç”¨ã€‚ ä»Šå¹´å„äº‘å‚å•†æ•…éšœé¢‘å‘ï¼Œæ²¡æœ‰è·¨ region çš„æœåŠ¡è¿ç§»å°±ä¼šå¾ˆéš¾å—ï¼Œéœ€è¦æŒç»­å…³æ³¨ä¸‹karmada è¿™ç±»å¤šé›†ç¾¤ç®¡ç†æ–¹æ¡ˆã€‚ Google è´¦å·ç³»ç»Ÿå®•æœº Fastly CDN æ•…éšœ Facebook æ•…éšœ AWS æ›´æ˜¯å„ç§å¯ç”¨åŒºæ•…éšœï¼Œ12/7 çš„æ•…éšœå¯¼è‡´ AWS å¤§éƒ¨åˆ†æœåŠ¡éƒ½å´©äº†ã€‚å› æ­¤æˆ‘ä»¬ SRE ä»Šå¹´ç»å¸¸æ˜¯æ•‘å„ç§å¤§ç«å°ç«â€¦ Rust/Go/WASM è“¬å‹ƒå‘å±•ï¼Œæœªæ¥å¯æœŸã€‚ AI è½åœ°åˆ°å„ä¸ªé¢†åŸŸï¼Œå½±å“åˆ°äº†æˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨çš„è¯­éŸ³å¯¼èˆªã€æ­Œå£°åˆæˆã€è¯­éŸ³åˆæˆç­‰å¤šä¸ªé¢†åŸŸï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬ä¸ SRE å·¥ä½œç›¸å…³çš„åœºæ™¯ï¼šAIOps ","date":"2022-01-03","objectID":"/posts/2021-summary/:6:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"2021 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2021-summary/#æŠ€æœ¯æ–¹é¢çš„æ„Ÿå—"},{"categories":["life","tech"],"content":" 2022 å¹´çš„å±•æœ›","date":"2022-01-03","objectID":"/posts/2021-summary/:7:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"2021 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2021-summary/#2022-å¹´çš„å±•æœ›"},{"categories":["life","tech"],"content":" æŠ€æœ¯ä¾§ä»Šå¹´çš„å±•æœ›å†™å¾—æ›´èšç„¦ä¸€äº›ï¼Œäº‰å–èƒ½å®ç° 50%ï¼Œå°±æ˜¯å¾ˆå¤§çš„çªç ´äº†ã€‚ é‡ç‚¹ä»ç„¶æ˜¯ç½‘ç»œæŠ€æœ¯ä¸ Kubernetes æŠ€æœ¯ï¼ŒRedis/Search/Database ç­‰æŠ€æœ¯è¿˜å¾—é åæ’ï¼Œæˆ–è®¸æ˜å¹´å§å“ˆå“ˆã€‚ ç†Ÿç»ƒæŒæ¡ Go è¯­è¨€ï¼Œå¹¶åˆ†åˆ«ç”¨äºè‡³å°‘ä¸¤ä¸ªé¡¹ç›®ä¸­ æ‰“é“è¿˜éœ€è‡ªèº«ç¡¬ï¼Œç¼–ç èƒ½åŠ›æ˜¯åŸºç¡€ä¸­çš„åŸºç¡€ Kubernetes ç›¸å…³ ä»¥ kubebuilder ä¸ºä»£è¡¨çš„ k8s å¼€å‘ã€æ‹“å±•æŠ€æœ¯ é˜…è¯» k8s åŠç›¸å…³ç”Ÿæ€çš„æºç ï¼Œäº†è§£å…¶å®ç°é€»è¾‘ ç½‘ç»œæŠ€æœ¯ æœåŠ¡ç½‘æ ¼ Istio ä»£ç†å·¥å…· Envoy/APISIX ç½‘ç»œæ’ä»¶ Cilium + eBPF AWS K8s æˆæœ¬ä¸æœåŠ¡ç¨³å®šæ€§ä¼˜åŒ– é€šè¿‡æ‹“æ‰‘æ„ŸçŸ¥çš„è¯·æ±‚è½¬å‘ï¼ŒèŠ‚çº¦è·¨å¯ç”¨åŒº/è·¨åŸŸçš„æµé‡æˆæœ¬ K8s æ–°ç‰¹æ€§ï¼šTopology Aware Hints Istio:Locality Load Balancing æ¨å¹¿ gRPC åè®® é€šè¿‡äº²å’Œæ€§ä¸åäº²å’Œæ€§ +deschedulerï¼Œå®ç°åˆç†è°ƒåº¦ Pods å‡å°‘è·¨åŸŸæµé‡ã€ä¹Ÿæå‡æœåŠ¡å®¹ç¾èƒ½åŠ› æå‡æœ¬åœ°å¼€å‘æ•ˆç‡ï¼š nocalhost å¤šé›†ç¾¤çš„åº”ç”¨éƒ¨ç½²ã€å®¹ç¾ karmada æ¢ç´¢æ–°æŠ€æœ¯ä¸å¯èƒ½æ€§ï¼ˆä¼˜å…ˆçº§ä½ï¼‰ åŸºäº Kubernetes çš„æœåŠ¡å¹³å°ï¼Œæœªæ¥çš„å‘å±•æ–¹å‘ kubevela buildpack æ˜¯å¦åº”è¯¥æ¨è¿› gitops openkruise Serverless å¹³å°çš„è¿›å±• Knative OpenFunction æœºå™¨å­¦ä¹ ã€æ·±åº¦å­¦ä¹ æŠ€æœ¯ï¼šæƒ³å°è¯•ä¸‹å°† AI åº”ç”¨åœ¨éŸ³ä¹ã€è¯­éŸ³ã€SRE ç­‰æˆ‘æ„Ÿå…´è¶£çš„é¢†åŸŸï¼Œå³ä½¿æ˜¯è°ƒåŒ…ä¹Ÿè¡Œå•Šï¼Œæ€»ä¹‹æƒ³å‡ºç‚¹æˆæœâ€¦ å¯ä»¥é¢„æ–™åˆ°æ˜å¹´ SRE å›¢é˜Ÿæœ‰è¶…å¤šçš„æœºä¼šï¼Œè¿™å…¶ä¸­æˆ‘å…·ä½“èƒ½è´Ÿè´£å“ªäº›éƒ¨åˆ†ï¼Œåˆèƒ½åšå‡ºæ€æ ·çš„æˆæœï¼ŒçœŸçš„ç›¸å½“æœŸå¾…~ ","date":"2022-01-03","objectID":"/posts/2021-summary/:7:1","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"2021 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2021-summary/#æŠ€æœ¯ä¾§"},{"categories":["life","tech"],"content":" ç”Ÿæ´»ä¾§ è¿åŠ¨ï¼š æŠŠè½®æ»‘ç»ƒå¥½ï¼Œå­¦ä¼šç‚¹èŠ±æ ·å§ï¼Œæ¯ä¸ªæœˆè‡³å°‘ä¸¤æ¬¡ã€‚ è¿›è¡Œä¸‰æ¬¡ä»¥ä¸Šçš„æ¬¡çŸ­é€”æ—…è¡Œï¼Œä¸œè¥¿å†²ç©¿è¶Šå¯ä»¥å†æ¥ä¸€æ¬¡ã€‚ éŸ³ä¹ï¼š å†ä¸€æ¬¡å­¦ä¹ ä¹ç†â€¦ midi é”®ç›˜ä¹°äº†ä¸€ç›´åƒç°ï¼Œå¤šå¤šç»ƒä¹ å§ ä¹°äº†ä¸ª Synthesizer V Stduio Pro + ã€Œé’æº¯ AIã€ï¼Œæ–°çš„ä¸€å¹´æƒ³å­¦ä¸‹è°ƒæ•™ï¼Œç¿»å”±äº›è‡ªå·±å–œæ¬¢çš„æ­Œã€‚ é˜…è¯»ï¼šæ¸…å•å¦‚ä¸‹ï¼Œä¸€ä¸ªæœˆè‡³å°‘è¯»å®Œå…¶ä¸­ä¸€æœ¬ã€‚ æ–‡å­¦ç±»ï¼š ã€Šäººé—´å¤±æ ¼ã€‹ï¼šä¹…ä»°å¤§åçš„ä¸€æœ¬ä¹¦ï¼Œæ›¾ç»æœ‰åŒå­¦åŠ›èï¼Œä½†æ˜¯ä¸€ç›´æ²¡çœ‹ã€‚ ã€Šç”Ÿå‘½æœ€åçš„è¯»ä¹¦ä¼šã€‹ï¼šæˆ–è®¸æ›¾ç»çœ‹è¿‡ï¼Œä½†æ˜¯ä¸€ç‚¹å°è±¡éƒ½æ²¡äº† ã€Šç™¾å¹´å­¤ç‹¬ã€‹ï¼šé«˜ä¸­çš„æ—¶å€™è¯»è¿‡ä¸€éï¼Œä½†æ˜¯éƒ½å¿˜å·®ä¸å¤šäº† ã€Šéœä¹±æ—¶æœŸçš„çˆ±æƒ…ã€‹ ã€Šè‹è²çš„ä¸–ç•Œã€‹ï¼šæ®è¯´æ˜¯å“²å­¦å¯è’™è¯»ç‰©ï¼Œæ›¾ç»çœ‹è¿‡ï¼Œä½†æ˜¯å¯¹å†…å®¹å®Œå…¨æ²¡å°è±¡äº†ã€‚ ã€Šä½ ä¸€ç”Ÿçš„æ•…äº‹ã€‹ï¼šæˆ‘ä¹Ÿæ›¾æ˜¯ä¸ªç§‘å¹»è¿· ã€Šæ²ˆä»æ–‡çš„ååŠç”Ÿã€‹ ã€Šæˆ‘ä¸åœ°å›ã€‹ ã€Šå°†é¥®èŒ¶ã€‹ ã€Šå¾å›½ä¸å¾æ°‘ - æ—è¯­å ‚ã€‹ ã€Šæˆ¿æ€çªçš„åˆæ‹ä¹å›­ã€‹ äººæ–‡ç¤¾ç§‘ ã€Šåœ¨ç”Ÿå‘½çš„å°½å¤´æ‹¥æŠ±ä½ -ä¸´ç»ˆå…³æ€€åŒ»ç”Ÿæ‰‹è®°ã€‹ï¼šä»Šå¹´æƒ³æ›´å¤šåœ°äº†è§£ä¸‹ã€Œæ­»äº¡ã€ ã€Šæ€æ ·å¾æœç¾ä¸½å°‘å¥³ã€‹ï¼šå“ˆå“ˆ ã€Šçˆ±çš„è‰ºæœ¯ã€‹ ã€Šç¤¾ä¼šå¿ƒç†å­¦ã€‹ ã€Šè¢«è®¨åŒçš„å‹‡æ°”ã€‹ ã€Šäººä½“ç®€å²ã€‹ ã€Šç§‘å­¦é©å‘½çš„ç»“æ„ã€‹ ã€Šé‚“å°å¹³æ—¶ä»£ã€‹ ã€Šè®ºä¸­å›½ã€‹ ã€Šåˆ˜æ“è¥¿æ–¹ç°ä»£æ€æƒ³è®²ä¹‰ã€‹ ã€Šæ—¶é—´çš„ç§©åºã€‹ ã€Šæç®€å®‡å®™å²ã€‹ ã€Šåœ†åœˆæ­£ä¹‰-ä½œä¸ºè‡ªç”±å‰æçš„ä¿¡å¿µã€‹ ã€Šäººç”Ÿè„šæœ¬ã€‹ æŠ€æœ¯ç±» ã€Šå¤æ‚ã€‹ ã€ŠSRE - Google è¿ç»´è§£å¯†ã€‹ ã€Šå‡¤å‡°é¡¹ç›®ï¼šä¸€ä¸ª IT è¿ç»´çš„ä¼ å¥‡æ•…äº‹ã€‹ ã€Šäººæœˆç¥è¯ã€‹ ã€Šç»©æ•ˆä½¿èƒ½ï¼šè¶…è¶Š OKRã€‹ ã€Šå¥ˆé£æ–‡åŒ–æ‰‹å†Œã€‹ ã€Šå¹•åäº§å“-æ‰“é€ çªç ´å¼æ€ç»´ã€‹ ã€Šæ·±å…¥ Linux å†…æ ¸æ¶æ„ã€‹ ã€ŠLinux/UNIX ç³»ç»Ÿç¼–ç¨‹æ‰‹å†Œã€‹ ã€Šé‡æ„ - æ”¹å–„æ—¢æœ‰ä»£ç çš„è®¾è®¡ã€‹ ã€Šç½‘ç»œæ˜¯æ€æ ·è¿æ¥çš„ã€‹ï¼šæ›¾ç»å­¦ä¹ è¿‡ã€Šè®¡ç®—æœºç½‘ç»œï¼šè‡ªé¡¶å‘ä¸‹æ–¹æ³•ã€‹ï¼Œä¸è¿‡åªå­¦åˆ°ç½‘ç»œå±‚ã€‚å°±ä»è¿™æœ¬ä¹¦å¼€å§‹é‡æ–°å­¦ä¹ å§ã€‚ ","date":"2022-01-03","objectID":"/posts/2021-summary/:7:2","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"2021 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2021-summary/#ç”Ÿæ´»ä¾§"},{"categories":["life","tech"],"content":" ç»“è¯­2021 å¹´åˆæœ‹å‹ä¸æˆ‘ç»™è‡ªå·±çš„æœŸè®¸æ˜¯ã€Œæ‹†ç ´ç‰ç¬¼é£å½©å‡¤ï¼Œé¡¿å¼€é‡‘é”èµ°è›Ÿé¾™ã€ï¼Œæ„Ÿè§‰ç¡®å®åº”éªŒäº†ã€‚ ä»Šå¹´æˆ‘å¸Œæœ›ä¸è®ºæ˜¯åœ¨ç”Ÿæ´»ä¸Šè¿˜æ˜¯åœ¨å·¥ä½œä¸Šï¼Œéƒ½èƒ½ã€Œæ›´ä¸Šä¸€å±‚æ¥¼ã€~ æ›´å¤šæœ‰è¶£çš„ã€æœ‰æ·±åº¦çš„ 2021 å¹´åº¦æ€»ç»“ï¼šhttps://github.com/saveweb/review-2021 ","date":"2022-01-03","objectID":"/posts/2021-summary/:8:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"2021 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2021-summary/#ç»“è¯­"},{"categories":["life"],"content":"å¤§é›ªï¼Œæ²™é›ªã€‚ åˆ°æ™´å²šæ¡¥ç­‰é€è‘¬é˜Ÿä¼æ—¶ï¼Œéå¸¸å†·ã€‚ è½¬å¤´ä¸€æœ›ï¼Œå‘ç°é€è‘¬çš„å‡ ä½å¸ˆå‚…åœ¨æ¸ æ¸¡åº™é—¨å£å°±åœ°å–æç”Ÿèµ·äº†ç«å †å–æš–ã€‚è¿™æ ·å¯’å†·çš„å¤©æ°”ä¸‹ï¼Œå¾ˆæœ‰ç§æƒŠå–œçš„æ„Ÿè§‰ã€‚ é€è‘¬è·¯ä¸Šåˆæ˜¯é£åˆæ˜¯é›ªï¼Œåƒæ˜¯è€å¤©ä¹Ÿåœ¨å“€ä¼¤ã€‚è¾‰è¾‰è¯´è¿™è¿˜æ˜¯ä»–ç¬¬ä¸€æ¬¡åœ¨é£é›ªå¤©é‡Œé€è‘¬ï¼Œæˆ‘ä¹Ÿæœ‰åŒæ„Ÿã€‚åˆ°äº†å±±ä¸Šï¼Œé›¨ä¼ä¸Šå·²ç»ç»“äº†è–„è–„ä¸€å±‚å†°ï¼Œè€çˆ¸è·Ÿè€å¦ˆè¡£æœä¹Ÿå†»ä¸Šäº†å†°æ™¶ï¼Œè¾‰è¾‰æ›´æ˜¯å¤´å‘éƒ½å†»ä¸Šäº†ã€‚é£é›ªä¹‹ä¸­ï¼ŒäºŒçˆ·çˆ·è¢«è‘¬åœ¨æˆ‘å®¶åå±±ã€‚ æˆ‘ä»¬å°±è¿™æ ·é€èµ°äº†äºŒçˆ·çˆ·ã€‚ è¿™æ¬¡çš„é€è‘¬ï¼Œå¯¹æˆ‘è€Œè¨€åƒæ˜¯ä¸€ä¸ªä»ªå¼â€”â€”å¤šå¹´å‰çš„é«˜è€ƒå¤‡æˆ˜ã€ä»¥åŠåæ¥çš„å¼‚ä¹¡æ±‚å­¦ï¼Œä½¿æˆ‘å¤±å»äº†ä¸€äº›ä¸€ç”Ÿåªæœ‰ä¸€æ¬¡çš„å‘Šåˆ«æœºä¼šï¼Œæˆ‘åœ¨å°è¯•å¼¥è¡¥è¿™äº›æ›¾ç»çš„é—æ†¾ã€‚ äº‹æƒ…éƒ½åŠå®Œåï¼Œæˆ‘åˆ°æ´å£èµ¶é«˜é“ï¼Œç»“æœä¸è®ºæ˜¯é«˜é“è¿˜æ˜¯ç«è½¦éƒ½æ™šç‚¹ï¼Œå°±è¿åªéš”ä¸€ä¸ªç«™çš„ K809 éƒ½æ™šç‚¹ 99 åˆ†é’Ÿã€‚æ¼«é•¿çš„ç­‰è½¦æ—¶é—´é‡Œï¼Œæˆ‘åˆçœ‹èµ·äº†ã€Šæœˆå®«ã€‹è¿™æœ¬å°è¯´ã€‚è¿™æ˜¯æˆ‘åˆšä¸Šå¤§å­¦æ—¶ä¹°çš„ä¹¦ï¼Œå› ä¸ºçœ‹åˆ°è¯´ä¸»è§’æƒ³æŠŠè‡ªå·±é€¼åˆ°æé™ï¼Œè¿™å¼•èµ·äº†å½“æ—¶è‹¦è¡Œåƒ§èˆ¬çš„æˆ‘çš„å…±é¸£ï¼Œäºæ˜¯å°±æƒ³ä¹°æ¥è¯»ä¸€è¯»ï¼Œä½†æˆ‘å§‹ç»ˆæ²¡æœ‰çœ‹å®Œå®ƒï¼Œå› ä¸ºè¶Šè¯»å†…å¿ƒå°±è¶Šå‹æŠ‘ã€‚ ä¸çŸ¥é“è¯¥å¦‚ä½•æè¿°è¿™ç§å¿ƒæ€çš„å˜åŒ–ï¼Œæˆ‘æ„è¯†åˆ°æˆ‘ç°åœ¨ç»ˆäºèƒ½å¤Ÿæ²‰ä¸‹å¿ƒå»è¯»è¿™æœ¬ä¹¦äº†ã€‚ æˆ‘è¾¹è¯»è¾¹å›å¿†å¤šå¹´å‰è¯»è¿‡çš„æ•…äº‹æƒ…èŠ‚ã€‚åœ¨è®°èµ·æ˜¯ Kitty æ•‘äº†è‡ªæˆ‘æ”¾é€ä¸­çš„ Foggï¼Œå¹¶ä¸”é‡æ–°è·å¾—å¸Œæœ›ä¹‹åï¼Œæˆ‘å‘è§‰è‡ªå·±ç›®å‰çš„çŠ¶æ€å¯èƒ½æœ‰äº›é—®é¢˜ã€‚ä¸šä½™æ—¶é—´æ²‰è¿·åœ¨è‡ªæˆ‘ä¸­å¿ƒçš„ç½‘ç»œå°è¯´ä¸­ï¼Œå…¶ä»–æ—¶é—´åªå…³æ³¨æŠ€æœ¯ï¼Œäººå°±æ¸æ¸å˜å¾—è·Ÿäººè„±èŠ‚ã€‚ ç»ˆäºä¸Šäº†é«˜é“ï¼Œåœ¨è½¦ä¸Šæˆ‘åŒæ ·ç”¨ã€Šæœˆå®«ã€‹æ‰“å‘æ—¶é—´ã€‚åœ¨æ™šç‚¹ä¸¤ä¸ªåŠå°æ—¶åï¼Œä¸€ç‚¹åŠï¼Œåˆ°è¾¾äº†æ·±åœ³åŒ—ï¼Œè¿™æ—¶å€™æˆ‘åˆšå¥½çœ‹åˆ°ä¹¦ä¸­ Kitty å¯¹ Fogg è¯´ï¼šã€Œå·²ç»å¤ªæ™šäº†ï¼Œæˆ‘ä¸èƒ½å†ä¸€æ¬¡å†’é™©ã€‚å†è§ï¼Œè¯·ä½ å¥½å¥½å¯¹è‡ªå·±ã€‚ã€å¿ƒé‡Œçªç„¶å°±ç©ºè½è½çš„ï¼Œæˆ‘æ„è¯†åˆ°è¿™æ˜¯ä¸€ä¸ªå½»å¤´å½»å°¾çš„æ‚²å‰§ï¼Œæˆ‘å±…ç„¶æƒ³åœ¨æ‚²å‰§ä¸­æœŸè®¸ä¸€ä¸ªç¾å¥½çš„è½¬æŠ˜ï¼ŒçœŸçš„æ˜¯æœ‰äº›å¦„æƒ³äº†ã€‚ä¸‹äº†è½¦ï¼Œç«™åœ¨ç«™å°ä¸Šï¼Œçœ¼æ³ªå°±æ¶Œäº†å‡ºæ¥ã€‚ä¸ºä¹¦ä¸­çš„æ‚²å‰§å“­æ³£ï¼Œä¹Ÿå†ä¸€æ¬¡æ„è¯†åˆ°ï¼Œé‚£äº›è®°å¿†ä¸­æ»¡è„¸çš±çº¹çš„èº«å½±ï¼Œæ˜¯çœŸçš„æ°¸åˆ«äº†ã€‚ ä» 2015 å¹´ 11 æœˆåˆ° 2021 å¹´ 12 æœˆ 27 æ—¥çš„å‡Œæ™¨ï¼ŒäºŒçˆ·çˆ·ä¸‹è‘¬çš„ç¿Œæ—¥ï¼Œæˆ‘å€Ÿç€ç«è½¦ç«™è·¯è¾¹æ˜é»„çš„ç¯å…‰ï¼Œçœ‹å®Œäº†ä¿ç½—Â·å¥¥æ–¯ç‰¹çš„ã€Šæœˆå®«ã€‹ã€‚ ","date":"2021-12-27","objectID":"/posts/moon-palace/:0:0","series":null,"tags":["ç”Ÿæ­»"],"title":"æœˆå®«","uri":"/posts/moon-palace/#"},{"categories":["life"],"content":" å·²è¿‡äº†ç«‹å†¬ï¼Œå´æ²¡æƒ³è±¡ä¸­çš„é‚£ä¹ˆå†·ã€‚ å¿½é—»å ‚å¼Ÿæ‰“ç®—å»æ²³å—ï¼Œè€Œä¸”åå¤©å°±èµ°ã€‚ ä¸€ç¬é—´æ„Ÿè§‰ç”Ÿæ´»æœ‰ç‚¹æ¢¦å¹»ï¼Œæƒ¶æƒ¶ç„¶åˆè„±ç¦»äº†æŒæ§ã€‚ åˆæƒ³åˆ°ä»Šå¹´æ‰¾åˆ°çš„æ–°å·¥ä½œï¼Œæ¢¦å¹»èˆ¬çš„å¾…é‡ï¼Œä¸é™é‡çš„ä¸‰é¤ä¾›åº”ï¼Œçª—æ˜å‡ å‡€çš„è½åœ°çª—å·¥ä½ï¼Œè¿™ä¸€åˆ‡éƒ½åƒæ˜¯åœ¨åšæ¢¦ã€‚ å³ä½¿å¦‚æ­¤ï¼Œæˆ‘ä¸€è¾¹æ‹…å¿ƒè‡ªå·±å·¥ä½œæä¸å®šè¦ææ¡¶è·‘è·¯ï¼Œä¸€è¾¹å´åˆè¿˜ä¸æ»¡è¶³ã€‚ æµ®ç”Ÿè‹¥æ¢¦ï¼Œä¸ºæ¬¢å‡ ä½•ï¼Ÿ å˜¿ï¼Œåˆæƒ³è¦å–ç‚¹é…’äº†ï¼Œæ¢¦é‡Œæˆ–è®¸æœ‰å¥½é…’å‘¢ã€‚ ææƒšé—´ï¼Œåˆå›åˆ°äº†é‚£å¹´å¤§äºŒå¼€å­¦ï¼Œæˆ‘æ‹–ç€ä¸ªæ—§çš®ç®±ï¼Œåœ¨å‡Œæ™¨è–„é›¾çš„æ ¡å›­é‡Œèµ°ç€ï¼Œè€³è¾¹åªæœ‰çš®ç®±è½®å­çš„æ»šåŠ¨å£°å’Œå‡ å£°é¸Ÿé¸£ã€‚è€³æœºé‡Œæ”¾ç€ä¸€é¦–ã€Šé¥è¿œçš„æ­Œã€‹ã€‚ ","date":"2021-11-16","objectID":"/posts/life-is-just-like-a-dream/:0:0","series":null,"tags":[],"title":"æµ®ç”Ÿè‹¥æ¢¦ï¼Œä¸ºæ¬¢å‡ ä½•ï¼Ÿ","uri":"/posts/life-is-just-like-a-dream/#"},{"categories":["éŸ³ä¹","life"],"content":" ã€Œæ­¤å²¸å¼ƒè‰ï¼Œå½¼å²¸ç¹èŠ±ã€‚ã€å–è‡ªå‰æ°¸åŠ¨æœºä¸»å”±ã€Œæ²³æ´¥æ¨±/ç™½é‡‘ã€çš„ä¸ªäººç®€ä»‹ ä»Šå¤©æƒ³æ¨å‡ é¦–æ­Œ emmmm éŸ³ä¹æ’ä»¶å‡ºäº†ç‚¹æ¯›ç—…ï¼Œç›´æ¥ä¸Šé“¾æ¥äº†ï¼š https://music.163.com/#/playlist?id=901077788 ","date":"2021-08-28","objectID":"/posts/weeds-on-this-side-flowers-on-the-other/:0:0","series":null,"tags":["åæ‘‡"],"title":"æ­¤å²¸å¼ƒè‰ï¼Œå½¼å²¸ç¹èŠ±","uri":"/posts/weeds-on-this-side-flowers-on-the-other/#"},{"categories":["tech"],"content":" æœ¬æ–‡ä»…é’ˆå¯¹ ipv4 ç½‘ç»œ æœ¬æ–‡å…ˆä»‹ç» iptables çš„åŸºæœ¬æ¦‚å¿µåŠå¸¸ç”¨å‘½ä»¤ï¼Œç„¶ååˆ†æ docker/podman æ˜¯å¦‚ä½•åˆ©ç”¨ iptables å’Œ Linux è™šæ‹Ÿç½‘ç»œæ¥å£å®ç°çš„å•æœºå®¹å™¨ç½‘ç»œã€‚ ","date":"2021-08-15","objectID":"/posts/iptables-and-container-networks/:0:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨","iptables","conntrack"],"title":"iptables åŠ docker å®¹å™¨ç½‘ç»œåˆ†æ","uri":"/posts/iptables-and-container-networks/#"},{"categories":["tech"],"content":" ä¸€ã€iptablesiptables æä¾›äº†åŒ…è¿‡æ»¤ã€NAT ä»¥åŠå…¶ä»–çš„åŒ…å¤„ç†èƒ½åŠ›ï¼Œiptables åº”ç”¨æœ€å¤šçš„ä¸¤ä¸ªåœºæ™¯æ˜¯ firewall å’Œ NAT iptables åŠæ–°çš„ nftables éƒ½æ˜¯åŸºäº netfilter å¼€å‘çš„ï¼Œæ˜¯ netfilter çš„å­é¡¹ç›®ã€‚ ä½†æ˜¯ eBPF ç¤¾åŒºç›®å‰æ­£åœ¨å¼€å‘æ—¨åœ¨å–ä»£ netfilter çš„æ–°é¡¹ç›® bpfilterï¼Œä»–ä»¬çš„ç›®æ ‡ä¹‹ä¸€æ˜¯å…¼å®¹ iptables/nftables è§„åˆ™ï¼Œè®©æˆ‘ä»¬æ‹­ç›®ä»¥å¾…å§ã€‚ ","date":"2021-08-15","objectID":"/posts/iptables-and-container-networks/:1:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨","iptables","conntrack"],"title":"iptables åŠ docker å®¹å™¨ç½‘ç»œåˆ†æ","uri":"/posts/iptables-and-container-networks/#ä¸€iptables"},{"categories":["tech"],"content":" 1. iptables åŸºç¡€æ¦‚å¿µ - å››è¡¨äº”é“¾ å®é™…ä¸Šè¿˜æœ‰å¼  SELinux ç›¸å…³çš„ security è¡¨ï¼ˆåº”è¯¥æ˜¯è¾ƒæ–°çš„å†…æ ¸æ–°å¢çš„ï¼Œä½†æ˜¯ä¸æ¸…æ¥šæ˜¯å“ªä¸ªç‰ˆæœ¬åŠ çš„ï¼‰ï¼Œä½†æ˜¯æˆ‘åŸºæœ¬æ²¡æ¥è§¦è¿‡ï¼Œå°±ç•¥è¿‡äº†ã€‚ è¿™é‡Œåªå¯¹ iptables åšç®€çŸ­ä»‹ç»ï¼Œè¯¦ç»†çš„æ•™ç¨‹å‚è§iptables è¯¦è§£ï¼ˆ1ï¼‰ï¼šiptables æ¦‚å¿µ - æœ±åŒå°ï¼Œè¿™ç¯‡æ–‡ç« å†™å¾—éå¸¸æ£’ï¼æŠŠ iptables è®²æ¸…æ¥šäº†ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œiptables æä¾›äº†å››å¼ è¡¨ï¼ˆä¸è€ƒè™‘ security çš„è¯ï¼‰å’Œäº”æ¡é“¾ï¼Œæ•°æ®åœ¨è¿™å››è¡¨äº”é“¾ä¸­çš„å¤„ç†æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š åœ¨è¿™é‡Œçš„ä»‹ç»ä¸­ï¼Œå¯ä»¥å…ˆå¿½ç•¥æ‰å›¾ä¸­ link layer å±‚çš„é“¾è·¯ï¼Œå®ƒå±äº ebtables çš„èŒƒç•´ã€‚å¦å¤–conntrack ä¹Ÿæš‚æ—¶å¿½ç•¥ï¼Œåœ¨ä¸‹ä¸€å°èŠ‚ä¼šè¯¦ç»†ä»‹ç» conntrack çš„åŠŸèƒ½ã€‚ netfilter æ•°æ®åŒ…å¤„ç†æµç¨‹ï¼Œæ¥è‡ª wikipedia å¯¹ç…§ä¸Šå›¾ï¼Œå¯¹äºå‘é€åˆ°æŸä¸ªç”¨æˆ·å±‚ç¨‹åºçš„æ•°æ®è€Œè¨€ï¼Œæµé‡é¡ºåºå¦‚ä¸‹ï¼š é¦–å…ˆè¿›å…¥ PREROUTING é“¾ï¼Œä¾æ¬¡ç»è¿‡è¿™ä¸‰ä¸ªè¡¨ï¼š raw -\u003e mangle -\u003e nat ç„¶åé€šè¿‡è·¯ç”±å†³ç­–ï¼Œå‘ç°ç›®æ ‡ IP ä¸ºæœ¬æœºåœ°å€ï¼Œäºæ˜¯è¿›å…¥ INPUT é“¾ï¼Œè¿™ä¸ªé“¾ä¸Šä¹Ÿæœ‰ä¸‰ä¸ªè¡¨ï¼Œå¤„ç†é¡ºåºæ˜¯ï¼šmangle -\u003e nat -\u003e filter è¿‡äº† INPUT é“¾åï¼Œæ•°æ®æ‰ä¼šè¿›å…¥å†…æ ¸åè®®æ ˆï¼Œæœ€ç»ˆåˆ°è¾¾ç”¨æˆ·å±‚ç¨‹åºã€‚ ç”¨æˆ·å±‚ç¨‹åºå‘å‡ºçš„æŠ¥æ–‡ï¼Œåˆ™ä¾æ¬¡ç»è¿‡è¿™å‡ ä¸ªè¡¨ï¼šOUTPUT -\u003e POSTROUTING åœ¨è·¯ç”±å†³ç­–æ—¶ï¼Œå¦‚æœç›®æ ‡ IP ä¸æ˜¯æœ¬æœºï¼Œå°±å¾—çœ‹å†…æ ¸æ˜¯å¦å¼€å¯äº† ip_forward åŠŸèƒ½ï¼Œå¦‚æœæ²¡å¼€å¯æ•°æ®åŒ…å°±æ‰”æ‰äº†ã€‚å¦‚æœå¼€äº†è½¬å‘ï¼Œå°±ä¼šè¿›å…¥ FORWARD é“¾å¤„ç†ï¼Œç„¶åç›´æ¥è¿›å…¥ POSTROUTING é“¾ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ç±»æµé‡ä¸ä¼šè¿‡ INPUT é“¾ï¼ ä»å›¾ä¸­ä¹Ÿå¾ˆå®¹æ˜“çœ‹å‡ºï¼Œå¦‚æœæ•°æ® dst ip ä¸æ˜¯æœ¬æœºä»»ä¸€æ¥å£çš„ ipï¼Œé‚£å®ƒé€šè¿‡çš„å‡ ä¸ªé“¾ä¾æ¬¡æ˜¯ï¼šPREROUTEING -\u003e FORWARD -\u003e POSTROUTING äº”é“¾çš„åŠŸèƒ½å’Œåç§°å®Œå…¨ä¸€è‡´ï¼Œåº”è¯¥å¾ˆå®¹æ˜“ç†è§£ã€‚é™¤äº†é»˜è®¤çš„äº”æ¡é“¾å¤–ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥åˆ›å»ºè‡ªå®šä¹‰çš„é“¾ï¼Œè‡ªå®šä¹‰çš„é“¾éœ€è¦è¢«é»˜è®¤é“¾å¼•ç”¨æ‰èƒ½ç”Ÿæ•ˆï¼Œæˆ‘ä»¬åé¢è¦ä»‹ç»çš„ Docker å®é™…ä¸Šå°±å®šä¹‰äº†å¥½å‡ æ¡è‡ªå®šä¹‰é“¾ã€‚ é™¤äº†ã€Œé“¾ã€å¤–ï¼Œiptables è¿˜æœ‰ã€Œè¡¨ã€çš„æ¦‚å¿µï¼Œå››ä¸ªè¡¨çš„ä¼˜å…ˆçº§é¡ºåºå¦‚ä¸‹ï¼š raw: å¯¹æ”¶åˆ°çš„æ•°æ®åŒ…åœ¨è¿æ¥è·Ÿè¸ªå‰è¿›è¡Œå¤„ç†ã€‚ä¸€èˆ¬ç”¨ä¸åˆ°ï¼Œå¯ä»¥å¿½ç•¥ ä¸€æ—¦ç”¨æˆ·ä½¿ç”¨äº† raw è¡¨ï¼Œraw è¡¨å¤„ç†å®Œåï¼Œå°†è·³è¿‡ nat è¡¨å’Œ ip_conntrack å¤„ç†ï¼Œå³ä¸å†åšåœ°å€è½¬æ¢å’Œæ•°æ®åŒ…çš„é“¾æ¥è·Ÿè¸ªå¤„ç†äº† mangle: ç”¨äºä¿®æ”¹æŠ¥æ–‡ã€ç»™æŠ¥æ–‡æ‰“æ ‡ç­¾ï¼Œç”¨å¾—ä¹Ÿè¾ƒå°‘ã€‚ nat: ä¸»è¦ç”¨äºåšç½‘ç»œåœ°å€è½¬æ¢ï¼ŒSNAT æˆ–è€… DNAT filter: ä¸»è¦ç”¨äºè¿‡æ»¤æ•°æ®åŒ… æ•°æ®åœ¨æŒ‰ä¼˜å…ˆçº§ç»è¿‡å››ä¸ªè¡¨çš„å¤„ç†æ—¶ï¼Œä¸€æ—¦åœ¨æŸä¸ªè¡¨ä¸­åŒ¹é…åˆ°ä¸€æ¡è§„åˆ™ A,ä¸‹ä¸€æ¡å¤„ç†è§„åˆ™å°±ç”±è§„åˆ™ A çš„ target å‚æ•°æŒ‡å®šï¼Œåç»­çš„æ‰€æœ‰è¡¨éƒ½ä¼šè¢«å¿½ç•¥ã€‚target æœ‰å¦‚ä¸‹å‡ ç§ç±»å‹ï¼š ACCEPT: ç›´æ¥å…è®¸æ•°æ®åŒ…é€šè¿‡ DROP: ç›´æ¥ä¸¢å¼ƒæ•°æ®åŒ…ï¼Œå¯¹ç¨‹åºè€Œè¨€å°±æ˜¯ 100% ä¸¢åŒ… REJECT: ä¸¢å¼ƒæ•°æ®åŒ…ï¼Œä½†æ˜¯ä¼šç»™ç¨‹åºè¿”å› RESETã€‚è¿™ä¸ªå¯¹ç¨‹åºæ›´å‹å¥½ï¼Œä½†æ˜¯å­˜åœ¨å®‰å…¨éšæ‚£ï¼Œé€šå¸¸ä¸ä½¿ç”¨ã€‚ MASQUERADE: ï¼ˆä¼ªè£…ï¼‰å°† src ip æ”¹å†™ä¸ºç½‘å¡ ipï¼Œå’Œ SNAT çš„åŒºåˆ«æ˜¯å®ƒä¼šè‡ªåŠ¨è¯»å–ç½‘å¡ ipã€‚è·¯ç”±è®¾å¤‡å¿…å¤‡ã€‚ SNAT/DNAT: é¡¾åæ€ä¹‰ï¼Œåšç½‘ç»œåœ°å€è½¬æ¢ REDIRECT: åœ¨æœ¬æœºåšç«¯å£æ˜ å°„ LOG: åœ¨ /var/log/messages æ–‡ä»¶ä¸­è®°å½•æ—¥å¿—ä¿¡æ¯ï¼Œç„¶åå°†æ•°æ®åŒ…ä¼ é€’ç»™ä¸‹ä¸€æ¡è§„åˆ™ï¼Œä¹Ÿå°±æ˜¯è¯´é™¤äº†è®°å½•ä»¥å¤–ä¸å¯¹æ•°æ®åŒ…åšä»»ä½•å…¶ä»–æ“ä½œï¼Œä»ç„¶è®©ä¸‹ä¸€æ¡è§„åˆ™å»åŒ¹é…ã€‚ åªæœ‰è¿™ä¸ª target ç‰¹æ®Šä¸€äº›ï¼ŒåŒ¹é…å®ƒçš„æ•°æ®ä»ç„¶å¯ä»¥åŒ¹é…åç»­è§„åˆ™ï¼Œä¸ä¼šç›´æ¥è·³è¿‡ã€‚ å…¶ä»–è‡ªå®šä¹‰é“¾çš„åç§°ï¼šè¡¨ç¤ºå°†æ•°æ®åŒ…äº¤ç»™è¯¥é“¾è¿›è¡Œä¸‹ä¸€æ­¥å¤„ç†ã€‚ RETURN: å¦‚æœæ˜¯åœ¨å­é“¾ï¼ˆè‡ªå®šä¹‰é“¾ï¼‰é‡åˆ° RETURNï¼Œåˆ™è¿”å›çˆ¶é“¾çš„ä¸‹ä¸€æ¡è§„åˆ™ç»§ç»­è¿›è¡Œæ¡ä»¶çš„æ¯”è¾ƒã€‚å¦‚æœæ˜¯åœ¨é»˜è®¤é“¾ RETURN åˆ™ç›´æ¥ä½¿ç”¨é»˜è®¤çš„åŠ¨ä½œï¼ˆACCEPT/DROPï¼‰ å…¶ä»–ç±»å‹ï¼Œå¯ä»¥ç”¨åˆ°çš„æ—¶å€™å†æŸ¥ ç†è§£äº†ä¸Šé¢è¿™å¼ å›¾ï¼Œä»¥åŠå››ä¸ªè¡¨çš„ç”¨é€”ï¼Œå°±å¾ˆå®¹æ˜“ç†è§£ iptables çš„å‘½ä»¤äº†ã€‚ ","date":"2021-08-15","objectID":"/posts/iptables-and-container-networks/:1:1","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨","iptables","conntrack"],"title":"iptables åŠ docker å®¹å™¨ç½‘ç»œåˆ†æ","uri":"/posts/iptables-and-container-networks/#1-iptables-åŸºç¡€æ¦‚å¿µ---å››è¡¨äº”é“¾"},{"categories":["tech"],"content":" 2. å¸¸ç”¨å‘½ä»¤ æ³¨æ„: ä¸‹é¢æä¾›çš„ iptables å‘½ä»¤åšçš„ä¿®æ”¹æ˜¯æœªæŒä¹…åŒ–çš„ï¼Œé‡å¯å°±ä¼šä¸¢å¤±ï¼åœ¨ä¸‹ä¸€èŠ‚ä¼šç®€å•ä»‹ç»æŒä¹…åŒ–é…ç½®çš„æ–¹æ³•ã€‚ å‘½ä»¤æ ¼å¼ï¼š shell iptables [-t table] {-A|-C|-D} chain [-m matchname [per-match-options]] -j targetname [per-target-options] å…¶ä¸­ table é»˜è®¤ä¸º filter è¡¨ï¼ˆå¯é€šè¿‡ -t xxx æŒ‡å®šåˆ«çš„è¡¨åï¼‰ï¼Œå…¶ä¸­ç³»ç»Ÿç®¡ç†å‘˜å®é™…ä½¿ç”¨æœ€å¤šçš„æ˜¯ INPUT é“¾ï¼Œç”¨äºè®¾ç½®é˜²ç«å¢™ã€‚ å…ˆä»‹ç»ä¸‹ iptables çš„æŸ¥è¯¢æŒ‡ä»¤ï¼š shell # --list-rules ä»¥å‘½ä»¤çš„å½¢å¼æŸ¥çœ‹æ‰€æœ‰è§„åˆ™ iptables -S # --list-rules æŸ¥çœ‹ INPUT è¡¨ä¸­çš„æ‰€æœ‰è§„åˆ™ iptables -S INPUT # -L è¡¨ç¤ºæŸ¥çœ‹å½“å‰è¡¨çš„æ‰€æœ‰è§„åˆ™ï¼Œç›¸æ¯” -S å®ƒçš„æ˜¾ç¤ºæ•ˆæœè¦æ›´ human-readable # -n è¡¨ç¤ºä¸å¯¹ IP åœ°å€è¿›è¡ŒåæŸ¥ï¼Œä¸€èˆ¬éƒ½ä¸éœ€è¦åæŸ¥ iptables -nL # æŸ¥çœ‹å…¶ä»–è¡¨çš„è§„åˆ™ï¼Œå¦‚ nat è¡¨ iptables -t nat -S iptables -t nat -nL ä»¥ä¸‹ç®€å•ä»‹ç»åœ¨ INPUT é“¾ä¸Šæ·»åŠ ã€ä¿®æ”¹è§„åˆ™ï¼Œæ¥è®¾ç½®é˜²ç«å¢™ï¼ˆé»˜è®¤ filter è¡¨ï¼Œå¯é€šè¿‡ -t xxx æŒ‡å®šåˆ«çš„è¡¨åï¼‰ï¼š shell # --add å…è®¸ 80 ç«¯å£é€šè¿‡ iptables -A INPUT -p tcp --dport 80 -j ACCEPT # ---delete é€šè¿‡ç¼–å·åˆ é™¤è§„åˆ™ iptables -D 1 # æˆ–è€…é€šè¿‡å®Œæ•´çš„è§„åˆ™å‚æ•°æ¥åˆ é™¤è§„åˆ™ iptables -D INPUT -p tcp --dport 80 -j ACCEPT # --replace é€šè¿‡ç¼–å·æ¥æ›¿æ¢è§„åˆ™å†…å®¹ iptables -R INPUT 1 -s 192.168.0.1 -j DROP # --insert åœ¨æŒ‡å®šçš„ä½ç½®æ’å…¥è§„åˆ™ï¼Œå¯ç±»æ¯”é“¾è¡¨çš„æ’å…¥ iptables -I INPUT 1 -p tcp --dport 80 -j ACCEPT # åœ¨åŒ¹é…æ¡ä»¶å‰é¢ä½¿ç”¨æ„Ÿå¹å·è¡¨ç¤ºå–å # å¦‚ä¸‹è§„åˆ™è¡¨ç¤ºæ¥å—æ‰€æœ‰æ¥è‡ª docker0ï¼Œä½†æ˜¯ç›®æ ‡æ¥å£ä¸æ˜¯ docker0 çš„æµé‡ iptables -A FORWARD -i docker0 ! -o docker0 -j ACCEPT # --policy è®¾ç½®æŸä¸ªé“¾çš„é»˜è®¤è§„åˆ™ # å¾ˆå¤šç³»ç»Ÿç®¡ç†å‘˜ä¼šä¹ æƒ¯å°†è¿æ¥å…¬ç½‘çš„æœåŠ¡å™¨ï¼Œé»˜è®¤è§„åˆ™è®¾ä¸º DROPï¼Œæå‡å®‰å…¨æ€§ï¼Œé¿å…é”™è¯¯åœ°å¼€æ”¾äº†ç«¯å£ã€‚ # ä½†æ˜¯ä¹Ÿè¦æ³¨æ„ï¼Œé»˜è®¤è§„åˆ™è®¾ä¸º DROP å‰ï¼Œä¸€å®šè¦å…ˆæŠŠå…è®¸ ssh ç«¯å£çš„è§„åˆ™åŠ ä¸Šï¼Œå¦åˆ™å°±å°´å°¬äº†ã€‚ iptables -P INPUT DROP # --flush æ¸…ç©º INPUT è¡¨ä¸Šçš„æ‰€æœ‰è§„åˆ™ iptables -F INPUT æœ¬æ–‡åç»­åˆ†ææ—¶ï¼Œå‡è®¾ç”¨æˆ·å·²ç»æ¸…æ¥š linux bridgeã€veth ç­‰è™šæ‹Ÿç½‘ç»œæ¥å£ç›¸å…³çŸ¥è¯†ã€‚å¦‚æœä½ è¿˜ç¼ºå°‘è¿™äº›å‰ç½®çŸ¥è¯†ï¼Œè¯·å…ˆé˜…è¯»æ–‡ç« Linux ä¸­çš„è™šæ‹Ÿç½‘ç»œæ¥å£ã€‚ ","date":"2021-08-15","objectID":"/posts/iptables-and-container-networks/:1:2","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨","iptables","conntrack"],"title":"iptables åŠ docker å®¹å™¨ç½‘ç»œåˆ†æ","uri":"/posts/iptables-and-container-networks/#2-å¸¸ç”¨å‘½ä»¤"},{"categories":["tech"],"content":" 3. conntrack è¿æ¥è·Ÿè¸ªä¸ NATåœ¨è®² conntrack ä¹‹é—´ï¼Œæˆ‘ä»¬å†å›é¡¾ä¸‹å‰é¢ç»™å‡ºè¿‡çš„ netfilter æ•°æ®å¤„ç†æµç¨‹å›¾ï¼š netfilter æ•°æ®åŒ…å¤„ç†æµç¨‹ï¼Œæ¥è‡ª wikipedia ä¸Šä¸€èŠ‚ä¸­æˆ‘ä»¬å¿½ç•¥äº†å›¾ä¸­çš„ conntrackï¼Œå®ƒå°±æ˜¯æœ¬èŠ‚çš„ä¸»è§’â€”â€”netfilter çš„è¿æ¥è·Ÿè¸ªï¼ˆconnection trackingï¼‰æ¨¡å—ã€‚ netfilter/conntrack æ˜¯ iptables å®ç° SNAT/DNAT/MASQUERADE çš„å‰ææ¡ä»¶ï¼Œä¸Šé¢çš„æµç¨‹å›¾æ˜¾ç¤ºï¼Œ conntrack åœ¨ PREROUTEING å’Œ OUTPUT é“¾çš„ raw è¡¨ä¹‹åç”Ÿæ•ˆã€‚ ä¸‹é¢ä»¥ docker é»˜è®¤çš„ bridge ç½‘ç»œä¸ºä¾‹è¯¦ç»†ä»‹ç»ä¸‹ conntrack çš„åŠŸèƒ½ã€‚ é¦–å…ˆï¼Œè¿™æ˜¯æˆ‘åœ¨ã€ŒLinux çš„è™šæ‹Ÿç½‘ç»œæ¥å£ã€æ–‡ä¸­ç»™å‡ºè¿‡çš„ docker0 ç½‘ç»œæ¶æ„å›¾: text +-----------------------------------------------+-----------------------------------+-----------------------------------+ | Host | Container A | Container B | | | | | | +---------------------------------------+ | +-------------------------+ | +-------------------------+ | | | Network Protocol Stack | | | Network Protocol Stack | | | Network Protocol Stack | | | +----+-------------+--------------------+ | +-----------+-------------+ | +------------+------------+ | | ^ ^ | ^ | ^ | |........|.............|........................|................|..................|.................|.................| | v v â†“ | v | v | | +----+----+ +-----+------+ | +-----+-------+ | +-----+-------+ | | | .31.101 | | 172.17.0.1 | +------+ | | 172.17.0.2 | | | 172.17.0.3 | | | +---------+ +-------------\u003c----\u003e+ veth | | +-------------+ | +-------------+ | | | eth0 | | docker0 | +--+---+ | | eth0(veth) | | | eth0(veth) | | | +----+----+ +-----+------+ ^ | +-----+-------+ | +-----+-------+ | | ^ ^ | | ^ | ^ | | | | +------------------------+ | | | | | v | | | | | | +--+---+ | | | | | | | veth | | | | | | | +--+---+ | | | | | | ^ | | | | | | +------------------------------------------------------------------------------+ | | | | | | | | | | | +-----------------------------------------------+-----------------------------------+-----------------------------------+ v Physical Network (192.168.31.0/24) docker ä¼šåœ¨ iptables ä¸­ä¸º docker0 ç½‘æ¡¥æ·»åŠ å¦‚ä¸‹è§„åˆ™ï¼š shell -t nat -A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE -t filter -P DROP -t filter -A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT è¿™å‡ è¡Œè§„åˆ™ä½¿ docker å®¹å™¨èƒ½æ­£å¸¸è®¿é—®å¤–éƒ¨ç½‘ç»œã€‚MASQUERADE åœ¨è¯·æ±‚å‡ºç½‘æ—¶ï¼Œä¼šè‡ªåŠ¨åš SNATï¼Œå°† src ip æ›¿æ¢æˆå‡ºå£ç½‘å¡çš„ ip. è¿™æ ·æ•°æ®åŒ…èƒ½æ­£å¸¸å‡ºç½‘ï¼Œè€Œä¸”å¯¹ç«¯è¿”å›çš„æ•°æ®åŒ…ç°åœ¨ä¹Ÿèƒ½æ­£å¸¸å›åˆ°å‡ºå£ç½‘å¡ã€‚ ç°åœ¨é—®é¢˜å°±æ¥äº†ï¼šå‡ºå£ç½‘å¡æ”¶åˆ°è¿”å›çš„æ•°æ®åŒ…åï¼Œè¿˜èƒ½å¦å°†æ•°æ®åŒ…è½¬å‘åˆ°æ•°æ®çš„åˆå§‹æ¥æºç«¯â€”â€”æŸä¸ª docker å®¹å™¨ï¼Ÿéš¾é“ docker è¿˜é¢å¤–æ·»åŠ äº†ä¸ MASQUERADE å¯¹åº”çš„ dst ip åå‘è½¬æ¢è§„åˆ™ï¼Ÿ å®é™…ä¸Šè¿™ä¸€æ­¥ä¾èµ–çš„æ˜¯æœ¬èŠ‚çš„ä¸»è§’â€”â€”iptables æä¾›çš„ conntrack è¿æ¥è·Ÿè¸ªåŠŸèƒ½ï¼ˆåœ¨ã€Œå‚è€ƒã€ä¸­æœ‰ä¸€ç¯‡æ–‡ç« è¯¦ç»†ä»‹ç»äº†æ­¤åŠŸèƒ½ï¼‰ã€‚ è¿æ¥è·Ÿè¸ªå¯¹ NAT çš„è´¡çŒ®æ˜¯ï¼šåœ¨åš NAT è½¬æ¢æ—¶ï¼Œæ— éœ€æ‰‹åŠ¨æ·»åŠ é¢å¤–çš„è§„åˆ™æ¥æ‰§è¡Œåå‘è½¬æ¢ä»¥å®ç°æ•°æ®çš„åŒå‘ä¼ è¾“ã€‚netfilter/conntrack ç³»ç»Ÿä¼šè®°å½• NAT çš„è¿æ¥çŠ¶æ€ï¼ŒNAT åœ°å€çš„åå‘è½¬æ¢æ˜¯æ ¹æ®è¿™ä¸ªçŠ¶æ€è‡ªåŠ¨å®Œæˆçš„ã€‚ æ¯”å¦‚ä¸Šå›¾ä¸­çš„ Container A é€šè¿‡ bridge ç½‘ç»œå‘ baidu.com å‘èµ·äº† N ä¸ªè¿æ¥ï¼Œè¿™æ—¶æ•°æ®çš„å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š é¦–å…ˆ Container A å‘å‡ºçš„æ•°æ®åŒ…è¢« MASQUERADE è§„åˆ™å¤„ç†ï¼Œå°† src ip æ›¿æ¢æˆ eth0 çš„ ipï¼Œç„¶åå‘é€åˆ°ç‰©ç†ç½‘ç»œ 192.168.31.0/24ã€‚ conntrack ç³»ç»Ÿè®°å½•æ­¤è¿æ¥è¢« NAT å¤„ç†å‰åçš„çŠ¶æ€ä¿¡æ¯ï¼Œå¹¶å°†å…¶çŠ¶æ€è®¾ç½®ä¸º NEWï¼Œè¡¨ç¤ºè¿™æ˜¯æ–°å‘èµ·çš„ä¸€ä¸ªè¿æ¥ å¯¹ç«¯ baidu.com è¿”å›æ•°æ®åŒ…åï¼Œä¼šé¦–å…ˆåˆ°è¾¾ eth0 ç½‘å¡ conntrack æŸ¥è¡¨ï¼Œå‘ç°è¿”å›æ•°æ®åŒ…çš„è¿æ¥å·²ç»è®°å½•åœ¨è¡¨ä¸­å¹¶ä¸”çŠ¶æ€ä¸º NEWï¼Œäºæ˜¯å®ƒå°†è¿æ¥çš„çŠ¶æ€ä¿®æ”¹ä¸º ESTABLISHEDï¼Œå¹¶ä¸”å°† dst_ip æ”¹ä¸º 172.17.0.2 ç„¶åå‘é€å‡ºå» æ³¨æ„ï¼Œè¿™ä¸ªå’Œ tcp çš„ ESTABLISHED æ²¡ä»»ä½•å…³ç³» ç»è¿‡è·¯ç”±åŒ¹é…ï¼Œæ•°æ®åŒ…ä¼šè¿›å…¥åˆ° docker0ï¼Œç„¶ååŒ¹é…ä¸Š iptables è§„åˆ™ï¼š-t filter -A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPTï¼Œ æ•°æ®ç›´æ¥è¢«æ”¾è¡Œ æ•°æ®ç»è¿‡ veth åï¼Œæœ€ç»ˆè¿›å…¥åˆ° Container A ä¸­ï¼Œäº¤ç”±å®¹å™¨çš„å†…æ ¸åè®®æ ˆå¤„ç†ã€‚ æ•°æ®è¢« Container A çš„å†…æ ¸åè®®æ ˆå‘é€åˆ°ã€Œå‘èµ·è¿æ¥çš„åº”ç”¨ç¨‹åºã€ã€‚ 1. æ”¯æŒå“ªäº›åè®®conntrack è¿æ¥è·Ÿè¸ªæ¨¡å—ç›®å‰åªæ”¯æŒä»¥ä¸‹å…­ç§åè®®ï¼šTCPã€UDPã€ICMPã€DCCPã€SCTPã€GRE è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œconntrack è·Ÿè¸ªçš„ã€Œè¿æ¥ã€ï¼Œè·Ÿã€ŒTCP è¿æ¥ã€ä¸æ˜¯ä¸€ä¸ªå±‚é¢çš„æ¦‚å¿µï¼Œå¯ä»¥çœ‹åˆ° conntrack ä¹Ÿæ”¯æŒ UDP è¿™ç§æ— è¿æ¥é€šè®¯åè®®ã€‚ 2. å®é™…æµ‹è¯• conntrackç°åœ¨æˆ‘ä»¬æ¥å®é™…æµ‹è¯•ä¸€ä¸‹ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯è¿™ä¹ˆå›äº‹ï¼š shell # ä½¿ç”¨ tcpdump åˆ†åˆ«åœ¨å‡ºå£ç½‘å¡ wlp4s0 ï¼ˆç›¸å½“äº eth0ï¼‰å’Œ docker0 ç½‘æ¡¥ä¸ŠæŠ“åŒ…ï¼Œåé¢ä¼šç”¨æ¥åˆ†æ â¯ sudo tcpdump -i wlp4s0 -n \u003e wlp4s0.dump # çª—å£ä¸€ï¼ŒæŠ“ wlp4s0 çš„åŒ… â¯ sudo tcpdump -i docker0 -n \u003e docker0.dump # çª—å£äºŒï¼ŒæŠ“ docker0 çš„åŒ… ç°åœ¨æ–°å»ºçª—å£ä¸‰ï¼Œå¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œé€šè¿‡ curl å‘½ä»¤ä½é€Ÿä¸‹è½½ä¸€ä¸ªè§†é¢‘æ–‡ä»¶ï¼š text â¯ docker run --rm --name curl -it curlimages/curl \"https://media.w3.org/2010/05/sintel/trailer.mp4\" -o /tmp/video.mp4 --limit-rate 100k ç„¶åæ–°å»ºçª—å£å››ï¼Œåœ¨å®¿ä¸»æœºæŸ¥çœ‹ conntrack çŠ¶æ€ shell â¯ sudo zypper in conntrack-tools # è¿™ä¸ªè®°å¾—å…ˆæå‰å®‰è£…å¥½ â¯ sudo conntrack -L | grep 172.17 # curl é€šè¿‡ NAT ç½‘ç»œå‘èµ·äº†ä¸€ä¸ª dns æŸ¥è¯¢è¯·æ±‚ï¼ŒDNS æœåŠ¡å™¨æ˜¯ç½‘å…³ä¸Šçš„ 192.168.31.1 udp 17 22 src=172.17.0.4 dst=192.168.31.1 sport=59423 dport=53 src=192.168.31.1 dst=192.168.31.228 sport=53 dport=59423 [ASSURED] mark=0 use=1 # curl é€šè¿‡ NAT ç½‘ç»œå‘ media.w3.org å‘èµ·äº† tcp è¿æ¥ tcp 6 298 ESTABLISHED src=172.17.0.4 dst=198.18.5.130 sport=54636 dport=443 src=198.18.5.130 dst=","date":"2021-08-15","objectID":"/posts/iptables-and-container-networks/:1:3","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨","iptables","conntrack"],"title":"iptables åŠ docker å®¹å™¨ç½‘ç»œåˆ†æ","uri":"/posts/iptables-and-container-networks/#3-conntrack-è¿æ¥è·Ÿè¸ªä¸-nat"},{"categories":["tech"],"content":" 3. conntrack è¿æ¥è·Ÿè¸ªä¸ NATåœ¨è®² conntrack ä¹‹é—´ï¼Œæˆ‘ä»¬å†å›é¡¾ä¸‹å‰é¢ç»™å‡ºè¿‡çš„ netfilter æ•°æ®å¤„ç†æµç¨‹å›¾ï¼š netfilter æ•°æ®åŒ…å¤„ç†æµç¨‹ï¼Œæ¥è‡ª wikipedia ä¸Šä¸€èŠ‚ä¸­æˆ‘ä»¬å¿½ç•¥äº†å›¾ä¸­çš„ conntrackï¼Œå®ƒå°±æ˜¯æœ¬èŠ‚çš„ä¸»è§’â€”â€”netfilter çš„è¿æ¥è·Ÿè¸ªï¼ˆconnection trackingï¼‰æ¨¡å—ã€‚ netfilter/conntrack æ˜¯ iptables å®ç° SNAT/DNAT/MASQUERADE çš„å‰ææ¡ä»¶ï¼Œä¸Šé¢çš„æµç¨‹å›¾æ˜¾ç¤ºï¼Œ conntrack åœ¨ PREROUTEING å’Œ OUTPUT é“¾çš„ raw è¡¨ä¹‹åç”Ÿæ•ˆã€‚ ä¸‹é¢ä»¥ docker é»˜è®¤çš„ bridge ç½‘ç»œä¸ºä¾‹è¯¦ç»†ä»‹ç»ä¸‹ conntrack çš„åŠŸèƒ½ã€‚ é¦–å…ˆï¼Œè¿™æ˜¯æˆ‘åœ¨ã€ŒLinux çš„è™šæ‹Ÿç½‘ç»œæ¥å£ã€æ–‡ä¸­ç»™å‡ºè¿‡çš„ docker0 ç½‘ç»œæ¶æ„å›¾: text +-----------------------------------------------+-----------------------------------+-----------------------------------+ | Host | Container A | Container B | | | | | | +---------------------------------------+ | +-------------------------+ | +-------------------------+ | | | Network Protocol Stack | | | Network Protocol Stack | | | Network Protocol Stack | | | +----+-------------+--------------------+ | +-----------+-------------+ | +------------+------------+ | | ^ ^ | ^ | ^ | |........|.............|........................|................|..................|.................|.................| | v v â†“ | v | v | | +----+----+ +-----+------+ | +-----+-------+ | +-----+-------+ | | | .31.101 | | 172.17.0.1 | +------+ | | 172.17.0.2 | | | 172.17.0.3 | | | +---------+ +-------------\u003c----\u003e+ veth | | +-------------+ | +-------------+ | | | eth0 | | docker0 | +--+---+ | | eth0(veth) | | | eth0(veth) | | | +----+----+ +-----+------+ ^ | +-----+-------+ | +-----+-------+ | | ^ ^ | | ^ | ^ | | | | +------------------------+ | | | | | v | | | | | | +--+---+ | | | | | | | veth | | | | | | | +--+---+ | | | | | | ^ | | | | | | +------------------------------------------------------------------------------+ | | | | | | | | | | | +-----------------------------------------------+-----------------------------------+-----------------------------------+ v Physical Network (192.168.31.0/24) docker ä¼šåœ¨ iptables ä¸­ä¸º docker0 ç½‘æ¡¥æ·»åŠ å¦‚ä¸‹è§„åˆ™ï¼š shell -t nat -A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE -t filter -P DROP -t filter -A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT è¿™å‡ è¡Œè§„åˆ™ä½¿ docker å®¹å™¨èƒ½æ­£å¸¸è®¿é—®å¤–éƒ¨ç½‘ç»œã€‚MASQUERADE åœ¨è¯·æ±‚å‡ºç½‘æ—¶ï¼Œä¼šè‡ªåŠ¨åš SNATï¼Œå°† src ip æ›¿æ¢æˆå‡ºå£ç½‘å¡çš„ ip. è¿™æ ·æ•°æ®åŒ…èƒ½æ­£å¸¸å‡ºç½‘ï¼Œè€Œä¸”å¯¹ç«¯è¿”å›çš„æ•°æ®åŒ…ç°åœ¨ä¹Ÿèƒ½æ­£å¸¸å›åˆ°å‡ºå£ç½‘å¡ã€‚ ç°åœ¨é—®é¢˜å°±æ¥äº†ï¼šå‡ºå£ç½‘å¡æ”¶åˆ°è¿”å›çš„æ•°æ®åŒ…åï¼Œè¿˜èƒ½å¦å°†æ•°æ®åŒ…è½¬å‘åˆ°æ•°æ®çš„åˆå§‹æ¥æºç«¯â€”â€”æŸä¸ª docker å®¹å™¨ï¼Ÿéš¾é“ docker è¿˜é¢å¤–æ·»åŠ äº†ä¸ MASQUERADE å¯¹åº”çš„ dst ip åå‘è½¬æ¢è§„åˆ™ï¼Ÿ å®é™…ä¸Šè¿™ä¸€æ­¥ä¾èµ–çš„æ˜¯æœ¬èŠ‚çš„ä¸»è§’â€”â€”iptables æä¾›çš„ conntrack è¿æ¥è·Ÿè¸ªåŠŸèƒ½ï¼ˆåœ¨ã€Œå‚è€ƒã€ä¸­æœ‰ä¸€ç¯‡æ–‡ç« è¯¦ç»†ä»‹ç»äº†æ­¤åŠŸèƒ½ï¼‰ã€‚ è¿æ¥è·Ÿè¸ªå¯¹ NAT çš„è´¡çŒ®æ˜¯ï¼šåœ¨åš NAT è½¬æ¢æ—¶ï¼Œæ— éœ€æ‰‹åŠ¨æ·»åŠ é¢å¤–çš„è§„åˆ™æ¥æ‰§è¡Œåå‘è½¬æ¢ä»¥å®ç°æ•°æ®çš„åŒå‘ä¼ è¾“ã€‚netfilter/conntrack ç³»ç»Ÿä¼šè®°å½• NAT çš„è¿æ¥çŠ¶æ€ï¼ŒNAT åœ°å€çš„åå‘è½¬æ¢æ˜¯æ ¹æ®è¿™ä¸ªçŠ¶æ€è‡ªåŠ¨å®Œæˆçš„ã€‚ æ¯”å¦‚ä¸Šå›¾ä¸­çš„ Container A é€šè¿‡ bridge ç½‘ç»œå‘ baidu.com å‘èµ·äº† N ä¸ªè¿æ¥ï¼Œè¿™æ—¶æ•°æ®çš„å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š é¦–å…ˆ Container A å‘å‡ºçš„æ•°æ®åŒ…è¢« MASQUERADE è§„åˆ™å¤„ç†ï¼Œå°† src ip æ›¿æ¢æˆ eth0 çš„ ipï¼Œç„¶åå‘é€åˆ°ç‰©ç†ç½‘ç»œ 192.168.31.0/24ã€‚ conntrack ç³»ç»Ÿè®°å½•æ­¤è¿æ¥è¢« NAT å¤„ç†å‰åçš„çŠ¶æ€ä¿¡æ¯ï¼Œå¹¶å°†å…¶çŠ¶æ€è®¾ç½®ä¸º NEWï¼Œè¡¨ç¤ºè¿™æ˜¯æ–°å‘èµ·çš„ä¸€ä¸ªè¿æ¥ å¯¹ç«¯ baidu.com è¿”å›æ•°æ®åŒ…åï¼Œä¼šé¦–å…ˆåˆ°è¾¾ eth0 ç½‘å¡ conntrack æŸ¥è¡¨ï¼Œå‘ç°è¿”å›æ•°æ®åŒ…çš„è¿æ¥å·²ç»è®°å½•åœ¨è¡¨ä¸­å¹¶ä¸”çŠ¶æ€ä¸º NEWï¼Œäºæ˜¯å®ƒå°†è¿æ¥çš„çŠ¶æ€ä¿®æ”¹ä¸º ESTABLISHEDï¼Œå¹¶ä¸”å°† dst_ip æ”¹ä¸º 172.17.0.2 ç„¶åå‘é€å‡ºå» æ³¨æ„ï¼Œè¿™ä¸ªå’Œ tcp çš„ ESTABLISHED æ²¡ä»»ä½•å…³ç³» ç»è¿‡è·¯ç”±åŒ¹é…ï¼Œæ•°æ®åŒ…ä¼šè¿›å…¥åˆ° docker0ï¼Œç„¶ååŒ¹é…ä¸Š iptables è§„åˆ™ï¼š-t filter -A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPTï¼Œ æ•°æ®ç›´æ¥è¢«æ”¾è¡Œ æ•°æ®ç»è¿‡ veth åï¼Œæœ€ç»ˆè¿›å…¥åˆ° Container A ä¸­ï¼Œäº¤ç”±å®¹å™¨çš„å†…æ ¸åè®®æ ˆå¤„ç†ã€‚ æ•°æ®è¢« Container A çš„å†…æ ¸åè®®æ ˆå‘é€åˆ°ã€Œå‘èµ·è¿æ¥çš„åº”ç”¨ç¨‹åºã€ã€‚ 1. æ”¯æŒå“ªäº›åè®®conntrack è¿æ¥è·Ÿè¸ªæ¨¡å—ç›®å‰åªæ”¯æŒä»¥ä¸‹å…­ç§åè®®ï¼šTCPã€UDPã€ICMPã€DCCPã€SCTPã€GRE è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œconntrack è·Ÿè¸ªçš„ã€Œè¿æ¥ã€ï¼Œè·Ÿã€ŒTCP è¿æ¥ã€ä¸æ˜¯ä¸€ä¸ªå±‚é¢çš„æ¦‚å¿µï¼Œå¯ä»¥çœ‹åˆ° conntrack ä¹Ÿæ”¯æŒ UDP è¿™ç§æ— è¿æ¥é€šè®¯åè®®ã€‚ 2. å®é™…æµ‹è¯• conntrackç°åœ¨æˆ‘ä»¬æ¥å®é™…æµ‹è¯•ä¸€ä¸‹ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯è¿™ä¹ˆå›äº‹ï¼š shell # ä½¿ç”¨ tcpdump åˆ†åˆ«åœ¨å‡ºå£ç½‘å¡ wlp4s0 ï¼ˆç›¸å½“äº eth0ï¼‰å’Œ docker0 ç½‘æ¡¥ä¸ŠæŠ“åŒ…ï¼Œåé¢ä¼šç”¨æ¥åˆ†æ â¯ sudo tcpdump -i wlp4s0 -n \u003e wlp4s0.dump # çª—å£ä¸€ï¼ŒæŠ“ wlp4s0 çš„åŒ… â¯ sudo tcpdump -i docker0 -n \u003e docker0.dump # çª—å£äºŒï¼ŒæŠ“ docker0 çš„åŒ… ç°åœ¨æ–°å»ºçª—å£ä¸‰ï¼Œå¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œé€šè¿‡ curl å‘½ä»¤ä½é€Ÿä¸‹è½½ä¸€ä¸ªè§†é¢‘æ–‡ä»¶ï¼š text â¯ docker run --rm --name curl -it curlimages/curl \"https://media.w3.org/2010/05/sintel/trailer.mp4\" -o /tmp/video.mp4 --limit-rate 100k ç„¶åæ–°å»ºçª—å£å››ï¼Œåœ¨å®¿ä¸»æœºæŸ¥çœ‹ conntrack çŠ¶æ€ shell â¯ sudo zypper in conntrack-tools # è¿™ä¸ªè®°å¾—å…ˆæå‰å®‰è£…å¥½ â¯ sudo conntrack -L | grep 172.17 # curl é€šè¿‡ NAT ç½‘ç»œå‘èµ·äº†ä¸€ä¸ª dns æŸ¥è¯¢è¯·æ±‚ï¼ŒDNS æœåŠ¡å™¨æ˜¯ç½‘å…³ä¸Šçš„ 192.168.31.1 udp 17 22 src=172.17.0.4 dst=192.168.31.1 sport=59423 dport=53 src=192.168.31.1 dst=192.168.31.228 sport=53 dport=59423 [ASSURED] mark=0 use=1 # curl é€šè¿‡ NAT ç½‘ç»œå‘ media.w3.org å‘èµ·äº† tcp è¿æ¥ tcp 6 298 ESTABLISHED src=172.17.0.4 dst=198.18.5.130 sport=54636 dport=443 src=198.18.5.130 dst=","date":"2021-08-15","objectID":"/posts/iptables-and-container-networks/:1:3","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨","iptables","conntrack"],"title":"iptables åŠ docker å®¹å™¨ç½‘ç»œåˆ†æ","uri":"/posts/iptables-and-container-networks/#1-æ”¯æŒå“ªäº›åè®®"},{"categories":["tech"],"content":" 3. conntrack è¿æ¥è·Ÿè¸ªä¸ NATåœ¨è®² conntrack ä¹‹é—´ï¼Œæˆ‘ä»¬å†å›é¡¾ä¸‹å‰é¢ç»™å‡ºè¿‡çš„ netfilter æ•°æ®å¤„ç†æµç¨‹å›¾ï¼š netfilter æ•°æ®åŒ…å¤„ç†æµç¨‹ï¼Œæ¥è‡ª wikipedia ä¸Šä¸€èŠ‚ä¸­æˆ‘ä»¬å¿½ç•¥äº†å›¾ä¸­çš„ conntrackï¼Œå®ƒå°±æ˜¯æœ¬èŠ‚çš„ä¸»è§’â€”â€”netfilter çš„è¿æ¥è·Ÿè¸ªï¼ˆconnection trackingï¼‰æ¨¡å—ã€‚ netfilter/conntrack æ˜¯ iptables å®ç° SNAT/DNAT/MASQUERADE çš„å‰ææ¡ä»¶ï¼Œä¸Šé¢çš„æµç¨‹å›¾æ˜¾ç¤ºï¼Œ conntrack åœ¨ PREROUTEING å’Œ OUTPUT é“¾çš„ raw è¡¨ä¹‹åç”Ÿæ•ˆã€‚ ä¸‹é¢ä»¥ docker é»˜è®¤çš„ bridge ç½‘ç»œä¸ºä¾‹è¯¦ç»†ä»‹ç»ä¸‹ conntrack çš„åŠŸèƒ½ã€‚ é¦–å…ˆï¼Œè¿™æ˜¯æˆ‘åœ¨ã€ŒLinux çš„è™šæ‹Ÿç½‘ç»œæ¥å£ã€æ–‡ä¸­ç»™å‡ºè¿‡çš„ docker0 ç½‘ç»œæ¶æ„å›¾: text +-----------------------------------------------+-----------------------------------+-----------------------------------+ | Host | Container A | Container B | | | | | | +---------------------------------------+ | +-------------------------+ | +-------------------------+ | | | Network Protocol Stack | | | Network Protocol Stack | | | Network Protocol Stack | | | +----+-------------+--------------------+ | +-----------+-------------+ | +------------+------------+ | | ^ ^ | ^ | ^ | |........|.............|........................|................|..................|.................|.................| | v v â†“ | v | v | | +----+----+ +-----+------+ | +-----+-------+ | +-----+-------+ | | | .31.101 | | 172.17.0.1 | +------+ | | 172.17.0.2 | | | 172.17.0.3 | | | +---------+ +-------------\u003c----\u003e+ veth | | +-------------+ | +-------------+ | | | eth0 | | docker0 | +--+---+ | | eth0(veth) | | | eth0(veth) | | | +----+----+ +-----+------+ ^ | +-----+-------+ | +-----+-------+ | | ^ ^ | | ^ | ^ | | | | +------------------------+ | | | | | v | | | | | | +--+---+ | | | | | | | veth | | | | | | | +--+---+ | | | | | | ^ | | | | | | +------------------------------------------------------------------------------+ | | | | | | | | | | | +-----------------------------------------------+-----------------------------------+-----------------------------------+ v Physical Network (192.168.31.0/24) docker ä¼šåœ¨ iptables ä¸­ä¸º docker0 ç½‘æ¡¥æ·»åŠ å¦‚ä¸‹è§„åˆ™ï¼š shell -t nat -A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE -t filter -P DROP -t filter -A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT è¿™å‡ è¡Œè§„åˆ™ä½¿ docker å®¹å™¨èƒ½æ­£å¸¸è®¿é—®å¤–éƒ¨ç½‘ç»œã€‚MASQUERADE åœ¨è¯·æ±‚å‡ºç½‘æ—¶ï¼Œä¼šè‡ªåŠ¨åš SNATï¼Œå°† src ip æ›¿æ¢æˆå‡ºå£ç½‘å¡çš„ ip. è¿™æ ·æ•°æ®åŒ…èƒ½æ­£å¸¸å‡ºç½‘ï¼Œè€Œä¸”å¯¹ç«¯è¿”å›çš„æ•°æ®åŒ…ç°åœ¨ä¹Ÿèƒ½æ­£å¸¸å›åˆ°å‡ºå£ç½‘å¡ã€‚ ç°åœ¨é—®é¢˜å°±æ¥äº†ï¼šå‡ºå£ç½‘å¡æ”¶åˆ°è¿”å›çš„æ•°æ®åŒ…åï¼Œè¿˜èƒ½å¦å°†æ•°æ®åŒ…è½¬å‘åˆ°æ•°æ®çš„åˆå§‹æ¥æºç«¯â€”â€”æŸä¸ª docker å®¹å™¨ï¼Ÿéš¾é“ docker è¿˜é¢å¤–æ·»åŠ äº†ä¸ MASQUERADE å¯¹åº”çš„ dst ip åå‘è½¬æ¢è§„åˆ™ï¼Ÿ å®é™…ä¸Šè¿™ä¸€æ­¥ä¾èµ–çš„æ˜¯æœ¬èŠ‚çš„ä¸»è§’â€”â€”iptables æä¾›çš„ conntrack è¿æ¥è·Ÿè¸ªåŠŸèƒ½ï¼ˆåœ¨ã€Œå‚è€ƒã€ä¸­æœ‰ä¸€ç¯‡æ–‡ç« è¯¦ç»†ä»‹ç»äº†æ­¤åŠŸèƒ½ï¼‰ã€‚ è¿æ¥è·Ÿè¸ªå¯¹ NAT çš„è´¡çŒ®æ˜¯ï¼šåœ¨åš NAT è½¬æ¢æ—¶ï¼Œæ— éœ€æ‰‹åŠ¨æ·»åŠ é¢å¤–çš„è§„åˆ™æ¥æ‰§è¡Œåå‘è½¬æ¢ä»¥å®ç°æ•°æ®çš„åŒå‘ä¼ è¾“ã€‚netfilter/conntrack ç³»ç»Ÿä¼šè®°å½• NAT çš„è¿æ¥çŠ¶æ€ï¼ŒNAT åœ°å€çš„åå‘è½¬æ¢æ˜¯æ ¹æ®è¿™ä¸ªçŠ¶æ€è‡ªåŠ¨å®Œæˆçš„ã€‚ æ¯”å¦‚ä¸Šå›¾ä¸­çš„ Container A é€šè¿‡ bridge ç½‘ç»œå‘ baidu.com å‘èµ·äº† N ä¸ªè¿æ¥ï¼Œè¿™æ—¶æ•°æ®çš„å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š é¦–å…ˆ Container A å‘å‡ºçš„æ•°æ®åŒ…è¢« MASQUERADE è§„åˆ™å¤„ç†ï¼Œå°† src ip æ›¿æ¢æˆ eth0 çš„ ipï¼Œç„¶åå‘é€åˆ°ç‰©ç†ç½‘ç»œ 192.168.31.0/24ã€‚ conntrack ç³»ç»Ÿè®°å½•æ­¤è¿æ¥è¢« NAT å¤„ç†å‰åçš„çŠ¶æ€ä¿¡æ¯ï¼Œå¹¶å°†å…¶çŠ¶æ€è®¾ç½®ä¸º NEWï¼Œè¡¨ç¤ºè¿™æ˜¯æ–°å‘èµ·çš„ä¸€ä¸ªè¿æ¥ å¯¹ç«¯ baidu.com è¿”å›æ•°æ®åŒ…åï¼Œä¼šé¦–å…ˆåˆ°è¾¾ eth0 ç½‘å¡ conntrack æŸ¥è¡¨ï¼Œå‘ç°è¿”å›æ•°æ®åŒ…çš„è¿æ¥å·²ç»è®°å½•åœ¨è¡¨ä¸­å¹¶ä¸”çŠ¶æ€ä¸º NEWï¼Œäºæ˜¯å®ƒå°†è¿æ¥çš„çŠ¶æ€ä¿®æ”¹ä¸º ESTABLISHEDï¼Œå¹¶ä¸”å°† dst_ip æ”¹ä¸º 172.17.0.2 ç„¶åå‘é€å‡ºå» æ³¨æ„ï¼Œè¿™ä¸ªå’Œ tcp çš„ ESTABLISHED æ²¡ä»»ä½•å…³ç³» ç»è¿‡è·¯ç”±åŒ¹é…ï¼Œæ•°æ®åŒ…ä¼šè¿›å…¥åˆ° docker0ï¼Œç„¶ååŒ¹é…ä¸Š iptables è§„åˆ™ï¼š-t filter -A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPTï¼Œ æ•°æ®ç›´æ¥è¢«æ”¾è¡Œ æ•°æ®ç»è¿‡ veth åï¼Œæœ€ç»ˆè¿›å…¥åˆ° Container A ä¸­ï¼Œäº¤ç”±å®¹å™¨çš„å†…æ ¸åè®®æ ˆå¤„ç†ã€‚ æ•°æ®è¢« Container A çš„å†…æ ¸åè®®æ ˆå‘é€åˆ°ã€Œå‘èµ·è¿æ¥çš„åº”ç”¨ç¨‹åºã€ã€‚ 1. æ”¯æŒå“ªäº›åè®®conntrack è¿æ¥è·Ÿè¸ªæ¨¡å—ç›®å‰åªæ”¯æŒä»¥ä¸‹å…­ç§åè®®ï¼šTCPã€UDPã€ICMPã€DCCPã€SCTPã€GRE è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œconntrack è·Ÿè¸ªçš„ã€Œè¿æ¥ã€ï¼Œè·Ÿã€ŒTCP è¿æ¥ã€ä¸æ˜¯ä¸€ä¸ªå±‚é¢çš„æ¦‚å¿µï¼Œå¯ä»¥çœ‹åˆ° conntrack ä¹Ÿæ”¯æŒ UDP è¿™ç§æ— è¿æ¥é€šè®¯åè®®ã€‚ 2. å®é™…æµ‹è¯• conntrackç°åœ¨æˆ‘ä»¬æ¥å®é™…æµ‹è¯•ä¸€ä¸‹ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯è¿™ä¹ˆå›äº‹ï¼š shell # ä½¿ç”¨ tcpdump åˆ†åˆ«åœ¨å‡ºå£ç½‘å¡ wlp4s0 ï¼ˆç›¸å½“äº eth0ï¼‰å’Œ docker0 ç½‘æ¡¥ä¸ŠæŠ“åŒ…ï¼Œåé¢ä¼šç”¨æ¥åˆ†æ â¯ sudo tcpdump -i wlp4s0 -n \u003e wlp4s0.dump # çª—å£ä¸€ï¼ŒæŠ“ wlp4s0 çš„åŒ… â¯ sudo tcpdump -i docker0 -n \u003e docker0.dump # çª—å£äºŒï¼ŒæŠ“ docker0 çš„åŒ… ç°åœ¨æ–°å»ºçª—å£ä¸‰ï¼Œå¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œé€šè¿‡ curl å‘½ä»¤ä½é€Ÿä¸‹è½½ä¸€ä¸ªè§†é¢‘æ–‡ä»¶ï¼š text â¯ docker run --rm --name curl -it curlimages/curl \"https://media.w3.org/2010/05/sintel/trailer.mp4\" -o /tmp/video.mp4 --limit-rate 100k ç„¶åæ–°å»ºçª—å£å››ï¼Œåœ¨å®¿ä¸»æœºæŸ¥çœ‹ conntrack çŠ¶æ€ shell â¯ sudo zypper in conntrack-tools # è¿™ä¸ªè®°å¾—å…ˆæå‰å®‰è£…å¥½ â¯ sudo conntrack -L | grep 172.17 # curl é€šè¿‡ NAT ç½‘ç»œå‘èµ·äº†ä¸€ä¸ª dns æŸ¥è¯¢è¯·æ±‚ï¼ŒDNS æœåŠ¡å™¨æ˜¯ç½‘å…³ä¸Šçš„ 192.168.31.1 udp 17 22 src=172.17.0.4 dst=192.168.31.1 sport=59423 dport=53 src=192.168.31.1 dst=192.168.31.228 sport=53 dport=59423 [ASSURED] mark=0 use=1 # curl é€šè¿‡ NAT ç½‘ç»œå‘ media.w3.org å‘èµ·äº† tcp è¿æ¥ tcp 6 298 ESTABLISHED src=172.17.0.4 dst=198.18.5.130 sport=54636 dport=443 src=198.18.5.130 dst=","date":"2021-08-15","objectID":"/posts/iptables-and-container-networks/:1:3","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨","iptables","conntrack"],"title":"iptables åŠ docker å®¹å™¨ç½‘ç»œåˆ†æ","uri":"/posts/iptables-and-container-networks/#2-å®é™…æµ‹è¯•-conntrack"},{"categories":["tech"],"content":" 3. conntrack è¿æ¥è·Ÿè¸ªä¸ NATåœ¨è®² conntrack ä¹‹é—´ï¼Œæˆ‘ä»¬å†å›é¡¾ä¸‹å‰é¢ç»™å‡ºè¿‡çš„ netfilter æ•°æ®å¤„ç†æµç¨‹å›¾ï¼š netfilter æ•°æ®åŒ…å¤„ç†æµç¨‹ï¼Œæ¥è‡ª wikipedia ä¸Šä¸€èŠ‚ä¸­æˆ‘ä»¬å¿½ç•¥äº†å›¾ä¸­çš„ conntrackï¼Œå®ƒå°±æ˜¯æœ¬èŠ‚çš„ä¸»è§’â€”â€”netfilter çš„è¿æ¥è·Ÿè¸ªï¼ˆconnection trackingï¼‰æ¨¡å—ã€‚ netfilter/conntrack æ˜¯ iptables å®ç° SNAT/DNAT/MASQUERADE çš„å‰ææ¡ä»¶ï¼Œä¸Šé¢çš„æµç¨‹å›¾æ˜¾ç¤ºï¼Œ conntrack åœ¨ PREROUTEING å’Œ OUTPUT é“¾çš„ raw è¡¨ä¹‹åç”Ÿæ•ˆã€‚ ä¸‹é¢ä»¥ docker é»˜è®¤çš„ bridge ç½‘ç»œä¸ºä¾‹è¯¦ç»†ä»‹ç»ä¸‹ conntrack çš„åŠŸèƒ½ã€‚ é¦–å…ˆï¼Œè¿™æ˜¯æˆ‘åœ¨ã€ŒLinux çš„è™šæ‹Ÿç½‘ç»œæ¥å£ã€æ–‡ä¸­ç»™å‡ºè¿‡çš„ docker0 ç½‘ç»œæ¶æ„å›¾: text +-----------------------------------------------+-----------------------------------+-----------------------------------+ | Host | Container A | Container B | | | | | | +---------------------------------------+ | +-------------------------+ | +-------------------------+ | | | Network Protocol Stack | | | Network Protocol Stack | | | Network Protocol Stack | | | +----+-------------+--------------------+ | +-----------+-------------+ | +------------+------------+ | | ^ ^ | ^ | ^ | |........|.............|........................|................|..................|.................|.................| | v v â†“ | v | v | | +----+----+ +-----+------+ | +-----+-------+ | +-----+-------+ | | | .31.101 | | 172.17.0.1 | +------+ | | 172.17.0.2 | | | 172.17.0.3 | | | +---------+ +-------------\u003c----\u003e+ veth | | +-------------+ | +-------------+ | | | eth0 | | docker0 | +--+---+ | | eth0(veth) | | | eth0(veth) | | | +----+----+ +-----+------+ ^ | +-----+-------+ | +-----+-------+ | | ^ ^ | | ^ | ^ | | | | +------------------------+ | | | | | v | | | | | | +--+---+ | | | | | | | veth | | | | | | | +--+---+ | | | | | | ^ | | | | | | +------------------------------------------------------------------------------+ | | | | | | | | | | | +-----------------------------------------------+-----------------------------------+-----------------------------------+ v Physical Network (192.168.31.0/24) docker ä¼šåœ¨ iptables ä¸­ä¸º docker0 ç½‘æ¡¥æ·»åŠ å¦‚ä¸‹è§„åˆ™ï¼š shell -t nat -A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE -t filter -P DROP -t filter -A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT è¿™å‡ è¡Œè§„åˆ™ä½¿ docker å®¹å™¨èƒ½æ­£å¸¸è®¿é—®å¤–éƒ¨ç½‘ç»œã€‚MASQUERADE åœ¨è¯·æ±‚å‡ºç½‘æ—¶ï¼Œä¼šè‡ªåŠ¨åš SNATï¼Œå°† src ip æ›¿æ¢æˆå‡ºå£ç½‘å¡çš„ ip. è¿™æ ·æ•°æ®åŒ…èƒ½æ­£å¸¸å‡ºç½‘ï¼Œè€Œä¸”å¯¹ç«¯è¿”å›çš„æ•°æ®åŒ…ç°åœ¨ä¹Ÿèƒ½æ­£å¸¸å›åˆ°å‡ºå£ç½‘å¡ã€‚ ç°åœ¨é—®é¢˜å°±æ¥äº†ï¼šå‡ºå£ç½‘å¡æ”¶åˆ°è¿”å›çš„æ•°æ®åŒ…åï¼Œè¿˜èƒ½å¦å°†æ•°æ®åŒ…è½¬å‘åˆ°æ•°æ®çš„åˆå§‹æ¥æºç«¯â€”â€”æŸä¸ª docker å®¹å™¨ï¼Ÿéš¾é“ docker è¿˜é¢å¤–æ·»åŠ äº†ä¸ MASQUERADE å¯¹åº”çš„ dst ip åå‘è½¬æ¢è§„åˆ™ï¼Ÿ å®é™…ä¸Šè¿™ä¸€æ­¥ä¾èµ–çš„æ˜¯æœ¬èŠ‚çš„ä¸»è§’â€”â€”iptables æä¾›çš„ conntrack è¿æ¥è·Ÿè¸ªåŠŸèƒ½ï¼ˆåœ¨ã€Œå‚è€ƒã€ä¸­æœ‰ä¸€ç¯‡æ–‡ç« è¯¦ç»†ä»‹ç»äº†æ­¤åŠŸèƒ½ï¼‰ã€‚ è¿æ¥è·Ÿè¸ªå¯¹ NAT çš„è´¡çŒ®æ˜¯ï¼šåœ¨åš NAT è½¬æ¢æ—¶ï¼Œæ— éœ€æ‰‹åŠ¨æ·»åŠ é¢å¤–çš„è§„åˆ™æ¥æ‰§è¡Œåå‘è½¬æ¢ä»¥å®ç°æ•°æ®çš„åŒå‘ä¼ è¾“ã€‚netfilter/conntrack ç³»ç»Ÿä¼šè®°å½• NAT çš„è¿æ¥çŠ¶æ€ï¼ŒNAT åœ°å€çš„åå‘è½¬æ¢æ˜¯æ ¹æ®è¿™ä¸ªçŠ¶æ€è‡ªåŠ¨å®Œæˆçš„ã€‚ æ¯”å¦‚ä¸Šå›¾ä¸­çš„ Container A é€šè¿‡ bridge ç½‘ç»œå‘ baidu.com å‘èµ·äº† N ä¸ªè¿æ¥ï¼Œè¿™æ—¶æ•°æ®çš„å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š é¦–å…ˆ Container A å‘å‡ºçš„æ•°æ®åŒ…è¢« MASQUERADE è§„åˆ™å¤„ç†ï¼Œå°† src ip æ›¿æ¢æˆ eth0 çš„ ipï¼Œç„¶åå‘é€åˆ°ç‰©ç†ç½‘ç»œ 192.168.31.0/24ã€‚ conntrack ç³»ç»Ÿè®°å½•æ­¤è¿æ¥è¢« NAT å¤„ç†å‰åçš„çŠ¶æ€ä¿¡æ¯ï¼Œå¹¶å°†å…¶çŠ¶æ€è®¾ç½®ä¸º NEWï¼Œè¡¨ç¤ºè¿™æ˜¯æ–°å‘èµ·çš„ä¸€ä¸ªè¿æ¥ å¯¹ç«¯ baidu.com è¿”å›æ•°æ®åŒ…åï¼Œä¼šé¦–å…ˆåˆ°è¾¾ eth0 ç½‘å¡ conntrack æŸ¥è¡¨ï¼Œå‘ç°è¿”å›æ•°æ®åŒ…çš„è¿æ¥å·²ç»è®°å½•åœ¨è¡¨ä¸­å¹¶ä¸”çŠ¶æ€ä¸º NEWï¼Œäºæ˜¯å®ƒå°†è¿æ¥çš„çŠ¶æ€ä¿®æ”¹ä¸º ESTABLISHEDï¼Œå¹¶ä¸”å°† dst_ip æ”¹ä¸º 172.17.0.2 ç„¶åå‘é€å‡ºå» æ³¨æ„ï¼Œè¿™ä¸ªå’Œ tcp çš„ ESTABLISHED æ²¡ä»»ä½•å…³ç³» ç»è¿‡è·¯ç”±åŒ¹é…ï¼Œæ•°æ®åŒ…ä¼šè¿›å…¥åˆ° docker0ï¼Œç„¶ååŒ¹é…ä¸Š iptables è§„åˆ™ï¼š-t filter -A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPTï¼Œ æ•°æ®ç›´æ¥è¢«æ”¾è¡Œ æ•°æ®ç»è¿‡ veth åï¼Œæœ€ç»ˆè¿›å…¥åˆ° Container A ä¸­ï¼Œäº¤ç”±å®¹å™¨çš„å†…æ ¸åè®®æ ˆå¤„ç†ã€‚ æ•°æ®è¢« Container A çš„å†…æ ¸åè®®æ ˆå‘é€åˆ°ã€Œå‘èµ·è¿æ¥çš„åº”ç”¨ç¨‹åºã€ã€‚ 1. æ”¯æŒå“ªäº›åè®®conntrack è¿æ¥è·Ÿè¸ªæ¨¡å—ç›®å‰åªæ”¯æŒä»¥ä¸‹å…­ç§åè®®ï¼šTCPã€UDPã€ICMPã€DCCPã€SCTPã€GRE è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œconntrack è·Ÿè¸ªçš„ã€Œè¿æ¥ã€ï¼Œè·Ÿã€ŒTCP è¿æ¥ã€ä¸æ˜¯ä¸€ä¸ªå±‚é¢çš„æ¦‚å¿µï¼Œå¯ä»¥çœ‹åˆ° conntrack ä¹Ÿæ”¯æŒ UDP è¿™ç§æ— è¿æ¥é€šè®¯åè®®ã€‚ 2. å®é™…æµ‹è¯• conntrackç°åœ¨æˆ‘ä»¬æ¥å®é™…æµ‹è¯•ä¸€ä¸‹ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯è¿™ä¹ˆå›äº‹ï¼š shell # ä½¿ç”¨ tcpdump åˆ†åˆ«åœ¨å‡ºå£ç½‘å¡ wlp4s0 ï¼ˆç›¸å½“äº eth0ï¼‰å’Œ docker0 ç½‘æ¡¥ä¸ŠæŠ“åŒ…ï¼Œåé¢ä¼šç”¨æ¥åˆ†æ â¯ sudo tcpdump -i wlp4s0 -n \u003e wlp4s0.dump # çª—å£ä¸€ï¼ŒæŠ“ wlp4s0 çš„åŒ… â¯ sudo tcpdump -i docker0 -n \u003e docker0.dump # çª—å£äºŒï¼ŒæŠ“ docker0 çš„åŒ… ç°åœ¨æ–°å»ºçª—å£ä¸‰ï¼Œå¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œé€šè¿‡ curl å‘½ä»¤ä½é€Ÿä¸‹è½½ä¸€ä¸ªè§†é¢‘æ–‡ä»¶ï¼š text â¯ docker run --rm --name curl -it curlimages/curl \"https://media.w3.org/2010/05/sintel/trailer.mp4\" -o /tmp/video.mp4 --limit-rate 100k ç„¶åæ–°å»ºçª—å£å››ï¼Œåœ¨å®¿ä¸»æœºæŸ¥çœ‹ conntrack çŠ¶æ€ shell â¯ sudo zypper in conntrack-tools # è¿™ä¸ªè®°å¾—å…ˆæå‰å®‰è£…å¥½ â¯ sudo conntrack -L | grep 172.17 # curl é€šè¿‡ NAT ç½‘ç»œå‘èµ·äº†ä¸€ä¸ª dns æŸ¥è¯¢è¯·æ±‚ï¼ŒDNS æœåŠ¡å™¨æ˜¯ç½‘å…³ä¸Šçš„ 192.168.31.1 udp 17 22 src=172.17.0.4 dst=192.168.31.1 sport=59423 dport=53 src=192.168.31.1 dst=192.168.31.228 sport=53 dport=59423 [ASSURED] mark=0 use=1 # curl é€šè¿‡ NAT ç½‘ç»œå‘ media.w3.org å‘èµ·äº† tcp è¿æ¥ tcp 6 298 ESTABLISHED src=172.17.0.4 dst=198.18.5.130 sport=54636 dport=443 src=198.18.5.130 dst=","date":"2021-08-15","objectID":"/posts/iptables-and-container-networks/:1:3","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨","iptables","conntrack"],"title":"iptables åŠ docker å®¹å™¨ç½‘ç»œåˆ†æ","uri":"/posts/iptables-and-container-networks/#3-nat-å¦‚ä½•åˆ†é…ç«¯å£"},{"categories":["tech"],"content":" 4. å¦‚ä½•æŒä¹…åŒ– iptables é…ç½®é¦–å…ˆéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œcentos7/opensuse 15 éƒ½å·²ç»åˆ‡æ¢åˆ°äº† firewalld ä½œä¸ºé˜²ç«å¢™é…ç½®è½¯ä»¶ï¼Œè€Œ ubuntu18.04 lts ä¹Ÿæ¢æˆäº† ufw æ¥é…ç½®é˜²ç«å¢™ã€‚ åŒ…æ‹¬ docker åº”è¯¥ä¹Ÿæ˜¯åœ¨å¯åŠ¨çš„æ—¶å€™åŠ¨æ€æ·»åŠ  iptables é…ç½®ã€‚ å¯¹äºä¸Šè¿°æ–°ç³»ç»Ÿï¼Œè¿˜æ˜¯å»ºè®®ç›´æ¥ä½¿ç”¨ firewalld/ufw é…ç½®é˜²ç«å¢™å§ï¼Œæˆ–è€…ç½‘ä¸Šæœä¸‹å…³é—­ ufw/firewalldã€å¯ç”¨ iptables æŒä¹…åŒ–çš„è§£å†³æ–¹æ¡ˆã€‚ æœ¬æ–‡ä¸»è¦ç›®çš„åœ¨äºç†è§£ docker å®¹å™¨ç½‘ç»œçš„åŸç†ï¼Œä»¥åŠä¸ºåé¢ç†è§£ kubernetes ç½‘ç»œæ’ä»¶ calico/flannel æ‰“å¥½åŸºç¡€ï¼Œå› æ­¤å°±ä¸å¤šä»‹ç»æŒä¹…åŒ–äº†ã€‚ ","date":"2021-08-15","objectID":"/posts/iptables-and-container-networks/:1:4","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨","iptables","conntrack"],"title":"iptables åŠ docker å®¹å™¨ç½‘ç»œåˆ†æ","uri":"/posts/iptables-and-container-networks/#4-å¦‚ä½•æŒä¹…åŒ–-iptables-é…ç½®"},{"categories":["tech"],"content":" äºŒã€å®¹å™¨ç½‘ç»œå®ç°åŸç† - iptables + bridge + vethDocker/Podman é»˜è®¤ä½¿ç”¨çš„éƒ½æ˜¯ bridge ç½‘ç»œï¼Œå®ƒä»¬çš„åº•å±‚å®ç°å®Œå…¨ç±»ä¼¼ã€‚ä¸‹é¢ä»¥ docker ä¸ºä¾‹è¿›è¡Œåˆ†æï¼ˆPodman çš„åˆ†ææµç¨‹ä¹ŸåŸºæœ¬ä¸€æ ·ï¼‰ã€‚ ","date":"2021-08-15","objectID":"/posts/iptables-and-container-networks/:2:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨","iptables","conntrack"],"title":"iptables åŠ docker å®¹å™¨ç½‘ç»œåˆ†æ","uri":"/posts/iptables-and-container-networks/#äºŒå®¹å™¨ç½‘ç»œå®ç°åŸç†---iptables--bridge--veth"},{"categories":["tech"],"content":" 1. ç®€å•åˆ†æ docker0 ç½‘æ¡¥çš„åŸç†é¦–å…ˆï¼Œä½¿ç”¨ docker run è¿è¡Œå‡ ä¸ªå®¹å™¨ï¼Œæ£€æŸ¥ä¸‹ç½‘ç»œçŠ¶å†µï¼š shell # è¿è¡Œä¸€ä¸ª debian å®¹å™¨å’Œä¸€ä¸ª nginx â¯ docker run -d --name debian --rm debian:buster sleep 1000000 â¯ docker run -d --name nginx --rm nginx:1.19-alpine # æŸ¥çœ‹ç½‘ç»œæ¥å£ï¼Œæœ‰ä¸¤ä¸ª veth æ¥å£ï¼ˆè€Œä¸”éƒ½æ²¡è®¾ ip åœ°å€ï¼‰ï¼Œåˆ†åˆ«è¿æ¥åˆ°ä¸¤ä¸ªå®¹å™¨çš„ eth0ï¼ˆdocker0 ç½‘ç»œæ¶æ„å›¾å‰é¢ç»™è¿‡äº†ï¼Œå¯ä»¥å¾€å‰é¢ç¿»ç¿»å¯¹ç…§ä¸‹ï¼‰ â¯ ip addr ls ... 5: docker0: \u003cBROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 qdisc noqueue state UP group default link/ether 02:42:42:c7:12:ba brd ff:ff:ff:ff:ff:ff inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0 valid_lft forever preferred_lft forever inet6 fe80::42:42ff:fec7:12ba/64 scope link valid_lft forever preferred_lft forever 100: veth16b37ea@if99: \u003cBROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 qdisc noqueue master docker0 state UP group default link/ether 42:af:34:ae:74:ae brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet6 fe80::40af:34ff:feae:74ae/64 scope link valid_lft forever preferred_lft forever 102: veth4b4dada@if101: \u003cBROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 qdisc noqueue master docker0 state UP group default link/ether 9e:f1:58:1a:cf:ae brd ff:ff:ff:ff:ff:ff link-netnsid 1 inet6 fe80::9cf1:58ff:fe1a:cfae/64 scope link valid_lft forever preferred_lft forever # ä¸¤ä¸ª veth æ¥å£éƒ½è¿æ¥åˆ°äº† docker0 ä¸Šé¢ï¼Œè¯´æ˜ä¸¤ä¸ªå®¹å™¨éƒ½ä½¿ç”¨äº† docker é»˜è®¤çš„ bridge ç½‘ç»œ â¯ sudo brctl show bridge name bridge id STP enabled interfaces docker0 8000.024242c712ba no veth16b37ea veth4b4dada # æŸ¥çœ‹è·¯ç”±è§„åˆ™ â¯ ip route ls default via 192.168.31.1 dev wlp4s0 proto dhcp metric 600 #ä¸‹åˆ—è·¯ç”±è§„åˆ™å°† `172.17.0.0/16` ç½‘æ®µçš„æ‰€æœ‰æµé‡è½¬å‘åˆ° docker0 172.17.0.0/16 dev docker0 proto kernel scope link src 172.17.0.1 linkdown 192.168.31.0/24 dev wlp4s0 proto kernel scope link src 192.168.31.228 metric 600 # æŸ¥çœ‹ iptables è§„åˆ™ # nat è¡¨ â¯ sudo iptables -t nat -S -P PREROUTING ACCEPT -P INPUT ACCEPT -P OUTPUT ACCEPT -P POSTROUTING ACCEPT # åœ¨ nat è¡¨ä¸­æ–°å»ºä¸€æ¡è‡ªå®šä¹‰é“¾ DOCKER -N DOCKER # æ‰€æœ‰ç›®çš„åœ°å€åœ¨æœ¬æœºçš„ï¼Œéƒ½å…ˆäº¤ç»™ DOCKER é“¾å¤„ç†ä¸€æ³¢ -A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER -A OUTPUT ! -d 127.0.0.0/8 -m addrtype --dst-type LOCAL -j DOCKER # ï¼ˆå®¹å™¨è®¿é—®å¤–éƒ¨ç½‘ç»œï¼‰æ‰€æœ‰å‡ºå£ä¸ä¸º docker0 çš„æµé‡ï¼Œéƒ½åšä¸‹ SNATï¼ŒæŠŠ src ip æ¢æˆå‡ºå£æ¥å£çš„ ip åœ°å€ -A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE # DOCKER é“¾ç›®å‰æ²¡ä»»ä½•å†…å®¹ï¼Œå•çº¯ç›´æ¥è¿”å›çˆ¶é“¾è¿›è¡Œè¿›ä¸€æ­¥åŒ¹é… -A DOCKER -i docker0 -j RETURN # filter è¡¨ â¯ sudo iptables -t filter -S -P INPUT ACCEPT -P FORWARD DROP -P OUTPUT ACCEPT # åœ¨ filter è¡¨ä¸­æ–°å»ºå››æ¡è‡ªå®šä¹‰é“¾ -N DOCKER -N DOCKER-ISOLATION-STAGE-1 -N DOCKER-ISOLATION-STAGE-2 -N DOCKER-USER # æ‰€æœ‰æµé‡éƒ½å¿…é¡»å…ˆç»è¿‡å¦‚ä¸‹ä¸¤ä¸ªè‡ªå®šä¹‰é“¾çš„å¤„ç†ï¼Œæ²¡é—®é¢˜æ‰èƒ½ç»§ç»­å¾€ä¸‹èµ° -A FORWARD -j DOCKER-ISOLATION-STAGE-1 -A FORWARD -j DOCKER-USER # ï¼ˆå®¹å™¨è®¿é—®å¤–éƒ¨ç½‘ç»œï¼‰å‡ºå»çš„æµé‡èµ°äº† MASQUERADEï¼Œå›æ¥çš„æµé‡ä¼šè¢« conntrack è¯†åˆ«å¹¶è½¬å‘å›æ¥ï¼Œè¿™é‡Œå…è®¸è¿”å›çš„æ•°æ®åŒ…é€šè¿‡ã€‚ # è¿™é‡Œç›´æ¥ ACCEPT è¢« conntrack è¯†åˆ«åˆ°çš„æµé‡ -A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT # å°†æ‰€æœ‰è®¿é—® docker0 çš„æµé‡éƒ½è½¬ç»™è‡ªå®šä¹‰é“¾ DOCKER å¤„ç† -A FORWARD -o docker0 -j DOCKER # å…è®¸æ‰€æœ‰æ¥è‡ª docker0 çš„æµé‡é€šè¿‡ï¼Œä¸è®ºä¸‹ä¸€è·³æ˜¯å¦æ˜¯ docker0 -A FORWARD -i docker0 ! -o docker0 -j ACCEPT -A FORWARD -i docker0 -o docker0 -j ACCEPT # ä¸‹é¢ä¸‰ä¸ªé“¾ç›®å‰å•¥è§„åˆ™ä¹Ÿæ²¡æœ‰ï¼Œå°±æ˜¯ç®€å•çš„ RETURNï¼Œç›´æ¥è¿”å›çˆ¶é“¾è¿›è¡Œè¿›ä¸€æ­¥åŒ¹é… -A DOCKER-ISOLATION-STAGE-1 -j RETURN -A DOCKER-ISOLATION-STAGE-2 -j RETURN -A DOCKER-USER -j RETURN ","date":"2021-08-15","objectID":"/posts/iptables-and-container-networks/:2:1","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨","iptables","conntrack"],"title":"iptables åŠ docker å®¹å™¨ç½‘ç»œåˆ†æ","uri":"/posts/iptables-and-container-networks/#1-ç®€å•åˆ†æ-docker0-ç½‘æ¡¥çš„åŸç†"},{"categories":["tech"],"content":" 2. docker0 ç¦æ­¢å®¹å™¨é—´é€šä¿¡docker å¯ä»¥é€šè¿‡ä¸º dockerd å¯åŠ¨å‚æ•°æ·»åŠ  --icc=false æ¥ç¦ç”¨å®¹å™¨é—´é€šä¿¡ ï¼ˆinter-container-networking çš„ç¼©å†™ï¼‰ï¼Œè¿™é‡Œæ¥éªŒè¯ä¸‹å®ƒæ˜¯å¦‚ä½•å®ç°è¿™ä¸ªåŠŸèƒ½çš„ã€‚ é¦–å…ˆéªŒè¯ä¸‹å‰é¢åˆ›å»ºçš„ debian å®¹å™¨ç›®å‰æ˜¯èƒ½è®¿é—® nginx å®¹å™¨çš„ï¼š shell # æŸ¥åˆ° nginx å®¹å™¨çš„ ip åœ°å€ â¯ docker inspect nginx | grep \\\"IPAddress \"IPAddress\": \"172.17.0.3\", â¯ docker exec -it debian bash # é¦–å…ˆè·‘ `apt update \u0026\u0026 apt install -y curl` å®‰è£… curl å·¥å…·ï¼Œè¿™é‡Œç•¥è¿‡ç›¸å…³æ—¥å¿— ...... # è®¿é—® nginx å®¹å™¨ï¼Œè¿”å›æ•°æ®æ­£å¸¸ root@499fbc07b79c:/# curl -s -v 172.17.0.3:80 -o /dev/null * Expire in 0 ms for 6 (transfer 0x5556f6dfd110) * Trying 172.17.0.3... * TCP_NODELAY set * Expire in 200 ms for 4 (transfer 0x5556f6dfd110) * Connected to 172.17.0.3 (172.17.0.3) port 80 (#0) \u003e GET / HTTP/1.1 \u003e Host: 172.17.0.3 \u003e User-Agent: curl/7.64.0 \u003e Accept: */* \u003e \u003c HTTP/1.1 200 OK \u003c Server: nginx/1.19.10 \u003c Date: Sat, 04 Mar 2023 14:00:09 GMT \u003c Content-Type: text/html \u003c Content-Length: 612 ... æ¥ç€æŸ¥æ‰¾ä¸‹ docker çš„ systemd é…ç½®ä½ç½®ï¼š shell â¯ sudo systemctl disable docker Removed \"/etc/systemd/system/multi-user.target.wants/docker.service\". â¯ sudo systemctl enable docker Created symlink /etc/systemd/system/multi-user.target.wants/docker.service â†’ /usr/lib/systemd/system/docker.service. æ ¹æ®æ—¥å¿—å¯å®šä½åˆ°æˆ‘çš„ docker.service é…ç½®ä½äº /usr/lib/systemd/system/docker.serviceï¼Œä¿®æ”¹æ­¤é…ç½®ï¼Œåœ¨ ExecStart ä¸€è¡Œçš„æœ«å°¾æ·»åŠ å‚æ•° --icc=falseï¼Œç„¶åé‡å¯ docker æœåŠ¡ï¼š shell â¯ sudo systemctl daemon-reload â¯ sudo systemctl restart docker ç°åœ¨å†èµ°ä¸€éå‰é¢çš„æµ‹è¯•ï¼Œä¼šå‘ç° debian æ— æ³•è®¿é—® nginx å®¹å™¨äº†ã€‚æŸ¥çœ‹ iptables è§„åˆ™ä¼šå‘ç°æ‰€æœ‰ docker0 ç½‘æ¡¥çš„å†…éƒ¨é€šä¿¡æ•°æ®å…¨éƒ¨è¢« drop æ‰äº†ï¼š shell # nat è¡¨ â¯ sudo iptables -t nat -S # å†…å®¹æ²¡æœ‰ä»»ä½•å˜åŒ–ï¼Œè¿™é‡Œç•¥è¿‡ ... # filter è¡¨ â¯ sudo iptables -t filter -S -P INPUT ACCEPT -P FORWARD DROP -P OUTPUT ACCEPT -N DOCKER -N DOCKER-ISOLATION-STAGE-1 -N DOCKER-ISOLATION-STAGE-2 -N DOCKER-USER -A FORWARD -j DOCKER-USER -A FORWARD -j DOCKER-ISOLATION-STAGE-1 -A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT # å°†æ‰€æœ‰è®¿é—® docker0 çš„æµé‡éƒ½è½¬ç»™è‡ªå®šä¹‰é“¾ DOCKER å¤„ç† -A FORWARD -o docker0 -j DOCKER # æ”¾è¡Œ docker0 ç½‘æ¡¥ä¸å¤–ç½‘é€šä¿¡çš„æ•°æ®ï¼ˆä¸‹ä¸€è·³ä¸ä¸º dockerï¼‰ -A FORWARD -i docker0 ! -o docker0 -j ACCEPT # ä¸¢å¼ƒæ‰€æœ‰ docker0 ç½‘æ¡¥çš„å†…éƒ¨é€šä¿¡æµé‡ï¼ˆå³ç¦æ­¢ docker0 ä¸Šçš„å®¹å™¨äº’ç›¸è®¿é—®ï¼‰ -A FORWARD -i docker0 -o docker0 -j DROP -A DOCKER-ISOLATION-STAGE-1 -i docker0 ! -o docker0 -j DOCKER-ISOLATION-STAGE-2 -A DOCKER-ISOLATION-STAGE-1 -j RETURN -A DOCKER-ISOLATION-STAGE-2 -o docker0 -j DROP -A DOCKER-ISOLATION-STAGE-2 -j RETURN -A DOCKER-USER -j RETURN ","date":"2021-08-15","objectID":"/posts/iptables-and-container-networks/:2:2","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨","iptables","conntrack"],"title":"iptables åŠ docker å®¹å™¨ç½‘ç»œåˆ†æ","uri":"/posts/iptables-and-container-networks/#2-docker0-ç¦æ­¢å®¹å™¨é—´é€šä¿¡"},{"categories":["tech"],"content":" 3. ä½¿ç”¨ docker-compose è‡ªå®šä¹‰ç½‘æ¡¥ä¸ç«¯å£æ˜ å°„æ¥ä¸‹æ¥ä½¿ç”¨å¦‚ä¸‹ docker-compose é…ç½®å¯åŠ¨ä¸€ä¸ª caddy å®¹å™¨ï¼Œæ·»åŠ è‡ªå®šä¹‰ network å’Œç«¯å£æ˜ å°„ï¼Œå¾…ä¼šå°±èƒ½éªŒè¯ docker æ˜¯å¦‚ä½•å®ç°è¿™ä¸¤ç§ç½‘ç»œçš„äº†ã€‚ docker-compose.yml å†…å®¹ï¼š yaml version: \"3.3\" services: caddy: image: \"caddy:2.2.1-alpine\" container_name: \"caddy\" restart: always command: caddy file-server --browse --root / ports: - \"8081:80\" networks: - caddy-1 networks: caddy-1: ç°åœ¨å…ˆç”¨ä¸Šé¢çš„é…ç½®å¯åŠ¨ caddy å®¹å™¨ï¼Œç„¶åå†æŸ¥çœ‹ç½‘ç»œçŠ¶å†µï¼š shell # å¯åŠ¨ caddy â¯ docker-compose up -d # æŸ¥ä¸‹ caddy å®¹å™¨çš„ ip â¯ docker inspect caddy | grep IPAddress ... \"IPAddress\": \"172.18.0.2\", # æŸ¥çœ‹ç½‘ç»œæ¥å£ï¼Œå¯ä»¥çœ‹åˆ°å¤šäº†ä¸€ä¸ªç½‘æ¡¥ br-ac3e0514d837 ï¼Œå®ƒå°±æ˜¯ä¸Šä¸€è¡Œå‘½ä»¤åˆ›å»ºçš„ caddy-1 ç½‘ç»œ # è¿˜å¤šäº†ä¸€ä¸ª veth0c25c6f@if104 ï¼Œå®ƒå®é™…è¿æ¥åˆ°äº† caddy å®¹å™¨çš„ eth0(veth) æ¥å£ â¯ ip addr ls ... 5: docker0: \u003cBROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 qdisc noqueue state UP group default link/ether 02:42:42:c7:12:ba brd ff:ff:ff:ff:ff:ff inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0 valid_lft forever preferred_lft forever inet6 fe80::42:42ff:fec7:12ba/64 scope link valid_lft forever preferred_lft forever 100: veth16b37ea@if99: \u003cBROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 qdisc noqueue master docker0 state UP group default link/ether 42:af:34:ae:74:ae brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet6 fe80::40af:34ff:feae:74ae/64 scope link valid_lft forever preferred_lft forever 102: veth4b4dada@if101: \u003cBROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 qdisc noqueue master docker0 state UP group default link/ether 9e:f1:58:1a:cf:ae brd ff:ff:ff:ff:ff:ff link-netnsid 1 inet6 fe80::9cf1:58ff:fe1a:cfae/64 scope link valid_lft forever preferred_lft forever 103: br-ac3e0514d837: \u003cBROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 qdisc noqueue state UP group default link/ether 02:42:7d:95:ba:7e brd ff:ff:ff:ff:ff:ff inet 172.18.0.1/16 brd 172.18.255.255 scope global br-ac3e0514d837 valid_lft forever preferred_lft forever inet6 fe80::42:7dff:fe95:ba7e/64 scope link valid_lft forever preferred_lft forever 105: veth0c25c6f@if104: \u003cBROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 qdisc noqueue master br-ac3e0514d837 state UP group default link/ether 9a:03:e1:f0:26:ea brd ff:ff:ff:ff:ff:ff link-netnsid 2 inet6 fe80::9803:e1ff:fef0:26ea/64 scope link valid_lft forever preferred_lft forever # æŸ¥çœ‹ç½‘æ¡¥ï¼Œèƒ½çœ‹åˆ° caddy å®¹å™¨çš„ veth0c25c6f æ¥å£è¿åœ¨äº† br-ac3e0514d837 ä¹Ÿå°±æ˜¯ caddy-1 ç½‘æ¡¥ä¸Šï¼Œæ²¡æœ‰åŠ å…¥åˆ° docker0 ç½‘ç»œ â¯ sudo brctl show bridge name bridge id STP enabled interfaces br-ac3e0514d837 8000.02427d95ba7e no veth0c25c6f docker0 8000.024242c712ba no veth16b37ea veth4b4dada # æŸ¥çœ‹è·¯ç”±ï¼Œèƒ½çœ‹åˆ°æ–°ç½‘æ¡¥ä½¿ç”¨çš„åœ°å€æ®µæ˜¯ 172.18.0.0/16ï¼Œæ˜¯ docker0 é€’å¢ä¸Šæ¥çš„ â¯ ip route ls default via 192.168.31.1 dev wlp4s0 proto dhcp metric 600 172.17.0.0/16 dev docker0 proto kernel scope link src 172.17.0.1 # å¤šäº†ä¸€ä¸ªç½‘æ¡¥çš„ 172.18.0.0/16 dev br-ac3e0514d837 proto kernel scope link src 172.18.0.1 192.168.31.0/24 dev wlp4s0 proto kernel scope link src 192.168.31.228 metric 600 # iptables ä¸­ä¹Ÿå¤šäº† caddy-1 ç½‘æ¡¥çš„ MASQUERADE è§„åˆ™ï¼Œä»¥åŠç«¯å£æ˜ å°„çš„è§„åˆ™ï¼Œä¸‹é¢é‡ç‚¹ç»™è¿™äº›æ–°å¢è§„åˆ™åŠ äº†æ³¨é‡Š â¯ sudo iptables -t nat -S -P PREROUTING ACCEPT -P INPUT ACCEPT -P OUTPUT ACCEPT -P POSTROUTING ACCEPT -N DOCKER -A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER -A OUTPUT ! -d 127.0.0.0/8 -m addrtype --dst-type LOCAL -j DOCKER -A POSTROUTING -s 172.18.0.0/16 ! -o br-ac3e0514d837 -j MASQUERADE -A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE # æºåœ°å€ä¸ç›®æ ‡åœ°å€éƒ½æ˜¯ 172.18.0.2/32ï¼Œè¯´æ˜æ˜¯ caddy å®¹å™¨åœ¨è¯·æ±‚å®ƒè‡ªå·±ï¼Œä¸ºä»€ä¹ˆè‡ªå·±è¯·æ±‚è‡ªå·±è¿˜è¦åš NAT(MASQUERADE) å‘¢ï¼Ÿï¼Ÿï¼Ÿ # æˆ‘è¡¨ç¤ºä¹Ÿè§‰å¾—æœ‰ç‚¹ç¦»è°±ï¼Œåªè¦å®¹å™¨ä¸­çš„åè®®æ ˆå®ç°æ²¡æ¯›ç—…ï¼Œè¯·æ±‚å®ƒè‡ªå·±åº”è¯¥æ ¹æœ¬ä¸ä¼šèµ°åˆ°ç½‘æ¡¥æ¥... # æŸ¥äº†ä¸€æ³¢èµ„æ–™å‘ç°è€å¤–ä¹ŸåŒæ ·è§‰å¾—å¾ˆç¦»è°±: https://www.ipspace.net/kb/DockerSvc/30-nat-iptables.html -A POSTROUTING -s 172.18.0.2/32 -d 172.18.0.2/32 -p tcp -m tcp --dport 80 -j MASQUERADE -A DOCKER -i br-ac3e0514d837 -j RETURN -A DOCKER -i docker0 -j RETURN # æ‰€æœ‰ä»é br-ac3e0514d837(caddy-1) ç½‘æ¡¥è¿›æ¥çš„ tcp æµé‡ï¼Œåªè¦ç›®æ ‡ç«¯å£æ˜¯ 8081ï¼Œå°±è½¬å‘åˆ° caddy å®¹å™¨å»å¹¶ä¸”ç›®æ ‡ç«¯å£æ”¹ä¸º 80ï¼ˆç«¯å£æ˜ å°„ï¼‰ # DOCKER é“¾å¤„ç†çš„æµé‡ç›®æ ‡åœ°å€ä¸æ˜¯å®¿ä¸»æœº IPï¼Œå› æ­¤åœ¨è·¯ç”±å†³ç­–æ—¶å®ƒä¼šèµ° FORWARD é“¾ï¼Œç›´æ¥ç»•è¿‡äº†é€šå¸¸è®¾ç½®åœ¨ INPUT é“¾çš„ä¸»æœºé˜²ç«å¢™è§„åˆ™ï¼Œè¿™å°±æ˜¯ Docker ç«¯å£æ˜ å°„èƒ½ä½¿é˜²ç«å¢™é…ç½®å¤±æ•ˆçš„åŸå› ã€‚ -A DOCKER ! -i br-ac3e0514d837 -p tcp -m tcp --dport 8081 -j DNAT --to-destination 172.18.0.2:80 â¯ sudo iptables -t filter -S -P INPUT ACCEPT -P FORWARD DROP -P OUTPUT ACCEPT -N DOCKER -N DOCKER-ISOLATION-STAGE-1 -N DOCKER-ISOLATION-STAGE-2 -N DOCKER-USER -A FORWARD -j D","date":"2021-08-15","objectID":"/posts/iptables-and-container-networks/:2:3","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨","iptables","conntrack"],"title":"iptables åŠ docker å®¹å™¨ç½‘ç»œåˆ†æ","uri":"/posts/iptables-and-container-networks/#docker-publish-ports"},{"categories":["tech"],"content":" ä¸‰ã€Docker/Podman çš„ macvlan/ipvlan æ¨¡å¼ æ³¨æ„ï¼šmacvlan å’Œ wifi å¥½åƒä¸å…¼å®¹ï¼Œæµ‹è¯•æ—¶ä¸è¦ä½¿ç”¨æ— çº¿ç½‘ç»œçš„æ¥å£ï¼ æˆ‘åœ¨å‰é¢ä»‹ç» Linux è™šæ‹Ÿç½‘ç»œæ¥å£çš„æ–‡ç« ä¸­ï¼Œæœ‰ä»‹ç»è¿‡ macvlan å’Œ ipvlan ä¸¤ç§æ–°çš„è™šæ‹Ÿæ¥å£ã€‚ ç›®å‰ Podman/Docker éƒ½æ”¯æŒä½¿ç”¨ macvlan æ¥æ„å»ºå®¹å™¨ç½‘ç»œï¼Œè¿™ç§æ¨¡å¼ä¸‹åˆ›å»ºçš„å®¹å™¨ç›´è¿å¤–éƒ¨ç½‘ç»œï¼Œå®¹å™¨å¯ä»¥æ‹¥æœ‰ç‹¬ç«‹çš„å¤–éƒ¨ IPï¼Œä¸éœ€è¦ç«¯å£æ˜ å°„ï¼Œä¹Ÿä¸éœ€è¦å€ŸåŠ© iptables. è¿™å’Œè™šæ‹Ÿæœºçš„ Bridge æ¨¡å¼å°±å¾ˆç±»ä¼¼ï¼Œä¸»è¦é€‚ç”¨äºå¸Œæœ›å®¹å™¨æ‹¥æœ‰ç‹¬ç«‹å¤–éƒ¨ IP çš„æƒ…å†µã€‚ ä¸‹é¢è¯¦ç»†åˆ†æä¸‹ Docker çš„ macvlan ç½‘ç»œï¼ˆPodman åº”è¯¥ä¹Ÿå®Œå…¨ç±»ä¼¼ï¼‰ã€‚ shell # é¦–å…ˆåˆ›å»ºä¸€ä¸ª macvlan ç½‘ç»œ # subnet/gateway çš„å‚æ•°éœ€è¦å’Œç‰©ç†ç½‘ç»œä¸€è‡´ # é€šè¿‡ -o parent è®¾å®šçˆ¶æ¥å£ï¼Œæˆ‘æœ¬æœºçš„ä»¥å¤ªç½‘å£åç§°ä¸º eno1 $ docker network create -d macvlan \\ --subnet=192.168.31.0/24 \\ --gateway=192.168.31.1 \\ -o parent=eno1 \\ macnet0 # ç°åœ¨ä½¿ç”¨ macvlan å¯åŠ¨ä¸€ä¸ªå®¹å™¨è¯•è¯• # å»ºè®®å’Œæˆ‘ä¸€æ ·ï¼Œé€šè¿‡ --ip æ‰‹åŠ¨é…ç½®é™æ€ ip åœ°å€ï¼Œå½“ç„¶ä¸é…ä¹Ÿå¯ä»¥ï¼ŒDHCP ä¼šè‡ªåŠ¨åˆ†é… IP $ docker run --network macnet0 --ip=192.168.31.233 --rm -it buildpack-deps:buster-curl /bin/bash # åœ¨å®¹å™¨ä¸­æŸ¥çœ‹ç½‘ç»œæ¥å£çŠ¶å†µï¼Œèƒ½çœ‹åˆ° eth0 æ˜¯ä¸€ä¸ª macvlan æ¥å£ root@4319488cb5e7:/# ip -d addr ls 1: lo: \u003cLOOPBACK,UP,LOWER_UP\u003e mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 promiscuity 0 minmtu 0 maxmtu 0 numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever 8: eth0@if2: \u003cBROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 qdisc noqueue state UP group default link/ether 02:42:c0:a8:1f:e9 brd ff:ff:ff:ff:ff:ff link-netnsid 0 promiscuity 0 minmtu 68 maxmtu 9194 macvlan mode bridge numtxqueues 1 numrxqueues 1 gso_max_size 64000 gso_max_segs 64 inet 192.168.31.233/24 brd 192.168.31.255 scope global eth0 valid_lft forever preferred_lft forever # è·¯ç”±è¡¨ï¼Œé»˜è®¤ gateway è¢«è‡ªåŠ¨é…ç½®è¿›æ¥äº† root@4319488cb5e7:/# ip route ls default via 192.168.31.1 dev eth0 192.168.31.0/24 dev eth0 proto kernel scope link src 192.168.31.233 # å¯ä»¥æ­£å¸¸è®¿é—® baidu root@4319488cb5e7:/# curl baidu.com \u003chtml\u003e \u003cmeta http-equiv=\"refresh\" content=\"0;url=http://www.baidu.com/\"\u003e \u003c/html\u003e Docker æ”¯æŒçš„å¦ä¸€ç§ç½‘ç»œæ¨¡å¼æ˜¯ ipvlanï¼ˆipvlan å’Œ macvlan çš„åŒºåˆ«æˆ‘åœ¨å‰ä¸€ç¯‡æ–‡ç« ä¸­å·²ç»ä»‹ç»è¿‡ï¼Œ ä¸å†èµ˜è¨€ï¼‰ï¼Œåˆ›å»ºå‘½ä»¤å’Œ macvlan å‡ ä¹ä¸€æ ·ï¼š shell # é¦–å…ˆåˆ›å»ºä¸€ä¸ª macvlan ç½‘ç»œ # subnet/gateway çš„å‚æ•°éœ€è¦å’Œç‰©ç†ç½‘ç»œä¸€è‡´ # é€šè¿‡ -o parent è®¾å®šçˆ¶æ¥å£ï¼Œæˆ‘æœ¬æœºçš„ä»¥å¤ªç½‘å£åç§°ä¸º eno1 # ipvlan_mode é»˜è®¤ä¸º l2ï¼Œè¡¨ç¤ºå·¥ä½œåœ¨æ•°æ®é“¾è·¯å±‚ã€‚ $ docker network create -d ipvlan \\ --subnet=192.168.31.0/24 \\ --gateway=192.168.31.1 \\ -o parent=eno1 \\ -o ipvlan_mode=l2 \\ ipvnet0 # ç°åœ¨ä½¿ç”¨ macvlan å¯åŠ¨ä¸€ä¸ªå®¹å™¨è¯•è¯• # å»ºè®®å’Œæˆ‘ä¸€æ ·ï¼Œé€šè¿‡ --ip æ‰‹åŠ¨é…ç½®é™æ€ ip åœ°å€ï¼Œå½“ç„¶ä¸é…ä¹Ÿå¯ä»¥ï¼ŒDHCP ä¼šè‡ªåŠ¨åˆ†é… IP $ docker run --network ipvnet0 --ip=192.168.31.234 --rm -it buildpack-deps:buster-curl /bin/bash # åœ¨å®¹å™¨ä¸­æŸ¥çœ‹ç½‘ç»œæ¥å£çŠ¶å†µï¼Œèƒ½çœ‹åˆ° eth0 æ˜¯ä¸€ä¸ª ipvlan æ¥å£ root@d0764ebbbf42:/# ip -d addr ls 1: lo: \u003cLOOPBACK,UP,LOWER_UP\u003e mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 promiscuity 0 minmtu 0 maxmtu 0 numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever 12: eth0@if2: \u003cBROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 qdisc noqueue state UNKNOWN group default link/ether 38:f3:ab:a3:e6:71 brd ff:ff:ff:ff:ff:ff link-netnsid 0 promiscuity 0 minmtu 68 maxmtu 65535 ipvlan mode l2 bridge numtxqueues 1 numrxqueues 1 gso_max_size 64000 gso_max_segs 64 inet 192.168.31.234/24 brd 192.168.31.255 scope global eth0 valid_lft forever preferred_lft forever # è·¯ç”±è¡¨ï¼Œé»˜è®¤ gateway è¢«è‡ªåŠ¨é…ç½®è¿›æ¥äº† root@d0764ebbbf42:/# ip route ls default via 192.168.31.1 dev eth0 192.168.31.0/24 dev eth0 proto kernel scope link src 192.168.31.234 # å¯ä»¥æ­£å¸¸è®¿é—® baidu root@d0764ebbbf42:/# curl baidu.com \u003chtml\u003e \u003cmeta http-equiv=\"refresh\" content=\"0;url=http://www.baidu.com/\"\u003e \u003c/html\u003e ","date":"2021-08-15","objectID":"/posts/iptables-and-container-networks/:3:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨","iptables","conntrack"],"title":"iptables åŠ docker å®¹å™¨ç½‘ç»œåˆ†æ","uri":"/posts/iptables-and-container-networks/#ä¸‰dockerpodman-çš„-macvlanipvlan-æ¨¡å¼"},{"categories":["tech"],"content":" å››ã€Rootless å®¹å™¨çš„ç½‘ç»œå®ç°å¦‚æœå®¹å™¨è¿è¡Œæ—¶ä¹Ÿåœ¨ Rootless æ¨¡å¼ä¸‹è¿è¡Œï¼Œé‚£å®ƒå°±æ²¡æœ‰æƒé™åœ¨å®¿ä¸»æœºæ·»åŠ  bridge/veth ç­‰è™šæ‹Ÿç½‘ç»œæ¥å£ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å‰é¢æè¿°çš„å®¹å™¨ç½‘ç»œå°±æ— æ³•è®¾ç½®äº†ã€‚ é‚£ä¹ˆ podman/containerd(nerdctl) ç›®å‰æ˜¯å¦‚ä½•åœ¨ Rootless æ¨¡å¼ä¸‹æ„å»ºå®¹å™¨ç½‘ç»œçš„å‘¢ï¼Ÿ æŸ¥çœ‹æ–‡æ¡£ï¼Œå‘ç°å®ƒä»¬éƒ½ç”¨åˆ°äº† rootlesskit ç›¸å…³çš„ä¸œè¥¿ï¼Œè€Œ rootlesskit æä¾›äº† rootless ç½‘ç»œçš„å‡ ä¸ªå®ç°ï¼Œæ–‡æ¡£å‚è§rootlesskit/docs/network.md å…¶ä¸­ç›®å‰æ¨èä½¿ç”¨ï¼Œè€Œä¸” podman/containerd(nerdctl) éƒ½é»˜è®¤ä½¿ç”¨çš„æ–¹æ¡ˆï¼Œæ˜¯rootless-containers/slirp4netns ä»¥ containerd(nerdctl) ä¸ºä¾‹ï¼ŒæŒ‰å®˜æ–¹æ–‡æ¡£å®‰è£…å¥½åï¼Œéšä¾¿å¯åŠ¨å‡ ä¸ªå®¹å™¨ï¼Œç„¶ååœ¨å®¿ä¸»æœºæŸ¥iptables/ip addr lsï¼Œä¼šå‘ç°å•¥ä¹Ÿæ²¡æœ‰ã€‚è¿™æ˜¾ç„¶æ˜¯å› ä¸º rootless æ¨¡å¼ä¸‹ containerd æ”¹ä¸äº†å®¿ä¸»æœºçš„ iptables é…ç½®å’Œè™šæ‹Ÿç½‘ç»œæ¥å£ã€‚ä½†æ˜¯å¯ä»¥æŸ¥çœ‹åˆ°å®¿ä¸»æœº slirp4netns åœ¨åå°è¿è¡Œï¼š shell â¯ ps aux | grep tap ryan 11644 0.0 0.0 5288 3312 ? S 00:01 0:02 slirp4netns --mtu 65520 -r 3 --disable-host-loopback --enable-sandbox --enable-seccomp 11625 tap0 ä½†æ˜¯æˆ‘çœ‹åŠå¤©æ–‡æ¡£ï¼Œåªçœ‹åˆ°æ€ä¹ˆä½¿ç”¨ rootlesskit/slirp4netns åˆ›å»ºæ–°çš„åå­—ç©ºé—´ï¼Œæ²¡çœ‹åˆ°æœ‰ä»‹ç»å¦‚ä½•è¿›å…¥ä¸€ä¸ªå·²å­˜åœ¨çš„ slirp4netns åå­—ç©ºé—´â€¦ ä½¿ç”¨ nsenter -a -t 11644 ä¹Ÿä¸€ç›´æŠ¥é”™ï¼Œä»»ä½•ç¨‹åºéƒ½æ˜¯ no such binaryâ€¦ ä»¥åæœ‰ç©ºå†é‡æ–°ç ”ç©¶ä¸€æ³¢â€¦ æ€»ä¹‹èƒ½ç¡®å®šçš„æ˜¯ï¼Œå®ƒé€šè¿‡åœ¨è™šæ‹Ÿçš„åå­—ç©ºé—´ä¸­åˆ›å»ºäº†ä¸€ä¸ª tap è™šæ‹Ÿæ¥å£æ¥å®ç°å®¹å™¨ç½‘ç»œï¼Œæ€§èƒ½ç›¸æ¯”å‰é¢ä»‹ç»çš„ç½‘ç»œå¤šå°‘æ˜¯è¦å·®ä¸€ç‚¹çš„ã€‚ ","date":"2021-08-15","objectID":"/posts/iptables-and-container-networks/:4:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨","iptables","conntrack"],"title":"iptables åŠ docker å®¹å™¨ç½‘ç»œåˆ†æ","uri":"/posts/iptables-and-container-networks/#å››rootless-å®¹å™¨çš„ç½‘ç»œå®ç°"},{"categories":["tech"],"content":" äº”ã€nftableså‰é¢ä»‹ç»äº† iptables ä»¥åŠå…¶åœ¨ docker å’Œé˜²ç«å¢™ä¸Šçš„åº”ç”¨ã€‚ä½†æ˜¯å®é™…ä¸Šç›®å‰å„å¤§ Linux å‘è¡Œç‰ˆéƒ½å·²ç»ä¸å»ºè®®ä½¿ç”¨ iptables äº†ï¼Œç”šè‡³æŠŠ iptables é‡å‘½åä¸ºäº† iptables-legacy. ç›®å‰ opensuse/debian/opensuse éƒ½å·²ç»é¢„è£…äº†å¹¶ä¸”æ¨èä½¿ç”¨ nftablesï¼Œè€Œä¸” firewalld å·²ç»é»˜è®¤ä½¿ç”¨ nftables ä½œä¸ºå®ƒçš„åç«¯äº†ã€‚ æˆ‘åœ¨ opensuse tumbleweed ä¸Šå®æµ‹ï¼Œfirewalld æ·»åŠ çš„æ˜¯ nftables é…ç½®ï¼Œè€Œ docker ä»ç„¶åœ¨ç”¨æ—§çš„ iptablesï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ç°åœ¨çš„æœºå™¨ä¸Šæœ‰ä¸¤å¥— netfilter å·¥å…·å¹¶å­˜ï¼š text # æŸ¥çœ‹ iptables æ•°æ® \u003e iptables -S -P INPUT ACCEPT -P FORWARD DROP -P OUTPUT ACCEPT -N DOCKER -N DOCKER-ISOLATION-STAGE-1 -N DOCKER-ISOLATION-STAGE-2 -N DOCKER-USER -A FORWARD -j DOCKER-ISOLATION-STAGE-1 -A FORWARD -o br-e3fbbb7a1b3a -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT -A FORWARD -o br-e3fbbb7a1b3a -j DOCKER ... # ç¡®è®¤ä¸‹æ˜¯å¦ä½¿ç”¨äº† nftables çš„å…¼å®¹å±‚ï¼Œç»“æœæç¤ºè¯·æˆ‘ä½¿ç”¨ iptables-legacy \u003e iptables-nft -S # Warning: iptables-legacy tables present, use iptables-legacy to see them -P INPUT ACCEPT -P FORWARD ACCEPT -P OUTPUT ACCEPT # æŸ¥çœ‹ nftables è§„åˆ™ï¼Œèƒ½çœ‹åˆ°ä¸‰å¼  firewalld ç”Ÿæˆçš„ table \u003e nft list ruleset table inet firewalld { ... } table ip firewalld { ... } table ip6 firewalld { ... } ä½†æ˜¯ç°åœ¨ kubernetes/docker éƒ½è¿˜æ˜¯ç”¨çš„ iptablesï¼Œnftables æˆ‘å­¦äº†ç”¨å¤„ä¸å¤§ï¼Œä»¥åæœ‰ç©ºå†è¡¥å……ã€‚ ","date":"2021-08-15","objectID":"/posts/iptables-and-container-networks/:5:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨","iptables","conntrack"],"title":"iptables åŠ docker å®¹å™¨ç½‘ç»œåˆ†æ","uri":"/posts/iptables-and-container-networks/#äº”nftables"},{"categories":["tech"],"content":" å‚è€ƒ iptables è¯¦è§£ï¼ˆ1ï¼‰ï¼šiptables æ¦‚å¿µ è¿æ¥è·Ÿè¸ªï¼ˆconntrackï¼‰ï¼šåŸç†ã€åº”ç”¨åŠ Linux å†…æ ¸å®ç° ç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNATï¼‰ä¹‹æŠ¥æ–‡è·Ÿè¸ª å®¹å™¨å®‰å…¨æ‹¾é— - Rootless Container åˆæ¢ netfilter - wikipedia ","date":"2021-08-15","objectID":"/posts/iptables-and-container-networks/:6:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨","iptables","conntrack"],"title":"iptables åŠ docker å®¹å™¨ç½‘ç»œåˆ†æ","uri":"/posts/iptables-and-container-networks/#å‚è€ƒ"},{"categories":["tech"],"content":" æœ¬æ–‡ç”¨åˆ°çš„å­—ç¬¦ç”»å·¥å…·ï¼švscode-asciiflow2 æ³¨æ„: æœ¬æ–‡ä¸­ä½¿ç”¨ ip å‘½ä»¤åˆ›å»ºæˆ–ä¿®æ”¹çš„ä»»ä½•ç½‘ç»œé…ç½®ï¼Œéƒ½æ˜¯æœªæŒä¹…åŒ–çš„ï¼Œä¸»æœºé‡å¯å³æ¶ˆå¤±ã€‚ Linux å…·æœ‰å¼ºå¤§çš„è™šæ‹Ÿç½‘ç»œèƒ½åŠ›ï¼Œè¿™ä¹Ÿæ˜¯ openstack ç½‘ç»œã€docker å®¹å™¨ç½‘ç»œä»¥åŠ kubernetes ç½‘ç»œç­‰è™šæ‹Ÿç½‘ç»œçš„åŸºç¡€ã€‚ è¿™é‡Œä»‹ç» Linux å¸¸ç”¨çš„è™šæ‹Ÿç½‘ç»œæ¥å£ç±»å‹ï¼šTUN/TAPã€bridgeã€vethã€ipvlan/macvlanã€vlan ä»¥åŠ vxlan/geneve. ","date":"2021-08-14","objectID":"/posts/linux-virtual-network-interfaces/:0:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨"],"title":"Linux ä¸­çš„è™šæ‹Ÿç½‘ç»œæ¥å£","uri":"/posts/linux-virtual-network-interfaces/#"},{"categories":["tech"],"content":" ä¸€ã€tun/tap è™šæ‹Ÿç½‘ç»œæ¥å£tun/tap æ˜¯æ“ä½œç³»ç»Ÿå†…æ ¸ä¸­çš„è™šæ‹Ÿç½‘ç»œè®¾å¤‡ï¼Œä»–ä»¬ä¸ºç”¨æˆ·å±‚ç¨‹åºæä¾›æ•°æ®çš„æ¥æ”¶ä¸ä¼ è¾“ã€‚ æ™®é€šçš„ç‰©ç†ç½‘ç»œæ¥å£å¦‚ eth0ï¼Œå®ƒçš„ä¸¤ç«¯åˆ†åˆ«æ˜¯å†…æ ¸åè®®æ ˆå’Œå¤–é¢çš„ç‰©ç†ç½‘ç»œã€‚ è€Œå¯¹äº TUN/TAP è™šæ‹Ÿæ¥å£å¦‚ tun0ï¼Œå®ƒçš„ä¸€ç«¯ä¸€å®šæ˜¯è¿æ¥çš„ç”¨æˆ·å±‚ç¨‹åºï¼Œå¦ä¸€ç«¯åˆ™è§†é…ç½®æ–¹å¼çš„ä¸åŒè€Œå˜åŒ–ï¼Œå¯ä»¥ç›´è¿å†…æ ¸åè®®æ ˆï¼Œä¹Ÿå¯ä»¥æ˜¯æŸä¸ª bridgeï¼ˆåé¢ä¼šä»‹ç»ï¼‰ã€‚Linux é€šè¿‡å†…æ ¸æ¨¡å— TUN æä¾› tun/tap åŠŸèƒ½ï¼Œè¯¥æ¨¡å—æä¾›äº†ä¸€ä¸ªè®¾å¤‡æ¥å£ /dev/net/tun ä¾›ç”¨æˆ·å±‚ç¨‹åºè¯»å†™ï¼Œç”¨æˆ·å±‚ç¨‹åºé€šè¿‡/dev/net/tun è¯»å†™ä¸»æœºå†…æ ¸åè®®æ ˆçš„æ•°æ®ã€‚ text \u003e modinfo tun filename: /lib/modules/5.13.6-1-default/kernel/drivers/net/tun.ko.xz alias: devname:net/tun alias: char-major-10-200 license: GPL author: (C) 1999-2004 Max Krasnyansky \u003cmaxk@qualcomm.com\u003e description: Universal TUN/TAP device driver ... \u003e ls /dev/net/tun /dev/net/tun ä¸€ä¸ª TUN è®¾å¤‡çš„ç¤ºä¾‹å›¾å¦‚ä¸‹ï¼š text +----------------------------------------------------------------------+ | | | +--------------------+ +--------------------+ | | | User Application A | | User Application B +\u003c-----+ | | +------------+-------+ +-------+------------+ | | | | 1 | 5 | | |...............+......................+...................|...........| | â†“ â†“ | | | +----------+ +----------+ | | | | socket A | | socket B | | | | +-------+--+ +--+-------+ | | | | 2 | 6 | | |.................+.................+......................|...........| | â†“ â†“ | | | +------------------------+ +--------+-------+ | | | Network Protocol Stack | | /dev/net/tun | | | +--+-------------------+-+ +--------+-------+ | | | 7 | 3 ^ | |................+...................+.....................|...........| | â†“ â†“ | | | +----------------+ +----------------+ 4 | | | | eth0 | | tun0 | | | | +-------+--------+ +-----+----------+ | | | 10.32.0.11 | | 192.168.3.11 | | | | 8 +---------------------+ | | | | +----------------+-----------------------------------------------------+ â†“ Physical Network å› ä¸º TUN/TAP è®¾å¤‡çš„ä¸€ç«¯æ˜¯å†…æ ¸åè®®æ ˆï¼Œæ˜¾ç„¶æµå…¥ tun0 çš„æ•°æ®åŒ…æ˜¯å…ˆç»è¿‡æœ¬åœ°çš„è·¯ç”±è§„åˆ™åŒ¹é…çš„ã€‚ è·¯ç”±åŒ¹é…æˆåŠŸï¼Œæ•°æ®åŒ…è¢«å‘é€åˆ° tun0 åï¼Œtun0 å‘ç°å¦ä¸€ç«¯æ˜¯é€šè¿‡ /dev/net/tun è¿æ¥åˆ°åº”ç”¨ç¨‹åº Bï¼Œå°±ä¼šå°†æ•°æ®ä¸¢ç»™åº”ç”¨ç¨‹åº Bã€‚ åº”ç”¨ç¨‹åºå¯¹æ•°æ®åŒ…è¿›è¡Œå¤„ç†åï¼Œå¯èƒ½ä¼šæ„é€ æ–°çš„æ•°æ®åŒ…ï¼Œé€šè¿‡ç‰©ç†ç½‘å¡å‘é€å‡ºå»ã€‚æ¯”å¦‚å¸¸è§çš„ VPN ç¨‹åºå°±æ˜¯æŠŠåŸæ¥çš„æ•°æ®åŒ…å°è£…/åŠ å¯†ä¸€éï¼Œå†å‘é€ç»™ VPN æœåŠ¡å™¨ã€‚ ","date":"2021-08-14","objectID":"/posts/linux-virtual-network-interfaces/:1:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨"],"title":"Linux ä¸­çš„è™šæ‹Ÿç½‘ç»œæ¥å£","uri":"/posts/linux-virtual-network-interfaces/#ä¸€tuntap-è™šæ‹Ÿç½‘ç»œæ¥å£"},{"categories":["tech"],"content":" C è¯­è¨€ç¼–ç¨‹æµ‹è¯• TUN è®¾å¤‡ä¸ºäº†ä½¿ç”¨ tun/tap è®¾å¤‡ï¼Œç”¨æˆ·å±‚ç¨‹åºéœ€è¦é€šè¿‡ç³»ç»Ÿè°ƒç”¨æ‰“å¼€ /dev/net/tun è·å¾—ä¸€ä¸ªè¯»å†™è¯¥è®¾å¤‡çš„æ–‡ä»¶æè¿°ç¬¦(FD)ï¼Œå¹¶ä¸”è°ƒç”¨ ioctl() å‘å†…æ ¸æ³¨å†Œä¸€ä¸ª TUN æˆ– TAP ç±»å‹çš„è™šæ‹Ÿç½‘å¡(å®ä¾‹åŒ–ä¸€ä¸ª tun/tap è®¾å¤‡)ï¼Œå…¶åç§°å¯èƒ½æ˜¯ tun0/tap0 ç­‰ã€‚ æ­¤åï¼Œç”¨æˆ·ç¨‹åºå¯ä»¥é€šè¿‡è¯¥ TUN/TAP è™šæ‹Ÿç½‘å¡ä¸ä¸»æœºå†…æ ¸åè®®æ ˆï¼ˆæˆ–è€…å…¶ä»–ç½‘ç»œè®¾å¤‡ï¼‰äº¤äº’ã€‚å½“ç”¨æˆ·å±‚ç¨‹åºå…³é—­åï¼Œå…¶æ³¨å†Œçš„ TUN/TAP è™šæ‹Ÿç½‘å¡ä»¥åŠè‡ªåŠ¨ç”Ÿæˆçš„è·¯ç”±è¡¨ç›¸å…³æ¡ç›®éƒ½ä¼šè¢«å†…æ ¸é‡Šæ”¾ã€‚ å¯ä»¥æŠŠç”¨æˆ·å±‚ç¨‹åºçœ‹åšæ˜¯ç½‘ç»œä¸Šå¦ä¸€å°ä¸»æœºï¼Œä»–ä»¬é€šè¿‡ tun/tap è™šæ‹Ÿç½‘å¡ç›¸è¿ã€‚ ä¸€ä¸ªç®€å•çš„ C ç¨‹åºç¤ºä¾‹å¦‚ä¸‹ï¼Œå®ƒæ¯æ¬¡æ”¶åˆ°æ•°æ®åï¼Œéƒ½åªå•çº¯åœ°æ‰“å°ä¸€ä¸‹æ”¶åˆ°çš„å­—èŠ‚æ•°ï¼š c #include \u003clinux/if.h\u003e #include \u003clinux/if_tun.h\u003e #include \u003csys/ioctl.h\u003e #include \u003cfcntl.h\u003e #include \u003cstring.h\u003e #include \u003cunistd.h\u003e #include\u003cstdlib.h\u003e #include\u003cstdio.h\u003e int tun_alloc(int flags) { struct ifreq ifr; int fd, err; char *clonedev = \"/dev/net/tun\"; // æ‰“å¼€ tun æ–‡ä»¶ï¼Œè·å¾— fd if ((fd = open(clonedev, O_RDWR)) \u003c 0) { return fd; } memset(\u0026ifr, 0, sizeof(ifr)); ifr.ifr_flags = flags; // å‘å†…æ ¸æ³¨å†Œä¸€ä¸ª TUN ç½‘å¡ï¼Œå¹¶ä¸å‰é¢æ‹¿åˆ°çš„ fd å…³è”èµ·æ¥ // ç¨‹åºå…³é—­æ—¶ï¼Œæ³¨å†Œçš„ tun ç½‘å¡åŠè‡ªåŠ¨ç”Ÿæˆçš„ç›¸å…³è·¯ç”±ç­–ç•¥ï¼Œä¼šè¢«è‡ªåŠ¨é‡Šæ”¾ if ((err = ioctl(fd, TUNSETIFF, (void *) \u0026ifr)) \u003c 0) { close(fd); return err; } printf(\"Open tun/tap device: %s for reading...\\n\", ifr.ifr_name); return fd; } int main() { int tun_fd, nread; char buffer[1500]; /* Flags: IFF_TUN - TUN device (no Ethernet headers) * IFF_TAP - TAP device * IFF_NO_PI - Do not provide packet information */ tun_fd = tun_alloc(IFF_TUN | IFF_NO_PI); if (tun_fd \u003c 0) { perror(\"Allocating interface\"); exit(1); } while (1) { nread = read(tun_fd, buffer, sizeof(buffer)); if (nread \u003c 0) { perror(\"Reading from interface\"); close(tun_fd); exit(1); } printf(\"Read %d bytes from tun/tap device\\n\", nread); } return 0; } æ¥ä¸‹æ¥å¼€å¯ä¸‰ä¸ªç»ˆç«¯çª—å£æ¥æµ‹è¯•ä¸Šè¿°ç¨‹åºï¼Œåˆ†åˆ«è¿è¡Œä¸Šé¢çš„ tun ç¨‹åºã€tcpdump å’Œ iproute2 æŒ‡ä»¤ã€‚ é¦–å…ˆé€šè¿‡ç¼–è¯‘è¿è¡Œä¸Šè¿° c ç¨‹åºï¼Œç¨‹åºä¼šé˜»å¡ä½ï¼Œç­‰å¾…æ•°æ®åˆ°è¾¾ï¼š text # ç¼–è¯‘ï¼Œè¯·å¿½ç•¥éƒ¨åˆ† warning \u003e gcc mytun.c -o mytun # åˆ›å»ºå¹¶ç›‘å¬ tun è®¾å¤‡éœ€è¦ root æƒé™ \u003e sudo mytun Open tun/tap device: tun0 for reading... ç°åœ¨ä½¿ç”¨ iproute2 æŸ¥çœ‹ä¸‹é“¾è·¯å±‚è®¾å¤‡ï¼š text # èƒ½å‘ç°æœ€åé¢æœ‰åˆ—å‡ºåä¸º tun0 çš„æ¥å£ï¼Œä½†æ˜¯çŠ¶æ€ä¸º down â¯ ip addr ls ...... 3: wlp4s0: \u003cBROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 qdisc noqueue state UP group default qlen 1000 link/ether c0:3c:59:36:a4:16 brd ff:ff:ff:ff:ff:ff inet 192.168.31.228/24 brd 192.168.31.255 scope global dynamic noprefixroute wlp4s0 valid_lft 41010sec preferred_lft 41010sec inet6 fe80::4ab0:130f:423b:5d37/64 scope link noprefixroute valid_lft forever preferred_lft forever 7: tun0: \u003cPOINTOPOINT,MULTICAST,NOARP\u003e mtu 1500 qdisc noop state DOWN group default qlen 500 link/none # ä¸º tun0 è®¾ç½® ip åœ°å€ï¼Œæ³¨æ„ä¸è¦å’Œå…¶ä»–æ¥å£åœ¨åŒä¸€ç½‘æ®µï¼Œä¼šå¯¼è‡´è·¯ç”±å†²çª \u003e sudo ip addr add 172.21.22.23/24 dev tun0 # å¯åŠ¨ tun0 è¿™ä¸ªæ¥å£ï¼Œè¿™ä¸€æ­¥ä¼šè‡ªåŠ¨å‘è·¯ç”±è¡¨ä¸­æ·»åŠ å°† 172.21.22.23/24 è·¯ç”±åˆ° tun0 çš„ç­–ç•¥ \u003e sudo ip link set tun0 up #ç¡®è®¤ä¸Šä¸€æ­¥æ·»åŠ çš„è·¯ç”±ç­–ç•¥æ˜¯å¦å­˜åœ¨ â¯ ip route ls default via 192.168.31.1 dev wlp4s0 proto dhcp metric 600 172.17.0.0/16 dev docker0 proto kernel scope link src 172.17.0.1 linkdown 172.21.22.0/24 dev tun0 proto kernel scope link src 172.21.22.23 192.168.31.0/24 dev wlp4s0 proto kernel scope link src 192.168.31.228 metric 600 # æ­¤æ—¶å†æŸ¥çœ‹æ¥å£ï¼Œå‘ç° tun0 çŠ¶æ€ä¸º unknown \u003e ip addr ls ...... 8: tun0: \u003cPOINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP\u003e mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 500 link/none inet 172.21.22.23/24 scope global tun0 valid_lft forever preferred_lft forever inet6 fe80::3d52:49b5:1cf3:38fd/64 scope link stable-privacy valid_lft forever preferred_lft forever # ä½¿ç”¨ tcpdump å°è¯•æŠ“ä¸‹ tun0 çš„æ•°æ®ï¼Œä¼šé˜»å¡åœ¨è¿™é‡Œï¼Œç­‰å¾…æ•°æ®åˆ°è¾¾ \u003e tcpdump -i tun0 ç°åœ¨å†å¯åŠ¨ç¬¬ä¸‰ä¸ªçª—å£å‘ç‚¹æ•°æ®ç»™ tun0ï¼ŒæŒç»­è§‚å¯Ÿå‰é¢ tcpdump å’Œ mytun çš„æ—¥å¿—: text # ç›´æ¥ ping tun0 çš„åœ°å€ï¼Œè²Œä¼¼æœ‰é—®é¢˜ï¼Œæ•°æ®æ²¡è¿› mytun ç¨‹åºï¼Œè€Œä¸”è¿˜æœ‰å“åº” â¯ ping -c 4 172.21.22.23 PING 172.21.22.23 (172.21.22.23) 56(84) bytes of data. 64 bytes from 172.21.22.23: icmp_seq=1 ttl=64 time=0.167 ms 64 bytes from 172.21.22.23: icmp_seq=2 ttl=64 time=0.180 ms 64 bytes from 172.21.22.23: icmp_seq=3 ttl=64 time=0.126 ms 64 bytes from 172.21.22.23: icmp_seq=4 ttl=64 time=0.141 ms --- 172.21.22.23 ping statistics --- 4 packets transmitted, 4 received, 0% packet loss, time 3060ms rtt min/avg/max/mdev = 0.126/0.153/0.180/0.021 ms # ä½†æ˜¯ ping è¯¥ç½‘æ®µä¸‹çš„å…¶ä»–åœ°å€ï¼Œæµé‡å°±ä¼šè¢«è½¬å‘ç»™ mytun ç¨‹åºï¼Œå› ä¸º mytun å•¥æ•°æ®ä¹Ÿæ²¡å›ï¼Œè‡ªç„¶ä¸¢åŒ…ç‡ 100% # tcpdump å’Œ mytun éƒ½ä¼šæ‰“å°å‡ºç›¸å…³æ—¥å¿— â¯ ping -c 4 172.21.22.26 PING 172.21.22.26 (172.21.22.26) 56(84) bytes of data. --- 172.21.22.26 ping statistics --- 4 packets transmitted, 0 received, 100% packet loss, time 3055ms ä¸‹é¢ç»™å‡º mytun çš„è¾“å‡ºï¼š text Read 84 bytes from tun/ta","date":"2021-08-14","objectID":"/posts/linux-virtual-network-interfaces/:1:1","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨"],"title":"Linux ä¸­çš„è™šæ‹Ÿç½‘ç»œæ¥å£","uri":"/posts/linux-virtual-network-interfaces/#c-è¯­è¨€ç¼–ç¨‹æµ‹è¯•-tun-è®¾å¤‡"},{"categories":["tech"],"content":" TUN ä¸ TAP çš„åŒºåˆ«TUN å’Œ TAP çš„åŒºåˆ«åœ¨äºå·¥ä½œçš„ç½‘ç»œå±‚æ¬¡ä¸åŒï¼Œç”¨æˆ·ç¨‹åºé€šè¿‡ TUN è®¾å¤‡åªèƒ½è¯»å†™ç½‘ç»œå±‚çš„ IP æ•°æ®åŒ…ï¼Œ è€Œ TAP è®¾å¤‡åˆ™æ”¯æŒè¯»å†™é“¾è·¯å±‚çš„æ•°æ®åŒ…ï¼ˆé€šå¸¸æ˜¯ä»¥å¤ªç½‘æ•°æ®åŒ…ï¼Œå¸¦æœ‰ Ethernet headersï¼‰ã€‚ TUN ä¸ TAP çš„å…³ç³»ï¼Œå°±ç±»ä¼¼äº socket å’Œ raw socket. TUN/TAP åº”ç”¨æœ€å¤šçš„åœºæ™¯æ˜¯ VPN ä»£ç†ï¼Œæ¯”å¦‚: clash: ä¸€ä¸ªæ”¯æŒå„ç§è§„åˆ™çš„éš§é“ï¼Œä¹Ÿæ”¯æŒ TUN æ¨¡å¼ tun2socks: ä¸€ä¸ªå…¨å±€é€æ˜ä»£ç†ï¼Œå’Œ VPN çš„å·¥ä½œæ¨¡å¼ä¸€æ ·ï¼Œå®ƒé€šè¿‡åˆ›å»ºè™šæ‹Ÿç½‘å¡+ä¿®æ”¹è·¯ç”±è¡¨ï¼Œåœ¨ç¬¬ä¸‰å±‚ç½‘ç»œå±‚ä»£ç†ç³»ç»Ÿæµé‡ã€‚ ","date":"2021-08-14","objectID":"/posts/linux-virtual-network-interfaces/:1:2","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨"],"title":"Linux ä¸­çš„è™šæ‹Ÿç½‘ç»œæ¥å£","uri":"/posts/linux-virtual-network-interfaces/#tun-ä¸-tap-çš„åŒºåˆ«"},{"categories":["tech"],"content":" äºŒã€vethveth æ¥å£æ€»æ˜¯æˆå¯¹å‡ºç°ï¼Œä¸€å¯¹ veth æ¥å£å°±ç±»ä¼¼ä¸€æ ¹ç½‘çº¿ï¼Œä»ä¸€ç«¯è¿›æ¥çš„æ•°æ®ä¼šä»å¦ä¸€ç«¯å‡ºå»ã€‚ åŒæ—¶ veth åˆæ˜¯ä¸€ä¸ªè™šæ‹Ÿç½‘ç»œæ¥å£ï¼Œå› æ­¤å®ƒå’Œ TUN/TAP æˆ–è€…å…¶ä»–ç‰©ç†ç½‘ç»œæ¥å£ä¸€æ ·ï¼Œä¹Ÿéƒ½èƒ½é…ç½® mac/ip åœ°å€ï¼ˆä½†æ˜¯å¹¶ä¸æ˜¯ä¸€å®šå¾—é… mac/ip åœ°å€ï¼‰ã€‚ å…¶ä¸»è¦ä½œç”¨å°±æ˜¯è¿æ¥ä¸åŒçš„ç½‘ç»œï¼Œæ¯”å¦‚åœ¨å®¹å™¨ç½‘ç»œä¸­ï¼Œç”¨äºå°†å®¹å™¨çš„ namespace ä¸ root namespace çš„ç½‘æ¡¥ br0 ç›¸è¿ã€‚å®¹å™¨ç½‘ç»œä¸­ï¼Œå®¹å™¨ä¾§çš„ veth è‡ªèº«è®¾ç½®äº† ip/mac åœ°å€å¹¶è¢«é‡å‘½åä¸º eth0ï¼Œä½œä¸ºå®¹å™¨çš„ç½‘ç»œæ¥å£ä½¿ç”¨ï¼Œè€Œä¸»æœºä¾§çš„ veth åˆ™ç›´æ¥è¿æ¥åœ¨ docker0/br0 ä¸Šé¢ã€‚ ä½¿ç”¨ veth å®ç°å®¹å™¨ç½‘ç»œï¼Œéœ€è¦ç»“åˆä¸‹ä¸€å°èŠ‚ä»‹ç»çš„ bridgeï¼Œåœ¨ä¸‹ä¸€å°èŠ‚å°†ç»™å‡ºå®¹å™¨ç½‘ç»œç»“æ„å›¾ã€‚ ","date":"2021-08-14","objectID":"/posts/linux-virtual-network-interfaces/:2:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨"],"title":"Linux ä¸­çš„è™šæ‹Ÿç½‘ç»œæ¥å£","uri":"/posts/linux-virtual-network-interfaces/#äºŒveth"},{"categories":["tech"],"content":" ä¸‰ã€bridgeLinux Bridge æ˜¯å·¥ä½œåœ¨é“¾è·¯å±‚çš„ç½‘ç»œäº¤æ¢æœºï¼Œç”± Linux å†…æ ¸æ¨¡å— bridge æä¾›ï¼Œå®ƒè´Ÿè´£åœ¨æ‰€æœ‰è¿æ¥åˆ°å®ƒçš„æ¥å£ä¹‹é—´è½¬å‘é“¾è·¯å±‚æ•°æ®åŒ…ã€‚ æ·»åŠ åˆ° Bridge ä¸Šçš„è®¾å¤‡è¢«è®¾ç½®ä¸ºåªæ¥å—äºŒå±‚æ•°æ®å¸§å¹¶ä¸”è½¬å‘æ‰€æœ‰æ”¶åˆ°çš„æ•°æ®åŒ…åˆ° Bridge ä¸­ã€‚åœ¨ Bridge ä¸­ä¼šè¿›è¡Œä¸€ä¸ªç±»ä¼¼ç‰©ç†äº¤æ¢æœºçš„æŸ¥MACç«¯å£æ˜ å°„è¡¨ã€è½¬å‘ã€æ›´æ–°MACç«¯å£æ˜ å°„è¡¨è¿™æ ·çš„å¤„ç†é€»è¾‘ï¼Œä»è€Œæ•°æ®åŒ…å¯ä»¥è¢«è½¬å‘åˆ°å¦ä¸€ä¸ªæ¥å£/ä¸¢å¼ƒ/å¹¿æ’­/å‘å¾€ä¸Šå±‚åè®®æ ˆï¼Œç”±æ­¤ Bridge å®ç°äº†æ•°æ®è½¬å‘çš„åŠŸèƒ½ã€‚ å¦‚æœä½¿ç”¨ tcpdump åœ¨ Bridge æ¥å£ä¸ŠæŠ“åŒ…ï¼Œå¯ä»¥æŠ“åˆ°ç½‘æ¡¥ä¸Šæ‰€æœ‰æ¥å£è¿›å‡ºçš„åŒ…ï¼Œå› ä¸ºè¿™äº›æ•°æ®åŒ…éƒ½è¦é€šè¿‡ç½‘æ¡¥è¿›è¡Œè½¬å‘ã€‚ ä¸ç‰©ç†äº¤æ¢æœºä¸åŒçš„æ˜¯ï¼ŒBridge æœ¬èº«å¯ä»¥è®¾ç½® IP åœ°å€ï¼Œå¯ä»¥è®¤ä¸ºå½“ä½¿ç”¨ brctl addbr br0 æ–°å»ºä¸€ä¸ª br0 ç½‘æ¡¥æ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨åˆ›å»ºäº†ä¸€ä¸ªåŒåçš„éšè— br0 ç½‘ç»œæ¥å£ã€‚br0 ä¸€æ—¦è®¾ç½® IP åœ°å€ï¼Œå°±æ„å‘³ç€è¿™ä¸ªéšè—çš„ br0 æ¥å£å¯ä»¥ä½œä¸ºè·¯ç”±æ¥å£è®¾å¤‡ï¼Œå‚ä¸ IP å±‚çš„è·¯ç”±é€‰æ‹©(å¯ä»¥ä½¿ç”¨ route -n æŸ¥çœ‹æœ€åä¸€åˆ— Iface)ã€‚å› æ­¤åªæœ‰å½“ br0 è®¾ç½® IP åœ°å€æ—¶ï¼ŒBridge æ‰æœ‰å¯èƒ½å°†æ•°æ®åŒ…å‘å¾€ä¸Šå±‚åè®®æ ˆã€‚ ä½†è¢«æ·»åŠ åˆ° Bridge ä¸Šçš„ç½‘å¡æ˜¯ä¸èƒ½é…ç½® IP åœ°å€çš„ï¼Œä»–ä»¬å·¥ä½œåœ¨æ•°æ®é“¾è·¯å±‚ï¼Œå¯¹è·¯ç”±ç³»ç»Ÿä¸å¯è§ã€‚ å®ƒå¸¸è¢«ç”¨äºåœ¨è™šæ‹Ÿæœºã€ä¸»æœºä¸Šä¸åŒçš„ namespaces ä¹‹é—´è½¬å‘æ•°æ®ã€‚ ","date":"2021-08-14","objectID":"/posts/linux-virtual-network-interfaces/:3:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨"],"title":"Linux ä¸­çš„è™šæ‹Ÿç½‘ç»œæ¥å£","uri":"/posts/linux-virtual-network-interfaces/#ä¸‰bridge"},{"categories":["tech"],"content":" è™šæ‹Ÿæœºåœºæ™¯ï¼ˆæ¡¥æ¥æ¨¡å¼ï¼‰ä»¥ qemu-kvm ä¸ºä¾‹ï¼Œåœ¨è™šæ‹Ÿæœºçš„æ¡¥æ¥æ¨¡å¼ä¸‹ï¼Œqemu-kvm ä¼šä¸ºæ¯ä¸ªè™šæ‹Ÿæœºåˆ›å»ºä¸€ä¸ª tun/tap è™šæ‹Ÿç½‘å¡å¹¶è¿æ¥åˆ° br0 ç½‘æ¡¥ã€‚è™šæ‹Ÿæœºå†…éƒ¨çš„ç½‘ç»œæ¥å£ eth0 æ˜¯ qemu-kvm è½¯ä»¶æ¨¡æ‹Ÿçš„ï¼Œå®é™…ä¸Šè™šæ‹Ÿæœºå†…ç½‘ç»œæ•°æ®çš„æ”¶å‘éƒ½ä¼šè¢« qemu-kvm è½¬æ¢æˆå¯¹ /dev/net/tun çš„è¯»å†™ã€‚ ä»¥å‘é€æ•°æ®ä¸ºä¾‹ï¼Œæ•´ä¸ªæµç¨‹å¦‚ä¸‹ï¼š è™šæ‹Ÿæœºå‘å‡ºå»çš„æ•°æ®åŒ…å…ˆåˆ°è¾¾ qemu-kvm ç¨‹åº æ•°æ®è¢«ç”¨æˆ·å±‚ç¨‹åº qemu-kvm å†™å…¥åˆ° /dev/net/tunï¼Œåˆ°è¾¾ tap è®¾å¤‡ tap è®¾å¤‡æŠŠæ•°æ®ä¼ é€åˆ° br0 ç½‘æ¡¥ br0 æŠŠæ•°æ®äº¤ç»™ eth0 å‘é€å‡ºå» æ•´ä¸ªæµç¨‹è·‘å®Œï¼Œæ•°æ®åŒ…éƒ½ä¸éœ€è¦ç»è¿‡å®¿ä¸»æœºçš„åè®®æ ˆï¼Œæ•ˆç‡é«˜ã€‚ text +------------------------------------------------+-----------------------------------+-----------------------------------+ | Host | VirtualMachine1 | VirtualMachine2 | | | | | | +--------------------------------------+ | +-------------------------+ | +-------------------------+ | | | Network Protocol Stack | | | Network Protocol Stack | | | Network Protocol Stack | | | +--------------------------------------+ | +-------------------------+ | +-------------------------+ | | â†‘ | â†‘ | â†‘ | |.......................|........................|................|..................|.................|.................| | â†“ | â†“ | â†“ | | +--------+ | +-------+ | +-------+ | | | .3.101 | | | .3.102| | | .3.103| | | +------+ +--------+ +-------+ | +-------+ | +-------+ | | | eth0 |\u003c---\u003e| br0 |\u003c---\u003e|tun/tap| | | eth0 | | | eth0 | | | +------+ +--------+ +-------+ | +-------+ | +-------+ | | â†‘ â†‘ â†‘ +--------+ â†‘ | â†‘ | | | | +------|qemu-kvm|-----------+ | | | | | â†“ +--------+ | | | | | +-------+ | | | | | | |tun/tap| | | | | | | +-------+ | | | | | | â†‘ | +--------+ | | | | | +-------------------------------------|qemu-kvm|-------------|-----------------+ | | | | +--------+ | | | | | | | +---------|--------------------------------------+-----------------------------------+-----------------------------------+ â†“ Physical Network (192.168.3.0/24) ","date":"2021-08-14","objectID":"/posts/linux-virtual-network-interfaces/:3:1","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨"],"title":"Linux ä¸­çš„è™šæ‹Ÿç½‘ç»œæ¥å£","uri":"/posts/linux-virtual-network-interfaces/#è™šæ‹Ÿæœºåœºæ™¯æ¡¥æ¥æ¨¡å¼"},{"categories":["tech"],"content":" è·¨ namespace é€šä¿¡åœºæ™¯ï¼ˆå®¹å™¨ç½‘ç»œï¼ŒNAT æ¨¡å¼ï¼‰ docker/podman æä¾›çš„ bridge ç½‘ç»œæ¨¡å¼ï¼Œå°±æ˜¯ä½¿ç”¨ veth+bridge+iptalbes å®ç°çš„ã€‚æˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« è¯¦ç»†ä»‹ç»ã€Œå®¹å™¨ç½‘ç»œã€ã€‚ ç”±äºå®¹å™¨è¿è¡Œåœ¨è‡ªå·±å•ç‹¬çš„ network namespace é‡Œé¢ï¼Œæ‰€ä»¥å’Œè™šæ‹Ÿæœºä¸€æ ·ï¼Œå®ƒä»¬ä¹Ÿéƒ½æœ‰è‡ªå·±å•ç‹¬çš„åè®®æ ˆã€‚ å®¹å™¨ç½‘ç»œçš„ç»“æ„å’Œè™šæ‹Ÿæœºå·®ä¸å¤šï¼Œä½†æ˜¯å®ƒæ”¹ç”¨äº† NAT ç½‘ç»œï¼Œå¹¶æŠŠ tun/tap æ¢æˆäº† vethï¼Œå¯¼è‡´ docker0 è¿‡æ¥çš„æ•°æ®ï¼Œè¦å…ˆç»è¿‡å®¿ä¸»æœºåè®®æ ˆï¼Œç„¶åæ‰è¿›å…¥ veth æ¥å£ã€‚ å¤šäº†ä¸€å±‚ NATï¼Œä»¥åŠå¤šèµ°äº†ä¸€å±‚å®¿ä¸»æœºåè®®æ ˆï¼Œéƒ½ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚ ç¤ºæ„å›¾å¦‚ä¸‹ï¼š text +-----------------------------------------------+-----------------------------------+-----------------------------------+ | Host | Container 1 | Container 2 | | | | | | +---------------------------------------+ | +-------------------------+ | +-------------------------+ | | | Network Protocol Stack | | | Network Protocol Stack | | | Network Protocol Stack | | | +----+-------------+--------------------+ | +-----------+-------------+ | +------------+------------+ | | ^ ^ | ^ | ^ | |........|.............|........................|................|..................|.................|.................| | v v â†“ | v | v | | +----+----+ +-----+------+ | +-----+-------+ | +-----+-------+ | | | .31.101 | | 172.17.0.1 | +------+ | | 172.17.0.2 | | | 172.17.0.3 | | | +---------+ +-------------\u003c----\u003e+ veth | | +-------------+ | +-------------+ | | | eth0 | | docker0 | +--+---+ | | eth0(veth) | | | eth0(veth) | | | +----+----+ +-----+------+ ^ | +-----+-------+ | +-----+-------+ | | ^ ^ | | ^ | ^ | | | | +------------------------+ | | | | | v | | | | | | +--+---+ | | | | | | | veth | | | | | | | +--+---+ | | | | | | ^ | | | | | | +------------------------------------------------------------------------------+ | | | | | | | | | | | +-----------------------------------------------+-----------------------------------+-----------------------------------+ v Physical Network (192.168.31.0/24) æ¯åˆ›å»ºä¸€ä¸ªæ–°å®¹å™¨ï¼Œéƒ½ä¼šåœ¨å®¹å™¨çš„ namespace é‡Œæ–°å»ºä¸€ä¸ª veth æ¥å£å¹¶å‘½ä»¤ä¸º eth0ï¼ŒåŒæ—¶åœ¨ä¸» namespace åˆ›å»ºä¸€ä¸ª vethï¼Œå°†å®¹å™¨çš„ eth0 ä¸ docker0 è¿æ¥ã€‚ å¯ä»¥åœ¨å®¹å™¨ä¸­é€šè¿‡ iproute2 æŸ¥çœ‹åˆ°ï¼Œ eth0 çš„æ¥å£ç±»å‹ä¸º vethï¼š shell â¯ docker run -it --rm debian:buster bash root@5facbe4ddc1e:/# ip --details addr ls 1: lo: \u003cLOOPBACK,UP,LOWER_UP\u003e mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 promiscuity 0 minmtu 0 maxmtu 0 numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever 20: eth0@if21: \u003cBROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 qdisc noqueue state UP group default link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0 promiscuity 0 minmtu 68 maxmtu 65535 veth numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535 inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0 valid_lft forever preferred_lft forever åŒæ—¶åœ¨å®¿ä¸»æœºä¸­èƒ½çœ‹åˆ°å¯¹åº”çš„ veth è®¾å¤‡æ˜¯ç»‘å®šåˆ°äº† docker0 ç½‘æ¡¥çš„ï¼š shell â¯ sudo brctl show bridge name bridge id STP enabled interfaces docker0 8000.0242fce99ef5 no vethea4171a ","date":"2021-08-14","objectID":"/posts/linux-virtual-network-interfaces/:3:2","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨"],"title":"Linux ä¸­çš„è™šæ‹Ÿç½‘ç»œæ¥å£","uri":"/posts/linux-virtual-network-interfaces/#è·¨-namespace-é€šä¿¡åœºæ™¯å®¹å™¨ç½‘ç»œnat-æ¨¡å¼"},{"categories":["tech"],"content":" å››ã€macvlan ç›®å‰ docker/podman éƒ½æ”¯æŒåˆ›å»ºåŸºäº macvlan çš„ Linux å®¹å™¨ç½‘ç»œã€‚ æ³¨æ„ macvlan å’Œ WiFi å­˜åœ¨å…¼å®¹é—®é¢˜ï¼Œå¦‚æœä½¿ç”¨ç¬”è®°æœ¬æµ‹è¯•ï¼Œå¯èƒ½ä¼šé‡åˆ°éº»çƒ¦ã€‚ å‚è€ƒæ–‡æ¡£ï¼šlinux ç½‘ç»œè™šæ‹ŸåŒ–ï¼š macvlan macvlan æ˜¯æ¯”è¾ƒæ–°çš„ Linux ç‰¹æ€§ï¼Œéœ€è¦å†…æ ¸ç‰ˆæœ¬ \u003e= 3.9ï¼Œå®ƒè¢«ç”¨äºåœ¨ä¸»æœºçš„ç½‘ç»œæ¥å£ï¼ˆçˆ¶æ¥å£ï¼‰ä¸Šé…ç½®å¤šä¸ªè™šæ‹Ÿå­æ¥å£ï¼Œè¿™äº›å­æ¥å£éƒ½æ‹¥æœ‰å„è‡ªç‹¬ç«‹çš„ mac åœ°å€ï¼Œä¹Ÿå¯ä»¥é…ä¸Š ip åœ°å€è¿›è¡Œé€šè®¯ã€‚ macvlan ä¸‹çš„è™šæ‹Ÿæœºæˆ–è€…å®¹å™¨ç½‘ç»œå’Œä¸»æœºåœ¨åŒä¸€ä¸ªç½‘æ®µä¸­ï¼Œå…±äº«åŒä¸€ä¸ªå¹¿æ’­åŸŸã€‚macvlan å’Œ bridge æ¯”è¾ƒç›¸ä¼¼ï¼Œä½†å› ä¸ºå®ƒçœå»äº† bridge çš„å­˜åœ¨ï¼Œæ‰€ä»¥é…ç½®å’Œè°ƒè¯•èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œè€Œä¸”æ•ˆç‡ä¹Ÿç›¸å¯¹é«˜ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œmacvlan è‡ªèº«ä¹Ÿå®Œç¾æ”¯æŒ VLANã€‚ å¦‚æœå¸Œæœ›å®¹å™¨æˆ–è€…è™šæ‹Ÿæœºæ”¾åœ¨ä¸»æœºç›¸åŒçš„ç½‘ç»œä¸­ï¼Œäº«å—å·²ç»å­˜åœ¨ç½‘ç»œæ ˆçš„å„ç§ä¼˜åŠ¿ï¼Œå¯ä»¥è€ƒè™‘ macvlanã€‚ æˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« å¯¹ docker çš„ macvlan/ipvlan åšä¸ªåˆ†æï¼Œè¿™é‡Œå…ˆç•¥è¿‡äº†â€¦ ","date":"2021-08-14","objectID":"/posts/linux-virtual-network-interfaces/:4:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨"],"title":"Linux ä¸­çš„è™šæ‹Ÿç½‘ç»œæ¥å£","uri":"/posts/linux-virtual-network-interfaces/#å››macvlan"},{"categories":["tech"],"content":" äº”ã€ipvlan linux ç½‘ç»œè™šæ‹ŸåŒ–ï¼š ipvlan cilium 1.9 å·²ç»æä¾›äº†åŸºäº ipvlan çš„ç½‘ç»œï¼ˆbeta ç‰¹æ€§ï¼‰ï¼Œç”¨äºæ›¿æ¢ä¼ ç»Ÿçš„ veth+bridge å®¹å™¨ç½‘ç»œã€‚è¯¦è§IPVLAN based Networking (beta) - Cilium 1.9 Docs ipvlan å’Œ macvlan çš„åŠŸèƒ½å¾ˆç±»ä¼¼ï¼Œä¹Ÿæ˜¯ç”¨äºåœ¨ä¸»æœºçš„ç½‘ç»œæ¥å£ï¼ˆçˆ¶æ¥å£ï¼‰ä¸Šé…ç½®å‡ºå¤šä¸ªè™šæ‹Ÿçš„å­æ¥å£ã€‚ä½†ä¸åŒçš„æ˜¯ï¼Œipvlan çš„å„å­æ¥å£æ²¡æœ‰ç‹¬ç«‹çš„ mac åœ°å€ï¼Œå®ƒä»¬å’Œä¸»æœºçš„çˆ¶æ¥å£å…±äº« mac åœ°å€ã€‚ å› ä¸º mac åœ°å€å…±äº«ï¼Œæ‰€ä»¥å¦‚æœä½¿ç”¨ DHCPï¼Œå°±è¦æ³¨æ„ä¸èƒ½ä½¿ç”¨ mac åœ°å€åš DHCPï¼Œéœ€è¦é¢å¤–é…ç½®å”¯ä¸€çš„ clientID. å¦‚æœä½ é‡åˆ°ä»¥ä¸‹çš„æƒ…å†µï¼Œè¯·è€ƒè™‘ä½¿ç”¨ ipvlanï¼š çˆ¶æ¥å£å¯¹ mac åœ°å€æ•°ç›®æœ‰é™åˆ¶ï¼Œæˆ–è€…åœ¨ mac åœ°å€è¿‡å¤šçš„æƒ…å†µä¸‹ä¼šé€ æˆä¸¥é‡çš„æ€§èƒ½æŸå¤± å·¥ä½œåœ¨ 802.11(wireless)æ— çº¿ç½‘ç»œä¸­ï¼ˆmacvlan æ— æ³•å’Œæ— çº¿ç½‘ç»œå…±åŒå·¥ä½œï¼‰ å¸Œæœ›æ­å»ºæ¯”è¾ƒå¤æ‚çš„ç½‘ç»œæ‹“æ‰‘ï¼ˆä¸æ˜¯ç®€å•çš„äºŒå±‚ç½‘ç»œå’Œ VLANï¼‰ï¼Œæ¯”å¦‚è¦å’Œ BGP ç½‘ç»œä¸€èµ·å·¥ä½œ åŸºäº ipvlan/macvlan çš„å®¹å™¨ç½‘ç»œï¼Œæ¯” veth+bridge+iptables çš„æ€§èƒ½è¦æ›´é«˜ã€‚ æˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« å¯¹ docker çš„ macvlan/ipvlan åšä¸ªåˆ†æï¼Œè¿™é‡Œå…ˆç•¥è¿‡äº†â€¦ ","date":"2021-08-14","objectID":"/posts/linux-virtual-network-interfaces/:5:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨"],"title":"Linux ä¸­çš„è™šæ‹Ÿç½‘ç»œæ¥å£","uri":"/posts/linux-virtual-network-interfaces/#äº”ipvlan"},{"categories":["tech"],"content":" å…­ã€vlanvlan å³è™šæ‹Ÿå±€åŸŸç½‘ï¼Œæ˜¯ä¸€ä¸ªé“¾è·¯å±‚çš„å¹¿æ’­åŸŸéš”ç¦»æŠ€æœ¯ï¼Œå¯ä»¥ç”¨äºåˆ‡åˆ†å±€åŸŸç½‘ï¼Œè§£å†³å¹¿æ’­æ³›æ»¥å’Œå®‰å…¨æ€§é—®é¢˜ã€‚è¢«éš”ç¦»çš„å¹¿æ’­åŸŸä¹‹é—´éœ€è¦ä¸Šå‡åˆ°ç¬¬ä¸‰å±‚æ‰èƒ½å®Œæˆé€šè®¯ã€‚ å¸¸ç”¨çš„ä¼ä¸šè·¯ç”±å™¨å¦‚ ER-X åŸºæœ¬éƒ½å¯ä»¥è®¾ç½® vlanï¼ŒLinux ä¹Ÿç›´æ¥æ”¯æŒäº† vlan. ä»¥å¤ªç½‘æ•°æ®åŒ…æœ‰ä¸€ä¸ªä¸“é—¨çš„å­—æ®µæä¾›ç»™ vlan ä½¿ç”¨ï¼Œvlan æ•°æ®åŒ…ä¼šåœ¨è¯¥ä½ç½®è®°å½•å®ƒçš„ VLAN IDï¼Œäº¤æ¢æœºé€šè¿‡è¯¥ ID æ¥åŒºåˆ†ä¸åŒçš„ VLANï¼Œåªå°†è¯¥ä»¥å¤ªç½‘æŠ¥æ–‡å¹¿æ’­åˆ°è¯¥ ID å¯¹åº”çš„ VLAN ä¸­ã€‚ ","date":"2021-08-14","objectID":"/posts/linux-virtual-network-interfaces/:6:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨"],"title":"Linux ä¸­çš„è™šæ‹Ÿç½‘ç»œæ¥å£","uri":"/posts/linux-virtual-network-interfaces/#å…­vlan"},{"categories":["tech"],"content":" ä¸ƒã€vxlan/geneve rfc8926 - Geneve: Generic Network Virtualization Encapsulation \u003erfc7348 - Virtual eXtensible Local Area Network (VXLAN) linux ä¸Šå®ç° vxlan ç½‘ç»œ åœ¨ä»‹ç» vxlan å‰ï¼Œå…ˆè¯´æ˜ä¸‹ä¸¤ä¸ªåè¯çš„å«ä¹‰ï¼š underlay ç½‘ç»œï¼šå³ç‰©ç†ç½‘ç»œ overlay ç½‘ç»œï¼šæŒ‡åœ¨ç°æœ‰çš„ç‰©ç†ç½‘ç»œä¹‹ä¸Šæ„å»ºçš„è™šæ‹Ÿç½‘ç»œã€‚å…¶å®å°±æ˜¯ä¸€ç§éš§é“æŠ€æœ¯ï¼Œå°†åŸç”Ÿæ€çš„äºŒå±‚æ•°æ®å¸§æŠ¥æ–‡è¿›è¡Œå°è£…åé€šè¿‡éš§é“è¿›è¡Œä¼ è¾“ã€‚ vxlan ä¸ geneve éƒ½æ˜¯ overlay ç½‘ç»œåè®®ï¼Œå®ƒä¿©éƒ½æ˜¯ä½¿ç”¨ UDP åŒ…æ¥å°è£…é“¾è·¯å±‚çš„ä»¥å¤ªç½‘å¸§ã€‚ vxlan åœ¨ 2014 å¹´æ ‡å‡†åŒ–ï¼Œè€Œ geneve åœ¨ 2020 å¹´åº•æ‰é€šè¿‡è‰æ¡ˆé˜¶æ®µï¼Œç›®å‰å°šæœªå½¢æˆæœ€ç»ˆæ ‡å‡†ã€‚ä½†æ˜¯ç›®å‰ linux/cilium éƒ½å·²ç»æ”¯æŒäº† geneve. geneve ç›¸å¯¹ vxlan æœ€å¤§çš„å˜åŒ–ï¼Œæ˜¯å®ƒæ›´çµæ´»â€”â€”å®ƒçš„ header é•¿åº¦æ˜¯å¯å˜çš„ã€‚ ç›®å‰æ‰€æœ‰ overlay çš„è·¨ä¸»æœºå®¹å™¨ç½‘ç»œæ–¹æ¡ˆï¼Œå‡ ä¹éƒ½æ˜¯åŸºäº vxlan å®ç°çš„ï¼ˆä¾‹å¤–ï¼šcilium ä¹Ÿæ”¯æŒ geneveï¼‰ã€‚ æˆ‘ä»¬åœ¨å­¦ä¹ å•æœºçš„å®¹å™¨ç½‘ç»œæ—¶ï¼Œä¸éœ€è¦æ¥è§¦åˆ° vxlanï¼Œä½†æ˜¯åœ¨å­¦ä¹ è·¨ä¸»æœºå®¹å™¨ç½‘ç»œæ–¹æ¡ˆå¦‚ flannel/calico/cilium æ—¶ï¼Œé‚£ vxlan(overlay) åŠ BGP(underlay) å°±ä¸å¯é¿å…åœ°è¦æ¥è§¦äº†ã€‚ å…ˆä»‹ç»ä¸‹ vxlan çš„æ•°æ®åŒ…ç»“æ„ï¼š VXLAN æ ˆå¸§ç»“æ„ åœ¨åˆ›å»º vxlan çš„ vtep è™šæ‹Ÿè®¾å¤‡æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨è®¾ç½®å›¾ä¸­çš„å¦‚ä¸‹å±æ€§ï¼š VXLAN ç›®æ ‡ç«¯å£ï¼šå³æ¥æ”¶æ–¹ vtep ä½¿ç”¨çš„ç«¯å£ï¼Œè¿™é‡Œ IANA å®šä¹‰çš„ç«¯å£æ˜¯ 4789ï¼Œä½†æ˜¯åªæœ‰ calico çš„ vxlan æ¨¡å¼é»˜è®¤ä½¿ç”¨è¯¥ç«¯å£ calicoï¼Œè€Œ cilium/flannel çš„é»˜è®¤ç«¯å£éƒ½æ˜¯ Linux é»˜è®¤çš„ 8472. VNID: æ¯ä¸ª VXLAN ç½‘ç»œæ¥å£éƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ªç‹¬ç«‹çš„ VNID ä¸€ä¸ªç‚¹å¯¹ç‚¹çš„ vxlan ç½‘ç»œæ¶æ„å›¾å¦‚ä¸‹: VXLAN ç‚¹å¯¹ç‚¹ç½‘ç»œæ¶æ„ å¯ä»¥çœ‹åˆ°æ¯å°è™šæ‹Ÿæœº VM éƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„ VNIDï¼Œç„¶åä¸¤å°ç‰©ç†æœºä¹‹é—´é€šè¿‡ VTEP è™šæ‹Ÿç½‘ç»œè®¾å¤‡å»ºç«‹äº† VXLAN éš§é“ï¼Œæ‰€æœ‰ VXLAN ç½‘ç»œä¸­çš„è™šæ‹Ÿæœºï¼Œéƒ½é€šè¿‡ VTEP æ¥äº’ç›¸é€šä¿¡ã€‚ æœ‰äº†ä¸Šé¢è¿™äº›çŸ¥è¯†ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤åœ¨ä¸¤å° Linux æœºå™¨é—´å»ºç«‹ä¸€ä¸ªç‚¹å¯¹ç‚¹çš„ VXLAN éš§é“ï¼š shell # åœ¨ä¸»æœº A ä¸Šåˆ›å»º VTEP è®¾å¤‡ vxlan0 # ä¸å¦ä¸€ä¸ª vtep æ¥å£ Bï¼ˆ192.168.8.101ï¼‰å»ºç«‹éš§é“ # å°† vxlan0 è‡ªèº«çš„ IP åœ°å€è®¾ä¸º 192.168.8.100 # ä½¿ç”¨çš„ VXLAN ç›®æ ‡ç«¯å£ä¸º 4789(IANA æ ‡å‡†) ip link add vxlan0 type vxlan \\ id 42 \\ dstport 4789 \\ remote 192.168.8.101 \\ local 192.168.8.100 \\ dev enp0s8 # ä¸ºæˆ‘ä»¬çš„ VXLAN ç½‘ç»œè®¾ç½®è™šæ‹Ÿç½‘æ®µï¼Œvxlan0 å°±æ˜¯é»˜è®¤ç½‘å…³ ip addr add 10.20.1.2/24 dev vxlan0 # å¯ç”¨æˆ‘ä»¬çš„ vxlan0 è®¾å¤‡ï¼Œè¿™ä¼šè‡ªåŠ¨ç”Ÿæˆè·¯ç”±è§„åˆ™ ip link set vxlan0 up # ç°åœ¨åœ¨ä¸»æœº B ä¸Šè¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼ŒåŒæ ·åˆ›å»ºä¸€ä¸ª VTEP è®¾å¤‡ vxlan0ï¼Œremote å’Œ local çš„ ip ä¸å‰é¢ç”¨çš„å‘½ä»¤åˆšå¥½ç›¸åã€‚ # æ³¨æ„ VNID å’Œ dstport å¿…é¡»å’Œå‰é¢å®Œå…¨ä¸€è‡´ ip link add vxlan0 type vxlan \\ id 42 \\ dstport 4789 \\ remote 192.168.8.100 \\ local 192.168.8.101 \\ dev enp0s8 # ä¸ºæˆ‘ä»¬çš„ VXLAN ç½‘ç»œè®¾ç½®è™šæ‹Ÿç½‘æ®µï¼Œvxlan0 å°±æ˜¯é»˜è®¤ç½‘å…³ ip addr add 10.20.1.3/24 dev vxlan0 ip link set vxlan0 up # åˆ°è¿™é‡Œï¼Œä¸¤å°æœºå™¨å°±å®Œæˆè¿æ¥ï¼Œå¯ä»¥é€šä¿¡äº†ã€‚å¯ä»¥åœ¨ä¸»æœº B ä¸Š ping 10.20.1.2 è¯•è¯•ï¼Œåº”è¯¥èƒ½æ”¶åˆ°ä¸»æœº A çš„å›åº”ã€‚ ping 10.20.1.2 ç‚¹å¯¹ç‚¹çš„ vxlan éš§é“å®é™…ç”¨å¤„ä¸å¤§ï¼Œå¦‚æœé›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½äº’ç›¸å»º vxlan éš§é“ï¼Œä»£ä»·å¤ªé«˜äº†ã€‚ ä¸€ç§æ›´å¥½çš„æ–¹å¼ï¼Œæ˜¯ä½¿ç”¨ ã€Œç»„æ’­æ¨¡å¼ã€çš„ vxlan éš§é“ï¼Œè¿™ç§æ¨¡å¼ä¸‹ä¸€ä¸ª vtep å¯ä»¥ä¸€æ¬¡ä¸ç»„å†…çš„æ‰€æœ‰ vtep å»ºç«‹éš§é“ã€‚ç¤ºä¾‹å‘½ä»¤å¦‚ä¸‹ï¼ˆè¿™é‡Œç•¥è¿‡äº†å¦‚ä½•è®¾ç½®ç»„æ’­åœ°å€ 239.1.1.1 çš„ä¿¡æ¯ï¼‰ï¼š shell ip link add vxlan0 type vxlan \\ id 42 \\ dstport 4789 \\ group 239.1.1.1 \\ dev enp0s8 ip addr add 10.20.1.2/24 dev vxlan0 ip link set vxlan0 up å¯ä»¥çœ‹åˆ°ï¼Œåªéœ€è¦ç®€å•åœ°æŠŠ local_ip/remote_ip æ›¿æ¢æˆä¸€ä¸ªç»„æ’­åœ°å€å°±è¡Œã€‚ç»„æ’­åŠŸèƒ½ä¼šå°†æ”¶åˆ°çš„æ•°æ®åŒ…å‘é€ç»™ç»„é‡Œçš„æ‰€æœ‰ vtep æ¥å£ï¼Œä½†æ˜¯åªæœ‰ VNID èƒ½å¯¹ä¸Šçš„ vtep ä¼šå¤„ç†è¯¥æŠ¥æ–‡ï¼Œå…¶ä»– vtep ä¼šç›´æ¥ä¸¢å¼ƒæ•°æ®ã€‚ æ¥ä¸‹æ¥ï¼Œä¸ºäº†èƒ½è®©æ‰€æœ‰çš„è™šæ‹Ÿæœº/å®¹å™¨ï¼Œéƒ½é€šè¿‡ vtep é€šä¿¡ï¼Œæˆ‘ä»¬å†æ·»åŠ ä¸€ä¸ª bridge ç½‘ç»œï¼Œå……å½“ vtep ä¸å®¹å™¨é—´çš„äº¤æ¢æœºã€‚æ¶æ„å¦‚ä¸‹ï¼š VXLAN å¤šæ’­ç½‘ç»œæ¶æ„ ä½¿ç”¨ ip å‘½ä»¤åˆ›å»ºç½‘æ¡¥ã€ç½‘ç»œåå­—ç©ºé—´ã€veth pairs ç»„æˆä¸Šå›¾ä¸­çš„å®¹å™¨ç½‘ç»œï¼š shell # åˆ›å»º br0 å¹¶å°† vxlan0 ç»‘å®šä¸Šå» ip link add br0 type bridge ip link set vxlan0 master br0 ip link set vxlan0 up ip link set br0 up # æ¨¡æ‹Ÿå°†å®¹å™¨åŠ å…¥åˆ°ç½‘æ¡¥ä¸­çš„æ“ä½œ ip netns add container1 ## åˆ›å»º veth pairï¼Œå¹¶æŠŠä¸€ç«¯åŠ åˆ°ç½‘æ¡¥ä¸Š ip link add veth0 type veth peer name veth1 ip link set dev veth0 master br0 ip link set dev veth0 up ## é…ç½®å®¹å™¨å†…éƒ¨çš„ç½‘ç»œå’Œ IP ip link set dev veth1 netns container1 ip netns exec container1 ip link set lo up ip netns exec container1 ip link set veth1 name eth0 ip netns exec container1 ip addr add 10.20.1.11/24 dev eth0 ip netns exec container1 ip link set eth0 up ç„¶ååœ¨å¦ä¸€å°æœºå™¨ä¸ŠåšåŒæ ·çš„æ“ä½œï¼Œå¹¶åˆ›å»ºæ–°å®¹å™¨ï¼Œä¸¤ä¸ªå®¹å™¨å°±èƒ½é€šè¿‡ vxlan é€šä¿¡å•¦~ ","date":"2021-08-14","objectID":"/posts/linux-virtual-network-interfaces/:7:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨"],"title":"Linux ä¸­çš„è™šæ‹Ÿç½‘ç»œæ¥å£","uri":"/posts/linux-virtual-network-interfaces/#vxlan-geneve"},{"categories":["tech"],"content":" æ¯”ç»„æ’­æ›´é«˜æ•ˆçš„ vxlan å®ç°ç»„æ’­æœ€å¤§çš„é—®é¢˜åœ¨äºï¼Œå› ä¸ºå®ƒä¸çŸ¥é“æ•°æ®çš„ç›®çš„åœ°ï¼Œæ‰€ä»¥æ¯ä¸ª vtep éƒ½å‘äº†ä¸€ä»½ã€‚å¦‚æœæ¯æ¬¡å‘æ•°æ®æ—¶ï¼Œ å¦‚æœèƒ½å¤Ÿç²¾ç¡®åˆ°å¯¹åº”çš„ vtepï¼Œå°±èƒ½èŠ‚çº¦å¤§é‡èµ„æºã€‚ å¦ä¸€ä¸ªé—®é¢˜æ˜¯ ARP æŸ¥è¯¢ä¹Ÿä¼šè¢«ç»„æ’­ï¼Œè¦çŸ¥é“ vxlan æœ¬èº«å°±æ˜¯ä¸ª overlay ç½‘ç»œï¼ŒARP çš„æˆæœ¬ä¹Ÿå¾ˆé«˜ã€‚ ä¸Šè¿°é—®é¢˜éƒ½å¯ä»¥é€šè¿‡ä¸€ä¸ªä¸­å¿ƒåŒ–çš„æ³¨å†Œä¸­å¿ƒï¼ˆå¦‚ etcdï¼‰æ¥è§£å†³ï¼Œæ‰€æœ‰å®¹å™¨ã€ç½‘ç»œçš„æ³¨å†Œä¸å˜æ›´ï¼Œéƒ½å†™å…¥åˆ°è¿™ä¸ªæ³¨å†Œä¸­å¿ƒï¼Œç„¶åç”±ç¨‹åºè‡ªåŠ¨ç»´æŠ¤ vtep ä¹‹é—´çš„éš§é“ã€fdb è¡¨åŠ ARP è¡¨. ","date":"2021-08-14","objectID":"/posts/linux-virtual-network-interfaces/:7:1","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨"],"title":"Linux ä¸­çš„è™šæ‹Ÿç½‘ç»œæ¥å£","uri":"/posts/linux-virtual-network-interfaces/#æ¯”ç»„æ’­æ›´é«˜æ•ˆçš„-vxlan-å®ç°"},{"categories":["tech"],"content":" å…«ã€è™šæ‹Ÿç½‘ç»œæ¥å£çš„é€Ÿç‡Loopback å’Œæœ¬ç« è®²åˆ°çš„å…¶ä»–è™šæ‹Ÿç½‘ç»œæ¥å£ä¸€æ ·ï¼Œéƒ½æ˜¯ä¸€ç§è½¯ä»¶æ¨¡æ‹Ÿçš„ç½‘ç»œè®¾å¤‡ã€‚ä»–ä»¬çš„é€Ÿç‡æ˜¯ä¸æ˜¯ä¹Ÿåƒç‰©ç†é“¾è·¯ä¸€æ ·ï¼Œå­˜åœ¨é“¾è·¯å±‚ï¼ˆæ¯”å¦‚ä»¥å¤ªç½‘ï¼‰åè®®çš„å¸¦å®½é™åˆ¶å‘¢ï¼Ÿ æ¯”å¦‚ç›®å‰å¾ˆå¤šè€æ—§çš„ç½‘ç»œè®¾å¤‡ï¼Œéƒ½æ˜¯åªæ”¯æŒåˆ°ç™¾å…†ä»¥å¤ªç½‘ï¼Œè¿™å°±å†³å®šäº†å®ƒçš„å¸¦å®½ä¸Šé™ã€‚å³ä½¿æ˜¯è¾ƒæ–°çš„è®¾å¤‡ï¼Œç›®å‰åŸºæœ¬ä¹Ÿéƒ½åªæ”¯æŒåˆ°åƒå…†ï¼Œä¹Ÿå°±æ˜¯ 1GbE ä»¥å¤ªç½‘æ ‡å‡†ï¼Œé‚£æœ¬æ–‡æåˆ°çš„è™šæ‹Ÿç½‘ç»œæ¥å£å•çº¯åœ¨æœ¬æœºå†…éƒ¨é€šä¿¡ï¼Œæ˜¯å¦ä¹Ÿå­˜åœ¨è¿™æ ·çš„åˆ¶çº¦å‘¢ï¼Ÿæ˜¯å¦ä¹Ÿåªèƒ½è·‘åˆ° 1GbE? å¦å¤–ç‰©ç†ç½‘ç»œè¿˜å­˜åœ¨é“¾è·¯å±‚åè®®åå•†æœºåˆ¶ï¼Œå°†ä¸€ä¸ªåƒå…†æ¥å£ä¸ä¸€ä¸ªç™¾å…†æ¥å£è¿æ¥ï¼Œå®ƒä»¬ä¼šè‡ªåŠ¨åå•†ä½¿ç”¨ç™¾å…†ä»¥å¤ªç½‘æ ‡å‡†è¿›è¡Œé€šè®¯ã€‚è™šæ‹Ÿç½‘ç»œæ¥å£æ˜¯å¦ä¹Ÿå­˜åœ¨è¿™æ ·çš„æœºåˆ¶å‘¢ï¼Ÿ å…ˆä½¿ç”¨ ethtool æ£€æŸ¥çœ‹çœ‹ï¼š text # docker å®¹å™¨çš„ veth æ¥å£é€Ÿç‡ \u003e ethtool vethe899841 | grep Speed Speed: 10000Mb/s # ç½‘æ¡¥çœ‹èµ·æ¥æ²¡æœ‰å›ºå®šçš„é€Ÿç‡ \u003e ethtool docker0 | grep Speed Speed: Unknown! # tun0 è®¾å¤‡çš„é»˜è®¤é€Ÿç‡è²Œä¼¼æ˜¯ 10Mb/s ? \u003e ethtool tun0 | grep Speed Speed: 10Mb/s # æ­¤å¤– ethtool æ— æ³•æ£€æŸ¥ lo ä»¥åŠ wifi çš„é€Ÿç‡ï¼Œå…ˆç•¥è¿‡ä¸æ ä»ä¸Šé¢çš„è¾“å‡ºèƒ½çœ‹åˆ°ï¼Œè™šæ‹Ÿæ¥å£çš„ Speed å±æ€§éƒ½æœ‰ç‚¹ç¦»è°±ï¼Œveth æ¥å£æ˜¾ç¤º 10Gb/sï¼Œtun0 æ›´æ˜¯ç¦»è°±çš„ 10Mb/s. é‚£ä¹ˆäº‹å®çœŸçš„å¦‚æ­¤ä¹ˆï¼Ÿè¯ä¸å¤šè¯´ï¼Œå…ˆå®æµ‹ä¸€æ³¢ã€‚ ","date":"2021-08-14","objectID":"/posts/linux-virtual-network-interfaces/:8:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨"],"title":"Linux ä¸­çš„è™šæ‹Ÿç½‘ç»œæ¥å£","uri":"/posts/linux-virtual-network-interfaces/#å…«è™šæ‹Ÿç½‘ç»œæ¥å£çš„é€Ÿç‡"},{"categories":["tech"],"content":" ç½‘ç»œæ€§èƒ½å®æµ‹æ¥ä¸‹æ¥å®é™…æµ‹è¯•ä¸€ä¸‹ï¼Œå—å…ˆç»™å‡ºæµ‹è¯•æœºçš„é…ç½®ï¼š text â¯ cat /etc/os-release NAME=\"openSUSE Tumbleweed\" # VERSION=\"20210810\" ... â¯ uname -a Linux legion-book 5.13.8-1-default #1 SMP Thu Aug 5 08:56:22 UTC 2021 (967c6a8) x86_64 x86_64 x86_64 GNU/Linux â¯ lscpu Architecture: x86_64 CPU(s): 16 Model name: AMD Ryzen 7 5800H with Radeon Graphics ... # å†…å­˜ï¼Œå•ä½ MB â¯ free -m total used free shared buff/cache available Mem: 27929 4482 17324 249 6122 22797 Swap: 2048 0 2048 å¥½äº†ï¼Œç°åœ¨ä½¿ç”¨ iperf3 æµ‹è¯•ï¼š shell # å¯åŠ¨æœåŠ¡ç«¯ iperf3 -s ------------- # æ–°çª—å£å¯åŠ¨å®¢æˆ·ç«¯ï¼Œé€šè¿‡ loopback æ¥å£è®¿é—® iperf3-serverï¼Œå¤§æ¦‚ 49Gb/s â¯ iperf3 -c 127.0.0.1 Connecting to host 127.0.0.1, port 5201 [ 5] local 127.0.0.1 port 48656 connected to 127.0.0.1 port 5201 [ ID] Interval Transfer Bitrate Retr Cwnd [ 5] 0.00-1.00 sec 4.46 GBytes 38.3 Gbits/sec 0 1.62 MBytes [ 5] 1.00-2.00 sec 4.61 GBytes 39.6 Gbits/sec 0 1.62 MBytes [ 5] 2.00-3.00 sec 5.69 GBytes 48.9 Gbits/sec 0 1.62 MBytes [ 5] 3.00-4.00 sec 6.11 GBytes 52.5 Gbits/sec 0 1.62 MBytes [ 5] 4.00-5.00 sec 6.04 GBytes 51.9 Gbits/sec 0 1.62 MBytes [ 5] 5.00-6.00 sec 6.05 GBytes 52.0 Gbits/sec 0 1.62 MBytes [ 5] 6.00-7.00 sec 6.01 GBytes 51.6 Gbits/sec 0 1.62 MBytes [ 5] 7.00-8.00 sec 6.05 GBytes 52.0 Gbits/sec 0 1.62 MBytes [ 5] 8.00-9.00 sec 6.34 GBytes 54.5 Gbits/sec 0 1.62 MBytes [ 5] 9.00-10.00 sec 5.91 GBytes 50.8 Gbits/sec 0 1.62 MBytes - - - - - - - - - - - - - - - - - - - - - - - - - [ ID] Interval Transfer Bitrate Retr [ 5] 0.00-10.00 sec 57.3 GBytes 49.2 Gbits/sec 0 sender [ 5] 0.00-10.00 sec 57.3 GBytes 49.2 Gbits/sec receiver # å®¢æˆ·ç«¯é€šè¿‡ wlp4s0 wifi ç½‘å¡(192.168.31.228)è®¿é—® iperf3-serverï¼Œå®é™…è¿˜æ˜¯èµ°çš„æœ¬æœºï¼Œä½†æ˜¯é€Ÿåº¦è¦æ¯” loopback å¿«ä¸€ç‚¹ï¼Œå¯èƒ½æ˜¯é»˜è®¤è®¾ç½®çš„é—®é¢˜ â¯ iperf3 -c 192.168.31.228 Connecting to host 192.168.31.228, port 5201 [ 5] local 192.168.31.228 port 43430 connected to 192.168.31.228 port 5201 [ ID] Interval Transfer Bitrate Retr Cwnd [ 5] 0.00-1.00 sec 5.12 GBytes 43.9 Gbits/sec 0 1.25 MBytes [ 5] 1.00-2.00 sec 5.29 GBytes 45.5 Gbits/sec 0 1.25 MBytes [ 5] 2.00-3.00 sec 5.92 GBytes 50.9 Gbits/sec 0 1.25 MBytes [ 5] 3.00-4.00 sec 6.00 GBytes 51.5 Gbits/sec 0 1.25 MBytes [ 5] 4.00-5.00 sec 5.98 GBytes 51.4 Gbits/sec 0 1.25 MBytes [ 5] 5.00-6.00 sec 6.05 GBytes 52.0 Gbits/sec 0 1.25 MBytes [ 5] 6.00-7.00 sec 6.16 GBytes 52.9 Gbits/sec 0 1.25 MBytes [ 5] 7.00-8.00 sec 6.08 GBytes 52.2 Gbits/sec 0 1.25 MBytes [ 5] 8.00-9.00 sec 6.00 GBytes 51.6 Gbits/sec 0 1.25 MBytes [ 5] 9.00-10.00 sec 6.01 GBytes 51.6 Gbits/sec 0 1.25 MBytes - - - - - - - - - - - - - - - - - - - - - - - - - [ ID] Interval Transfer Bitrate Retr [ 5] 0.00-10.00 sec 58.6 GBytes 50.3 Gbits/sec 0 sender [ 5] 0.00-10.00 sec 58.6 GBytes 50.3 Gbits/sec receiver # ä»å®¹å™¨ä¸­è®¿é—®å®¿ä¸»æœºçš„ iperf3-serverï¼Œé€Ÿåº¦å‡ ä¹æ²¡åŒºåˆ« â¯ docker run -it --rm --name=iperf3-server networkstatic/iperf3 -c 192.168.31.228 Connecting to host 192.168.31.228, port 5201 [ 5] local 172.17.0.2 port 43436 connected to 192.168.31.228 port 5201 [ ID] Interval Transfer Bitrate Retr Cwnd [ 5] 0.00-1.00 sec 4.49 GBytes 38.5 Gbits/sec 0 403 KBytes [ 5] 1.00-2.00 sec 5.31 GBytes 45.6 Gbits/sec 0 544 KBytes [ 5] 2.00-3.00 sec 6.14 GBytes 52.8 Gbits/sec 0 544 KBytes [ 5] 3.00-4.00 sec 5.85 GBytes 50.3 Gbits/sec 0 544 KBytes [ 5] 4.00-5.00 sec 6.14 GBytes 52.7 Gbits/sec 0 544 KBytes [ 5] 5.00-6.00 sec 5.99 GBytes 51.5 Gbits/sec 0 544 KBytes [ 5] 6.00-7.00 sec 5.86 GBytes 50.4 Gbits/sec 0 544 KBytes [ 5] 7.00-8.00 sec 6.05 GBytes 52.0 Gbits/sec 0 544 KBytes [ 5] 8.00-9.00 sec 5.99 GBytes 51.5 Gbits/sec 0 544 KBytes [ 5] 9.00-10.00 sec 6.12 GBytes 52.5 Gbits/sec 0 544 KBytes - - - - - - - - - - - - - - - - - - - - - - - - - [ ID] Interval Transfer Bitrate Retr [ 5] 0.00-10.00 sec 58.0 GBytes 49.8 Gbits/sec 0 sender [ 5] 0.00-10.00 sec 58.0 GBytes 49.8 Gbits/sec receiver æŠŠ iperf3-server è·‘åœ¨å®¹å™¨é‡Œå†æµ‹ä¸€éï¼š shell # åœ¨å®¹å™¨ä¸­å¯åŠ¨ iperf3-serverï¼Œå¹¶æ˜ å°„åˆ°å®¿ä¸»æœºç«¯å£ 6201 \u003e docker run -it --rm --name=iperf3-server -p 6201:5201 networkstatic/iperf3 -s \u003e docker inspect --format \"{{ .NetworkSettings.IPAddress }}\" iperf3-server 172.17.0.2 ----------------------------- # æµ‹è¯•å®¹å™¨ä¹‹é—´äº’è®¿çš„é€Ÿåº¦ï¼Œip ä¸º iperf3-server çš„å®¹å™¨ ipï¼Œé€Ÿåº¦è¦æ…¢ä¸€äº›ã€‚ # æ¯•ç«Ÿè¿‡äº† veth -","date":"2021-08-14","objectID":"/posts/linux-virtual-network-interfaces/:8:1","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨"],"title":"Linux ä¸­çš„è™šæ‹Ÿç½‘ç»œæ¥å£","uri":"/posts/linux-virtual-network-interfaces/#ç½‘ç»œæ€§èƒ½å®æµ‹"},{"categories":["tech"],"content":" å‚è€ƒ Linuxè™šæ‹Ÿç½‘ç»œè®¾å¤‡ä¹‹tun/tap Linuxè™šæ‹Ÿç½‘ç»œè®¾å¤‡ä¹‹veth äº‘è®¡ç®—åº•å±‚æŠ€æœ¯-è™šæ‹Ÿç½‘ç»œè®¾å¤‡(Bridge,VLAN) äº‘è®¡ç®—åº•å±‚æŠ€æœ¯-è™šæ‹Ÿç½‘ç»œè®¾å¤‡(tun/tap,veth) Universal TUN/TAP device driver - Kernel Docs Tun/Tap interface tutorial Linux Loopback performance with TCP_NODELAY enabled ","date":"2021-08-14","objectID":"/posts/linux-virtual-network-interfaces/:9:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["Linux","ç½‘ç»œ","è™šæ‹ŸåŒ–","å®¹å™¨"],"title":"Linux ä¸­çš„è™šæ‹Ÿç½‘ç»œæ¥å£","uri":"/posts/linux-virtual-network-interfaces/#å‚è€ƒ"},{"categories":["tech"],"content":" æ–‡ä¸­çš„å‘½ä»¤å‡åœ¨ macOS Big Sure å’Œ openSUSE Tumbleweed ä¸Šæµ‹è¯•é€šè¿‡ ","date":"2021-04-11","objectID":"/posts/socat-netcat/:0:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["ç½‘ç»œ","Linux","ç½‘ç»œè°ƒè¯•"],"title":"Linux ç½‘ç»œå·¥å…·ä¸­çš„ç‘å£«å†›åˆ€ - socat \u0026 netcat","uri":"/posts/socat-netcat/#"},{"categories":["tech"],"content":" socat \u0026 netcatnetcat(network cat) æ˜¯ä¸€ä¸ªå†å²æ‚ ä¹…çš„ç½‘ç»œå·¥å…·åŒ…ï¼Œè¢«ç§°ä½œ TCP/IP çš„ç‘å£«å†›åˆ€ï¼Œå„å¤§ Linux å‘è¡Œç‰ˆéƒ½æœ‰é»˜è®¤å®‰è£… openbsd ç‰ˆæœ¬çš„ netcatï¼Œå®ƒçš„å‘½ä»¤è¡Œåç§°ä¸º nc. è€Œ socat(socket cat)ï¼Œå®˜æ–¹æ–‡æ¡£æè¿°å®ƒæ˜¯\"netcat++\" (extended design, new implementation)ï¼Œé¡¹ç›®æ¯”è¾ƒæ´»è·ƒï¼Œkubernetes-client(kubectl) åº•å±‚å°±æ˜¯ä½¿ç”¨çš„å®ƒåšå„ç§æµé‡è½¬å‘ã€‚ åœ¨ä¸æ–¹ä¾¿å®‰è£… socat çš„ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„ netcat. è€Œåœ¨å…¶ä»–ç¯å¢ƒï¼Œå¯ä»¥è€ƒè™‘ä¼˜å…ˆä½¿ç”¨ socat. ","date":"2021-04-11","objectID":"/posts/socat-netcat/:1:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["ç½‘ç»œ","Linux","ç½‘ç»œè°ƒè¯•"],"title":"Linux ç½‘ç»œå·¥å…·ä¸­çš„ç‘å£«å†›åˆ€ - socat \u0026 netcat","uri":"/posts/socat-netcat/#socat--netcat"},{"categories":["tech"],"content":" ä¸€ã€ç®€ä»‹socat çš„åŸºæœ¬å‘½ä»¤æ ¼å¼ï¼š shell socat [å‚æ•°] åœ°å€1 åœ°å€2 ç»™ socat æä¾›ä¸¤ä¸ªåœ°å€ï¼Œsocat å¹²çš„æ´»å°±æ˜¯æŠŠä¸¤ä¸ªåœ°å€çš„æµå¯¹æ¥èµ·æ¥ã€‚å·¦è¾¹åœ°å€çš„è¾“å‡ºä¼ ç»™å³è¾¹ï¼ŒåŒæ—¶åˆæŠŠå³è¾¹åœ°å€çš„è¾“å‡ºä¼ ç»™å·¦è¾¹ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªåŒå‘çš„æ•°æ®ç®¡é“ã€‚ å¬èµ·æ¥å¥½åƒæ²¡å•¥ç‰¹åˆ«çš„ï¼Œä½†æ˜¯å®é™…ä¸Šè®¡ç®—æœºç½‘ç»œå¹²çš„æ´»ä¹Ÿå°±æ˜¯æ•°æ®ä¼ è¾“è€Œå·²ï¼Œå´å½±å“äº†æ•´ä¸ªä¸–ç•Œï¼Œä¸å¯å°è§‘å®ƒçš„åŠŸèƒ½ã€‚ socat æ”¯æŒéå¸¸å¤šçš„åœ°å€ç±»å‹ï¼š-/stdioï¼ŒTCP, TCP-LISTEN, UDP, UDP-LISTEN, OPEN, EXEC, SOCKS, PROXY ç­‰ç­‰ï¼Œå¯ç”¨äºç«¯å£ç›‘å¬ã€é“¾æ¥ï¼Œæ–‡ä»¶å’Œè¿›ç¨‹è¯»å†™ï¼Œä»£ç†æ¡¥æ¥ç­‰ç­‰ã€‚ socat çš„åŠŸèƒ½å°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œå‘½ä»¤è¡Œå‚æ•°ä¹Ÿå¾ˆç®€æ´ï¼Œå”¯ä¸€éœ€è¦èŠ±ç‚¹ç²¾åŠ›å­¦ä¹ çš„å°±æ˜¯å®ƒå„ç§åœ°å€çš„å®šä¹‰å’Œæ­é…å†™æ³•ã€‚ è€Œ netcat å®šä¹‰è²Œä¼¼æ²¡è¿™ä¹ˆä¸¥è°¨ï¼Œå¯ä»¥ç®€å•çš„ç†è§£ä¸ºç½‘ç»œç‰ˆçš„ cat å‘½ä»¤ 2333 ","date":"2021-04-11","objectID":"/posts/socat-netcat/:2:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["ç½‘ç»œ","Linux","ç½‘ç»œè°ƒè¯•"],"title":"Linux ç½‘ç»œå·¥å…·ä¸­çš„ç‘å£«å†›åˆ€ - socat \u0026 netcat","uri":"/posts/socat-netcat/#ä¸€ç®€ä»‹"},{"categories":["tech"],"content":" äºŒã€å®‰è£…æ–¹æ³•å„å‘è¡Œç‰ˆéƒ½è‡ªå¸¦ netcatï¼ŒåŒ…åé€šå¸¸ä¸º nc-openbsdï¼Œå› æ­¤è¿™é‡Œåªä»‹ç» socat çš„å®‰è£…æ–¹æ³•ï¼š shell # Debian/Ubuntu sudo apt install socat # CentOS/RedHat sudo yum install socat # macOS brew install socat å…¶ä»–å‘è¡Œç‰ˆåŸºæœ¬ä¹Ÿéƒ½å¯ä»¥ä½¿ç”¨åŒ…ç®¡ç†å™¨å®‰è£… socat ","date":"2021-04-11","objectID":"/posts/socat-netcat/:3:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["ç½‘ç»œ","Linux","ç½‘ç»œè°ƒè¯•"],"title":"Linux ç½‘ç»œå·¥å…·ä¸­çš„ç‘å£«å†›åˆ€ - socat \u0026 netcat","uri":"/posts/socat-netcat/#äºŒå®‰è£…æ–¹æ³•"},{"categories":["tech"],"content":" ä¸‰ã€å¸¸ç”¨å‘½ä»¤","date":"2021-04-11","objectID":"/posts/socat-netcat/:4:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["ç½‘ç»œ","Linux","ç½‘ç»œè°ƒè¯•"],"title":"Linux ç½‘ç»œå·¥å…·ä¸­çš„ç‘å£«å†›åˆ€ - socat \u0026 netcat","uri":"/posts/socat-netcat/#ä¸‰å¸¸ç”¨å‘½ä»¤"},{"categories":["tech"],"content":" 1. æ£€æµ‹è¿œç¨‹ç«¯å£çš„å¯è¿æ¥æ€§ å¾ˆå¤šäººä¼šç”¨ telnet æ¥åšè¿™é¡¹æµ‹è¯•ï¼Œä¸è¿‡ç°åœ¨å¾ˆå¤šå‘è¡Œç‰ˆåŸºæœ¬éƒ½ä¸è‡ªå¸¦ telnet äº†ï¼Œè¿˜éœ€è¦é¢å¤–å®‰è£…ã€‚telnet å·®ä¸å¤šå·²ç»å¿«å¯¿ç»ˆæ­£å¯äº†ï¼Œè¿˜æ˜¯å»ºè®®ä½¿ç”¨æ›´ä¸“ä¸šçš„ socat/netcat ä½¿ç”¨ socat/netcat æ£€æµ‹è¿œç¨‹ç«¯å£çš„å¯è¿æ¥æ€§ï¼š shell # -d[ddd] å¢åŠ æ—¥å¿—è¯¦ç»†ç¨‹åº¦ï¼Œ-dd Prints fatal, error, warning, and notice messages. socat -dd - TCP:192.168.1.252:3306 # -v æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ # -z ä¸å‘é€æ•°æ®ï¼Œæ•ˆæœä¸ºç«‹å³å…³é—­è¿æ¥ï¼Œå¿«é€Ÿå¾—å‡ºç»“æœ nc -vz 192.168.1.2 8080 # -vv æ˜¾ç¤ºæ›´è¯¦ç»†çš„å†…å®¹ # -w2 è¶…æ—¶æ—¶é—´è®¾ä¸º 2 ç§’ # ä½¿ç”¨ nc åšç®€å•çš„ç«¯å£æ‰«æ nc -vv -w2 -z 192.168.1.2 20-500 ","date":"2021-04-11","objectID":"/posts/socat-netcat/:4:1","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["ç½‘ç»œ","Linux","ç½‘ç»œè°ƒè¯•"],"title":"Linux ç½‘ç»œå·¥å…·ä¸­çš„ç‘å£«å†›åˆ€ - socat \u0026 netcat","uri":"/posts/socat-netcat/#1-æ£€æµ‹è¿œç¨‹ç«¯å£çš„å¯è¿æ¥æ€§"},{"categories":["tech"],"content":" 2. æµ‹è¯•æœ¬æœºç«¯å£æ˜¯å¦èƒ½è¢«å¤–éƒ¨è®¿é—®åœ¨æœ¬æœºç›‘å¬ä¸€ä¸ª TCP ç«¯å£ï¼Œæ¥æ”¶åˆ°çš„å†…å®¹ä¼ åˆ° stdoutï¼ŒåŒæ—¶å°† stdin çš„è¾“å…¥ä¼ ç»™å®¢æˆ·ç«¯ï¼š shell # æœåŠ¡ç«¯å¯åŠ¨å‘½ä»¤ï¼Œsocat/nc äºŒé€‰ä¸€ socat TCP-LISTEN:7000 - # -l --listening nc -l 7000 # å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ python3ï¼ˆæ³¨æ„æ–‡ä»¶å®‰å…¨æ€§ï¼‰ # æ­¤å‘½ä»¤åœ¨ 7000 ç«¯å£å¯ç”¨ä¸€ä¸ªæ–‡ä»¶æœåŠ¡å™¨ï¼Œç»‘å®šåˆ° 0.0.0.0ï¼Œä»¥å½“å‰ç›®å½•ä¸ºæ ¹ç›®å½• python3 -m http.server 7000 # æˆ–è€…åœ¨è¾ƒè€çš„æœºå™¨ä¸Šå¯ä»¥ç”¨ python2ï¼ˆæ³¨æ„æ–‡ä»¶å®‰å…¨æ€§ï¼‰ python -m SimpleHTTPServer 8000 # å®¢æˆ·ç«¯è¿æ¥å‘½ä»¤ï¼Œsocat/nc äºŒé€‰ä¸€ socat TCP:192.168.31.123:7000 - nc 192.168.11.123 7000 UDP åè®®çš„æµ‹è¯•ä¹Ÿéå¸¸ç±»ä¼¼ï¼Œä½¿ç”¨ netcat çš„ç¤ºä¾‹å¦‚ä¸‹ï¼š shell # æœåŠ¡ç«¯ï¼Œåªç›‘å¬ ipv4 nc -u -l 8080 # å®¢æˆ·ç«¯ nc -u 192.168.31.123 8080 # å®¢æˆ·ç«¯æœ¬æœºæµ‹è¯•ï¼Œæ³¨æ„ localhost ä¼šè¢«ä¼˜å…ˆè§£æä¸º ipv6! è¿™ä¼šå¯¼è‡´æœåŠ¡ç«¯(ipv4)çš„ nc æ¥æ”¶ä¸åˆ°æ•°æ®ï¼ nc -u localhost 8080 ä½¿ç”¨ socat çš„ UDP æµ‹è¯•ç¤ºä¾‹å¦‚ä¸‹ï¼š shell socat UDP-LISTEN:7000 - socat UDP:192.168.31.123:7000 - ","date":"2021-04-11","objectID":"/posts/socat-netcat/:4:2","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["ç½‘ç»œ","Linux","ç½‘ç»œè°ƒè¯•"],"title":"Linux ç½‘ç»œå·¥å…·ä¸­çš„ç‘å£«å†›åˆ€ - socat \u0026 netcat","uri":"/posts/socat-netcat/#2-æµ‹è¯•æœ¬æœºç«¯å£æ˜¯å¦èƒ½è¢«å¤–éƒ¨è®¿é—®"},{"categories":["tech"],"content":" 3. è°ƒè¯• TLS åè®® å‚è€ƒ socat å®˜æ–¹æ–‡æ¡£ï¼šSecuring Traffic Between two Socat Instances Using SSL æµ‹è¯•è¯ä¹¦åŠç§é’¥çš„ç”Ÿæˆå‚è§å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦ï¼ˆå…«ï¼‰â€”â€” æ•°å­—è¯ä¹¦ä¸ TLS åè®® æ¨¡æ‹Ÿä¸€ä¸ª mTLS æœåŠ¡å™¨ï¼Œç›‘å¬ 4433 ç«¯å£ï¼Œæ¥æ”¶åˆ°çš„æ•°æ®åŒæ ·è¾“å‡ºåˆ° stdoutï¼š shell # socat éœ€è¦ä½¿ç”¨åŒæ—¶åŒ…å«è¯ä¹¦å’Œç§é’¥çš„ pem æ–‡ä»¶ï¼Œç”Ÿæˆæ–¹æ³•å¦‚ä¸‹ cat server.key server.crt \u003e server.pem cat client.key client.crt \u003e client.pem # æœåŠ¡ç«¯å¯åŠ¨å‘½ä»¤ socat openssl-listen:4433,reuseaddr,cert=server.pem,cafile=client.crt - # å®¢æˆ·ç«¯è¿æ¥å‘½ä»¤ï¼ˆä½¿ç”¨ç³»ç»Ÿçš„ ca.crt æˆ–è€…ä½ è‡ªå·±çš„ç§æœ‰ ca.cert æ¥éªŒè¯æœåŠ¡ç«¯è¯ä¹¦ï¼‰ socat - openssl-connect:192.168.31.123:4433,cert=client.pem,cafile=ca.crt # æˆ–è€…ä½¿ç”¨ curl è¿æ¥ï¼ˆca.crt è¯ä¹¦æ¥æºåŒä¸Šï¼‰ curl -v --cacert ca.crt --cert client.crt --key client.key --tls-max 1.2 https://192.168.31.123:4433 ä¸Šé¢çš„å‘½ä»¤ä½¿ç”¨äº† mTLS åŒå‘è®¤è¯çš„åè®®ï¼Œå¯é€šè¿‡è®¾å®š verify=0 æ¥å…³æ‰å®¢æˆ·ç«¯è®¤è¯ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š shell # socat éœ€è¦ä½¿ç”¨åŒæ—¶åŒ…å«è¯ä¹¦å’Œç§é’¥çš„ pem æ–‡ä»¶ï¼Œç”Ÿæˆæ–¹æ³•å¦‚ä¸‹ cat server.key server.crt \u003e server.pem # æœåŠ¡ç«¯å¯åŠ¨å‘½ä»¤ socat openssl-listen:4433,reuseaddr,cert=server.pem,verify=0 - # å®¢æˆ·ç«¯è¿æ¥å‘½ä»¤ï¼Œå¦‚æœ ip/åŸŸåä¸å—è¯ä¹¦ä¿æŠ¤ï¼Œå°±ä¹Ÿéœ€è¦æ·»åŠ  verify=0 # ï¼ˆä½¿ç”¨ç³»ç»Ÿçš„ ca.crt æˆ–è€…ä½ è‡ªå·±çš„ç§æœ‰ ca.cert æ¥éªŒè¯æœåŠ¡ç«¯è¯ä¹¦ï¼‰ socat - openssl-connect:192.168.31.123:4433,cafile=ca.crt # æˆ–è€…ä½¿ç”¨ curl è¿æ¥ï¼ˆca.crt è¯ä¹¦æ¥æºåŒä¸Šï¼‰ curl -v --cacert ca.crt https://192.168.31.123:4433 ","date":"2021-04-11","objectID":"/posts/socat-netcat/:4:3","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["ç½‘ç»œ","Linux","ç½‘ç»œè°ƒè¯•"],"title":"Linux ç½‘ç»œå·¥å…·ä¸­çš„ç‘å£«å†›åˆ€ - socat \u0026 netcat","uri":"/posts/socat-netcat/#3-è°ƒè¯•-tls-åè®®"},{"categories":["tech"],"content":" 4. æ•°æ®ä¼ è¾“é€šå¸¸ä¼ è¾“æ–‡ä»¶æ—¶ï¼Œæˆ‘éƒ½ä¹ æƒ¯ä½¿ç”¨ scp/ssh/rsyncï¼Œä½†æ˜¯ socat å…¶å®ä¹Ÿå¯ä»¥ä¼ è¾“æ–‡ä»¶ã€‚ ä»¥å°† demo.tar.gz ä»ä¸»æœº A å‘é€åˆ°ä¸»æœº B ä¸ºä¾‹ï¼Œé¦–å…ˆåœ¨æ•°æ®å‘é€æ–¹ A æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š shell # -u è¡¨ç¤ºæ•°æ®åªä»å·¦è¾¹çš„åœ°å€å•å‘ä¼ è¾“ç»™å³è¾¹ï¼ˆsocat é»˜è®¤æ˜¯ä¸€ä¸ªåŒå‘ç®¡é“ï¼‰ # -U å’Œ -u ç›¸åï¼Œæ•°æ®åªä»å³è¾¹å•å‘ä¼ è¾“ç»™å·¦è¾¹ socat -u open:demo.tar.gz tcp-listen:2000,reuseaddr ç„¶ååœ¨æ•°æ®æ¥æ”¶æ–¹ B æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå°±èƒ½æŠŠæ–‡ä»¶æ¥æ”¶åˆ°ï¼š shell socat -u tcp:192.168.1.252:2000 open:demo.tar.gz,create # å¦‚æœè§‰å¾—å¤ªç¹çï¼Œä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡ stdout é‡å®šå‘ socat -u tcp:192.168.1.252:2000 - \u003e demo.tar.gz ä½¿ç”¨ netcat ä¹Ÿå¯ä»¥å®ç°æ•°æ®ä¼ è¾“ï¼š shell # å…ˆåœ¨æ¥æ”¶æ–¹å¯åŠ¨æœåŠ¡ç«¯ nc -l -p 8080 \u003e demo.tar.gz # å†åœ¨å‘é€æ–¹å¯åŠ¨å®¢æˆ·ç«¯å‘é€æ•°æ® nc 192.168.1.2 8080 \u003c demo.tar.gz ","date":"2021-04-11","objectID":"/posts/socat-netcat/:4:4","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["ç½‘ç»œ","Linux","ç½‘ç»œè°ƒè¯•"],"title":"Linux ç½‘ç»œå·¥å…·ä¸­çš„ç‘å£«å†›åˆ€ - socat \u0026 netcat","uri":"/posts/socat-netcat/#4-æ•°æ®ä¼ è¾“"},{"categories":["tech"],"content":" 5. æ‹…å½“ä¸´æ—¶çš„ web æœåŠ¡å™¨ä½¿ç”¨ fork reuseaddr SYSTEM ä¸‰ä¸ªå‘½ä»¤ï¼Œå†ç”¨ systemd/supervisor ç®¡ç†ä¸€ä¸‹ï¼Œå°±å¯ä»¥ç”¨å‡ è¡Œå‘½ä»¤å®ç°ä¸€ä¸ªç®€å•çš„åå°æœåŠ¡å™¨ã€‚ ä¸‹é¢çš„å‘½ä»¤å°†ç›‘å¬ 8080 ç«¯å£ï¼Œå¹¶å°†æ•°æ®æµå’Œ web.py çš„ stdio è¿æ¥èµ·æ¥ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æµè§ˆå™¨è®¿é—®http://\u003cip\u003e:8080 æ¥æŸ¥çœ‹æ•ˆæœã€‚ shell socat TCP-LISTEN:8080,reuseaddr,fork SYSTEM:\"python3 web.py\" å‡è®¾ web.py çš„å†…å®¹ä¸ºï¼ˆæ³¨æ„ print çš„å†…å®¹è¦ä¸ HTTP åè®®æ ¼å¼ä¸€è‡´ï¼‰ï¼š python print(\"\"\"HTTP/1.1 200 OK Content-Type: text/plain hello world \"\"\") é‚£ curl localhost:8080 å°±åº”è¯¥ä¼šè¾“å‡º hello world å½“ç„¶ï¼Œå¦‚æœä½ ä»…å¸Œæœ›å¿«é€Ÿæä¾›ä¸€ä¸ªæ–‡ä»¶æœåŠ¡å™¨ï¼Œä¹Ÿå¯ç›´æ¥ä½¿ç”¨ python å‘½ä»¤ï¼š shell # https://docs.python.org/3/library/http.server.html#http.server.SimpleHTTPRequestHandler.do_GET python3 -m http.server 8000 --directory /tmp/ # æˆ–è€…åœ¨æ—§æœºå™¨ä¸Šå¯ä»¥ç›´æ¥ä½¿ç”¨ python2 æä¾›æ–‡ä»¶æœåŠ¡å™¨ï¼Œé»˜è®¤ä»¥å½“å‰æ–‡ä»¶å¤¹ä¸ºæ ¹ç›®å½• python -m SimpleHTTPServer 8000 ","date":"2021-04-11","objectID":"/posts/socat-netcat/:4:5","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["ç½‘ç»œ","Linux","ç½‘ç»œè°ƒè¯•"],"title":"Linux ç½‘ç»œå·¥å…·ä¸­çš„ç‘å£«å†›åˆ€ - socat \u0026 netcat","uri":"/posts/socat-netcat/#5-æ‹…å½“ä¸´æ—¶çš„-web-æœåŠ¡å™¨"},{"categories":["tech"],"content":" 6. ç«¯å£è½¬å‘ç›‘å¬ 8080 ç«¯å£ï¼Œå»ºç«‹è¯¥ç«¯å£ä¸ baidu.com:80 ä¹‹é—´çš„åŒå‘ç®¡é“: shell socat TCP-LISTEN:8080,fork,reuseaddr TCP:baidu.com:80 æ‹¿ curl å‘½ä»¤æµ‹è¯•ä¸€ä¸‹ï¼Œåº”è¯¥èƒ½æ­£å¸¸è®¿é—®åˆ°ç™¾åº¦ï¼š shell # æ³¨æ„æŒ‡å®š Host curl -v -H 'Host: baidu.com' localhost:8080 å…¶ä»–ç”¨æ³•ï¼Œæ¯”å¦‚ä¸ºä¸€ä¸ªä»…ç›‘å¬äº† 127.0.0.1 loopback ç½‘å¡çš„æœåŠ¡ï¼Œå…è®¸é€šè¿‡å¤–éƒ¨ç½‘ç»œè®¿é—®ï¼ˆæ³¨æ„å®‰å…¨æ€§ï¼‰ï¼š shell socat TCP-LISTEN:5432,fork,reuseaddr TCP:localhost:3658 ","date":"2021-04-11","objectID":"/posts/socat-netcat/:4:6","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["ç½‘ç»œ","Linux","ç½‘ç»œè°ƒè¯•"],"title":"Linux ç½‘ç»œå·¥å…·ä¸­çš„ç‘å£«å†›åˆ€ - socat \u0026 netcat","uri":"/posts/socat-netcat/#6-ç«¯å£è½¬å‘"},{"categories":["tech"],"content":" 7. ç«¯å£æ‰«ænetcat æ”¯æŒç®€å•çš„ç«¯å£æ‰«æåŠŸèƒ½ï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰«æ 192.168.1.2 ä» 8000 åˆ° 9000 çš„æ‰€æœ‰ç«¯å£å·ï¼š text # -w æŒ‡å®šè¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ # -z åªæ‰«ææ­£åœ¨ç›‘å¬çš„ daemonsï¼Œä¸å‘å…¶å‘é€ä»»ä½•æ•°æ® nc -vv -w3 -z 192.168.1.2 8000-9000 socat è²Œä¼¼ä¸æ”¯æŒè¿™é¡¹åŠŸèƒ½ï¼Œä¼°è®¡æ˜¯æ›´å»ºè®®ä½¿ç”¨ä¸“ä¸šçš„ nmap å§ã€‚ ","date":"2021-04-11","objectID":"/posts/socat-netcat/:4:7","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["ç½‘ç»œ","Linux","ç½‘ç»œè°ƒè¯•"],"title":"Linux ç½‘ç»œå·¥å…·ä¸­çš„ç‘å£«å†›åˆ€ - socat \u0026 netcat","uri":"/posts/socat-netcat/#7-ç«¯å£æ‰«æ"},{"categories":["tech"],"content":" å…¶ä»–socat è¿˜æä¾›äº†ä¸°å¯Œçš„ examples ä¸ tutorialsï¼Œä»‹ç»äº†è®¸å¤šå…¶ä»–ç”¨æ³•ï¼ŒåŒ…æ‹¬ï¼š Building TUN based virtual networks with socat: æ„é€  TUN è™šæ‹Ÿç½‘å¡ IP Multicasting with Socat: æ”¯æŒ IP åŒ…å¹¿æ’­ï¼Œå°†ç®¡é“å¦ä¸€ç«¯è®¾ä¸ºä¸€ä¸ª CIDR ç½‘æ®µ etcâ€¦ è¯¦è§å®˜æ–¹æ–‡æ¡£ï¼š socat - Multipurpose relay nc-openbsd man page ","date":"2021-04-11","objectID":"/posts/socat-netcat/:4:8","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["ç½‘ç»œ","Linux","ç½‘ç»œè°ƒè¯•"],"title":"Linux ç½‘ç»œå·¥å…·ä¸­çš„ç‘å£«å†›åˆ€ - socat \u0026 netcat","uri":"/posts/socat-netcat/#å…¶ä»–"},{"categories":["tech"],"content":" å‚è€ƒ æ–°ç‰ˆç‘å£«å†›åˆ€ï¼šsocat - éŸ¦æ˜“ç¬‘ - çŸ¥ä¹ ç”¨å¥½ä½ çš„ç‘å£«å†›åˆ€/netcat - éŸ¦æ˜“ç¬‘ - çŸ¥ä¹ socat - Multipurpose relay ","date":"2021-04-11","objectID":"/posts/socat-netcat/:5:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["ç½‘ç»œ","Linux","ç½‘ç»œè°ƒè¯•"],"title":"Linux ç½‘ç»œå·¥å…·ä¸­çš„ç‘å£«å†›åˆ€ - socat \u0026 netcat","uri":"/posts/socat-netcat/#å‚è€ƒ"},{"categories":["life"],"content":" æœ¬æ–‡å¯èƒ½å……æ–¥ç€å­¦ç”Ÿå‹æ€ç»´ï¼Œè¯·è°¨æ…é˜…è¯»â€¦ ","date":"2021-02-13","objectID":"/posts/no-more-dreams/:0:0","series":null,"tags":[],"title":"è„šè¸å®åœ°ï¼Œä»°æœ›æ˜Ÿç©º","uri":"/posts/no-more-dreams/#"},{"categories":["life"],"content":" å¹´è½»çœŸå¥½æœ€è¿‘çœ‹äº†äº›å‰è¾ˆä»¬çš„åšå®¢ï¼Œå¾ˆå¤šæ˜¯åœ¨è®¡ç®—æœºè¡Œä¸šå·¥ä½œå‡ åå¹´çš„å‰è¾ˆï¼Œè¿˜æœ‰è®¸åµ©çš„æ–‡ç« ã€‚ æˆ‘æ›´æ·±åˆ»åœ°è®¤è¯†åˆ°äº†ä¸€ä»¶äº‹ï¼šæˆ‘å½“ä¸‹çš„å¾ˆå¤šæ–‡ç« ï¼Œéƒ½èƒ½çœ‹å¾—å‡ºæˆ‘åœ¨å¾ˆè®¤çœŸçš„æ€è€ƒã€æ€»ç»“ï¼Œä½†æ˜¯æ€»æ˜¯æœ‰å¾ˆæ˜æ˜¾çš„ç¨šå«©çš„æ„Ÿè§‰åœ¨é‡Œé¢â€”â€”æˆ‘è‡ªè®¤ä¸ºè¿™æ˜¯ã€Œå­¦ç”Ÿå‹æ€ç»´ã€ã€‚ æˆ‘æ€»æ˜¯å–œæ¬¢è®²ã€Œä¸”è¡Œä¸”å¯»ã€ã€ã€Œè‡ªå·±çš„çœ¼ç•Œè¿˜å¤ªç‹­çª„äº†ï¼Œæˆ‘å¯¹ä¸–ç•Œè¿˜å¾ˆç¼ºä¹äº†è§£ã€ã€ã€Œæ ¹æœ¬çœ‹ä¸æ¸…å¥½åï¼Œå°±æ— æ³•ç‹¬ç«‹åšå‡ºå†³ç­–ã€è¯¸å¦‚æ­¤ç±»ã€‚ æˆ‘æŠŠè¿™æ ·çš„æ–‡ç« å†™å‡ºæ¥ï¼Œå‰è¾ˆä»¬ç»™æˆ‘ç•™è¨€ã€Œåšä¸»åªæ˜¯æ²‰æ·€çš„æ—¶é—´è¿˜è¿œè¿œä¸å¤Ÿã€‚æ†‹ç€æ€¥ï¼Œå¹´è½»å°±æ˜¯æœ€å¤§çš„èµ„æœ¬ã€‚ã€ã€ã€Œåªæƒ³è¯´å¹´è½»çœŸå¥½ï¼Œä½¿åŠ²æŠ˜è…¾æ‰çŸ¥é“è¦ä»€ä¹ˆä¸œè¥¿ã€ã€‚ å—¯ï¼Œæˆ‘ç†è§£åˆ°äº†ï¼Œå› ä¸ºæˆ‘ã€Œå¹´è½»ã€ï¼Œæ‰€ä»¥å†™å‡ºè¿™æ ·çš„æ–‡ç« æ²¡é—®é¢˜ï¼Œå¯ä»¥ä½¿åŠ²å»æŠ˜è…¾ã€å»æ¢ç´¢ã€å»æ€è€ƒã€‚ ","date":"2021-02-13","objectID":"/posts/no-more-dreams/:1:0","series":null,"tags":[],"title":"è„šè¸å®åœ°ï¼Œä»°æœ›æ˜Ÿç©º","uri":"/posts/no-more-dreams/#å¹´è½»çœŸå¥½"},{"categories":["life"],"content":" ä¸‰åè€Œç«‹ å­æ›°ï¼šå¾ï¼Œåæœ‰äº”ï¼Œè€Œå¿—äºå­¦ï¼Œä¸‰åè€Œç«‹ï¼Œå››åè€Œä¸æƒ‘ï¼Œäº”åè€ŒçŸ¥å¤©å‘½ï¼Œå…­åè€Œè€³é¡ºï¼Œä¸ƒåè€Œä»å¿ƒæ‰€æ¬²ï¼Œä¸é€¾çŸ©ã€‚ å­”å­è¯´ï¼šã€Œæˆ‘åäº”å²ç«‹å¿—å­¦ä¹ ï¼Œä¸‰åå²åœ¨äººç”Ÿé“è·¯ä¸Šç«™ç¨³è„šè·Ÿï¼Œå››åå²å¿ƒä¸­ä¸å†è¿·æƒ˜ï¼Œäº”åå²çŸ¥é“ä¸Šå¤©ç»™æˆ‘å®‰æ’çš„å‘½è¿ï¼Œå…­åå²å¬åˆ°åˆ«äººè¯´è¯å°±èƒ½åˆ†è¾¨æ˜¯éçœŸå‡ï¼Œä¸ƒåå²èƒ½éšå¿ƒæ‰€æ¬²åœ°è¯´è¯åšäº‹ï¼Œåˆä¸ä¼šè¶…è¶Šè§„çŸ©ã€‚ã€ ã€Œå››åè€Œä¸æƒ‘ã€å¯¹æˆ‘è€Œè¨€å¯èƒ½è¿˜å¤ªè¿œï¼Œä½†ã€Œä¸‰åè€Œç«‹ã€å´æ˜¯å·²ç»èƒ½é¢„è§åˆ°äº†çš„ï¼Œæ²¡å‡ å¹´äº†ã€‚ ä¸‰åè€Œç«‹ï¼Œäººåˆ°äº†ä¸‰åå²ï¼Œå°±åº”è¯¥çŸ¥é“è‡ªå·±å¦‚ä½•ç«‹èº«å¤„ä¸–ï¼Œå°˜ä¸–æ»šæ»šä¸­èƒ½å®ˆä½è‡ªå·±çš„ä¸€ç‚¹æœ¬çœŸä¸å¤±ã€‚ ä¸‰åå²ï¼Œå·²ä¸æ˜¯ä¸€ä¸ªå¹´è½»çš„å¹´çºªäº†ã€‚ å¦‚æœæˆ‘åˆ°äº†ä¸‰åå²ï¼Œè¿˜å»å†™äº›ã€Œè‡ªå·±çš„çœ¼ç•Œè¿˜å¤ªç‹­çª„äº†ï¼Œæˆ‘å¯¹ä¸–ç•Œè¿˜å¾ˆç¼ºä¹äº†è§£ã€ã€ã€Œæˆ‘æ ¹æœ¬çœ‹ä¸æ¸…å¥½åï¼Œå¾ˆå¤šæ—¶å€™æ— æ³•ç‹¬ç«‹åšå‡ºå†³ç­–ã€ï¼Œé‚£å°±è´»ç¬‘å¤§æ–¹äº†ã€‚ æ‰€ä»¥å³ä½¿è¯´ã€Œå¹´è½»å°±æ˜¯æœ€å¤§çš„èµ„æœ¬ã€ï¼Œä¹Ÿä¸æ˜¯èƒ½éšæ„æŒ¥éœçš„ã€‚ äººç”Ÿè¿™æ¡é“è·¯ä¸Šæˆ‘ä»¬è¸½è¸½ç‹¬è¡Œï¼Œé“é˜»ä¸”é•¿ï¼Œçœ¼å…‰è¦æ”¾é•¿è¿œä¸€ç‚¹ã€å¤šçœ‹ä¸€ç‚¹ï¼Œä¸è¦æŠŠè‡ªå·±é™åˆ¶ä½äº†ï¼Œæ›´ä¸åº”è¯¥åŸåœ°è¸æ­¥ã€‚ ","date":"2021-02-13","objectID":"/posts/no-more-dreams/:2:0","series":null,"tags":[],"title":"è„šè¸å®åœ°ï¼Œä»°æœ›æ˜Ÿç©º","uri":"/posts/no-more-dreams/#ä¸‰åè€Œç«‹"},{"categories":["life"],"content":" è®¸åµ©â€”â€”æˆ‘æ²¡æœ‰æ¢¦æƒ³è¿™ä¸¤å¤©çœ‹å¤šäº†å‰è¾ˆä»¬çš„åšå®¢ï¼Œå°±æƒ³æ‰¾ç‚¹éè™šæ„çš„ä¹¦è—‰çœ‹çœ‹ï¼Œè¡¥å……ç‚¹é˜…å†ã€‚ æ˜¨å¤©å‘æœ‹å‹ä»¬è®¨ä¹¦çœ‹ï¼Œ@rea.ink å°±ç»™æˆ‘æ¨èè®¸åµ©çš„ã€Šæµ·ä¸Šçµå…‰ã€‹ã€‚æ„å¤–åœ°å‘ç°äº†è®¸åµ©çš„æ–°æµªåšå®¢ã€‚ åšå®¢çš„å†…å®¹éƒ½å¾ˆè€äº†ï¼Œæœ€æ–°çš„ä¸€ç¯‡æ˜¯ 2013 å¹´ã€‚ä½†æ˜¯è¿™å¹¶ä¸å¦¨ç¢å…¶ä¸­è§è§£çš„ä»·å€¼ æµ·ä¸Šçµå…‰â€”â€”è®¸åµ© ä»¥å‰åª’ä½“é—®æˆ‘æ¥ä¸‹æ¥æœ‰ä»€ä¹ˆè®¡åˆ’æˆ–æ¢¦æƒ³æ—¶æˆ‘æ€»æ˜¯å¾ˆæ„£çš„å›ç­”ï¼Œæˆ‘æ²¡æœ‰æ¢¦æƒ³ã€‚ çœŸçš„ï¼Œä¸€ä¸ªå¹´è¿‡åŠç™¾çš„äººè¿˜æŠŠæ¢¦æƒ³è¿™ç§å­—çœ¼æŒ‚åœ¨å˜´ä¸Šæ˜¯å¾ˆä¹å‘³çš„ã€‚ çå¤§çœ¼çœ‹çœ‹çœ¼å‰çš„ç”Ÿæ´»ï¼Œå‘¨é­çš„ä¸€åˆ‡å§ã€‚ è„šè¸å®åœ°è®¤çœŸè¿‡å¥½æ¯ä¸€å¤©çš„ç”Ÿæ´»å§ã€‚ è‡³äºå¿ƒåº•çš„ä¿¡å¿µâ€”â€”æ˜¯å†³è®¡ä¸å¿…æ‹¿å‡ºæ¥é«˜è°ˆé˜”è®ºçš„ã€‚ å‡ºç¦»å¿ƒâ€”â€”è®¸åµ© è¿™å‡ ä¸ªæœˆï¼Œèµ°è¿‡äº†ä¸å°‘åœ°æ–¹ã€‚ æ¯åˆ°ä¸€å¤„ï¼Œé‡‡è®¿æˆ‘çš„åª’ä½“é€šå¸¸ä¼šæœ‰è¿™ä¹ˆä¸€é—®ï¼šä½ çš„éŸ³ä¹ç†æƒ³æ˜¯ä»€ä¹ˆï¼Ÿ è€Œå½“ç­”æ¡ˆæ˜¯ã€Œæˆ‘ä»æ¥æ²¡æœ‰ç†æƒ³ã€æ—¶ï¼Œæˆ‘è¿æ¥é‚£äº›é”™æ„•çš„çœ¼ç¥ã€‚ å¹´è½»çš„æ—¶å€™ï¼Œæ‹¥æœ‰ä¸€äº›ä¸–ä¿—çš„å¿µæƒ³ï¼ˆæ¯”å¦‚å£°åè¿œæ’­ï¼Ÿï¼‰ã€ä¸€äº›ç‰©è´¨ä¸Šçš„æœŸå¾…ï¼ˆæ¯”å¦‚å¤§æˆ¿å­å¥½è½¦å­ï¼Ÿï¼‰ã€ä¸€äº›ç²¾ç¥ä¸Šçš„æ†§æ†¬ï¼ˆæ¯”å¦‚å¯»å¾—ä½³å¶ï¼Ÿï¼‰ã€ä¸€äº›ç›¸å¯¹å´‡é«˜çš„ç›®æ ‡ï¼ˆæ¯”å¦‚é€ ç¦å­å­™ï¼Ÿï¼ï¼‰ï¼Œä¼¼ä¹çš„ç¡®èƒ½è®©ä¸€äº›äººæ›´æœ‰åŠ¨åŠ›çš„è¿‡æ´»æ¯ä¸€å¤©ã€‚ ä½†å¦‚æœï¼Œå²æœˆåœ¨ä½ è„¸ä¸Šå·²ç„¶ç•™ä¸‹ä¸å°‘å¹´è½®â€”â€”ä½ åèˆ¹çš„åŠ¨æœºä»ç„¶åªæ˜¯åˆ°è¾¾ä¸€åº§å²›ï¼Œåˆ«äººæŠŠå²›ä¸Šçš„ä¸€åˆ‡ç¾å¦™å’Œå®è—è¯´ç»™ä½ å¬å°±å¯ä»¥è®©ä½ åˆ’èˆ¹åˆ’çš„æ›´å¸¦åŠ²å„¿â€”â€”é‚£æˆ‘èƒ½å¯¹ä½ è¯´äº›ä»€ä¹ˆå‘¢ï¼Ÿ ","date":"2021-02-13","objectID":"/posts/no-more-dreams/:3:0","series":null,"tags":[],"title":"è„šè¸å®åœ°ï¼Œä»°æœ›æ˜Ÿç©º","uri":"/posts/no-more-dreams/#è®¸åµ©æˆ‘æ²¡æœ‰æ¢¦æƒ³"},{"categories":["life"],"content":" æ± å»ºå¼ºâ€”â€”ä½ è€äº†è¿™ä¸¤å¤©è¯»åˆ°äº†ä¸€ç¯‡æ± å»ºå¼ºå†™çš„ã€Šä½ è€äº†ã€‹ï¼Œä½œè€…æ˜¯æå®¢æ—¶é—´åˆ›å§‹äººï¼Œ çœŸçš„æ˜¯å¹´è¿‡åŠç™¾çš„æŠ€æœ¯äººäº†ã€‚ ä½ è€äº† - æ± å»ºå¼ºçš„éšæƒ³å½• 40 ä»¥åï¼Œä¸æƒ‘æ˜¯ä¸å¯èƒ½çš„ï¼Œææ…Œæ˜¯ä¸æ—¥ä¿±å¢çš„ã€‚å››åä¸æƒ‘ï¼Œè¯´å¾—ä¸æ˜¯ä½ æƒ³æ˜ç™½äº†ï¼Œè€Œæ˜¯ä½ æƒ³ä¸æ˜ç™½çš„ï¼Œå¯èƒ½å°±æƒ³ä¸æ˜ç™½äº†ï¼Œç”Ÿæ—¥å˜æˆå¦ä¸€ç§ä»ªå¼ï¼Œå®ƒä¸¥è‚ƒçš„å‘Šè¯‰ä½ ï¼ŒåŒå­¦ï¼Œä¸è¦æœ‰ä»»ä½•å¹»æƒ³äº†ï¼Œæ¥å—è¿™ä¸ªç°å®ï¼Œä½ å·²ç»ä¸å†å¹´è½»äº†ã€‚å†å–èŒä¹Ÿæ”¹å˜ä¸äº†è¿™ä¸ªäº‹å®ã€‚ äººä»¬æ€»ä¼šé•¿å¤§ï¼Œæˆç†Ÿï¼Œè¡°è€ï¼Œä¸€å¦‚ä¸‡äº‹ä¸‡ç‰©ã€‚ä»Šä½•åœ¨è¯´ï¼Œäººä»ä¸€å‡ºç”Ÿå¼€å§‹ï¼Œå°±è¸ä¸Šäº†è‡ªå·±çš„è¥¿æ¸¸è·¯ï¼Œä¸€è·¯å‘è¥¿ï¼Œåˆ°äº†å°½å¤´ï¼Œå°±æ˜¯è™šæ— ï¼Œäººå°±æ²¡äº†ã€‚æ‰€æœ‰äººéƒ½ä¸å¯é¿å…è¦å¥”å‘é‚£ä¸ªå½’å®¿ï¼Œä½ æ²¡åŠæ³•é€‰æ‹©ï¼Œæ²¡åŠæ³•å›å¤´ã€‚ ä½ è€äº† - æ± å»ºå¼ºçš„éšæƒ³å½• ä½ è·³ä¸å‡ºè¿™ä¸ªä¸–ç•Œï¼Œæ˜¯å› ä¸ºä½ ä¸çŸ¥é“è¿™ä¸ªä¸–ç•Œæœ‰å¤šå¤§ï¼Œä¸€æ—¦ä½ çŸ¥é“äº†ï¼Œä½ å°±è¶…å‡ºäº†å®ƒã€‚ å¹´é¾„ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ ","date":"2021-02-13","objectID":"/posts/no-more-dreams/:4:0","series":null,"tags":[],"title":"è„šè¸å®åœ°ï¼Œä»°æœ›æ˜Ÿç©º","uri":"/posts/no-more-dreams/#æ± å»ºå¼ºä½ è€äº†"},{"categories":["life"],"content":" æ¢¦æƒ³ä¸è¦å¤šçš„ï¼Œæƒ³çœ‹ä¸–ç•Œä¹Ÿä¸æ˜¯é è¯´çš„æ—¢ç„¶è¯´äº†è¦å¤šèµ°èµ°çœ‹çœ‹ï¼Œé‚£å°±å¤šçœ‹å¤šæƒ³ã€‚ å°±åƒè®¸åµ©å†™çš„é‚£æ ·ï¼Œä¸å¿…å»é«˜è°ˆé˜”è®ºä»€ä¹ˆç†æƒ³ä¸ä¿¡å¿µï¼Œå®é™…è¡ŒåŠ¨æ‰æ˜¯æœ€æœ‰åŠ›çš„è¯æ˜ã€‚ Keep eyes on the stars, and feet on the ground. ","date":"2021-02-13","objectID":"/posts/no-more-dreams/:5:0","series":null,"tags":[],"title":"è„šè¸å®åœ°ï¼Œä»°æœ›æ˜Ÿç©º","uri":"/posts/no-more-dreams/#æ¢¦æƒ³ä¸è¦å¤šçš„æƒ³çœ‹ä¸–ç•Œä¹Ÿä¸æ˜¯é è¯´çš„"},{"categories":["life"],"content":" 2022-02-09 æ›´æ–°ï¼š2022 å¹´å†å›çœ‹è¿™ç¯‡æ–‡ç« ï¼Œæ˜æ˜¾æ„Ÿè§‰åˆ°æˆ‘çš„è¿›æ­¥å¾ˆå¤§å¾ˆå¤§ï¼Œä¸è®ºæ˜¯å·¥ä½œæ–‡åŒ–ä¸ç¯å¢ƒã€è–ªèµ„ã€åƒå–ç©ä¹ã€è¿˜æ˜¯æ¥è§¦åˆ°çš„çº¿ä¸Šç¯å¢ƒè§„æ¨¡éƒ½æœ‰äº†è´¨çš„å˜åŒ–ï¼Œè¯¦æƒ…è§2021 å¹´æ€»ç»“ã€‚ç›®å‰å¯¹è‡ªå·±çš„è®¤çŸ¥æ›´æ¸…æ™°äº†ï¼ŒæœŸå¾… 2022 å¹´æˆ‘èƒ½ã€Œæ›´ä¸Šä¸€å±‚æ¥¼ã€å“ˆå“ˆ~ 2021-09-04 æ›´æ–°ï¼šåœ¨æ–°å…¬å¸è®¤è¯†åˆ°äº†è‡ªå·±æŠ€æœ¯ã€æ–¹æ³•è®ºã€æ€ç»´æ¨¡å¼ç­‰å¤šæ–¹é¢çš„ä¸è¶³ã€‚è¿™ç¯‡æ–‡ç« çš„éƒ¨åˆ†å†…å®¹è®©æˆ‘è§‰å¾—æœ‰ç‚¹ç¾è€»â€¦ä¸è¿‡å°±è¿™æ ·å§ï¼Œæ¯•ç«Ÿè¿™ç¡®å®æ˜¯æˆ‘å½“æ—¶çš„æ‰€æ€æ‰€æƒ³â€¦ ","date":"2021-02-06","objectID":"/posts/end-of-the-first-round/:0:0","series":null,"tags":["æ€»ç»“","å¿ƒå¾—"],"title":"æˆ‘åœ¨åˆ›ä¸šå…¬å¸åšæŠ€æœ¯ä¸€å¹´å¤šçš„ä¸€ç‚¹ä½“ä¼š","uri":"/posts/end-of-the-first-round/#"},{"categories":["life"],"content":" äººæœ‰æ‚²æ¬¢ç¦»åˆï¼Œæœˆæœ‰é˜´æ™´åœ†ç¼ºä»Šå¹´å¹´åº•çš„æ—¶å€™ï¼Œè‡ªå·±å¿ƒæ€æ‘‡æ‘†ä¸å®šï¼Œè¿™å½±å“åˆ°äº†æˆ‘çš„å·¥ä½œï¼Œé¡ºåŠ¿å°±å‘å…¬å¸æå‡ºäº†ç¦»èŒã€‚ è¿™ä¸¤ä¸‰å¤©å’Œè€æ¿ã€æŠ€æœ¯ç»ç†ï¼Œè¿˜åŒ…æ‹¬å…¬å¸æ¯”è¾ƒå¼ºçš„åŒäº‹ä»¬ï¼Œéƒ½åšäº†ä¸€ç•ªæ²Ÿé€šã€‚è¿™ä¸€æ˜¯å…¬å¸å¸Œæœ›æˆ‘èƒ½å¤Ÿè®¤åŒå…¬å¸çš„è·¯çº¿å’Œç†å¿µï¼Œè·Ÿç€ä¸€æ¡é“å¾€å‰èµ°ã€‚äºŒå‘¢æˆ‘ä¹Ÿå¾ˆæƒ³çŸ¥é“ï¼Œè€æ¿ã€æŠ€æœ¯ç»ç†ã€è¿˜æœ‰æŠ€æœ¯éª¨å¹²ä»¬ï¼Œä¸ºä»€ä¹ˆèƒ½è¿™ä¹ˆåšå®šä¸ç–‘ï¼Ÿä¸ºä»€ä¹ˆè¿™ä¹ˆæ‹¼ï¼Ÿ ç»“æœæ˜¯æˆ‘å’Œå…¬å¸éƒ½å‘ç°ï¼Œæˆ‘ä»¬ä¸æ˜¯ä¸€è·¯äººï¼Œè§‚å¿µå­˜åœ¨å†²çªã€‚å…¬å¸çš„æŠ€æœ¯éª¨å¹²ä»¬éƒ½æ˜¯åˆ›ä¸šæ€ç»´ï¼Œä»–ä»¬æˆ–è€…ä¹åœ¨å…¶ä¸­ï¼Œæˆ–è€…æ„¿æ„ä¸ºäº†è€æ¿æè¿°çš„æœªæ¥å¿ä¸€æ—¶ç—›è‹¦ã€‚ä»–ä»¬éƒ½æ„¿æ„ä¸ºäº†äº§å“ä»˜å‡ºæ›´å¤šã€‚ä½†æ˜¯æˆ‘å‘ç°å¯¹å…¬å¸ï¼Œæˆ‘ä¸æ„¿æ„ä»˜å‡ºå¤ªå¤šã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä¸€ç›´å°±æ˜¯ä¸ªæ™®é€šä¸Šç­æ—çš„æƒ³æ³•ï¼Œé«˜ç‚¹å·¥èµ„ï¼Œå¤šç‚¹ä¸ªäººæ—¶é—´ï¼Œåšç€è‡ªå·±å–œæ¬¢çš„äº‹æƒ…ã€‚ äºæ˜¯æˆ‘ç«é€Ÿç¦»èŒã€‚å½“å¤©åŠå®Œäº¤æ¥ï¼Œç­¾å®Œç¦»èŒåè®®ï¼Œæ‹¿ç€ç¦»èŒåè®®å’Œç¦»èŒè¯æ˜ï¼Œå…‰é€Ÿæ’¤é€€ã€‚ è¿™æ˜¯æˆ‘æ¯•ä¸šåçš„ç¬¬ä¸€ä»½å·¥ä½œï¼Œ2019 å¹´ 6 æœˆåº•å…¥èŒï¼Œåœ¨å…¬å¸å‘†äº†ä¸€å¹´å¤šï¼Œå­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿ï¼Œç»ä¸ä»…ä»…åªæ˜¯æŠ€æœ¯ã€‚å› æ­¤æˆ‘è§‰å¾—è‡ªå·±æœ‰å¿…è¦åšä¸€ä¸ªæŠ€æœ¯ä»¥å¤–çš„æ€»ç»“ã€‚ ä»»ä½•ä¸€å®¶å…¬å¸éƒ½æœ‰å¥½æœ‰åï¼Œä½†æ˜¯æŒ‰ç…§æƒ¯ä¾‹ï¼Œè¿™ç¯‡æ–‡ç« ä¼šé¿è€Œä¸è°ˆå…¬å¸ä¸å¥½çš„ä¸œè¥¿ã€‚å…¬å¸çš„åç§°å‘¢ï¼Œ è¿™é‡Œå°±ç”¨ W æ¥ä»£æ›¿å§ã€‚ å› ä¸ºæœ‰å‰è¾ˆåœ¨åšå®¢å›­è¯„è®ºé‡Œä¸º W å…¬å¸æ„Ÿåˆ°å¯æƒœï¼Œåœ¨å¼€å§‹æ­£é¢˜ä¹‹å‰ï¼Œè¿˜æ˜¯å…ˆè¯´ä¸‹ç¦»èŒåŸå› ã€‚å…¶å®è¯´æ¥ä¹Ÿç®€å•ï¼ŒåŸºæœ¬éƒ½èƒ½çŒœåˆ°ï¼šå·¥èµ„è¶…ä½ã€ç”»é¥¼å……é¥¥ã€é¼“åŠ±æ— æ„ä¹‰åŠ ç­ã€æŠ€æœ¯èƒ½åŠ›åˆ°äº†ç“¶é¢ˆï¼Œä»¥åŠæŠ€æœ¯èƒ½åŠ›æå‡ä½¿æˆ‘ä¿¡å¿ƒè†¨èƒ€ã€‚ ","date":"2021-02-06","objectID":"/posts/end-of-the-first-round/:1:0","series":null,"tags":["æ€»ç»“","å¿ƒå¾—"],"title":"æˆ‘åœ¨åˆ›ä¸šå…¬å¸åšæŠ€æœ¯ä¸€å¹´å¤šçš„ä¸€ç‚¹ä½“ä¼š","uri":"/posts/end-of-the-first-round/#äººæœ‰æ‚²æ¬¢ç¦»åˆæœˆæœ‰é˜´æ™´åœ†ç¼º"},{"categories":["life"],"content":" è‡ªæˆ‘è®¤è¯†æˆ‘åˆšè¿› W å…¬å¸æ—¶ï¼Œæ˜¯ä¸€ä¸ªåˆšæ¯•ä¸šçš„å°ç™½ï¼Œåªæ˜¯å…´è¶£ä½¿ç„¶å–œæ¬¢æŠ€æœ¯ã€‚å› ä¸ºä¸“ä¸šä¸åŒï¼Œå‘¨å›´ä¹Ÿæ¥è§¦ä¸åˆ°å¤šå°‘ææŠ€æœ¯çš„ï¼Œå°±æ¯”è¾ƒã€Œç‹¬ã€ã€‚ åœ¨ W å…¬å¸æˆ‘è·å¾—äº†å’Œä¸€ç¾¤æœ‰ä¸Šè¿›å¿ƒçš„äººä»¬äº’ç›¸åä½œçš„æœºä¼šï¼Œå¤§å®¶åœ¨ä¸€æ­¥ä¸€æ­¥å¾€å‰èµ°çš„æ„Ÿè§‰ï¼Œè®©æˆ‘åœ¨èŒæœŸé—´ä¸€ç›´éå¸¸å¿«ä¹ã€‚ æˆ‘ä»¬çš„æŠ€æœ¯ç»ç†ä¹Ÿç»™äº† DevOps å›¢é˜Ÿè¶³å¤Ÿçš„è‡ªç”±ï¼Œç”šè‡³æ˜¯é¼“åŠ±æˆ‘ä»¬å»æ¢ç´¢ã€å°è¯•æ–°æŠ€æœ¯ã€‚è¿™æ˜¯æˆ‘è¿™ä¸€å¹´å¤š DevOps è¿™ä¸ªæ–¹å‘è¿›æ­¥è¿™ä¹ˆå¿«çš„æœ€å¤§åŸå› ã€‚ ç„¶ååœ¨å’ŒæŠ€æœ¯ç»ç†ã€åŒäº‹ä»¬å¦è¯šæ²Ÿé€šçš„æ—¶å€™ï¼Œæˆ‘ä¹Ÿäº†è§£åˆ°äº†è‡ªå·±çš„èƒ½åŠ›ï¼Œä¸ä»…ä»…åœ¨æŠ€æœ¯ã€‚æˆ‘å¯¹å…¬å¸çš„ä»·å€¼ï¼Œä¹Ÿç»ä¸ä»…ä»…åœ¨æŠ€æœ¯ã€‚è¿™æ˜¯æˆ‘ä»¥å‰ä»æ¥æ²¡æœ‰æƒ³è¿‡çš„ï¼Œæˆ‘å–œæ¬¢æŠ€æœ¯ï¼Œè€Œä¸”æ‰¾å·¥ä½œå‘ç°èŒä½è¦æ±‚ä¹Ÿéƒ½æ˜¯å†™çš„æŠ€æœ¯ï¼Œæˆ‘çœŸçš„å°±ä¸€ç›´ä»¥ä¸ºæŠ€æœ¯å°±æ˜¯ä¸€åˆ‡ã€‚ è¿™é‡Œæˆ‘å°¤å…¶è¦æ„Ÿè°¢æŠ€æœ¯ç»ç†ï¼Œæ˜¯ä»–å¸®æˆ‘æŠŠè‡ªå·±å¯¹å…¬å¸çš„ä»·å€¼å’Œä¸è¶³åˆ†æå¾—å¦‚æ­¤é€å½»ã€‚ ä¸‹é¢æ˜¯æˆ‘ç»“åˆç»ç†å’ŒåŒäº‹å¯¹æˆ‘çš„è¯„ä»·ï¼Œå¯¹æˆ‘ä¸ªäººèƒ½åŠ›åšä¸ªè¯„ä¼°ï¼ˆä¸‰äººè¡Œå¿…æœ‰æˆ‘å¸ˆï¼Œä»…ä¾›å‚è€ƒï¼‰ï¼š ç†è§£èƒ½åŠ›ã€æ´å¯Ÿèƒ½åŠ›ï¼šåœ¨å…¬å¸ï¼Œæˆ‘è¿™æ–¹é¢çš„èƒ½åŠ›æ˜¯æ‹”å°–çš„ã€‚å’Œäººäº¤æµï¼Œæˆ‘ç»å¸¸èƒ½å¾ˆå¿«åœ°æŠŠæ¡ä½æ ¸å¿ƒã€‚ è¡¨è¾¾èƒ½åŠ›ï¼šæˆ‘çš„è¡¨è¾¾èƒ½åŠ›ä¹Ÿæ˜¯å…¬å¸é‡Œæ‹”å°–çš„ã€‚åŒäº‹è·Ÿæˆ‘è®²ï¼Œå¬æˆ‘æè¿°ä¸€æ¡é±¼ï¼Œä»–èƒ½æ¸…æ™°åœ°çœ‹åˆ°é±¼çš„éª¨å¤´ã€‚ å…¶å®æˆ‘æ—¥å¸¸å†™åšå®¢æ—¶ï¼Œç»å¸¸è§‰å¾—è‡ªå·±è¡¨è¾¾åœ°ä¸å¤Ÿå¥½ï¼Œå¾ˆå¤šäººçš„æ–‡ç« å°±æ¯”æˆ‘å†™å¾—æ›´å¥½ã€‚ä¸åŒçš„è§’åº¦çœ‹åˆ°çš„ä¸œè¥¿çœŸçš„åŒºåˆ«å¾ˆå¤§ï¼Œæ„Ÿè°¢æˆ‘çš„åŒäº‹ä»¬ã€‚ æ¢ç´¢èƒ½åŠ›ï¼šæˆ‘æ—¥å¸¸å–œæ¬¢é€› githubï¼Œç¿» CNCF Landscapeï¼Œæˆ‘çš„å…´è¶£é©±åŠ¨ç€è‡ªå·±å»æ¢ç´¢å„ç§æ–°æŠ€æœ¯ï¼Œæ€è€ƒå®ƒä»¬çš„ä¼˜åŠ£ã€‚ ä½†æ˜¯æˆ‘çš„å¤§éƒ¨åˆ†åŒäº‹ä»¬éƒ½ä¸æ˜¯è¿™æ ·çš„ï¼Œå¾ˆå¤šåŒäº‹åªè¯»ä¸­æ–‡æ–‡æ¡£å’Œåšå®¢ï¼Œè‹±æ–‡ä¹Ÿå¿…é¡»ä¾èµ–ä¸æ€ä¹ˆé è°±çš„ç¿»è¯‘ã€‚å¦å¤–ä»–ä»¬å·¥æœŸç´§ä¸šåŠ¡å¤šï¼Œä¹Ÿæ²¡æˆ‘ä»¬ DevOps è¿™è¾¹è¿™ä¹ˆå¤šçš„æ—¶é—´å»æ¢ç´¢è¯•ç”¨æ–°æŠ€æœ¯ã€‚ å› æ­¤ï¼Œæˆ‘çš„æ¢ç´¢èƒ½åŠ›è¦å¼ºäºå¤§å¤šæ•°åŒäº‹ã€‚ å…¨å±€æ€è€ƒèƒ½åŠ›: æ”¾çœ¼å…¨å±€ã€æ€è€ƒæœªæ¥ï¼Œåœ¨ä¼—å¤šé€‰æ‹©ä¸­èƒ½å¤Ÿå¹¶ä¸”æ•¢äºåšå‡ºå†³ç­–ã€‚æˆ‘ç›®å‰è¿˜å¾ˆç¼ºä¹è¿™æ ·çš„èƒ½åŠ›ã€‚ è¯´åˆ°åº•æˆ‘ç›®å‰è¿˜æ˜¯ä¸ªæ™®é€šäººçš„æ€è·¯ï¼Œæ²¡æœ‰æŠŠè‡ªå·±æ”¾åœ¨å†³ç­–è€…çš„ä½ç½®ä¸Šå»æ€è€ƒã€‚ å…¶æ¬¡å‘¢ï¼Œæˆ‘çš„çŸ¥è¯†é¢è¿˜å¤ªçª„ï¼Œå¯¼è‡´æˆ‘æ ¹æœ¬çœ‹ä¸æ¸…å¥½åï¼Œå¾ˆå¤šæ—¶å€™å°±æ— æ³•ç‹¬ç«‹åšå‡ºå†³ç­–ã€‚æˆ‘éœ€è¦æ‰©å¤§è‡ªå·±çš„çŸ¥è¯†é¢ã€‚ æŠ€æœ¯èƒ½åŠ›ï¼šæˆ‘çš„æŠ€æœ¯èƒ½åŠ›åœ¨å…¬å¸é‡Œèƒ½è¯„åˆ° 80 åˆ†å§ã€‚æˆ‘æŠ€æœ¯ä¸ç®—å¥½ï¼ŒåŸºç¡€è–„å¼±ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬ä¸€ä¸ªå°åˆ›ä¸šå…¬å¸å†…éƒ¨æ¯”è¾ƒï¼Œèƒ½åˆ° 80 åˆ†ã€‚ ç®¡ç†èƒ½åŠ›ï¼šDevOps å°±ä¸¤ä¸‰äººï¼Œå› ä¸ºæˆ‘å…·æœ‰ä¸Šé¢è¿™äº›èƒ½åŠ›ï¼ŒçŸ®ä¸ªå­é‡Œæ‹”é«˜çš„ï¼Œç†æ‰€å½“ç„¶åœ°æˆ‘æˆäº†é¢†å¤´çš„ã€‚ä½†æ˜¯æ€§æ ¼ä½¿ç„¶ï¼Œæˆ‘ç®¡ç†èƒ½åŠ›æ˜¯å…¬å¸æœ€å·®çš„â€¦ åˆ›ä¸šæ€ç»´ï¼šå…¬å¸æ˜¯åˆ›ä¸šå…¬å¸ï¼ŒæŠ€æœ¯éª¨å¹²ä»¬éƒ½æ˜¯åˆ›ä¸šæ€ç»´ã€‚ä½†æ˜¯è¯´å®è¯æˆ‘ä»æ¥æ²¡æƒ³è¿‡è¦å»åˆ›ä¸šï¼Œä¸æ„¿æ„æŠ•å…¥å¤ªå¤šã€‚è¿™ä¹Ÿæ˜¯æˆ‘ç¦»èŒçš„åŸå› ã€‚ å› æ­¤ï¼ŒæŠ€æœ¯ç»ç†è®¤ä¸ºï¼Œæˆ‘å¯èƒ½æ›´é€‚åˆå½“è®²å¸ˆå“ˆå“ˆã€‚ åœ¨å…¬å¸ä¹Ÿç¡®å®ç»™åŒäº‹ä»¬è®²è¿‡å‡ æ¬¡è¯¾ï¼Œèƒ½å¤Ÿçœ‹åˆ°åŒäº‹ä»¬é«˜å…´åœ°é¼“æŒï¼Œå‘Šè¯‰æˆ‘ã€Œè®²å¾—å¯ä»¥ã€ï¼Œæˆ‘å°±å¾ˆå¼€å¿ƒã€‚è¿™ç§å¿ƒæƒ…å°±å’Œæœ‰äººåœ¨æˆ‘åšå®¢é‡Œè¯„è®ºã€Œæ„Ÿè°¢ï¼Œå¾ˆæœ‰å¸®åŠ©ã€æ˜¯ä¸€æ ·çš„ã€‚ ","date":"2021-02-06","objectID":"/posts/end-of-the-first-round/:2:0","series":null,"tags":["æ€»ç»“","å¿ƒå¾—"],"title":"æˆ‘åœ¨åˆ›ä¸šå…¬å¸åšæŠ€æœ¯ä¸€å¹´å¤šçš„ä¸€ç‚¹ä½“ä¼š","uri":"/posts/end-of-the-first-round/#è‡ªæˆ‘è®¤è¯†"},{"categories":["life"],"content":" æˆ‘çš„æ”¶è·é¦–å…ˆæŠ€æœ¯å°±ä¸ç”¨è¯´äº†ï¼Œä»æˆ‘è¿™ä¸€å¹´å¤šçš„åšå®¢æ–‡ç« å°±èƒ½çœ‹åˆ°ï¼Œæˆ‘çš„æŠ€æœ¯è¿›æ­¥ç›¸å½“å¤§ã€‚ è¿˜æœ‰å°±æ˜¯æå‡äº†å¯¹è‡ªæˆ‘çš„è®¤è¯†ï¼Œè¿™ä¸€ç‚¹å‰é¢ä¹Ÿå·²ç»é˜è¿°è¿‡äº†ã€‚ é‚£å…¶ä»–æ–¹é¢æˆ‘æ”¶è·äº†å•¥å‘¢ï¼Ÿå¤§æ¦‚æœ‰ä¸‹é¢è¿™äº›ï¼š æˆ‘å‘ç°ï¼ŒæŠ€æœ¯ç»ç†å‡ åå¹´çš„æŠ€æœ¯ç»éªŒå’Œç”Ÿæ´»ç»å†ï¼Œèƒ½è®©ä»–ä¸äº†è§£çš„æŠ€æœ¯é¢†åŸŸä¸­ï¼Œä¹Ÿèƒ½å¿«é€Ÿæ‰¾å‡ºçœŸæ­£æœ‰ä»·å€¼çš„ä¸œè¥¿ã€‚â€”â€”ç»éªŒå’Œé˜…å†ç»™äº†ä»–å¼ºå¤§çš„æ´å¯Ÿèƒ½åŠ›ã€‚ æŠ€æœ¯äº§å“ä¸­æœ€æœ‰ä»·å€¼çš„ä¸œè¥¿ï¼Œä¹Ÿæœ€éš¾çœ‹é€çš„ä¸œè¥¿ï¼Œå¹¶ä¸æ˜¯æŠ€æœ¯æœ¬èº«ï¼Œè€Œæ˜¯ç†å¿µã€æŠ½è±¡ã€‚æ¯”å¦‚ DevOpsã€åŸºç¡€è®¾æ–½å³ä»£ç ã€äº‘è®¡ç®—ã€å¼€æºã€‚ è¿™å¾ˆéš¾ï¼Œä½†æ˜¯èƒ½é¢†å…ˆæ‰€æœ‰äººï¼Œæœ€å…ˆå‘ç°è¿™äº›å®è§‚æ¦‚å¿µçš„ä»·å€¼ï¼Œå¹¶æŠ¼æ³¨çš„äººï¼Œå°±èƒ½è·å¾—å·¨å¤§çš„å…ˆæ‰‹ä¼˜åŠ¿ã€‚ ä½†æ˜¯ã€Œä¸–äººå¤§éƒ½æ„šæ˜§ã€ï¼Œæˆ–è€…è¯´ã€Œå¤ªè¿‡èªæ˜ã€ï¼Œå¯¼è‡´è¿™ç±»åˆ›ä¸šå›¢é˜Ÿå¯èƒ½å’Œç¤¾ä¼šæ ¼æ ¼ä¸å…¥ã€‚ä¸è®ºæˆåŠŸå¤±è´¥ï¼Œè¿™ç±»æ°¸è¿œæ˜¯å°‘æ•°äººã€‚ ç†æ€§çš„æ²Ÿé€šæ˜¯å¥½çš„ï¼Œä½†æ˜¯æœ‰æ—¶å€™æƒ…ç»ªåŒ–çš„æ²Ÿé€šåè€Œæ›´æœ‰æ•ˆæœã€‚ æˆ‘ä»¬æŠ€æœ¯ç»ç†æ˜¯ä¸€ä¸ªè¶…çº§ç†æ€§çš„äººï¼Œä½†æ˜¯æˆ‘å’Œä»–æ²Ÿé€šï¼Œä»–çš„æƒ³æ³•å¹¶ä¸èƒ½å¾ˆå¥½çš„ä¼ è¾¾ç»™æˆ‘ã€‚åè€Œæƒ…ç»ªåŒ–çš„è€æ¿è·Ÿæˆ‘æ²Ÿé€šï¼Œæˆ‘æ›´èƒ½æ„ŸåŒèº«å—ã€‚ æˆ‘è®¤è¯†äº†å½¢å½¢è‰²è‰²çš„äººï¼Œå…¬å¸çš„åŒäº‹ã€é¢†å¯¼ï¼Œå¾ˆå¤šéƒ½æœ‰å€¼å¾—æˆ‘å­¦ä¹ çš„åœ°æ–¹ã€‚æœ‰äº›æ„Ÿæ‚Ÿ å¯ŒäºŒä»£ä¸åœ¨æ„é’±ï¼Œæ²¡æ™®é€šäººè¿™ä¹ˆæ–¤æ–¤è®¡è¾ƒï¼Œåªåœ¨æ„å…¬å¸æ°›å›´ï¼Œä»¥åŠè‡ªå·±èƒ½åšä»€ä¹ˆã€‚åè€Œæ›´æ„¿æ„ä»˜å‡ºæ›´å¤šï¼Œèƒ½å¤Ÿä¹åœ¨å…¶ä¸­ï¼Œä¹Ÿæ›´å®¹æ˜“æˆåŠŸã€‚åˆ›ä¸šå…¬å¸å¤§æ¦‚å¾ˆå–œæ¬¢è¿™ç±»äººã€‚ ä¸–ç•Œä¸Šå¤§éƒ¨åˆ†äººéƒ½æ˜¯æ™®é€šäººã€‚å¤§ä¼—è®¤åŒçš„è§‚ç‚¹ï¼Œä¸ä¸€å®šå°±æ˜¯æ­£ç¡®çš„è§‚ç‚¹ã€‚å¤§ä¼—è§‚ç‚¹çš„å˜åŒ–ä¹Ÿèƒ½ä½“ç°å‡ºç¤¾ä¼šçš„å˜è¿ã€‚ æ¯”å¦‚å½“å¹´å¤§è·ƒè¿›å…¨æ°‘çš„ç‹‚çƒ­ï¼Œå’Œç°åœ¨å…¬å¸å€¡å¯¼ 996ï¼Œç¤¾ä¼šèˆ†è®ºåˆ™ç§¯æåæŠ—ã€‚å…¬å¸å’Œæ°‘ä¼—ç«™åœ¨äº†å¯¹ç«‹é¢ã€‚ é™¤äº†ä¸Šé¢è¿™äº›è™šçš„ï¼Œè¿˜æœ‰æ›´å®åœ¨çš„ï¼š å¿«ä¹ï¼šç»ç†ä¸ºäººç›¸å½“å¥½ï¼ŒåŒäº‹ä¹‹é—´åˆä½œå¤§éƒ½ä¹Ÿå¾ˆæ„‰å¿«ï¼Œäººäº‹å°å§å§è¶…çº§ä¸“ä¸šï¼Œæ— å¾®ä¸è‡³åœ°ç…§é¡¾æˆ‘ä»¬ã€‚åœ¨èŒæœŸé—´æˆ‘æ”¶è·äº†ç›¸å½“å¤šçš„å¿«ä¹ã€‚ è‡ªä¿¡å¿ƒï¼šæˆ‘è¿›å…¬å¸ä¹‹å‰ï¼Œä½œä¸ºä¸€ä¸ªè·¨ä¸“ä¸šçš„å°ç™½ï¼Œéå¸¸æ²¡æœ‰åº•æ°”ï¼Œè€Œä¸”åœ¨å­¦æ ¡çš„æ—¶å€™æ•´ä¸ªäººéå¸¸é¢“åºŸã€‚ä½†æ˜¯åœ¨ W å…¬å¸ï¼Œæˆ‘å­¦åˆ°äº†æŠ€æœ¯ï¼Œå·¥ä½œä¹åœ¨å…¶ä¸­ï¼Œè¿˜æ”¶è·äº†åŒäº‹å’Œé¢†å¯¼çš„è‚¯å®šã€‚æˆ‘å»ºç«‹èµ·äº†è‡ªä¿¡å¿ƒã€‚ Money: è™½ç„¶ä¸å¤šï¼Œä½†æ˜¯æˆ‘å¥½æ­¹ä¹Ÿæ˜¯ä¸ªæœ‰äº›é—²é’±äº†çš„äººhhh ","date":"2021-02-06","objectID":"/posts/end-of-the-first-round/:3:0","series":null,"tags":["æ€»ç»“","å¿ƒå¾—"],"title":"æˆ‘åœ¨åˆ›ä¸šå…¬å¸åšæŠ€æœ¯ä¸€å¹´å¤šçš„ä¸€ç‚¹ä½“ä¼š","uri":"/posts/end-of-the-first-round/#æˆ‘çš„æ”¶è·"},{"categories":["life"],"content":" æœªæ¥æ¯•ä¸šåï¼Œç¬¬ä¸€ä»½å·¥ä½œå°±è¿™æ ·ç»“æŸäº†ã€‚æœ‰ç‚¹ä»“ä¿ƒï¼Œå› ä¸ºå¾ˆå‡ºä¹æ„æ–™ï¼Œä½†ç»†æƒ³ä¸‹æ¥ä¹Ÿæ˜¯æƒ…ç†ä¹‹ä¸­ã€‚ ä¸‹é¢å°±æ˜¯è¿‡å¹´äº†ï¼Œè¿‡å¹´å‘¢ï¼Œå°±ç…§ç€æ—¢æœ‰çš„è®¡åˆ’æ¥å§ï¼Œç»§ç»­æå‡ä¸‹æŠ€æœ¯èƒ½åŠ›ã€‚è‡³å°‘å¯¹ç›®å‰çš„æˆ‘è€Œè¨€ï¼ŒæŠ€æœ¯è¿˜æ˜¯æˆ‘çš„èƒ½åŠ›åŸºç¡€å’Œæ‰¾å·¥ä½œçš„æœ€å¤§ä¾ä»—ï¼Œå…¶ä»–èƒ½åŠ›ç›®å‰è¿˜æ˜¯åœ¨å›´ç»•æŠ€æœ¯æˆé•¿ã€‚ å¹´åå‡†å¤‡æ‰¾ä¸‹ä¸€ä»½å·¥ä½œã€‚è¿™ä¸€æ¬¡ï¼Œæˆ‘å¸Œæœ›èƒ½å¤šèµ°ä¸€èµ°ï¼Œçœ‹ä¸€çœ‹ï¼Œä¸ç€æ€¥åšå†³å®šã€‚ æˆ‘è§‰å¾—è‡ªå·±çš„çœ¼ç•Œè¿˜å¤ªç‹­çª„äº†ï¼Œæˆ‘å¯¹ä¸–ç•Œè¿˜å¾ˆç¼ºä¹äº†è§£ã€‚ä»¥è‡³äºå¾ˆå¤šä¸œè¥¿ï¼Œæˆ‘æ ¹æœ¬æ— æ³•ä½œå‡ºè¯„åˆ¤ã€‚ æ—¢ç„¶ç°åœ¨è·³å‡ºäº†ä¸€åº§æˆ‘çš„ã€Œå›´åŸã€ï¼Œè‡ªç„¶è¦å»å¤šçœ‹çœ‹ï¼Œå¤–é¢çš„ä¸–ç•Œæ˜¯ä¸ªå•¥æ ·å­ã€‚ æˆ–è®¸ä¹Ÿæ²¡ä»€ä¹ˆåŒºåˆ«ï¼Ÿé‚£ä¹Ÿå¾—çœ‹è¿‡æ‰èƒ½ä¸‹ç»“è®ºå•Šï¼ˆç¬‘ ","date":"2021-02-06","objectID":"/posts/end-of-the-first-round/:4:0","series":null,"tags":["æ€»ç»“","å¿ƒå¾—"],"title":"æˆ‘åœ¨åˆ›ä¸šå…¬å¸åšæŠ€æœ¯ä¸€å¹´å¤šçš„ä¸€ç‚¹ä½“ä¼š","uri":"/posts/end-of-the-first-round/#æœªæ¥"},{"categories":["life"],"content":" æ–‡æœ«æ–‡ç« çš„æœ€åï¼Œç¥å¤§å®¶ã€ä¹Ÿç¥æˆ‘è‡ªå·±åœ¨ 2021 å¹´é‡Œâ€”â€” æ‹†ç ´ç‰ç¬¼é£å½©å‡¤ï¼Œé¡¿å¼€é‡‘é”èµ°è›Ÿé¾™ã€‚ ","date":"2021-02-06","objectID":"/posts/end-of-the-first-round/:5:0","series":null,"tags":["æ€»ç»“","å¿ƒå¾—"],"title":"æˆ‘åœ¨åˆ›ä¸šå…¬å¸åšæŠ€æœ¯ä¸€å¹´å¤šçš„ä¸€ç‚¹ä½“ä¼š","uri":"/posts/end-of-the-first-round/#æ–‡æœ«"},{"categories":null,"content":" åœ¨è¿™ä¸ªä¿¡æ¯çˆ†ç‚¸çš„æ—¶ä»£ï¼Œæ›´éœ€è¦èƒ½å¤Ÿæ”¾æ…¢è„šæ­¥ï¼Œæ²‰ä¸‹å¿ƒï¼Œç³»ç»Ÿæ€§çš„å­¦ä¹ ã€‚ è™½ç„¶è¿™ä¸€é¡µåˆ—äº†è¿™ä¹ˆå¤šä¸œè¥¿ï¼Œä½†æˆ‘å®é™…å­¦ä¹ è¿˜æ˜¯ä»å¿ƒï¼Œå½“å‰å¯¹å•¥æ„Ÿå…´è¶£å°±å­¦å•¥ã€‚æˆ‘ä¹Ÿä¼šå°è¯•æ‰¾åˆ°æ„Ÿå…´è¶£çš„åº”ç”¨åœºæ™¯ï¼Œåšç‚¹å°ç©æ„æˆ–è€…å†™ç‚¹å­¦ä¹ æ„Ÿæ‚Ÿï¼Œæ¯•ç«Ÿå­¦è€Œä¸ç”¨ï¼Œé‚£ä¸€æ˜¯å…´è¶£éš¾ä»¥æŒç»­ï¼ŒäºŒæ˜¯çº¸ä¸Šè°ˆå…µå­¦ä¸åˆ°çœŸæœ¬äº‹ã€‚ ","date":"2021-02-01","objectID":"/now/:0:0","series":null,"tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/#"},{"categories":null,"content":" ä¸€ã€æˆ‘æ­£åœ¨ç ”ç©¶è¿™äº› æŒ‰ä¼˜å…ˆçº§æ’åº è¿åŠ¨ å®Œæˆæ¯å¤© 800 å¡è·¯é‡Œçš„æ¶ˆè€—é‡ï¼Œç›®æ ‡æ˜¯å‡è‚¥+æå‡ä½“åŠ› æ–¹å¼ï¼šç©é™†åœ°å†²æµªæ¿ã€è·‘æ­¥ã€ç™»å±±ã€éª‘è¡Œ Linux å­¦ä¹  å‚ä¸ Nixpkgs çš„ PR review, ç†Ÿæ‚‰ç¤¾åŒºçš„ PR æµç¨‹ï¼Œæ”¹è¿›ä¸€äº›æˆ‘ç”¨åˆ°çš„ NixOS Module. ã€Šæ·±å…¥ç†è§£ Linux å†…æ ¸ã€‹ ã€Šæ·±å…¥ç†è§£ Linux è¿›ç¨‹ä¸å†…å­˜ã€‹ é©¾ç…§è€ƒè¯• - ç§‘ç›®ä¸€åˆ·é¢˜ ","date":"2021-02-01","objectID":"/now/:1:0","series":null,"tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/#ä¸€æˆ‘æ­£åœ¨ç ”ç©¶è¿™äº›"},{"categories":null,"content":" äºŒã€æˆ‘ä»Šå¹´è¿˜æƒ³ææè¿™äº› æ‹¿åˆ°é©¾ç…§ ä½“é‡é™åˆ° 58kg Linux å­¦ä¹  ç§¯æå‚ä¸ NixOS ä¸Šæ¸¸è´¡çŒ® å®ŒæˆåŸºç¡€çŸ¥è¯†å­¦ä¹  ã€Šæ·±å…¥ç†è§£ Linux è¿›ç¨‹ä¸å†…å­˜ã€‹ ã€Šæ·±å…¥ç†è§£ Linux ç½‘ç»œã€‹ https://deepwiki.com/torvalds/linux ã€ŠBPF Performance Toolsï¼ˆè‹±æ–‡ç‰ˆï¼‰ã€‹ - 35/740 nftables: https://wiki.nftables.org/wiki-nftables/index.php/Main_Page tproxy: https://www.kernel.org/doc/Documentation/networking/tproxy.txt ebpf: https://ebpf.io/ systemd: https://systemd.io/ æ¡Œé¢ç³»ç»Ÿç›¸å…³: dbus: https://www.freedesktop.org/wiki/Software/dbus/ pipewire: https://pipewire.org/ äº‘åŸç”Ÿ ç ”ç©¶ Istio çš„åº•å±‚å®ç° https://deepwiki.com/istio/istio https://deepwiki.com/istio/proxy https://deepwiki.com/kubernetes/kubernetes RISC-V ä¸æ“ä½œç³»ç»Ÿ é˜…è¯» ã€ŠEducated - A Memoirï¼ˆä¸­æ–‡åï¼šä½ å½“åƒé¸Ÿé£å¾€ä½ çš„å±±ï¼‰ã€‹ ã€Šè¿™æ‰æ˜¯å¿ƒç†å­¦ - çœ‹ç©¿ä¼ªç§‘å­¦çš„æ‰¹åˆ¤æ€§æ€ç»´ ç¬¬ 11 ç‰ˆã€‹ æ—…æ¸¸ä¸æˆ·å¤–è¿åŠ¨ å»æ—¥æœ¬ã€éŸ©å›½è·Ÿæ–°åŠ å¡ç© æ“ä½œç³»ç»Ÿ è¯¾ç¨‹ï¼šæ“ä½œç³»ç»Ÿï¼šè®¾è®¡ä¸å®ç° - å—å¤§ jyy è€å¸ˆçš„è¯¾ç¨‹ èµ„æ–™ï¼š æ“ä½œç³»ç»Ÿï¼šè®¾è®¡ä¸å®ç° (2024 æ˜¥å­£å­¦æœŸ) å—äº¬å¤§å­¦ è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯ç³» è®¡ç®—æœºç³»ç»ŸåŸºç¡€ è¯¾ç¨‹å®éªŒ (PA) ä¹¦ Operating Systems - Three Easy Pieces éƒ¨ç½²å­¦ä¹ å„ç±»æ•°æ®ä¸­é—´ä»¶ï¼š Milvus å‘é‡æ•°æ®åº“ ClickHouse - å­˜æ—¥å¿—ä¹‹ç±»çš„æ—¶åºæ•°æ®è²Œä¼¼éƒ½æŒºåˆé€‚ï¼ŒåŸç”Ÿåˆ†å¸ƒå¼ã€é«˜æ€§èƒ½ TimescaleDB - ä¹Ÿæ˜¯ PG çš„æ’ä»¶ï¼ŒScale èƒ½åŠ›æœ‰é™ï¼Œä½†æ˜¯å¥½å¤„æ˜¯å¼€å‘äººå‘˜ä¸Šæ‰‹æ²¡éš¾åº¦ã€‚ ","date":"2021-02-01","objectID":"/now/:2:0","series":null,"tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/#äºŒæˆ‘ä»Šå¹´è¿˜æƒ³ææè¿™äº›"},{"categories":null,"content":" ä¸‰ã€ä»Šå¹´çš„é˜…è¯»è¿›å±• ç”µå­ç‰ˆéƒ½å¯ä»¥åœ¨ z-library ä¸Šå¾ˆæ–¹ä¾¿åœ°ä¸‹è½½åˆ°ï¼Œå®ä½“ä¹¦çš„è¯å¯ä»¥åœ¨å¤šæŠ“é±¼ç­‰äºŒæ‰‹ä¹¦å¹³å°ç¢°ç¢°è¿æ°”ã€‚ å·²è¯»ï¼š ã€ŠGo é«˜çº§ç¼–ç¨‹ã€‹ Linux/Unix ç³»ç»Ÿç¼–ç¨‹æ‰‹å†Œï¼ˆä¸‹å†Œï¼‰ æ­£åœ¨è¯»ï¼š ã€Šæ·±å…¥ç†è§£ Linux ç½‘ç»œã€‹ ã€Šæ·±å…¥ç†è§£ Linux è¿›ç¨‹ä¸å†…å­˜ã€‹ ã€ŠBPF Performance Toolsï¼ˆè‹±æ–‡ç‰ˆï¼‰ã€‹ - 35/740 ã€ŠEducated - A Memoirï¼ˆä¸­æ–‡åï¼šä½ å½“åƒé¸Ÿé£å¾€ä½ çš„å±±ï¼‰ã€‹ The Great Gatsby - 10/41 ã€Šè¿™æ‰æ˜¯å¿ƒç†å­¦ - çœ‹ç©¿ä¼ªç§‘å­¦çš„æ‰¹åˆ¤æ€§æ€ç»´ ç¬¬ 11 ç‰ˆã€‹ æƒ³è¯»ï¼Œä½†æ˜¯æ²¡å•¥è®¡åˆ’ï¼ˆå¤§è‡´æŒ‰æ„Ÿå…´è¶£ç¨‹åº¦æ’åºï¼‰ï¼š ç¬¬ä¸€æ¢¯é˜Ÿ ã€Šç•Œé™ï¼šé€šå¾€ä¸ªäººè‡ªç”±çš„å®è·µæŒ‡å—ã€‹ ã€Šç½®èº«äº‹å†…ï¼šä¸­å›½æ”¿åºœä¸ç»æµå‘å±•ã€‹ Linux Device Driver Development - Second Edition: Linux é©±åŠ¨ç¼–ç¨‹å…¥é—¨ï¼Œ2022 å¹´å‡ºçš„æ–°ä¹¦ï¼ŒåŸºäº Linux 5.10ï¼Œamazon ä¸Šè¯„ä»·ä¸é”™ï¼Œç›®å‰åªæœ‰è‹±æ–‡ç‰ˆï¼Œå†™çš„å¾ˆå¥½ï¼Œå¯¹æ–°æ‰‹å¾ˆå‹å¥½ã€‚ ã€Šå¤æ‚ - æ¢…æ‹‰å°¼ ç±³æ­‡å°”ã€‹ Psychology and Life, 20th edition, by Richard J. Gerrig ç¬¬äºŒæ¢¯é˜Ÿ Mountaineering: The Freedom of the Hillsï¼ˆç™»å±±åœ£ç»ï¼‰ ã€Šåˆ†å¿ƒä¹Ÿæœ‰å¥½äººç”Ÿã€‹ ã€Šåˆ˜æ“è¥¿æ–¹ç°ä»£æ€æƒ³è®²ä¹‰ã€‹ ã€Šäº”å››è¿åŠ¨å²ï¼šç°ä»£ä¸­å›½çš„çŸ¥è¯†é©å‘½ã€‹ ã€Šå…«æ¬¡å±æœºï¼šä¸­å›½çš„çœŸå®ç»éªŒã€‹ ã€Šæˆ‘ä»¬ä»Šå¤©æ€æ ·åšçˆ¶äº²ã€‹ï¼šæ¢å¯è¶…çš„æ•™è‚²è§‚ ã€Šä¸­å›½å›½å®¶æ²»ç†çš„åˆ¶åº¦é€»è¾‘ã€‹ ã€Šæ±Ÿæ‘ç»æµã€‹ ã€Šå…šå‘˜ã€å…šæƒä¸å…šäº‰ï¼š1924 - 1949 å¹´ä¸­å›½å›½æ°‘å…šçš„ç»„ç»‡å½¢æ€ã€‹ ã€Šæˆ‘çš„å‰åŠç”Ÿâ€”â€”çˆ±æ–°è§‰ç½—Â·æº¥ä»ªã€‹ ã€Šä¸ºä»€ä¹ˆå­¦ç”Ÿä¸å–œæ¬¢ä¸Šå­¦ã€‹ ","date":"2021-02-01","objectID":"/now/:3:0","series":null,"tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/#ä¸‰ä»Šå¹´çš„é˜…è¯»è¿›å±•"},{"categories":null,"content":" å››ã€å¤‡é€‰å­¦ä¹ è·¯çº¿","date":"2021-02-01","objectID":"/now/:4:0","series":null,"tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/#å››å¤‡é€‰å­¦ä¹ è·¯çº¿"},{"categories":null,"content":" 1. é«˜ä¼˜å…ˆçº§ æ“ä½œç³»ç»Ÿç†è§£ Linux æ“ä½œç³»ç»Ÿä¹Ÿæ˜¯æˆ‘ç»§ç»­ç²¾è¿›æŠ€æœ¯å¿…ä¸å¯å°‘çš„æŠ€èƒ½ã€‚ æ ¸å¿ƒè¯¾ç¨‹ï¼šè¯¾ç¨‹ 6.S081 + ä¹¦Operating Systems - Three Easy Pieces è¯¾ç¨‹ç›¸å…³èµ„æº 0xFFFF - MIT6.S081 Operating System Engineering (Fall 2020) æ“ä½œç³»ç»Ÿï¼šè®¾è®¡ä¸å®ç° - å—å¤§ jyy è€å¸ˆçš„è¯¾ç¨‹ OSTEP å­¦ä¹ æŒ‡å—ï¼šhttps://github.com/ryan4yin/computer-science/tree/master/coursepages/ostep å­¦åˆ° xv6 æ—¶å¯ç»“åˆè¿™ä»½èµ„æ–™å•ƒæºç ï¼šxv6-annotated Systems Performance: Enterprise and the Cloud, 2nd Edition (2020): è¿›é˜¶è¯»ç‰©ï¼Œæç³»ç»Ÿæ€§èƒ½ä¼˜åŒ–çš„ ã€ŠBPF Performance Toolsï¼ˆè‹±æ–‡ç‰ˆï¼‰ã€‹ï¼šè¿›é˜¶è¯»ç‰©ï¼ŒLinux å†…æ ¸æŠ€æœ¯ï¼Œä¸»è¦ç”¨äºæ Linux ç½‘ç»œæ•°æ®åŒ…å¤„ç†ã€æ€§èƒ½åˆ†æã€ç³»ç»Ÿç›‘æ§çš„ã€‚ Linux ç³»ç»Ÿ Linux ç»å…¸ä¹¦ç›®(æŒ‰é˜…è¯»é¡ºåºæ’åˆ—) TLPI - æ­£åœ¨è¯» APUE(Advanced Programming in the UNIX Environment) UNP(Unix Network Programming) Understanding the Linux Kernel, 3rd Edition æå®¢æ—¶é—´ ã€ŠLinux å†…æ ¸æŠ€æœ¯å®æˆ˜è¯¾ã€‹ flash-linux0.11-talk æå®¢æ—¶é—´ã€Šå®¹å™¨å®æˆ˜é«˜æ‰‹è¯¾ã€‹ æå®¢æ—¶é—´ã€ŠeBPF æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜ã€‹ C è¯­è¨€ / Rust è¯­è¨€ æå®¢æ—¶é—´ã€Šæ·±å…¥ C è¯­è¨€å’Œç¨‹åºè¿è¡ŒåŸç†ã€‹ æå®¢æ—¶é—´ã€ŠRust ç¼–ç¨‹ç¬¬ä¸€è¯¾ã€‹ Linux æ€§èƒ½è°ƒä¼˜ä¸ Linux ç½‘ç»œæŠ€æœ¯ ã€Šæ·±å…¥ç†è§£ Linux ç½‘ç»œ - å¼ å½¦é£ã€‹ - 14/320 ã€Šæ·±å…¥ç†è§£ Linux è¿›ç¨‹ä¸å†…å­˜ - å¼ å½¦é£ã€‹ æå®¢æ—¶é—´ã€Šç½‘ç»œæ’æŸ¥æ¡ˆä¾‹è¯¾ã€‹ æå®¢æ—¶é—´ ã€ŠLinux æ€§èƒ½ä¼˜åŒ–å®æˆ˜ã€‹ è®¡ç®—æœºç½‘ç»œè®¡ç®—æœºç½‘ç»œå¯ç®—æ˜¯æˆ‘çš„è€æœ¬è¡Œäº†ï¼Œç”¨æ¥åƒé¥­çš„å®¶ä¼™äº‹ï¼ŒæŠ€è‰ºä¸èƒ½è½ä¸‹ã€‚ è®¡ç®—æœºç½‘ç»œ TCP/IP Illustrated, Volume 1, 2nd Edition - è¿›åº¦ 31/920 è¯¾ç¨‹CS 144: Introduction to Computer Networking ä»¥å‰å­¦è¿‡ä¸€æ¬¡ã€ŠComputer Networking - A Top-Down Approach, 7eã€‹ï¼Œè¿™æ¬¡ç®—æ˜¯é‡å­¦å§ã€‚ è¯¾ç¨‹ä¸»è¦ä½¿ç”¨ C++ï¼Œæˆ‘æˆ–è®¸å¯ä»¥è€ƒè™‘ç”¨ rust/go å®ç°ä¸‹åè®®æ ˆï¼Ÿ TCP/IP åè®®æ ˆçš„å®ç°ï¼šå¯ä»¥å‚è€ƒ google/gvisor ","date":"2021-02-01","objectID":"/now/:4:1","series":null,"tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/#1-é«˜ä¼˜å…ˆçº§"},{"categories":null,"content":" 1. é«˜ä¼˜å…ˆçº§ æ“ä½œç³»ç»Ÿç†è§£ Linux æ“ä½œç³»ç»Ÿä¹Ÿæ˜¯æˆ‘ç»§ç»­ç²¾è¿›æŠ€æœ¯å¿…ä¸å¯å°‘çš„æŠ€èƒ½ã€‚ æ ¸å¿ƒè¯¾ç¨‹ï¼šè¯¾ç¨‹ 6.S081 + ä¹¦Operating Systems - Three Easy Pieces è¯¾ç¨‹ç›¸å…³èµ„æº 0xFFFF - MIT6.S081 Operating System Engineering (Fall 2020) æ“ä½œç³»ç»Ÿï¼šè®¾è®¡ä¸å®ç° - å—å¤§ jyy è€å¸ˆçš„è¯¾ç¨‹ OSTEP å­¦ä¹ æŒ‡å—ï¼šhttps://github.com/ryan4yin/computer-science/tree/master/coursepages/ostep å­¦åˆ° xv6 æ—¶å¯ç»“åˆè¿™ä»½èµ„æ–™å•ƒæºç ï¼šxv6-annotated Systems Performance: Enterprise and the Cloud, 2nd Edition (2020): è¿›é˜¶è¯»ç‰©ï¼Œæç³»ç»Ÿæ€§èƒ½ä¼˜åŒ–çš„ ã€ŠBPF Performance Toolsï¼ˆè‹±æ–‡ç‰ˆï¼‰ã€‹ï¼šè¿›é˜¶è¯»ç‰©ï¼ŒLinux å†…æ ¸æŠ€æœ¯ï¼Œä¸»è¦ç”¨äºæ Linux ç½‘ç»œæ•°æ®åŒ…å¤„ç†ã€æ€§èƒ½åˆ†æã€ç³»ç»Ÿç›‘æ§çš„ã€‚ Linux ç³»ç»Ÿ Linux ç»å…¸ä¹¦ç›®(æŒ‰é˜…è¯»é¡ºåºæ’åˆ—) TLPI - æ­£åœ¨è¯» APUE(Advanced Programming in the UNIX Environment) UNP(Unix Network Programming) Understanding the Linux Kernel, 3rd Edition æå®¢æ—¶é—´ ã€ŠLinux å†…æ ¸æŠ€æœ¯å®æˆ˜è¯¾ã€‹ flash-linux0.11-talk æå®¢æ—¶é—´ã€Šå®¹å™¨å®æˆ˜é«˜æ‰‹è¯¾ã€‹ æå®¢æ—¶é—´ã€ŠeBPF æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜ã€‹ C è¯­è¨€ / Rust è¯­è¨€ æå®¢æ—¶é—´ã€Šæ·±å…¥ C è¯­è¨€å’Œç¨‹åºè¿è¡ŒåŸç†ã€‹ æå®¢æ—¶é—´ã€ŠRust ç¼–ç¨‹ç¬¬ä¸€è¯¾ã€‹ Linux æ€§èƒ½è°ƒä¼˜ä¸ Linux ç½‘ç»œæŠ€æœ¯ ã€Šæ·±å…¥ç†è§£ Linux ç½‘ç»œ - å¼ å½¦é£ã€‹ - 14/320 ã€Šæ·±å…¥ç†è§£ Linux è¿›ç¨‹ä¸å†…å­˜ - å¼ å½¦é£ã€‹ æå®¢æ—¶é—´ã€Šç½‘ç»œæ’æŸ¥æ¡ˆä¾‹è¯¾ã€‹ æå®¢æ—¶é—´ ã€ŠLinux æ€§èƒ½ä¼˜åŒ–å®æˆ˜ã€‹ è®¡ç®—æœºç½‘ç»œè®¡ç®—æœºç½‘ç»œå¯ç®—æ˜¯æˆ‘çš„è€æœ¬è¡Œäº†ï¼Œç”¨æ¥åƒé¥­çš„å®¶ä¼™äº‹ï¼ŒæŠ€è‰ºä¸èƒ½è½ä¸‹ã€‚ è®¡ç®—æœºç½‘ç»œ TCP/IP Illustrated, Volume 1, 2nd Edition - è¿›åº¦ 31/920 è¯¾ç¨‹CS 144: Introduction to Computer Networking ä»¥å‰å­¦è¿‡ä¸€æ¬¡ã€ŠComputer Networking - A Top-Down Approach, 7eã€‹ï¼Œè¿™æ¬¡ç®—æ˜¯é‡å­¦å§ã€‚ è¯¾ç¨‹ä¸»è¦ä½¿ç”¨ C++ï¼Œæˆ‘æˆ–è®¸å¯ä»¥è€ƒè™‘ç”¨ rust/go å®ç°ä¸‹åè®®æ ˆï¼Ÿ TCP/IP åè®®æ ˆçš„å®ç°ï¼šå¯ä»¥å‚è€ƒ google/gvisor ","date":"2021-02-01","objectID":"/now/:4:1","series":null,"tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/#æ“ä½œç³»ç»Ÿ"},{"categories":null,"content":" 1. é«˜ä¼˜å…ˆçº§ æ“ä½œç³»ç»Ÿç†è§£ Linux æ“ä½œç³»ç»Ÿä¹Ÿæ˜¯æˆ‘ç»§ç»­ç²¾è¿›æŠ€æœ¯å¿…ä¸å¯å°‘çš„æŠ€èƒ½ã€‚ æ ¸å¿ƒè¯¾ç¨‹ï¼šè¯¾ç¨‹ 6.S081 + ä¹¦Operating Systems - Three Easy Pieces è¯¾ç¨‹ç›¸å…³èµ„æº 0xFFFF - MIT6.S081 Operating System Engineering (Fall 2020) æ“ä½œç³»ç»Ÿï¼šè®¾è®¡ä¸å®ç° - å—å¤§ jyy è€å¸ˆçš„è¯¾ç¨‹ OSTEP å­¦ä¹ æŒ‡å—ï¼šhttps://github.com/ryan4yin/computer-science/tree/master/coursepages/ostep å­¦åˆ° xv6 æ—¶å¯ç»“åˆè¿™ä»½èµ„æ–™å•ƒæºç ï¼šxv6-annotated Systems Performance: Enterprise and the Cloud, 2nd Edition (2020): è¿›é˜¶è¯»ç‰©ï¼Œæç³»ç»Ÿæ€§èƒ½ä¼˜åŒ–çš„ ã€ŠBPF Performance Toolsï¼ˆè‹±æ–‡ç‰ˆï¼‰ã€‹ï¼šè¿›é˜¶è¯»ç‰©ï¼ŒLinux å†…æ ¸æŠ€æœ¯ï¼Œä¸»è¦ç”¨äºæ Linux ç½‘ç»œæ•°æ®åŒ…å¤„ç†ã€æ€§èƒ½åˆ†æã€ç³»ç»Ÿç›‘æ§çš„ã€‚ Linux ç³»ç»Ÿ Linux ç»å…¸ä¹¦ç›®(æŒ‰é˜…è¯»é¡ºåºæ’åˆ—) TLPI - æ­£åœ¨è¯» APUE(Advanced Programming in the UNIX Environment) UNP(Unix Network Programming) Understanding the Linux Kernel, 3rd Edition æå®¢æ—¶é—´ ã€ŠLinux å†…æ ¸æŠ€æœ¯å®æˆ˜è¯¾ã€‹ flash-linux0.11-talk æå®¢æ—¶é—´ã€Šå®¹å™¨å®æˆ˜é«˜æ‰‹è¯¾ã€‹ æå®¢æ—¶é—´ã€ŠeBPF æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜ã€‹ C è¯­è¨€ / Rust è¯­è¨€ æå®¢æ—¶é—´ã€Šæ·±å…¥ C è¯­è¨€å’Œç¨‹åºè¿è¡ŒåŸç†ã€‹ æå®¢æ—¶é—´ã€ŠRust ç¼–ç¨‹ç¬¬ä¸€è¯¾ã€‹ Linux æ€§èƒ½è°ƒä¼˜ä¸ Linux ç½‘ç»œæŠ€æœ¯ ã€Šæ·±å…¥ç†è§£ Linux ç½‘ç»œ - å¼ å½¦é£ã€‹ - 14/320 ã€Šæ·±å…¥ç†è§£ Linux è¿›ç¨‹ä¸å†…å­˜ - å¼ å½¦é£ã€‹ æå®¢æ—¶é—´ã€Šç½‘ç»œæ’æŸ¥æ¡ˆä¾‹è¯¾ã€‹ æå®¢æ—¶é—´ ã€ŠLinux æ€§èƒ½ä¼˜åŒ–å®æˆ˜ã€‹ è®¡ç®—æœºç½‘ç»œè®¡ç®—æœºç½‘ç»œå¯ç®—æ˜¯æˆ‘çš„è€æœ¬è¡Œäº†ï¼Œç”¨æ¥åƒé¥­çš„å®¶ä¼™äº‹ï¼ŒæŠ€è‰ºä¸èƒ½è½ä¸‹ã€‚ è®¡ç®—æœºç½‘ç»œ TCP/IP Illustrated, Volume 1, 2nd Edition - è¿›åº¦ 31/920 è¯¾ç¨‹CS 144: Introduction to Computer Networking ä»¥å‰å­¦è¿‡ä¸€æ¬¡ã€ŠComputer Networking - A Top-Down Approach, 7eã€‹ï¼Œè¿™æ¬¡ç®—æ˜¯é‡å­¦å§ã€‚ è¯¾ç¨‹ä¸»è¦ä½¿ç”¨ C++ï¼Œæˆ‘æˆ–è®¸å¯ä»¥è€ƒè™‘ç”¨ rust/go å®ç°ä¸‹åè®®æ ˆï¼Ÿ TCP/IP åè®®æ ˆçš„å®ç°ï¼šå¯ä»¥å‚è€ƒ google/gvisor ","date":"2021-02-01","objectID":"/now/:4:1","series":null,"tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/#è®¡ç®—æœºç½‘ç»œ"},{"categories":null,"content":" 2. ä»¥åå¯èƒ½ä¼šæ„Ÿå…´è¶£çš„ AI infra æ–¹å‘è¿™æ˜¯ä¸€ä¸ªç›¸å½“æ–°çš„æ–¹å‘ï¼Œå› ä¸ºè¿‘ä¸¤å¹´ AI å¼€å§‹è½åœ°è€Œå…´èµ·ï¼Œå®ƒæ—¢è¦æ±‚ç†Ÿæ‚‰ K8s/Istio ç­‰ä¼ ç»Ÿ infra ç»„ä»¶ï¼Œåˆè¦æ±‚å¯¹ AI è®­ç»ƒæ¨ç†ç›¸å…³çš„æŠ€æœ¯æœ‰è¶³å¤Ÿäº†è§£ï¼Œä¾‹å¦‚ï¼š Operator: training-operator è°ƒåº¦ï¼švolcano æ¡†æ¶ï¼šKubeflow, RayTrain, Argo Workflows æ€§èƒ½ä¼˜åŒ–ï¼šTriton/BentoML/vLLM/PyTorch/CUDA æ„Ÿè§‰æ˜¯ä¸€ä¸ªè½¬å‹çš„æ–¹å‘ï¼Œä¸šä½™å¯ä»¥çœ‹çœ‹ã€‚ ç›¸å…³èµ„æ–™ï¼š https://github.com/stas00/ml-engineering/ å¿ƒç†å­¦ä¸è®¤çŸ¥ç¥ç»ç§‘å­¦å­¦ä¹ è·¯çº¿ï¼š å…¥é—¨ï¼š ã€Šè¿™æ‰æ˜¯å¿ƒç†å­¦ - çœ‹ç©¿ä¼ªç§‘å­¦çš„æ‰¹åˆ¤æ€§æ€ç»´ ç¬¬ 11 ç‰ˆã€‹ Psychology and Life, 20th edition, by Richard J. Gerrig, 2012 Educational Psychology, 14th Global Edition (Anita Woolfolk, 2021) Development Across the Life Span, 10th edition (Robert S. Feldman, 2023) è¿›é˜¶åˆ°è®¤çŸ¥ç¥ç»ç§‘å­¦ Neuroscience: Exploring the Brain, 4th edition (2015) Cognitive Neuroscience: The Biology of the Mind, 5th edition (2019) å…¶ä»–æ–¹å‘ ã€ŠIntimate Relationshipsã€‹ - è¿›åº¦ 14/449 ã€ŠSocial Psychology, 14e, David Myersã€‹ åµŒå…¥å¼/ç‰©è”ç½‘åµŒå…¥å¼è·Ÿ IoT æ˜¯æˆ‘ 2022 å¹´åº•å¼€çš„æ–°å‘ï¼Œç›®å‰å…´è¶£å¼ºçƒˆã€‚ ä¹‹å‰åˆ¶å®šçš„ FPGA å­¦ä¹ è·¯çº¿ï¼š ä»æ•°å­—ç”µè·¯åˆ° FPGA å†åˆ° RISC-V å½“å‰ç›®æ ‡ï¼šç”¨ FPGA å®ç°äº›å°åŠŸèƒ½ å…ˆå­¦ç‚¹æ•°å­—ç”µè·¯åŸºç¡€çŸ¥è¯† ä¹¦ç±ï¼šPractical Electronics for Inventors, Fourth Edition ä¸ºäº†å¿«é€Ÿä¸Šæ‰‹ï¼Œç›´æ¥è·³è¿‡æ¨¡æ‹Ÿç”µè·¯éƒ¨åˆ†ï¼Œçœ‹ç¬¬ 12 åˆ°ç¬¬ 13 ç«  å†å­¦ç‚¹ FPGA åŸºç¡€çŸ¥è¯† ä¹¦ç±ï¼šPractical Electronics for Inventors, Fourth Edition å¼€å‘æ¿ï¼šçŸ½é€Ÿè”æç³–ç³»åˆ—ï¼Œä¸»è¦ç”¨ verilog è¯­è¨€å¼€å‘ é˜…è¯»ç¬¬ 14 ç« ï¼Œç®€å•å…¥é—¨ FPGA verilog è¯­è¨€ï¼Œç›´æ¥ç”¨è¿™ä¸ªç«™ç‚¹å°±å¤Ÿäº†ï¼Œæ˜¯éå¸¸å¥½çš„æ•™ç¨‹ + ç»ƒä¹ åœºï¼š https://hdlbits.01xz.net/wiki/Main_Page æ›´æœ‰è¶£çš„ç»ƒä¹ é¢˜ï¼š https://www.fpga4fun.com/ ä» LED ç‚¹ç¯åˆ° RISCV CPUï¼ˆå¾ªåºæ¸è¿›ï¼‰:https://github.com/BrunoLevy/learn-fpga/blob/master/FemtoRV/TUTORIALS/FROM_BLINKER_TO_RISCV/README.md è¿›é˜¶ï¼šå­¦ä¹  RISCV ä¸å¤„ç†å™¨å¾®æ¶æ„ ä¹¦ç±ï¼šDigital Design and Computer Architecture RISC-V Edition æ­¤ä¹¦ä»ç¬¬å…­ç« å¼€å§‹è®² RISCV å¾®æ¶æ„ã€‚ æˆ‘ç›®å‰æ”¶é›†çš„ç›¸å…³å†…å®¹ï¼ˆä»…æ˜¯ä¸€ä¸ªèµ„æ–™åˆé›†ï¼Œå†…å®¹æœ‰é‡å¤çš„ï¼‰ï¼š åµŒå…¥å¼ Linux ç³»åˆ— Linux Device Driver Development - Second Edition: Linux é©±åŠ¨ç¼–ç¨‹å…¥é—¨ï¼Œ2022 å¹´å‡ºçš„æ–°ä¹¦ï¼ŒåŸºäº Linux 5.10ï¼Œamazon ä¸Šè¯„ä»·ä¸é”™ï¼Œç›®å‰åªæœ‰è‹±æ–‡ç‰ˆï¼Œå†™çš„å¾ˆå¥½ï¼Œå¯¹æ–°æ‰‹å¾ˆå‹å¥½ã€‚ Linux Driver Development for Embedded Processors 2nd Edition: è¿™æœ¬æ˜¯ 2018 å¹´å‡ºçš„ï¼Œå†™å¾—æ²¡ä¸Šé¢é‚£æœ¬å¥½ã€å†…å®¹ä¹Ÿæ²¡é‚£ä¹ˆæ–°ï¼Œä½†æ˜¯çœ‹è¯„ä»·ä¹Ÿä¸é”™ï¼Œç‰¹ç‚¹æ˜¯æœ‰è®¸å¤šçš„ Lab å¯åšã€‚ Linux Kernel Programming: A comprehensive guide to kernel internals: Linux å†…æ ¸ç¼–ç¨‹é¢†åŸŸçš„æ–°ä¹¦ï¼Œé€‚åˆå…¥é—¨ Linux å†…æ ¸ï¼Œamazon ä¸Šè¯„ä»·æŒºå¥½ï¼Œå…ˆæ”¶è—ä¸€ä¸ª Understanding the Linux Kernel, 3rd Editionï¼šLinux å†…æ ¸æŠ€æœ¯è¿›é˜¶ã€‚ linux-insides: ä» bootloader å¼€å§‹è®²è§£äº† Linux å†…æ ¸çš„è®¸å¤šé‡è¦çš„åŠŸèƒ½æ¨¡å—ï¼Œçœ‹ stars å¾ˆé«˜æ‰€ä»¥ä¹Ÿåœ¨è¿™é‡Œåˆ—ä¸€ä¸‹ã€‚ ç”µè·¯åŸç† Practical Electronics for Inventors, Fourth Edition èŠ¯ç‰‡ ARM64: STM32 ESP32 RK3588s RISCV: milkv mars/duo, licheepi4a FPGA / ç”µè·¯è®¾è®¡:FPGA ç©è€ä¹‹æ—… ç›®å‰çš„å­¦ä¹ ç›®æ ‡ DIY æ— äººæœºç¼–é˜Ÿé£è¡Œï¼è¦è¾¾æˆè¿™ä¸ªç›®æ ‡éœ€è¦å­¦ä¹ çš„ä¸œè¥¿æœ‰ç‚¹å¤šï¼Œæ…¢æ…¢åŠªåŠ›å§~ å…¶ä»–æ‚é¡¹ Go è¯­è¨€è¿›é˜¶ ã€ŠGo å­¦ä¹ ç¬”è®°ï¼ˆç¬¬å…­ç‰ˆä¸‹å·ï¼‰ã€‹ åŸºäº go 1.10ï¼Œè¯¦ç»†åˆ†æ go çš„å®ç°æœºåˆ¶ï¼šå†…å­˜åˆ†é…ã€åƒåœ¾å›æ”¶ã€å¹¶å‘è°ƒåº¦ç­‰ç­‰ Goè¯­è¨€åŠ¨æ‰‹å†™Webæ¡†æ¶ - è¿›åº¦ 20% Go è¯­è¨€é«˜æ€§èƒ½ç¼–ç¨‹ è‹±è¯­ æ‰¾å¤–æ•™ç»ƒå£è¯­ å†å¤šèƒŒç‚¹å•è¯ï¼Œç°åœ¨æˆ‘æŠ€æœ¯è‹±æ–‡èƒ½æ— éšœç¢é˜…è¯»ï¼Œä½†æ˜¯ç”Ÿæ´»è‹±è¯­æ–¹é¢è¯æ±‡é‡ç›¸å½“ä½ã€‚ ã€Šè‹±è¯­è¯­æ³•æ–°æ€ç»´â€”â€”åˆçº§æ•™ç¨‹ã€‹ ã€ŠEnglish Grammar In Useã€‹è¯­æ³•ä¹¦ ã€ŠKey words for fluencyã€‹å£è¯­è¡¨è¾¾ ç”Ÿæ´»ï¼š å¨±ä¹+è¿åŠ¨ï¼š è½®æ»‘ï¼šå€’æ»‘åå‹æ­¥ æ¸¸æ³³ï¼šå­¦ä¼šè›™æ³³å¹¶ä¸”æå‡é€Ÿåº¦ å¾’æ­¥ï¼šå¤ã€å†¬ä¸¤å­£å„å®Œæˆä¸€æ¬¡éº¦ç†æµ©å¾„å…¨ç¨‹ å…¶ä»–èµ„æ–™ è¿™ä¸ªåˆ—è¡¨ä¸­çš„å†…å®¹æ²¡å•¥ä¼˜å…ˆçº§ï¼Œåæ­£å…ˆåˆ—ç€ï¼Œä»€ä¹ˆæ—¶å€™æœ‰å…´è¶£å¯ä»¥ç©ç©ã€‚ é™„ä¸€ä»½å±Œç‚¸å¤©çš„ CS è‡ªå­¦æŒ‡å—ï¼šhttps://github.com/pkuflyingpig/cs-self-learning/ å†™å‡ ä¸ªå°é¡¹ç›®ï¼ˆä½¿ç”¨ rust/goï¼‰ å®ç°ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨ https://viewsourcecode.org/snaptoken/kilo/ å®ç°ä¸€ä¸ªç®€å•çš„ Linux å®¹å™¨ https://blog.lizzie.io/linux-containers-in-500-loc.html ç½‘ç»œä»£ç†ï¼ˆä¸åˆ° 2000 è¡Œçš„ TUN åº“ï¼‰ https://github.com/songgao/water Go è¯­è¨€ Web ç¼–ç¨‹ 7å¤©ç”¨Goä»é›¶å®ç°åˆ†å¸ƒå¼ç¼“å­˜GeeCache 7å¤©ç”¨Goä»é›¶å®ç°ORMæ¡†æ¶GeeORM 7å¤©ç”¨Goä»é›¶å®ç°RPCæ¡†æ¶GeeRPC balancer: æºç é˜…è¯»ï¼Œå¦‚ä½•ä½¿ç”¨ go å®ç°å¸¸è§ balancer ç®—æ³• å®¹å™¨ä¸ Kubernetesï¼ˆå…¶å®å¥½åƒä¹Ÿæ²¡å•¥å…´è¶£ï¼‰ Hacking Kubernetes: Threat-Driven Analysis and Defense: Kubernetes å®‰å…¨ï¼Œå¨èƒæ¨¡å‹ä»¥åŠå¦‚ä½•é˜²æŠ¤ã€‚ Container Security: Fundamental Technology Concepts that Protect Containerized Applications: å®¹å™¨å®‰å…¨ï¼Œè¿™ä¹¦åœ¨äºšé©¬é€Šä¸Šè¯„ä»·å¾ˆå¥½ã€‚ åˆ†å¸ƒå¼æ•°æ®åº“ï¼š å­¦ä¹ è·¯çº¿ æå®¢æ—¶é—´ã€Šåˆ†å¸ƒå¼åè®®ä¸ç®—æ³•å®æˆ˜ã€‹ - å­¦ä¹ è¿›åº¦ 50% åˆ†å¸ƒå¼ç³»ç»Ÿï¼šè¯¾ç¨‹ MIT 6.824 + ä¹¦Designing Data-Intensive Applications æ•°æ®åº“ç³»ç»Ÿï¼šè¯¾ç¨‹CMU 15-445 å‚åŠ  tidb çš„ talent-planï¼Œå®Œæˆ tinykv é¡¹ç›® å…¶ä»–å‚è€ƒä¹¦ç± ã€ŠDistributed Systems, 3rd Edition, 2017ã€‹ ã€ŠDistributed Algorithms, 2nd Edition, 2018ã€‹ SQL è¿›é˜¶æ•™ç¨‹ ","date":"2021-02-01","objectID":"/now/:4:2","series":null,"tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/#2-ä»¥åå¯èƒ½ä¼šæ„Ÿå…´è¶£çš„"},{"categories":null,"content":" 2. ä»¥åå¯èƒ½ä¼šæ„Ÿå…´è¶£çš„ AI infra æ–¹å‘è¿™æ˜¯ä¸€ä¸ªç›¸å½“æ–°çš„æ–¹å‘ï¼Œå› ä¸ºè¿‘ä¸¤å¹´ AI å¼€å§‹è½åœ°è€Œå…´èµ·ï¼Œå®ƒæ—¢è¦æ±‚ç†Ÿæ‚‰ K8s/Istio ç­‰ä¼ ç»Ÿ infra ç»„ä»¶ï¼Œåˆè¦æ±‚å¯¹ AI è®­ç»ƒæ¨ç†ç›¸å…³çš„æŠ€æœ¯æœ‰è¶³å¤Ÿäº†è§£ï¼Œä¾‹å¦‚ï¼š Operator: training-operator è°ƒåº¦ï¼švolcano æ¡†æ¶ï¼šKubeflow, RayTrain, Argo Workflows æ€§èƒ½ä¼˜åŒ–ï¼šTriton/BentoML/vLLM/PyTorch/CUDA æ„Ÿè§‰æ˜¯ä¸€ä¸ªè½¬å‹çš„æ–¹å‘ï¼Œä¸šä½™å¯ä»¥çœ‹çœ‹ã€‚ ç›¸å…³èµ„æ–™ï¼š https://github.com/stas00/ml-engineering/ å¿ƒç†å­¦ä¸è®¤çŸ¥ç¥ç»ç§‘å­¦å­¦ä¹ è·¯çº¿ï¼š å…¥é—¨ï¼š ã€Šè¿™æ‰æ˜¯å¿ƒç†å­¦ - çœ‹ç©¿ä¼ªç§‘å­¦çš„æ‰¹åˆ¤æ€§æ€ç»´ ç¬¬ 11 ç‰ˆã€‹ Psychology and Life, 20th edition, by Richard J. Gerrig, 2012 Educational Psychology, 14th Global Edition (Anita Woolfolk, 2021) Development Across the Life Span, 10th edition (Robert S. Feldman, 2023) è¿›é˜¶åˆ°è®¤çŸ¥ç¥ç»ç§‘å­¦ Neuroscience: Exploring the Brain, 4th edition (2015) Cognitive Neuroscience: The Biology of the Mind, 5th edition (2019) å…¶ä»–æ–¹å‘ ã€ŠIntimate Relationshipsã€‹ - è¿›åº¦ 14/449 ã€ŠSocial Psychology, 14e, David Myersã€‹ åµŒå…¥å¼/ç‰©è”ç½‘åµŒå…¥å¼è·Ÿ IoT æ˜¯æˆ‘ 2022 å¹´åº•å¼€çš„æ–°å‘ï¼Œç›®å‰å…´è¶£å¼ºçƒˆã€‚ ä¹‹å‰åˆ¶å®šçš„ FPGA å­¦ä¹ è·¯çº¿ï¼š ä»æ•°å­—ç”µè·¯åˆ° FPGA å†åˆ° RISC-V å½“å‰ç›®æ ‡ï¼šç”¨ FPGA å®ç°äº›å°åŠŸèƒ½ å…ˆå­¦ç‚¹æ•°å­—ç”µè·¯åŸºç¡€çŸ¥è¯† ä¹¦ç±ï¼šPractical Electronics for Inventors, Fourth Edition ä¸ºäº†å¿«é€Ÿä¸Šæ‰‹ï¼Œç›´æ¥è·³è¿‡æ¨¡æ‹Ÿç”µè·¯éƒ¨åˆ†ï¼Œçœ‹ç¬¬ 12 åˆ°ç¬¬ 13 ç«  å†å­¦ç‚¹ FPGA åŸºç¡€çŸ¥è¯† ä¹¦ç±ï¼šPractical Electronics for Inventors, Fourth Edition å¼€å‘æ¿ï¼šçŸ½é€Ÿè”æç³–ç³»åˆ—ï¼Œä¸»è¦ç”¨ verilog è¯­è¨€å¼€å‘ é˜…è¯»ç¬¬ 14 ç« ï¼Œç®€å•å…¥é—¨ FPGA verilog è¯­è¨€ï¼Œç›´æ¥ç”¨è¿™ä¸ªç«™ç‚¹å°±å¤Ÿäº†ï¼Œæ˜¯éå¸¸å¥½çš„æ•™ç¨‹ + ç»ƒä¹ åœºï¼š https://hdlbits.01xz.net/wiki/Main_Page æ›´æœ‰è¶£çš„ç»ƒä¹ é¢˜ï¼š https://www.fpga4fun.com/ ä» LED ç‚¹ç¯åˆ° RISCV CPUï¼ˆå¾ªåºæ¸è¿›ï¼‰:https://github.com/BrunoLevy/learn-fpga/blob/master/FemtoRV/TUTORIALS/FROM_BLINKER_TO_RISCV/README.md è¿›é˜¶ï¼šå­¦ä¹  RISCV ä¸å¤„ç†å™¨å¾®æ¶æ„ ä¹¦ç±ï¼šDigital Design and Computer Architecture RISC-V Edition æ­¤ä¹¦ä»ç¬¬å…­ç« å¼€å§‹è®² RISCV å¾®æ¶æ„ã€‚ æˆ‘ç›®å‰æ”¶é›†çš„ç›¸å…³å†…å®¹ï¼ˆä»…æ˜¯ä¸€ä¸ªèµ„æ–™åˆé›†ï¼Œå†…å®¹æœ‰é‡å¤çš„ï¼‰ï¼š åµŒå…¥å¼ Linux ç³»åˆ— Linux Device Driver Development - Second Edition: Linux é©±åŠ¨ç¼–ç¨‹å…¥é—¨ï¼Œ2022 å¹´å‡ºçš„æ–°ä¹¦ï¼ŒåŸºäº Linux 5.10ï¼Œamazon ä¸Šè¯„ä»·ä¸é”™ï¼Œç›®å‰åªæœ‰è‹±æ–‡ç‰ˆï¼Œå†™çš„å¾ˆå¥½ï¼Œå¯¹æ–°æ‰‹å¾ˆå‹å¥½ã€‚ Linux Driver Development for Embedded Processors 2nd Edition: è¿™æœ¬æ˜¯ 2018 å¹´å‡ºçš„ï¼Œå†™å¾—æ²¡ä¸Šé¢é‚£æœ¬å¥½ã€å†…å®¹ä¹Ÿæ²¡é‚£ä¹ˆæ–°ï¼Œä½†æ˜¯çœ‹è¯„ä»·ä¹Ÿä¸é”™ï¼Œç‰¹ç‚¹æ˜¯æœ‰è®¸å¤šçš„ Lab å¯åšã€‚ Linux Kernel Programming: A comprehensive guide to kernel internals: Linux å†…æ ¸ç¼–ç¨‹é¢†åŸŸçš„æ–°ä¹¦ï¼Œé€‚åˆå…¥é—¨ Linux å†…æ ¸ï¼Œamazon ä¸Šè¯„ä»·æŒºå¥½ï¼Œå…ˆæ”¶è—ä¸€ä¸ª Understanding the Linux Kernel, 3rd Editionï¼šLinux å†…æ ¸æŠ€æœ¯è¿›é˜¶ã€‚ linux-insides: ä» bootloader å¼€å§‹è®²è§£äº† Linux å†…æ ¸çš„è®¸å¤šé‡è¦çš„åŠŸèƒ½æ¨¡å—ï¼Œçœ‹ stars å¾ˆé«˜æ‰€ä»¥ä¹Ÿåœ¨è¿™é‡Œåˆ—ä¸€ä¸‹ã€‚ ç”µè·¯åŸç† Practical Electronics for Inventors, Fourth Edition èŠ¯ç‰‡ ARM64: STM32 ESP32 RK3588s RISCV: milkv mars/duo, licheepi4a FPGA / ç”µè·¯è®¾è®¡:FPGA ç©è€ä¹‹æ—… ç›®å‰çš„å­¦ä¹ ç›®æ ‡ DIY æ— äººæœºç¼–é˜Ÿé£è¡Œï¼è¦è¾¾æˆè¿™ä¸ªç›®æ ‡éœ€è¦å­¦ä¹ çš„ä¸œè¥¿æœ‰ç‚¹å¤šï¼Œæ…¢æ…¢åŠªåŠ›å§~ å…¶ä»–æ‚é¡¹ Go è¯­è¨€è¿›é˜¶ ã€ŠGo å­¦ä¹ ç¬”è®°ï¼ˆç¬¬å…­ç‰ˆä¸‹å·ï¼‰ã€‹ åŸºäº go 1.10ï¼Œè¯¦ç»†åˆ†æ go çš„å®ç°æœºåˆ¶ï¼šå†…å­˜åˆ†é…ã€åƒåœ¾å›æ”¶ã€å¹¶å‘è°ƒåº¦ç­‰ç­‰ Goè¯­è¨€åŠ¨æ‰‹å†™Webæ¡†æ¶ - è¿›åº¦ 20% Go è¯­è¨€é«˜æ€§èƒ½ç¼–ç¨‹ è‹±è¯­ æ‰¾å¤–æ•™ç»ƒå£è¯­ å†å¤šèƒŒç‚¹å•è¯ï¼Œç°åœ¨æˆ‘æŠ€æœ¯è‹±æ–‡èƒ½æ— éšœç¢é˜…è¯»ï¼Œä½†æ˜¯ç”Ÿæ´»è‹±è¯­æ–¹é¢è¯æ±‡é‡ç›¸å½“ä½ã€‚ ã€Šè‹±è¯­è¯­æ³•æ–°æ€ç»´â€”â€”åˆçº§æ•™ç¨‹ã€‹ ã€ŠEnglish Grammar In Useã€‹è¯­æ³•ä¹¦ ã€ŠKey words for fluencyã€‹å£è¯­è¡¨è¾¾ ç”Ÿæ´»ï¼š å¨±ä¹+è¿åŠ¨ï¼š è½®æ»‘ï¼šå€’æ»‘åå‹æ­¥ æ¸¸æ³³ï¼šå­¦ä¼šè›™æ³³å¹¶ä¸”æå‡é€Ÿåº¦ å¾’æ­¥ï¼šå¤ã€å†¬ä¸¤å­£å„å®Œæˆä¸€æ¬¡éº¦ç†æµ©å¾„å…¨ç¨‹ å…¶ä»–èµ„æ–™ è¿™ä¸ªåˆ—è¡¨ä¸­çš„å†…å®¹æ²¡å•¥ä¼˜å…ˆçº§ï¼Œåæ­£å…ˆåˆ—ç€ï¼Œä»€ä¹ˆæ—¶å€™æœ‰å…´è¶£å¯ä»¥ç©ç©ã€‚ é™„ä¸€ä»½å±Œç‚¸å¤©çš„ CS è‡ªå­¦æŒ‡å—ï¼šhttps://github.com/pkuflyingpig/cs-self-learning/ å†™å‡ ä¸ªå°é¡¹ç›®ï¼ˆä½¿ç”¨ rust/goï¼‰ å®ç°ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨ https://viewsourcecode.org/snaptoken/kilo/ å®ç°ä¸€ä¸ªç®€å•çš„ Linux å®¹å™¨ https://blog.lizzie.io/linux-containers-in-500-loc.html ç½‘ç»œä»£ç†ï¼ˆä¸åˆ° 2000 è¡Œçš„ TUN åº“ï¼‰ https://github.com/songgao/water Go è¯­è¨€ Web ç¼–ç¨‹ 7å¤©ç”¨Goä»é›¶å®ç°åˆ†å¸ƒå¼ç¼“å­˜GeeCache 7å¤©ç”¨Goä»é›¶å®ç°ORMæ¡†æ¶GeeORM 7å¤©ç”¨Goä»é›¶å®ç°RPCæ¡†æ¶GeeRPC balancer: æºç é˜…è¯»ï¼Œå¦‚ä½•ä½¿ç”¨ go å®ç°å¸¸è§ balancer ç®—æ³• å®¹å™¨ä¸ Kubernetesï¼ˆå…¶å®å¥½åƒä¹Ÿæ²¡å•¥å…´è¶£ï¼‰ Hacking Kubernetes: Threat-Driven Analysis and Defense: Kubernetes å®‰å…¨ï¼Œå¨èƒæ¨¡å‹ä»¥åŠå¦‚ä½•é˜²æŠ¤ã€‚ Container Security: Fundamental Technology Concepts that Protect Containerized Applications: å®¹å™¨å®‰å…¨ï¼Œè¿™ä¹¦åœ¨äºšé©¬é€Šä¸Šè¯„ä»·å¾ˆå¥½ã€‚ åˆ†å¸ƒå¼æ•°æ®åº“ï¼š å­¦ä¹ è·¯çº¿ æå®¢æ—¶é—´ã€Šåˆ†å¸ƒå¼åè®®ä¸ç®—æ³•å®æˆ˜ã€‹ - å­¦ä¹ è¿›åº¦ 50% åˆ†å¸ƒå¼ç³»ç»Ÿï¼šè¯¾ç¨‹ MIT 6.824 + ä¹¦Designing Data-Intensive Applications æ•°æ®åº“ç³»ç»Ÿï¼šè¯¾ç¨‹CMU 15-445 å‚åŠ  tidb çš„ talent-planï¼Œå®Œæˆ tinykv é¡¹ç›® å…¶ä»–å‚è€ƒä¹¦ç± ã€ŠDistributed Systems, 3rd Edition, 2017ã€‹ ã€ŠDistributed Algorithms, 2nd Edition, 2018ã€‹ SQL è¿›é˜¶æ•™ç¨‹ ","date":"2021-02-01","objectID":"/now/:4:2","series":null,"tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/#ai-infra-æ–¹å‘"},{"categories":null,"content":" 2. ä»¥åå¯èƒ½ä¼šæ„Ÿå…´è¶£çš„ AI infra æ–¹å‘è¿™æ˜¯ä¸€ä¸ªç›¸å½“æ–°çš„æ–¹å‘ï¼Œå› ä¸ºè¿‘ä¸¤å¹´ AI å¼€å§‹è½åœ°è€Œå…´èµ·ï¼Œå®ƒæ—¢è¦æ±‚ç†Ÿæ‚‰ K8s/Istio ç­‰ä¼ ç»Ÿ infra ç»„ä»¶ï¼Œåˆè¦æ±‚å¯¹ AI è®­ç»ƒæ¨ç†ç›¸å…³çš„æŠ€æœ¯æœ‰è¶³å¤Ÿäº†è§£ï¼Œä¾‹å¦‚ï¼š Operator: training-operator è°ƒåº¦ï¼švolcano æ¡†æ¶ï¼šKubeflow, RayTrain, Argo Workflows æ€§èƒ½ä¼˜åŒ–ï¼šTriton/BentoML/vLLM/PyTorch/CUDA æ„Ÿè§‰æ˜¯ä¸€ä¸ªè½¬å‹çš„æ–¹å‘ï¼Œä¸šä½™å¯ä»¥çœ‹çœ‹ã€‚ ç›¸å…³èµ„æ–™ï¼š https://github.com/stas00/ml-engineering/ å¿ƒç†å­¦ä¸è®¤çŸ¥ç¥ç»ç§‘å­¦å­¦ä¹ è·¯çº¿ï¼š å…¥é—¨ï¼š ã€Šè¿™æ‰æ˜¯å¿ƒç†å­¦ - çœ‹ç©¿ä¼ªç§‘å­¦çš„æ‰¹åˆ¤æ€§æ€ç»´ ç¬¬ 11 ç‰ˆã€‹ Psychology and Life, 20th edition, by Richard J. Gerrig, 2012 Educational Psychology, 14th Global Edition (Anita Woolfolk, 2021) Development Across the Life Span, 10th edition (Robert S. Feldman, 2023) è¿›é˜¶åˆ°è®¤çŸ¥ç¥ç»ç§‘å­¦ Neuroscience: Exploring the Brain, 4th edition (2015) Cognitive Neuroscience: The Biology of the Mind, 5th edition (2019) å…¶ä»–æ–¹å‘ ã€ŠIntimate Relationshipsã€‹ - è¿›åº¦ 14/449 ã€ŠSocial Psychology, 14e, David Myersã€‹ åµŒå…¥å¼/ç‰©è”ç½‘åµŒå…¥å¼è·Ÿ IoT æ˜¯æˆ‘ 2022 å¹´åº•å¼€çš„æ–°å‘ï¼Œç›®å‰å…´è¶£å¼ºçƒˆã€‚ ä¹‹å‰åˆ¶å®šçš„ FPGA å­¦ä¹ è·¯çº¿ï¼š ä»æ•°å­—ç”µè·¯åˆ° FPGA å†åˆ° RISC-V å½“å‰ç›®æ ‡ï¼šç”¨ FPGA å®ç°äº›å°åŠŸèƒ½ å…ˆå­¦ç‚¹æ•°å­—ç”µè·¯åŸºç¡€çŸ¥è¯† ä¹¦ç±ï¼šPractical Electronics for Inventors, Fourth Edition ä¸ºäº†å¿«é€Ÿä¸Šæ‰‹ï¼Œç›´æ¥è·³è¿‡æ¨¡æ‹Ÿç”µè·¯éƒ¨åˆ†ï¼Œçœ‹ç¬¬ 12 åˆ°ç¬¬ 13 ç«  å†å­¦ç‚¹ FPGA åŸºç¡€çŸ¥è¯† ä¹¦ç±ï¼šPractical Electronics for Inventors, Fourth Edition å¼€å‘æ¿ï¼šçŸ½é€Ÿè”æç³–ç³»åˆ—ï¼Œä¸»è¦ç”¨ verilog è¯­è¨€å¼€å‘ é˜…è¯»ç¬¬ 14 ç« ï¼Œç®€å•å…¥é—¨ FPGA verilog è¯­è¨€ï¼Œç›´æ¥ç”¨è¿™ä¸ªç«™ç‚¹å°±å¤Ÿäº†ï¼Œæ˜¯éå¸¸å¥½çš„æ•™ç¨‹ + ç»ƒä¹ åœºï¼š https://hdlbits.01xz.net/wiki/Main_Page æ›´æœ‰è¶£çš„ç»ƒä¹ é¢˜ï¼š https://www.fpga4fun.com/ ä» LED ç‚¹ç¯åˆ° RISCV CPUï¼ˆå¾ªåºæ¸è¿›ï¼‰:https://github.com/BrunoLevy/learn-fpga/blob/master/FemtoRV/TUTORIALS/FROM_BLINKER_TO_RISCV/README.md è¿›é˜¶ï¼šå­¦ä¹  RISCV ä¸å¤„ç†å™¨å¾®æ¶æ„ ä¹¦ç±ï¼šDigital Design and Computer Architecture RISC-V Edition æ­¤ä¹¦ä»ç¬¬å…­ç« å¼€å§‹è®² RISCV å¾®æ¶æ„ã€‚ æˆ‘ç›®å‰æ”¶é›†çš„ç›¸å…³å†…å®¹ï¼ˆä»…æ˜¯ä¸€ä¸ªèµ„æ–™åˆé›†ï¼Œå†…å®¹æœ‰é‡å¤çš„ï¼‰ï¼š åµŒå…¥å¼ Linux ç³»åˆ— Linux Device Driver Development - Second Edition: Linux é©±åŠ¨ç¼–ç¨‹å…¥é—¨ï¼Œ2022 å¹´å‡ºçš„æ–°ä¹¦ï¼ŒåŸºäº Linux 5.10ï¼Œamazon ä¸Šè¯„ä»·ä¸é”™ï¼Œç›®å‰åªæœ‰è‹±æ–‡ç‰ˆï¼Œå†™çš„å¾ˆå¥½ï¼Œå¯¹æ–°æ‰‹å¾ˆå‹å¥½ã€‚ Linux Driver Development for Embedded Processors 2nd Edition: è¿™æœ¬æ˜¯ 2018 å¹´å‡ºçš„ï¼Œå†™å¾—æ²¡ä¸Šé¢é‚£æœ¬å¥½ã€å†…å®¹ä¹Ÿæ²¡é‚£ä¹ˆæ–°ï¼Œä½†æ˜¯çœ‹è¯„ä»·ä¹Ÿä¸é”™ï¼Œç‰¹ç‚¹æ˜¯æœ‰è®¸å¤šçš„ Lab å¯åšã€‚ Linux Kernel Programming: A comprehensive guide to kernel internals: Linux å†…æ ¸ç¼–ç¨‹é¢†åŸŸçš„æ–°ä¹¦ï¼Œé€‚åˆå…¥é—¨ Linux å†…æ ¸ï¼Œamazon ä¸Šè¯„ä»·æŒºå¥½ï¼Œå…ˆæ”¶è—ä¸€ä¸ª Understanding the Linux Kernel, 3rd Editionï¼šLinux å†…æ ¸æŠ€æœ¯è¿›é˜¶ã€‚ linux-insides: ä» bootloader å¼€å§‹è®²è§£äº† Linux å†…æ ¸çš„è®¸å¤šé‡è¦çš„åŠŸèƒ½æ¨¡å—ï¼Œçœ‹ stars å¾ˆé«˜æ‰€ä»¥ä¹Ÿåœ¨è¿™é‡Œåˆ—ä¸€ä¸‹ã€‚ ç”µè·¯åŸç† Practical Electronics for Inventors, Fourth Edition èŠ¯ç‰‡ ARM64: STM32 ESP32 RK3588s RISCV: milkv mars/duo, licheepi4a FPGA / ç”µè·¯è®¾è®¡:FPGA ç©è€ä¹‹æ—… ç›®å‰çš„å­¦ä¹ ç›®æ ‡ DIY æ— äººæœºç¼–é˜Ÿé£è¡Œï¼è¦è¾¾æˆè¿™ä¸ªç›®æ ‡éœ€è¦å­¦ä¹ çš„ä¸œè¥¿æœ‰ç‚¹å¤šï¼Œæ…¢æ…¢åŠªåŠ›å§~ å…¶ä»–æ‚é¡¹ Go è¯­è¨€è¿›é˜¶ ã€ŠGo å­¦ä¹ ç¬”è®°ï¼ˆç¬¬å…­ç‰ˆä¸‹å·ï¼‰ã€‹ åŸºäº go 1.10ï¼Œè¯¦ç»†åˆ†æ go çš„å®ç°æœºåˆ¶ï¼šå†…å­˜åˆ†é…ã€åƒåœ¾å›æ”¶ã€å¹¶å‘è°ƒåº¦ç­‰ç­‰ Goè¯­è¨€åŠ¨æ‰‹å†™Webæ¡†æ¶ - è¿›åº¦ 20% Go è¯­è¨€é«˜æ€§èƒ½ç¼–ç¨‹ è‹±è¯­ æ‰¾å¤–æ•™ç»ƒå£è¯­ å†å¤šèƒŒç‚¹å•è¯ï¼Œç°åœ¨æˆ‘æŠ€æœ¯è‹±æ–‡èƒ½æ— éšœç¢é˜…è¯»ï¼Œä½†æ˜¯ç”Ÿæ´»è‹±è¯­æ–¹é¢è¯æ±‡é‡ç›¸å½“ä½ã€‚ ã€Šè‹±è¯­è¯­æ³•æ–°æ€ç»´â€”â€”åˆçº§æ•™ç¨‹ã€‹ ã€ŠEnglish Grammar In Useã€‹è¯­æ³•ä¹¦ ã€ŠKey words for fluencyã€‹å£è¯­è¡¨è¾¾ ç”Ÿæ´»ï¼š å¨±ä¹+è¿åŠ¨ï¼š è½®æ»‘ï¼šå€’æ»‘åå‹æ­¥ æ¸¸æ³³ï¼šå­¦ä¼šè›™æ³³å¹¶ä¸”æå‡é€Ÿåº¦ å¾’æ­¥ï¼šå¤ã€å†¬ä¸¤å­£å„å®Œæˆä¸€æ¬¡éº¦ç†æµ©å¾„å…¨ç¨‹ å…¶ä»–èµ„æ–™ è¿™ä¸ªåˆ—è¡¨ä¸­çš„å†…å®¹æ²¡å•¥ä¼˜å…ˆçº§ï¼Œåæ­£å…ˆåˆ—ç€ï¼Œä»€ä¹ˆæ—¶å€™æœ‰å…´è¶£å¯ä»¥ç©ç©ã€‚ é™„ä¸€ä»½å±Œç‚¸å¤©çš„ CS è‡ªå­¦æŒ‡å—ï¼šhttps://github.com/pkuflyingpig/cs-self-learning/ å†™å‡ ä¸ªå°é¡¹ç›®ï¼ˆä½¿ç”¨ rust/goï¼‰ å®ç°ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨ https://viewsourcecode.org/snaptoken/kilo/ å®ç°ä¸€ä¸ªç®€å•çš„ Linux å®¹å™¨ https://blog.lizzie.io/linux-containers-in-500-loc.html ç½‘ç»œä»£ç†ï¼ˆä¸åˆ° 2000 è¡Œçš„ TUN åº“ï¼‰ https://github.com/songgao/water Go è¯­è¨€ Web ç¼–ç¨‹ 7å¤©ç”¨Goä»é›¶å®ç°åˆ†å¸ƒå¼ç¼“å­˜GeeCache 7å¤©ç”¨Goä»é›¶å®ç°ORMæ¡†æ¶GeeORM 7å¤©ç”¨Goä»é›¶å®ç°RPCæ¡†æ¶GeeRPC balancer: æºç é˜…è¯»ï¼Œå¦‚ä½•ä½¿ç”¨ go å®ç°å¸¸è§ balancer ç®—æ³• å®¹å™¨ä¸ Kubernetesï¼ˆå…¶å®å¥½åƒä¹Ÿæ²¡å•¥å…´è¶£ï¼‰ Hacking Kubernetes: Threat-Driven Analysis and Defense: Kubernetes å®‰å…¨ï¼Œå¨èƒæ¨¡å‹ä»¥åŠå¦‚ä½•é˜²æŠ¤ã€‚ Container Security: Fundamental Technology Concepts that Protect Containerized Applications: å®¹å™¨å®‰å…¨ï¼Œè¿™ä¹¦åœ¨äºšé©¬é€Šä¸Šè¯„ä»·å¾ˆå¥½ã€‚ åˆ†å¸ƒå¼æ•°æ®åº“ï¼š å­¦ä¹ è·¯çº¿ æå®¢æ—¶é—´ã€Šåˆ†å¸ƒå¼åè®®ä¸ç®—æ³•å®æˆ˜ã€‹ - å­¦ä¹ è¿›åº¦ 50% åˆ†å¸ƒå¼ç³»ç»Ÿï¼šè¯¾ç¨‹ MIT 6.824 + ä¹¦Designing Data-Intensive Applications æ•°æ®åº“ç³»ç»Ÿï¼šè¯¾ç¨‹CMU 15-445 å‚åŠ  tidb çš„ talent-planï¼Œå®Œæˆ tinykv é¡¹ç›® å…¶ä»–å‚è€ƒä¹¦ç± ã€ŠDistributed Systems, 3rd Edition, 2017ã€‹ ã€ŠDistributed Algorithms, 2nd Edition, 2018ã€‹ SQL è¿›é˜¶æ•™ç¨‹ ","date":"2021-02-01","objectID":"/now/:4:2","series":null,"tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/#å¿ƒç†å­¦ä¸è®¤çŸ¥ç¥ç»ç§‘å­¦"},{"categories":null,"content":" 2. ä»¥åå¯èƒ½ä¼šæ„Ÿå…´è¶£çš„ AI infra æ–¹å‘è¿™æ˜¯ä¸€ä¸ªç›¸å½“æ–°çš„æ–¹å‘ï¼Œå› ä¸ºè¿‘ä¸¤å¹´ AI å¼€å§‹è½åœ°è€Œå…´èµ·ï¼Œå®ƒæ—¢è¦æ±‚ç†Ÿæ‚‰ K8s/Istio ç­‰ä¼ ç»Ÿ infra ç»„ä»¶ï¼Œåˆè¦æ±‚å¯¹ AI è®­ç»ƒæ¨ç†ç›¸å…³çš„æŠ€æœ¯æœ‰è¶³å¤Ÿäº†è§£ï¼Œä¾‹å¦‚ï¼š Operator: training-operator è°ƒåº¦ï¼švolcano æ¡†æ¶ï¼šKubeflow, RayTrain, Argo Workflows æ€§èƒ½ä¼˜åŒ–ï¼šTriton/BentoML/vLLM/PyTorch/CUDA æ„Ÿè§‰æ˜¯ä¸€ä¸ªè½¬å‹çš„æ–¹å‘ï¼Œä¸šä½™å¯ä»¥çœ‹çœ‹ã€‚ ç›¸å…³èµ„æ–™ï¼š https://github.com/stas00/ml-engineering/ å¿ƒç†å­¦ä¸è®¤çŸ¥ç¥ç»ç§‘å­¦å­¦ä¹ è·¯çº¿ï¼š å…¥é—¨ï¼š ã€Šè¿™æ‰æ˜¯å¿ƒç†å­¦ - çœ‹ç©¿ä¼ªç§‘å­¦çš„æ‰¹åˆ¤æ€§æ€ç»´ ç¬¬ 11 ç‰ˆã€‹ Psychology and Life, 20th edition, by Richard J. Gerrig, 2012 Educational Psychology, 14th Global Edition (Anita Woolfolk, 2021) Development Across the Life Span, 10th edition (Robert S. Feldman, 2023) è¿›é˜¶åˆ°è®¤çŸ¥ç¥ç»ç§‘å­¦ Neuroscience: Exploring the Brain, 4th edition (2015) Cognitive Neuroscience: The Biology of the Mind, 5th edition (2019) å…¶ä»–æ–¹å‘ ã€ŠIntimate Relationshipsã€‹ - è¿›åº¦ 14/449 ã€ŠSocial Psychology, 14e, David Myersã€‹ åµŒå…¥å¼/ç‰©è”ç½‘åµŒå…¥å¼è·Ÿ IoT æ˜¯æˆ‘ 2022 å¹´åº•å¼€çš„æ–°å‘ï¼Œç›®å‰å…´è¶£å¼ºçƒˆã€‚ ä¹‹å‰åˆ¶å®šçš„ FPGA å­¦ä¹ è·¯çº¿ï¼š ä»æ•°å­—ç”µè·¯åˆ° FPGA å†åˆ° RISC-V å½“å‰ç›®æ ‡ï¼šç”¨ FPGA å®ç°äº›å°åŠŸèƒ½ å…ˆå­¦ç‚¹æ•°å­—ç”µè·¯åŸºç¡€çŸ¥è¯† ä¹¦ç±ï¼šPractical Electronics for Inventors, Fourth Edition ä¸ºäº†å¿«é€Ÿä¸Šæ‰‹ï¼Œç›´æ¥è·³è¿‡æ¨¡æ‹Ÿç”µè·¯éƒ¨åˆ†ï¼Œçœ‹ç¬¬ 12 åˆ°ç¬¬ 13 ç«  å†å­¦ç‚¹ FPGA åŸºç¡€çŸ¥è¯† ä¹¦ç±ï¼šPractical Electronics for Inventors, Fourth Edition å¼€å‘æ¿ï¼šçŸ½é€Ÿè”æç³–ç³»åˆ—ï¼Œä¸»è¦ç”¨ verilog è¯­è¨€å¼€å‘ é˜…è¯»ç¬¬ 14 ç« ï¼Œç®€å•å…¥é—¨ FPGA verilog è¯­è¨€ï¼Œç›´æ¥ç”¨è¿™ä¸ªç«™ç‚¹å°±å¤Ÿäº†ï¼Œæ˜¯éå¸¸å¥½çš„æ•™ç¨‹ + ç»ƒä¹ åœºï¼š https://hdlbits.01xz.net/wiki/Main_Page æ›´æœ‰è¶£çš„ç»ƒä¹ é¢˜ï¼š https://www.fpga4fun.com/ ä» LED ç‚¹ç¯åˆ° RISCV CPUï¼ˆå¾ªåºæ¸è¿›ï¼‰:https://github.com/BrunoLevy/learn-fpga/blob/master/FemtoRV/TUTORIALS/FROM_BLINKER_TO_RISCV/README.md è¿›é˜¶ï¼šå­¦ä¹  RISCV ä¸å¤„ç†å™¨å¾®æ¶æ„ ä¹¦ç±ï¼šDigital Design and Computer Architecture RISC-V Edition æ­¤ä¹¦ä»ç¬¬å…­ç« å¼€å§‹è®² RISCV å¾®æ¶æ„ã€‚ æˆ‘ç›®å‰æ”¶é›†çš„ç›¸å…³å†…å®¹ï¼ˆä»…æ˜¯ä¸€ä¸ªèµ„æ–™åˆé›†ï¼Œå†…å®¹æœ‰é‡å¤çš„ï¼‰ï¼š åµŒå…¥å¼ Linux ç³»åˆ— Linux Device Driver Development - Second Edition: Linux é©±åŠ¨ç¼–ç¨‹å…¥é—¨ï¼Œ2022 å¹´å‡ºçš„æ–°ä¹¦ï¼ŒåŸºäº Linux 5.10ï¼Œamazon ä¸Šè¯„ä»·ä¸é”™ï¼Œç›®å‰åªæœ‰è‹±æ–‡ç‰ˆï¼Œå†™çš„å¾ˆå¥½ï¼Œå¯¹æ–°æ‰‹å¾ˆå‹å¥½ã€‚ Linux Driver Development for Embedded Processors 2nd Edition: è¿™æœ¬æ˜¯ 2018 å¹´å‡ºçš„ï¼Œå†™å¾—æ²¡ä¸Šé¢é‚£æœ¬å¥½ã€å†…å®¹ä¹Ÿæ²¡é‚£ä¹ˆæ–°ï¼Œä½†æ˜¯çœ‹è¯„ä»·ä¹Ÿä¸é”™ï¼Œç‰¹ç‚¹æ˜¯æœ‰è®¸å¤šçš„ Lab å¯åšã€‚ Linux Kernel Programming: A comprehensive guide to kernel internals: Linux å†…æ ¸ç¼–ç¨‹é¢†åŸŸçš„æ–°ä¹¦ï¼Œé€‚åˆå…¥é—¨ Linux å†…æ ¸ï¼Œamazon ä¸Šè¯„ä»·æŒºå¥½ï¼Œå…ˆæ”¶è—ä¸€ä¸ª Understanding the Linux Kernel, 3rd Editionï¼šLinux å†…æ ¸æŠ€æœ¯è¿›é˜¶ã€‚ linux-insides: ä» bootloader å¼€å§‹è®²è§£äº† Linux å†…æ ¸çš„è®¸å¤šé‡è¦çš„åŠŸèƒ½æ¨¡å—ï¼Œçœ‹ stars å¾ˆé«˜æ‰€ä»¥ä¹Ÿåœ¨è¿™é‡Œåˆ—ä¸€ä¸‹ã€‚ ç”µè·¯åŸç† Practical Electronics for Inventors, Fourth Edition èŠ¯ç‰‡ ARM64: STM32 ESP32 RK3588s RISCV: milkv mars/duo, licheepi4a FPGA / ç”µè·¯è®¾è®¡:FPGA ç©è€ä¹‹æ—… ç›®å‰çš„å­¦ä¹ ç›®æ ‡ DIY æ— äººæœºç¼–é˜Ÿé£è¡Œï¼è¦è¾¾æˆè¿™ä¸ªç›®æ ‡éœ€è¦å­¦ä¹ çš„ä¸œè¥¿æœ‰ç‚¹å¤šï¼Œæ…¢æ…¢åŠªåŠ›å§~ å…¶ä»–æ‚é¡¹ Go è¯­è¨€è¿›é˜¶ ã€ŠGo å­¦ä¹ ç¬”è®°ï¼ˆç¬¬å…­ç‰ˆä¸‹å·ï¼‰ã€‹ åŸºäº go 1.10ï¼Œè¯¦ç»†åˆ†æ go çš„å®ç°æœºåˆ¶ï¼šå†…å­˜åˆ†é…ã€åƒåœ¾å›æ”¶ã€å¹¶å‘è°ƒåº¦ç­‰ç­‰ Goè¯­è¨€åŠ¨æ‰‹å†™Webæ¡†æ¶ - è¿›åº¦ 20% Go è¯­è¨€é«˜æ€§èƒ½ç¼–ç¨‹ è‹±è¯­ æ‰¾å¤–æ•™ç»ƒå£è¯­ å†å¤šèƒŒç‚¹å•è¯ï¼Œç°åœ¨æˆ‘æŠ€æœ¯è‹±æ–‡èƒ½æ— éšœç¢é˜…è¯»ï¼Œä½†æ˜¯ç”Ÿæ´»è‹±è¯­æ–¹é¢è¯æ±‡é‡ç›¸å½“ä½ã€‚ ã€Šè‹±è¯­è¯­æ³•æ–°æ€ç»´â€”â€”åˆçº§æ•™ç¨‹ã€‹ ã€ŠEnglish Grammar In Useã€‹è¯­æ³•ä¹¦ ã€ŠKey words for fluencyã€‹å£è¯­è¡¨è¾¾ ç”Ÿæ´»ï¼š å¨±ä¹+è¿åŠ¨ï¼š è½®æ»‘ï¼šå€’æ»‘åå‹æ­¥ æ¸¸æ³³ï¼šå­¦ä¼šè›™æ³³å¹¶ä¸”æå‡é€Ÿåº¦ å¾’æ­¥ï¼šå¤ã€å†¬ä¸¤å­£å„å®Œæˆä¸€æ¬¡éº¦ç†æµ©å¾„å…¨ç¨‹ å…¶ä»–èµ„æ–™ è¿™ä¸ªåˆ—è¡¨ä¸­çš„å†…å®¹æ²¡å•¥ä¼˜å…ˆçº§ï¼Œåæ­£å…ˆåˆ—ç€ï¼Œä»€ä¹ˆæ—¶å€™æœ‰å…´è¶£å¯ä»¥ç©ç©ã€‚ é™„ä¸€ä»½å±Œç‚¸å¤©çš„ CS è‡ªå­¦æŒ‡å—ï¼šhttps://github.com/pkuflyingpig/cs-self-learning/ å†™å‡ ä¸ªå°é¡¹ç›®ï¼ˆä½¿ç”¨ rust/goï¼‰ å®ç°ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨ https://viewsourcecode.org/snaptoken/kilo/ å®ç°ä¸€ä¸ªç®€å•çš„ Linux å®¹å™¨ https://blog.lizzie.io/linux-containers-in-500-loc.html ç½‘ç»œä»£ç†ï¼ˆä¸åˆ° 2000 è¡Œçš„ TUN åº“ï¼‰ https://github.com/songgao/water Go è¯­è¨€ Web ç¼–ç¨‹ 7å¤©ç”¨Goä»é›¶å®ç°åˆ†å¸ƒå¼ç¼“å­˜GeeCache 7å¤©ç”¨Goä»é›¶å®ç°ORMæ¡†æ¶GeeORM 7å¤©ç”¨Goä»é›¶å®ç°RPCæ¡†æ¶GeeRPC balancer: æºç é˜…è¯»ï¼Œå¦‚ä½•ä½¿ç”¨ go å®ç°å¸¸è§ balancer ç®—æ³• å®¹å™¨ä¸ Kubernetesï¼ˆå…¶å®å¥½åƒä¹Ÿæ²¡å•¥å…´è¶£ï¼‰ Hacking Kubernetes: Threat-Driven Analysis and Defense: Kubernetes å®‰å…¨ï¼Œå¨èƒæ¨¡å‹ä»¥åŠå¦‚ä½•é˜²æŠ¤ã€‚ Container Security: Fundamental Technology Concepts that Protect Containerized Applications: å®¹å™¨å®‰å…¨ï¼Œè¿™ä¹¦åœ¨äºšé©¬é€Šä¸Šè¯„ä»·å¾ˆå¥½ã€‚ åˆ†å¸ƒå¼æ•°æ®åº“ï¼š å­¦ä¹ è·¯çº¿ æå®¢æ—¶é—´ã€Šåˆ†å¸ƒå¼åè®®ä¸ç®—æ³•å®æˆ˜ã€‹ - å­¦ä¹ è¿›åº¦ 50% åˆ†å¸ƒå¼ç³»ç»Ÿï¼šè¯¾ç¨‹ MIT 6.824 + ä¹¦Designing Data-Intensive Applications æ•°æ®åº“ç³»ç»Ÿï¼šè¯¾ç¨‹CMU 15-445 å‚åŠ  tidb çš„ talent-planï¼Œå®Œæˆ tinykv é¡¹ç›® å…¶ä»–å‚è€ƒä¹¦ç± ã€ŠDistributed Systems, 3rd Edition, 2017ã€‹ ã€ŠDistributed Algorithms, 2nd Edition, 2018ã€‹ SQL è¿›é˜¶æ•™ç¨‹ ","date":"2021-02-01","objectID":"/now/:4:2","series":null,"tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/#åµŒå…¥å¼ç‰©è”ç½‘"},{"categories":null,"content":" 2. ä»¥åå¯èƒ½ä¼šæ„Ÿå…´è¶£çš„ AI infra æ–¹å‘è¿™æ˜¯ä¸€ä¸ªç›¸å½“æ–°çš„æ–¹å‘ï¼Œå› ä¸ºè¿‘ä¸¤å¹´ AI å¼€å§‹è½åœ°è€Œå…´èµ·ï¼Œå®ƒæ—¢è¦æ±‚ç†Ÿæ‚‰ K8s/Istio ç­‰ä¼ ç»Ÿ infra ç»„ä»¶ï¼Œåˆè¦æ±‚å¯¹ AI è®­ç»ƒæ¨ç†ç›¸å…³çš„æŠ€æœ¯æœ‰è¶³å¤Ÿäº†è§£ï¼Œä¾‹å¦‚ï¼š Operator: training-operator è°ƒåº¦ï¼švolcano æ¡†æ¶ï¼šKubeflow, RayTrain, Argo Workflows æ€§èƒ½ä¼˜åŒ–ï¼šTriton/BentoML/vLLM/PyTorch/CUDA æ„Ÿè§‰æ˜¯ä¸€ä¸ªè½¬å‹çš„æ–¹å‘ï¼Œä¸šä½™å¯ä»¥çœ‹çœ‹ã€‚ ç›¸å…³èµ„æ–™ï¼š https://github.com/stas00/ml-engineering/ å¿ƒç†å­¦ä¸è®¤çŸ¥ç¥ç»ç§‘å­¦å­¦ä¹ è·¯çº¿ï¼š å…¥é—¨ï¼š ã€Šè¿™æ‰æ˜¯å¿ƒç†å­¦ - çœ‹ç©¿ä¼ªç§‘å­¦çš„æ‰¹åˆ¤æ€§æ€ç»´ ç¬¬ 11 ç‰ˆã€‹ Psychology and Life, 20th edition, by Richard J. Gerrig, 2012 Educational Psychology, 14th Global Edition (Anita Woolfolk, 2021) Development Across the Life Span, 10th edition (Robert S. Feldman, 2023) è¿›é˜¶åˆ°è®¤çŸ¥ç¥ç»ç§‘å­¦ Neuroscience: Exploring the Brain, 4th edition (2015) Cognitive Neuroscience: The Biology of the Mind, 5th edition (2019) å…¶ä»–æ–¹å‘ ã€ŠIntimate Relationshipsã€‹ - è¿›åº¦ 14/449 ã€ŠSocial Psychology, 14e, David Myersã€‹ åµŒå…¥å¼/ç‰©è”ç½‘åµŒå…¥å¼è·Ÿ IoT æ˜¯æˆ‘ 2022 å¹´åº•å¼€çš„æ–°å‘ï¼Œç›®å‰å…´è¶£å¼ºçƒˆã€‚ ä¹‹å‰åˆ¶å®šçš„ FPGA å­¦ä¹ è·¯çº¿ï¼š ä»æ•°å­—ç”µè·¯åˆ° FPGA å†åˆ° RISC-V å½“å‰ç›®æ ‡ï¼šç”¨ FPGA å®ç°äº›å°åŠŸèƒ½ å…ˆå­¦ç‚¹æ•°å­—ç”µè·¯åŸºç¡€çŸ¥è¯† ä¹¦ç±ï¼šPractical Electronics for Inventors, Fourth Edition ä¸ºäº†å¿«é€Ÿä¸Šæ‰‹ï¼Œç›´æ¥è·³è¿‡æ¨¡æ‹Ÿç”µè·¯éƒ¨åˆ†ï¼Œçœ‹ç¬¬ 12 åˆ°ç¬¬ 13 ç«  å†å­¦ç‚¹ FPGA åŸºç¡€çŸ¥è¯† ä¹¦ç±ï¼šPractical Electronics for Inventors, Fourth Edition å¼€å‘æ¿ï¼šçŸ½é€Ÿè”æç³–ç³»åˆ—ï¼Œä¸»è¦ç”¨ verilog è¯­è¨€å¼€å‘ é˜…è¯»ç¬¬ 14 ç« ï¼Œç®€å•å…¥é—¨ FPGA verilog è¯­è¨€ï¼Œç›´æ¥ç”¨è¿™ä¸ªç«™ç‚¹å°±å¤Ÿäº†ï¼Œæ˜¯éå¸¸å¥½çš„æ•™ç¨‹ + ç»ƒä¹ åœºï¼š https://hdlbits.01xz.net/wiki/Main_Page æ›´æœ‰è¶£çš„ç»ƒä¹ é¢˜ï¼š https://www.fpga4fun.com/ ä» LED ç‚¹ç¯åˆ° RISCV CPUï¼ˆå¾ªåºæ¸è¿›ï¼‰:https://github.com/BrunoLevy/learn-fpga/blob/master/FemtoRV/TUTORIALS/FROM_BLINKER_TO_RISCV/README.md è¿›é˜¶ï¼šå­¦ä¹  RISCV ä¸å¤„ç†å™¨å¾®æ¶æ„ ä¹¦ç±ï¼šDigital Design and Computer Architecture RISC-V Edition æ­¤ä¹¦ä»ç¬¬å…­ç« å¼€å§‹è®² RISCV å¾®æ¶æ„ã€‚ æˆ‘ç›®å‰æ”¶é›†çš„ç›¸å…³å†…å®¹ï¼ˆä»…æ˜¯ä¸€ä¸ªèµ„æ–™åˆé›†ï¼Œå†…å®¹æœ‰é‡å¤çš„ï¼‰ï¼š åµŒå…¥å¼ Linux ç³»åˆ— Linux Device Driver Development - Second Edition: Linux é©±åŠ¨ç¼–ç¨‹å…¥é—¨ï¼Œ2022 å¹´å‡ºçš„æ–°ä¹¦ï¼ŒåŸºäº Linux 5.10ï¼Œamazon ä¸Šè¯„ä»·ä¸é”™ï¼Œç›®å‰åªæœ‰è‹±æ–‡ç‰ˆï¼Œå†™çš„å¾ˆå¥½ï¼Œå¯¹æ–°æ‰‹å¾ˆå‹å¥½ã€‚ Linux Driver Development for Embedded Processors 2nd Edition: è¿™æœ¬æ˜¯ 2018 å¹´å‡ºçš„ï¼Œå†™å¾—æ²¡ä¸Šé¢é‚£æœ¬å¥½ã€å†…å®¹ä¹Ÿæ²¡é‚£ä¹ˆæ–°ï¼Œä½†æ˜¯çœ‹è¯„ä»·ä¹Ÿä¸é”™ï¼Œç‰¹ç‚¹æ˜¯æœ‰è®¸å¤šçš„ Lab å¯åšã€‚ Linux Kernel Programming: A comprehensive guide to kernel internals: Linux å†…æ ¸ç¼–ç¨‹é¢†åŸŸçš„æ–°ä¹¦ï¼Œé€‚åˆå…¥é—¨ Linux å†…æ ¸ï¼Œamazon ä¸Šè¯„ä»·æŒºå¥½ï¼Œå…ˆæ”¶è—ä¸€ä¸ª Understanding the Linux Kernel, 3rd Editionï¼šLinux å†…æ ¸æŠ€æœ¯è¿›é˜¶ã€‚ linux-insides: ä» bootloader å¼€å§‹è®²è§£äº† Linux å†…æ ¸çš„è®¸å¤šé‡è¦çš„åŠŸèƒ½æ¨¡å—ï¼Œçœ‹ stars å¾ˆé«˜æ‰€ä»¥ä¹Ÿåœ¨è¿™é‡Œåˆ—ä¸€ä¸‹ã€‚ ç”µè·¯åŸç† Practical Electronics for Inventors, Fourth Edition èŠ¯ç‰‡ ARM64: STM32 ESP32 RK3588s RISCV: milkv mars/duo, licheepi4a FPGA / ç”µè·¯è®¾è®¡:FPGA ç©è€ä¹‹æ—… ç›®å‰çš„å­¦ä¹ ç›®æ ‡ DIY æ— äººæœºç¼–é˜Ÿé£è¡Œï¼è¦è¾¾æˆè¿™ä¸ªç›®æ ‡éœ€è¦å­¦ä¹ çš„ä¸œè¥¿æœ‰ç‚¹å¤šï¼Œæ…¢æ…¢åŠªåŠ›å§~ å…¶ä»–æ‚é¡¹ Go è¯­è¨€è¿›é˜¶ ã€ŠGo å­¦ä¹ ç¬”è®°ï¼ˆç¬¬å…­ç‰ˆä¸‹å·ï¼‰ã€‹ åŸºäº go 1.10ï¼Œè¯¦ç»†åˆ†æ go çš„å®ç°æœºåˆ¶ï¼šå†…å­˜åˆ†é…ã€åƒåœ¾å›æ”¶ã€å¹¶å‘è°ƒåº¦ç­‰ç­‰ Goè¯­è¨€åŠ¨æ‰‹å†™Webæ¡†æ¶ - è¿›åº¦ 20% Go è¯­è¨€é«˜æ€§èƒ½ç¼–ç¨‹ è‹±è¯­ æ‰¾å¤–æ•™ç»ƒå£è¯­ å†å¤šèƒŒç‚¹å•è¯ï¼Œç°åœ¨æˆ‘æŠ€æœ¯è‹±æ–‡èƒ½æ— éšœç¢é˜…è¯»ï¼Œä½†æ˜¯ç”Ÿæ´»è‹±è¯­æ–¹é¢è¯æ±‡é‡ç›¸å½“ä½ã€‚ ã€Šè‹±è¯­è¯­æ³•æ–°æ€ç»´â€”â€”åˆçº§æ•™ç¨‹ã€‹ ã€ŠEnglish Grammar In Useã€‹è¯­æ³•ä¹¦ ã€ŠKey words for fluencyã€‹å£è¯­è¡¨è¾¾ ç”Ÿæ´»ï¼š å¨±ä¹+è¿åŠ¨ï¼š è½®æ»‘ï¼šå€’æ»‘åå‹æ­¥ æ¸¸æ³³ï¼šå­¦ä¼šè›™æ³³å¹¶ä¸”æå‡é€Ÿåº¦ å¾’æ­¥ï¼šå¤ã€å†¬ä¸¤å­£å„å®Œæˆä¸€æ¬¡éº¦ç†æµ©å¾„å…¨ç¨‹ å…¶ä»–èµ„æ–™ è¿™ä¸ªåˆ—è¡¨ä¸­çš„å†…å®¹æ²¡å•¥ä¼˜å…ˆçº§ï¼Œåæ­£å…ˆåˆ—ç€ï¼Œä»€ä¹ˆæ—¶å€™æœ‰å…´è¶£å¯ä»¥ç©ç©ã€‚ é™„ä¸€ä»½å±Œç‚¸å¤©çš„ CS è‡ªå­¦æŒ‡å—ï¼šhttps://github.com/pkuflyingpig/cs-self-learning/ å†™å‡ ä¸ªå°é¡¹ç›®ï¼ˆä½¿ç”¨ rust/goï¼‰ å®ç°ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨ https://viewsourcecode.org/snaptoken/kilo/ å®ç°ä¸€ä¸ªç®€å•çš„ Linux å®¹å™¨ https://blog.lizzie.io/linux-containers-in-500-loc.html ç½‘ç»œä»£ç†ï¼ˆä¸åˆ° 2000 è¡Œçš„ TUN åº“ï¼‰ https://github.com/songgao/water Go è¯­è¨€ Web ç¼–ç¨‹ 7å¤©ç”¨Goä»é›¶å®ç°åˆ†å¸ƒå¼ç¼“å­˜GeeCache 7å¤©ç”¨Goä»é›¶å®ç°ORMæ¡†æ¶GeeORM 7å¤©ç”¨Goä»é›¶å®ç°RPCæ¡†æ¶GeeRPC balancer: æºç é˜…è¯»ï¼Œå¦‚ä½•ä½¿ç”¨ go å®ç°å¸¸è§ balancer ç®—æ³• å®¹å™¨ä¸ Kubernetesï¼ˆå…¶å®å¥½åƒä¹Ÿæ²¡å•¥å…´è¶£ï¼‰ Hacking Kubernetes: Threat-Driven Analysis and Defense: Kubernetes å®‰å…¨ï¼Œå¨èƒæ¨¡å‹ä»¥åŠå¦‚ä½•é˜²æŠ¤ã€‚ Container Security: Fundamental Technology Concepts that Protect Containerized Applications: å®¹å™¨å®‰å…¨ï¼Œè¿™ä¹¦åœ¨äºšé©¬é€Šä¸Šè¯„ä»·å¾ˆå¥½ã€‚ åˆ†å¸ƒå¼æ•°æ®åº“ï¼š å­¦ä¹ è·¯çº¿ æå®¢æ—¶é—´ã€Šåˆ†å¸ƒå¼åè®®ä¸ç®—æ³•å®æˆ˜ã€‹ - å­¦ä¹ è¿›åº¦ 50% åˆ†å¸ƒå¼ç³»ç»Ÿï¼šè¯¾ç¨‹ MIT 6.824 + ä¹¦Designing Data-Intensive Applications æ•°æ®åº“ç³»ç»Ÿï¼šè¯¾ç¨‹CMU 15-445 å‚åŠ  tidb çš„ talent-planï¼Œå®Œæˆ tinykv é¡¹ç›® å…¶ä»–å‚è€ƒä¹¦ç± ã€ŠDistributed Systems, 3rd Edition, 2017ã€‹ ã€ŠDistributed Algorithms, 2nd Edition, 2018ã€‹ SQL è¿›é˜¶æ•™ç¨‹ ","date":"2021-02-01","objectID":"/now/:4:2","series":null,"tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/#å…¶ä»–æ‚é¡¹"},{"categories":null,"content":" 2. ä»¥åå¯èƒ½ä¼šæ„Ÿå…´è¶£çš„ AI infra æ–¹å‘è¿™æ˜¯ä¸€ä¸ªç›¸å½“æ–°çš„æ–¹å‘ï¼Œå› ä¸ºè¿‘ä¸¤å¹´ AI å¼€å§‹è½åœ°è€Œå…´èµ·ï¼Œå®ƒæ—¢è¦æ±‚ç†Ÿæ‚‰ K8s/Istio ç­‰ä¼ ç»Ÿ infra ç»„ä»¶ï¼Œåˆè¦æ±‚å¯¹ AI è®­ç»ƒæ¨ç†ç›¸å…³çš„æŠ€æœ¯æœ‰è¶³å¤Ÿäº†è§£ï¼Œä¾‹å¦‚ï¼š Operator: training-operator è°ƒåº¦ï¼švolcano æ¡†æ¶ï¼šKubeflow, RayTrain, Argo Workflows æ€§èƒ½ä¼˜åŒ–ï¼šTriton/BentoML/vLLM/PyTorch/CUDA æ„Ÿè§‰æ˜¯ä¸€ä¸ªè½¬å‹çš„æ–¹å‘ï¼Œä¸šä½™å¯ä»¥çœ‹çœ‹ã€‚ ç›¸å…³èµ„æ–™ï¼š https://github.com/stas00/ml-engineering/ å¿ƒç†å­¦ä¸è®¤çŸ¥ç¥ç»ç§‘å­¦å­¦ä¹ è·¯çº¿ï¼š å…¥é—¨ï¼š ã€Šè¿™æ‰æ˜¯å¿ƒç†å­¦ - çœ‹ç©¿ä¼ªç§‘å­¦çš„æ‰¹åˆ¤æ€§æ€ç»´ ç¬¬ 11 ç‰ˆã€‹ Psychology and Life, 20th edition, by Richard J. Gerrig, 2012 Educational Psychology, 14th Global Edition (Anita Woolfolk, 2021) Development Across the Life Span, 10th edition (Robert S. Feldman, 2023) è¿›é˜¶åˆ°è®¤çŸ¥ç¥ç»ç§‘å­¦ Neuroscience: Exploring the Brain, 4th edition (2015) Cognitive Neuroscience: The Biology of the Mind, 5th edition (2019) å…¶ä»–æ–¹å‘ ã€ŠIntimate Relationshipsã€‹ - è¿›åº¦ 14/449 ã€ŠSocial Psychology, 14e, David Myersã€‹ åµŒå…¥å¼/ç‰©è”ç½‘åµŒå…¥å¼è·Ÿ IoT æ˜¯æˆ‘ 2022 å¹´åº•å¼€çš„æ–°å‘ï¼Œç›®å‰å…´è¶£å¼ºçƒˆã€‚ ä¹‹å‰åˆ¶å®šçš„ FPGA å­¦ä¹ è·¯çº¿ï¼š ä»æ•°å­—ç”µè·¯åˆ° FPGA å†åˆ° RISC-V å½“å‰ç›®æ ‡ï¼šç”¨ FPGA å®ç°äº›å°åŠŸèƒ½ å…ˆå­¦ç‚¹æ•°å­—ç”µè·¯åŸºç¡€çŸ¥è¯† ä¹¦ç±ï¼šPractical Electronics for Inventors, Fourth Edition ä¸ºäº†å¿«é€Ÿä¸Šæ‰‹ï¼Œç›´æ¥è·³è¿‡æ¨¡æ‹Ÿç”µè·¯éƒ¨åˆ†ï¼Œçœ‹ç¬¬ 12 åˆ°ç¬¬ 13 ç«  å†å­¦ç‚¹ FPGA åŸºç¡€çŸ¥è¯† ä¹¦ç±ï¼šPractical Electronics for Inventors, Fourth Edition å¼€å‘æ¿ï¼šçŸ½é€Ÿè”æç³–ç³»åˆ—ï¼Œä¸»è¦ç”¨ verilog è¯­è¨€å¼€å‘ é˜…è¯»ç¬¬ 14 ç« ï¼Œç®€å•å…¥é—¨ FPGA verilog è¯­è¨€ï¼Œç›´æ¥ç”¨è¿™ä¸ªç«™ç‚¹å°±å¤Ÿäº†ï¼Œæ˜¯éå¸¸å¥½çš„æ•™ç¨‹ + ç»ƒä¹ åœºï¼š https://hdlbits.01xz.net/wiki/Main_Page æ›´æœ‰è¶£çš„ç»ƒä¹ é¢˜ï¼š https://www.fpga4fun.com/ ä» LED ç‚¹ç¯åˆ° RISCV CPUï¼ˆå¾ªåºæ¸è¿›ï¼‰:https://github.com/BrunoLevy/learn-fpga/blob/master/FemtoRV/TUTORIALS/FROM_BLINKER_TO_RISCV/README.md è¿›é˜¶ï¼šå­¦ä¹  RISCV ä¸å¤„ç†å™¨å¾®æ¶æ„ ä¹¦ç±ï¼šDigital Design and Computer Architecture RISC-V Edition æ­¤ä¹¦ä»ç¬¬å…­ç« å¼€å§‹è®² RISCV å¾®æ¶æ„ã€‚ æˆ‘ç›®å‰æ”¶é›†çš„ç›¸å…³å†…å®¹ï¼ˆä»…æ˜¯ä¸€ä¸ªèµ„æ–™åˆé›†ï¼Œå†…å®¹æœ‰é‡å¤çš„ï¼‰ï¼š åµŒå…¥å¼ Linux ç³»åˆ— Linux Device Driver Development - Second Edition: Linux é©±åŠ¨ç¼–ç¨‹å…¥é—¨ï¼Œ2022 å¹´å‡ºçš„æ–°ä¹¦ï¼ŒåŸºäº Linux 5.10ï¼Œamazon ä¸Šè¯„ä»·ä¸é”™ï¼Œç›®å‰åªæœ‰è‹±æ–‡ç‰ˆï¼Œå†™çš„å¾ˆå¥½ï¼Œå¯¹æ–°æ‰‹å¾ˆå‹å¥½ã€‚ Linux Driver Development for Embedded Processors 2nd Edition: è¿™æœ¬æ˜¯ 2018 å¹´å‡ºçš„ï¼Œå†™å¾—æ²¡ä¸Šé¢é‚£æœ¬å¥½ã€å†…å®¹ä¹Ÿæ²¡é‚£ä¹ˆæ–°ï¼Œä½†æ˜¯çœ‹è¯„ä»·ä¹Ÿä¸é”™ï¼Œç‰¹ç‚¹æ˜¯æœ‰è®¸å¤šçš„ Lab å¯åšã€‚ Linux Kernel Programming: A comprehensive guide to kernel internals: Linux å†…æ ¸ç¼–ç¨‹é¢†åŸŸçš„æ–°ä¹¦ï¼Œé€‚åˆå…¥é—¨ Linux å†…æ ¸ï¼Œamazon ä¸Šè¯„ä»·æŒºå¥½ï¼Œå…ˆæ”¶è—ä¸€ä¸ª Understanding the Linux Kernel, 3rd Editionï¼šLinux å†…æ ¸æŠ€æœ¯è¿›é˜¶ã€‚ linux-insides: ä» bootloader å¼€å§‹è®²è§£äº† Linux å†…æ ¸çš„è®¸å¤šé‡è¦çš„åŠŸèƒ½æ¨¡å—ï¼Œçœ‹ stars å¾ˆé«˜æ‰€ä»¥ä¹Ÿåœ¨è¿™é‡Œåˆ—ä¸€ä¸‹ã€‚ ç”µè·¯åŸç† Practical Electronics for Inventors, Fourth Edition èŠ¯ç‰‡ ARM64: STM32 ESP32 RK3588s RISCV: milkv mars/duo, licheepi4a FPGA / ç”µè·¯è®¾è®¡:FPGA ç©è€ä¹‹æ—… ç›®å‰çš„å­¦ä¹ ç›®æ ‡ DIY æ— äººæœºç¼–é˜Ÿé£è¡Œï¼è¦è¾¾æˆè¿™ä¸ªç›®æ ‡éœ€è¦å­¦ä¹ çš„ä¸œè¥¿æœ‰ç‚¹å¤šï¼Œæ…¢æ…¢åŠªåŠ›å§~ å…¶ä»–æ‚é¡¹ Go è¯­è¨€è¿›é˜¶ ã€ŠGo å­¦ä¹ ç¬”è®°ï¼ˆç¬¬å…­ç‰ˆä¸‹å·ï¼‰ã€‹ åŸºäº go 1.10ï¼Œè¯¦ç»†åˆ†æ go çš„å®ç°æœºåˆ¶ï¼šå†…å­˜åˆ†é…ã€åƒåœ¾å›æ”¶ã€å¹¶å‘è°ƒåº¦ç­‰ç­‰ Goè¯­è¨€åŠ¨æ‰‹å†™Webæ¡†æ¶ - è¿›åº¦ 20% Go è¯­è¨€é«˜æ€§èƒ½ç¼–ç¨‹ è‹±è¯­ æ‰¾å¤–æ•™ç»ƒå£è¯­ å†å¤šèƒŒç‚¹å•è¯ï¼Œç°åœ¨æˆ‘æŠ€æœ¯è‹±æ–‡èƒ½æ— éšœç¢é˜…è¯»ï¼Œä½†æ˜¯ç”Ÿæ´»è‹±è¯­æ–¹é¢è¯æ±‡é‡ç›¸å½“ä½ã€‚ ã€Šè‹±è¯­è¯­æ³•æ–°æ€ç»´â€”â€”åˆçº§æ•™ç¨‹ã€‹ ã€ŠEnglish Grammar In Useã€‹è¯­æ³•ä¹¦ ã€ŠKey words for fluencyã€‹å£è¯­è¡¨è¾¾ ç”Ÿæ´»ï¼š å¨±ä¹+è¿åŠ¨ï¼š è½®æ»‘ï¼šå€’æ»‘åå‹æ­¥ æ¸¸æ³³ï¼šå­¦ä¼šè›™æ³³å¹¶ä¸”æå‡é€Ÿåº¦ å¾’æ­¥ï¼šå¤ã€å†¬ä¸¤å­£å„å®Œæˆä¸€æ¬¡éº¦ç†æµ©å¾„å…¨ç¨‹ å…¶ä»–èµ„æ–™ è¿™ä¸ªåˆ—è¡¨ä¸­çš„å†…å®¹æ²¡å•¥ä¼˜å…ˆçº§ï¼Œåæ­£å…ˆåˆ—ç€ï¼Œä»€ä¹ˆæ—¶å€™æœ‰å…´è¶£å¯ä»¥ç©ç©ã€‚ é™„ä¸€ä»½å±Œç‚¸å¤©çš„ CS è‡ªå­¦æŒ‡å—ï¼šhttps://github.com/pkuflyingpig/cs-self-learning/ å†™å‡ ä¸ªå°é¡¹ç›®ï¼ˆä½¿ç”¨ rust/goï¼‰ å®ç°ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨ https://viewsourcecode.org/snaptoken/kilo/ å®ç°ä¸€ä¸ªç®€å•çš„ Linux å®¹å™¨ https://blog.lizzie.io/linux-containers-in-500-loc.html ç½‘ç»œä»£ç†ï¼ˆä¸åˆ° 2000 è¡Œçš„ TUN åº“ï¼‰ https://github.com/songgao/water Go è¯­è¨€ Web ç¼–ç¨‹ 7å¤©ç”¨Goä»é›¶å®ç°åˆ†å¸ƒå¼ç¼“å­˜GeeCache 7å¤©ç”¨Goä»é›¶å®ç°ORMæ¡†æ¶GeeORM 7å¤©ç”¨Goä»é›¶å®ç°RPCæ¡†æ¶GeeRPC balancer: æºç é˜…è¯»ï¼Œå¦‚ä½•ä½¿ç”¨ go å®ç°å¸¸è§ balancer ç®—æ³• å®¹å™¨ä¸ Kubernetesï¼ˆå…¶å®å¥½åƒä¹Ÿæ²¡å•¥å…´è¶£ï¼‰ Hacking Kubernetes: Threat-Driven Analysis and Defense: Kubernetes å®‰å…¨ï¼Œå¨èƒæ¨¡å‹ä»¥åŠå¦‚ä½•é˜²æŠ¤ã€‚ Container Security: Fundamental Technology Concepts that Protect Containerized Applications: å®¹å™¨å®‰å…¨ï¼Œè¿™ä¹¦åœ¨äºšé©¬é€Šä¸Šè¯„ä»·å¾ˆå¥½ã€‚ åˆ†å¸ƒå¼æ•°æ®åº“ï¼š å­¦ä¹ è·¯çº¿ æå®¢æ—¶é—´ã€Šåˆ†å¸ƒå¼åè®®ä¸ç®—æ³•å®æˆ˜ã€‹ - å­¦ä¹ è¿›åº¦ 50% åˆ†å¸ƒå¼ç³»ç»Ÿï¼šè¯¾ç¨‹ MIT 6.824 + ä¹¦Designing Data-Intensive Applications æ•°æ®åº“ç³»ç»Ÿï¼šè¯¾ç¨‹CMU 15-445 å‚åŠ  tidb çš„ talent-planï¼Œå®Œæˆ tinykv é¡¹ç›® å…¶ä»–å‚è€ƒä¹¦ç± ã€ŠDistributed Systems, 3rd Edition, 2017ã€‹ ã€ŠDistributed Algorithms, 2nd Edition, 2018ã€‹ SQL è¿›é˜¶æ•™ç¨‹ ","date":"2021-02-01","objectID":"/now/:4:2","series":null,"tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/#å…¶ä»–èµ„æ–™"},{"categories":null,"content":" äº”ã€å¤‡é€‰ä¹¦å• æˆ‘çš„è±†ç“£ å¦‚ä¸‹æ˜¯æˆ‘ç›®å‰æƒ³è¯»çš„ä¹¦å•ï¼Œå¦‚æœå†³å®šè¯»ï¼Œå°±æŠŠå¯¹åº”çš„ä¹¦ç§»åˆ°ã€Œè®¡åˆ’è¯»ã€ä¸­ã€‚ å®¶åº­æ•™è‚²ï¼ˆæ•™è‚²ä¹Ÿè¦è®²ç©¶ç§‘å­¦ï¼Œå‡­ç›´è§‰åšäº‹å¾€å¾€ä¼šé”™å¾—å¾ˆç¦»è°±ï¼‰ ã€Šæ•™è‚²ä¸ç¾å¥½ç”Ÿæ´»ã€‹ï¼šå¤§åé¼é¼çš„æ€æƒ³å®¶ç½—ç´ çš„æ•™è‚²è§‚ã€‚ ã€Šå­©å­ï¼šæŒ‘æˆ˜ï¼ˆChildren - The Challengeï¼‰ã€‹ï¼šç¾å›½äººå†™çš„ä¹¦ï¼Œå¦‚ä½•åœ¨å°Šé‡å­©å­ã€ç»™å­©å­å¹³ç­‰è‡ªç”±çš„åŒæ—¶ï¼Œè®©å­©å­å°Šé‡è§„åˆ™ã€æ‰¿æ‹…è´£ä»»ã€èµ¢å¾—åˆä½œã€‚é˜¿å¾·å‹’å¿ƒç†å­¦ã€‚ ã€ŠP.E.T.çˆ¶æ¯æ•ˆèƒ½è®­ç»ƒ - è®©äº²å­æ²Ÿé€šå¦‚æ­¤é«˜æ•ˆè€Œç®€å•ã€‹ ã€Šé«˜å‹å¹´ä»£ï¼šå¦‚ä½•å¸®åŠ©å­©å­åœ¨å¤§å­¦æ¸¡è¿‡éš¾å…³ã€é¡ºåˆ©æˆäººï¼ˆThe Stressed Years of Their Livesï¼‰ã€‹ï¼šä½œè€…ä¹‹ä¸€çš„å„¿å­æ°æ£®åœ¨ä¸Šå¤§å­¦çš„ç¬¬ä¸€å¹´å‡ºç°äº†ä¸¥é‡çš„å¿ƒç†é—®é¢˜ï¼šæ— æ³•è¿”æ ¡ç»§ç»­å­¦ä¸šï¼Œ æƒ…ç»ªæ¿’äºå´©æºƒï¼Œç”šè‡³äº§ç”Ÿè‡ªæ€å†²åŠ¨ã€‚æœ¬ä¹¦æ€»ç»“äº†å¦‚ä½•å»å‘ç°å¹¶è§£å†³é’å°‘å¹´çš„å¿ƒç†é—®é¢˜ï¼Œå¸®åŠ©ä»–ä»¬å®Œæˆä»å®¶åº­åˆ°å¤§å­¦ã€ä»é’æ˜¥æœŸåˆ°çœŸæ­£æˆå¹´çš„é¡ºåˆ©è¿‡æ¸¡ã€‚ ã€Šäº«å—å­©å­æˆé•¿ - ç•™ç¾æ•™è‚²åšå£«åå…«å¹´æ•™è‚²æ‰‹è®°ã€‹ï¼šè¿™ä¹¦ä¸»è¦æ˜¯ä¸ªæµæ°´è´¦ï¼Œæ—¢åŒ…å«ä½œè€…ä¸»è§‚çš„æ•™è‚²ç†å¿µã€ä¹Ÿæ´å¼•äº†è®¸å¤šæ•™è‚²ã€å¿ƒç†å­¦ç­‰é¢†åŸŸçš„é‡è¦ç§‘å­¦å‘ç°ã€‚æ­£åœ¨è¯»ï¼Œç›®å‰è¯„ä¸ª 7 åˆ†å§ã€‚ ã€Šæ¸¸æˆåŠ›ï¼ˆPlayful Parentingï¼‰ã€‹ï¼šæ¸¸æˆåŠ›çš„æ¸¸æˆï¼Œç‰¹æŒ‡äº²å­é—´çš„äº’åŠ¨ã€‚å®ƒæ˜¯æ€è€ƒæ–¹å¼ï¼Œæ˜¯äº’åŠ¨æ–¹å¼ï¼Œä¹Ÿæ˜¯å¤§äººä¸å­©å­åœ¨ä¸€èµ·è½»æ¾å¼€å¿ƒçš„çŠ¶æ€ã€‚æœ¬ä¹¦çš„é‡ç‚¹æ˜¯è§£å†³å­©å­å¸¸è§çš„è¡Œä¸ºé—®é¢˜ï¼Œæ¿€å‘å­©å­å†…åœ¨çš„è‡ªä¿¡åŠ›ï¼Œé‡å»ºçˆ¶æ¯ä¸å­©å­é—´äº²å¯†æ²Ÿé€šçš„æ¡¥æ¢ã€‚ ã€ŠçœŸå¸Œæœ›æˆ‘çˆ¶æ¯è¯»è¿‡è¿™æœ¬ä¹¦ã€‹ ã€Šä¸ºä»€ä¹ˆå­¦ç”Ÿä¸å–œæ¬¢ä¸Šå­¦?ï¼ˆWhy Donâ€™t Students Like School?ï¼‰ã€‹ï¼šç”¨è®¤çŸ¥å¿ƒç†å­¦çš„åŸç†ï¼Œè¯¦ç»†åˆ†æäº†å­¦ç”Ÿå­¦ä¹ çš„è¿‡ç¨‹å’Œæ•™å¸ˆåœ¨è¯¾å ‚æ•™å­¦ä¸­å¿…é¡»æ³¨æ„çš„ä¸€äº›é—®é¢˜ã€‚ ã€Šå­¦ä¹ çš„æœ¬è´¨ã€‹ï¼šæ³•å›½äººå®‰å¾·çƒˆÂ·ç„¦å°”å½“çš„ä¹¦ ç»æµ / ç®¡ç† / ç¤¾ä¼š ã€ŠPrinciples Of Economics, 9e, N. Gregory Mankiwã€‹ ã€Šåœ†åœˆæ­£ä¹‰-ä½œä¸ºè‡ªç”±å‰æçš„ä¿¡å¿µã€‹ ã€ŠæŠ•èµ„ä¸­æœ€ç®€å•çš„äº‹ã€‹ ã€Šå€ºåŠ¡å±æœº - æˆ‘çš„åº”å¯¹åŸåˆ™ã€‹ ã€Šåˆ†æä¸æ€è€ƒ - é»„å¥‡å¸†çš„å¤æ—¦ç»æµè¯¾ã€‹ï¼šè¿™æœ¬ä¹¦ä¼šéœ€è¦ä¸€å®šçš„ç»æµå­¦åŸºç¡€çŸ¥è¯†ï¼Œæ‰“ç®—åœ¨å…¥é—¨ç»æµå­¦åå†çœ‹ Animal Farm - ä¸€æœ¬æ”¿æ²»è®½åˆºå°ä¹¦ ã€Šæ‰‹æŠŠæ‰‹æ•™ä½ è¯»è´¢æŠ¥ã€‹ ã€ŠåŸåˆ™ - åº”å¯¹å˜åŒ–ä¸­çš„ä¸–ç•Œç§©åºã€‹ ã€Šæ¢è·¯ä¹‹å½¹ - 1978-1922 å¹´çš„ä¸­å›½ç»æµæ”¹é©ã€‹ ã€Šç­šè·¯ç»´è‰° - ä¸­å›½ç¤¾ä¼šä¸»ä¹‰è·¯å¾„çš„äº”æ¬¡é€‰æ‹©ã€‹ ã€Šé‚“å°å¹³æ—¶ä»£ã€‹ ã€Šè®ºä¸­å›½ã€‹ ã€Šä¸­å›½å›½å®¶æ²»ç†çš„åˆ¶åº¦é€»è¾‘ã€‹ ã€Šæ±Ÿæ‘ç»æµã€‹ ã€Šå…«æ¬¡å±æœºï¼šä¸­å›½çš„çœŸå®ç»éªŒã€‹ ã€Šä¸­å›½ç»æµï¼šé€‚åº”ä¸å¢é•¿ã€‹ ã€Šä¸­å›½ä¸ºä»€ä¹ˆæœ‰å‰é€”ï¼šå¯¹å¤–ç»æµå…³ç³»çš„æˆ˜ç•¥æ½œèƒ½ã€‹ ã€Šç½®èº«äº‹å†…ï¼šä¸­å›½æ”¿åºœä¸ç»æµå‘å±•ã€‹ ã€Šå…šå‘˜ã€å…šæƒä¸å…šäº‰ï¼š1924 - 1949 å¹´ä¸­å›½å›½æ°‘å…šçš„ç»„ç»‡å½¢æ€ã€‹ äººç‰©ä¼ è®°æˆ–è€…ä¸åäººç›¸å…³çš„ä¹¦ç±ï¼ˆä»å†å²ä¸Šçš„æˆåŠŸè€…ï¼Œä»¥åŠå†å²ä¸­å­¦ä¹ ï¼‰ ã€Šå²è’‚å¤«Â·ä¹”å¸ƒæ–¯ä¼ ã€‹ ã€ŠåŸƒéš†Â·é©¬æ–¯å…‹ä¼ ã€‹ ã€Šç»´ç‰¹æ ¹æ–¯å¦ä¼ ã€‹ ã€Šæå…‰è€€è§‚å¤©ä¸‹ã€‹ ã€Šæ²ˆä»æ–‡çš„ååŠç”Ÿã€‹ï¼šè¿™æœ¬ä¹¦æ›´åç ”ç©¶æ€§è´¨ï¼Œæœ‰ç‚¹éš¾è¯» ã€Šé™†å¾ç¥¥è¯„ä¼ ã€‹ï¼šä»ä¸­å›½å¤–äº¤å®¶é™†å¾ç¥¥çš„å²æ–™å‡ºå‘è€ƒå¯Ÿæ¸…æœ«ã€åŒ—æ´‹åˆ°å›½æ°‘æ”¿åºœæ—¶æœŸï¼Œè¿‘ä»£ä¸­å›½ä¸ä¸–ç•Œçš„äº’åŠ¨å†ç¨‹ã€‚ ã€Šç¬¬ä¸€åœˆã€‹ï¼šä¸æ˜¯è‡ªä¼ ï¼Œèƒœä¼¼è‡ªä¼ ã€‚è¯ºå¥–å¾—ä¸»ç´¢å°”ä»å°¼ç´ä»¥è‡ªå·±çš„äº²èº«ç»å†ä¸ºåŸå‹ï¼Œå†ç°äº†æ–¯å¤§æ—æ—¶æœŸçš„ç‹¬è£åˆ¶åº¦å¯¹äººæ€§çš„æ‘§æ®‹å’Œç ´åã€‚ ã€Šåˆ«é—¹äº†ï¼Œè´¹æ›¼å…ˆç”Ÿï¼šç§‘å­¦é¡½ç«¥çš„æ•…äº‹ã€‹ ã€Šæˆ‘çš„å‰åŠç”Ÿâ€”â€”çˆ±æ–°è§‰ç½—Â·æº¥ä»ªã€‹ï¼šçœ‹å®Œç”µå½±ã€Šæœ«ä»£çš‡å¸ã€‹åï¼Œå¯¹æ¸…æœå†å²äº§ç”Ÿäº†å…´è¶£ï¼Œæ‰“ç®—çœ‹çœ‹ã€‚ å†å²ä¸çºªå®ä½œå“ ã€Šä¸‡å†åäº”å¹´ã€‹ ã€Šè·¨è¶Šè¾¹ç•Œçš„ç¤¾åŒºï¼ˆä¿®è®¢ç‰ˆï¼‰ã€‹ï¼šæŒç»­è‡³ä»Šçš„çœŸå®ã€ŒåŒ—æ¼‚ã€å²ã€‚è½¬å‹ä¸­çš„ä¸­å›½åŸå¸‚ã€æµåŠ¨äººå£ã€ç»æµä¸ç¤¾ä¼šã€‚åŒ—äº¬ã€Œæµ™æ±Ÿæ‘ã€ä¸ã€Œæµ™æ±Ÿæ‘äººã€ä¸‰åå¹´ç”Ÿæ´»è®°å½•ç ”ç©¶ã€‚ ã€Šå¤©æœçš„å´©æºƒï¼šé¸¦ç‰‡æˆ˜äº‰å†ç ”ç©¶ï¼ˆä¿®è®¢ç‰ˆï¼‰ã€‹ ã€Šç”²åˆæˆ˜äº‰å‰åä¹‹æ™šæ¸…æˆ˜å±€ã€‹ ã€Šæ™šæœŸå¸åˆ¶ä¸­å›½çš„ç§‘ä¸¾æ–‡åŒ–å²ã€‹ ã€Šå‰‘æ¡¥ä¸­å›½æ™šæ¸…å²ã€‹ï¼š1400 é¡µçš„ä¸€æœ¬å¤§éƒ¨å¤´ ã€Šäº”å››è¿åŠ¨å²ï¼šç°ä»£ä¸­å›½çš„çŸ¥è¯†é©å‘½ã€‹ ã€Šä¸­è¥¿æ–‡åŒ–å›çœ¸ã€‹ï¼šè¿™å‡ æœ¬ä¸­è¥¿æ–‡åŒ–å¯¹æ¯”çš„ä¹¦ï¼Œä¸»è¦æ˜¯æƒ³ç”¨äºå­¦ä¹ ä»¥åŠå¯¹æ¯”ä¸­è¥¿æ–‡åŒ–çš„å·®å¼‚ã€‚ ã€Šå¯¹å²¸çš„è¯±æƒ‘ï¼šä¸­è¥¿æ–‡åŒ–äº¤æµè®°ã€‹ ã€Šä¸­è¥¿æ–‡åŒ–çš„ç²¾ç¥åˆ†é‡ã€‹ ã€Šè¡€æ®‡ï¼šåŸƒåšæ‹‰çš„è¿‡å»ã€ç°åœ¨å’Œæœªæ¥ã€‹ ã€Šå‘æ‚¨å‘ŠçŸ¥ï¼Œæ˜å¤©æˆ‘ä»¬ä¸€å®¶å°±è¦è¢«æ€ï¼šå¢æ—ºè¾¾å¤§å± æ€çºªäº‹ã€‹ ã€Šä¸œäº¬è´«å›°å¥³å­ã€‹ å…¶ä»–äººæ–‡ç¤¾ç§‘ ã€Šè·¨å­¦ç§‘ï¼šäººæ–‡å­¦ç§‘çš„è¯ç”Ÿã€å±æœºä¸æœªæ¥ã€‹ ã€Šæªç‚®ã€ç—…èŒä¸é’¢é“ã€‹ ã€Šè¥¿çº¿æ— æˆ˜äº‹ã€‹ ã€Šäººç±»ç¾¤æ˜Ÿé—ªè€€æ—¶ã€‹ ã€Šäººä½“ç®€å²ã€‹ ã€Šæ—¶é—´çš„ç§©åºã€‹ ã€Šæç®€å®‡å®™å²ã€‹ ã€Šäººç”Ÿè„šæœ¬ã€‹ ã€Šè¯­è¨€å­¦çš„é‚€è¯·ã€‹- è¿›åº¦ 68/288 å¯¹è¯­è¨€å­¦æœ‰ç‚¹å…´è¶£ï¼ŒåŒæ—¶å¬è¯´è¿™æœ¬ä¹¦å¯¹è¡¨è¾¾ï¼ˆæ²Ÿé€šã€å†™ä½œï¼‰ä¹Ÿå¤§æœ‰å¸®åŠ©~ ã€Šæ­¥å¤©æ­Œç ”ç©¶ã€‹ å…¬ç›Šæ…ˆå–„ / NGO ã€Šå¦‚ä½•æ”¹å˜ä¸–ç•Œ - ç¤¾ä¼šä¼ä¸šå®¶ä¸æ–°æ€æƒ³çš„å¨åŠ›ã€‹ï¼šæ®è¯„ç¤¾ä¼šä¼ä¸šçš„æ¦‚å¿µå³æºè‡ªæ­¤ä¹¦ ã€Šç¦»å¼€å¾®è½¯ æ”¹å˜ä¸–ç•Œã€‹ ã€Šç©·äººçš„é“¶è¡Œå®¶ã€‹ï¼šç©·äººçŸ¥é“è¯¥æ€ä¹ˆæ‘†è„±è´«å›°ï¼Œåªè¦ä½ ç»™äºˆå¹³ç­‰çš„å€Ÿè´·çš„æƒåŠ›ã€‚ç›¸ä¿¡å¹¶æ”¯æŒæ¯ä¸ªç‹¬ç«‹äººè‡ªå·±çš„é€‰æ‹©ã€‚ ã€Šæ’¬åŠ¨å…¬ç›Š - æ…ˆå–„å’Œç¤¾ä¼šæŠ•èµ„æ–°å‰æ²¿å¯¼è®ºã€‹ ã€Šè¡¨è¾¾çš„åŠ›é‡ - å½“ä¸­å›½å…¬ç›Šç»„ç»‡é‡ä¸Šåª’ä½“ã€‹ ã€Šè´¢å¯Œçš„è´£ä»»ä¸èµ„æœ¬ä¸»ä¹‰æ¼”å˜ - ç¾å›½ç™¾å¹´å…¬ç›Šå‘å±•çš„å¯ç¤ºã€‹ ã€Šä¸ºå…¬ç›Šè€Œå…±å’Œ - é˜¿æ‹‰å–„SEEç”Ÿæ€åä¼šæ²»ç†ä¹‹è·¯ã€‹ ã€Šå…¬ç›Šå‰µæ¥­ - é’å¹´å‰µæ¥­èˆ‡ä¸­å¹´å°ˆæ¥­çš„æ–°é¸æ“‡ã€‹ ã€Šè“æ¯›è¡£ã€‹ï¼šå¦‚ä½•æˆä¸ºä¸€ä¸ªç¤¾ä¼šä¼ä¸šå®¶ï¼Œæœ‰ä½œè€…çš„äº²èº«ç»å†ï¼Œèµ°è¿‡çš„å¤±è´¥æ•™è®­ä¸æˆåŠŸç»éªŒ è™šæ„ç±» Majo no Tabitabiï¼ˆé­”å¥³ä¹‹æ—…ï¼‰Vol.1 Tasogare-iro no Uta Tsukaiï¼ˆé»„æ˜è‰²çš„å’ä½¿ï¼‰Vol.1 Moon Palace, by Pual Auster - è¯»è¿‡ä¸­æ–‡ç‰ˆï¼Œä½†æ˜¯çœ‹è‹±æ–‡ç‰ˆè¯æ±‡é‡ä¹Ÿä¸é«˜ï¼Œå¯ä»¥ä¸€è¯» æ–‡å­¦ç±»ï¼š ã€Šç™¾å¹´å­¤ç‹¬ã€‹ï¼šé«˜ä¸­çš„æ—¶å€™è¯»è¿‡ä¸€éï¼Œä½†æ˜¯éƒ½å¿˜å·®ä¸å¤šäº† ã€Šéœä¹±æ—¶æœŸçš„çˆ±æƒ…ã€‹ ã€Šè‹è²çš„ä¸–ç•Œï¼ˆSophieâ€™s Worldï¼‰ã€‹ï¼šæ®è¯´æ˜¯å“²å­¦å¯è’™è¯»ç‰©ï¼Œæ›¾ç»çœ‹è¿‡ï¼Œä½†æ˜¯å¯¹å†…å®¹å®Œå…¨æ²¡å°è±¡äº†ã€‚ ã€Šä½ ä¸€ç”Ÿçš„æ•…äº‹ã€‹ï¼šæˆ‘ä¹Ÿæ›¾æ˜¯ä¸ªç§‘å¹»è¿· ã€Šæˆ¿æ€çªçš„åˆæ‹ä¹å›­ã€‹ ã€Šæœˆå…‰è½åœ¨å·¦æ‰‹ä¸Šã€‹ ã€Šäº†ä¸èµ·çš„ç›–èŒ¨æ¯”ã€‹ ã€ŠThe Windup Girlã€‹ï¼šé«˜ä¸­æ—¶è¯»è¿‡ä¸­æ–‡ç‰ˆï¼Œåˆ·æ–°æˆ‘ä¸‰è§‚ï¼Œç°åœ¨æƒ³å†è¯»ä¸€éè‹±æ–‡åŸç‰ˆã€‚ æŠ€æœ¯ç±» ã€Šäººæœˆç¥è¯ã€‹ ã€Šç»©æ•ˆä½¿èƒ½ï¼šè¶…è¶Š OKRã€‹ ã€Šå¥ˆé£æ–‡åŒ–æ‰‹å†Œã€‹ ã€Šå¹•åäº§å“-æ‰“é€ çªç ´å¼æ€ç»´ã€‹ ã€Šé‡æ„ - æ”¹å–„æ—¢æœ‰ä»£ç çš„è®¾è®¡ã€‹ ã€Šäº‘åŸç”ŸæœåŠ¡ç½‘æ ¼ Istioï¼šåŸç†ã€å®è·µã€æ¶æ„ä¸æºç è§£æã€‹ ã€Šå‡¤å‡°é¡¹ç›®ï¼šä¸€ä¸ª IT è¿ç»´çš„ä¼ å¥‡æ•…äº‹ã€‹ ã€Šä¸€äººä¼ä¸šï¼šä¸€ä¸ªäººä¹Ÿèƒ½èµšé’±çš„å•†ä¸šæ–°æ¨¡å¼ã€‹ è‹±è¯­è¯­æ³• ã€ŠEnglish Grammar In Useã€‹ ã€Šè‹±è¯­è¯­æ³•æ–°æ€ç»´â€”â€”åˆçº§æ•™ç¨‹ã€‹ - 8/366 ç¥ç§˜å­¦ï¼ˆæ²¡å‡†å•¥æ—¶å€™æˆ‘å°±æƒ³å†™ç‚¹å°è¯´â€¦ï¼‰ ã€Šæ€§å‘½åœ­æ—¨ã€‹ ","date":"2021-02-01","objectID":"/now/:5:0","series":null,"tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/#äº”å¤‡é€‰ä¹¦å•"},{"categories":null,"content":" æ¢ç´¢äº’è”ç½‘ä¸Šçš„é«˜è´¨é‡å†…å®¹ ä¸»è¦å‚è€ƒè‡ª https://www.owenyoung.com/sources/ äº’è”ç½‘ä¿¡æ¯æ³›æ»¥ï¼Œæˆ‘ä»å„ç§ä¿¡æ¯æ¥æºä¸­æŒ‘é€‰äº†ä¸€éƒ¨åˆ†æˆ‘æ„Ÿå…´è¶£çš„ã€å—æ¨èæ¬¡æ•°è¾ƒå¤šçš„ä¿¡æ¯æºåˆ—åœ¨äº†è¿™é‡Œã€‚ä¹Ÿè¦æ³¨æ„çš„æ˜¯ï¼Œå¤©å¤©çœ‹æœ€æ–°çš„æ–°é—»ä¸çƒ­ç‚¹ï¼Œå¯¹ä¸ªäººå¹¶æ²¡æœ‰ä»€ä¹ˆå¥½å¤„ã€‚åœ¨æœ‰å…´è¶£æˆ–è€…æ— èŠçš„æ—¶å€™ç¿»ä¸€ç¿»ï¼Œäº†è§£ä¸€ä¸‹ä¸–ç•Œçš„å˜åŒ–å°±å¥½äº†ã€‚ ä¸­å›½ä¸å›½é™…ä¸Šçš„æ”¿å²å†…å®¹ï¼š çˆ±æ€æƒ³ç½‘: å›½å†…çš„ä¸€ä¸ªå­¦æœ¯åˆ†äº«ç«™ç‚¹ï¼Œå›½å†…è®¸å¤šå­¦è€…åœ¨ä¸Šé¢é’ˆç ­æ—¶å¼Šã€‚ ä¸­å›½ 1850 - 1950 å¹´é—´çš„å„ç§æŠ¥çº¸ æ—¶äº‹æ–°é—»ï¼ˆå…¨è‹±æ–‡ï¼‰ï¼š æœ‰äººç²¾é€‰äº†ä¸€äº›ä¿¡æ¯æºï¼Œå¹¶åˆ¶ä½œäº†ä¸€ä»½ä¸­æ–‡æ‘˜è¦ç´¢å¼•: https://www.buzzing.cc/ çº½çº¦å®¢: çº½çº¦å®¢æ˜¯ä¸€ä»½ç¾å›½çš„æ–‡å­¦ã€è‰ºæœ¯å’Œæ—¶äº‹æ‚å¿—ï¼Œä»¥å…¶å¯¹æ”¿æ²»ã€æ–‡åŒ–å’Œæ—¶äº‹çš„è¯„è®ºè€Œé—»åã€‚ å¤§è¥¿æ´‹: å¤§è¥¿æ´‹æ˜¯ä¸€ä»½ç¾å›½ç¤¾è®ºæ‚å¿—ï¼Œçš„ç‰¹è‰²æ–‡ç« æ¶‰åŠæ”¿æ²»ã€å¤–äº¤ï¼Œå•†ä¸šä¸ç»æµï¼Œæ–‡åŒ–ä¸è‰ºæœ¯ï¼Œç§‘æŠ€å’Œç§‘å­¦ç­‰é¢†åŸŸã€‚ è‹±å›½å«æŠ¥: è‹±å›½å«æŠ¥æ˜¯è‹±å›½çš„ä¸€å®¶å…¨å›½æ€§æŠ¥çº¸ã€‚ æ—¥æœ¬è¯»å–æ–°é—»: æ—¥æœ¬è¯»å–æ–°é—»æ˜¯æ—¥æœ¬çš„ä¸€å®¶å…¨å›½æ€§æŠ¥çº¸ã€‚ åŠå²›ç”µè§†å°: å¡å¡”å°”çš„å›½é™…åª’ä½“ï¼Œç”±å¡å¡”å°”ç‹å®¤æ‹¥æœ‰ã€‚å…¶ç‰¹ç‚¹æ˜¯ä¸­ä¸œé˜¿æ‹‰ä¼¯ä¸–ç•Œçš„è§†è§’ã€‚ ä¸€äº›æ–°å…´åª’ä½“ æ–°æ”¿æ²»å®¶: è‹±å›½çš„ä¸€ä»½è¿›æ­¥æ”¿æ²»ä¸æ–‡åŒ–æ‚å¿—ã€‚ Rest of the world: ç§‘æŠ€æŠ¥é“ NOEMA: ã€Œæ¢ç´¢å¸­å·æˆ‘ä»¬ä¸–ç•Œçš„å˜é©ã€ï¼Œå‘è¡¨æœ‰å…³å“²å­¦ã€æ²»ç†ã€åœ°ç¼˜æ”¿æ²»ã€ç»æµã€æŠ€æœ¯å’Œæ–‡åŒ–äº¤å‰é¢†åŸŸçš„æ–‡ç« ã€‚ Semafor: å°†æ— å¯äº‰è®®çš„äº‹å®ä¸è®°è€…å¯¹è¿™äº›äº‹å®çš„åˆ†æåˆ†å¼€ï¼Œæä¾›ä¸åŒçš„å’Œæ›´å…¨é¢çš„è§‚ç‚¹ï¼Œå¹¶åˆ†äº«å…¶ä»–åª’ä½“å¯¹è¯¥ä¸»é¢˜çš„æœ‰åŠ›æŠ¥é“ã€‚ ","date":"2021-02-01","objectID":"/now/:6:0","series":null,"tags":null,"title":"æ­¤æ—¶æ­¤åˆ»çš„æˆ‘","uri":"/now/#æ¢ç´¢äº’è”ç½‘ä¸Šçš„é«˜è´¨é‡å†…å®¹"},{"categories":["tech"],"content":" æ³¨æ„ï¼šè¿™ç¯‡æ–‡ç« å¹¶ä¸æ˜¯ä¸€ç¯‡å…¥é—¨æ•™ç¨‹ï¼Œå­¦ä¹  Argo Workflows è¯·ç§»æ­¥å®˜æ–¹æ–‡æ¡£Argo Documentation Argo Workflows æ˜¯ä¸€ä¸ªäº‘åŸç”Ÿå·¥ä½œæµå¼•æ“ï¼Œä¸“æ³¨äºç¼–æ’å¹¶è¡Œä»»åŠ¡ã€‚å®ƒçš„ç‰¹ç‚¹å¦‚ä¸‹ï¼š ä½¿ç”¨ Kubernetes è‡ªå®šä¹‰èµ„æº(CR)å®šä¹‰å·¥ä½œæµï¼Œå…¶ä¸­å·¥ä½œæµä¸­çš„æ¯ä¸ªæ­¥éª¤éƒ½æ˜¯ä¸€ä¸ªå®¹å™¨ã€‚ å°†å¤šæ­¥éª¤å·¥ä½œæµå»ºæ¨¡ä¸ºä¸€ç³»åˆ—ä»»åŠ¡ï¼Œæˆ–è€…ä½¿ç”¨æœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰æè¿°ä»»åŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚ å¯ä»¥åœ¨çŸ­æ—¶é—´å†…è½»æ¾è¿è¡Œç”¨äºæœºå™¨å­¦ä¹ æˆ–æ•°æ®å¤„ç†çš„è®¡ç®—å¯†é›†å‹ä½œä¸šã€‚ Argo Workflows å¯ä»¥çœ‹ä½œ Tekton çš„åŠ å¼ºç‰ˆï¼Œå› æ­¤æ˜¾ç„¶ä¹Ÿå¯ä»¥é€šè¿‡ Argo Workflows è¿è¡Œ CI/CD æµæ°´çº¿(Pipielines)ã€‚ é˜¿é‡Œäº‘æ˜¯ Argo Workflows çš„æ·±åº¦ä½¿ç”¨è€…å’Œè´¡çŒ®è€…ï¼Œå¦å¤– Kubeflow åº•å±‚çš„å·¥ä½œæµå¼•æ“ä¹Ÿæ˜¯ Argo Workflows. ","date":"2021-01-27","objectID":"/posts/experience-of-argo-workflows/:0:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿","Kubernetes"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/experience-of-argo-workflows/#"},{"categories":["tech"],"content":" ä¸€ã€Argo Workflows å¯¹æ¯” Jenkinsæˆ‘ä»¬åœ¨åˆ‡æ¢åˆ° Argo Workflows ä¹‹å‰ï¼Œä½¿ç”¨çš„ CI/CD å·¥å…·æ˜¯ Jenkinsï¼Œä¸‹é¢å¯¹ Argo Workflows å’Œ Jenkins åšä¸€ä¸ªæ¯”è¾ƒè¯¦ç»†çš„å¯¹æ¯”ï¼Œä»¥äº†è§£ Argo Workflows çš„ä¼˜ç¼ºç‚¹ã€‚ ","date":"2021-01-27","objectID":"/posts/experience-of-argo-workflows/:1:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿","Kubernetes"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/experience-of-argo-workflows/#ä¸€argo-workflows-å¯¹æ¯”-jenkins"},{"categories":["tech"],"content":" 1. Workflow çš„å®šä¹‰Workflow ä½¿ç”¨ kubernetes CR è¿›è¡Œå®šä¹‰ï¼Œå› æ­¤æ˜¾ç„¶æ˜¯ä¸€ä»½ yaml é…ç½®ã€‚ ä¸€ä¸ª Workflowï¼Œå°±æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨ Kubernetes ä¸Šçš„æµæ°´çº¿ï¼Œå¯¹åº” Jenkins çš„ä¸€æ¬¡ Build. è€Œ WorkflowTemplate åˆ™æ˜¯ä¸€ä¸ªå¯é‡ç”¨çš„ Workflow æ¨¡æ¿ï¼Œå¯¹åº” Jenkins çš„ä¸€ä¸ª Job. WorkflowTemplate çš„ yaml å®šä¹‰å’Œ Workflow å®Œå…¨ä¸€è‡´ï¼Œåªæœ‰ Kind ä¸åŒï¼ WorkflowTemplate å¯ä»¥è¢«å…¶ä»– Workflow å¼•ç”¨å¹¶è§¦å‘ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨ä¼ å‚ä»¥ç”Ÿæˆä¸€ä¸ª Workflow å·¥ä½œæµã€‚ ","date":"2021-01-27","objectID":"/posts/experience-of-argo-workflows/:1:1","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿","Kubernetes"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/experience-of-argo-workflows/#1-workflow-çš„å®šä¹‰"},{"categories":["tech"],"content":" 2. Workflow çš„ç¼–æ’Argo Workflows ç›¸æ¯”å…¶ä»–æµæ°´çº¿é¡¹ç›®(Jenkins/Tekton/Drone/Gitlab-CI)è€Œè¨€ï¼Œæœ€å¤§çš„ç‰¹ç‚¹ï¼Œå°±æ˜¯å®ƒå¼ºå¤§çš„æµæ°´çº¿ç¼–æ’èƒ½åŠ›ã€‚ å…¶ä»–æµæ°´çº¿é¡¹ç›®ï¼Œå¯¹æµæ°´çº¿ä¹‹é—´çš„å…³è”æ€§è€ƒè™‘å¾—å¾ˆå°‘ï¼ŒåŸºæœ¬éƒ½å‡è®¾æµæ°´çº¿éƒ½æ˜¯äº’ç›¸ç‹¬ç«‹çš„ã€‚ è€Œ Argo Workflows åˆ™å‡è®¾ã€Œä»»åŠ¡ã€ä¹‹é—´æ˜¯æœ‰ä¾èµ–å…³ç³»çš„ï¼Œé’ˆå¯¹è¿™ä¸ªä¾èµ–å…³ç³»ï¼Œå®ƒæä¾›äº†ä¸¤ç§åè°ƒç¼–æ’ã€Œä»»åŠ¡ã€çš„æ–¹æ³•ï¼šSteps å’Œ DAG å†å€ŸåŠ©templateRef æˆ–è€…Workflow of Workflowsï¼Œ å°±èƒ½å®ç° Workflows çš„ç¼–æ’äº†ã€‚ æˆ‘ä»¬ä¹‹æ‰€ä»¥é€‰æ‹© Argo Workflows è€Œä¸æ˜¯ Tektonï¼Œä¸»è¦å°±æ˜¯å› ä¸º Argo çš„æµæ°´çº¿ç¼–æ’èƒ½åŠ›æ¯” Tekton å¼ºå¤§å¾—å¤šã€‚ï¼ˆä¹Ÿè®¸æ˜¯å› ä¸ºæˆ‘ä»¬çš„åç«¯ä¸­å°ç»“æ„æ¯”è¾ƒç‰¹æ®Šï¼Œå¯¼è‡´æˆ‘ä»¬çš„ CI æµæ°´çº¿éœ€è¦å…·å¤‡å¤æ‚çš„ç¼–æ’èƒ½åŠ›ï¼‰ ä¸€ä¸ªå¤æ‚å·¥ä½œæµçš„ç¤ºä¾‹å¦‚ä¸‹ï¼š https://github.com/argoproj/argo/issues/1088#issuecomment-445884543 ","date":"2021-01-27","objectID":"/posts/experience-of-argo-workflows/:1:2","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿","Kubernetes"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/experience-of-argo-workflows/#2-workflow-çš„ç¼–æ’"},{"categories":["tech"],"content":" 3. Workflow çš„å£°æ˜å¼é…ç½®Argo ä½¿ç”¨ Kubernetes è‡ªå®šä¹‰èµ„æº(CR)æ¥å®šä¹‰ Workflowï¼Œç†Ÿæ‚‰ Kubernetes Yaml çš„åŒå­¦ä¸Šæ‰‹åº”è¯¥éƒ½å¾ˆå¿«ã€‚ ä¸‹é¢å¯¹ Workflow å®šä¹‰æ–‡ä»¶å’Œ Jenkinsfile åšä¸ªå¯¹æ¯”ï¼š argo å®Œå…¨ä½¿ç”¨ yaml æ¥å®šä¹‰æµæ°´çº¿ï¼Œå­¦ä¹ æˆæœ¬æ¯” Jenkinsfile çš„ groovy ä½ã€‚å¯¹ç†Ÿæ‚‰ Kubernetes çš„åŒå­¦å°¤å…¶å¦‚æ­¤ã€‚ å°† jenkinsfile ç”¨ argo é‡å†™åï¼Œä»£ç é‡å‡ºç°äº†æ˜æ˜¾çš„è†¨èƒ€ã€‚ä¸€ä¸ª 20 è¡Œçš„ Jenkinsfileï¼Œç”¨ Argo é‡å†™å¯èƒ½å°±å˜æˆäº† 60 è¡Œã€‚ é…ç½®å‡ºç°äº†è†¨èƒ€æ˜¯ä¸ªé—®é¢˜ï¼Œä½†æ˜¯è€ƒè™‘åˆ°å®ƒçš„å¯è¯»æ€§è¿˜ç®—ä¸é”™ï¼Œè€Œä¸” Argo çš„ Workflow ç¼–æ’åŠŸèƒ½ï¼Œèƒ½æ›¿ä»£æ‰æˆ‘ä»¬ç›®å‰ç»´æŠ¤çš„éƒ¨åˆ† Python æ„å»ºä»£ç ï¼Œä»¥åŠä¸€äº›å…¶ä»–ä¼˜ç‚¹ï¼Œé…ç½®è†¨èƒ€è¿™ä¸ªé—®é¢˜ä¹Ÿå°±å¯ä»¥æ¥å—äº†ã€‚ ","date":"2021-01-27","objectID":"/posts/experience-of-argo-workflows/:1:3","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿","Kubernetes"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/experience-of-argo-workflows/#3-workflow-çš„å£°æ˜å¼é…ç½®"},{"categories":["tech"],"content":" 4. Web UIArgo Workflows çš„ Web UI æ„Ÿè§‰è¿˜å¾ˆåŸå§‹ã€‚ç¡®å®è¯¥æ”¯æŒçš„åŠŸèƒ½éƒ½æœ‰ï¼Œä½†æ˜¯å®ƒè²Œä¼¼ä¸æ˜¯é¢å‘ã€Œç”¨æˆ·ã€çš„ï¼ŒåŠŸèƒ½æ¯”è¾ƒåº•å±‚ã€‚ å®ƒä¸åƒ Jenkins ä¸€æ ·ï¼Œæœ‰å¾ˆå‹å¥½çš„ä½¿ç”¨ç•Œé¢(è™½ç„¶è¯´ Jenkins çš„ UI ä¹Ÿå¾ˆæ˜¾è€â€¦) å¦å¤–å®ƒæ‰€æœ‰çš„ Workflow éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œæ²¡åŠæ³•ç›´è§‚åœ°æ‰¾åˆ°ä¸€ä¸ª WorkflowTemplate çš„æ‰€æœ‰æ„å»ºè®°å½•ï¼Œåªèƒ½é€šè¿‡ label/namespace è¿›è¡Œåˆ†ç±»ï¼Œé€šè¿‡ä»»åŠ¡åç§°è¿›è¡Œæœç´¢ã€‚ è€Œ Jenkins å¯ä»¥å¾ˆæ–¹ä¾¿åœ°çœ‹åˆ°åŒä¸€ä¸ª Job çš„æ‰€æœ‰æ„å»ºå†å²ã€‚ ","date":"2021-01-27","objectID":"/posts/experience-of-argo-workflows/:1:4","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿","Kubernetes"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/experience-of-argo-workflows/#4-web-ui"},{"categories":["tech"],"content":" 5. Workflow çš„åˆ†ç±» ä¸ºä½•éœ€è¦å¯¹ Workflow åšç»†è‡´çš„åˆ†ç±»å¸¸è§çš„å¾®æœåŠ¡é¡¹ç›®ï¼Œå¾€å¾€ä¼šæ‹†åˆ†æˆä¼—å¤š Git ä»“åº“ï¼ˆå¾®æœåŠ¡ï¼‰è¿›è¡Œå¼€å‘ï¼Œä¼—å¤šçš„ Git ä»“åº“ä¼šä½¿æˆ‘ä»¬åˆ›å»ºä¼—å¤šçš„ CI/CD æµæ°´çº¿ã€‚å¦‚æœæ²¡æœ‰ä»»ä½•çš„åˆ†ç±»ï¼Œè¿™ä¸€å¤§å †çš„æµæ°´çº¿å¦‚ä½•ç®¡ç†ï¼Œå°±æˆäº†ä¸€ä¸ªéš¾é¢˜ã€‚ æœ€æ˜¾è§çš„éœ€æ±‚ï¼šå‰ç«¯å’Œåç«¯çš„æµæ°´çº¿æœ€å¥½èƒ½åŒºåˆ†ä¸€ä¸‹ï¼Œå¾€ä¸‹ç»†åˆ†ï¼Œå‰ç«¯çš„ Web ç«¯å’Œå®¢æˆ·ç«¯æœ€å¥½ä¹Ÿèƒ½åŒºåˆ†ï¼Œåç«¯çš„ä¸šåŠ¡å±‚å’Œä¸­å°æœ€å¥½ä¹ŸåŒºåˆ†å¼€æ¥ã€‚ å¦å¤–æˆ‘ä»¬è¿˜å¸Œæœ›å°†è¿ç»´ã€è‡ªåŠ¨åŒ–æµ‹è¯•ç›¸å…³çš„ä»»åŠ¡ä¹Ÿé›†æˆåˆ°è¿™ä¸ªç³»ç»Ÿä¸­æ¥ï¼ˆç›®å‰æˆ‘ä»¬å°±æ˜¯ä½¿ç”¨ Jenkins å®Œæˆè¿ç»´ã€è‡ªåŠ¨åŒ–æµ‹è¯•ä»»åŠ¡çš„ï¼‰ï¼Œå¦‚æœæ²¡æœ‰ä»»ä½•åˆ†ç±»ï¼Œè¿™ä¸€å¤§å †æµæ°´çº¿å°†æ··ä¹±æ— æ¯”ã€‚ Argo Workflows çš„åˆ†ç±»èƒ½åŠ›å½“ Workflow è¶Šæ¥è¶Šå¤šçš„æ—¶å€™ï¼Œå¦‚æœä¸åšåˆ†ç±»ï¼Œä¸€å † WorkflowTemplate å †åœ¨ä¸€èµ·å°±ä¼šæ˜¾å¾—ç‰¹åˆ«æ··ä¹±ã€‚ ï¼ˆæ²¡é”™ï¼Œæˆ‘è§‰å¾— Drone å°±æœ‰è¿™ä¸ªé—®é¢˜â€¦ï¼‰ Argo æ˜¯å®Œå…¨åŸºäº Kubernetes çš„ï¼Œå› æ­¤ç›®å‰å®ƒä¹Ÿåªèƒ½é€šè¿‡ namespace/labels è¿›è¡Œåˆ†ç±»ã€‚ è¿™æ ·çš„åˆ†ç±»ç»“æ„å’Œ Jenkins çš„è§†å›¾-æ–‡ä»¶å¤¹ä½“ç³»å¤§ç›¸å¾„åº­ï¼Œç›®å‰æ„Ÿè§‰ä¸æ˜¯å¾ˆå¥½ç”¨ï¼ˆä¹Ÿå¯èƒ½çº¯ç²¹æ˜¯ Web UI çš„é”…ï¼‰ã€‚ ","date":"2021-01-27","objectID":"/posts/experience-of-argo-workflows/:1:5","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿","Kubernetes"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/experience-of-argo-workflows/#5-workflow-çš„åˆ†ç±»"},{"categories":["tech"],"content":" 5. Workflow çš„åˆ†ç±» ä¸ºä½•éœ€è¦å¯¹ Workflow åšç»†è‡´çš„åˆ†ç±»å¸¸è§çš„å¾®æœåŠ¡é¡¹ç›®ï¼Œå¾€å¾€ä¼šæ‹†åˆ†æˆä¼—å¤š Git ä»“åº“ï¼ˆå¾®æœåŠ¡ï¼‰è¿›è¡Œå¼€å‘ï¼Œä¼—å¤šçš„ Git ä»“åº“ä¼šä½¿æˆ‘ä»¬åˆ›å»ºä¼—å¤šçš„ CI/CD æµæ°´çº¿ã€‚å¦‚æœæ²¡æœ‰ä»»ä½•çš„åˆ†ç±»ï¼Œè¿™ä¸€å¤§å †çš„æµæ°´çº¿å¦‚ä½•ç®¡ç†ï¼Œå°±æˆäº†ä¸€ä¸ªéš¾é¢˜ã€‚ æœ€æ˜¾è§çš„éœ€æ±‚ï¼šå‰ç«¯å’Œåç«¯çš„æµæ°´çº¿æœ€å¥½èƒ½åŒºåˆ†ä¸€ä¸‹ï¼Œå¾€ä¸‹ç»†åˆ†ï¼Œå‰ç«¯çš„ Web ç«¯å’Œå®¢æˆ·ç«¯æœ€å¥½ä¹Ÿèƒ½åŒºåˆ†ï¼Œåç«¯çš„ä¸šåŠ¡å±‚å’Œä¸­å°æœ€å¥½ä¹ŸåŒºåˆ†å¼€æ¥ã€‚ å¦å¤–æˆ‘ä»¬è¿˜å¸Œæœ›å°†è¿ç»´ã€è‡ªåŠ¨åŒ–æµ‹è¯•ç›¸å…³çš„ä»»åŠ¡ä¹Ÿé›†æˆåˆ°è¿™ä¸ªç³»ç»Ÿä¸­æ¥ï¼ˆç›®å‰æˆ‘ä»¬å°±æ˜¯ä½¿ç”¨ Jenkins å®Œæˆè¿ç»´ã€è‡ªåŠ¨åŒ–æµ‹è¯•ä»»åŠ¡çš„ï¼‰ï¼Œå¦‚æœæ²¡æœ‰ä»»ä½•åˆ†ç±»ï¼Œè¿™ä¸€å¤§å †æµæ°´çº¿å°†æ··ä¹±æ— æ¯”ã€‚ Argo Workflows çš„åˆ†ç±»èƒ½åŠ›å½“ Workflow è¶Šæ¥è¶Šå¤šçš„æ—¶å€™ï¼Œå¦‚æœä¸åšåˆ†ç±»ï¼Œä¸€å † WorkflowTemplate å †åœ¨ä¸€èµ·å°±ä¼šæ˜¾å¾—ç‰¹åˆ«æ··ä¹±ã€‚ ï¼ˆæ²¡é”™ï¼Œæˆ‘è§‰å¾— Drone å°±æœ‰è¿™ä¸ªé—®é¢˜â€¦ï¼‰ Argo æ˜¯å®Œå…¨åŸºäº Kubernetes çš„ï¼Œå› æ­¤ç›®å‰å®ƒä¹Ÿåªèƒ½é€šè¿‡ namespace/labels è¿›è¡Œåˆ†ç±»ã€‚ è¿™æ ·çš„åˆ†ç±»ç»“æ„å’Œ Jenkins çš„è§†å›¾-æ–‡ä»¶å¤¹ä½“ç³»å¤§ç›¸å¾„åº­ï¼Œç›®å‰æ„Ÿè§‰ä¸æ˜¯å¾ˆå¥½ç”¨ï¼ˆä¹Ÿå¯èƒ½çº¯ç²¹æ˜¯ Web UI çš„é”…ï¼‰ã€‚ ","date":"2021-01-27","objectID":"/posts/experience-of-argo-workflows/:1:5","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿","Kubernetes"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/experience-of-argo-workflows/#ä¸ºä½•éœ€è¦å¯¹-workflow-åšç»†è‡´çš„åˆ†ç±»"},{"categories":["tech"],"content":" 5. Workflow çš„åˆ†ç±» ä¸ºä½•éœ€è¦å¯¹ Workflow åšç»†è‡´çš„åˆ†ç±»å¸¸è§çš„å¾®æœåŠ¡é¡¹ç›®ï¼Œå¾€å¾€ä¼šæ‹†åˆ†æˆä¼—å¤š Git ä»“åº“ï¼ˆå¾®æœåŠ¡ï¼‰è¿›è¡Œå¼€å‘ï¼Œä¼—å¤šçš„ Git ä»“åº“ä¼šä½¿æˆ‘ä»¬åˆ›å»ºä¼—å¤šçš„ CI/CD æµæ°´çº¿ã€‚å¦‚æœæ²¡æœ‰ä»»ä½•çš„åˆ†ç±»ï¼Œè¿™ä¸€å¤§å †çš„æµæ°´çº¿å¦‚ä½•ç®¡ç†ï¼Œå°±æˆäº†ä¸€ä¸ªéš¾é¢˜ã€‚ æœ€æ˜¾è§çš„éœ€æ±‚ï¼šå‰ç«¯å’Œåç«¯çš„æµæ°´çº¿æœ€å¥½èƒ½åŒºåˆ†ä¸€ä¸‹ï¼Œå¾€ä¸‹ç»†åˆ†ï¼Œå‰ç«¯çš„ Web ç«¯å’Œå®¢æˆ·ç«¯æœ€å¥½ä¹Ÿèƒ½åŒºåˆ†ï¼Œåç«¯çš„ä¸šåŠ¡å±‚å’Œä¸­å°æœ€å¥½ä¹ŸåŒºåˆ†å¼€æ¥ã€‚ å¦å¤–æˆ‘ä»¬è¿˜å¸Œæœ›å°†è¿ç»´ã€è‡ªåŠ¨åŒ–æµ‹è¯•ç›¸å…³çš„ä»»åŠ¡ä¹Ÿé›†æˆåˆ°è¿™ä¸ªç³»ç»Ÿä¸­æ¥ï¼ˆç›®å‰æˆ‘ä»¬å°±æ˜¯ä½¿ç”¨ Jenkins å®Œæˆè¿ç»´ã€è‡ªåŠ¨åŒ–æµ‹è¯•ä»»åŠ¡çš„ï¼‰ï¼Œå¦‚æœæ²¡æœ‰ä»»ä½•åˆ†ç±»ï¼Œè¿™ä¸€å¤§å †æµæ°´çº¿å°†æ··ä¹±æ— æ¯”ã€‚ Argo Workflows çš„åˆ†ç±»èƒ½åŠ›å½“ Workflow è¶Šæ¥è¶Šå¤šçš„æ—¶å€™ï¼Œå¦‚æœä¸åšåˆ†ç±»ï¼Œä¸€å † WorkflowTemplate å †åœ¨ä¸€èµ·å°±ä¼šæ˜¾å¾—ç‰¹åˆ«æ··ä¹±ã€‚ ï¼ˆæ²¡é”™ï¼Œæˆ‘è§‰å¾— Drone å°±æœ‰è¿™ä¸ªé—®é¢˜â€¦ï¼‰ Argo æ˜¯å®Œå…¨åŸºäº Kubernetes çš„ï¼Œå› æ­¤ç›®å‰å®ƒä¹Ÿåªèƒ½é€šè¿‡ namespace/labels è¿›è¡Œåˆ†ç±»ã€‚ è¿™æ ·çš„åˆ†ç±»ç»“æ„å’Œ Jenkins çš„è§†å›¾-æ–‡ä»¶å¤¹ä½“ç³»å¤§ç›¸å¾„åº­ï¼Œç›®å‰æ„Ÿè§‰ä¸æ˜¯å¾ˆå¥½ç”¨ï¼ˆä¹Ÿå¯èƒ½çº¯ç²¹æ˜¯ Web UI çš„é”…ï¼‰ã€‚ ","date":"2021-01-27","objectID":"/posts/experience-of-argo-workflows/:1:5","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿","Kubernetes"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/experience-of-argo-workflows/#argo-workflows-çš„åˆ†ç±»èƒ½åŠ›"},{"categories":["tech"],"content":" 6. è§¦å‘æ„å»ºçš„æ–¹å¼Argo Workflows çš„æµæ°´çº¿æœ‰å¤šç§è§¦å‘æ–¹å¼ï¼š æ‰‹åŠ¨è§¦å‘ï¼šæ‰‹åŠ¨æäº¤ä¸€ä¸ª Workflowï¼Œå°±èƒ½è§¦å‘ä¸€æ¬¡æ„å»ºã€‚å¯ä»¥é€šè¿‡workflowTemplateRef ç›´æ¥å¼•ç”¨ä¸€ä¸ªç°æˆçš„æµæ°´çº¿æ¨¡æ¿ã€‚ å®šæ—¶è§¦å‘ï¼šCronWorkflow é€šè¿‡ Git ä»“åº“å˜æ›´è§¦å‘ï¼šå€ŸåŠ© argo-events å¯ä»¥å®ç°æ­¤åŠŸèƒ½ï¼Œè¯¦è§å…¶æ–‡æ¡£ã€‚ å¦å¤–ç›®å‰ä¹Ÿä¸æ¸…æ¥š WebHook çš„å¯é ç¨‹åº¦å¦‚ä½•ï¼Œä¼šä¸ä¼šå› ä¸ºå®•æœºã€æ–­ç½‘ç­‰æ•…éšœï¼Œå¯¼è‡´ Git ä»“åº“å˜æ›´äº†ï¼Œè€Œ Workflow å´æ²¡è§¦å‘ï¼Œè€Œä¸”è¿˜æ²¡æœ‰ä»»ä½•æ˜¾çœ¼çš„é”™è¯¯é€šçŸ¥ï¼Ÿå¦‚æœè¿™ä¸ªé”™è¯¯å°±è¿™æ ·è—èµ·æ¥äº†ï¼Œå°±å¯èƒ½ä¼šå¯¼è‡´å¾ˆä¸¥é‡çš„é—®é¢˜ï¼ ","date":"2021-01-27","objectID":"/posts/experience-of-argo-workflows/:1:6","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿","Kubernetes"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/experience-of-argo-workflows/#6-è§¦å‘æ„å»ºçš„æ–¹å¼"},{"categories":["tech"],"content":" 7. secrets ç®¡ç†Argo Workflows çš„æµæ°´çº¿ï¼Œå¯ä»¥ä» kubernetes secrets/configmap ä¸­è·å–ä¿¡æ¯ï¼Œå°†ä¿¡æ¯æ³¨å…¥åˆ°ç¯å¢ƒå˜é‡ä¸­ã€æˆ–è€…ä»¥æ–‡ä»¶å½¢å¼æŒ‚è½½åˆ° Pod ä¸­ã€‚ Git ç§é’¥ã€Harbor ä»“åº“å‡­æ®ã€CD éœ€è¦çš„ kubeconfigï¼Œéƒ½å¯ä»¥ç›´æ¥ä» secrets/configmap ä¸­è·å–åˆ°ã€‚ å¦å¤–å› ä¸º Vault å¾ˆæµè¡Œï¼Œä¹Ÿå¯ä»¥å°† secrets ä¿å­˜åœ¨ Vault ä¸­ï¼Œå†é€šè¿‡ vault agent å°†é…ç½®æ³¨å…¥è¿› Podã€‚ ","date":"2021-01-27","objectID":"/posts/experience-of-argo-workflows/:1:7","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿","Kubernetes"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/experience-of-argo-workflows/#7-secrets-ç®¡ç†"},{"categories":["tech"],"content":" 8. ArtifactsArgo æ”¯æŒæ¥å…¥å¯¹è±¡å­˜å‚¨ï¼Œåšå…¨å±€çš„ Artifact ä»“åº“ï¼Œæœ¬åœ°å¯ä»¥ä½¿ç”¨ MinIO. ä½¿ç”¨å¯¹è±¡å­˜å‚¨å­˜å‚¨ Artifactï¼Œæœ€å¤§çš„å¥½å¤„å°±æ˜¯å¯ä»¥åœ¨ Pod ä¹‹é—´éšæ„ä¼ æ•°æ®ï¼ŒPod å¯ä»¥å®Œå…¨åˆ†å¸ƒå¼åœ°è¿è¡Œåœ¨ Kubernetes é›†ç¾¤çš„ä»»ä½•èŠ‚ç‚¹ä¸Šã€‚ å¦å¤–ä¹Ÿå¯ä»¥è€ƒè™‘å€ŸåŠ© Artifact ä»“åº“å®ç°è·¨æµæ°´çº¿çš„ç¼“å­˜å¤ç”¨ï¼ˆæœªæµ‹è¯•ï¼‰ï¼Œæå‡æ„å»ºé€Ÿåº¦ã€‚ ","date":"2021-01-27","objectID":"/posts/experience-of-argo-workflows/:1:8","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿","Kubernetes"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/experience-of-argo-workflows/#8-artifacts"},{"categories":["tech"],"content":" 9. å®¹å™¨é•œåƒçš„æ„å»ºå€ŸåŠ© Buildkit ç­‰å®¹å™¨é•œåƒæ„å»ºå·¥å…·ï¼Œå¯ä»¥å®ç°å®¹å™¨é•œåƒçš„åˆ†å¸ƒå¼æ„å»ºã€‚ Buildkit å¯¹æ„å»ºç¼“å­˜çš„æ”¯æŒä¹Ÿå¾ˆå¥½ï¼Œå¯ä»¥ç›´æ¥å°†ç¼“å­˜å­˜å‚¨åœ¨å®¹å™¨é•œåƒä»“åº“ä¸­ã€‚ ä¸å»ºè®®ä½¿ç”¨ Google çš„ Kanikoï¼Œå®ƒå¯¹ç¼“å­˜å¤ç”¨çš„æ”¯æŒä¸å’‹åœ°ï¼Œç¤¾åŒºä¹Ÿä¸æ´»è·ƒã€‚ ","date":"2021-01-27","objectID":"/posts/experience-of-argo-workflows/:1:9","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿","Kubernetes"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/experience-of-argo-workflows/#9-å®¹å™¨é•œåƒçš„æ„å»º"},{"categories":["tech"],"content":" 10. å®¢æˆ·ç«¯/SDKArgo æœ‰æä¾›ä¸€ä¸ªå‘½ä»¤è¡Œå®¢æˆ·ç«¯ï¼Œä¹Ÿæœ‰ HTTP API å¯ä¾›ä½¿ç”¨ã€‚ å¦‚ä¸‹é¡¹ç›®å€¼å¾—è¯•ç”¨ï¼š argo-client-python: Argo Workflows çš„ Python å®¢æˆ·ç«¯ è¯´å®è¯ï¼Œæ„Ÿè§‰å’Œ kubernetes-client/python ä¸€æ ·éš¾ç”¨ï¼Œæ¯•ç«Ÿéƒ½æ˜¯ openapi-generator ç”Ÿæˆå‡ºæ¥çš„â€¦ argo-python-dsl: ä½¿ç”¨ Python DSL ç¼–å†™ Argo Workflows æ„Ÿè§‰ä½¿ç”¨éš¾åº¦æ¯” yaml é«˜ï¼Œä¹Ÿä¸å¤ªå¥½ç”¨ã€‚ couler: ä¸º Argo/Tekton/Airflow æä¾›ç»Ÿä¸€çš„æ„å»ºä¸ç®¡ç†æ¥å£ ç†å¿µå€’æ˜¯å¾ˆå¥½ï¼Œå¾…ç ”ç©¶ æ„Ÿè§‰ couler æŒºä¸é”™çš„ï¼Œå¯ä»¥ç›´æ¥ç”¨ Python å†™ WorkflowTemplateï¼Œè¿™æ ·å°±ä¸€æ­¥åˆ°ä½ï¼Œæ‰€æœ‰ CI/CD ä»£ç å…¨éƒ¨æ˜¯ Python äº†ã€‚ æ­¤å¤–ï¼Œå› ä¸º Argo Workflows æ˜¯ kubernetes è‡ªå®šä¹‰èµ„æº CRï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ helm/kustomize æ¥åš workflow çš„ç”Ÿæˆã€‚ ç›®å‰æˆ‘ä»¬ä¸€äº›æ­¥éª¤éå¸¸å¤šï¼Œä½†æ˜¯é‡å¤åº¦ä¹Ÿå¾ˆé«˜çš„ Argo æµæ°´çº¿é…ç½®ï¼Œå°±æ˜¯ä½¿ç”¨ helm ç”Ÿæˆçš„â€”â€”å…³é”®æ•°æ®æŠ½å–åˆ° values.yaml ä¸­ï¼Œä½¿ç”¨ helm æ¨¡æ¿ + range å¾ªç¯æ¥ç”Ÿæˆ workflow é…ç½®ã€‚ ","date":"2021-01-27","objectID":"/posts/experience-of-argo-workflows/:1:10","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿","Kubernetes"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/experience-of-argo-workflows/#10-å®¢æˆ·ç«¯sdk"},{"categories":["tech"],"content":" äºŒã€å®‰è£… Argo Workflows å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttps://argoproj.github.io/argo-workflows/installation/ å®‰è£…ä¸€ä¸ªé›†ç¾¤ç‰ˆ(cluster wide)çš„ Argo Workflowsï¼Œä½¿ç”¨ MinIO åš artifacts å­˜å‚¨ï¼š shell kubectl apply -f https://raw.githubusercontent.com/argoproj/argo/stable/manifests/install.yaml éƒ¨ç½² MinIO: shell helm repo add minio https://helm.min.io/ # official minio Helm charts # æŸ¥çœ‹å†å²ç‰ˆæœ¬ helm search repo minio/minio -l | head # ä¸‹è½½å¹¶è§£å‹ chart helm pull minio/minio --untar --version 8.0.9 # ç¼–å†™ custom-values.yamlï¼Œç„¶åéƒ¨ç½² minio kubectl create namespace minio helm install minio ./minio -n argo -f custom-values.yaml minio éƒ¨ç½²å¥½åï¼Œå®ƒä¼šå°†é»˜è®¤çš„ accesskey å’Œ secretkey ä¿å­˜åœ¨åä¸º minio çš„ secret ä¸­ã€‚æˆ‘ä»¬éœ€è¦ä¿®æ”¹ argo çš„é…ç½®ï¼Œå°† minio ä½œä¸ºå®ƒçš„é»˜è®¤ artifact ä»“åº“ã€‚ åœ¨ configmap workflow-controller-configmap çš„ data ä¸­æ·»åŠ å¦‚ä¸‹å­—æ®µï¼š shell artifactRepository: | # æ˜¯å¦å°† main å®¹å™¨çš„æ—¥å¿—ä¿å­˜ä¸º artifactï¼Œè¿™æ · pod è¢«åˆ é™¤åï¼Œä»ç„¶å¯ä»¥åœ¨ artifact ä¸­æ‰¾åˆ°æ—¥å¿— archiveLogs: true s3: bucket: argo-bucket # bucket åç§°ï¼Œè¿™ä¸ª bucket éœ€è¦å…ˆæ‰‹åŠ¨åˆ›å»ºå¥½ï¼ endpoint: minio:9000 # minio åœ°å€ insecure: true # ä» minio è¿™ä¸ª secret ä¸­è·å– key/secret accessKeySecret: name: minio key: accesskey secretKeySecret: name: minio key: secretkey ç°åœ¨è¿˜å·®æœ€åä¸€æ­¥ï¼šæ‰‹åŠ¨è¿›å…¥ minio çš„ Web UIï¼Œåˆ›å»ºå¥½ argo-bucket è¿™ä¸ª bucket. ç›´æ¥è®¿é—® minio çš„ 9000 ç«¯å£ï¼ˆéœ€è¦ä½¿ç”¨ nodeport/ingress ç­‰æ–¹å¼æš´éœ²æ­¤ç«¯å£ï¼‰å°±èƒ½è¿›å…¥ Web UIï¼Œä½¿ç”¨å‰é¢æåˆ°çš„ secret minio ä¸­çš„ key/secret ç™»å½•ï¼Œå°±èƒ½åˆ›å»º bucket. ","date":"2021-01-27","objectID":"/posts/experience-of-argo-workflows/:2:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿","Kubernetes"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/experience-of-argo-workflows/#äºŒå®‰è£…-argo-workflows"},{"categories":["tech"],"content":" ServiceAccount é…ç½® https://argoproj.github.io/argo-workflows/service-accounts/ Argo Workflows ä¾èµ–äº ServiceAccount è¿›è¡ŒéªŒè¯ä¸æˆæƒï¼Œè€Œä¸”é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä½¿ç”¨æ‰€åœ¨ namespace çš„ default ServiceAccount è¿è¡Œ workflow. å¯ default è¿™ä¸ª ServiceAccount é»˜è®¤æ ¹æœ¬æ²¡æœ‰ä»»ä½•æƒé™ï¼æ‰€ä»¥ Argo çš„ artifacts, outputs, access to secrets ç­‰åŠŸèƒ½å…¨éƒ½ä¼šå› ä¸ºæƒé™ä¸è¶³è€Œæ— æ³•ä½¿ç”¨ï¼ ä¸ºæ­¤ï¼ŒArgo çš„å®˜æ–¹æ–‡æ¡£æä¾›äº†ä¸¤ä¸ªè§£å†³æ–¹æ³•ã€‚ æ–¹æ³•ä¸€ï¼Œç›´æ¥ç»™ default ç»‘å®š cluster-admin ClusterRoleï¼Œç»™å®ƒé›†ç¾¤ç®¡ç†å‘˜çš„æƒé™ï¼Œåªè¦ä¸€è¡Œå‘½ä»¤ï¼ˆä½†æ˜¯æ˜¾ç„¶å®‰å…¨æ€§å ªå¿§ï¼‰ï¼š shell kubectl create rolebinding default-admin --clusterrole=admin --serviceaccount=\u003cnamespace\u003e:default -n \u003cnamespace\u003e æ–¹æ³•äºŒï¼Œå®˜æ–¹ç»™å‡ºäº†Argo Workflows éœ€è¦çš„æœ€å°æƒé™çš„ Role å®šä¹‰ï¼Œ æ–¹ä¾¿èµ·è§æˆ‘å°†å®ƒæ”¹æˆä¸€ä¸ª ClusterRole: yaml apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRole metadata: name: argo-workflows-role rules: # pod get/watch is used to identify the container IDs of the current pod # pod patch is used to annotate the step's outputs back to controller (e.g. artifact location) - apiGroups: - \"\" resources: - pods verbs: - get - watch - patch # logs get/watch are used to get the pods logs for script outputs, and for log archival - apiGroups: - \"\" resources: - pods/log verbs: - get - watch åˆ›å»ºå¥½ä¸Šé¢è¿™ä¸ªæœ€å°çš„ ClusterRoleï¼Œç„¶åä¸ºæ¯ä¸ªåå­—ç©ºé—´ï¼Œè·‘ä¸€ä¸‹å¦‚ä¸‹å‘½ä»¤ï¼Œç»™ default è´¦å·ç»‘å®šè¿™ä¸ª clusterrole: shell kubectl create rolebinding default-argo-workflows --clusterrole=argo-workflows-role --serviceaccount=\u003cnamespace\u003e:default -n \u003cnamespace\u003e è¿™æ ·å°±èƒ½ç»™ default è´¦å·æä¾›æœ€å°çš„ workflow è¿è¡Œæƒé™ã€‚ æˆ–è€…å¦‚æœä½ å¸Œæœ›ä½¿ç”¨åˆ«çš„ ServiceAccount æ¥è¿è¡Œ workflowï¼Œä¹Ÿå¯ä»¥è‡ªè¡Œåˆ›å»º ServiceAccountï¼Œç„¶åå†èµ°ä¸Šé¢æ–¹æ³•äºŒçš„æµç¨‹ï¼Œä½†æ˜¯æœ€åï¼Œè¦è®°å¾—åœ¨ workflow çš„ spec.serviceAccountName ä¸­è®¾å®šå¥½ ServiceAccount åç§°ã€‚ ","date":"2021-01-27","objectID":"/posts/experience-of-argo-workflows/:2:1","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿","Kubernetes"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/experience-of-argo-workflows/#serviceaccount-é…ç½®"},{"categories":["tech"],"content":" Workflow Executors https://argoproj.github.io/argo-workflows/workflow-executors/ Workflow Executor æ˜¯ç¬¦åˆç‰¹å®šæ¥å£çš„ä¸€ä¸ªè¿›ç¨‹(Process)ï¼ŒArgo å¯ä»¥é€šè¿‡å®ƒæ‰§è¡Œä¸€äº›åŠ¨ä½œï¼Œå¦‚ç›‘æ§ Pod æ—¥å¿—ã€æ”¶é›† Artifactsã€ç®¡ç†å®¹å™¨ç”Ÿå‘½å‘¨æœŸç­‰ç­‰â€¦ Workflow Executor æœ‰å¤šç§å®ç°ï¼Œå¯ä»¥é€šè¿‡å‰é¢æåˆ°çš„ configmap workflow-controller-configmap æ¥é€‰æ‹©ã€‚ å¯é€‰é¡¹å¦‚ä¸‹ï¼š docker(é»˜è®¤): ç›®å‰ä½¿ç”¨èŒƒå›´æœ€å¹¿ï¼Œä½†æ˜¯å®‰å…¨æ€§æœ€å·®ã€‚å®ƒè¦æ±‚ä¸€å®šè¦æŒ‚è½½è®¿é—® docker.sockï¼Œå› æ­¤ä¸€å®šè¦ root æƒé™ï¼ kubelet: åº”ç”¨éå¸¸å°‘ï¼Œç›®å‰åŠŸèƒ½ä¹Ÿæœ‰äº›æ¬ ç¼ºï¼Œç›®å‰ä¹Ÿå¿…é¡»æä¾› root æƒé™ Kubernetes API (k8sapi): ç›´æ¥é€šè¿‡è°ƒç”¨ k8sapi å®ç°æ—¥å¿—ç›‘æ§ã€Artifacts æ‰‹æœºç­‰åŠŸèƒ½ï¼Œéå¸¸å®‰å…¨ï¼Œä½†æ˜¯æ€§èƒ½æ¬ ä½³ã€‚ Process Namespace Sharing (pns): å®‰å…¨æ€§æ¯” k8sapi å·®ä¸€ç‚¹ï¼Œå› ä¸º Process å¯¹å…¶ä»–æ‰€æœ‰å®¹å™¨éƒ½å¯è§äº†ã€‚ä½†æ˜¯ç›¸å¯¹çš„æ€§èƒ½å¥½å¾ˆå¤šã€‚ åœ¨ docker è¢« kubernetes æŠ›å¼ƒçš„å½“ä¸‹ï¼Œå¦‚æœä½ å·²ç»æ”¹ç”¨ containerd åšä¸º kubernetes è¿è¡Œæ—¶ï¼Œé‚£ argo å°†ä¼šæ— æ³•å·¥ä½œï¼Œå› ä¸ºå®ƒé»˜è®¤ä½¿ç”¨ docker ä½œä¸ºè¿è¡Œæ—¶ï¼ æˆ‘ä»¬å»ºè®®å°† workflow executore æ”¹ä¸º pnsï¼Œå…¼é¡¾å®‰å…¨æ€§ä¸æ€§èƒ½ï¼Œworkflow-controller-configmap æŒ‰ç…§å¦‚ä¸‹æ–¹å¼ä¿®æ”¹ï¼š yaml apiVersion: v1 kind: ConfigMap metadata: name: workflow-controller-configmap data: config: | # ...çœç•¥è‹¥å¹²é…ç½®... # Specifies the container runtime interface to use (default: docker) # must be one of: docker, kubelet, k8sapi, pns containerRuntimeExecutor: pns # ... ","date":"2021-01-27","objectID":"/posts/experience-of-argo-workflows/:2:2","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿","Kubernetes"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/experience-of-argo-workflows/#workflow-executors"},{"categories":["tech"],"content":" ä¸‰ã€ä½¿ç”¨ Argo Workflows åš CI å·¥å…·å®˜æ–¹çš„ Reference è¿˜ç®—è¯¦ç»†ï¼Œä¹Ÿæœ‰æä¾›éå¸¸å¤šçš„ examples ä¾›æˆ‘ä»¬å‚è€ƒï¼Œè¿™é‡Œæä¾›æˆ‘ä»¬å‡ ä¸ªå¸¸ç”¨çš„ workflow å®šä¹‰ã€‚ ä½¿ç”¨ buildkit æ„å»ºé•œåƒï¼šhttps://github.com/argoproj/argo-workflows/blob/master/examples/buildkit-template.yaml buildkit æ”¯æŒç¼“å­˜ï¼Œå¯ä»¥åœ¨è¿™ä¸ª example çš„åŸºç¡€ä¸Šè‡ªå®šä¹‰å‚æ•° æ³¨æ„ä½¿ç”¨ PVC æ¥è·¨ step å…±äº«å­˜å‚¨ç©ºé—´è¿™ç§æ‰‹æ®µï¼Œé€Ÿåº¦ä¼šæ¯”é€šè¿‡ artifacts é«˜å¾ˆå¤šã€‚ ","date":"2021-01-27","objectID":"/posts/experience-of-argo-workflows/:3:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿","Kubernetes"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/experience-of-argo-workflows/#ä¸‰ä½¿ç”¨-argo-workflows-åš-ci-å·¥å…·"},{"categories":["tech"],"content":" å››ã€å¸¸è§é—®é¢˜","date":"2021-01-27","objectID":"/posts/experience-of-argo-workflows/:4:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿","Kubernetes"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/experience-of-argo-workflows/#å››å¸¸è§é—®é¢˜"},{"categories":["tech"],"content":" 1. workflow é»˜è®¤ä½¿ç”¨ root è´¦å·ï¼Ÿworkflow çš„æµç¨‹é»˜è®¤ä½¿ç”¨ root è´¦å·ï¼Œå¦‚æœä½ çš„é•œåƒé»˜è®¤ä½¿ç”¨é root è´¦å·ï¼Œè€Œä¸”è¦ä¿®æ”¹æ–‡ä»¶ï¼Œå°±å¾ˆå¯èƒ½é‡åˆ° Permission Denined çš„é—®é¢˜ã€‚ è§£å†³æ–¹æ³•ï¼šé€šè¿‡ Pod Security Context æ‰‹åŠ¨è®¾å®šå®¹å™¨çš„ user/group: Workflow Pod Security Context å®‰å…¨èµ·è§ï¼Œæˆ‘å»ºè®®æ‰€æœ‰çš„ workflow éƒ½æ‰‹åŠ¨è®¾å®š securityContextï¼Œç¤ºä¾‹ï¼š yaml apiVersion: argoproj.io/v1alpha1 kind: WorkflowTemplate metadata: name: xxx spec: securityContext: runAsNonRoot: true runAsUser: 1000 æˆ–è€…ä¹Ÿå¯ä»¥é€šè¿‡ workflow-controller-configmap çš„ workflowDefaults è®¾å®šé»˜è®¤çš„ workflow é…ç½®ã€‚ ","date":"2021-01-27","objectID":"/posts/experience-of-argo-workflows/:4:1","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿","Kubernetes"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/experience-of-argo-workflows/#1-workflow-é»˜è®¤ä½¿ç”¨-root-è´¦å·"},{"categories":["tech"],"content":" 2. å¦‚ä½•ä» hashicorp vault ä¸­è¯»å– secrets? å‚è€ƒSupport to get secrets from Vault hashicorp vault ç›®å‰å¯ä»¥è¯´æ˜¯äº‘åŸç”Ÿé¢†åŸŸæœ€å—æ¬¢è¿çš„ secrets ç®¡ç†å·¥å…·ã€‚æˆ‘ä»¬åœ¨ç”Ÿäº§ç¯å¢ƒç”¨å®ƒåšä¸ºåˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒï¼ŒåŒæ—¶åœ¨æœ¬åœ° CI/CD ä¸­ï¼Œä¹Ÿä½¿ç”¨å®ƒå­˜å‚¨ç›¸å…³çš„æ•æ„Ÿä¿¡æ¯ã€‚ ç°åœ¨è¿ç§»åˆ° argoï¼Œæˆ‘ä»¬å½“ç„¶å¸Œæœ›èƒ½å¤Ÿæœ‰ä¸€ä¸ªå¥½çš„æ–¹æ³•ä» vault ä¸­è¯»å–é…ç½®ã€‚ ç›®å‰æœ€æ¨èçš„æ–¹æ³•ï¼Œæ˜¯ä½¿ç”¨ vault çš„ vault-agentï¼Œå°† secrets ä»¥æ–‡ä»¶çš„å½¢å¼æ³¨å…¥åˆ° pod ä¸­ã€‚ é€šè¿‡ valut-policy - vault-role - k8s-serviceaccount ä¸€ç³»åˆ—è®¤è¯æˆæƒé…ç½®ï¼Œå¯ä»¥åˆ¶å®šéå¸¸ç»†ç²’åº¦çš„ secrets æƒé™è§„åˆ™ï¼Œè€Œä¸”é…ç½®ä¿¡æ¯é˜…åå³ç„šï¼Œå®‰å…¨æ€§å¾ˆé«˜ã€‚ ","date":"2021-01-27","objectID":"/posts/experience-of-argo-workflows/:4:2","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿","Kubernetes"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/experience-of-argo-workflows/#2-å¦‚ä½•ä»-hashicorp-vault-ä¸­è¯»å–-secrets"},{"categories":["tech"],"content":" 3. å¦‚ä½•åœ¨å¤šä¸ªåå­—ç©ºé—´ä¸­ä½¿ç”¨åŒä¸€ä¸ª secrets?ä½¿ç”¨ Namespace å¯¹ workflow è¿›è¡Œåˆ†ç±»æ—¶ï¼Œé‡åˆ°çš„ä¸€ä¸ªå¸¸è§é—®é¢˜å°±æ˜¯ï¼Œå¦‚ä½•åœ¨å¤šä¸ªåå­—ç©ºé—´ä½¿ç”¨private-git-creds/docker-config/minio/vault ç­‰ workflow å¿…è¦çš„ secrets. å¸¸è§çš„æ–¹æ³•æ˜¯æŠŠ secrets åœ¨æ‰€æœ‰åå­—ç©ºé—´ create ä¸€æ¬¡ã€‚ ä½†æ˜¯ä¹Ÿæœ‰æ›´æ–¹ä¾¿çš„ secrets åŒæ­¥å·¥å…·ï¼š æ¯”å¦‚ï¼Œä½¿ç”¨ kyverno è¿›è¡Œ secrets åŒæ­¥çš„é…ç½®ï¼š yaml apiVersion: kyverno.io/v1 kind: ClusterPolicy metadata: name: sync-secrets spec: background: false rules: # å°† secret vault ä» argo Namespace åŒæ­¥åˆ°å…¶ä»–æ‰€æœ‰ Namespace - name: sync-vault-secret match: resources: kinds: - Namespace generate: kind: Secret name: regcred namespace: \"{{request.object.metadata.name}}\" synchronize: true clone: namespace: argo name: vault # å¯ä»¥é…ç½®å¤šä¸ª rulesï¼Œæ¯ä¸ª rules åŒæ­¥ä¸€ä¸ª secret ä¸Šé¢æä¾›çš„ kyverno é…ç½®ï¼Œä¼šå®æ—¶åœ°ç›‘æ§æ‰€æœ‰ Namespace å˜æ›´ï¼Œä¸€ä½†æœ‰æ–° Namespace è¢«åˆ›å»ºï¼Œå®ƒå°±ä¼šç«‹å³å°† vault secret åŒæ­¥åˆ°è¯¥ Namespace. æˆ–è€…ï¼Œä½¿ç”¨ä¸“é—¨çš„ secrets/configmap å¤åˆ¶å·¥å…·ï¼škubernetes-replicator ","date":"2021-01-27","objectID":"/posts/experience-of-argo-workflows/:4:3","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿","Kubernetes"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/experience-of-argo-workflows/#3-å¦‚ä½•åœ¨å¤šä¸ªåå­—ç©ºé—´ä¸­ä½¿ç”¨åŒä¸€ä¸ª-secrets"},{"categories":["tech"],"content":" 4. Argo å¯¹ CR èµ„æºçš„éªŒè¯ä¸å¤Ÿä¸¥è°¨ï¼Œå†™é”™äº† key éƒ½ä¸æŠ¥é”™å¾…ç ”ç©¶ ","date":"2021-01-27","objectID":"/posts/experience-of-argo-workflows/:4:4","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿","Kubernetes"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/experience-of-argo-workflows/#4-argo-å¯¹-cr-èµ„æºçš„éªŒè¯ä¸å¤Ÿä¸¥è°¨å†™é”™äº†-key-éƒ½ä¸æŠ¥é”™"},{"categories":["tech"],"content":" 5. å¦‚ä½•å½’æ¡£å†å²æ•°æ®ï¼ŸArgo ç”¨çš„æ—¶é—´é•¿äº†ï¼Œè·‘è¿‡çš„ Workflows/Pods å…¨éƒ½ä¿å­˜åœ¨ Kubernetes/Argo Server ä¸­ï¼Œå¯¼è‡´ Argo è¶Šç”¨è¶Šæ…¢ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒArgo æä¾›äº†ä¸€äº›é…ç½®æ¥é™åˆ¶ Workflows å’Œ Pods çš„æ•°é‡ï¼Œè¯¦è§ï¼šLimit The Total Number Of Workflows And Pods è¿™äº›é™åˆ¶éƒ½æ˜¯ Workflow çš„å‚æ•°ï¼Œå¦‚æœå¸Œæœ›è®¾ç½®ä¸€ä¸ªå…¨å±€é»˜è®¤çš„é™åˆ¶ï¼Œå¯ä»¥æŒ‰ç…§å¦‚ä¸‹ç¤ºä¾‹ä¿®æ”¹ argo çš„workflow-controller-configmap è¿™ä¸ª configmap: yaml apiVersion: v1 kind: ConfigMap metadata: name: workflow-controller-configmap data: config: | # Default values that will apply to all Workflows from this controller, unless overridden on the Workflow-level # See more: docs/default-workflow-specs.md workflowDefaults: spec: # must complete in 8h (28,800 seconds) activeDeadlineSeconds: 28800 # keep workflows for 1d (86,400 seconds) ttlStrategy: secondsAfterCompletion: 86400 # secondsAfterSuccess: 5 # secondsAfterFailure: 500 # delete all pods as soon as they complete podGC: # å¯é€‰é¡¹ï¼š\"OnPodCompletion\", \"OnPodSuccess\", \"OnWorkflowCompletion\", \"OnWorkflowSuccess\" strategy: OnPodCompletion ","date":"2021-01-27","objectID":"/posts/experience-of-argo-workflows/:4:5","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿","Kubernetes"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/experience-of-argo-workflows/#5-å¦‚ä½•å½’æ¡£å†å²æ•°æ®"},{"categories":["tech"],"content":" 6. Argo çš„å…¶ä»–è¿›é˜¶é…ç½®Argo Workflows çš„é…ç½®ï¼Œéƒ½ä¿å­˜åœ¨ workflow-controller-configmap è¿™ä¸ª configmap ä¸­ï¼Œæˆ‘ä»¬å‰é¢å·²ç»æ¥è§¦åˆ°äº†å®ƒçš„éƒ¨åˆ†å†…å®¹ã€‚ è¿™é‡Œç»™å‡ºæ­¤é…ç½®æ–‡ä»¶çš„å®Œæ•´ examples:https://github.com/argoproj/argo-workflows/blob/master/docs/workflow-controller-configmap.yaml å…¶ä¸­ä¸€äº›å¯èƒ½éœ€è¦è‡ªå®šä¹‰çš„å‚æ•°å¦‚ä¸‹ï¼š parallelism: workflow çš„æœ€å¤§å¹¶è¡Œæ•°é‡ persistence: å°†å®Œæˆçš„ workflows ä¿å­˜åˆ° postgresql/mysql ä¸­ï¼Œè¿™æ ·å³ä½¿ k8s ä¸­çš„ workflow è¢«åˆ é™¤äº†ï¼Œè¿˜èƒ½æŸ¥çœ‹ workflow è®°å½• ä¹Ÿæ”¯æŒé…ç½®è¿‡æœŸæ—¶é—´ sso: å¯ç”¨å•ç‚¹ç™»å½• ","date":"2021-01-27","objectID":"/posts/experience-of-argo-workflows/:4:6","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿","Kubernetes"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/experience-of-argo-workflows/#6-argo-çš„å…¶ä»–è¿›é˜¶é…ç½®"},{"categories":["tech"],"content":" 7. æ˜¯å¦åº”è¯¥å°½é‡ä½¿ç”¨ CI/CD å·¥å…·æä¾›çš„åŠŸèƒ½ï¼Ÿæˆ‘ä»åŒäº‹ä»¥åŠç½‘ç»œä¸Šï¼Œäº†è§£åˆ°éƒ¨åˆ† DevOps äººå‘˜ä¸»å¼ å°½é‡è‡ªå·±ä½¿ç”¨ Python/Go æ¥å®ç° CI/CD æµæ°´çº¿ï¼ŒCI/CD å·¥å…·æä¾›çš„åŠŸèƒ½èƒ½ä¸ä½¿ç”¨å°±ä¸è¦ä½¿ç”¨ã€‚ å› æ­¤æœ‰æ­¤ä¸€é—®ã€‚ä¸‹é¢åšä¸‹è¯¦ç»†çš„åˆ†æï¼š å°½é‡ä½¿ç”¨ CI/CD å·¥å…·æä¾›çš„æ’ä»¶/åŠŸèƒ½ï¼Œå¥½å¤„æ˜¯ä¸éœ€è¦è‡ªå·±å»å®ç°ï¼Œå¯ä»¥é™ä½ç»´æŠ¤æˆæœ¬ã€‚ä½†æ˜¯ç›¸å¯¹çš„è¿ç»´äººå‘˜å°±éœ€è¦æ·±å…¥å­¦ä¹ è¿™ä¸ª CI/CD å·¥å…·çš„ä½¿ç”¨ï¼Œå¦å¤–è¿˜ä¼šå’Œ CI/CD å·¥å…·ç»‘å®šï¼Œä¼šå¢åŠ è¿ç§»éš¾åº¦ã€‚ è€Œå°½é‡è‡ªå·±ç”¨ Python ç­‰ä»£ç å»å®ç°æµæ°´çº¿ï¼Œè®© CI/CD å·¥å…·åªè´Ÿè´£è°ƒåº¦ä¸è¿è¡Œè¿™äº› Python ä»£ç ï¼Œé‚£ CI/CD å°±å¯ä»¥å¾ˆæ–¹ä¾¿åœ°éšä¾¿æ¢ï¼Œè¿ç»´äººå‘˜ä¹Ÿä¸éœ€è¦å»æ·±å…¥å­¦ä¹  CI/CD å·¥å…·çš„ä½¿ç”¨ã€‚ç¼ºç‚¹æ˜¯å¯èƒ½ä¼šå¢åŠ  CI/CD ä»£ç çš„å¤æ‚æ€§ã€‚ æˆ‘è§‚å¯Ÿåˆ° argo/drone çš„ä¸€äº› examplesï¼Œå‘ç°å®ƒä»¬çš„ç‰¹å¾æ˜¯ï¼š æ‰€æœ‰ CI/CD ç›¸å…³çš„é€»è¾‘ï¼Œå…¨éƒ½å®ç°åœ¨æµæ°´çº¿ä¸­ï¼Œä¸éœ€è¦å…¶ä»–æ„å»ºä»£ç  æ¯ä¸€ä¸ª step éƒ½ä½¿ç”¨ä¸“ç”¨é•œåƒï¼šgolang/nodejs/python æ¯”å¦‚å…ˆä½¿ç”¨ golang é•œåƒè¿›è¡Œæµ‹è¯•ã€æ„å»ºï¼Œå†ä½¿ç”¨ kaniko å°†æ‰“åŒ…æˆå®¹å™¨é•œåƒ é‚£æ˜¯å¦åº”è¯¥å°½é‡ä½¿ç”¨ CI/CD å·¥å…·æä¾›çš„åŠŸèƒ½å‘¢ï¼Ÿ å…¶å®è¿™å°±æ˜¯æœ‰å¤šç§æ–¹æ³•å®ç°åŒä¸€ä»¶äº‹ï¼Œè¯¥ç”¨å“ªç§æ–¹æ³•çš„é—®é¢˜ã€‚è¿™ä¸ªé—®é¢˜åœ¨å„ä¸ªé¢†åŸŸéƒ½å¾ˆå¸¸è§ã€‚ ä»¥æˆ‘ç›®å‰çš„ç»éªŒæ¥çœ‹ï¼Œéœ€è¦å…·ä½“é—®é¢˜å…·ä½“åˆ†æï¼Œä»¥ Argo Workflows ä¸ºä¾‹ï¼š æµæ°´çº¿æœ¬èº«éå¸¸ç®€å•ï¼Œé‚£å®Œå…¨å¯ä»¥ç›´æ¥ä½¿ç”¨ argo æ¥å®ç°ï¼Œæ²¡å¿…è¦è‡ªå·±å†æä¸ª python è„šæœ¬ ç®€å•çš„æµæ°´çº¿ï¼Œè¿ç§»èµ·æ¥å¾€å¾€ä¹Ÿéå¸¸ç®€å•ã€‚æ²¡å¿…è¦ä¸ºäº†å¯è¿ç§»æ€§ï¼Œéè¦ç”¨ argo å»è°ƒç”¨ python è„šæœ¬ã€‚ æµæ°´çº¿çš„æ­¥éª¤ä¹‹é—´åŒ…å«å¾ˆå¤šé€»è¾‘åˆ¤æ–­/æ•°æ®ä¼ é€’ï¼Œé‚£å¾ˆå¯èƒ½æ˜¯ä½ çš„æµæ°´çº¿è®¾è®¡æœ‰é—®é¢˜ï¼ æµæ°´çº¿çš„æ­¥éª¤ä¹‹é—´ä¼ é€’çš„æ•°æ®åº”è¯¥å°½å¯èƒ½å°‘ï¼å¤æ‚çš„é€»è¾‘åˆ¤æ–­åº”è¯¥å°½é‡å°è£…åœ¨å…¶ä¸­ä¸€ä¸ªæ­¥éª¤ä¸­ï¼ è¿™ç§æƒ…å†µä¸‹ï¼Œå°±åº”è¯¥ä½¿ç”¨ python è„šæœ¬æ¥å°è£…å¤æ‚çš„é€»è¾‘ï¼Œè€Œä¸åº”è¯¥å°†è¿™äº›é€»è¾‘æš´éœ²åˆ° Argo Workflows ä¸­ï¼ æˆ‘éœ€è¦æ‰¹é‡è¿è¡Œå¾ˆå¤šçš„æµæ°´çº¿ï¼Œè€Œä¸”å®ƒä»¬ä¹‹é—´è¿˜æœ‰å¤æ‚çš„ä¾èµ–å…³ç³»ï¼šé‚£æ˜¾ç„¶åº”è¯¥åˆ©ç”¨ä¸Š argo workflow çš„é«˜çº§ç‰¹æ€§ã€‚ argo çš„ dag/steps å’Œ workflow of workflows è¿™ä¸¤ä¸ªåŠŸèƒ½ç»“åˆï¼Œå¯ä»¥ç®€å•åœ°å®ç°ä¸Šè¿°åŠŸèƒ½ã€‚ ","date":"2021-01-27","objectID":"/posts/experience-of-argo-workflows/:4:7","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿","Kubernetes"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/experience-of-argo-workflows/#7-æ˜¯å¦åº”è¯¥å°½é‡ä½¿ç”¨-cicd-å·¥å…·æä¾›çš„åŠŸèƒ½"},{"categories":["tech"],"content":" 8. å¦‚ä½•æå‡ Argo Workflows çš„åˆ›å»ºå’Œé”€æ¯é€Ÿåº¦ï¼Ÿæˆ‘ä»¬å‘ç° workflow çš„ podï¼Œåˆ›å»ºå’Œé”€æ¯æ¶ˆè€—äº†å¤§é‡æ—¶é—´ï¼Œå°¤å…¶æ˜¯é”€æ¯ã€‚è¿™å¯¼è‡´æˆ‘ä»¬å•ä¸ªæµæ°´çº¿åœ¨ argo ä¸Šè·‘ï¼Œè¿˜æ²¡åœ¨ jenkins ä¸Šè·‘æ›´å¿«ã€‚ ","date":"2021-01-27","objectID":"/posts/experience-of-argo-workflows/:5:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿","Kubernetes"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/experience-of-argo-workflows/#8-å¦‚ä½•æå‡-argo-workflows-çš„åˆ›å»ºå’Œé”€æ¯é€Ÿåº¦"},{"categories":["tech"],"content":" ä½¿ç”¨ä½“éªŒç›®å‰å·²ç»ä½¿ç”¨ Argo Workflows ä¸€ä¸ªæœˆå¤šäº†ï¼Œæ€»çš„æ¥è¯´ï¼Œæœ€éš¾ç”¨çš„å°±æ˜¯ Web UIã€‚ å…¶ä»–çš„éƒ½æ˜¯å°é—®é¢˜ï¼Œåªæœ‰ Web UI æ˜¯çœŸçš„è¶…éš¾ç”¨ï¼Œæ„Ÿè§‰æ ¹æœ¬å°±æ²¡æœ‰å¥½å¥½åšè¿‡è®¾è®¡â€¦ æ€¥éœ€ä¸€ä¸ªç¬¬ä¸‰æ–¹ Web UIâ€¦ ","date":"2021-01-27","objectID":"/posts/experience-of-argo-workflows/:6:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿","Kubernetes"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/experience-of-argo-workflows/#ä½¿ç”¨ä½“éªŒ"},{"categories":["tech"],"content":" ç”»å¤– - å¦‚ä½•å¤„ç†å…¶ä»– Kubernetes èµ„æºä¹‹é—´çš„ä¾èµ–å…³ç³»Argo ç›¸æ¯”å…¶ä»– CI å·¥å…·ï¼Œæœ€å¤§çš„ç‰¹ç‚¹ï¼Œæ˜¯å®ƒå‡è®¾ã€Œä»»åŠ¡ã€ä¹‹é—´æ˜¯æœ‰ä¾èµ–å…³ç³»çš„ï¼Œå› æ­¤å®ƒæä¾›äº†å¤šç§åè°ƒç¼–æ’ã€Œä»»åŠ¡ã€çš„æ–¹æ³•ã€‚ ä½†æ˜¯è²Œä¼¼ Argo CD å¹¶æ²¡æœ‰ç»§æ‰¿è¿™ä¸ªç†å¿µï¼ŒArgo CD éƒ¨ç½²æ—¶ï¼Œå¹¶ä¸èƒ½åœ¨ kubernetes èµ„æºä¹‹é—´ï¼Œé€šè¿‡ DAG ç­‰æ–¹æ³•å®šä¹‰ä¾èµ–å…³ç³»ã€‚ å¾®æœåŠ¡ä¹‹é—´å­˜åœ¨ä¾èµ–å…³ç³»ï¼Œå¸Œæœ›èƒ½æŒ‰ä¾èµ–å…³ç³»è¿›è¡Œéƒ¨ç½²ï¼Œè€Œ ArgoCD/FluxCD éƒ¨ç½² kubernetes yaml æ—¶éƒ½æ˜¯ä¸è€ƒè™‘ä»»ä½•ä¾èµ–å…³ç³»çš„ã€‚è¿™é‡Œå°±å­˜åœ¨ä¸€äº›çŸ›ç›¾ã€‚ è§£å†³è¿™ä¸ªçŸ›ç›¾çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œæˆ‘æŸ¥é˜…äº†å¾ˆå¤šèµ„æ–™ï¼Œä¹Ÿè‡ªå·±åšäº†ä¸€äº›æ€è€ƒï¼Œå¾—åˆ°çš„æœ€ä½³å®è·µæ¥è‡ªè§£å†³æœåŠ¡ä¾èµ– - é˜¿é‡Œäº‘ ACK å®¹å™¨æœåŠ¡ï¼Œå®ƒç»™å‡ºäº†ä¸¤ç§æ–¹æ¡ˆï¼š åº”ç”¨ç«¯æœåŠ¡ä¾èµ–æ£€æŸ¥: å³åœ¨å¾®æœåŠ¡çš„å…¥å£æ·»åŠ ä¾èµ–æ£€æŸ¥é€»è¾‘ï¼Œç¡®ä¿æ‰€æœ‰ä¾èµ–çš„å¾®æœåŠ¡/æ•°æ®åº“éƒ½å¯è®¿é—®äº†ï¼Œå°±ç»­æ¢é’ˆæ‰èƒ½è¿”å› 200. å¦‚æœè¶…æ—¶å°±ç›´æ¥ Crash ç‹¬ç«‹çš„æœåŠ¡ä¾èµ–æ£€æŸ¥é€»è¾‘: éƒ¨åˆ†é—ç•™ä»£ç ä½¿ç”¨æ–¹æ³•ä¸€æ”¹é€ èµ·æ¥æˆ–è®¸ä¼šå¾ˆå›°éš¾ï¼Œè¿™æ—¶å¯ä»¥è€ƒè™‘ä½¿ç”¨ pod initContainer æˆ–è€…å®¹å™¨çš„å¯åŠ¨è„šæœ¬ä¸­ï¼ŒåŠ å…¥ä¾èµ–æ£€æŸ¥é€»è¾‘ã€‚ ä½†æ˜¯è¿™ä¸¤ä¸ªæ–¹æ¡ˆä¹Ÿè¿˜æ˜¯å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œåœ¨è¯´æ˜é—®é¢˜å‰ï¼Œæˆ‘å…ˆè¯´æ˜ä¸€ä¸‹æˆ‘ä»¬ã€ŒæŒ‰åºéƒ¨ç½²ã€çš„åº”ç”¨åœºæ™¯ã€‚ æˆ‘ä»¬æ˜¯ä¸€ä¸ªå¾ˆå°çš„å›¢é˜Ÿï¼Œåç«¯åš RPC æ¥å£å‡çº§æ—¶ï¼Œé€šå¸¸æ˜¯ç›´æ¥åœ¨å¼€å‘ç¯å¢ƒåšå…¨é‡å‡çº§+æµ‹è¯•ã€‚å› æ­¤è¿ç»´è¿™è¾¹ä¹Ÿæ˜¯ï¼Œæ¯æ¬¡éƒ½æ˜¯åšå…¨é‡å‡çº§ã€‚ å› ä¸ºæ²¡æœ‰åè®®åå•†æœºåˆ¶ï¼Œæ–°çš„å¾®æœåŠ¡çš„ã€ŒRPC æœåŠ¡ç«¯ã€å°†å…¼å®¹ v1 v2 æ–°æ—§ä¸¤ç§åè®®ï¼Œè€Œæ–°çš„ã€ŒRPC å®¢æˆ·ç«¯ã€å°†ç›´æ¥ä½¿ç”¨ v2 åè®®å»è¯·æ±‚å…¶ä»–å¾®æœåŠ¡ã€‚è¿™å°±å¯¼è‡´æˆ‘ä»¬å¿…é¡»å…ˆå‡çº§ã€ŒRPC æœåŠ¡ç«¯ã€ï¼Œç„¶åæ‰èƒ½å‡çº§ã€ŒRPC å®¢æˆ·ç«¯ã€ã€‚ ä¸ºæ­¤ï¼Œåœ¨è¿›è¡Œå¾®æœåŠ¡çš„å…¨é‡å‡çº§æ—¶ï¼Œå°±éœ€è¦æ²¿ç€ RPC è°ƒç”¨é“¾è·¯æŒ‰åºå‡çº§ï¼Œè¿™é‡Œå°±æ¶‰åŠåˆ°äº† Kubernetes èµ„æºä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚ æˆ‘ç›®å‰è·çŸ¥çš„å…³é”®é—®é¢˜åœ¨äºï¼šæˆ‘ä»¬ä½¿ç”¨çš„å¹¶ä¸æ˜¯çœŸæ­£çš„å¾®æœåŠ¡å¼€å‘æ¨¡å¼ï¼Œè€Œæ˜¯åœ¨æŠŠæ•´ä¸ªå¾®æœåŠ¡ç³»ç»Ÿå½“æˆä¸€ä¸ªã€Œå•ä½“æœåŠ¡ã€åœ¨çœ‹å¾…ï¼Œæ‰€ä»¥å¼•ç”³å‡ºäº†è¿™æ ·çš„ä¾èµ–å…³é”®çš„é—®é¢˜ã€‚æˆ‘è¿›å…¥çš„æ–°å…¬å¸å®Œå…¨æ²¡æœ‰è¿™æ ·çš„é—®é¢˜ï¼Œæ‰€æœ‰çš„æœåŠ¡ä¹‹é—´åœ¨ CI/CD è¿™ä¸ªé˜¶æ®µéƒ½æ˜¯è§£è€¦çš„ï¼ŒCI/CD ä¸éœ€è¦è€ƒè™‘æœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œä¹Ÿæ²¡æœ‰è‡ªåŠ¨æŒ‰ç…§ä¾èµ–å…³ç³»è¿›è¡Œå¾®æœåŠ¡æ‰¹é‡å‘å¸ƒçš„åŠŸèƒ½ï¼Œè¿™äº›éƒ½ç”±å¼€å‘äººå‘˜è‡ªè¡Œç»´æŠ¤ã€‚æˆ–è®¸è¿™æ‰æ˜¯æ­£ç¡®çš„ä½¿ç”¨å§¿åŠ¿ï¼Œå¦‚æœåŠ¨ä¸åŠ¨å°±è¦æ‰¹é‡æ›´æ–°ä¸€å¤§æ‰¹æœåŠ¡ï¼Œé‚£å¾®æœåŠ¡ä½“ç³»çš„è®¾è®¡ã€æ‹†åˆ†è‚¯å®šæ˜¯æœ‰é—®é¢˜äº†ï¼Œç”Ÿäº§ç¯å¢ƒä¹Ÿä¸ä¼šå…è®¸è¿™ä¹ˆè½»ç‡çš„æ›´æ–°ã€‚ å‰é¢è®²äº†ï¼Œé˜¿é‡Œäº‘æä¾›çš„ã€Œåº”ç”¨ç«¯æœåŠ¡ä¾èµ–æ£€æŸ¥ã€å’Œã€Œç‹¬ç«‹çš„æœåŠ¡ä¾èµ–æ£€æŸ¥é€»è¾‘ã€æ˜¯æœ€ä½³å®è·µã€‚å®ƒä»¬çš„ä¼˜ç‚¹æœ‰ï¼š ç®€åŒ–éƒ¨ç½²é€»è¾‘ï¼Œæ¯æ¬¡ç›´æ¥åšå…¨é‡éƒ¨ç½²å°± OKã€‚ æå‡éƒ¨ç½²é€Ÿåº¦ï¼Œå…·ä½“ä½“ç°åœ¨ï¼šGitOps éƒ¨ç½²æµç¨‹åªéœ€è¦èµ°ä¸€æ¬¡ï¼ˆæŒ‰åºéƒ¨ç½²è¦å¾ˆå¤šæ¬¡ï¼‰ã€æ‰€æœ‰é•œåƒéƒ½æå‰æ‹‰å–å¥½äº†ã€æ‰€æœ‰ Pod ä¹Ÿéƒ½æå‰å¯åŠ¨äº†ã€‚ ä½†æ˜¯è¿™é‡Œæœ‰ä¸ªé—®é¢˜æ˜¯ã€Œç°åº¦å‘å¸ƒã€æˆ–è€…ã€Œæ»šåŠ¨æ›´æ–°ã€ï¼Œè¿™ä¸¤ç§æƒ…å†µä¸‹éƒ½å­˜åœ¨æ–°æ—§ç‰ˆæœ¬å…±å­˜çš„é—®é¢˜ã€‚ å¦‚æœå‡ºç°äº† RPC æ¥å£å‡çº§ï¼Œé‚£å°±å¿…é¡»å…ˆå®Œæˆã€ŒRPC æœåŠ¡ç«¯ã€çš„ã€Œç°åº¦å‘å¸ƒã€æˆ–è€…ã€Œæ»šåŠ¨æ›´æ–°ã€ï¼Œå†å»æ›´æ–°ã€ŒRPC å®¢æˆ·ç«¯ã€ã€‚ å¦åˆ™å¦‚æœç›´æ¥å¯¹æ‰€æœ‰å¾®æœåŠ¡åšç°åº¦æ›´æ–°ï¼Œåªä¾é ã€ŒæœåŠ¡ä¾èµ–æ£€æŸ¥ã€ï¼Œå°±ä¼šå‡ºç°è¿™æ ·çš„é—®é¢˜â€”â€”ã€ŒRPC æœåŠ¡ç«¯ã€å¤„äºã€Œè–›å®šè°”ã€çŠ¶æ€ï¼Œä½ è°ƒç”¨åˆ°çš„æœåŠ¡ç«¯ç‰ˆæœ¬æ˜¯æ–°è¿˜æ˜¯æ—§ï¼Œå–å†³äºè´Ÿè½½å‡è¡¡çš„ç­–ç•¥å’Œæ¦‚ç‡ã€‚ å› æ­¤åœ¨åš RPC æ¥å£çš„å…¨é‡å‡çº§æ—¶ï¼Œåªä¾é ã€ŒæœåŠ¡ä¾èµ–æ£€æŸ¥ã€æ˜¯è¡Œä¸é€šçš„ã€‚æˆ‘ç›®å‰æƒ³åˆ°çš„æ–¹æ¡ˆï¼Œæœ‰å¦‚ä¸‹å‡ ç§ï¼š æˆ‘ä»¬å½“å‰çš„ä½¿ç”¨æ–¹æ¡ˆï¼šç›´æ¥åœ¨ yaml éƒ¨ç½²è¿™ä¸€æ­¥å®ç°æŒ‰åºéƒ¨ç½²ï¼Œæ¯æ¬¡éƒ¨ç½²åå°±è½®è¯¢ kube-apiserverï¼Œç¡®è®¤å…¨éƒ¨ç°åº¦å®Œæˆï¼Œå†è¿›è¡Œä¸‹ä¸€é˜¶æ®µçš„ yaml éƒ¨ç½²ã€‚ è®©åç«¯åŠ ä¸ªå‚æ•°æ¥æ§åˆ¶å®¢æˆ·ç«¯ä½¿ç”¨çš„ RPC åè®®ç‰ˆæœ¬ï¼Œæˆ–è€…æä¸€ä¸ªåè®®åå•†ã€‚è¿™æ ·å°±ä¸éœ€è¦æ§åˆ¶å¾®æœåŠ¡å‘å¸ƒé¡ºåºäº†ã€‚ ç¤¾åŒºå¾ˆå¤šæœ‰çŠ¶æ€åº”ç”¨çš„éƒ¨ç½²éƒ½æ¶‰åŠåˆ°éƒ¨ç½²é¡ºåºç­‰å¤æ‚æ“ä½œï¼Œç›®å‰æµè¡Œçš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨ Operator+CRD æ¥å®ç°è¿™ç±»åº”ç”¨çš„éƒ¨ç½²ã€‚Operator ä¼šè‡ªè¡Œå¤„ç†å¥½å„ä¸ªç»„ä»¶çš„éƒ¨ç½²é¡ºåºã€‚ ","date":"2021-01-27","objectID":"/posts/experience-of-argo-workflows/:7:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿","Kubernetes"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/experience-of-argo-workflows/#ç”»å¤–---å¦‚ä½•å¤„ç†å…¶ä»–-kubernetes-èµ„æºä¹‹é—´çš„ä¾èµ–å…³ç³»"},{"categories":["tech"],"content":" å‚è€ƒæ–‡æ¡£ ArgoåŠ å…¥CNCFå­µåŒ–å™¨ï¼Œä¸€æ–‡è§£æKubernetesåŸç”Ÿå·¥ä½œæµ è§†é¢‘: How to Multiply the Power of Argo Projects By Using Them Together - Hong Wang ","date":"2021-01-27","objectID":"/posts/experience-of-argo-workflows/:8:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["äº‘åŸç”Ÿ","CI","æŒç»­é›†æˆ","æµæ°´çº¿","Kubernetes"],"title":"äº‘åŸç”Ÿæµæ°´çº¿ Argo Workflows çš„å®‰è£…ã€ä½¿ç”¨ä»¥åŠä¸ªäººä½“éªŒ","uri":"/posts/experience-of-argo-workflows/#å‚è€ƒæ–‡æ¡£"},{"categories":["tech"],"content":"Vault æ˜¯ hashicorp æ¨å‡ºçš„ secrets ç®¡ç†ã€åŠ å¯†å³æœåŠ¡ä¸æƒé™ç®¡ç†å·¥å…·ã€‚å®ƒçš„åŠŸèƒ½ç®€ä»‹å¦‚ä¸‹ï¼š secrets ç®¡ç†ï¼šæ”¯æŒä¿å­˜å„ç§è‡ªå®šä¹‰ä¿¡æ¯ã€è‡ªåŠ¨ç”Ÿæˆå„ç±»å¯†é’¥ï¼Œvault è‡ªåŠ¨ç”Ÿæˆçš„å¯†é’¥è¿˜èƒ½è‡ªåŠ¨è½®è½¬(rotate) è®¤è¯æ–¹å¼ï¼šæ”¯æŒæ¥å…¥å„å¤§äº‘å‚å•†çš„è´¦å·ä½“ç³»ï¼ˆæ¯”å¦‚é˜¿é‡Œäº‘RAMå­è´¦å·ä½“ç³»ï¼‰æˆ–è€… LDAP ç­‰è¿›è¡Œèº«ä»½éªŒè¯ï¼Œä¸éœ€è¦åˆ›å»ºé¢å¤–çš„è´¦å·ä½“ç³»ã€‚ æƒé™ç®¡ç†ï¼šé€šè¿‡ policyï¼Œå¯ä»¥è®¾å®šéå¸¸ç»†è‡´çš„ ACL æƒé™ã€‚ å¯†é’¥å¼•æ“ï¼šä¹Ÿæ”¯æŒæ¥ç®¡å„å¤§äº‘å‚å•†çš„è´¦å·ä½“ç³»ï¼ˆæ¯”å¦‚é˜¿é‡Œäº‘RAMå­è´¦å·ä½“ç³»ï¼‰ï¼Œå®ç° API Key çš„è‡ªåŠ¨è½®è½¬ã€‚ æ”¯æŒæ¥å…¥ kubernetes rbac è®¤è¯ä½“ç³»ï¼Œé€šè¿‡ serviceaccount+role ä¸ºæ¯ä¸ª Pod å•ç‹¬é…ç½®è®¤è¯è§’è‰²ã€‚ æ”¯æŒé€šè¿‡ sidecar/init-container å°† secrets æ³¨å…¥åˆ° pod ä¸­ï¼Œæˆ–è€…é€šè¿‡ k8s operator å°† vault æ•°æ®åŒæ­¥åˆ° k8s secrets ä¸­ åœ¨ä½¿ç”¨ Vault ä¹‹å‰ï¼Œæˆ‘ä»¬æ˜¯ä»¥æºç¨‹å¼€æºçš„ Apollo ä½œä¸ºå¾®æœåŠ¡çš„åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒã€‚ Apollo åœ¨å›½å†…éå¸¸æµè¡Œã€‚å®ƒåŠŸèƒ½å¼ºå¤§ï¼Œæ”¯æŒé…ç½®çš„ç»§æ‰¿ï¼Œä¹Ÿæœ‰æä¾› HTTP API æ–¹ä¾¿è‡ªåŠ¨åŒ–ã€‚ç¼ºç‚¹æ˜¯æƒé™ç®¡ç†å’Œ secrets ç®¡ç†æ¯”è¾ƒå¼±ï¼Œä¹Ÿä¸æ”¯æŒä¿¡æ¯åŠ å¯†ï¼Œä¸é€‚åˆç›´æ¥å­˜å‚¨æ•æ„Ÿä¿¡æ¯ã€‚å› æ­¤æˆ‘ä»¬ç°åœ¨åˆ‡æ¢åˆ°äº† Vault. ç›®å‰æˆ‘ä»¬æœ¬åœ°çš„ CI/CD æµæ°´çº¿å’Œäº‘ä¸Šçš„å¾®æœåŠ¡ä½“ç³»ï¼Œéƒ½æ˜¯ä½¿ç”¨çš„ Vault åš secrets ç®¡ç†. ","date":"2021-01-24","objectID":"/posts/experience-of-vault/:0:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/experience-of-vault/#"},{"categories":["tech"],"content":" ä¸€ã€Vault åŸºç¡€æ¦‚å¿µ ã€ŒåŸºæœ¬æ¦‚å¿µã€è¿™ä¸€èŠ‚ï¼ŒåŸºæœ¬éƒ½ç¿»è¯‘è‡ªå®˜æ–¹æ–‡æ¡£:https://www.vaultproject.io/docs/internals/architecture é¦–å…ˆçœ‹ä¸€ä¸‹ Vault çš„æ¶æ„å›¾ï¼š vault layers å¯ä»¥çœ‹åˆ°ï¼Œå‡ ä¹æ‰€æœ‰çš„ Vault ç»„ä»¶éƒ½è¢«ç»Ÿç§°ä¸ºã€Œå±éšœï¼ˆBarrierï¼‰ã€ã€‚ Vault å¯ä»¥ç®€å•åœ°è¢«åˆ’åˆ†ä¸ºå­˜å‚¨åç«¯ï¼ˆStorage Backendï¼‰ã€å±éšœï¼ˆBarrierï¼‰å’Œ HTTP/S API ä¸‰ä¸ªéƒ¨åˆ†ã€‚ Vaultï¼Œç¿»è¯‘æˆä¸­æ–‡å°±æ˜¯é‡‘åº“ã€‚ç±»æ¯”é“¶è¡Œé‡‘åº“ï¼Œã€Œå±éšœã€å°±æ˜¯ç”¨äºä¿æŠ¤é‡‘åº“çš„åˆé‡‘å¤§é—¨å’Œé’¢ç­‹æ··å‡åœŸï¼Œå­˜å‚¨åç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„æ‰€æœ‰æ•°æ®æµåŠ¨éƒ½éœ€è¦ç»è¿‡å®ƒã€‚ ã€Œå±éšœã€ç¡®ä¿åªæœ‰åŠ å¯†æ•°æ®ä¼šè¢«å†™å…¥å­˜å‚¨åç«¯ï¼ŒåŠ å¯†æ•°æ®åœ¨ç»è¿‡ã€Œå±éšœã€è¢«è¯»å‡ºçš„è¿‡ç¨‹ä¸­è¢«éªŒè¯ä¸è§£å¯†ã€‚ å’Œé“¶è¡Œé‡‘åº“çš„å¤§é—¨éå¸¸ç±»ä¼¼ï¼Œã€Œå±éšœã€ä¹Ÿå¿…é¡»å…ˆè§£å°ï¼Œæ‰èƒ½è§£å¯†å­˜å‚¨åç«¯ä¸­çš„æ•°æ®ã€‚ ","date":"2021-01-24","objectID":"/posts/experience-of-vault/:1:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/experience-of-vault/#ä¸€vault-åŸºç¡€æ¦‚å¿µ"},{"categories":["tech"],"content":" 1. æ•°æ®å­˜å‚¨åŠåŠ å¯†è§£å¯†å­˜å‚¨åç«¯ï¼ˆStorage Backendï¼‰: Vault è‡ªèº«ä¸å­˜å‚¨æ•°æ®ï¼Œå› æ­¤éœ€è¦ä¸ºå®ƒé…ç½®ä¸€ä¸ªå­˜å‚¨åç«¯ã€‚å­˜å‚¨åç«¯æ˜¯ä¸å—ä¿¡ä»»çš„ï¼Œåªç”¨äºå­˜å‚¨åŠ å¯†æ•°æ®ã€‚ åˆå§‹åŒ–ï¼ˆInitializationï¼‰: Vault åœ¨é¦–æ¬¡å¯åŠ¨æ—¶éœ€è¦åˆå§‹åŒ–ï¼Œè¿™ä¸€æ­¥ç”Ÿæˆä¸€ä¸ªåŠ å¯†å¯†é’¥ï¼ˆEncryption Keyï¼‰ç”¨äºåŠ å¯†æ•°æ®ï¼ŒåŠ å¯†å®Œæˆçš„æ•°æ®æ‰èƒ½è¢«ä¿å­˜åˆ°å­˜å‚¨åç«¯ã€‚ è§£å°ï¼ˆUnsealï¼‰: Vault å¯åŠ¨åï¼Œå› ä¸ºä¸çŸ¥é“åŠ å¯†å¯†é’¥æ‰€ä»¥æ— æ³•è§£å¯†æ•°æ®ï¼Œè¿™ç§çŠ¶æ€è¢«å½¢è±¡å¾—ç§°ä½œå·²å°å°ï¼ˆSealedï¼‰ã€‚åœ¨è§£å°å‰ Vault æ— æ³•è¿›è¡Œä»»ä½•æ“ä½œã€‚ åŠ å¯†å¯†é’¥è¢«ä¸»å¯†é’¥ï¼ˆMaster Keyï¼‰ä¿æŠ¤ï¼Œæˆ‘ä»¬å¿…é¡»æä¾›ä¸»å¯†é’¥æ‰èƒ½è§£å¯†å‡º Vault çš„åŠ å¯†å¯†é’¥ï¼Œä»è€Œå®Œæˆè§£å°æ“ä½œã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒVault ä½¿ç”¨æ²™ç±³å°”å¯†é’¥åˆ†å‰²ç®—æ³• å°†ä¸»å¯†é’¥åˆ†å‰²æˆäº”ä¸ªåˆ†å‰²å¯†é’¥ï¼ˆKey Sharesï¼‰ï¼Œå¿…é¡»è¦æä¾›å…¶ä¸­ä»»æ„ä¸‰ä¸ªåˆ†å‰²å¯†é’¥æ‰èƒ½é‡å»ºå‡ºä¸»å¯†é’¥ï¼Œå®Œæˆè§£å°æ“ä½œã€‚ vault-shamir-secret-sharing åˆ†å‰²å¯†é’¥çš„æ€»æ•°ï¼Œä»¥åŠé‡å»ºä¸»å¯†é’¥æœ€å°‘éœ€è¦çš„åˆ†å‰²å¯†é’¥æ•°é‡ï¼Œéƒ½æ˜¯å¯ä»¥è°ƒæ•´çš„ã€‚æ²™ç±³å°”å¯†é’¥åˆ†å‰²ç®—æ³•ä¹Ÿå¯ä»¥å…³é—­ï¼Œè¿™æ ·ä¸»å¯†é’¥å°†è¢«ç›´æ¥æä¾›ç»™ç®¡ç†å‘˜ï¼Œç®¡ç†å‘˜å¯ç›´æ¥ä½¿ç”¨å®ƒè¿›è¡Œè§£å°æ“ä½œã€‚ ","date":"2021-01-24","objectID":"/posts/experience-of-vault/:1:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/experience-of-vault/#1-æ•°æ®å­˜å‚¨åŠåŠ å¯†è§£å¯†"},{"categories":["tech"],"content":" 2. è®¤è¯ç³»ç»ŸåŠæƒé™ç³»ç»Ÿåœ¨è§£å°å®Œæˆåï¼ŒVault å°±å¯ä»¥å¼€å§‹å¤„ç†è¯·æ±‚äº†ã€‚ HTTP è¯·æ±‚è¿›å…¥åçš„æ•´ä¸ªå¤„ç†æµç¨‹éƒ½ç”± vault core ç®¡ç†ï¼Œcore ä¼šå¼ºåˆ¶è¿›è¡Œ ACL æ£€æŸ¥ï¼Œå¹¶ç¡®ä¿å®¡è®¡æ—¥å¿—(audit logging)å®Œæˆè®°å½•ã€‚ å®¢æˆ·ç«¯é¦–æ¬¡è¿æ¥ vault æ—¶ï¼Œéœ€è¦å…ˆå®Œæˆèº«ä»½è®¤è¯ï¼Œvault çš„ auth methods æ¨¡å—æœ‰å¾ˆå¤šèº«ä»½è®¤è¯æ–¹æ³•å¯é€‰ï¼š ç”¨æˆ·å‹å¥½çš„è®¤è¯æ–¹æ³•ï¼Œé€‚åˆç®¡ç†å‘˜ä½¿ç”¨ï¼šusername/passwordã€äº‘æœåŠ¡å•†ã€ldap åœ¨åˆ›å»º user çš„æ—¶å€™ï¼Œéœ€è¦ä¸º user ç»‘å®š policyï¼Œç»™äºˆåˆé€‚çš„æƒé™ã€‚ åº”ç”¨å‹å¥½çš„æ–¹æ³•ï¼Œé€‚åˆåº”ç”¨ç¨‹åºä½¿ç”¨ï¼špublic/private keysã€tokensã€kubernetesã€jwt èº«ä»½éªŒè¯è¯·æ±‚æµç» core å¹¶è¿›å…¥ auth methodsï¼Œauth methods ç¡®å®šè¯·æ±‚æ˜¯å¦æœ‰æ•ˆå¹¶è¿”å›ã€Œå…³è”ç­–ç•¥(policies)ã€çš„åˆ—è¡¨ã€‚ ACL ç­–ç•¥ç”± policy store è´Ÿè´£ç®¡ç†ä¸å­˜å‚¨ï¼Œç”± core è¿›è¡Œ ACL æ£€æŸ¥ã€‚ACL çš„é»˜è®¤è¡Œä¸ºæ˜¯æ‹’ç»ï¼Œè¿™æ„å‘³ç€é™¤éæ˜ç¡®é…ç½® policy å…è®¸æŸé¡¹æ“ä½œï¼Œå¦åˆ™è¯¥æ“ä½œå°†è¢«æ‹’ç»ã€‚ åœ¨é€šè¿‡ auth methods å®Œæˆäº†èº«ä»½è®¤è¯ï¼Œå¹¶ä¸”è¿”å›çš„å…³è”ç­–ç•¥ä¹Ÿæ²¡æ¯›ç—…ä¹‹åï¼Œtoken store å°†ä¼šç”Ÿæˆå¹¶ç®¡ç†ä¸€ä¸ªæ–°çš„å‡­è¯ï¼ˆtokenï¼‰ï¼Œè¿™ä¸ª token ä¼šè¢«è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œç”¨äºè¿›è¡Œåç»­è¯·æ±‚ã€‚ ç±»ä¼¼ web ç½‘ç«™çš„ cookieï¼Œtoken ä¹Ÿéƒ½å­˜åœ¨ä¸€ä¸ªç§ŸæœŸï¼ˆleaseï¼‰æˆ–è€…è¯´æœ‰æ•ˆæœŸï¼Œè¿™åŠ å¼ºäº†å®‰å…¨æ€§ã€‚ token å…³è”äº†ç›¸å…³çš„ç­–ç•¥ policiesï¼Œè¿™äº›ç­–ç•¥å°†è¢«ç”¨äºéªŒè¯è¯·æ±‚çš„æƒé™ã€‚ è¯·æ±‚ç»è¿‡éªŒè¯åï¼Œå°†è¢«è·¯ç”±åˆ° secret engineã€‚å¦‚æœ secret engine è¿”å›äº†ä¸€ä¸ªsecretï¼ˆç”± vault è‡ªåŠ¨ç”Ÿæˆçš„ secretï¼‰ï¼Œcore ä¼šå°†å…¶æ³¨å†Œåˆ° expiration managerï¼Œå¹¶ç»™å®ƒé™„åŠ ä¸€ä¸ª lease IDã€‚lease ID è¢«å®¢æˆ·ç«¯ç”¨äºæ›´æ–°(renew)æˆ–åŠé”€(revoke)å®ƒå¾—åˆ°çš„ secret. å¦‚æœå®¢æˆ·ç«¯å…è®¸ç§Ÿçº¦(lease)åˆ°æœŸï¼Œexpiration manager å°†è‡ªåŠ¨åŠé”€è¿™ä¸ª secret. core è¿˜è´Ÿè´£å¤„ç†å®¡æ ¸ä»£ç† audit brokerçš„è¯·æ±‚åŠå“åº”æ—¥å¿—ï¼Œå°†è¯·æ±‚å‘é€åˆ°æ‰€æœ‰å·²é…ç½®çš„å®¡æ ¸è®¾å¤‡ audit devices. ä¸è¿‡é»˜è®¤æƒ…å†µä¸‹è¿™ä¸ªåŠŸèƒ½è²Œä¼¼æ˜¯å…³é—­çš„ã€‚ ","date":"2021-01-24","objectID":"/posts/experience-of-vault/:1:2","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/experience-of-vault/#2-è®¤è¯ç³»ç»ŸåŠæƒé™ç³»ç»Ÿ"},{"categories":["tech"],"content":" 3. Secret EngineSecret Engine æ˜¯ä¿å­˜ã€ç”Ÿæˆæˆ–è€…åŠ å¯†æ•°æ®çš„ç»„ä»¶ï¼Œå®ƒéå¸¸çµæ´»ã€‚ æœ‰çš„ Secret Engines åªæ˜¯å•çº¯åœ°å­˜å‚¨ä¸è¯»å–æ•°æ®ï¼Œæ¯”å¦‚ kv å°±å¯ä»¥çœ‹ä½œä¸€ä¸ªåŠ å¯†çš„ Redisã€‚è€Œå…¶ä»–çš„ Secret Engines åˆ™è¿æ¥åˆ°å…¶ä»–çš„æœåŠ¡å¹¶æŒ‰éœ€ç”ŸæˆåŠ¨æ€å‡­è¯ã€‚ è¿˜æœ‰äº› Secret Engines æä¾›ã€ŒåŠ å¯†å³æœåŠ¡(encryption as a service)ã€çš„èƒ½åŠ›ï¼Œå¦‚ transitã€è¯ä¹¦ç®¡ç†ç­‰ã€‚ å¸¸ç”¨çš„ engine ä¸¾ä¾‹ï¼š AliCloud Secrets Engine: åŸºäº RAM ç­–ç•¥åŠ¨æ€ç”Ÿæˆ AliCloud Access Tokenï¼Œæˆ–åŸºäº RAM è§’è‰²åŠ¨æ€ç”Ÿæˆ AliCloud STS å‡­æ® Access Token ä¼šè‡ªåŠ¨æ›´æ–°(Renew)ï¼Œè€Œ STS å‡­æ®æ˜¯ä¸´æ—¶ä½¿ç”¨çš„ï¼Œè¿‡æœŸåå°±å¤±æ•ˆäº†ã€‚ kv: é”®å€¼å­˜å‚¨ï¼Œå¯ç”¨äºå­˜å‚¨ä¸€äº›é™æ€çš„é…ç½®ã€‚å®ƒä¸€å®šç¨‹åº¦ä¸Šèƒ½æ›¿ä»£æ‰æºç¨‹çš„ Apollo é…ç½®ä¸­å¿ƒã€‚ Transit Secrets Engine: æä¾›åŠ å¯†å³æœåŠ¡çš„åŠŸèƒ½ï¼Œå®ƒåªè´Ÿè´£åŠ å¯†å’Œè§£å¯†ï¼Œä¸è´Ÿè´£å­˜å‚¨ã€‚ä¸»è¦åº”ç”¨åœºæ™¯æ˜¯å¸® app åŠ è§£å¯†æ•°æ®ï¼Œä½†æ˜¯æ•°æ®ä»æ—§å­˜å‚¨åœ¨ MySQL ç­‰æ•°æ®åº“ä¸­ã€‚ ","date":"2021-01-24","objectID":"/posts/experience-of-vault/:1:3","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/experience-of-vault/#3-secret-engine"},{"categories":["tech"],"content":" äºŒã€éƒ¨ç½² Vaultå®˜æ–¹å»ºè®®é€šè¿‡ Helm éƒ¨ç½² vaultï¼Œå¤§æ¦‚æµç¨‹ï¼š ä½¿ç”¨ helm/docker éƒ¨ç½²è¿è¡Œ vault. åˆå§‹åŒ–/è§£å° vault: vault å®‰å…¨æªæ–½ï¼Œæ¯æ¬¡é‡å¯å¿…é¡»è§£å°(å¯è®¾ç½®è‡ªåŠ¨è§£å°). ","date":"2021-01-24","objectID":"/posts/experience-of-vault/:2:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/experience-of-vault/#äºŒéƒ¨ç½²-vault"},{"categories":["tech"],"content":" 0. å¦‚ä½•é€‰æ‹©å­˜å‚¨åç«¯ï¼Ÿé¦–å…ˆï¼Œæˆ‘ä»¬è‚¯å®šéœ€è¦é«˜å¯ç”¨ HAï¼Œè‡³å°‘è¦ä¿ç•™èƒ½å‡çº§åˆ° HA çš„èƒ½åŠ›ï¼Œæ‰€ä»¥ä¸å»ºè®®é€‰æ‹©ä¸æ”¯æŒ HA çš„åç«¯ã€‚ è€Œå…·ä½“çš„é€‰æ‹©ï¼Œå°±å› å›¢é˜Ÿç»éªŒè€Œå¼‚äº†ï¼Œäººä»¬å¾€å¾€å€¾å‘äºä½¿ç”¨è‡ªå·±ç†Ÿæ‚‰çš„ã€çŸ¥æ ¹çŸ¥åº•çš„åç«¯ï¼Œæˆ–è€…é€‰ç”¨äº‘æœåŠ¡ã€‚ æ¯”å¦‚æˆ‘ä»¬å¯¹ MySQL/PostgreSQL æ¯”è¾ƒç†Ÿæ‚‰ï¼Œè€Œä¸”ä½¿ç”¨äº‘æœåŠ¡æä¾›çš„æ•°æ®åº“ä¸éœ€è¦è€ƒè™‘å¤ªå¤šçš„ç»´æŠ¤é—®é¢˜ï¼ŒMySQL/PostgreSQL ä½œä¸ºä¸€ä¸ªé€šç”¨åè®®ä¹Ÿä¸ä¼šè¢«äº‘å‚å•†ç»‘æ¶ï¼Œé‚£æˆ‘ä»¬å°±å€¾å‘äºä½¿ç”¨è¿™ä¸¤è€…ä¹‹ä¸€ã€‚ è€Œå¦‚æœä½ ä»¬æ˜¯æœ¬åœ°è‡ªå»ºï¼Œé‚£ä½ å¯èƒ½æ›´å€¾å‘äºä½¿ç”¨ Etcd/Consul/Raft åšåç«¯å­˜å‚¨ã€‚ ","date":"2021-01-24","objectID":"/posts/experience-of-vault/:2:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/experience-of-vault/#0-å¦‚ä½•é€‰æ‹©å­˜å‚¨åç«¯"},{"categories":["tech"],"content":" 1. docker-compose éƒ¨ç½²ï¼ˆé HAï¼‰ æ¨èç”¨äºæœ¬åœ°å¼€å‘æµ‹è¯•ç¯å¢ƒï¼Œæˆ–è€…å…¶ä»–ä¸éœ€è¦é«˜å¯ç”¨çš„ç¯å¢ƒã€‚ docker-compose.yml ç¤ºä¾‹å¦‚ä¸‹ï¼š yaml version: \"3.3\" services: vault: # æ–‡æ¡£ï¼šhttps://hub.docker.com/_/vault image: vault:1.6.0 container_name: vault ports: # rootless å®¹å™¨ï¼Œå†…éƒ¨ä¸èƒ½ä½¿ç”¨æ ‡å‡†ç«¯å£ 443 - \"443:8200\" restart: always volumes: # å®¡è®¡æ—¥å¿—å­˜å‚¨ç›®å½•ï¼ˆ`file` audit backendï¼‰ - ./logs:/vault/logs # å½“ä½¿ç”¨ file data storage æ’ä»¶æ—¶ï¼Œæ•°æ®è¢«å­˜å‚¨åœ¨è¿™é‡Œã€‚é»˜è®¤ä¸å¾€è¿™å†™ä»»ä½•æ•°æ®ã€‚ - ./file:/vault/file # vault é…ç½® - ./config.hcl:/vault/config/config.hcl # TLS è¯ä¹¦ - ./certs:/certs # vault éœ€è¦é”å®šå†…å­˜ä»¥é˜²æ­¢æ•æ„Ÿå€¼ä¿¡æ¯è¢«äº¤æ¢(swapped)åˆ°ç£ç›˜ä¸­ # ä¸ºæ­¤éœ€è¦æ·»åŠ å¦‚ä¸‹ capability cap_add: - IPC_LOCK # å¿…é¡»è®¾å®š entrypointï¼Œå¦åˆ™ vault å®¹å™¨é»˜è®¤ä»¥ development æ¨¡å¼è¿è¡Œ entrypoint: vault server -config /vault/config/config.hcl config.hcl å†…å®¹å¦‚ä¸‹ï¼š hcl ui = true // ä½¿ç”¨æ–‡ä»¶åšæ•°æ®å­˜å‚¨ï¼ˆå•èŠ‚ç‚¹ï¼‰ storage \"file\" { path = \"/vault/file\" } listener \"tcp\" { address = \"[::]:8200\" tls_disable = false tls_cert_file = \"/certs/server.crt\" tls_key_file = \"/certs/server.key\" } å°†å¦‚ä¸Šä¸¤ä»½é…ç½®ä¿å­˜åœ¨åŒä¸€æ–‡ä»¶å¤¹å†…ï¼ŒåŒæ—¶åœ¨ ./certs ä¸­æä¾› TLS è¯ä¹¦ server.crt å’Œç§é’¥server.keyã€‚ ç„¶å docker-compose up -d å°±èƒ½å¯åŠ¨è¿è¡Œä¸€ä¸ª vault å®ä¾‹ã€‚ ","date":"2021-01-24","objectID":"/posts/experience-of-vault/:2:2","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/experience-of-vault/#1-docker-compose-éƒ¨ç½²é-ha"},{"categories":["tech"],"content":" 2. é€šè¿‡ helm éƒ¨ç½²é«˜å¯ç”¨çš„ vault æ¨èç”¨äºç”Ÿäº§ç¯å¢ƒ é€šè¿‡ helm éƒ¨ç½²ï¼š shell # æ·»åŠ  valut ä»“åº“ helm repo add hashicorp https://helm.releases.hashicorp.com # æŸ¥çœ‹ vault ç‰ˆæœ¬å· helm search repo hashicorp/vault -l | head # ä¸‹è½½æŸä¸ªç‰ˆæœ¬å·çš„ vault helm pull hashicorp/vault --version 0.11.0 --untar å‚ç…§ä¸‹è½½ä¸‹æ¥çš„ ./vault/values.yaml ç¼–å†™ custom-values.yamlï¼Œéƒ¨ç½²ä¸€ä¸ªä»¥ mysql ä¸ºåç«¯å­˜å‚¨çš„ HA vaultï¼Œé…ç½®ç¤ºä¾‹å¦‚ä¸‹: é…ç½®å†…å®¹è™½ç„¶å¤šï¼Œä½†æ˜¯å¤§éƒ½æ˜¯ç›´æ¥æ‹·è´è‡ª ./vault/values.yamlï¼Œæ”¹åŠ¨å¾ˆå°‘ã€‚æµ‹è¯• Vault æ—¶å¯ä»¥å¿½ç•¥æ‰å…¶ä¸­å¤§å¤šæ•°çš„é…ç½®é¡¹ã€‚ yaml global: # enabled is the master enabled switch. Setting this to true or false # will enable or disable all the components within this chart by default. enabled: true # TLS for end-to-end encrypted transport tlsDisable: false injector: # True if you want to enable vault agent injection. enabled: true replicas: 1 # If true, will enable a node exporter metrics endpoint at /metrics. metrics: enabled: false # Mount Path of the Vault Kubernetes Auth Method. authPath: \"auth/kubernetes\" certs: # secretName is the name of the secret that has the TLS certificate and # private key to serve the injector webhook. If this is null, then the # injector will default to its automatic management mode that will assign # a service account to the injector to generate its own certificates. secretName: null # caBundle is a base64-encoded PEM-encoded certificate bundle for the # CA that signed the TLS certificate that the webhook serves. This must # be set if secretName is non-null. caBundle: \"\" # certName and keyName are the names of the files within the secret for # the TLS cert and private key, respectively. These have reasonable # defaults but can be customized if necessary. certName: tls.crt keyName: tls.key server: # Resource requests, limits, etc. for the server cluster placement. This # should map directly to the value of the resources field for a PodSpec. # By default no direct resource request is made. # Enables a headless service to be used by the Vault Statefulset service: enabled: true # Port on which Vault server is listening port: 8200 # Target port to which the service should be mapped to targetPort: 8200 # This configures the Vault Statefulset to create a PVC for audit # logs. Once Vault is deployed, initialized and unseal, Vault must # be configured to use this for audit logs. This will be mounted to # /vault/audit # See https://www.vaultproject.io/docs/audit/index.html to know more auditStorage: enabled: false # Run Vault in \"HA\" mode. There are no storage requirements unless audit log # persistence is required. In HA mode Vault will configure itself to use Consul # for its storage backend. The default configuration provided will work the Consul # Helm project by default. It is possible to manually configure Vault to use a # different HA backend. ha: enabled: true replicas: 3 # Set the api_addr configuration for Vault HA # See https://www.vaultproject.io/docs/configuration#api_addr # If set to null, this will be set to the Pod IP Address apiAddr: null # config is a raw string of default configuration when using a Stateful # deployment. Default is to use a Consul for its HA storage backend. # This should be HCL. # Note: Configuration files are stored in ConfigMaps so sensitive data # such as passwords should be either mounted through extraSecretEnvironmentVars # or through a Kube secret. For more information see: # https://www.vaultproject.io/docs/platform/k8s/helm/run#protecting-sensitive-vault-configurations config: | ui = true listener \"tcp\" { address = \"[::]:8200\" cluster_address = \"[::]:8201\" # æ³¨æ„ï¼Œè¿™ä¸ªå€¼è¦å’Œ helm çš„å‚æ•° global.tlsDisable ä¸€è‡´ tls_disable = false tls_cert_file = \"/etc/certs/vault.crt\" tls_key_file = \"/etc/certs/vault.key\" } # storage \"postgresql\" { # connection_url = \"postgres://username:password@\u003chost\u003e:5432/vault?sslmode=disable\" # ha_enabled = true # } service_registration \"kubernetes\" {} # Example configuration for using auto-unseal, using AWS KMS. # the cluster must have a service account that is authorized to access AWS KMS, through an IAM Role. # seal \"awskms\" { # region = \"us-east-1\" # kms_key_id = \"\u003csome-key-i","date":"2021-01-24","objectID":"/posts/experience-of-vault/:2:3","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/experience-of-vault/#install-by-helm"},{"categories":["tech"],"content":" 3. åˆå§‹åŒ–å¹¶è§£å° vault å®˜æ–¹æ–‡æ¡£ï¼šInitialize and unseal Vault - Vault on Kubernetes Deployment Guide é€šè¿‡ helm éƒ¨ç½² vaultï¼Œé»˜è®¤ä¼šéƒ¨ç½²ä¸€ä¸ªä¸‰å‰¯æœ¬çš„ StatefulSetï¼Œä½†æ˜¯è¿™ä¸‰ä¸ªå‰¯æœ¬éƒ½ä¼šå¤„äº NotReady çŠ¶æ€ï¼ˆdocker æ–¹å¼éƒ¨ç½²çš„ä¹Ÿä¸€æ ·ï¼‰ã€‚æ¥ä¸‹æ¥è¿˜éœ€è¦æ‰‹åŠ¨åˆå§‹åŒ–å¹¶è§£å° vaultï¼Œæ‰èƒ½ Ready: ç¬¬ä¸€æ­¥ï¼šä»ä¸‰ä¸ªå‰¯æœ¬ä¸­éšä¾¿é€‰æ‹©ä¸€ä¸ªï¼Œè¿è¡Œ vault çš„åˆå§‹åŒ–å‘½ä»¤ï¼škubectl exec -ti vault-0 -- vault operator init åˆå§‹åŒ–æ“ä½œä¼šè¿”å› 5 ä¸ª unseal keysï¼Œä»¥åŠä¸€ä¸ª Initial Root Tokenï¼Œè¿™äº›æ•°æ®éå¸¸æ•æ„Ÿéå¸¸é‡è¦ï¼Œä¸€å®šè¦ä¿å­˜åˆ°å®‰å…¨çš„åœ°æ–¹ï¼ ç¬¬äºŒæ­¥ï¼šåœ¨æ¯ä¸ªå‰¯æœ¬ä¸Šï¼Œä½¿ç”¨ä»»æ„ä¸‰ä¸ª unseal keys è¿›è¡Œè§£å°æ“ä½œã€‚ ä¸€å…±æœ‰ä¸‰ä¸ªå‰¯æœ¬ï¼Œä¹Ÿå°±æ˜¯è¯´è¦è§£å° 3*3 æ¬¡ï¼Œæ‰èƒ½å®Œæˆ vault çš„å®Œæ•´è§£å°ï¼ shell # æ¯ä¸ªå®ä¾‹éƒ½éœ€è¦è§£å°ä¸‰æ¬¡ï¼ ## Unseal the first vault server until it reaches the key threshold $ kubectl exec -ti vault-0 -- vault operator unseal # ... Unseal Key 1 $ kubectl exec -ti vault-0 -- vault operator unseal # ... Unseal Key 2 $ kubectl exec -ti vault-0 -- vault operator unseal # ... Unseal Key 3 è¿™æ ·å°±å®Œæˆäº†éƒ¨ç½²ï¼Œä½†æ˜¯è¦æ³¨æ„ï¼Œvault å®ä¾‹æ¯æ¬¡é‡å¯åï¼Œéƒ½éœ€è¦é‡æ–°è§£å°ï¼ä¹Ÿå°±æ˜¯é‡æ–°è¿›è¡Œç¬¬äºŒæ­¥æ“ä½œï¼ ","date":"2021-01-24","objectID":"/posts/experience-of-vault/:2:4","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/experience-of-vault/#3-åˆå§‹åŒ–å¹¶è§£å°-vault"},{"categories":["tech"],"content":" 4. åˆå§‹åŒ–å¹¶è®¾ç½®è‡ªåŠ¨è§£å°åœ¨æœªè®¾ç½® auto unseal çš„æƒ…å†µä¸‹ï¼Œvault æ¯æ¬¡é‡å¯éƒ½è¦æ‰‹åŠ¨è§£å°æ‰€æœ‰ vault å®ä¾‹ï¼Œå®åœ¨æ˜¯å¾ˆéº»çƒ¦ï¼Œåœ¨äº‘ä¸Šè‡ªåŠ¨æ‰©ç¼©å®¹çš„æƒ…å†µä¸‹ï¼Œvault å®ä¾‹ä¼šè¢«è‡ªåŠ¨è°ƒåº¦ï¼Œè¿™ç§æƒ…å†µå°±æ›´éº»çƒ¦äº†ã€‚ ä¸ºäº†ç®€åŒ–è¿™ä¸ªæµç¨‹ï¼Œå¯ä»¥è€ƒè™‘é…ç½® auto unseal è®© vault è‡ªåŠ¨è§£å°ã€‚ è‡ªåŠ¨è§£å°ç›®å‰æœ‰ä¸¤ç§æ–¹æ³•ï¼š ä½¿ç”¨é˜¿é‡Œäº‘/AWS/Azure ç­‰äº‘æœåŠ¡æä¾›çš„å¯†é’¥åº“æ¥ç®¡ç† encryption key AWS: awskms Seal å¦‚æœæ˜¯ k8s é›†ç¾¤ï¼Œvault ä½¿ç”¨çš„ ServiceAccount éœ€è¦æœ‰æƒé™ä½¿ç”¨ AWS KMSï¼Œå®ƒå¯æ›¿ä»£æ‰ config.hcl ä¸­çš„ access_key/secret_key ä¸¤ä¸ªå±æ€§ é˜¿é‡Œäº‘ï¼šalicloudkms Seal å¦‚æœä½ ä¸æƒ³ç”¨äº‘æœåŠ¡ï¼Œé‚£å¯ä»¥è€ƒè™‘autounseal-transitï¼Œ è¿™ç§æ–¹æ³•ä½¿ç”¨å¦ä¸€ä¸ª vault å®ä¾‹æä¾›çš„ transit å¼•æ“æ¥å®ç° auto-unseal. ç®€å•ç²—æš´ï¼šç›´æ¥å†™ä¸ª crontab æˆ–è€…åœ¨ CI å¹³å°ä¸ŠåŠ ä¸ªå®šæ—¶ä»»åŠ¡å»æ‰§è¡Œè§£å°å‘½ä»¤ï¼Œä»¥å®ç°è‡ªåŠ¨è§£å°ã€‚ä¸è¿‡è¿™æ ·å®‰å…¨æ€§å°±ä¸å¥½è¯´äº†ã€‚ ä»¥ä½¿ç”¨ awskms ä¸ºä¾‹ï¼Œé¦–å…ˆåˆ›å»º aws IAM çš„ policy å†…å®¹å¦‚ä¸‹: json { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Sid\": \"VaultKMSUnseal\", \"Effect\": \"Allow\", \"Action\": [\"kms:Decrypt\", \"kms:Encrypt\", \"kms:DescribeKey\"], \"Resource\": \"*\" } ] } ç„¶ååˆ›å»º IAM Role ç»‘å®šä¸Šé¢çš„ policyï¼Œå¹¶ä¸º vault çš„ k8s serviceaccount åˆ›å»ºä¸€ä¸ª IAM Roleï¼Œ ç»‘å®šä¸Šè¿™ä¸ª policy. è¿™æ · vault ä½¿ç”¨çš„ serviceaccount è‡ªèº«å°±æ‹¥æœ‰äº†è®¿é—® awskms çš„æƒé™ï¼Œä¹Ÿå°±ä¸éœ€è¦é¢å¤–é€šè¿‡ access_key/secret_key æ¥è®¿é—® awskms. å…³äº IAM Role å’Œ k8s serviceaccount å¦‚ä½•ç»‘å®šï¼Œå‚è§å®˜æ–¹æ–‡æ¡£ï¼šIAM roles for EKS service accounts å®Œäº‹åå†ä¿®æ”¹å¥½å‰é¢æä¾›çš„ helm é…ç½®ï¼Œéƒ¨ç½²å®ƒï¼Œæœ€åä½¿ç”¨å¦‚ä¸‹å‘½ä»¤åˆå§‹åŒ–ä¸€ä¸‹ï¼š shell # åˆå§‹åŒ–å‘½ä»¤å’Œæ™®é€šæ¨¡å¼å¹¶æ— ä¸åŒ kubectl exec -ti vault-0 -- vault operator init # ä¼šæ‰“å°å‡ºä¸€ä¸ª root tokenï¼Œä»¥åŠäº”ä¸ª Recovery Keyï¼ˆè€Œä¸æ˜¯ Unseal Keyï¼‰ # Recover Key ä¸å†ç”¨äºè§£å°ï¼Œä½†æ˜¯é‡æ–°ç”Ÿæˆ root token ç­‰æ“ä½œä»ç„¶ä¼šéœ€è¦ç”¨åˆ°å®ƒ. ç„¶åå°±å¤§åŠŸå‘Šæˆäº†ï¼Œå¯ä»¥å°è¯•ä¸‹åˆ é™¤ vault çš„ podï¼Œæ–°å»ºçš„ Pod åº”è¯¥ä¼šè‡ªåŠ¨è§£å°ã€‚ ","date":"2021-01-24","objectID":"/posts/experience-of-vault/:2:5","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/experience-of-vault/#4-åˆå§‹åŒ–å¹¶è®¾ç½®è‡ªåŠ¨è§£å°"},{"categories":["tech"],"content":" ä¸‰ã€Vault è‡ªèº«çš„é…ç½®ç®¡ç†Vault æœ¬èº«æ˜¯ä¸€ä¸ªå¤æ‚çš„ secrets å·¥å…·ï¼Œå®ƒæä¾›äº† Web UI å’Œ CLI ç”¨äºæ‰‹åŠ¨ç®¡ç†ä¸æŸ¥çœ‹ Vault çš„å†…å®¹ã€‚ ä½†æ˜¯ä½œä¸ºä¸€å DevOpsï¼Œæˆ‘ä»¬å½“ç„¶æ›´å–œæ¬¢æ›´è‡ªæ²»çš„æ–¹æ³•ï¼Œè¿™æœ‰ä¸¤ç§é€‰æ‹©: ä½¿ç”¨ vault çš„ sdk: python-hvac ä½¿ç”¨ terraform-provider-vault æˆ–è€… pulumi-vault å®ç° vault é…ç½®çš„è‡ªåŠ¨åŒ–ç®¡ç†ã€‚ Web UI é€‚åˆæ‰‹å·¥æ“ä½œï¼Œè€Œ sdk/terraform-provider-vault åˆ™é€‚åˆç”¨äºè‡ªåŠ¨åŒ–ç®¡ç† vault. æˆ‘ä»¬çš„æµ‹è¯•ç¯å¢ƒå°±æ˜¯ä½¿ç”¨ pulumi-vault å®Œæˆçš„è‡ªåŠ¨åŒ–é…ç½® vault policy å’Œ kubernetes roleï¼Œç„¶åè‡ªåŠ¨åŒ–æ³¨å…¥æ‰€æœ‰æµ‹è¯•ç”¨çš„ secrets. ","date":"2021-01-24","objectID":"/posts/experience-of-vault/:3:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/experience-of-vault/#ä¸‰vault-è‡ªèº«çš„é…ç½®ç®¡ç†"},{"categories":["tech"],"content":" 1. ä½¿ç”¨ pulumi è‡ªåŠ¨åŒ–é…ç½® vaultä½¿ç”¨ pulumi ç®¡ç† vault é…ç½®çš„ä¼˜åŠ¿æ˜¯å¾ˆå¤§çš„ï¼Œå› ä¸ºäº‘ä¸Šèµ„æºçš„æ•æ„Ÿä¿¡æ¯ï¼ˆæ•°æ®åº“è´¦å·å¯†ç ã€èµ„æº IDã€RAMå­è´¦å·ï¼‰éƒ½æ˜¯ pulumi åˆ›å»ºçš„ã€‚ å†ç»“åˆä½¿ç”¨ pulumi_valutï¼Œå°±èƒ½å®ç°æ•æ„Ÿä¿¡æ¯è‡ªåŠ¨ç”Ÿæˆåï¼Œç«‹å³ä¿å­˜åˆ° vault ä¸­ï¼Œå®ç°å®Œå…¨è‡ªåŠ¨åŒ–ã€‚ åç»­å¾®æœåŠ¡å°±å¯ä»¥é€šè¿‡ kubernetes è®¤è¯ï¼Œç›´æ¥ä» vault è¯»å–æ•æ„Ÿä¿¡æ¯ã€‚ æˆ–è€…æ˜¯å†™å…¥åˆ°æœ¬åœ°çš„ vault ä¸­ç•™åšå¤‡ä»½ï¼Œåœ¨éœ€è¦çš„æ—¶å€™ï¼Œç®¡ç†å‘˜èƒ½ç™»å…¥è¿›å»æŸ¥çœ‹ç›¸å…³æ•æ„Ÿä¿¡æ¯ã€‚ 1.1 Token çš„ç”Ÿæˆpulumi_vault æœ¬èº«æŒºç®€å•çš„ï¼Œå£°æ˜å¼çš„é…ç½®å˜›ï¼Œç›´æ¥ç”¨å°±æ˜¯äº†ã€‚ ä½†æ˜¯å®ƒä¸€å®šè¦æ±‚æä¾› VAULT_TOKEN ä½œä¸ºèº«ä»½è®¤è¯çš„å‡­è¯ï¼ˆå®æµ‹ userpass/approle éƒ½ä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œä¼šæŠ¥é”™ no vault token foundï¼‰ï¼Œè€Œä¸” pulumi è¿˜ä¼šå…ˆç”Ÿæˆä¸´æ—¶ç”¨çš„ child tokenï¼Œç„¶åç”¨è¿™ä¸ª child token è¿›è¡Œåç»­çš„æ“ä½œã€‚ é¦–å…ˆå®‰å…¨èµ·è§ï¼Œè‚¯å®šä¸åº”è¯¥ç›´æ¥æä¾› root tokenï¼root token åº”è¯¥å°å­˜ï¼Œé™¤äº†ç´§æ€¥æƒ…å†µä¸åº”è¯¥å¯ç”¨ã€‚ é‚£ä¹ˆåº”è¯¥å¦‚ä½•ç”Ÿæˆä¸€ä¸ªæƒé™æœ‰é™çš„ token ç»™ vault ä½¿ç”¨å‘¢ï¼Ÿæˆ‘çš„æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ª userpass è´¦å·ï¼Œé€šè¿‡ policy ç»™äºˆå®ƒæœ‰é™çš„æƒé™ã€‚ç„¶åå…ˆæ‰‹åŠ¨(æˆ–è€…è‡ªåŠ¨)ç™»å½•è·å–åˆ° tokenï¼Œå†å°† token æä¾›ç»™ pulumi_vault ä½¿ç”¨ã€‚ è¿™é‡Œé¢æœ‰ä¸ªå‘ï¼Œå°±æ˜¯å¿…é¡»ç»™ userpass è´¦å·åˆ›å»º child token çš„æƒé™ï¼š hcl path \"local/*\" { capabilities = [\"read\", \"list\"] } // å…è®¸åˆ›å»º child token path \"auth/token/create\" { capabilities = [\"create\", \"read\", \"update\", \"delete\", \"list\"] } ä¸ç»™è¿™ä¸ªæƒé™ï¼Œpulumi_vault å°±ä¼šä¸€ç›´æŠ¥é”™ã€‚ã€‚ ç„¶åè¿˜å¾—ç»™å®ƒã€Œè‡ªåŠ¨åŒ–é…ç½®ã€éœ€è¦çš„æƒé™ï¼Œæ¯”å¦‚è‡ªåŠ¨åˆ›å»º/æ›´æ–° policy/secrets/kubernetes ç­‰ç­‰ï¼Œç¤ºä¾‹å¦‚ä¸‹: hcl # To list policies - Step 3 path \"sys/policy\" { capabilities = [\"read\"] } # Create and manage ACL policies broadly across Vault path \"sys/policy/*\" { capabilities = [\"create\", \"read\", \"update\", \"delete\", \"list\", \"sudo\"] } # List, create, update, and delete key/value secrets path \"secret/*\" { capabilities = [\"create\", \"read\", \"update\", \"delete\", \"list\", \"sudo\"] } path \"auth/kubernetes/role/*\" { capabilities = [\"create\", \"read\", \"update\", \"list\"] } ","date":"2021-01-24","objectID":"/posts/experience-of-vault/:3:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/experience-of-vault/#1-ä½¿ç”¨-pulumi-è‡ªåŠ¨åŒ–é…ç½®-vault"},{"categories":["tech"],"content":" 1. ä½¿ç”¨ pulumi è‡ªåŠ¨åŒ–é…ç½® vaultä½¿ç”¨ pulumi ç®¡ç† vault é…ç½®çš„ä¼˜åŠ¿æ˜¯å¾ˆå¤§çš„ï¼Œå› ä¸ºäº‘ä¸Šèµ„æºçš„æ•æ„Ÿä¿¡æ¯ï¼ˆæ•°æ®åº“è´¦å·å¯†ç ã€èµ„æº IDã€RAMå­è´¦å·ï¼‰éƒ½æ˜¯ pulumi åˆ›å»ºçš„ã€‚ å†ç»“åˆä½¿ç”¨ pulumi_valutï¼Œå°±èƒ½å®ç°æ•æ„Ÿä¿¡æ¯è‡ªåŠ¨ç”Ÿæˆåï¼Œç«‹å³ä¿å­˜åˆ° vault ä¸­ï¼Œå®ç°å®Œå…¨è‡ªåŠ¨åŒ–ã€‚ åç»­å¾®æœåŠ¡å°±å¯ä»¥é€šè¿‡ kubernetes è®¤è¯ï¼Œç›´æ¥ä» vault è¯»å–æ•æ„Ÿä¿¡æ¯ã€‚ æˆ–è€…æ˜¯å†™å…¥åˆ°æœ¬åœ°çš„ vault ä¸­ç•™åšå¤‡ä»½ï¼Œåœ¨éœ€è¦çš„æ—¶å€™ï¼Œç®¡ç†å‘˜èƒ½ç™»å…¥è¿›å»æŸ¥çœ‹ç›¸å…³æ•æ„Ÿä¿¡æ¯ã€‚ 1.1 Token çš„ç”Ÿæˆpulumi_vault æœ¬èº«æŒºç®€å•çš„ï¼Œå£°æ˜å¼çš„é…ç½®å˜›ï¼Œç›´æ¥ç”¨å°±æ˜¯äº†ã€‚ ä½†æ˜¯å®ƒä¸€å®šè¦æ±‚æä¾› VAULT_TOKEN ä½œä¸ºèº«ä»½è®¤è¯çš„å‡­è¯ï¼ˆå®æµ‹ userpass/approle éƒ½ä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œä¼šæŠ¥é”™ no vault token foundï¼‰ï¼Œè€Œä¸” pulumi è¿˜ä¼šå…ˆç”Ÿæˆä¸´æ—¶ç”¨çš„ child tokenï¼Œç„¶åç”¨è¿™ä¸ª child token è¿›è¡Œåç»­çš„æ“ä½œã€‚ é¦–å…ˆå®‰å…¨èµ·è§ï¼Œè‚¯å®šä¸åº”è¯¥ç›´æ¥æä¾› root tokenï¼root token åº”è¯¥å°å­˜ï¼Œé™¤äº†ç´§æ€¥æƒ…å†µä¸åº”è¯¥å¯ç”¨ã€‚ é‚£ä¹ˆåº”è¯¥å¦‚ä½•ç”Ÿæˆä¸€ä¸ªæƒé™æœ‰é™çš„ token ç»™ vault ä½¿ç”¨å‘¢ï¼Ÿæˆ‘çš„æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ª userpass è´¦å·ï¼Œé€šè¿‡ policy ç»™äºˆå®ƒæœ‰é™çš„æƒé™ã€‚ç„¶åå…ˆæ‰‹åŠ¨(æˆ–è€…è‡ªåŠ¨)ç™»å½•è·å–åˆ° tokenï¼Œå†å°† token æä¾›ç»™ pulumi_vault ä½¿ç”¨ã€‚ è¿™é‡Œé¢æœ‰ä¸ªå‘ï¼Œå°±æ˜¯å¿…é¡»ç»™ userpass è´¦å·åˆ›å»º child token çš„æƒé™ï¼š hcl path \"local/*\" { capabilities = [\"read\", \"list\"] } // å…è®¸åˆ›å»º child token path \"auth/token/create\" { capabilities = [\"create\", \"read\", \"update\", \"delete\", \"list\"] } ä¸ç»™è¿™ä¸ªæƒé™ï¼Œpulumi_vault å°±ä¼šä¸€ç›´æŠ¥é”™ã€‚ã€‚ ç„¶åè¿˜å¾—ç»™å®ƒã€Œè‡ªåŠ¨åŒ–é…ç½®ã€éœ€è¦çš„æƒé™ï¼Œæ¯”å¦‚è‡ªåŠ¨åˆ›å»º/æ›´æ–° policy/secrets/kubernetes ç­‰ç­‰ï¼Œç¤ºä¾‹å¦‚ä¸‹: hcl # To list policies - Step 3 path \"sys/policy\" { capabilities = [\"read\"] } # Create and manage ACL policies broadly across Vault path \"sys/policy/*\" { capabilities = [\"create\", \"read\", \"update\", \"delete\", \"list\", \"sudo\"] } # List, create, update, and delete key/value secrets path \"secret/*\" { capabilities = [\"create\", \"read\", \"update\", \"delete\", \"list\", \"sudo\"] } path \"auth/kubernetes/role/*\" { capabilities = [\"create\", \"read\", \"update\", \"list\"] } ","date":"2021-01-24","objectID":"/posts/experience-of-vault/:3:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/experience-of-vault/#11-token-çš„ç”Ÿæˆ"},{"categories":["tech"],"content":" å››ã€åœ¨ Kubernetes ä¸­ä½¿ç”¨ vault æ³¨å…¥ secretsvault-k8s-auth-workflow å‰é¢æåˆ°è¿‡ vault æ”¯æŒé€šè¿‡ Kubernetes çš„ ServiceAccount ä¸ºæ¯ä¸ª Pod å•ç‹¬åˆ†é…æƒé™ã€‚ åº”ç”¨ç¨‹åºæœ‰ä¸¤ç§æ–¹å¼å»è¯»å– vault ä¸­çš„é…ç½®ï¼š å€ŸåŠ© Vault Sidecarï¼Œå°† secrets ä»¥æ–‡ä»¶çš„å½¢å¼è‡ªåŠ¨æ³¨å…¥åˆ° Pod ä¸­ï¼Œæ¯”å¦‚/vault/secrets/config.json vault sidecar åœ¨å¸¸é©»æ¨¡å¼ä¸‹æ¯ 15 ç§’æ›´æ–°ä¸€æ¬¡é…ç½®ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨ watchdog å®æ—¶ç›‘æ§ secrets æ–‡ä»¶çš„å˜æ›´ã€‚ åº”ç”¨ç¨‹åºè‡ªå·±ä½¿ç”¨ SDK ç›´æ¥è®¿é—® vault api è·å– secrets ä¸Šè¿°ä¸¤ç§æ–¹å¼ï¼Œéƒ½å¯ä»¥å€ŸåŠ© Kubernetes ServiceAccount è¿›è¡Œèº«ä»½éªŒè¯å’Œæƒé™åˆ†é…ã€‚ ä¸‹é¢ä»¥ Sidecar æ¨¡å¼ä¸ºä¾‹ï¼Œä»‹ç»å¦‚ä½•å°† secrets ä»¥æ–‡ä»¶å½¢å¼æ³¨å…¥åˆ° Pod ä¸­ã€‚ ","date":"2021-01-24","objectID":"/posts/experience-of-vault/:4:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/experience-of-vault/#å››åœ¨-kubernetes-ä¸­ä½¿ç”¨-vault-æ³¨å…¥-secrets"},{"categories":["tech"],"content":" 1. éƒ¨ç½²å¹¶é…ç½® vault agenté¦–å…ˆå¯ç”¨ Vault çš„ Kubernetes èº«ä»½éªŒè¯: shell # é…ç½®èº«ä»½è®¤è¯éœ€è¦åœ¨ vault pod ä¸­æ‰§è¡Œï¼Œå¯åŠ¨ vault-0 çš„äº¤äº’å¼ä¼šè¯ kubectl exec -n vault -it vault-0 -- /bin/sh export VAULT_TOKEN='\u003cyour-root-token\u003e' export VAULT_ADDR='http://localhost:8200' # å¯ç”¨ Kubernetes èº«ä»½éªŒè¯ vault auth enable kubernetes # kube-apiserver API é…ç½®ï¼Œvault éœ€è¦é€šè¿‡ kube-apiserver å®Œæˆå¯¹ serviceAccount çš„èº«ä»½éªŒè¯ vault write auth/kubernetes/config \\ token_reviewer_jwt=\"$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\" \\ kubernetes_host=\"https://$KUBERNETES_PORT_443_TCP_ADDR:443\" \\ kubernetes_ca_cert=@/var/run/secrets/kubernetes.io/serviceaccount/ca.crt 1.1 ä½¿ç”¨é›†ç¾¤å¤–éƒ¨çš„ valut å®ä¾‹ å¦‚æœä½ æ²¡è¿™ä¸ªéœ€æ±‚ï¼Œè¯·è·³è¿‡è¿™ä¸€èŠ‚ã€‚ è¯¦è§Install the Vault Helm chart configured to address an external Vault kubernetes ä¹Ÿå¯ä»¥å’Œå¤–éƒ¨çš„ vault å®ä¾‹é›†æˆï¼Œé›†ç¾¤ä¸­åªéƒ¨ç½² vault-agent. è¿™é€‚ç”¨äºå¤šä¸ª kubernetes é›†ç¾¤ä»¥åŠå…¶ä»– APP å…±ç”¨ä¸€ä¸ª vault å®ä¾‹çš„æƒ…å†µï¼Œæ¯”å¦‚æˆ‘ä»¬æœ¬åœ°çš„å¤šä¸ªå¼€å‘æµ‹è¯•é›†ç¾¤ï¼Œå°±éƒ½å…±ç”¨ç€åŒä¸€ä¸ª vault å®ä¾‹ï¼Œæ–¹ä¾¿ç»Ÿä¸€ç®¡ç†åº”ç”¨çš„ secrets. é¦–å…ˆï¼Œä½¿ç”¨ helm chart éƒ¨ç½² vault-agentï¼Œæ¥å…¥å¤–éƒ¨çš„ vault å®ä¾‹ã€‚ä½¿ç”¨çš„ custom-values.yaml ç¤ºä¾‹å¦‚ä¸‹ï¼š yaml global: # enabled is the master enabled switch. Setting this to true or false # will enable or disable all the components within this chart by default. enabled: true # TLS for end-to-end encrypted transport tlsDisable: false injector: # True if you want to enable vault agent injection. enabled: true replicas: 1 # If multiple replicas are specified, by default a leader-elector side-car # will be created so that only one injector attempts to create TLS certificates. leaderElector: enabled: true image: repository: \"gcr.io/google_containers/leader-elector\" tag: \"0.4\" ttl: 60s # If true, will enable a node exporter metrics endpoint at /metrics. metrics: enabled: false # External vault server address for the injector to use. Setting this will # disable deployment of a vault server along with the injector. # TODO è¿™é‡Œçš„ https ca.crt è¦æ€ä¹ˆè®¾ç½®ï¼ŸmTLS åˆè¯¥å¦‚ä½•é…ç½®ï¼Ÿ externalVaultAddr: \"https://\u003cexternal-vault-url\u003e\" # Mount Path of the Vault Kubernetes Auth Method. authPath: \"auth/kubernetes\" certs: # secretName is the name of the secret that has the TLS certificate and # private key to serve the injector webhook. If this is null, then the # injector will default to its automatic management mode that will assign # a service account to the injector to generate its own certificates. secretName: null # caBundle is a base64-encoded PEM-encoded certificate bundle for the # CA that signed the TLS certificate that the webhook serves. This must # be set if secretName is non-null. caBundle: \"\" # certName and keyName are the names of the files within the secret for # the TLS cert and private key, respectively. These have reasonable # defaults but can be customized if necessary. certName: tls.crt keyName: tls.key éƒ¨ç½²å‘½ä»¤å’Œ é€šè¿‡ helm éƒ¨ç½² vault ä¸€è‡´ï¼Œåªè¦æ›´æ¢ custom-values.yaml å°±è¡Œã€‚ vault-agent éƒ¨ç½²å®Œæˆåï¼Œç¬¬äºŒæ­¥æ˜¯ä¸º vault åˆ›å»º serviceAccountã€secret å’Œ ClusterRoleBindingï¼Œä»¥å…è®¸ vault å®¡æŸ¥ kubernetes çš„ token, å®Œæˆå¯¹ pod çš„èº«ä»½éªŒè¯. yaml é…ç½®å¦‚ä¸‹ï¼š yaml --- apiVersion: v1 kind: ServiceAccount metadata: name: vault-auth namespace: vault --- apiVersion: v1 kind: Secret metadata: name: vault-auth namespace: vault annotations: kubernetes.io/service-account.name: vault-auth type: kubernetes.io/service-account-token --- apiVersion: rbac.authorization.k8s.io/v1beta1 kind: ClusterRoleBinding metadata: name: role-tokenreview-binding roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: system:auth-delegator subjects: - kind: ServiceAccount name: vault-auth namespace: vault ç°åœ¨åœ¨ vault å®ä¾‹è¿™è¾¹ï¼Œå¯ç”¨ kubernetes èº«ä»½éªŒè¯ï¼Œåœ¨ vault å®ä¾‹å†…ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š vault å®ä¾‹å†…æ˜¾ç„¶æ²¡æœ‰ kubectl å’Œ kubeconfigï¼Œç®€ä¾¿èµ·è§ï¼Œä¸‹åˆ—çš„ vault å‘½ä»¤ä¹Ÿå¯ä»¥é€šè¿‡ Web UI å®Œæˆã€‚ shell export VAULT_TOKEN='\u003cyour-root-token\u003e' export VAULT_ADDR='http://localhost:8200' # å¯ç”¨ Kubernetes èº«ä»½éªŒè¯ vault auth enable kubernetes # kube-apiserver API é…ç½®ï¼Œvault éœ€è¦é€šè¿‡ kube-apiserver å®Œæˆå¯¹ serviceAccount çš„èº«ä»½éªŒè¯ # TOKEN_REVIEW_JWT: å°±æ˜¯æˆ‘ä»¬å‰é¢åˆ›å»ºçš„ secret `vault-auth` TOKEN_REVIEW_JWT=$(kubectl -n vault get secret vault-auth -o go-template='{{ .data.token }}' | base64 --decode) # kube-apiserver çš„ ca è¯ä¹¦ KUBE_CA_CERT=$(kubectl -n vault config view --raw --minify --flatten -o jsonpath='{.clusters[].cl","date":"2021-01-24","objectID":"/posts/experience-of-vault/:4:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/experience-of-vault/#1-éƒ¨ç½²å¹¶é…ç½®-vault-agent"},{"categories":["tech"],"content":" 1. éƒ¨ç½²å¹¶é…ç½® vault agenté¦–å…ˆå¯ç”¨ Vault çš„ Kubernetes èº«ä»½éªŒè¯: shell # é…ç½®èº«ä»½è®¤è¯éœ€è¦åœ¨ vault pod ä¸­æ‰§è¡Œï¼Œå¯åŠ¨ vault-0 çš„äº¤äº’å¼ä¼šè¯ kubectl exec -n vault -it vault-0 -- /bin/sh export VAULT_TOKEN='' export VAULT_ADDR='http://localhost:8200' # å¯ç”¨ Kubernetes èº«ä»½éªŒè¯ vault auth enable kubernetes # kube-apiserver API é…ç½®ï¼Œvault éœ€è¦é€šè¿‡ kube-apiserver å®Œæˆå¯¹ serviceAccount çš„èº«ä»½éªŒè¯ vault write auth/kubernetes/config \\ token_reviewer_jwt=\"$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\" \\ kubernetes_host=\"https://$KUBERNETES_PORT_443_TCP_ADDR:443\" \\ kubernetes_ca_cert=@/var/run/secrets/kubernetes.io/serviceaccount/ca.crt 1.1 ä½¿ç”¨é›†ç¾¤å¤–éƒ¨çš„ valut å®ä¾‹ å¦‚æœä½ æ²¡è¿™ä¸ªéœ€æ±‚ï¼Œè¯·è·³è¿‡è¿™ä¸€èŠ‚ã€‚ è¯¦è§Install the Vault Helm chart configured to address an external Vault kubernetes ä¹Ÿå¯ä»¥å’Œå¤–éƒ¨çš„ vault å®ä¾‹é›†æˆï¼Œé›†ç¾¤ä¸­åªéƒ¨ç½² vault-agent. è¿™é€‚ç”¨äºå¤šä¸ª kubernetes é›†ç¾¤ä»¥åŠå…¶ä»– APP å…±ç”¨ä¸€ä¸ª vault å®ä¾‹çš„æƒ…å†µï¼Œæ¯”å¦‚æˆ‘ä»¬æœ¬åœ°çš„å¤šä¸ªå¼€å‘æµ‹è¯•é›†ç¾¤ï¼Œå°±éƒ½å…±ç”¨ç€åŒä¸€ä¸ª vault å®ä¾‹ï¼Œæ–¹ä¾¿ç»Ÿä¸€ç®¡ç†åº”ç”¨çš„ secrets. é¦–å…ˆï¼Œä½¿ç”¨ helm chart éƒ¨ç½² vault-agentï¼Œæ¥å…¥å¤–éƒ¨çš„ vault å®ä¾‹ã€‚ä½¿ç”¨çš„ custom-values.yaml ç¤ºä¾‹å¦‚ä¸‹ï¼š yaml global: # enabled is the master enabled switch. Setting this to true or false # will enable or disable all the components within this chart by default. enabled: true # TLS for end-to-end encrypted transport tlsDisable: false injector: # True if you want to enable vault agent injection. enabled: true replicas: 1 # If multiple replicas are specified, by default a leader-elector side-car # will be created so that only one injector attempts to create TLS certificates. leaderElector: enabled: true image: repository: \"gcr.io/google_containers/leader-elector\" tag: \"0.4\" ttl: 60s # If true, will enable a node exporter metrics endpoint at /metrics. metrics: enabled: false # External vault server address for the injector to use. Setting this will # disable deployment of a vault server along with the injector. # TODO è¿™é‡Œçš„ https ca.crt è¦æ€ä¹ˆè®¾ç½®ï¼ŸmTLS åˆè¯¥å¦‚ä½•é…ç½®ï¼Ÿ externalVaultAddr: \"https://\" # Mount Path of the Vault Kubernetes Auth Method. authPath: \"auth/kubernetes\" certs: # secretName is the name of the secret that has the TLS certificate and # private key to serve the injector webhook. If this is null, then the # injector will default to its automatic management mode that will assign # a service account to the injector to generate its own certificates. secretName: null # caBundle is a base64-encoded PEM-encoded certificate bundle for the # CA that signed the TLS certificate that the webhook serves. This must # be set if secretName is non-null. caBundle: \"\" # certName and keyName are the names of the files within the secret for # the TLS cert and private key, respectively. These have reasonable # defaults but can be customized if necessary. certName: tls.crt keyName: tls.key éƒ¨ç½²å‘½ä»¤å’Œ é€šè¿‡ helm éƒ¨ç½² vault ä¸€è‡´ï¼Œåªè¦æ›´æ¢ custom-values.yaml å°±è¡Œã€‚ vault-agent éƒ¨ç½²å®Œæˆåï¼Œç¬¬äºŒæ­¥æ˜¯ä¸º vault åˆ›å»º serviceAccountã€secret å’Œ ClusterRoleBindingï¼Œä»¥å…è®¸ vault å®¡æŸ¥ kubernetes çš„ token, å®Œæˆå¯¹ pod çš„èº«ä»½éªŒè¯. yaml é…ç½®å¦‚ä¸‹ï¼š yaml --- apiVersion: v1 kind: ServiceAccount metadata: name: vault-auth namespace: vault --- apiVersion: v1 kind: Secret metadata: name: vault-auth namespace: vault annotations: kubernetes.io/service-account.name: vault-auth type: kubernetes.io/service-account-token --- apiVersion: rbac.authorization.k8s.io/v1beta1 kind: ClusterRoleBinding metadata: name: role-tokenreview-binding roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: system:auth-delegator subjects: - kind: ServiceAccount name: vault-auth namespace: vault ç°åœ¨åœ¨ vault å®ä¾‹è¿™è¾¹ï¼Œå¯ç”¨ kubernetes èº«ä»½éªŒè¯ï¼Œåœ¨ vault å®ä¾‹å†…ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š vault å®ä¾‹å†…æ˜¾ç„¶æ²¡æœ‰ kubectl å’Œ kubeconfigï¼Œç®€ä¾¿èµ·è§ï¼Œä¸‹åˆ—çš„ vault å‘½ä»¤ä¹Ÿå¯ä»¥é€šè¿‡ Web UI å®Œæˆã€‚ shell export VAULT_TOKEN='' export VAULT_ADDR='http://localhost:8200' # å¯ç”¨ Kubernetes èº«ä»½éªŒè¯ vault auth enable kubernetes # kube-apiserver API é…ç½®ï¼Œvault éœ€è¦é€šè¿‡ kube-apiserver å®Œæˆå¯¹ serviceAccount çš„èº«ä»½éªŒè¯ # TOKEN_REVIEW_JWT: å°±æ˜¯æˆ‘ä»¬å‰é¢åˆ›å»ºçš„ secret `vault-auth` TOKEN_REVIEW_JWT=$(kubectl -n vault get secret vault-auth -o go-template='{{ .data.token }}' | base64 --decode) # kube-apiserver çš„ ca è¯ä¹¦ KUBE_CA_CERT=$(kubectl -n vault config view --raw --minify --flatten -o jsonpath='{.clusters[].cl","date":"2021-01-24","objectID":"/posts/experience-of-vault/:4:1","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/experience-of-vault/#11-ä½¿ç”¨é›†ç¾¤å¤–éƒ¨çš„-valut-å®ä¾‹"},{"categories":["tech"],"content":" 2. å…³è” k8s rbac æƒé™ç³»ç»Ÿå’Œ vaultæ¥ä¸‹æ¥éœ€è¦åšçš„äº‹ï¼š é€šè¿‡ vault policy å®šä¹‰å¥½æ¯ä¸ª roleï¼ˆå¾®æœåŠ¡ï¼‰èƒ½è®¿é—®å“ªäº›èµ„æºã€‚ ä¸ºæ¯ä¸ªå¾®æœåŠ¡ç”Ÿæˆä¸€ä¸ª roleï¼Œè¿™ä¸ª role éœ€è¦ç»‘å®šå¯¹åº”çš„ vault policy åŠ kubernetes serviceaccount è¿™ä¸ª role æ˜¯ vault çš„ kubernetes æ’ä»¶è‡ªèº«çš„å±æ€§ï¼Œå®ƒå’Œ kubernetes role æ²¡æœ‰åŠæ¯›é’±å…³ç³»ã€‚ åˆ›å»ºä¸€ä¸ª ServiceAccountï¼Œå¹¶ä½¿ç”¨è¿™ä¸ª ä½¿ç”¨è¿™ä¸ª ServiceAccount éƒ¨ç½²å¾®æœåŠ¡ å…¶ä¸­ç¬¬ä¸€æ­¥å’Œç¬¬äºŒæ­¥éƒ½å¯ä»¥é€šè¿‡ vault api è‡ªåŠ¨åŒ–å®Œæˆ. ç¬¬ä¸‰æ­¥å¯ä»¥é€šè¿‡ kubectl éƒ¨ç½²æ—¶å®Œæˆã€‚ æ–¹ä¾¿èµ·è§ï¼Œvault policy / role / k8s serviceaccount è¿™ä¸‰ä¸ªé…ç½®ï¼Œéƒ½å»ºè®®å’Œå¾®æœåŠ¡ä½¿ç”¨ç›¸åŒçš„åç§°ã€‚ ä¸Šè¿°é…ç½®ä¸­ï¼Œrole èµ·åˆ°ä¸€ä¸ªæ‰¿ä¸Šå¯ä¸‹çš„ä½œç”¨ï¼Œå®ƒå…³è”äº† k8s serviceaccount å’Œ vault policy ä¸¤ä¸ªé…ç½®ã€‚ æ¯”å¦‚åˆ›å»ºä¸€ä¸ªåä¸º my-app-policy çš„ vault policyï¼Œå†…å®¹ä¸º: hcl # å…è®¸è¯»å–æ•°æ® path \"my-app/data/*\" { capabilities = [\"read\", \"list\"] } // å…è®¸åˆ—å‡º myapp ä¸­çš„æ‰€æœ‰æ•°æ®(kv v2) path \"myapp/metadata/*\" { capabilities = [\"read\", \"list\"] } ç„¶ååœ¨ vault çš„ kubernetes æ’ä»¶é…ç½®ä¸­ï¼Œåˆ›å»º role my-app-roleï¼Œé…ç½®å¦‚ä¸‹: å…³è” k8s default åå­—ç©ºé—´ä¸­çš„ serviceaccount my-app-accountï¼Œå¹¶åˆ›å»ºå¥½è¿™ä¸ª serviceaccount. å…³è” vault token policyï¼Œè¿™å°±æ˜¯å‰é¢åˆ›å»ºçš„ my-app-policy è®¾ç½® token periodï¼ˆæœ‰æ•ˆæœŸï¼‰ è¿™ä¹‹åï¼Œæ¯ä¸ªå¾®æœåŠ¡å°±èƒ½é€šè¿‡ serviceaccount ä» vault ä¸­è¯»å– my-app ä¸­çš„æ‰€æœ‰ä¿¡æ¯äº†ã€‚ ","date":"2021-01-24","objectID":"/posts/experience-of-vault/:4:2","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/experience-of-vault/#2-å…³è”-k8s-rbac-æƒé™ç³»ç»Ÿå’Œ-vault"},{"categories":["tech"],"content":" 3. éƒ¨ç½² Pod å‚è€ƒæ–‡æ¡£ï¼šhttps://www.vaultproject.io/docs/platform/k8s/injector ä¸‹ä¸€æ­¥å°±æ˜¯å°†é…ç½®æ³¨å…¥åˆ°å¾®æœåŠ¡å®¹å™¨ä¸­ï¼Œè¿™éœ€è¦ä½¿ç”¨åˆ° Agent Sidecar Injectorã€‚vault é€šè¿‡ sidecar å®ç°é…ç½®çš„è‡ªåŠ¨æ³¨å…¥ä¸åŠ¨æ€æ›´æ–°ã€‚ å…·ä½“è€Œè¨€å°±æ˜¯åœ¨ Pod ä¸ŠåŠ ä¸Šä¸€å † Agent Sidecar Injector çš„æ³¨è§£ï¼Œå¦‚æœé…ç½®æ¯”è¾ƒå¤šï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ configmap ä¿å­˜ï¼Œåœ¨æ³¨è§£ä¸­å¼•ç”¨ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ vault-inject-agent æœ‰ä¸¤ç§è¿è¡Œæ¨¡å¼ï¼š init æ¨¡å¼: ä»…åœ¨ Pod å¯åŠ¨å‰åˆå§‹åŒ–ä¸€æ¬¡ï¼Œè·‘å®Œå°±é€€å‡ºï¼ˆCompletedï¼‰ å¸¸é©»æ¨¡å¼: å®¹å™¨ä¸é€€å‡ºï¼ŒæŒç»­ç›‘æ§ vault çš„é…ç½®æ›´æ–°ï¼Œç»´æŒ Pod é…ç½®å’Œ vualt é…ç½®çš„åŒæ­¥ã€‚ ç¤ºä¾‹ï¼š yaml apiVersion: apps/v1 kind: Deployment metadata: labels: app: my-app name: my-app namespace: default spec: minReadySeconds: 3 progressDeadlineSeconds: 60 revisionHistoryLimit: 3 selector: matchLabels: app: my-app strategy: rollingUpdate: maxUnavailable: 1 type: RollingUpdate template: metadata: annotations: vault.hashicorp.com/agent-init-first: \"true\" # æ˜¯å¦ä½¿ç”¨ initContainer æå‰åˆå§‹åŒ–é…ç½®æ–‡ä»¶ vault.hashicorp.com/agent-inject: \"true\" vault.hashicorp.com/secret-volume-path: vault vault.hashicorp.com/role: \"my-app-role\" # vault kubernetes æ’ä»¶çš„ role åç§° vault.hashicorp.com/agent-inject-template-config.json: | # æ¸²æŸ“æ¨¡æ¿çš„è¯­æ³•åœ¨åé¢ä»‹ç» vault.hashicorp.com/agent-limits-cpu: 250m vault.hashicorp.com/agent-requests-cpu: 100m # åŒ…å« vault é…ç½®çš„ configmapï¼Œå¯ä»¥åšæ›´ç²¾ç»†çš„æ§åˆ¶ # vault.hashicorp.com/agent-configmap: my-app-vault-config labels: app: my-app spec: containers: - image: registry.svc.local/xx/my-app:latest imagePullPolicy: IfNotPresent # æ­¤å¤„çœç•¥è‹¥å¹²é…ç½®... serviceAccountName: my-app-account å¸¸è§é”™è¯¯ï¼š vault-agent(sidecar) æŠ¥é”™: namespace not authorized auth/kubernetes/config ä¸­çš„ role æ²¡æœ‰ç»‘å®š Pod çš„ namespace vault-agent(sidecar) æŠ¥é”™: permission denied æ£€æŸ¥ vault å®ä¾‹çš„æ—¥å¿—ï¼Œåº”è¯¥æœ‰å¯¹åº”çš„é”™è¯¯æ—¥å¿—ï¼Œå¾ˆå¯èƒ½æ˜¯ auth/kubernetes/config æ²¡é…å¯¹ï¼Œvault æ— æ³•éªŒè¯ kube-apiserver çš„ tls è¯ä¹¦ï¼Œæˆ–è€…ä½¿ç”¨çš„ kubernetes token æ²¡æœ‰æƒé™ã€‚ vault-agent(sidecar) æŠ¥é”™: service account not authorized auth/kubernetes/config ä¸­çš„ role æ²¡æœ‰ç»‘å®š Pod ä½¿ç”¨çš„ serviceAccount ","date":"2021-01-24","objectID":"/posts/experience-of-vault/:4:3","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/experience-of-vault/#3-éƒ¨ç½²-pod"},{"categories":["tech"],"content":" 4. vault agent é…ç½®vault-agent çš„é…ç½®ï¼Œéœ€è¦æ³¨æ„çš„æœ‰ï¼š å¦‚æœä½¿ç”¨ configmap æä¾›å®Œæ•´çš„ config.hcl é…ç½®ï¼Œæ³¨æ„ agent-init vautl-agent çš„ template è¯´æ˜ï¼š ç›®å‰æ¥è¯´æœ€æµè¡Œçš„é…ç½®æ–‡ä»¶æ ¼å¼åº”è¯¥æ˜¯ json/yamlï¼Œä»¥ json ä¸ºä¾‹ï¼Œå¯¹æ¯ä¸ªå¾®æœåŠ¡çš„ kv æ•°æ®ï¼Œå¯ä»¥è€ƒè™‘å°†å®ƒæ‰€æœ‰çš„ä¸ªæ€§åŒ–é…ç½®éƒ½ä¿å­˜åœ¨ \u003cengine-name\u003e/\u003cservice-name\u003e/ ä¸‹é¢ï¼Œç„¶åä½¿ç”¨å¦‚ä¸‹ template æ³¨å…¥é…ç½®ï¼š consul-template { {{ range secrets \"\u003cengine-name\u003e/metadata/\u003cservice-name\u003e/\" }} \"{{ printf \"%s\" . }}\": {{ with secret (printf \"\u003cengine-name\u003e/\u003cservice-name\u003e/%s\" .) }} {{ .Data.data | toJSONPretty }}, {{ end }} {{ end }} } template çš„è¯¦ç»†è¯­æ³•å‚è§: https://github.com/hashicorp/consul-template#secret æ³¨æ„ï¼šv2 ç‰ˆæœ¬çš„ kv secretsï¼Œå®ƒçš„ list æ¥å£æœ‰å˜æ›´ï¼Œå› æ­¤åœ¨éå† v2 kv secrets æ—¶ï¼Œå¿…é¡»è¦å†™æˆ range secrets \"\u003cengine-name\u003e/metadata/\u003cservice-name\u003e/\"ï¼Œä¹Ÿå°±æ˜¯ä¸­é—´è¦æ’å…¥metadataï¼Œè€Œä¸” policy ä¸­å¿…é¡»å¼€æ”¾ \u003cengine-name\u003e/metadata/\u003cservice-name\u003e/ çš„ read/list æƒé™ï¼å®˜æ–¹æ–‡æ¡£å®Œå…¨æ²¡æåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘é€šè¿‡ wireshark æŠ“åŒ…è°ƒè¯•ï¼Œå¯¹ç…§å®˜æ–¹çš„KV Secrets Engine - Version 2 (API) æ‰ææ˜ç™½è¿™ä¸ªã€‚ è¿™æ ·ç”Ÿæˆå‡ºæ¥çš„å†…å®¹å°†æ˜¯ json æ ¼å¼ï¼Œä¸è¿‡æœ‰ä¸ªä¸å…¼å®¹çš„åœ°æ–¹ï¼šæœ€åä¸€ä¸ª secrets çš„æœ«å°¾æœ‰é€—å· , æ¸²æŸ“å‡ºçš„æ•ˆæœç¤ºä¾‹ï¼š json { \"secret-a\": { \"a\": \"b\", \"c\": \"d\" }, \"secret-b\": { \"v\": \"g\", \"r\": \"c\" } } å› ä¸ºå­˜åœ¨å°¾éƒ¨é€—å·(trailing comma)ï¼Œç›´æ¥ä½¿ç”¨ json æ ‡å‡†åº“è§£æå®ƒä¼šæŠ¥é”™ã€‚é‚£è¯¥å¦‚ä½•å»è§£æå®ƒå‘¢ï¼Ÿæˆ‘åœ¨ä¸‡èƒ½çš„ stackoverflow ä¸Šæ‰¾åˆ°äº†è§£å†³æ–¹æ¡ˆï¼šyaml å®Œå…¨å…¼å®¹ json è¯­æ³•ï¼Œå¹¶ä¸”æ”¯æŒå°¾éƒ¨é€—å·ï¼ ä»¥ python ä¸ºä¾‹ï¼Œç›´æ¥ yaml.safe_load() å°±èƒ½å®Œç¾è§£æ vault ç”Ÿæˆå‡ºçš„ json å†…å®¹ã€‚ ","date":"2021-01-24","objectID":"/posts/experience-of-vault/:4:4","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/experience-of-vault/#4-vault-agent-é…ç½®"},{"categories":["tech"],"content":" 5. æ‹“å±•ï¼šåœ¨ kubernetes ä¸­ä½¿ç”¨ vault çš„å…¶ä»–å§¿åŠ¿é™¤äº†ä½¿ç”¨å®˜æ–¹æä¾›çš„ sidecar æ¨¡å¼è¿›è¡Œ secrets æ³¨å…¥ï¼Œç¤¾åŒºä¹Ÿæä¾›äº†ä¸€äº›åˆ«çš„æ–¹æ¡ˆï¼Œå¯ä»¥å‚è€ƒï¼š hashicorp/vault-csi-provider: å®˜æ–¹çš„ Beta é¡¹ç›®ï¼Œé€šè¿‡ Secrets Store CSI é©±åŠ¨å°† vault secrets ä»¥æ•°æ®å·çš„å½¢å¼æŒ‚è½½åˆ° pod ä¸­ kubernetes-external-secrets: æä¾› CRD å®šä¹‰ï¼Œæ ¹æ®å®šä¹‰å°† secret ä» vault ä¸­åŒæ­¥åˆ° kubernetes secrets å®˜æ–¹çš„ sidecar/init-container æ¨¡å¼ä»ç„¶æ˜¯æœ€æ¨èä½¿ç”¨çš„ã€‚ ","date":"2021-01-24","objectID":"/posts/experience-of-vault/:4:5","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/experience-of-vault/#5-æ‹“å±•åœ¨-kubernetes-ä¸­ä½¿ç”¨-vault-çš„å…¶ä»–å§¿åŠ¿"},{"categories":["tech"],"content":" äº”ã€ä½¿ç”¨ vault å®ç° AWS IAM Credentials çš„è‡ªåŠ¨è½®è½¬å¾…ç»­ã€‚ã€‚ã€‚ ","date":"2021-01-24","objectID":"/posts/experience-of-vault/:5:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦","äº‘åŸç”Ÿç›¸å…³"],"tags":["Vault","äº‘åŸç”Ÿ","Secrets","é…ç½®","é…ç½®ç®¡ç†"],"title":"secrets ç®¡ç†å·¥å…· Vault çš„ä»‹ç»ã€å®‰è£…åŠä½¿ç”¨","uri":"/posts/experience-of-vault/#äº”ä½¿ç”¨-vault-å®ç°-aws-iam-credentials-çš„è‡ªåŠ¨è½®è½¬"},{"categories":["tech"],"content":" QEMU/KVM è™šæ‹ŸåŒ– QEMU/KVM æœ‰ä¸€å®šçš„ä½¿ç”¨é—¨æ§›ï¼Œæœ¬æ–‡å‡è®¾ä½ å·²ç»æ‹¥æœ‰åŸºç¡€çš„è™šæ‹ŸåŒ–ç›¸å…³çŸ¥è¯†ï¼Œæœ€å¥½æ˜¯å·²ç»æœ‰ virtualbox æˆ– vmware workstation çš„ä½¿ç”¨ç»éªŒã€‚ ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:1:0","series":null,"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt"],"title":"QEMU/KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/#qemukvm-è™šæ‹ŸåŒ–"},{"categories":["tech"],"content":" å‰è¨€è™šæ‹Ÿæœºï¼ˆVirtual Machineï¼‰æ˜¯æŒ‡é€šè¿‡è½¯ä»¶æ¨¡æ‹Ÿçš„å…·æœ‰å®Œæ•´ç¡¬ä»¶ç³»ç»ŸåŠŸèƒ½çš„ã€è¿è¡Œåœ¨ä¸€ä¸ªå®Œå…¨éš”ç¦»ç¯å¢ƒä¸­çš„å®Œæ•´è®¡ç®—æœºç³»ç»Ÿã€‚å®ƒçš„ä¸»è¦ç”¨é€”æœ‰ï¼š æµ‹è¯•ã€å°é²œæ–°çš„æ“ä½œç³»ç»Ÿã€‚ å¿«é€Ÿåˆ›å»ºå®Œå…¨éš”ç¦»çš„æ²™ç®±ç¯å¢ƒï¼Œç”¨äºè¿è¡ŒæŸäº›ä¸å®‰å…¨çš„æˆ–è€…æ•æ„Ÿçš„æ–‡ä»¶/ç¨‹åºã€‚ äº‘æœåŠ¡å•†æˆ–ä¼ä¸šä¼šé€šè¿‡æœåŠ¡å™¨è™šæ‹ŸåŒ–ï¼Œæå‡æœåŠ¡å™¨çš„åˆ©ç”¨ç‡ã€‚ è™šæ‹Ÿæœºå¯ä»¥åˆ›å»ºå¿«ç…§è·Ÿå¤‡ä»½ï¼Œç³»ç»Ÿç¯å¢ƒå¯ä»¥éšæ—¶è¿˜åŸåˆ°æ—§çš„å¿«ç…§ï¼Œä¹Ÿèƒ½æ–¹ä¾¿åœ°æ‹·è´ç»™ä»–äººã€‚ è€Œ QEMU/KVM åˆ™æ˜¯ç›®å‰æœ€æµè¡Œçš„ä¼ä¸šçº§è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œå®ƒåŸºäº Linux å†…æ ¸æä¾›çš„ KVM æ¨¡å—ï¼Œç»“æ„ç²¾ç®€ï¼Œ æ€§èƒ½æŸå¤±å°ï¼Œè€Œä¸”å¼€æºå…è´¹ï¼Œå› æ­¤æˆäº†å¤§éƒ¨åˆ†ä¼ä¸šçš„é¦–é€‰è™šæ‹ŸåŒ–æ–¹æ¡ˆã€‚ ç›®å‰å„å¤§äº‘å‚å•†çš„è™šæ‹ŸåŒ–æ–¹æ¡ˆï¼Œæ–°çš„æœåŠ¡å™¨å®ä¾‹åŸºæœ¬éƒ½æ˜¯ç”¨çš„ KVM æŠ€æœ¯ã€‚å³ä½¿æ˜¯èµ·æ­¥æœ€æ—©ï¼Œä¸€ç›´é‡åº¦ä½¿ç”¨ Xen çš„ AWSï¼Œä» EC2 C5 å¼€å§‹å°±æ”¹ç”¨äº†åŸºäº KVM å®šåˆ¶çš„ Nitro è™šæ‹ŸåŒ–æŠ€æœ¯ã€‚ ä½†æ˜¯ KVM ä½œä¸ºä¸€ä¸ªä¼ä¸šçº§çš„åº•å±‚è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œå´æ²¡æœ‰å¯¹æ¡Œé¢ä½¿ç”¨åšæ·±å…¥çš„ä¼˜åŒ–ï¼Œå› æ­¤å¦‚æœæƒ³æŠŠå®ƒå½“æˆæ¡Œé¢è™šæ‹ŸåŒ–è½¯ä»¶æ¥ä½¿ç”¨ï¼Œæ›¿ä»£æ‰VirtualBox/VMware Workstationï¼Œ æœ‰ä¸€å®šéš¾åº¦ã€‚ æœ¬æ–‡æ˜¯æˆ‘ä¸ªäººå­¦ä¹  KVM çš„ä¸€ä¸ªæ€»ç»“æ€§æ–‡æ¡£ï¼Œå…¶ç›®æ ‡æ˜¯ä½¿ç”¨ KVM ä½œä¸ºæ¡Œé¢è™šæ‹ŸåŒ–è½¯ä»¶ã€‚ ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:2:0","series":null,"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt"],"title":"QEMU/KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/#å‰è¨€"},{"categories":["tech"],"content":" ä¸€ã€å®‰è£… QEMU/KVMQEMU/KVM ç¯å¢ƒéœ€è¦å®‰è£…å¾ˆå¤šçš„ç»„ä»¶ï¼Œå®ƒä»¬å„å¸å…¶èŒï¼š qemu: æ¨¡æ‹Ÿå„ç±»è¾“å…¥è¾“å‡ºè®¾å¤‡ï¼ˆç½‘å¡ã€ç£ç›˜ã€USBç«¯å£ç­‰ï¼‰ qemu åº•å±‚ä½¿ç”¨ kvm æ¨¡æ‹Ÿ CPU å’Œ RAMï¼Œæ¯”è½¯ä»¶æ¨¡æ‹Ÿçš„æ–¹å¼å¿«å¾ˆå¤šã€‚ libvirt: æä¾›ç®€å•ä¸”ç»Ÿä¸€çš„å·¥å…·å’Œ APIï¼Œç”¨äºç®¡ç†è™šæ‹Ÿæœºï¼Œå±è”½äº†åº•å±‚çš„å¤æ‚ç»“æ„ã€‚ï¼ˆæ”¯æŒ qemu-kvm/virtualbox/vmwareï¼‰ ovmf: ä¸ºè™šæ‹Ÿæœºå¯ç”¨ UEFI æ”¯æŒ virt-manager: ç”¨äºç®¡ç†è™šæ‹Ÿæœºçš„ GUI ç•Œé¢ï¼ˆå¯ä»¥ç®¡ç†è¿œç¨‹ kvm ä¸»æœºï¼‰ã€‚ virt-viewer: é€šè¿‡ GUI ç•Œé¢ç›´æ¥ä¸è™šæ‹Ÿæœºäº¤äº’ï¼ˆå¯ä»¥ç®¡ç†è¿œç¨‹ kvm ä¸»æœºï¼‰ã€‚ dnsmasq vde2 bridge-utils openbsd-netcat: ç½‘ç»œç›¸å…³ç»„ä»¶ï¼Œæä¾›äº†ä»¥å¤ªç½‘è™šæ‹ŸåŒ–ã€ç½‘ç»œæ¡¥æ¥ã€NATç½‘ç»œç­‰è™šæ‹Ÿç½‘ç»œåŠŸèƒ½ã€‚ dnsmasq æä¾›äº† NAT è™šæ‹Ÿç½‘ç»œçš„ DHCP åŠ DNS è§£æåŠŸèƒ½ã€‚ vde2: ä»¥å¤ªç½‘è™šæ‹ŸåŒ– bridge-utils: é¡¾åæ€ä¹‰ï¼Œæä¾›ç½‘ç»œæ¡¥æ¥ç›¸å…³çš„å·¥å…·ã€‚ openbsd-netcat: TCP/IP çš„ç‘å£«å†›åˆ€ï¼Œè¯¦è§socat \u0026 netcatï¼Œè¿™é‡Œä¸æ¸…æ¥šæ˜¯å“ªä¸ªç½‘ç»œç»„ä»¶ä¼šç”¨åˆ°å®ƒã€‚ å®‰è£…å‘½ä»¤ï¼š shell # archlinux/manjaro sudo pacman -S qemu virt-manager virt-viewer dnsmasq vde2 bridge-utils openbsd-netcat # ubuntu,å‚è€ƒäº†å®˜æ–¹æ–‡æ¡£ï¼Œä½†æœªæµ‹è¯• sudo apt install qemu-kvm libvirt-daemon-system virt-manager virt-viewer virtinst bridge-utils # centos,å‚è€ƒäº†å®˜æ–¹æ–‡æ¡£ï¼Œä½†æœªæµ‹è¯• sudo yum groupinstall \"Virtualization Host\" sudo yum install virt-manager virt-viewer virt-install # opensuse # see: https://doc.opensuse.org/documentation/leap/virtualization/html/book-virt/cha-vt-installation.html sudo yast2 virtualization # enter to terminal ui, select kvm + kvm tools, and then install it. å®‰è£…å®Œæˆåï¼Œè¿˜ä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œéœ€è¦åšäº›é¢å¤–çš„å·¥ä½œã€‚è¯·ç»§ç»­å¾€ä¸‹èµ°ã€‚ ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:3:0","series":null,"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt"],"title":"QEMU/KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/#ä¸€å®‰è£…-qemukvm"},{"categories":["tech"],"content":" 1. libguestfs - è™šæ‹Ÿæœºç£ç›˜æ˜ åƒå¤„ç†å·¥å…·libguestfs æ˜¯ä¸€ä¸ªè™šæ‹Ÿæœºç£ç›˜æ˜ åƒå¤„ç†å·¥å…·ï¼Œå¯ç”¨äºç›´æ¥ä¿®æ”¹/æŸ¥çœ‹/è™šæ‹Ÿæœºæ˜ åƒã€è½¬æ¢æ˜ åƒæ ¼å¼ç­‰ã€‚ å®ƒæä¾›çš„å‘½ä»¤åˆ—è¡¨å¦‚ä¸‹ï¼š virt-df centos.img: æŸ¥çœ‹ç¡¬ç›˜ä½¿ç”¨æƒ…å†µ virt-ls centos.img /: åˆ—å‡ºç›®å½•æ–‡ä»¶ virt-copy-out -d domain /etc/passwd /tmpï¼šåœ¨è™šæ‹Ÿæ˜ åƒä¸­æ‰§è¡Œæ–‡ä»¶å¤åˆ¶ virt-list-filesystems /file/xx.imgï¼šæŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿä¿¡æ¯ virt-list-partitions /file/xx.imgï¼šæŸ¥çœ‹åˆ†åŒºä¿¡æ¯ guestmount -a /file/xx.qcow2(raw/qcow2éƒ½æ”¯æŒ) -m /dev/VolGroup/lv_root --rw /mntï¼šç›´æ¥å°†åˆ†åŒºæŒ‚è½½åˆ°å®¿ä¸»æœº guestfish: äº¤äº’å¼ shellï¼Œå¯è¿è¡Œä¸Šè¿°æ‰€æœ‰å‘½ä»¤ã€‚ virt-v2v: å°†å…¶ä»–æ ¼å¼çš„è™šæ‹Ÿæœº(æ¯”å¦‚ ova) è½¬æ¢æˆ kvm è™šæ‹Ÿæœºã€‚ virt-p2v: å°†ä¸€å°ç‰©ç†æœºè½¬æ¢æˆè™šæ‹Ÿæœºã€‚ å­¦ä¹ è¿‡ç¨‹ä¸­å¯èƒ½ä¼šä½¿ç”¨åˆ°ä¸Šè¿°å‘½ä»¤ï¼Œæå‰å®‰è£…å¥½æ€»ä¸ä¼šæœ‰é”™ï¼Œå®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼š shell # opensuse sudo zypper install libguestfs # archlinux/manjaroï¼Œç›®å‰ç¼ºå°‘ virt-v2v/virt-p2v ç»„ä»¶ sudo pacman -S libguestfs # ubuntu sudo apt install libguestfs-tools # centos sudo yum install libguestfs-tools ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:3:1","series":null,"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt"],"title":"QEMU/KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/#1-libguestfs---è™šæ‹Ÿæœºç£ç›˜æ˜ åƒå¤„ç†å·¥å…·"},{"categories":["tech"],"content":" 2. å¯åŠ¨ QEMU/KVMé€šè¿‡ systemd å¯åŠ¨ libvirtd åå°æœåŠ¡ï¼š shell sudo systemctl enable libvirtd.service sudo systemctl start libvirtd.service ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:3:2","series":null,"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt"],"title":"QEMU/KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/#2-å¯åŠ¨-qemukvm"},{"categories":["tech"],"content":" 3. è®©é root ç”¨æˆ·èƒ½æ­£å¸¸ä½¿ç”¨ kvmqumu/kvm è£…å¥½åï¼Œé»˜è®¤æƒ…å†µä¸‹éœ€è¦ root æƒé™æ‰èƒ½æ­£å¸¸ä½¿ç”¨å®ƒã€‚ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œé¦–å…ˆç¼–è¾‘æ–‡ä»¶/etc/libvirt/libvirtd.conf: unix_sock_group = \"libvirt\"ï¼Œå–æ¶ˆè¿™ä¸€è¡Œçš„æ³¨é‡Šï¼Œä½¿ libvirt ç”¨æˆ·ç»„èƒ½ä½¿ç”¨ unix å¥—æ¥å­—ã€‚ unix_sock_rw_perms = \"0770\"ï¼Œå–æ¶ˆè¿™ä¸€è¡Œçš„æ³¨é‡Šï¼Œä½¿ç”¨æˆ·èƒ½è¯»å†™ unix å¥—æ¥å­—ã€‚ ç„¶åæ–°å»º libvirt ç”¨æˆ·ç»„ï¼Œå°†å½“å‰ç”¨æˆ·åŠ å…¥è¯¥ç»„ï¼š shell newgrp libvirt sudo usermod -aG libvirt $USER æœ€åé‡å¯ libvirtd æœåŠ¡ï¼Œåº”è¯¥å°±èƒ½æ­£å¸¸ä½¿ç”¨äº†ï¼š shell sudo systemctl restart libvirtd.service ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:3:3","series":null,"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt"],"title":"QEMU/KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/#3-è®©é-root-ç”¨æˆ·èƒ½æ­£å¸¸ä½¿ç”¨-kvm"},{"categories":["tech"],"content":" 3. å¯ç”¨åµŒå¥—è™šæ‹ŸåŒ–å¦‚æœä½ éœ€è¦åœ¨è™šæ‹Ÿæœºä¸­è¿è¡Œè™šæ‹Ÿæœºï¼ˆæ¯”å¦‚åœ¨è™šæ‹Ÿæœºé‡Œæµ‹è¯• katacontainers ç­‰å®‰å…¨å®¹å™¨æŠ€æœ¯ï¼‰ï¼Œé‚£å°±éœ€è¦å¯ç”¨å†…æ ¸æ¨¡å— kvm_intel æˆ– kvm_amd å®ç°åµŒå¥—è™šæ‹ŸåŒ–ã€‚ é¦–å…ˆé€šè¿‡å¦‚ä¸‹æŒ‡ä»¤éªŒè¯ä¸‹æ˜¯å¦å·²ç»å¯ç”¨äº†åµŒå¥—è™šæ‹ŸåŒ–ï¼ˆä¸€èˆ¬çš„å‘è¡Œç‰ˆé»˜è®¤éƒ½ä¸ä¼šå¯ç”¨ï¼‰ï¼š shell # intel ç”¨è¿™ä¸ªå‘½ä»¤ï¼Œè¾“å‡º Y åˆ™è¡¨ç¤ºå¯ç”¨äº†åµŒå¥—è™šæ‹ŸåŒ– cat /sys/module/kvm_intel/parameters/nested # amd ç”¨å¦‚ä¸‹æŒ‡ä»¤ï¼Œè¾“å‡º 1 åˆ™è¡¨ç¤ºå¯ç”¨äº†åµŒå¥—è™šæ‹ŸåŒ– cat /sys/module/kvm_amd/parameters/nested å¦‚æœè¾“å‡ºä¸æ˜¯ Y/1ï¼Œè¯´æ˜é»˜è®¤æœªå¯ç”¨åµŒå¥—è™šæ‹ŸåŒ–ï¼Œéœ€è¦æ‰‹åŠ¨å¯ç”¨ï¼Œæ­¥éª¤å¦‚ä¸‹ã€‚ å¦‚æœæ˜¯ intel cpuï¼Œéœ€è¦ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯ç”¨åµŒå¥—è™šæ‹ŸåŒ–åŠŸèƒ½ï¼š shell ## 1. å…³é—­æ‰€æœ‰è™šæ‹Ÿæœºï¼Œå¹¶å¸è½½ kvm_intel å†…æ ¸æ¨¡å— sudo modprobe -r kvm_intel ## 2. å¯ç”¨åµŒå¥—è™šæ‹ŸåŒ–åŠŸèƒ½ sudo modprobe kvm_intel nested=1 ## 3. ä¿å­˜é…ç½®ï¼Œä½¿åµŒå¥—è™šæ‹ŸåŒ–åŠŸèƒ½åœ¨é‡å¯åè‡ªåŠ¨å¯ç”¨ cat \u003c\u003cEOF | sudo tee /etc/modprobe.d/kvm.conf options kvm_intel nested=1 EOF å¦‚æœæ˜¯ amd cpuï¼Œåˆ™åº”ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯ç”¨åµŒå¥—è™šæ‹ŸåŒ–åŠŸèƒ½ï¼š shell ## 1. å…³é—­æ‰€æœ‰è™šæ‹Ÿæœºï¼Œå¹¶å¸è½½ kvm_intel å†…æ ¸æ¨¡å— sudo modprobe -r kvm_amd ## 2. å¯ç”¨åµŒå¥—è™šæ‹ŸåŒ–åŠŸèƒ½ sudo modprobe kvm_amd nested=1 ## 3. ä¿å­˜é…ç½®ï¼Œä½¿åµŒå¥—è™šæ‹ŸåŒ–åŠŸèƒ½åœ¨é‡å¯åè‡ªåŠ¨å¯ç”¨ cat \u003c\u003cEOF | sudo tee /etc/modprobe.d/kvm.conf options kvm_amd nested=1 EOF æ”¹å®Œåå†åˆ©ç”¨å‰é¢æåˆ°çš„å‘½ä»¤éªŒè¯ä¸‹æ˜¯å¦å¯ç”¨æˆåŠŸã€‚ è‡³æ­¤ï¼ŒKVM çš„å®‰è£…å°±å¤§åŠŸå‘Šæˆå•¦ï¼Œç°åœ¨åº”è¯¥å¯ä»¥åœ¨ç³»ç»Ÿä¸­æ‰¾åˆ° virt-manager çš„å›¾æ ‡ï¼Œè¿›å»å°±å¯ä»¥ä½¿ç”¨äº†ã€‚virt-manager çš„ä½¿ç”¨æ–¹æ³•å’Œ virtualbox/vmware workstation å¤§åŒå°å¼‚ï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†ä»‹ç»äº†ï¼Œ è‡ªå·±æ‘¸ç´¢æ‘¸ç´¢åº”è¯¥å°±ä¼šäº†ã€‚ å¦‚ä¸‹å†…å®¹æ˜¯è¿›é˜¶ç¯‡ï¼Œä¸»è¦ä»‹ç»å¦‚ä½•é€šè¿‡å‘½ä»¤è¡Œæ¥ç®¡ç†è™šæ‹Ÿæœºç£ç›˜ï¼Œä»¥åŠ KVMã€‚å¦‚æœä½ è¿˜æ˜¯ kvm æ–°æ‰‹ï¼Œå»ºè®®å…ˆé€šè¿‡å›¾å½¢ç•Œé¢ virt-manager ç†Ÿæ‚‰ç†Ÿæ‚‰ï¼Œå†å¾€ä¸‹ç»§ç»­è¯»ã€‚ ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:3:4","series":null,"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt"],"title":"QEMU/KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/#3-å¯ç”¨åµŒå¥—è™šæ‹ŸåŒ–"},{"categories":["tech"],"content":" äºŒã€è™šæ‹Ÿæœºç£ç›˜æ˜ åƒç®¡ç†è¿™éœ€è¦ç”¨åˆ°ä¸¤ä¸ªå·¥å…·ï¼š libguestfs: è™šæ‹Ÿæœºç£ç›˜æ˜ åƒç®¡ç†å·¥å…·ï¼Œå‰é¢ä»‹ç»è¿‡äº† qemu-img: qemu çš„ç£ç›˜æ˜ åƒç®¡ç†å·¥å…·ï¼Œç”¨äºåˆ›å»ºç£ç›˜ã€æ‰©ç¼©å®¹ç£ç›˜ã€ç”Ÿæˆç£ç›˜å¿«ç…§ã€æŸ¥çœ‹ç£ç›˜ä¿¡æ¯ã€è½¬æ¢ç£ç›˜æ ¼å¼ç­‰ç­‰ã€‚ shell # åˆ›å»ºç£ç›˜ qemu-img create -f qcow2 -o cluster_size=128K virt_disk.qcow2 20G # æ‰©å®¹ç£ç›˜ qemu-img resize ubuntu-server-cloudimg-amd64.img 30G # æŸ¥çœ‹ç£ç›˜ä¿¡æ¯ qemu-img info ubuntu-server-cloudimg-amd64.img # è½¬æ¢ç£ç›˜æ ¼å¼ qemu-img convert -f raw -O qcow2 vm01.img vm01.qcow2 # raw =\u003e qcow2 qemu-img convert -f qcow2 -O raw vm01.qcow2 vm01.img # qcow2 =\u003e raw ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:4:0","series":null,"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt"],"title":"QEMU/KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/#äºŒè™šæ‹Ÿæœºç£ç›˜æ˜ åƒç®¡ç†"},{"categories":["tech"],"content":" 1. å¯¼å…¥ vmware é•œåƒç›´æ¥ä» vmware ova æ–‡ä»¶å¯¼å…¥ kvmï¼Œè¿™ç§æ–¹å¼è½¬æ¢å¾—åˆ°çš„é•œåƒåº”è¯¥èƒ½ç›´æ¥ç”¨ï¼ˆç½‘å¡éœ€è¦é‡æ–°é…ç½®ï¼‰ï¼š shell virt-v2v -i ova centos7-test01.ova -o local -os /vmhost/centos7-01 -of qcow2 ä¹Ÿå¯ä»¥å…ˆä» ova ä¸­è§£å‹å‡º vmdk ç£ç›˜æ˜ åƒï¼Œå°† vmware çš„ vmdk æ–‡ä»¶è½¬æ¢æˆ qcow2 æ ¼å¼ï¼Œç„¶åå†å¯¼å…¥ kvmï¼ˆç½‘å¡éœ€è¦é‡æ–°é…ç½®ï¼‰ï¼š shell # è½¬æ¢æ˜ åƒæ ¼å¼ qemu-img convert -p -f vmdk -O qcow2 centos7-test01-disk1.vmdk centos7-test01.qcow2 # æŸ¥çœ‹è½¬æ¢åçš„æ˜ åƒä¿¡æ¯ qemu-img info centos7-test01.qcow2 ç›´æ¥è½¬æ¢ vmdk æ–‡ä»¶å¾—åˆ°çš„ qcow2 é•œåƒï¼Œå¯ä¼šæŠ¥é”™ï¼Œæ¯”å¦‚ã€Œç£ç›˜æ— æ³•æŒ‚è½½ã€ã€‚æ ¹æ®Importing Virtual Machines and disk images - ProxmoxVE Docs æ–‡æ¡£æ‰€è¨€ï¼Œéœ€è¦åœ¨ç½‘ä¸Šä¸‹è½½å®‰è£… MergeIDE.zip ç»„ä»¶ï¼Œå¦å¤–å¯åŠ¨è™šæ‹Ÿæœºå‰ï¼Œéœ€è¦å°†ç¡¬ç›˜ç±»å‹æ”¹ä¸º IDEï¼Œ æ‰èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:4:1","series":null,"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt"],"title":"QEMU/KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/#1-å¯¼å…¥-vmware-é•œåƒ"},{"categories":["tech"],"content":" 2. å¯¼å…¥ img é•œåƒimg é•œåƒæ–‡ä»¶ï¼Œå°±æ˜¯æ‰€è°“çš„ raw æ ¼å¼é•œåƒï¼Œä¹Ÿè¢«ç§°ä¸ºè£¸é•œåƒï¼ŒIO é€Ÿåº¦æ¯” qcow2 å¿«ï¼Œä½†æ˜¯ä½“ç§¯å¤§ï¼Œè€Œä¸”ä¸æ”¯æŒå¿«ç…§ç­‰é«˜çº§ç‰¹æ€§ã€‚å¦‚æœä¸è¿½æ±‚ IO æ€§èƒ½çš„è¯ï¼Œå»ºè®®å°†å®ƒè½¬æ¢æˆ qcow2 å†ä½¿ç”¨ã€‚ shell qemu-img convert -f raw -O qcow2 vm01.img vm01.qcow2 ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:4:2","series":null,"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt"],"title":"QEMU/KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/#2-å¯¼å…¥-img-é•œåƒ"},{"categories":["tech"],"content":" ä¸‰ã€è™šæ‹Ÿæœºç®¡ç†è™šæ‹Ÿæœºç®¡ç†å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…· virsh/virt-installï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ GUI å·¥å…· virt-manager. GUI å¾ˆå‚»ç“œå¼ï¼Œå°±ä¸ä»‹ç»äº†ï¼Œè¿™é‡Œä¸»è¦ä»‹ç»å‘½ä»¤è¡Œå·¥å…· virsh/virt-install å…ˆä»‹ç»ä¸‹ libvirt ä¸­çš„å‡ ä¸ªæ¦‚å¿µï¼š Domain: æŒ‡ä»£è¿è¡Œåœ¨è™šæ‹Ÿæœºå™¨ä¸Šçš„æ“ä½œç³»ç»Ÿçš„å®ä¾‹ - ä¸€ä¸ªè™šæ‹Ÿæœºï¼Œæˆ–è€…ç”¨äºå¯åŠ¨è™šæ‹Ÿæœºçš„é…ç½®ã€‚ Guest OS: è¿è¡Œåœ¨ domain ä¸­çš„è™šæ‹Ÿæ“ä½œç³»ç»Ÿã€‚ å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä½ éƒ½å¯ä»¥æŠŠä¸‹é¢å‘½ä»¤ä¸­æ¶‰åŠåˆ°çš„ domain ç†è§£æˆè™šæ‹Ÿæœºã€‚ ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:5:0","series":null,"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt"],"title":"QEMU/KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/#ä¸‰è™šæ‹Ÿæœºç®¡ç†"},{"categories":["tech"],"content":" 0. è®¾ç½®é»˜è®¤ URIvirsh/virt-install/virt-viewer ç­‰ä¸€ç³»åˆ— libvirt å‘½ä»¤ï¼Œsudo virsh net-list â€“all é»˜è®¤æƒ…å†µä¸‹ä¼šä½¿ç”¨ qemu:///session ä½œä¸º URI å»è¿æ¥ QEMU/KVMï¼Œåªæœ‰ root è´¦å·æ‰ä¼šé»˜è®¤ä½¿ç”¨qemu:///system. å¦ä¸€æ–¹é¢ virt-manager è¿™ä¸ª GUI å·¥å…·ï¼Œé»˜è®¤ä¹Ÿä¼šä½¿ç”¨ qemu:///system å»è¿æ¥ QEMU/KVMï¼ˆå’Œ root è´¦å·ä¸€è‡´ï¼‰ qemu:///system æ˜¯ç³»ç»Ÿå…¨å±€çš„ qemu ç¯å¢ƒï¼Œè€Œ qemu:///session çš„ç¯å¢ƒæ˜¯æŒ‰ç”¨æˆ·éš”ç¦»çš„ã€‚å¦å¤–qemu:///session æ²¡æœ‰é»˜è®¤çš„ networkï¼Œåˆ›å»ºè™šæ‹Ÿæœºæ—¶ä¼šå‡ºæ¯›ç—…ã€‚ã€‚ã€‚ å› æ­¤ï¼Œä½ éœ€è¦å°†é»˜è®¤çš„ URI æ”¹ä¸º qemu:///systemï¼Œå¦åˆ™ç»å¯¹ä¼šè¢«å‘: shell echo 'export LIBVIRT_DEFAULT_URI=\"qemu:///system\"' \u003e\u003e ~/.bashrc ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:5:1","series":null,"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt"],"title":"QEMU/KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/#0-è®¾ç½®é»˜è®¤-uri"},{"categories":["tech"],"content":" 1. è™šæ‹Ÿæœºç½‘ç»œqemu-kvm å®‰è£…å®Œæˆåï¼Œqemu:///system ç¯å¢ƒä¸­é»˜è®¤ä¼šåˆ›å»ºä¸€ä¸ª default ç½‘ç»œï¼Œè€Œqemu:///session ä¸æä¾›é»˜è®¤çš„ç½‘ç»œï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»ºã€‚ æˆ‘ä»¬é€šå¸¸ä½¿ç”¨ qemu:///system ç¯å¢ƒå°±å¥½ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•æŸ¥çœ‹å¹¶å¯åŠ¨ default ç½‘ç»œï¼Œè¿™æ ·åé¢åˆ›å»ºè™šæ‹Ÿæœºæ—¶æ‰æœ‰ç½‘ç»œå¯ç”¨ã€‚ shell # åˆ—å‡ºæ‰€æœ‰è™šæ‹Ÿæœºç½‘ç»œ $ sudo virsh net-list --all Name State Autostart Persistent ---------------------------------------------- default inactive no yes # å¯åŠ¨é»˜è®¤ç½‘ç»œ $ virsh net-start default Network default started # å°† default ç½‘ç»œè®¾ä¸ºè‡ªå¯åŠ¨ $ virsh net-autostart --network default Network default marked as autostarted # å†æ¬¡æ£€æŸ¥ç½‘ç»œçŠ¶å†µï¼Œå·²ç»æ˜¯ active äº† $ sudo virsh net-list --all Name State Autostart Persistent -------------------------------------------- default active yes yes ä¹Ÿå¯ä»¥åˆ›å»ºæ–°çš„è™šæ‹Ÿæœºç½‘ç»œï¼Œè¿™éœ€è¦æ‰‹åŠ¨ç¼–å†™ç½‘ç»œçš„ xml é…ç½®ï¼Œç„¶åé€šè¿‡virsh net-define --file my-network.xml åˆ›å»ºï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†ä»‹ç»äº†ï¼Œå› ä¸ºæš‚æ—¶ç”¨ä¸åˆ°â€¦ ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:5:2","series":null,"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt"],"title":"QEMU/KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/#1-è™šæ‹Ÿæœºç½‘ç»œ"},{"categories":["tech"],"content":" 2. åˆ›å»ºè™šæ‹Ÿæœº - virt-install shell # ä½¿ç”¨ iso é•œåƒåˆ›å»ºå…¨æ–°çš„ proxmox è™šæ‹Ÿæœºï¼Œè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª 60G çš„ç£ç›˜ã€‚ virt-install --virt-type kvm \\ --name pve-1 \\ --vcpus 4 --memory 8096 \\ --disk size=60 \\ --network network=default,model=virtio \\ --os-type linux \\ --os-variant generic \\ --graphics vnc \\ --cdrom proxmox-ve_6.3-1.iso # ä½¿ç”¨å·²å­˜åœ¨çš„ opensuse cloud ç£ç›˜åˆ›å»ºè™šæ‹Ÿæœº virt-install --virt-type kvm \\ --name opensuse15-2 \\ --vcpus 2 --memory 2048 \\ --disk opensuse15.2-openstack.qcow2,device=disk,bus=virtio \\ --disk seed.iso,device=cdrom \\ --os-type linux \\ --os-variant opensuse15.2 \\ --network network=default,model=virtio \\ --graphics vnc \\ --import å…¶ä¸­çš„ --os-variant ç”¨äºè®¾å®š OS ç›¸å…³çš„ä¼˜åŒ–é…ç½®ï¼Œå®˜æ–¹æ–‡æ¡£å¼ºçƒˆæ¨èè®¾å®šï¼Œå…¶å¯é€‰å‚æ•°å¯ä»¥é€šè¿‡ osinfo-query os æŸ¥çœ‹ã€‚ ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:5:3","series":null,"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt"],"title":"QEMU/KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/#2-åˆ›å»ºè™šæ‹Ÿæœº---virt-install"},{"categories":["tech"],"content":" 3. è™šæ‹Ÿæœºç®¡ç† - virshè™šæ‹Ÿæœºåˆ›å»ºå¥½åï¼Œå¯ä½¿ç”¨ virsh ç®¡ç†è™šæ‹Ÿæœºã€‚ é¦–å…ˆä»‹ç»ä¸‡èƒ½çš„å¸®åŠ©å‘½ä»¤ï¼š shell virsh help é™¤äº†å®˜æ–¹çš„ help ä¹‹å¤–ï¼Œæˆ‘ä¹Ÿæ€»ç»“äº†ä¸‹ virsh çš„å¸¸ç”¨å‘½ä»¤ï¼Œå¦‚ä¸‹ã€‚ æŸ¥çœ‹è™šæ‹Ÿæœºåˆ—è¡¨ï¼š text # æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„è™šæ‹Ÿæœº virsh list # æŸ¥çœ‹æ‰€æœ‰è™šæ‹Ÿæœºï¼ŒåŒ…æ‹¬ inactive çš„è™šæ‹Ÿæœº virsh list --all ä½¿ç”¨ virt-viewer ä»¥ vnc åè®®ç™»å…¥è™šæ‹Ÿæœºç»ˆç«¯ï¼š shell # ä½¿ç”¨è™šæ‹Ÿæœº ID è¿æ¥ virt-viewer 8 # ä½¿ç”¨è™šæ‹Ÿæœºåç§°è¿æ¥ï¼Œå¹¶ä¸”ç­‰å¾…è™šæ‹Ÿæœºå¯åŠ¨ virt-viewer --wait opensuse15 å¯åŠ¨ã€å…³é—­ã€æš‚åœ(ä¼‘çœ )ã€é‡å¯è™šæ‹Ÿæœºï¼š shell virsh start opensuse15 virsh suspend opensuse15 virsh resume opensuse15 virsh reboot opensuse15 # ä¼˜é›…å…³æœº virsh shutdown opensuse15 # å¼ºåˆ¶å…³æœº virsh destroy opensuse15 # å¯ç”¨è‡ªåŠ¨å¼€æœº virsh autostart opensuse15 # ç¦ç”¨è‡ªåŠ¨å¼€æœº virsh autostart --disable opensuse15 è™šæ‹Ÿæœºå¿«ç…§ç®¡ç†ï¼š shell # åˆ—å‡ºä¸€ä¸ªè™šæ‹Ÿæœºçš„æ‰€æœ‰å¿«ç…§ virsh snapshot-list --domain opensuse15 # ç»™æŸä¸ªè™šæ‹Ÿæœºç”Ÿæˆä¸€ä¸ªæ–°å¿«ç…§ virsh snapshot-create \u003cdomain\u003e # ä½¿ç”¨å¿«ç…§å°†è™šæ‹Ÿæœºè¿˜åŸ virsh snapshot-restore \u003cdomain\u003e \u003csnapshotname\u003e # åˆ é™¤å¿«ç…§ virsh snapshot-delete \u003cdomain\u003e \u003csnapshotname\u003e åˆ é™¤è™šæ‹Ÿæœºï¼š shell virsh undefine opensuse15 è¿ç§»è™šæ‹Ÿæœºï¼š shell # ä½¿ç”¨é»˜è®¤å‚æ•°è¿›è¡Œç¦»çº¿è¿ç§»ï¼Œå°†å·²å…³æœºçš„æœåŠ¡å™¨è¿ç§»åˆ°å¦ä¸€ä¸ª qemu å®ä¾‹ virsh migrate 37 qemu+ssh://tux@jupiter.example.com/system # è¿˜æ”¯æŒåœ¨çº¿å®æ—¶è¿ç§»ï¼Œå¾…ç»­ cpu/å†…å­˜ä¿®æ”¹ï¼š shell # æ”¹æˆ 4 æ ¸ virsh setvcpus opensuse15 4 # æ”¹æˆ 4G virsh setmem opensuse15 4096 è™šæ‹Ÿæœºç›‘æ§ï¼š shell # å¾…ç»­ ä¿®æ”¹ç£ç›˜ã€ç½‘ç»œåŠå…¶ä»–è®¾å¤‡ï¼š shell # æ·»åŠ æ–°è®¾å¤‡ virsh attach-device virsh attach-disk virsh attach-interface # åˆ é™¤è®¾å¤‡ virsh detach-disk virsh detach-device virsh detach-interface ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:5:4","series":null,"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt"],"title":"QEMU/KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/#3-è™šæ‹Ÿæœºç®¡ç†---virsh"},{"categories":["tech"],"content":" å››ã€ä½¿ç”¨ cloudinit è‡ªåŠ¨é…ç½®è™šæ‹Ÿæœºåœ¨æœ¬æœºçš„ KVM ç¯å¢ƒä¸­ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ cloud-init æ¥åˆå§‹åŒ–è™šæ‹Ÿæœºã€‚å¥½å¤„æ˜¯åˆ›å»ºè™šæ‹Ÿæœºçš„æ—¶å€™ï¼Œå°±èƒ½è®¾ç½®å¥½è™šæ‹Ÿæœºçš„ hostname/network/user-pass/disk-size ç­‰ä¸€ç³»åˆ—å‚æ•°ï¼Œä¸éœ€è¦æ¯æ¬¡å¯åŠ¨åå†æ‰‹åŠ¨ç™»å½•åˆ°æœºå™¨ä¸­é…ç½®ã€‚ ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:6:0","series":null,"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt"],"title":"QEMU/KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/#å››ä½¿ç”¨-cloudinit-è‡ªåŠ¨é…ç½®è™šæ‹Ÿæœº"},{"categories":["tech"],"content":" ä¸‹è½½ cloud image æ³¨æ„ï¼šä¸‹é¢çš„å‡ ç§é•œåƒéƒ½åˆ†åˆ«æœ‰è‡ªå·±çš„å‘ç‚¹ï¼Œä»… Ubuntu/OpenSUSE æµ‹è¯•é€šè¿‡ï¼Œå…¶ä»–å‘è¡Œç‰ˆçš„ Cloud é•œåƒéƒ½æœ‰å„ç§æ¯›ç—…â€¦ é¦–å…ˆä¸‹è½½ Cloud ç‰ˆæœ¬çš„ç³»ç»Ÿé•œåƒï¼š Ubuntu Cloud Images (RELEASED): æä¾› img æ ¼å¼çš„è£¸é•œåƒï¼ˆPVE ä¹Ÿæ”¯æŒæ­¤æ ¼å¼ï¼‰ è¯·ä¸‹è½½å¸¦æœ‰ .img ç»“å°¾çš„é•œåƒï¼Œå…¶ä¸­ kvm.img ç»“å°¾çš„é•œåƒä¼šæ›´ç²¾ç®€ä¸€ç‚¹ã€‚ OpenSUSE Cloud Images è¯·ä¸‹è½½å¸¦æœ‰ NoCloud æˆ–è€… OpenStack å­—æ ·çš„é•œåƒã€‚ å¯¹äºå…¶ä»–é•œåƒï¼Œå¯ä»¥è€ƒè™‘æ‰‹åŠ¨é€šè¿‡ iso æ¥åˆ¶ä½œä¸€ä¸ª cloudinit é•œåƒï¼Œå‚è€ƒopenstack - create ubuntu cloud images from iso ä¸Šè¿°é•œåƒå’Œæˆ‘ä»¬æ™®é€šè™šæ‹Ÿæœºä½¿ç”¨çš„ ISO é•œåƒçš„åŒºåˆ«ï¼Œä¸€æ˜¯é•œåƒæ ¼å¼ä¸åŒï¼ŒäºŒæ˜¯éƒ½è‡ªå¸¦äº†cloud-init/qemu-guest-agent/cloud-utils-growpart ç­‰ cloud ç›¸å…³è½¯ä»¶ã€‚ å…¶ä¸­ NoCloud è¡¨ç¤ºæ”¯æŒ cloudinit NoCloud æ•°æ®æºâ€”â€”å³ä½¿ç”¨ seed.iso æä¾› user-data/meta-data/network-config é…ç½®ï¼ŒPVE å°±æ˜¯ä½¿ç”¨çš„è¿™ç§æ¨¡å¼ã€‚è€Œ Openstack é•œåƒé€šå¸¸ä¹Ÿéƒ½æ”¯æŒ NoCloud æ¨¡å¼ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨çš„ã€‚ cloud image åŸºæœ¬éƒ½æ²¡æœ‰é»˜è®¤å¯†ç ï¼Œå¹¶ä¸”ç¦ç”¨äº† SSH å¯†ç ç™»å½•ï¼Œå¿…é¡»é€šè¿‡ cloud-init è®¾ç½®ç§é’¥æ–¹å¼è¿›è¡Œ ssh ç™»å½•ã€‚ ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:6:1","series":null,"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt"],"title":"QEMU/KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/#ä¸‹è½½-cloud-image"},{"categories":["tech"],"content":" é…ç½® cloudinit å¹¶åˆ›å»ºè™šæ‹Ÿæœºè¿™éœ€è¦ç”¨åˆ°ä¸€ä¸ªå·¥å…·ï¼šcloud-utils shell # manjaro sudo pacman -S cloud-utils # ubuntu sudo apt install cloud-utils # opensuseï¼ŒåŒ…ä»“åº“é‡Œæ‰¾ä¸åˆ° cloud-utilsï¼Œåªèƒ½æºç å®‰è£… git clone https://github.com/canonical/cloud-utils git checkout 0.32 cd cloud-utils \u0026\u0026 sudo make install # ç”Ÿæˆ iso æ–‡ä»¶è¿˜éœ€è¦ genisoimageï¼Œè¯·ä½¿ç”¨ä¸€é”®å®‰è£…ï¼šhttps://software.opensuse.org/package/genisoimage cloud-utils æä¾› cloud-init ç›¸å…³çš„å„ç§å®ç”¨å·¥å…·ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ª cloud-localds å‘½ä»¤ï¼Œå¯ä»¥é€šè¿‡ cloud é…ç½®ç”Ÿæˆä¸€ä¸ªé cloud çš„ bootable ç£ç›˜æ˜ åƒï¼Œä¾›æœ¬åœ°çš„è™šæ‹Ÿæœºä½¿ç”¨ã€‚ é¦–å…ˆç¼–å†™ user-data: yaml #cloud-config hostname: opensuse15-2 fqdn: opensuse15-2.local # è®© cloud-init è‡ªåŠ¨æ›´æ–° /etc/hosts ä¸­ localhost ç›¸å…³çš„å†…å®¹ manage_etc_hosts: localhost package_upgrade: true disable_root: false # è®¾ç½® root çš„ ssh å¯†é’¥ user: root # è®¾ç½®å¯†ç ï¼Œä»…ç”¨äºæ§åˆ¶å°ç™»å½• password: xxxxx # ä½¿ç”¨å¯†é’¥ç™»å½• ssh_authorized_keys: - \"\u003cssh-key content\u003e\" chpasswd: # expire ä½¿å¯†ç ç”¨å®Œå³å¤±æ•ˆï¼Œç”¨æˆ·æ¯æ¬¡ç™»å½•éƒ½éœ€è¦è®¾ç½®å¹¶ä½¿ç”¨å¯†ç ï¼ expire: false # ssh å…è®¸å¯†ç ç™»å½•ï¼ˆä¸å»ºè®®å¼€å¯ï¼‰ ssh_pwauth: false æ³¨æ„ user-data çš„ç¬¬ä¸€è¡Œçš„ #cloud-config ç»å¯¹ä¸èƒ½çœç•¥ï¼å®ƒæ ‡è¯†é…ç½®æ ¼å¼ä¸ºtext/cloud-configï¼ å†ç¼–å†™ network-config(å…¶æ ¼å¼å’Œ ubuntu çš„ netplan åŸºæœ¬å®Œå…¨ä¸€è‡´ï¼Œä½†æ˜¯æˆ‘åªæµ‹é€šäº† v1 ç‰ˆæœ¬ï¼Œv2 ç‰ˆæ²¡æµ‹é€š): yaml version: 1 config: - type: physical name: eth0 subnets: - type: static address: 192.168.122.160 netmask: 255.255.255.0 gateway: 192.168.122.1 - type: nameserver interface: eth0 address: - 114.114.114.114 - 8.8.8.8 # search: # search domain # - xxx shell cloud-localds seed.iso user-data --network-config network-config æ¯æ¬¡éƒ½æ‰‹åŠ¨ç”Ÿæˆ seed.iso å¤ªéº»çƒ¦äº†ï¼Œå®é™…ä½¿ç”¨ï¼Œå»ºè®®ç”¨åé¢ä»‹ç»çš„è‡ªåŠ¨åŒ–åŠŸèƒ½ proxmox-libvirt æˆ–è€… terraform-libvirt-provider~ è¿™æ ·å°±ç”Ÿæˆå‡ºäº†ä¸€ä¸ª seed.isoï¼Œåˆ›å»ºè™šæ‹Ÿæœºæ—¶åŒæ—¶éœ€è¦è½½å…¥ seed.iso å’Œ cloud imageï¼Œcloud-image è‡ªèº«ä¸ºå¯åŠ¨ç›˜ï¼Œè¿™æ ·å°±å¤§åŠŸå‘Šæˆäº†ã€‚ç¤ºä¾‹å‘½ä»¤å¦‚ä¸‹ï¼š shell virt-install --virt-type kvm \\ --name k8s-master-0 \\ --vcpus 2 --memory 3072 \\ --disk k8s-master-0.qcow2,device=disk,bus=virtio \\ --disk ../vm-seeds/160-seed-k8s-master-0.iso,device=cdrom \\ --os-type linux \\ --os-variant opensuse15.3 \\ --network network=default,model=virtio \\ --graphics vnc \\ --import ä¹Ÿå¯ä»¥ä½¿ç”¨ virt-viewer çš„ GUI ç•Œé¢è¿›è¡Œæ“ä½œã€‚ è¿™æ ·è®¾ç½®å®Œæˆåï¼Œcloud è™šæ‹Ÿæœºåº”è¯¥å°±å¯ä»¥å¯åŠ¨äº†ï¼Œå¯ä»¥æ£€æŸ¥ä¸‹ hostnameã€ç½‘ç»œã€root çš„å¯†ç å’Œç§é’¥ã€ssh é…ç½®æ˜¯å¦å‡æ­£å¸¸ã€‚ ä¸€åˆ‡æ­£å¸¸åï¼Œè¿˜æœ‰ä¸ªé—®é¢˜éœ€è¦è§£å†³â€”â€”åˆå§‹ç£ç›˜åº”è¯¥å¾ˆå°ã€‚å¯ä»¥ç›´æ¥æ‰‹åŠ¨æ‰©å®¹ img çš„å¤§å°ï¼Œcloud-init åœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶å°±ä¼šè‡ªåŠ¨æ‰©å®¹åˆ†åŒºï¼š shell qemu-img resize ubuntu-server-cloudimg-amd64.img 30G ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:6:2","series":null,"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt"],"title":"QEMU/KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/#é…ç½®-cloudinit-å¹¶åˆ›å»ºè™šæ‹Ÿæœº"},{"categories":["tech"],"content":" cloud image çš„å‘ 1. ubuntu cloud image çš„å‘ ubuntu å¯åŠ¨æ—¶ä¼šæŠ¥é”™ no such device: rootï¼Œä½†æ˜¯è¿‡ä¸€ä¼šå°±ä¼šæ­£å¸¸å¯åŠ¨ã€‚ è¿™æ˜¯ ubuntu cloud image çš„ bug: https://bugs.launchpad.net/cloud-images/+bug/1726476 ubuntu å¯åŠ¨åå¾ˆå¿«å°±ä¼šè¿›å…¥ç™»å½•ç•Œé¢ï¼Œä½†æ˜¯ root å¯†ç å¯èƒ½è¿˜æ²¡æ”¹å¥½ï¼Œç™»å½•ä¼šæŠ¥å¯†ç é”™è¯¯ï¼Œç­‰å¾…ä¸€ä¼šå†å°è¯•ç™»å½•å°± OK äº† ubuntu çš„é»˜è®¤ç½‘å¡åç§°æ˜¯ ens3ï¼Œä¸æ˜¯ eth0ï¼Œæ³¨æ„ä¿®æ”¹ network_config çš„ç½‘å¡åç§°ï¼Œå¦åˆ™ç½‘ç»œé…ç½®ä¸ä¼šç”Ÿæ•ˆ 2. opensuse cloud image çš„å‘ opensuse leap 15 åªæ”¯æŒ network_config v1ï¼Œå¯¹ v2 çš„æ”¯æŒæœ‰ bugï¼Œgateway4 ä¸ä¼šç”Ÿæ•ˆ 3. debian cloud image çš„å‘debian çš„ cloud é•œåƒæ ¹æœ¬æ²¡æ³•ç”¨ï¼Œå»ºè®®é¿å…ä½¿ç”¨å®ƒã€‚ debian å¯åŠ¨æ—¶ä¼šå½»åº•å¡ä½ï¼Œæˆ–è€…ç›´æ¥æŠ¥é”™ kernel panic åŸå› æ˜¯æ·»åŠ äº† spice å›¾å½¢å¡ï¼Œæ¢æˆ vnc å°±æ­£å¸¸äº† Debian Cloud Images ä¸­çš„ nocloud é•œåƒä¸ä¼šåœ¨å¯åŠ¨æ—¶è¿è¡Œ cloudinitï¼Œcloudinit å®Œå…¨ä¸ç”Ÿæ•ˆ ä¸çŸ¥é“æ˜¯å•¥å‘ï¼Œæ²¡è§£å†³ ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:6:3","series":null,"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt"],"title":"QEMU/KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/#cloud-image-çš„å‘"},{"categories":["tech"],"content":" cloud image çš„å‘ 1. ubuntu cloud image çš„å‘ ubuntu å¯åŠ¨æ—¶ä¼šæŠ¥é”™ no such device: rootï¼Œä½†æ˜¯è¿‡ä¸€ä¼šå°±ä¼šæ­£å¸¸å¯åŠ¨ã€‚ è¿™æ˜¯ ubuntu cloud image çš„ bug: https://bugs.launchpad.net/cloud-images/+bug/1726476 ubuntu å¯åŠ¨åå¾ˆå¿«å°±ä¼šè¿›å…¥ç™»å½•ç•Œé¢ï¼Œä½†æ˜¯ root å¯†ç å¯èƒ½è¿˜æ²¡æ”¹å¥½ï¼Œç™»å½•ä¼šæŠ¥å¯†ç é”™è¯¯ï¼Œç­‰å¾…ä¸€ä¼šå†å°è¯•ç™»å½•å°± OK äº† ubuntu çš„é»˜è®¤ç½‘å¡åç§°æ˜¯ ens3ï¼Œä¸æ˜¯ eth0ï¼Œæ³¨æ„ä¿®æ”¹ network_config çš„ç½‘å¡åç§°ï¼Œå¦åˆ™ç½‘ç»œé…ç½®ä¸ä¼šç”Ÿæ•ˆ 2. opensuse cloud image çš„å‘ opensuse leap 15 åªæ”¯æŒ network_config v1ï¼Œå¯¹ v2 çš„æ”¯æŒæœ‰ bugï¼Œgateway4 ä¸ä¼šç”Ÿæ•ˆ 3. debian cloud image çš„å‘debian çš„ cloud é•œåƒæ ¹æœ¬æ²¡æ³•ç”¨ï¼Œå»ºè®®é¿å…ä½¿ç”¨å®ƒã€‚ debian å¯åŠ¨æ—¶ä¼šå½»åº•å¡ä½ï¼Œæˆ–è€…ç›´æ¥æŠ¥é”™ kernel panic åŸå› æ˜¯æ·»åŠ äº† spice å›¾å½¢å¡ï¼Œæ¢æˆ vnc å°±æ­£å¸¸äº† Debian Cloud Images ä¸­çš„ nocloud é•œåƒä¸ä¼šåœ¨å¯åŠ¨æ—¶è¿è¡Œ cloudinitï¼Œcloudinit å®Œå…¨ä¸ç”Ÿæ•ˆ ä¸çŸ¥é“æ˜¯å•¥å‘ï¼Œæ²¡è§£å†³ ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:6:3","series":null,"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt"],"title":"QEMU/KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/#1-ubuntu-cloud-image-çš„å‘"},{"categories":["tech"],"content":" cloud image çš„å‘ 1. ubuntu cloud image çš„å‘ ubuntu å¯åŠ¨æ—¶ä¼šæŠ¥é”™ no such device: rootï¼Œä½†æ˜¯è¿‡ä¸€ä¼šå°±ä¼šæ­£å¸¸å¯åŠ¨ã€‚ è¿™æ˜¯ ubuntu cloud image çš„ bug: https://bugs.launchpad.net/cloud-images/+bug/1726476 ubuntu å¯åŠ¨åå¾ˆå¿«å°±ä¼šè¿›å…¥ç™»å½•ç•Œé¢ï¼Œä½†æ˜¯ root å¯†ç å¯èƒ½è¿˜æ²¡æ”¹å¥½ï¼Œç™»å½•ä¼šæŠ¥å¯†ç é”™è¯¯ï¼Œç­‰å¾…ä¸€ä¼šå†å°è¯•ç™»å½•å°± OK äº† ubuntu çš„é»˜è®¤ç½‘å¡åç§°æ˜¯ ens3ï¼Œä¸æ˜¯ eth0ï¼Œæ³¨æ„ä¿®æ”¹ network_config çš„ç½‘å¡åç§°ï¼Œå¦åˆ™ç½‘ç»œé…ç½®ä¸ä¼šç”Ÿæ•ˆ 2. opensuse cloud image çš„å‘ opensuse leap 15 åªæ”¯æŒ network_config v1ï¼Œå¯¹ v2 çš„æ”¯æŒæœ‰ bugï¼Œgateway4 ä¸ä¼šç”Ÿæ•ˆ 3. debian cloud image çš„å‘debian çš„ cloud é•œåƒæ ¹æœ¬æ²¡æ³•ç”¨ï¼Œå»ºè®®é¿å…ä½¿ç”¨å®ƒã€‚ debian å¯åŠ¨æ—¶ä¼šå½»åº•å¡ä½ï¼Œæˆ–è€…ç›´æ¥æŠ¥é”™ kernel panic åŸå› æ˜¯æ·»åŠ äº† spice å›¾å½¢å¡ï¼Œæ¢æˆ vnc å°±æ­£å¸¸äº† Debian Cloud Images ä¸­çš„ nocloud é•œåƒä¸ä¼šåœ¨å¯åŠ¨æ—¶è¿è¡Œ cloudinitï¼Œcloudinit å®Œå…¨ä¸ç”Ÿæ•ˆ ä¸çŸ¥é“æ˜¯å•¥å‘ï¼Œæ²¡è§£å†³ ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:6:3","series":null,"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt"],"title":"QEMU/KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/#2-opensuse-cloud-image-çš„å‘"},{"categories":["tech"],"content":" cloud image çš„å‘ 1. ubuntu cloud image çš„å‘ ubuntu å¯åŠ¨æ—¶ä¼šæŠ¥é”™ no such device: rootï¼Œä½†æ˜¯è¿‡ä¸€ä¼šå°±ä¼šæ­£å¸¸å¯åŠ¨ã€‚ è¿™æ˜¯ ubuntu cloud image çš„ bug: https://bugs.launchpad.net/cloud-images/+bug/1726476 ubuntu å¯åŠ¨åå¾ˆå¿«å°±ä¼šè¿›å…¥ç™»å½•ç•Œé¢ï¼Œä½†æ˜¯ root å¯†ç å¯èƒ½è¿˜æ²¡æ”¹å¥½ï¼Œç™»å½•ä¼šæŠ¥å¯†ç é”™è¯¯ï¼Œç­‰å¾…ä¸€ä¼šå†å°è¯•ç™»å½•å°± OK äº† ubuntu çš„é»˜è®¤ç½‘å¡åç§°æ˜¯ ens3ï¼Œä¸æ˜¯ eth0ï¼Œæ³¨æ„ä¿®æ”¹ network_config çš„ç½‘å¡åç§°ï¼Œå¦åˆ™ç½‘ç»œé…ç½®ä¸ä¼šç”Ÿæ•ˆ 2. opensuse cloud image çš„å‘ opensuse leap 15 åªæ”¯æŒ network_config v1ï¼Œå¯¹ v2 çš„æ”¯æŒæœ‰ bugï¼Œgateway4 ä¸ä¼šç”Ÿæ•ˆ 3. debian cloud image çš„å‘debian çš„ cloud é•œåƒæ ¹æœ¬æ²¡æ³•ç”¨ï¼Œå»ºè®®é¿å…ä½¿ç”¨å®ƒã€‚ debian å¯åŠ¨æ—¶ä¼šå½»åº•å¡ä½ï¼Œæˆ–è€…ç›´æ¥æŠ¥é”™ kernel panic åŸå› æ˜¯æ·»åŠ äº† spice å›¾å½¢å¡ï¼Œæ¢æˆ vnc å°±æ­£å¸¸äº† Debian Cloud Images ä¸­çš„ nocloud é•œåƒä¸ä¼šåœ¨å¯åŠ¨æ—¶è¿è¡Œ cloudinitï¼Œcloudinit å®Œå…¨ä¸ç”Ÿæ•ˆ ä¸çŸ¥é“æ˜¯å•¥å‘ï¼Œæ²¡è§£å†³ ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:6:3","series":null,"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt"],"title":"QEMU/KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/#3-debian-cloud-image-çš„å‘"},{"categories":["tech"],"content":" ç”»å¤–ï¼šcloudinit ä¸»æœºåç§°cloudinit æœ‰ä¸‰ä¸ªå‚æ•°ä¸ hostname ç›¸å…³ã€‚å…¶ä¸­æœ‰ä¸¤ä¸ªï¼Œå°±æ˜¯ä¸Šé¢æåˆ°çš„ user-data ä¸­çš„ï¼š hostname: ä¸»æœºåç§° fqdn: ä¸»æœºçš„å®Œå…¨é™å®šåŸŸåï¼Œä¼˜å…ˆçº§æ¯” hostname æ›´é«˜ è¿™ä¸¤ä¸ªå‚æ•°çš„è¡Œä¸ºå‡å— preserve_hostname: true/false è¿™ä¸ªå‚æ•°çš„å½±å“ã€‚ å¦ä¸€ä¸ªæ˜¯ meta-data ä¸­ï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ª local-hostnameï¼Œæ­¤å‚æ•°çš„åœ°ä½å¥½åƒå’Œ user-data ä¸­çš„ hostname ç›¸åŒï¼Œä¸è¿‡å¯èƒ½ä¼˜å…ˆçº§ä¼šé«˜ä¸€äº›å§ã€‚æ²¡æœ‰æ‰¾åˆ°ç›¸å…³æ–‡æ¡£ã€‚ ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:6:4","series":null,"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt"],"title":"QEMU/KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/#ç”»å¤–cloudinit-ä¸»æœºåç§°"},{"categories":["tech"],"content":" è‡ªåŠ¨åŒ–å¯ä»¥ä½¿ç”¨ pulumi/terraform è‡ªåŠ¨åŒ–åˆ›å»ºä¸ç®¡ç† QEMU/KVM è™šæ‹Ÿæœºï¼Œç›¸å½“æ–¹ä¾¿ï¼š terraform-provider-libvirt pulumi-libvirt#examples ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:6:5","series":null,"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt"],"title":"QEMU/KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/#è‡ªåŠ¨åŒ–"},{"categories":["tech"],"content":" å‚è€ƒ Virtualization Guide - OpenSUSE Complete Installation of KVM, QEMU and Virt Manager on Arch Linux and Manjaro virtualization-libvirt - ubuntu docs RedHat Docs - KVM åœ¨ QEMU ä½¿ç”¨ Ubuntu Cloud Images ","date":"2021-01-17","objectID":"/posts/qemu-kvm-usage/:7:0","series":null,"tags":["è™šæ‹ŸåŒ–","Visualization","KVM","QEMU","libvirt"],"title":"QEMU/KVM è™šæ‹ŸåŒ–ç¯å¢ƒçš„æ­å»ºä¸ä½¿ç”¨","uri":"/posts/qemu-kvm-usage/#å‚è€ƒ"},{"categories":null,"content":" æœ¬ç«™çš„æ–‡ç« å¯èƒ½ä»¥ä¸­æ–‡æˆ–è‹±æ–‡ä¸¤ç§è¯­è¨€ä¹¦å†™ï¼Œå…¶ä¸­éƒ¨åˆ†æ–‡ç« å¯èƒ½æ˜¯åŒè¯­ï¼Œä¹Ÿæœ‰éƒ¨åˆ†æ–‡ç« åªæœ‰ä¸­æ–‡æˆ–è€…è‹±æ–‡ç‰ˆæœ¬ï¼Œè¯·è¯»è€…æŒ‰éœ€é˜…è¯»ã€‚ The articles on this site may be written in Chinese orEnglish, some of them may be bilingual, and some of them are only available in Chinese orEnglish. Please read them as needed. ","date":"2021-01-16","objectID":"/about/:0:0","series":null,"tags":null,"title":"å…³äº","uri":"/about/#"},{"categories":null,"content":" å…³äºæˆ‘ æ˜µç§°ï¼šä¸­æ–‡æ˜µç§°ã€Œæ–¼æ¸…æ¨‚ã€ã€ŒäºŒèŠ±ã€ï¼Œè‹±æ–‡ IDã€Œryan4yinã€ã€Œryan_yinã€ æ€§åˆ«ï¼šä»–/He/Him å·¥ä½œä¸å­¦ä¹ ç»å† 2012-6 ~ 2015-6ï¼šåœ¨ï¼ˆæ¹–å—é‚µé˜³ï¼‰æ­¦å†ˆä¸€ä¸­è¯»é«˜ä¸­ 2015-6 ~ 2019-6ï¼šåœ¨å®‰å¾½å»ºç­‘å¤§å­¦è¯»å£°å­¦ä¸“ä¸šï¼Œæ²¡é”™å°±æ˜¯åˆä¸­ç‰©ç†è¯¾ä¸Šæ•²éŸ³å‰çš„é‚£ä¸ªå£°å­¦ ï¼ˆä¸æ˜¯éŸ³ä¹â€¦ï¼‰ã€‚æœ¬äººä¸“ä¸šçŸ¥è¯†æˆ˜äº”æ¸£ï¼Œå­¦ä½è¯éƒ½æ²¡æ‹¿åˆ° emmm 2019-6 ~ 2021-2ï¼šåœ¨æŸä¸çŸ¥ååˆ›ä¸šå…¬å¸åšå…¨èƒ½è¿ç»´ï¼ˆå…¨å¹²å·¥ç¨‹å¸ˆï¼‰ï¼Œä¸Šè‡³æ­å»ºé˜¿é‡Œäº‘ç”Ÿäº§ç¯å¢ƒã€æ Kubernetes é›†ç¾¤ã€Istio æœåŠ¡ç½‘æ ¼ã€CICDã€æ€§èƒ½æµ‹è¯•ï¼Œä¸‹è‡³ææ´‹åƒåœ¾æˆ´å°”æœåŠ¡å™¨ä¸ vSphereã€è£…æ°´ç®¡ã€ä¿®é—¨ç¦ã€æ‰«åœ°æ‹–åœ°ã€å½“è‹¦åŠ›æ¬è¿è´§ç‰©ï¼Œåæ­£æ²¡äººå¹²çš„å°±è¿ç»´å¹²å‘— 2021-3 ~ 2025-1ï¼šåœ¨æŸä¸çŸ¥åå‡ºæµ· APP å…¬å¸æ‹…ä»» SRE å·¥ç¨‹å¸ˆï¼Œç›®å‰ä¸»è¦è´Ÿè´£ AIGC åŸºç¡€è®¾æ–½ä»¥åŠçº¿ä¸Šç½‘å…³çš„ç»´æŠ¤ä¸ä¼˜åŒ–ï¼Œä¹Ÿæ›¾è´Ÿè´£è¿‡çº¿ä¸ŠæœåŠ¡ K8s é›†ç¾¤çš„ç»´æŠ¤ä¼˜åŒ–ã€äº‘æˆæœ¬åˆ†æç®¡æ§ç­‰å·¥ä½œã€‚ éŸ³ä¹ï¼š å–œæ¬¢å¬åæ‘‡ã€è“è‰ã€æ°‘è°£ã€å™¨ä¹ æœ€å–œæ¬¢çš„æ­Œæ‰‹æ˜¯è™šæ‹Ÿæ­Œæ‰‹æ´›å¤©ä¾ æœ‰åœ¨æ–­æ–­ç»­ç»­åœ°å­¦ä¹ ç«¹ç¬›è·Ÿå£ç´ï¼ˆå¤éŸ³ã€è“è°ƒéƒ½æœ‰åœ¨å­¦ï¼‰ï¼Œå¦å¤–ä¹Ÿæœ‰åœ¨å­¦ä¹ ä½¿ç”¨Synthesizer V/ACE è·Ÿ Reaper è¿åŠ¨ï¼šå–œæ¬¢è½®æ»‘ä»¥åŠæ¸¸æ³³ï¼Œå“¦è¿˜æœ‰ VR æ¸¸æˆã€ŠBeat Saberã€‹ã€ŠPistol Whipã€‹ï¼Œä½†æ˜¯ç›®å‰éƒ½æ˜¯åŠåŠå­å“ˆå“ˆ~ èŒ¶ï¼š2021 å¹´åœ¨æœ‹å‹å®¶å–è¿‡ä¸€æ¬¡é’é’±æŸ³åå°±ä¸€ç›´å¿µå¿µä¸å¿˜ï¼Œå¹´åº•å°±å…¥å‘äº†å‡¤ç‰Œæ»‡çº¢ã€å¤©ä¹‹çº¢ç¥é—¨çº¢èŒ¶ã€æç™½å®‰å‰ç™½èŒ¶ï¼Œç›®å‰æ¯”è¾ƒå–œæ¬¢å–çº¢èŒ¶ ä¹¦ç±ï¼šè¯»å¾—æœ€å¤šçš„æ­£ç»ä¹¦æ˜¯ IT æŠ€æœ¯ä¹¦ç±ï¼Œå¦å¤–ä¹Ÿå–œæ¬¢çœ‹ç§‘å¹»ï¼Œä»¥åŠæˆ’ä¸æ‰çš„ç½‘æ–‡/è½»å°è¯´ å½±è§†ï¼šçœ‹å¾—æœ€å¤šçš„æ˜¯åŠ¨æ¼«ï¼Œå¦å¤–å°±æ˜¯æ¬§ç¾ç§‘å¹»ç‰‡ã€æ¸©æƒ…ç‰‡ ä¸­æ–‡è¾“å…¥æ–¹æ¡ˆï¼šå°é¹¤éŸ³å½¢ è‡ªç„¶è¯­è¨€ English: Keep learning. Good at reading technical articles, but weak in writing, listening and speaking ä¸­æ–‡ï¼šæ¯è¯­ï¼Œé«˜ä¸­è¯­æ–‡ä¸­ä¸Šæ°´å‡†ã€‚å¸Œæœ›èƒ½å­¦ä¼šç”¨ä¸­æ–‡å†™å°è¯´ï¼Œå°±å…ˆä»çŸ­ç¯‡å¼€å§‹å§ ç¼–ç¨‹è¯­è¨€ Go/Python: ç›®å‰çš„ä¸»åŠ›ï¼Œä¹Ÿæ˜¯æˆ‘æœ€ç†Ÿæ‚‰çš„è¯­è¨€ C: å…¥é—¨æ°´å¹³ï¼Œæ­£åœ¨ä½¿ç”¨ C è¯­è¨€å­¦ä¹  Linux ç³»ç»Ÿç¼–ç¨‹ Rust: å­¦ä¹ ä¸­ï¼Œå¤§é‡å‡½æ•°å¼çš„è¯­æ³•ç³–ï¼Œè´´å¿ƒçš„ç¼–è¯‘å™¨æç¤ºï¼Œæ„Ÿè§‰å¾ˆå¥½ç”¨ï¼ˆå½“ç„¶ä¹Ÿæ¯”è¾ƒç£¨äººâ€¦ï¼‰ æ„Ÿå…´è¶£çš„æŠ€æœ¯ï¼š Linux: æœ¬äºº Linux çˆ±å¥½è€…ä¸€åï¼Œä¹Ÿé å®ƒåƒé¥­ã€‚æœ€å–œæ¬¢å¹¶ä¸”æŠ•å…¥äº†æœ€å¤šç²¾åŠ›çš„å‘è¡Œç‰ˆæ˜¯ NixOS Neovim: æœ¬äººçš„ä¸»åŠ›ç¼–è¾‘å™¨ï¼Œä¹Ÿæ˜¯æˆ‘æœ€å–œæ¬¢çš„ç¼–è¾‘å™¨ã€‚å®ƒèƒ½å¸¦ç»™æˆ‘ç±»ä¼¼å½¢ç è¾“å…¥æ³•çš„ä¸æ»‘è¾“å…¥ä½“éªŒï¼Œè®©æˆ‘çˆ±ä¸é‡Šæ‰‹ Window Manager: çª—å£ç®¡ç†å™¨ï¼Œç›®å‰æˆ‘ i3/hyprland éƒ½æœ‰åœ¨ç”¨ã€‚ä¸ Neovim ç±»ä¼¼ï¼Œå®ƒä»¬çš„å¥½å¤„æ˜¯å¯ä»¥è®©æˆ‘ä¸ç”¨ç¦»å¼€é”®ç›˜å°±èƒ½å®Œæˆå¤§éƒ¨åˆ†æ“ä½œï¼Œä½“éªŒå¾ˆä¸æ»‘ Embedded: å³åµŒå…¥å¼ç³»ç»Ÿï¼Œæ„Ÿè§‰ç¡¬ä»¶æ˜¯ä¸ªå¾ˆå¥½ç©çš„é¢†åŸŸï¼Œä¸šä½™æŠ˜è…¾äº†è®¸å¤šï¼Œä¹ŸèŠ±äº†ä¸å°‘é’±åœ¨è¿™ä¸Šé¢ Kubernetes: SRE çš„é¥­ç¢—ä¹‹ä¸€ï¼Œäº‘åŸç”Ÿçš„åŸºçŸ³ Istio: æœ€æˆç†Ÿçš„æœåŠ¡ç½‘æ ¼äº§å“ï¼Œä¹Ÿæ˜¯é¥­ç¢—ä¹‹ä¸€ è”ç³»æ–¹å¼ é‚®ä»¶ï¼šbXkgZW1haWw6IHJ5YW40eWluQGxpbnV4LmNvbQ== è±†ç“£ï¼šæœ¬äººæ˜¯è±†ç“£ä¹¦å½±éŸ³æ ‡è®°çš„é‡åº¦ä½¿ç”¨è€…ï¼Œä» 2015 å¹´ä»¥æ¥ä¸€ç›´ä½¿ç”¨è±†ç“£æ ‡è®°è¯»è¿‡çš„ä¹¦çœ‹è¿‡çš„ç”µå½±ã€‚ Twitter: è‡ª 2021 å¹´èµ·åœ¨ Twitter ä¸Šå‘å¸ƒä¸€äº›ç”Ÿæ´»åŠ¨æ€ä¸æŠ€æœ¯å†…å®¹ï¼ŒåŒæ—¶ä¹Ÿå¾ˆå–œæ¬¢çœ‹ Twitter ä¸Šå„ä½ç”»æ‰‹å¤§è§¦çš„ä½œå“ã€‚æ˜¯æˆ‘æ—¥å¸¸æ¶ˆé£ä¸æ¥è§¦ç¢ç‰‡åŒ–ä¿¡æ¯çš„é‡è¦æ¸ é“ä¹‹ä¸€ã€‚ Bilibili: æ—¥å¸¸ç”¨ Bilibili æ¶ˆé£ï¼Œæ—¥å¸¸å–œæ¬¢çœ‹ MMD èˆè¹ˆã€è™šæ‹Ÿæ­Œå§¬ã€ç¡¬æ ¸æŠ€æœ¯ç›¸å…³å†…å®¹ã€‚ Github Issues: ä¹Ÿå¯ä»¥è€ƒè™‘ç›´æ¥åœ¨æ­¤ä»“åº“çš„ Issue åŒºè”ç³»æˆ‘ã€‚ ","date":"2021-01-16","objectID":"/about/:1:0","series":null,"tags":null,"title":"å…³äº","uri":"/about/#å…³äºæˆ‘"},{"categories":null,"content":" å…³äºæ­¤åšå®¢ ã€Œå¯¹æˆ‘æ¥è¯´ï¼Œåšå®¢é¦–å…ˆæ˜¯ä¸€ç§çŸ¥è¯†ç®¡ç†å·¥å…·ï¼Œå…¶æ¬¡æ‰æ˜¯ä¼ æ’­å·¥å…·ã€‚æˆ‘çš„æŠ€æœ¯æ–‡ç« ï¼Œä¸»è¦ç”¨æ¥æ•´ç†æˆ‘è¿˜ä¸æ‡‚çš„çŸ¥è¯†ã€‚æˆ‘åªå†™é‚£äº›æˆ‘è¿˜æ²¡æœ‰å®Œå…¨æŒæ¡çš„ä¸œè¥¿ï¼Œé‚£äº›æˆ‘ç²¾é€šçš„ä¸œè¥¿ï¼Œå¾€å¾€æ²¡æœ‰åŠ¨åŠ›å†™ã€‚ç‚«è€€ä»æ¥ä¸æ˜¯æˆ‘çš„åŠ¨æœºï¼Œå¥½å¥‡æ‰æ˜¯ã€‚ã€ â”€â”€é˜®ä¸€å³° æˆ‘ä» 2016 å¹´å¼€å§‹å†™åšå®¢ï¼Œå·²ç»æœ‰å¾ˆå¤šå¹´äº†ï¼Œä¹Ÿè¯•ç”¨è¿‡å›½å†…å¤–å¾ˆå¤šçš„å†™ä½œå¹³å°ï¼Œä¸è¿‡æœ€ç»ˆè¿˜æ˜¯é€‰æ‹©äº†æ­å»ºä¸€ä¸ªè‡ªå·±çš„ç«™ç‚¹ï¼Œå› ä¸ºå®ƒå®Œå…¨å—æˆ‘è‡ªå·±ç®¡æ§ï¼Œè‡ªç”±åº¦æœ€é«˜ï¼Œæ–‡ç« ä¸ä¼šæ— æ•…è¢«åˆ é™¤æˆ–å°é”ã€‚å…¶æ¬¡æ˜¯å¾ˆå¤šå…è´¹çš„é™æ€ç«™ç‚¹æœåŠ¡å¯ç”¨ï¼ˆå¦‚ GitHub Pagesã€Vercel ç­‰ï¼‰ï¼ŒåŸºæœ¬ä¸èŠ±é’±ã€‚ ä¸è®ºæ˜¯ç”Ÿæ´»åšå®¢è¿˜æ˜¯æŠ€æœ¯åšå®¢ï¼Œæ¯ä½å†™åšå®¢çš„åšä¸»ï¼Œéƒ½æœ‰ç€è‡ªå·±çš„ç›®çš„ï¼Œæˆ‘å†™åšå®¢çš„ç›®çš„å˜åŒ–è¿‡å¾ˆå¤šæ¬¡ã€‚æœ€å¼€å§‹æˆ‘åªæ˜¯æƒ³å°è¯•ä¸‹æ–°é²œäº‹ç‰©ï¼›åæ¥å˜æˆæƒ³è·å¾—æ›´å¤šçš„é˜…è¯»é‡è·Ÿè¯„è®ºï¼Œå› ä¸ºè¿™èƒ½ç»™æˆ‘å¼ºçƒˆçš„æˆå°±æ„Ÿï¼›å†åæ¥æˆ‘ä¹Ÿè¯•è¿‡æŠŠåšå®¢å½“æˆæŠ€æœ¯ç¬”è®°æœ¬è·Ÿæ—¥è®°æœ¬æ¥ç”¨ï¼Œå†™äº†å¾ˆå¤šçç¢çš„ä¸œè¥¿ï¼›æ¥ç€å‘¢å°±åˆ°äº†ç°åœ¨ï¼Œç°åœ¨æˆ‘å†™åšå®¢çš„é¦–è¦ç›®çš„æ˜¯é€šè¿‡å®ƒæ¢³ç†ä¸æ„å»ºæˆ‘çš„çŸ¥è¯†ä½“ç³»ï¼Œæˆ‘çš„åšå®¢è·Ÿæˆ‘çš„ä¸ªäººç¬”è®°ryan4yin/knowledge å°±æ˜¯æˆ‘çš„çŸ¥è¯†å®åº“ï¼Œæˆ‘åœ¨ä¸æ–­å¾€é‡Œé¢è¡¥å……æ–°çš„å†…å®¹çš„åŒæ—¶ï¼Œä¹Ÿè¶Šæ¥è¶Šå¤šåœ°ä¾èµ–å®ƒå®Œæˆè‡ªå·±çš„æ—¥å¸¸å·¥ä½œç”šè‡³ä¸šä½™ç©ä¹ï¼›è€Œæ¬¡è¦ç›®æ ‡åˆ™æ˜¯å°†è‡ªå·±å­¦åˆ°çš„çŸ¥è¯†åˆ†äº«ç»™æœ‰éœ€è¦çš„äººï¼ŒåŠ©äººä¸ºä¹å˜›ï¼›æœ€åä¸€ä¸ªç›®çš„ï¼Œæ˜¯è®°å½•æˆ‘è‡ªå·±ï¼Œè®°å½•æˆ‘çš„å–œæ€’å“€ä¹ï¼Œè®°å½•æˆ‘çš„æˆé•¿ã€‚ æˆ‘çš„åŸŸåéƒ½ä¹°äº†æœ€é•¿çš„åå¹´ï¼Œè€Œä¸”éš”å‡ å¹´å°±ç»­æ»¡ï¼Œæˆ‘å¸Œæœ›è¿™ä¸ªåšå®¢èƒ½é™ªä¼´æˆ‘å¾ˆä¹…å¾ˆä¹…ã€‚ä¸‹ä¸€ä¸ªåå¹´ï¼Œå†å›å¤´çœ‹çœ‹æˆ‘çš„åšå®¢ï¼Œçœ‹åˆ°æˆ‘è¿™åå¹´èµ°è¿‡çš„è·¯ï¼Œæˆ‘æƒ³é‚£ä¸ªæ—¶å€™ä¸€å®šä¼šå¾ˆæœ‰è¶£ï¼ ","date":"2021-01-16","objectID":"/about/:2:0","series":null,"tags":null,"title":"å…³äº","uri":"/about/#å…³äºæ­¤åšå®¢"},{"categories":null,"content":" æˆ‘æ›¾ç”¨è¿‡çš„ç®´è¨€è¿™äº›ç®´è¨€æ›¾ç»é™ªä¼´æˆ‘ä¸è¿™ä¸ªåšå®¢åº¦è¿‡äº†è®¸å¤šæ˜¥å¤ç§‹å†¬ï¼Œå®ƒä»¬éƒ½æ›¾åœ¨æŸä¸ªæ—¶æœŸç»™è¿‡æˆ‘åŠ›é‡ï¼Œæ¯æ¯çœ‹åˆ°éƒ½ä»¤äººæ€€å¿µã€‚åœ¨è¿™é‡Œä¹Ÿå°†å®ƒä»¬é€ç»™å„ä½è¯»è€…ï¼Œå¸Œæœ›å®ƒä»¬ä¹Ÿèƒ½ç»™ä½ ä»¥åŠ›é‡ï¼ 2021-02-06 ~ 2022-01-03 æ‹†ç ´ç‰ç¬¼é£å½©å‡¤ï¼Œé¡¿å¼€é‡‘é”èµ°è›Ÿé¾™ã€‚ â€”â€” æ¥è‡ªå¥½å‹ @äºŒç‰› çš„èµ è¯­ 2021-01-16 - 2022-04-04 åŒæ‰‹åˆå é—­ä¸Šçœ¼ç› å¿ƒé‡Œä»€ä¹ˆä¹Ÿä¸å»æƒ³å˜´è§’å°±é«˜é«˜æ‰¬èµ· ç¬‘å‡ºå£°æ¥ èµç¾å¿«ä¹~ 2022-04-04 ~ 2022-08-19 æˆ‘é”™è¿‡èŠ±ï¼Œå´çœ‹è§æµ·ã€‚ 2021-01-18 ~ 2022-08-19 æœ‰å¾ˆå¤šçš„ç»æœ›ï¼Œä½†ä¹Ÿæœ‰ç¾çš„æ—¶åˆ»ï¼Œåªä¸è¿‡åœ¨ç¾çš„æ—¶åˆ»ï¼Œæ—¶é—´æ˜¯ä¸åŒäºä»¥å¾€çš„ã€‚ â”€â”€ã€ŠåˆºçŒ¬çš„ä¼˜é›…ã€‹ 2022-08-19 ~ now è„šä¸‹è™½æœ‰ä¸‡æ°´åƒå±±ï¼Œä½†è¡Œè€…å¿…è‡³ã€‚ â€”â€”ã€Šåœ¨å³¡æ±Ÿçš„è½¬å¼¯å¤„ - é™ˆè¡Œç”²äººç”Ÿç¬”è®°ã€‹ ","date":"2021-01-16","objectID":"/about/:2:1","series":null,"tags":null,"title":"å…³äº","uri":"/about/#æˆ‘æ›¾ç”¨è¿‡çš„ç®´è¨€"},{"categories":null,"content":" åšå®¢æ—¶é—´çº¿ åšå®¢æ—¶é—´çº¿ 2016-06-17ï¼šï¼ˆå¤§ä¸€ä¸‹å­¦æœŸï¼‰åœ¨åšå®¢å›­åˆ›å»ºåšå®¢ https://www.cnblogs.com/kirito-c/ ç¬¬ä¸€ç¯‡åšæ–‡æ˜¯è´ªåƒè›‡â€”Câ€”åŸºäºeasyxå›¾å½¢åº“ï¼Œç°åœ¨è¿˜èƒ½å›å¿†èµ·æ”¶åˆ°ç¬¬ä¸€æ¡è¯„è®ºæ—¶çš„å…´å¥‹ä¹‹æƒ…ã€‚ 2021-01-16ï¼šï¼ˆå·¥ä½œä¸€å¹´å¤šåï¼‰ç”³è¯·åŸŸåå¹¶å¼€è®¾ç‹¬ç«‹åšå®¢ https://ryan4yin.space/ 2021-01-28ï¼šç«™ç‚¹ä» Cloudflare + GitHub Pages è¿ç§»åˆ° Vercelï¼Œå›½å†…è®¿é—®é€Ÿåº¦æœ‰ä¸€å®šæå‡ã€‚ 2021-02-07ï¼šï¼ˆç¬¬ä¸€ä»½å·¥ä½œç»“æŸåèµ‹é—²ï¼‰å°†åšå®¢ä¸»åŸŸååˆ‡æ¢ä¸º https://thiscute.world/ï¼Œå¦å¤–æ–°å¢å¤‡ç”¨åŸŸå https://writefor.fun 2022-02-07ï¼šç«™ç‚¹æ·»åŠ ã€Œé˜…è¯»æ’è¡Œã€é¡µï¼Œå±•ç¤ºä» Google Analytics æ‹‰å–çš„ç«™ç‚¹ç»Ÿè®¡æ•°æ®ã€‚ 2022-02-16ï¼šç«™ç‚¹é€šè¿‡åå¹´ä¹‹çº¦å®¡æ ¸ï¼Œæ­£å¼åŠ å…¥åå¹´ä¹‹çº¦ åšå®¢å¿«ç…§-2020-01-21 åšå®¢å›­å¿«ç…§ åšå®¢å¿«ç…§-2022-07-31 ThisCute.World å¿«ç…§ ","date":"2021-01-16","objectID":"/about/:2:2","series":null,"tags":null,"title":"å…³äº","uri":"/about/#åšå®¢æ—¶é—´çº¿"},{"categories":null,"content":" æ³¨æ„äº‹é¡¹æœ¬ç«™æ‰€æœ‰æŠ€æœ¯å†…å®¹å‡ä¸ºä¸ªäººè§‚ç‚¹ï¼Œä¸ä¿è¯æ­£ç¡®ï¼Œå¦å¤–éšç€æ—¶é—´å˜åŒ–éƒ¨åˆ†æŠ€æœ¯å†…å®¹ä¹Ÿå¯èƒ½ä¼šå¤±æ•ˆï¼Œè¯·è¯»è€…è‡ªè¡Œç”„åˆ«ã€‚ å¦å¤–æœ¬ç«™ä½¿ç”¨çš„è®¸å¤šé…å›¾éƒ½æ¥æºäºç½‘ç»œï¼Œå¦‚æœ‰ä¾µæƒï¼Œè¯·è”ç³»æˆ‘åˆ é™¤ã€‚ ","date":"2021-01-16","objectID":"/about/:3:0","series":null,"tags":null,"title":"å…³äº","uri":"/about/#æ³¨æ„äº‹é¡¹"},{"categories":null,"content":" ç”»å¤–äº’è”ç½‘æµ©å¦‚çƒŸæµ·ï¼Œè¿™ä¸ªå°ç«™åå®‰ä¸€éš…ï¼Œå¦‚æœå®ƒæœ‰å¹¸è¢«ä½ å‘ç°ï¼Œè€Œä¸”å…¶ä¸­æ–‡å­—å¯¹ä½ è¿˜æœ‰äº›å¸®åŠ©ï¼Œé‚£å¯çœŸæ˜¯å¤ªæ£’äº†ï¼æ„Ÿè°¢æœ‰ä½ ~ å¦‚æœä½ è§‰å¾—è¿™ä¸ªå°ç«™è¿˜ä¸é”™ï¼Œæ¬¢è¿å°†å®ƒåˆ†äº«ç»™ä½ çš„æœ‹å‹ï¼Œæˆ–è€…åœ¨æ–‡ç« åº•ä¸‹çš„è¯„è®ºåŒºç•™ä¸‹åªè¨€ç‰‡è¯­ï¼Œè®©æˆ‘çŸ¥é“ä½ çš„æƒ³æ³•ï¼Œè¿™æ˜¯å¯¹æˆ‘æœ€å¤§çš„é¼“åŠ±ï¼ ","date":"2021-01-16","objectID":"/about/:4:0","series":null,"tags":null,"title":"å…³äº","uri":"/about/#ç”»å¤–"},{"categories":["tech"],"content":"Pulumi æ˜¯ä¸€ä¸ªåŸºç¡€è®¾æ–½çš„è‡ªåŠ¨ç®¡ç†å·¥å…·ï¼Œä½¿ç”¨ Python/TypeScript/Go/Dotnet ç¼–å†™å¥½å£°æ˜å¼çš„èµ„æºé…ç½®ï¼Œå°±èƒ½å®ç°ä¸€é”®åˆ›å»º/ä¿®æ”¹/é”€æ¯å„ç±»èµ„æºï¼Œè¿™é‡Œçš„èµ„æºå¯ä»¥æ˜¯ï¼š AWS/é˜¿é‡Œäº‘ç­‰äº‘ä¸Šçš„è´Ÿè½½å‡è¡¡ã€äº‘æœåŠ¡å™¨ã€TLS è¯ä¹¦ã€DNSã€CDNã€OSSã€æ•°æ®åº“â€¦å‡ ä¹æ‰€æœ‰çš„äº‘ä¸Šèµ„æº æœ¬åœ°è‡ªå»ºçš„ vSphere/Kubernetes/ProxmoxVE/libvirt ç¯å¢ƒä¸­çš„è™šæ‹Ÿæœºã€å®¹å™¨ç­‰èµ„æº ç›¸æ¯”ç›´æ¥è°ƒç”¨ AWS/é˜¿é‡Œäº‘/Kubernetes çš„ APIï¼Œä½¿ç”¨ pulumi çš„å¥½å¤„æœ‰ï¼š å£°æ˜å¼é…ç½®ï¼šä½ åªéœ€è¦å£°æ˜ä½ çš„èµ„æºå±æ€§å°± OKï¼Œæ‰€æœ‰çš„çŠ¶æ€ç®¡ç†ã€å¼‚å¸¸å¤„ç†éƒ½ç”± pulumi å®Œæˆã€‚ ç»Ÿä¸€çš„é…ç½®æ–¹å¼ï¼šæä¾›ç»Ÿä¸€çš„é…ç½®æ–¹æ³•ï¼Œæ¥å£°æ˜å¼çš„é…ç½®æ‰€æœ‰ AWS/é˜¿é‡Œäº‘/Kubernetes èµ„æºã€‚ å£°æ˜å¼é…ç½®çš„å¯è¯»æ€§æ›´å¥½ï¼Œæ›´ä¾¿äºç»´æŠ¤ è¯•æƒ³ä¸€ä¸‹ï¼Œé€šè¿‡ä¼ ç»Ÿçš„æ‰‹æ®µå»ä»é›¶æ­å»ºä¸€ä¸ªäº‘ä¸Šæµ‹è¯•ç¯å¢ƒã€æˆ–è€…æœ¬åœ°å¼€å‘ç¯å¢ƒï¼Œéœ€è¦æ‰‹å·¥åšå¤šå°‘ç¹ççš„å·¥ä½œã€‚ è€Œä¾é  Pulumi è¿™ç±»ã€ŒåŸºç¡€è®¾æ–½å³ä»£ç ï¼ˆInfrastructure as Code, IaCï¼‰ã€çš„å·¥å…·ï¼Œåªéœ€è¦ä¸€è¡Œå‘½ä»¤å°±èƒ½æ­å»ºå¥½ä¸€ä¸ªå¯å¤ç°çš„äº‘ä¸Šæµ‹è¯•ç¯å¢ƒæˆ–æœ¬åœ°å¼€å‘ç¯å¢ƒã€‚ æ¯”å¦‚æˆ‘ä»¬çš„é˜¿é‡Œäº‘æµ‹è¯•ç¯å¢ƒï¼ŒåŒ…æ‹¬ä¸¤ä¸ª kubernetes é›†ç¾¤ã€è´Ÿè½½å‡è¡¡ã€VPC ç½‘ç»œã€æ•°æ®åº“ã€äº‘ç›‘æ§å‘Šè­¦ /æ—¥å¿—å‘Šè­¦ã€RAMè´¦å·æƒé™ä½“ç³»ç­‰ç­‰ï¼Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„ä½“ç³»ã€‚ äººå·¥å»é…ç½®è¿™ä¹ˆå¤šä¸œè¥¿ï¼Œæƒ³è¦å¤ç°æ˜¯å¾ˆå›°éš¾çš„ï¼Œéå¸¸ç¹çè€Œä¸”å®¹æ˜“å‡ºé”™ã€‚ ä½†æ˜¯ä½¿ç”¨ pulumiï¼Œåªéœ€è¦ä¸€è¡Œå‘½ä»¤ï¼Œå°±èƒ½åˆ›å»ºå¹¶é…ç½®å¥½è¿™äº”èŠ±å…«é—¨ä¸€å¤§å †çš„ç©æ„å„¿ã€‚é”€æ¯æ•´ä¸ªæµ‹è¯•ç¯å¢ƒä¹Ÿåªéœ€è¦ä¸€è¡Œå‘½ä»¤ã€‚ å®é™…ä½¿ç”¨ä½“éªŒï¼šæˆ‘ä»¬ä½¿ç”¨ Pulumi è‡ªåŠ¨åŒ–äº†é˜¿é‡Œäº‘æµ‹è¯•ç¯å¢ƒæ­å»º 95%+ çš„æ“ä½œï¼Œè¿™ä¸ªæ¯”ä¾‹éšç€é˜¿é‡Œäº‘çš„ pulumi provider çš„å®Œå–„ï¼Œè¿˜å¯ä»¥è¿›ä¸€æ­¥æé«˜ï¼ ","date":"2021-01-08","objectID":"/posts/experience-of-pulumi/:0:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/experience-of-pulumi/#"},{"categories":["tech"],"content":" Pulumi vs Terraform vs CloudFormationå…ˆä»‹ç»ä¸‹ CloudFormationï¼Œå®ƒæ˜¯ AWS æä¾›çš„ä¸€ä¸ª IaC å·¥å…·ï¼Œ å®ƒä½¿ç”¨ json/yaml ç¼–å†™å£°æ˜å¼é…ç½®æ–‡ä»¶ï¼Œç„¶åå®Œå…¨åœ¨ AWS äº‘ä¸Šè¿›è¡Œèµ„æºçš„åˆ›å»ºã€ç®¡ç†ã€é”€æ¯ã€‚å…¶æ‰€åˆ›å»ºçš„èµ„æºè·Ÿ CloudFormation Task åŒç”Ÿå‘½å‘¨æœŸï¼Œå› æ­¤åˆ é™¤è¯¥ CloudFormation Task å°±ä¼šè‡ªåŠ¨é”€æ¯æ‰€æœ‰ç›¸å…³èµ„æºã€‚å› æ­¤å®ƒçš„å¥½å¤„åº”è¯¥æ˜¯å¯ä»¥å®Œå…¨åœ¨äº‘ä¸Šè¿è¡Œï¼Œæœ¬åœ°å®¢æˆ·ç«¯åªæ˜¯ä¸€ä¸ªæäº¤é…ç½®çš„å·¥å…·ã€‚è€Œç¼ºç‚¹åˆ™æ˜¯åªèƒ½åœ¨ AWS ä¸Šä½¿ç”¨ã€‚ è€Œåœ¨é€šç”¨çš„ã€ŒåŸºç¡€è®¾æ–½å³ä»£ç ã€é¢†åŸŸï¼Œæœ‰ä¸€ä¸ªå·¥å…·æ¯” Pulumi æ›´æµè¡Œï¼Œå®ƒå°±æ˜¯Terraform. å®é™…ä¸Šæˆ‘ä»¬ä¸€å¼€å§‹ä½¿ç”¨çš„ä¹Ÿæ˜¯ Terraformï¼Œä½†æ˜¯åæ¥ä½¿ç”¨ Pulumi å®Œå…¨é‡å†™äº†ä¸€éã€‚ ä¸»è¦åŸå› æ˜¯ï¼ŒPulumi è§£å†³äº† Terraform é…ç½®çš„ä¸€ä¸ªç—›ç‚¹ï¼šé…ç½®è¯­æ³•å¤ªè¿‡ç®€å•ï¼Œå¯¼è‡´é…ç½®ç¹çã€‚è€Œä¸”è¿˜è¦é¢å¤–å­¦ä¹ ä¸€é—¨ DSL - HCL Terraform è™½ç„¶åº”ç”¨å¹¿æ³›ï¼Œä½†æ˜¯å®ƒé»˜è®¤ä½¿ç”¨çš„ HCL è¯­è¨€å¤ªç®€å•ï¼Œè¡¨ç°åŠ›ä¸å¤Ÿå¼ºã€‚è¿™å°±å¯¼è‡´åœ¨ä¸€äº›åœºæ™¯ä¸‹ä½¿ç”¨ Terraformï¼Œä¼šå‡ºç°å¤§é‡çš„é‡å¤é…ç½®ã€‚ ä¸€ä¸ªå…¸å‹çš„åœºæ™¯æ˜¯ã€Œæ‰¹é‡åˆ›å»ºèµ„æºï¼ŒåŠ¨æ€ç”Ÿæˆèµ„æºå‚æ•°ã€ã€‚æ¯”å¦‚æ‰¹é‡åˆ›å»ºä¸€æ‰¹åç§°ç±»ä¼¼çš„ ECS æœåŠ¡å™¨ /VPCäº¤æ¢æœºã€‚å¦‚æœä½¿ç”¨ terraformï¼Œå°±ä¼šå‡ºç°å¤§é‡çš„é‡å¤é…ç½®ã€‚ æ”¹ç”¨ terraform æä¾›çš„ module èƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šå®ç°é…ç½®çš„å¤ç”¨ï¼Œä½†æ˜¯å®ƒè¿˜æ˜¯è§£å†³ä¸äº†é—®é¢˜ã€‚è¦ä½¿ç”¨ moduleï¼Œä½ éœ€è¦ä»˜å‡ºæ—¶é—´å»å­¦ä¹  module çš„æ¦‚å¿µï¼Œä¸ºäº†æ‹¼æ¥å‚æ•°ï¼Œä½ è¿˜éœ€è¦å­¦ä¹  HCL çš„ä¸€äº›é«˜çº§ç”¨æ³•ã€‚ ä½†æ˜¯ä»˜å‡ºäº†è¿™ä¹ˆå¤šï¼Œæœ€åå†™å‡ºçš„ module è¿˜æ˜¯ä¸å¤Ÿçµæ´»â€”â€”å®ƒè¢« HCL å±€é™ä½äº†ã€‚ ä¸ºäº†å®ç°å¦‚æ­¤çš„å‚æ•°åŒ–åŠ¨æ€åŒ–ï¼Œæˆ‘ä»¬ä¸å¾—ä¸å¼•å…¥ Python ç­‰å…¶ä»–ç¼–ç¨‹è¯­è¨€ã€‚äºæ˜¯æ„å»ºæµç¨‹å°±å˜æˆäº†ï¼š å€ŸåŠ© Python ç­‰å…¶ä»–è¯­è¨€å…ˆç”Ÿæˆå‡º HCL é…ç½® é€šè¿‡ terraform å‘½ä»¤è¡Œè¿›è¡Œ plan ä¸ apply é€šè¿‡ Python ä»£ç è§£æ terraform.tfstatï¼Œè·å– apply ç»“æœï¼Œå†è¿›è¡Œè¿›ä¸€æ­¥æ“ä½œã€‚ è¿™æ˜¾ç„¶éå¸¸ç¹çï¼Œä¸»è¦å›°éš¾å°±åœ¨äº Python å’Œ Terraform ä¹‹é—´çš„äº¤äº’ã€‚ è¿›ä¸€æ­¥æ€è€ƒï¼Œæ—¢ç„¶å…¶ä»–ç¼–ç¨‹è¯­è¨€å¦‚ Python/Go çš„å¼•å…¥ä¸å¯é¿å…ï¼Œé‚£æ˜¯ä¸æ˜¯èƒ½ä½¿ç”¨å®ƒä»¬å½»åº•æ›¿ä»£æ‰ HCL å‘¢ï¼Ÿèƒ½ä¸èƒ½ç›´æ¥ä½¿ç”¨ Python/Go ç¼–å†™é…ç½®ï¼Ÿå¦‚æœ Terraform åŸç”Ÿå°±æ”¯æŒ Python/Go æ¥ç¼–å†™é…ç½®ï¼Œé‚£å°±ä¸å­˜åœ¨äº¤äº’é—®é¢˜äº†ã€‚ ç›¸æ¯”äºä½¿ç”¨é¢†åŸŸç‰¹å®šè¯­è¨€ HCLï¼Œä½¿ç”¨é€šç”¨ç¼–ç¨‹è¯­è¨€ç¼–å†™é…ç½®ï¼Œå¥½å¤„æœ‰ï¼š Python/Go/TypeScript ç­‰é€šç”¨çš„ç¼–ç¨‹è¯­è¨€ï¼Œä¹Ÿæ”¯æŒ Yaml è¿™æ ·æ–¹ä¾¿è‡ªåŠ¨åŒ–ç”Ÿæˆçš„é…ç½®è¯­è¨€ï¼Œèƒ½æ»¡è¶³ä½ çš„ä¸€åˆ‡éœ€æ±‚ã€‚ ä½œä¸ºä¸€ä¸ªå¼€å‘äººå‘˜/DevOpsï¼Œä½ åº”è¯¥å¯¹ Python/Go ç­‰è¯­è¨€ç›¸å½“ç†Ÿæ‚‰ï¼Œå¯ä»¥ç›´æ¥åˆ©ç”¨ä¸Šå·²æœ‰çš„ç»éªŒã€‚ æ›´æ–¹ä¾¿æµ‹è¯•ï¼šå¯ä»¥ä½¿ç”¨å„ç¼–ç¨‹è¯­è¨€ä¸­æµè¡Œçš„æµ‹è¯•æ¡†æ¶æ¥æµ‹è¯• pulumi é…ç½®ï¼ äºæ˜¯ Pulumi æ¨ªç©ºå‡ºä¸–ã€‚ å¦ä¸€ä¸ªå’Œ Pulumi åŠŸèƒ½ç±»ä¼¼çš„å·¥å…·ï¼Œæ˜¯åˆšå‡ºç‚‰æ²¡å¤šä¹…çš„terraform-cdkï¼Œä½†æ˜¯ç›®å‰å®ƒè¿˜å¾ˆä¸æˆç†Ÿã€‚ ","date":"2021-01-08","objectID":"/posts/experience-of-pulumi/:1:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/experience-of-pulumi/#pulumi-vs-terraform-vs-cloudformation"},{"categories":["tech"],"content":" Pulumi ç‰¹ç‚¹ä»‹ç» åŸç”Ÿæ”¯æŒé€šè¿‡ Python/Go/TypeScript/Dotnet ç­‰è¯­è¨€ç¼–å†™é…ç½®ï¼Œä¹Ÿå°±å®Œå…¨è§£å†³äº†ä¸Šè¿°çš„ terraform å’Œ python çš„äº¤äº’é—®é¢˜ã€‚ pulumi æ˜¯ç›®å‰æœ€æµè¡Œçš„ çœŸ-IaaS å·¥å…·ï¼Œå¯¹å„è¯­è¨€çš„æ”¯æŒéƒ½å¾ˆæˆç†Ÿã€‚ å…¼å®¹ terraform çš„æ‰€æœ‰ providerï¼Œåªæ˜¯éœ€è¦è‡ªè¡Œä½¿ç”¨pulumi-tf-provider-boilerplate é‡æ–°æ‰“åŒ…ï¼Œæœ‰äº›éº»çƒ¦ã€‚ pulumi å®˜æ–¹çš„ provider å‡ ä¹å…¨éƒ½æ˜¯å°è£…çš„ terraform providerï¼ŒåŒ…æ‹¬ aws/azure/alicloudï¼Œç›®å‰åªå‘ç° kubernetes æ˜¯åŸç”Ÿçš„ï¼ˆç‹¬è‹—å•Šï¼‰ã€‚ çŠ¶æ€ç®¡ç†å’Œ secrets ç®¡ç†æœ‰å¦‚ä¸‹å‡ ç§é€‰æ‹©ï¼š ä½¿ç”¨ app.pulumi.comï¼ˆé»˜è®¤ï¼‰:å…è´¹ç‰ˆæä¾› stack å†å²ç®¡ç†ï¼Œå¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„å†å²è®°å½•ã€‚å¦å¤–è¿˜æä¾›ä¸€ä¸ªèµ„æºå…³ç³»çš„å¯è§†åŒ–é¢æ¿ã€‚æ€»ä¹‹å¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯å¤šäººåˆä½œå°±éœ€è¦æ”¶è´¹ã€‚ æœ¬åœ°æ–‡ä»¶å­˜å‚¨ï¼špulumi login file:///app/data äº‘ç«¯å¯¹è±¡å­˜å‚¨ï¼Œ æ”¯æŒ s3 ç­‰å¯¹è±¡å­˜å‚¨åè®®ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ AWS æˆ–è€…æœ¬åœ°çš„ MinIO æ¥åš Backend. pulumi login 's3://\u003cbucket-path\u003e?endpoint=my.minio.local:8080\u0026disableSSL=true\u0026s3ForcePathStyle=true' minio/aws çš„ credential å¯ä»¥é€šè¿‡ AWS_ACCESS_KEY_ID å’Œ AWS_SECRET_ACCESS_KEY ä¸¤ä¸ªç¯å¢ƒå˜é‡è®¾ç½®ã€‚å¦å¤–å³ä½¿æ˜¯ä½¿ç”¨ MinIOï¼ŒAWS_REGION è¿™ä¸ªæ²¡å•¥ç”¨çš„ç¯å¢ƒå˜é‡ä¹Ÿå¿…é¡»è®¾ç½®ï¼å¦åˆ™ä¼šæŠ¥é”™ã€‚ gitlab 13 æ”¯æŒ Terraform HTTP State åè®®ï¼Œ ç­‰è¿™ä¸ª pr åˆå¹¶ï¼Œpulumi ä¹Ÿèƒ½ä»¥ gitlab ä¸º backend äº†ã€‚ ä½¿ç”¨ pulumi ä¼ä¸šç‰ˆï¼ˆè‡ªå»ºæœåŠ¡ï¼‰ï¼šæ¯” app.pulumi.com æä¾›æ›´å¤šçš„ç‰¹æ€§ï¼Œä½†æ˜¯æ˜¾ç„¶æ˜¯æ”¶è´¹çš„ã€‚ã€‚ æ€»ä¹‹ï¼Œéå¸¸é¦™ï¼Œå¼ºçƒˆæ¨èå„ä½ DevOps è¯•ç”¨ã€‚ ä»¥ä¸‹å†…å®¹æ˜¯æˆ‘å¯¹ pulumi çš„ä¸€äº›æ€è€ƒï¼Œä»¥åŠä½¿ç”¨ pulumi é‡åˆ°çš„å„ç§é—®é¢˜+è§£å†³æ–¹æ³•ï¼Œé€‚åˆå¯¹ pulumi æœ‰ä¸€å®šäº†è§£çš„åŒå­¦é˜…è¯»ã€‚ å¦‚æœä½ åˆšæ¥è§¦ Pulumi è€Œä¸”æœ‰å…´è¶£å­¦ä¹ ï¼Œå»ºè®®å…ˆç§»æ­¥pulumi get started å…¥ä¸ªé—¨ï¼Œå†æ¥ç€çœ‹ä¸‹é¢çš„å†…å®¹ã€‚ ","date":"2021-01-08","objectID":"/posts/experience-of-pulumi/:2:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/experience-of-pulumi/#pulumi-ç‰¹ç‚¹ä»‹ç»"},{"categories":["tech"],"content":" ä½¿ç”¨å»ºè®® å»ºè®®æŸ¥çœ‹å¯¹åº”çš„ terraform provider æ–‡æ¡£ï¼špulumi çš„ provider åŸºæœ¬éƒ½æ˜¯å°è£…çš„ terraform ç‰ˆæœ¬ï¼Œè€Œä¸”æ–‡æ¡£æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œæ¯”ï¼ˆç®€ï¼‰è¾ƒï¼ˆç›´ï¼‰éš¾ï¼ˆä¸€ï¼‰çœ‹ï¼ˆå¨ï¼‰æ‡‚ï¼ˆshiï¼‰ï¼Œexamples ä¹Ÿå°‘ã€‚ stack: pulumi å®˜æ–¹æä¾›äº†ä¸¤ç§ stack ç”¨æ³•ï¼šã€Œå•ä½“ã€å’Œã€Œå¾®-stackã€ å•ä½“: one stack rule them allï¼Œé€šè¿‡ stack å‚æ•°æ¥æ§åˆ¶æ­¥éª¤ã€‚stack ç”¨æ¥åŒºåˆ†ç¯å¢ƒ dev/pro ç­‰ã€‚ å¾®-stack: æ¯ä¸€ä¸ª stack æ˜¯ä¸€ä¸ªæ­¥éª¤ï¼Œæ‰€æœ‰ stack ç»„æˆä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®ã€‚ å®é™…ä½¿ç”¨ä¸­ï¼Œæˆ‘å‘ç°ã€Œå¾®-stackã€æ¨¡å¼éœ€è¦ä½¿ç”¨åˆ° pulumi çš„ inter-stack dependenciesï¼ŒæŠ¥ä¸€å †çš„é”™ï¼Œè€Œä¸”ä¸å¤Ÿçµæ´»ã€‚å› æ­¤ç›®å‰æ›´æ¨èã€Œå•ä½“ã€æ¨¡å¼ã€‚ æˆ‘ä»¬æœ€è¿‘ä½¿ç”¨ pulumi å®Œå…¨é‡å†™äº†ä»¥å‰ç”¨ terraform ç¼–å†™çš„äº‘ä¸Šé…ç½®ï¼Œç®€åŒ–äº†å¾ˆå¤šç¹ççš„é…ç½®ï¼Œä¹Ÿé™ä½äº†æˆ‘ä»¬ Python è¿ç»´ä»£ç å’Œ terraform ä¹‹é—´çš„äº¤äº’éš¾åº¦ã€‚å¦å¤–æˆ‘ä»¬è¿˜å……åˆ†åˆ©ç”¨ä¸Šäº† Python çš„ç±»å‹æ£€æŸ¥å’Œè¯­æ³•æ£€æŸ¥ï¼Œå¾ˆå¤šé”™è¯¯ IDE éƒ½èƒ½ç›´æ¥ç»™å‡ºæç¤ºï¼Œå¼ºåŒ–äº†é…ç½®çš„ä¸€è‡´æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ ä¸è¿‡ç”±äºé˜¿é‡Œäº‘ provider æš‚æ—¶è¿˜ï¼š ä¸æ”¯æŒç®¡ç† ASM æœåŠ¡ç½‘æ ¼ã€DTS æ•°æ®ä¼ è¾“ç­‰èµ„æº OSS ç­‰äº§å“çš„éƒ¨åˆ†å‚æ•°ä¹Ÿæš‚æ—¶ä¸æ”¯æŒé…ç½®ï¼ˆæ¯”å¦‚ OSS ä¸æ”¯æŒé…ç½®å›¾ç‰‡æ ·å¼ã€ElasticSearch æš‚æ—¶ä¸æ”¯æŒè‡ªåŠ¨åˆ›å»º 7.x ç‰ˆæœ¬ï¼‰ ä¸æ”¯æŒåˆ›å»º ElasticSearch 7.x è¿™äº›é—®é¢˜ï¼Œå¯¼è‡´æˆ‘ä»¬ä»ç„¶æœ‰éƒ¨åˆ†é…ç½®éœ€è¦æ‰‹åŠ¨å¤„ç†ï¼Œå¦å¤–ä¸€äº›è€—æ—¶é•¿çš„èµ„æºï¼Œéœ€è¦å•ç‹¬å»åˆ›å»ºã€‚å› æ­¤è¿˜ä¸èƒ½å®ç°å®Œå…¨çš„ã€Œä¸€é”®ã€ã€‚ ","date":"2021-01-08","objectID":"/posts/experience-of-pulumi/:3:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/experience-of-pulumi/#ä½¿ç”¨å»ºè®®"},{"categories":["tech"],"content":" å¸¸è§é—®é¢˜","date":"2021-01-08","objectID":"/posts/experience-of-pulumi/:4:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/experience-of-pulumi/#å¸¸è§é—®é¢˜"},{"categories":["tech"],"content":" 1. Output çš„ç”¨æ³• pulumi é€šè¿‡èµ„æºä¹‹é—´çš„å±æ€§å¼•ç”¨ï¼ˆOutput[str]ï¼‰æ¥ç¡®å®šä¾èµ–å…³ç³»ï¼Œå¦‚æœä½ é€šè¿‡è‡ªå®šä¹‰çš„å±æ€§ (str)è§£è€¦äº†èµ„æºä¾èµ–ï¼Œä¼šå¯¼è‡´èµ„æºåˆ›å»ºé¡ºåºé”™è¯¯è€Œåˆ›å»ºå¤±è´¥ã€‚ Output[str] æ˜¯ä¸€ä¸ªå¼‚æ­¥å±æ€§ï¼Œç±»ä¼¼ Futureï¼Œä¸èƒ½è¢«ç”¨åœ¨ pulumi å‚æ•°ä¹‹å¤–çš„åœ°æ–¹ï¼ Output[str] æä¾›ä¸¤ç§æ–¹æ³•èƒ½ç›´æ¥å¯¹ Output[str] è¿›è¡Œä¸€äº›æ“ä½œï¼š Output.concat(\"http://\", domain, \"/\", path): æ­¤æ–¹æ³•å°† str ä¸ Output[str] æ‹¼æ¥èµ·æ¥ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ Output[str] å¯¹è±¡ï¼Œå¯ç”¨åš pulumi å±æ€§ã€‚ domain.apply(lambda it: print(it)): Output[str] çš„ apply æ–¹æ³•æ¥æ”¶ä¸€ä¸ªå‡½æ•°ã€‚åœ¨å¼‚æ­¥è·å–åˆ°æ•°æ®åï¼Œpulumi ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼ŒæŠŠå…·ä½“çš„æ•°æ®ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚ å¦å¤– apply ä¹Ÿä¼šå°†ä¼ å…¥å‡½æ•°çš„è¿”å›å€¼åŒ…è£…æˆ Output ç±»å‹è¿”å›å‡ºæ¥ã€‚ å¯ç”¨äºï¼šåœ¨è·å–åˆ°æ•°æ®åï¼Œå°†æ•°æ®æ‰“å°å‡ºæ¥/å‘é€åˆ°é‚®ç®±/è°ƒç”¨æŸä¸ª API ä¸Šä¼ æ•°æ®ç­‰ç­‰ã€‚ Output.all(output1, output2, ...).apply(lambda it: print(it)) å¯ç”¨äºå°†å¤šä¸ªoutput å€¼ï¼Œæ‹¼æ¥æˆä¸€ä¸ª Output ç±»å‹ï¼Œå…¶å†…éƒ¨çš„ raw å€¼ä¸ºä¸€ä¸ª tuple å¯¹è±¡(str1, str2, ...). å®˜æ–¹ä¸¾ä¾‹ï¼šconnection_string = Output.all(sql_server.name, database.name).apply(lambda args: f\"Server=tcp:{args[0]}.database.windows.net;initial catalog={args[1]}...\") ","date":"2021-01-08","objectID":"/posts/experience-of-pulumi/:4:1","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/experience-of-pulumi/#1-output-çš„ç”¨æ³•"},{"categories":["tech"],"content":" 2. å¦‚ä½•ä½¿ç”¨å¤šä¸ªäº‘è´¦å·/å¤šä¸ª k8s é›†ç¾¤ï¼Ÿé»˜è®¤æƒ…å†µä¸‹ pulumi ä½¿ç”¨é»˜è®¤çš„ providerï¼Œä½†æ˜¯ pulumi æ‰€æœ‰çš„èµ„æºéƒ½æœ‰ä¸€ä¸ªé¢å¤–çš„ opts å‚æ•°ï¼Œ å¯ç”¨äºè®¾å®šå…¶ä»– providerã€‚ é€šè¿‡è¿™ä¸ª optsï¼Œæˆ‘ä»¬å¯ä»¥å®ç°åœ¨ä¸€ä¸ª pulumi é¡¹ç›®ä¸­ï¼Œä½¿ç”¨å¤šä¸ªäº‘è´¦å·ï¼Œæˆ–è€…ç®¡ç†å¤šä¸ª k8s é›†ç¾¤ã€‚ ç¤ºä¾‹ï¼š python from pulumi import get_stack, ResourceOptions, StackReference from pulumi_alicloud import Provider, oss # è‡ªå®šä¹‰ providerï¼Œkey/secret é€šè¿‡å‚æ•°è®¾å®šï¼Œè€Œä¸æ˜¯ä»é»˜è®¤çš„ç¯å¢ƒå˜é‡è¯»å–ã€‚ # å¯ä»¥è‡ªå®šä¹‰å¾ˆå¤šä¸ª providers provider = pulumi_alicloud.Provider( \"custom-alicloud-provider\", region=\"cn-hangzhou\", access_key=\"xxx\", secret_key=\"jjj\", ) # é€šè¿‡ optsï¼Œè®© pulumi ä½¿ç”¨è‡ªå®šä¹‰çš„ providerï¼ˆæ›¿æ¢æ‰é»˜è®¤çš„ï¼‰ bucket = oss.Bucket(..., opts=ResourceOptions(provider=provider)) ","date":"2021-01-08","objectID":"/posts/experience-of-pulumi/:4:2","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/experience-of-pulumi/#2-å¦‚ä½•ä½¿ç”¨å¤šä¸ªäº‘è´¦å·å¤šä¸ª-k8s-é›†ç¾¤"},{"categories":["tech"],"content":" 3. inter-stack å±æ€§ä¼ é€’ è¿™ä¸œè¥¿è¿˜æ²¡æé€ï¼Œå¾…ç ”ç©¶ã€‚ å¤šä¸ª stack ä¹‹é—´è¦äº’ç›¸ä¼ é€’å‚æ•°ï¼Œéœ€è¦é€šè¿‡ pulumi.export å¯¼å‡ºå±æ€§ï¼Œé€šè¿‡ stack.require_xxx è·å–å±æ€§ã€‚ ä»å¦ä¸€ä¸ª stack è¯»å–å±æ€§çš„ç¤ºä¾‹ï¼š python from pulumi import StackReference cfg = pulumi.Config() stack_name = pulumi.get_stack() # stack åç§° project = pulumi.get_project() infra = StackReference(f\"ryan4yin/{project}/{stack_name}\") # è¿™ä¸ªå±æ€§åœ¨ä¸Šä¸€ä¸ª stack ä¸­è¢« export å‡ºæ¥ vpc_id = infra.require(\"resources.vpc.id\") ","date":"2021-01-08","objectID":"/posts/experience-of-pulumi/:4:3","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/experience-of-pulumi/#3-inter-stack-å±æ€§ä¼ é€’"},{"categories":["tech"],"content":" 4. pulumi up è¢«ä¸­æ–­ï¼Œæˆ–è€…å¯¹èµ„æºåšäº†æ‰‹åŠ¨ä¿®æ”¹ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ å¼ºè¡Œä¸­æ–­ pulumi upï¼Œä¼šå¯¼è‡´èµ„æºè¿›å…¥ pending çŠ¶æ€ï¼Œå¿…é¡»æ‰‹åŠ¨ä¿®å¤ã€‚ ä¿®å¤æ–¹æ³•ï¼špulumi stack exportï¼Œåˆ é™¤ pending èµ„æºï¼Œå† pulumi stack import æ‰‹åŠ¨åˆ é™¤äº†äº‘ä¸Šèµ„æºï¼Œæˆ–è€…ä¿®æ”¹äº†ä¸€äº›å¯¹èµ„æºç®¡ç†æ— å½±å“çš„å‚æ•°ï¼Œå¯¹ pulumi æ²¡æœ‰å½±å“ï¼Œå®ƒèƒ½æ­£ç¡®æ£€æµ‹åˆ°è¿™ç§æƒ…å†µã€‚ å¯ä»¥é€šè¿‡ pulumi refresh æ‰‹åŠ¨ä»äº‘ä¸Šæ‹‰å–æœ€æ–°çš„èµ„æºçŠ¶æ€ã€‚ æ‰‹åŠ¨æ›´æ”¹äº†èµ„æºä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼ˆæ¯”å¦‚ç»‘å®š EIP ä¹‹ç±»çš„ï¼‰ï¼Œå¾ˆå¯èƒ½å¯¼è‡´ pulumi æ— æ³•æ­£ç¡®ç®¡ç†èµ„æºä¹‹é—´çš„ä¾èµ–ã€‚ è¿™ç§æƒ…å†µå¿…é¡»å…ˆæ‰‹åŠ¨è¿˜åŸä¾èµ–å…³ç³»ï¼ˆæˆ–è€…æŠŠç›¸å…³èµ„æºå…¨éƒ¨æ‰‹åŠ¨åˆ é™¤æ‰ï¼‰ï¼Œç„¶åæ‰èƒ½ç»§ç»­ä½¿ç”¨ pulumiã€‚ ","date":"2021-01-08","objectID":"/posts/experience-of-pulumi/:4:4","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/experience-of-pulumi/#4-pulumi-up-è¢«ä¸­æ–­æˆ–è€…å¯¹èµ„æºåšäº†æ‰‹åŠ¨ä¿®æ”¹ä¼šå‘ç”Ÿä»€ä¹ˆ"},{"categories":["tech"],"content":" 5. å¦‚ä½•æ‰‹åŠ¨å£°æ˜èµ„æºé—´çš„ä¾èµ–å…³ç³»ï¼Ÿæœ‰æ—¶å€™å› ä¸ºä¸€äº›é—®é¢˜ï¼ˆæ¯”å¦‚ pulumi provider åŠŸèƒ½ç¼ºå¤±ï¼Œä½¿ç”¨äº† restful api å®ç°éƒ¨åˆ†åŠŸèƒ½ï¼‰ï¼Œpulumi å¯èƒ½æ— æ³•è¯†åˆ«åˆ°æŸäº›èµ„æºä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚ è¿™æ—¶å¯ä»¥ä¸ºèµ„æºæ·»åŠ  dependsOn å±æ€§ï¼Œè¿™ä¸ªå±æ€§èƒ½æ˜¾å¼åœ°å£°æ˜ä¾èµ–å…³ç³»ã€‚ ","date":"2021-01-08","objectID":"/posts/experience-of-pulumi/:4:5","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/experience-of-pulumi/#5-å¦‚ä½•æ‰‹åŠ¨å£°æ˜èµ„æºé—´çš„ä¾èµ–å…³ç³»"},{"categories":["tech"],"content":" 6. å¦‚ä½•å¯¼å…¥å·²ç»å­˜åœ¨çš„èµ„æºï¼Ÿå¦‚æœä½ å¸ä¸æ˜¯ä¸€å¼€å§‹å°±ä½¿ç”¨äº† pulumi è¿™ç±»å·¥å…·ï¼Œé‚£é€šå¸¸ç»å¤§éƒ¨åˆ†äº‘ä¸Šèµ„æºéƒ½æ˜¯æ‰‹åŠ¨ç®¡ç†ã€æˆ–è€…ç”±å…¶ä»–å·¥å…·è‡ªåŠ¨åŒ–ç®¡ç†çš„ï¼Œè¯¥å¦‚ä½•å°†å®ƒä»¬çº³å…¥ pulumi ç®¡è¾–å‘¢ï¼Ÿ å®˜æ–¹æœ‰æä¾›ä¸€ç¯‡ç›¸å…³æ–‡æ¡£Importing Infrastructure. æ–‡æ¡£æœ‰æåˆ°ä¸¤ç§èµ„æºå¯¼å…¥çš„æ–¹æ³•ï¼Œå¯¼å…¥æˆåŠŸåéƒ½ä¼šè‡ªåŠ¨ç”Ÿæˆèµ„æºçš„çŠ¶æ€ï¼Œä»¥åŠå¯¹åº”çš„ pulumi ä»£ç ã€‚ç¬¬ä¸€ç§æ˜¯ä½¿ç”¨ pulumi import å‘½ä»¤ï¼Œç¬¬äºŒç§æ˜¯åœ¨ä»£ç ä¸­ä½¿ç”¨ import å‚æ•°ã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œç¤¾åŒºè¿˜æœ‰å‡ ä¸ªå…¶ä»–èµ„æºå¯¼å…¥å·¥å…·ï¼ˆreverse IaCï¼‰å€¼å¾—ç ”ç©¶ï¼š former2: ä¸ºå·²æœ‰çš„ AWS èµ„æºç”Ÿæˆ terraform/pulumi/cloudformation ç­‰é…ç½®ï¼Œä½†æ˜¯ä¸æ”¯æŒç”Ÿæˆ tfstate çŠ¶æ€ terraformer: ä¸ºå·²æœ‰çš„ AWS/GCP/Azure/Alicloud/DigitalOcean ç­‰å¤šç§äº‘èµ„æºç”Ÿæˆ terraform é…ç½®ä»¥åŠ tfstate çŠ¶æ€ terracognita: åŠŸèƒ½è·Ÿ terraformer ä¸€æ ·ï¼Œéƒ½æ”¯æŒç”Ÿæˆ terraform é…ç½®ä»¥åŠ tfstate çŠ¶æ€ï¼Œä½†æ˜¯å®ƒæ”¯æŒ AWS/GCP/Azure ä¸‰æœµäº‘ pulumi-terraform: è¿™ä¸ª provider ä½¿ä½ å¯ä»¥åœ¨ pulumi é¡¹ç›®é‡Œä½¿ç”¨ tfstate çŠ¶æ€æ–‡ä»¶ tf2pulumi: å°† terraform é…ç½®è½¬æ¢ä¸º pulumi typescript é…ç½® 6.1 é€šè¿‡ pulumi import å‘½ä»¤å¯¼å…¥èµ„æºä½¿ç”¨ pulumi import å‘½ä»¤å¯¼å…¥èµ„æºçš„å¥½å¤„æ˜¯ï¼Œä¸éœ€è¦ä¸ºæ¯ä¸ªèµ„æºæ‰‹å†™ä»£ç ï¼Œæ­¤å‘½ä»¤ä¼šè‡ªåŠ¨ç”Ÿæˆèµ„æºçš„ stack state ä¸é…ç½®ä»£ç ã€‚ ä½¿ç”¨æ­¤å‘½ä»¤å¯¼å…¥çš„èµ„æºï¼Œé»˜è®¤ä¼šå¯ç”¨åˆ é™¤ä¿æŠ¤ï¼Œä½ å¯é€šè¿‡å‚æ•° --protect=false æ¥å…³é—­åˆ é™¤ä¿æŠ¤ã€‚ èµ„æºåç§°å¯é€šè¿‡å‘½ä»¤è¡Œå‚æ•°ï¼Œæˆ–è€… Json æ–‡ä»¶æ¥æŒ‡å®šã€‚ ä¸‹é¢æˆ‘ä»¬æ¼”ç¤ºä¸€ä¸ªå¯¼å…¥ä¸€ä¸ª s3 bucket çš„æµç¨‹ï¼š shell # å¯¼å…¥ä¸€ä¸ªåä¸º test-sre çš„ s3 bucketï¼Œèµ„æº ID ä¸º p-test-sre $ pulumi import aws:s3/bucket:Bucket p-test-sre test-sre ...... Do you want to perform this import? yes Importing (dev): Type Name Status + pulumi:pulumi:Stack pulumi-test-dev created = â””â”€ aws:s3:Bucket p-test-sre imported Resources: + 1 created = 1 imported 2 changes Duration: 8s Please copy the following code into your Pulumi application. Not doing so will cause Pulumi to report that an update will happen on the next update command. Please note that the imported resources are marked as protected. To destroy them you will need to remove the `protect` option and run `pulumi update` *before* the destroy will take effect. import pulumi import pulumi_aws as aws p_test_sre = aws.s3.Bucket(\"p-test-sre\", arn=\"arn:aws:s3:::test-sre\", bucket=\"test-sre\", hosted_zone_id=\"ZZBBCC332211KK\", request_payer=\"BucketOwner\", tags={ \"Name\": \"test-sre\", \"Team\": \"Platform\", }, opts=pulumi.ResourceOptions(protect=True)) èƒ½çœ‹åˆ°å®ƒä¼šè‡ªåŠ¨å¯¼å…¥å¯¹åº”èµ„æºçš„ stateï¼Œå¹¶åŒæ—¶æ‰“å°å‡ºå¯¹åº”çš„ python ä»£ç ï¼Œè¦æ±‚æˆ‘ä»¬æ‰‹åŠ¨å°†ä»£ç å¤åˆ¶ç²˜è´´åˆ°é¡¹ç›®ä¸­ã€‚è€Œä¸”ä»£ç ä¼šè‡ªå¸¦ arn/hosted_zone_id/protect ç­‰å±æ€§ï¼Œè¯´æ˜è¿™ä¸ªèµ„æºå®é™…ä¸Šæ˜¯æ— æ³•åƒæ™®é€š pulumi èµ„æºä¸€æ ·ï¼Œé€šè¿‡ pulumi up/pulumi destroy è‡ªåŠ¨åˆ›å»ºé”€æ¯çš„ã€‚è¦é€šè¿‡ pulumi åˆ é™¤è¯¥èµ„æºï¼Œéœ€è¦é¦–å…ˆè§£é™¤åˆ é™¤ä¿æŠ¤ï¼Œç„¶åå°†å¯¹åº”çš„ä»£ç ç‰‡æ®µåˆ é™¤æ‰ï¼Œæœ€åæ‰§è¡Œ pulumi upã€‚ ä¹Ÿå¯é€šè¿‡ json æ¥æ‰¹é‡å¯¼å…¥èµ„æºï¼Œé¦–å…ˆç¼–å†™ä¸€ä¸ª json èµ„æºæ¸…å•ï¼š text { \"resources\": [{ \"type\": \"aws:s3/bucket:Bucket\", \"name\": \"s3-bucket_xxx-debug\", \"id\": \"xxx-debug\" }, { \"type\": \"aws:s3/accessPoint:AccessPoint\", \"name\": \"s3-accesspoint_xxx-debug\", \"id\": \"112233445566:xxx-debug\" } ] } ç„¶åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æ‰¹é‡å¯¼å…¥èµ„æºï¼š shell $ pulumi import -f test-resources.json ...... Do you want to perform this import? yes Importing (dev): Type Name Status pulumi:pulumi:Stack pulumi-test-dev = â”œâ”€ aws:s3:AccessPoint s3-accesspoint_xxx-debug imported = â””â”€ aws:s3:Bucket s3-bucket_xxx-debug imported Resources: = 2 imported 2 unchanged Duration: 8s Please copy the following code into your Pulumi application. Not doing so will cause Pulumi to report that an update will happen on the next update command. Please note that the imported resources are marked as protected. To destroy them you will need to remove the `protect` option and run `pulumi update` *before* the destroy will take effect. import pulumi import pulumi_aws as aws s3_bucket_snappea_dl_debug = aws.s3.Bucket(\"s3-bucket_xxx-debug\", arn=\"arn:aws:s3:::xxx-debug\", bucket=\"xxx-debug\", hosted_zone_id=\"ZZBBCC332211KK\", request_payer=\"BucketOwner\", tags={ \"Name\": \"xxx-debug\", \"Team\": \"Xxx\", }, opts=pulumi.ResourceOptions(protect=True)) s3_accesspoint_snappea_dl_debug = aws.s3.AccessPoint(\"s3-accesspoint_xxx-debug\", account_id=\"112233445566\", bucket=\"xxx-debug\", name=\"xxx-debug\", public_access_block_configuration=aws.s3.AccessPointPublicAccessBlockConfigurationArgs( block_public_acls=False, block_public_policy=False, ignore_public_acls=False, restrict_public_buckets=False, ), opts=pulumi.ResourceOptions(protect=True)) èƒ½çœ‹åˆ°åŒæ ·çš„ç”Ÿæˆå‡ºäº†ä¸¤ä¸ªèµ„æºçš„ stack çŠ¶æ€ï¼Œä»¥åŠå¯¹åº”çš„ä»£ç ã€‚ 6.2 é€šè¿‡ä»£ç å¯¼å…¥èµ„æºé€šè¿‡ä»£ç å¯¼å…¥èµ„æºï¼Œéœ€è¦ä½ æ‰‹å·¥ä¸ºæ¯ä¸ªèµ„æºç¼–å†™ä»£ç ï¼Œå¹¶ä¸”ç¡®ä¿ä»£ç çš„æ‰€æœ‰å‚æ•°ä¸èµ„æºæœ¬èº«çš„çŠ¶æ€å®Œå…¨ä¸€è‡´ã€‚ å› æ­¤å¯ä»¥çœ‹åˆ°è¿™ç§å¯¼å…¥æ–¹å¼å¾ˆä¸çµæ´»ï¼Œé€šå¸¸ä¸æ¨èä½¿ç”¨ï¼Œpulumi import è‡ªåŠ¨ç”Ÿæˆä»£ç å®ƒä¸é¦™ä¹ˆ emmmm å¤§æ¦‚çš„æµç¨‹å¦‚ä¸‹ï¼Œé¦–å…ˆç¼–å†™ä¸€ä¸ªèµ„æºçš„é…ç½®ä»£ç ï¼Œå¹¶å°†å…¶æ ‡æ³¨ä¸º import: python p_test_sre = aws.s3.Bucket(\"p-test-sre\", bucket=\"test-sre\", tags={ \"Name\": \"test-sre\", \"Team\": \"xxx\", # è¿™é‡Œæˆ‘æ•…æ„å†™é”™äº†ï¼Œpulumi ä¼šæ£€æµ‹åˆ°è¿™é‡Œæœ‰é—®é¢˜ï¼Œæç¤ºå¯¼å…¥å°†å¤±è´¥ }, opts","date":"2021-01-08","objectID":"/posts/experience-of-pulumi/:4:6","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/experience-of-pulumi/#6-å¦‚ä½•å¯¼å…¥å·²ç»å­˜åœ¨çš„èµ„æº"},{"categories":["tech"],"content":" 6. å¦‚ä½•å¯¼å…¥å·²ç»å­˜åœ¨çš„èµ„æºï¼Ÿå¦‚æœä½ å¸ä¸æ˜¯ä¸€å¼€å§‹å°±ä½¿ç”¨äº† pulumi è¿™ç±»å·¥å…·ï¼Œé‚£é€šå¸¸ç»å¤§éƒ¨åˆ†äº‘ä¸Šèµ„æºéƒ½æ˜¯æ‰‹åŠ¨ç®¡ç†ã€æˆ–è€…ç”±å…¶ä»–å·¥å…·è‡ªåŠ¨åŒ–ç®¡ç†çš„ï¼Œè¯¥å¦‚ä½•å°†å®ƒä»¬çº³å…¥ pulumi ç®¡è¾–å‘¢ï¼Ÿ å®˜æ–¹æœ‰æä¾›ä¸€ç¯‡ç›¸å…³æ–‡æ¡£Importing Infrastructure. æ–‡æ¡£æœ‰æåˆ°ä¸¤ç§èµ„æºå¯¼å…¥çš„æ–¹æ³•ï¼Œå¯¼å…¥æˆåŠŸåéƒ½ä¼šè‡ªåŠ¨ç”Ÿæˆèµ„æºçš„çŠ¶æ€ï¼Œä»¥åŠå¯¹åº”çš„ pulumi ä»£ç ã€‚ç¬¬ä¸€ç§æ˜¯ä½¿ç”¨ pulumi import å‘½ä»¤ï¼Œç¬¬äºŒç§æ˜¯åœ¨ä»£ç ä¸­ä½¿ç”¨ import å‚æ•°ã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œç¤¾åŒºè¿˜æœ‰å‡ ä¸ªå…¶ä»–èµ„æºå¯¼å…¥å·¥å…·ï¼ˆreverse IaCï¼‰å€¼å¾—ç ”ç©¶ï¼š former2: ä¸ºå·²æœ‰çš„ AWS èµ„æºç”Ÿæˆ terraform/pulumi/cloudformation ç­‰é…ç½®ï¼Œä½†æ˜¯ä¸æ”¯æŒç”Ÿæˆ tfstate çŠ¶æ€ terraformer: ä¸ºå·²æœ‰çš„ AWS/GCP/Azure/Alicloud/DigitalOcean ç­‰å¤šç§äº‘èµ„æºç”Ÿæˆ terraform é…ç½®ä»¥åŠ tfstate çŠ¶æ€ terracognita: åŠŸèƒ½è·Ÿ terraformer ä¸€æ ·ï¼Œéƒ½æ”¯æŒç”Ÿæˆ terraform é…ç½®ä»¥åŠ tfstate çŠ¶æ€ï¼Œä½†æ˜¯å®ƒæ”¯æŒ AWS/GCP/Azure ä¸‰æœµäº‘ pulumi-terraform: è¿™ä¸ª provider ä½¿ä½ å¯ä»¥åœ¨ pulumi é¡¹ç›®é‡Œä½¿ç”¨ tfstate çŠ¶æ€æ–‡ä»¶ tf2pulumi: å°† terraform é…ç½®è½¬æ¢ä¸º pulumi typescript é…ç½® 6.1 é€šè¿‡ pulumi import å‘½ä»¤å¯¼å…¥èµ„æºä½¿ç”¨ pulumi import å‘½ä»¤å¯¼å…¥èµ„æºçš„å¥½å¤„æ˜¯ï¼Œä¸éœ€è¦ä¸ºæ¯ä¸ªèµ„æºæ‰‹å†™ä»£ç ï¼Œæ­¤å‘½ä»¤ä¼šè‡ªåŠ¨ç”Ÿæˆèµ„æºçš„ stack state ä¸é…ç½®ä»£ç ã€‚ ä½¿ç”¨æ­¤å‘½ä»¤å¯¼å…¥çš„èµ„æºï¼Œé»˜è®¤ä¼šå¯ç”¨åˆ é™¤ä¿æŠ¤ï¼Œä½ å¯é€šè¿‡å‚æ•° --protect=false æ¥å…³é—­åˆ é™¤ä¿æŠ¤ã€‚ èµ„æºåç§°å¯é€šè¿‡å‘½ä»¤è¡Œå‚æ•°ï¼Œæˆ–è€… Json æ–‡ä»¶æ¥æŒ‡å®šã€‚ ä¸‹é¢æˆ‘ä»¬æ¼”ç¤ºä¸€ä¸ªå¯¼å…¥ä¸€ä¸ª s3 bucket çš„æµç¨‹ï¼š shell # å¯¼å…¥ä¸€ä¸ªåä¸º test-sre çš„ s3 bucketï¼Œèµ„æº ID ä¸º p-test-sre $ pulumi import aws:s3/bucket:Bucket p-test-sre test-sre ...... Do you want to perform this import? yes Importing (dev): Type Name Status + pulumi:pulumi:Stack pulumi-test-dev created = â””â”€ aws:s3:Bucket p-test-sre imported Resources: + 1 created = 1 imported 2 changes Duration: 8s Please copy the following code into your Pulumi application. Not doing so will cause Pulumi to report that an update will happen on the next update command. Please note that the imported resources are marked as protected. To destroy them you will need to remove the `protect` option and run `pulumi update` *before* the destroy will take effect. import pulumi import pulumi_aws as aws p_test_sre = aws.s3.Bucket(\"p-test-sre\", arn=\"arn:aws:s3:::test-sre\", bucket=\"test-sre\", hosted_zone_id=\"ZZBBCC332211KK\", request_payer=\"BucketOwner\", tags={ \"Name\": \"test-sre\", \"Team\": \"Platform\", }, opts=pulumi.ResourceOptions(protect=True)) èƒ½çœ‹åˆ°å®ƒä¼šè‡ªåŠ¨å¯¼å…¥å¯¹åº”èµ„æºçš„ stateï¼Œå¹¶åŒæ—¶æ‰“å°å‡ºå¯¹åº”çš„ python ä»£ç ï¼Œè¦æ±‚æˆ‘ä»¬æ‰‹åŠ¨å°†ä»£ç å¤åˆ¶ç²˜è´´åˆ°é¡¹ç›®ä¸­ã€‚è€Œä¸”ä»£ç ä¼šè‡ªå¸¦ arn/hosted_zone_id/protect ç­‰å±æ€§ï¼Œè¯´æ˜è¿™ä¸ªèµ„æºå®é™…ä¸Šæ˜¯æ— æ³•åƒæ™®é€š pulumi èµ„æºä¸€æ ·ï¼Œé€šè¿‡ pulumi up/pulumi destroy è‡ªåŠ¨åˆ›å»ºé”€æ¯çš„ã€‚è¦é€šè¿‡ pulumi åˆ é™¤è¯¥èµ„æºï¼Œéœ€è¦é¦–å…ˆè§£é™¤åˆ é™¤ä¿æŠ¤ï¼Œç„¶åå°†å¯¹åº”çš„ä»£ç ç‰‡æ®µåˆ é™¤æ‰ï¼Œæœ€åæ‰§è¡Œ pulumi upã€‚ ä¹Ÿå¯é€šè¿‡ json æ¥æ‰¹é‡å¯¼å…¥èµ„æºï¼Œé¦–å…ˆç¼–å†™ä¸€ä¸ª json èµ„æºæ¸…å•ï¼š text { \"resources\": [{ \"type\": \"aws:s3/bucket:Bucket\", \"name\": \"s3-bucket_xxx-debug\", \"id\": \"xxx-debug\" }, { \"type\": \"aws:s3/accessPoint:AccessPoint\", \"name\": \"s3-accesspoint_xxx-debug\", \"id\": \"112233445566:xxx-debug\" } ] } ç„¶åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æ‰¹é‡å¯¼å…¥èµ„æºï¼š shell $ pulumi import -f test-resources.json ...... Do you want to perform this import? yes Importing (dev): Type Name Status pulumi:pulumi:Stack pulumi-test-dev = â”œâ”€ aws:s3:AccessPoint s3-accesspoint_xxx-debug imported = â””â”€ aws:s3:Bucket s3-bucket_xxx-debug imported Resources: = 2 imported 2 unchanged Duration: 8s Please copy the following code into your Pulumi application. Not doing so will cause Pulumi to report that an update will happen on the next update command. Please note that the imported resources are marked as protected. To destroy them you will need to remove the `protect` option and run `pulumi update` *before* the destroy will take effect. import pulumi import pulumi_aws as aws s3_bucket_snappea_dl_debug = aws.s3.Bucket(\"s3-bucket_xxx-debug\", arn=\"arn:aws:s3:::xxx-debug\", bucket=\"xxx-debug\", hosted_zone_id=\"ZZBBCC332211KK\", request_payer=\"BucketOwner\", tags={ \"Name\": \"xxx-debug\", \"Team\": \"Xxx\", }, opts=pulumi.ResourceOptions(protect=True)) s3_accesspoint_snappea_dl_debug = aws.s3.AccessPoint(\"s3-accesspoint_xxx-debug\", account_id=\"112233445566\", bucket=\"xxx-debug\", name=\"xxx-debug\", public_access_block_configuration=aws.s3.AccessPointPublicAccessBlockConfigurationArgs( block_public_acls=False, block_public_policy=False, ignore_public_acls=False, restrict_public_buckets=False, ), opts=pulumi.ResourceOptions(protect=True)) èƒ½çœ‹åˆ°åŒæ ·çš„ç”Ÿæˆå‡ºäº†ä¸¤ä¸ªèµ„æºçš„ stack çŠ¶æ€ï¼Œä»¥åŠå¯¹åº”çš„ä»£ç ã€‚ 6.2 é€šè¿‡ä»£ç å¯¼å…¥èµ„æºé€šè¿‡ä»£ç å¯¼å…¥èµ„æºï¼Œéœ€è¦ä½ æ‰‹å·¥ä¸ºæ¯ä¸ªèµ„æºç¼–å†™ä»£ç ï¼Œå¹¶ä¸”ç¡®ä¿ä»£ç çš„æ‰€æœ‰å‚æ•°ä¸èµ„æºæœ¬èº«çš„çŠ¶æ€å®Œå…¨ä¸€è‡´ã€‚ å› æ­¤å¯ä»¥çœ‹åˆ°è¿™ç§å¯¼å…¥æ–¹å¼å¾ˆä¸çµæ´»ï¼Œé€šå¸¸ä¸æ¨èä½¿ç”¨ï¼Œpulumi import è‡ªåŠ¨ç”Ÿæˆä»£ç å®ƒä¸é¦™ä¹ˆ emmmm å¤§æ¦‚çš„æµç¨‹å¦‚ä¸‹ï¼Œé¦–å…ˆç¼–å†™ä¸€ä¸ªèµ„æºçš„é…ç½®ä»£ç ï¼Œå¹¶å°†å…¶æ ‡æ³¨ä¸º import: python p_test_sre = aws.s3.Bucket(\"p-test-sre\", bucket=\"test-sre\", tags={ \"Name\": \"test-sre\", \"Team\": \"xxx\", # è¿™é‡Œæˆ‘æ•…æ„å†™é”™äº†ï¼Œpulumi ä¼šæ£€æµ‹åˆ°è¿™é‡Œæœ‰é—®é¢˜ï¼Œæç¤ºå¯¼å…¥å°†å¤±è´¥ }, opts","date":"2021-01-08","objectID":"/posts/experience-of-pulumi/:4:6","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/experience-of-pulumi/#61-é€šè¿‡-pulumi-import-å‘½ä»¤å¯¼å…¥èµ„æº"},{"categories":["tech"],"content":" 6. å¦‚ä½•å¯¼å…¥å·²ç»å­˜åœ¨çš„èµ„æºï¼Ÿå¦‚æœä½ å¸ä¸æ˜¯ä¸€å¼€å§‹å°±ä½¿ç”¨äº† pulumi è¿™ç±»å·¥å…·ï¼Œé‚£é€šå¸¸ç»å¤§éƒ¨åˆ†äº‘ä¸Šèµ„æºéƒ½æ˜¯æ‰‹åŠ¨ç®¡ç†ã€æˆ–è€…ç”±å…¶ä»–å·¥å…·è‡ªåŠ¨åŒ–ç®¡ç†çš„ï¼Œè¯¥å¦‚ä½•å°†å®ƒä»¬çº³å…¥ pulumi ç®¡è¾–å‘¢ï¼Ÿ å®˜æ–¹æœ‰æä¾›ä¸€ç¯‡ç›¸å…³æ–‡æ¡£Importing Infrastructure. æ–‡æ¡£æœ‰æåˆ°ä¸¤ç§èµ„æºå¯¼å…¥çš„æ–¹æ³•ï¼Œå¯¼å…¥æˆåŠŸåéƒ½ä¼šè‡ªåŠ¨ç”Ÿæˆèµ„æºçš„çŠ¶æ€ï¼Œä»¥åŠå¯¹åº”çš„ pulumi ä»£ç ã€‚ç¬¬ä¸€ç§æ˜¯ä½¿ç”¨ pulumi import å‘½ä»¤ï¼Œç¬¬äºŒç§æ˜¯åœ¨ä»£ç ä¸­ä½¿ç”¨ import å‚æ•°ã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œç¤¾åŒºè¿˜æœ‰å‡ ä¸ªå…¶ä»–èµ„æºå¯¼å…¥å·¥å…·ï¼ˆreverse IaCï¼‰å€¼å¾—ç ”ç©¶ï¼š former2: ä¸ºå·²æœ‰çš„ AWS èµ„æºç”Ÿæˆ terraform/pulumi/cloudformation ç­‰é…ç½®ï¼Œä½†æ˜¯ä¸æ”¯æŒç”Ÿæˆ tfstate çŠ¶æ€ terraformer: ä¸ºå·²æœ‰çš„ AWS/GCP/Azure/Alicloud/DigitalOcean ç­‰å¤šç§äº‘èµ„æºç”Ÿæˆ terraform é…ç½®ä»¥åŠ tfstate çŠ¶æ€ terracognita: åŠŸèƒ½è·Ÿ terraformer ä¸€æ ·ï¼Œéƒ½æ”¯æŒç”Ÿæˆ terraform é…ç½®ä»¥åŠ tfstate çŠ¶æ€ï¼Œä½†æ˜¯å®ƒæ”¯æŒ AWS/GCP/Azure ä¸‰æœµäº‘ pulumi-terraform: è¿™ä¸ª provider ä½¿ä½ å¯ä»¥åœ¨ pulumi é¡¹ç›®é‡Œä½¿ç”¨ tfstate çŠ¶æ€æ–‡ä»¶ tf2pulumi: å°† terraform é…ç½®è½¬æ¢ä¸º pulumi typescript é…ç½® 6.1 é€šè¿‡ pulumi import å‘½ä»¤å¯¼å…¥èµ„æºä½¿ç”¨ pulumi import å‘½ä»¤å¯¼å…¥èµ„æºçš„å¥½å¤„æ˜¯ï¼Œä¸éœ€è¦ä¸ºæ¯ä¸ªèµ„æºæ‰‹å†™ä»£ç ï¼Œæ­¤å‘½ä»¤ä¼šè‡ªåŠ¨ç”Ÿæˆèµ„æºçš„ stack state ä¸é…ç½®ä»£ç ã€‚ ä½¿ç”¨æ­¤å‘½ä»¤å¯¼å…¥çš„èµ„æºï¼Œé»˜è®¤ä¼šå¯ç”¨åˆ é™¤ä¿æŠ¤ï¼Œä½ å¯é€šè¿‡å‚æ•° --protect=false æ¥å…³é—­åˆ é™¤ä¿æŠ¤ã€‚ èµ„æºåç§°å¯é€šè¿‡å‘½ä»¤è¡Œå‚æ•°ï¼Œæˆ–è€… Json æ–‡ä»¶æ¥æŒ‡å®šã€‚ ä¸‹é¢æˆ‘ä»¬æ¼”ç¤ºä¸€ä¸ªå¯¼å…¥ä¸€ä¸ª s3 bucket çš„æµç¨‹ï¼š shell # å¯¼å…¥ä¸€ä¸ªåä¸º test-sre çš„ s3 bucketï¼Œèµ„æº ID ä¸º p-test-sre $ pulumi import aws:s3/bucket:Bucket p-test-sre test-sre ...... Do you want to perform this import? yes Importing (dev): Type Name Status + pulumi:pulumi:Stack pulumi-test-dev created = â””â”€ aws:s3:Bucket p-test-sre imported Resources: + 1 created = 1 imported 2 changes Duration: 8s Please copy the following code into your Pulumi application. Not doing so will cause Pulumi to report that an update will happen on the next update command. Please note that the imported resources are marked as protected. To destroy them you will need to remove the `protect` option and run `pulumi update` *before* the destroy will take effect. import pulumi import pulumi_aws as aws p_test_sre = aws.s3.Bucket(\"p-test-sre\", arn=\"arn:aws:s3:::test-sre\", bucket=\"test-sre\", hosted_zone_id=\"ZZBBCC332211KK\", request_payer=\"BucketOwner\", tags={ \"Name\": \"test-sre\", \"Team\": \"Platform\", }, opts=pulumi.ResourceOptions(protect=True)) èƒ½çœ‹åˆ°å®ƒä¼šè‡ªåŠ¨å¯¼å…¥å¯¹åº”èµ„æºçš„ stateï¼Œå¹¶åŒæ—¶æ‰“å°å‡ºå¯¹åº”çš„ python ä»£ç ï¼Œè¦æ±‚æˆ‘ä»¬æ‰‹åŠ¨å°†ä»£ç å¤åˆ¶ç²˜è´´åˆ°é¡¹ç›®ä¸­ã€‚è€Œä¸”ä»£ç ä¼šè‡ªå¸¦ arn/hosted_zone_id/protect ç­‰å±æ€§ï¼Œè¯´æ˜è¿™ä¸ªèµ„æºå®é™…ä¸Šæ˜¯æ— æ³•åƒæ™®é€š pulumi èµ„æºä¸€æ ·ï¼Œé€šè¿‡ pulumi up/pulumi destroy è‡ªåŠ¨åˆ›å»ºé”€æ¯çš„ã€‚è¦é€šè¿‡ pulumi åˆ é™¤è¯¥èµ„æºï¼Œéœ€è¦é¦–å…ˆè§£é™¤åˆ é™¤ä¿æŠ¤ï¼Œç„¶åå°†å¯¹åº”çš„ä»£ç ç‰‡æ®µåˆ é™¤æ‰ï¼Œæœ€åæ‰§è¡Œ pulumi upã€‚ ä¹Ÿå¯é€šè¿‡ json æ¥æ‰¹é‡å¯¼å…¥èµ„æºï¼Œé¦–å…ˆç¼–å†™ä¸€ä¸ª json èµ„æºæ¸…å•ï¼š text { \"resources\": [{ \"type\": \"aws:s3/bucket:Bucket\", \"name\": \"s3-bucket_xxx-debug\", \"id\": \"xxx-debug\" }, { \"type\": \"aws:s3/accessPoint:AccessPoint\", \"name\": \"s3-accesspoint_xxx-debug\", \"id\": \"112233445566:xxx-debug\" } ] } ç„¶åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æ‰¹é‡å¯¼å…¥èµ„æºï¼š shell $ pulumi import -f test-resources.json ...... Do you want to perform this import? yes Importing (dev): Type Name Status pulumi:pulumi:Stack pulumi-test-dev = â”œâ”€ aws:s3:AccessPoint s3-accesspoint_xxx-debug imported = â””â”€ aws:s3:Bucket s3-bucket_xxx-debug imported Resources: = 2 imported 2 unchanged Duration: 8s Please copy the following code into your Pulumi application. Not doing so will cause Pulumi to report that an update will happen on the next update command. Please note that the imported resources are marked as protected. To destroy them you will need to remove the `protect` option and run `pulumi update` *before* the destroy will take effect. import pulumi import pulumi_aws as aws s3_bucket_snappea_dl_debug = aws.s3.Bucket(\"s3-bucket_xxx-debug\", arn=\"arn:aws:s3:::xxx-debug\", bucket=\"xxx-debug\", hosted_zone_id=\"ZZBBCC332211KK\", request_payer=\"BucketOwner\", tags={ \"Name\": \"xxx-debug\", \"Team\": \"Xxx\", }, opts=pulumi.ResourceOptions(protect=True)) s3_accesspoint_snappea_dl_debug = aws.s3.AccessPoint(\"s3-accesspoint_xxx-debug\", account_id=\"112233445566\", bucket=\"xxx-debug\", name=\"xxx-debug\", public_access_block_configuration=aws.s3.AccessPointPublicAccessBlockConfigurationArgs( block_public_acls=False, block_public_policy=False, ignore_public_acls=False, restrict_public_buckets=False, ), opts=pulumi.ResourceOptions(protect=True)) èƒ½çœ‹åˆ°åŒæ ·çš„ç”Ÿæˆå‡ºäº†ä¸¤ä¸ªèµ„æºçš„ stack çŠ¶æ€ï¼Œä»¥åŠå¯¹åº”çš„ä»£ç ã€‚ 6.2 é€šè¿‡ä»£ç å¯¼å…¥èµ„æºé€šè¿‡ä»£ç å¯¼å…¥èµ„æºï¼Œéœ€è¦ä½ æ‰‹å·¥ä¸ºæ¯ä¸ªèµ„æºç¼–å†™ä»£ç ï¼Œå¹¶ä¸”ç¡®ä¿ä»£ç çš„æ‰€æœ‰å‚æ•°ä¸èµ„æºæœ¬èº«çš„çŠ¶æ€å®Œå…¨ä¸€è‡´ã€‚ å› æ­¤å¯ä»¥çœ‹åˆ°è¿™ç§å¯¼å…¥æ–¹å¼å¾ˆä¸çµæ´»ï¼Œé€šå¸¸ä¸æ¨èä½¿ç”¨ï¼Œpulumi import è‡ªåŠ¨ç”Ÿæˆä»£ç å®ƒä¸é¦™ä¹ˆ emmmm å¤§æ¦‚çš„æµç¨‹å¦‚ä¸‹ï¼Œé¦–å…ˆç¼–å†™ä¸€ä¸ªèµ„æºçš„é…ç½®ä»£ç ï¼Œå¹¶å°†å…¶æ ‡æ³¨ä¸º import: python p_test_sre = aws.s3.Bucket(\"p-test-sre\", bucket=\"test-sre\", tags={ \"Name\": \"test-sre\", \"Team\": \"xxx\", # è¿™é‡Œæˆ‘æ•…æ„å†™é”™äº†ï¼Œpulumi ä¼šæ£€æµ‹åˆ°è¿™é‡Œæœ‰é—®é¢˜ï¼Œæç¤ºå¯¼å…¥å°†å¤±è´¥ }, opts","date":"2021-01-08","objectID":"/posts/experience-of-pulumi/:4:6","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/experience-of-pulumi/#62-é€šè¿‡ä»£ç å¯¼å…¥èµ„æº"},{"categories":["tech"],"content":" 6.3 å¦‚ä½•ä» pulumi ä¸­ç§»é™¤è¢«å¯¼å…¥çš„èµ„æºæ ¼å¼å¦‚ä¸‹ï¼š shell pulumi state delete \u003cresource URN\u003e [flags] æ¯”å¦‚è¦åˆ é™¤å…ˆå‰å¯¼å…¥çš„ arn:aws:s3:::test-sreï¼Œé¦–å…ˆåˆ é™¤å¯¹åº”çš„ä»£ç ï¼Œç„¶åæ‰§è¡Œpulumi previewï¼Œå°±ä¼šæŠ¥é”™å¹¶æ‰“å°å‡ºå¯¹åº”çš„èµ„æº urn: text $ pulumi preview ... Diagnostics: aws:s3:Bucket (p-test-sre): error: Preview failed: unable to delete resource \"urn:pulumi:dev::pulumi-test::aws:s3/bucket:Bucket::p-test-sre\" as it is currently marked for protection. To unprotect the resource, either remove the `protect` flag from the resource in your Pulumi program and run `pulumi up` or use the command: `pulumi state unprotect 'urn:pulumi:dev::pulumi-test::aws:s3/bucket:Bucket::p-test-sre'` æ¥ä¸‹æ¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¼ºåˆ¶ä» state æ–‡ä»¶ä¸­ç§»é™¤æ­¤èµ„æºï¼ˆä»…ä¿®æ”¹é…ç½®ï¼Œå¯¹å®é™…èµ„æºæ— ä»»ä½•å½±å“ï¼‰ï¼š shell pulumi state delete urn:pulumi:dev::pulumi-test::aws:s3/bucket:Bucket::p-test-sre --force ","date":"2021-01-08","objectID":"/posts/experience-of-pulumi/:4:7","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/experience-of-pulumi/#63-å¦‚ä½•ä»-pulumi-ä¸­ç§»é™¤è¢«å¯¼å…¥çš„èµ„æº"},{"categories":["tech"],"content":" 5. pulumi-kubernetesï¼Ÿpulumi-kubernetes æ˜¯ä¸€æ¡é¾™æœåŠ¡ï¼š åœ¨ yaml é…ç½®ç”Ÿæˆè¿™ä¸€æ­¥ï¼Œå®ƒèƒ½ç»“åˆ/æ›¿ä»£æ‰ helm/kustomizeï¼Œæˆ–è€…ä½ é«˜åº¦è‡ªå®šä¹‰çš„ Python è„šæœ¬ã€‚ åœ¨ yaml éƒ¨ç½²è¿™ä¸€æ­¥ï¼Œå®ƒèƒ½æ›¿ä»£æ‰ argo-cd è¿™ç±» gitops å·¥å…·ã€‚ å¼ºå¤§çš„çŠ¶æ€ç®¡ç†ï¼Œargo-cd ä¹Ÿæœ‰çŠ¶æ€ç®¡ç†ï¼Œå¯ä»¥å¯¹æ¯”çœ‹çœ‹ã€‚ ä¹Ÿå¯ä»¥ä»…é€šè¿‡ kubernetes_pulumi ç”Ÿæˆ yamlï¼Œå†é€šè¿‡ argo-cd éƒ¨ç½²ï¼Œè¿™æ · pulumi_kubernetes å°±ä»…ç”¨æ¥ç®€åŒ– yaml çš„ç¼–å†™ï¼Œä»ç„¶é€šè¿‡ gitops å·¥å…·/kubectl æ¥éƒ¨ç½²ã€‚ ä½¿ç”¨ pulumi-kubernetes å†™é…ç½®ï¼Œè¦è­¦æƒ•é€»è¾‘å’Œæ•°æ®çš„æ··åˆç¨‹åº¦ã€‚å› ä¸º kubernetes çš„é…ç½®å¤æ‚åº¦æ¯”è¾ƒé«˜ï¼Œå¦‚æœåŠ¨æ€é…ç½®æ¯”è¾ƒå¤šï¼Œå¾ˆå®¹æ˜“å°±ä¼šå†™å‡ºéš¾ä»¥ç»´æŠ¤çš„ python ä»£ç æ¥ã€‚ æ¸²æŸ“ yaml çš„ç¤ºä¾‹ï¼š python from pulumi import get_stack, ResourceOptions, StackReference from pulumi_kubernetes import Provider from pulumi_kubernetes.apps.v1 import Deployment, DeploymentSpecArgs from pulumi_kubernetes.core.v1 import ( ContainerArgs, ContainerPortArgs, EnvVarArgs, PodSpecArgs, PodTemplateSpecArgs, ResourceRequirementsArgs, Service, ServicePortArgs, ServiceSpecArgs, ) from pulumi_kubernetes.meta.v1 import LabelSelectorArgs, ObjectMetaArgs provider = Provider( \"render-yaml\", render_yaml_to_directory=\"rendered\", ) deployment = Deployment( \"redis\", spec=DeploymentSpecArgs(...), opts=ResourceOptions(provider=provider), ) å¦‚ç¤ºä¾‹æ‰€ç¤ºï¼Œpulumi-kubernetes çš„é…ç½®æ˜¯å®Œå…¨ç»“æ„åŒ–çš„ï¼Œæ¯” yaml/helm/kustomize è¦çµæ´»éå¸¸å¤šã€‚ æ€»ä¹‹å®ƒéå¸¸çµæ´»ï¼Œæ—¢å¯ä»¥å’Œ helm/kustomize ç»“åˆä½¿ç”¨ï¼Œæ›¿ä»£æ‰ argocd/kubectlã€‚ä¹Ÿå¯ä»¥å’Œ argocd/kubectl ä½¿ç”¨ï¼Œæ›¿ä»£æ‰ helm/kustomizeã€‚ å…·ä½“æ€ä¹ˆä½¿ç”¨å¥½ï¼Ÿæˆ‘ä¹Ÿè¿˜åœ¨ç ”ç©¶ã€‚ ","date":"2021-01-08","objectID":"/posts/experience-of-pulumi/:4:8","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/experience-of-pulumi/#5-pulumi-kubernetes"},{"categories":["tech"],"content":" 6. é˜¿é‡Œäº‘èµ„æº replace æŠ¥é”™ï¼Ÿé˜¿é‡Œäº‘æœ‰éƒ¨åˆ†èµ„æºï¼Œåªèƒ½åˆ›å»ºåˆ é™¤ï¼Œä¸å…è®¸ä¿®æ”¹ï¼Œæ¯”å¦‚ã€Œèµ„æºç»„ã€ã€‚å¯¹è¿™ç±»èµ„æºåšå˜æ›´æ—¶ï¼Œpulumi ä¼šç›´æ¥æŠ¥é”™ï¼šã€ŒResources aleardy existsã€ï¼Œè¿™ç±»èµ„æºï¼Œé€šå¸¸éƒ½æœ‰ä¸€ä¸ªã€Œforceã€å‚æ•°ï¼ŒæŒ‡ç¤ºæ˜¯å¦å¼ºåˆ¶ä¿®æ”¹â€”â€”å³å…ˆåˆ é™¤å†é‡å»ºã€‚ ","date":"2021-01-08","objectID":"/posts/experience-of-pulumi/:4:9","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/experience-of-pulumi/#6-é˜¿é‡Œäº‘èµ„æº-replace-æŠ¥é”™"},{"categories":["tech"],"content":" 7. æœ‰äº›èµ„æºå±æ€§æ— æ³•ä½¿ç”¨ pulumi é…ç½®ï¼Ÿè¿™å¾—çœ‹å„äº‘æœåŠ¡æä¾›å•†çš„æ”¯æŒæƒ…å†µã€‚ æ¯”å¦‚é˜¿é‡Œäº‘å¾ˆå¤šèµ„æºçš„å±æ€§ï¼Œpulumi éƒ½æ— æ³•å®Œå…¨é…ç½®ï¼Œå› ä¸º alicloud provider çš„åŠŸèƒ½è¿˜ä¸å¤Ÿå…¨é¢ã€‚ ç›®å‰æˆ‘ä»¬ç”Ÿäº§ç¯å¢ƒï¼Œå¤§æ¦‚ 95%+ çš„ä¸œè¥¿ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ pulumi å®ç°è‡ªåŠ¨åŒ–é…ç½®ã€‚è€Œå…¶ä»– OSS çš„é«˜çº§å‚æ•°ã€æ–°å‡ºçš„ ASM æœåŠ¡ç½‘æ ¼ã€kubernetes çš„æˆæƒç®¡ç†ã€ElasticSearch7 ç­‰èµ„æºï¼Œè¿˜æ˜¯éœ€è¦æ‰‹åŠ¨é…ç½®ã€‚ è¿™ä¸ªæ²¡åŠæ³•ï¼Œåªèƒ½ç­‰é˜¿é‡Œäº‘æä¾›æ”¯æŒã€‚ ","date":"2021-01-08","objectID":"/posts/experience-of-pulumi/:4:10","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/experience-of-pulumi/#7-æœ‰äº›èµ„æºå±æ€§æ— æ³•ä½¿ç”¨-pulumi-é…ç½®"},{"categories":["tech"],"content":" 8. CI/CD ä¸­å¦‚ä½•ä½¿ pulumi å°†çŠ¶æ€ä¿å­˜åˆ°æ–‡ä»¶ï¼ŸCI/CD ä¸­æˆ‘ä»¬å¯èƒ½ä¼šå¸Œæœ› pulumi å°†çŠ¶æ€ä¿å­˜åˆ°æœ¬åœ°ï¼Œé¿å…è¿æ¥ pulumi ä¸­å¿ƒæœåŠ¡å™¨ã€‚è¿™ä¸€æ–¹é¢èƒ½åŠ å¿«é€Ÿåº¦ï¼Œå¦ä¸€æ–¹é¢ä¸€äº›ä¸´æ—¶çŠ¶æ€æˆ‘ä»¬å¯èƒ½æ ¹æœ¬ä¸æƒ³å­˜å‚¨ï¼Œå¯ä»¥ç›´æ¥ä¸¢å¼ƒã€‚ æ–¹æ³•ï¼š shell # æŒ‡å®šçŠ¶æ€æ–‡ä»¶è·¯å¾„ pulumi login file://\u003cfile-path\u003e # ä¿å­˜åˆ°é»˜è®¤ä½ç½®: ~/.pulumi/credentials.json pulumi login --local # ä¿å­˜åˆ°è¿œç¨‹ S3 å­˜å‚¨ï¼ˆminio/ceph æˆ–è€…å„ç±»äº‘å¯¹è±¡å­˜å‚¨æœåŠ¡ï¼Œéƒ½å…¼å®¹ aws çš„ s3 åè®®ï¼‰ pulumi login s3://\u003cbucket-path\u003e ç™»å½•å®Œæˆåï¼Œå†è¿›è¡Œ pulumi up æ“ä½œï¼Œæ•°æ®å°±ä¼šç›´æ¥ä¿å­˜åˆ°ä½ è®¾å®šçš„è·¯å¾„ä¸‹ã€‚ ","date":"2021-01-08","objectID":"/posts/experience-of-pulumi/:4:11","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/experience-of-pulumi/#8-cicd-ä¸­å¦‚ä½•ä½¿-pulumi-å°†çŠ¶æ€ä¿å­˜åˆ°æ–‡ä»¶"},{"categories":["tech"],"content":" 9. å¦‚ä½•ä¼°ç®—èµ„æºå˜æ›´å¯¼è‡´çš„æˆæœ¬å˜åŒ–ï¼Ÿç›®å‰ pulumi è²Œä¼¼æ²¡æœ‰ç±»ä¼¼çš„å·¥å…·ï¼Œä½†æ˜¯ terraform æœ‰ä¸€ä¸ªinfracost å¯ä»¥å¹²è¿™ä¸ªæ´»ï¼Œå€¼å¾—å…³æ³¨ã€‚ ","date":"2021-01-08","objectID":"/posts/experience-of-pulumi/:4:12","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/experience-of-pulumi/#9-å¦‚ä½•ä¼°ç®—èµ„æºå˜æ›´å¯¼è‡´çš„æˆæœ¬å˜åŒ–"},{"categories":["tech"],"content":" ç¼ºç‚¹","date":"2021-01-08","objectID":"/posts/experience-of-pulumi/:5:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/experience-of-pulumi/#ç¼ºç‚¹"},{"categories":["tech"],"content":" 1. æŠ¥é”™ä¿¡æ¯ä¸ç›´è§‚pulumi å’Œ terraform éƒ½æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯å°è£…å±‚æ¬¡å¤ªé«˜äº†ã€‚ å°è£…çš„å±‚æ¬¡å¾ˆé«˜ï¼Œä¼˜ç‚¹æ˜¯æ–¹ä¾¿äº†æˆ‘ä»¬ä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨å¾ˆç»Ÿä¸€å¾ˆç®€æ´çš„å£°æ˜å¼è¯­æ³•ç¼–å†™é…ç½®ã€‚è€Œç¼ºç‚¹ï¼Œåˆ™æ˜¯å‡ºäº† bugï¼ŒæŠ¥é”™ä¿¡æ¯å¾€å¾€ä¸å¤Ÿç›´è§‚ï¼Œå¯¼è‡´é—®é¢˜ä¸å¥½æ’æŸ¥ã€‚ ","date":"2021-01-08","objectID":"/posts/experience-of-pulumi/:5:1","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/experience-of-pulumi/#1-æŠ¥é”™ä¿¡æ¯ä¸ç›´è§‚"},{"categories":["tech"],"content":" 2. èµ„æºçŠ¶æ€è¢«ç ´åæ—¶ï¼Œä¿®å¤èµ·æ¥éå¸¸éº»çƒ¦åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œéƒ½å¯èƒ½å‘ç”Ÿèµ„æºçŠ¶æ€è¢«ç ´åçš„é—®é¢˜ï¼š åœ¨åˆ›å»ºèµ„æº Aï¼Œå› ä¸ºå‚æ•°æ˜¯å·²çŸ¥çš„ï¼Œä½ ç›´æ¥ä½¿ç”¨äº†å¸¸é‡è€Œä¸æ˜¯ Outputã€‚è¿™ä¼šå¯¼è‡´ pulumi æ— æ³•è¯†åˆ«åˆ°ä¾èµ–å…³ç³»ï¼ä»è€Œåˆ›å»ºå¤±è´¥ï¼Œæˆ–è€…åˆ é™¤æ—¶èµ„æºçŠ¶æ€è¢«ç ´åï¼ æœ‰ä¸€ä¸ª pulumi stack ä¸€æ¬¡åœ¨ä¸‰å°ç‰©ç†æœºä¸Šåˆ›å»ºèµ„æºã€‚ä½ ç™½å¤©åˆ›å»ºèµ„æºæ™šä¸Šåˆ é™¤èµ„æºï¼Œä½†æ˜¯æŸä¸€å°ç‰©ç†æœºæ™šä¸Šä¼šå…³æœºã€‚è¿™å°†å¯¼è‡´ pulumi æ— æ³•æŸ¥è¯¢åˆ°è¿™å°ç‰©ç†æœºä¸Šçš„èµ„æºçŠ¶æ€ï¼Œè¿™ä¸ª pulumi stack åœ¨æ™šä¸Šå°±æ— æ³•ä½¿ç”¨ï¼Œå®ƒä¼šä¸€ç›´æŠ¥é”™ï¼ ","date":"2021-01-08","objectID":"/posts/experience-of-pulumi/:5:2","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/experience-of-pulumi/#2-èµ„æºçŠ¶æ€è¢«ç ´åæ—¶ä¿®å¤èµ·æ¥éå¸¸éº»çƒ¦"},{"categories":["tech"],"content":" å¸¸ç”¨ Provider pulumi-alicloud: ç®¡ç†é˜¿é‡Œäº‘èµ„æº pulumi-vault: æˆ‘è¿™è¾¹ç”¨å®ƒæ¥å¿«é€Ÿåˆå§‹åŒ– vaultï¼Œåˆ›å»ºä¸ç®¡ç† vault çš„æ‰€æœ‰é…ç½®ã€‚ ","date":"2021-01-08","objectID":"/posts/experience-of-pulumi/:6:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/experience-of-pulumi/#å¸¸ç”¨-provider"},{"categories":["tech"],"content":" æˆ‘åˆ›å»ºç»´æŠ¤çš„ Providerç”±äº Pulumi ç”Ÿæ€è¿˜æ¯”è¾ƒå°ï¼Œæœ‰äº› provider åªæœ‰ terraform æ‰æœ‰ã€‚ æˆ‘ä¸ºäº†é€ (æ–¹)ç¦(ä¾¿)å¤§(è‡ª)ä¼—(å·±)ï¼Œåˆ›å»ºå¹¶ç»´æŠ¤äº†ä¸¤ä¸ªæœ¬åœ°è™šæ‹Ÿæœºç›¸å…³çš„ Providers: ryan4yin/pulumi-proxmox: ç›®å‰åªç”¨æ¥è‡ªåŠ¨åˆ›å»º PVE è™šæ‹Ÿæœº å¯ä»¥è€ƒè™‘ç»“åˆ kubespray/kubeadm å¿«é€Ÿåˆ›å»º k8s é›†ç¾¤ ryan4yin/pulumi-libvirt: å¿«é€Ÿåˆ›å»º kvm è™šæ‹Ÿæœº å¯ä»¥è€ƒè™‘ç»“åˆ kubespray/kubeadm å¿«é€Ÿåˆ›å»º k8s é›†ç¾¤ ","date":"2021-01-08","objectID":"/posts/experience-of-pulumi/:7:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["åŸºç¡€è®¾æ–½å³ä»£ç ","äº‘åŸç”Ÿ","Pulumi","Terraform"],"title":"Pulumi ä½¿ç”¨ä½“éªŒ - åŸºç¡€è®¾æ–½ä»£ç åŒ–","uri":"/posts/experience-of-pulumi/#æˆ‘åˆ›å»ºç»´æŠ¤çš„-provider"},{"categories":["tech"],"content":"openSUSE æ˜¯ä¸€ä¸ªåŸºäº RPM çš„å‘è¡Œç‰ˆï¼Œè¿™å’Œ RHEL/CentOS ä¸€è‡´ã€‚ä½†æ˜¯å®ƒçš„å®˜æ–¹åŒ…ç®¡ç†å™¨æ˜¯ä¸“æœ‰çš„ zypperï¼ŒæŒºå¥½ç”¨çš„ï¼Œè½¯ä»¶ä¹Ÿå¾ˆæ–°ã€‚ æˆ‘æœ€è¿‘ä» Manjaro åˆ‡æ¢åˆ°äº† openSUSEï¼Œå‘ç° KDE æ¡Œé¢ç¡®å®æ¯” Manjaro æ›´ä¸æ»‘ï¼Œè€Œä¸”ç¤¾åŒºæº OBS ä½“éªŒä¸‹æ¥æ¯” AUR æ›´èˆ’æœã€‚ å°¤å…¶æ˜¯å®¹å™¨/Kubernetes æ–¹é¢ï¼Œæºé‡Œé¢çš„ä¸œè¥¿æ¯” AUR æ›´ä¸°å¯Œï¼Œè€Œä¸”æ˜¯å®˜æ–¹ç»´æŠ¤çš„ã€‚æœ¬æ–‡ç®—æ˜¯å¯¹è¿ç§»æµç¨‹åšçš„ä¸€ä¸ªæ€»ç»“ã€‚ æœ¬æ–‡ä»¥ openSUSE Tumbleweed ä¸ºåŸºç¡€ç¼–å†™ï¼Œè¿™æ˜¯ä¸€ä¸ªå’Œ Manjaro/Arch ä¸€æ ·çš„æ»šåŠ¨å‘è¡Œç‰ˆï¼Œè½¯ä»¶æºéƒ½å¾ˆæ–°ã€‚openSUSE ç¤¾åŒºçš„å¤§éƒ¨åˆ†ç”¨æˆ·éƒ½æ˜¯ä½¿ç”¨çš„ Tumbleweed. å®ƒçš„ç¡¬ä»¶å…¼å®¹æ€§ä¹Ÿè¦æ¯” openSUSE Leapï¼ˆç¨³å®šç‰ˆï¼‰å¥½â€”â€”å®æµ‹å°ç±³æ¸¸æˆæœ¬å®‰è£… Leapï¼Œä¼‘çœ å Touchpad ä¼šå¤±çµã€‚ ","date":"2021-01-04","objectID":"/posts/opensuse-instruction/:0:0","series":null,"tags":["openSUSE","Linux"],"title":"openSUSE ä½¿ç”¨æŒ‡å—","uri":"/posts/opensuse-instruction/#"},{"categories":["tech"],"content":" ä¸€ã€zypper çš„åŸºç¡€å‘½ä»¤zypper çš„æºåœ¨å›½å†…æ¯”è¾ƒæ…¢ï¼Œä½†å®é™…ä¸Šä¸‹è½½çš„æ—¶å€™ï¼Œzypper ä¼šæ™ºèƒ½é€‰æ‹©æœ€å¿«çš„é•œåƒæºä¸‹è½½è½¯ä»¶åŒ…ï¼Œæ¯”å¦‚å›½å†…çš„æ¸…åæºç­‰ã€‚ ä½†æ˜¯æˆ‘å‘ç°å®˜æ–¹çš„æºç´¢å¼•æ›´æ–°å¤ªæ…¢ï¼Œç”šè‡³ç»å¸¸å¤±è´¥ã€‚å› æ­¤æ²¡åŠæ³•ï¼Œè¿˜æ˜¯å¾—æ‰‹åŠ¨è®¾ç½®é•œåƒæºï¼š shell # ç¦ç”¨åŸæœ‰çš„å®˜æ–¹è½¯ä»¶æº sudo zypper mr --disable repo-oss repo-non-oss repo-update repo-update-non-oss repo-debug # æ·»åŠ åŒ—å¤–é•œåƒæº sudo zypper ar -fcg https://mirrors.bfsu.edu.cn/opensuse/tumbleweed/repo/oss/ bfsu-oss sudo zypper ar -fcg https://mirrors.bfsu.edu.cn/opensuse/tumbleweed/repo/non-oss/ bfsu-non-oss ç„¶åå°±æ˜¯ zypper çš„å¸¸ç”¨å‘½ä»¤ï¼š shell sudo zypper refresh # refresh all repos sudo zypper update # update all software sudo zypper search --installed-only \u003cpackage-name\u003e # æŸ¥æ‰¾æœ¬åœ°å®‰è£…çš„ç¨‹åº sudo zypper search \u003cpackage-name\u003e # æŸ¥æ‰¾æœ¬åœ°å’Œè½¯ä»¶æºä¸­çš„ç¨‹åº sudo zypper install \u003cpackage-name\u003e # å®‰è£…ç¨‹åº sudo zypper remove --clean-deps \u003cpackage-name\u003e # å¸è½½ç¨‹åºï¼Œæ³¨æ„æ·»åŠ  --clean-deps æˆ–è€… -uï¼Œå¦åˆ™ä¸ä¼šå¸è½½ä¾èµ–é¡¹ï¼ sudo zypper clean # æ¸…ç†æœ¬åœ°çš„åŒ…ç¼“å­˜ ","date":"2021-01-04","objectID":"/posts/opensuse-instruction/:1:0","series":null,"tags":["openSUSE","Linux"],"title":"openSUSE ä½¿ç”¨æŒ‡å—","uri":"/posts/opensuse-instruction/#ä¸€zypper-çš„åŸºç¡€å‘½ä»¤"},{"categories":["tech"],"content":" Install Software è¿™é‡Œéœ€è¦ç”¨åˆ°OBS(Open Build Service, ç±»ä¼¼ arch çš„ AURï¼Œä½†æ˜¯æ˜¯é¢„ç¼–è¯‘çš„åŒ…)ï¼Œ å› ä¸º OBS ä¸œè¥¿å¤ªå¤šäº†ï¼Œå› æ­¤ä¸å­˜åœ¨å®Œæ•´çš„å›½å†…é•œåƒï¼Œå¹³å‡é€Ÿåº¦å¤§æ¦‚ 300kb/sã€‚å»ºè®®æœ‰æ¡ä»¶å¯ä»¥åœ¨è·¯ç”±å™¨ä¸ŠåŠ æ™ºèƒ½ä»£ç†æé€Ÿã€‚ å®‰è£…éœ€è¦ç”¨åˆ°çš„å„ç±»è½¯ä»¶: shell # å¯ç”¨ Packman ä»“åº“ï¼Œä½¿ç”¨é˜¿é‡Œäº‘é•œåƒæº sudo zypper ar \"http://mirrors.aliyun.com/packman/suse/openSUSE_Tumbleweed/\" Packman # install video player and web browser sudo zypper install mpv ffmpeg-4 chromium firefox # install screenshot and other utils # å®‰è£…å¥½åå¯ä»¥é…ä¸ªæˆªå›¾å¿«æ·é”® alt+a =\u003e `flameshot gui` sudo zypper install flameshot peek nomacs # install git clang/make/cmake sudo zypper install git gcc clang make cmake # install wireshark sudo zypper install wireshark sudo gpasswd --add $USER wireshark # å°†ä½ æ·»åŠ åˆ° wireshark ç”¨æˆ·ç»„ä¸­ ","date":"2021-01-04","objectID":"/posts/opensuse-instruction/:2:0","series":null,"tags":["openSUSE","Linux"],"title":"openSUSE ä½¿ç”¨æŒ‡å—","uri":"/posts/opensuse-instruction/#install-software"},{"categories":["tech"],"content":" IDE + ç¼–ç¨‹è¯­è¨€ shell # install vscode: https://en.openSUSE.org/Visual_Studio_Code sudo rpm --import https://packages.microsoft.com/keys/microsoft.asc sudo zypper addrepo https://packages.microsoft.com/yumrepos/vscode vscode sudo zypper refresh sudo zypper install code # å®‰è£… dotnet 5: https://docs.microsoft.com/en-us/dotnet/core/install/linux-openSUSE#openSUSE-15- sudo rpm --import https://packages.microsoft.com/keys/microsoft.asc sudo zypper addrepo https://packages.microsoft.com/openSUSE/15/prod/ microsoft-prod sudo zypper refresh sudo zypper install dotnet-sdk-5.0 # å®‰è£…æ–°ç‰ˆæœ¬çš„ goï¼ˆæºä¸­çš„ç‰ˆæœ¬æ¯”è¾ƒä½ï¼Œæ›´å»ºè®®ä» go å®˜ç½‘ä¸‹è½½å®‰è£…ï¼‰ sudo zypper install go é€šè¿‡ tarball/script å®‰è£…ï¼š shell # rustupï¼Œrust ç¯å¢ƒç®¡ç†å™¨ curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh # jetbrains toolbox appï¼Œç”¨äºå®‰è£…å’Œç®¡ç† pycharm/idea/goland/android studio ç­‰ IDE # å‚è§ï¼šhttps://www.jetbrains.com/toolbox-app/ # ä¸ä½¿ç”¨ç³»ç»Ÿ pythonï¼Œæ”¹ç”¨ miniconda è£… python3.8 # å‚è€ƒï¼šhttps://github.com/ContinuumIO/docker-images/blob/master/miniconda3/debian/Dockerfile wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh -O /tmp/miniconda.sh sudo /bin/bash /tmp/miniconda.sh -b -p /opt/conda rm /tmp/miniconda.sh sudo /opt/conda/bin/conda clean -tipsy sudo ln -s /opt/conda/etc/profile.d/conda.sh /etc/profile.d/conda.sh echo \". /opt/conda/etc/profile.d/conda.sh\" \u003e\u003e ~/.bashrc echo \"conda activate base\" \u003e\u003e ~/.bashrc # miniconda çš„ entrypoint é»˜è®¤å®‰è£…åœ¨å¦‚ä¸‹ç›®å½•ï¼Œæ·»åŠ åˆ° PATH ä¸­ echo \"export PATH=\\$PATH:\\$HOME/.local/bin\" \u003e\u003e ~/.bashrc æ¥ä¸‹æ¥å®‰è£… VSCode æ’ä»¶ï¼Œä¸‹åˆ—æ˜¯æˆ‘çš„æ’ä»¶åˆ—è¡¨ï¼š è¯­è¨€ï¼š python/go/c#/julia/flutter c/c++ extension pack rust-analyzer shellchecker redhat xml \u0026 yaml even-better-toml edit-csv vscode-proto3 ansible/terraform markdown all in one + Markdown Preview Enhanced ç¾åŒ–ï¼š community material theme vscode icons glasslt-vsc docker/kubernetes IntelliJ IDEA Keybindings gitlens prettier utils comment translate path intellisense svg visual studio intellicode remote ssh + remote containers rest client vscode databases ","date":"2021-01-04","objectID":"/posts/opensuse-instruction/:2:1","series":null,"tags":["openSUSE","Linux"],"title":"openSUSE ä½¿ç”¨æŒ‡å—","uri":"/posts/opensuse-instruction/#ide--ç¼–ç¨‹è¯­è¨€"},{"categories":["tech"],"content":" å®¹å™¨ + Kubernetes shell # æ—¶é«¦çš„æ–°å®¹å™¨å¥—è£…: https://documentation.suse.com/sles/15-SP2/html/SLES-all/cha-podman-overview.html sudo zypper in podman kompose skopeo buildah katacontainers # å®‰è£… kubernetes ç›¸å…³å·¥å…·ï¼Œtumbleweed å®˜æ–¹ä»“åº“çš„åŒ…éƒ½éå¸¸æ–°ï¼å¾ˆèˆ’æœ sudo zypper in helm k9s kubernetes-client # æœ¬åœ°æµ‹è¯•ç›®å‰è¿˜æ˜¯ docker-compose æœ€æ–¹ä¾¿ï¼Œdocker ä»æœ‰å¿…è¦å®‰è£… sudo zypper in docker sudo gpasswd --add $USER docker sudo systemctl enable docker sudo systemctl start docker # ç®€å•èµ·è§ï¼Œç›´æ¥ç”¨ pip å®‰è£… docker-compose å’Œ podman-compose sudo pip install docker-compose podman-compose ","date":"2021-01-04","objectID":"/posts/opensuse-instruction/:2:2","series":null,"tags":["openSUSE","Linux"],"title":"openSUSE ä½¿ç”¨æŒ‡å—","uri":"/posts/opensuse-instruction/#å®¹å™¨--kubernetes"},{"categories":["tech"],"content":" åŠå…¬ã€éŸ³ä¹ã€èŠå¤© shell # æ·»åŠ  openSUSE_zh æºï¼šhttps://build.opensuse.org/project/show/home:opensuse_zh sudo zypper addrepo 'https://download.opensuse.org/repositories/home:/opensuse_zh/openSUSE_Tumbleweed' openSUSE_zh sudo zypper refresh sudo zypper install wps-office netease-cloud-music # linux qq: https://im.qq.com/linuxqq/download.html # è™½ç„¶ç®€é™‹ä½†ä¹Ÿå¤Ÿç”¨ï¼Œå‘é€æ–‡ä»¶æ¯” KDE Connect è¦æ–¹ä¾¿ä¸€äº›ã€‚ sudo rpm -ivh linux_qq.rpm ","date":"2021-01-04","objectID":"/posts/opensuse-instruction/:2:3","series":null,"tags":["openSUSE","Linux"],"title":"openSUSE ä½¿ç”¨æŒ‡å—","uri":"/posts/opensuse-instruction/#åŠå…¬éŸ³ä¹èŠå¤©"},{"categories":["tech"],"content":" å®‰è£…è¾“å…¥æ³•æˆ‘ç”¨çš„è¾“å…¥æ³•æ˜¯å°é¹¤éŸ³å½¢ï¼Œé¦–å…ˆå®‰è£… fcitx-rime: shell # æ·»åŠ  m17n obs æºï¼šhttps://build.openSUSE.org/repositories/M17N sudo zypper addrepo 'https://download.opensuse.org/repositories/M17N/openSUSE_Tumbleweed' m17n sudo zypper refresh sudo zypper install fcitx5 fcitx5-configtool fcitx5-qt5 fcitx5-rime ç„¶åï¼Œä» http://flypy.ys168.com/ ä¸‹è½½æœ€æ–°çš„é¼ é¡»ç®¡ï¼ˆMacOSï¼‰é…ç½®æ–‡ä»¶ï¼Œå°†è§£å‹å¾—åˆ°çš„ rime æ–‡ä»¶å¤¹æ‹·è´åˆ° ~/.local/share/fcitx5/ ä¸‹ï¼š shell mv rime ~/.local/share/fcitx5/ ç°åœ¨é‡å¯ç³»ç»Ÿï¼Œåœ¨ fcitx5 é…ç½®é‡Œé¢æ·»åŠ  rimeã€Œä¸­å·éŸµã€ï¼Œå°±å¯ä»¥æ­£å¸¸ä½¿ç”¨å°é¹¤éŸ³å½¢äº†ã€‚ ","date":"2021-01-04","objectID":"/posts/opensuse-instruction/:2:4","series":null,"tags":["openSUSE","Linux"],"title":"openSUSE ä½¿ç”¨æŒ‡å—","uri":"/posts/opensuse-instruction/#å®‰è£…è¾“å…¥æ³•"},{"categories":["tech"],"content":" QEMU/KVMä¸å¾—ä¸è¯´ï¼ŒopenSUSE å®‰è£… KVM çœŸçš„è¶…æ–¹ä¾¿ï¼Œçº¯ GUI æ“ä½œï¼š shell # see: https://doc.openSUSE.org/documentation/leap/virtualization/html/book-virt/cha-vt-installation.html sudo yast2 virtualization # enter to terminal ui, select kvm + kvm tools, and then install it. KVM çš„è¯¦ç»†æ–‡æ¡£å‚è§ KVM/README.md ","date":"2021-01-04","objectID":"/posts/opensuse-instruction/:2:5","series":null,"tags":["openSUSE","Linux"],"title":"openSUSE ä½¿ç”¨æŒ‡å—","uri":"/posts/opensuse-instruction/#qemukvm"},{"categories":["tech"],"content":" VPN è¿æ¥ä¸é˜²ç«å¢™é˜²ç«å¢™é»˜è®¤ä¼šç¦ç”¨ pptp ç­‰ vpn åè®®çš„ç«¯å£ï¼Œéœ€è¦æ‰‹åŠ¨æ‰“å¼€. å…è®¸ä½¿ç”¨ PPTP åè®®ï¼š shell # å…è®¸ gre æ•°æ®åŒ…æµå…¥ç½‘ç»œ sudo firewall-cmd --permanent --zone=public --direct --add-rule ipv4 filter INPUT 0 -p gre -j ACCEPT sudo firewall-cmd --permanent --zone=public --direct --add-rule ipv6 filter INPUT 0 -p gre -j ACCEPT # masquerade: è‡ªåŠ¨ä½¿ç”¨ interface åœ°å€ä¼ªè£…æ‰€æœ‰æµé‡ï¼ˆå°†ä¸»æœºå½“ä½œè·¯ç”±å™¨ä½¿ç”¨ï¼Œvpn æ˜¯è™šæ‹Ÿç½‘ç»œï¼Œéœ€è¦è¿™ä¸ªåŠŸèƒ½ï¼‰ sudo firewall-cmd --permanent --zone=public --add-masquerade # pptp å®¢æˆ·ç«¯ä½¿ç”¨å›ºå®šç«¯å£ 1723/tcp é€šä¿¡ firewall-cmd --add-port=1723/tcp --permanent sudo firewall-cmd --reload å…è®¸ä½¿ç”¨ wireguard åè®®ï¼Œæ­¤åè®®åªä½¿ç”¨ tcp åè®®ï¼Œè€Œä¸”å¯ä»¥ç«¯å£å·å¯ä»¥è‡ªå®šä¹‰ã€‚ä¸è¿‡ wireguard è‡ªèº«çš„é…ç½®æ–‡ä»¶ /etc/wireguard/xxx.conf å°±èƒ½é…ç½® iptables å‚æ•°æ”¾è¡Œç›¸å…³ç«¯å£ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚ ","date":"2021-01-04","objectID":"/posts/opensuse-instruction/:2:6","series":null,"tags":["openSUSE","Linux"],"title":"openSUSE ä½¿ç”¨æŒ‡å—","uri":"/posts/opensuse-instruction/#vpn-è¿æ¥ä¸é˜²ç«å¢™"},{"categories":["tech"],"content":" è§¦æ‘¸æ¿æ‰‹åŠ¿å‚è€ƒ libinput-gestures ","date":"2021-01-04","objectID":"/posts/opensuse-instruction/:3:0","series":null,"tags":["openSUSE","Linux"],"title":"openSUSE ä½¿ç”¨æŒ‡å—","uri":"/posts/opensuse-instruction/#è§¦æ‘¸æ¿æ‰‹åŠ¿"},{"categories":["tech"],"content":" å®‰è£… Nvidia é—­æºé©±åŠ¨ å®Œå…¨å‚è€ƒå®˜æ–¹æ–‡æ¡£ https://en.opensuse.org/SDB:NVIDIA_drivers shell # æ·»åŠ  Nvidia å®˜æ–¹é•œåƒæº zypper addrepo --refresh https://download.nvidia.com/opensuse/tumbleweed NVIDIA # æœç´¢é©±åŠ¨ä»¥åŠå¯¹åº”çš„ç‰ˆæœ¬å· # åœ¨å¦‚ä¸‹ Nvidia å®˜æ–¹ç«™ç‚¹æ ¹æ®æç¤ºæ£€ç´¢å‡ºåˆé€‚çš„æœ€æ–°é©±åŠ¨ï¼Œç„¶åä½¿ç”¨å…¶ç‰ˆæœ¬å·åœ¨å¦‚ä¸‹ zypper å‘½ä»¤è¾“å‡ºä¸­æ‰¾åˆ°å¯¹åº”çš„é©±åŠ¨åç§° # https://www.nvidia.com/Download/index.aspx # æ¯”å¦‚æˆ‘çš„æ˜¾å¡æ˜¯ RTX3070ï¼Œé€šè¿‡ç‰ˆæœ¬å·èƒ½æ‰¾åˆ°å…¶å¯¹åº”çš„é©±åŠ¨ä¸º x11-video-nvidiaG06 zypper se -s x11-video-nvidiaG0* # å®‰è£…é©±åŠ¨ zypper in x11-video-nvidiaG06 x11-video-nvidiaG06 å¦‚æœä½ è¿˜éœ€è¦å®‰è£… CUDA æ¥æœ¬åœ°ç‚¼ä¸¹ï¼ŒCUDA çš„å®‰è£…æœ‰ä¸¤ç§æ–¹æ³•ï¼š ç›´æ¥å°† CUDA å®‰è£…åœ¨æœ¬æœºï¼Œå¯å‚è€ƒNVIDIA CUDA Installation Guide for Linux ä½¿ç”¨ Docker å®¹å™¨ç‚¼ä¸¹ï¼Œå¯å‚è€ƒ nvidia-docker ","date":"2021-01-04","objectID":"/posts/opensuse-instruction/:4:0","series":null,"tags":["openSUSE","Linux"],"title":"openSUSE ä½¿ç”¨æŒ‡å—","uri":"/posts/opensuse-instruction/#å®‰è£…-nvidia-é—­æºé©±åŠ¨"},{"categories":["tech"],"content":" è®¾ç½®ä»£ç†å·¥å…·ä¸ºäº†åŠ é€Ÿç½‘ç»œæˆ–è€…è®¿é—®ä¸€äº›å›½å†…ä¸å­˜åœ¨çš„ç½‘ç«™ï¼Œç½‘ç»œä»£ç†æ˜¯å¿…ä¸å¯å°‘çš„å·¥å…·ã€‚ æˆ‘ä¹ æƒ¯ä½¿ç”¨ clashï¼Œæç®€å®‰è£…æ–¹æ³•å¦‚ä¸‹ï¼š é¦–å…ˆ sudo zypper in clash å®‰è£…å¥½ clash clash ç¯å¢ƒé…ç½®ï¼ˆè®°ä¸æ¸…æ˜¯å¦å¾—æ‰‹åŠ¨é…ç½®è¿™ä¸ªäº†â€¦ï¼‰ ä¸‹è½½å¥½ Country.mmdb æ”¾åˆ°~/.config/clash ä¸­ å¥½åƒè¿˜éœ€è¦ä¸‹è½½ä¸‹ clash-dashboard åˆ° ~/.config/clash/ui æ‰¾åˆ°ä½ è‡ªå·±çš„ clash é…ç½®è®¢é˜…åœ°å€ï¼ˆå„ç§æœºåœºéƒ½ä¼šæä¾›çš„ï¼‰ï¼Œå†™ä¸ªå°è„šæœ¬å†…å®¹ä¸ºcurl \"\u003cè®¢é˜…åœ°å€\u003e\" \u003e ~/.config/clash/config.yaml å¦‚æœè¿™ä¸ªæ–‡ä»¶å¤¹è¿˜æ²¡æœ‰å°±å…ˆåˆ›å»ºä¸€ä¸‹ å¦‚æœä»£ç†æ˜¯è‡ªå·±æ­å»ºçš„ï¼Œé‚£å°±è‡ªå·±å†™è¿™ä¸ªé…ç½®å’¯ æŠŠè„šæœ¬æ”¾åœ¨ PATH ä¸­çš„æŸä¸ªç›®å½•ä¸­ï¼Œæ–¹ä¾¿éšæ—¶è°ƒç”¨æ›´æ–° ä½¿ç”¨ tmux åå°å¯åŠ¨ clashï¼Œä»£ç†å°±è®¾ç½®å®Œæˆäº† æµè§ˆå™¨å¯ä»¥é€šè¿‡ swichomega æ¥è®¾ç½®ç»†è‡´çš„ä»£ç†è§„åˆ™ å‘½ä»¤è¡Œå¯ä»¥ç›´æ¥ä½¿ç”¨export HTTP_PROXY=http://127.0.0.1; export HTTPS_PROXY=http://127.0.0.1 æ¥ä½¿ç”¨ä»£ç†ï¼Œå¤§éƒ¨åˆ†å‘½ä»¤è¡Œç¨‹åºéƒ½ä¼šä½¿ç”¨è¿™ä¸¤ä¸ªç¯å¢ƒå˜é‡çš„é…ç½®ã€‚ ä¸€èˆ¬æœºåœºç»™çš„ clash é…ç½®éƒ½ä¼šç›´æ¥å¼€å¯ clash Web é…ç½®é¡µï¼Œå¯ä»¥é€šè¿‡http://localhost:9090/ui/#/proxies ç›´æ¥è®¿é—® ","date":"2021-01-04","objectID":"/posts/opensuse-instruction/:5:0","series":null,"tags":["openSUSE","Linux"],"title":"openSUSE ä½¿ç”¨æŒ‡å—","uri":"/posts/opensuse-instruction/#è®¾ç½®ä»£ç†å·¥å…·"},{"categories":["tech"],"content":" è®¾ç½® zypper ä½¿ç”¨ proxy ä¸‹è½½æ›´æ–°zypper é»˜è®¤ä¸ä¼šè¯»å– HTTP_PROXY è·Ÿ HTTPS_PROXY ç­‰ç¯å¢ƒå˜é‡ï¼Œå¯¹äºä¸€äº›æ— å›½å†…é•œåƒçš„æºè€Œè¨€ï¼Œ å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼é…ç½®èµ°ä»£ç†æå‡ä¸‹è½½é€Ÿåº¦ï¼ˆè¿™éœ€è¦ä½ å·²ç»æœ‰æœ¬åœ°ä»£ç†æ‰è¡Œï¼Œæ¯”å¦‚è¯´ clashï¼‰ï¼š è¿›å…¥ YaST GUI åœ¨æœç´¢æ¡†ç›´æ¥æœç´¢ proxy å³å¯æ‰¾åˆ°å¯¹åº”çš„é…ç½®é¡¹ é…ç½®å¥½ http ä»¥åŠ https åè®®çš„ä»£ç†åœ°å€ï¼Œå¦‚æœæ˜¯æœ¬åœ°çš„ clashï¼Œå¯ä»¥ç›´æ¥å¡«http://127.0.0.1:7890 åœ¨ã€ŒNo Proxy Domainsã€ä¸­æ·»åŠ å›½å†…é•œåƒæºåœ°å€ï¼Œä½¿å®ƒä»¬ä¸è¦èµ°ä»£ç† å¦‚æœæ˜¯è·Ÿæˆ‘çš„æ•™ç¨‹èµ°çš„ï¼Œåº”è¯¥éœ€è¦å°†è¿™ä¸ªå€¼æ”¹æˆlocalhost,127.0.0.1,mirrors.bfsu.edu.cn,mirrors.aliyun.com ","date":"2021-01-04","objectID":"/posts/opensuse-instruction/:6:0","series":null,"tags":["openSUSE","Linux"],"title":"openSUSE ä½¿ç”¨æŒ‡å—","uri":"/posts/opensuse-instruction/#è®¾ç½®-zypper-ä½¿ç”¨-proxy-ä¸‹è½½æ›´æ–°"},{"categories":["tech"],"content":" KDE ConnectKDE Connect æ˜¯ä¸€ä¸ª PC æ‰‹æœºååŒå·¥å…·ï¼Œå¯ä»¥åœ¨ç”µè„‘å’Œæ‰‹æœºä¹‹é—´å…±äº«å‰ªåˆ‡ç‰ˆã€è¿œç¨‹è¾“å…¥ã€å‘é€æ–‡ä»¶ã€å…±äº«æ–‡ä»¶å¤¹ã€é€šçŸ¥åŒæ­¥ç­‰ç­‰ã€‚æ€»è€Œè¨€ä¹‹éå¸¸å¥½ç”¨ï¼Œåªè¦æ‰‹æœºå’Œ PC å¤„äºåŒä¸€ä¸ªå±€åŸŸç½‘å°±è¡Œï¼Œä¸éœ€è¦ä»€ä¹ˆæ•°æ®çº¿ã€‚ å¦‚æœå®‰è£…ç³»ç»Ÿæ—¶é€‰æ‹©äº†æ‰“å¼€é˜²ç«å¢™ï¼ŒKDE Connect æ˜¯è¿ä¸ä¸Šçš„ï¼Œéœ€è¦æ‰‹åŠ¨å¼€æ”¾ç«¯å£å·ï¼š shell # see: https://userbase.kde.org/KDEConnect#firewalld # è¿˜å¯ä»¥ä½¿ç”¨ --add-source=xx.xx.xx.xx/xx è®¾ç½® ip ç™½åå• sudo firewall-cmd --zone=public --permanent --add-port=1714-1764/tcp sudo firewall-cmd --zone=public --permanent --add-port=1714-1764/udp sudo firewall-cmd --reload # ç¡®è®¤ä¸‹å·²ç»å¼€æ”¾è¿™äº›ç«¯å£ sudo firewall-cmd --list-all ç„¶åæ‰‹æœºï¼ˆAndroidï¼‰å®‰è£…å¥½ KDE Connectï¼Œå°±èƒ½å¼€å§‹äº«å—äº†ã€‚ ç›®å‰å­˜åœ¨çš„ Bug: Android 10 ç¦æ­¢äº†åå°åº”ç”¨è¯»å–å‰ªåˆ‡ç‰ˆï¼Œè¿™å¯¼è‡´ KDE Connect åªèƒ½ä» PC åŒæ­¥åˆ°æ‰‹æœºï¼Œè€Œæ— æ³•åå‘åŒæ­¥ã€‚ å¦‚æœä½ æœ‰ ROOT æƒé™ï¼Œå¯ä»¥å‚è€ƒFix clipboard permission on Android 10 çš„æ–¹æ³•ï¼Œå®‰è£… ClipboardWhitelist æ¥æ‰“å¼€æƒé™ã€‚ å¦åˆ™ï¼Œè²Œä¼¼å°±åªèƒ½ä½¿ç”¨æ‰‹æœºç«¯çš„ã€Œè¿œç¨‹è¾“å…¥ã€æ¨¡å—æ¥æ‰‹åŠ¨ä¼ è¾“æ–‡æœ¬äº†ã€‚ ","date":"2021-01-04","objectID":"/posts/opensuse-instruction/:6:1","series":null,"tags":["openSUSE","Linux"],"title":"openSUSE ä½¿ç”¨æŒ‡å—","uri":"/posts/opensuse-instruction/#kde-connect"},{"categories":["tech"],"content":" VPN è¿æ¥ä¸å…¶ä»–é˜²ç«å¢™ç›¸å…³é…ç½®é˜²ç«å¢™é»˜è®¤ä¼šç¦ç”¨æ‰€æœ‰å¯¹å¤–ç«¯å£ï¼Œéœ€è¦æ‰‹åŠ¨æ‰“å¼€ã€‚ å…è®¸ä½¿ç”¨ PPTP åè®®ï¼š shell # å…è®¸ gre æ•°æ®åŒ…æµå…¥ç½‘ç»œ sudo firewall-cmd --permanent --zone=public --direct --add-rule ipv4 filter INPUT 0 -p gre -j ACCEPT sudo firewall-cmd --permanent --zone=public --direct --add-rule ipv6 filter INPUT 0 -p gre -j ACCEPT # masquerade: è‡ªåŠ¨ä½¿ç”¨ interface åœ°å€ä¼ªè£…æ‰€æœ‰æµé‡ï¼ˆå°†ä¸»æœºå½“ä½œè·¯ç”±å™¨ä½¿ç”¨ï¼Œvpn æ˜¯è™šæ‹Ÿç½‘ç»œï¼Œéœ€è¦è¿™ä¸ªåŠŸèƒ½ï¼‰ sudo firewall-cmd --permanent --zone=public --add-masquerade # pptp å®¢æˆ·ç«¯ä½¿ç”¨å›ºå®šç«¯å£ 1723/tcp é€šä¿¡ firewall-cmd --add-port=1723/tcp --permanent sudo firewall-cmd --reload # ç¡®è®¤ä¸‹å·²ç»å¼€æ”¾è¿™äº›ç«¯å£ sudo firewall-cmd --list-all å…è®¸ä½¿ç”¨ wireguard åè®®ï¼š æ­¤åè®®åªä½¿ç”¨ tcp åè®®ï¼Œè€Œä¸”å¯ä»¥ç«¯å£å·å¯ä»¥è‡ªå®šä¹‰ã€‚ä¸è¿‡ wireguard è‡ªèº«çš„é…ç½®æ–‡ä»¶/etc/wireguard/xxx.conf å°±èƒ½é…ç½® iptables å‚æ•°æ”¾è¡Œç›¸å…³ç«¯å£ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚ ","date":"2021-01-04","objectID":"/posts/opensuse-instruction/:6:2","series":null,"tags":["openSUSE","Linux"],"title":"openSUSE ä½¿ç”¨æŒ‡å—","uri":"/posts/opensuse-instruction/#vpn-è¿æ¥ä¸å…¶ä»–é˜²ç«å¢™ç›¸å…³é…ç½®"},{"categories":["tech"],"content":" OpenSSH æœåŠ¡ä¸ºäº†å±€åŸŸç½‘æ•°æ®ä¼ è¾“æ–¹ä¾¿ï¼Œä»¥åŠè¿œç¨‹ä½¿ç”¨ PCï¼Œæˆ‘ä¸€èˆ¬éƒ½ä¼šç»™è‡ªå·±çš„ Linux æœºå™¨æ‰“å¼€ OpenSSH æœåŠ¡ã€‚ åœ¨ OpenSUSE ä¸Šå¯ç”¨ OpenSSH æœåŠ¡çš„æµç¨‹ï¼š shell sudo systemctl enable sshd sudo systemctl start sshd sudo systemctl status sshd 2. è®¾ç½®ä½¿ç”¨å¯†é’¥ç™»å½•æ˜¾ç„¶å¯†é’¥ç™»å½•æ‰è¶³å¤Ÿå®‰å…¨ï¼Œè¿™é‡Œä»‹ç»ä¸‹æˆ‘å¦‚ä½•è®¾ç½®å¯†é’¥ç™»å½•ã€‚ å…ˆç”Ÿæˆå¯†é’¥å¯¹ï¼ˆå¦‚æœä½ å¸¸ç”¨ githubï¼Œæœ¬åœ°åº”è¯¥å·²ç»æœ‰å¯†é’¥å¯¹äº†ï¼Œå¯ä»¥è€ƒè™‘ç›´æ¥ä½¿ç”¨åŒä¸€ä¸ªå¯†é’¥å¯¹ï¼Œè¿™æ ·å°±èƒ½è·³è¿‡è¿™ä¸€æ­¥ï¼‰ï¼š shell # æˆ–è€…ç›´æ¥å‘½ä»¤è¡ŒæŒ‡å®šå¯†é’¥ç®—æ³•ç±»å‹(-t)ã€åç§°ä¸è·¯å¾„(-f)ã€æ³¨é‡Š(-C)ã€å¯†é’¥çš„ä¿æŠ¤å¯†ç (-P)ã€‚ ## å½“å¯†é’¥è¾ƒå¤šæ—¶ï¼Œæ³¨é‡Šå¯ç”¨äºåŒºåˆ†å¯†é’¥çš„ç”¨é€”ã€‚ ## ç®—æ³•æ¨èä½¿ç”¨ ed25519/ecdsaï¼Œé»˜è®¤çš„ rsa ç®—æ³•ç›®å‰å·²ä¸æ¨èä½¿ç”¨ï¼ˆéœ€è¦å¾ˆé•¿çš„å¯†é’¥å’Œç­¾åæ‰èƒ½ä¿è¯å®‰å…¨ï¼‰ã€‚ ssh-keygen -t ed25519 -f id_rsa_for_xxx -C \"ssh key for xxx\" -P '' æ¥ä¸‹æ¥éœ€è¦æŠŠå…¬é’¥è¿½åŠ åˆ°ä¸»æœºçš„ $HOME/.ssh/authorized_keys æ–‡ä»¶çš„æœ«å°¾ï¼ˆ$HOME æ˜¯ user çš„å®¶ç›®å½•ï¼Œä¸æ˜¯ root çš„å®¶ç›®å½•ï¼Œè¯·çœ‹æ¸…æ¥šäº†ï¼‰ï¼š shell # æ–¹æ³•ä¸€ï¼Œæ‰‹åŠ¨å°†å…¬é’¥æ·»åŠ åˆ° ~/.ssh/authorized_keys ä¸­ # ç„¶åæ‰‹åŠ¨å°† ~/.ssh/authorized_keys çš„æƒé™è®¾ä¸º 600 chmod 600 ~/.ssh/authorized_keys # æ–¹æ³•äºŒï¼šå¦‚æœä½ çš„å¯†é’¥å¯¹åœ¨å…¶ä»–ä¸»æœºä¸Šï¼Œå¯ä»¥ç›´æ¥åœ¨è¯¥ä¸»æœºä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å°†å…¬é’¥æ·»åŠ åˆ° openSUSE æœºå™¨ä¸Šï¼Œä¼šæœ‰æç¤ºè¾“å…¥å¯†ç  # -i è®¾å®šå…¬é’¥ä½ç½®ï¼Œé»˜è®¤ä½¿ç”¨ ~/.ssh/id_rsa.pub ssh-copy-id -i path/to/key_name.pub user@host ç°åœ¨å°±å®Œäº‹äº†ï¼Œå¯ä»¥ä½¿ç”¨å¯†é’¥é’¥ç™»å½•è¯•è¯•ï¼š shell # -i è®¾å®šç§é’¥ä½ç½®ï¼Œé»˜è®¤ä½¿ç”¨ ~/.ssh/id_rsa ssh \u003cusername\u003e@\u003cserver-ip\u003e -i \u003crsa_private_key\u003e # ä¸¾ä¾‹ ssh ubuntu@111.222.333.444 -i ~/.ssh/id_rsa_for_server 2. è°ƒæ•´å®‰å…¨è®¾ç½®openSUSE çš„ OpenSSH æœåŠ¡é»˜è®¤æ˜¯å…è®¸å¯†ç ç™»å½•çš„ï¼Œè™½ç„¶ä¹Ÿæœ‰ç™»å½•é€Ÿç‡é™åˆ¶ï¼Œè¿˜æ˜¯ä¼šæœ‰ç‚¹å±é™©ã€‚ æ—¢ç„¶æˆ‘ä»¬å‰é¢å·²ç»è®¾ç½®å¥½äº†å¯†é’¥ç™»å½•ï¼Œç°åœ¨å°±å¯ä»¥æŠŠå¯†ç ç™»å½•åŠŸèƒ½å®Œå…¨ç¦ç”¨æ‰ï¼Œæå‡å®‰å…¨æ€§ã€‚ è¯·å–æ¶ˆæ³¨é‡Šå¹¶ä¿®æ”¹ /usr/etc/ssh/sshd_config ä¸­å¦‚ä¸‹å‚æ•°çš„å€¼ï¼š æ³¨æ„ OpenSSH çš„ä¸»é…ç½®æ–‡ä»¶æ˜¯ /usr/etc/ssh/sshd_configï¼Œè€Œä¸æ˜¯å¤§éƒ¨åˆ† Linux å‘è¡Œç‰ˆä½¿ç”¨çš„/etc/ssh/sshd_configã€‚ conf # å®‰å…¨ç›¸å…³é…ç½® LoginGraceTime 2m StrictModes yes MaxAuthTries 6 MaxSessions 10 # ç¦æ­¢ä½¿ç”¨ root ç”¨æˆ·ç™»å½• PermitRootLogin no # å…è®¸ä½¿ç”¨å…¬é’¥è®¤è¯ PubkeyAuthentication yes # ç¦ç”¨æ˜æ–‡å¯†ç ç™»å½• PasswordAuthentication no # ç¦ç”¨æ‰åŸºäº password çš„äº¤äº’å¼è®¤è¯ KbdInteractiveAuthentication no # ç¦ç”¨ PAM æ¨¡å— UsePAM no æ”¹å®Œåå†é‡å¯ä¸‹ sshd æœåŠ¡å¹¶ç”¨ ssh å‘½ä»¤ç™»å½•æµ‹è¯•ç¡®è®¤åŠŸèƒ½å·²ç”Ÿæ•ˆï¼š shell # å°è¯•åœ¨ä½¿ç”¨ã€Œå…¬é’¥éªŒè¯ã€ä¹‹å¤–çš„å…¶ä»–æ–¹æ³•ç™»å½• # å¦‚æœ sshd æœåŠ¡çš„è®¾ç½®æ­£ç¡®ï¼Œè¿™è¡Œå‘½ä»¤åº”è¯¥ç™»å½•å¤±è´¥å¹¶æŠ¥é”™ã€ŒPermission Denied(publickey)ã€ ssh -o PubkeyAuthentication=no user@host ","date":"2021-01-04","objectID":"/posts/opensuse-instruction/:6:3","series":null,"tags":["openSUSE","Linux"],"title":"openSUSE ä½¿ç”¨æŒ‡å—","uri":"/posts/opensuse-instruction/#openssh-æœåŠ¡"},{"categories":["tech"],"content":" OpenSSH æœåŠ¡ä¸ºäº†å±€åŸŸç½‘æ•°æ®ä¼ è¾“æ–¹ä¾¿ï¼Œä»¥åŠè¿œç¨‹ä½¿ç”¨ PCï¼Œæˆ‘ä¸€èˆ¬éƒ½ä¼šç»™è‡ªå·±çš„ Linux æœºå™¨æ‰“å¼€ OpenSSH æœåŠ¡ã€‚ åœ¨ OpenSUSE ä¸Šå¯ç”¨ OpenSSH æœåŠ¡çš„æµç¨‹ï¼š shell sudo systemctl enable sshd sudo systemctl start sshd sudo systemctl status sshd 2. è®¾ç½®ä½¿ç”¨å¯†é’¥ç™»å½•æ˜¾ç„¶å¯†é’¥ç™»å½•æ‰è¶³å¤Ÿå®‰å…¨ï¼Œè¿™é‡Œä»‹ç»ä¸‹æˆ‘å¦‚ä½•è®¾ç½®å¯†é’¥ç™»å½•ã€‚ å…ˆç”Ÿæˆå¯†é’¥å¯¹ï¼ˆå¦‚æœä½ å¸¸ç”¨ githubï¼Œæœ¬åœ°åº”è¯¥å·²ç»æœ‰å¯†é’¥å¯¹äº†ï¼Œå¯ä»¥è€ƒè™‘ç›´æ¥ä½¿ç”¨åŒä¸€ä¸ªå¯†é’¥å¯¹ï¼Œè¿™æ ·å°±èƒ½è·³è¿‡è¿™ä¸€æ­¥ï¼‰ï¼š shell # æˆ–è€…ç›´æ¥å‘½ä»¤è¡ŒæŒ‡å®šå¯†é’¥ç®—æ³•ç±»å‹(-t)ã€åç§°ä¸è·¯å¾„(-f)ã€æ³¨é‡Š(-C)ã€å¯†é’¥çš„ä¿æŠ¤å¯†ç (-P)ã€‚ ## å½“å¯†é’¥è¾ƒå¤šæ—¶ï¼Œæ³¨é‡Šå¯ç”¨äºåŒºåˆ†å¯†é’¥çš„ç”¨é€”ã€‚ ## ç®—æ³•æ¨èä½¿ç”¨ ed25519/ecdsaï¼Œé»˜è®¤çš„ rsa ç®—æ³•ç›®å‰å·²ä¸æ¨èä½¿ç”¨ï¼ˆéœ€è¦å¾ˆé•¿çš„å¯†é’¥å’Œç­¾åæ‰èƒ½ä¿è¯å®‰å…¨ï¼‰ã€‚ ssh-keygen -t ed25519 -f id_rsa_for_xxx -C \"ssh key for xxx\" -P '' æ¥ä¸‹æ¥éœ€è¦æŠŠå…¬é’¥è¿½åŠ åˆ°ä¸»æœºçš„ $HOME/.ssh/authorized_keys æ–‡ä»¶çš„æœ«å°¾ï¼ˆ$HOME æ˜¯ user çš„å®¶ç›®å½•ï¼Œä¸æ˜¯ root çš„å®¶ç›®å½•ï¼Œè¯·çœ‹æ¸…æ¥šäº†ï¼‰ï¼š shell # æ–¹æ³•ä¸€ï¼Œæ‰‹åŠ¨å°†å…¬é’¥æ·»åŠ åˆ° ~/.ssh/authorized_keys ä¸­ # ç„¶åæ‰‹åŠ¨å°† ~/.ssh/authorized_keys çš„æƒé™è®¾ä¸º 600 chmod 600 ~/.ssh/authorized_keys # æ–¹æ³•äºŒï¼šå¦‚æœä½ çš„å¯†é’¥å¯¹åœ¨å…¶ä»–ä¸»æœºä¸Šï¼Œå¯ä»¥ç›´æ¥åœ¨è¯¥ä¸»æœºä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å°†å…¬é’¥æ·»åŠ åˆ° openSUSE æœºå™¨ä¸Šï¼Œä¼šæœ‰æç¤ºè¾“å…¥å¯†ç  # -i è®¾å®šå…¬é’¥ä½ç½®ï¼Œé»˜è®¤ä½¿ç”¨ ~/.ssh/id_rsa.pub ssh-copy-id -i path/to/key_name.pub user@host ç°åœ¨å°±å®Œäº‹äº†ï¼Œå¯ä»¥ä½¿ç”¨å¯†é’¥é’¥ç™»å½•è¯•è¯•ï¼š shell # -i è®¾å®šç§é’¥ä½ç½®ï¼Œé»˜è®¤ä½¿ç”¨ ~/.ssh/id_rsa ssh @ -i # ä¸¾ä¾‹ ssh ubuntu@111.222.333.444 -i ~/.ssh/id_rsa_for_server 2. è°ƒæ•´å®‰å…¨è®¾ç½®openSUSE çš„ OpenSSH æœåŠ¡é»˜è®¤æ˜¯å…è®¸å¯†ç ç™»å½•çš„ï¼Œè™½ç„¶ä¹Ÿæœ‰ç™»å½•é€Ÿç‡é™åˆ¶ï¼Œè¿˜æ˜¯ä¼šæœ‰ç‚¹å±é™©ã€‚ æ—¢ç„¶æˆ‘ä»¬å‰é¢å·²ç»è®¾ç½®å¥½äº†å¯†é’¥ç™»å½•ï¼Œç°åœ¨å°±å¯ä»¥æŠŠå¯†ç ç™»å½•åŠŸèƒ½å®Œå…¨ç¦ç”¨æ‰ï¼Œæå‡å®‰å…¨æ€§ã€‚ è¯·å–æ¶ˆæ³¨é‡Šå¹¶ä¿®æ”¹ /usr/etc/ssh/sshd_config ä¸­å¦‚ä¸‹å‚æ•°çš„å€¼ï¼š æ³¨æ„ OpenSSH çš„ä¸»é…ç½®æ–‡ä»¶æ˜¯ /usr/etc/ssh/sshd_configï¼Œè€Œä¸æ˜¯å¤§éƒ¨åˆ† Linux å‘è¡Œç‰ˆä½¿ç”¨çš„/etc/ssh/sshd_configã€‚ conf # å®‰å…¨ç›¸å…³é…ç½® LoginGraceTime 2m StrictModes yes MaxAuthTries 6 MaxSessions 10 # ç¦æ­¢ä½¿ç”¨ root ç”¨æˆ·ç™»å½• PermitRootLogin no # å…è®¸ä½¿ç”¨å…¬é’¥è®¤è¯ PubkeyAuthentication yes # ç¦ç”¨æ˜æ–‡å¯†ç ç™»å½• PasswordAuthentication no # ç¦ç”¨æ‰åŸºäº password çš„äº¤äº’å¼è®¤è¯ KbdInteractiveAuthentication no # ç¦ç”¨ PAM æ¨¡å— UsePAM no æ”¹å®Œåå†é‡å¯ä¸‹ sshd æœåŠ¡å¹¶ç”¨ ssh å‘½ä»¤ç™»å½•æµ‹è¯•ç¡®è®¤åŠŸèƒ½å·²ç”Ÿæ•ˆï¼š shell # å°è¯•åœ¨ä½¿ç”¨ã€Œå…¬é’¥éªŒè¯ã€ä¹‹å¤–çš„å…¶ä»–æ–¹æ³•ç™»å½• # å¦‚æœ sshd æœåŠ¡çš„è®¾ç½®æ­£ç¡®ï¼Œè¿™è¡Œå‘½ä»¤åº”è¯¥ç™»å½•å¤±è´¥å¹¶æŠ¥é”™ã€ŒPermission Denied(publickey)ã€ ssh -o PubkeyAuthentication=no user@host ","date":"2021-01-04","objectID":"/posts/opensuse-instruction/:6:3","series":null,"tags":["openSUSE","Linux"],"title":"openSUSE ä½¿ç”¨æŒ‡å—","uri":"/posts/opensuse-instruction/#2-è®¾ç½®ä½¿ç”¨å¯†é’¥ç™»å½•"},{"categories":["tech"],"content":" OpenSSH æœåŠ¡ä¸ºäº†å±€åŸŸç½‘æ•°æ®ä¼ è¾“æ–¹ä¾¿ï¼Œä»¥åŠè¿œç¨‹ä½¿ç”¨ PCï¼Œæˆ‘ä¸€èˆ¬éƒ½ä¼šç»™è‡ªå·±çš„ Linux æœºå™¨æ‰“å¼€ OpenSSH æœåŠ¡ã€‚ åœ¨ OpenSUSE ä¸Šå¯ç”¨ OpenSSH æœåŠ¡çš„æµç¨‹ï¼š shell sudo systemctl enable sshd sudo systemctl start sshd sudo systemctl status sshd 2. è®¾ç½®ä½¿ç”¨å¯†é’¥ç™»å½•æ˜¾ç„¶å¯†é’¥ç™»å½•æ‰è¶³å¤Ÿå®‰å…¨ï¼Œè¿™é‡Œä»‹ç»ä¸‹æˆ‘å¦‚ä½•è®¾ç½®å¯†é’¥ç™»å½•ã€‚ å…ˆç”Ÿæˆå¯†é’¥å¯¹ï¼ˆå¦‚æœä½ å¸¸ç”¨ githubï¼Œæœ¬åœ°åº”è¯¥å·²ç»æœ‰å¯†é’¥å¯¹äº†ï¼Œå¯ä»¥è€ƒè™‘ç›´æ¥ä½¿ç”¨åŒä¸€ä¸ªå¯†é’¥å¯¹ï¼Œè¿™æ ·å°±èƒ½è·³è¿‡è¿™ä¸€æ­¥ï¼‰ï¼š shell # æˆ–è€…ç›´æ¥å‘½ä»¤è¡ŒæŒ‡å®šå¯†é’¥ç®—æ³•ç±»å‹(-t)ã€åç§°ä¸è·¯å¾„(-f)ã€æ³¨é‡Š(-C)ã€å¯†é’¥çš„ä¿æŠ¤å¯†ç (-P)ã€‚ ## å½“å¯†é’¥è¾ƒå¤šæ—¶ï¼Œæ³¨é‡Šå¯ç”¨äºåŒºåˆ†å¯†é’¥çš„ç”¨é€”ã€‚ ## ç®—æ³•æ¨èä½¿ç”¨ ed25519/ecdsaï¼Œé»˜è®¤çš„ rsa ç®—æ³•ç›®å‰å·²ä¸æ¨èä½¿ç”¨ï¼ˆéœ€è¦å¾ˆé•¿çš„å¯†é’¥å’Œç­¾åæ‰èƒ½ä¿è¯å®‰å…¨ï¼‰ã€‚ ssh-keygen -t ed25519 -f id_rsa_for_xxx -C \"ssh key for xxx\" -P '' æ¥ä¸‹æ¥éœ€è¦æŠŠå…¬é’¥è¿½åŠ åˆ°ä¸»æœºçš„ $HOME/.ssh/authorized_keys æ–‡ä»¶çš„æœ«å°¾ï¼ˆ$HOME æ˜¯ user çš„å®¶ç›®å½•ï¼Œä¸æ˜¯ root çš„å®¶ç›®å½•ï¼Œè¯·çœ‹æ¸…æ¥šäº†ï¼‰ï¼š shell # æ–¹æ³•ä¸€ï¼Œæ‰‹åŠ¨å°†å…¬é’¥æ·»åŠ åˆ° ~/.ssh/authorized_keys ä¸­ # ç„¶åæ‰‹åŠ¨å°† ~/.ssh/authorized_keys çš„æƒé™è®¾ä¸º 600 chmod 600 ~/.ssh/authorized_keys # æ–¹æ³•äºŒï¼šå¦‚æœä½ çš„å¯†é’¥å¯¹åœ¨å…¶ä»–ä¸»æœºä¸Šï¼Œå¯ä»¥ç›´æ¥åœ¨è¯¥ä¸»æœºä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å°†å…¬é’¥æ·»åŠ åˆ° openSUSE æœºå™¨ä¸Šï¼Œä¼šæœ‰æç¤ºè¾“å…¥å¯†ç  # -i è®¾å®šå…¬é’¥ä½ç½®ï¼Œé»˜è®¤ä½¿ç”¨ ~/.ssh/id_rsa.pub ssh-copy-id -i path/to/key_name.pub user@host ç°åœ¨å°±å®Œäº‹äº†ï¼Œå¯ä»¥ä½¿ç”¨å¯†é’¥é’¥ç™»å½•è¯•è¯•ï¼š shell # -i è®¾å®šç§é’¥ä½ç½®ï¼Œé»˜è®¤ä½¿ç”¨ ~/.ssh/id_rsa ssh @ -i # ä¸¾ä¾‹ ssh ubuntu@111.222.333.444 -i ~/.ssh/id_rsa_for_server 2. è°ƒæ•´å®‰å…¨è®¾ç½®openSUSE çš„ OpenSSH æœåŠ¡é»˜è®¤æ˜¯å…è®¸å¯†ç ç™»å½•çš„ï¼Œè™½ç„¶ä¹Ÿæœ‰ç™»å½•é€Ÿç‡é™åˆ¶ï¼Œè¿˜æ˜¯ä¼šæœ‰ç‚¹å±é™©ã€‚ æ—¢ç„¶æˆ‘ä»¬å‰é¢å·²ç»è®¾ç½®å¥½äº†å¯†é’¥ç™»å½•ï¼Œç°åœ¨å°±å¯ä»¥æŠŠå¯†ç ç™»å½•åŠŸèƒ½å®Œå…¨ç¦ç”¨æ‰ï¼Œæå‡å®‰å…¨æ€§ã€‚ è¯·å–æ¶ˆæ³¨é‡Šå¹¶ä¿®æ”¹ /usr/etc/ssh/sshd_config ä¸­å¦‚ä¸‹å‚æ•°çš„å€¼ï¼š æ³¨æ„ OpenSSH çš„ä¸»é…ç½®æ–‡ä»¶æ˜¯ /usr/etc/ssh/sshd_configï¼Œè€Œä¸æ˜¯å¤§éƒ¨åˆ† Linux å‘è¡Œç‰ˆä½¿ç”¨çš„/etc/ssh/sshd_configã€‚ conf # å®‰å…¨ç›¸å…³é…ç½® LoginGraceTime 2m StrictModes yes MaxAuthTries 6 MaxSessions 10 # ç¦æ­¢ä½¿ç”¨ root ç”¨æˆ·ç™»å½• PermitRootLogin no # å…è®¸ä½¿ç”¨å…¬é’¥è®¤è¯ PubkeyAuthentication yes # ç¦ç”¨æ˜æ–‡å¯†ç ç™»å½• PasswordAuthentication no # ç¦ç”¨æ‰åŸºäº password çš„äº¤äº’å¼è®¤è¯ KbdInteractiveAuthentication no # ç¦ç”¨ PAM æ¨¡å— UsePAM no æ”¹å®Œåå†é‡å¯ä¸‹ sshd æœåŠ¡å¹¶ç”¨ ssh å‘½ä»¤ç™»å½•æµ‹è¯•ç¡®è®¤åŠŸèƒ½å·²ç”Ÿæ•ˆï¼š shell # å°è¯•åœ¨ä½¿ç”¨ã€Œå…¬é’¥éªŒè¯ã€ä¹‹å¤–çš„å…¶ä»–æ–¹æ³•ç™»å½• # å¦‚æœ sshd æœåŠ¡çš„è®¾ç½®æ­£ç¡®ï¼Œè¿™è¡Œå‘½ä»¤åº”è¯¥ç™»å½•å¤±è´¥å¹¶æŠ¥é”™ã€ŒPermission Denied(publickey)ã€ ssh -o PubkeyAuthentication=no user@host ","date":"2021-01-04","objectID":"/posts/opensuse-instruction/:6:3","series":null,"tags":["openSUSE","Linux"],"title":"openSUSE ä½¿ç”¨æŒ‡å—","uri":"/posts/opensuse-instruction/#2-è°ƒæ•´å®‰å…¨è®¾ç½®"},{"categories":["tech"],"content":" firewall é˜²ç«å¢™ä»‹ç»firewall æ˜¯ SUSE/RedHat ç­‰ RPM å‘è¡Œç‰ˆä½¿ç”¨çš„é˜²ç«å¢™ç¨‹åºï¼Œå®ƒåº•å±‚ä½¿ç”¨çš„æ˜¯ iptables/nftablesï¼Œ å¸¸ç”¨å‘½ä»¤å¦‚ä¸‹ï¼š bash systemctl enable firewalld # å¯ç”¨ firewalld æœåŠ¡ï¼Œå³æ‰“å¼€ã€Œå¼€æœºè‡ªå¯ã€åŠŸèƒ½ systemctl disable firewalld # å…³é—­ firewalld æœåŠ¡ï¼Œå³å…³é—­ã€Œå¼€æœºè‡ªå¯ã€åŠŸèƒ½ systemctl status firewalld # æŸ¥çœ‹ firewalld çš„çŠ¶æ€ systemctl start firewalld # å¯åŠ¨ systemctl stop firewalld # åœæ­¢ # æ‰“å¼€ SSH ç«¯å£ sudo firewall-cmd --zone=public --add-port=22/tcp --permanent # å…³é—­ SSH ç«¯å£ firewall-cmd --zone=public --remove-port=22/tcp --permanent # ä¿®æ”¹é˜²ç«å¢™è§„åˆ™åéœ€è¦é‡è½½é…ç½® sudo firewall-cmd --reload # æŸ¥çœ‹ firewall çš„çŠ¶æ€ sudo firewall-cmd --list-all ","date":"2021-01-04","objectID":"/posts/opensuse-instruction/:6:4","series":null,"tags":["openSUSE","Linux"],"title":"openSUSE ä½¿ç”¨æŒ‡å—","uri":"/posts/opensuse-instruction/#firewall-é˜²ç«å¢™ä»‹ç»"},{"categories":["tech"],"content":" å…¶ä»–è®¾ç½®ä» Windows å¸¦è¿‡æ¥çš„ä¹ æƒ¯æ˜¯å•å‡»é€‰ä¸­æ–‡ä»¶ï¼ŒåŒå‡»æ‰æ‰“å¼€ï¼Œè¿™ä¸ªå¯ä»¥åœ¨ã€Œç³»ç»Ÿè®¾ç½®ã€-ã€Œå·¥ä½œç©ºé—´è¡Œä¸ºã€-ã€Œå¸¸è§„è¡Œä¸ºã€-ã€Œç‚¹å‡»è¡Œä¸ºã€ä¸­ä¿®æ”¹ã€‚ ","date":"2021-01-04","objectID":"/posts/opensuse-instruction/:7:0","series":null,"tags":["openSUSE","Linux"],"title":"openSUSE ä½¿ç”¨æŒ‡å—","uri":"/posts/opensuse-instruction/#å…¶ä»–è®¾ç½®"},{"categories":["life","tech"],"content":" é—²è¨€ç¢è¯­ä¸€æ™ƒä¸€å¹´åˆè¿‡å»äº†ï¼Œä»Šå¹´å¯çœŸæ˜¯é­”å¹»çš„ä¸€å¹´ï¼Œå£ç½©å¸¦äº†ä¸€å¹´æ²¡èƒ½æ‘˜ä¸‹æ¥ï¼Œç¾å›½ç–«æƒ…æ„ŸæŸ“äººæ•° 1500 ä¸‡ã€‚ ä¸Šé¢è¿™æ®µè¯è¦æ˜¯è®©å»å¹´çš„æˆ‘çœ‹åˆ°äº†ï¼Œæ²¡å‡†éƒ½ä»¥ä¸ºä»Šå¹´çœŸçš„ç”ŸåŒ–å±æœºäº†hhhâ€¦ è¨€å½’æ­£ä¼ ï¼Œä»å»å¹´ 6 æœˆåº•å…¥èŒï¼Œåˆ°ç°åœ¨æœ‰ä¸€å¹´åŠäº†ï¼Œè¿™ä¸€å¹´åŠå­¦åˆ°çš„ä¸œè¥¿çœŸçš„éå¸¸å¤šï¼Œå®Œå…¨é‡å¡‘äº†æˆ‘çš„æŠ€æœ¯æ ˆã€‚ç°åœ¨æˆ‘çš„æ•´ä¸ªæŠ€æœ¯æ ˆï¼ŒåŸºæœ¬éƒ½æ˜¯å›´ç»•ç€äº‘åŸç”Ÿè¿™ä¸€å—å‘å±•äº†ã€‚ ","date":"2020-12-12","objectID":"/posts/2020-summary/:1:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"2020 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2020-summary/#é—²è¨€ç¢è¯­"},{"categories":["life","tech"],"content":" æ´»åŠ¨ä»Šå¹´ä¹Ÿå‚åŠ äº†å‡ ä¸ªæŠ€æœ¯æ²™é¾™ï¼Œæœ‰äº›æ”¶è·ï¼Œä½†æ˜¯æ²¡å»å¹´é‚£ä¹ˆæ–°å¥‡äº†ï¼Œä¸»è¦æ˜¯å¾ˆå¤šä¸œè¥¿è‡ªå·±å·²ç»æ‡‚äº†hhhã€‚å¤§æ¦‚æœ‰è¿™ä¹ˆå‡ ä¸ªæ´»åŠ¨ï¼š 2019 å¹´è…¾è®¯è“é²¸ç¬¬5å±Šè¿ç»´æŠ€æœ¯æ²™é¾™ï¼šåœ¨æ·±åœ³è…¾è®¯å¤§å¦å‚åŠ çš„ï¼Œç‚¹å¿ƒå’Œå’–å•¡å¾ˆæ£’ï¼Œè®²çš„ä¸œè¥¿é‡Œï¼Œè…¾è®¯è‡ªå·±åˆ†äº«çš„ã€Œç ”å‘è¿ç»´ä¸€ä½“åŒ–å¹³å°ã€æ¯”è¾ƒæœ‰æ”¶è·ï¼Œæˆ‘æ”¶è—äº†é‚£ä¸€ä»½ PPT Rancher - ä¼ä¸šäº‘åŸç”Ÿçš„æ¢ç´¢ä¸è½åœ°ï¼šå»å¹´å‚åŠ  Rancher çš„æ²™é¾™è§‰å¾—å¾ˆé«˜å¤§ä¸Šï¼Œå› ä¸ºè‡ªå·±å¾ˆå¤šä¸œè¥¿éƒ½ä¸æ‡‚ã€‚ä½†æ˜¯ä»Šå¹´æ¥å¬ï¼Œæ˜æ˜¾å°±æ„Ÿè§‰ä»–ä»¬è®²çš„å¾ˆåŸºç¡€ï¼Œå¯¹æˆ‘æ²¡ä»€ä¹ˆä»·å€¼äº†ã€‚ä¹Ÿä¾§é¢è¯´æ˜æˆ‘ç¡®å®è¿›æ­¥äº†éå¸¸å¤šå“ˆå“ˆã€‚ 2020 PyconChina æ·±åœ³åœºï¼šé¢ï¼Œä¹Ÿè§‰å¾—æ²¡ä»€ä¹ˆå¹²è´§ï¼Œå¥½å‡ ä¸ªéƒ½æ˜¯åœ¨æ¨é”€è‡ªå®¶çš„äº§å“ï¼ˆAzure AI å¹³å°å’Œä¸€ä¸ª Django å†™çš„ä½ä»£ç å¹³å°ï¼‰ï¼Œæœ‰ä¸ªè®² Nix åŒ…ç®¡ç†çš„å¤§ä½¬ä½†æ˜¯æ²¡è®²å¥½ï¼Œåé¢æˆ‘ä»¬å°±ç›´æ¥æºœäº†â€¦ å¦å¤–å°±æ˜¯ï¼Œä»Šå¹´å¿ƒè¡€æ¥æ½®ä¹°äº†å››å¼  Live House çš„æ¼”å‡ºç¥¨ï¼Œä½“éªŒä¸‹æ¥è§‰å¾—é’±èŠ±å¾—å¾ˆå€¼ï¼Œç»™æˆ‘å……å€¼äº†ä¸å°‘æ­£èƒ½é‡ã€‚ æ™¯å¾·é•‡æ–‡è‰ºå¤å…´ã€Šå°æ­Œè¡Œã€‹ï¼šè¿™æ˜¯æˆ‘è¶…çº§å–œæ¬¢çš„ä¸€ä¸ªä¹é˜Ÿï¼Œæ¼”å‡ºæ•ˆæœè¶…æ£’ï¼å¬åˆ°äº†å®Œæ•´çš„æ•…äº‹ï¼Œè€Œä¸”è§åˆ°äº†ä¹ä¸‰å§‘å¨˜æœ¬äººï¼Œå¤ªé«˜å…´äº†ï¼ å¾æµ·ä¿ - æ¸¸ç¦»ç‰‡åˆ»ï¼šè¿™ä½æ­Œæ‰‹æˆ‘ä¹‹å‰å…¶å®æ²¡æ¥è§¦è¿‡ï¼Œä½†æ˜¯å¬äº†ä¸‹å¥¹çš„ã€Šç©ºã€‹å‘ç°å¾ˆä¸é”™å¾ˆå¸…æ°”ï¼Œå°±ä¹°äº†ã€‚ä½†æ˜¯æ•´åœºä¸‹æ¥æ„Ÿè§‰ä¿ä¿çŠ¶æ€ä¸ä½³ï¼Œæœ‰ç‚¹å”±ä¸åŠ¨çš„æ„Ÿè§‰ã€‚ä¸­åœºé—®æ­Œè¿·ä»¬æœ‰æ²¡æœ‰å¸¦é‡æ ¼é…’ï¼Œæœ«äº†åˆé—®æ·±åœ³ç°åœ¨èƒ½æ¸¸æ³³ä¹ˆå“ˆå“ˆï¼Œæ˜¯ä¸ªå¾ˆéšæ€§çš„æ­Œæ‰‹ã€‚åé¢å¯èƒ½è¿˜çœŸæ¸¸æ³³å»äº†ã€‚ å¤å°è™ - é€å¹´ï¼šè¿™æ˜¯ä¸ªæ°‘è°£æ­Œæ‰‹ï¼Œä»¥å‰ä¸Šå¤§å­¦çš„æ—¶å€™å¬è¿‡ï¼Œåªæœ‰å‰ä»–å’Œäººå£°ï¼Œå…¶å®æ˜¯æœ‰äº›ä¼¤æ„Ÿçš„æ­Œã€‚å› ä¸ºæˆ‘æœ€è¿‘çŠ¶æ€å¾ˆå¥½ï¼Œæˆ‘å»ä¹‹å‰è¿˜æ‹…å¿ƒæ°›å›´ä¸é€‚åˆæˆ‘ã€‚ç„¶åå¤å°è™è¯´å¼€å¿ƒæœ€é‡è¦ï¼Œå¸¦äº†ä¸ªä¹é˜Ÿæ¥ä¼´å¥ï¼Œæ¶å­é¼“å°±æ˜¯çµé­‚ï¼Œæ•´ä¸ªæ¼”å‡ºéƒ½å› é¼“ç‚¹è€Œæ¬¢å¿«äº†èµ·æ¥ã€‚æ•ˆæœä¹Ÿéå¸¸æ£’ï¼ æ—¶å…‰èƒ¶å›Šä¹é˜Ÿï¼šè¿™ä¹Ÿæ˜¯ä¸€ä¸ªå›½é£åæ‘‡ä¹é˜Ÿï¼Œåœ¨ä¸€ä¸ªæ·±åœ³ç¦ç”°ä¸€ä¸ªå°é…’å§ã€Œçº¢ç³–ç½ä¸Šæ­¥åº—ã€æ¼”å‡ºçš„ï¼Œ æ¯”è¾ƒç®€é™‹ï¼Œäººä¹Ÿä¸å¤šï¼Œå°±å››äº”åäººçš„æ ·å­ï¼ˆå‡ºä¹æ„æ–™ï¼‰ã€‚ä½†æ˜¯æ¼”å‡ºæ•ˆæœå¾ˆæ£’ï¼Œã€Šæ—…é€”ã€‹ã€Šå¿†é•¿å®‰ã€‹ã€Šç£çŸ³ã€‹éƒ½éå¸¸å¥½å¬ã€‚å°¤å…¶æ˜¯åœ¨è¿™æ ·çš„åœºåˆå”±ã€Šæˆ‘ä¸çŸ¥é“ä½ çš„åå­—ã€‹ï¼ŒæŒºæœ‰æ„Ÿè§¦çš„ã€‚ ","date":"2020-12-12","objectID":"/posts/2020-summary/:2:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"2020 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2020-summary/#æ´»åŠ¨"},{"categories":["life","tech"],"content":" æŠ€æœ¯èƒ½åŠ›æ€»ç»“ä»Šå¹´æˆ‘çš„å·¥ä½œé‡ç‚¹æœ‰è¿™ä¹ˆå‡ ä¸ªï¼š é‡æ„åŠç»´æŠ¤ CI/CD ä»£ç ï¼Œè®©å®ƒèƒ½åœ¨å¤šä¸ªäº§å“çº¿ä¸Šå¤ç”¨ äº‘ä¸Šç¯å¢ƒç®¡ç†ï¼šä»Šå¹´ç†Ÿæ‚‰äº†é˜¿é‡Œäº‘è¿™ä¸€å¥—ä¸œè¥¿ï¼Œå¹¶ä¸”ç”¨ä¸Šäº†è‡ªåŠ¨åŒ–å·¥å…·å¯¹äº‘ä¸Šç¯å¢ƒè¿›è¡Œç®¡ç†ã€‚ ä¸€å¼€å§‹æ˜¯ä½¿ç”¨ terraformï¼Œä½†æ˜¯ terraform çš„ hcl è¯­æ³•ä¸å¤Ÿçµæ´»ï¼Œæœ€è¿‘åˆ‡æ¢åˆ°äº† pulumi+pythonï¼Œä¸å¾—ä¸è¯´çœŸé¦™ã€‚ç›®å‰äº‘ä¸Šçš„èµ„æºåŠé…ç½® 95% éƒ½å®Œå…¨ç”¨ pulumi ç®¡ç†äº†ï¼ˆè¿˜å‰©å¤§æ¦‚ 5% å› ä¸ºå„ç§åŸå› ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®ï¼‰ã€‚ kubernetesäº‘åŸç”Ÿ: ä»Šå¹´æˆ‘åœ¨è¿™ä¸ªé¢†åŸŸçš„è¿›æ­¥æœ€å¤§ï¼Œç†Ÿæ‚‰äº† k8s/istio/flagger/vault/prometheus/helm/traefik ç­‰ç­‰ã€‚ä¸è¿‡ç›®å‰è¿™é‡Œé¢å¤§éƒ¨åˆ†å·¥å…·è¿˜åœç•™åœ¨ã€Œä¼šç”¨ã€çš„çŠ¶æ€ã€‚ æœåŠ¡å™¨è™šæ‹ŸåŒ–ç³»ç»Ÿä» vSphere åˆ‡æ¢åˆ° PVE VMware çš„ vCenter åƒçš„èµ„æºå¤ªå¤šï¼Œè€Œä¸”è¿˜ä¸èƒ½è‡ªåŠ¨æ‰©ç¼©å®¹ç¡¬ç›˜ï¼ŒPython SDK ä¹Ÿè¶…éš¾ç”¨ã€‚å› æ­¤æˆ‘åœ¨å…¬å¸å°è¯•ä½¿ç”¨ PVE æ›¿æ¢ vSphere è¿™ä¸€å¥—ï¼Œæ•ˆæœå¾ˆä¸é”™ã€‚ PVE+pulumi/terraform+cloudinit èƒ½å®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²è™šæ‹Ÿæœºï¼Œè‡ªåŠ¨é…ç½®ç½‘ç»œã€è´¦å·åŠSSHå¯†é’¥ã€è‡ªåŠ¨æ‰©ç¼©å®¹ç¡¬ç›˜ï¼Œéå¸¸æ–¹ä¾¿ï¼ è€Œä¸” PVE ä¸æ”¶è´¹ï¼Œå»ä¸­å¿ƒåŒ–ï¼Œä¸€å¥—ç”¨ä¸‹æ¥èˆ’æœå¤ªå¤šäº†ã€‚åªæ˜¯ pve+cloud-init é—¨æ§›ç¨å¾®é«˜ä¸€ç‚¹ï¼Œ éœ€è¦ä¸€å®šæ—¶é—´å»ç†Ÿæ‚‰ã€‚ CI/CD ç³»ç»Ÿï¼šåŸºäº Jenkins çš„ CI/CD åœ¨æˆ‘å¸å„ç§æ°´åœŸä¸æœï¼Œå°æ¯›ç—…ä¸æ–­ã€‚Jenkins æœ¬èº«å°±å­˜åœ¨å•ç‚¹æ•…éšœï¼Œä¸é€‚åˆäº‘åŸç”Ÿï¼ŒåŠ ä¸Š Jenkinsfile æœ‰å­¦ä¹ æˆæœ¬ï¼Œè€Œä¸”ä¸æ–¹ä¾¿å¤ç”¨ï¼Œæˆ‘å°±æƒ³æŠŠ Jenkins æ¢æ‰ã€‚æˆ‘åœ¨è¿™ä¸€å¹´é‡Œè°ƒç ”äº†å¤§é‡çš„å¼€æº CI/CD å·¥å…·ï¼Œéƒ½å„æœ‰ä¸è¶³ã€‚ä¸»è¦è¿˜æ˜¯å› ä¸ºæˆ‘ä»¬å½“ä¸‹çš„ Jenkins æ‰¿è½½äº†å¤ªå¤šçš„åŠŸèƒ½ï¼Œå·²ç»æ˜¯ä¸€ä¸ªCI/CDã€è‡ªåŠ¨åŒ–æµ‹è¯•ã€è‡ªåŠ¨åŒ–è¿ç»´å¹³å°äº†ï¼Œå¦ä¸€æ–¹é¢å…¬å¸åç«¯çš„æµæ°´çº¿è¿˜å­˜åœ¨ä¾èµ–å…³ç³»ï¼Œéœ€è¦è¿›è¡Œå¤æ‚çš„ç¼–æ’ã€‚ ç›®å‰æˆ‘å°±æ‰¾åˆ° Argo Workflows çš„åŠŸèƒ½å¾ˆç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚ï¼Œç›®å‰æ­£åœ¨å°è¯•è¿ç§»ä¸€éƒ¨åˆ†åŠŸèƒ½åˆ° Argo Workflows è¯•ç”¨ã€‚ å› ä¸º argo çš„ UI å’Œ jenkins å·®åˆ«è¿‡å¤§ï¼Œæš‚å®šä»ä»¥ jenkins ä¸ºå‰ç«¯ï¼Œé€šè¿‡ python å°†ä»»åŠ¡åˆ†æ´¾ç»™ argo è¿è¡Œã€‚è¿™æ · argo å¯¹ä½¿ç”¨è€…è€Œè¨€æ˜¯éšå½¢çš„ï¼Œç”¨æˆ·ä½“éªŒåŸºæœ¬ä¸Šæ²¡åŒºåˆ«ã€‚ æ‚äº‹ï¼šä¿®æ°´ç”µã€ä¿®æœåŠ¡å™¨ã€ç»„è£…åŠå…¬ç”µè„‘ã€æ¬æœºæˆ¿â€¦ ","date":"2020-12-12","objectID":"/posts/2020-summary/:3:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"2020 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2020-summary/#æŠ€æœ¯èƒ½åŠ›æ€»ç»“"},{"categories":["life","tech"],"content":" ä»Šå¹´åœ¨æŠ€æœ¯æ–¹é¢çš„æ„Ÿå— Podman/Skopeo/Buildah/Kaniko ç­‰æŠ€æœ¯è¿›ä¸€æ­¥å‘å±•ï¼Œæ­£åœ¨é€æ¸èš•é£Ÿ Docker çš„åœ°ç›˜. kubernetes å·²ç»å¼ƒç”¨ docker-shimï¼Œç›´æ¥å¯¹æ¥ containerdï¼Œä¸‹ä¸€æ­¥åº”è¯¥æ˜¯å½»åº•åˆ‡æ¢åˆ° CRI-Oã€‚ Istio 1.5 åˆå¹¶ä¸ºå•ä½“æ¶æ„æ•ˆæœå¾ˆæ˜æ˜¾ï¼Œå„å¾®ä¿¡å…¬ä¼—å·ä¸‰å¤©ä¸¤å¤´å°±è®²æœåŠ¡ç½‘æ ¼ï¼ŒæœåŠ¡ç½‘æ ¼æ˜¯æ¯‹åº¸ç½®ç–‘çš„æœªæ¥ é˜¿é‡Œäº‘çš„ OAM è¿›ä¸€æ­¥å‘å±•ï¼Œç›®å‰é˜¿é‡ŒåŸºäº OAM ç ”å‘çš„ Kubevela è‡´åŠ›äºå°è£… Kubernetes çš„åŠŸèƒ½ï¼Œè®©å°ç™½ä¹Ÿèƒ½ç”¨ä¸Š Kubernetesã€‚è€Œè¿™åŒæ—¶è¿˜èƒ½ä¿ç•™ k8s å®Œæ•´çš„èƒ½åŠ›ï¼Œå€¼å¾—æœŸå¾…ã€‚ äº‘ä¸Šå®‰å…¨è¶Šæ¥è¶Šå¼•èµ·é‡è§†äº†ï¼Œç›®å‰ CNCF ç¤¾åŒºä¸Šå®¹å™¨å®‰å…¨ç›¸å…³çš„é¡¹ç›®åœ¨å¿«é€Ÿå‘å±•ã€‚åŒ…æ‹¬é•œåƒå®‰å…¨/å®‰å…¨å®¹å™¨(kata containers)ç­‰ã€‚ ä½¿ç”¨ Kubernetes æ¥ç®¡ç†æ•°æ®åº“å·²ç»æ˜¯å¤§è¶‹åŠ¿ï¼Œæ¯•ç«Ÿæˆæœ¬ä¼˜åŠ¿å¤ªæ˜æ˜¾äº†ã€‚ å¾ˆå¤šå…¬å¸å·²ç»åœ¨ä½¿ç”¨ docker è¿è¡Œæ•°æ®åº“ï¼Œæ¯•ç«Ÿæ€§èƒ½æ²¡å•¥æŸå¤±ï¼Œå°±èƒ½æ–¹ä¾¿å¾ˆå¤šã€‚ä½†æ˜¯ä»ç„¶æ‰‹åŠ¨æ­å»ºé›†ç¾¤ï¼Œä¹Ÿä¸ä½¿ç”¨åˆ†å¸ƒå¼å­˜å‚¨ã€‚ ç›®å‰å¥½åƒåªæœ‰å¤§å‚å¦‚é˜¿é‡Œäº¬ä¸œæ‰æœ‰è¿™ä¸ªå®åŠ›ï¼Œä½¿ç”¨ kubernetes å’Œåˆ†å¸ƒå¼å­˜å‚¨æ¥è·‘æ•°æ®åº“ã€‚å®¹å™¨åŒ–çš„åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿç»´æŠ¤(å¦‚ ceph)ï¼Œå…¶ä¸­çš„éš¾ç‚¹æˆ‘ç›®å‰è¿˜ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œä¸è¿‡æ— å¤–ä¹æ€§èƒ½ã€ç¨³å®šæ€§ã€æ•…éšœæ¢å¤è¿™äº›ã€‚ ","date":"2020-12-12","objectID":"/posts/2020-summary/:4:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"2020 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2020-summary/#ä»Šå¹´åœ¨æŠ€æœ¯æ–¹é¢çš„æ„Ÿå—"},{"categories":["life","tech"],"content":" æ˜å¹´çš„å±•æœ› Go è¯­è¨€å¿…é¡»å­¦èµ·æ¥ï¼Œä»Šå¹´å…¥é—¨äº†ä¸¤éè¯­æ³•ï¼Œä½†æ˜¯æ²¡å†™è¿‡å•¥ä¸œè¥¿ï¼Œåˆå¿˜å·®ä¸å¤šäº†ã€‚ è¦è¿›ä¸€æ­¥ç†Ÿæ‚‰ k8s/istio/flagger/vault/prometheus/helm/traefik/caddy è¿™äº›å·¥å…·ï¼Œä¼šç”¨è¿˜ä¸å¤Ÿï¼Œè¦æ·±å…¥åº•å±‚ã€‚ æ·±å…¥å­¦ä¹ è®¡ç®—æœºç½‘ç»œ + Linux ç½‘ç»œ + Kubernetes ç½‘ç»œï¼è¿™éå¸¸é‡è¦ã€‚ å­¦ä¹  Podman/Docker çš„åº•å±‚åŸç†ï¼Œå­¦ä¹  katacontainers ç­‰å®‰å…¨å®¹å™¨æŠ€æœ¯ã€‚ ä¸º kubevela/dapr/knative ç­‰äº‘åŸç”Ÿé¡¹ç›®åšä¸€äº›è´¡çŒ®ï¼Œè¦å‚ä¸åˆ°å¼€æºä¸­å»ã€‚ æŒæ¡ Argo Workflows/tektonï¼Œå°† CI/CD æ¬åˆ° k8s ä¸Šå»ã€‚ å­¦ä¹ è®¾è®¡æ¨¡å¼ æœ‰æœºä¼šçš„è¯ï¼Œç†Ÿæ‚‰ä¸‹åˆ†å¸ƒå¼å­˜å‚¨ã€åˆ†å¸ƒå¼æ•°æ®åº“ã€‚è¿™æ–¹é¢æˆ‘ç›®å‰è¿˜ç›¸å½“æ¬ ç¼ºã€‚ å­¦ä¹  KVM è™šæ‹ŸåŒ– å¦‚æœå­¦ï¼ˆxianï¼‰æœ‰ï¼ˆdeï¼‰ä½™ï¼ˆdanï¼‰åŠ›ï¼ˆtengï¼‰çš„è¯ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘ææä¸‹é¢è¿™å‡ ä¸ªï¼š rust è¯­è¨€ï¼šrust é€šè¿‡ owner+lifetime å®ç°å†…å­˜çš„æ™ºèƒ½ç®¡ç†ï¼Œæ€§èƒ½å¾ˆé«˜ï¼Œè€Œä¸”ç¼–è¯‘å™¨æç¤ºéå¸¸å‹å¥½ï¼Œå€¼å¾—ä¸€å­¦ã€‚ æœºå™¨å­¦ä¹ /æ·±åº¦å­¦ä¹ : è¿™ä¸ªé¢†åŸŸå¯æ˜¯å½“ä¸‹çš„å¤§çƒ­é—¨ï¼Œå¯ä»¥ç”¨ python/julia ç©ä¸€ç©ï¼Œé¡ºä¾¿è¡¥ä¸€è¡¥å¾®ç§¯åˆ†çº¿ä»£æ¦‚ç‡è®ºã€‚ã€‚ ã€Šç¼–ç¨‹è¯­è¨€å®ç°æ¨¡å¼ã€‹ï¼šå—¯ï¼Œå¸Œæœ›èƒ½è‡ªå·±é€ è½®å­ï¼Œå†™äº›ç®€å•çš„ parserã€‚ elixir: ruby è¯­æ³•+ erlang å¹¶å‘æ¨¡å‹(actor), å¦‚æœæœ‰æ—¶é—´çš„è¯ï¼Œä¹Ÿå¯ä»¥ç©ç©ï¼Œäº†è§£ä¸‹åŸç”Ÿåˆ†å¸ƒå¼çš„å‡½æ•°å¼è¯­è¨€çš„ç‰¹ç‚¹ã€‚ å›çœ‹äº†ä¸‹å»å¹´çš„æ€»ç»“ï¼Œå‘ç°æˆ‘ go/c# éƒ½æ²¡å­¦å¤šå°‘ï¼Œè®¾è®¡æ¨¡å¼ä¹Ÿæ²¡åŠ¨ï¼Œpython è¿˜åœ¨åŸåœ°è¸æ­¥hhhâ€¦ å»å¹´çš„å±•æœ›å¾ˆå¤šéƒ½æ²¡å®ç°ã€‚ ä¸è¿‡äº‘åŸç”Ÿè¿™ä¸€å—å€’æ˜¯è¿›æ­¥å¾ˆå¿«ï¼Œæ€»ä½“å¾ˆæ»¡æ„ä»Šå¹´çš„æˆæœå“ˆå“ˆ~ æ˜å¹´åŠ æ²¹ï¼ ","date":"2020-12-12","objectID":"/posts/2020-summary/:5:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"2020 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2020-summary/#æ˜å¹´çš„å±•æœ›"},{"categories":["éŸ³ä¹","life"],"content":" å‰è¨€2020 å¹´ 11 æœˆ 28 æ—¥ï¼Œæˆ‘ç¬¬ä¸€æ¬¡å‚åŠ  Live Houseï¼Œæ¼”å‡ºä¹é˜Ÿæ˜¯ã€Œæ™¯å¾·é•‡æ–‡è‰ºå¤å…´ã€ã€‚ ã€Œæ™¯å¾·é•‡æ–‡è‰ºå¤å…´ã€æ˜¯æˆ‘å¾ˆå–œæ¬¢çš„ä¸€æ”¯åæ‘‡ä¹é˜Ÿï¼Œæˆ‘å–œæ¬¢ä¸Šè¿™æ”¯ä¹é˜Ÿï¼Œè¿˜å¾—ä»æˆ‘çš„æ˜µç§°ã€Œæ–¼æ¸…æ¨‚ã€è¯´èµ·ã€‚ 17 å¹´çš„æ—¶å€™ï¼Œå¬äº†è®¸å¤šåæ‘‡ï¼Œç½‘æ˜“äº‘å°±ç»™æˆ‘æ¨èã€Œæ™¯å¾·é•‡æ–‡è‰ºå¤å…´ã€çš„æ­Œï¼Œå¦‚æ­¤ç»“ç¼˜ã€‚ å…¶ä¸­æœ‰ä¸€é¦–æ­Œæ˜¯ã€Œæ»¡ä¸–ã€ï¼Œåæ‘‡å˜›ï¼Œæ­Œè¯åªæœ‰å››å¥ï¼š æœˆä¸‹çµé¸ŸåŸ èŠ±é¦™æ— å¤„å¯» å†çœ‹ç ´åœŸäºº ä¸€æ»¡åˆä¸€ä¸– å¬è¿™é¦–æ­Œçš„æ—¶å€™ï¼Œæˆ‘æƒ³èµ·çœ‹è¿‡éŸ©å¯’çš„ã€Šé•¿å®‰ä¹±ã€‹ï¼Œé‡Œé¢å¥³ä¸»åå«ã€Œå–œä¹ã€ï¼Œè¿™åå­—é‡Œå¯„æ‰˜ç€å®¶äººå¯¹å¥¹çš„æœŸè®¸â€”â€”å¹³å®‰å–œä¹ã€‚æˆ‘å¿ƒé‡Œä¹Ÿå‡èµ·ä¸€ä¸ªä¸å¯èƒ½å®ç°çš„æ„¿æœ›ï¼š å¸Œå†€èƒ½äºè¿™å°˜ä¸–ä¹‹ä¸­ï¼Œäº«å¾—åŠä¸–æ¸…é—²ï¼Œä¸€ç”Ÿå–œä¹ è¿™æ„¿æœ›å·²ç„¶ä¸å¯èƒ½å®ç°ï¼Œè¿‡å¾€çš„å²æœˆé‡Œï¼Œæˆ‘æœ‰è¿‡å¤ªå¤šè‹¦æ¼ï¼Œåšè¿‡äº†å¤ªå¤šé”™äº‹ï¼›å¯é‡è§çš„æœªæ¥ï¼Œä¹Ÿè¿˜æ²¡åˆ°æ¸…é—²äº«ä¹çš„æ—¶å€™ã€‚é‚£è‡³å°‘æŠŠæ˜µç§°æ”¹æˆã€Œæ–¼æ¸…æ¨‚ã€ï¼Œæé†’ç€è‡ªå·±ï¼Œä½ æœ‰è¿‡è¿™æ ·ä¸€ä¸ªæ„¿æœ›ã€‚ ","date":"2020-11-28","objectID":"/posts/jingdezhen-renaissance-band-2020-shenzhen/:1:0","series":null,"tags":["æ™¯å¾·é•‡æ–‡è‰ºå¤å…´","åæ‘‡"],"title":"ã€Œå°æ­Œè¡Œã€-æ™¯å¾·é•‡æ–‡è‰ºå¤å…´-2020å·¡æ¼”-æ·±åœ³","uri":"/posts/jingdezhen-renaissance-band-2020-shenzhen/#å‰è¨€"},{"categories":["éŸ³ä¹","life"],"content":" æ¼”å‡ºæ¼”å‡ºçš„å†…å®¹æ˜¯ã€Šå°æ­Œè¡Œã€‹è¿™å¼ ä¸“è¾‘ï¼Œä¹é˜Ÿé€šè¿‡ä¸€ä¸ªè‡ªåˆ›çš„ç¥è¯æ•…äº‹ï¼Œå°†æ•´å¼ ä¸“è¾‘ä¸²æˆäº†ä¸€ä¸ªç±»ä¼¼éŸ³ä¹å‰§çš„å½¢å¼ï¼Œè¿›è¡Œæ¼”å‡ºï¼Œæ•ˆæœå¾ˆæ£’ï¼ æˆ‘ç”¨æ‰‹æœºå½•ä¸‹äº†å‡ ä¹å…¨ç¨‹ï¼Œå› ä¸ºç¬¬ä¸€æ¬¡å‚åŠ  Live Houseï¼Œåˆæ˜¯è‡ªå·±è¿™ä¹ˆå–œæ¬¢çš„ä¹é˜Ÿï¼Œæƒ³è¦å½•ä¸‹æ¥ï¼Œç•™åšçºªå¿µã€‚ è§†é¢‘å·²ç»ä¸Šä¼ åˆ°äº† Bilibili: å½•åˆ°æœ€åæ‰‹æœºæ²¡ç”µäº†ï¼Œä¸ºäº†ç•™ç‚¹ç”µé‡åˆ·å…¬äº¤è½¦å¡å’Œé—¨ç¦å¡ï¼Œæœ€åä¸€é¦–ã€Šæ°´ç å¤´ã€‹æ²¡æœ‰å½•å®Œã€‚ï¼ˆåˆ°å®¶æ—¶çœŸçš„å·®ç‚¹åˆ·ä¸äº†é—¨ç¦hhhï¼‰ å¥½äº†ï¼Œä¸‹é¢æ˜¯æ¼”å‡ºçš„ç…§ç‰‡é›†é”¦ï¼š Live House å…¥å£çš„å®£ä¼ æµ·æŠ¥ è€æ‘é•¿1 è€æ‘é•¿2 è€æ‘é•¿3 æ‹‰å°æç´çš„å°å“¥å“¥ ä¹ä¸‰èˆè¹ˆ å°æç´ä¼´å¥ ä¹ä¸‰æ˜¯æœå»·å‘½å®˜ é˜¿å¼¥é™€ä½› å”± å”± å”± å”± å”± ä¹ä¸‰æœ€æ¼‚äº®çš„ä¸€ç¬é—´ ä¹ä¸‰è¶…å¸…æ°” ç»“æŸï¼š Live House åå° ç»“æŸé èº¬ å¤§åˆç…§ ç­¾å”®ï¼š ç­¾å”® ","date":"2020-11-28","objectID":"/posts/jingdezhen-renaissance-band-2020-shenzhen/:2:0","series":null,"tags":["æ™¯å¾·é•‡æ–‡è‰ºå¤å…´","åæ‘‡"],"title":"ã€Œå°æ­Œè¡Œã€-æ™¯å¾·é•‡æ–‡è‰ºå¤å…´-2020å·¡æ¼”-æ·±åœ³","uri":"/posts/jingdezhen-renaissance-band-2020-shenzhen/#æ¼”å‡º"},{"categories":["tech"],"content":" ä¸ªäººç¬”è®°ï¼Œä¸ä¿è¯æ­£ç¡® ","date":"2020-05-31","objectID":"/posts/base64-encoding-is-not-unique/:0:0","series":null,"tags":["Base64","ç¼–ç "],"title":"Base64 ç¼–ç å¹¶ä¸å”¯ä¸€","uri":"/posts/base64-encoding-is-not-unique/#"},{"categories":["tech"],"content":" é—®é¢˜æˆ‘ä»¥å‰åªçŸ¥é“ Base64 è¿™ä¸ªç¼–ç ç®—æ³•å¾ˆå¸¸ç”¨ï¼Œè‡ªå·±ä¹Ÿç»å¸¸åœ¨ JWT ç­‰åœºæ™¯ä¸‹ä½¿ç”¨ï¼Œä½†æ˜¯ä»æ¥æ²¡äº†è§£è¿‡å®ƒçš„åŸç†ï¼Œä¸€ç›´å…ˆå…¥ä¸ºä¸»åœ°è®¤ä¸ºå®ƒçš„ç¼–ç åº”è¯¥æ˜¯å”¯ä¸€çš„ã€‚ ä½†æ˜¯ä»Šå¤©æµ‹è¯• JWT æ—¶ï¼Œå‘ç°ä¿®æ”¹ JWT çš„æœ€åä¸€ä¸ªå­—ç¬¦ï¼ˆå…¶å®ä¸æ˜¯æˆ‘å‘ç°çš„ã€‚ã€‚ï¼‰ï¼Œå±…ç„¶æœ‰å¯èƒ½ä¸å½±å“ JWT çš„æ­£ç¡®æ€§ã€‚æ¯”å¦‚ä¸‹è¿™ä¸ªä½¿ç”¨ HS256 ç®—æ³•çš„ JWT: text eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c æŠŠå®ƒçš„æœ€åä¸€ä¸ªå­—ç¬¦æ”¹æˆ d eæˆ–è€… fï¼Œéƒ½èƒ½æˆåŠŸé€šè¿‡ http://jwt.io çš„éªŒè¯ã€‚ è¿™è®©æˆ‘è§‰å¾—å¾ˆå¥‡æ€ªï¼ˆéš¾é“æˆ‘å‘ç°äº†ä¸€ä¸ª Bugï¼Ÿï¼‰ï¼Œåœ¨ QQ ç¾¤é‡Œä¸€é—®ï¼Œå°±æœ‰å¤§ä½¬æ‰¾åˆ°æ ¹æœ¬åŸå› ï¼šè¿™æ˜¯ Base64 ç¼–ç çš„ç‰¹æ€§ã€‚å¹¶ä¸”é€šè¿‡ python è¿›è¡Œäº†å®é™…æ¼”ç¤ºï¼š python In [1]: import base64 # ä½¿ç”¨ jwt çš„ signature è¿›è¡ŒéªŒè¯ In [2]: base64.b64decode(\"SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c==\") Out[2]: b'I\\xf9J\\xc7\\x04IH\\xc7\\x8a(]\\x90O\\x87\\xf0\\xa4\\xc7\\x89\\x7f~\\x8f:N\\xb2%V\\x9dB\\xcb0\\xe5' In [3]: base64.b64decode(\"SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5d==\") Out[3]: b'I\\xf9J\\xc7\\x04IH\\xc7\\x8a(]\\x90O\\x87\\xf0\\xa4\\xc7\\x89\\x7f~\\x8f:N\\xb2%V\\x9dB\\xcb0\\xe5' In [4]: base64.b64decode(\"SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5e==\") Out[4]: b'I\\xf9J\\xc7\\x04IH\\xc7\\x8a(]\\x90O\\x87\\xf0\\xa4\\xc7\\x89\\x7f~\\x8f:N\\xb2%V\\x9dB\\xcb0\\xe5' In [5]: base64.b64decode(\"SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5f==\") Out[5]: b'I\\xf9J\\xc7\\x04IH\\xc7\\x8a(]\\x90O\\x87\\xf0\\xa4\\xc7\\x89\\x7f~\\x8f:N\\xb2%V\\x9dB\\xcb0\\xe5' # ä¸¤ä¸ªç­‰äºå·ä¹‹åçš„ä»»ä½•å†…å®¹ï¼Œéƒ½ä¼šè¢«ç›´æ¥ä¸¢å¼ƒã€‚è¿™ä¸ªæ˜¯å®ç°ç›¸å…³çš„ï¼Œæœ‰çš„ base64 å¤„ç†åº“å¯¹è¿™ç§æƒ…å†µä¼šæŠ¥é”™ã€‚ In [6]: base64.b64decode(\"SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5f==fdf=df==dfd=fderwe=r\") Out[6]: b'I\\xf9J\\xc7\\x04IH\\xc7\\x8a(]\\x90O\\x87\\xf0\\xa4\\xc7\\x89\\x7f~\\x8f:N\\xb2%V\\x9dB\\xcb0\\xe5' å¯ä»¥çœ‹åˆ°æœ‰ä¸¤ä¸ªç°è±¡ï¼š å°†åŒä¸€ä¸ª base64 ä¸²çš„æœ€åä¸€ä¸ªå­—æ¯åˆ†åˆ«æ”¹æˆ d e fï¼Œè§£ç å‡ºæ¥çš„å†…å®¹æ²¡æœ‰ä»»ä½•å˜åŒ–ã€‚ åœ¨ base64 ä¸²æœ«å°¾ == åé¢æ·»åŠ äº†ä¸€å †éšæœºå­—ç¬¦ï¼Œå¯¹è§£ç å‡ºçš„å†…å®¹ä¹Ÿæ²¡æœ‰ä»»ä½•å½±å“ã€‚ ","date":"2020-05-31","objectID":"/posts/base64-encoding-is-not-unique/:0:0","series":null,"tags":["Base64","ç¼–ç "],"title":"Base64 ç¼–ç å¹¶ä¸å”¯ä¸€","uri":"/posts/base64-encoding-is-not-unique/#é—®é¢˜"},{"categories":["tech"],"content":" åŸå› åˆ†æbase64 ç¼–ç å°†äºŒè¿›åˆ¶å†…å®¹(bytes)ä»å·¦å¾€å³æ¯ 6 bits åˆ†ä¸ºä¸€ç»„ï¼Œæ¯ä¸€ç»„ç¼–ç ä¸ºä¸€ä¸ªå¯æ‰“å°å­—ç¬¦ã€‚ bas64 ä» ASCII å­—ç¬¦é›†ä¸­é€‰å‡ºäº† 64 ä¸ªå­—ç¬¦ï¼ˆ=å·é™¤å¤–ï¼‰è¿›è¡Œç¼–ç ã€‚å› ä¸º $2^6=64$ï¼Œä½¿ç”¨ 64 ä¸ªå­—ç¬¦æ‰èƒ½ä¿è¯ä¸Šè¿°ç¼–ç çš„å”¯ä¸€æ€§ã€‚ ä½†æ˜¯è¢«ç¼–ç çš„äºŒè¿›åˆ¶å†…å®¹(bytes)çš„ bits æ•°ä¸ä¸€å®šæ˜¯ 6 çš„å€æ•°ï¼Œæ— æ³•è¢«ç¼–ç ä¸º 6 bits ä¸€ç»„ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±éœ€è¦åœ¨è¿™äº›äºŒè¿›åˆ¶å†…å®¹çš„æœ«å°¾å¡«å……ä¸Š 2 æˆ– 4 ä¸ª bit ä½ï¼Œè¿™æ ·æ‰èƒ½ä½¿ç”¨ base64 è¿›è¡Œç¼–ç ã€‚ å…³äºè¿™äº›è¢«å¡«å……çš„ bitsï¼Œåœ¨ RFC4648 ä¸­å®šä¹‰äº†è§„èŒƒè¡Œä¸ºï¼šå…¨éƒ¨è¡¥ 0. ä½†æ˜¯è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå¼ºåˆ¶çš„è¡Œä¸ºï¼Œ å› æ­¤å®é™…ä¸Šä½ å¯ä»¥éšä¾¿è¡¥ï¼Œåœ¨è¿›è¡Œ base64 è§£ææ—¶ï¼Œè¢«å¡«è¡¥çš„ bits ä¼šè¢«ç›´æ¥å¿½ç•¥æ‰ã€‚ è¿™å°±å¯¼è‡´äº†ä¸Šé¢æè¿°çš„è¡Œä¸ºï¼šä¿®æ”¹ JWT çš„æœ€åä¸€ä¸ªå­—ç¬¦(6 bitsï¼Œå…¶ä¸­å¯èƒ½åŒ…å« 2 æˆ– 4 ä¸ªå¡«å……æ¯”ç‰¹ä½)å¯èƒ½å¹¶ä¸å½±å“è¢«ç¼–ç çš„å®é™…å†…å®¹ï¼ RFC4648 ä¸­å¯¹è¿™ä¸ª bits å¡«å……çš„æè¿°å¦‚ä¸‹ï¼š text 3.5. Canonical Encoding The padding step in base 64 and base 32 encoding can, if improperly implemented, lead to non-significant alterations of the encoded data. For example, if the input is only one octet for a base 64 encoding, then all six bits of the first symbol are used, but only the first two bits of the next symbol are used. These pad bits MUST be set to zero by conforming encoders, which is described in the descriptions on padding below. If this property do not hold, there is no canonical representation of base-encoded data, and multiple base- encoded strings can be decoded to the same binary data. If this property (and others discussed in this document) holds, a canonical encoding is guaranteed. In some environments, the alteration is critical and therefore decoders MAY chose to reject an encoding if the pad bits have not been set to zero. The specification referring to this may mandate a specific behaviour. å®ƒè®²åˆ°åœ¨æŸäº›ç¯å¢ƒä¸‹ï¼Œbase64 è§£æå™¨å¯èƒ½ä¼šä¸¥æ ¼æ£€æŸ¥è¢«å¡«å……çš„è¿™å‡ ä¸ª bitsï¼Œè¦æ±‚å®ƒä»¬å…¨éƒ¨ä¸º 0. ä½†æ˜¯æˆ‘æµ‹è¯•å‘ç°ï¼ŒPython æ ‡å‡†åº“å’Œ https://jwt.io éƒ½æ²¡æœ‰åšè¿™æ ·çš„é™åˆ¶ã€‚å› æ­¤æˆ‘è®¤ä¸ºç»å¤§éƒ¨åˆ†ç¯å¢ƒä¸‹ï¼Œè¢«å¡«å……çš„ bits éƒ½æ˜¯ä¼šè¢«å¿½ç•¥çš„ã€‚ ","date":"2020-05-31","objectID":"/posts/base64-encoding-is-not-unique/:1:0","series":null,"tags":["Base64","ç¼–ç "],"title":"Base64 ç¼–ç å¹¶ä¸å”¯ä¸€","uri":"/posts/base64-encoding-is-not-unique/#åŸå› åˆ†æ"},{"categories":["tech"],"content":" é—®é¢˜ä¸€ï¼šä¸ºä»€ä¹ˆåªéœ€è¦å¡«å…… 2 æˆ– 4 ä¸ª bit ä½ï¼Ÿè¿™æ˜¯çœ‹åˆ°ã€Œå¡«å……ä¸Š 2 æˆ– 4 ä¸ª bit ä½ã€æ—¶çš„ç¬¬ä¸€æƒ³æ³•â€”â€”å¦‚æœè¦è¡¥è¶³åˆ° 6 çš„å€æ•°ï¼Œä¸åº”è¯¥æ˜¯è¦å¡«å…… 1-5 ä¸ª bit ä½ä¹ˆï¼Ÿ è¦è§£ç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¾—çœ‹ base64 çš„å®šä¹‰ã€‚åœ¨ RFC4648 çš„ base64 å®šä¹‰ä¸­ï¼Œæœ‰å¦‚ä¸‹è¿™æ ·ä¸€æ®µè¯ï¼š The Base 64 encoding is designed to represent arbitrary sequences of octets in a form that allows the use of both upper- and lowercase letters but that need not be human readable. æ³¨æ„é‡ç‚¹ï¼šoctetsâ€”â€” å’Œ bytes åŒä¹‰ï¼Œè¡¨ç¤º 8 bits ä¸€ç»„çš„ä½åºåˆ—ã€‚è¿™è¡¨ç¤º base64 åªæ”¯æŒç¼–ç  bits æ•°ä¸º 8 çš„å€æ•°çš„äºŒè¿›åˆ¶å†…å®¹ï¼Œè€Œ $8x \\bmod 6$ çš„ç»“æœåªå¯èƒ½æ˜¯ 0/2/4 ä¸‰ç§æƒ…å†µã€‚ å› æ­¤åªéœ€è¦å¡«å…… 2 æˆ– 4 ä¸ª bit ä½ã€‚ è¿™æ ·çš„å‡è®¾ä¹Ÿå¹¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå› ä¸ºç°ä»£è®¡ç®—æœºéƒ½æ˜¯ç»Ÿä¸€ä½¿ç”¨ 8 bits(byte) ä¸ºæœ€å°çš„å¯è¯»å•ä½çš„ã€‚å³ä½¿æ˜¯ c è¯­è¨€çš„ã€Œä½åŸŸã€ä¹Ÿæ˜¯å¦‚æ­¤ã€‚å› ä¸º Byte(8 bits) ç°ä»£ CPU æ•°æ®è¯»å†™æ“ä½œçš„åŸºæœ¬å•ä½ï¼Œå­¦è¿‡æ±‡ç¼–çš„å¯¹è¿™ä¸ªåº”è¯¥éƒ½æœ‰äº›å°è±¡ã€‚ ä½ ä»”ç»†æƒ³æƒ³ï¼Œæ‰€æœ‰æ–‡ä»¶çš„æœ€å°è®¡é‡å•ä½ï¼Œæ˜¯ä¸æ˜¯éƒ½æ˜¯ byteï¼Ÿ ","date":"2020-05-31","objectID":"/posts/base64-encoding-is-not-unique/:2:0","series":null,"tags":["Base64","ç¼–ç "],"title":"Base64 ç¼–ç å¹¶ä¸å”¯ä¸€","uri":"/posts/base64-encoding-is-not-unique/#é—®é¢˜ä¸€ä¸ºä»€ä¹ˆåªéœ€è¦å¡«å……-2-æˆ–-4-ä¸ª-bit-ä½"},{"categories":["tech"],"content":" é—®é¢˜äºŒï¼šä¸ºä»€ä¹ˆç”¨ python æµ‹è¯•æ—¶å¯èƒ½éœ€è¦åœ¨ JWT signature çš„æœ«å°¾æ·»åŠ å¤šä¸ª =ï¼Œè€Œ JWT ä¸­ä¸éœ€è¦ï¼Ÿå‰é¢å·²ç»è®²è¿‡ï¼Œbase64 çš„ç¼–ç æ­¥éª¤æ˜¯æ˜¯å°†å­—èŠ‚(byte, 8 bits)åºåˆ—ï¼Œä»å·¦å¾€å³æ¯ 6 ä¸ª bits è½¬æ¢æˆä¸€ä¸ªå¯æ‰“å°å­—ç¬¦ã€‚ æŸ¥é˜… RFC4648 ç¬¬ 4 å°èŠ‚ä¸­ base64 çš„å®šä¹‰ï¼Œèƒ½çœ‹åˆ°å®ƒå®é™…ä¸Šæ˜¯æ¯æ¬¡å¤„ç† 24 bitsï¼Œå› ä¸ºè¿™æ˜¯ 6 å’Œ 8 çš„æœ€å°å…¬å€æ•°ï¼Œå¯ä»¥åˆšå¥½ç”¨ 4 ä¸ªå­—ç¬¦è¡¨ç¤ºã€‚ åœ¨è¢«å¤„ç†çš„å­—èŠ‚åºåˆ—çš„æ¯”ç‰¹(bits)æ•°ä¸æ˜¯ 24 çš„æ•´æ•°æ—¶ï¼Œå°±éœ€è¦åœ¨åºåˆ—æœ«å°¾å¡«å…… 0 ä½¿æœ«å°¾çš„ bits æ•°æ˜¯ 6 çš„å€æ•°(6-bit groups)ã€‚æœ‰å¯èƒ½ä¼šå‡ºç°ä¸‰ç§æƒ…å†µï¼š è¢«å¤„ç†çš„å­—èŠ‚åºåˆ— S çš„æ¯”ç‰¹æ•°åˆšå¥½æ˜¯ 24 çš„å€æ•°ï¼šä¸éœ€è¦è¡¥æ¯”ç‰¹ä½ï¼Œæœ«å°¾ä¹Ÿå°±ä¸éœ€è¦åŠ  = S çš„æ¯”ç‰¹æ•°æ˜¯ $24x+8$: æœ«å°¾éœ€è¦è¡¥ 4 ä¸ª bitsï¼Œè¿™æ ·æœ«å°¾å‰©ä½™çš„ bits æ‰æ˜¯ 6-bit groupsï¼Œæ‰èƒ½ç¼–ç æˆ base64ã€‚ç„¶åæ·»åŠ ä¸¤ä¸ª == ä½¿ç¼–ç åçš„å­—ç¬¦æ•°ä¸º 4 çš„å€æ•°ã€‚ S çš„æ¯”ç‰¹æ•°ä¸º $24x+16$ï¼šæœ«å°¾éœ€è¦æ·»åŠ  2 ä¸ª bits æ‰èƒ½ç¼–ç æˆ base64ã€‚ç„¶åæ·»åŠ ä¸€ä¸ª = ä½¿ç¼–ç åçš„å­—ç¬¦æ•°ä¸º 4 çš„å€æ•°ã€‚ å…¶å®å¯ä»¥çœ‹åˆ°ï¼Œæ·»åŠ  = çš„ç›®çš„åªæ˜¯ä¸ºäº†ä½¿ç¼–ç åçš„å­—ç¬¦æ•°ä¸º 4 çš„å€æ•°è€Œå·²ï¼Œ= è¿™ä¸ª padding å…¶å®æ˜¯å†—ä½™ä¿¡æ¯ï¼Œå®Œå…¨å¯ä»¥å»æ‰ã€‚ åœ¨è§£ç å®Œæˆåï¼Œåº”ç”¨ç¨‹åºä¼šè‡ªåŠ¨å»é™¤æ‰æœ«å°¾è¿™ä¸è¶³ 1 byte çš„ 2 æˆ– 4 ä¸ªå¡«å……ä½ã€‚ å› æ­¤ JWT å°±å»æ‰äº†å®ƒä»¥å‡å°‘ä¼ è¾“çš„æ•°æ®é‡ã€‚ å¯ä»¥ç”¨å‰é¢è®²åˆ°çš„ JWT signature è¿›è¡ŒéªŒè¯ï¼š python In [1]: import base64 In [2]: s = base64.b64decode(\"SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c==\") # len(s) * 8 å¾—åˆ° bits æ•° In [3]: len(s) * 8 % 24 Out[3]: 8 å¯ä»¥çœ‹åˆ°è¿™é‡Œçš„è¢«ç¼–ç å†…å®¹æ¯”ç‰¹æ•°ä¸º $24x+8$ï¼Œæ‰€ä»¥æœ«å°¾éœ€è¦æ·»åŠ ä¸¤ä¸ª == å·æ‰ç¬¦åˆ RFC4648 çš„å®šä¹‰ã€‚ ","date":"2020-05-31","objectID":"/posts/base64-encoding-is-not-unique/:3:0","series":null,"tags":["Base64","ç¼–ç "],"title":"Base64 ç¼–ç å¹¶ä¸å”¯ä¸€","uri":"/posts/base64-encoding-is-not-unique/#é—®é¢˜äºŒä¸ºä»€ä¹ˆç”¨-python-æµ‹è¯•æ—¶å¯èƒ½éœ€è¦åœ¨-jwt-signature-çš„æœ«å°¾æ·»åŠ å¤šä¸ª-è€Œ-jwt-ä¸­ä¸éœ€è¦"},{"categories":["tech"],"content":" å‚è€ƒ Remove trailing ã€Œ=ã€ when base64 encoding RFC4648 - base64 å®šä¹‰ Difference between RFC 3548 and RFC 4648 Base64 éšå†™åŸç†å’Œæå–è„šæœ¬ ","date":"2020-05-31","objectID":"/posts/base64-encoding-is-not-unique/:4:0","series":null,"tags":["Base64","ç¼–ç "],"title":"Base64 ç¼–ç å¹¶ä¸å”¯ä¸€","uri":"/posts/base64-encoding-is-not-unique/#å‚è€ƒ"},{"categories":["tech"],"content":" æŠ“åŒ…åˆ†ææŠ“åŒ…åˆ†æå·¥å…·ä¸»è¦æœ‰ä¸¤ç§ï¼š http/https ç½‘ç»œä»£ç†å·¥å…·ï¼šmitmproxy/fiddler éƒ½å±äºè¿™ä¸€ç±»ï¼Œç”¨äºåˆ†æ http éå¸¸æ–¹ä¾¿ã€‚ä½†æ˜¯åªæ”¯æŒ http/httpsï¼Œæœ‰å±€é™æ€§ã€‚ tcp/udp/icmp ç­‰ç½‘ç»œå—…æ¢å·¥å…·ï¼štcpdump/tshark éƒ½å±äºè¿™ä¸€ç±»ï¼Œç½‘ç»œæ•…éšœåˆ†æç­‰åœºæ™¯å¸¸ç”¨ã€‚ è¿™é‡Œä¸»è¦ä»‹ç»å¦‚ä½•ä½¿ç”¨ tcpdump + wireshark è¿›è¡Œè¿œç¨‹å®æ—¶æŠ“åŒ…åˆ†æã€‚è€Œ mitmproxy æŠ“åŒ…å’Œ wireshark æœ¬åœ°æŠ“åŒ…éƒ½ç›¸å½“ç®€å•ï¼Œå°±ä¸ä»‹ç»äº†ã€‚ P.S. tshark æ˜¯ wireshark çš„å‘½ä»¤è¡Œç‰ˆæœ¬ï¼Œç”¨æ³• tcpdump éå¸¸ç›¸ä¼¼ã€‚ ","date":"2020-05-28","objectID":"/posts/tcpdump-and-wireshark/:0:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["ç½‘ç»œ","Wireshark","tcpdump","æŠ“åŒ…åˆ†æ"],"title":"ä½¿ç”¨ tcpdump å’Œ Wireshark è¿›è¡Œè¿œç¨‹å®æ—¶æŠ“åŒ…åˆ†æ","uri":"/posts/tcpdump-and-wireshark/#æŠ“åŒ…åˆ†æ"},{"categories":["tech"],"content":" ä¸€ã€wireshark çš„åŸºæœ¬ç”¨æ³•WireShark çš„ UI ç•Œé¢å¦‚ä½•ä½¿ç”¨ï¼Œç½‘ä¸Šèƒ½æœå¾—åˆ°å„ç§ç±»å‹çš„ wireshark æ¼”ç¤ºï¼Œå¤šçœ‹å‡ ç¯‡åšå®¢å°±ä¼šäº†ã€‚æœç´¢ [xxx åè®® wireshark æŠ“åŒ…åˆ†æ] å°±èƒ½æ‰¾åˆ°å„ç§å„æ ·çš„æ¼”ç¤ºï¼Œæ¯”å¦‚ ã€ŒgRPC åè®® wireshark æŠ“åŒ…åˆ†æã€ ã€ŒWebSocket åè®® wireshark æŠ“åŒ…åˆ†æã€ ã€ŒTCP åè®® wireshark æŠ“åŒ…åˆ†æã€ ç­‰ç­‰ ä¸»è¦éœ€è¦ä»‹ç»çš„ï¼Œåº”è¯¥æ˜¯ wireshark çš„æ•°æ®åŒ…è¿‡æ»¤å™¨ã€‚wireshark ä¸­æœ‰ä¸¤ç§åŒ…è¿‡æ»¤å™¨ï¼š æ•è·è¿‡æ»¤å™¨ï¼šåœ¨æŠ“åŒ…çš„æ—¶å€™ä½¿ç”¨å®ƒå¯¹æ•°æ®åŒ…è¿›è¡Œè¿‡æ»¤ã€‚ æ˜¾ç¤ºè¿‡æ»¤å™¨ï¼šå¯¹æŠ“åˆ°çš„æ‰€æœ‰æ•°æ®åŒ…è¿›è¡Œè¿‡æ»¤ã€‚ æ˜¾ç¤ºè¿‡æ»¤å™¨æ˜¯æœ€æœ‰ç”¨çš„ï¼Œä¸‹é¢ç®€è¦ä»‹ç»ä¸‹æ˜¾ç¤ºè¿‡æ»¤å™¨çš„è¯­æ³•ã€‚ å¯ä»¥ç›´æ¥é€šè¿‡ã€Œåè®®åç§°ã€è¿›è¡Œè¿‡æ»¤ï¼š text # åªçœ‹ tcp æµé‡ tcp # åªçœ‹ http æµé‡ http # ä½¿ç”¨æ„Ÿå¹å·ï¼ˆæˆ– notï¼‰è¿›è¡Œåå‘è¿‡æ»¤ !arp # è¿‡æ»¤æ‰æ‰€æœ‰ arp æ•°æ®åŒ… ä¹Ÿå¯ä»¥é€šè¿‡ã€Œåè®®åç§°.åè®®å±æ€§ã€å’Œã€Œæ¯”è¾ƒæ“ä½œç¬¦ï¼ˆæ¯”å¦‚ ==ï¼‰ã€è¿›è¡Œæ›´ç²¾ç¡®çš„è¿‡æ»¤ï¼š text # é€šè¿‡ ip çš„æºåœ°å€ src æˆ– dst è¿›è¡Œè¿‡æ»¤ ip.src==192.168.1.33 # é€šè¿‡ IP åœ°å€ï¼ˆip.addrï¼‰è¿›è¡Œè¿‡æ»¤ï¼ˆåŒ¹é… ip.src æˆ– ip.dstï¼‰ ip.addr==192.168.0.5 # ä¸Šä¸€æ¡è¿‡æ»¤è¡¨è¾¾å¼ç­‰ä»·äºï¼š ip.src==192.168.0.5 or ip.dst==192.168.0.5 # é€šè¿‡ tcp ç«¯å£å·è¿›è¡Œè¿‡æ»¤ tcp.port==80 tcp.port\u003e4000 # é€šè¿‡ http çš„ host å±æ€§è¿›è¡Œè¿‡æ»¤ http.host != \"xxx.baidu.com\" # é€šè¿‡ http.referer å±æ€§è¿›è¡Œè¿‡æ»¤ http.referer == \"xxx.baidu.com\" # å¤šä¸ªè¿‡æ»¤å™¨ä¹‹é—´ç”¨ andã€or è¿›è¡Œç»„åˆ http.host != \"xxx.baidu.com\" and http.referer == \"xxx.baidu.com\" ","date":"2020-05-28","objectID":"/posts/tcpdump-and-wireshark/:1:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["ç½‘ç»œ","Wireshark","tcpdump","æŠ“åŒ…åˆ†æ"],"title":"ä½¿ç”¨ tcpdump å’Œ Wireshark è¿›è¡Œè¿œç¨‹å®æ—¶æŠ“åŒ…åˆ†æ","uri":"/posts/tcpdump-and-wireshark/#ä¸€wireshark-çš„åŸºæœ¬ç”¨æ³•"},{"categories":["tech"],"content":" äºŒã€tcpdump + ssh + wireshark è¿œç¨‹å®æ—¶æŠ“åŒ…åœ¨è¿›è¡Œè¿œç¨‹ç½‘ç»œæŠ“åŒ…åˆ†ææ—¶ï¼Œæˆ‘ä»¬é€šå¸¸çš„åšæ³•æ˜¯ï¼Œé¦–å…ˆä½¿ç”¨å¦‚ä¸‹å‘½ä»¤åœ¨è¿œç¨‹ä¸»æœºä¸ŠæŠ“åŒ…ï¼Œä¿å­˜ä¸º pcap æ ¼å¼çš„æ–‡ä»¶ï¼š shell tcpdump -i eth0 -w temp.pcap # å½“ç„¶ä½ ä¹Ÿå¯ä»¥åœ¨æŠ“åŒ…é˜¶æ®µå°±åŠ ä¸€äº›è¿‡æ»¤æ¡ä»¶ï¼Œé™ä½æŠ“åˆ°çš„æ•°æ®é‡ä¸å·¥ä½œè´Ÿè½½ # å…·ä½“çš„å‘½ä»¤è¡Œè¿‡æ»¤æ¡ä»¶åœ¨åé¢çš„ç¬¬ä¸‰èŠ‚æœ‰è®²ï¼Œè¿™é‡Œä»…ç®€å•ä¸¾ä¾‹ # å—…æ¢ eth0 æ¥å£ï¼Œ src/dst ip åœ°å€ä¸º x.x.x.x/a.a.a.a çš„æ‰€æœ‰ tcp æ•°æ®åŒ… tcpdump -i eth0 -w temp.pcap 'tcp and (host x.x.x.x or host a.a.a.a)' ç„¶åå†å°† pcap æ–‡ä»¶æ‹·è´åˆ°æœ¬åœ°ï¼Œä½¿ç”¨ wireshark å¯¹å…¶è¿›è¡Œåˆ†æã€‚ ä½†æ˜¯è¿™æ ·åšæ²¡æœ‰æ—¶æ•ˆæ€§ï¼Œè€Œä¸”æ•°æ®æ‹·è´æ¥å»ä¹Ÿæ¯”è¾ƒéº»çƒ¦ã€‚ è€ƒè™‘ä½¿ç”¨æµçš„æ–¹å¼ï¼Œåœ¨è¿œç¨‹ä¸»æœºä¸Šä½¿ç”¨ tcpdump æŠ“åŒ…ï¼Œæœ¬åœ°ä½¿ç”¨ wireshark è¿›è¡Œå®æ—¶åˆ†æã€‚ ä½¿ç”¨ ssh åè®®è¿›è¡Œæµå¼ä¼ è¾“çš„ç¤ºä¾‹å¦‚ä¸‹ï¼š shell # eth0 æ›´æ¢æˆä½ çš„æœºå™¨ interface åç§°ï¼Œè™šæ‹Ÿæœºå¯èƒ½æ˜¯ ens33 ssh root@some.host \"tcpdump -i eth0 -l -w -\" | wireshark -k -i - # æ·»åŠ ä¸€äº› tcpdump è¿‡æ»¤æ¡ä»¶è¿›è¡Œç²¾ç¡®è¿‡æ»¤ï¼Œè¿™ä¹Ÿèƒ½é¿å…æ•°æ®é‡è¿‡å¤§ ssh root@some.host \"tcpdump -i eth0 -l -w - 'tcp and (host x.x.x.x or host a.a.a.a)'\" | wireshark -k -i - åœ¨ä¸æ–¹ä¾¿ä½¿ç”¨ ssh åè®®çš„æƒ…å†µä¸‹ï¼ˆæ¯”å¦‚å®¹å™¨æŠ“åŒ…ã€Android æŠ“åŒ…ï¼‰ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ nc(netcat) è¿›è¡Œæ•°æ®æµçš„è½¬å‘ï¼š shell # 1. è¿œç¨‹ä¸»æœºæŠ“åŒ…ï¼šå°†æ•°æ®æµé€šè¿‡ 11111 ç«¯å£æš´éœ²å‡ºå» tcpdump -i wlan0 -s0 -w - | nc -l -p 11111 # 2. æœ¬åœ°ä¸»æœºä»è¿œç¨‹ä¸»æœºçš„ 11111 ç«¯å£è¯»å–æ•°æ®ï¼Œæä¾›ç»™ wireshark nc \u003cremote-host\u003e 11111 | wireshark -k -S -i - å¦‚æœæ˜¯æŠ“å– Android æ‰‹æœºçš„æ•°æ®ï¼Œæ–¹ä¾¿èµ·è§ï¼Œå¯ä»¥é€šè¿‡ adb å¤šè¿›è¡Œä¸€æ¬¡æ•°æ®è½¬å‘ï¼š shell # æ–¹æ¡ˆä¸€ï¼šroot æ‰‹æœºåï¼Œå°† arm ç‰ˆçš„ tcpdump æ‹·è´åˆ°æ‰‹æœºå†…è¿›è¡ŒæŠ“åŒ… # 1. åœ¨ adb shell é‡Œä½¿ç”¨ tcpdump æŠ“ WiFi çš„æ•°æ®åŒ…ï¼Œè½¬å‘åˆ° 11111 ç«¯å£ ## éœ€è¦å…ˆè·å–åˆ° root æƒé™ï¼Œå°† tcpdump æ‹·è´åˆ° /system/bin/ ç›®å½•ä¸‹ tcpdump -i wlan0 -s0 -w - | nc -l -p 11111 # 2. åœ¨æœ¬æœºä½¿ç”¨ adb forward å°†æ‰‹æœºçš„ 11111 ç«¯å£ç»‘å®šåˆ°æœ¬æœº(PC)çš„ 11111 ç«¯å£ adb forward tcp:11111 tcp:11111 # 3. ç›´æ¥ä»æœ¬æœº(PC)çš„ 11111 ç«¯å£è¯»å–æ•°æ®ï¼Œæä¾›ç»™ wireshark nc localhost 11111 | wireshark -k -S -i - ## é€šè¿‡æ•°æ®è½¬å‘ï¼Œæœ¬æœº 11111 ç«¯å£çš„æ•°æ®ï¼Œå°±æ˜¯å®‰å“æ‰‹æœºå†… tcmpdump çš„ stdout å†…å®¹ã€‚ # æ–¹æ¡ˆäºŒï¼š # å¦‚æœæ‰‹æœºä¸æ–¹ä¾¿ rootï¼Œæ¨è PC å¼€å¯ WiFi çƒ­ç‚¹ï¼Œæ‰‹æœºè¿ä¸Šè¿™ä¸ªçƒ­ç‚¹è®¿é—®ç½‘ç»œã€‚ # è¿™æ ·æ‰‹æœºçš„æ•°æ®å°±ä¸€å®šä¼šèµ° PCï¼Œç›´æ¥åœ¨ PC ä¸Šé€šè¿‡ wireshark æŠ“åŒ…å°±è¡Œã€‚ # å¦‚æœä½ åªéœ€è¦ç®€å•åœ°æŠ“ http/https åŒ…ï¼Œè¯·ä½¿ç”¨ fiddler/mitmproxy å¦‚æœéœ€è¦å¯¹ Kubernetes é›†ç¾¤ä¸­çš„å®¹å™¨è¿›è¡ŒæŠ“åŒ…ï¼Œæ¨èç›´æ¥ä½¿ç”¨ksniff! ","date":"2020-05-28","objectID":"/posts/tcpdump-and-wireshark/:2:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["ç½‘ç»œ","Wireshark","tcpdump","æŠ“åŒ…åˆ†æ"],"title":"ä½¿ç”¨ tcpdump å’Œ Wireshark è¿›è¡Œè¿œç¨‹å®æ—¶æŠ“åŒ…åˆ†æ","uri":"/posts/tcpdump-and-wireshark/#äºŒtcpdump--ssh--wireshark-è¿œç¨‹å®æ—¶æŠ“åŒ…"},{"categories":["tech"],"content":" Windows ç³»ç»Ÿå¦å¤–å¦‚æœä½ æœ¬æœºæ˜¯ Windows ç³»ç»Ÿï¼Œè¦åˆ† shell è®¨è®ºï¼š cmd: å¯ä»¥ç›´æ¥ä½¿ç”¨ä¸Šè¿°å‘½ä»¤ã€‚ powershell: PowerShell ç®¡é“å¯¹ native commands çš„æ”¯æŒä¸æ˜¯å¾ˆå¥½ï¼Œç®¡é“ä¸¤è¾¹çš„å‘½ä»¤è²Œä¼¼æ˜¯ä¸²è¡Œæ‰§è¡Œçš„ï¼Œè¿™ä¼šå¯¼è‡´ wireshark æ— æ³•å¯åŠ¨ï¼ç›®å‰æ²¡æœ‰æ‰¾åˆ°å¥½çš„è§£å†³æ–¹æ³•ã€‚ã€‚ å¦å¤–å¦‚æœä½ ä½¿ç”¨ wslï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤ä½¿ wsl è°ƒç”¨ windows ä¸­çš„ wireshark è¿›è¡ŒæŠ“åŒ…åˆ†æï¼š shell # æ·»åŠ è½¯é“¾æ¥ sudo ln -s \"$(which wireshark.exe)\" /usr/local/bin/wireshark æ·»åŠ äº†ä¸Šè¿°è½¯é“¾æ¥åï¼Œå°±å¯ä»¥æ­£å¸¸åœ°åœ¨ wsl ä¸­ä½¿ç”¨å‰é¢ä»‹ç»çš„æ‰€æœ‰æŠ“åŒ…æŒ‡ä»¤äº†ï¼ˆåŒ…æ‹¬ksniffï¼‰ã€‚å®ƒèƒ½æ­£å¸¸è°ƒç”¨ windows ä¸­çš„ wiresharkï¼Œæ•°æ®æµä¹Ÿèƒ½æ­£å¸¸åœ°é€šè¿‡ shell ç®¡é“ä¼ è¾“ã€‚ ","date":"2020-05-28","objectID":"/posts/tcpdump-and-wireshark/:2:1","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["ç½‘ç»œ","Wireshark","tcpdump","æŠ“åŒ…åˆ†æ"],"title":"ä½¿ç”¨ tcpdump å’Œ Wireshark è¿›è¡Œè¿œç¨‹å®æ—¶æŠ“åŒ…åˆ†æ","uri":"/posts/tcpdump-and-wireshark/#windows-ç³»ç»Ÿ"},{"categories":["tech"],"content":" ä¸‰ã€ç›´æ¥åœ¨å‘½ä»¤è¡ŒæŠ“åŒ…æ£€æŸ¥","date":"2020-05-28","objectID":"/posts/tcpdump-and-wireshark/:3:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["ç½‘ç»œ","Wireshark","tcpdump","æŠ“åŒ…åˆ†æ"],"title":"ä½¿ç”¨ tcpdump å’Œ Wireshark è¿›è¡Œè¿œç¨‹å®æ—¶æŠ“åŒ…åˆ†æ","uri":"/posts/tcpdump-and-wireshark/#ä¸‰ç›´æ¥åœ¨å‘½ä»¤è¡ŒæŠ“åŒ…æ£€æŸ¥"},{"categories":["tech"],"content":" termsharkå¯ä»¥ç›´æ¥ä½¿ç”¨å‘½ä»¤è¡Œ UI å·¥å…· termshark è¿›è¡Œå®æ—¶æŠ“åŒ…åˆ†æ æœ‰çš„æ—¶å€™ï¼Œè¿œç¨‹å®æ—¶æŠ“åŒ…å› ä¸ºæŸäº›åŸå› æ— æ³•å®ç°ï¼Œè€ŒæŠŠ pcap æ•°æ®æ‹·è´åˆ°æœ¬åœ°åˆ†æåˆæ¯”è¾ƒéº»çƒ¦ã€‚è¿™æ—¶ä½ å¯ä»¥è€ƒè™‘ç›´æ¥ä½¿ç”¨å‘½ä»¤è¡Œç‰ˆæœ¬çš„ wireshark UI:termsharkï¼Œç›´æ¥åœ¨å‘½ä»¤è¡Œè¿›è¡Œå®æ—¶çš„æŠ“åŒ…åˆ†æã€‚ å¯ä»¥ç›´æ¥ä½¿ç”¨ termshark æŠ“åŒ…æŸ¥çœ‹ï¼š shell termshark -i eth0 icmp ä¹Ÿå¯ä»¥ç”¨ termshark åˆ†æ pcap æ–‡ä»¶ï¼š shell termshark -r test.pcap kubectl-debug é»˜è®¤çš„è°ƒè¯•é•œåƒä¸­ï¼Œå°±è‡ªå¸¦termshark. ","date":"2020-05-28","objectID":"/posts/tcpdump-and-wireshark/:3:1","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["ç½‘ç»œ","Wireshark","tcpdump","æŠ“åŒ…åˆ†æ"],"title":"ä½¿ç”¨ tcpdump å’Œ Wireshark è¿›è¡Œè¿œç¨‹å®æ—¶æŠ“åŒ…åˆ†æ","uri":"/posts/tcpdump-and-wireshark/#termshark"},{"categories":["tech"],"content":" tcpdumpä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ tcpdump å°†æŠ“åˆ°çš„æ•°æ®æ‰“å°åˆ° stdout æŸ¥çœ‹ï¼Œè¿™ç§æ–¹æ³•æ¯”è¾ƒé€‚åˆåœ¨å‘½ä»¤è¡Œä¸­ä¸´æ—¶æŠ“äº›æ˜æ–‡æ•°æ®çœ‹çœ‹ã€‚ å…ˆç®€å•ä»‹ç»ä¸‹ tcpdump çš„å‘½ä»¤è¡Œå‚æ•°ï¼ˆå¯é€šè¿‡ man tcpdump æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£ï¼‰ï¼š text -A ä»¥ ASCII å­—ç¬¦æ–¹å¼æ‰“å°æ‰€æœ‰æŠ“åˆ°çš„æ•°æ®å†…å®¹ï¼Œåœ¨æŠ“å–çº¯æ–‡æœ¬æ•°æ®æ—¶å¾ˆå¥½ç”¨ -i interface ä»…æŠ“å–æŸä¸ªç‰¹å®šç½‘ç»œæ¥å£ä¸Šçš„æ•°æ®åŒ…ï¼Œç‰¹æ®Šå‚æ•° `all` è¡¨ç¤ºæ‰€æœ‰æ¥å£ -s snaplen è®¾ç½®æ¯ä¸ªåŒ…çš„æœ€å¤§é•¿åº¦ï¼Œé»˜è®¤ä¸º 262144 bytesã€‚åœ¨è¾ƒè€ç‰ˆæœ¬çš„ tcpdump ä¸­ -s 0 å³è¡¨ç¤ºä½¿ç”¨é»˜è®¤çš„åŒ…é•¿åº¦ --snapshot-length=snaplen å¸¸ç”¨å‘½ä»¤å¦‚ä¸‹ï¼š æ³¨æ„ tcpdump åœ¨ç›´æ¥æ‰“å°æ•°æ®æ—¶ï¼Œæœ‰å¯èƒ½ä¼šå‘ç°è¾ƒé•¿çš„æ•°æ®å°¾éƒ¨ä¼šè¢«æˆªæ–­ï¼Œä¸¢å¤±ä¿¡æ¯ã€‚è¿™æ˜¯ tcpdump æœ¬èº«çš„é—®é¢˜ï¼Œåœ¨è¿™ç§æ¨¡å¼ä¸‹ tcpdump æ˜¯é’ˆå¯¹æ¯ä¸ª tcp æ•°æ®åŒ…åº”ç”¨ http è¿‡æ»¤å‚æ•°ï¼Œè€Œè¿‡é•¿çš„ body ååŠéƒ¨åˆ†åœ¨å¦ä¸€ä¸ª tcp åŒ…é‡Œï¼Œå°±è¿‡æ»¤ä¸å‡ºæ¥äº†ã€‚å¦‚æœæœ‰å¿…è¦æŠ“è¿™ç±» body å¾ˆå¤§çš„æ•°æ®çš„è¯ï¼Œå»ºè®®ç»“åˆ wireshark åˆ†æã€‚ shell # 1. å—…æ¢æ‰€æœ‰æ¥å£ï¼Œ80 ç«¯å£ä¸Šæ‰€æœ‰ HTTP åè®®è¯·æ±‚ä¸å“åº”çš„ headers ä»¥åŠ body tcpdump -A -s 0 'tcp port 80 and (((ip[2:2] - ((ip[0]\u00260xf)\u003c\u003c2)) - ((tcp[12]\u00260xf0)\u003e\u003e2)) != 0)' ## æ”¹æŠ“ 8080 ç«¯å£ tcpdump -A -s 0 'tcp port 8080 and (((ip[2:2] - ((ip[0]\u00260xf)\u003c\u003c2)) - ((tcp[12]\u00260xf0)\u003e\u003e2)) != 0)' # 2. å—…æ¢ eth0 æ¥å£ï¼Œ80 ç«¯å£ä¸Šæ‰€æœ‰ HTTP GET è¯·æ±‚ï¼ˆ'GET ' =\u003e 0x47455420ï¼‰ tcpdump -A -i eth0 -s 0 'tcp port 80 and tcp[((tcp[12:1] \u0026 0xf0) \u003e\u003e 2):4] = 0x47455420' ## æ”¹æŠ“ 8080 ç«¯å£ tcpdump -A -i eth0 -s 0 'tcp port 8080 and tcp[((tcp[12:1] \u0026 0xf0) \u003e\u003e 2):4] = 0x47455420' # 3. å—…æ¢ eth0 æ¥å£ï¼Œ80 ç«¯å£ä¸Šæ‰€æœ‰ HTTP POST è¯·æ±‚ï¼ˆ'POST' =\u003e 0x504F5354ï¼‰ tcpdump -A -i eth0 -s 0 'tcp port 80 and tcp[((tcp[12:1] \u0026 0xf0) \u003e\u003e 2):4] = 0x504F5354' ## æ”¹æŠ“ 8080 ç«¯å£ tcpdump -A -i eth0 -s 0 'tcp port 8080 and tcp[((tcp[12:1] \u0026 0xf0) \u003e\u003e 2):4] = 0x504F5354' # 4. ä¹Ÿå¯ä»¥ä½¿ç”¨ not è¿›è¡Œå‚æ•°æ’é™¤ï¼Œæ¯”å¦‚æ’é™¤æ‰ 9091 è·Ÿ 2379 ç«¯å£ tcpdump -A -s 0 'tcp and port not 9091 and port not 2379 and (((ip[2:2] - ((ip[0]\u00260xf)\u003c\u003c2)) - ((tcp[12]\u00260xf0)\u003e\u003e2)) != 0)' # 5. å—…æ¢ eth0 æ¥å£ï¼Œ src/dst ip åœ°å€ä¸º x.x.x.x/a.a.a.a çš„æ‰€æœ‰ tcp æ•°æ®åŒ… tcpdump -A -i eth0 -s 0 'tcp and (host x.x.x.x or host a.a.a.a)' # 6. é€šè¿‡ ip + port ç»„åˆè¿‡æ»¤ tcp æ•°æ®åŒ… tcpdump -A -i eth0 -s 0 'tcp and !(dst host 192.168.1.100 and dst port 1111) and !(dst host 192.168.1.101 and dst port 3333)' # 7. æ ¹æ® CIDR ç½‘æ®µè¿‡æ»¤ tcp æ•°æ®åŒ… tcpdump -A -i eth0 -s 0 'tcp and net 172.16.0.0/16' ","date":"2020-05-28","objectID":"/posts/tcpdump-and-wireshark/:3:2","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["ç½‘ç»œ","Wireshark","tcpdump","æŠ“åŒ…åˆ†æ"],"title":"ä½¿ç”¨ tcpdump å’Œ Wireshark è¿›è¡Œè¿œç¨‹å®æ—¶æŠ“åŒ…åˆ†æ","uri":"/posts/tcpdump-and-wireshark/#tcpdump"},{"categories":["tech"],"content":" å‚è€ƒ WireSharkä½¿ç”¨æ•™ç¨‹ Tracing network traffic using tcpdump and tshark Android remote sniffing using Tcpdump, nc and Wireshark èŠèŠtcpdumpä¸WiresharkæŠ“åŒ…åˆ†æ ","date":"2020-05-28","objectID":"/posts/tcpdump-and-wireshark/:4:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["ç½‘ç»œ","Wireshark","tcpdump","æŠ“åŒ…åˆ†æ"],"title":"ä½¿ç”¨ tcpdump å’Œ Wireshark è¿›è¡Œè¿œç¨‹å®æ—¶æŠ“åŒ…åˆ†æ","uri":"/posts/tcpdump-and-wireshark/#å‚è€ƒ"},{"categories":["tech"],"content":" æœ¬æ–‡åŸºäº Istio1.5 ç¼–å†™æµ‹è¯• Istio æ”¯æŒä½¿ç”¨ JWT å¯¹ç»ˆç«¯ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ï¼ˆIstio End User Authenticationï¼‰ï¼Œæ”¯æŒå¤šç§ JWT ç­¾åç®—æ³•ã€‚ ç›®å‰ä¸»æµçš„ JWT ç®—æ³•æ˜¯ RS256/ES256ã€‚ï¼ˆè¯·å¿½ç•¥ HS256ï¼Œè¯¥ç®—æ³•ä¸é€‚åˆåˆ†å¸ƒå¼ JWT éªŒè¯ï¼‰ è¿™é‡Œä»¥ RSA256 ç®—æ³•ä¸ºä¾‹è¿›è¡Œä»‹ç»ï¼ŒES256 çš„é…ç½®æ–¹å¼ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚ æ³¨æ„ï¼šIstio ä»…è´Ÿè´£èº«ä»½éªŒè¯ï¼Œç”¨æˆ·éœ€è¦é¦–å…ˆé€šè¿‡ä¸šåŠ¡å±‚çš„ç™»å½• API è·å¾— JWT ä¿¡æ¯ã€‚ ","date":"2020-04-06","objectID":"/posts/use-istio-for-jwt-auth/:0:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","Istio","æœåŠ¡ç½‘æ ¼"],"title":"ä½¿ç”¨ Istio è¿›è¡Œ JWT èº«ä»½éªŒè¯ï¼ˆå……å½“ API ç½‘å…³ï¼‰","uri":"/posts/use-istio-for-jwt-auth/#"},{"categories":["tech"],"content":" 1. ä»‹ç» JWK ä¸ JWKSIstio è¦æ±‚æä¾› JWKS æ ¼å¼çš„ä¿¡æ¯ï¼Œç”¨äº JWT ç­¾åéªŒè¯ã€‚å› æ­¤è¿™é‡Œå¾—å…ˆä»‹ç»ä¸€ä¸‹ JWK å’Œ JWKS. JWKS ï¼Œä¹Ÿå°±æ˜¯ JWK Setï¼Œjson ç»“æ„å¦‚ä¸‹ï¼š text { \"keys\": [ \u003cjwk-1\u003e, \u003cjwk-2\u003e, ... ]} JWKS æè¿°ä¸€ç»„ JWK å¯†é’¥ã€‚å®ƒèƒ½åŒæ—¶æè¿°å¤šä¸ªå¯ç”¨çš„å…¬é’¥ï¼Œåº”ç”¨åœºæ™¯ä¹‹ä¸€æ˜¯å¯†é’¥çš„ Rotate. è€Œ JWKï¼Œå…¨ç§°æ˜¯ Json Web Keyï¼Œå®ƒæè¿°äº†ä¸€ä¸ªåŠ å¯†å¯†é’¥ï¼ˆå…¬é’¥æˆ–ç§é’¥ï¼‰çš„å„é¡¹å±æ€§ï¼ŒåŒ…æ‹¬å¯†é’¥çš„å€¼ã€‚ Istio ä½¿ç”¨ JWK æè¿°éªŒè¯ JWT ç­¾åæ‰€éœ€è¦çš„ä¿¡æ¯ã€‚åœ¨ä½¿ç”¨ RSA ç­¾åç®—æ³•æ—¶ï¼ŒJWK æè¿°çš„åº”è¯¥æ˜¯ç”¨äºéªŒè¯çš„ RSA å…¬é’¥ã€‚ ä¸€ä¸ª RSA å…¬é’¥çš„ JWK æè¿°å¦‚ä¸‹ï¼š text { \"alg\": \"RS256\", # ç®—æ³•ã€Œå¯é€‰å‚æ•°ã€ \"kty\": \"RSA\", # å¯†é’¥ç±»å‹ \"use\": \"sig\", # è¢«ç”¨äºç­¾åã€Œå¯é€‰å‚æ•°ã€ \"kid\": \"NjVBRjY5MDlCMUIwNzU4RTA2QzZFMDQ4QzQ2MDAyQjVDNjk1RTM2Qg\", # key çš„å”¯ä¸€ id \"n\": \"yeNlzlub94YgerT030codqEztjfU_S6X4DbDA_iVKkjAWtYfPHDzz_sPCT1Axz6isZdf3lHpq_gYX4Sz-cbe4rjmigxUxr-FgKHQy3HeCdK6hNq9ASQvMK9LBOpXDNn7mei6RZWom4wo3CMvvsY1w8tjtfLb-yQwJPltHxShZq5-ihC9irpLI9xEBTgG12q5lGIFPhTl_7inA1PFK97LuSLnTJzW0bj096v_TMDg7pOWm_zHtF53qbVsI0e3v5nmdKXdFf9BjIARRfVrbxVxiZHjU6zL6jY5QJdh1QCmENoejj_ytspMmGW7yMRxzUqgxcAqOBpVm0b-_mW3HoBdjQ\", \"e\": \"AQAB\" } RSA æ˜¯åŸºäºå¤§æ•°åˆ†è§£çš„åŠ å¯†/ç­¾åç®—æ³•ï¼Œä¸Šè¿°å‚æ•°ä¸­ï¼Œe æ˜¯å…¬é’¥çš„æ¨¡æ•°(modulus)ï¼Œn æ˜¯å…¬é’¥çš„æŒ‡æ•° (exponent)ï¼Œä¸¤ä¸ªå‚æ•°éƒ½æ˜¯ base64 å­—ç¬¦ä¸²ã€‚ JWK ä¸­ RSA å…¬é’¥çš„å…·ä½“å®šä¹‰å‚è§RSA Keys - JSON Web Algorithms (JWA) ","date":"2020-04-06","objectID":"/posts/use-istio-for-jwt-auth/:0:1","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","Istio","æœåŠ¡ç½‘æ ¼"],"title":"ä½¿ç”¨ Istio è¿›è¡Œ JWT èº«ä»½éªŒè¯ï¼ˆå……å½“ API ç½‘å…³ï¼‰","uri":"/posts/use-istio-for-jwt-auth/#1-ä»‹ç»-jwk-ä¸-jwks"},{"categories":["tech"],"content":" 2. JWK çš„ç”Ÿæˆè¦ç”Ÿæˆ JWK å…¬é’¥ï¼Œéœ€è¦å…ˆç”Ÿæˆç§é’¥ï¼Œç”Ÿæˆæ–¹æ³•å‚è§JWT ç­¾åç®—æ³• HS256ã€RS256 åŠ ES256 åŠå¯†é’¥ç”Ÿæˆã€‚ å…¬é’¥ä¸éœ€è¦ç”¨ä¸Šè¿°æ–¹æ³•ç”Ÿæˆï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦çš„æ˜¯ JWK æ ¼å¼çš„å…¬é’¥ã€‚åé¢ä¼šé€šè¿‡ python ç”Ÿæˆå‡º JWK å…¬é’¥ã€‚ ä¸Šé¢çš„å‘½ä»¤ä¼šå°†ç”Ÿæˆå‡ºçš„ RSA ç§é’¥å†™å…¥ key.pem ä¸­ï¼ŒæŸ¥çœ‹ä¸€ä¸‹ç§é’¥å†…å®¹ã€‚ text ryan@RYAN-MI-DESKTOP:~/istio$ cat key.pem -----BEGIN RSA PRIVATE KEY----- MIIEpAIBAAKCAQEAt1cKkQqPh8iOv5BhKh7Rx6A2+1ldpO/jczML/0GBKu4X+lHr Y8YbJrt29jyAXlWM8vHC7tXsqgUG+WziRD0D8nhnh10XC14SeH+3mVuBqph+TqhX TWsh9gtAIbeUHJjEI4I79QK4/wquPHHIGZBQDQQnuMh6vAS3VaUYJdEIoKvUBnAy Y35kJZgyJSbrxLsEExL2zujUD/OY+/In2bq/3rFtDGNlgHyC7Gu2zXSXvfOA4O5m 9BBXOc7eEqj7PoOKNaTxLN3YcuRtgR6NIXL4KLb6oyvIzoeiprt4+9q7sc3Dnkc5 EV9kwWlEW2DHzhP6VYca0WXIIXc53U1AM3ewxwIDAQABAoIBABIKhaaqJF+XM7zU B0uuxrPfJynqrFVbqcUfQ9H1bzF7Rm7CeuhRiUBxeA5Y+8TMpFcPxT/dWzGL1xja RxWx715/zKg8V9Uth6HF55o2r/bKlLtGw3iBz1C34LKwrul1eu+HlEDS6MNoGKco BynE0qvFOedsCu/Pgv7xhQPLow60Ty1uM0AhbcPgi6yJ5ksRB1XjtEnW0t+c8yQS nU3mU8k230SdMhf4Ifud/5TPLjmXdFpyPi9uYiVdJ5oWsmMWEvekXoBnHWDDF/eT VkVMiTBorT4qn+Ax1VjHL2VOMO5ZbXEcpbIc3Uer7eZAaDQ0NPZK37IkIn9TiZ21 cqzgbCkCgYEA5enHZbD5JgfwSNWCaiNrcBhYjpCtvfbT82yGW+J4/Qe/H+bY/hmJ RRTKf0kVPdRwZzq7GphVMWIuezbOk0aFGhk/SzIveW8QpLY0FV/5xFnGNjV9AuNc xrmgVshUsyQvr1TFkbdkC6yuvNgQfXfnbEoaPsXYEMCii2zqdF5lWGUCgYEAzCR2 6g8vEQx0hdRS5d0zD2/9IRYNzfP5oK0+F3KHH2OuwlmQVIo7IhCiUgqserXNBDef hj+GNcU8O/yXLomAXG7VG/cLWRrpY8d9bcRMrwb0/SkNr0yNrkqHiWQ/PvR+2MLk viWFZTTp8YizPA+8pSC/oFd1jkZF0UhKVAREM7sCgYB5+mfxyczFopyW58ADM7uC g0goixXCnTuiAEfgY+0wwXVjJYSme0HaxscQdOOyJA1ml0BBQeShCKgEcvVyKY3g ZNixunR5hrVbzdcgKAVJaR/CDuq+J4ZHYKByqmJVkLND4EPZpWSM1Rb31eIZzw2W 5FG8UBbr/GfAdQ6GorY+CQKBgQCzWQHkBmz6VG/2t6AQ9LIMSP4hWEfOfh78q9dW MDdIO4JomtkzfLIQ7n49B8WalShGITwUbLDTgrG1neeQahsMmg6+X99nbD5JfBTV H9WjG8CWvb+ZF++NhUroSNtLyu+6LhdaeopkbQVvPwMArG62wDu6ebv8v/5MrG8o uwrUSwKBgQCxV43ZqTRnEuDlF7jMN+2JZWhpbrucTG5INoMPOC0ZVatePszZjYm8 LrmqQZHer2nqtFpyslwgKMWgmVLJTH7sVf0hS9po0+iSYY/r8e/c85UdUreb0xyT x8whrOnMMODCAqu4W/Rx1Lgf2vXIx0pZmlt8Df9i2AVg/ePR6jO3Nw== -----END RSA PRIVATE KEY----- æ¥ä¸‹æ¥é€šè¿‡ Python ç¼–ç¨‹ç”Ÿæˆ RSA Public Key å’Œ JWKï¼ˆjwk å…¶å®å°±æ˜¯å…¬é’¥çš„å¦ä¸€ä¸ªè¡¨è¿°å½¢å¼è€Œå·²ï¼‰: python # éœ€è¦å…ˆå®‰è£…ä¾èµ–: pip install jwcrypto from jwcrypto.jwk import JWK from pathlib import Path private_key = Path(\"key.pem\").read_bytes() jwk = JWK.from_pem(private_key) # å¯¼å‡ºå…¬é’¥ RSA Public Key public_key = jwk.public().export_to_pem() print(public_key) print(\"=\"*30) # å¯¼å‡º JWK jwk_bytes = jwk.public().export() print(jwk_bytes) Istio éœ€è¦ JWK è¿›è¡Œ JWT éªŒè¯ï¼Œè€Œæˆ‘ä»¬æ‰‹åŠ¨éªŒè¯ JWT æ—¶ä¸€èˆ¬éœ€è¦ç”¨åˆ° Public Key. æ–¹ä¾¿èµ·è§ï¼Œä¸Šè¿°ä»£ç æŠŠè¿™ä¸¤ä¸ªéƒ½æ‰“å°äº†å‡ºæ¥ã€‚å†…å®¹å¦‚ä¸‹ï¼š text # Public Key å†…å®¹ï¼Œä¸åŒ…å«è¿™è¡Œæ³¨é‡Š -----BEGIN PUBLIC KEY----- MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAt1cKkQqPh8iOv5BhKh7R x6A2+1ldpO/jczML/0GBKu4X+lHrY8YbJrt29jyAXlWM8vHC7tXsqgUG+WziRD0D 8nhnh10XC14SeH+3mVuBqph+TqhXTWsh9gtAIbeUHJjEI4I79QK4/wquPHHIGZBQ DQQnuMh6vAS3VaUYJdEIoKvUBnAyY35kJZgyJSbrxLsEExL2zujUD/OY+/In2bq/ 3rFtDGNlgHyC7Gu2zXSXvfOA4O5m9BBXOc7eEqj7PoOKNaTxLN3YcuRtgR6NIXL4 KLb6oyvIzoeiprt4+9q7sc3Dnkc5EV9kwWlEW2DHzhP6VYca0WXIIXc53U1AM3ew xwIDAQAB -----END PUBLIC KEY----- text # jwk å†…å®¹ { 'e': 'AQAB', 'kid': 'oyYwZSLCLVVPHdVp0jXIcLNpGn6dMCumlY-6wSenmFo', 'kty': 'RSA', 'n': 't1cKkQqPh8iOv5BhKh7Rx6A2-1ldpO_jczML_0GBKu4X-lHrY8YbJrt29jyAXlWM8vHC7tXsqgUG-WziRD0D8nhnh10XC14SeH-3mVuBqph-TqhXTWsh9gtAIbeUHJjEI4I79QK4_wquPHHIGZBQDQQnuMh6vAS3VaUYJdEIoKvUBnAyY35kJZgyJSbrxLsEExL2zujUD_OY-_In2bq_3rFtDGNlgHyC7Gu2zXSXvfOA4O5m9BBXOc7eEqj7PoOKNaTxLN3YcuRtgR6NIXL4KLb6oyvIzoeiprt4-9q7sc3Dnkc5EV9kwWlEW2DHzhP6VYca0WXIIXc53U1AM3ewxw' } ","date":"2020-04-06","objectID":"/posts/use-istio-for-jwt-auth/:0:2","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","Istio","æœåŠ¡ç½‘æ ¼"],"title":"ä½¿ç”¨ Istio è¿›è¡Œ JWT èº«ä»½éªŒè¯ï¼ˆå……å½“ API ç½‘å…³ï¼‰","uri":"/posts/use-istio-for-jwt-auth/#2-jwk-çš„ç”Ÿæˆ"},{"categories":["tech"],"content":" 4. æµ‹è¯•å¯†é’¥å¯ç”¨æ€§æ¥ä¸‹æ¥åœ¨ jwt.io ä¸­å¡«å…¥æµ‹è¯•ç”¨çš„å…¬é’¥ç§é’¥ï¼Œè¿˜æœ‰ Header/Payloadã€‚ä¸€æ˜¯æµ‹è¯•å…¬ç§é’¥çš„å¯ç”¨æ€§ï¼ŒäºŒæ˜¯ç”Ÿæˆå‡º JWT ä¾›åç»­æµ‹è¯• Istio JWT éªŒè¯åŠŸèƒ½çš„å¯ç”¨æ€§ã€‚ å¯ä»¥çœ‹åˆ°å·¦ä¸‹è§’æ˜¾ç¤ºã€ŒSignature Verifiedã€ï¼ŒæˆåŠŸåœ°ç”Ÿæˆå‡ºäº† JWTã€‚åç»­å¯ä»¥ä½¿ç”¨è¿™ä¸ª JWT è®¿é—® Istio ç½‘å…³ï¼Œæµ‹è¯• Istio JWT éªŒè¯åŠŸèƒ½ã€‚ ","date":"2020-04-06","objectID":"/posts/use-istio-for-jwt-auth/:0:3","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","Istio","æœåŠ¡ç½‘æ ¼"],"title":"ä½¿ç”¨ Istio è¿›è¡Œ JWT èº«ä»½éªŒè¯ï¼ˆå……å½“ API ç½‘å…³ï¼‰","uri":"/posts/use-istio-for-jwt-auth/#4-æµ‹è¯•å¯†é’¥å¯ç”¨æ€§"},{"categories":["tech"],"content":" 5. å¯ç”¨ Istio çš„èº«ä»½éªŒè¯ç¼–å†™ istio é…ç½®ï¼š yaml apiVersion: \"security.istio.io/v1beta1\" kind: \"RequestAuthentication\" metadata: name: \"jwt-example\" namespace: istio-system # istio-system åå­—ç©ºé—´ä¸­çš„é…ç½®ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šåº”ç”¨åˆ°æ‰€æœ‰åå­—ç©ºé—´ spec: selector: matchLabels: istio: ingressgateway # åœ¨å¸¦æœ‰è¿™äº› labels çš„ ingressgateway/sidecar ä¸Šç”Ÿæ•ˆ jwtRules: # issuer å³ç­¾å‘è€…ï¼Œéœ€è¦å’Œ JWT payload ä¸­çš„ iss å±æ€§å®Œå…¨ä¸€è‡´ã€‚ - issuer: \"testing@secure.istio.io\" jwks: | { \"keys\": [ { \"e\": \"AQAB\", \"kid\": \"oyYwZSLCLVVPHdVp0jXIcLNpGn6dMCumlY-6wSenmFo\", # kid éœ€è¦ä¸ jwt header ä¸­çš„ kid å®Œå…¨ä¸€è‡´ã€‚ \"kty\": \"RSA\", \"n\": \"t1cKkQqPh8iOv5BhKh7Rx6A2-1ldpO_jczML_0GBKu4X-lHrY8YbJrt29jyAXlWM8vHC7tXsqgUG-WziRD0D8nhnh10XC14SeH-3mVuBqph-TqhXTWsh9gtAIbeUHJjEI4I79QK4_wquPHHIGZBQDQQnuMh6vAS3VaUYJdEIoKvUBnAyY35kJZgyJSbrxLsEExL2zujUD_OY-_In2bq_3rFtDGNlgHyC7Gu2zXSXvfOA4O5m9BBXOc7eEqj7PoOKNaTxLN3YcuRtgR6NIXL4KLb6oyvIzoeiprt4-9q7sc3Dnkc5EV9kwWlEW2DHzhP6VYca0WXIIXc53U1AM3ewxw\" } ] } # jwks æˆ– jwksUri äºŒé€‰å…¶ä¸€ # jwksUri: \"http://nginx.test.local/istio/jwks.json\" ç°åœ¨ kubectl apply ä¸€ä¸‹ï¼ŒJWT éªŒè¯å°±æ·»åŠ åˆ°å…¨å±€äº†ã€‚ å¯ä»¥çœ‹åˆ° jwtRules æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œå› æ­¤å¯ä»¥ä¸ºæ¯ä¸ª issuers é…ç½®ä¸åŒçš„ jwtRule. å¯¹åŒä¸€ä¸ª issuersï¼ˆjwt ç­¾å‘è€…ï¼‰ï¼Œå¯ä»¥é€šè¿‡ jwks è®¾ç½®å¤šä¸ªå…¬é’¥ï¼Œä»¥å®ç°JWTç­¾åå¯†é’¥çš„è½®è½¬ã€‚JWT çš„éªŒè¯è§„åˆ™æ˜¯ï¼š JWT çš„ payload ä¸­æœ‰ issuer å±æ€§ï¼Œé¦–å…ˆé€šè¿‡ issuer åŒ¹é…åˆ°å¯¹åº”çš„ istio ä¸­é…ç½®çš„ jwksã€‚ JWT çš„ header ä¸­æœ‰ kid å±æ€§ï¼Œç¬¬äºŒæ­¥åœ¨ jwks çš„å…¬é’¥åˆ—è¡¨ä¸­ï¼Œä¸­æ‰¾åˆ° kid ç›¸åŒçš„å…¬é’¥ã€‚ ä½¿ç”¨æ‰¾åˆ°çš„å…¬é’¥è¿›è¡Œ JWT ç­¾åéªŒè¯ã€‚ é…ç½®ä¸­çš„ spec.selector å¯ä»¥çœç•¥ï¼Œè¿™æ ·ä¼šç›´æ¥åœ¨æ•´ä¸ª namespace ä¸­ç”Ÿæ•ˆï¼Œè€Œå¦‚æœæ˜¯åœ¨istio-system åå­—ç©ºé—´ï¼Œè¯¥é…ç½®å°†åœ¨å…¨é›†ç¾¤çš„æ‰€æœ‰ sidecar/ingressgateway ä¸Šç”Ÿæ•ˆï¼ ","date":"2020-04-06","objectID":"/posts/use-istio-for-jwt-auth/:0:4","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","Istio","æœåŠ¡ç½‘æ ¼"],"title":"ä½¿ç”¨ Istio è¿›è¡Œ JWT èº«ä»½éªŒè¯ï¼ˆå……å½“ API ç½‘å…³ï¼‰","uri":"/posts/use-istio-for-jwt-auth/#5-å¯ç”¨-istio-çš„èº«ä»½éªŒè¯"},{"categories":["tech"],"content":" 6. å¯ç”¨ Payload è½¬å‘/Authorization è½¬å‘é»˜è®¤æƒ…å†µä¸‹ï¼ŒIstio åœ¨å®Œæˆäº†èº«ä»½éªŒè¯ä¹‹åï¼Œä¼šå»æ‰ Authorization è¯·æ±‚å¤´å†è¿›è¡Œè½¬å‘ã€‚è¿™å°†å¯¼è‡´æˆ‘ä»¬çš„åç«¯æœåŠ¡è·å–ä¸åˆ°å¯¹åº”çš„ Payloadï¼Œæ— æ³•åˆ¤æ–­ End User çš„èº«ä»½ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦å¯ç”¨ Istio çš„ Authorization è¯·æ±‚å¤´çš„è½¬å‘åŠŸèƒ½ï¼Œåœ¨å‰è¿°çš„ RequestAuthentication yaml é…ç½®ä¸­æ·»åŠ ä¸€ä¸ªå‚æ•°å°±è¡Œï¼š yaml apiVersion: \"security.istio.io/v1beta1\" kind: \"RequestAuthentication\" metadata: name: \"jwt-example\" namespace: istio-system spec: selector: matchLabels: istio: ingressgateway jwtRules: - issuer: \"testing@secure.istio.io\" jwks: | { \"keys\": [ { \"e\": \"AQAB\", \"kid\": \"oyYwZSLCLVVPHdVp0jXIcLNpGn6dMCumlY-6wSenmFo\", \"kty\": \"RSA\", \"n\": \"t1cKkQqPh8iOv5BhKh7Rx6A2-1ldpO_jczML_0GBKu4X-lHrY8YbJrt29jyAXlWM8vHC7tXsqgUG-WziRD0D8nhnh10XC14SeH-3mVuBqph-TqhXTWsh9gtAIbeUHJjEI4I79QK4_wquPHHIGZBQDQQnuMh6vAS3VaUYJdEIoKvUBnAyY35kJZgyJSbrxLsEExL2zujUD_OY-_In2bq_3rFtDGNlgHyC7Gu2zXSXvfOA4O5m9BBXOc7eEqj7PoOKNaTxLN3YcuRtgR6NIXL4KLb6oyvIzoeiprt4-9q7sc3Dnkc5EV9kwWlEW2DHzhP6VYca0WXIIXc53U1AM3ewxw\" } ] } # ===================== æ·»åŠ å¦‚ä¸‹å‚æ•°=========================== forwardOriginalToken: true # è½¬å‘ Authorization è¯·æ±‚å¤´ åŠ äº†è½¬å‘åï¼Œæµç¨‹å›¾å¦‚ä¸‹ï¼ˆéœ€è¦ mermaid æ¸²æŸ“ï¼‰ï¼š sequenceDiagram; # autonumber participant User as ç”¨æˆ· participant Auth as æˆæƒæœåŠ¡ participant IG as IngressGateway participant SVC as æŸæœåŠ¡ User-\u003e\u003e+Auth: Login Auth-\u003e\u003eAuth: ç”¨ç§é’¥ç”Ÿæˆ JWT ç­¾å Auth--\u003e\u003e-User: è¿”å› JWT User-\u003e\u003e+IG: è¯·æ±‚ä¿¡æ¯ï¼ˆå¸¦ JWTï¼‰IG-\u003e\u003eIG: ç”¨å…¬é’¥éªŒè¯ JWT ç­¾å IG-\u003e\u003e-SVC: è¯·æ±‚ä¿¡æ¯ï¼ˆè½¬å‘ JWTï¼‰SVC--\u003e\u003eIG: è¿”å›ä¿¡æ¯ IG--\u003e\u003eUser: è¿”å›ä¿¡æ¯ ","date":"2020-04-06","objectID":"/posts/use-istio-for-jwt-auth/:0:5","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","Istio","æœåŠ¡ç½‘æ ¼"],"title":"ä½¿ç”¨ Istio è¿›è¡Œ JWT èº«ä»½éªŒè¯ï¼ˆå……å½“ API ç½‘å…³ï¼‰","uri":"/posts/use-istio-for-jwt-auth/#6-å¯ç”¨-payload-è½¬å‘authorization-è½¬å‘"},{"categories":["tech"],"content":" 7. è®¾å®šå¼ºåˆ¶è®¤è¯è§„åˆ™Istio çš„ JWT éªŒè¯è§„åˆ™ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šç›´æ¥å¿½ç•¥ä¸å¸¦ Authorization è¯·æ±‚å¤´ï¼ˆå³ JWTï¼‰çš„æµé‡ï¼Œå› æ­¤è¿™ç±»æµé‡èƒ½ç›´æ¥è¿›å…¥ç½‘æ ¼å†…éƒ¨ã€‚é€šå¸¸è¿™æ˜¯æ²¡é—®é¢˜çš„ï¼Œå› ä¸ºæ²¡æœ‰ Authorization çš„æµé‡å³ä½¿è¿›å…¥åˆ°å†…éƒ¨ï¼Œä¹Ÿä¼šå› ä¸ºæ— æ³•é€šè¿‡ payload åˆ¤åˆ«èº«ä»½è€Œè¢«æ‹’ç»æ“ä½œã€‚å¦‚æœéœ€è¦ç¦æ­¢ä¸å¸¦ JWT çš„æµé‡ï¼Œå°±éœ€è¦é¢å¤–é…ç½® AuthorizationPolicy ç­–ç•¥ã€‚ æ¯”å¦‚æ‹’ç»ä»»ä½• JWT æ— æ•ˆçš„è¯·æ±‚ï¼ˆåŒ…æ‹¬ Authorization çš„æƒ…å†µï¼‰ï¼š yaml apiVersion: security.istio.io/v1beta1 kind: AuthorizationPolicy metadata: name: \"deny-requests-with-out-authorization\" namespace: istio-system spec: selector: matchLabels: istio: ingressgateway action: DENY # æ‹’ç» rules: - from: - source: notRequestPrincipals: [\"*\"] # ä¸å­˜åœ¨ä»»ä½•è¯·æ±‚èº«ä»½ï¼ˆPrincipalï¼‰çš„ requests å¦‚æœä»…å¸Œæœ›å¼ºåˆ¶è¦æ±‚å¯¹éƒ¨åˆ† path çš„è¯·æ±‚å¿…é¡»å¸¦æœ‰ Authorization Headerï¼Œå¯ä»¥è¿™æ ·è®¾ç½®ï¼š yaml apiVersion: security.istio.io/v1beta1 kind: AuthorizationPolicy metadata: name: \"deny-requests-with-out-authorization\" namespace: istio-system spec: selector: matchLabels: istio: ingressgateway action: DENY # æ‹’ç» rules: - from: - source: notRequestPrincipals: [\"*\"] # ä¸å­˜åœ¨ä»»ä½•è¯·æ±‚èº«ä»½ï¼ˆPrincipalï¼‰çš„ requests # ä»…å¼ºåˆ¶è¦æ±‚å¦‚ä¸‹ host/path ç›¸å…³çš„è¯·æ±‚ï¼Œå¿…é¡»å¸¦ä¸Š JWT token to: - operation: hosts: [\"another-host.com\"] paths: [\"/headers\"] æ³¨æ„è¿™ä¸¤ä¸ª Istio CR è¿”å›çš„é”™è¯¯ç æ˜¯ä¸åŒçš„ï¼š RequestsAuthentication éªŒè¯å¤±è´¥çš„è¯·æ±‚ï¼ŒIstio ä¼šè¿”å› 401 çŠ¶æ€ç ã€‚ AuthorizationPolicy éªŒè¯å¤±è´¥çš„è¯·æ±‚ï¼ŒIstio ä¼šè¿”å› 403 çŠ¶æ€ç ã€‚ è¿™ä¼šå¯¼è‡´åœ¨ä½¿ç”¨ AuthorizationPolicy ç¦æ­¢äº†ä¸å¸¦ Authorization å¤´çš„æµé‡åï¼Œè¿™ç±»è¯·æ±‚ä¼šç›´æ¥è¢«è¿”å› 403ï¼Œåœ¨ä½¿ç”¨ RESTful API æ—¶ï¼Œè¿™ç§æƒ…å†µå¯èƒ½ä¼šé€ æˆé—®é¢˜ã€‚ ","date":"2020-04-06","objectID":"/posts/use-istio-for-jwt-auth/:0:6","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","Istio","æœåŠ¡ç½‘æ ¼"],"title":"ä½¿ç”¨ Istio è¿›è¡Œ JWT èº«ä»½éªŒè¯ï¼ˆå……å½“ API ç½‘å…³ï¼‰","uri":"/posts/use-istio-for-jwt-auth/#7-è®¾å®šå¼ºåˆ¶è®¤è¯è§„åˆ™"},{"categories":["tech"],"content":" 8. Response HeadersRequestsAuthentication ä¸æ”¯æŒè‡ªå®šä¹‰å“åº”å¤´ä¿¡æ¯ï¼Œè¿™å¯¼è‡´å¯¹äºå‰åç«¯åˆ†ç¦»çš„ Web API è€Œè¨€ï¼Œä¸€æ—¦ JWT å¤±æ•ˆï¼ŒIstio ä¼šç›´æ¥å°† 401 è¿”å›ç»™å‰ç«¯ Web é¡µé¢ã€‚å› ä¸ºå“åº”å¤´ä¸­ä¸åŒ…å«Access-Crontrol-Allow-Originï¼Œå“åº”å°†è¢«æµè§ˆå™¨æ‹¦æˆªï¼ è¿™å¯èƒ½éœ€è¦é€šè¿‡ EnvoyFilter è‡ªå®šä¹‰å“åº”å¤´ï¼Œæ·»åŠ è·¨åŸŸä¿¡æ¯ã€‚ ","date":"2020-04-06","objectID":"/posts/use-istio-for-jwt-auth/:0:7","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","Istio","æœåŠ¡ç½‘æ ¼"],"title":"ä½¿ç”¨ Istio è¿›è¡Œ JWT èº«ä»½éªŒè¯ï¼ˆå……å½“ API ç½‘å…³ï¼‰","uri":"/posts/use-istio-for-jwt-auth/#8-response-headers"},{"categories":["tech"],"content":" å‚è€ƒ JSON Web Key Set Properties - Auth0 JWK - RFC7517 Sample JWT and JWKS data for demo - Istio Security End User Authentication - Istio JWTRule - Istio jwt.io - åŠ¨æ€ç”Ÿæˆ jwt ","date":"2020-04-06","objectID":"/posts/use-istio-for-jwt-auth/:1:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes","Istio","æœåŠ¡ç½‘æ ¼"],"title":"ä½¿ç”¨ Istio è¿›è¡Œ JWT èº«ä»½éªŒè¯ï¼ˆå……å½“ API ç½‘å…³ï¼‰","uri":"/posts/use-istio-for-jwt-auth/#å‚è€ƒ"},{"categories":["tech"],"content":" ä¸ªäººç¬”è®°ï¼Œè§‚ç‚¹ä¸ä¸€å®šæ­£ç¡®. é€‚åˆå¯¹ Kubernetes æœ‰ä¸€å®šäº†è§£çš„åŒå­¦ã€‚ ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:0:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/#"},{"categories":["tech"],"content":" å‰è¨€æœ€è¿‘ä¸€ç›´åœ¨å­¦ä¹  Kubernetesï¼Œä½†æ˜¯æ‰‹å¤´æ²¡æœ‰ä¸ªè‡ªæœ‰åŸŸåï¼Œè¦æµ‹è¯• ingress å°±æ¯”è¾ƒéº»çƒ¦ï¼Œæ¯æ¬¡éƒ½æ˜¯æ‰‹åŠ¨æ”¹ hosts æ–‡ä»¶ã€‚ã€‚ ä»Šå¤©çªç„¶æƒ³åˆ°â€”â€”K8s å†…éƒ¨å°±æ˜¯ç”¨ DNS åšçš„æœåŠ¡å‘ç°ï¼Œæˆ‘ä¸ºå•¥ä¸è‡ªå·±å¼„ä¸€ä¸ª DNS æœåŠ¡å™¨å‘¢ï¼Ÿç„¶åæ‰€æœ‰èŠ‚ç‚¹çš„ DNS éƒ½é…æˆå®ƒï¼Œè¿™æ ·æœ‰éœ€è¦æ—¶ç›´æ¥æ”¹è¿™ä¸ª DNS æœåŠ¡å™¨çš„é…ç½®å°±è¡Œï¼Œ ä¸€åŠ³æ°¸é€¸ã€‚ æˆ‘é¦–å…ˆæƒ³åˆ°çš„æ˜¯ ç¾¤æ™–/Windows Server è‡ªå¸¦çš„é‚£ç§è‡ªå¸¦å›¾å½¢åŒ–ç•Œé¢çš„ DNS æœåŠ¡å™¨ï¼Œä½†æ˜¯è¿™ä¿©éƒ½æ˜¯å¹³å°ç‰¹å®šçš„ã€‚ ç½‘ä¸Šæœä¸€åœˆæ²¡æ‰¾åˆ°ç±»ä¼¼å¸¦ UI çš„ DNS å·¥å…·ï¼Œæœåˆ°çš„ powerdns/bind ç›¸æ¯” coredns ä¹Ÿæ²¡çœ‹å‡ºå•¥ä¼˜åŠ¿æ¥ï¼Œæ‰€ä»¥å†³å®šå°±ç”¨ CoreDNSï¼Œåˆšå¥½ç†Ÿæ‚‰ä¸€ä¸‹å®ƒçš„å…·ä½“ä½¿ç”¨ã€‚ ä¸è¿‡è®² CoreDNS å‰ï¼Œæˆ‘ä»¬è¿˜æ˜¯å…ˆæ¥ç†Ÿæ‚‰ä¸€ä¸‹ DNS çš„åŸºç¡€æ¦‚å¿µå§ã€‚ ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:1:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/#å‰è¨€"},{"categories":["tech"],"content":" ä¸€ã€DNS æ˜¯ä¸ªå•¥ï¼Ÿ æ²¡æœ‰å†™å¾—å¾ˆæ¸…æ¥šï¼Œä¸é€‚åˆåˆå­¦ã€‚å»ºè®®å…ˆé€šè¿‡åˆ«çš„èµ„æ–™ç†Ÿæ‚‰ä¸‹ DNS åŸºç¡€ã€‚ DNSï¼Œå³åŸŸåç³»ç»Ÿï¼ˆDomain Name Systemï¼‰ï¼Œæ˜¯ä¸€é¡¹è´Ÿè´£å°†ä¸€ä¸ª human readable çš„æ‰€è°“åŸŸåï¼Œè½¬æ¢æˆä¸€ä¸ª ip åœ°å€çš„åè®®ã€‚ è€ŒåŸŸåçš„å¥½å¤„ï¼Œæœ‰å¦‚ä¸‹å‡ é¡¹ï¼š åŸŸåå¯¹äººç±»æ›´å‹å¥½ï¼Œå¯è¯»çš„å­—ç¬¦ä¸²æ¯”ä¸€ä¸² ip æ•°å­—å¯å¥½è®°å¤šäº†ã€‚ ä¸€ä¸ªåŸŸåå¯ä»¥å¯¹åº”å¤šä¸ª ipï¼Œå¯å®ç°æ‰€è°“çš„è´Ÿè½½å‡è¡¡ã€‚ å¤šä¸ªåŸŸåå¯ä»¥å¯¹åº”åŒä¸€ä¸ª ipï¼Œä»¥ä¸åŒçš„åŸŸåè®¿é—®è¯¥ ipï¼Œèƒ½è®¿é—®ä¸åŒçš„åº”ç”¨ã€‚ï¼ˆé€šè¿‡ nginx åšä»£ç†å®ç°ï¼‰ DNS åè®®æ˜¯ä¸€ä¸ªåŸºäº UDP çš„åº”ç”¨å±‚åè®®ï¼Œå®ƒé»˜è®¤ä½¿ç”¨ 53 ç«¯å£è¿›è¡Œé€šä¿¡ã€‚åº”ç”¨ç¨‹åºé€šå¸¸å°† DNS è§£æå§”æ´¾ç»™æ“ä½œç³»ç»Ÿçš„ DNS Resolver æ¥æ‰§è¡Œï¼Œç¨‹åºå‘˜å¯¹å®ƒå‡ ä¹æ— æ„ŸçŸ¥ã€‚ DNS è™½ç„¶è¯´ä¸€èˆ¬åªç”¨æ¥æŸ¥ä¸ª ip åœ°å€ï¼Œä½†æ˜¯å®ƒæä¾›çš„è®°å½•ç±»å‹è¿˜è›®å¤šçš„ï¼Œä¸»è¦æœ‰å¦‚ä¸‹å‡ ç§ï¼š A è®°å½•ï¼šå®ƒè®°å½•åŸŸåä¸ IPv4 åœ°å€çš„å¯¹åº”å…³ç³»ã€‚ç›®å‰ç”¨çš„æœ€å¤šçš„ DNS è®°å½•å°±æ˜¯è¿™ä¸ªã€‚ AAAA è®°å½•ï¼šå®ƒå¯¹åº”çš„æ˜¯ IPv6ï¼Œå¯ä»¥ç†è§£æˆæ–°ä¸€ä»£çš„ A è®°å½•ã€‚ä»¥åä¼šç”¨çš„è¶Šæ¥è¶Šå¤šçš„ã€‚ NS è®°å½•ï¼šè®°å½• DNS åŸŸå¯¹åº”çš„æƒå¨æœåŠ¡å™¨åŸŸåï¼Œæƒå¨æœåŠ¡å™¨åŸŸåå¿…é¡»è¦æœ‰å¯¹åº”çš„ A è®°å½•ã€‚ é€šè¿‡è¿™ä¸ªè®°å½•ï¼Œå¯ä»¥å°†å­åŸŸåçš„è§£æåˆ†é…ç»™åˆ«çš„ DNS æœåŠ¡å™¨ã€‚ CNAME è®°å½•: è®°å½•åŸŸåä¸å¦ä¸€ä¸ªåŸŸåçš„å¯¹åº”å…³ç³»ï¼Œç”¨äºç»™åŸŸåèµ·åˆ«åã€‚è¿™ä¸ªç”¨å¾—ä¹ŸæŒºå¤šçš„ã€‚ MX è®°å½•ï¼šè®°å½•åŸŸåå¯¹åº”çš„é‚®ä»¶æœåŠ¡å™¨åŸŸåï¼Œé‚®ä»¶æœåŠ¡å™¨çš„åŸŸåå¿…é¡»è¦æœ‰å¯¹åº”çš„ A è®°å½•ã€‚ SRV è®°å½•ï¼šSRV è®°å½•ç”¨äºæä¾›æœåŠ¡å‘ç°ï¼Œçœ‹åå­—ä¹Ÿèƒ½çŸ¥é“å®ƒå’Œ SERVICE æœ‰å…³ã€‚ SRV è®°å½•çš„å†…å®¹æœ‰å›ºå®šæ ¼å¼ï¼šä¼˜å…ˆçº§ æƒé‡ ç«¯å£ ç›®æ ‡åœ°å€ï¼Œä¾‹å¦‚0 5 5060 sipserver.example.com ä¸»è¦ç”¨äºä¼ä¸šåŸŸæ§(AD)ã€å¾®æœåŠ¡å‘ç°ï¼ˆKubernetesï¼‰ ä¸Šè¿°çš„æ‰€æœ‰ DNS è®°å½•ï¼Œéƒ½æ˜¯å±äºå°†åŸŸåè§£æä¸º IP åœ°å€ï¼Œæˆ–è€…å¦ä¸€ä¸ªåŸŸåï¼Œè¿™è¢«ç§°åš DNS æ­£å‘è§£æã€‚é™¤äº†è¿™ä¸ªæ­£å‘è§£æå¤–ï¼Œè¿˜æœ‰ä¸ªéå¸¸å†·é—¨çš„åå‘è§£æï¼ŒåŸºæœ¬ä¸Šåªåœ¨è®¾ç½®é‚®ä»¶æœåŠ¡å™¨æ—¶æ‰ä¼šç”¨åˆ°ã€‚ï¼ˆKubernetes å¯èƒ½ä¹Ÿæœ‰ç”¨åˆ°ï¼‰ åå‘è§£æä¸»è¦çš„è®°å½•ç±»å‹æ˜¯ï¼šPTR è®°å½•ï¼Œå®ƒæä¾›å°† IP åœ°å€åå‘è§£æä¸ºåŸŸåçš„åŠŸèƒ½ã€‚è€Œä¸”å› ä¸ºåŸŸåæ˜¯ä»å³å¾€å·¦è¯»çš„ï¼ˆæœ€å³ä¾§æ˜¯æ ¹, www.baidu.com.ï¼‰ï¼Œè€Œ IP çš„ç½‘æ®µï¼ˆå¦‚ 192.168.0.0/16ï¼‰åˆšå¥½ç›¸åï¼Œæ˜¯å·¦è¾¹ä¼˜å…ˆã€‚å› æ­¤ PTR è®°å½•çš„ã€ŒåŸŸåâ€å¿…é¡»å°† IP åœ°å€åç€å†™ï¼Œæœ«å°¾å†åŠ ä¸Š .in-addr.arpa. è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªåå‘è§£æçš„åŸŸåã€‚ï¼ˆipv6 ä½¿ç”¨ ip6.arpa.ï¼‰æ‹¿ baidu.com çš„é‚®ä»¶æœåŠ¡å™¨æµ‹è¯•ä¸€ä¸‹ï¼š PTR è®°å½•æŸ¥è¯¢ å…¶ä»–è¿˜æœ‰äº› TXTã€CAA ç­‰å¥‡å¥‡æ€ªæ€ªçš„è®°å½•ï¼Œå°±ç”¨åˆ°çš„æ—¶å€™è‡ªå·±å†æŸ¥äº†ã€‚ ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:2:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/#ä¸€dns-æ˜¯ä¸ªå•¥"},{"categories":["tech"],"content":" äºŒã€åŸŸåçš„åˆ†å±‚ç»“æ„å›½é™…åŸŸåç³»ç»Ÿè¢«åˆ†æˆå››å±‚ï¼š æ ¹åŸŸï¼ˆRoot Zoneï¼‰ï¼šæ‰€æœ‰åŸŸåçš„æ ¹ã€‚ æ ¹åŸŸåæœåŠ¡å™¨è´Ÿè´£è§£æé¡¶çº§åŸŸåï¼Œç»™å‡ºé¡¶çº§åŸŸåçš„ DNS æœåŠ¡å™¨åœ°å€ã€‚ å…¨ä¸–ç•Œä»…æœ‰åä¸‰ç»„æ ¹åŸŸåæœåŠ¡å™¨ï¼Œè¿™äº›æœåŠ¡å™¨çš„ ip åœ°å€åŸºæœ¬ä¸ä¼šå˜åŠ¨ã€‚ å®ƒçš„åŸŸåæ˜¯ â€œ\"ï¼Œç©ºå­—ç¬¦ä¸²ã€‚è€Œå®ƒçš„**å…¨é™å®šåŸŸåï¼ˆFQDNï¼‰**æ˜¯ .ï¼Œå› ä¸º FQDN æ€»æ˜¯ä»¥ . ç»“å°¾ã€‚ï¼ˆFQDN åœ¨åé¢è§£é‡Šï¼Œå¯æš‚æ—¶å¿½ç•¥ï¼‰ é¡¶çº§åŸŸï¼ˆTop Level Domains, TLDï¼‰ï¼š.com .cn ç­‰å›½é™…ã€å›½å®¶çº§çš„åŸŸå é¡¶çº§åŸŸåæœåŠ¡å™¨è´Ÿè´£è§£ææ¬¡çº§åŸŸåï¼Œç»™å‡ºæ¬¡çº§åŸŸåçš„ DNS æœåŠ¡å™¨åœ°å€ã€‚ æ¯ä¸ªé¡¶çº§åŸŸåéƒ½å¯¹åº”å„è‡ªçš„æœåŠ¡å™¨ï¼Œå®ƒä»¬ä¹‹é—´æ˜¯å®Œå…¨ç‹¬ç«‹çš„ã€‚.cn çš„åŸŸåè§£æä»…ç”± .cn é¡¶çº§åŸŸåæœåŠ¡å™¨æä¾›ã€‚ ç›®å‰å›½é™… DNS ç³»ç»Ÿä¸­å·²æœ‰ä¸Šåƒä¸ª TLDï¼ŒåŒ…æ‹¬ä¸­æ–‡ã€Œ.æˆ‘çˆ±ä½ ã€ç”šè‡³è—æ–‡åŸŸåï¼Œè¯¦ç»†åˆ—è¡¨å‚è§IANA TLD æ•°æ®åº“ é™¤äº†å›½é™…å¯ç”¨çš„ TLDï¼Œè¿˜æœ‰ä¸€ç±»ç±»ä¼¼ã€Œå†…ç½‘ IP åœ°å€ã€çš„ã€Œç§æœ‰ TLDâ€ï¼Œæœ€å¸¸è§çš„æ¯”å¦‚ xxx.local xxx.lanï¼Œè¢«å¹¿æ³›ç”¨åœ¨é›†ç¾¤é€šä¿¡ä¸­ã€‚åé¢è¯¦ç»†ä»‹ç» æ¬¡çº§åŸŸï¼ˆSecond Level Domainsï¼‰ï¼šè¿™ä¸ªæ‰æ˜¯ä¸ªäºº/ä¼ä¸šèƒ½å¤Ÿä¹°åˆ°çš„åŸŸåï¼Œæ¯”å¦‚ baidu.com æ¯ä¸ªæ¬¡çº§åŸŸåéƒ½æœ‰ä¸€åˆ°å¤šä¸ªæƒå¨ DNS æœåŠ¡å™¨ï¼Œè¿™äº› DNS æœåŠ¡å™¨ä¼šä»¥ NS è®°å½•çš„å½¢å¼ä¿å­˜åœ¨å¯¹åº”çš„é¡¶çº§åŸŸåï¼ˆTLDï¼‰æœåŠ¡å™¨ä¸­ã€‚ æƒå¨åŸŸåæœåŠ¡å™¨åˆ™è´Ÿè´£ç»™å‡ºæœ€ç»ˆçš„è§£æç»“æœï¼šip åœ°å€(A è®°å½• )ï¼Œå¦ä¸€ä¸ªåŸŸåï¼ˆCNAME è®°å½•ï¼‰ã€å¦ä¸€ä¸ª DNS æœåŠ¡å™¨ï¼ˆNS è®°å½•ï¼‰ç­‰ã€‚ å­åŸŸï¼ˆSub Domainsï¼‰ï¼š*.baidu.com ç»Ÿç»Ÿéƒ½æ˜¯ baidu.com çš„å­åŸŸã€‚ æ¯ä¸€ä¸ªå­åŸŸéƒ½å¯ä»¥æœ‰è‡ªå·±ç‹¬ç«‹çš„æƒå¨ DNS æœåŠ¡å™¨ï¼Œè¿™é€šè¿‡åœ¨å­åŸŸä¸­æ·»åŠ  NS è®°å½•å®ç°ã€‚ æ™®é€šç”¨æˆ·é€šå¸¸æ˜¯é€šè¿‡åŸŸåæä¾›å•†å¦‚é˜¿é‡Œäº‘è´­ä¹°çš„æ¬¡çº§åŸŸåï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä»¥ rea.ink ä¸ºä¾‹ä»‹ç»åŸŸåçš„è´­ä¹°åˆ°å¯ç”¨çš„æ•´ä¸ªæµç¨‹ã€‚ åŸŸåçš„è´­ä¹°ä¸ä½¿ç”¨æµç¨‹ï¼š ä½ åœ¨æŸåŸŸåæä¾›å•†å¤„è´­ä¹°äº†ä¸€ä¸ªåŸŸå rea.ink åŸŸåæä¾›å•†å‘ .ink å¯¹åº”çš„é¡¶çº§åŸŸåæœåŠ¡å™¨ä¸­æ’å…¥ä¸€æ¡ä»¥ä¸Šçš„ NS è®°å½•ï¼ŒæŒ‡å‘å®ƒè‡ªå·±çš„æ¬¡çº§ DNS æœåŠ¡å™¨ï¼Œå¦‚ dns25.hichina.com. é˜¿é‡Œäº‘ä¼šå‘ TLD ä¸­æ’å…¥å‡ æ¡ NS è®°å½•ï¼ŒæŒ‡å‘é˜¿é‡Œäº‘çš„æ¬¡çº§ DNS æœåŠ¡å™¨ï¼ˆå¦‚vip1.alidns.comï¼‰ã€‚ ä½ åœ¨è¯¥åŸŸåæä¾›å•†çš„ DNS ç®¡ç†ç•Œé¢ä¸­æ·»åŠ  A è®°å½•ï¼Œå€¼ä¸ºä½ çš„æœåŠ¡å™¨ IPã€‚ OK ç°åœ¨ ping ä¸€ä¸‹ rea.inkï¼Œå°±ä¼šå‘ç°å®ƒå·²ç»è§£æåˆ°ä½ è‡ªå·±çš„æœåŠ¡å™¨äº†ã€‚ ä¸Šè¿°æµç¨‹ä¸­å¿½ç•¥äº†æˆ‘å¤§å¤©æœçš„ç‰¹æ®Šå›½æƒ…â€”â€”å¤‡æ¡ˆï¼Œå‹¿ä»‹æ„ã€‚ ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:3:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/#äºŒåŸŸåçš„åˆ†å±‚ç»“æ„"},{"categories":["tech"],"content":" ä¸‰ã€DNS é€’å½’è§£æå™¨ï¼šåœ¨æµè§ˆå™¨ä¸­è¾“å…¥åŸŸååå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿä¸‹é¢çš„å›¾ç‰‡æ‹·è´è‡ª Amazon Aws æ–‡æ¡£ï¼Œå®ƒå±•ç¤ºäº†åœ¨ä¸è€ƒè™‘ä»»ä½• DNS ç¼“å­˜çš„æƒ…å†µä¸‹ï¼Œä¸€æ¬¡ Web è¯·æ±‚çš„ç»è¿‡ï¼Œè¯¦ç»†æç»˜äº† DNS è§£æçš„éƒ¨åˆ†ã€‚ DNS è§£ææµç¨‹ å…¶ä¸­çš„ç¬¬ 3 4 5 æ­¥æŒ‰é¡ºåºå‘å‰é¢è®²è¿‡çš„æ ¹åŸŸåæœåŠ¡å™¨ã€é¡¶çº§åŸŸåæœåŠ¡å™¨ã€æƒå¨åŸŸåæœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œ ä»¥è·å¾—ä¸‹ä¸€ä¸ª DNS æœåŠ¡å™¨çš„ä¿¡æ¯ã€‚è¿™å¾ˆæ¸…æ™°ã€‚ å›¾ä¸­å½“å‰è¿˜æ²¡ä»‹ç»çš„éƒ¨åˆ†ï¼Œæ˜¯ç´«è‰²çš„ DNS Resolver(åŸŸåè§£æå™¨)ï¼Œä¹Ÿå«Recursive DNS resolverï¼ˆDNS é€’å½’è§£æå™¨ï¼‰ã€‚å®ƒæœ¬èº«åªè´Ÿè´£é€’å½’åœ°è¯·æ±‚ 3 4 5 æ­¥ä¸­çš„ä¸Šæ¸¸æœåŠ¡å™¨ï¼Œç„¶åæŠŠè·å–çš„æœ€ç»ˆç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼ŒåŒæ—¶å°†è®°å½•ç¼“å­˜åˆ°æœ¬åœ°ä»¥åŠ å¿«è§£æé€Ÿåº¦ã€‚ è¿™ä¸ª DNS è§£æå™¨ï¼Œå…¶å®å°±æ˜¯æ‰€è°“çš„å…¬å…± DNS æœåŠ¡å™¨ï¼šGoogle çš„ 8.8.8.8ï¼Œå›½å†…è‘—åçš„114.114.114.114ã€‚ è¿™äº›å…¬å…± DNS ç”¨æˆ·é‡å¤§ï¼Œç¼“å­˜äº†å¤§é‡çš„ DNS è®°å½•ï¼Œæœ‰æ•ˆåœ°é™ä½äº†ä¸Šæ¸¸ DNS æœåŠ¡å™¨çš„å‹åŠ›ï¼Œä¹ŸåŠ å¿«äº†ç½‘ç»œä¸Šçš„ DNS æŸ¥è¯¢é€Ÿåº¦ã€‚ æ¥ä¸‹æ¥ä½¿ç”¨ dig +trace baidu.com å¤ç°ä¸€ä¸‹ä¸Šè¿°çš„æŸ¥è¯¢æµç¨‹ï¼ˆè¿™ç§æƒ…å†µä¸‹ dig è‡ªå·±å°±æ˜¯ä¸€ä¸ª DNS é€’å½’è§£æå™¨ï¼‰ï¼š dig +trace baidu.com å¦å¤–å‰é¢æœ‰è®²è¿‡ DNS çš„åå‘è§£æï¼Œä¹Ÿæ˜¯åŒæ ·çš„å±‚çº§ç»“æ„ï¼Œæ˜¯ä»æ ¹æœåŠ¡å™¨å¼€å§‹å¾€ä¸‹æŸ¥è¯¢çš„ï¼Œä¸‹é¢æ‹¿ baidu çš„ä¸€ä¸ªé‚®ä»¶æœåŠ¡å™¨è¿›è¡Œæµ‹è¯•ï¼š åå‘è§£æ dig å·¥å…·æœªæ¥å¯èƒ½ä¼šè¢« drill å–ä»£ã€‚ ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:4:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/#ä¸‰dns-é€’å½’è§£æå™¨åœ¨æµè§ˆå™¨ä¸­è¾“å…¥åŸŸååå‘ç”Ÿäº†ä»€ä¹ˆ"},{"categories":["tech"],"content":" DNS æ³›è§£æé€šé…ç¬¦ *DNS è®°å½•å…è®¸ä½¿ç”¨é€šé…ç¬¦ *ï¼Œä½†ä»…æ”¯æŒåŒçº§åŒ¹é…ï¼Œä¹Ÿå°±æ˜¯è¯´ * ä¸èƒ½åŒ¹é…åŸŸåä¸­çš„ . è¿™ä¸ªå­—ç¬¦ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œ*.aliyun.com èƒ½ç”¨äº xx.aliyun.com å’Œ abc.aliyun.comï¼Œä½†ä¸èƒ½ç”¨äºaliyun.com, a.b.aliyun.com æˆ– bb.xx.aliyun.com. ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:4:1","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/#dns-æ³›è§£æé€šé…ç¬¦-"},{"categories":["tech"],"content":" TTLï¼ˆTime To Liveï¼‰ä¸Šé¢è®²äº†å…¬å…± DNS æœåŠ¡å™¨é€šè¿‡ç¼“å­˜æŠ€æœ¯ï¼Œé™ä½äº†ä¸Šæ¸¸ DNS æœåŠ¡å™¨çš„å‹åŠ›ï¼Œä¹ŸåŠ å¿«äº†ç½‘ç»œä¸Šçš„ DNS æŸ¥è¯¢é€Ÿåº¦ã€‚ å¯ç¼“å­˜æ€»å¾—æœ‰ä¸ªè¿‡æœŸæ—¶é—´å§ï¼ä¸ºäº†ç²¾ç¡®åœ°æ§åˆ¶ DNS è®°å½•çš„è¿‡æœŸæ—¶é—´ï¼Œæ¯æ¡ DNS è®°å½•éƒ½è¦æ±‚è®¾ç½®ä¸€ä¸ªæ—¶é—´å±æ€§â€”â€”TTLï¼Œå•ä½ä¸ºç§’ã€‚è¿™ä¸ªæ—¶é—´å¯ä»¥è‡ªå®šä¹‰ã€‚ ä»»ä½•ä¸€æ¡ DNS ç¼“å­˜ï¼Œåœ¨è¶…è¿‡è¿‡æœŸæ—¶é—´åéƒ½å¿…é¡»ä¸¢å¼ƒï¼å¦å¤–åœ¨æ²¡è¶…æ—¶çš„æ—¶å€™ï¼ŒDNS ç¼“å­˜ä¹Ÿå¯ä»¥è¢«ä¸»åŠ¨æˆ–è€…è¢«åŠ¨åœ°åˆ·æ–°ã€‚ ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:4:2","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/#ttltime-to-live"},{"categories":["tech"],"content":" å››ã€æœ¬åœ° DNS æœåŠ¡å™¨ä¸ç§æœ‰ DNS åŸŸè¿™ç±»æœåŠ¡å™¨åªåœ¨å½“å‰å±€åŸŸç½‘å†…æœ‰æ•ˆï¼Œæ˜¯ä¸€ä¸ªç§æœ‰çš„ DNS æœåŠ¡å™¨ï¼Œä¼ä¸šå¸¸ç”¨ã€‚ä¸€èˆ¬é€šè¿‡ DHCP æˆ–è€…æ‰‹åŠ¨é…ç½®çš„æ–¹å¼ï¼Œä½¿å†…ç½‘çš„æœåŠ¡å™¨éƒ½é»˜è®¤ä½¿ç”¨å±€åŸŸç½‘ DNS æœåŠ¡å™¨è¿›è¡Œè§£æã€‚è¯¥æœåŠ¡å™¨å¯ä»¥åªè§£æè‡ªå·±çš„ç§æœ‰ DNS åŸŸï¼Œè€Œå°†å…¶ä»– DNS åŸŸçš„è§£æ forward åˆ°å…¬ç½‘ DNS è§£æå™¨å»ã€‚ è¿™ä¸ªç§æœ‰ DNS åŸŸï¼Œä¼šè¦†ç›–æ‰å…¬ç½‘çš„åŒååŸŸ(å¦‚æœå…¬ç½‘ä¸Šæœ‰è¿™ä¸ªåŸŸçš„è¯)ã€‚ç§æœ‰ dns åŸŸä¹Ÿå¯ä½¿ç”¨å…¬ç½‘ä¸å­˜åœ¨çš„ TLDï¼Œæ¯”å¦‚ xxx.local xxx.lan ç­‰ã€‚vmware vcenter å°±é»˜è®¤ä½¿ç”¨ vsphere.local ä½œä¸ºå®ƒçš„ sso (å•ç‚¹ç™»å½•)ç³»ç»Ÿçš„åŸŸåã€‚kubernetes é»˜è®¤ä½¿ç”¨ svc.cluster.local ä½œä¸ºé›†ç¾¤å†…éƒ¨åŸŸåã€‚ ç§æœ‰ DNS åŸŸçš„é€‰æ‹©ï¼Œå‚è§DNS ç§æœ‰åŸŸçš„é€‰æ‹©ï¼šinternal.xxx.com xxx.local è¿˜æ˜¯ xxx.zoneï¼Ÿ å±€åŸŸç½‘ DNS æœåŠ¡å™¨çš„è§„æ¨¡ä¸å±‚çº§ï¼Œè§†å±€åŸŸç½‘çš„å¤§å°è€Œå®šã€‚ä¸€èˆ¬å°å…¬å¸ä¸€ä¸ªå°±è¡Œï¼Œè¦å®¹ç¾è®¾ä¸‰ä¸ªå‰¯æœ¬ä¹Ÿå¤Ÿäº†ã€‚ ä»¥ CoreDNS ä¸ºä¾‹ï¼Œå±€åŸŸç½‘ DNS æœåŠ¡å™¨ä¹Ÿå¯ä»¥è¢«è®¾ç½®æˆä¸€ä¸ª DNS Resolverï¼Œå¯ä»¥è®¾ç½®åªè½¬å‘ç‰¹å®šåŸŸåçš„ DNS è§£æã€‚è¿™å«å°†æŸä¸ªåŸŸè®¾ä¸ºã€Œè½¬å‘åŒºåŸŸã€ã€‚ ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:5:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/#å››æœ¬åœ°-dns-æœåŠ¡å™¨ä¸ç§æœ‰-dns-åŸŸ"},{"categories":["tech"],"content":" äº”ã€æ“ä½œç³»ç»Ÿçš„ DNS è§£æå™¨åº”ç”¨ç¨‹åºå®é™…ä¸Šéƒ½æ˜¯è°ƒç”¨çš„æ“ä½œç³»ç»Ÿçš„ DNS Resolver è¿›è¡ŒåŸŸåè§£æçš„ã€‚åœ¨ Linux ä¸­ DNS Resolver ç”± glibc/musl æä¾›ï¼Œé…ç½®æ–‡ä»¶ä¸º /etc/resolv.confã€‚ æ¯”å¦‚ Python çš„ DNS è§£æï¼Œå°±æ¥è‡ªäºæ ‡å‡†åº“çš„ socket åŒ…ï¼Œè¿™ä¸ªåŒ…åªæ˜¯å¯¹åº•å±‚ c è¯­è¨€åº“çš„ä¸€ä¸ªç®€å•å°è£…ã€‚ åŸºæœ¬ä¸Šåªæœ‰ä¸“é—¨ç”¨äºç½‘ç»œè¯Šæ–­çš„ DNS å·¥å…·åŒ…ï¼Œæ‰ä¼šè‡ªå·±å®ç° DNS åè®®ã€‚ ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:6:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/#äº”æ“ä½œç³»ç»Ÿçš„-dns-è§£æå™¨"},{"categories":["tech"],"content":" 1. hosts æ–‡ä»¶æ“ä½œç³»ç»Ÿä¸­è¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šæ–‡ä»¶ï¼šLinux ä¸­çš„ /etc/hosts å’Œ Windows ä¸­çš„C:\\Windows\\System32\\drivers\\etc\\hosts ç³»ç»Ÿä¸­çš„ DNS resolver ä¼šé¦–å…ˆæŸ¥çœ‹è¿™ä¸ª hosts æ–‡ä»¶ä¸­æœ‰æ²¡æœ‰è¯¥åŸŸåçš„è®°å½•ï¼Œå¦‚æœæœ‰å°±ç›´æ¥è¿”å›äº†ã€‚æ²¡æ‰¾åˆ°æ‰ä¼šå»æŸ¥æ‰¾æœ¬åœ° DNS ç¼“å­˜ã€åˆ«çš„ DNS æœåŠ¡å™¨ã€‚ åªæœ‰éƒ¨åˆ†ä¸“é—¨ç”¨äºç½‘ç»œè¯Šæ–­çš„åº”ç”¨ç¨‹åºï¼ˆe.g. digï¼‰ä¸ä¼šä¾èµ– OS çš„ DNS è§£æå™¨ï¼Œå› æ­¤è¿™ä¸ª hosts ä¼šå¤±æ•ˆã€‚hosts å¯¹äºç»å¤§éƒ¨åˆ†ç¨‹åºéƒ½æœ‰æ•ˆã€‚ ç§»åŠ¨è®¾å¤‡ä¸Š hosts å¯èƒ½ä¼šå¤±æ•ˆï¼Œéƒ¨åˆ† app ä¼šç»•è¿‡ç³»ç»Ÿï¼Œä½¿ç”¨æ–°å…´çš„ HTTPDNS åè®®è¿›è¡Œ DNS è§£æã€‚ ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:6:1","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/#1-hosts-æ–‡ä»¶"},{"categories":["tech"],"content":" 2. HTTPDNSä¼ ç»Ÿçš„ DNS åè®®å› ä¸ºä½¿ç”¨äº†æ˜æ–‡çš„ UDP åè®®ï¼Œå¾ˆå®¹æ˜“è¢«åŠ«æŒã€‚é¡ºåº”ç§»åŠ¨äº’è”ç½‘çš„å…´èµ·ï¼Œç›®å‰ä¸€ç§æ–°å‹çš„ DNS åè®®â€”â€”HTTPDNS åº”ç”¨è¶Šæ¥è¶Šå¹¿æ³›ï¼Œå›½å†…çš„é˜¿é‡Œäº‘è…¾è®¯äº‘éƒ½æä¾›äº†è¿™é¡¹åŠŸèƒ½ã€‚ HTTPDNS é€šè¿‡ HTTP åè®®ç›´æ¥å‘æƒå¨ DNS æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œç»•è¿‡äº†ä¸€å †ä¸­é—´çš„ DNS é€’å½’è§£æå™¨ã€‚å¥½å¤„æœ‰äºŒï¼š æƒå¨ DNS æœåŠ¡å™¨èƒ½ç›´æ¥è·å–åˆ°å®¢æˆ·ç«¯çš„çœŸå® IPï¼ˆè€Œä¸æ˜¯æŸä¸ªä¸­é—´ DNS é€’å½’è§£æå™¨çš„ IPï¼‰ï¼Œèƒ½å®ç°å°±è¿‘è°ƒåº¦ã€‚ å› ä¸ºæ˜¯ç›´æ¥ä¸æƒå¨ DNS æœåŠ¡å™¨è¿æ¥ï¼Œé¿å…äº† DNS ç¼“å­˜æ±¡æŸ“çš„é—®é¢˜ã€‚ HTTPDNS åè®®éœ€è¦ç¨‹åºè‡ªå·±å¼•å…¥ SDKï¼Œæˆ–è€…ç›´æ¥è¯·æ±‚ HTTP APIã€‚ ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:6:2","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/#2-httpdns"},{"categories":["tech"],"content":" 3. é»˜è®¤ DNS æœåŠ¡å™¨æ“ä½œç³»ç»Ÿçš„ DNS è§£æå™¨é€šå¸¸ä¼šå…è®¸æˆ‘ä»¬é…ç½®å¤šä¸ªä¸Šæ¸¸ Name Serversï¼Œæ¯”å¦‚ Linux å°±æ˜¯é€šè¿‡/etc/resolv.conf é…ç½® DNS æœåŠ¡å™¨çš„ã€‚ conf $ cat /etc/resolv.conf nameserver 8.8.8.8 nameserver 8.8.4.4 search lan ä¸è¿‡ç°åœ¨è¿™ä¸ªæ–‡ä»¶åŸºæœ¬ä¸ä¼šæ‰‹åŠ¨ä¿®æ”¹äº†ï¼Œå„ Linux å‘è¡Œç‰ˆéƒ½æ¨å‡ºäº†è‡ªå·±çš„ç½‘ç»œé…ç½®å·¥å…·ï¼Œç”±è¿™äº›å·¥å…·è‡ªåŠ¨ç”Ÿæˆ Linux çš„å„ç§ç½‘ç»œé…ç½®ï¼Œæ›´æ–¹ä¾¿ã€‚æ¯”å¦‚ Ubuntu å°±æ¨èä½¿ç”¨ netplan å·¥å…·è¿›è¡Œç½‘ç»œè®¾ç½®ã€‚ Kubernetes å°±æ˜¯é€šè¿‡ä½¿ç”¨å®¹å™¨å·æ˜ å°„çš„åŠŸèƒ½ï¼Œä¿®æ”¹ /etc/resolv.confï¼Œä½¿é›†ç¾¤çš„æ‰€æœ‰å®¹å™¨éƒ½ä½¿ç”¨é›†ç¾¤ DNS æœåŠ¡å™¨ï¼ˆCoreDNSï¼‰è¿›è¡Œ DNS è§£æã€‚ é€šè¿‡é‡å¤ä½¿ç”¨ nameserver å­—æ®µï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ª DNS æœåŠ¡å™¨ï¼ˆLinux æœ€å¤šä¸‰ä¸ªï¼‰ã€‚DNS æŸ¥è¯¢ä¼šæŒ‰é…ç½®ä¸­çš„é¡ºåºé€‰ç”¨ DNS æœåŠ¡å™¨ã€‚ ä»…åœ¨é å‰çš„ DNS æœåŠ¡å™¨æ²¡æœ‰å“åº”ï¼ˆtimeoutï¼‰æ—¶ï¼Œæ‰ä¼šä½¿ç”¨åç»­çš„ DNS æœåŠ¡å™¨ï¼æ‰€ä»¥æŒ‡å®šçš„æœåŠ¡å™¨ä¸­çš„ DNS è®°å½•æœ€å¥½å®Œå…¨ä¸€è‡´ï¼ï¼ï¼ä¸è¦æŠŠç¬¬ä¸€ä¸ªé…å†…ç½‘ DNSï¼Œç¬¬äºŒä¸ªé…å¤–ç½‘ï¼ï¼ï¼ ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:6:3","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/#3-é»˜è®¤-dns-æœåŠ¡å™¨"},{"categories":["tech"],"content":" 4. DNS æœç´¢åŸŸä¸Šä¸€å°èŠ‚ç»™å‡ºçš„ /etc/resolv.conf æ–‡ä»¶å†…å®¹çš„æœ«å°¾ï¼Œæœ‰è¿™æ ·ä¸€è¡Œ: search lanï¼Œå®ƒæŒ‡å®šçš„ï¼Œæ˜¯æ‰€è°“çš„ DNS æœç´¢åŸŸã€‚ è®²åˆ° DNS æœç´¢åŸŸï¼Œå°±ä¸å¾—ä¸æåˆ°ä¸€ä¸ªåè¯ï¼šå…¨é™å®šåŸŸåï¼ˆFull Qulified Domain Name, FQDNï¼‰ï¼Œå³ä¸€ä¸ªåŸŸåçš„å®Œæ•´åç§°ï¼Œwww.baidu.comã€‚ ä¸€ä¸ªæ™®é€šçš„åŸŸåï¼Œæœ‰ä¸‹åˆ—å››ç§å¯èƒ½ï¼š www.baidu.com.: æœ«å°¾çš„ . è¡¨ç¤ºæ ¹åŸŸï¼Œè¯´æ˜ www.baidu.com æ˜¯ä¸€ä¸ª FQDNï¼Œå› æ­¤ä¸ä¼šä½¿ç”¨æœç´¢åŸŸï¼ www.baidu.com: æœ«å°¾æ²¡ .ï¼Œä½†æ˜¯åŸŸååŒ…å«ä¸æ­¢ä¸€ä¸ª .ã€‚é¦–å…ˆå½“ä½œ FQDN è¿›è¡ŒæŸ¥è¯¢ï¼Œæ²¡æŸ¥æ‰¾å†æŒ‰é¡ºåºåœ¨å„æœç´¢åŸŸä¸­æŸ¥è¯¢ã€‚ /etc/resolv.conf çš„ options å‚æ•°ä¸­ï¼Œå¯ä»¥æŒ‡å®šåŸŸåä¸­åŒ…å« . çš„ä¸´ç•Œä¸ªæ•°ï¼Œé»˜è®¤æ˜¯ 1. local: ä¸åŒ…å« .ï¼Œè¢«å½“ä½œ host åç§°ï¼Œé FQDNã€‚é¦–å…ˆåœ¨ /etc/hosts ä¸­æŸ¥æ‰¾ï¼Œæ²¡æ‰¾åˆ°çš„è¯ï¼Œå†æŒ‰é¡ºåºåœ¨å„æœç´¢åŸŸä¸­æŸ¥æ‰¾ã€‚ ä¸Šè¿°æœç´¢é¡ºåºå¯ä»¥é€šè¿‡ host -v \u003cdomain-name\u003e è¿›è¡Œæµ‹è¯•ï¼Œè¯¥å‘½ä»¤ä¼šè¾“å‡ºå®ƒå°è¯•è¿‡çš„æ‰€æœ‰ FQDNã€‚ä¿®æ”¹ /etc/resolv.conf ä¸­çš„ search å±æ€§å¹¶æµ‹è¯•ï¼Œç„¶åæŸ¥çœ‹è¾“å‡ºã€‚ å°±å¦‚ä¸Šé¢è¯´ä¾‹ä¸¾çš„ï¼Œåœ¨æ²¡æœ‰ DNS æœç´¢åŸŸ è¿™ä¸ªä¸œè¥¿çš„æ¡ä»¶ä¸‹ï¼Œæˆ‘ä»¬è®¿é—®ä»»ä½•åŸŸåï¼Œéƒ½å¿…é¡»è¾“å…¥ä¸€ä¸ªå…¨é™å®šåŸŸå FQDNã€‚æœ‰äº†æœç´¢åŸŸæˆ‘ä»¬å°±å¯ä»¥ç¨å¾®å·ç‚¹æ‡’ï¼Œçœç•¥æ‰åŸŸåçš„ä¸€éƒ¨åˆ†åç¼€ï¼Œè®© DNS Resolver è‡ªå·±å»åœ¨å„æœç´¢åŸŸä¸­æœç´¢ã€‚ åœ¨ Kubernetes ä¸­å°±ä½¿ç”¨åˆ°äº†æœç´¢åŸŸï¼Œk8s ä¸­é»˜è®¤çš„åŸŸå FQDN æ˜¯service.namespace.svc.cluster.localï¼Œä½†æ˜¯å¯¹äº default namespace ä¸­çš„ serviceï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡ service åç§°æŸ¥è¯¢åˆ°å®ƒçš„ IPã€‚å¯¹äºå…¶ä»–åå­—ç©ºé—´ä¸­çš„ serviceï¼Œä¹Ÿå¯ä»¥é€šè¿‡service.namespace æŸ¥è¯¢åˆ°å®ƒä»¬çš„ IPï¼Œä¸éœ€è¦ç»™å‡º FQDNã€‚ Kubernetes ä¸­ /etc/resolv.conf çš„ç¤ºä¾‹å¦‚ä¸‹ï¼š conf nameserver 10.43.0.10 search default.svc.cluster.local svc.cluster.local cluster.local options ndots:5 å¯ä»¥çœ‹åˆ° k8s è®¾ç½®äº†ä¸€ç³»åˆ—çš„æœç´¢åŸŸï¼Œå¹¶ä¸”å°† . çš„ä¸´ç•Œå€¼è®¾ä¸ºäº† 5ã€‚ä¹Ÿå°±æ˜¯å°‘äº 5 ä¸ª dots çš„åŸŸåï¼Œéƒ½é¦–å…ˆå½“ä½œé FQDN çœ‹å¾…ï¼Œä¼˜å…ˆåœ¨æœç´¢åŸŸé‡Œé¢æŸ¥æ‰¾ã€‚ è¯¥é…ç½®æ–‡ä»¶çš„è¯¦ç»†æè¿°å‚è§manpage - resolv.confï¼Œæˆ–è€…åœ¨ Linux ä¸­ä½¿ç”¨ man resolv.conf å‘½ä»¤æŸ¥çœ‹ã€‚ ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:6:4","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/#4-dns-æœç´¢åŸŸ"},{"categories":["tech"],"content":" å…­ã€DNS è¯Šæ–­çš„å‘½ä»¤è¡Œå·¥å…· shell dig +trace baidu.com # è¯Šæ–­ dns çš„ä¸»è¦å·¥å…·ï¼Œéå¸¸å¼ºå¤§ host -a baidu.com # host åŸºæœ¬å°±æ˜¯ dig çš„å¼±åŒ–ç‰ˆï¼Œä¸è¿‡ host æœ‰ä¸ªæœ‰ç‚¹å°±æ˜¯èƒ½æ‰“å°å‡ºå®ƒæµ‹è¯•è¿‡çš„æ‰€æœ‰ FQDN nslookup baidu.com # å’Œ host æ²¡å•¥å¤§å·®åˆ«ï¼Œå¤šä¸ªäº¤äº’å¼æŸ¥è¯¢ä¸è¿‡ä¸€èˆ¬ç”¨ä¸åˆ° whois baidu.com # æŸ¥è¯¢åŸŸåæ³¨å†Œä¿¡æ¯ï¼Œå†…ç½‘è¯Šæ–­ç”¨ä¸åˆ° è¯¦ç»†çš„ä½¿ç”¨è¯· man dig ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:7:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/#å…­dns-è¯Šæ–­çš„å‘½ä»¤è¡Œå·¥å…·"},{"categories":["tech"],"content":" ä¸ƒã€CoreDNS çš„ä½¿ç”¨ä¸»æµçš„æœ¬åœ° DNS æœåŠ¡å™¨ä¸­ï¼Œæä¾› UI ç•Œé¢çš„æœ‰ Windows DNS Server å’Œç¾¤æ™– DNS Serverï¼Œå¾ˆæ–¹ä¾¿ï¼Œä¸è¿‡è¿™ä¸¤ä¸ªéƒ½æ˜¯æ“ä½œç³»ç»Ÿç»‘å®šçš„ã€‚ å¼€æºçš„ DNS æœåŠ¡å™¨é‡Œè¾¹å„¿ï¼ŒBIND å¥½åƒæ˜¯æœ€æœ‰åçš„ï¼Œå„å¤§ Linux å‘è¡Œç‰ˆè‡ªå¸¦çš„dig/host/nslookupï¼Œæœ€åˆéƒ½æ˜¯ Bind æä¾›çš„å‘½ä»¤è¡Œå·¥å…·ã€‚ä¸è¿‡ä¸ºäº†ä¸€ä¸¾ä¸¤å¾—ï¼ˆDNS+K8sï¼‰ï¼Œå’±è¿˜æ˜¯ç›´æ¥å­¦ä¹  CoreDNS çš„ä½¿ç”¨ã€‚ CoreDNS æœ€å¤§çš„ç‰¹ç‚¹æ˜¯çµæ´»ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°ç»™å®ƒç¼–å†™æ’ä»¶ä»¥æä¾›æ–°åŠŸèƒ½ã€‚åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œç›¸æ¯”ä¼ ç»Ÿ DNS æœåŠ¡å™¨ï¼Œå®ƒéå¸¸ã€Œç°ä»£åŒ–â€ã€‚åœ¨ K8s ä¸­å®ƒè¢«ç”¨äºæä¾›æœåŠ¡å‘ç°åŠŸèƒ½ã€‚ æ¥ä¸‹æ¥ä»¥ CoreDNS ä¸ºä¾‹ï¼Œè®²è¿°å¦‚ä½•é…ç½®ä¸€ä¸ª DNS æœåŠ¡å™¨ï¼Œæ·»åŠ ç§æœ‰çš„ DNS è®°å½•ï¼Œå¹¶è®¾ç½®è½¬å‘è§„åˆ™ä»¥è§£æå…¬ç½‘åŸŸåã€‚ ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:8:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/#ä¸ƒcoredns-çš„ä½¿ç”¨"},{"categories":["tech"],"content":" 1. é…ç½®æ–‡ä»¶ï¼šCorefileCoreDNS å› ä¸ºæ˜¯ Go è¯­è¨€å†™çš„ï¼Œç¼–è¯‘ç»“æœæ˜¯å•ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå®ƒé»˜è®¤ä»¥å½“å‰æ–‡ä»¶å¤¹ä¸‹çš„ Corefile ä¸ºé…ç½®æ–‡ä»¶ã€‚ä»¥ kubernetes ä¸­çš„ Corefile ä¸ºä¾‹ï¼š corefile .:53 { errors # å¯ç”¨é”™è¯¯æ—¥å¿— health # å¯ç”¨å¥åº·æ£€æŸ¥ api ready # å¯ç”¨ readiness å°±ç»ª api # å¯ç”¨ kubernetes é›†ç¾¤æ”¯æŒï¼Œè¯¦è§ https://coredns.io/plugins/kubernetes/ # æ­¤æ’ä»¶åªå¤„ç† cluster.local åŸŸï¼Œä»¥åŠ PTR è§£æ kubernetes cluster.local in-addr.arpa ip6.arpa { pods insecure upstream # fallthrough in-addr.arpa ip6.arpa # å‘ä¸‹ä¼ é€’ DNS åå‘æŸ¥è¯¢ ttl 30 # è¿‡æœŸæ—¶é—´ } prometheus :9153 # å¯ç”¨ prometheus metrics æ”¯æŒ forward . 114.114.114.114 19.29.29.29 # å°†éé›†ç¾¤åŸŸåçš„ DNS è¯·æ±‚ï¼Œè½¬å‘ç»™å…¬ç½‘ DNS æœåŠ¡å™¨ã€‚ cache 30 # å¯ç”¨å‰ç«¯ç¼“å­˜ï¼Œç¼“å­˜çš„ TTL è®¾ä¸º 30 loop # æ£€æµ‹å¹¶åœæ­¢æ­»å¾ªç¯è§£æ reload # æ”¯æŒåŠ¨æ€æ›´æ–° Corefile # éšæœºåŒ– A/AAAA/MX è®°å½•çš„é¡ºåºä»¥å®ç°è´Ÿè½½å‡è¡¡ã€‚ # å› ä¸º DNS resolver é€šå¸¸ä½¿ç”¨ç¬¬ä¸€æ¡è®°å½•ï¼Œè€Œç¬¬ä¸€æ¡è®°å½•æ˜¯éšæœºçš„ã€‚è¿™æ ·å®¢æˆ·ç«¯çš„è¯·æ±‚å°±èƒ½è¢«éšæœºåˆ†é…åˆ°å¤šä¸ªåç«¯ã€‚ loadbalance } Corefile é¦–å…ˆå®šä¹‰ DNS åŸŸï¼ŒåŸŸåçš„ä»£ç å—å†…å®šä¹‰éœ€è¦ä½¿ç”¨çš„å„ç§æ’ä»¶ã€‚æ³¨æ„è¿™é‡Œçš„æ’ä»¶é¡ºåºæ˜¯æ²¡æœ‰ä»»ä½•æ„ä¹‰çš„ï¼æ’ä»¶çš„è°ƒç”¨é“¾æ˜¯åœ¨ CoreDNS ç¼–è¯‘æ—¶å°±å®šä¹‰å¥½çš„ï¼Œä¸èƒ½åœ¨è¿è¡Œæ—¶æ›´æ”¹ã€‚ é€šè¿‡ä¸Šè¿°é…ç½®å¯åŠ¨çš„ CoreDNS æ˜¯æ— çŠ¶æ€çš„ï¼Œå®ƒä»¥ Kubernetes ApiServer ä¸ºæ•°æ®æºï¼ŒCoreDNS æœ¬èº«åªç›¸å½“äºä¸€ä¸ªæŸ¥è¯¢å™¨/ç¼“å­˜ï¼Œå› æ­¤å®ƒå¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ‰©ç¼©å®¹ã€‚ ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:8:1","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/#1-é…ç½®æ–‡ä»¶corefile"},{"categories":["tech"],"content":" 2. å°† CoreDNS è®¾ç½®æˆä¸€ä¸ªç§æœ‰ DNS æœåŠ¡å™¨ç°åœ¨æ¸…æ¥šäº† Corefile çš„ç»“æ„ï¼Œè®©æˆ‘ä»¬æ¥è®¾è®¡ä¸€ä¸ªé€šè¿‡æ–‡ä»¶é…ç½® DNS æ¡ç›®çš„ Corefile é…ç½®ï¼š corefile # å®šä¹‰å¯å¤ç”¨ Block (common) { log errors cache loop # æ£€æµ‹å¹¶åœæ­¢æ­»å¾ªç¯è§£æ } # æœ¬åœ°å¼€å‘ç¯å¢ƒçš„ DNS è§£æ dev-env.local:53 { import common # å¯¼å…¥ Block file dev-env.local { # ä»æ–‡ä»¶ `dev-env.local` ä¸­è¯»å– DNS æ•°æ® reload 30s # æ¯ 30s æ£€æŸ¥ä¸€æ¬¡é…ç½®çš„ Serialï¼Œè‹¥è¯¥å€¼æœ‰å˜æ›´åˆ™é‡è½½æ•´ä¸ª Zone çš„é…ç½®ã€‚ } } # æœ¬åœ°æµ‹è¯•ç¯å¢ƒ test-env.local:53 { import common file test-env.local { reload 30s } } # å…¶ä»– .:53 { forward . 114.114.114.114 # è§£æå…¬ç½‘åŸŸå log errors cache } ä¸Šé¢çš„ Corefile å®šä¹‰äº†ä¸¤ä¸ªæœ¬åœ°åŸŸå dev-env.local å’Œ test-env.localï¼Œå®ƒä»¬çš„ DNS æ•°æ®åˆ†åˆ«ä¿å­˜åœ¨ file æŒ‡å®šçš„æ–‡ä»¶ä¸­ã€‚ è¿™ä¸ª file æŒ‡å®šçš„æ–‡ä»¶å’Œ bind9 ä¸€æ ·ï¼Œéƒ½æ˜¯ä½¿ç”¨åœ¨rfc1035 ä¸­å®šä¹‰çš„ Master File æ ¼å¼ï¼Œdig å‘½ä»¤è¾“å‡ºçš„å°±æ˜¯è¿™ç§æ ¼å¼çš„å†…å®¹ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š text ;; èˆ‡æ•´å€‹é ˜åŸŸç›¸é—œæ€§è¼ƒé«˜çš„è¨­å®šåŒ…æ‹¬ NS, A, MX, SOA ç­‰æ¨™èªŒçš„è¨­å®šè™•ï¼ $TTL 30 @ IN SOA dev-env.local. devops.dev-env.local. ( 20200202 ; SERIALï¼Œæ¯æ¬¡ä¿®æ”¹æ­¤æ–‡ä»¶ï¼Œéƒ½åº”è¯¥åŒæ­¥ä¿®æ”¹è¿™ä¸ªã€Œç‰ˆæœ¬å·â€ï¼Œå¯å°†å®ƒè®¾ä¸ºä¿®æ”¹æ—¶é—´ã€‚ 7200 ; REFRESH 600 ; RETRY 3600000 ; EXPIRE 60) ; MINIMUM @ IN NS dns1.dev-env.local. ; DNS ä¼ºæœå™¨åç¨± dns1.dev-env.local. IN A 192.168.23.2 ; DNS ä¼ºæœå™¨ IP redis.dev-env.local. IN A 192.168.23.21 mysql.dev-env.local. IN A 192.168.23.22 elasticsearch.dev-env.local. IN A 192.168.23.23 ftp IN A 192.168.23.25 ; é€™æ˜¯ç°¡åŒ–çš„å¯«æ³•ï¼ è¯¦ç»†çš„æ ¼å¼è¯´æ˜å‚è§é³¥å“¥çš„ Linux ç§æˆ¿èœ - DNS æ­£è§£è³‡æ–™åº«æª”æ¡ˆçš„è¨­å®š test-env.local ä¹Ÿæ˜¯ä¸€æ ·çš„æ ¼å¼ï¼Œæ ¹æ®ä¸Šé¢çš„æ¨¡æ¿ä¿®æ”¹å°±è¡Œã€‚è¿™ä¸¤ä¸ªé…ç½®æ–‡ä»¶å’Œ Corefile æ”¾åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹ï¼š text root@test-ubuntu:~/dns-server# tree . â”œâ”€â”€ coredns # coredns binary â”œâ”€â”€ Corefile â”œâ”€â”€ dev-env.local â””â”€â”€ test-env.local ç„¶åé€šè¿‡ ./coredns å¯åŠ¨ corednsã€‚é€šè¿‡ dig æ£€éªŒï¼š DNS æµ‹è¯• å¯ä»¥çœ‹åˆ° ftp.dev-env.local å·²ç»è¢«æˆåŠŸè§£æäº†ã€‚ ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:8:2","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/#2-å°†-coredns-è®¾ç½®æˆä¸€ä¸ªç§æœ‰-dns-æœåŠ¡å™¨"},{"categories":["tech"],"content":" 3. å¯é€‰æ’ä»¶ï¼ˆExternal Pluginsï¼‰CoreDNS æä¾›çš„é¢„ç¼–è¯‘ç‰ˆæœ¬ï¼Œä¸åŒ…å« External Plugins ä¸­åˆ—å‡ºçš„éƒ¨åˆ†ï¼Œå¦‚æœä½ éœ€è¦ï¼Œå¯ä»¥è‡ªè¡Œä¿®æ”¹ plugin.cfgï¼Œç„¶åæ‰‹åŠ¨ç¼–è¯‘ã€‚ ä¸å¾—ä¸è¯´ Go è¯­è¨€çš„ç¼–è¯‘ï¼Œæ¯” C è¯­è¨€æ˜¯æ–¹ä¾¿å¤ªå¤šäº†ã€‚è‡ªåŠ¨æ‹‰å–ä¾èµ–ï¼Œä¸€è¡Œå‘½ä»¤ç¼–è¯‘ï¼åªè¦é…å¥½GOPROXYï¼Œå¯ç”¨å¯é€‰æ’ä»¶å…¶å®ç›¸å½“ç®€å•ã€‚ ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:8:3","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/#3-å¯é€‰æ’ä»¶external-plugins"},{"categories":["tech"],"content":" 4. è®¾ç½® DNS é›†ç¾¤å•å° DNS æœåŠ¡å™¨çš„æ€§èƒ½æ˜¯æœ‰é™çš„ï¼Œè€Œä¸”å­˜åœ¨å•ç‚¹æ•…éšœé—®é¢˜ã€‚å› æ­¤åœ¨è¦æ±‚é«˜å¯ç”¨æˆ–è€…é«˜æ€§èƒ½çš„æƒ…å†µä¸‹ï¼Œ å°±éœ€è¦è®¾ç½® DNS é›†ç¾¤ã€‚ è™½ç„¶è¯´ CoreDNS æœ¬èº«ä¹Ÿæ”¯æŒå„ç§ DNS Zone ä¼ è¾“ï¼Œä¸»ä» DNS æœåŠ¡å™¨ç­‰åŠŸèƒ½ï¼Œä¸è¿‡æˆ‘æƒ³æœ€ç®€å•çš„ï¼Œå¯èƒ½è¿˜æ˜¯ç›´æ¥ç”¨ K8sã€‚ ç›´æ¥ç”¨ ConfigMap å­˜é…ç½®ï¼Œé€šè¿‡ Deployment æ‰©å®¹å°±è¡Œï¼Œå¤šæ–¹ä¾¿ã€‚ è¦ä¿®æ”¹èµ·æ¥æ›´æ–¹ä¾¿ï¼Œè¿˜å¯ä»¥å¯ç”¨å¯é€‰æ’ä»¶ï¼šredisï¼Œç›´æ¥æŠŠé…ç½®ä»¥ json çš„å½¢å¼å­˜åœ¨ redis é‡Œï¼Œé€šè¿‡ redis-desktop-manager è¿›è¡ŒæŸ¥çœ‹ä¸ä¿®æ”¹ã€‚ ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:8:4","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/#4-è®¾ç½®-dns-é›†ç¾¤"},{"categories":["tech"],"content":" å‚è€ƒ DNS åŸç†å…¥é—¨ What Is DNS? | How DNS Works - Cloudflare What is DNS? - Amazon AWS é¸Ÿå“¥çš„ Linux ç§æˆ¿èœâ€”â€”ä¸»æ©Ÿåç¨±æ§åˆ¶è€…ï¼š DNS ä¼ºæœå™¨ CoreDNS - Manual Kubernetes - DNS for Services and Pods Kubernetes - Customizing DNS Service ","date":"2020-03-29","objectID":"/posts/about-dns-protocol/:9:0","series":["è®¡ç®—æœºç½‘ç»œç›¸å…³"],"tags":["DNS","CoreDNS","ç½‘ç»œ"],"title":"Linuxç½‘ç»œå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šåŸŸåè§£æ(DNS)â€”â€”ä»¥ CoreDNS ä¸ºä¾‹","uri":"/posts/about-dns-protocol/#å‚è€ƒ"},{"categories":["tech"],"content":" ç­¾åç®—æ³•ä»‹ç»å…·ä½“çš„ JWT ç­¾åç®—æ³•å‰ï¼Œå…ˆè§£é‡Šä¸€ä¸‹ç­¾åã€æ‘˜è¦/æŒ‡çº¹ã€åŠ å¯†è¿™å‡ ä¸ªåè¯çš„å«ä¹‰ï¼š æ•°å­—ç­¾å(Digital Signature): å°±å’Œæˆ‘ä»¬æ—¥å¸¸åŠç†å„ç§æ‰‹ç»­æ—¶éœ€è¦åœ¨æ–‡ä»¶ä¸Šç­¾ä¸Šä½ è‡ªå·±çš„åå­—ä¸€æ ·ï¼Œæ•°å­—ç­¾åçš„ä¸»è¦ç”¨é€”ä¹Ÿæ˜¯ç”¨äºèº«ä»½è®¤è¯ã€‚ æ›´å‡†ç¡®çš„è®²ï¼Œæ•°å­—ç­¾åå¯ä¿è¯æ•°æ®çš„ä¸‰ä¸ªç‰¹æ€§ï¼šçœŸå®æ€§ï¼ˆæœªè¢«ä¼ªé€ ï¼‰ã€å®Œæ•´æ€§ï¼ˆä¸å­˜åœ¨ç¼ºå¤±ï¼‰ã€ä¸å¯å¦è®¤æ€§ï¼ˆç¡®å®æ˜¯ç”±ä½ æœ¬äººè®¤å¯å¹¶ç­¾åï¼‰ æ•°å­—æ‘˜è¦(digest)/æ•°å­—æŒ‡çº¹(fingerprint): æŒ‡çš„æ˜¯æ•°æ®çš„ Hash å€¼ã€‚ åŠ å¯†ç®—æ³•ï¼šè¿™ä¸ªåº”è¯¥ä¸éœ€è¦è§£é‡Šï¼Œå°±æ˜¯å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ã€‚ã€‚ æ•°å­—ç­¾åçš„å…·ä½“å®ç°ï¼Œé€šå¸¸æ˜¯å…ˆå¯¹æ•°æ®è¿›è¡Œä¸€æ¬¡ Hash æ‘˜è¦(SHA1/SHA256/SHA512 ç­‰)ï¼Œç„¶åå†ä½¿ç”¨éå¯¹ç§°åŠ å¯†ç®—æ³•(RSA/ECDSA ç­‰)çš„ç§é’¥å¯¹è¿™ä¸ªæ‘˜è¦è¿›è¡ŒåŠ å¯†ï¼Œè¿™æ ·å¾—åˆ°çš„ç»“æœå°±æ˜¯åŸå§‹æ•°æ®çš„ä¸€ä¸ªç­¾åã€‚ ç”¨æˆ·åœ¨éªŒè¯æ•°æ®æ—¶ï¼Œåªéœ€è¦ä½¿ç”¨å…¬é’¥è§£å¯†å‡º Hash æ‘˜è¦ï¼Œç„¶åè‡ªå·±å†å¯¹æ•°æ®è¿›è¡Œä¸€æ¬¡åŒæ ·çš„æ‘˜è¦ï¼Œå¯¹æ¯”ä¸¤ä¸ªæ‘˜è¦æ˜¯å¦ç›¸åŒå³å¯ã€‚ æ³¨æ„ï¼šç­¾åç®—æ³•æ˜¯ä½¿ç”¨ç§é’¥åŠ å¯†ï¼Œç¡®ä¿å¾—åˆ°çš„ç­¾åæ— æ³•è¢«ä¼ªé€ ï¼ŒåŒæ—¶æ‰€æœ‰äººéƒ½å¯ä»¥ä½¿ç”¨å…¬é’¥è§£å¯†æ¥éªŒè¯ç­¾åã€‚è¿™å’Œæ­£å¸¸çš„æ•°æ®åŠ å¯†ç®—æ³•æ˜¯ç›¸åçš„ã€‚ï¼ˆéå¯¹ç§°åŠ å¯†ç®—æ³•æ”¯æŒä½¿ç”¨å¯†é’¥å¯¹çš„ä»»ä½•ä¸€ä¸ªåŠ å¯†æ•°æ®ï¼Œå†ç”¨å¦ä¸€ä¸ªå¯†é’¥è§£å¯†ï¼‰ å› ä¸ºæ•°å­—ç­¾åå¤šäº†éå¯¹ç§°åŠ å¯†è¿™ä¸€æ­¥ï¼Œå°±èƒ½ä¿è¯åªæœ‰æ‹¥æœ‰ç§é’¥çš„äººæ‰èƒ½ç”Ÿæˆå‡ºæ­£ç¡®çš„æ•°å­—ç­¾åï¼Œè¾¾åˆ°äº†é˜²æ­¢ä¼ªé€ ç­¾åçš„ç›®çš„ã€‚è€Œæ•°å­—æ‘˜è¦ï¼ˆHashï¼‰åˆ™è°éƒ½å¯ä»¥è®¡ç®—å‡ºæ¥ï¼Œé€šå¸¸ç”±å¯ä¿¡æ–¹å…¬å¸ƒæ•°æ®çš„ Hash å€¼ï¼Œç”¨æˆ·ä¸‹è½½æ•°æ®åï¼Œå¯é€šè¿‡ Hash å€¼å¯¹æ¯”æ¥åˆ¤æ–­æ•°æ®æ˜¯å¦æŸåï¼Œæˆ–è€…è¢«äººè°ƒåŒ…ã€‚ é‡ç‚¹åœ¨äºï¼ŒHash æ‘˜è¦å¿…é¡»ç”±å¯ä¿¡æ–¹å…¬å¸ƒå‡ºæ¥ï¼Œå¦åˆ™ä¸èƒ½ä¿è¯å®‰å…¨æ€§ã€‚è€Œæ•°å­—ç­¾åå¯ä»¥éšæ•°æ®ä¸€èµ·æä¾›ï¼Œä¸éœ€è¦æ‹…å¿ƒè¢«ä¼ªé€ ã€‚ JWT æ˜¯ç­¾åå’Œæ•°æ®ä¸€èµ·æä¾›çš„ï¼Œå› æ­¤å¿…é¡»ä½¿ç”¨ç­¾åæ‰èƒ½ä¿è¯å®‰å…¨æ€§ã€‚ P.S. åœ¨ Android/IOS å¼€å‘ä¸­ï¼Œç»å¸¸ä¼šé‡åˆ°å„ç±» API æˆ–è€… APP å•†åº—è¦æ±‚æä¾› APP çš„ç­¾åï¼Œè¿˜æŒ‡æ˜éœ€è¦çš„æ˜¯ MD5/SHA1 å€¼ã€‚è¿™ä¸ªåœ°æ–¹éœ€è¦å¡«çš„ MD5/SHA1 å€¼ï¼Œå®é™…ä¸Šåªæ˜¯ä½ ã€Œç­¾åè¯ä¹¦(=å…¬é’¥+è¯ä¹¦æ‹¥æœ‰è€…ä¿¡æ¯)ã€çš„ã€Œæ•°å­—æŒ‡çº¹/æ‘˜è¦ã€ï¼Œå’Œ JWT çš„ç­¾åä¸æ˜¯ä¸€å›äº‹ã€‚ ","date":"2020-03-03","objectID":"/posts/jwt-algorithm-key-generation/:0:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["JWT","ç®—æ³•","OpenSSL"],"title":"JWT ç­¾åç®—æ³• HS256ã€RS256 åŠ ES256 åŠå¯†é’¥ç”Ÿæˆ","uri":"/posts/jwt-algorithm-key-generation/#ç­¾åç®—æ³•"},{"categories":["tech"],"content":" å‰è¨€JWT è§„èŒƒçš„è¯¦ç»†è¯´æ˜è¯·è§ã€Œå‚è€ƒã€éƒ¨åˆ†çš„é“¾æ¥ã€‚è¿™é‡Œä¸»è¦è¯´æ˜ä¸€ä¸‹ JWT æœ€å¸¸è§çš„å‡ ç§ç­¾åç®—æ³• (JWA)ï¼šHS256(HMAC-SHA256) ã€RS256(RSA-SHA256) è¿˜æœ‰ ES256(ECDSA-SHA256)ã€‚ è¿™ä¸‰ç§ç®—æ³•éƒ½æ˜¯ä¸€ç§æ¶ˆæ¯ç­¾åç®—æ³•ï¼Œå¾—åˆ°çš„éƒ½åªæ˜¯ä¸€æ®µæ— æ³•è¿˜åŸçš„ç­¾åã€‚åŒºåˆ«åœ¨äºæ¶ˆæ¯ç­¾åä¸ç­¾åéªŒè¯éœ€è¦çš„ ã€Œkeyã€ä¸åŒã€‚ HS256 ä½¿ç”¨åŒä¸€ä¸ªã€Œsecret_keyã€è¿›è¡Œç­¾åä¸éªŒè¯ï¼ˆå¯¹ç§°åŠ å¯†ï¼‰ã€‚ä¸€æ—¦ secret_key æ³„æ¼ï¼Œå°±æ¯«æ— å®‰å…¨æ€§å¯è¨€äº†ã€‚ å› æ­¤ HS256 åªé€‚åˆé›†ä¸­å¼è®¤è¯ï¼Œç­¾åå’ŒéªŒè¯éƒ½å¿…é¡»ç”±å¯ä¿¡æ–¹è¿›è¡Œã€‚ ä¼ ç»Ÿçš„å•ä½“åº”ç”¨å¹¿æ³›ä½¿ç”¨è¿™ç§ç®—æ³•ï¼Œä½†æ˜¯è¯·ä¸è¦åœ¨ä»»ä½•åˆ†å¸ƒå¼çš„æ¶æ„ä¸­ä½¿ç”¨å®ƒï¼ RS256 æ˜¯ä½¿ç”¨ RSA ç§é’¥è¿›è¡Œç­¾åï¼Œä½¿ç”¨ RSA å…¬é’¥è¿›è¡ŒéªŒè¯ã€‚å…¬é’¥å³ä½¿æ³„æ¼ä¹Ÿæ¯«æ— å½±å“ï¼Œåªè¦ç¡®ä¿ç§é’¥å®‰å…¨å°±è¡Œã€‚ RS256 å¯ä»¥å°†éªŒè¯å§”æ‰˜ç»™å…¶ä»–åº”ç”¨ï¼Œåªè¦å°†å…¬é’¥ç»™ä»–ä»¬å°±è¡Œã€‚ ES256 å’Œ RS256 ä¸€æ ·ï¼Œéƒ½ä½¿ç”¨ç§é’¥ç­¾åï¼Œå…¬é’¥éªŒè¯ã€‚ç®—æ³•é€Ÿåº¦ä¸Šå·®è·ä¹Ÿä¸å¤§ï¼Œä½†æ˜¯å®ƒçš„ç­¾åé•¿åº¦ç›¸å¯¹çŸ­å¾ˆå¤šï¼ˆçœæµé‡ï¼‰ï¼Œå¹¶ä¸”ç®—æ³•å¼ºåº¦å’Œ RS256 å·®ä¸å¤šã€‚ å¯¹äºå•ä½“åº”ç”¨è€Œè¨€ï¼ŒHS256 å’Œ RS256 çš„å®‰å…¨æ€§æ²¡æœ‰å¤šå¤§å·®åˆ«ã€‚è€Œå¯¹äºéœ€è¦è¿›è¡Œå¤šæ–¹éªŒè¯çš„å¾®æœåŠ¡æ¶æ„è€Œè¨€ï¼Œæ˜¾ç„¶åªæœ‰ RS256/ES256 æ‰èƒ½æä¾›è¶³å¤Ÿçš„å®‰å…¨æ€§ã€‚åœ¨ä½¿ç”¨ RS256 æ—¶ï¼Œåªæœ‰ã€Œèº«ä»½è®¤è¯çš„å¾®æœåŠ¡ (auth)ã€éœ€è¦ç”¨ RSA ç§é’¥ç”Ÿæˆ JWTï¼Œå…¶ä»–å¾®æœåŠ¡ä½¿ç”¨å…¬å¼€çš„å…¬é’¥å³å¯è¿›è¡Œç­¾åéªŒè¯ï¼Œç§é’¥å¾—åˆ°äº†æ›´å¥½çš„ä¿æŠ¤ã€‚ æ›´è¿›ä¸€æ­¥ï¼Œã€ŒJWT ç”Ÿæˆã€å’Œã€ŒJWT å…¬é’¥åˆ†å‘ã€éƒ½å¯ä»¥ç›´æ¥å§”æ‰˜ç»™ç¬¬ä¸‰æ–¹çš„é€šç”¨å·¥å…·ï¼Œæ¯”å¦‚hydraã€‚ç”šè‡³ã€ŒJWT éªŒè¯ã€ä¹Ÿå¯ä»¥å§”æ‰˜ç»™ã€ŒAPI ç½‘å…³ã€æ¥å¤„ç†ï¼Œåº”ç”¨è‡ªèº«å¯ä»¥æŠŠè®¤è¯é‰´æƒå®Œå…¨å§”æ‰˜ç»™å¤–éƒ¨çš„å¹³å°ï¼Œè€Œåº”ç”¨è‡ªèº«åªéœ€è¦ä¸“æ³¨äºä¸šåŠ¡ã€‚è¿™ä¹Ÿæ˜¯ç›®å‰çš„å‘å±•è¶‹åŠ¿ã€‚ RFC 7518 - JSON Web Algorithms (JWA) ä¸­ç»™å‡ºçš„ JWT ç®—æ³•åˆ—è¡¨å¦‚ä¸‹ï¼š +--------------+-------------------------------+--------------------+ | \"alg\" Param | Digital Signature or MAC | Implementation | | Value | Algorithm | Requirements | +--------------+-------------------------------+--------------------+ | HS256 | HMAC using SHA-256 | Required | | HS384 | HMAC using SHA-384 | Optional | | HS512 | HMAC using SHA-512 | Optional | | RS256 | RSASSA-PKCS1-v1_5 using | Recommended | | | SHA-256 | | | RS384 | RSASSA-PKCS1-v1_5 using | Optional | | | SHA-384 | | | RS512 | RSASSA-PKCS1-v1_5 using | Optional | | | SHA-512 | | | ES256 | ECDSA using P-256 and SHA-256 | Recommended+ | | ES384 | ECDSA using P-384 and SHA-384 | Optional | | ES512 | ECDSA using P-521 and SHA-512 | Optional | | PS256 | RSASSA-PSS using SHA-256 and | Optional | | | MGF1 with SHA-256 | | | PS384 | RSASSA-PSS using SHA-384 and | Optional | | | MGF1 with SHA-384 | | | PS512 | RSASSA-PSS using SHA-512 and | Optional | | | MGF1 with SHA-512 | | | none | No digital signature or MAC | Optional | | | performed | | +--------------+-------------------------------+--------------------+ The use of \"+\" in the Implementation Requirements column indicates that the requirement strength is likely to be increased in a future version of the specification. ç›®å‰åº”è¯¥æ‰€æœ‰ jwt ç›¸å…³çš„åº“éƒ½æ”¯æŒ HS256/RS256/ES256 è¿™ä¸‰ç§ç®—æ³•ã€‚ ES256 ä½¿ç”¨ ECDSA è¿›è¡Œç­¾åï¼Œå®ƒçš„å®‰å…¨æ€§å’Œè¿ç®—é€Ÿåº¦ç›®å‰å’Œ RS256 å·®è·ä¸å¤§ï¼Œä½†æ˜¯æ‹¥æœ‰æ›´çŸ­çš„ç­¾åé•¿åº¦ã€‚å¯¹äºéœ€è¦é¢‘ç¹å‘é€çš„ JWT è€Œè¨€ï¼Œæ›´çŸ­çš„é•¿åº¦é•¿æœŸä¸‹æ¥å¯ä»¥èŠ‚çº¦å¤§é‡æµé‡ã€‚ å› æ­¤æ›´æ¨èä½¿ç”¨ ES256 ç®—æ³•ã€‚ ","date":"2020-03-03","objectID":"/posts/jwt-algorithm-key-generation/:0:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["JWT","ç®—æ³•","OpenSSL"],"title":"JWT ç­¾åç®—æ³• HS256ã€RS256 åŠ ES256 åŠå¯†é’¥ç”Ÿæˆ","uri":"/posts/jwt-algorithm-key-generation/#å‰è¨€"},{"categories":["tech"],"content":" ä½¿ç”¨ OpenSSL ç”Ÿæˆ RSA/ECC å…¬ç§é’¥RS256 ä½¿ç”¨ RSA ç®—æ³•è¿›è¡Œç­¾åï¼Œå¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤ç”Ÿæˆ RSA å¯†é’¥ï¼š shell # 1. ç”Ÿæˆ 2048 ä½ï¼ˆä¸æ˜¯ 256 ä½ï¼‰çš„ RSA å¯†é’¥ openssl genrsa -out rsa-private-key.pem 2048 # 2. é€šè¿‡å¯†é’¥ç”Ÿæˆå…¬é’¥ openssl rsa -in rsa-private-key.pem -pubout -out rsa-public-key.pem ES256 ä½¿ç”¨ ECDSA ç®—æ³•è¿›è¡Œç­¾åï¼Œè¯¥ç®—æ³•ä½¿ç”¨ ECC å¯†é’¥ï¼Œç”Ÿæˆå‘½ä»¤å¦‚ä¸‹ï¼š shell # 1. ç”Ÿæˆ ec ç®—æ³•çš„ç§é’¥ï¼Œä½¿ç”¨ prime256v1 æ›²çº¿ï¼ˆNIST P-256 æ ‡å‡†ï¼‰ï¼Œå¯†é’¥é•¿åº¦ 256 ä½ã€‚ï¼ˆå¼ºåº¦å¤§äº 2048 ä½çš„ RSA å¯†é’¥ï¼‰ openssl ecparam -genkey -name prime256v1 -out ecc-private-key.pem # 2. é€šè¿‡å¯†é’¥ç”Ÿæˆå…¬é’¥ openssl ec -in ecc-private-key.pem -pubout -out ecc-public-key.pem å¯†é’¥çš„ä½¿ç”¨åº”è¯¥å°±ä¸éœ€è¦ä»‹ç»äº†ï¼Œå„ç±»è¯­è¨€éƒ½æœ‰å¯¹åº” JWT åº“å¤„ç†è¿™äº›ï¼Œè¯·è‡ªè¡ŒæŸ¥çœ‹æ–‡æ¡£ã€‚ å¦‚æœæ˜¯è°ƒè¯•/å­¦ä¹  JWTï¼Œéœ€è¦æ‰‹åŠ¨ç­¾åä¸éªŒè¯çš„è¯ï¼Œæ¨èä½¿ç”¨jwt å·¥å…·ç½‘ç«™ - jwt.io ","date":"2020-03-03","objectID":"/posts/jwt-algorithm-key-generation/:1:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["JWT","ç®—æ³•","OpenSSL"],"title":"JWT ç­¾åç®—æ³• HS256ã€RS256 åŠ ES256 åŠå¯†é’¥ç”Ÿæˆ","uri":"/posts/jwt-algorithm-key-generation/#ä½¿ç”¨-openssl-ç”Ÿæˆ-rsaecc-å…¬ç§é’¥"},{"categories":["tech"],"content":" å‚è€ƒ RFC 7518 - JSON Web Algorithms (JWA) ä»€ä¹ˆæ˜¯ JWT â€“ JSON WEB TOKEN jwt å·¥å…·ç½‘ç«™ - jwt.io JWT ç®—æ³•æ¯”è¾ƒ ","date":"2020-03-03","objectID":"/posts/jwt-algorithm-key-generation/:2:0","series":["å†™ç»™å¼€å‘äººå‘˜çš„å®ç”¨å¯†ç å­¦"],"tags":["JWT","ç®—æ³•","OpenSSL"],"title":"JWT ç­¾åç®—æ³• HS256ã€RS256 åŠ ES256 åŠå¯†é’¥ç”Ÿæˆ","uri":"/posts/jwt-algorithm-key-generation/#å‚è€ƒ"},{"categories":["life","tech"],"content":" è¿Ÿåˆ°çš„å¹´ç»ˆæ€»ç»“ ","date":"2020-01-31","objectID":"/posts/2019-summary/:0:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"2019 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2019-summary/#"},{"categories":["life","tech"],"content":" é—²è¨€ç¢è¯­æˆ‘æ˜¯ä»Šå¹´å…­æœˆåº•åˆ°çš„æ·±åœ³ï¼Œè¿æ°”å¾ˆå¥½ï¼Œç¬¬ä¸€é¢å°±é¢ä¸Šäº†ç°åœ¨æ‰€åœ¨çš„å…¬å¸ï¼Œä»¥ä¸‹å°±å«å®ƒ W å…¬å¸å§ã€‚å…¬å¸çš„æŠ€æœ¯æ ˆä¹Ÿå¾ˆé€‚åˆæˆ‘ï¼Œåœ¨å…¥èŒåˆ°ç°åœ¨çš„è¿™åŠå¹´é‡Œï¼Œæˆ‘å­¦åˆ°äº†ä¸å°‘çŸ¥è¯†ã€‚ ä½†æ˜¯è¿æ°”ä¹Ÿå·®ï¼Œåªæœ‰è¿™ä¹ˆä¸€å®¶å…¬å¸çº¦äº†æˆ‘é¢è¯•ï¼ŒæŠ•çš„å…¶ä»–ç®€å†éƒ½çŸ³æ²‰å¤§æµ·â€¦ æ€»ä¹‹ï¼Œä»Šå¹´å°è¯•å‚åŠ è¿‡ä¸¤æ¬¡æŠ€æœ¯åˆ†äº«ï¼ŒRancher çš„æŠ€æœ¯æ²™é¾™ï¼Œå‰å‡ å¤©åˆå»å¬äº† OSChina çš„æºåˆ›ä¼šã€‚ ","date":"2020-01-31","objectID":"/posts/2019-summary/:1:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"2019 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2019-summary/#é—²è¨€ç¢è¯­"},{"categories":["life","tech"],"content":" æŠ€æœ¯èƒ½åŠ›æ€»ç»“æˆ‘å…¥èŒååšçš„æ˜¯è¿ç»´å¼€å‘ï¼Œä¸»è¦è´Ÿè´£é€šè¿‡ Jenkins Pipeline + Python è¿›è¡Œè‡ªåŠ¨åŒ–çš„æµ‹è¯•ã€æ„å»ºå’Œéƒ¨ç½²ï¼š æµ‹è¯•ï¼šæŒ‡ UI æµ‹è¯•ã€API æµ‹è¯•ã€å‹åŠ›æµ‹è¯•ã€‚å•å…ƒæµ‹è¯•ç®—åœ¨æ„å»ºæµç¨‹ä¸­ã€‚ æ„å»ºï¼šæ›´æ–°ä¾èµ–-\u003eå•å…ƒæµ‹è¯•-\u003eæ„å»º Library æˆ–é•œåƒ å…¬å¸çš„å†…éƒ¨ä»£ç ä½¿ç”¨åˆ†å±‚ç»“æ„ï¼Œåº•å±‚å°è£…äº†å„ç§ç¬¬ä¸‰æ–¹åŒ…ï¼Œå¹¶å®ç°äº†ä¸€äº›é€šç”¨çš„åŠŸèƒ½ï¼Œå½¢æˆäº†æ‰€è°“çš„ä¸­å°ã€‚ç›®å‰æ˜¯é€šè¿‡æ‰¹é‡ä»»åŠ¡é€çº§è‡ªä¸‹å‘ä¸Šæ„å»ºã€‚ éƒ¨ç½²ï¼šæ‰«æé•œåƒä»“åº“ä¸­å„é•œåƒï¼Œç”Ÿæˆæœ€æ–°çš„ k8s éƒ¨ç½²æ–‡ä»¶ï¼Œç„¶åè¿›è¡Œéƒ¨ç½²ã€‚ æ‰€ä»¥è¿™åŠå¹´ä¸­ï¼Œæˆ‘å·®ä¸å¤šç†Ÿæ‚‰äº†è‡ªåŠ¨åŒ–è¿ç»´çš„å·¥ä½œã€‚ä¸»è¦åŒ…æ‹¬ Jenkins Pipeline çš„ç¼–å†™ï¼Œæˆ‘ä»¬åŸºæœ¬éƒ½æ˜¯ä½¿ç”¨ Jenkins è°ƒç”¨ Python ä»£ç æ¥è¿›è¡Œå…·ä½“çš„æ„å»ºã€‚ å…¬å¸çš„æ„å»ºæœ‰å¾ˆå¤šè‡ªå·±ç‰¹æ®Šçš„éœ€æ±‚ï¼ŒJenkins è‡ªå¸¦çš„æ’ä»¶æ— æ³•æ»¡è¶³ã€‚ ç†Ÿæ‚‰äº† Python çš„ subprocess åº“ï¼Œä¸ºäº†è¿œç¨‹è°ƒç”¨ï¼Œåˆç†Ÿæ‚‰äº† fabricï¼ˆå½“ä½œ library ç”¨ï¼‰ã€‚ åšå‹æµ‹æ—¶ï¼Œç†Ÿæ‚‰äº† locust å› ä¸ºåŸºæœ¬éƒ½æ˜¯é€šè¿‡å‘½ä»¤è¡Œè¿›è¡Œæµ‹è¯•ã€æ„å»ºï¼Œæˆ‘ç°åœ¨æ¯”å‰åç«¯ç»„è¿˜ç†Ÿæ‚‰ csharp/flutter/golang çš„ cliâ€¦ å­¦ä¼šäº† Dockerfile è¯­æ³•ã€‚æˆ‘ä»¬çš„åç«¯å…¨éƒ¨éƒ½æ˜¯ä»¥å®¹å™¨æ–¹å¼éƒ¨ç½²çš„ï¼Œè¿™ä¸ªæ˜¯åŸºæœ¬æŠ€èƒ½ã€‚ ç†Ÿæ‚‰å¹¶ä¸”ç”¨ä¸Šäº† Kubernetes. è¿™ä¸œè¥¿åŸºæœ¬ä¸Šå°±æ˜¯æœªæ¥äº†ï¼Œä¹Ÿå°†æ˜¯æˆ‘çš„ä¸»æ”»æ–¹å‘ã€‚ ä½†æ˜¯ï¼Œä¹Ÿå­˜åœ¨ä¸€äº›é—®é¢˜ï¼š å¯¹ Linux/ç½‘ç»œ/vSphere ä¸å¤Ÿäº†è§£ï¼Œå¯¼è‡´æ¯æ¬¡å¤„ç†è¿™ç±»é—®é¢˜åªä¼šæ’é™¤æ³•ã€‚ å¯¹ç›‘æ§/æ—¥å¿—/å‘Šè­¦ä¸å¤Ÿäº†è§£ï¼Œç›‘æ§é¢æ¿ä¸€å †å‚æ•°å´çœ‹ä¸å‡ºé—®é¢˜ï¼Œæ—¥å¿—ä¸çŸ¥é“æ€ä¹ˆç”¨ kibana è¿›è¡Œæœç´¢ï¼Œå‘Šè­¦è¿˜æ²¡é…è¿‡ã€‚ã€‚ è§£å†³é—®é¢˜çš„èƒ½åŠ›è¿˜æœ‰å¾…æå‡ï¼Œè€ƒè™‘æ€»æ˜¯ä¸å¤Ÿå…¨é¢ï¼Œè€æ˜¯å‡ºé—®é¢˜ã€‚ï¼ˆä¸èƒ½è®©äººæ”¾å¿ƒï¼‰ æ€»æ˜¯æƒ³å¾—å¤ªå¤šï¼Œæ‹–æ…¢äº†è§£å†³é—®é¢˜çš„é€Ÿåº¦ã€‚ï¼ˆè¿™å€’ä¹Ÿä¸èƒ½å®Œå…¨ç®—æ˜¯ç¼ºç‚¹ã€‚ï¼‰ ","date":"2020-01-31","objectID":"/posts/2019-summary/:2:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"2019 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2019-summary/#æŠ€æœ¯èƒ½åŠ›æ€»ç»“"},{"categories":["life","tech"],"content":" ä»Šå¹´åœ¨æŠ€æœ¯ä¸Šçš„æ„Ÿå— Kubernetes å’Œäº‘åŸç”Ÿæ­£åœ¨å¸­å·æ•´ä¸ªäº’è”ç½‘/ç‰©è”ç½‘è¡Œä¸šã€‚ Kubernetes ç›®å‰ä¸»è¦ç”¨äº Stateless åº”ç”¨ï¼Œé‚£åç«¯çš„ æ•°æ®åº“/ç¼“å­˜/æ¶ˆæ¯æœåŠ¡ è¦å¦‚ä½•åšåˆ†å¸ƒå¼å‘¢ï¼Ÿè¿™ä¹Ÿæ˜¯å¤§å®¶å…³æ³¨çš„é‡ç‚¹ã€‚ åˆ†å¸ƒå¼ã€å¾®æœåŠ¡æ¨¡å¼ä¸‹çš„ç›‘æ§(prometheus)ã€æ—¥å¿—åˆ†æ(elk)ã€å®‰å…¨ã€é“¾è·¯è¿½è¸ª(jaeger)ï¼Œæ˜¯è¿ç»´å…³æ³¨çš„é‡ç‚¹ã€‚ æœåŠ¡ç½‘æ ¼æ­£åœ¨èµ°å‘æˆç†Ÿï¼ŒIstio å¾ˆå€¼å¾—å­¦ä¹ å’Œè¯•ç”¨ã€‚ å¼€æºçš„åˆ†å¸ƒå¼æ•°æ®åº“/äº‘æ•°æ®åº“æˆä¸ºè¶Šæ¥è¶Šå¤šä¼ä¸šçš„é€‰æ‹©ï¼Œå¼€æºçš„ TiDBï¼ˆHTAPï¼‰å’Œé˜¿é‡Œäº‘çš„ PolarDBï¼ˆè®¡ç®—å­˜å‚¨åˆ†ç¦»ï¼‰éƒ½åº”è¯¥äº†è§£äº†è§£ã€‚ Transaction Processing: é¢å‘äº¤æ˜“ï¼Œæ•°æ®çš„å˜åŠ¨(å¢åˆ æ”¹)å¤šï¼Œæ¶‰åŠçš„æ•°æ®é‡å’Œè®¡ç®—é‡(æŸ¥) å°‘ï¼Œå®æ—¶æ€§è¦æ±‚é«˜ã€‚ Analytical Processingï¼šé¢å‘åˆ†æï¼Œæ•°æ®çš„å˜åŠ¨å°‘ï¼Œä½†æ¶‰åŠçš„æ•°æ®é‡å’Œè®¡ç®—é‡å¾ˆå¤šï¼ HTAPï¼ˆHybrid transaction/analytical processingï¼‰ï¼šæ··åˆå‹æ•°æ®åº“ï¼Œå¯åŒæ—¶è¢«ç”¨äºä¸Šè¿°ä¸¤ç§åœºæ™¯ã€‚ Knative/Jenkins-X è¿™ç±» Serverless çš„ CI/CD ä¹Ÿæ­£åœ¨å¿«é€Ÿå‘å±•ï¼Œéœ€è¦æ·±å…¥è°ƒç ”ã€‚ ","date":"2020-01-31","objectID":"/posts/2019-summary/:3:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"2019 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2019-summary/#ä»Šå¹´åœ¨æŠ€æœ¯ä¸Šçš„æ„Ÿå—"},{"categories":["life","tech"],"content":" æ˜å¹´çš„å±•æœ›ä½œä¸ºä¸€åèŒæ–°è¿ç»´å¼€å‘ï¼Œæ˜å¹´æ˜¾ç„¶è¿˜è¦ç»§ç»­åœ¨è¿™æ¡è·¯ä¸Šç»§ç»­å‘å‰ã€‚ æˆ‘æ˜å¹´çš„ä»»åŠ¡ï¼Œç¬¬ä¸€ä»¶ï¼Œå°±æ˜¯ä¼˜åŒ–æ‰éƒ¨åˆ†è‡ªå·±ç›®å‰å­˜åœ¨çš„é—®é¢˜ï¼ˆå‰é¢æœ‰æåˆ°ï¼‰ï¼Œç¬¬äºŒå‘¢ï¼Œå°±æ˜¯ç´§è·ŸæŠ€æœ¯æ½®æµã€‚é‡ç‚¹æœ‰ä¸‹é¢å‡ é¡¹ï¼š å……å®è‡ªå·±ç½‘ç»œéƒ¨åˆ†æ¬ ç¼ºçš„çŸ¥è¯†ï¼Œå°¤å…¶æ˜¯ DNS è§£æ(CoreDNS)å’Œ NAT(iptables)è¿™ä¿©ç©æ„å„¿ã€‚ å­¦ä¹ æ•°æ®åº“ç»„ä»¶çš„ä½¿ç”¨å’Œæ€§èƒ½è°ƒä¼˜ï¼šMySQL/Redis/ElasticSearch/MongoDBï¼Œå¦å¤–ç†Ÿæ‚‰ PostgreSQL å’Œåˆ†å¸ƒå¼æ•°æ®åº“ TiDB/Vitess Kubernetes/Istio Kubernetes ä¸Šçš„ CI/CDï¼šKnative,Istio-GitOps ç›‘æ§å‘Šè­¦ï¼šPrometheus/Grafana æ€»ç»“ä¸€å¥—æ•…éšœæ’é™¤çš„æ–¹æ³•è®ºï¼šç½‘ç»œæ•…éšœã€CPU/RAM/Disk æ€§èƒ½å¼‚å¸¸ç­‰ã€åº”ç”¨æ•…éšœç­‰ã€‚ æœ€é‡è¦çš„ä»»åŠ¡ï¼Œæ˜¯ç»´æŠ¤å…¬å¸è¿™ä¸€å¥—å¾®æœåŠ¡åœ¨é˜¿é‡Œäº‘ä¸Šçš„æ­£å¸¸è¿è¡Œï¼Œç§¯ç´¯ç»éªŒã€‚ å…³æ³¨ CNCF è“å›¾ ä¸Šçš„å„é¡¹æ–°æŠ€æœ¯ã€‚ å¦å¤–å‘¢ï¼Œå°±æ˜¯å¼€å‘æ–¹é¢çš„ä»»åŠ¡ï¼š è®¾è®¡æ¨¡å¼åº”è¯¥è¦å­¦å­¦äº†ï¼ Python ä¸èƒ½æ­¢æ­¥äºæ­¤ï¼Œè¦åˆ¶å®šæºç å­¦ä¹ è®¡åˆ’ã€‚ å­¦ä¹  C# è¯­è¨€ï¼Œé˜…è¯»å…¬å¸çš„æºç ï¼Œç†Ÿæ‚‰ä¼ä¸šçº§çš„ä¸šåŠ¡ä»£ç ã€‚ å­¦ä¹  go è¯­è¨€ï¼Œç”¨äº DevOpsã€‚ï¼ˆå…¶å®è¿˜æƒ³å­¦ rustï¼Œä¸è¿‡æ˜å¹´å¯èƒ½æ²¡æ—¶é—´ï¼‰ è¦æŠŠ xhup é‚£ä¸ªé¡¹ç›®å®Œæˆï¼Œä¹Ÿä¸çŸ¥é“èƒ½ä¸èƒ½æŠ½å‡ºæ—¶é—´ã€‚ã€‚ ","date":"2020-01-31","objectID":"/posts/2019-summary/:4:0","series":["å¹´ç»ˆæ€»ç»“"],"tags":["æ€»ç»“"],"title":"2019 å¹´å¹´ç»ˆæ€»ç»“","uri":"/posts/2019-summary/#æ˜å¹´çš„å±•æœ›"},{"categories":["tech"],"content":" Pod å¸¸è§é”™è¯¯ OOMKilled: Pod çš„å†…å­˜ä½¿ç”¨è¶…å‡ºäº† resources.limits ä¸­çš„é™åˆ¶ï¼Œè¢«å¼ºåˆ¶æ€æ­»ã€‚ SandboxChanged: Pod sandbox changed, it will be killed and re-created: å¾ˆå¯èƒ½æ˜¯ç”±äºå†…å­˜é™åˆ¶å¯¼è‡´å®¹å™¨è¢« OOMKilledï¼Œæˆ–è€…å…¶ä»–èµ„æºä¸è¶³ å¦‚æœæ˜¯ OOMï¼Œå®¹å™¨é€šå¸¸ä¼šè¢«é‡å¯ï¼Œkubectl describe èƒ½çœ‹åˆ°å®¹å™¨ä¸Šæ¬¡è¢«é‡å¯çš„åŸå› State.Last State.Reason = OOMKilled, Exit Code=137. Pod ä¸æ–­è¢«é‡å¯ï¼Œkubectl describe æ˜¾ç¤ºé‡å¯åŸå› State.Last State.Reason = Error, Exit Code=137ï¼Œ137 å¯¹åº” SIGKILL(kill -9) ä¿¡å·ï¼Œè¯´æ˜å®¹å™¨è¢«å¼ºåˆ¶é‡å¯ã€‚å¯èƒ½çš„åŸå› ï¼š æœ€æœ‰å¯èƒ½çš„åŸå› æ˜¯ï¼Œå­˜æ´»æ¢é’ˆï¼ˆlivenessProbeï¼‰æ£€æŸ¥å¤±è´¥ èŠ‚ç‚¹èµ„æºä¸è¶³ï¼Œå†…æ ¸å¼ºåˆ¶å…³é—­äº†è¿›ç¨‹ä»¥é‡Šæ”¾èµ„æºï¼Œè¿™ç§æƒ…å†µå¯ä»¥é€šè¿‡ journalctl -k æŸ¥çœ‹è¯¦ç»†çš„ç³»ç»Ÿæ—¥å¿—ã€‚ CrashLoopBackoff: Pod è¿›å…¥ å´©æºƒ-é‡å¯å¾ªç¯ï¼Œé‡å¯é—´éš”æ—¶é—´ä» 10 20 40 80 ä¸€ç›´ç¿»å€åˆ°ä¸Šé™ 300 ç§’ï¼Œç„¶åä»¥ 300 ç§’ä¸ºé—´éš”æ— é™é‡å¯ã€‚ Pod ä¸€ç›´ Pending: è¿™è¯´æ˜æ²¡æœ‰ä»»ä½•èŠ‚ç‚¹èƒ½æ»¡è¶³ Pod çš„è¦æ±‚ï¼Œå®¹å™¨æ— æ³•è¢«è°ƒåº¦ã€‚æ¯”å¦‚ç«¯å£è¢«åˆ«çš„å®¹å™¨ç”¨ hostPort å ç”¨ï¼ŒèŠ‚ç‚¹æœ‰æ±¡ç‚¹ç­‰ã€‚ FailedCreateSandBox: Failed create pod sandbox: rpc error: code = DeadlineExceeded desc = context deadline exceededï¼š å¾ˆå¯èƒ½æ˜¯ CNI ç½‘ç»œæ’ä»¶çš„é—®é¢˜ï¼ˆæ¯”å¦‚ ip åœ°å€æº¢å‡ºï¼‰ï¼Œ FailedSync: error determining status: rpc error: code = DeadlineExceeded desc = context deadline exceeded: å¸¸å’Œå‰ä¸¤ä¸ªé”™è¯¯å…ˆåå‡ºç°ï¼Œå¾ˆå¯èƒ½æ˜¯ CNI ç½‘ç»œæ’ä»¶çš„é—®é¢˜ã€‚ å¼€å‘é›†ç¾¤ï¼Œä¸€æ¬¡æ€§éƒ¨ç½²æ‰€æœ‰æœåŠ¡æ—¶ï¼Œå„ Pod äº’ç›¸äº‰æŠ¢èµ„æºï¼Œå¯¼è‡´ Pod ç”Ÿå­˜æ¢é’ˆå¤±è´¥ï¼Œä¸æ–­é‡å¯ï¼Œ é‡å¯è¿›ä¸€æ­¥åŠ é‡èµ„æºä½¿ç”¨ã€‚æ¶æ€§å¾ªç¯ã€‚ éœ€è¦ç»™æ¯ä¸ª Pod åŠ ä¸Š resources.requestsï¼Œè¿™æ ·èµ„æºä¸è¶³æ—¶ï¼Œåç»­ Pod ä¼šåœæ­¢è°ƒåº¦ï¼Œç›´åˆ°èµ„æºæ¢å¤æ­£å¸¸ã€‚ Pod å‡ºç°å¤§é‡çš„ Failed è®°å½•ï¼ŒDeployment ä¸€ç›´é‡å¤å»ºç«‹ Pod: é€šè¿‡kubectl describe/edit pod \u003cpod-name\u003e æŸ¥çœ‹ pod Events å’Œ Statusï¼Œä¸€èˆ¬ä¼šçœ‹åˆ°å¤±è´¥ä¿¡æ¯ï¼Œå¦‚èŠ‚ç‚¹å¼‚å¸¸å¯¼è‡´ Pod è¢«é©±é€ã€‚ Kubernetes é—®é¢˜æ’æŸ¥ï¼šPod çŠ¶æ€ä¸€ç›´ Terminating åˆ›å»ºäº† Deployment åï¼Œå´æ²¡æœ‰è‡ªåŠ¨åˆ›å»º Pod: ç¼ºå°‘æŸäº›åˆ›å»º Pod å¿…è¦çš„ä¸œè¥¿ï¼Œæ¯”å¦‚è®¾å®šçš„ ServiceAccount ä¸å­˜åœ¨ã€‚ Pod è¿è¡Œå¤±è´¥ï¼ŒçŠ¶æ€ä¸º MatchNodeSelector: å¯¹ä¸»èŠ‚ç‚¹è¿›è¡Œå…³æœºã€è¿ç§»ç­‰æ“ä½œï¼Œå¯¼è‡´ä¸»è°ƒåº¦å™¨ä¸‹çº¿æ—¶ï¼Œä¼šåœ¨ä¸€æ®µæ—¶é—´å†…å¯¼è‡´ Pod è°ƒåº¦å¤±è´¥ï¼Œè°ƒåº¦å¤±è´¥ä¼šæŠ¥è¿™ä¸ªé”™ã€‚ Pod ä»ç„¶å­˜åœ¨ï¼Œä½†æ˜¯ Service çš„ Endpoints å´ä¸ºç©ºï¼Œæ‰¾ä¸åˆ°å¯¹åº”çš„ Pod IPs: é‡åˆ°è¿‡ä¸€æ¬¡ï¼Œæ˜¯å› ä¸ºæ—¶é—´è·³å˜ï¼ˆä»æœªæ¥çš„æ—¶é—´æ”¹å›äº†å½“å‰æ—¶é—´ï¼‰å¯¼è‡´çš„é—®é¢˜ã€‚ Pod æ— æ³•è°ƒåº¦ï¼ŒæŠ¥é”™ x node(s) had volume node affinity conflict: è¯´æ˜è¯¥ pod æ‰€ç»‘å®šçš„ PV æœ‰ nodeAffinity æ— æ³•æ»¡è¶³ï¼Œå¯ä»¥ check å¯¹åº”çš„ PV yaml. é€šå¸¸åŸå› æ˜¯ PV æ‰€åœ¨çš„å¯ç”¨åŒºï¼Œæ²¡æœ‰å¯ç”¨çš„èŠ‚ç‚¹ï¼Œå¯¼è‡´ Pod æ— æ³•è°ƒåº¦ã€‚ æœ€ç®€å•çš„è§£å†³æ–¹æ³•æ˜¯ï¼Œåœ¨å¯¹åº”çš„å¯ç”¨åŒºè¡¥å……èŠ‚ç‚¹ å¦‚æœæ•°æ®å¯ä»¥ä¸¢ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘ç›´æ¥åˆ é™¤é‡å»º PV/PVC ","date":"2019-11-24","objectID":"/posts/kubernetes-common-errors-and-solutions/:1:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes"],"title":"Kubernetes å¸¸è§é”™è¯¯ã€åŸå› åŠå¤„ç†æ–¹æ³•","uri":"/posts/kubernetes-common-errors-and-solutions/#pod-å¸¸è§é”™è¯¯"},{"categories":["tech"],"content":" æ§åˆ¶é¢æ•…éšœå¯èƒ½ä¼šå¯¼è‡´å„ç±»å¥‡æ€ªçš„å¼‚å¸¸ç°è±¡å¯¹äºç”Ÿäº§ç¯å¢ƒçš„é›†ç¾¤ï¼Œå› ä¸ºæœ‰é«˜å¯ç”¨ï¼Œé€šå¸¸æˆ‘ä»¬æ¯”è¾ƒå°‘é‡åˆ°æ§åˆ¶é¢æ•…éšœé—®é¢˜ã€‚ä½†æ˜¯ä¸€æ—¦æ§åˆ¶é¢å‘ç”Ÿæ•…éšœï¼Œå°±å¯èƒ½ä¼šå¯¼è‡´å„ç±»å¥‡æ€ªçš„å¼‚å¸¸ç°è±¡ã€‚å¦‚æœèƒ½åœ¨æ’æŸ¥é—®é¢˜æ—¶ï¼ŒæŠŠæ§åˆ¶é¢å¼‚å¸¸è€ƒè™‘è¿›æ¥ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°±èƒ½èŠ‚çº¦å¤§é‡çš„æ’æŸ¥æ—¶é—´ï¼Œå¿«é€Ÿå®šä½åˆ°é—®é¢˜ã€‚ å…¶ä¸­æ¯”è¾ƒéšæ™¦çš„å°±æ˜¯ controller-manager æ•…éšœå¯¼è‡´çš„å¼‚å¸¸ï¼š èŠ‚ç‚¹çš„æœåŠ¡å™¨å·²ç»è¢«ç»ˆæ­¢ï¼Œä½†æ˜¯ Kubernetes é‡Œè¿˜æ˜¾ç¤º node ä¸º Ready çŠ¶æ€ï¼Œä¸ä¼šæ›´æ–°ä¸º NotReady. è¢«åˆ é™¤çš„ Pods å¯èƒ½ä¼šå¡åœ¨ Terminating çŠ¶æ€ï¼Œåªæœ‰å¼ºåˆ¶åˆ é™¤æ‰èƒ½åˆ é™¤æ‰å®ƒä»¬ã€‚å¹¶ä¸”ç¡®è®¤ Pod æ²¡æœ‰ metadata.finalizers å±æ€§ HPA çš„åŠ¨æ€ä¼¸ç¼©åŠŸèƒ½å¤±æ•ˆ â€¦ å¦‚æœè¿™äº›ç°è±¡åŒæ—¶å‘ç”Ÿï¼Œå°±è¦æ€€ç–‘æ˜¯å¦æ˜¯ kube-controller-manager å‡ºé—®é¢˜äº†. æœ€ç®€å•çš„æ’æŸ¥å‘½ä»¤ï¼š bash $ kubectl get componentstatuses Warning: v1 ComponentStatus is deprecated in v1.19+ NAME STATUS MESSAGE ERROR scheduler Healthy ok controller-manager Healthy ok etcd-0 Healthy ok # ç±»ä¼¼è¿™ç§é”™è¯¯ $ kubectl events --types=Warning -n your-namespace LAST SEEN TYPE REASON OBJECT MESSAGE 56m Warning UpdateLoadBalancerFailed Service/xxx-xxx Error updating load balancer with new hosts [xxx-4-3dsiuh \u003c1 more\u003e], error: failed to update load-balancer with ID xxx: xxx error å¦‚æœä¸‰ä¸ªç»„ä»¶ä»»ä¸€ä¸ªæ˜¾ç¤º Unhealthyï¼Œå°±èƒ½ç¡®å®šæ˜¯æ§åˆ¶é¢å‡ºç°äº†é—®é¢˜ã€‚ è¿™ä¸ª API å·²è¢«åºŸå¼ƒï¼Œæœ‰äººå»ºè®®ä½¿ç”¨ kubectl get --raw='/readyz?verbose' æ¥æ›¿ä»£ã€‚ä½†æˆ‘å®æµ‹å‘ç°å³ä½¿è¿™ä¸ªå‘½ä»¤è¿”å›å…¨éƒ½ OKï¼Œä½† controller-manager/scheduler ä»æ—§å¯èƒ½å‡ºé—®é¢˜ã€‚ å…¶ä»–æ§åˆ¶é¢å¼‚å¸¸çš„è¯¦ç»†åˆ†æï¼Œå‚è§kubernetes æ§åˆ¶é¢æ•…éšœç°è±¡åŠåˆ†æ ","date":"2019-11-24","objectID":"/posts/kubernetes-common-errors-and-solutions/:1:1","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes"],"title":"Kubernetes å¸¸è§é”™è¯¯ã€åŸå› åŠå¤„ç†æ–¹æ³•","uri":"/posts/kubernetes-common-errors-and-solutions/#æ§åˆ¶é¢æ•…éšœå¯èƒ½ä¼šå¯¼è‡´å„ç±»å¥‡æ€ªçš„å¼‚å¸¸ç°è±¡"},{"categories":["tech"],"content":" Pod æ— æ³•åˆ é™¤å¯èƒ½æ˜¯æŸäº›èµ„æºæ— æ³•è¢«GCï¼Œè¿™ä¼šå¯¼è‡´å®¹å™¨å·²ç» Exited äº†ï¼Œä½†æ˜¯ Pod ä¸€ç›´å¤„äº Terminating çŠ¶æ€ã€‚ è¿™ä¸ªé—®é¢˜åœ¨ç½‘ä¸Šèƒ½æœåˆ°å¾ˆå¤šæ¡ˆä¾‹,ä½†å¤§éƒ½åªæ˜¯æä¾›äº†å¦‚ä¸‹çš„å¼ºåˆ¶æ¸…ç†å‘½ä»¤ï¼Œæœªåˆ†æå…·ä½“åŸå› ï¼š shell kubectl delete pods \u003cpod\u003e --grace-period=0 --force æœ€è¿‘æ‰¾åˆ°å‡ ç¯‡è¯¦ç»†çš„åŸå› åˆ†ææ–‡ç« ï¼Œå€¼å¾—ä¸€çœ‹ï¼š è…¾è®¯äº‘åŸç”Ÿ -ã€Pod TerminatingåŸå› è¿½è¸ªç³»åˆ—ã€‘ä¹‹ containerd ä¸­è¢«æ¼æ‰çš„ runc é”™è¯¯ä¿¡æ¯ è…¾è®¯äº‘åŸç”Ÿ -ã€Pod TerminatingåŸå› è¿½è¸ªç³»åˆ—ä¹‹äºŒã€‘execè¿æ¥æœªå…³é—­å¯¼è‡´çš„äº‹ä»¶é˜»å¡ è…¾è®¯äº‘åŸç”Ÿ -ã€Pod TerminatingåŸå› è¿½è¸ªç³»åˆ—ä¹‹ä¸‰ã€‘è®©dockeräº‹ä»¶å¤„ç†ç½¢å·¥çš„cancelçŠ¶æ€ç  Pod terminating - é—®é¢˜æ’æŸ¥ - KaKu Li å¤§è‡´æ€»ç»“ä¸€ä¸‹ï¼Œä¸»è¦åŸå› æ¥è‡ª docker 18.06 ä»¥åŠ kubernetes çš„ docker-shim è¿è¡Œæ—¶çš„åº•å±‚é€»è¾‘ï¼Œ å·²ç»åœ¨æ–°ç‰ˆæœ¬è¢«ä¿®å¤äº†ã€‚ ","date":"2019-11-24","objectID":"/posts/kubernetes-common-errors-and-solutions/:1:2","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes"],"title":"Kubernetes å¸¸è§é”™è¯¯ã€åŸå› åŠå¤„ç†æ–¹æ³•","uri":"/posts/kubernetes-common-errors-and-solutions/#pod-æ— æ³•åˆ é™¤"},{"categories":["tech"],"content":" initContainers ä¸æ–­ restartï¼Œä½†æ˜¯ Containers å´éƒ½æ˜¾ç¤ºå·² readyKubernetes åº”è¯¥ç¡®ä¿æ‰€æœ‰ initContainers éƒ½ Completedï¼Œç„¶åæ‰èƒ½å¯åŠ¨ Containers. ä½†æ˜¯æˆ‘ä»¬å‘ç°æœ‰ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œæ‰€æœ‰åŒ…å« initContainers çš„ Podï¼ŒçŠ¶æ€å…¨éƒ½æ˜¯Init:CrashLoopBackOff æˆ–è€… Init:Error. è€Œä¸”è¿›ä¸€æ­¥ kubectl describe po æŸ¥çœ‹ç»†èŠ‚ï¼Œå‘ç° initContainer çš„çŠ¶æ€ä¸º: text ... State: Waiting Reason: CrashLoopBackOff Last State: Terminated Reason: Error Exit Code: 2 Started: Tue, 03 Aug 2021 06:02:42 +0000 Finished: Tue, 03 Aug 2021 06:02:42 +0000 Ready: False Restart Count: 67 ... è€Œ Containers çš„çŠ¶æ€å±…ç„¶æ˜¯ ready: text ... Host Port: 0/TCP State: Running Started: Tue, 03 Aug 2021 00:35:30 +0000 Ready: True Restart Count: 0 ... initContainers è¿˜æœªè¿è¡ŒæˆåŠŸï¼Œè€Œ Containers å´ Ready äº†ï¼Œéå¸¸ç–‘æƒ‘ã€‚ ä»”ç»†æƒ³äº†ä¸‹ï¼Œæ—©ä¸Šå› ä¸ºç£ç›˜ä½™é‡å‘Šè­¦ï¼Œæœ‰æ‰‹åŠ¨è¿è¡Œè¿‡ docker system prune å‘½ä»¤ï¼Œé‚£ä¹ˆé—®é¢˜å¯èƒ½å°±æ˜¯è¿™æ¡å‘½ä»¤æ¸…ç†æ‰äº†å·²ç» exited çš„ initContainers å®¹å™¨ï¼Œå¯¼è‡´ k8s æ•…éšœï¼Œä¸æ–­å°è¯•é‡å¯è¯¥å®¹å™¨ã€‚ ç½‘ä¸Šä¸€æœç¡®å®æœ‰ç›¸å…³çš„ä¿¡æ¯ï¼š https://stackoverflow.com/questions/62333064/cant-delete-exited-init-container https://github.com/kubernetes/kubernetes/issues/62362 ç»“è®ºï¼šä½¿ç”¨å¤–éƒ¨çš„åƒåœ¾æ¸…ç†å‘½ä»¤å¯èƒ½å¯¼è‡´ k8s è¡Œä¸ºå¼‚å¸¸ã€‚ ","date":"2019-11-24","objectID":"/posts/kubernetes-common-errors-and-solutions/:1:3","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes"],"title":"Kubernetes å¸¸è§é”™è¯¯ã€åŸå› åŠå¤„ç†æ–¹æ³•","uri":"/posts/kubernetes-common-errors-and-solutions/#initcontainers-ä¸æ–­-restartä½†æ˜¯-containers-å´éƒ½æ˜¾ç¤ºå·²-ready"},{"categories":["tech"],"content":" èŠ‚ç‚¹å¸¸è§é”™è¯¯ DiskPressureï¼š èŠ‚ç‚¹çš„å¯ç”¨ç©ºé—´ä¸è¶³ã€‚ï¼ˆé€šè¿‡df -h æŸ¥çœ‹ï¼Œä¿è¯å¯ç”¨ç©ºé—´ä¸å°äº 15%ï¼‰ The node was low on resource: ephemeral-storage: åŒä¸Šï¼ŒèŠ‚ç‚¹çš„å­˜å‚¨ç©ºé—´ä¸å¤Ÿäº†ã€‚ èŠ‚ç‚¹å­˜å‚¨å‘Šè­¦å¯èƒ½çš„åŸå› ï¼š kubelet çš„èµ„æº GC è®¾ç½®æœ‰é—®é¢˜ï¼Œé—ç•™çš„é•œåƒç­‰èµ„æºæœªåŠæ—¶ GC å¯¼è‡´å‘Šè­¦ å­˜åœ¨è¿è¡Œçš„ pod ä½¿ç”¨äº†å¤§é‡å­˜å‚¨ç©ºé—´ï¼Œåœ¨èŠ‚ç‚¹ä¸Šé€šè¿‡ docker ps -a --size | grep G å¯ä»¥æŸ¥çœ‹åˆ° å¦‚æœä½¿ç”¨çš„æ˜¯ EKSï¼Œå¹¶ä¸”ç£ç›˜å‘Šè­¦çš„æŒ‚è½½ç‚¹ä¸º/var/lib/kubelet/plugins/kubernetes.io/aws-ebs/mounts/aws/us-east-1b/vol-xxxxx æ˜¾ç„¶æ˜¯ EBS å­˜å‚¨å·å¿«æ»¡äº†å¯¼è‡´çš„ å¯é€šè¿‡ kubectl get pv -A -o yaml | grep -C 30 vol-xxxxx æ¥å®šä½åˆ°å…·ä½“çš„å­˜å‚¨å· ","date":"2019-11-24","objectID":"/posts/kubernetes-common-errors-and-solutions/:2:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes"],"title":"Kubernetes å¸¸è§é”™è¯¯ã€åŸå› åŠå¤„ç†æ–¹æ³•","uri":"/posts/kubernetes-common-errors-and-solutions/#èŠ‚ç‚¹å¸¸è§é”™è¯¯"},{"categories":["tech"],"content":" ç½‘ç»œå¸¸è§é”™è¯¯","date":"2019-11-24","objectID":"/posts/kubernetes-common-errors-and-solutions/:3:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes"],"title":"Kubernetes å¸¸è§é”™è¯¯ã€åŸå› åŠå¤„ç†æ–¹æ³•","uri":"/posts/kubernetes-common-errors-and-solutions/#ç½‘ç»œå¸¸è§é”™è¯¯"},{"categories":["tech"],"content":" 1. Ingress/Istio Gateway è¿”å›å€¼ 404ï¼šä¸å­˜åœ¨è¯¥ Service/Istio Gatewayï¼Œæˆ–è€…æ˜¯æœåŠ¡è‡ªèº«è¿”å› 404 500ï¼šå¤§æ¦‚ç‡æ˜¯æœåŠ¡è‡ªèº«çš„é”™è¯¯å¯¼è‡´ 500ï¼Œå°æ¦‚ç‡æ˜¯ä»£ç†ï¼ˆSidecar/Ingress ç­‰ï¼‰çš„é”™è¯¯ 503ï¼šæœåŠ¡ä¸å¯ç”¨ï¼Œæœ‰å¦‚ä¸‹å‡ ç§å¯èƒ½çš„åŸå› ï¼š Service å¯¹åº”çš„ Pods ä¸å­˜åœ¨ï¼Œendpoints ä¸ºç©º Service å¯¹åº”çš„ Pods å…¨éƒ¨éƒ½ NotReadyï¼Œå¯¼è‡´ endpoints ä¸ºç©º ä¹Ÿæœ‰å¯èƒ½æ˜¯æœåŠ¡è‡ªèº«å‡ºé”™è¿”å›çš„ 503 å¦‚æœä½ ä½¿ç”¨äº† envoy sidecarï¼Œ 503 å¯èƒ½çš„åŸå› å°±å¤šäº†ã€‚åŸºæœ¬ä¸Š sidecar ä¸ä¸»å®¹å™¨é€šä¿¡è¿‡ç¨‹ä¸­çš„ä»»ä½•é—®é¢˜éƒ½ä¼šä½¿ envoy è¿”å› 503ï¼Œä½¿å®¢æˆ·ç«¯é‡è¯•ã€‚ è¯¦è§ Istioï¼š503ã€UC å’Œ TCP 502ï¼šBad Gatewayï¼Œé€šå¸¸æ˜¯ç”±äºä¸Šæ¸¸æœªè¿”å›æ­£ç¡®çš„å“åº”å¯¼è‡´çš„ï¼Œå¯èƒ½çš„æ ¹æœ¬åŸå› ï¼š åº”ç”¨ç¨‹åºæœªæ­£ç¡®å¤„ç† SIGTERM ä¿¡å·ï¼Œåœ¨è¯·æ±‚æœªå¤„ç†å®Œæ¯•æ—¶ç›´æ¥ç»ˆæ­¢äº†è¿›ç¨‹ã€‚è¯¦è§ä¼˜é›…åœæ­¢ï¼ˆGracful Shutdownï¼‰ä¸ 502/504 æŠ¥é”™ - K8s æœ€ä½³å®è·µ ç½‘ç»œæ’ä»¶ bug 504ï¼šç½‘å…³è¯·æ±‚ upstream è¶…æ—¶ï¼Œä¸»è¦æœ‰ä¸¤ç§å¯èƒ½ è€ƒè™‘æ˜¯ä¸æ˜¯ Ingress Controller çš„ IP åˆ—è¡¨æœªæ›´æ–°ï¼Œå°†è¯·æ±‚ä»£ç†åˆ°äº†ä¸å­˜åœ¨çš„ ipï¼Œå¯¼è‡´å¾—ä¸åˆ°å“åº” Service Endpoints ç§»é™¤ä¸å¤ŸåŠæ—¶ï¼Œåœ¨ Pod å·²ç»è¢«ç»ˆæ­¢åï¼Œä»ç„¶æœ‰ä¸ªåˆ«è¯·æ±‚è¢«è·¯ç”±åˆ°äº†è¯¥ Podï¼Œå¾—ä¸åˆ°å“åº”å¯¼è‡´ 504ã€‚è¯¦è§ä¼˜é›…åœæ­¢ï¼ˆGracful Shutdownï¼‰ä¸ 502/504 æŠ¥é”™ - K8s æœ€ä½³å®è·µ Pod å“åº”å¤ªæ…¢ï¼Œä»£ç é—®é¢˜ å†æ€»ç»“ä¸€ä¸‹å¸¸è§çš„å‡ ç§é”™è¯¯ï¼š æœªè®¾ç½®ä¼˜é›…åœæ­¢ï¼Œå¯¼è‡´ Pod è¢«é‡æ–°ç»ˆæ­¢æ—¶ï¼Œæœ‰æ¦‚ç‡å‡ºç° 502/504 æœåŠ¡çš„æ‰€æœ‰ Pods çš„çŠ¶æ€åœ¨ã€Œå°±ç»ªã€å’Œã€Œæœªå°±ç»ªã€ä¹‹é—´æ‘†åŠ¨ï¼Œå¯¼è‡´é—´æ­‡æ€§åœ°å‡ºç°å¤§é‡ 503 é”™è¯¯ æœåŠ¡è¿”å› 5xx é”™è¯¯å¯¼è‡´å®¢æˆ·ç«¯ä¸æ–­é‡è¯•ï¼Œè¯·æ±‚æµé‡è¢«æ”¾å¤§ï¼Œå¯¼è‡´æœåŠ¡ä¸€ç›´èµ·ä¸æ¥ è§£å†³åŠæ³•ï¼šé™æµã€ç†”æ–­ï¼ˆç½‘å…³å±‚ç›´æ¥è¿”å›å›ºå®šçš„ç›¸åº”å†…å®¹ï¼‰ Ingress ç›¸å…³ç½‘ç»œé—®é¢˜çš„æ’æŸ¥æµç¨‹ï¼š Which ingress controller? Timeout between client and ingress controller, or between ingress controller and backend service/pod? HTTP/504 generated by the ingress controller, proven by logs from the ingress controller? If you port-forward to skip the internet between client and ingress controller, does the timeout still happen? ","date":"2019-11-24","objectID":"/posts/kubernetes-common-errors-and-solutions/:3:1","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes"],"title":"Kubernetes å¸¸è§é”™è¯¯ã€åŸå› åŠå¤„ç†æ–¹æ³•","uri":"/posts/kubernetes-common-errors-and-solutions/#1-ingressistio-gateway-è¿”å›å€¼"},{"categories":["tech"],"content":" 2. ä¸Šäº† istio sidecar åï¼Œåº”ç”¨ç¨‹åºå¶å°”ï¼ˆé—´éš”å‡ å¤©åŠä¸ªæœˆï¼‰ä¼š redis è¿æ¥ç›¸å…³çš„é”™è¯¯è€ƒè™‘æ˜¯å¦å’Œ tcp é•¿æ—¶é—´ä½¿ç”¨æœ‰å…³ï¼Œæ¯”å¦‚è¿æ¥é•¿æ—¶é—´ç©ºé—²çš„è¯ï¼Œå¯èƒ½ä¼šè¢« istio sidecar æ–­å¼€ã€‚å¦‚æœç¨‹åºè‡ªèº«çš„é‡è¿æœºåˆ¶æœ‰é—®é¢˜ï¼Œå°±ä¼šå¯¼è‡´è¿™ç§ç°è±¡ã€‚ ç¡®è®¤æ–¹æ³•ï¼š æ£€æŸ¥ istio çš„ idleTimeout æ—¶é•¿ï¼ˆé»˜è®¤ 1hï¼‰ åˆ›å»ºä¸‰äº”ä¸ªæ²¡æµé‡çš„ Pod æ”¾ç½® 1hï¼ˆä¸ istio idleTimeout æ—¶é•¿ä¸€è‡´ï¼‰ï¼Œçœ‹çœ‹æ˜¯å¦ä¼šå‡†æ—¶å¼€å§‹æŠ¥ redis çš„é”™ã€‚ å¯¹ç…§ç»„ï¼šåˆ›å»ºä¸‰äº”ä¸ªåŒæ ·æ²¡æµé‡çš„ Podï¼Œä½†æ˜¯ä¸æ³¨å…¥ istio sidecarï¼Œåº”è¯¥ä¸€ç›´å¾ˆæ­£å¸¸ è¿™æ ·å°±èƒ½ç¡®è®¤é—®é¢˜ï¼Œåç»­å¤„ç†ï¼š æŠ“åŒ…è§‚å¯Ÿç¨‹åºåœ¨å‡ºé”™åçš„ tcp å±‚è¡Œä¸º æŸ¥é˜… redis sdk çš„ç›¸å…³ issueã€ä»£ç ï¼Œé€šè¿‡å‡çº§ SDK åº”è¯¥èƒ½è§£å†³é—®é¢˜ã€‚ ","date":"2019-11-24","objectID":"/posts/kubernetes-common-errors-and-solutions/:3:2","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes"],"title":"Kubernetes å¸¸è§é”™è¯¯ã€åŸå› åŠå¤„ç†æ–¹æ³•","uri":"/posts/kubernetes-common-errors-and-solutions/#2-ä¸Šäº†-istio-sidecar-ååº”ç”¨ç¨‹åºå¶å°”é—´éš”å‡ å¤©åŠä¸ªæœˆä¼š-redis-è¿æ¥ç›¸å…³çš„é”™è¯¯"},{"categories":["tech"],"content":" åå­—ç©ºé—´å¸¸è§é”™è¯¯","date":"2019-11-24","objectID":"/posts/kubernetes-common-errors-and-solutions/:4:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes"],"title":"Kubernetes å¸¸è§é”™è¯¯ã€åŸå› åŠå¤„ç†æ–¹æ³•","uri":"/posts/kubernetes-common-errors-and-solutions/#åå­—ç©ºé—´å¸¸è§é”™è¯¯"},{"categories":["tech"],"content":" åå­—ç©ºé—´æ— æ³•åˆ é™¤è¿™é€šå¸¸æ˜¯æŸäº›èµ„æºå¦‚ CR(custom resources)/å­˜å‚¨ç­‰èµ„æºæ— æ³•é‡Šæ”¾å¯¼è‡´çš„ã€‚æ¯”å¦‚å¸¸è§çš„ monitoring åå­—ç©ºé—´æ— æ³•åˆ é™¤ï¼Œåº”è¯¥å°±æ˜¯ CR æ— æ³• GC å¯¼è‡´çš„ã€‚ å¯æ‰‹åŠ¨åˆ é™¤ namespace é…ç½®ä¸­çš„ææ„å™¨ï¼ˆspec.finalizerï¼Œåœ¨åå­—ç©ºé—´ç”Ÿå‘½å‘¨æœŸç»“æŸå‰ä¼šç”Ÿæˆçš„é…ç½®é¡¹ï¼‰ï¼Œè¿™æ ·åå­—ç©ºé—´å°±ä¼šç›´æ¥è·³è¿‡ GC æ­¥éª¤ï¼š shell # ç¼–è¾‘åå­—ç©ºé—´çš„é…ç½® kubectl edit namespace \u003cns-name\u003e # å°† spec.finalizers æ”¹æˆç©ºåˆ—è¡¨ [] å¦‚æœä¸Šè¿°æ–¹æ³•ä¹Ÿæ— æ³•åˆ é™¤åå­—ç©ºé—´ï¼Œä¹Ÿæ‰¾ä¸åˆ°å…·ä½“çš„é—®é¢˜ï¼Œå°±åªèƒ½ç›´æ¥ä» etcd ä¸­åˆ é™¤æ‰å®ƒäº†(æœ‰é£é™©ï¼Œè°¨æ…æ“ä½œï¼)ã€‚æ–¹æ³•å¦‚ä¸‹ï¼š shell # ç™»å½•åˆ° etcd å®¹å™¨ä¸­ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š export ETCDCTL_API=3 cd /etc/kubernetes/pki/etcd/ # åˆ—å‡ºæ‰€æœ‰åå­—ç©ºé—´ etcdctl --cacert ca.crt --cert peer.crt --key peer.key get /registry/namespaces --prefix --keys-only # ï¼ˆè°¨æ…æ“ä½œï¼ï¼ï¼ï¼‰å¼ºåˆ¶åˆ é™¤åå­—ç©ºé—´ `monitoring`ã€‚è¿™å¯èƒ½å¯¼è‡´ç›¸å…³èµ„æºæ— æ³•è¢« GCï¼ etcdctl --cacert ca.crt --cert peer.crt --key peer.key del /registry/namespaces/monitoring ","date":"2019-11-24","objectID":"/posts/kubernetes-common-errors-and-solutions/:4:1","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes"],"title":"Kubernetes å¸¸è§é”™è¯¯ã€åŸå› åŠå¤„ç†æ–¹æ³•","uri":"/posts/kubernetes-common-errors-and-solutions/#åå­—ç©ºé—´æ— æ³•åˆ é™¤"},{"categories":["tech"],"content":" kubectl/istioctl ç­‰å®¢æˆ·ç«¯å·¥å…·å¼‚å¸¸ socat not found: kubectl ä½¿ç”¨ socat è¿›è¡Œç«¯å£è½¬å‘ï¼Œé›†ç¾¤çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œä»¥åŠæœ¬æœºéƒ½å¿…é¡»å®‰è£…æœ‰ socat å·¥å…·ã€‚ ","date":"2019-11-24","objectID":"/posts/kubernetes-common-errors-and-solutions/:5:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes"],"title":"Kubernetes å¸¸è§é”™è¯¯ã€åŸå› åŠå¤„ç†æ–¹æ³•","uri":"/posts/kubernetes-common-errors-and-solutions/#kubectlistioctl-ç­‰å®¢æˆ·ç«¯å·¥å…·å¼‚å¸¸"},{"categories":["tech"],"content":" æ‰¹é‡æ¸…ç† Evicted è®°å½•æœ‰æ—¶å€™ Pod å› ä¸ºèŠ‚ç‚¹é€‰æ‹©å™¨çš„é—®é¢˜ï¼Œè¢«ä¸æ–­è°ƒåº¦åˆ°æœ‰é—®é¢˜çš„ Node ä¸Šï¼Œå°±ä¼šä¸æ–­è¢« Evictedï¼Œå¯¼è‡´å‡ºç°å¤§é‡çš„ Evicted Podsã€‚æ’æŸ¥å®Œé—®é¢˜åï¼Œéœ€è¦æ‰‹åŠ¨æ¸…ç†æ‰è¿™äº› Evicted Pods. æ‰¹é‡åˆ é™¤ Evicted è®°å½•: shell kubectl get pods | grep Evicted | awk '{print $1}' | xargs kubectl delete pod ","date":"2019-11-24","objectID":"/posts/kubernetes-common-errors-and-solutions/:6:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes"],"title":"Kubernetes å¸¸è§é”™è¯¯ã€åŸå› åŠå¤„ç†æ–¹æ³•","uri":"/posts/kubernetes-common-errors-and-solutions/#æ‰¹é‡æ¸…ç†-evicted-è®°å½•"},{"categories":["tech"],"content":" å®¹å™¨é•œåƒGCã€Podé©±é€ä»¥åŠèŠ‚ç‚¹å‹åŠ›èŠ‚ç‚¹å‹åŠ› DiskPressure ä¼šå¯¼è‡´ Pod è¢«é©±é€ï¼Œä¹Ÿä¼šè§¦å‘å®¹å™¨é•œåƒçš„ GCã€‚ æ ¹æ®å®˜æ–¹æ–‡æ¡£é…ç½®èµ„æºä¸è¶³æ—¶çš„å¤„ç†æ–¹å¼ï¼ŒKubelet æä¾›å¦‚ä¸‹ç”¨äºé…ç½®å®¹å™¨ GC åŠ Evicetion çš„é˜ˆå€¼ï¼š --eviction-hard å’Œ eviction-soft: å¯¹åº”æ—§å‚æ•° --image-gc-high-thresholdï¼Œè¿™ä¸¤ä¸ªå‚æ•°é…ç½®é•œåƒ GC åŠé©±é€çš„è§¦å‘é˜ˆå€¼ã€‚ç£ç›˜ä½¿ç”¨ç‡çš„é˜ˆå€¼é»˜è®¤ä¸º 85% åŒºåˆ«åœ¨äº eviction-hard æ˜¯ç«‹å³é©±é€ï¼Œè€Œ eviction-soft åœ¨è¶…è¿‡eviction-soft-grace-period ä¹‹åæ‰é©±é€ã€‚ --eviction-minimum-reclaim: å¯¹åº”æ—§å‚æ•° --image-gc-low-thresholdã€‚è¿™æ˜¯è¿›è¡Œèµ„æºå›æ”¶ ï¼ˆé•œåƒGCã€Podé©±é€ç­‰ï¼‰åæœŸæœ›è¾¾åˆ°çš„ç£ç›˜ä½¿ç”¨ç‡ç™¾åˆ†æ¯”ã€‚ç£ç›˜ä½¿ç”¨ç‡çš„é˜ˆå€¼é»˜è®¤å€¼ä¸º 80%ã€‚ é—®ï¼šèƒ½å¦ä¸º ImageGC è®¾ç½®ä¸€ä¸ªæ¯” DiskPressure æ›´ä½çš„é˜ˆå€¼ï¼Ÿå› ä¸ºæˆ‘ä»¬å¸Œæœ›èƒ½è‡ªåŠ¨è¿›è¡Œé•œåƒ GCï¼Œä½†æ˜¯ä¸æƒ³ç«‹å³è§¦å‘ Pod é©±é€ã€‚ ç­”ï¼šè¿™åº”è¯¥å¯ä»¥é€šè¿‡è®¾ç½® eviction-soft å’Œé•¿ä¸€ç‚¹çš„ eviction-soft-grace-period æ¥å®ç°ã€‚å¦å¤– --eviction-minimum-reclaim ä¹Ÿå¯ä»¥è®¾å°ä¸€ç‚¹ï¼Œæ¸…ç†å¾—æ›´å¹²å‡€ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š shell --eviction-soft=memory.available\u003c1Gi,nodefs.available\u003c2Gi,imagefs.available\u003c200Gi --eviction-soft-grace-period=3m --eviction-minimum-reclaim=memory.available=0Mi,nodefs.available=1Gi,imagefs.available=2Gi ","date":"2019-11-24","objectID":"/posts/kubernetes-common-errors-and-solutions/:7:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes"],"title":"Kubernetes å¸¸è§é”™è¯¯ã€åŸå› åŠå¤„ç†æ–¹æ³•","uri":"/posts/kubernetes-common-errors-and-solutions/#å®¹å™¨é•œåƒgcpodé©±é€ä»¥åŠèŠ‚ç‚¹å‹åŠ›"},{"categories":["tech"],"content":" ç›‘æ§/HPA å¸¸è§é”™è¯¯","date":"2019-11-24","objectID":"/posts/kubernetes-common-errors-and-solutions/:8:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes"],"title":"Kubernetes å¸¸è§é”™è¯¯ã€åŸå› åŠå¤„ç†æ–¹æ³•","uri":"/posts/kubernetes-common-errors-and-solutions/#ç›‘æ§hpa-å¸¸è§é”™è¯¯"},{"categories":["tech"],"content":" æœåŠ¡è®¾ç½®äº† HPA é˜ˆå€¼ä¸º 50% CPUï¼Œæ‰€æœ‰ä¸šåŠ¡å®¹å™¨åœ¨å¯åŠ¨åä¸ä¹…å°±ä¼š OOMï¼ŒCPU æš´æ¶¨ç„¶åæŒ‚æ‰ã€‚ä½†æ˜¯æ— æ³•è§¦å‘ CPU æ‰©ç¼©å®¹ï¼ŒPrometheus ç›‘æ§æŒ‡æ ‡ä¹Ÿä¸å¯¹åŠ²ã€‚æ ¹æ®metrics-sever - how-often-metrics-are-scraped æè¿°ï¼Œmetrics-sever é»˜è®¤æƒ…å†µä¸‹æ¯ 60s é‡‡é›†ä¸€æ¬¡æŒ‡æ ‡ï¼Œè€Œ Prometheus çš„é‡‡é›†é—´éš”é€šå¸¸ä¼šé…ç½®ä¸º 15s/30sã€‚ è¿™è¯´æ˜å¦‚æœä¸šåŠ¡å®¹å™¨æ¯æ¬¡é‡å¯åï¼Œéƒ½åšæŒä¸è¿‡ 60s å°±ä¼šæŒ‚æ‰ï¼Œå°±å¾ˆå¯èƒ½å¯¼è‡´ metrics-sever é‡‡é›†ä¸åˆ°è¶³å¤Ÿçš„æŒ‡æ ‡ï¼ŒHPA æŸ¥è¯¢åˆ°çš„å¹³å‡ CPU å°†ä¼šæ˜¯ 0%ï¼Œæ— æ³•è§¦å‘æ‰©å®¹æ“ä½œã€‚ Prometheus ä¹Ÿæ˜¯ä¸€æ ·çš„é€»è¾‘ï¼Œå¦‚æœå®¹å™¨æ¯æ¬¡å¯åŠ¨éƒ½åšæŒä¸è¿‡ 30sï¼Œé‚£å°±ä¼šå¯¼è‡´ prometheus ç»å¸¸æŠ“ä¸åˆ°æŒ‡æ ‡ï¼Œç›‘æ§å›¾è¡¨æˆ–è€…å‘Šè­¦å°±ä¼šå‡ºé—®é¢˜ã€‚ ","date":"2019-11-24","objectID":"/posts/kubernetes-common-errors-and-solutions/:8:1","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes"],"title":"Kubernetes å¸¸è§é”™è¯¯ã€åŸå› åŠå¤„ç†æ–¹æ³•","uri":"/posts/kubernetes-common-errors-and-solutions/#æœåŠ¡è®¾ç½®äº†-hpa-é˜ˆå€¼ä¸º-50-cpuæ‰€æœ‰ä¸šåŠ¡å®¹å™¨åœ¨å¯åŠ¨åä¸ä¹…å°±ä¼š-oomcpu-æš´æ¶¨ç„¶åæŒ‚æ‰ä½†æ˜¯æ— æ³•è§¦å‘-cpu-æ‰©ç¼©å®¹prometheus-ç›‘æ§æŒ‡æ ‡ä¹Ÿä¸å¯¹åŠ²"},{"categories":["tech"],"content":" å…¶ä»–é—®é¢˜","date":"2019-11-24","objectID":"/posts/kubernetes-common-errors-and-solutions/:9:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes"],"title":"Kubernetes å¸¸è§é”™è¯¯ã€åŸå› åŠå¤„ç†æ–¹æ³•","uri":"/posts/kubernetes-common-errors-and-solutions/#å…¶ä»–é—®é¢˜"},{"categories":["tech"],"content":" éš”å¤© Istio ç­‰å·¥å…·çš„ sidecar è‡ªåŠ¨æ³¨å…¥è«åå…¶å¦™å¤±æ•ˆäº†å¦‚æœæœåŠ¡å™¨æ™šä¸Šä¼šå…³æœºï¼Œå¯èƒ½å¯¼è‡´ç¬¬äºŒå¤©ç½‘ç»œæ’ä»¶å‡ºé—®é¢˜ï¼Œå¯¼è‡´ sidecar æ³¨å…¥å™¨æ— æ³•è§‚å¯Ÿåˆ° pod çš„åˆ›å»ºï¼Œä¹Ÿå°±æ— æ³•å®Œæˆ sidecar æ³¨å…¥ã€‚ ","date":"2019-11-24","objectID":"/posts/kubernetes-common-errors-and-solutions/:9:1","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes"],"title":"Kubernetes å¸¸è§é”™è¯¯ã€åŸå› åŠå¤„ç†æ–¹æ³•","uri":"/posts/kubernetes-common-errors-and-solutions/#éš”å¤©-istio-ç­‰å·¥å…·çš„-sidecar-è‡ªåŠ¨æ³¨å…¥è«åå…¶å¦™å¤±æ•ˆäº†"},{"categories":["tech"],"content":" å¦‚ä½•é‡æ–°è¿è¡Œä¸€ä¸ª Jobï¼Ÿæˆ‘ä»¬æœ‰ä¸€ä¸ª Job å› ä¸ºå¤–éƒ¨åŸå› è¿è¡Œå¤±è´¥äº†ï¼Œä¿®å¤å¥½åå°±éœ€è¦é‡æ–°è¿è¡Œå®ƒã€‚ æ–¹æ³•æ˜¯ï¼šåˆ é™¤æ—§çš„ Jobï¼Œå†ä½¿ç”¨åŒä¸€ä»½é…ç½®é‡å»º Job. å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ fluxcd è¿™ç±» GitOps å·¥å…·ï¼Œå°±åªéœ€è¦æ‰‹å·¥åˆ é™¤æ—§ Podï¼Œfluxcd ä¼šå®šæ—¶è‡ªåŠ¨ apply æ‰€æœ‰é…ç½®ï¼Œè¿™å°±å®Œæˆäº† Job çš„é‡å»ºã€‚ ","date":"2019-11-24","objectID":"/posts/kubernetes-common-errors-and-solutions/:9:2","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes"],"title":"Kubernetes å¸¸è§é”™è¯¯ã€åŸå› åŠå¤„ç†æ–¹æ³•","uri":"/posts/kubernetes-common-errors-and-solutions/#å¦‚ä½•é‡æ–°è¿è¡Œä¸€ä¸ª-job"},{"categories":["tech"],"content":" å‚è€ƒ Kubernetesç®¡ç†ç»éªŒ 504 Gateway Timeout when accessing workload via ingress Kubernetes Failure Stories Istioï¼š503ã€UC å’Œ TCP istio å®è·µæŒ‡å— - imroc.cc Kubernetes å®è·µæŒ‡å— - imroc.cc ","date":"2019-11-24","objectID":"/posts/kubernetes-common-errors-and-solutions/:10:0","series":["äº‘åŸç”Ÿç›¸å…³"],"tags":["Kubernetes"],"title":"Kubernetes å¸¸è§é”™è¯¯ã€åŸå› åŠå¤„ç†æ–¹æ³•","uri":"/posts/kubernetes-common-errors-and-solutions/#å‚è€ƒ"},{"categories":["tech"],"content":"Manjaro æ˜¯ä¸€ä¸ªåŸºäº Arch Linux çš„ Linux æ»šåŠ¨å‘è¡Œç‰ˆï¼Œç”¨ç€æŒºèˆ’æœçš„ã€‚æœ€å¤§çš„ç‰¹ç‚¹ï¼Œæ˜¯åŒ…ä»“åº“å¾ˆä¸°å¯Œï¼Œè€Œä¸”éƒ½å¾ˆæ–°ã€‚ä»£ä»·æ˜¯å¶å°”ä¼šå‡ºäº›å°æ¯›ç—…ã€‚ 2021-09-22 æ›´æ–°ï¼šä»Šå¤©è¢«ç¾¤å‹ç§‘æ™®ï¼Œå¯èƒ½æˆ‘ä¸‹é¢åˆ—ä¸¾çš„å‡ ä¸ªæ»šæŒ‚äº‹ä»¶ï¼Œå¯èƒ½éƒ½å’Œæˆ‘ä½¿ç”¨äº† archlinuxcn è¿™ä¸ªæºæœ‰å…³ï¼Œè¿™ç¡®å®æœ‰å¯èƒ½ã€‚ æˆ‘ä¸€å¹´å¤šçš„ä½¿ç”¨ä¸­ï¼Œé‡åˆ°è¿‡ qv2-ray åŠ¨æ€é“¾æ¥åº“ç‚¸æ‰çš„é—®é¢˜ï¼Œæ²¡ä¸“é—¨å»æ‰¾ä¿®å¤æ–¹æ³•ï¼Œå¥½åƒæ˜¯ç­‰äº†ä¸€ä¸¤ä¸ªæœˆï¼Œå‡çº§äº†ä¸¤ä¸ªå¤§ç‰ˆæœ¬æ‰æ¢å¤ã€‚å¦ä¸€ä¸ªå°±æ˜¯VSCode - Incorrect locale â€™en-USâ€™ used everywhere è¿˜é‡åˆ°è¿‡ libguestfs çš„ä¸€ä¸ªé—®é¢˜ï¼švrit-v2v/virt-p2v ä¸¤ä¸ªå·¥å…·è¢«æ‹†åˆ†å‡ºå»ï¼Œå¯¼è‡´ manjaro åªèƒ½é€šè¿‡æºç å®‰è£…è¿™ä¿©è´§ã€‚è¿™è²Œä¼¼ç›®å‰ä»æ—§æ²¡æœ‰è§£å†³ã€‚ æ€»çš„æ¥è¯´ä½“éªŒå¾ˆä¸é”™ï¼Œèƒ½å¾ˆåŠæ—¶åœ°ç”¨ä¸Šå„ç§æ–°ç‰ˆæœ¬çš„è½¯ä»¶ã€‚ ","date":"2019-07-13","objectID":"/posts/manjaro-instruction/:0:0","series":null,"tags":["Manjaro","Linux","Arch Linux"],"title":"Manjaro ä½¿ç”¨æŒ‡å—","uri":"/posts/manjaro-instruction/#"},{"categories":["tech"],"content":" ä¸€ã€pacman/yay çš„åŸºç¡€å‘½ä»¤Manjaro è£…å¥½åï¼Œéœ€è¦è¿è¡Œçš„ç¬¬ä¸€æ¡å‘½ä»¤ï¼š sh sudo pacman -Syy ## å¼ºåˆ¶æ›´æ–° package ç›®å½• sudo pacman-mirrors --interactive --country China # åˆ—å‡ºæ‰€æœ‰å›½å†…çš„é•œåƒæºï¼Œå¹¶æä¾›äº¤äº’å¼çš„ç•Œé¢æ‰‹åŠ¨é€‰æ‹©é•œåƒæº sudo pacman -Syyu # å¼ºåˆ¶æ›´æ–° package ç›®å½•ï¼Œå¹¶å°è¯•æ›´æ–°å·²å®‰è£…çš„æ‰€æœ‰ packages. sudo pacman -S yay # å®‰è£… yay pacman æ˜¯ arch/manjaro çš„å®˜æ–¹åŒ…ç®¡ç†å™¨ï¼Œè€Œåˆšåˆšå®‰è£…çš„ yayï¼Œåˆ™æ˜¯ä¸€ä¸ªèƒ½æŸ¥è¯¢ arch linux çš„ aur ä»“åº“çš„ç¬¬ä¸‰æ–¹åŒ…ç®¡ç†å™¨ï¼Œéå¸¸æµè¡Œã€‚ pacman çš„å¸¸ç”¨å‘½ä»¤è¯­æ³•ï¼š sh pacman -S package_name # å®‰è£…è½¯ä»¶ pacman -S extra/package_name # å®‰è£…ä¸åŒä»“åº“ä¸­çš„ç‰ˆæœ¬ pacman -Syu # å‡çº§æ•´ä¸ªç³»ç»Ÿï¼Œyæ˜¯æ›´æ–°æ•°æ®åº“ï¼Œyyæ˜¯å¼ºåˆ¶æ›´æ–°ï¼Œuæ˜¯å‡çº§è½¯ä»¶ pacman -Ss string # åœ¨åŒ…æ•°æ®åº“ä¸­æŸ¥è¯¢è½¯ä»¶ pacman -Si package_name # æ˜¾ç¤ºè½¯ä»¶çš„è¯¦ç»†ä¿¡æ¯ pacman -Sc # æ¸…é™¤è½¯ä»¶ç¼“å­˜ï¼Œå³/var/cache/pacman/pkgç›®å½•ä¸‹çš„æ–‡ä»¶ pacman -R package_name # åˆ é™¤å•ä¸ªè½¯ä»¶ pacman -Rs package_name # åˆ é™¤æŒ‡å®šè½¯ä»¶åŠå…¶æ²¡æœ‰è¢«å…¶ä»–å·²å®‰è£…è½¯ä»¶ä½¿ç”¨çš„ä¾èµ–å…³ç³» pacman -Qs string # æŸ¥è¯¢å·²å®‰è£…çš„è½¯ä»¶åŒ… pacman -Qi package_name # æŸ¥è¯¢æœ¬åœ°å®‰è£…åŒ…çš„è¯¦ç»†ä¿¡æ¯ pacman -Ql package_name # è·å–å·²å®‰è£…è½¯ä»¶æ‰€åŒ…å«çš„æ–‡ä»¶çš„åˆ—è¡¨ pacman -U package.tar.zx # ä»æœ¬åœ°æ–‡ä»¶å®‰è£… pactree package_name # æ˜¾ç¤ºè½¯ä»¶çš„ä¾èµ–æ ‘ yay çš„ç”¨æ³•å’Œ pacman å®Œå…¨ç±»ä¼¼ï¼Œä¸Šè¿°æ‰€æœ‰ pacman xxx å‘½ä»¤ï¼Œå‡å¯æ›¿æ¢æˆ yay xxx æ‰§è¡Œã€‚ æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€æ¡ yay å‘½ä»¤å€¼å¾—è®°ä¸€ä¸‹ï¼š sh yay -c # å¸è½½æ‰€æœ‰æ— ç”¨çš„ä¾èµ–ã€‚ç±»æ¯” apt-get autoremove ","date":"2019-07-13","objectID":"/posts/manjaro-instruction/:1:0","series":null,"tags":["Manjaro","Linux","Arch Linux"],"title":"Manjaro ä½¿ç”¨æŒ‡å—","uri":"/posts/manjaro-instruction/#ä¸€pacmanyay-çš„åŸºç¡€å‘½ä»¤"},{"categories":["tech"],"content":" å¸¸ç”¨è½¯ä»¶ä¸é…ç½®","date":"2019-07-13","objectID":"/posts/manjaro-instruction/:2:0","series":null,"tags":["Manjaro","Linux","Arch Linux"],"title":"Manjaro ä½¿ç”¨æŒ‡å—","uri":"/posts/manjaro-instruction/#å¸¸ç”¨è½¯ä»¶ä¸é…ç½®"},{"categories":["tech"],"content":" 1. æ·»åŠ  archlinux ä¸­æ–‡ç¤¾åŒºä»“åº“Arch Linux ä¸­æ–‡ç¤¾åŒºä»“åº“ æ˜¯ç”± Arch Linux ä¸­æ–‡ç¤¾åŒºé©±åŠ¨çš„éå®˜æ–¹ç”¨æˆ·ä»“åº“ï¼ŒåŒ…å«ä¸€äº›é¢å¤–çš„è½¯ä»¶åŒ…ä»¥åŠå·²æœ‰è½¯ä»¶çš„ git ç‰ˆæœ¬ç­‰å˜ç§ã€‚éƒ¨åˆ†è½¯ä»¶åŒ…çš„æ‰“åŒ…è„šæœ¬æ¥æºäº AURã€‚ ä¸€äº›å›½å†…è½¯ä»¶ï¼Œå¦‚æœç›´æ¥ä» aur å®‰è£…ï¼Œé‚£å°±ä¼šæœ‰ä¸€ä¸ªç¼–è¯‘è¿‡ç¨‹ï¼Œæœ‰ç‚¹æ…¢ã€‚è€Œ archlinuxcn æœ‰å·²ç»ç¼–è¯‘å¥½çš„åŒ…ï¼Œå¯ä»¥ç›´æ¥å®‰è£…ã€‚æ›´æ–°é€Ÿåº¦ä¹Ÿå¾ˆå¿«ï¼Œæ¨èä½¿ç”¨ã€‚ é…ç½®æ–¹æ³•è§Arch Linux Chinese Community Repositoryã€‚ ","date":"2019-07-13","objectID":"/posts/manjaro-instruction/:2:1","series":null,"tags":["Manjaro","Linux","Arch Linux"],"title":"Manjaro ä½¿ç”¨æŒ‡å—","uri":"/posts/manjaro-instruction/#1-æ·»åŠ -archlinux-ä¸­æ–‡ç¤¾åŒºä»“åº“"},{"categories":["tech"],"content":" 2. å®‰è£…å¸¸ç”¨è½¯ä»¶ sh sudo pacman -S google-chrome firefox # æµè§ˆå™¨ sudo pacman -S netease-cloud-music # ç½‘æ˜“äº‘éŸ³ä¹ sudo pacman -S noto-fonts-cjk wqy-bitmapfont wqy-microhei wqy-zenhei # ä¸­æ–‡å­—ä½“ï¼šæ€æºç³»åˆ—ã€æ–‡æ³‰ç³»åˆ— sudo pacman -S wps-office ttf-wps-fonts sudo pacman -S vim # å‘½ä»¤è¡Œç¼–è¾‘å™¨ sudo pacman -S git # ç‰ˆæœ¬ç®¡ç†å·¥å…· sudo pacman -S clang make cmake gdb # ç¼–è¯‘è°ƒè¯•ç¯å¢ƒ sudo pacman -S visual-studio-code-bin # ä»£ç ç¼–è¾‘å™¨ sudo pacman -S wireshark-qt mitmproxy # æŠ“åŒ…å·¥å…· sudo pacman -S docker # docker å®¹å™¨ å…¶ä¸­ docker å’Œ wireshark éœ€è¦é¢å¤–é…ç½®ï¼Œå¦åˆ™ä¼šè¦æ±‚ç®¡ç†å‘˜æƒé™ï¼š sh sudo groupadd wireshark sudo gpasswd --add $USER wireshark # å°†ä½ æ·»åŠ åˆ° wireshark ç”¨æˆ·ç»„ä¸­ sudo groupadd docker sudo gpasswd --add $USER docker # åŒä¸Š ","date":"2019-07-13","objectID":"/posts/manjaro-instruction/:2:2","series":null,"tags":["Manjaro","Linux","Arch Linux"],"title":"Manjaro ä½¿ç”¨æŒ‡å—","uri":"/posts/manjaro-instruction/#2-å®‰è£…å¸¸ç”¨è½¯ä»¶"},{"categories":["tech"],"content":" 3. ä¸­æ–‡è¾“å…¥æ³•æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼šä¸­å·éŸµï¼ˆrimeï¼‰å’Œæœç‹—æ‹¼éŸ³ï¼ˆsogoupinyinï¼‰ã€‚ ç®€å•çœäº‹ç”¨æœç‹—ï¼Œè¦ç”¨ç‰¹æ®Šçš„è¾“å…¥æ–¹æ¡ˆï¼ˆäº”ç¬”ã€éŸ³å½¢ã€äºŒç¬”ç­‰ç­‰ï¼‰å°±åªæœ‰ rime å¯é€‰äº†ã€‚ 3.1 fcitx5-rime é…ç½®å°é¹¤éŸ³å½¢é¦–å…ˆå®‰è£… fcitx5-rime, æ³¨æ„è¿™äº›ç»„ä»¶ä¸€ä¸ªéƒ½ä¸èƒ½çœç•¥ï¼š shell sudo pacman -S fcitx5 fcitx5-chinese-addons fcitx5-gtk fcitx5-qt kcm-fcitx5 fcitx5-rime ç¬¬äºŒæ­¥æ˜¯ä¿®æ”¹ç¯å¢ƒå˜é‡ï¼Œå°† fcitx5-rime è®¾ä¸ºé»˜è®¤è¾“å…¥æ³•å¹¶è‡ªåŠ¨å¯åŠ¨ã€‚ æ·»åŠ  ~/.pam_environment æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š conf INPUT_METHOD DEFAULT=fcitx5 GTK_IM_MODULE DEFAULT=fcitx5 QT_IM_MODULE DEFAULT=fcitx5 XMODIFIERS DEFAULT=@im=fcitx5 pam-env æ¨¡å—ä¼šåœ¨æ‰€æœ‰ç™»å½•ä¼šè¯ä¸­è¯»å–ä¸Šé¢çš„é…ç½®æ–‡ä»¶ï¼ŒåŒ…æ‹¬ X11 ä¼šè¯å’Œ Wayland ä¼šè¯ã€‚ æ·»åŠ è‡ªåŠ¨å¯åŠ¨ï¼š shell # ~/.xprofile æ˜¯ x11 GUI çš„ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶ echo 'fcitx5 \u0026' \u003e\u003e ~/.xprofile ç„¶åï¼Œä» http://flypy.ys168.com/ ä¸‹è½½æœ€æ–°çš„é¼ é¡»ç®¡ï¼ˆMacOSï¼‰é…ç½®æ–‡ä»¶ï¼Œå°†è§£å‹å¾—åˆ°çš„ rime æ–‡ä»¶å¤¹æ‹·è´åˆ° ~/.local/share/fcitx5/ ä¸‹ï¼š shell mv rime ~/.local/share/fcitx5/ ç°åœ¨é‡å¯ç³»ç»Ÿï¼Œåœ¨ fcitx5 é…ç½®é‡Œé¢æ·»åŠ  rimeï¼Œå°±å¯ä»¥æ­£å¸¸ä½¿ç”¨å°é¹¤éŸ³å½¢äº†ã€‚ ","date":"2019-07-13","objectID":"/posts/manjaro-instruction/:2:3","series":null,"tags":["Manjaro","Linux","Arch Linux"],"title":"Manjaro ä½¿ç”¨æŒ‡å—","uri":"/posts/manjaro-instruction/#3-ä¸­æ–‡è¾“å…¥æ³•"},{"categories":["tech"],"content":" 3. ä¸­æ–‡è¾“å…¥æ³•æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼šä¸­å·éŸµï¼ˆrimeï¼‰å’Œæœç‹—æ‹¼éŸ³ï¼ˆsogoupinyinï¼‰ã€‚ ç®€å•çœäº‹ç”¨æœç‹—ï¼Œè¦ç”¨ç‰¹æ®Šçš„è¾“å…¥æ–¹æ¡ˆï¼ˆäº”ç¬”ã€éŸ³å½¢ã€äºŒç¬”ç­‰ç­‰ï¼‰å°±åªæœ‰ rime å¯é€‰äº†ã€‚ 3.1 fcitx5-rime é…ç½®å°é¹¤éŸ³å½¢é¦–å…ˆå®‰è£… fcitx5-rime, æ³¨æ„è¿™äº›ç»„ä»¶ä¸€ä¸ªéƒ½ä¸èƒ½çœç•¥ï¼š shell sudo pacman -S fcitx5 fcitx5-chinese-addons fcitx5-gtk fcitx5-qt kcm-fcitx5 fcitx5-rime ç¬¬äºŒæ­¥æ˜¯ä¿®æ”¹ç¯å¢ƒå˜é‡ï¼Œå°† fcitx5-rime è®¾ä¸ºé»˜è®¤è¾“å…¥æ³•å¹¶è‡ªåŠ¨å¯åŠ¨ã€‚ æ·»åŠ  ~/.pam_environment æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š conf INPUT_METHOD DEFAULT=fcitx5 GTK_IM_MODULE DEFAULT=fcitx5 QT_IM_MODULE DEFAULT=fcitx5 XMODIFIERS DEFAULT=@im=fcitx5 pam-env æ¨¡å—ä¼šåœ¨æ‰€æœ‰ç™»å½•ä¼šè¯ä¸­è¯»å–ä¸Šé¢çš„é…ç½®æ–‡ä»¶ï¼ŒåŒ…æ‹¬ X11 ä¼šè¯å’Œ Wayland ä¼šè¯ã€‚ æ·»åŠ è‡ªåŠ¨å¯åŠ¨ï¼š shell # ~/.xprofile æ˜¯ x11 GUI çš„ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶ echo 'fcitx5 \u0026' \u003e\u003e ~/.xprofile ç„¶åï¼Œä» http://flypy.ys168.com/ ä¸‹è½½æœ€æ–°çš„é¼ é¡»ç®¡ï¼ˆMacOSï¼‰é…ç½®æ–‡ä»¶ï¼Œå°†è§£å‹å¾—åˆ°çš„ rime æ–‡ä»¶å¤¹æ‹·è´åˆ° ~/.local/share/fcitx5/ ä¸‹ï¼š shell mv rime ~/.local/share/fcitx5/ ç°åœ¨é‡å¯ç³»ç»Ÿï¼Œåœ¨ fcitx5 é…ç½®é‡Œé¢æ·»åŠ  rimeï¼Œå°±å¯ä»¥æ­£å¸¸ä½¿ç”¨å°é¹¤éŸ³å½¢äº†ã€‚ ","date":"2019-07-13","objectID":"/posts/manjaro-instruction/:2:3","series":null,"tags":["Manjaro","Linux","Arch Linux"],"title":"Manjaro ä½¿ç”¨æŒ‡å—","uri":"/posts/manjaro-instruction/#31-fcitx5-rime-é…ç½®å°é¹¤éŸ³å½¢"},{"categories":["tech"],"content":" å‘ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä¹Ÿé‡åˆ°äº†ä¸€äº›å‘ï¼š å®‰è£…è½¯ä»¶åŒ…æ—¶ï¼Œæ— æ³•åœ¨çº¿å®‰è£…æ—§ç‰ˆæœ¬ï¼é™¤éä½ æœ¬åœ°æœ‰æ—§ç‰ˆæœ¬çš„å®‰è£…åŒ…æ²¡æ¸…é™¤ï¼Œæ‰å¯ä»¥é€šè¿‡ç¼“å­˜å®‰è£…æ—§ç‰ˆæœ¬ã€‚ è¿™ç§é—®é¢˜æ²¡é‡åˆ°æ—¶å¥½è¯´ï¼Œä½†æœ‰æ—¶å€™æ–°ç‰ˆæœ¬æœ‰é—®é¢˜ï¼Œæ—§å®‰è£…åŒ…ä¹Ÿæ¸…ç†æ‰äº†æ— æ³•å›é€€ï¼Œå°±éå¸¸éº»çƒ¦ã€‚ è€Œä¸”å°±ç®—ä½ å›é€€äº†ç‰ˆæœ¬ï¼Œä¸€å‡çº§å®ƒå°±åˆæ›´æ–°äº†ã€‚ã€‚ ","date":"2019-07-13","objectID":"/posts/manjaro-instruction/:3:0","series":null,"tags":["Manjaro","Linux","Arch Linux"],"title":"Manjaro ä½¿ç”¨æŒ‡å—","uri":"/posts/manjaro-instruction/#å‘"},{"categories":["tech"],"content":" å½»åº•åˆ é™¤ Manjaro åŠå…¶å¼•å¯¼é¡¹æœ€è¿‘(2021-01)åˆ‡æ¢åˆ°äº† OpenSUSEï¼Œä½“éªŒå¾ˆå¥½ï¼Œäºæ˜¯å†³å®šåˆ é™¤æ‰ Manjaroã€‚ ä¸€ç•ªæ“ä½œï¼Œæ€»ç»“å‡ºçš„åˆ é™¤æµç¨‹å¦‚ä¸‹ï¼ˆä»¥ä¸‹å‘½ä»¤å‡éœ€è¦ root æƒé™ï¼‰ï¼š shell # 1. åˆ é™¤ EFI å¼•å¯¼é¡¹ ## æŸ¥çœ‹ efi çš„æ‰€æœ‰å¯åŠ¨é¡¹ï¼Œæ‰¾åˆ° Manjaro çš„ç¼–å· efibootmgr ## åˆ é™¤æ‰ Manjaro å¯åŠ¨é¡¹ sudo efibootmgr --delete-bootnum -b 2 # 2. åˆ é™¤ manjaro çš„ bootloader ## æˆ‘ä½¿ç”¨äº† manjaro é»˜è®¤çš„å®‰è£…ç­–ç•¥ï¼Œbootloader è¢«å®‰è£…åœ¨äº†å’Œ windows ç›¸åŒçš„ EFI åˆ†åŒºä¸‹ ## é¦–å…ˆé€šè¿‡ opnsuse çš„åˆ†åŒºå·¥å…·ï¼Œæ‰¾åˆ° EFI åˆ†åŒºçš„è®¾å¤‡å·ï¼Œç„¶åæŒ‚è½½å®ƒ mkdir efi mount /dev/nvme0n1p1 efi # åˆ é™¤ Manjaro bootloader rm -r EFI/Manjaro # 3. é‡å»º grub2 å¼•å¯¼é¡¹ grub2-mkconfig \u003e /boot/grub2/grub.cfg # 4. æœ€åï¼Œé€šè¿‡åˆ†åŒºå·¥å…·åˆ é™¤ Manjaro çš„æ‰€æœ‰åˆ†åŒºï¼Œæˆ‘æ˜¯ SSDï¼Œåªæœ‰ä¸€ä¸ªåˆ†åŒº # 5. é‡å¯ç³»ç»Ÿï¼Œæ‰€æœ‰ä¸œè¥¿å°±å…¨åˆ é™¤å¹²å‡€äº†ã€‚ ","date":"2019-07-13","objectID":"/posts/manjaro-instruction/:4:0","series":null,"tags":["Manjaro","Linux","Arch Linux"],"title":"Manjaro ä½¿ç”¨æŒ‡å—","uri":"/posts/manjaro-instruction/#å½»åº•åˆ é™¤-manjaro-åŠå…¶å¼•å¯¼é¡¹"},{"categories":["tech"],"content":" å‚è€ƒ Arch Linux Wiki - ä¸­æ–‡ AUR ä»“åº“ Arch Linux ä¸­æ–‡ç¤¾åŒºä»“åº“ yay - Yet another Yogurt - An AUR Helper written in Go å®‰è£…Manjaroä¹‹åçš„é…ç½® Arch Linux Wiki - Fcitx5 ","date":"2019-07-13","objectID":"/posts/manjaro-instruction/:5:0","series":null,"tags":["Manjaro","Linux","Arch Linux"],"title":"Manjaro ä½¿ç”¨æŒ‡å—","uri":"/posts/manjaro-instruction/#å‚è€ƒ"},{"categories":["life"],"content":"å››å¹´å¤§å­¦æƒ¨æ·¡æ”¶åœºï¼Œååœ¨ç«è½¦ç¡¬åº§ä¸Šï¼Œå¿ƒé‡Œæœ‰äº›å¿å¿‘ã€‚ å¯¹é¢åç€ä¸€ä¸ª 16 å²çš„å¥³å­©å­ï¼Œä»åˆè‚¥å»æ·±åœ³å½“å®‰æ£€ï¼Œéšçº¦å¬åˆ°ã€Œ700 å—ä¸€ä¸ªæœˆã€ï¼Œã€Œå†æ€ä¹ˆç€åå¤©ä¹Ÿæœ‰ä¸€ä¼‘å§ã€ï¼Œè¯´å®è¯æ·±æ„Ÿæƒ­æ„§ã€‚ å°æ—¶å€™æˆ‘å¦ˆå¯¹æˆ‘æœ‰ç‚¹ä¿æŠ¤è¿‡åº¦ï¼Œä»å°åˆ°å¤§å‡ ä¹æ²¡ä¸‹ç”°å¹²è¿‡æ´»ï¼Œåœ¨å®¶å¸®å¿™å¹²è¿‡çš„æ´»å±ˆæŒ‡å¯æ•°ã€‚å› ä¸ºè¯»ä¹¦å°šå¯ï¼Œç¨€é‡Œç³Šæ¶‚è¯»äº†åå¤šå¹´ä¹¦ï¼Œç°åœ¨æƒ¨æ·¡æ”¶åœºã€‚è€Œå¯¹é¢å¥³å­©å­ 16 å²ï¼Œå·²ç»è¦å»ç¦»å®¶è¿™ä¹ˆè¿œçš„åœ°æ–¹å®ä¹ äº† ï¼ˆå½“å®‰æ£€ï¼‰ï¼Œè€Œä¸”è¿˜å¬åˆ°å¯¹é¢è¯´ã€Œæƒ³å’Œä»–åˆ†äº†ï¼Œæ¯æ¬¡éƒ½æ˜¯æˆ‘ç»™ä»–æ‰“ç”µè¯ï¼Œä»–ä»æ¥æ²¡ä¸»åŠ¨è¿‡ï¼Œç°åœ¨è¿˜æŠ±æ€¨æˆ‘ç”µè¯æ‰“å°‘äº†â€¦â€¦ã€ æ„Ÿè§‰æˆ‘ 22 å¹´ï¼Œæœ‰ç‚¹ç™½æ´»äº†ã€‚ã€‚ å¯å³ä½¿è¿™æ ·ï¼Œè¿˜æ˜¯æä¸èµ·å¤šå¤§åŠ¨åŠ›å»å¤ä¹ é¢è¯•ç”¨çš„çŸ¥è¯†ç‚¹ã€‚å¿ƒé‡Œæ…Œçš„ä¸è¡Œï¼Œå¯æ¸¸æˆç…§æ‰“ä¸è¯¯ã€‚è¿˜ç’ç€å®¶é‡Œï¼ŒèŠ±ç™½æ¡åˆ†æœŸä¹°äº†ä¸ª 6000 çš„å°ç±³æ¸¸æˆæœ¬ï¼Œä¸€æœˆè¦è¿˜ 500ï¼Œä¸‡ä¸€å·¥ä½œæ‰¾å¾—ä¸ç†æƒ³ï¼Œæˆ‘ä¸çŸ¥é“è¿™ä¸ªé’±çªŸçª¿åˆ°æ—¶å€™è¯¥æ€ä¹ˆå¡«ä¸Šã€‚ã€‚ã€‚ æˆ‘çš„å››å¹´å¤§å­¦å¥½åƒä¹Ÿæœ‰è¿‡äº›é«˜å…‰æ—¶åˆ»ï¼Œä¹Ÿæœ‰è¿‡è®¸å¤šå€¼å¾—é“­è®°çš„æ¬¢ä¹æ—¶å…‰ï¼Œä¸´åˆ°å¤´æ¥å´æ˜¯è¿™ä¹ˆä¸ªæƒ¨æ·¡çš„ç»“å°¾ã€‚ä¹Ÿæœ‰æƒ³è¿‡åŠªåŠ›åŠªåŠ›ï¼Œå¯ä¸€æ‡’æ•£èµ·æ¥ï¼Œå°±æœ‰äº†å€Ÿå£â€”â€”ã€Œå½“åˆå·®ç‚¹é«˜è€ƒéƒ½æ²¡å‚åŠ ï¼Œå°±ç›´æ¥é€€å­¦äº†ï¼Œç°åœ¨èµ·ç è¿˜è¯»äº†å››å¹´çš„ä¸‰æµä¸€æœ¬ï¼Œè§äº†ä¸–é¢ï¼Œèµšåˆ°äº†ã€‚ã€ ä¸çŸ¥é“åå¹´åæˆ‘å†å›é¦–ï¼Œä¼šä¸ä¼šè§‰å¾—ç°åœ¨å†…å¿ƒçš„å¿å¿‘ï¼Œä¸ç®—ä»€ä¹ˆã€‚ æ€»ä¹‹å‘¢ï¼Œå› ä¸ºä¸€å¥ã€Œæè®¡ç®—æœºçš„è¯ï¼Œæ·±åœ³å·¥ä½œåº”è¯¥å¾ˆå¤šå§ï¼Œä¸å¦‚è¿‡æ¥æ‰¾å·¥ä½œï¼Ÿã€ï¼Œæˆ‘ä¸Šäº†è¿™è¶Ÿç«è½¦ã€‚ å­¦ä¸šå•¥çš„éƒ½éšå®ƒå»å§ï¼Œæ˜¯ä¸æ˜¯å•è½¦å˜æ‘©æ‰˜ï¼Œå°±çœ‹è¿™ä¸€æŠŠäº†â€¦ ","date":"2019-06-20","objectID":"/posts/escape-my-university/:0:0","series":null,"tags":[],"title":"é€ƒç¦»æˆ‘çš„å¤§å­¦","uri":"/posts/escape-my-university/#"},{"categories":["tech"],"content":" ä¸ªäººç¬”è®°ï¼Œä¸ä¿è¯æ­£ç¡®ã€‚ ","date":"2019-05-21","objectID":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/:0:0","series":null,"tags":["SQLAlchemy","Python","ORM","åç«¯","æ•°æ®åº“","Database"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰ï¼šORM ä¸­çš„å…³ç³»æ„å»º","uri":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/#"},{"categories":["tech"],"content":" ä¸€ã€å…³ç³»æ„å»ºï¼šForeignKey ä¸ relationshipå…³ç³»æ„å»ºçš„é‡ç‚¹ï¼Œåœ¨äºææ¸…æ¥šè¿™ä¸¤ä¸ªå‡½æ•°çš„ç”¨æ³•ã€‚ForeignKey çš„ç”¨æ³•å·²ç»åœ¨SQLè¡¨è¾¾å¼è¯­è¨€ - è¡¨å®šä¹‰ä¸­çš„çº¦æŸ è®²è¿‡äº†ã€‚ä¸»è¦æ˜¯ ondelete å’Œ onupdate ä¸¤ä¸ªå‚æ•°çš„ç”¨æ³•ã€‚ ","date":"2019-05-21","objectID":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/:1:0","series":null,"tags":["SQLAlchemy","Python","ORM","åç«¯","æ•°æ®åº“","Database"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰ï¼šORM ä¸­çš„å…³ç³»æ„å»º","uri":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/#ä¸€å…³ç³»æ„å»ºforeignkey-ä¸-relationship"},{"categories":["tech"],"content":" äºŒã€relationshiprelationship å‡½æ•°åœ¨ ORM ä¸­ç”¨äºæ„å»ºè¡¨ä¹‹é—´çš„å…³è”å…³ç³»ã€‚ä¸ ForeignKey ä¸åŒçš„æ˜¯ï¼Œå®ƒå®šä¹‰çš„å…³ç³»ä¸å±äºè¡¨å®šä¹‰ï¼Œè€Œæ˜¯åŠ¨æ€è®¡ç®—çš„ã€‚ç”¨å®ƒå®šä¹‰å‡ºæ¥çš„å±æ€§ï¼Œç›¸å½“äº SQL ä¸­çš„è§†å›¾ã€‚ è¿™ä¸ªå‡½æ•°æœ‰ç‚¹éš¾ç”¨ï¼Œä¸€æ˜¯å› ä¸ºå®ƒçš„æœ‰å‡ ä¸ªå‚æ•°ä¸å¤ªå¥½ç†è§£ï¼ŒäºŒæ˜¯å› ä¸ºå®ƒçš„å‚æ•°éå¸¸ä¸°å¯Œï¼Œè®©äººæœ›è€Œå´æ­¥ã€‚ä¸‹é¢é€šè¿‡ä¸€å¯¹å¤šã€å¤šå¯¹ä¸€ã€å¤šå¯¹å¤šå‡ ä¸ªåœºæ™¯ä¸‹ relationship çš„ä½¿ç”¨ï¼Œæ¥ä¸€æ­¥æ­¥ç†Ÿæ‚‰å®ƒçš„ç”¨æ³•ã€‚ é¦–å…ˆåˆå§‹åŒ–ï¼š python3 from sqlalchemy import Table, Column, Integer, ForeignKey from sqlalchemy.orm import relationship from sqlalchemy.ext.declarative import declarative_base Base = declarative_base() ","date":"2019-05-21","objectID":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/:2:0","series":null,"tags":["SQLAlchemy","Python","ORM","åç«¯","æ•°æ®åº“","Database"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰ï¼šORM ä¸­çš„å…³ç³»æ„å»º","uri":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/#äºŒrelationship"},{"categories":["tech"],"content":" 1. ä¸€å¯¹å¤š python3 class Parent(Base): __tablename__ = 'parent' id = Column(Integer, primary_key=True) # å› ä¸º Child ä¸­æœ‰ Parent çš„ ForeignKeyï¼Œè¿™è¾¹çš„å£°æ˜ä¸éœ€è¦å†é¢å¤–æŒ‡å®šä»€ä¹ˆã€‚ children = relationship(\"Child\") # children çš„é›†åˆï¼Œç›¸å½“äºä¸€ä¸ªè§†å›¾ã€‚ class Child(Base): __tablename__ = 'child' id = Column(Integer, primary_key=True) parent_id = Column(Integer, ForeignKey('parent.id')) ä¸€ä¸ª Parent å¯ä»¥æœ‰å¤šä¸ª Childrenï¼Œé€šè¿‡ relationshipï¼Œæˆ‘ä»¬å°±èƒ½ç›´æ¥é€šè¿‡parent.children å¾—åˆ°ç»“æœï¼Œå…å»ç¹ççš„ query è¯­å¥ã€‚ 1.1 åå‘å¼•ç”¨ 1.1.1 backref ä¸ back_populatesé‚£å¦‚æœæˆ‘ä»¬éœ€è¦å¾—çŸ¥ child çš„ parent å¯¹è±¡å‘¢ï¼Ÿèƒ½ä¸èƒ½ç›´æ¥è®¿é—® child.parentï¼Ÿ ä¸ºäº†å®ç°è¿™ä¸ªåŠŸèƒ½ï¼ŒSQLAlchemy æä¾›äº† backref å’Œ back_populates ä¸¤ä¸ªå‚æ•°ã€‚ ä¸¤ä¸ªå‚æ•°çš„æ•ˆæœå®Œå…¨ä¸€è‡´ï¼ŒåŒºåˆ«åœ¨äºï¼Œbackref åªéœ€è¦åœ¨ Parent ç±»ä¸­å£°æ˜childrenï¼ŒChild.parent ä¼šè¢«åŠ¨æ€åˆ›å»ºã€‚ è€Œ back_populates å¿…é¡»åœ¨ä¸¤ä¸ªç±»ä¸­æ˜¾å¼åœ°ä½¿ç”¨ back_populatesï¼Œæ›´æ˜¾ç¹çã€‚ï¼ˆä½†æ˜¯ä¹Ÿæ›´æ¸…æ™°ï¼Ÿï¼‰ å…ˆçœ‹ backref ç‰ˆï¼š python3 class Parent(Base): __tablename__ = 'parent' id = Column(Integer, primary_key=True) children = relationship(\"Child\", backref=\"parent\") # backref è¡¨ç¤ºï¼Œåœ¨ Child ç±»ä¸­åŠ¨æ€åˆ›å»º parent å±æ€§ï¼ŒæŒ‡å‘å½“å‰ç±»ã€‚ # Child ç±»ä¸éœ€è¦ä¿®æ”¹ å†çœ‹ back_populates ç‰ˆï¼š python3 class Parent(Base): __tablename__ = 'parent' id = Column(Integer, primary_key=True) children = relationship(\"Child\", back_populates=\"parent\") # back_populates class Child(Base): __tablename__ = 'child' id = Column(Integer, primary_key=True) parent_id = Column(Integer, ForeignKey('parent.id')) # è¿™è¾¹ä¹Ÿå¿…é¡»å£°æ˜ï¼Œä¸èƒ½çœç•¥ï¼ parent = relationship(\"Parent\", back_populates=\"children\") # parent ä¸æ˜¯é›†åˆï¼Œæ˜¯å±æ€§ï¼ NOTEï¼šå£°æ˜çš„ä¸¤ä¸ª relationship ä¸éœ€è¦å¤šä½™çš„è¯´æ˜ï¼ŒSQLAlchemy èƒ½è‡ªåŠ¨è¯†åˆ«åˆ°parent.children æ˜¯ collectionï¼Œchild.parent æ˜¯ attribute. 1.1.2. åå‘å¼•ç”¨çš„å‚æ•°ï¼šsqlalchemy.orm.backref(name, **kwargs)ä½¿ç”¨ back_populates æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°åœ¨ä¸¤ä¸ª relationship å‡½æ•°ä¸­æŒ‡å®šå„ç§å‚æ•°ï¼š python3 class Parent(Base): __tablename__ = 'parent' id = Column(Integer, primary_key=True) children = relationship(\"Child\", back_populates=\"parent\", lazy='dynamic') # æŒ‡å®š lazy çš„å€¼ class Child(Base): __tablename__ = 'child' id = Column(Integer, primary_key=True) parent_id = Column(Integer, ForeignKey('parent.id')) parent = relationship(\"Parent\", back_populates=\"children\", lazy='dynamic') # æŒ‡å®š lazy çš„å€¼ ä½†æ˜¯å¦‚æœä½¿ç”¨ backrefï¼Œå› ä¸ºæˆ‘ä»¬åªæœ‰ä¸€ä¸ª relationship å‡½æ•°ï¼ŒChild.parent æ˜¯è¢«éšå¼åˆ›å»ºçš„ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•æŒ‡å®šè¿™ä¸ªå±æ€§çš„å‚æ•°å‘¢ï¼Ÿ ç­”æ¡ˆå°±æ˜¯ backref() å‡½æ•°ï¼Œä½¿ç”¨å®ƒæ›¿ä»£ backref å‚æ•°çš„å€¼ï¼š python3 from sqlalchemy.orm import backref class Parent(Base): __tablename__ = 'parent' id = Column(Integer, primary_key=True) children = relationship(\"Child\", backref=backref(\"parent\", lazy='dynamic')) # ä½¿ç”¨ backref() å‡½æ•°ï¼ŒæŒ‡å®š Child.parent å±æ€§çš„å‚æ•° # Child ç±»ä¸éœ€è¦ä¿®æ”¹ backref() çš„å‚æ•°ä¼šè¢«ä¼ é€’ç»™ relationship()ï¼Œå› æ­¤å®ƒä¿©çš„å‚æ•°ä¹Ÿå®Œå…¨ä¸€è‡´ã€‚ ","date":"2019-05-21","objectID":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/:2:1","series":null,"tags":["SQLAlchemy","Python","ORM","åç«¯","æ•°æ®åº“","Database"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰ï¼šORM ä¸­çš„å…³ç³»æ„å»º","uri":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/#1-ä¸€å¯¹å¤š"},{"categories":["tech"],"content":" 1. ä¸€å¯¹å¤š python3 class Parent(Base): __tablename__ = 'parent' id = Column(Integer, primary_key=True) # å› ä¸º Child ä¸­æœ‰ Parent çš„ ForeignKeyï¼Œè¿™è¾¹çš„å£°æ˜ä¸éœ€è¦å†é¢å¤–æŒ‡å®šä»€ä¹ˆã€‚ children = relationship(\"Child\") # children çš„é›†åˆï¼Œç›¸å½“äºä¸€ä¸ªè§†å›¾ã€‚ class Child(Base): __tablename__ = 'child' id = Column(Integer, primary_key=True) parent_id = Column(Integer, ForeignKey('parent.id')) ä¸€ä¸ª Parent å¯ä»¥æœ‰å¤šä¸ª Childrenï¼Œé€šè¿‡ relationshipï¼Œæˆ‘ä»¬å°±èƒ½ç›´æ¥é€šè¿‡parent.children å¾—åˆ°ç»“æœï¼Œå…å»ç¹ççš„ query è¯­å¥ã€‚ 1.1 åå‘å¼•ç”¨ 1.1.1 backref ä¸ back_populatesé‚£å¦‚æœæˆ‘ä»¬éœ€è¦å¾—çŸ¥ child çš„ parent å¯¹è±¡å‘¢ï¼Ÿèƒ½ä¸èƒ½ç›´æ¥è®¿é—® child.parentï¼Ÿ ä¸ºäº†å®ç°è¿™ä¸ªåŠŸèƒ½ï¼ŒSQLAlchemy æä¾›äº† backref å’Œ back_populates ä¸¤ä¸ªå‚æ•°ã€‚ ä¸¤ä¸ªå‚æ•°çš„æ•ˆæœå®Œå…¨ä¸€è‡´ï¼ŒåŒºåˆ«åœ¨äºï¼Œbackref åªéœ€è¦åœ¨ Parent ç±»ä¸­å£°æ˜childrenï¼ŒChild.parent ä¼šè¢«åŠ¨æ€åˆ›å»ºã€‚ è€Œ back_populates å¿…é¡»åœ¨ä¸¤ä¸ªç±»ä¸­æ˜¾å¼åœ°ä½¿ç”¨ back_populatesï¼Œæ›´æ˜¾ç¹çã€‚ï¼ˆä½†æ˜¯ä¹Ÿæ›´æ¸…æ™°ï¼Ÿï¼‰ å…ˆçœ‹ backref ç‰ˆï¼š python3 class Parent(Base): __tablename__ = 'parent' id = Column(Integer, primary_key=True) children = relationship(\"Child\", backref=\"parent\") # backref è¡¨ç¤ºï¼Œåœ¨ Child ç±»ä¸­åŠ¨æ€åˆ›å»º parent å±æ€§ï¼ŒæŒ‡å‘å½“å‰ç±»ã€‚ # Child ç±»ä¸éœ€è¦ä¿®æ”¹ å†çœ‹ back_populates ç‰ˆï¼š python3 class Parent(Base): __tablename__ = 'parent' id = Column(Integer, primary_key=True) children = relationship(\"Child\", back_populates=\"parent\") # back_populates class Child(Base): __tablename__ = 'child' id = Column(Integer, primary_key=True) parent_id = Column(Integer, ForeignKey('parent.id')) # è¿™è¾¹ä¹Ÿå¿…é¡»å£°æ˜ï¼Œä¸èƒ½çœç•¥ï¼ parent = relationship(\"Parent\", back_populates=\"children\") # parent ä¸æ˜¯é›†åˆï¼Œæ˜¯å±æ€§ï¼ NOTEï¼šå£°æ˜çš„ä¸¤ä¸ª relationship ä¸éœ€è¦å¤šä½™çš„è¯´æ˜ï¼ŒSQLAlchemy èƒ½è‡ªåŠ¨è¯†åˆ«åˆ°parent.children æ˜¯ collectionï¼Œchild.parent æ˜¯ attribute. 1.1.2. åå‘å¼•ç”¨çš„å‚æ•°ï¼šsqlalchemy.orm.backref(name, **kwargs)ä½¿ç”¨ back_populates æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°åœ¨ä¸¤ä¸ª relationship å‡½æ•°ä¸­æŒ‡å®šå„ç§å‚æ•°ï¼š python3 class Parent(Base): __tablename__ = 'parent' id = Column(Integer, primary_key=True) children = relationship(\"Child\", back_populates=\"parent\", lazy='dynamic') # æŒ‡å®š lazy çš„å€¼ class Child(Base): __tablename__ = 'child' id = Column(Integer, primary_key=True) parent_id = Column(Integer, ForeignKey('parent.id')) parent = relationship(\"Parent\", back_populates=\"children\", lazy='dynamic') # æŒ‡å®š lazy çš„å€¼ ä½†æ˜¯å¦‚æœä½¿ç”¨ backrefï¼Œå› ä¸ºæˆ‘ä»¬åªæœ‰ä¸€ä¸ª relationship å‡½æ•°ï¼ŒChild.parent æ˜¯è¢«éšå¼åˆ›å»ºçš„ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•æŒ‡å®šè¿™ä¸ªå±æ€§çš„å‚æ•°å‘¢ï¼Ÿ ç­”æ¡ˆå°±æ˜¯ backref() å‡½æ•°ï¼Œä½¿ç”¨å®ƒæ›¿ä»£ backref å‚æ•°çš„å€¼ï¼š python3 from sqlalchemy.orm import backref class Parent(Base): __tablename__ = 'parent' id = Column(Integer, primary_key=True) children = relationship(\"Child\", backref=backref(\"parent\", lazy='dynamic')) # ä½¿ç”¨ backref() å‡½æ•°ï¼ŒæŒ‡å®š Child.parent å±æ€§çš„å‚æ•° # Child ç±»ä¸éœ€è¦ä¿®æ”¹ backref() çš„å‚æ•°ä¼šè¢«ä¼ é€’ç»™ relationship()ï¼Œå› æ­¤å®ƒä¿©çš„å‚æ•°ä¹Ÿå®Œå…¨ä¸€è‡´ã€‚ ","date":"2019-05-21","objectID":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/:2:1","series":null,"tags":["SQLAlchemy","Python","ORM","åç«¯","æ•°æ®åº“","Database"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰ï¼šORM ä¸­çš„å…³ç³»æ„å»º","uri":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/#11-åå‘å¼•ç”¨"},{"categories":["tech"],"content":" 1. ä¸€å¯¹å¤š python3 class Parent(Base): __tablename__ = 'parent' id = Column(Integer, primary_key=True) # å› ä¸º Child ä¸­æœ‰ Parent çš„ ForeignKeyï¼Œè¿™è¾¹çš„å£°æ˜ä¸éœ€è¦å†é¢å¤–æŒ‡å®šä»€ä¹ˆã€‚ children = relationship(\"Child\") # children çš„é›†åˆï¼Œç›¸å½“äºä¸€ä¸ªè§†å›¾ã€‚ class Child(Base): __tablename__ = 'child' id = Column(Integer, primary_key=True) parent_id = Column(Integer, ForeignKey('parent.id')) ä¸€ä¸ª Parent å¯ä»¥æœ‰å¤šä¸ª Childrenï¼Œé€šè¿‡ relationshipï¼Œæˆ‘ä»¬å°±èƒ½ç›´æ¥é€šè¿‡parent.children å¾—åˆ°ç»“æœï¼Œå…å»ç¹ççš„ query è¯­å¥ã€‚ 1.1 åå‘å¼•ç”¨ 1.1.1 backref ä¸ back_populatesé‚£å¦‚æœæˆ‘ä»¬éœ€è¦å¾—çŸ¥ child çš„ parent å¯¹è±¡å‘¢ï¼Ÿèƒ½ä¸èƒ½ç›´æ¥è®¿é—® child.parentï¼Ÿ ä¸ºäº†å®ç°è¿™ä¸ªåŠŸèƒ½ï¼ŒSQLAlchemy æä¾›äº† backref å’Œ back_populates ä¸¤ä¸ªå‚æ•°ã€‚ ä¸¤ä¸ªå‚æ•°çš„æ•ˆæœå®Œå…¨ä¸€è‡´ï¼ŒåŒºåˆ«åœ¨äºï¼Œbackref åªéœ€è¦åœ¨ Parent ç±»ä¸­å£°æ˜childrenï¼ŒChild.parent ä¼šè¢«åŠ¨æ€åˆ›å»ºã€‚ è€Œ back_populates å¿…é¡»åœ¨ä¸¤ä¸ªç±»ä¸­æ˜¾å¼åœ°ä½¿ç”¨ back_populatesï¼Œæ›´æ˜¾ç¹çã€‚ï¼ˆä½†æ˜¯ä¹Ÿæ›´æ¸…æ™°ï¼Ÿï¼‰ å…ˆçœ‹ backref ç‰ˆï¼š python3 class Parent(Base): __tablename__ = 'parent' id = Column(Integer, primary_key=True) children = relationship(\"Child\", backref=\"parent\") # backref è¡¨ç¤ºï¼Œåœ¨ Child ç±»ä¸­åŠ¨æ€åˆ›å»º parent å±æ€§ï¼ŒæŒ‡å‘å½“å‰ç±»ã€‚ # Child ç±»ä¸éœ€è¦ä¿®æ”¹ å†çœ‹ back_populates ç‰ˆï¼š python3 class Parent(Base): __tablename__ = 'parent' id = Column(Integer, primary_key=True) children = relationship(\"Child\", back_populates=\"parent\") # back_populates class Child(Base): __tablename__ = 'child' id = Column(Integer, primary_key=True) parent_id = Column(Integer, ForeignKey('parent.id')) # è¿™è¾¹ä¹Ÿå¿…é¡»å£°æ˜ï¼Œä¸èƒ½çœç•¥ï¼ parent = relationship(\"Parent\", back_populates=\"children\") # parent ä¸æ˜¯é›†åˆï¼Œæ˜¯å±æ€§ï¼ NOTEï¼šå£°æ˜çš„ä¸¤ä¸ª relationship ä¸éœ€è¦å¤šä½™çš„è¯´æ˜ï¼ŒSQLAlchemy èƒ½è‡ªåŠ¨è¯†åˆ«åˆ°parent.children æ˜¯ collectionï¼Œchild.parent æ˜¯ attribute. 1.1.2. åå‘å¼•ç”¨çš„å‚æ•°ï¼šsqlalchemy.orm.backref(name, **kwargs)ä½¿ç”¨ back_populates æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°åœ¨ä¸¤ä¸ª relationship å‡½æ•°ä¸­æŒ‡å®šå„ç§å‚æ•°ï¼š python3 class Parent(Base): __tablename__ = 'parent' id = Column(Integer, primary_key=True) children = relationship(\"Child\", back_populates=\"parent\", lazy='dynamic') # æŒ‡å®š lazy çš„å€¼ class Child(Base): __tablename__ = 'child' id = Column(Integer, primary_key=True) parent_id = Column(Integer, ForeignKey('parent.id')) parent = relationship(\"Parent\", back_populates=\"children\", lazy='dynamic') # æŒ‡å®š lazy çš„å€¼ ä½†æ˜¯å¦‚æœä½¿ç”¨ backrefï¼Œå› ä¸ºæˆ‘ä»¬åªæœ‰ä¸€ä¸ª relationship å‡½æ•°ï¼ŒChild.parent æ˜¯è¢«éšå¼åˆ›å»ºçš„ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•æŒ‡å®šè¿™ä¸ªå±æ€§çš„å‚æ•°å‘¢ï¼Ÿ ç­”æ¡ˆå°±æ˜¯ backref() å‡½æ•°ï¼Œä½¿ç”¨å®ƒæ›¿ä»£ backref å‚æ•°çš„å€¼ï¼š python3 from sqlalchemy.orm import backref class Parent(Base): __tablename__ = 'parent' id = Column(Integer, primary_key=True) children = relationship(\"Child\", backref=backref(\"parent\", lazy='dynamic')) # ä½¿ç”¨ backref() å‡½æ•°ï¼ŒæŒ‡å®š Child.parent å±æ€§çš„å‚æ•° # Child ç±»ä¸éœ€è¦ä¿®æ”¹ backref() çš„å‚æ•°ä¼šè¢«ä¼ é€’ç»™ relationship()ï¼Œå› æ­¤å®ƒä¿©çš„å‚æ•°ä¹Ÿå®Œå…¨ä¸€è‡´ã€‚ ","date":"2019-05-21","objectID":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/:2:1","series":null,"tags":["SQLAlchemy","Python","ORM","åç«¯","æ•°æ®åº“","Database"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰ï¼šORM ä¸­çš„å…³ç³»æ„å»º","uri":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/#111-backref-ä¸-back_populates"},{"categories":["tech"],"content":" 1. ä¸€å¯¹å¤š python3 class Parent(Base): __tablename__ = 'parent' id = Column(Integer, primary_key=True) # å› ä¸º Child ä¸­æœ‰ Parent çš„ ForeignKeyï¼Œè¿™è¾¹çš„å£°æ˜ä¸éœ€è¦å†é¢å¤–æŒ‡å®šä»€ä¹ˆã€‚ children = relationship(\"Child\") # children çš„é›†åˆï¼Œç›¸å½“äºä¸€ä¸ªè§†å›¾ã€‚ class Child(Base): __tablename__ = 'child' id = Column(Integer, primary_key=True) parent_id = Column(Integer, ForeignKey('parent.id')) ä¸€ä¸ª Parent å¯ä»¥æœ‰å¤šä¸ª Childrenï¼Œé€šè¿‡ relationshipï¼Œæˆ‘ä»¬å°±èƒ½ç›´æ¥é€šè¿‡parent.children å¾—åˆ°ç»“æœï¼Œå…å»ç¹ççš„ query è¯­å¥ã€‚ 1.1 åå‘å¼•ç”¨ 1.1.1 backref ä¸ back_populatesé‚£å¦‚æœæˆ‘ä»¬éœ€è¦å¾—çŸ¥ child çš„ parent å¯¹è±¡å‘¢ï¼Ÿèƒ½ä¸èƒ½ç›´æ¥è®¿é—® child.parentï¼Ÿ ä¸ºäº†å®ç°è¿™ä¸ªåŠŸèƒ½ï¼ŒSQLAlchemy æä¾›äº† backref å’Œ back_populates ä¸¤ä¸ªå‚æ•°ã€‚ ä¸¤ä¸ªå‚æ•°çš„æ•ˆæœå®Œå…¨ä¸€è‡´ï¼ŒåŒºåˆ«åœ¨äºï¼Œbackref åªéœ€è¦åœ¨ Parent ç±»ä¸­å£°æ˜childrenï¼ŒChild.parent ä¼šè¢«åŠ¨æ€åˆ›å»ºã€‚ è€Œ back_populates å¿…é¡»åœ¨ä¸¤ä¸ªç±»ä¸­æ˜¾å¼åœ°ä½¿ç”¨ back_populatesï¼Œæ›´æ˜¾ç¹çã€‚ï¼ˆä½†æ˜¯ä¹Ÿæ›´æ¸…æ™°ï¼Ÿï¼‰ å…ˆçœ‹ backref ç‰ˆï¼š python3 class Parent(Base): __tablename__ = 'parent' id = Column(Integer, primary_key=True) children = relationship(\"Child\", backref=\"parent\") # backref è¡¨ç¤ºï¼Œåœ¨ Child ç±»ä¸­åŠ¨æ€åˆ›å»º parent å±æ€§ï¼ŒæŒ‡å‘å½“å‰ç±»ã€‚ # Child ç±»ä¸éœ€è¦ä¿®æ”¹ å†çœ‹ back_populates ç‰ˆï¼š python3 class Parent(Base): __tablename__ = 'parent' id = Column(Integer, primary_key=True) children = relationship(\"Child\", back_populates=\"parent\") # back_populates class Child(Base): __tablename__ = 'child' id = Column(Integer, primary_key=True) parent_id = Column(Integer, ForeignKey('parent.id')) # è¿™è¾¹ä¹Ÿå¿…é¡»å£°æ˜ï¼Œä¸èƒ½çœç•¥ï¼ parent = relationship(\"Parent\", back_populates=\"children\") # parent ä¸æ˜¯é›†åˆï¼Œæ˜¯å±æ€§ï¼ NOTEï¼šå£°æ˜çš„ä¸¤ä¸ª relationship ä¸éœ€è¦å¤šä½™çš„è¯´æ˜ï¼ŒSQLAlchemy èƒ½è‡ªåŠ¨è¯†åˆ«åˆ°parent.children æ˜¯ collectionï¼Œchild.parent æ˜¯ attribute. 1.1.2. åå‘å¼•ç”¨çš„å‚æ•°ï¼šsqlalchemy.orm.backref(name, **kwargs)ä½¿ç”¨ back_populates æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°åœ¨ä¸¤ä¸ª relationship å‡½æ•°ä¸­æŒ‡å®šå„ç§å‚æ•°ï¼š python3 class Parent(Base): __tablename__ = 'parent' id = Column(Integer, primary_key=True) children = relationship(\"Child\", back_populates=\"parent\", lazy='dynamic') # æŒ‡å®š lazy çš„å€¼ class Child(Base): __tablename__ = 'child' id = Column(Integer, primary_key=True) parent_id = Column(Integer, ForeignKey('parent.id')) parent = relationship(\"Parent\", back_populates=\"children\", lazy='dynamic') # æŒ‡å®š lazy çš„å€¼ ä½†æ˜¯å¦‚æœä½¿ç”¨ backrefï¼Œå› ä¸ºæˆ‘ä»¬åªæœ‰ä¸€ä¸ª relationship å‡½æ•°ï¼ŒChild.parent æ˜¯è¢«éšå¼åˆ›å»ºçš„ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•æŒ‡å®šè¿™ä¸ªå±æ€§çš„å‚æ•°å‘¢ï¼Ÿ ç­”æ¡ˆå°±æ˜¯ backref() å‡½æ•°ï¼Œä½¿ç”¨å®ƒæ›¿ä»£ backref å‚æ•°çš„å€¼ï¼š python3 from sqlalchemy.orm import backref class Parent(Base): __tablename__ = 'parent' id = Column(Integer, primary_key=True) children = relationship(\"Child\", backref=backref(\"parent\", lazy='dynamic')) # ä½¿ç”¨ backref() å‡½æ•°ï¼ŒæŒ‡å®š Child.parent å±æ€§çš„å‚æ•° # Child ç±»ä¸éœ€è¦ä¿®æ”¹ backref() çš„å‚æ•°ä¼šè¢«ä¼ é€’ç»™ relationship()ï¼Œå› æ­¤å®ƒä¿©çš„å‚æ•°ä¹Ÿå®Œå…¨ä¸€è‡´ã€‚ ","date":"2019-05-21","objectID":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/:2:1","series":null,"tags":["SQLAlchemy","Python","ORM","åç«¯","æ•°æ®åº“","Database"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰ï¼šORM ä¸­çš„å…³ç³»æ„å»º","uri":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/#112-åå‘å¼•ç”¨çš„å‚æ•°sqlalchemyormbackrefname-kwargs"},{"categories":["tech"],"content":" 2. å¤šå¯¹ä¸€A many-to-one is similar to a one-to-many relationship. The difference is that this relationship is looked at from the â€œmanyâ€ side. ","date":"2019-05-21","objectID":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/:2:2","series":null,"tags":["SQLAlchemy","Python","ORM","åç«¯","æ•°æ®åº“","Database"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰ï¼šORM ä¸­çš„å…³ç³»æ„å»º","uri":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/#2-å¤šå¯¹ä¸€"},{"categories":["tech"],"content":" 3. ä¸€å¯¹ä¸€ python3 class Parent(Base): __tablename__ = 'parent' id = Column(Integer, primary_key=True) child = relationship(\"Child\", uselist=False, # ä¸ä½¿ç”¨ collectionï¼è¿™æ˜¯å…³é”® back_populates=\"parent\") class Child(Base): __tablename__ = 'child' id = Column(Integer, primary_key=True) parent_id = Column(Integer, ForeignKey('parent.id')) # åŒ…å« ForeignKey çš„ç±»ï¼Œæ­¤å±æ€§é»˜è®¤ä¸º attributeï¼Œå› æ­¤ä¸éœ€è¦ uselist=False parent = relationship(\"Parent\", back_populates=\"child\") ","date":"2019-05-21","objectID":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/:2:3","series":null,"tags":["SQLAlchemy","Python","ORM","åç«¯","æ•°æ®åº“","Database"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰ï¼šORM ä¸­çš„å…³ç³»æ„å»º","uri":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/#3-ä¸€å¯¹ä¸€"},{"categories":["tech"],"content":" 4. å¤šå¯¹å¤š python # å¤šå¯¹å¤šï¼Œå¿…é¡»è¦ä½¿ç”¨ä¸€ä¸ªå…³è”è¡¨ï¼ association_table = Table('association', Base.metadata, Column('left_id', Integer, ForeignKey('left.id')), # çº¦å®šä¿—æˆçš„è§„çŸ©ï¼Œå·¦è¾¹æ˜¯ parent Column('right_id', Integer, ForeignKey('right.id')) # å³è¾¹æ˜¯ child ) class Parent(Base): __tablename__ = 'left' id = Column(Integer, primary_key=True) children = relationship(\"Child\", secondary=association_table) # ä¸“ç”¨å‚æ•° secondaryï¼Œç”¨äºæŒ‡å®šä½¿ç”¨çš„å…³è”è¡¨ class Child(Base): __tablename__ = 'right' id = Column(Integer, primary_key=True) è¦æ·»åŠ åå‘å¼•ç”¨æ—¶ï¼ŒåŒæ ·å¯ä»¥ä½¿ç”¨ backref æˆ– back_populates. 4.1 user2userå¦‚æœå¤šå¯¹å¤šå…³ç³»ä¸­çš„ä¸¤è¾¹éƒ½æ˜¯ userï¼Œå³éƒ½æ˜¯åŒä¸€ä¸ªè¡¨æ—¶ï¼Œè¯¥æ€ä¹ˆå£°æ˜ï¼Ÿ ä¾‹å¦‚ç”¨æˆ·çš„ã€Œå…³æ³¨ã€ä¸ã€Œç²‰ä¸ã€ï¼Œä½ æ˜¯ userï¼Œä½ çš„ç²‰ä¸æ˜¯ userï¼Œä½ å…³æ³¨çš„è´¦å·ä¹Ÿæ˜¯ userã€‚ è¿™ä¸ªæ—¶å€™ï¼Œå…³è”è¡¨ association_table çš„ä¸¤ä¸ªé”®éƒ½æ˜¯ userï¼ŒSQLAlchemy æ— æ³•åŒºåˆ†ä¸»æ¬¡ï¼Œéœ€è¦æ‰‹åŠ¨æŒ‡å®šï¼Œä¸ºæ­¤éœ€è¦ä½¿ç”¨ primaryjoin å’Œ secondaryjoin ä¸¤ä¸ªå‚æ•°ã€‚ python # å…³è”è¡¨ï¼Œå·¦ä¾§çš„ user æ­£åœ¨å…³æ³¨å³ä¾§çš„ user followers = db.Table('followers', db.Column('follower_id', db.Integer, db.ForeignKey('user.id')), # å·¦ä¾§ db.Column('followed_id', db.Integer, db.ForeignKey('user.id')) # å³ä¾§ï¼Œè¢«å…³æ³¨çš„ user ) class User(UserMixin, db.Model): id = db.Column(db.Integer, primary_key=True) username = db.Column(db.String(64), index=True, unique=True, nullable=False) email = db.Column(db.String(120), index=True, unique=True, nullable=False) password_hash = db.Column(db.String(128), nullable=False) # æˆ‘å…³æ³¨çš„ users followed = db.relationship( 'User', secondary=followers, # æŒ‡å®šå¤šå¯¹å¤šå…³è”è¡¨ primaryjoin=(followers.c.follower_id == id), # å·¦ä¾§ï¼Œç”¨äºè·å–ã€Œæˆ‘å…³æ³¨çš„ usersã€çš„ join æ¡ä»¶ secondaryjoin=(followers.c.followed_id == id), # å³ä¾§ï¼Œç”¨äºè·å–ã€Œæˆ‘çš„ç²‰ä¸ã€çš„ join æ¡ä»¶ lazy='dynamic', # å»¶è¿Ÿæ±‚å€¼ï¼Œè¿™æ ·æ‰èƒ½ç”¨ filter_by ç­‰è¿‡æ»¤å‡½æ•° backref=db.backref('followers', lazy='dynamic')) # followers ä¹Ÿè¦å»¶è¿Ÿæ±‚å€¼ è¿™é‡Œæ¯”è¾ƒç»•çš„ï¼Œå°±æ˜¯å®¹æ˜“ææ·· primaryjoin å’Œ secondaryjoin ä¸¤ä¸ªå‚æ•°ã€‚ primaryjoinï¼šï¼ˆå¤šå¯¹å¤šä¸­ï¼‰ç”¨äºä»å­å¯¹è±¡æŸ¥è¯¢å…¶çˆ¶å¯¹è±¡çš„ conditionï¼ˆchild.parentsï¼‰ï¼Œé»˜è®¤åªè€ƒè™‘å¤–é”®ã€‚ secondaryjoinï¼šï¼ˆå¤šå¯¹å¤šä¸­ï¼‰ç”¨äºä»çˆ¶å¯¹è±¡æŸ¥è¯¢å…¶æ‰€æœ‰å­å¯¹è±¡çš„conditionï¼ˆparent.childrenï¼‰ï¼Œ åŒæ ·çš„ï¼Œé»˜è®¤æƒ…å†µä¸‹åªè€ƒè™‘å¤–é”®ã€‚ ","date":"2019-05-21","objectID":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/:2:4","series":null,"tags":["SQLAlchemy","Python","ORM","åç«¯","æ•°æ®åº“","Database"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰ï¼šORM ä¸­çš„å…³ç³»æ„å»º","uri":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/#4-å¤šå¯¹å¤š"},{"categories":["tech"],"content":" 4. å¤šå¯¹å¤š python # å¤šå¯¹å¤šï¼Œå¿…é¡»è¦ä½¿ç”¨ä¸€ä¸ªå…³è”è¡¨ï¼ association_table = Table('association', Base.metadata, Column('left_id', Integer, ForeignKey('left.id')), # çº¦å®šä¿—æˆçš„è§„çŸ©ï¼Œå·¦è¾¹æ˜¯ parent Column('right_id', Integer, ForeignKey('right.id')) # å³è¾¹æ˜¯ child ) class Parent(Base): __tablename__ = 'left' id = Column(Integer, primary_key=True) children = relationship(\"Child\", secondary=association_table) # ä¸“ç”¨å‚æ•° secondaryï¼Œç”¨äºæŒ‡å®šä½¿ç”¨çš„å…³è”è¡¨ class Child(Base): __tablename__ = 'right' id = Column(Integer, primary_key=True) è¦æ·»åŠ åå‘å¼•ç”¨æ—¶ï¼ŒåŒæ ·å¯ä»¥ä½¿ç”¨ backref æˆ– back_populates. 4.1 user2userå¦‚æœå¤šå¯¹å¤šå…³ç³»ä¸­çš„ä¸¤è¾¹éƒ½æ˜¯ userï¼Œå³éƒ½æ˜¯åŒä¸€ä¸ªè¡¨æ—¶ï¼Œè¯¥æ€ä¹ˆå£°æ˜ï¼Ÿ ä¾‹å¦‚ç”¨æˆ·çš„ã€Œå…³æ³¨ã€ä¸ã€Œç²‰ä¸ã€ï¼Œä½ æ˜¯ userï¼Œä½ çš„ç²‰ä¸æ˜¯ userï¼Œä½ å…³æ³¨çš„è´¦å·ä¹Ÿæ˜¯ userã€‚ è¿™ä¸ªæ—¶å€™ï¼Œå…³è”è¡¨ association_table çš„ä¸¤ä¸ªé”®éƒ½æ˜¯ userï¼ŒSQLAlchemy æ— æ³•åŒºåˆ†ä¸»æ¬¡ï¼Œéœ€è¦æ‰‹åŠ¨æŒ‡å®šï¼Œä¸ºæ­¤éœ€è¦ä½¿ç”¨ primaryjoin å’Œ secondaryjoin ä¸¤ä¸ªå‚æ•°ã€‚ python # å…³è”è¡¨ï¼Œå·¦ä¾§çš„ user æ­£åœ¨å…³æ³¨å³ä¾§çš„ user followers = db.Table('followers', db.Column('follower_id', db.Integer, db.ForeignKey('user.id')), # å·¦ä¾§ db.Column('followed_id', db.Integer, db.ForeignKey('user.id')) # å³ä¾§ï¼Œè¢«å…³æ³¨çš„ user ) class User(UserMixin, db.Model): id = db.Column(db.Integer, primary_key=True) username = db.Column(db.String(64), index=True, unique=True, nullable=False) email = db.Column(db.String(120), index=True, unique=True, nullable=False) password_hash = db.Column(db.String(128), nullable=False) # æˆ‘å…³æ³¨çš„ users followed = db.relationship( 'User', secondary=followers, # æŒ‡å®šå¤šå¯¹å¤šå…³è”è¡¨ primaryjoin=(followers.c.follower_id == id), # å·¦ä¾§ï¼Œç”¨äºè·å–ã€Œæˆ‘å…³æ³¨çš„ usersã€çš„ join æ¡ä»¶ secondaryjoin=(followers.c.followed_id == id), # å³ä¾§ï¼Œç”¨äºè·å–ã€Œæˆ‘çš„ç²‰ä¸ã€çš„ join æ¡ä»¶ lazy='dynamic', # å»¶è¿Ÿæ±‚å€¼ï¼Œè¿™æ ·æ‰èƒ½ç”¨ filter_by ç­‰è¿‡æ»¤å‡½æ•° backref=db.backref('followers', lazy='dynamic')) # followers ä¹Ÿè¦å»¶è¿Ÿæ±‚å€¼ è¿™é‡Œæ¯”è¾ƒç»•çš„ï¼Œå°±æ˜¯å®¹æ˜“ææ·· primaryjoin å’Œ secondaryjoin ä¸¤ä¸ªå‚æ•°ã€‚ primaryjoinï¼šï¼ˆå¤šå¯¹å¤šä¸­ï¼‰ç”¨äºä»å­å¯¹è±¡æŸ¥è¯¢å…¶çˆ¶å¯¹è±¡çš„ conditionï¼ˆchild.parentsï¼‰ï¼Œé»˜è®¤åªè€ƒè™‘å¤–é”®ã€‚ secondaryjoinï¼šï¼ˆå¤šå¯¹å¤šä¸­ï¼‰ç”¨äºä»çˆ¶å¯¹è±¡æŸ¥è¯¢å…¶æ‰€æœ‰å­å¯¹è±¡çš„conditionï¼ˆparent.childrenï¼‰ï¼Œ åŒæ ·çš„ï¼Œé»˜è®¤æƒ…å†µä¸‹åªè€ƒè™‘å¤–é”®ã€‚ ","date":"2019-05-21","objectID":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/:2:4","series":null,"tags":["SQLAlchemy","Python","ORM","åç«¯","æ•°æ®åº“","Database"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰ï¼šORM ä¸­çš„å…³ç³»æ„å»º","uri":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/#41-user2user"},{"categories":["tech"],"content":" ä¸‰ã€ORM å±‚ çš„ ã€Œdeleteã€ cascade vs. FOREIGN KEY å±‚çš„ ã€ŒON DELETEã€ cascadeä¹‹å‰æœ‰è®²è¿‡ Table å®šä¹‰ä¸­çš„çº§è”æ“ä½œï¼šON DELETE å’Œ ON UPDATEï¼Œå¯ä»¥é€šè¿‡ ForeignKey çš„å‚æ•°æŒ‡å®šä¸º CASCADE. å¯ SQLAlchemy è¿˜æœ‰ä¸€ä¸ª relationship ç”Ÿæˆ SQL è¯­å¥æ—¶çš„é…ç½®å‚æ•° cascadeï¼Œå¦å¤–passive_deletes ä¹Ÿå¯ä»¥æŒ‡å®šä¸º cascadeã€‚ æœ‰è¿™ä¹ˆå¤šçš„ cascadeï¼Œæˆ‘çœŸçš„æ˜¯å¾ˆæ‡µã€‚è¿™ä¸‰ä¸ª cascade åˆ°åº•æœ‰ä½•å·®åˆ«å‘¢ï¼Ÿ å¤–é”®çº¦æŸä¸­çš„ ON DELETE å’Œ ON UPDATEï¼Œä¸ ORM å±‚çš„ CASCADE åœ¨åŠŸèƒ½ä¸Šï¼Œç¡®å®æœ‰å¾ˆå¤šé‡å çš„åœ°æ–¹ã€‚ä½†æ˜¯ä¹Ÿæœ‰å¾ˆå¤šä¸åŒï¼š æ•°æ®åº“å±‚é¢çš„ ON DELETE çº§è”èƒ½é«˜æ•ˆåœ°å¤„ç† many-to-one çš„å…³è”ï¼›æˆ‘ä»¬åœ¨ many æ–¹å®šä¹‰å¤–é”®ï¼Œä¹Ÿåœ¨è¿™é‡Œæ·»åŠ  ON DELETE çº¦æŸã€‚è€Œåœ¨ ORM å±‚ï¼Œå°±åˆšå¥½ç›¸åã€‚SQLAlchemy åœ¨ one æ–¹å¤„ç† many æ–¹çš„åˆ é™¤æ“ä½œï¼Œè¿™æ„å‘³ç€å®ƒæ›´é€‚åˆå¤„ç† one-to-many çš„å…³è”ã€‚ æ•°æ®åº“å±‚é¢ä¸Šï¼Œä¸å¸¦ ON DELETE çš„å¤–é”®å¸¸ç”¨äºé˜²æ­¢çˆ¶æ•°æ®è¢«åˆ é™¤ï¼Œè€Œå¯¼è‡´å­æ•°æ®æˆä¸ºæ— æ³•è¢«ç´¢å¼•åˆ°çš„åƒåœ¾æ•°æ®ã€‚å¦‚æœè¦åœ¨ä¸€ä¸ª one-to-many æ˜ å°„ä¸Šå®ç°è¿™ä¸ªè¡Œä¸ºï¼ŒSQLAlchemy å°†å¤–é”®è®¾ç½®ä¸º NULL çš„é»˜è®¤è¡Œä¸ºå¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼ä¹‹ä¸€æ•è·ï¼š æœ€ç®€å•ä¹Ÿæœ€å¸¸ç”¨çš„æ–¹æ³•ï¼Œå½“ç„¶æ˜¯å°†å¤–é”®å®šä¹‰ä¸º NOT NULL. å°è¯•å°†è¯¥åˆ—è®¾ä¸º NULL ä¼šè§¦å‘ NOT NULL constraint exception. å¦ä¸€ç§æ›´ç‰¹æ®Šçš„æ–¹æ³•ï¼Œæ˜¯å°† passive_deletes æ ‡å¿—è®¾ç½®ä¸ºå­— all. è¿™ä¼šå®Œå…¨ç¦ç”¨ SQLAlchemy å°†å¤–é”®åˆ—è®¾ç½®ä¸º NULL çš„è¡Œä¸ºï¼Œå¹¶ä¸” DELETE çˆ¶æ•°æ®è€Œä¸ä¼šå¯¹å­æ•°æ®äº§ç”Ÿä»»ä½•å½±å“ã€‚è¿™æ ·æ‰èƒ½è§¦å‘æ•°æ®åº“å±‚é¢çš„ ON DELETE çº¦æŸï¼Œæˆ–è€…å…¶ä»–çš„è§¦å‘å™¨ã€‚ æ•°æ®åº“å±‚é¢çš„ ON DELETE çº§è” æ¯” ORM å±‚é¢çš„çº§è”æ›´é«˜æ•ˆã€‚æ•°æ®åº“å¯ä»¥åŒæ—¶åœ¨å¤šä¸ª relationship ä¸­é“¾æ¥ä¸€ç³»åˆ—çº§è”æ“ä½œã€‚ SQLAlchemy ä¸éœ€è¦è¿™ä¹ˆå¤æ‚ï¼Œå› ä¸ºæˆ‘ä»¬é€šè¿‡å°† passive_deletes é€‰é¡¹ä¸æ­£ç¡®é…ç½®çš„å¤–é”®çº¦æŸç»“åˆä½¿ç”¨ï¼Œæä¾›ä¸æ•°æ®åº“çš„ ON DELETE åŠŸèƒ½çš„å¹³æ»‘é›†æˆã€‚ ","date":"2019-05-21","objectID":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/:3:0","series":null,"tags":["SQLAlchemy","Python","ORM","åç«¯","æ•°æ®åº“","Database"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰ï¼šORM ä¸­çš„å…³ç³»æ„å»º","uri":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/#ä¸‰orm-å±‚-çš„-delete-cascade-vs-foreign-key-å±‚çš„-on-delete-cascade"},{"categories":["tech"],"content":" æ–¹æ³•ä¸€ï¼šORM å±‚çš„ cascade å®ç°relationship çš„ cascade å‚æ•°å†³å®šäº†ä¿®æ”¹çˆ¶è¡¨æ—¶ï¼Œä»€ä¹ˆæ—¶å€™å­è¡¨è¦è¿›è¡Œçº§è”æ“ä½œã€‚å®ƒçš„å¯é€‰é¡¹æœ‰ ï¼ˆstrï¼Œé€‰é¡¹ä¹‹é—´ç”¨é€—å·åˆ†éš”ï¼‰ï¼š save-updateï¼šé»˜è®¤é€‰é¡¹ä¹‹ä¸€ã€‚åœ¨ addï¼ˆå¯¹åº” SQL çš„ insert æˆ– updateï¼‰ä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œä¼š add æ‰€æœ‰å®ƒç›¸å…³è”çš„å¯¹è±¡ã€‚ mergeï¼šé»˜è®¤é€‰é¡¹ä¹‹ä¸€ã€‚åœ¨ mergeï¼ˆç›¸å½“å­—å…¸çš„updateæ“ä½œï¼Œæœ‰å°±æ›¿æ¢æ‰ï¼Œæ²¡æœ‰å°±åˆå¹¶ï¼‰ä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œä¼š merge æ‰€æœ‰å’Œå®ƒç›¸å…³è”çš„å¯¹è±¡ã€‚ expunge ï¼šç§»é™¤æ“ä½œçš„æ—¶å€™ï¼Œä¼šå°†ç›¸å…³è”çš„å¯¹è±¡ä¹Ÿè¿›è¡Œç§»é™¤ã€‚è¿™ä¸ªæ“ä½œåªæ˜¯ä»sessionä¸­ç§»é™¤ï¼Œå¹¶ä¸ä¼šçœŸæ­£çš„ä»æ•°æ®åº“ä¸­åˆ é™¤ã€‚ deleteï¼šåˆ é™¤çˆ¶è¡¨æ•°æ®æ—¶ï¼ŒåŒæ—¶åˆ é™¤ä¸å®ƒå…³è”çš„æ•°æ®ã€‚ delete-orphanï¼šå½“å­å¯¹è±¡ä¸çˆ¶å¯¹è±¡è§£é™¤å…³ç³»æ—¶ï¼Œåˆ é™¤æ‰æ­¤å­å¯¹è±¡ï¼ˆå­¤å„¿ï¼‰ã€‚ï¼ˆå…¶å®è¿˜æ˜¯æ²¡æ‡‚ã€‚ã€‚ï¼‰ refresh-expireï¼šä¸å¸¸ç”¨ã€‚ allï¼šè¡¨ç¤ºé€‰ä¸­é™¤ delete-orphan ä¹‹å¤–çš„æ‰€æœ‰é€‰é¡¹ã€‚ï¼ˆå› æ­¤ all, delete-orphan å¾ˆå¸¸ç”¨ï¼Œ å®ƒæ‰æ˜¯çœŸæ­£çš„ allï¼‰ é»˜è®¤å±æ€§æ˜¯ â€œsave-update, mergeâ€. è¿™åªæ˜¯ç®€ç•¥çš„è¯´æ˜ï¼Œä¸Šè¿°å‡ ä¸ªå‚æ•°çš„è¯¦ç»†æ–‡æ¡£è§SQLAlchemy - Cascades ","date":"2019-05-21","objectID":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/:3:1","series":null,"tags":["SQLAlchemy","Python","ORM","åç«¯","æ•°æ®åº“","Database"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰ï¼šORM ä¸­çš„å…³ç³»æ„å»º","uri":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/#æ–¹æ³•ä¸€orm-å±‚çš„-cascade-å®ç°"},{"categories":["tech"],"content":" æ–¹æ³•äºŒï¼šæ•°æ®åº“å±‚çš„ cascade å®ç° å°† ForeignKey çš„ ondelete å’Œ onupdate å‚æ•°æŒ‡å®šä¸º CASCADEï¼Œå®ç°æ•°æ®åº“å±‚é¢çš„çº§è”ã€‚ ä¸º relationship æ·»åŠ å…³é”®å­—å‚æ•° passive_deletes=\"all\"ï¼Œè¿™æ ·å°±å®Œå…¨ç¦ç”¨ SQLAlchemy å°†å¤–é”®åˆ—è®¾ç½®ä¸º NULL çš„è¡Œä¸ºï¼Œå¹¶ä¸” DELETE çˆ¶æ•°æ®ä¸ä¼šå¯¹å­æ•°æ®äº§ç”Ÿä»»ä½•å½±å“ã€‚ è¿™æ · DELETE æ“ä½œæ—¶ï¼Œå°±ä¼šè§¦å‘æ•°æ®åº“çš„ ON DELETE çº¦æŸï¼Œä»è€Œçº§è”åˆ é™¤å­æ•°æ®ã€‚ ","date":"2019-05-21","objectID":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/:3:2","series":null,"tags":["SQLAlchemy","Python","ORM","åç«¯","æ•°æ®åº“","Database"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰ï¼šORM ä¸­çš„å…³ç³»æ„å»º","uri":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/#æ–¹æ³•äºŒæ•°æ®åº“å±‚çš„-cascade-å®ç°"},{"categories":["tech"],"content":" å‚è€ƒ SQLAlchemy - Relationship Configuration SQLAlchemy - Cascades SQLAlchemy ä¸­çš„ backref å’Œ back_populates The Flask Mega-Tutorial Part VIII: Followers hackersandslackers/sqlalchemy-tutorial ","date":"2019-05-21","objectID":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/:4:0","series":null,"tags":["SQLAlchemy","Python","ORM","åç«¯","æ•°æ®åº“","Database"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰ï¼šORM ä¸­çš„å…³ç³»æ„å»º","uri":"/posts/sqlalchemy-notes-3-relationship-and-foreignkey/#å‚è€ƒ"},{"categories":["life"],"content":"è¿™ç½‘ç»œå°è¯´ä¸€èµ·å¤´ï¼Œå°±åœä¸ä¸‹æ¥ã€‚å¼€å§‹è¿˜åªæ˜¯è¿½æ›´æ–°ï¼Œæ¯å¤©çœ‹çœ‹ä¸‰å››æœ¬ä¹¦çš„æ›´æ–°ï¼ˆä¸€æ›´æˆ–äºŒæ›´ï¼‰å°±è¡Œäº†ï¼Œè¯´ä¸ä¸Šå¿ƒæ»¡æ„è¶³ï¼Œä½†ä¹Ÿæ²¡å¤šä¹ˆæ¬²æ±‚ä¸æ»¡ã€‚ åˆ°äº†ä¸‰æœˆä¸‹æ—¬ï¼Œçªç„¶å°±æƒ³çœ‹æœ¬æ–°ä¹¦ã€‚å¿µå¤´ä¸€èµ·å°±ä¸€å‘ä¸å¯æ”¶æ‹¾ï¼ŒåªæŒ‘äºŒä¸‰åä¸‡å­—çš„è¿è½½ä¹¦çœ‹â€”â€”é¦–è¦åŸå› æ˜¯æ€•æ”¶ä¸ä½æ‰‹ï¼Œä¹¦å¤ªé•¿çš„è¯ï¼ŒåºŸå¯å¿˜é£Ÿèµ·æ¥è‡ªå·±é­ç½ªï¼›å…¶æ¬¡æ˜¯å‰äºŒåå¤šä¸‡å­—éƒ½å¯ä»¥å…è´¹çœ‹ï¼Œåé¢æ‰æ˜¯æ”¶è´¹ç« èŠ‚ã€‚ æ„Ÿè§‰è‡ªå·±é™†é™†ç»­ç»­å¯èƒ½çœ‹äº†äºŒä¸‰åæœ¬ä¹¦ï¼Œäº”å…­ç™¾ä¸‡å­—å°±è¿™ä¹ˆè¿‡äº†ï¼ŒäºŒä¸‰åä¸ªæ•…äº‹å°±å¦‚è¿‡çœ¼äº‘çƒŸï¼Œè½¬çœ¼å°±è®°ä¸å¾—å‡ ä¸ªä¹¦åäº†ã€‚å°±åƒä»å°åˆ°å¤§çš„åŒå­¦è€å¸ˆä¸€æ ·ï¼Œçœ‹å°è¯´çœ‹åˆ°è®²é«˜ä¸­å®¤å‹ï¼Œå°±å°è¯•å›æƒ³æˆ‘çš„é«˜ä¸­å®¿èˆï¼Œä¸€æ—¶ç«Ÿè¿è‡ªå·±çš„åºŠé“ºéƒ½æé”™äº†ï¼Œä»”ç»†å›æƒ³ä¸‹ï¼Œä¹Ÿæœ‰å¥½å‡ ä¸ªå®¤å‹çš„åå­—é•¿ç›¸éƒ½å¿˜è®°äº†ã€‚è¿™è¿˜ç®—å¥½äº†ï¼Œ æ¯•ç«Ÿé«˜ä¸­ä¸‰å¹´ï¼Œä¹Ÿè¿‡äº†è¿™ä¹ˆé•¿æ—¶é—´æ‰æ·¡å¿˜ã€‚è¿™ç½‘æ–‡çš„æ•…äº‹æœ‰çš„å…‰æ€ªé™†ç¦»ï¼Œæœ‰çš„å¼‚æƒ³å¤©å¼€ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯ä¸“æ³¨ä¸€ä¸ªã€Œçˆ½ã€å­—ï¼Œæ— ä¸æ˜¯é‡‘æ‰‹æŒ‡æ‰“æ€ªå‡çº§çš„å¥—è·¯ã€‚åƒç¯‡ä¸€å¾‹ä¸‹ï¼Œèƒ½è®°ä½çš„æ²¡å‡ ä¸ªã€‚ å€’ä¹Ÿæœ‰ç‰¹ç«‹ç‹¬è¡Œçš„ï¼Œå› æ­¤ä¹Ÿå°±å°è±¡å°¤å…¶æ·±åˆ»ï¼Œã€Šæœˆæ˜è§å›æ¥/äº‘èƒ¡ä¸å–œã€‹æ˜¯è¿™æ ·ä¸€æœ¬æ–‡ç¬”ä¼˜ç¾çš„å¤è¨€ï¼Œ ä¸ºç€ã€Œäº‘èƒ¡ä¸å–œã€ä¸€å¥ï¼Œé‚£æ—¶çªç„¶å°±å–œæ¬¢ä¸Šäº†ã€Šè¯—ç»ã€‹ã€‚è¿˜æœ‰ä½ä½œè€…çš„æ˜Ÿé™…è¨€æƒ…æ–‡ï¼šã€Šæ˜Ÿçƒä¸Šçš„å®Œç¾å®¶å›­ã€‹å’Œã€Šæœªæ¥ä¸–ç•Œä¹‹æˆ‘å¿ƒå®‰å¤„ã€‹ï¼Œå†™å¾—æä¸ºç»†è…»ã€‚å°¤å…¶æ˜¯å‰è€…ï¼Œåªæ˜¯ä»–å†™çš„ç ”ç©¶ç”Ÿç”Ÿæ´»ï¼Œæœ‰ç‚¹åˆºæ¿€æˆ‘è¿™ä¸ªæ›¾ç»ä¿¡èª“æ—¦æ—¦è¦è€ƒç ”ï¼Œç°åœ¨å´å¤§å­¦æ–‡å‡­éƒ½æ‹¿ä¸åˆ°çš„å­¦æ¸£ã€‚ã€‚å°±çœ‹ä¸ä¸‹å»ã€‚ æœ‰æ®µæ—¶é—´å¯¹æ—¥ç³»è½»å°è¯´é’çæœ‰åŠ ï¼Œè§‰å¾—é‡Œå¤´çš„ä¼˜ç§€ä½œå“å°±æ˜¯æ¯”å›½å†…ç½‘æ–‡é«˜ä¸ªæ¡£æ¬¡ã€‚ç°åœ¨ä¸€æƒ³ï¼Œå…¶å®éƒ½ä¸€æ ·ï¼Œè‰¯è ä¸é½ï¼Œéƒ½å–œæ¬¢ç©¿è¶Šé‡ç”Ÿå¼‚ä¸–ç•Œçš„å¥—è·¯ã€‚åªæ˜¯çœ‹å¤šäº†åŠ¨æ¼«ï¼Œæ‰å¯¹è½»å°è¯´å¤šç‚¹å¥½æ„Ÿè€Œå·²ã€‚ç½‘æ–‡é‡Œå†™çš„å¥½çš„ä¹¦ä¹Ÿä¸å°‘ã€‚ è¿™ä¸¤å¤©çªç„¶å°±æœ‰äº›åŒå€¦äº†ï¼Œå­—çœ‹å¤šäº†å¼€å§‹å¤´ç–¼ï¼ŒåŒçƒ¦ã€‚å°±åƒæ‰‹å†²åè¿›å…¥äº†è´¤è€…æ—¶é—´ä¸€æ ·ã€‚ã€‚ã€‚è¿™æ ·ä¸€æƒ³ï¼Œè¿™ä¹¦ç˜¾åˆ°åº•è¿˜æ˜¯æ²¡æ¯’å“é‚£ä¹ˆå¯æ€•ï¼Œå†æ€ä¹ˆå‡¶çŒ›ï¼Œç–¯ç‹‚ä¸Šä¸€ä¸ªæœˆï¼Œä¹Ÿåç»§ä¹åŠ›äº†ï¼Œä¸ä¼šè¶Šé™·è¶Šæ·±ã€‚ è¿™ä¸€ä¸ªæœˆæ·±å±…ç®€å‡ºï¼Œè¿QQéƒ½ç›´æ¥ææ‰äº†å¥½å‡ å¤©ã€‚æˆ‘çœ‹èµ·å°è¯´æ¥å°±æ˜¯è¿™æ ·ï¼Œåˆ«çš„äº‹å®Œå…¨æ²¡å…´è‡´ç†ï¼Œç–¯ç‹‚èµ·æ¥å°±æ›´æ˜¯å˜æœ¬åŠ å‰ã€‚ å¿½åœ°åˆæƒ³èµ·äº†è‡ªå·±å†…å¿ƒæ•æ„Ÿã€æ€§æ ¼åˆ«æ‰­ã€èƒ†å­å°ã€å—ä¸å¾—è®­æ–¥ã€‚å†åŠ ä¸Šè¿™ä¸€ä¸ªæœˆçš„æ‰€ä½œæ‰€ä¸ºï¼ŒçœŸæ˜¯å‡­å®åŠ›å•ƒè€+å•èº«ã€‚ é¢“åºŸå®Œäº†ï¼Œè‡ªå‘ï¼Œå°±å®‰æ…°è‡ªå·±å…¨å›½å¤§å­¦ç”Ÿå æ¯”ä¸è¿‡3%ï¼Œåˆæƒ³æƒ³æˆ˜äº‰å¹´ä»£äººä»¬çš„æ‚²æƒ¨ï¼Œå°±è§‰å¾—è‡ªå·±å·²ç»æ¯”å¾ˆå¤šäººéƒ½æ´»å¾—å¥½äº†ã€‚ç”Ÿé€¢ç››ä¸–ï¼Œå›½æ³°æ°‘å®‰ï¼Œåˆèƒ½æ‰¾åˆ°è‡ªå·±å–œæ¬¢çš„ä¸œè¥¿ï¼Œè€Œä¸”ä¸»åŠ¨åœ°è¿½æ±‚äº†ã€‚è™½ç„¶æ²¡æœ‰å°½å…¨åŠ›ï¼Œä½†æ˜¯äººç”Ÿè‹¦çŸ­å˜›ï¼Œè¦åŠæ—¶äº«ä¹ã€‚é…¸ç”œè‹¦è¾£æ··ä¸€èµ·ï¼Œæˆ‘æ€»å½’æ˜¯çŸ¥è¶³çš„ã€‚ è¦çœŸèƒ½ç©¿è¶Šæˆ‘è‚¯å®šä¸ä¼šåƒè¿‡å»é‚£æ ·å¹²ï¼Œä½†æ˜¯ä¸èƒ½ç©¿è¶Šä¹Ÿä¸æ˜¯å¤ªå¯æƒœã€‚æˆ‘ç»å†è¿‡çš„ç³Ÿå¿ƒäº‹å’Œå¾ˆå¤šäººæœ‰è¿‡çš„ç»æœ›æ¯”èµ·æ¥ï¼Œæ ¹æœ¬ä¸å€¼ä¸€æï¼Œæˆ‘è¿˜èƒ½æœ‰ä»€ä¹ˆä¸æ»¡çš„å‘¢ï¼Ÿ è¿™ä¸ªä¸–ç•Œæ€»å½’æ˜¯ä¸ä¼šåœæ­¢è½¬åŠ¨ï¼Œä¹Ÿä¸ä¼šéšæˆ‘å¿ƒæ„ã€‚æˆ‘è®¨åŒçš„ç¹æ–‡ç¼›èŠ‚åœ¨äººé™…äº¤å¾€ä¸­æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œæˆ‘çš„è‡ªå‘æ˜¯è—ä¸ä½çš„ï¼Œæˆ‘çŸ¥è¯†ä¸Šçš„çŸ­æ¿ä¹Ÿæ˜¯å®å®åœ¨åœ¨çš„ã€‚ æˆ‘è¿˜èƒ½æ€ä¹ˆåšå‘¢ï¼Ÿæ€»ä¹‹å‘å‰èµ°å§ï¼Œä¸è®ºæ˜¯è¢«äººæµè£¹æŒŸç€ï¼Œè¿˜æ˜¯è¢«è‡ªå·±çš„æ¬²æœ›æ‹‰æ‰¯ç€ï¼Œéƒ½åªèƒ½å‘å‰â€”â€”äººç”Ÿæ˜¯æ²¡æœ‰é€€è·¯çš„ã€‚ ","date":"2019-04-14","objectID":"/posts/webnovel-addiction-recovery/:0:0","series":null,"tags":["Webnovel","ç½‘ç»œå°è¯´"],"title":"ç˜¾çš„é€€å´","uri":"/posts/webnovel-addiction-recovery/#"},{"categories":["tech"],"content":" ä¸ªäººç¬”è®°ï¼Œå¦‚æœ‰ç–æ¼ï¼Œè¿˜è¯·æŒ‡æ­£ã€‚ ä½¿ç”¨å¤šçº¿ç¨‹ï¼ˆthreadingï¼‰å’Œå¤šè¿›ç¨‹ï¼ˆmultiprocessingï¼‰å®Œæˆå¸¸è§„çš„å¹¶å‘éœ€æ±‚ï¼Œåœ¨å¯åŠ¨çš„æ—¶å€™ startã€join ç­‰æ­¥éª¤ä¸èƒ½çœï¼Œå¤æ‚çš„éœ€è¦è¿˜è¦ç”¨ 1-2 ä¸ªé˜Ÿåˆ—ã€‚éšç€éœ€æ±‚è¶Šæ¥è¶Šå¤æ‚ï¼Œå¦‚æœæ²¡æœ‰è‰¯å¥½çš„è®¾è®¡å’ŒæŠ½è±¡è¿™éƒ¨åˆ†çš„åŠŸèƒ½å±‚æ¬¡ï¼Œä»£ç é‡è¶Šå¤šè°ƒè¯•çš„éš¾åº¦å°±è¶Šå¤§ã€‚ å¯¹äºéœ€è¦å¹¶å‘æ‰§è¡Œã€ä½†æ˜¯å¯¹å®æ—¶æ€§è¦æ±‚ä¸é«˜çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ concurrent.futures åŒ…ä¸­çš„ PoolExecutor ç±»æ¥å®ç°ã€‚ è¿™ä¸ªåŒ…æä¾›äº†ä¸¤ä¸ªæ‰§è¡Œå™¨ï¼šçº¿ç¨‹æ± æ‰§è¡Œå™¨ ThreadPoolExecutor å’Œè¿›ç¨‹æ± æ‰§è¡Œå™¨ ProcessPoolExecutorï¼Œä¸¤ä¸ªæ‰§è¡Œå™¨æä¾›åŒæ ·çš„ APIã€‚ æ± çš„æ¦‚å¿µä¸»è¦ç›®çš„æ˜¯ä¸ºäº†é‡ç”¨ï¼šè®©çº¿ç¨‹æˆ–è¿›ç¨‹åœ¨ç”Ÿå‘½å‘¨æœŸå†…å¯ä»¥å¤šæ¬¡ä½¿ç”¨ã€‚å®ƒå‡å°‘äº†åˆ›å»ºåˆ›å»ºçº¿ç¨‹å’Œè¿›ç¨‹çš„å¼€é”€ï¼Œæé«˜äº†ç¨‹åºæ€§èƒ½ã€‚é‡ç”¨ä¸æ˜¯å¿…é¡»çš„è§„åˆ™ï¼Œä½†å®ƒæ˜¯ç¨‹åºå‘˜åœ¨åº”ç”¨ä¸­ä½¿ç”¨æ± çš„ä¸»è¦åŸå› ã€‚ æ± ï¼Œåªæœ‰å›ºå®šä¸ªæ•°çš„çº¿ç¨‹/è¿›ç¨‹ï¼Œé€šè¿‡ max_workers æŒ‡å®šã€‚ ä»»åŠ¡é€šè¿‡ executor.submit æäº¤åˆ° executor çš„ä»»åŠ¡é˜Ÿåˆ—ï¼Œè¿”å›ä¸€ä¸ª future å¯¹è±¡ã€‚ Future æ˜¯å¸¸è§çš„ä¸€ç§å¹¶å‘è®¾è®¡æ¨¡å¼ã€‚ä¸€ä¸ªFutureå¯¹è±¡ä»£è¡¨äº†ä¸€äº›å°šæœªå°±ç»ªï¼ˆå®Œæˆï¼‰çš„ç»“æœï¼Œåœ¨ã€Œå°†æ¥ã€çš„æŸä¸ªæ—¶é—´å°±ç»ªäº†ä¹‹åå°±å¯ä»¥è·å–åˆ°è¿™ä¸ªç»“æœã€‚ ä»»åŠ¡è¢«è°ƒåº¦åˆ°å„ä¸ª workers ä¸­æ‰§è¡Œã€‚ä½†æ˜¯è¦æ³¨æ„ï¼Œä¸€ä¸ªä»»åŠ¡ä¸€æ—¦è¢«æ‰§è¡Œï¼Œåœ¨æ‰§è¡Œå®Œæ¯•å‰ï¼Œä¼šä¸€ç›´å ç”¨è¯¥ workerï¼ å¦‚æœ workers ä¸å¤Ÿç”¨ï¼Œå…¶ä»–çš„ä»»åŠ¡ä¼šä¸€ç›´ç­‰å¾…ï¼å› æ­¤ PoolExecutor ä¸é€‚åˆå®æ—¶ä»»åŠ¡ã€‚ python import concurrent.futures import time from itertools import count number_list = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10] def evaluate_item(x): for i in count(x): # count æ˜¯æ— é™è¿­ä»£å™¨ï¼Œä¼šä¸€ç›´é€’å¢ã€‚ print(f\"{x} - {i}\") time.sleep(0.01) if __name__ == \"__main__\": # è¿›ç¨‹æ±  start_time_2 = time.time() # ä½¿ç”¨ with åœ¨ç¦»å¼€æ­¤ä»£ç å—æ—¶ï¼Œè‡ªåŠ¨è°ƒç”¨ executor.shutdown(wait=true) é‡Šæ”¾ executor èµ„æº with concurrent.futures.ThreadPoolExecutor(max_workers=5) as executor: # å°† 10 ä¸ªä»»åŠ¡æäº¤ç»™ executorï¼Œå¹¶æ”¶é›† futures futures = [executor.submit(evaluate_item, item) for item in number_list] # as_completed æ–¹æ³•ç­‰å¾… futures ä¸­çš„ future å®Œæˆ # ä¸€æ—¦æŸä¸ª future å®Œæˆï¼Œas_completed å°±ç«‹å³è¿”å›è¯¥ future # è¿™ä¸ªæ–¹æ³•ï¼Œä½¿æ¯æ¬¡è¿”å›çš„ futureï¼Œæ€»æ˜¯æœ€å…ˆå®Œæˆçš„ future # è€Œä¸æ˜¯å…ˆç­‰å¾…ä»»åŠ¡ 1ï¼Œå†ç­‰å¾…ä»»åŠ¡ 2... for future in concurrent.futures.as_completed(futures): # result è¿”å›è¢«è°ƒç”¨å‡½æ•°çš„è¿”å›å€¼ # å¦‚æœè°ƒç”¨æŠ›å‡ºäº†å¼‚å¸¸ï¼Œresult ä¼šæŠ›å‡ºåŒæ ·çš„å¼‚å¸¸ # å¦‚æœè°ƒç”¨è¢«å–æ¶ˆï¼Œresult æŠ›å‡º CancelledError å¼‚å¸¸ print(future.result()) print (\"Thread pool execution in \" + str(time.time() - start_time_2), \"seconds\") ä¸Šé¢çš„ä»£ç ä¸­ï¼Œitem ä¸º 1 2 3 4 5 çš„äº”ä¸ªä»»åŠ¡ä¼šä¸€ç›´å ç”¨æ‰€æœ‰çš„ workersï¼Œè€Œ 6 7 8 9 10 è¿™äº”ä¸ªä»»åŠ¡ä¼šæ°¸è¿œç­‰å¾…ï¼ï¼ï¼ ","date":"2019-03-15","objectID":"/posts/python-concurrency-pool-executor/:0:0","series":null,"tags":["Python","Concurrency","å¹¶å‘"],"title":"Python å¹¶å‘ç¼–ç¨‹ï¼šPoolExecutor ç¯‡","uri":"/posts/python-concurrency-pool-executor/#"},{"categories":["tech"],"content":" API è¯¦ç»†è¯´æ˜concurrent.futures åŒ…å«ä¸‰ä¸ªéƒ¨åˆ†çš„ APIï¼š PoolExecutorï¼šä¹Ÿå°±æ˜¯ä¸¤ä¸ªæ‰§è¡Œå™¨çš„ API æ„é€ å™¨ï¼šä¸»è¦çš„å‚æ•°æ˜¯ max_workersï¼Œç”¨äºæŒ‡å®šçº¿ç¨‹æ± å¤§å°ï¼ˆæˆ–è€…è¯´ workers ä¸ªæ•°ï¼‰ submit(fn, *args, **kwargs)ï¼šå°†ä»»åŠ¡å‡½æ•° fn æäº¤åˆ°æ‰§è¡Œå™¨ï¼Œargs å’Œ kwargs å°±æ˜¯ fn éœ€è¦çš„å‚æ•°ã€‚ è¿”å›ä¸€ä¸ª futureï¼Œç”¨äºè·å–ç»“æœ map(func, *iterables, timeout=None, chunksize=1)ï¼šå½“ä»»åŠ¡æ˜¯åŒä¸€ä¸ªï¼Œåªæœ‰å‚æ•°ä¸åŒæ—¶ï¼Œ å¯ä»¥ç”¨è¿™ä¸ªæ–¹æ³•ä»£æ›¿ submitã€‚iterables çš„æ¯ä¸ªå…ƒç´ å¯¹åº” func çš„ä¸€ç»„å‚æ•°ã€‚ è¿”å›ä¸€ä¸ª futures çš„è¿­ä»£å™¨ shutdown(wait=True)ï¼šå…³é—­æ‰§è¡Œå™¨ï¼Œä¸€èˆ¬éƒ½ä½¿ç”¨ with ç®¡ç†å™¨è‡ªåŠ¨å…³é—­ã€‚ Futureï¼šä»»åŠ¡è¢«æäº¤ç»™æ‰§è¡Œå™¨åï¼Œä¼šè¿”å›ä¸€ä¸ª future future.result(timeout=None)ï¼šæœ€å¸¸ç”¨çš„æ–¹æ³•ï¼Œè¿”å›ä»»åŠ¡çš„ç»“æœã€‚å¦‚æœä»»åŠ¡å°šæœªç»“æŸï¼Œè¿™ä¸ªæ–¹æ³•ä¼šä¸€ç›´ç­‰å¾…ï¼ timeout æŒ‡å®šè¶…æ—¶æ—¶é—´ï¼Œä¸º None æ—¶æ²¡æœ‰è¶…æ—¶é™åˆ¶ã€‚è¶…æ—¶ä¼šæŠ›å‡º concurrent.futures.TimeoutError å¼‚å¸¸ã€‚ å¦‚æœè°ƒç”¨æŠ›å‡ºäº†å¼‚å¸¸ï¼Œresult ä¼šæŠ›å‡ºåŒæ ·çš„å¼‚å¸¸ å¦‚æœè°ƒç”¨è¢«å–æ¶ˆï¼Œresult æŠ›å‡º CancelledError å¼‚å¸¸ exception(timeout=None)ï¼šè¿”å›ä»»åŠ¡æŠ›å‡ºçš„å¼‚å¸¸ã€‚å’Œ result() ä¸€æ ·ï¼Œä¹Ÿä¼šç­‰å¾…ä»»åŠ¡ç»“æŸã€‚ timeout å‚æ•°è·Ÿ result ä¸€è‡´ï¼Œè¶…æ—¶ä¼šæŠ›å‡º concurrent.futures.TimeoutError å¼‚å¸¸ã€‚ å¦‚æœè°ƒç”¨æŠ›å‡ºäº†å¼‚å¸¸ï¼Œexception ä¼šè¿”å›åŒæ ·çš„å¼‚å¸¸ï¼Œå¦åˆ™è¿”å› None å¦‚æœè°ƒç”¨è¢«å–æ¶ˆï¼Œresult æŠ›å‡º CancelledError å¼‚å¸¸ cancel()ï¼šå–æ¶ˆæ­¤ä»»åŠ¡ add_done_callback(fn)ï¼šfuture å®Œæˆåï¼Œä¼šæ‰§è¡Œ fn(future)ã€‚ running()ï¼šæ˜¯å¦æ­£åœ¨è¿è¡Œ done()ï¼šfuture æ˜¯å¦å·²ç»ç»“æŸäº†ï¼Œboolean â€¦è¯¦è§å®˜æ–¹æ–‡æ¡£ æ¨¡å—å¸¦æœ‰çš„å®ç”¨å‡½æ•° concurrent.futures.as_completed(fs, timeout=None)ï¼šç­‰å¾… fs ï¼ˆfutures iterableï¼‰ä¸­çš„ future å®Œæˆ ä¸€æ—¦ fs ä¸­çš„æŸ future å®Œæˆäº†ï¼Œè¿™ä¸ªå‡½æ•°å°±ç«‹å³è¿”å›è¯¥ futureã€‚ è¿™ä¸ªæ–¹æ³•ï¼Œä½¿æ¯æ¬¡è¿”å›çš„ futureï¼Œæ€»æ˜¯æœ€å…ˆå®Œæˆçš„ futureã€‚è€Œä¸æ˜¯å…ˆç­‰å¾…ä»»åŠ¡ 1ï¼Œå†ç­‰å¾…ä»»åŠ¡ 2â€¦ å¸¸é€šè¿‡ for future in as_completed(fs): ä½¿ç”¨æ­¤å‡½æ•°ã€‚ concurrent.futures.wait(fs, timeout=None, return_when=ALL_COMPLETED)ï¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ° return_when æ‰€æŒ‡å®šçš„äº‹å‘ç”Ÿï¼Œæˆ–è€… timeout return_when æœ‰ä¸‰ä¸ªé€‰é¡¹ï¼šALL_COMPLETEDï¼ˆfs ä¸­çš„ futures å…¨éƒ¨å®Œæˆï¼‰ï¼ŒFIRST__COMPLETEDï¼ˆfs ä¸­ä»»æ„ä¸€ä¸ª future å®Œæˆï¼‰è¿˜æœ‰ FIRST_EXCEPTIONï¼ˆæŸä»»åŠ¡æŠ›å‡ºå¼‚å¸¸ï¼‰ ","date":"2019-03-15","objectID":"/posts/python-concurrency-pool-executor/:1:0","series":null,"tags":["Python","Concurrency","å¹¶å‘"],"title":"Python å¹¶å‘ç¼–ç¨‹ï¼šPoolExecutor ç¯‡","uri":"/posts/python-concurrency-pool-executor/#api-è¯¦ç»†è¯´æ˜"},{"categories":["tech"],"content":" Future è®¾è®¡æ¨¡å¼è¿™é‡Œçš„ PoolExecutor çš„ç‰¹ç‚¹ï¼Œåœ¨äºå®ƒä½¿ç”¨äº† Future è®¾è®¡æ¨¡å¼ï¼Œä½¿ä»»åŠ¡çš„æ‰§è¡Œï¼Œä¸ç»“æœçš„è·å–ï¼Œå˜æˆä¸€ä¸ªå¼‚æ­¥çš„æµç¨‹ã€‚ æˆ‘ä»¬å…ˆé€šè¿‡ submit/map å°†ä»»åŠ¡æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—ï¼Œè¿™æ—¶ä»»åŠ¡å°±å·²ç»å¼€å§‹æ‰§è¡Œäº†ï¼ ç„¶åæˆ‘ä»¬åœ¨éœ€è¦çš„æ—¶å€™ï¼Œé€šè¿‡ future è·å–ç»“æœï¼Œæˆ–è€…ç›´æ¥ add_done_callback(fn)ã€‚ è¿™é‡Œä»»åŠ¡çš„æ‰§è¡Œæ˜¯åœ¨æ–°çš„ workers ä¸­çš„ï¼Œä¸»è¿›ç¨‹/çº¿ç¨‹ä¸ä¼šé˜»å¡ï¼Œå› æ­¤ä¸»çº¿ç¨‹å¯ä»¥å¹²å…¶ä»–çš„äº‹ã€‚è¿™ç§æ–¹å¼è¢«ç§°ä½œå¼‚æ­¥ç¼–ç¨‹ã€‚ ","date":"2019-03-15","objectID":"/posts/python-concurrency-pool-executor/:2:0","series":null,"tags":["Python","Concurrency","å¹¶å‘"],"title":"Python å¹¶å‘ç¼–ç¨‹ï¼šPoolExecutor ç¯‡","uri":"/posts/python-concurrency-pool-executor/#future-è®¾è®¡æ¨¡å¼"},{"categories":["tech"],"content":" ç”»å¤–concurrent.futures åŸºäº multiprocessing.pool å®ç°ï¼Œå› æ­¤å®é™…ä¸Šå®ƒæ¯”ç›´æ¥ä½¿ç”¨ çº¿ç¨‹/è¿›ç¨‹ çš„ Pool è¦æ…¢ä¸€ç‚¹ã€‚ä½†æ˜¯å®ƒæä¾›äº†æ›´æ–¹ä¾¿ç®€æ´çš„ APIã€‚ ","date":"2019-03-15","objectID":"/posts/python-concurrency-pool-executor/:3:0","series":null,"tags":["Python","Concurrency","å¹¶å‘"],"title":"Python å¹¶å‘ç¼–ç¨‹ï¼šPoolExecutor ç¯‡","uri":"/posts/python-concurrency-pool-executor/#ç”»å¤–"},{"categories":["tech"],"content":" å‚è€ƒ ä½¿ç”¨Pythonè¿›è¡Œå¹¶å‘ç¼–ç¨‹-PoolExecutorç¯‡ Python Parallel Programming Cookbook concurrent.futures â€” Launching parallel tasks è¿›ç¨‹çº¿ç¨‹åç¨‹ä¸å¹¶å‘å¹¶è¡Œ å¹¶è¡Œè®¾è®¡æ¨¡å¼ï¼ˆä¸€ï¼‰â€“ Futureæ¨¡å¼ ","date":"2019-03-15","objectID":"/posts/python-concurrency-pool-executor/:4:0","series":null,"tags":["Python","Concurrency","å¹¶å‘"],"title":"Python å¹¶å‘ç¼–ç¨‹ï¼šPoolExecutor ç¯‡","uri":"/posts/python-concurrency-pool-executor/#å‚è€ƒ"},{"categories":["tech"],"content":" ä¸ªäººç¬”è®°ï¼Œä¸ä¿è¯æ­£ç¡®ã€‚ è™½ç„¶è¯´çœ‹åˆ°å¾ˆå¤šäººä¸çœ‹å¥½ asyncioï¼Œä½†æ˜¯è¿™ä¸ªä¸œè¥¿è¿˜æ˜¯å¿…é¡»å­¦çš„ã€‚ã€‚åŸºäºåç¨‹çš„å¼‚æ­¥ï¼Œåœ¨å¾ˆå¤šè¯­è¨€ä¸­éƒ½æœ‰ï¼Œå­¦ä¼šäº† Python çš„ï¼Œå°±ä¸€é€šç™¾é€šã€‚ ","date":"2019-02-14","objectID":"/posts/python-asyncio/:0:0","series":null,"tags":["Python","asyncio"],"title":"Python å¼‚æ­¥ç¼–ç¨‹ç¬”è®°ï¼šasyncio","uri":"/posts/python-asyncio/#"},{"categories":["tech"],"content":" ä¸€ã€ç”Ÿæˆå™¨ generatorPython çš„ asyncio æ˜¯é€šè¿‡ generator å®ç°çš„ï¼Œè¦å­¦ä¹  asyncï¼Œå…ˆå¾—å¤ä¹ ä¸‹ generator. ","date":"2019-02-14","objectID":"/posts/python-asyncio/:1:0","series":null,"tags":["Python","asyncio"],"title":"Python å¼‚æ­¥ç¼–ç¨‹ç¬”è®°ï¼šasyncio","uri":"/posts/python-asyncio/#ä¸€ç”Ÿæˆå™¨-generator"},{"categories":["tech"],"content":" 1. yieldä¼—æ‰€å‘¨çŸ¥ï¼Œyield æ˜¯ç”¨äºå®šä¹‰ generator å‡½æ•°çš„å…³é”®å­—ï¼Œè°ƒç”¨è¯¥å‡½æ•°ï¼Œä¼šè¿”å›ä¸€ä¸ª generator python \u003e\u003e\u003e def f(): ... yield 1 ... yield 2 ... \u003e\u003e\u003e f() # è¿”å›çš„æ˜¯ generator \u003cgenerator object f at 0x7f672c460570\u003e \u003e\u003e\u003e g = f() \u003e\u003e\u003e next(g) # é€šè¿‡ next æ–¹æ³•ä» generator è·å–å€¼ 1 \u003e\u003e\u003e g.__next__() # next æ–¹æ³•å®é™…æ˜¯è°ƒç”¨äº† generator çš„ __next__ æ–¹æ³• 2 \u003e\u003e\u003e next(g) # ç”Ÿæˆå™¨è¿è¡Œç»“æŸï¼Œäº§ç”Ÿä¸€ä¸ª StopIteration çš„ exception Traceback (most recent call last): File \"\u003cstdin\u003e\", line 1, in \u003cmodule\u003e StopIteration æ¯æ¬¡è°ƒç”¨ nextï¼Œgenerator éƒ½åªä¼šè¿è¡Œåˆ°ä¸‹ä¸€ä¸ª yield å…³é”®å­—æ‰€åœ¨è¡Œï¼Œè¿”å› yield å³ä¾§çš„å¯¹è±¡ï¼Œç„¶åæš‚åœåœ¨è¯¥å¤„ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡ next è°ƒç”¨ã€‚ ä»ä¸Šé¢çš„ä¾‹å­çœ‹ï¼Œyield å°±æ˜¯å»¶è¿Ÿæ±‚å€¼è€Œå·²ã€‚ä½†æ˜¯ yield è¿˜æœ‰ä¸€ä¸ªç‰¹æ€§ï¼Œå°±æ˜¯å®ƒæ˜¯ä¸€ä¸ª expressionï¼Œæœ‰è¿”å›å€¼ï¼çœ‹ä¾‹å­ï¼š Python \u003e\u003e\u003e def func(): ... r = yield 1 ... yield r ... \u003e\u003e\u003e g = func() \u003e\u003e\u003e next(g) 1 \u003e\u003e\u003e next(g) # é€šè¿‡ next è°ƒç”¨ï¼Œyield çš„è¿”å›å€¼ä¸º None \u003e\u003e\u003e g2 = func() \u003e\u003e\u003e next(g2) # é¦–å…ˆéœ€è¦é€šè¿‡ next è°ƒç”¨ï¼Œè¿è¡Œåˆ° yield è¯­å¥å¤„ 1 \u003e\u003e\u003e g2.send(419) # ç°åœ¨ç”¨ send æ–¹æ³•ï¼Œè¿™ä¼šå°†å½“å‰æ‰€åœ¨çš„ yield è¯­å¥çš„å€¼è®¾ç½®ä¸ºä½  send çš„å€¼ï¼Œä¹Ÿå°±æ˜¯ 419 419 # ç„¶å generator è¿è¡Œåˆ°ä¸‹ä¸€ä¸ª yieldï¼Œè¿”å›å³è¾¹çš„å€¼å¹¶æš‚åœ generator æœ‰å››ä¸ªå®ä¾‹å‡½æ•°ï¼šnextã€send æ˜¯åˆšåˆšå·²ç»ä»‹ç»äº†çš„ï¼Œæ­¤å¤–è¿˜æœ‰ throw ç”¨äºä» yield æ‰€åœ¨å¤„æŠ›å‡º Exceptionï¼Œå’Œ close ç”¨äºå…³é—­ Generatorã€‚è¯¦è§Generator-iterator methods ","date":"2019-02-14","objectID":"/posts/python-asyncio/:1:1","series":null,"tags":["Python","asyncio"],"title":"Python å¼‚æ­¥ç¼–ç¨‹ç¬”è®°ï¼šasyncio","uri":"/posts/python-asyncio/#1-yield"},{"categories":["tech"],"content":" 2. yield from å¯ä»¥ç†è§£æˆæ˜¯ yield \u003cvalue\u003e from \u003citerable\u003eï¼Œæ¯æ¬¡è°ƒç”¨æ—¶å®ƒéƒ½ä¼šä» \u003citerable\u003e ä¸­å–å€¼ï¼Œç›´åˆ°é‡åˆ° StopIterationã€‚æ‰ä¼šä»ä¸‹ä¸€ä¸ª yield å–å€¼ã€‚ python \u003e\u003e\u003e def f(): ... yield from [1, 2, 3, 4] # iterable ... yield 5 ... yield from range(4, 0, -1) # iterable ... \u003e\u003e\u003e list(f()) [1, 2, 3, 4, 5, 4, 3, 2, 1] å½“ç„¶ï¼Œyield from \u003citerable\u003e ä¹Ÿæ˜¯ä¸€ä¸ª expressionï¼Œä¹Ÿæœ‰å€¼ã€‚å®ƒçš„å€¼å°±æ˜¯ StopIteration å¼‚å¸¸çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå†…ç½®ç±»å‹çš„è¿™ä¸ªå€¼éƒ½æ˜¯ None. python \u003e\u003e\u003e def f(): ... r = yield from [1, 2] ... yield f\"value of yield from is {r}\" ... \u003e\u003e\u003e list(f()) [1, 2, 'value of yield from is None'] å½“ \u003citerable\u003e æ˜¯ generator æ—¶ï¼Œyield from ä¼šç›´æ¥å°†å‡½æ•°è°ƒç”¨å§”æ‰˜ç»™è¿™ä¸ªå­ generatorï¼Œè¿™é‡Œçš„è°ƒç”¨åŒ…æ‹¬äº†å‰é¢è¯´è¿‡çš„ nextã€sendã€throwã€close å››ä¸ªå‡½æ•°ã€‚å¹¶ç›´æ¥å°† sub generator yield çš„å€¼ yield ç»™ caller. ","date":"2019-02-14","objectID":"/posts/python-asyncio/:1:2","series":null,"tags":["Python","asyncio"],"title":"Python å¼‚æ­¥ç¼–ç¨‹ç¬”è®°ï¼šasyncio","uri":"/posts/python-asyncio/#2-yield-from"},{"categories":["tech"],"content":" 3. yield å’Œ return æ··ç”¨ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿgenerator ä¸­çš„ return valueï¼Œè¯­ä¹‰ä¸Šç­‰åŒäº raise StopIteration(value)ï¼š shell \u003e\u003e\u003e def f(): ... yield 1 ... return 2 ... yield 3 # æ°¸è¿œä¸ä¼šè¢«æ‰§è¡Œ ... \u003e\u003e\u003e g = f() \u003e\u003e\u003e next(g) 1 \u003e\u003e\u003e next(g) # return å¼•å‘ StopIteration Traceback (most recent call last): File \"\u003cinput\u003e\", line 1, in \u003cmodule\u003e StopIteration: 2 \u003e\u003e\u003e next(g) # å†æ¬¡è°ƒç”¨ï¼ŒStopIteration å˜æˆæ— å‚äº†ã€‚ Traceback (most recent call last): File \"\u003cinput\u003e\", line 1, in \u003cmodule\u003e StopIteration å¯ä»¥çœ‹åˆ° return å¼•å‘äº† StopIteration å¼‚å¸¸ï¼Œè€Œ return çš„å€¼åˆ™æˆäº†è¯¥å¼‚å¸¸çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚ ä¹‹å‰è¯´è¿‡ yield from \u003csub generator\u003e è¡¨è¾¾å¼çš„å€¼ï¼Œå°±æ˜¯è¯¥ \u003csub generator\u003e çš„ StopIteration å¼‚å¸¸çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå› æ­¤ï¼š shell \u003e\u003e\u003e def f2(): ... a = yield from f() ... yield a # a æ˜¯ f() ä¸­ return çš„å€¼ ... \u003e\u003e\u003e list(f2()) [1, 2] PEP 479 â€“ Change StopIteration handling inside generators ä¿®æ”¹äº†StopIteration çš„è¡Œä¸ºï¼Œè¯¥ PEP ä½¿äººä¸º raise çš„ StopIteration å¼•å‘ä¸€ä¸ª RuntimeErrorã€‚è¯¥ PEP åœ¨ Python 3.5 ç‰ˆæœ¬æ·»åŠ åˆ° future ä¸­ï¼Œå¹¶åœ¨ Python 3.7 æˆä¸ºé»˜è®¤è¡Œä¸ºã€‚å› æ­¤é™¤éä½ ç¡®å®æƒ³è¦å¼•å‘å¼‚å¸¸ï¼Œå¦åˆ™åº”è¯¥ä½¿ç”¨ return æ¥ç»“æŸä¸€ä¸ª generator å¹¶è¿”å›å€¼ã€‚ ","date":"2019-02-14","objectID":"/posts/python-asyncio/:1:3","series":null,"tags":["Python","asyncio"],"title":"Python å¼‚æ­¥ç¼–ç¨‹ç¬”è®°ï¼šasyncio","uri":"/posts/python-asyncio/#3-yield-å’Œ-return-æ··ç”¨ä¼šå‘ç”Ÿä»€ä¹ˆ"},{"categories":["tech"],"content":" äºŒã€å¼‚æ­¥IOã€åç¨‹ä¸éé˜»å¡ IOå…ˆäº†è§£ä¸€ä¸‹ è¿›ç¨‹çº¿ç¨‹åç¨‹ä¸å¹¶å‘å¹¶è¡Œ å’Œå„ç§ IO æ¨¡å‹ ","date":"2019-02-14","objectID":"/posts/python-asyncio/:2:0","series":null,"tags":["Python","asyncio"],"title":"Python å¼‚æ­¥ç¼–ç¨‹ç¬”è®°ï¼šasyncio","uri":"/posts/python-asyncio/#äºŒå¼‚æ­¥ioåç¨‹ä¸éé˜»å¡-io"},{"categories":["tech"],"content":" ä¸‰ã€asyncio çš„ç®€å•ä½¿ç”¨asyncio å¼•å…¥äº†ä¸¤ä¸ªæ–°å…³é”®å­—ï¼šasync å’Œ awaitï¼Œå…¶ä¸­ async èƒ½æ”¾åœ¨ä¸‰ä¸ªåœ°æ–¹ï¼š async defï¼šç”¨äºå®šä¹‰å¼‚æ­¥å‡½æ•°å’Œå¼‚æ­¥ç”Ÿæˆå™¨ ä¸å«æœ‰ yield çš„æ˜¯ async def å®šä¹‰çš„æ˜¯åç¨‹å‡½æ•°ï¼ˆcoroutine functionï¼‰ï¼Œè°ƒç”¨è¯¥å‡½æ•°è¿”å›åç¨‹å¯¹è±¡ï¼ˆcoroutine objectï¼‰ï¼Œåç¨‹å¯¹è±¡éœ€è¦é€šè¿‡ EventLoop è¿è¡Œã€‚ å†…éƒ¨å«æœ‰ yield çš„ async def å®šä¹‰çš„æ˜¯å¼‚æ­¥ç”Ÿæˆå™¨å‡½æ•°ï¼ˆasynchronous generator functionï¼‰ï¼Œè°ƒç”¨è¯¥å‡½æ•°è¿”å›å¼‚æ­¥ç”Ÿæˆå™¨ï¼ˆasync_generatorï¼‰ å¼‚æ­¥ç”Ÿæˆå™¨åªèƒ½ç”¨åœ¨ Coroutine ä¸­ async def ä¸­ä¸å…è®¸ä½¿ç”¨ yield from async forï¼šè¡¨ç¤º for è¿­ä»£çš„æ˜¯ä¸€ä¸ªå¼‚æ­¥ç”Ÿæˆå™¨ï¼Œè¯¥ for å¾ªç¯çš„æ¯ä¸€æ¬¡è¿­ä»£ï¼Œéƒ½æ˜¯å¼‚æ­¥çš„ã€‚ åªèƒ½ç”¨åœ¨ async def çš„å†…éƒ¨ async withï¼šè¡¨ç¤º with ç®¡ç†çš„æ˜¯ä¸€ä¸ªå¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼ˆasynchronous context managerï¼‰ è¯¥ context manager çš„ enter å’Œ exit ä¸¤ä¸ªæ­¥éª¤æ˜¯å¼‚æ­¥çš„ åªèƒ½ç”¨åœ¨ async def çš„å†…éƒ¨ æ³¨æ„å¼‚æ­¥ generatorã€context managerï¼Œå®ƒçš„ protocol éƒ½å’ŒåŒæ­¥çš„ä¸åŒï¼Œä¸èƒ½æ··ä¸ºä¸€è°ˆã€‚å…·ä½“è€Œè¨€ï¼Œå¯¹åŒæ­¥ protocol xxx å‡½æ•°ï¼Œå®ƒçš„å¼‚æ­¥ç‰ˆæœ¬ä¸º axxxï¼Œå°±æ˜¯åŠ ä¸ª aã€‚ è€Œ awaitï¼Œå°±ç›¸å½“äº yield fromï¼Œå·®åˆ«åœ¨äº await æ˜¯å¼‚æ­¥çš„ã€‚è¿˜æœ‰æˆ‘ä»¬å…³å¿ƒçš„æ˜¯ await è¡¨è¾¾å¼çš„å€¼ï¼Œè€Œ yield from ä¸­æˆ‘ä»¬æ›´å…³å¿ƒå®ƒå‘ä¸Šå±‚ yield çš„å€¼ã€‚ åœ¨ yield from ä¸­ï¼Œå½“å‰ç”Ÿæˆå™¨è°ƒç”¨å¦ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œå½“å‰ç”Ÿæˆå™¨ä¼šæŒ‚èµ·ï¼Œç›´åˆ°å¦ä¸€ä¸ªç”Ÿæˆå™¨è¿”å›ã€‚ ä½†æ˜¯åœ¨ await ä¸­ï¼Œå½“å‰ Coroutine æŒ‚èµ·æ—¶ï¼Œ eventloop ä¼šå¯»æ‰¾å…¶ä»– task æ¥è·‘ï¼Œè¿™å°±åˆ©ç”¨ä¸Šäº† IO æ¼«é•¿çš„ç­‰å¾…æ—¶é—´ã€‚ async for æ˜¯æ¯æ¬¡è¿­ä»£éƒ½ä¼š await ä¸€æ¬¡ï¼Œå¦‚æœè¿­ä»£å¯¹è±¡æ˜¯ IO æ“ä½œï¼Œè¿™ä¸ª IO ç­‰å¾…æ—¶é—´å°±ä¼šè¢«åˆ©ç”¨ä¸Šã€‚ async with ä¹Ÿæ˜¯åŒæ ·ï¼Œå¦‚æœ context çš„ enter å’Œ exit æ˜¯ IO æ“ä½œï¼Œè¿™ä¸ª IO æ—¶é—´å°±ä¼šè¢« eventloop ç”¨äºè¿è¡Œå…¶ä»– task. ä½¿ç”¨ asyncio æ—¶ï¼Œæˆ‘ä»¬è¦ç”¨ async def å°†æ‰€æœ‰çš„ IO æ“ä½œéƒ½å®šä¹‰æˆå¼‚æ­¥æ“ä½œã€‚ç„¶ååœ¨è°ƒç”¨æ—¶ï¼Œéƒ½ä½¿ç”¨ await/async for/async with æ¥è°ƒç”¨ã€‚ ","date":"2019-02-14","objectID":"/posts/python-asyncio/:3:0","series":null,"tags":["Python","asyncio"],"title":"Python å¼‚æ­¥ç¼–ç¨‹ç¬”è®°ï¼šasyncio","uri":"/posts/python-asyncio/#ä¸‰asyncio-çš„ç®€å•ä½¿ç”¨"},{"categories":["tech"],"content":" å››ã€Coroutineã€Task å’Œ Futureé¦–å…ˆï¼Œæ¯ä¸ªåç¨‹å¯¹è±¡ï¼Œéƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„åç¨‹å•å…ƒï¼Œåç¨‹å¯¹è±¡ä¹‹é—´å¯ä»¥å¼‚æ­¥è¿è¡Œã€‚ åç¨‹éœ€è¦æ”¾åˆ° EventLoop å†…è¿è¡Œï¼Œè¦è¿è¡Œä¸€ä¸ªåç¨‹ aï¼Œæœ‰ä¸‰ç§æ–¹æ³•ï¼š é€šè¿‡ asyncio.run(coro) è¿è¡Œä¸€ä¸ªåç¨‹ã€‚ è¯¥æ–¹æ³•ä¼šæ–°å»ºä¸€ä¸ª EventLoop åœ¨å¦ä¸€ä¸ªåç¨‹ b ä¸­é€šè¿‡ await è°ƒç”¨ aã€‚å½“ b è¿è¡Œæ—¶ï¼Œ a ä¹Ÿä¼šè¢« task è¿è¡Œã€‚ é€šè¿‡ asyncio.create_task(coro)ï¼Œå°†éœ€è¦è¿è¡Œçš„åç¨‹åŒ…è£…æˆ taskï¼Œç„¶åé€šè¿‡ task ç›¸å…³çš„æ–¹æ³•æ¥å¼‚æ­¥è¿è¡Œå®ƒä»¬ã€‚ asyncio.gather(*awaitable_objects): å¹¶å‘æ‰§è¡Œæ‰€æœ‰çš„ taskï¼Œé˜»å¡åˆ°æ‰€æœ‰ task ç»“æŸã€‚è¿”å›ä¸€ä¸ª result åˆ—è¡¨ã€‚result çš„åˆ—è¡¨é¡ºåºå’Œ future çš„é¡ºåºä¸€è‡´ asyncio.as_completed(aws, *, loop=None, timeout=None)ï¼Œå’Œ gather çš„åŒºåˆ«åœ¨äºï¼Œå®ƒè¿”å›ä¸€ä¸ªå¼‚æ­¥è¿­ä»£å™¨ï¼Œæ¯æ¬¡è¿­ä»£éƒ½è¿”å›æœ€å…ˆå®Œæˆçš„ä¸€ä¸ª future. concurrent.futures æ˜¯è¿›ç¨‹çº¿ç¨‹çš„å¼‚æ­¥æ‰§è¡Œï¼Œè€Œ asyncio æ˜¯åŸºäºåç¨‹çš„å•çº¿ç¨‹å¼‚æ­¥æ‰§è¡Œ ","date":"2019-02-14","objectID":"/posts/python-asyncio/:4:0","series":null,"tags":["Python","asyncio"],"title":"Python å¼‚æ­¥ç¼–ç¨‹ç¬”è®°ï¼šasyncio","uri":"/posts/python-asyncio/#å››coroutinetask-å’Œ-future"},{"categories":["tech"],"content":" äº”ã€å‚è€ƒ ä»0åˆ°1ï¼ŒPythonå¼‚æ­¥ç¼–ç¨‹çš„æ¼”è¿›ä¹‹è·¯ æ€ä¹ˆæŒæ¡ asyncio Python Async/Awaitå…¥é—¨æŒ‡å— è°ˆè°ˆPythonåç¨‹æŠ€æœ¯çš„æ¼”è¿› Python Doc - Coroutines Python Doc - asyncio ","date":"2019-02-14","objectID":"/posts/python-asyncio/:5:0","series":null,"tags":["Python","asyncio"],"title":"Python å¼‚æ­¥ç¼–ç¨‹ç¬”è®°ï¼šasyncio","uri":"/posts/python-asyncio/#äº”å‚è€ƒ"},{"categories":["tech"],"content":"ç…§ä¾‹å…ˆçœ‹å±‚æ¬¡å›¾ SQLAlchemy å±‚æ¬¡ç»“æ„ ","date":"2019-02-11","objectID":"/posts/sqlalchemy-notes-2-orm-basics/:0:0","series":null,"tags":["SQLAlchemy","Python","ORM","åç«¯","æ•°æ®åº“","Database"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šORM åŸºç¡€","uri":"/posts/sqlalchemy-notes-2-orm-basics/#"},{"categories":["tech"],"content":" ä¸€ã€å£°æ˜æ˜ å°„å…³ç³»ä½¿ç”¨ ORM æ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å®šä¹‰è¦æ“ä½œçš„è¡¨ï¼ˆé€šè¿‡ Tableï¼‰ï¼Œç„¶åå†å®šä¹‰è¯¥è¡¨å¯¹åº”çš„ Python classï¼Œå¹¶å£°æ˜ä¸¤è€…ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼ˆé€šè¿‡ Mapperï¼‰ã€‚ æ–¹ä¾¿èµ·è§ï¼ŒSQLAlchemy æä¾›äº† Declarative ç³»ç»Ÿæ¥ä¸€æ¬¡å®Œæˆä¸Šè¿°ä¸‰ä¸ªæ­¥éª¤ï¼ŒDeclarative ç³»ç»Ÿæä¾› base classï¼Œè¿™ä¸ª base class ä¼šä¸ºç»§æ‰¿äº†å®ƒçš„ Python classï¼ˆå¯ç§°ä½œ modelï¼‰åˆ›å»º Tableï¼Œå¹¶ç»´æŠ¤ä¸¤è€…çš„æ˜ å°„å…³ç³»ã€‚ python from sqlalchemy.ext.declarative import declarative_base from SQLAlchemy import Column, Integer, String Base = declarative_base() # æ‹¿åˆ° Base ç±» class User(Base): id = Column(Integer, primary_key=True) username = Column(String(32), nullable=False, index=True) # æ·»åŠ  index æå‡æœç´¢æ•ˆç‡ fullname = Column(String(64)) password = Column(String(32)) # çœŸå®æƒ…å†µä¸‹ä¸€èˆ¬åªå­˜ hash def __repr__(self): return f\"\u003cUser {self.username}\u003e\" è¿™æ ·å°±å£°æ˜å¥½äº†ä¸€ä¸ªå¯¹è±¡-å…³ç³»æ˜ å°„ï¼Œä¸Šä¸€ç¯‡æ–‡ç« è¯´è¿‡æ‰€æœ‰çš„ Table éƒ½åœ¨æŸä¸ª MetaData ä¸­ï¼Œå¯ä»¥é€šè¿‡Base.metadata è·å–å®ƒã€‚ python Base.metadata.create_all(engine) # é€šè¿‡ metadata åˆ›å»ºè¡¨ï¼ˆæˆ–è€…è¯´ç”Ÿæˆæ¨¡å¼ schemaï¼‰ engine çš„åˆ›å»ºè¯·è§ä¸Šç¯‡æ–‡æ¡£SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šEngine ä¸ SQL è¡¨è¾¾å¼è¯­è¨€ çº¦æŸæ¡ä»¶ å¯å‚è€ƒ SQL åŸºç¡€ç¬”è®°ï¼ˆä¸‰ï¼‰ï¼šçº¦æŸ ä¸SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šEngine ä¸ SQL è¡¨è¾¾å¼è¯­è¨€ - è¡¨å®šä¹‰ä¸­çš„çº¦æŸ ä½¿ç”¨ ORM æ¥å®šä¹‰çº¦æŸæ¡ä»¶ï¼Œä¸ç›´æ¥ä½¿ç”¨ SQL è¡¨è¾¾å¼è¯­è¨€å®šä¹‰å¾ˆç±»ä¼¼ï¼Œä¹Ÿæœ‰ä¸¤ç§æ–¹æ³•ï¼š ç›´æ¥å°†çº¦æŸæ¡ä»¶ä½œä¸º Columnã€ForeignKey çš„å‚æ•°ä¼ å…¥ã€‚è¿™ç§æ–¹å¼æœ€ç®€æ´ï¼Œä¹Ÿæœ€å¸¸ç”¨ã€‚ ä½¿ç”¨ UniqueConstraintã€CheckConstraint ç­‰ç±»æ„é€ çº¦æŸï¼Œç„¶åæ”¾å…¥ __table_args__ å±æ€§ä¸­ã€‚ä¸¾ä¾‹ï¼š python3 class User(Base): id = Column(Integer, primary_key=True) username = Column(String(32), nullable=False, index=True) # æ·»åŠ  index æå‡æœç´¢æ•ˆç‡ fullname = Column(String(64)) password = Column(String(32)) # çœŸå®æƒ…å†µä¸‹ä¸€èˆ¬åªå­˜ hash # é¡¾åæ€ä¹‰ï¼Œè¿™æ˜¯ `Table` ç±»çš„å‚æ•°çš„åºåˆ—ã€‚é‡Œé¢çš„çº¦æŸæ¡ä»¶ä¼šè¢«ç”¨äºæ„å»º __table__ __table_args__ = (UniqueConstraint('username', name='c_user'),) # username çš„å”¯ä¸€æ€§çº¦æŸ def __repr__(self): return f\"\u003cUser {self.username}\u003e\" ","date":"2019-02-11","objectID":"/posts/sqlalchemy-notes-2-orm-basics/:0:1","series":null,"tags":["SQLAlchemy","Python","ORM","åç«¯","æ•°æ®åº“","Database"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šORM åŸºç¡€","uri":"/posts/sqlalchemy-notes-2-orm-basics/#ä¸€å£°æ˜æ˜ å°„å…³ç³»"},{"categories":["tech"],"content":" ä¸€ã€å£°æ˜æ˜ å°„å…³ç³»ä½¿ç”¨ ORM æ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å®šä¹‰è¦æ“ä½œçš„è¡¨ï¼ˆé€šè¿‡ Tableï¼‰ï¼Œç„¶åå†å®šä¹‰è¯¥è¡¨å¯¹åº”çš„ Python classï¼Œå¹¶å£°æ˜ä¸¤è€…ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼ˆé€šè¿‡ Mapperï¼‰ã€‚ æ–¹ä¾¿èµ·è§ï¼ŒSQLAlchemy æä¾›äº† Declarative ç³»ç»Ÿæ¥ä¸€æ¬¡å®Œæˆä¸Šè¿°ä¸‰ä¸ªæ­¥éª¤ï¼ŒDeclarative ç³»ç»Ÿæä¾› base classï¼Œè¿™ä¸ª base class ä¼šä¸ºç»§æ‰¿äº†å®ƒçš„ Python classï¼ˆå¯ç§°ä½œ modelï¼‰åˆ›å»º Tableï¼Œå¹¶ç»´æŠ¤ä¸¤è€…çš„æ˜ å°„å…³ç³»ã€‚ python from sqlalchemy.ext.declarative import declarative_base from SQLAlchemy import Column, Integer, String Base = declarative_base() # æ‹¿åˆ° Base ç±» class User(Base): id = Column(Integer, primary_key=True) username = Column(String(32), nullable=False, index=True) # æ·»åŠ  index æå‡æœç´¢æ•ˆç‡ fullname = Column(String(64)) password = Column(String(32)) # çœŸå®æƒ…å†µä¸‹ä¸€èˆ¬åªå­˜ hash def __repr__(self): return f\"\" è¿™æ ·å°±å£°æ˜å¥½äº†ä¸€ä¸ªå¯¹è±¡-å…³ç³»æ˜ å°„ï¼Œä¸Šä¸€ç¯‡æ–‡ç« è¯´è¿‡æ‰€æœ‰çš„ Table éƒ½åœ¨æŸä¸ª MetaData ä¸­ï¼Œå¯ä»¥é€šè¿‡Base.metadata è·å–å®ƒã€‚ python Base.metadata.create_all(engine) # é€šè¿‡ metadata åˆ›å»ºè¡¨ï¼ˆæˆ–è€…è¯´ç”Ÿæˆæ¨¡å¼ schemaï¼‰ engine çš„åˆ›å»ºè¯·è§ä¸Šç¯‡æ–‡æ¡£SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šEngine ä¸ SQL è¡¨è¾¾å¼è¯­è¨€ çº¦æŸæ¡ä»¶ å¯å‚è€ƒ SQL åŸºç¡€ç¬”è®°ï¼ˆä¸‰ï¼‰ï¼šçº¦æŸ ä¸SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šEngine ä¸ SQL è¡¨è¾¾å¼è¯­è¨€ - è¡¨å®šä¹‰ä¸­çš„çº¦æŸ ä½¿ç”¨ ORM æ¥å®šä¹‰çº¦æŸæ¡ä»¶ï¼Œä¸ç›´æ¥ä½¿ç”¨ SQL è¡¨è¾¾å¼è¯­è¨€å®šä¹‰å¾ˆç±»ä¼¼ï¼Œä¹Ÿæœ‰ä¸¤ç§æ–¹æ³•ï¼š ç›´æ¥å°†çº¦æŸæ¡ä»¶ä½œä¸º Columnã€ForeignKey çš„å‚æ•°ä¼ å…¥ã€‚è¿™ç§æ–¹å¼æœ€ç®€æ´ï¼Œä¹Ÿæœ€å¸¸ç”¨ã€‚ ä½¿ç”¨ UniqueConstraintã€CheckConstraint ç­‰ç±»æ„é€ çº¦æŸï¼Œç„¶åæ”¾å…¥ __table_args__ å±æ€§ä¸­ã€‚ä¸¾ä¾‹ï¼š python3 class User(Base): id = Column(Integer, primary_key=True) username = Column(String(32), nullable=False, index=True) # æ·»åŠ  index æå‡æœç´¢æ•ˆç‡ fullname = Column(String(64)) password = Column(String(32)) # çœŸå®æƒ…å†µä¸‹ä¸€èˆ¬åªå­˜ hash # é¡¾åæ€ä¹‰ï¼Œè¿™æ˜¯ `Table` ç±»çš„å‚æ•°çš„åºåˆ—ã€‚é‡Œé¢çš„çº¦æŸæ¡ä»¶ä¼šè¢«ç”¨äºæ„å»º __table__ __table_args__ = (UniqueConstraint('username', name='c_user'),) # username çš„å”¯ä¸€æ€§çº¦æŸ def __repr__(self): return f\"\" ","date":"2019-02-11","objectID":"/posts/sqlalchemy-notes-2-orm-basics/:0:1","series":null,"tags":["SQLAlchemy","Python","ORM","åç«¯","æ•°æ®åº“","Database"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šORM åŸºç¡€","uri":"/posts/sqlalchemy-notes-2-orm-basics/#çº¦æŸæ¡ä»¶"},{"categories":["tech"],"content":" äºŒã€è·å– sessionä¸Šä¸€èŠ‚è®² engine æ—¶ï¼Œæˆ‘ä»¬æ˜¯é€šè¿‡ connection æ¥ä¸æ•°æ®åº“äº¤äº’ï¼Œè€Œåœ¨ ORM ä¸­æˆ‘ä»¬ä½¿ç”¨ Session è®¿é—®æ•°æ®åº“ã€‚ python from sqlalchemy.orm import sessionmaker Session = sessionmaker(bind=engine) # è·å– session ","date":"2019-02-11","objectID":"/posts/sqlalchemy-notes-2-orm-basics/:0:2","series":null,"tags":["SQLAlchemy","Python","ORM","åç«¯","æ•°æ®åº“","Database"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šORM åŸºç¡€","uri":"/posts/sqlalchemy-notes-2-orm-basics/#äºŒè·å–-session"},{"categories":["tech"],"content":" ä¸‰ã€å¢åˆ æ”¹æŸ¥ç›´æ¥ä½¿ç”¨ SQL è¡¨è¾¾å¼è¯­è¨€æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ insert()ã€select()ã€update()ã€delete() å››ä¸ªå‡½æ•°æ„é€  SQLï¼Œä½¿ç”¨ where() æ·»åŠ æ¡ä»¶ï¼Œä½¿ç”¨ model.join(another_model) è¿›è¡Œ join æ“ä½œã€‚è€Œä½¿ç”¨ ORM æ—¶ï¼Œ æ•°æ®åº“æ“ä½œä¸å†ä¸ SQL ç›´æ¥å¯¹åº”ã€‚æˆ‘ä»¬ç°åœ¨æ˜¯é€šè¿‡æ“ä½œ Python å¯¹è±¡æ¥æ“ä½œæ•°æ®åº“äº†ã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬é€šè¿‡ db.session.add()ã€db.session.delete() è¿›è¡Œæ·»åŠ ä¸åˆ é™¤ï¼Œä½¿ç”¨ db.session.query(Model) è¿›è¡ŒæŸ¥è¯¢ï¼Œé€šè¿‡ filter å’Œ filter_by æ·»åŠ è¿‡æ»¤æ¡ä»¶ã€‚è€Œä¿®æ”¹ï¼Œåˆ™æ˜¯å…ˆæŸ¥è¯¢å‡ºå¯¹åº”çš„ row å¯¹è±¡ï¼Œç›´æ¥ä¿®æ”¹è¿™ä¸ªå¯¹è±¡ï¼Œç„¶å commit å°±è¡Œã€‚ å¢æ·»ï¼š python ed_user = User(name='ed', fullname='Ed Jones', password='edspassword') # ç”¨æ„é€ å™¨æ„é€ å¯¹è±¡ session.add(ed_user) # æ·»åŠ ï¼Œæ­¤å¤–è¿˜æœ‰æ‰¹é‡æ·»åŠ  add_all([user1, user2...]) session.commit() # å¿…é¡»æ‰‹åŠ¨ commit ä¿®æ”¹ï¼š python ed_user = session.query(User).filter_by(name='ed').first() # å…ˆè·å–åˆ° User å¯¹è±¡ ed_user.password = 'f8s7ccs' # æ”¹äº†å¯†ç  session.commit() # æäº¤ # æ‰¹é‡ä¿®æ”¹ session.query(User).filter(User.home=='shanghai') \\ .update({User.login_num:0}) # å°†æ‰€æœ‰ä¸Šæµ·çš„ç”¨æˆ·çš„ login_num è®¾ä¸º 0 session.commit() åˆ é™¤ï¼š python ed_user = session.query(User).filter_by(name='ed').first() # å…ˆè·å–åˆ° User å¯¹è±¡ session.delete(ed_user) # ç›´æ¥åˆ é™¤ï¼ˆsession çŸ¥é“ ed_user å±äºå“ªä¸ªè¡¨ï¼‰ session.commit() # æäº¤ # æ‰¹é‡åˆ é™¤ session.query(User).filter(User.home=='shanghai') \\ .delete() # åˆ é™¤æ‰€æœ‰ä¸Šæµ·çš„ç”¨æˆ· session.commit() åŒæ ·çš„ï¼Œä¹Ÿå¯ä»¥åœ¨å¤–é¢æ£€æŸ¥å¼‚å¸¸ï¼Œç„¶åè°ƒç”¨ session.rollback() å®ç°å¤±è´¥å›æ»šã€‚ ","date":"2019-02-11","objectID":"/posts/sqlalchemy-notes-2-orm-basics/:0:3","series":null,"tags":["SQLAlchemy","Python","ORM","åç«¯","æ•°æ®åº“","Database"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šORM åŸºç¡€","uri":"/posts/sqlalchemy-notes-2-orm-basics/#ä¸‰å¢åˆ æ”¹æŸ¥"},{"categories":["tech"],"content":" å››ã€è¿›é˜¶æŸ¥è¯¢ filter_byï¼šä½¿ç”¨å…³é”®å­—å‚æ•°è¿›è¡Œè¿‡æ»¤ï¼Œå‰é¢çš„æ¼”ç¤ºä¸­å·²ç»ç”¨è¿‡å¤šæ¬¡äº†ã€‚ filterï¼šå®ƒå¯¹åº” SQL è¡¨è¾¾å¼è¯­è¨€ä¸­çš„ whereï¼Œæ”¯æŒå„ç§å¤æ‚çš„ SQL è¯­æ³•ã€‚ group_by: é€šè¿‡æŒ‡å®š column åˆ†ç»„ distinct(): å»é‡ join(): å…³è” python query.filter(User.name == 'ed') # è¿™ä¸ªç­‰åŒäº filter_byï¼Œä½†æ˜¯æ›´ç¹ç query.filter(User.name != 'ed') # ä¸ç­‰äºï¼Œè¿™ä¸ªå°±æ˜¯ filter_by æ— æ³•åšåˆ°çš„äº† query.filter(User.name.like('%ed%')) # SQL like çš„ like è¯­æ³• query.filter(User.name.in_(['ed', 'wendy', 'jack'])) # åŒ…å« # æŸ¥è¯¢è¿˜å¯ä»¥åµŒå¥— query.filter(User.name.in_( session.query(User.name).filter(User.name.like('%ed%')) )) query.filter(~User.name.in_(['ed', 'wendy', 'jack'])) # ä¸åŒ…å« query.filter(User.name == None) # NULL å¯¹åº” Python çš„ None from sqlalchemy import or_, and_, in_ query.filter(or_(User.name == 'ed', User.name == 'wendy')) # OR è¯­æ³• query.group_by(User.name) # åˆ†ç»„ query.distinct() # å»é‡ from sqlalchemy import func # SQL å‡½æ•°åŒ… session.query(func.count(User.name)).filter_by(xxx=xxx) # ä½¿ç”¨ count å‡½æ•° # join å…³è” # é»˜è®¤ä½¿ç”¨å†…è”ï¼ˆinnerï¼‰ï¼Œå³åªå–ä¸¤è¡¨çš„äº¤é›† session.query(User, Address).filter(User.id==Address.user_id) # æ–¹æ³•ä¸€ session.query(User).join(Address).\\ # æ–¹æ³•äºŒ filter(Address.email_address=='jack@google.com') # å¤–è” outer joinï¼Œå°†å¦ä¸€è¡¨çš„åˆ—è”ç»“åˆ°ä¸»è¡¨ï¼Œæ²¡æœ‰çš„è¡Œä¸º NULL session.query(User).outerjoin(User.addresses) \\ .filter(Address.email_address=='jack@google.com') æ‰§è¡ŒæŸ¥è¯¢ï¼Œè·å–æ•°æ®æŸ¥è¯¢è¿”å› query å¯¹è±¡ï¼Œä½† SQL è¿˜æ²¡æœ‰è¢«æ‰§è¡Œï¼Œç›´åˆ°ä½ è°ƒç”¨ä¸‹åˆ—å‡ ä¸ªæ–¹æ³•ï¼š python # æ„é€  query å¯¹è±¡ query = session.query(User).filter(User.name.like('%ed')).order_by(User.id) # 1. all è¿”å›æ‰€æœ‰ç»“æœçš„åˆ—è¡¨ res_list = query.all() # 2. first å…ˆåœ¨ SQL ä¸­åŠ å…¥é™åˆ¶ `limit 1`ï¼Œç„¶åæ‰§è¡Œã€‚ res = query.first() # 3. one æ‰§è¡Œ sql å¹¶è·å–æ‰€æœ‰ç»“æœ # å¦‚æœç»“æœä¸æ­¢ä¸€è¡Œï¼ŒæŠ›å‡º MultipleResultsFound Errorï¼ï¼ï¼ # å¦‚æœç»“æœä¸ºç©ºï¼ŒæŠ›å‡º NoResultFound Error ï¼ï¼ï¼ res = query.one() 4. one_or_none å·®åˆ«åœ¨äºç»“æœä¸ºç©ºï¼Œå®ƒä¸æŠ›å‡ºå¼‚å¸¸ï¼Œè€Œæ˜¯è¿”å› None res = query.one_or_none() ","date":"2019-02-11","objectID":"/posts/sqlalchemy-notes-2-orm-basics/:0:4","series":null,"tags":["SQLAlchemy","Python","ORM","åç«¯","æ•°æ®åº“","Database"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šORM åŸºç¡€","uri":"/posts/sqlalchemy-notes-2-orm-basics/#å››è¿›é˜¶æŸ¥è¯¢"},{"categories":["tech"],"content":" å››ã€è¿›é˜¶æŸ¥è¯¢ filter_byï¼šä½¿ç”¨å…³é”®å­—å‚æ•°è¿›è¡Œè¿‡æ»¤ï¼Œå‰é¢çš„æ¼”ç¤ºä¸­å·²ç»ç”¨è¿‡å¤šæ¬¡äº†ã€‚ filterï¼šå®ƒå¯¹åº” SQL è¡¨è¾¾å¼è¯­è¨€ä¸­çš„ whereï¼Œæ”¯æŒå„ç§å¤æ‚çš„ SQL è¯­æ³•ã€‚ group_by: é€šè¿‡æŒ‡å®š column åˆ†ç»„ distinct(): å»é‡ join(): å…³è” python query.filter(User.name == 'ed') # è¿™ä¸ªç­‰åŒäº filter_byï¼Œä½†æ˜¯æ›´ç¹ç query.filter(User.name != 'ed') # ä¸ç­‰äºï¼Œè¿™ä¸ªå°±æ˜¯ filter_by æ— æ³•åšåˆ°çš„äº† query.filter(User.name.like('%ed%')) # SQL like çš„ like è¯­æ³• query.filter(User.name.in_(['ed', 'wendy', 'jack'])) # åŒ…å« # æŸ¥è¯¢è¿˜å¯ä»¥åµŒå¥— query.filter(User.name.in_( session.query(User.name).filter(User.name.like('%ed%')) )) query.filter(~User.name.in_(['ed', 'wendy', 'jack'])) # ä¸åŒ…å« query.filter(User.name == None) # NULL å¯¹åº” Python çš„ None from sqlalchemy import or_, and_, in_ query.filter(or_(User.name == 'ed', User.name == 'wendy')) # OR è¯­æ³• query.group_by(User.name) # åˆ†ç»„ query.distinct() # å»é‡ from sqlalchemy import func # SQL å‡½æ•°åŒ… session.query(func.count(User.name)).filter_by(xxx=xxx) # ä½¿ç”¨ count å‡½æ•° # join å…³è” # é»˜è®¤ä½¿ç”¨å†…è”ï¼ˆinnerï¼‰ï¼Œå³åªå–ä¸¤è¡¨çš„äº¤é›† session.query(User, Address).filter(User.id==Address.user_id) # æ–¹æ³•ä¸€ session.query(User).join(Address).\\ # æ–¹æ³•äºŒ filter(Address.email_address=='jack@google.com') # å¤–è” outer joinï¼Œå°†å¦ä¸€è¡¨çš„åˆ—è”ç»“åˆ°ä¸»è¡¨ï¼Œæ²¡æœ‰çš„è¡Œä¸º NULL session.query(User).outerjoin(User.addresses) \\ .filter(Address.email_address=='jack@google.com') æ‰§è¡ŒæŸ¥è¯¢ï¼Œè·å–æ•°æ®æŸ¥è¯¢è¿”å› query å¯¹è±¡ï¼Œä½† SQL è¿˜æ²¡æœ‰è¢«æ‰§è¡Œï¼Œç›´åˆ°ä½ è°ƒç”¨ä¸‹åˆ—å‡ ä¸ªæ–¹æ³•ï¼š python # æ„é€  query å¯¹è±¡ query = session.query(User).filter(User.name.like('%ed')).order_by(User.id) # 1. all è¿”å›æ‰€æœ‰ç»“æœçš„åˆ—è¡¨ res_list = query.all() # 2. first å…ˆåœ¨ SQL ä¸­åŠ å…¥é™åˆ¶ `limit 1`ï¼Œç„¶åæ‰§è¡Œã€‚ res = query.first() # 3. one æ‰§è¡Œ sql å¹¶è·å–æ‰€æœ‰ç»“æœ # å¦‚æœç»“æœä¸æ­¢ä¸€è¡Œï¼ŒæŠ›å‡º MultipleResultsFound Errorï¼ï¼ï¼ # å¦‚æœç»“æœä¸ºç©ºï¼ŒæŠ›å‡º NoResultFound Error ï¼ï¼ï¼ res = query.one() 4. one_or_none å·®åˆ«åœ¨äºç»“æœä¸ºç©ºï¼Œå®ƒä¸æŠ›å‡ºå¼‚å¸¸ï¼Œè€Œæ˜¯è¿”å› None res = query.one_or_none() ","date":"2019-02-11","objectID":"/posts/sqlalchemy-notes-2-orm-basics/:0:4","series":null,"tags":["SQLAlchemy","Python","ORM","åç«¯","æ•°æ®åº“","Database"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šORM åŸºç¡€","uri":"/posts/sqlalchemy-notes-2-orm-basics/#æ‰§è¡ŒæŸ¥è¯¢è·å–æ•°æ®"},{"categories":["tech"],"content":" å‚è€ƒ SQLAlchemy å¯¹è±¡å…³ç³»å…¥é—¨ SQLAlchemy ORM çš„å…³è”æ˜ å°„å®šä¹‰ï¼šä¸€å¯¹å¤šã€å¤šå¯¹å¤š hackersandslackers/sqlalchemy-tutorial ","date":"2019-02-11","objectID":"/posts/sqlalchemy-notes-2-orm-basics/:0:5","series":null,"tags":["SQLAlchemy","Python","ORM","åç«¯","æ•°æ®åº“","Database"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šORM åŸºç¡€","uri":"/posts/sqlalchemy-notes-2-orm-basics/#å‚è€ƒ"},{"categories":["tech"],"content":" ä¸€ã€WebSocketWebSocket æ˜¯ä¸€ä¸ªåŒå‘é€šä¿¡åè®®ï¼Œå®ƒåœ¨æ¡æ‰‹é˜¶æ®µé‡‡ç”¨ HTTP/1.1 åè®®ï¼ˆæš‚æ—¶ä¸æ”¯æŒ HTTP/2ï¼‰ã€‚ æ¡æ‰‹è¿‡ç¨‹å¦‚ä¸‹ï¼š é¦–å…ˆå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘èµ·ä¸€ä¸ªç‰¹æ®Šçš„ HTTP è¯·æ±‚ï¼Œå…¶æ¶ˆæ¯å¤´å¦‚ä¸‹ï¼š headers GET /chat HTTP/1.1 // è¯·æ±‚è¡Œ Host: server.example.com Upgrade: websocket // required Connection: Upgrade // required Sec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ== // requiredï¼Œä¸€ä¸ª 16bits ç¼–ç å¾—åˆ°çš„ base64 ä¸² Origin: http://example.com // ç”¨äºé˜²æ­¢æœªè®¤è¯çš„è·¨åŸŸè„šæœ¬ä½¿ç”¨æµè§ˆå™¨ websocket api ä¸æœåŠ¡ç«¯è¿›è¡Œé€šä¿¡ Sec-WebSocket-Protocol: chat, superchat // optional, å­åè®®åå•†å­—æ®µ Sec-WebSocket-Version: 13 å¦‚æœæœåŠ¡ç«¯æ”¯æŒè¯¥ç‰ˆæœ¬çš„ WebSocketï¼Œä¼šè¿”å› 101 å“åº”ï¼Œå“åº”æ ‡å¤´å¦‚ä¸‹ï¼š headers HTTP/1.1 101 Switching Protocols // çŠ¶æ€è¡Œ Upgrade: websocket // required Connection: Upgrade // required Sec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK+xOo= // requiredï¼ŒåŠ å¯†åçš„ Sec-WebSocket-Key Sec-WebSocket-Protocol: chat // è¡¨æ˜é€‰æ‹©çš„å­åè®® æ¡æ‰‹å®Œæˆåï¼Œæ¥ä¸‹æ¥çš„ TCP æ•°æ®åŒ…å°±éƒ½æ˜¯ WebSocket åè®®çš„å¸§äº†ã€‚ å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œçš„æ¡æ‰‹ä¸æ˜¯ TCP çš„æ¡æ‰‹ï¼Œè€Œæ˜¯åœ¨ TCP è¿æ¥å†…éƒ¨ï¼Œä» HTTP/1.1 upgrade åˆ° WebSocket çš„æ¡æ‰‹ã€‚ WebSocket æä¾›ä¸¤ç§åè®®ï¼šä¸åŠ å¯†çš„ ws:// å’Œ åŠ å¯†çš„ wss://. å› ä¸ºæ˜¯ç”¨ HTTP æ¡æ‰‹ï¼Œå®ƒå’Œ HTTP ä½¿ç”¨åŒæ ·çš„ç«¯å£ï¼šws æ˜¯ 80ï¼ˆHTTPï¼‰ï¼Œwss æ˜¯ 443ï¼ˆHTTPSï¼‰ åœ¨ Python ç¼–ç¨‹ä¸­ï¼Œå¯ä½¿ç”¨ websockets å®ç°çš„å¼‚æ­¥ WebSocket å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ã€‚æ­¤å¤– aiohttp ä¹Ÿæä¾›äº† WebSocket æ”¯æŒã€‚ Noteï¼šå¦‚æœä½ æœç´¢ Flask çš„ WebSocket æ’ä»¶ï¼Œå¾—åˆ°çš„ç¬¬ä¸€ä¸ªç»“æœå¾ˆå¯èƒ½æ˜¯Flask-SocketIOã€‚ä½†æ˜¯Flask-ScoektIO ä½¿ç”¨çš„æ˜¯å®ƒç‹¬æœ‰çš„ SocketIO åè®®ï¼Œå¹¶ä¸æ˜¯æ ‡å‡†çš„ WebSocketã€‚åªæ˜¯å®ƒåˆšå¥½æä¾›ä¸ WebSocket ç›¸åŒçš„åŠŸèƒ½è€Œå·²ã€‚ SocketIO çš„ä¼˜åŠ¿åœ¨äºåªè¦ Web ç«¯ä½¿ç”¨äº† SocketIO.jsï¼Œå°±èƒ½æ”¯æŒè¯¥åè®®ã€‚è€Œçº¯ WS åè®®ï¼Œåªæœ‰è¾ƒæ–°çš„æµè§ˆå™¨æ‰æ”¯æŒã€‚å¯¹äºå®¢æˆ·ç«¯é Web çš„æƒ…å†µï¼Œæ›´å¥½çš„é€‰æ‹©å¯èƒ½æ˜¯ä½¿ç”¨ Flask-Socketsã€‚ ","date":"2019-02-11","objectID":"/posts/websocket-http2-and-grpc/:1:0","series":null,"tags":["WebSocket","gRPC","HTTP/2"],"title":"WebSocketã€HTTP/2 ä¸ gRPC","uri":"/posts/websocket-http2-and-grpc/#ä¸€websocket"},{"categories":["tech"],"content":" JS API javascript // WebSocket API var socket = new WebSocket(\"ws://websocket.example.com\") // Show a connected message when the WebSocket is opened. socket.onopen = function (event) { console.log(\"WebSocket is connected.\") } // Handle messages sent by the server. socket.onmessage = function (event) { var message = event.data console.log(message) } // Handle any error that occurs. socket.onerror = function (error) { console.log(\"WebSocket Error: \" + error) } ","date":"2019-02-11","objectID":"/posts/websocket-http2-and-grpc/:1:1","series":null,"tags":["WebSocket","gRPC","HTTP/2"],"title":"WebSocketã€HTTP/2 ä¸ gRPC","uri":"/posts/websocket-http2-and-grpc/#js-api"},{"categories":["tech"],"content":" äºŒã€HTTP/2HTTP/2 äº 2015 å¹´æ ‡å‡†åŒ–ï¼Œä¸»è¦ç›®çš„æ˜¯ä¼˜åŒ–æ€§èƒ½ã€‚å…¶ç‰¹æ€§å¦‚ä¸‹ï¼š äºŒè¿›åˆ¶åè®®ï¼šHTTP/2 çš„æ¶ˆæ¯å¤´ä½¿ç”¨äºŒè¿›åˆ¶æ ¼å¼ï¼Œè€Œéæ–‡æœ¬æ ¼å¼ã€‚å¹¶ä¸”ä½¿ç”¨ä¸“é—¨è®¾è®¡çš„ HPack ç®—æ³•å‹ç¼©ã€‚ å¤šè·¯å¤ç”¨ï¼ˆMultiplexingï¼‰ï¼šå°±æ˜¯è¯´ HTTP/2 å¯ä»¥é‡å¤ä½¿ç”¨åŒä¸€ä¸ª TCP è¿æ¥ï¼Œå¹¶ä¸”è¿æ¥æ˜¯å¤šè·¯çš„ï¼Œ å¤šä¸ªè¯·æ±‚æˆ–å“åº”å¯ä»¥åŒæ—¶ä¼ è¾“ã€‚ å¯¹æ¯”ä¹‹ä¸‹ï¼ŒHTTP/1.1 çš„é•¿è¿æ¥ä¹Ÿèƒ½å¤ç”¨ TCP è¿æ¥ï¼Œä½†æ˜¯åªèƒ½ä¸²è¡Œï¼Œä¸èƒ½ã€Œå¤šè·¯ã€ã€‚ æœåŠ¡å™¨æ¨é€ï¼šæœåŠ¡ç«¯èƒ½å¤Ÿç›´æ¥æŠŠèµ„æºæ¨é€ç»™å®¢æˆ·ç«¯ï¼Œå½“å®¢æˆ·ç«¯éœ€è¦è¿™äº›æ–‡ä»¶çš„æ—¶å€™ï¼Œå®ƒå·²ç»åœ¨å®¢æˆ·ç«¯äº†ã€‚ï¼ˆè¯¥æ¨é€å¯¹ Web App æ˜¯éšè—çš„ï¼Œç”±æµè§ˆå™¨å¤„ç†ï¼‰ HTTP/2 å…è®¸å–æ¶ˆæŸä¸ªæ­£åœ¨ä¼ è¾“çš„æ•°æ®æµï¼ˆé€šè¿‡å‘é€ RST_STREAM å¸§ï¼‰ï¼Œè€Œä¸å…³é—­ TCP è¿æ¥ã€‚ è¿™æ­£æ˜¯äºŒè¿›åˆ¶åè®®çš„å¥½å¤„ä¹‹ä¸€ï¼Œå¯ä»¥å®šä¹‰å¤šç§åŠŸèƒ½çš„æ•°æ®å¸§ã€‚ å®ƒå…è®¸æœåŠ¡ç«¯å°†èµ„æºæ¨é€åˆ°å®¢æˆ·ç«¯ç¼“å­˜ï¼Œæˆ‘ä»¬è®¿é—®æ·˜å®ç­‰ç½‘ç«™æ—¶ï¼Œç»å¸¸ä¼šå‘ç°å¾ˆå¤šè¯·æ±‚çš„è¯·æ±‚å¤´éƒ¨åˆ†ä¼šæç¤ºã€Œprovisional headers are shownã€ï¼Œè¿™é€šå¸¸å°±æ˜¯ç›´æ¥ä»ç¼“å­˜åŠ è½½äº†èµ„æºï¼Œå› æ­¤è¯·æ±‚æ ¹æœ¬æ²¡æœ‰è¢«å‘é€ã€‚è§‚å¯Ÿ Chrome Network çš„ Size åˆ—ï¼Œè¿™ç§è¯·æ±‚çš„è¯¥å­—æ®µä¸€èˆ¬éƒ½æ˜¯ from disk cache æˆ–è€…from memory cache. Chrome å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼æŸ¥çœ‹è¯·æ±‚ä½¿ç”¨çš„åè®®ï¼š 2019-02-10: ä½¿ç”¨ Chrome æŸ¥çœ‹ï¼Œç›®å‰ä¸»æµç½‘ç«™åŸºæœ¬éƒ½å·²ç»éƒ¨åˆ†ä½¿ç”¨äº† HTTP/2ï¼ŒçŸ¥ä¹ã€bilibiliã€GIthub ä½¿ç”¨äº† wss åè®®ï¼Œä¹Ÿæœ‰å¾ˆå¤šç½‘ç«™ä½¿ç”¨äº† SSEï¼ˆæ ¼å¼å¦‚data:image/png;base64,\u003cbase64 string\u003eï¼‰è€Œä¸”å¾ˆå¤šç½‘ç«™éƒ½æœ‰ä½¿ç”¨ HTTP/2 + QUICï¼Œè¯¥åè®®çš„æ–°åç§°æ˜¯ HTTP/3ï¼Œå®ƒæ˜¯åŸºäº UDP çš„ HTTP åè®®ã€‚ ","date":"2019-02-11","objectID":"/posts/websocket-http2-and-grpc/:2:0","series":null,"tags":["WebSocket","gRPC","HTTP/2"],"title":"WebSocketã€HTTP/2 ä¸ gRPC","uri":"/posts/websocket-http2-and-grpc/#äºŒhttp2"},{"categories":["tech"],"content":" SSEæœåŠ¡ç«¯æ¨é€äº‹ä»¶ï¼Œæ˜¯é€šè¿‡ HTTP é•¿è¿æ¥è¿›è¡Œä¿¡æ¯æ¨é€çš„ä¸€ä¸ªåŠŸèƒ½ã€‚å®ƒé¦–å…ˆç”±æµè§ˆå™¨å‘æœåŠ¡ç«¯å»ºç«‹ä¸€ä¸ª HTTP é•¿è¿æ¥ï¼Œç„¶åæœåŠ¡ç«¯ä¸æ–­åœ°é€šè¿‡è¿™ä¸ªé•¿è¿æ¥å°†æ¶ˆæ¯æ¨é€ç»™æµè§ˆå™¨ã€‚JS API å¦‚ä¸‹ï¼š javascript // create SSE connection var source = new EventSource(\"/dates\") // è¿æ¥å»ºç«‹æ—¶ï¼Œè¿™äº› API å’Œ WebSocket çš„å¾ˆç›¸ä¼¼ source.onopen = function (event) { // handle open event } // æ”¶åˆ°æ¶ˆæ¯æ—¶ï¼ˆå®ƒåªæ•è·æœªå‘½å eventï¼‰ source.onmessage = function (event) { var data = event.data // å‘é€è¿‡æ¥çš„å®é™…æ•°æ®ï¼ˆstringï¼‰ var origin = event.origin // æœåŠ¡å™¨ç«¯URLçš„åŸŸåéƒ¨åˆ†ï¼Œå³åè®®ã€åŸŸåå’Œç«¯å£ã€‚ var lastEventId = event.lastEventId // æ•°æ®çš„ç¼–å·ï¼Œç”±æœåŠ¡å™¨ç«¯å‘é€ã€‚å¦‚æœæ²¡æœ‰ç¼–å·ï¼Œè¿™ä¸ªå±æ€§ä¸ºç©ºã€‚ // handle message } source.onerror = function (event) { // handle error event } ","date":"2019-02-11","objectID":"/posts/websocket-http2-and-grpc/:2:1","series":null,"tags":["WebSocket","gRPC","HTTP/2"],"title":"WebSocketã€HTTP/2 ä¸ gRPC","uri":"/posts/websocket-http2-and-grpc/#sse"},{"categories":["tech"],"content":" å…·ä½“çš„å®ç°åœ¨æ”¶åˆ°å®¢æˆ·ç«¯çš„ SSE è¯·æ±‚ï¼ˆHTTP åè®®ï¼‰æ—¶ï¼ŒæœåŠ¡ç«¯è¿”å›çš„å“åº”é¦–éƒ¨å¦‚ä¸‹ï¼š headers Content-Type: text/event-stream Cache-Control: no-cache Connection: keep-alive è€Œ body éƒ¨åˆ†ï¼ŒSSE å®šä¹‰äº†å››ç§ä¿¡æ¯ï¼š dataï¼šæ•°æ®æ  eventï¼šè‡ªå®šä¹‰æ•°æ®ç±»å‹ id ï¼šæ•°æ® id retryï¼šæœ€å¤§é—´éš”æ—¶é—´ï¼Œè¶…æ—¶åˆ™é‡æ–°è¿æ¥ body ä¸¾ä¾‹è¯´æ˜ï¼š text : è¿™ç§æ ¼å¼çš„æ¶ˆæ¯æ˜¯æ³¨é‡Šï¼Œä¼šè¢«å¿½ç•¥\\n\\n : é€šå¸¸æœåŠ¡å™¨æ¯éš”ä¸€æ®µæ—¶é—´å°±ä¼šå‘é€ä¸€ä¸ªæ³¨é‡Šï¼Œé˜²æ­¢è¶…æ—¶ retry\\n\\n : ä¸‹é¢è¿™ä¸ªæ˜¯ä¸€ä¸ªå•è¡Œæ•°æ®\\n\\n data: some text\\n\\n : ä¸‹é¢è¿™ä¸ªæ˜¯å¤šè¡Œæ•°æ®ï¼Œåœ¨å®¢æˆ·ç«¯ä¼šé‡ç»„æˆä¸€ä¸ª data\\n\\n data: {\\n data: \"foo\": \"bar\",\\n data: \"baz\", 555\\n data: }\\n\\n : è¿™æ˜¯ä¸€ä¸ªå‘½å eventï¼Œåªä¼šè¢«äº‹ä»¶åä¸ä¹‹ç›¸åŒçš„ listener æ•è·\\n\\n event: foo\\n data: a foo event\\n\\n : æœªå‘½åäº‹ä»¶ï¼Œä¼šè¢« onmessage æ•è·\\n\\n data: an unnamed event\\n\\n event: bar\\n data: a bar event\\n\\n : è¿™ä¸ª id å¯¹åº” event.lastEventId\\n\\n id: msg1\\n data: message\\n\\n ","date":"2019-02-11","objectID":"/posts/websocket-http2-and-grpc/:2:2","series":null,"tags":["WebSocket","gRPC","HTTP/2"],"title":"WebSocketã€HTTP/2 ä¸ gRPC","uri":"/posts/websocket-http2-and-grpc/#å…·ä½“çš„å®ç°"},{"categories":["tech"],"content":" WebSocketã€HTTP/2 ä¸ SSE çš„æ¯”è¾ƒ åŠ å¯†ä¸å¦ï¼š WebSocket æ”¯æŒæ˜æ–‡é€šä¿¡ ws:// å’ŒåŠ å¯† wss://ï¼Œ è€Œ HTTP/2 åè®®è™½ç„¶æ²¡æœ‰è§„å®šå¿…é¡»åŠ å¯†ï¼Œä½†æ˜¯ä¸»æµæµè§ˆå™¨éƒ½åªæ”¯æŒ HTTP/2 over TLS. SSE æ˜¯ä½¿ç”¨çš„ HTTP åè®®é€šä¿¡ï¼Œæ”¯æŒ http/https æ¶ˆæ¯æ¨é€ï¼š WebSocketæ˜¯å…¨åŒå·¥é€šé“ï¼Œå¯ä»¥åŒå‘é€šä¿¡ã€‚è€Œä¸”æ¶ˆæ¯æ˜¯ç›´æ¥æ¨é€ç»™ Web App. SSE åªèƒ½å•å‘ä¸²è¡Œåœ°ä»æœåŠ¡ç«¯å°†æ•°æ®æ¨é€ç»™ Web App. HTTP/2 è™½ç„¶ä¹Ÿæ”¯æŒ Server Pushï¼Œä½†æ˜¯æœåŠ¡å™¨åªèƒ½ä¸»åŠ¨å°†èµ„æºæ¨é€åˆ°å®¢æˆ·ç«¯ç¼“å­˜ï¼å¹¶ä¸å…è®¸å°†æ•°æ®æ¨é€åˆ°å®¢æˆ·ç«¯é‡Œè·‘çš„ Web App æœ¬èº«ã€‚æœåŠ¡å™¨æ¨é€åªèƒ½ç”±æµè§ˆå™¨å¤„ç†ï¼Œä¸ä¼šåœ¨åº”ç”¨ç¨‹åºä»£ç ä¸­å¼¹å‡ºæœåŠ¡å™¨æ•°æ®ï¼Œè¿™æ„å‘³ç€åº”ç”¨ç¨‹åºæ²¡æœ‰ API æ¥è·å–è¿™äº›äº‹ä»¶çš„é€šçŸ¥ã€‚ ä¸ºäº†æ¥è¿‘å®æ—¶åœ°å°†æ•°æ®æ¨é€ç»™ Web Appï¼Œ HTTP/2 å¯ä»¥ç»“åˆ SSEï¼ˆServer-Sent Eventï¼‰ä½¿ç”¨ã€‚ WebSocket åœ¨éœ€è¦æ¥è¿‘å®æ—¶åŒå‘é€šä¿¡çš„é¢†åŸŸï¼Œå¾ˆæœ‰ç”¨æ­¦ä¹‹åœ°ã€‚è€Œ HTTP/2 + SSE é€‚åˆç”¨äºå±•ç¤ºå®æ—¶æ•°æ®ã€‚ å¦å¤–åœ¨å®¢æˆ·ç«¯éæµè§ˆå™¨çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ä¸åŠ å¯†çš„ HTTP/2 ä¹Ÿæ˜¯å¯èƒ½çš„ã€‚ ","date":"2019-02-11","objectID":"/posts/websocket-http2-and-grpc/:2:3","series":null,"tags":["WebSocket","gRPC","HTTP/2"],"title":"WebSocketã€HTTP/2 ä¸ gRPC","uri":"/posts/websocket-http2-and-grpc/#websockethttp2-ä¸-sse-çš„æ¯”è¾ƒ"},{"categories":["tech"],"content":" requests æŸ¥çœ‹ HTTP åè®®ç‰ˆæœ¬å·å¯ä»¥é€šè¿‡ resp.raw.version å¾—åˆ°å“åº”çš„ HTTP ç‰ˆæœ¬å·ï¼š shell \u003e\u003e\u003e import requests \u003e\u003e\u003e resp = requests.get(\"https://zhihu.com\") \u003e\u003e\u003e resp.raw.version 11 ä½†æ˜¯ requests é»˜è®¤ä½¿ç”¨ HTTP/1.1ï¼Œå¹¶ä¸”ä¸æ”¯æŒ HTTP/2.ï¼ˆä¸è¿‡è¿™ä¹Ÿä¸æ˜¯ä»€ä¹ˆå¤§é—®é¢˜ï¼ŒHTTP/2 åªæ˜¯åšäº†æ€§èƒ½ä¼˜åŒ–ï¼Œç”¨ HTTP/1.1 ä¹Ÿå°±æ˜¯æ…¢ä¸€ç‚¹è€Œå·²ã€‚ï¼‰ ","date":"2019-02-11","objectID":"/posts/websocket-http2-and-grpc/:2:4","series":null,"tags":["WebSocket","gRPC","HTTP/2"],"title":"WebSocketã€HTTP/2 ä¸ gRPC","uri":"/posts/websocket-http2-and-grpc/#requests-æŸ¥çœ‹-http-åè®®ç‰ˆæœ¬å·"},{"categories":["tech"],"content":" ä¸‰ã€gRPC åè®®gRPC æ˜¯ä¸€ä¸ªè¿œç¨‹è¿‡ç¨‹è°ƒç”¨æ¡†æ¶ï¼Œé»˜è®¤ä½¿ç”¨ protobuf3 è¿›è¡Œæ•°æ®çš„é«˜æ•ˆåºåˆ—åŒ–ä¸ service å®šä¹‰ï¼Œä½¿ç”¨ HTTP/2 è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚è¿™é‡Œè®¨è®ºçš„æ˜¯gRPC over HTTP/2 åè®®ã€‚ ç›®å‰ gRPC ä¸»è¦è¢«ç”¨åœ¨å¾®æœåŠ¡é€šä¿¡ä¸­ï¼Œä½†æ˜¯å› ä¸ºå…¶ä¼˜è¶Šçš„æ€§èƒ½ï¼Œå®ƒä¹Ÿå¾ˆå¥‘åˆæ¸¸æˆã€loT ç­‰éœ€è¦é«˜æ€§èƒ½ä½å»¶è¿Ÿçš„åœºæ™¯ã€‚ å…¶å®å…‰ä»åè®®å…ˆè¿›ç¨‹åº¦ä¸Šè®²ï¼ŒgRPC åŸºæœ¬å…¨é¢è¶…è¶Š REST: ä½¿ç”¨äºŒè¿›åˆ¶è¿›è¡Œæ•°æ®åºåˆ—åŒ–ï¼Œæ¯” json æ›´èŠ‚çº¦æµé‡ã€åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ä¹Ÿæ›´å¿«ã€‚ protobuf3 è¦æ±‚ api è¢«å®Œå…¨æ¸…æ™°çš„å®šä¹‰å¥½ï¼Œè€Œ REST api åªèƒ½é ç¨‹åºå‘˜è‡ªè§‰å®šä¹‰ã€‚ gRPC å®˜æ–¹å°±æ”¯æŒä» api å®šä¹‰ç”Ÿæˆä»£ç ï¼Œè€Œ REST api éœ€è¦å€ŸåŠ© openapi-codegen ç­‰ç¬¬ä¸‰æ–¹å·¥å…·ã€‚ æ”¯æŒ 4 ç§é€šä¿¡æ¨¡å¼ï¼šä¸€å¯¹ä¸€(unary)ã€å®¢æˆ·ç«¯æµã€æœåŠ¡ç«¯æµã€åŒç«¯æµã€‚æ›´çµæ´» åªæ˜¯ç›®å‰ gRPC å¯¹ browser çš„æ”¯æŒä»ç„¶ä¸æ˜¯å¾ˆå¥½ï¼Œå¦‚æœä½ éœ€è¦é€šè¿‡æµè§ˆå™¨è®¿é—® apiï¼Œé‚£ gRPC å¯èƒ½ä¸æ˜¯ä½ çš„èœã€‚å¦‚æœä½ çš„äº§å“åªæ‰“ç®—é¢å‘ App ç­‰å¯æ§çš„å®¢æˆ·ç«¯ï¼Œå¯ä»¥è€ƒè™‘ä¸Š gRPCã€‚ å¯¹åŒæ—¶éœ€è¦ä¸ºæµè§ˆå™¨å’Œ APP æä¾›æœåŠ¡åº”ç”¨è€Œè¨€ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘ APP ä½¿ç”¨ gRPC åè®®ï¼Œè€Œæµè§ˆå™¨ä½¿ç”¨ API ç½‘å…³æä¾›çš„ HTTP æ¥å£ï¼Œåœ¨ API ç½‘å…³ä¸Šè¿›è¡Œ HTTP - gRPC åè®®è½¬æ¢ã€‚ ","date":"2019-02-11","objectID":"/posts/websocket-http2-and-grpc/:3:0","series":null,"tags":["WebSocket","gRPC","HTTP/2"],"title":"WebSocketã€HTTP/2 ä¸ gRPC","uri":"/posts/websocket-http2-and-grpc/#ä¸‰grpc-åè®®"},{"categories":["tech"],"content":" gRPC over HTTP/2 å®šä¹‰è¯¦ç»†çš„å®šä¹‰å‚è§å®˜æ–¹æ–‡æ¡£gRPC over HTTP/2. è¿™é‡Œæ˜¯ç®€è¦è¯´æ˜å‡ ç‚¹ï¼š gRPC å®Œå…¨éšè—äº† HTTP/2 æœ¬èº«çš„ methodã€headersã€path ç­‰è¯­ä¹‰ï¼Œè¿™äº›ä¿¡æ¯å¯¹ç”¨æˆ·è€Œè¨€å®Œå…¨ä¸å¯è§äº†ã€‚ è¯·æ±‚ç»Ÿä¸€ä½¿ç”¨ POSTï¼Œå“åº”çŠ¶æ€ç»Ÿä¸€ä¸º 200ã€‚åªè¦å“åº”æ˜¯æ ‡å‡†çš„ gRPC æ ¼å¼ï¼Œå“åº”ä¸­çš„ HTTP çŠ¶æ€ç å°†è¢«å®Œå…¨å¿½ç•¥ã€‚ gRPC å®šä¹‰äº†è‡ªå·±çš„ status çŠ¶æ€ç ã€æ ¼å¼å›ºå®šçš„ pathã€è¿˜æœ‰å®ƒè‡ªå·±çš„ headersã€‚ ","date":"2019-02-11","objectID":"/posts/websocket-http2-and-grpc/:3:1","series":null,"tags":["WebSocket","gRPC","HTTP/2"],"title":"WebSocketã€HTTP/2 ä¸ gRPC","uri":"/posts/websocket-http2-and-grpc/#grpc-over-http2-å®šä¹‰"},{"categories":["tech"],"content":" å‚è€ƒ æ·±å…¥æ¢ç´¢ WebSockets å’Œ HTTP/2 HTTP/2 ç‰¹æ€§ä¸æŠ“åŒ…åˆ†æ SSEï¼šæœåŠ¡å™¨å‘é€äº‹ä»¶,ä½¿ç”¨é•¿é“¾æ¥è¿›è¡Œé€šè®¯ Using server-sent events - MDN Can I Use HTTP/2 on Browsers Python 3.x how to get http version (using requests library) WebSocket æ˜¯ä»€ä¹ˆåŸç†ï¼Ÿ åŸç”Ÿæ¨¡å—æ‰“é€ ä¸€ä¸ªç®€å•çš„ WebSocket æœåŠ¡å™¨ Google Cloud - API design: Understanding gRPC, OpenAPI and REST and when to use them ","date":"2019-02-11","objectID":"/posts/websocket-http2-and-grpc/:4:0","series":null,"tags":["WebSocket","gRPC","HTTP/2"],"title":"WebSocketã€HTTP/2 ä¸ gRPC","uri":"/posts/websocket-http2-and-grpc/#å‚è€ƒ"},{"categories":["tech"],"content":"ä¸ç®¡æ˜¯åšçˆ¬è™«è¿˜æ˜¯å†™ Web Appï¼ŒChrome å’Œ Firefox çš„ DevTools éƒ½æ˜¯è¶…å¸¸ç”¨çš„ï¼Œä½†æ˜¯ç»å¸¸å‘ç°åˆ«äººçš„æˆªå›¾æœ‰ä»€ä¹ˆå­—æ®µæˆ‘æ‰¾ä¸åˆ°ï¼Œåˆ«äººçš„ä»€ä¹ˆåŠŸèƒ½æˆ‘çš„ Chrome æ²¡æœ‰ï¼Œä»”ç»†ä¸€æœç´¢æ‰çŸ¥é“ï¼ŒåŸæ¥æ˜¯æˆ‘ä¸ä¼šç”¨ã€‚ã€‚ Ctrl + Shift + Iï¼šæ‰“å¼€ DevTools Ctrl + Shift + Jï¼šæ‰“å¼€æ§åˆ¶å° ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:0","series":null,"tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/#"},{"categories":["tech"],"content":" æœç´¢ Ctrl + Fï¼šåœ¨å½“å‰ä½ç½®æœç´¢å…³é”®å­— åœ¨ç½‘é¡µç•Œé¢ç”¨è¿™ä¸ªå¿«æ·é”®ï¼Œå°±æ˜¯é¡µå†…æœç´¢ åœ¨ Network çš„ Response é¡µé¢ï¼Œå°±æ˜¯åœ¨ Response ä¸­æœç´¢ Ctrl + Shift + Fï¼šå…¨æ–‡æœç´¢ï¼Œåœ¨å½“å‰ Web App çš„æ‰€æœ‰æ–‡ä»¶ä¸­æœç´¢ã€‚ çˆ¬è™«å¿…å¤‡ï¼ï¼ï¼è¦å¯»æ‰¾ä¸€äº›ç‰¹æ®Šå­—ç¬¦ä¸²çš„æ¥æºï¼Œç”¨å®ƒæœç´¢å±¡è¯•ä¸çˆ½ã€‚ ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:1","series":null,"tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/#æœç´¢"},{"categories":["tech"],"content":" Commandåœ¨ DevTools é‡ŒæŒ‰å¿«æ·é”® Ctrl + Shift + P å°±èƒ½æ‰“å¼€ Command è¾“å…¥æ¡†ï¼Œå®ƒå’Œ vscode/sublime çš„ Command ä¸€æ ·ï¼Œç”¨å¥½äº†ç‰¹åˆ«æ–¹ä¾¿ã€‚ ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:2","series":null,"tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/#command"},{"categories":["tech"],"content":" Network 1. å±æ€§åˆ—Chrome å¯ä»¥å³é”®å±æ€§åˆ—åæ¥å¢å‡å±æ€§åˆ—ï¼ŒFirefox-Dev ä¹Ÿæ˜¯ä¸€æ ·ï¼š 2. copyåœ¨ Chrome ä¸­å³é”®æŸä¸ªè¯·æ±‚ï¼Œé€‰ä¸­ copyï¼Œä¼šç»™å‡ºå‡ ä¸ª optionsï¼š è€Œ Firefox-Dev çš„æ›´å¼ºä¸€ç‚¹ï¼Œå¯ä»¥å¤åˆ¶æ¶ˆæ¯å¤´ï¼ˆè¯·æ±‚å¤´å’Œå“åº”å¤´ï¼‰ï¼š 3. response çš„ pretty printChrome çš„ Response é¡µé¢å·¦ä¸‹è§’ï¼Œæœ‰{}æŒ‰é’®ï¼Œå¯ä»¥ beautify å“åº”ã€‚ è€Œ Firefox-Dev åªåœ¨ Debugger é¡µé¢æä¾›è¯¥æŒ‰é’®ï¼ŒResponse ä¸­ä¸æ”¯æŒã€‚ Firefox å“åº”çš„ preview å’Œ payload æ˜¯æ”¾åœ¨ Response é¡µé¢ä¸‹ã€‚è€Œ Chrome æ˜¯åˆ†æˆäº†ä¸¤ä¸ªæ ‡ç­¾é¡µ 4. å¯¼å‡º HARå³é”®ä»»æ„ä¸€ä¸ªè¯·æ±‚ï¼Œé€‰æ‹© save all as HARï¼Œå°±å¯ä»¥å¯¼å‡º HAR æ–‡ä»¶ã€‚ï¼ˆChrome æœ‰ with contentï¼Œ å¯¼å‡ºçš„ HAR æ–‡ä»¶ä¼šå«æœ‰æ‰€æœ‰è¯·æ±‚ä¸å“åº”çš„ bodyï¼‰ è¯¥æ–‡ä»¶å¯ç”¨äºå­˜å‚¨å½“å‰ç›‘å¬åˆ°çš„æ‰€æœ‰æµè§ˆå™¨è¯·æ±‚ä¿¡æ¯ã€‚åœ¨ä»¥åéœ€è¦åˆ†æè¿™äº›è¯·æ±‚æ—¶ï¼Œå°† HAR æ–‡ä»¶æ‹–åˆ° Network é¡µé¢å³å¯æ¢å¤æ‰€æœ‰è¯·æ±‚ã€‚ 5. Raw Headersï¼ˆåŸå§‹æ¶ˆæ¯å¤´ï¼‰Chrome åªæ”¯æŒæŸ¥çœ‹ HTTP/1.x çš„ Raw Headersï¼Œå¯¹è¿™ç§è¯·æ±‚ï¼Œä¼šç»™å‡º view source é€‰é¡¹ã€‚ Chrome ä¸èƒ½æŸ¥çœ‹ HTTP/2 çš„ Raw Headersã€‚ è€Œ Firefox åˆ™æ”¯æŒæŸ¥çœ‹ HTTP/2 çš„ Raw Headersã€‚ï¼ˆæ˜¯æ¢å¤åçš„ï¼ŒHTTP/2 çš„åŸå§‹æ¶ˆæ¯å¤´æ˜¯äºŒè¿›åˆ¶å‹ç¼©å½¢å¼ï¼‰ å®ƒè¿˜æä¾› Edit and Resend è¯·æ±‚çš„åŠŸèƒ½ï¼Œè¿™ç‚¹è¦ç»™ä¸ªèµï½ 6. å®¡æŸ¥ WebSocketï¼ˆChrome onlyï¼‰åœ¨ NetWork ä¸­ç‚¹å‡»å¯¹åº”çš„ WebSocket è¯·æ±‚ï¼Œåœ¨å³ä¾§é€‰æ‹© Frames æ ‡ç­¾ï¼Œå°±å¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„æ¶ˆæ¯äº† 7. è·¨é¡µé¢åŠ è½½æ—¶ï¼Œä¿ç•™ç½‘ç»œè¯·æ±‚è®°å½•å½“é¡µé¢é‡è½½æˆ–è€…é¡µé¢è·³è½¬æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒNetworké¢æ¿ä¸‹çš„ç½‘ç»œè¯·æ±‚è®°å½•è¡¨ä¹Ÿæ˜¯åˆ·æ–°çš„ã€‚å¦‚æœæƒ³ä¿ç•™ä¹‹å‰é¡µé¢çš„ç½‘ç»œè¯·æ±‚æ•°æ®ï¼Œå¯ä»¥å‹¾é€‰Preserve log. å¸¸ç”¨çš„ä¸€ä¸ªåº”ç”¨åœºæ™¯ï¼šç™»å½•/æ³¨å†Œæ—¶ä¼šè°ƒç”¨ç™»å½•/æ³¨å†ŒAPIï¼Œå¼€å‘è€…æƒ³æŸ¥çœ‹è¿™ä¸ªæ¥å£è¿”å›çš„æƒ…å†µï¼Œä½†æ˜¯ç™»å½•/æ³¨å†ŒæˆåŠŸåä¸€èˆ¬ä¼šè·³è½¬åˆ°æ–°çš„é¡µé¢ï¼Œå¯¼è‡´äº†Networké¢æ¿çš„è¯·æ±‚è®°å½•è¢«åˆ·æ–°ä»è€Œçœ‹ä¸åˆ°ç™»å½•/æ³¨å†Œæ¥å£è¿”å›çš„æƒ…å†µã€‚æ­¤æ—¶å‹¾é€‰ä¸ŠPreserve logï¼Œæ— è®ºè·³è½¬åˆ°é‚£ä¸ªé¡µé¢ï¼Œéƒ½èƒ½åœ¨Networkç½‘ç»œè¯·æ±‚è®°å½•è¡¨ä¸­æŸ¥çœ‹åˆ°ä¹‹å‰æ¥å£è¿”å›çš„æƒ…å†µã€‚ ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:3","series":null,"tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/#network"},{"categories":["tech"],"content":" Network 1. å±æ€§åˆ—Chrome å¯ä»¥å³é”®å±æ€§åˆ—åæ¥å¢å‡å±æ€§åˆ—ï¼ŒFirefox-Dev ä¹Ÿæ˜¯ä¸€æ ·ï¼š 2. copyåœ¨ Chrome ä¸­å³é”®æŸä¸ªè¯·æ±‚ï¼Œé€‰ä¸­ copyï¼Œä¼šç»™å‡ºå‡ ä¸ª optionsï¼š è€Œ Firefox-Dev çš„æ›´å¼ºä¸€ç‚¹ï¼Œå¯ä»¥å¤åˆ¶æ¶ˆæ¯å¤´ï¼ˆè¯·æ±‚å¤´å’Œå“åº”å¤´ï¼‰ï¼š 3. response çš„ pretty printChrome çš„ Response é¡µé¢å·¦ä¸‹è§’ï¼Œæœ‰{}æŒ‰é’®ï¼Œå¯ä»¥ beautify å“åº”ã€‚ è€Œ Firefox-Dev åªåœ¨ Debugger é¡µé¢æä¾›è¯¥æŒ‰é’®ï¼ŒResponse ä¸­ä¸æ”¯æŒã€‚ Firefox å“åº”çš„ preview å’Œ payload æ˜¯æ”¾åœ¨ Response é¡µé¢ä¸‹ã€‚è€Œ Chrome æ˜¯åˆ†æˆäº†ä¸¤ä¸ªæ ‡ç­¾é¡µ 4. å¯¼å‡º HARå³é”®ä»»æ„ä¸€ä¸ªè¯·æ±‚ï¼Œé€‰æ‹© save all as HARï¼Œå°±å¯ä»¥å¯¼å‡º HAR æ–‡ä»¶ã€‚ï¼ˆChrome æœ‰ with contentï¼Œ å¯¼å‡ºçš„ HAR æ–‡ä»¶ä¼šå«æœ‰æ‰€æœ‰è¯·æ±‚ä¸å“åº”çš„ bodyï¼‰ è¯¥æ–‡ä»¶å¯ç”¨äºå­˜å‚¨å½“å‰ç›‘å¬åˆ°çš„æ‰€æœ‰æµè§ˆå™¨è¯·æ±‚ä¿¡æ¯ã€‚åœ¨ä»¥åéœ€è¦åˆ†æè¿™äº›è¯·æ±‚æ—¶ï¼Œå°† HAR æ–‡ä»¶æ‹–åˆ° Network é¡µé¢å³å¯æ¢å¤æ‰€æœ‰è¯·æ±‚ã€‚ 5. Raw Headersï¼ˆåŸå§‹æ¶ˆæ¯å¤´ï¼‰Chrome åªæ”¯æŒæŸ¥çœ‹ HTTP/1.x çš„ Raw Headersï¼Œå¯¹è¿™ç§è¯·æ±‚ï¼Œä¼šç»™å‡º view source é€‰é¡¹ã€‚ Chrome ä¸èƒ½æŸ¥çœ‹ HTTP/2 çš„ Raw Headersã€‚ è€Œ Firefox åˆ™æ”¯æŒæŸ¥çœ‹ HTTP/2 çš„ Raw Headersã€‚ï¼ˆæ˜¯æ¢å¤åçš„ï¼ŒHTTP/2 çš„åŸå§‹æ¶ˆæ¯å¤´æ˜¯äºŒè¿›åˆ¶å‹ç¼©å½¢å¼ï¼‰ å®ƒè¿˜æä¾› Edit and Resend è¯·æ±‚çš„åŠŸèƒ½ï¼Œè¿™ç‚¹è¦ç»™ä¸ªèµï½ 6. å®¡æŸ¥ WebSocketï¼ˆChrome onlyï¼‰åœ¨ NetWork ä¸­ç‚¹å‡»å¯¹åº”çš„ WebSocket è¯·æ±‚ï¼Œåœ¨å³ä¾§é€‰æ‹© Frames æ ‡ç­¾ï¼Œå°±å¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„æ¶ˆæ¯äº† 7. è·¨é¡µé¢åŠ è½½æ—¶ï¼Œä¿ç•™ç½‘ç»œè¯·æ±‚è®°å½•å½“é¡µé¢é‡è½½æˆ–è€…é¡µé¢è·³è½¬æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒNetworké¢æ¿ä¸‹çš„ç½‘ç»œè¯·æ±‚è®°å½•è¡¨ä¹Ÿæ˜¯åˆ·æ–°çš„ã€‚å¦‚æœæƒ³ä¿ç•™ä¹‹å‰é¡µé¢çš„ç½‘ç»œè¯·æ±‚æ•°æ®ï¼Œå¯ä»¥å‹¾é€‰Preserve log. å¸¸ç”¨çš„ä¸€ä¸ªåº”ç”¨åœºæ™¯ï¼šç™»å½•/æ³¨å†Œæ—¶ä¼šè°ƒç”¨ç™»å½•/æ³¨å†ŒAPIï¼Œå¼€å‘è€…æƒ³æŸ¥çœ‹è¿™ä¸ªæ¥å£è¿”å›çš„æƒ…å†µï¼Œä½†æ˜¯ç™»å½•/æ³¨å†ŒæˆåŠŸåä¸€èˆ¬ä¼šè·³è½¬åˆ°æ–°çš„é¡µé¢ï¼Œå¯¼è‡´äº†Networké¢æ¿çš„è¯·æ±‚è®°å½•è¢«åˆ·æ–°ä»è€Œçœ‹ä¸åˆ°ç™»å½•/æ³¨å†Œæ¥å£è¿”å›çš„æƒ…å†µã€‚æ­¤æ—¶å‹¾é€‰ä¸ŠPreserve logï¼Œæ— è®ºè·³è½¬åˆ°é‚£ä¸ªé¡µé¢ï¼Œéƒ½èƒ½åœ¨Networkç½‘ç»œè¯·æ±‚è®°å½•è¡¨ä¸­æŸ¥çœ‹åˆ°ä¹‹å‰æ¥å£è¿”å›çš„æƒ…å†µã€‚ ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:3","series":null,"tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/#1-å±æ€§åˆ—"},{"categories":["tech"],"content":" Network 1. å±æ€§åˆ—Chrome å¯ä»¥å³é”®å±æ€§åˆ—åæ¥å¢å‡å±æ€§åˆ—ï¼ŒFirefox-Dev ä¹Ÿæ˜¯ä¸€æ ·ï¼š 2. copyåœ¨ Chrome ä¸­å³é”®æŸä¸ªè¯·æ±‚ï¼Œé€‰ä¸­ copyï¼Œä¼šç»™å‡ºå‡ ä¸ª optionsï¼š è€Œ Firefox-Dev çš„æ›´å¼ºä¸€ç‚¹ï¼Œå¯ä»¥å¤åˆ¶æ¶ˆæ¯å¤´ï¼ˆè¯·æ±‚å¤´å’Œå“åº”å¤´ï¼‰ï¼š 3. response çš„ pretty printChrome çš„ Response é¡µé¢å·¦ä¸‹è§’ï¼Œæœ‰{}æŒ‰é’®ï¼Œå¯ä»¥ beautify å“åº”ã€‚ è€Œ Firefox-Dev åªåœ¨ Debugger é¡µé¢æä¾›è¯¥æŒ‰é’®ï¼ŒResponse ä¸­ä¸æ”¯æŒã€‚ Firefox å“åº”çš„ preview å’Œ payload æ˜¯æ”¾åœ¨ Response é¡µé¢ä¸‹ã€‚è€Œ Chrome æ˜¯åˆ†æˆäº†ä¸¤ä¸ªæ ‡ç­¾é¡µ 4. å¯¼å‡º HARå³é”®ä»»æ„ä¸€ä¸ªè¯·æ±‚ï¼Œé€‰æ‹© save all as HARï¼Œå°±å¯ä»¥å¯¼å‡º HAR æ–‡ä»¶ã€‚ï¼ˆChrome æœ‰ with contentï¼Œ å¯¼å‡ºçš„ HAR æ–‡ä»¶ä¼šå«æœ‰æ‰€æœ‰è¯·æ±‚ä¸å“åº”çš„ bodyï¼‰ è¯¥æ–‡ä»¶å¯ç”¨äºå­˜å‚¨å½“å‰ç›‘å¬åˆ°çš„æ‰€æœ‰æµè§ˆå™¨è¯·æ±‚ä¿¡æ¯ã€‚åœ¨ä»¥åéœ€è¦åˆ†æè¿™äº›è¯·æ±‚æ—¶ï¼Œå°† HAR æ–‡ä»¶æ‹–åˆ° Network é¡µé¢å³å¯æ¢å¤æ‰€æœ‰è¯·æ±‚ã€‚ 5. Raw Headersï¼ˆåŸå§‹æ¶ˆæ¯å¤´ï¼‰Chrome åªæ”¯æŒæŸ¥çœ‹ HTTP/1.x çš„ Raw Headersï¼Œå¯¹è¿™ç§è¯·æ±‚ï¼Œä¼šç»™å‡º view source é€‰é¡¹ã€‚ Chrome ä¸èƒ½æŸ¥çœ‹ HTTP/2 çš„ Raw Headersã€‚ è€Œ Firefox åˆ™æ”¯æŒæŸ¥çœ‹ HTTP/2 çš„ Raw Headersã€‚ï¼ˆæ˜¯æ¢å¤åçš„ï¼ŒHTTP/2 çš„åŸå§‹æ¶ˆæ¯å¤´æ˜¯äºŒè¿›åˆ¶å‹ç¼©å½¢å¼ï¼‰ å®ƒè¿˜æä¾› Edit and Resend è¯·æ±‚çš„åŠŸèƒ½ï¼Œè¿™ç‚¹è¦ç»™ä¸ªèµï½ 6. å®¡æŸ¥ WebSocketï¼ˆChrome onlyï¼‰åœ¨ NetWork ä¸­ç‚¹å‡»å¯¹åº”çš„ WebSocket è¯·æ±‚ï¼Œåœ¨å³ä¾§é€‰æ‹© Frames æ ‡ç­¾ï¼Œå°±å¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„æ¶ˆæ¯äº† 7. è·¨é¡µé¢åŠ è½½æ—¶ï¼Œä¿ç•™ç½‘ç»œè¯·æ±‚è®°å½•å½“é¡µé¢é‡è½½æˆ–è€…é¡µé¢è·³è½¬æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒNetworké¢æ¿ä¸‹çš„ç½‘ç»œè¯·æ±‚è®°å½•è¡¨ä¹Ÿæ˜¯åˆ·æ–°çš„ã€‚å¦‚æœæƒ³ä¿ç•™ä¹‹å‰é¡µé¢çš„ç½‘ç»œè¯·æ±‚æ•°æ®ï¼Œå¯ä»¥å‹¾é€‰Preserve log. å¸¸ç”¨çš„ä¸€ä¸ªåº”ç”¨åœºæ™¯ï¼šç™»å½•/æ³¨å†Œæ—¶ä¼šè°ƒç”¨ç™»å½•/æ³¨å†ŒAPIï¼Œå¼€å‘è€…æƒ³æŸ¥çœ‹è¿™ä¸ªæ¥å£è¿”å›çš„æƒ…å†µï¼Œä½†æ˜¯ç™»å½•/æ³¨å†ŒæˆåŠŸåä¸€èˆ¬ä¼šè·³è½¬åˆ°æ–°çš„é¡µé¢ï¼Œå¯¼è‡´äº†Networké¢æ¿çš„è¯·æ±‚è®°å½•è¢«åˆ·æ–°ä»è€Œçœ‹ä¸åˆ°ç™»å½•/æ³¨å†Œæ¥å£è¿”å›çš„æƒ…å†µã€‚æ­¤æ—¶å‹¾é€‰ä¸ŠPreserve logï¼Œæ— è®ºè·³è½¬åˆ°é‚£ä¸ªé¡µé¢ï¼Œéƒ½èƒ½åœ¨Networkç½‘ç»œè¯·æ±‚è®°å½•è¡¨ä¸­æŸ¥çœ‹åˆ°ä¹‹å‰æ¥å£è¿”å›çš„æƒ…å†µã€‚ ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:3","series":null,"tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/#2-copy"},{"categories":["tech"],"content":" Network 1. å±æ€§åˆ—Chrome å¯ä»¥å³é”®å±æ€§åˆ—åæ¥å¢å‡å±æ€§åˆ—ï¼ŒFirefox-Dev ä¹Ÿæ˜¯ä¸€æ ·ï¼š 2. copyåœ¨ Chrome ä¸­å³é”®æŸä¸ªè¯·æ±‚ï¼Œé€‰ä¸­ copyï¼Œä¼šç»™å‡ºå‡ ä¸ª optionsï¼š è€Œ Firefox-Dev çš„æ›´å¼ºä¸€ç‚¹ï¼Œå¯ä»¥å¤åˆ¶æ¶ˆæ¯å¤´ï¼ˆè¯·æ±‚å¤´å’Œå“åº”å¤´ï¼‰ï¼š 3. response çš„ pretty printChrome çš„ Response é¡µé¢å·¦ä¸‹è§’ï¼Œæœ‰{}æŒ‰é’®ï¼Œå¯ä»¥ beautify å“åº”ã€‚ è€Œ Firefox-Dev åªåœ¨ Debugger é¡µé¢æä¾›è¯¥æŒ‰é’®ï¼ŒResponse ä¸­ä¸æ”¯æŒã€‚ Firefox å“åº”çš„ preview å’Œ payload æ˜¯æ”¾åœ¨ Response é¡µé¢ä¸‹ã€‚è€Œ Chrome æ˜¯åˆ†æˆäº†ä¸¤ä¸ªæ ‡ç­¾é¡µ 4. å¯¼å‡º HARå³é”®ä»»æ„ä¸€ä¸ªè¯·æ±‚ï¼Œé€‰æ‹© save all as HARï¼Œå°±å¯ä»¥å¯¼å‡º HAR æ–‡ä»¶ã€‚ï¼ˆChrome æœ‰ with contentï¼Œ å¯¼å‡ºçš„ HAR æ–‡ä»¶ä¼šå«æœ‰æ‰€æœ‰è¯·æ±‚ä¸å“åº”çš„ bodyï¼‰ è¯¥æ–‡ä»¶å¯ç”¨äºå­˜å‚¨å½“å‰ç›‘å¬åˆ°çš„æ‰€æœ‰æµè§ˆå™¨è¯·æ±‚ä¿¡æ¯ã€‚åœ¨ä»¥åéœ€è¦åˆ†æè¿™äº›è¯·æ±‚æ—¶ï¼Œå°† HAR æ–‡ä»¶æ‹–åˆ° Network é¡µé¢å³å¯æ¢å¤æ‰€æœ‰è¯·æ±‚ã€‚ 5. Raw Headersï¼ˆåŸå§‹æ¶ˆæ¯å¤´ï¼‰Chrome åªæ”¯æŒæŸ¥çœ‹ HTTP/1.x çš„ Raw Headersï¼Œå¯¹è¿™ç§è¯·æ±‚ï¼Œä¼šç»™å‡º view source é€‰é¡¹ã€‚ Chrome ä¸èƒ½æŸ¥çœ‹ HTTP/2 çš„ Raw Headersã€‚ è€Œ Firefox åˆ™æ”¯æŒæŸ¥çœ‹ HTTP/2 çš„ Raw Headersã€‚ï¼ˆæ˜¯æ¢å¤åçš„ï¼ŒHTTP/2 çš„åŸå§‹æ¶ˆæ¯å¤´æ˜¯äºŒè¿›åˆ¶å‹ç¼©å½¢å¼ï¼‰ å®ƒè¿˜æä¾› Edit and Resend è¯·æ±‚çš„åŠŸèƒ½ï¼Œè¿™ç‚¹è¦ç»™ä¸ªèµï½ 6. å®¡æŸ¥ WebSocketï¼ˆChrome onlyï¼‰åœ¨ NetWork ä¸­ç‚¹å‡»å¯¹åº”çš„ WebSocket è¯·æ±‚ï¼Œåœ¨å³ä¾§é€‰æ‹© Frames æ ‡ç­¾ï¼Œå°±å¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„æ¶ˆæ¯äº† 7. è·¨é¡µé¢åŠ è½½æ—¶ï¼Œä¿ç•™ç½‘ç»œè¯·æ±‚è®°å½•å½“é¡µé¢é‡è½½æˆ–è€…é¡µé¢è·³è½¬æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒNetworké¢æ¿ä¸‹çš„ç½‘ç»œè¯·æ±‚è®°å½•è¡¨ä¹Ÿæ˜¯åˆ·æ–°çš„ã€‚å¦‚æœæƒ³ä¿ç•™ä¹‹å‰é¡µé¢çš„ç½‘ç»œè¯·æ±‚æ•°æ®ï¼Œå¯ä»¥å‹¾é€‰Preserve log. å¸¸ç”¨çš„ä¸€ä¸ªåº”ç”¨åœºæ™¯ï¼šç™»å½•/æ³¨å†Œæ—¶ä¼šè°ƒç”¨ç™»å½•/æ³¨å†ŒAPIï¼Œå¼€å‘è€…æƒ³æŸ¥çœ‹è¿™ä¸ªæ¥å£è¿”å›çš„æƒ…å†µï¼Œä½†æ˜¯ç™»å½•/æ³¨å†ŒæˆåŠŸåä¸€èˆ¬ä¼šè·³è½¬åˆ°æ–°çš„é¡µé¢ï¼Œå¯¼è‡´äº†Networké¢æ¿çš„è¯·æ±‚è®°å½•è¢«åˆ·æ–°ä»è€Œçœ‹ä¸åˆ°ç™»å½•/æ³¨å†Œæ¥å£è¿”å›çš„æƒ…å†µã€‚æ­¤æ—¶å‹¾é€‰ä¸ŠPreserve logï¼Œæ— è®ºè·³è½¬åˆ°é‚£ä¸ªé¡µé¢ï¼Œéƒ½èƒ½åœ¨Networkç½‘ç»œè¯·æ±‚è®°å½•è¡¨ä¸­æŸ¥çœ‹åˆ°ä¹‹å‰æ¥å£è¿”å›çš„æƒ…å†µã€‚ ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:3","series":null,"tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/#3-response-çš„-pretty-print"},{"categories":["tech"],"content":" Network 1. å±æ€§åˆ—Chrome å¯ä»¥å³é”®å±æ€§åˆ—åæ¥å¢å‡å±æ€§åˆ—ï¼ŒFirefox-Dev ä¹Ÿæ˜¯ä¸€æ ·ï¼š 2. copyåœ¨ Chrome ä¸­å³é”®æŸä¸ªè¯·æ±‚ï¼Œé€‰ä¸­ copyï¼Œä¼šç»™å‡ºå‡ ä¸ª optionsï¼š è€Œ Firefox-Dev çš„æ›´å¼ºä¸€ç‚¹ï¼Œå¯ä»¥å¤åˆ¶æ¶ˆæ¯å¤´ï¼ˆè¯·æ±‚å¤´å’Œå“åº”å¤´ï¼‰ï¼š 3. response çš„ pretty printChrome çš„ Response é¡µé¢å·¦ä¸‹è§’ï¼Œæœ‰{}æŒ‰é’®ï¼Œå¯ä»¥ beautify å“åº”ã€‚ è€Œ Firefox-Dev åªåœ¨ Debugger é¡µé¢æä¾›è¯¥æŒ‰é’®ï¼ŒResponse ä¸­ä¸æ”¯æŒã€‚ Firefox å“åº”çš„ preview å’Œ payload æ˜¯æ”¾åœ¨ Response é¡µé¢ä¸‹ã€‚è€Œ Chrome æ˜¯åˆ†æˆäº†ä¸¤ä¸ªæ ‡ç­¾é¡µ 4. å¯¼å‡º HARå³é”®ä»»æ„ä¸€ä¸ªè¯·æ±‚ï¼Œé€‰æ‹© save all as HARï¼Œå°±å¯ä»¥å¯¼å‡º HAR æ–‡ä»¶ã€‚ï¼ˆChrome æœ‰ with contentï¼Œ å¯¼å‡ºçš„ HAR æ–‡ä»¶ä¼šå«æœ‰æ‰€æœ‰è¯·æ±‚ä¸å“åº”çš„ bodyï¼‰ è¯¥æ–‡ä»¶å¯ç”¨äºå­˜å‚¨å½“å‰ç›‘å¬åˆ°çš„æ‰€æœ‰æµè§ˆå™¨è¯·æ±‚ä¿¡æ¯ã€‚åœ¨ä»¥åéœ€è¦åˆ†æè¿™äº›è¯·æ±‚æ—¶ï¼Œå°† HAR æ–‡ä»¶æ‹–åˆ° Network é¡µé¢å³å¯æ¢å¤æ‰€æœ‰è¯·æ±‚ã€‚ 5. Raw Headersï¼ˆåŸå§‹æ¶ˆæ¯å¤´ï¼‰Chrome åªæ”¯æŒæŸ¥çœ‹ HTTP/1.x çš„ Raw Headersï¼Œå¯¹è¿™ç§è¯·æ±‚ï¼Œä¼šç»™å‡º view source é€‰é¡¹ã€‚ Chrome ä¸èƒ½æŸ¥çœ‹ HTTP/2 çš„ Raw Headersã€‚ è€Œ Firefox åˆ™æ”¯æŒæŸ¥çœ‹ HTTP/2 çš„ Raw Headersã€‚ï¼ˆæ˜¯æ¢å¤åçš„ï¼ŒHTTP/2 çš„åŸå§‹æ¶ˆæ¯å¤´æ˜¯äºŒè¿›åˆ¶å‹ç¼©å½¢å¼ï¼‰ å®ƒè¿˜æä¾› Edit and Resend è¯·æ±‚çš„åŠŸèƒ½ï¼Œè¿™ç‚¹è¦ç»™ä¸ªèµï½ 6. å®¡æŸ¥ WebSocketï¼ˆChrome onlyï¼‰åœ¨ NetWork ä¸­ç‚¹å‡»å¯¹åº”çš„ WebSocket è¯·æ±‚ï¼Œåœ¨å³ä¾§é€‰æ‹© Frames æ ‡ç­¾ï¼Œå°±å¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„æ¶ˆæ¯äº† 7. è·¨é¡µé¢åŠ è½½æ—¶ï¼Œä¿ç•™ç½‘ç»œè¯·æ±‚è®°å½•å½“é¡µé¢é‡è½½æˆ–è€…é¡µé¢è·³è½¬æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒNetworké¢æ¿ä¸‹çš„ç½‘ç»œè¯·æ±‚è®°å½•è¡¨ä¹Ÿæ˜¯åˆ·æ–°çš„ã€‚å¦‚æœæƒ³ä¿ç•™ä¹‹å‰é¡µé¢çš„ç½‘ç»œè¯·æ±‚æ•°æ®ï¼Œå¯ä»¥å‹¾é€‰Preserve log. å¸¸ç”¨çš„ä¸€ä¸ªåº”ç”¨åœºæ™¯ï¼šç™»å½•/æ³¨å†Œæ—¶ä¼šè°ƒç”¨ç™»å½•/æ³¨å†ŒAPIï¼Œå¼€å‘è€…æƒ³æŸ¥çœ‹è¿™ä¸ªæ¥å£è¿”å›çš„æƒ…å†µï¼Œä½†æ˜¯ç™»å½•/æ³¨å†ŒæˆåŠŸåä¸€èˆ¬ä¼šè·³è½¬åˆ°æ–°çš„é¡µé¢ï¼Œå¯¼è‡´äº†Networké¢æ¿çš„è¯·æ±‚è®°å½•è¢«åˆ·æ–°ä»è€Œçœ‹ä¸åˆ°ç™»å½•/æ³¨å†Œæ¥å£è¿”å›çš„æƒ…å†µã€‚æ­¤æ—¶å‹¾é€‰ä¸ŠPreserve logï¼Œæ— è®ºè·³è½¬åˆ°é‚£ä¸ªé¡µé¢ï¼Œéƒ½èƒ½åœ¨Networkç½‘ç»œè¯·æ±‚è®°å½•è¡¨ä¸­æŸ¥çœ‹åˆ°ä¹‹å‰æ¥å£è¿”å›çš„æƒ…å†µã€‚ ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:3","series":null,"tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/#4-å¯¼å‡º-har"},{"categories":["tech"],"content":" Network 1. å±æ€§åˆ—Chrome å¯ä»¥å³é”®å±æ€§åˆ—åæ¥å¢å‡å±æ€§åˆ—ï¼ŒFirefox-Dev ä¹Ÿæ˜¯ä¸€æ ·ï¼š 2. copyåœ¨ Chrome ä¸­å³é”®æŸä¸ªè¯·æ±‚ï¼Œé€‰ä¸­ copyï¼Œä¼šç»™å‡ºå‡ ä¸ª optionsï¼š è€Œ Firefox-Dev çš„æ›´å¼ºä¸€ç‚¹ï¼Œå¯ä»¥å¤åˆ¶æ¶ˆæ¯å¤´ï¼ˆè¯·æ±‚å¤´å’Œå“åº”å¤´ï¼‰ï¼š 3. response çš„ pretty printChrome çš„ Response é¡µé¢å·¦ä¸‹è§’ï¼Œæœ‰{}æŒ‰é’®ï¼Œå¯ä»¥ beautify å“åº”ã€‚ è€Œ Firefox-Dev åªåœ¨ Debugger é¡µé¢æä¾›è¯¥æŒ‰é’®ï¼ŒResponse ä¸­ä¸æ”¯æŒã€‚ Firefox å“åº”çš„ preview å’Œ payload æ˜¯æ”¾åœ¨ Response é¡µé¢ä¸‹ã€‚è€Œ Chrome æ˜¯åˆ†æˆäº†ä¸¤ä¸ªæ ‡ç­¾é¡µ 4. å¯¼å‡º HARå³é”®ä»»æ„ä¸€ä¸ªè¯·æ±‚ï¼Œé€‰æ‹© save all as HARï¼Œå°±å¯ä»¥å¯¼å‡º HAR æ–‡ä»¶ã€‚ï¼ˆChrome æœ‰ with contentï¼Œ å¯¼å‡ºçš„ HAR æ–‡ä»¶ä¼šå«æœ‰æ‰€æœ‰è¯·æ±‚ä¸å“åº”çš„ bodyï¼‰ è¯¥æ–‡ä»¶å¯ç”¨äºå­˜å‚¨å½“å‰ç›‘å¬åˆ°çš„æ‰€æœ‰æµè§ˆå™¨è¯·æ±‚ä¿¡æ¯ã€‚åœ¨ä»¥åéœ€è¦åˆ†æè¿™äº›è¯·æ±‚æ—¶ï¼Œå°† HAR æ–‡ä»¶æ‹–åˆ° Network é¡µé¢å³å¯æ¢å¤æ‰€æœ‰è¯·æ±‚ã€‚ 5. Raw Headersï¼ˆåŸå§‹æ¶ˆæ¯å¤´ï¼‰Chrome åªæ”¯æŒæŸ¥çœ‹ HTTP/1.x çš„ Raw Headersï¼Œå¯¹è¿™ç§è¯·æ±‚ï¼Œä¼šç»™å‡º view source é€‰é¡¹ã€‚ Chrome ä¸èƒ½æŸ¥çœ‹ HTTP/2 çš„ Raw Headersã€‚ è€Œ Firefox åˆ™æ”¯æŒæŸ¥çœ‹ HTTP/2 çš„ Raw Headersã€‚ï¼ˆæ˜¯æ¢å¤åçš„ï¼ŒHTTP/2 çš„åŸå§‹æ¶ˆæ¯å¤´æ˜¯äºŒè¿›åˆ¶å‹ç¼©å½¢å¼ï¼‰ å®ƒè¿˜æä¾› Edit and Resend è¯·æ±‚çš„åŠŸèƒ½ï¼Œè¿™ç‚¹è¦ç»™ä¸ªèµï½ 6. å®¡æŸ¥ WebSocketï¼ˆChrome onlyï¼‰åœ¨ NetWork ä¸­ç‚¹å‡»å¯¹åº”çš„ WebSocket è¯·æ±‚ï¼Œåœ¨å³ä¾§é€‰æ‹© Frames æ ‡ç­¾ï¼Œå°±å¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„æ¶ˆæ¯äº† 7. è·¨é¡µé¢åŠ è½½æ—¶ï¼Œä¿ç•™ç½‘ç»œè¯·æ±‚è®°å½•å½“é¡µé¢é‡è½½æˆ–è€…é¡µé¢è·³è½¬æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒNetworké¢æ¿ä¸‹çš„ç½‘ç»œè¯·æ±‚è®°å½•è¡¨ä¹Ÿæ˜¯åˆ·æ–°çš„ã€‚å¦‚æœæƒ³ä¿ç•™ä¹‹å‰é¡µé¢çš„ç½‘ç»œè¯·æ±‚æ•°æ®ï¼Œå¯ä»¥å‹¾é€‰Preserve log. å¸¸ç”¨çš„ä¸€ä¸ªåº”ç”¨åœºæ™¯ï¼šç™»å½•/æ³¨å†Œæ—¶ä¼šè°ƒç”¨ç™»å½•/æ³¨å†ŒAPIï¼Œå¼€å‘è€…æƒ³æŸ¥çœ‹è¿™ä¸ªæ¥å£è¿”å›çš„æƒ…å†µï¼Œä½†æ˜¯ç™»å½•/æ³¨å†ŒæˆåŠŸåä¸€èˆ¬ä¼šè·³è½¬åˆ°æ–°çš„é¡µé¢ï¼Œå¯¼è‡´äº†Networké¢æ¿çš„è¯·æ±‚è®°å½•è¢«åˆ·æ–°ä»è€Œçœ‹ä¸åˆ°ç™»å½•/æ³¨å†Œæ¥å£è¿”å›çš„æƒ…å†µã€‚æ­¤æ—¶å‹¾é€‰ä¸ŠPreserve logï¼Œæ— è®ºè·³è½¬åˆ°é‚£ä¸ªé¡µé¢ï¼Œéƒ½èƒ½åœ¨Networkç½‘ç»œè¯·æ±‚è®°å½•è¡¨ä¸­æŸ¥çœ‹åˆ°ä¹‹å‰æ¥å£è¿”å›çš„æƒ…å†µã€‚ ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:3","series":null,"tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/#5-raw-headersåŸå§‹æ¶ˆæ¯å¤´"},{"categories":["tech"],"content":" Network 1. å±æ€§åˆ—Chrome å¯ä»¥å³é”®å±æ€§åˆ—åæ¥å¢å‡å±æ€§åˆ—ï¼ŒFirefox-Dev ä¹Ÿæ˜¯ä¸€æ ·ï¼š 2. copyåœ¨ Chrome ä¸­å³é”®æŸä¸ªè¯·æ±‚ï¼Œé€‰ä¸­ copyï¼Œä¼šç»™å‡ºå‡ ä¸ª optionsï¼š è€Œ Firefox-Dev çš„æ›´å¼ºä¸€ç‚¹ï¼Œå¯ä»¥å¤åˆ¶æ¶ˆæ¯å¤´ï¼ˆè¯·æ±‚å¤´å’Œå“åº”å¤´ï¼‰ï¼š 3. response çš„ pretty printChrome çš„ Response é¡µé¢å·¦ä¸‹è§’ï¼Œæœ‰{}æŒ‰é’®ï¼Œå¯ä»¥ beautify å“åº”ã€‚ è€Œ Firefox-Dev åªåœ¨ Debugger é¡µé¢æä¾›è¯¥æŒ‰é’®ï¼ŒResponse ä¸­ä¸æ”¯æŒã€‚ Firefox å“åº”çš„ preview å’Œ payload æ˜¯æ”¾åœ¨ Response é¡µé¢ä¸‹ã€‚è€Œ Chrome æ˜¯åˆ†æˆäº†ä¸¤ä¸ªæ ‡ç­¾é¡µ 4. å¯¼å‡º HARå³é”®ä»»æ„ä¸€ä¸ªè¯·æ±‚ï¼Œé€‰æ‹© save all as HARï¼Œå°±å¯ä»¥å¯¼å‡º HAR æ–‡ä»¶ã€‚ï¼ˆChrome æœ‰ with contentï¼Œ å¯¼å‡ºçš„ HAR æ–‡ä»¶ä¼šå«æœ‰æ‰€æœ‰è¯·æ±‚ä¸å“åº”çš„ bodyï¼‰ è¯¥æ–‡ä»¶å¯ç”¨äºå­˜å‚¨å½“å‰ç›‘å¬åˆ°çš„æ‰€æœ‰æµè§ˆå™¨è¯·æ±‚ä¿¡æ¯ã€‚åœ¨ä»¥åéœ€è¦åˆ†æè¿™äº›è¯·æ±‚æ—¶ï¼Œå°† HAR æ–‡ä»¶æ‹–åˆ° Network é¡µé¢å³å¯æ¢å¤æ‰€æœ‰è¯·æ±‚ã€‚ 5. Raw Headersï¼ˆåŸå§‹æ¶ˆæ¯å¤´ï¼‰Chrome åªæ”¯æŒæŸ¥çœ‹ HTTP/1.x çš„ Raw Headersï¼Œå¯¹è¿™ç§è¯·æ±‚ï¼Œä¼šç»™å‡º view source é€‰é¡¹ã€‚ Chrome ä¸èƒ½æŸ¥çœ‹ HTTP/2 çš„ Raw Headersã€‚ è€Œ Firefox åˆ™æ”¯æŒæŸ¥çœ‹ HTTP/2 çš„ Raw Headersã€‚ï¼ˆæ˜¯æ¢å¤åçš„ï¼ŒHTTP/2 çš„åŸå§‹æ¶ˆæ¯å¤´æ˜¯äºŒè¿›åˆ¶å‹ç¼©å½¢å¼ï¼‰ å®ƒè¿˜æä¾› Edit and Resend è¯·æ±‚çš„åŠŸèƒ½ï¼Œè¿™ç‚¹è¦ç»™ä¸ªèµï½ 6. å®¡æŸ¥ WebSocketï¼ˆChrome onlyï¼‰åœ¨ NetWork ä¸­ç‚¹å‡»å¯¹åº”çš„ WebSocket è¯·æ±‚ï¼Œåœ¨å³ä¾§é€‰æ‹© Frames æ ‡ç­¾ï¼Œå°±å¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„æ¶ˆæ¯äº† 7. è·¨é¡µé¢åŠ è½½æ—¶ï¼Œä¿ç•™ç½‘ç»œè¯·æ±‚è®°å½•å½“é¡µé¢é‡è½½æˆ–è€…é¡µé¢è·³è½¬æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒNetworké¢æ¿ä¸‹çš„ç½‘ç»œè¯·æ±‚è®°å½•è¡¨ä¹Ÿæ˜¯åˆ·æ–°çš„ã€‚å¦‚æœæƒ³ä¿ç•™ä¹‹å‰é¡µé¢çš„ç½‘ç»œè¯·æ±‚æ•°æ®ï¼Œå¯ä»¥å‹¾é€‰Preserve log. å¸¸ç”¨çš„ä¸€ä¸ªåº”ç”¨åœºæ™¯ï¼šç™»å½•/æ³¨å†Œæ—¶ä¼šè°ƒç”¨ç™»å½•/æ³¨å†ŒAPIï¼Œå¼€å‘è€…æƒ³æŸ¥çœ‹è¿™ä¸ªæ¥å£è¿”å›çš„æƒ…å†µï¼Œä½†æ˜¯ç™»å½•/æ³¨å†ŒæˆåŠŸåä¸€èˆ¬ä¼šè·³è½¬åˆ°æ–°çš„é¡µé¢ï¼Œå¯¼è‡´äº†Networké¢æ¿çš„è¯·æ±‚è®°å½•è¢«åˆ·æ–°ä»è€Œçœ‹ä¸åˆ°ç™»å½•/æ³¨å†Œæ¥å£è¿”å›çš„æƒ…å†µã€‚æ­¤æ—¶å‹¾é€‰ä¸ŠPreserve logï¼Œæ— è®ºè·³è½¬åˆ°é‚£ä¸ªé¡µé¢ï¼Œéƒ½èƒ½åœ¨Networkç½‘ç»œè¯·æ±‚è®°å½•è¡¨ä¸­æŸ¥çœ‹åˆ°ä¹‹å‰æ¥å£è¿”å›çš„æƒ…å†µã€‚ ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:3","series":null,"tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/#6-å®¡æŸ¥-websocketchrome-only"},{"categories":["tech"],"content":" Network 1. å±æ€§åˆ—Chrome å¯ä»¥å³é”®å±æ€§åˆ—åæ¥å¢å‡å±æ€§åˆ—ï¼ŒFirefox-Dev ä¹Ÿæ˜¯ä¸€æ ·ï¼š 2. copyåœ¨ Chrome ä¸­å³é”®æŸä¸ªè¯·æ±‚ï¼Œé€‰ä¸­ copyï¼Œä¼šç»™å‡ºå‡ ä¸ª optionsï¼š è€Œ Firefox-Dev çš„æ›´å¼ºä¸€ç‚¹ï¼Œå¯ä»¥å¤åˆ¶æ¶ˆæ¯å¤´ï¼ˆè¯·æ±‚å¤´å’Œå“åº”å¤´ï¼‰ï¼š 3. response çš„ pretty printChrome çš„ Response é¡µé¢å·¦ä¸‹è§’ï¼Œæœ‰{}æŒ‰é’®ï¼Œå¯ä»¥ beautify å“åº”ã€‚ è€Œ Firefox-Dev åªåœ¨ Debugger é¡µé¢æä¾›è¯¥æŒ‰é’®ï¼ŒResponse ä¸­ä¸æ”¯æŒã€‚ Firefox å“åº”çš„ preview å’Œ payload æ˜¯æ”¾åœ¨ Response é¡µé¢ä¸‹ã€‚è€Œ Chrome æ˜¯åˆ†æˆäº†ä¸¤ä¸ªæ ‡ç­¾é¡µ 4. å¯¼å‡º HARå³é”®ä»»æ„ä¸€ä¸ªè¯·æ±‚ï¼Œé€‰æ‹© save all as HARï¼Œå°±å¯ä»¥å¯¼å‡º HAR æ–‡ä»¶ã€‚ï¼ˆChrome æœ‰ with contentï¼Œ å¯¼å‡ºçš„ HAR æ–‡ä»¶ä¼šå«æœ‰æ‰€æœ‰è¯·æ±‚ä¸å“åº”çš„ bodyï¼‰ è¯¥æ–‡ä»¶å¯ç”¨äºå­˜å‚¨å½“å‰ç›‘å¬åˆ°çš„æ‰€æœ‰æµè§ˆå™¨è¯·æ±‚ä¿¡æ¯ã€‚åœ¨ä»¥åéœ€è¦åˆ†æè¿™äº›è¯·æ±‚æ—¶ï¼Œå°† HAR æ–‡ä»¶æ‹–åˆ° Network é¡µé¢å³å¯æ¢å¤æ‰€æœ‰è¯·æ±‚ã€‚ 5. Raw Headersï¼ˆåŸå§‹æ¶ˆæ¯å¤´ï¼‰Chrome åªæ”¯æŒæŸ¥çœ‹ HTTP/1.x çš„ Raw Headersï¼Œå¯¹è¿™ç§è¯·æ±‚ï¼Œä¼šç»™å‡º view source é€‰é¡¹ã€‚ Chrome ä¸èƒ½æŸ¥çœ‹ HTTP/2 çš„ Raw Headersã€‚ è€Œ Firefox åˆ™æ”¯æŒæŸ¥çœ‹ HTTP/2 çš„ Raw Headersã€‚ï¼ˆæ˜¯æ¢å¤åçš„ï¼ŒHTTP/2 çš„åŸå§‹æ¶ˆæ¯å¤´æ˜¯äºŒè¿›åˆ¶å‹ç¼©å½¢å¼ï¼‰ å®ƒè¿˜æä¾› Edit and Resend è¯·æ±‚çš„åŠŸèƒ½ï¼Œè¿™ç‚¹è¦ç»™ä¸ªèµï½ 6. å®¡æŸ¥ WebSocketï¼ˆChrome onlyï¼‰åœ¨ NetWork ä¸­ç‚¹å‡»å¯¹åº”çš„ WebSocket è¯·æ±‚ï¼Œåœ¨å³ä¾§é€‰æ‹© Frames æ ‡ç­¾ï¼Œå°±å¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„æ¶ˆæ¯äº† 7. è·¨é¡µé¢åŠ è½½æ—¶ï¼Œä¿ç•™ç½‘ç»œè¯·æ±‚è®°å½•å½“é¡µé¢é‡è½½æˆ–è€…é¡µé¢è·³è½¬æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒNetworké¢æ¿ä¸‹çš„ç½‘ç»œè¯·æ±‚è®°å½•è¡¨ä¹Ÿæ˜¯åˆ·æ–°çš„ã€‚å¦‚æœæƒ³ä¿ç•™ä¹‹å‰é¡µé¢çš„ç½‘ç»œè¯·æ±‚æ•°æ®ï¼Œå¯ä»¥å‹¾é€‰Preserve log. å¸¸ç”¨çš„ä¸€ä¸ªåº”ç”¨åœºæ™¯ï¼šç™»å½•/æ³¨å†Œæ—¶ä¼šè°ƒç”¨ç™»å½•/æ³¨å†ŒAPIï¼Œå¼€å‘è€…æƒ³æŸ¥çœ‹è¿™ä¸ªæ¥å£è¿”å›çš„æƒ…å†µï¼Œä½†æ˜¯ç™»å½•/æ³¨å†ŒæˆåŠŸåä¸€èˆ¬ä¼šè·³è½¬åˆ°æ–°çš„é¡µé¢ï¼Œå¯¼è‡´äº†Networké¢æ¿çš„è¯·æ±‚è®°å½•è¢«åˆ·æ–°ä»è€Œçœ‹ä¸åˆ°ç™»å½•/æ³¨å†Œæ¥å£è¿”å›çš„æƒ…å†µã€‚æ­¤æ—¶å‹¾é€‰ä¸ŠPreserve logï¼Œæ— è®ºè·³è½¬åˆ°é‚£ä¸ªé¡µé¢ï¼Œéƒ½èƒ½åœ¨Networkç½‘ç»œè¯·æ±‚è®°å½•è¡¨ä¸­æŸ¥çœ‹åˆ°ä¹‹å‰æ¥å£è¿”å›çš„æƒ…å†µã€‚ ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:3","series":null,"tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/#7-è·¨é¡µé¢åŠ è½½æ—¶ä¿ç•™ç½‘ç»œè¯·æ±‚è®°å½•"},{"categories":["tech"],"content":" JavaScript æ§åˆ¶å° å¯ä»¥é€šè¿‡ $x(\u003cxpath\u003e, \u003cDOM-element\u003e)ï¼Œç”¨ xpath æŸ¥è¯¢ DOM å…ƒç´ ã€‚ é€šè¿‡æ§åˆ¶å°å·¦ä¸Šæ–¹çš„é€‰å•ï¼Œå¯ä»¥åˆ‡æ¢ JS çš„ç¯å¢ƒï¼Œå®ƒé»˜è®¤æ˜¯å½“å‰é¡µé¢ï¼ˆtopï¼‰ã€‚ ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:4","series":null,"tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/#javascript-æ§åˆ¶å°"},{"categories":["tech"],"content":" Elements é¡µé¢ï¼ˆFirefox-Dev æ˜¯ Inspector é¡µé¢ï¼‰ 1. DOM å…ƒç´ æ–­ç‚¹ï¼ˆChrome onlyï¼‰åœ¨ Elements é¡µé¢ï¼Œå³é”®ä¸€ä¸ªå…ƒç´ ï¼Œæœ‰ä¸€ä¸ª Break on é€‰é¡¹ï¼Œå¯ä»¥æ§åˆ¶åœ¨ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶ Break. - subtree modification: å­èŠ‚ç‚¹è¢«ä¿®æ”¹ - attribute modificationï¼šå½“å‰èŠ‚ç‚¹çš„å±æ€§è¢«ä¿®æ”¹ã€‚ï¼ˆinline style è¢«ä¿®æ”¹ä¹Ÿä¼šè§¦å‘æ­¤äº‹ä»¶ï¼‰- node removalï¼šèŠ‚ç‚¹è¢«ç§»é™¤ 2. æ£€ç´¢å…ƒç´ ä¸Šæ³¨å†Œçš„äº‹ä»¶ï¼ˆChrome onlyï¼‰åœ¨ Elements é¡µé¢é€‰ä¸­ä¸€ä¸ªå…ƒç´ ï¼ˆæˆ–è€…ç›´æ¥å³é”®æ£€æŸ¥è¯¥å…ƒç´ ï¼‰ï¼Œç„¶ååœ¨å³ä¾§çª—å£ï¼Œé€‰æ‹© Event Listeners æ ‡ç­¾ï¼Œå°±å¯ä»¥çœ‹åˆ°è¯¥å…ƒç´ ä¸Šæ³¨å†Œçš„æ‰€æœ‰äº‹ä»¶ã€‚ 3. é¢œè‰²é€‰æ‹©å™¨é€‰ä¸­ä»»ä¸€å…ƒç´ ï¼Œåœ¨å³ä¾§é€‰æ‹© Styles é€‰å•ï¼Œä¼šæ˜¾ç¤ºå½“å‰å…ƒç´ çš„ css å±æ€§ã€‚ å…¶ä¸­æ‰€æœ‰çš„é¢œè‰²å°æ–¹å—éƒ½æ˜¯å¯ä»¥ç‚¹å‡»çš„ï¼Œç‚¹å‡»é¢œè‰²æ–¹å—å å¯ä»¥å°†é¢œè‰²å±æ€§è½¬æ¢æˆå¤šä¸ªæ ¼å¼ï¼ˆChrome onlyï¼‰ é»˜è®¤æ ¼å¼ï¼š#207981 RGBæ ¼å¼ï¼šrgb(32, 121, 129) HSLæ ¼å¼ï¼šhsl(185, 60%, 32%) æä¾› color pickerï¼Œå¯ç”¨äºåœ¨ç½‘é¡µä»»æ„ä½ç½®å–è‰²ã€‚ï¼ˆFirefox-Dev ä¹Ÿæœ‰ï¼‰ æä¾›å¤åˆ¶æŒ‰é”®ï¼Œç›´æ¥å°†è¯¥é¢œè‰²å½“å‰æ ¼å¼çš„è¡¨è¾¾å¤åˆ¶åˆ°å‰ªåˆ‡æ¿ ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:5","series":null,"tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/#elements-é¡µé¢firefox-dev-æ˜¯-inspector-é¡µé¢"},{"categories":["tech"],"content":" Elements é¡µé¢ï¼ˆFirefox-Dev æ˜¯ Inspector é¡µé¢ï¼‰ 1. DOM å…ƒç´ æ–­ç‚¹ï¼ˆChrome onlyï¼‰åœ¨ Elements é¡µé¢ï¼Œå³é”®ä¸€ä¸ªå…ƒç´ ï¼Œæœ‰ä¸€ä¸ª Break on é€‰é¡¹ï¼Œå¯ä»¥æ§åˆ¶åœ¨ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶ Break. - subtree modification: å­èŠ‚ç‚¹è¢«ä¿®æ”¹ - attribute modificationï¼šå½“å‰èŠ‚ç‚¹çš„å±æ€§è¢«ä¿®æ”¹ã€‚ï¼ˆinline style è¢«ä¿®æ”¹ä¹Ÿä¼šè§¦å‘æ­¤äº‹ä»¶ï¼‰- node removalï¼šèŠ‚ç‚¹è¢«ç§»é™¤ 2. æ£€ç´¢å…ƒç´ ä¸Šæ³¨å†Œçš„äº‹ä»¶ï¼ˆChrome onlyï¼‰åœ¨ Elements é¡µé¢é€‰ä¸­ä¸€ä¸ªå…ƒç´ ï¼ˆæˆ–è€…ç›´æ¥å³é”®æ£€æŸ¥è¯¥å…ƒç´ ï¼‰ï¼Œç„¶ååœ¨å³ä¾§çª—å£ï¼Œé€‰æ‹© Event Listeners æ ‡ç­¾ï¼Œå°±å¯ä»¥çœ‹åˆ°è¯¥å…ƒç´ ä¸Šæ³¨å†Œçš„æ‰€æœ‰äº‹ä»¶ã€‚ 3. é¢œè‰²é€‰æ‹©å™¨é€‰ä¸­ä»»ä¸€å…ƒç´ ï¼Œåœ¨å³ä¾§é€‰æ‹© Styles é€‰å•ï¼Œä¼šæ˜¾ç¤ºå½“å‰å…ƒç´ çš„ css å±æ€§ã€‚ å…¶ä¸­æ‰€æœ‰çš„é¢œè‰²å°æ–¹å—éƒ½æ˜¯å¯ä»¥ç‚¹å‡»çš„ï¼Œç‚¹å‡»é¢œè‰²æ–¹å—å å¯ä»¥å°†é¢œè‰²å±æ€§è½¬æ¢æˆå¤šä¸ªæ ¼å¼ï¼ˆChrome onlyï¼‰ é»˜è®¤æ ¼å¼ï¼š#207981 RGBæ ¼å¼ï¼šrgb(32, 121, 129) HSLæ ¼å¼ï¼šhsl(185, 60%, 32%) æä¾› color pickerï¼Œå¯ç”¨äºåœ¨ç½‘é¡µä»»æ„ä½ç½®å–è‰²ã€‚ï¼ˆFirefox-Dev ä¹Ÿæœ‰ï¼‰ æä¾›å¤åˆ¶æŒ‰é”®ï¼Œç›´æ¥å°†è¯¥é¢œè‰²å½“å‰æ ¼å¼çš„è¡¨è¾¾å¤åˆ¶åˆ°å‰ªåˆ‡æ¿ ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:5","series":null,"tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/#1-dom-å…ƒç´ æ–­ç‚¹chrome-only"},{"categories":["tech"],"content":" Elements é¡µé¢ï¼ˆFirefox-Dev æ˜¯ Inspector é¡µé¢ï¼‰ 1. DOM å…ƒç´ æ–­ç‚¹ï¼ˆChrome onlyï¼‰åœ¨ Elements é¡µé¢ï¼Œå³é”®ä¸€ä¸ªå…ƒç´ ï¼Œæœ‰ä¸€ä¸ª Break on é€‰é¡¹ï¼Œå¯ä»¥æ§åˆ¶åœ¨ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶ Break. - subtree modification: å­èŠ‚ç‚¹è¢«ä¿®æ”¹ - attribute modificationï¼šå½“å‰èŠ‚ç‚¹çš„å±æ€§è¢«ä¿®æ”¹ã€‚ï¼ˆinline style è¢«ä¿®æ”¹ä¹Ÿä¼šè§¦å‘æ­¤äº‹ä»¶ï¼‰- node removalï¼šèŠ‚ç‚¹è¢«ç§»é™¤ 2. æ£€ç´¢å…ƒç´ ä¸Šæ³¨å†Œçš„äº‹ä»¶ï¼ˆChrome onlyï¼‰åœ¨ Elements é¡µé¢é€‰ä¸­ä¸€ä¸ªå…ƒç´ ï¼ˆæˆ–è€…ç›´æ¥å³é”®æ£€æŸ¥è¯¥å…ƒç´ ï¼‰ï¼Œç„¶ååœ¨å³ä¾§çª—å£ï¼Œé€‰æ‹© Event Listeners æ ‡ç­¾ï¼Œå°±å¯ä»¥çœ‹åˆ°è¯¥å…ƒç´ ä¸Šæ³¨å†Œçš„æ‰€æœ‰äº‹ä»¶ã€‚ 3. é¢œè‰²é€‰æ‹©å™¨é€‰ä¸­ä»»ä¸€å…ƒç´ ï¼Œåœ¨å³ä¾§é€‰æ‹© Styles é€‰å•ï¼Œä¼šæ˜¾ç¤ºå½“å‰å…ƒç´ çš„ css å±æ€§ã€‚ å…¶ä¸­æ‰€æœ‰çš„é¢œè‰²å°æ–¹å—éƒ½æ˜¯å¯ä»¥ç‚¹å‡»çš„ï¼Œç‚¹å‡»é¢œè‰²æ–¹å—å å¯ä»¥å°†é¢œè‰²å±æ€§è½¬æ¢æˆå¤šä¸ªæ ¼å¼ï¼ˆChrome onlyï¼‰ é»˜è®¤æ ¼å¼ï¼š#207981 RGBæ ¼å¼ï¼šrgb(32, 121, 129) HSLæ ¼å¼ï¼šhsl(185, 60%, 32%) æä¾› color pickerï¼Œå¯ç”¨äºåœ¨ç½‘é¡µä»»æ„ä½ç½®å–è‰²ã€‚ï¼ˆFirefox-Dev ä¹Ÿæœ‰ï¼‰ æä¾›å¤åˆ¶æŒ‰é”®ï¼Œç›´æ¥å°†è¯¥é¢œè‰²å½“å‰æ ¼å¼çš„è¡¨è¾¾å¤åˆ¶åˆ°å‰ªåˆ‡æ¿ ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:5","series":null,"tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/#2-æ£€ç´¢å…ƒç´ ä¸Šæ³¨å†Œçš„äº‹ä»¶chrome-only"},{"categories":["tech"],"content":" Elements é¡µé¢ï¼ˆFirefox-Dev æ˜¯ Inspector é¡µé¢ï¼‰ 1. DOM å…ƒç´ æ–­ç‚¹ï¼ˆChrome onlyï¼‰åœ¨ Elements é¡µé¢ï¼Œå³é”®ä¸€ä¸ªå…ƒç´ ï¼Œæœ‰ä¸€ä¸ª Break on é€‰é¡¹ï¼Œå¯ä»¥æ§åˆ¶åœ¨ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶ Break. - subtree modification: å­èŠ‚ç‚¹è¢«ä¿®æ”¹ - attribute modificationï¼šå½“å‰èŠ‚ç‚¹çš„å±æ€§è¢«ä¿®æ”¹ã€‚ï¼ˆinline style è¢«ä¿®æ”¹ä¹Ÿä¼šè§¦å‘æ­¤äº‹ä»¶ï¼‰- node removalï¼šèŠ‚ç‚¹è¢«ç§»é™¤ 2. æ£€ç´¢å…ƒç´ ä¸Šæ³¨å†Œçš„äº‹ä»¶ï¼ˆChrome onlyï¼‰åœ¨ Elements é¡µé¢é€‰ä¸­ä¸€ä¸ªå…ƒç´ ï¼ˆæˆ–è€…ç›´æ¥å³é”®æ£€æŸ¥è¯¥å…ƒç´ ï¼‰ï¼Œç„¶ååœ¨å³ä¾§çª—å£ï¼Œé€‰æ‹© Event Listeners æ ‡ç­¾ï¼Œå°±å¯ä»¥çœ‹åˆ°è¯¥å…ƒç´ ä¸Šæ³¨å†Œçš„æ‰€æœ‰äº‹ä»¶ã€‚ 3. é¢œè‰²é€‰æ‹©å™¨é€‰ä¸­ä»»ä¸€å…ƒç´ ï¼Œåœ¨å³ä¾§é€‰æ‹© Styles é€‰å•ï¼Œä¼šæ˜¾ç¤ºå½“å‰å…ƒç´ çš„ css å±æ€§ã€‚ å…¶ä¸­æ‰€æœ‰çš„é¢œè‰²å°æ–¹å—éƒ½æ˜¯å¯ä»¥ç‚¹å‡»çš„ï¼Œç‚¹å‡»é¢œè‰²æ–¹å—å å¯ä»¥å°†é¢œè‰²å±æ€§è½¬æ¢æˆå¤šä¸ªæ ¼å¼ï¼ˆChrome onlyï¼‰ é»˜è®¤æ ¼å¼ï¼š#207981 RGBæ ¼å¼ï¼šrgb(32, 121, 129) HSLæ ¼å¼ï¼šhsl(185, 60%, 32%) æä¾› color pickerï¼Œå¯ç”¨äºåœ¨ç½‘é¡µä»»æ„ä½ç½®å–è‰²ã€‚ï¼ˆFirefox-Dev ä¹Ÿæœ‰ï¼‰ æä¾›å¤åˆ¶æŒ‰é”®ï¼Œç›´æ¥å°†è¯¥é¢œè‰²å½“å‰æ ¼å¼çš„è¡¨è¾¾å¤åˆ¶åˆ°å‰ªåˆ‡æ¿ ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:5","series":null,"tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/#3-é¢œè‰²é€‰æ‹©å™¨"},{"categories":["tech"],"content":" å…ƒç´ å®¡æŸ¥Ctrl + Shift + C æˆ–è€…ç‚¹å‡» DevTools æœ€å·¦ä¸Šè§’çš„å°ç®­å¤´æŒ‰é’®ï¼Œå°±èƒ½è¿›å…¥å…ƒç´ å®¡æŸ¥æ¨¡å¼ã€‚ è¯¥æ¨¡å¼ä¸‹ä¼šè‡ªåŠ¨å®¡æŸ¥é¼ æ ‡æ‰€æŒ‡çš„å…ƒç´ ï¼ŒElements é¡µé¢ä¹Ÿä¼šè‡ªåŠ¨å®šä½åˆ°è¯¥å…ƒç´ ã€‚ ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:6","series":null,"tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/#å…ƒç´ å®¡æŸ¥"},{"categories":["tech"],"content":" Sources é¡µé¢ï¼ˆFirefox-Dev æ˜¯ Debuuger é¡µé¢ï¼‰Sources å³ä¾§çš„ Debugger æ”¯æŒå„ç§æ–­ç‚¹è°ƒè¯•ã€‚ æ¡ä»¶æ–­ç‚¹ Sources ä¸­ï¼Œåœ¨ä»»æ„ JS ä»£ç çš„è¡Œå·ä¸Šå•å‡»é¼ æ ‡å·¦é”®ï¼Œå°±èƒ½åœ¨è¯¥è¡Œè®¾ç½®ä¸€ä¸ªæ™®é€šæ–­ç‚¹ï¼ˆåœ¨ Response ä¸­å¯ä¸è¡Œï¼‰ã€‚åœ¨è¡Œå·ä¸Šå³é”®ï¼Œèƒ½ç›´æ¥è®¾ç½®æ¡ä»¶æ–­ç‚¹ã€‚ XHR æ–­ç‚¹ï¼šåœ¨å³ä¾§ Debugger ä¸­ï¼Œå¯ä»¥æ·»åŠ  XHR æ–­ç‚¹ã€‚ å¦‚æœæ¡ä»¶ç•™ç©ºï¼Œä¸€æ—¦æœ‰ XHR å‘èµ·ï¼Œå°±ä¼šæ— æ¡ä»¶è¿›å…¥è°ƒè¯•ã€‚ æ¡ä»¶æ˜¯ ã€ŒBreak When URL Contaions ã€ Watch Expressionsï¼šè¡¨è¾¾å¼å®¡æŸ¥ åŒå‡»é€‰ä¸­ JS ä»£ç ä¸­çš„ä»»æ„å˜é‡ï¼Œç„¶åå³é”®å®ƒï¼Œå¯ä»¥å°†è¯¥å˜é‡æ·»åŠ åˆ° Watch ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥éšæ—¶è§‚å¯Ÿå®ƒçš„å€¼ã€‚ ä¹Ÿå¯ä»¥åœ¨å³ä¾§ Watch ä¸­æ‰‹åŠ¨è¾“å…¥ JS è¡¨è¾¾å¼ã€‚ DOM å…ƒç´ æ–­ç‚¹ï¼ˆChrome onlyï¼‰ï¼šåœ¨ Elements éƒ¨åˆ†è®²è¿‡äº†ã€‚ Chrome çš„æ–­ç‚¹åŠŸèƒ½æ¯” Firefox-Dev çš„æ›´ä¸°å¯Œã€‚ ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:7","series":null,"tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/#sources-é¡µé¢firefox-dev-æ˜¯-debuuger-é¡µé¢"},{"categories":["tech"],"content":" Screenshot 1. For Chromeæ–¹æ³•ä¸€ï¼šåœ¨ DevTools ç•Œé¢ï¼ŒæŒ‰å¿«æ·é”® Ctrl + Shift + P æ‰“å¼€ Command çª—å£ï¼Œç„¶åè¾“å…¥screenshotï¼Œåœ¨ä¸‹æ‹‰æ é‡Œé€‰æ‹©ä½ éœ€è¦çš„æˆªå›¾å‘½ä»¤å°±è¡Œã€‚ æ–¹æ³•äºŒï¼šå…ˆè¿› dev toolsï¼Œç‚¹å‡» å·¦ä¸Šè§’çš„è®¾å¤‡å›¾æ ‡ï¼ˆtoggle device toolbarï¼‰ï¼Œç„¶åé¡µé¢é¡¶éƒ¨å°±ä¼šå‡ºç°ä¸€ä¸ªå¯¼èˆªæ ï¼Œåœ¨è¿™é‡Œå¥½é€‰æ‹©è®¾å¤‡æˆ–è€…è‡ªå®šä¹‰å›¾åƒå°ºå¯¸ï¼Œç„¶åç‚¹å‡»è¯¥å¯¼èˆªæ å³ä¾§ï¼ˆä¸æ˜¯ dev tools å³ä¾§ï¼‰çš„ options å›¾æ ‡ï¼Œä¼šæœ‰ä¸¤ä¸ªé€‰é¡¹ï¼šã€Œæˆªå›¾ï¼ˆcapture screenshotï¼‰ã€å’Œã€Œæˆªç½‘é¡µå…¨å›¾ï¼ˆcapture full size screenshotï¼‰ã€ï¼Œå¦‚ä¸‹ï¼š 2. For Firefox åªæˆªæ˜¾ç¤ºå‡ºæ¥çš„éƒ¨åˆ†ï¼šå’Œ Chrome ä¸€æ ·ç‚¹å‡»è®¾å¤‡å›¾æ ‡ï¼Œç„¶ååœ¨é¡µé¢ä¸Šé¢çš„ toolbar å°±æœ‰æˆªå›¾æŒ‰é’® æˆªç½‘é¡µå…¨å›¾ï¼šåœ¨ DevTools å³è¾¹çš„ options ä¸­è¿›å…¥ Settingsï¼Œå‹¾é€‰take a screenshot of the entire pageï¼ŒDevTools å³ä¸Šè§’å°±ä¼šå‡ºç°æˆªå›¾æŒ‰é’®äº†ã€‚ ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:8","series":null,"tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/#screenshot"},{"categories":["tech"],"content":" Screenshot 1. For Chromeæ–¹æ³•ä¸€ï¼šåœ¨ DevTools ç•Œé¢ï¼ŒæŒ‰å¿«æ·é”® Ctrl + Shift + P æ‰“å¼€ Command çª—å£ï¼Œç„¶åè¾“å…¥screenshotï¼Œåœ¨ä¸‹æ‹‰æ é‡Œé€‰æ‹©ä½ éœ€è¦çš„æˆªå›¾å‘½ä»¤å°±è¡Œã€‚ æ–¹æ³•äºŒï¼šå…ˆè¿› dev toolsï¼Œç‚¹å‡» å·¦ä¸Šè§’çš„è®¾å¤‡å›¾æ ‡ï¼ˆtoggle device toolbarï¼‰ï¼Œç„¶åé¡µé¢é¡¶éƒ¨å°±ä¼šå‡ºç°ä¸€ä¸ªå¯¼èˆªæ ï¼Œåœ¨è¿™é‡Œå¥½é€‰æ‹©è®¾å¤‡æˆ–è€…è‡ªå®šä¹‰å›¾åƒå°ºå¯¸ï¼Œç„¶åç‚¹å‡»è¯¥å¯¼èˆªæ å³ä¾§ï¼ˆä¸æ˜¯ dev tools å³ä¾§ï¼‰çš„ options å›¾æ ‡ï¼Œä¼šæœ‰ä¸¤ä¸ªé€‰é¡¹ï¼šã€Œæˆªå›¾ï¼ˆcapture screenshotï¼‰ã€å’Œã€Œæˆªç½‘é¡µå…¨å›¾ï¼ˆcapture full size screenshotï¼‰ã€ï¼Œå¦‚ä¸‹ï¼š 2. For Firefox åªæˆªæ˜¾ç¤ºå‡ºæ¥çš„éƒ¨åˆ†ï¼šå’Œ Chrome ä¸€æ ·ç‚¹å‡»è®¾å¤‡å›¾æ ‡ï¼Œç„¶ååœ¨é¡µé¢ä¸Šé¢çš„ toolbar å°±æœ‰æˆªå›¾æŒ‰é’® æˆªç½‘é¡µå…¨å›¾ï¼šåœ¨ DevTools å³è¾¹çš„ options ä¸­è¿›å…¥ Settingsï¼Œå‹¾é€‰take a screenshot of the entire pageï¼ŒDevTools å³ä¸Šè§’å°±ä¼šå‡ºç°æˆªå›¾æŒ‰é’®äº†ã€‚ ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:8","series":null,"tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/#1-for-chrome"},{"categories":["tech"],"content":" Screenshot 1. For Chromeæ–¹æ³•ä¸€ï¼šåœ¨ DevTools ç•Œé¢ï¼ŒæŒ‰å¿«æ·é”® Ctrl + Shift + P æ‰“å¼€ Command çª—å£ï¼Œç„¶åè¾“å…¥screenshotï¼Œåœ¨ä¸‹æ‹‰æ é‡Œé€‰æ‹©ä½ éœ€è¦çš„æˆªå›¾å‘½ä»¤å°±è¡Œã€‚ æ–¹æ³•äºŒï¼šå…ˆè¿› dev toolsï¼Œç‚¹å‡» å·¦ä¸Šè§’çš„è®¾å¤‡å›¾æ ‡ï¼ˆtoggle device toolbarï¼‰ï¼Œç„¶åé¡µé¢é¡¶éƒ¨å°±ä¼šå‡ºç°ä¸€ä¸ªå¯¼èˆªæ ï¼Œåœ¨è¿™é‡Œå¥½é€‰æ‹©è®¾å¤‡æˆ–è€…è‡ªå®šä¹‰å›¾åƒå°ºå¯¸ï¼Œç„¶åç‚¹å‡»è¯¥å¯¼èˆªæ å³ä¾§ï¼ˆä¸æ˜¯ dev tools å³ä¾§ï¼‰çš„ options å›¾æ ‡ï¼Œä¼šæœ‰ä¸¤ä¸ªé€‰é¡¹ï¼šã€Œæˆªå›¾ï¼ˆcapture screenshotï¼‰ã€å’Œã€Œæˆªç½‘é¡µå…¨å›¾ï¼ˆcapture full size screenshotï¼‰ã€ï¼Œå¦‚ä¸‹ï¼š 2. For Firefox åªæˆªæ˜¾ç¤ºå‡ºæ¥çš„éƒ¨åˆ†ï¼šå’Œ Chrome ä¸€æ ·ç‚¹å‡»è®¾å¤‡å›¾æ ‡ï¼Œç„¶ååœ¨é¡µé¢ä¸Šé¢çš„ toolbar å°±æœ‰æˆªå›¾æŒ‰é’® æˆªç½‘é¡µå…¨å›¾ï¼šåœ¨ DevTools å³è¾¹çš„ options ä¸­è¿›å…¥ Settingsï¼Œå‹¾é€‰take a screenshot of the entire pageï¼ŒDevTools å³ä¸Šè§’å°±ä¼šå‡ºç°æˆªå›¾æŒ‰é’®äº†ã€‚ ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:8","series":null,"tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/#2-for-firefox"},{"categories":["tech"],"content":" å…¶ä»– 1. Fake Geolocationï¼ˆChrome onlyï¼‰åœ¨ Chrome ä¸­è¿›å…¥ DevToolsï¼Œç‚¹å‡»å³ä¸Šè§’çš„ options æŒ‰é’®ï¼Œé€‰æ‹© More tools -\u003e Sensorsï¼Œåœ¨ Geolocation å¤„é€‰æ‹© Custom locationï¼Œå°±å¯ä»¥ä¿®æ”¹åœ°ç†ä½ç½®äº†ã€‚ 2. è‡ªå®šä¹‰è¯·æ±‚å¤´ For Chromeå’Œ ä¸Šä¸€å°èŠ‚ä¸€æ ·ï¼Œå…ˆè¿› More toolsï¼Œé€‰æ‹© Network conditionsï¼Œå–æ¶ˆå‹¾é€‰ Select atuomaticallyï¼Œ å°±å¯ä»¥ä¿®æ”¹è¯·æ±‚å¤´äº†ã€‚ ä¸Šé¢çš„æ¼”ç¤ºä¸­ï¼Œä½¿ç”¨ python-requests/2.21.0 åš user agentï¼ŒçŸ¥ä¹è¿”å› 404. For Firefoxæ‰“å¼€è®¾å¤‡æ¨¡æ‹Ÿï¼Œåœ¨ toolbar çš„å³ä¸Šè§’å‹¾é€‰ show user agentï¼Œç„¶åå°±å¯ä»¥åœ¨ toolbar ä¿®æ”¹ user agent äº†ï¼š ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:9","series":null,"tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/#å…¶ä»–"},{"categories":["tech"],"content":" å…¶ä»– 1. Fake Geolocationï¼ˆChrome onlyï¼‰åœ¨ Chrome ä¸­è¿›å…¥ DevToolsï¼Œç‚¹å‡»å³ä¸Šè§’çš„ options æŒ‰é’®ï¼Œé€‰æ‹© More tools -\u003e Sensorsï¼Œåœ¨ Geolocation å¤„é€‰æ‹© Custom locationï¼Œå°±å¯ä»¥ä¿®æ”¹åœ°ç†ä½ç½®äº†ã€‚ 2. è‡ªå®šä¹‰è¯·æ±‚å¤´ For Chromeå’Œ ä¸Šä¸€å°èŠ‚ä¸€æ ·ï¼Œå…ˆè¿› More toolsï¼Œé€‰æ‹© Network conditionsï¼Œå–æ¶ˆå‹¾é€‰ Select atuomaticallyï¼Œ å°±å¯ä»¥ä¿®æ”¹è¯·æ±‚å¤´äº†ã€‚ ä¸Šé¢çš„æ¼”ç¤ºä¸­ï¼Œä½¿ç”¨ python-requests/2.21.0 åš user agentï¼ŒçŸ¥ä¹è¿”å› 404. For Firefoxæ‰“å¼€è®¾å¤‡æ¨¡æ‹Ÿï¼Œåœ¨ toolbar çš„å³ä¸Šè§’å‹¾é€‰ show user agentï¼Œç„¶åå°±å¯ä»¥åœ¨ toolbar ä¿®æ”¹ user agent äº†ï¼š ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:9","series":null,"tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/#1-fake-geolocationchrome-only"},{"categories":["tech"],"content":" å…¶ä»– 1. Fake Geolocationï¼ˆChrome onlyï¼‰åœ¨ Chrome ä¸­è¿›å…¥ DevToolsï¼Œç‚¹å‡»å³ä¸Šè§’çš„ options æŒ‰é’®ï¼Œé€‰æ‹© More tools -\u003e Sensorsï¼Œåœ¨ Geolocation å¤„é€‰æ‹© Custom locationï¼Œå°±å¯ä»¥ä¿®æ”¹åœ°ç†ä½ç½®äº†ã€‚ 2. è‡ªå®šä¹‰è¯·æ±‚å¤´ For Chromeå’Œ ä¸Šä¸€å°èŠ‚ä¸€æ ·ï¼Œå…ˆè¿› More toolsï¼Œé€‰æ‹© Network conditionsï¼Œå–æ¶ˆå‹¾é€‰ Select atuomaticallyï¼Œ å°±å¯ä»¥ä¿®æ”¹è¯·æ±‚å¤´äº†ã€‚ ä¸Šé¢çš„æ¼”ç¤ºä¸­ï¼Œä½¿ç”¨ python-requests/2.21.0 åš user agentï¼ŒçŸ¥ä¹è¿”å› 404. For Firefoxæ‰“å¼€è®¾å¤‡æ¨¡æ‹Ÿï¼Œåœ¨ toolbar çš„å³ä¸Šè§’å‹¾é€‰ show user agentï¼Œç„¶åå°±å¯ä»¥åœ¨ toolbar ä¿®æ”¹ user agent äº†ï¼š ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:9","series":null,"tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/#2-è‡ªå®šä¹‰è¯·æ±‚å¤´"},{"categories":["tech"],"content":" å…¶ä»– 1. Fake Geolocationï¼ˆChrome onlyï¼‰åœ¨ Chrome ä¸­è¿›å…¥ DevToolsï¼Œç‚¹å‡»å³ä¸Šè§’çš„ options æŒ‰é’®ï¼Œé€‰æ‹© More tools -\u003e Sensorsï¼Œåœ¨ Geolocation å¤„é€‰æ‹© Custom locationï¼Œå°±å¯ä»¥ä¿®æ”¹åœ°ç†ä½ç½®äº†ã€‚ 2. è‡ªå®šä¹‰è¯·æ±‚å¤´ For Chromeå’Œ ä¸Šä¸€å°èŠ‚ä¸€æ ·ï¼Œå…ˆè¿› More toolsï¼Œé€‰æ‹© Network conditionsï¼Œå–æ¶ˆå‹¾é€‰ Select atuomaticallyï¼Œ å°±å¯ä»¥ä¿®æ”¹è¯·æ±‚å¤´äº†ã€‚ ä¸Šé¢çš„æ¼”ç¤ºä¸­ï¼Œä½¿ç”¨ python-requests/2.21.0 åš user agentï¼ŒçŸ¥ä¹è¿”å› 404. For Firefoxæ‰“å¼€è®¾å¤‡æ¨¡æ‹Ÿï¼Œåœ¨ toolbar çš„å³ä¸Šè§’å‹¾é€‰ show user agentï¼Œç„¶åå°±å¯ä»¥åœ¨ toolbar ä¿®æ”¹ user agent äº†ï¼š ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:9","series":null,"tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/#for-chrome"},{"categories":["tech"],"content":" å…¶ä»– 1. Fake Geolocationï¼ˆChrome onlyï¼‰åœ¨ Chrome ä¸­è¿›å…¥ DevToolsï¼Œç‚¹å‡»å³ä¸Šè§’çš„ options æŒ‰é’®ï¼Œé€‰æ‹© More tools -\u003e Sensorsï¼Œåœ¨ Geolocation å¤„é€‰æ‹© Custom locationï¼Œå°±å¯ä»¥ä¿®æ”¹åœ°ç†ä½ç½®äº†ã€‚ 2. è‡ªå®šä¹‰è¯·æ±‚å¤´ For Chromeå’Œ ä¸Šä¸€å°èŠ‚ä¸€æ ·ï¼Œå…ˆè¿› More toolsï¼Œé€‰æ‹© Network conditionsï¼Œå–æ¶ˆå‹¾é€‰ Select atuomaticallyï¼Œ å°±å¯ä»¥ä¿®æ”¹è¯·æ±‚å¤´äº†ã€‚ ä¸Šé¢çš„æ¼”ç¤ºä¸­ï¼Œä½¿ç”¨ python-requests/2.21.0 åš user agentï¼ŒçŸ¥ä¹è¿”å› 404. For Firefoxæ‰“å¼€è®¾å¤‡æ¨¡æ‹Ÿï¼Œåœ¨ toolbar çš„å³ä¸Šè§’å‹¾é€‰ show user agentï¼Œç„¶åå°±å¯ä»¥åœ¨ toolbar ä¿®æ”¹ user agent äº†ï¼š ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:9","series":null,"tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/#for-firefox"},{"categories":["tech"],"content":" 3. Request Blockingï¼ˆChrome onlyï¼‰åœ¨ Network çš„ä»»æ„è¯·æ±‚ä¸Šå³é”®ï¼Œèœå•ä¸­å°±æœ‰ Block request URLï¼ˆé˜»å¡è¯¥ URLï¼‰å’Œ Block request domainï¼ˆé˜»å¡è¯·æ±‚æ‰€åœ¨çš„æ•´ä¸ªåŸŸï¼‰ ç„¶åå°±å¯ä»¥åœ¨ More tools -\u003e Request blocking ä¸­çœ‹åˆ°ä½ è®¾ç½®çš„é˜»å¡æ¡ä»¶ã€‚ ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:10","series":null,"tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/#3-request-blockingchrome-only"},{"categories":["tech"],"content":" å‚è€ƒ ä½ ä¸çŸ¥é“çš„ Chrome è°ƒè¯•æŠ€å·§ Chrome Dev Tools ä¸­æ–‡æ‰‹å†Œ Firefox Quantumï¼šå¼€å‘è€…ç‰ˆæœ¬ How to Capture Screenshots in Google Chrome without using Extensions Chrome DevTools - Network ","date":"2019-02-11","objectID":"/posts/web-browser-dev-tools/:0:11","series":null,"tags":["Chrome","Firefox","DevTools","Browser"],"title":"Chrome ä¸ Firefox-Dev çš„ DevTools","uri":"/posts/web-browser-dev-tools/#å‚è€ƒ"},{"categories":["tech"],"content":" å‰è¨€å¦‚æœè¦åœ¨Linux ä¸Šè®¾ç½®ä¸€ä¸ªå¼€æœºè‡ªå¯ï¼Œå‡ºç°é—®é¢˜è‡ªåŠ¨é‡å¯ï¼Œå¹¶ä¸”æœ‰è‰¯å¥½æ—¥å¿—çš„ç¨‹åºï¼Œæ¯”è¾ƒæµè¡Œçš„æ–¹æ³•æœ‰supervisordã€systemdï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ upstartã€runit ç­‰ç±»ä¼¼çš„å·¥å…·ã€‚ä½†æ˜¯è‡ªä» systemd è¢« ubuntuã€centos ç­‰ä¸»æµ Linux å‘è¡Œç‰ˆåº”ç”¨ä»¥æ¥ï¼Œsystemd æ¸æ¸æˆä¸ºä¸»æµæ–¹æ¡ˆã€‚ å¦‚æœä½ éœ€è¦è·¨å¹³å°(Linux/MacOSX/FreeBSD)çš„æ–¹æ¡ˆï¼Œé‚£ä¹ˆå»ºè®®ä½¿ç”¨ supervisordï¼Œå¦‚æœåªéœ€è¦æ”¯æŒ Linux åˆ™å»ºè®®é€‰ç”¨ systemd. ","date":"2019-01-28","objectID":"/posts/systemd-basics/:1:0","series":null,"tags":["Linux","Systemd","Init System"],"title":"é€šè¿‡ systemctl è®¾ç½®è‡ªå®šä¹‰ Service","uri":"/posts/systemd-basics/#å‰è¨€"},{"categories":["tech"],"content":" é…ç½®è¯´æ˜è¦è‡ªå®šä¹‰ä¸€ä¸ªæœåŠ¡ï¼Œéœ€è¦åœ¨ /usr/lib/systemd/system/ ä¸‹æ·»åŠ ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼š\u003csoftware-name\u003e.service å¦‚æœ /usr/lib/systemd/system/ ä¸å­˜åœ¨ï¼Œå¯è€ƒè™‘ä½¿ç”¨ /lib/systemd/system/ æˆ–/etc/systemd/system/ ExecXXX ä¸­çš„å‘½ä»¤ï¼Œå‡å¯ä»¥æ­£å¸¸ä½¿ç”¨è½¬ä¹‰å­—ç¬¦ä»¥åŠç¯å¢ƒå˜é‡æ’å€¼è¯­æ³•ï¼Œæ¯”å¦‚ç”¨ \\ ç»“å°¾è¡¨ç¤ºæ¢è¡Œï¼Œç”¨ $Xxx è·å–ç¯å¢ƒå˜é‡ã€‚ é…ç½®æ–‡ä»¶çš„å†…å®¹è¯´æ˜ï¼š toml [Unit]: æœåŠ¡çš„å¯åŠ¨é¡ºåºä¸ä¾èµ–å…³ç³» Description: å½“å‰æœåŠ¡çš„ç®€å•æè¿° After: å½“å‰æœåŠ¡ï¼ˆ\u003csoftware-name\u003e.serviceï¼‰éœ€è¦åœ¨è¿™äº›æœåŠ¡å¯åŠ¨åï¼Œæ‰å¯åŠ¨ Before: å’Œ After ç›¸åï¼Œå½“å‰æœåŠ¡éœ€è¦åœ¨è¿™äº›æœåŠ¡å¯åŠ¨å‰ï¼Œå…ˆå¯åŠ¨ Wantsï¼šè¡¨ç¤ºå½“å‰æœåŠ¡\"å¼±ä¾èµ–\"äºè¿™äº›æœåŠ¡ã€‚å³å½“å‰æœåŠ¡ä¾èµ–äºå®ƒä»¬ï¼Œä½†æ˜¯æ²¡æœ‰å®ƒä»¬ï¼Œå½“å‰æœåŠ¡ä¹Ÿèƒ½æ­£å¸¸è¿è¡Œã€‚ Requires: è¡¨ç¤º\"å¼ºä¾èµ–\"å…³ç³»ï¼Œå³å¦‚æœè¯¥æœåŠ¡å¯åŠ¨å¤±è´¥æˆ–å¼‚å¸¸é€€å‡ºï¼Œé‚£ä¹ˆå½“å‰æœåŠ¡ä¹Ÿå¿…é¡»é€€å‡ºã€‚ [Service] æœåŠ¡è¿è¡Œå‚æ•°çš„è®¾ç½® Type=forking åå°è¿è¡Œçš„å½¢å¼ PIDFile=/software-name/pid pidæ–‡ä»¶è·¯å¾„ EnvironmentFile=/xxx/prod.env é€šè¿‡æ–‡ä»¶è®¾å®šç¯å¢ƒå˜é‡ï¼Œæ³¨æ„è¿™ä¸œè¥¿ä¸æ”¯æŒç¯å¢ƒå˜é‡çš„æ’å€¼è¯­æ³• ${xxx} WorkingDirectory=/xxx/xxx å·¥ä½œç›®å½• ExecStartPre ä¸ºå¯åŠ¨åšå‡†å¤‡çš„å‘½ä»¤ ExecStart æœåŠ¡çš„å…·ä½“è¿è¡Œå‘½ä»¤ï¼ˆå¯¹é workingdirectory çš„æ–‡ä»¶ï¼Œå¿…é¡»ç”¨ç»å¯¹è·¯å¾„ï¼ ExecReload é‡è½½å‘½ä»¤ï¼Œå¦‚æœç¨‹åºæ”¯æŒ HUP ä¿¡å·çš„è¯ï¼Œé€šå¸¸å°†æ­¤é¡¹è®¾ä¸º `/bin/kill -HUP $MAINPID` ExecStop åœæ­¢å‘½ä»¤ ExecStartPreï¼šå¯åŠ¨æœåŠ¡ä¹‹å‰æ‰§è¡Œçš„å‘½ä»¤ ExecStartPostï¼šå¯åŠ¨æœåŠ¡ä¹‹åæ‰§è¡Œçš„å‘½ä»¤ ExecStopPostï¼šåœæ­¢æœåŠ¡ä¹‹åæ‰§è¡Œçš„å‘½ä»¤ RuntimeDirectory=xxxx RuntimeDirectoryMode=0775 PrivateTmp=True è¡¨ç¤ºç»™æœåŠ¡åˆ†é…ç‹¬ç«‹çš„ä¸´æ—¶ç©ºé—´ RestartSec è‡ªåŠ¨é‡å¯å½“å‰æœåŠ¡é—´éš”çš„ç§’æ•° Restart å®šä¹‰ä½•ç§æƒ…å†µ Systemd ä¼šè‡ªåŠ¨é‡å¯å½“å‰æœåŠ¡ï¼Œå¯èƒ½çš„å€¼åŒ…æ‹¬alwaysï¼ˆæ€»æ˜¯é‡å¯ï¼‰ã€on-successã€on-failure ç­‰ # ç¨‹åºçš„ user å’Œ group User=ryan Group=ryan æ³¨æ„ï¼šå¯åŠ¨ã€é‡è½½ã€åœæ­¢å‘½ä»¤å…¨éƒ¨è¦æ±‚ä½¿ç”¨ç»å¯¹è·¯å¾„ [Install] å®šä¹‰å¦‚ä½•å®‰è£…è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œå³æ€æ ·åšåˆ°å¼€æœºå¯åŠ¨ã€‚ # Targetçš„å«ä¹‰æ˜¯æœåŠ¡ç»„ï¼Œè¡¨ç¤ºä¸€ç»„æœåŠ¡ã€‚ WantedBy=multi-user.target æ³¨æ„ï¼Œservice æ–‡ä»¶ä¸æ”¯æŒè¡Œå†…æ³¨é‡Šï¼ï¼ï¼æ³¨é‡Šå¿…é¡»å•ç‹¬ä¸€è¡Œ ","date":"2019-01-28","objectID":"/posts/systemd-basics/:1:1","series":null,"tags":["Linux","Systemd","Init System"],"title":"é€šè¿‡ systemctl è®¾ç½®è‡ªå®šä¹‰ Service","uri":"/posts/systemd-basics/#é…ç½®è¯´æ˜"},{"categories":["tech"],"content":" Type è¯´æ˜Type æ„Ÿè§‰æ˜¯æ•´ä¸ªé…ç½®æ–‡ä»¶é‡Œé¢æœ€ä¸å¥½ç†è§£çš„ä¸€ä¸ªé…ç½®é¡¹ï¼Œå®ƒçš„å®é™…ä½œç”¨å°±æ˜¯ï¼šå‘Šè¯‰ systemd ä½ çš„ Service æ˜¯å¦‚ä½•å¯åŠ¨çš„ Type=simpleï¼ˆé»˜è®¤å€¼ï¼‰ï¼šExecStart å‘½ä»¤ä¼šç«‹å³å¯åŠ¨ä½ çš„æœåŠ¡ï¼Œå¹¶ä¸”æŒç»­è¿è¡Œï¼Œä¸ä¼šé€€å‡ºã€‚ Type=forkingï¼šExecStart å‘½ä»¤ä¼š fork å‡ºä½ çš„æœåŠ¡ä¸»è¿›ç¨‹ï¼Œç„¶åæ­£å¸¸é€€å‡ºã€‚ä½¿ç”¨æ­¤ Type æ—¶åº”åŒæ—¶æŒ‡å®š PIDFile=ï¼Œsystemd ä½¿ç”¨å®ƒè·Ÿè¸ªæœåŠ¡çš„ä¸»è¿›ç¨‹ã€‚ Type=oneshotï¼šExecStart å‘½ä»¤ã€‚å¯èƒ½éœ€è¦åŒæ—¶è®¾ç½® RemainAfterExit=yes ä½¿å¾— systemd åœ¨æœåŠ¡è¿›ç¨‹é€€å‡ºä¹‹åä»ç„¶è®¤ä¸ºæœåŠ¡å¤„äºæ¿€æ´»çŠ¶æ€ Type=notifyï¼šä¸ Type=simple ç›¸åŒï¼Œä½†çº¦å®šæœåŠ¡ä¼šåœ¨å°±ç»ªåå‘ systemd å‘é€ä¸€ä¸ªä¿¡å·ï¼Œä»¥è¡¨æ˜è‡ªå·±å·²ç»å¯åŠ¨æˆåŠŸã€‚ ç»†èŠ‚ï¼šsystemd ä¼šåˆ›å»ºä¸€ä¸ª unix socketï¼Œå¹¶å°†åœ°å€é€šè¿‡ $NOTIFY_SOCKET ç¯å¢ƒå˜é‡æä¾›ç»™æœåŠ¡ï¼ŒåŒæ—¶ç›‘å¬è¯¥ socket ä¸Šçš„ä¿¡å·ã€‚æœåŠ¡å¯ä»¥ä½¿ç”¨ systemd æä¾›çš„ C å‡½æ•° sd_notify() æˆ–è€…å‘½ä»¤è¡Œå·¥å…· systemd-notify å‘é€ä¿¡å·ç»™ systemd. å› ä¸ºå¤šäº†ä¸ª notify ä¿¡å·ï¼Œæ‰€ä»¥è¿™ä¸€ Type è¦æ¯” simple æ›´ç²¾ç¡®ä¸€ç‚¹ã€‚ä½†æ˜¯éœ€è¦æœåŠ¡çš„é…åˆï¼Œ Type=dbusï¼šè‹¥ä»¥æ­¤æ–¹å¼å¯åŠ¨ï¼Œå½“æŒ‡å®šçš„ BusName å‡ºç°åœ¨ DBus ç³»ç»Ÿæ€»çº¿ä¸Šæ—¶ï¼Œsystemd è®¤ä¸ºæœåŠ¡å°±ç»ªã€‚ Type=idleï¼šæ²¡ææ˜ç™½ï¼Œä¸è¿‡é€šå¸¸ä¹Ÿç”¨ä¸åˆ°ã€‚ æ›´è¯¦ç»†çš„è§Systemd å…¥é—¨æ•™ç¨‹ï¼šå‘½ä»¤ç¯‡ - é˜®ä¸€å³°ã€‚ ","date":"2019-01-28","objectID":"/posts/systemd-basics/:1:2","series":null,"tags":["Linux","Systemd","Init System"],"title":"é€šè¿‡ systemctl è®¾ç½®è‡ªå®šä¹‰ Service","uri":"/posts/systemd-basics/#type-è¯´æ˜"},{"categories":["tech"],"content":" é…ç½®ä¸¾ä¾‹æ¯”å¦‚ shadsocks Server Serviceï¼Œçš„é…ç½®æ–‡ä»¶ ss-server.service çš„å†…å®¹ä¸ºï¼š toml [Unit] Description=shadsocks server After=network.target auditd.service [Service] Type=forking ExecStart=/usr/local/bin/ssserver -c /etc/shadsocks.json --user shadsocks --pid-file /var/run/shadsocks.pid -d start ExecStop=/usr/local/bin/ssserver -c /etc/shadsocks.json --user shadsocks --pid-file /var/run/shadsocks.pid -d stop PIDFile=/var/run/shadsocks.pid Restart=always RestartSec=4 [Install] WantedBy=multi-user.target è€Œ enginx çš„é…ç½®æ–‡ä»¶ nginx.service çš„å†…å®¹æ˜¯ï¼š toml [Unit] Description=The NGINX HTTP and reverse proxy server After=syslog.target network-online.target remote-fs.target nss-lookup.target Wants=network-online.target [Service] Type=forking PIDFile=/run/nginx.pid ExecStartPre=/usr/sbin/nginx -t ExecStart=/usr/sbin/nginx ExecReload=/usr/sbin/nginx -s reload ExecStop=/bin/kill -s QUIT $MAINPID PrivateTmp=true [Install] WantedBy=multi-user.target ä¸ºäº†ä½¿ç”¨ç¯å¢ƒå˜é‡æ’å€¼ï¼Œè€Œä½¿ç”¨ sh å¯åŠ¨çš„ etcd æœåŠ¡ï¼Œå®ƒçš„ etcd.service é…ç½®å¦‚ä¸‹: toml [Unit] Description=etcd key-value store Documentation=https://github.com/etcd-io/etcd After=network.target [Service] Type=simple # EnvironmentFile ä¸æ”¯æŒä½¿ç”¨ ${xxx} å˜é‡æ’å€¼ï¼Œè¿™é‡Œä¸é€‚åˆä½¿ç”¨ # EnvironmentFile=/data/etcd.env # -a è¡¨ç¤ºä¼ é€’ç¯å¢ƒå˜é‡ ExecStart=/bin/bash -ac '. /data/etcd.env; /data/bin/etcd' Restart=always RestartSec=5s LimitNOFILE=40000 [Install] WantedBy=multi-user.target å¦‚æœä½ ä¸éœ€è¦åœ¨ /data/etcd.env ä¸­ä½¿ç”¨ç¯å¢ƒå˜é‡çš„æ’å€¼è¯­æ³•ï¼Œé‚£å¯ä»¥è¿™æ ·å†™: toml [Unit] Description=etcd key-value store Documentation=https://github.com/etcd-io/etcd After=network.target [Service] Type=notify EnvironmentFile=/data/etcd.env # ExecXXX çš„å‘½ä»¤ä¸­æ˜¯å¯ä»¥ä½¿ç”¨ ${Xxx} æ’å€¼è¯­æ³•çš„ ExecStart=/data/bin/etcd \\ --initial-advertise-peer-urls http://${THIS_IP}:2380 \\ --listen-peer-urls http://${THIS_IP}:2380 \\ --advertise-client-urls http://${THIS_IP}:2379 \\ --listen-client-urls http://${THIS_IP}:2379 \\ --initial-cluster \"${NAME_1}=http://${HOST_1}:2380,${NAME_2}=http://${HOST_2}:2380,${NAME_3}=http://${HOST_3}:2380\" Restart=always RestartSec=5s LimitNOFILE=40000 [Install] WantedBy=multi-user.target ","date":"2019-01-28","objectID":"/posts/systemd-basics/:1:3","series":null,"tags":["Linux","Systemd","Init System"],"title":"é€šè¿‡ systemctl è®¾ç½®è‡ªå®šä¹‰ Service","uri":"/posts/systemd-basics/#é…ç½®ä¸¾ä¾‹"},{"categories":["tech"],"content":" æœåŠ¡çš„å¯åŠ¨ã€å…³é—­ text systemctl enable ss-server.service # å¯ç”¨æœåŠ¡ï¼Œå³å¼€æœºè‡ªåŠ¨å¯åŠ¨ systemctl disable ss-server.service # å–æ¶ˆæœåŠ¡ï¼Œå–æ¶ˆå¼€æœºå¯åŠ¨ systemctl start ss-server.service # å¯åŠ¨æœåŠ¡ systemctl stop ss-server.service # åœæ­¢æœåŠ¡ systemctl restart ss-server.service # é‡å¯æœåŠ¡(stop + start) systemctl reload ss-server.service # æœåŠ¡ä¸ stopï¼Œç›´æ¥åŠ è½½é…ç½®æ›´æ–°ç­‰ï¼ˆå¯¹åº” ExecReloadï¼‰ # æ£€æŸ¥çŠ¶æ€ systemctl status ss-server.service -l systemctl list-units --type=service # æŸ¥çœ‹æ‰€æœ‰æœåŠ¡ ","date":"2019-01-28","objectID":"/posts/systemd-basics/:1:4","series":null,"tags":["Linux","Systemd","Init System"],"title":"é€šè¿‡ systemctl è®¾ç½®è‡ªå®šä¹‰ Service","uri":"/posts/systemd-basics/#æœåŠ¡çš„å¯åŠ¨å…³é—­"},{"categories":["tech"],"content":" å‚è€ƒ Systemd å…¥é—¨æ•™ç¨‹ï¼šå‘½ä»¤ç¯‡ - é˜®ä¸€å³° systemd.exec ä¸­æ–‡æ‰‹å†Œ ","date":"2019-01-28","objectID":"/posts/systemd-basics/:1:5","series":null,"tags":["Linux","Systemd","Init System"],"title":"é€šè¿‡ systemctl è®¾ç½®è‡ªå®šä¹‰ Service","uri":"/posts/systemd-basics/#å‚è€ƒ"},{"categories":["tech"],"content":" ä¸ªäººç¬”è®°ï¼Œå¦‚æœ‰é”™è¯¯çƒ¦è¯·æŒ‡æ­£ã€‚ SQLAlchemy æ˜¯ä¸€ä¸ªç”¨ Python å®ç°çš„ ORM ï¼ˆObject Relational Mappingï¼‰æ¡†æ¶ï¼Œå®ƒç”±å¤šä¸ªç»„ä»¶æ„æˆï¼Œè¿™äº›ç»„ä»¶å¯ä»¥å•ç‹¬ä½¿ç”¨ï¼Œä¹Ÿèƒ½ç‹¬ç«‹ä½¿ç”¨ã€‚å®ƒçš„ç»„ä»¶å±‚æ¬¡ç»“æ„å¦‚ä¸‹ï¼š SQLAlchemy å±‚æ¬¡ç»“æ„ å…¶ä¸­æœ€å¸¸ç”¨çš„ç»„ä»¶ï¼Œåº”è¯¥æ˜¯ ORM å’Œ SQL è¡¨è¾¾å¼è¯­è¨€ï¼Œè¿™ä¸¤è€…æ—¢å¯ä»¥ç‹¬ç«‹ä½¿ç”¨ï¼Œä¹Ÿèƒ½ç»“åˆä½¿ç”¨ã€‚ ORM çš„å¥½å¤„åœ¨äºå®ƒ è‡ªåŠ¨å¤„ç†äº†æ•°æ®åº“å’Œ Python å¯¹è±¡ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œå±è”½äº†ä¸¤å¥—ç³»ç»Ÿä¹‹é—´çš„å·®å¼‚ã€‚ç¨‹åºå‘˜ä¸éœ€è¦å†ç¼–å†™å¤æ‚çš„ SQL è¯­å¥ï¼Œç›´æ¥æ“ä½œ Python å¯¹è±¡å°±è¡Œã€‚ å±è”½äº†å„æ•°æ®åº“ä¹‹é—´çš„å·®å¼‚ï¼Œæ›´æ¢åº•å±‚æ•°æ®åº“ä¸éœ€è¦ä¿®æ”¹ SQL è¯­å¥ï¼Œæ”¹ä¸‹é…ç½®å°±è¡Œã€‚ ä½¿æ•°æ®åº“ç»“æ„æ–‡æ¡£åŒ–ï¼Œmodels å®šä¹‰å¾ˆæ¸…æ™°åœ°æè¿°äº†æ•°æ®åº“çš„ç»“æ„ã€‚ é¿å…äº†ä¸è§„èŒƒã€å†—ä½™ã€é£æ ¼ä¸ç»Ÿä¸€çš„ SQL è¯­å¥ï¼Œå¯ä»¥é¿å…å¾ˆå¤šäººä¸º Bugï¼Œä¹Ÿæ–¹ä¾¿ç»´æŠ¤ã€‚ ä½†æ˜¯ ORM éœ€è¦æ¶ˆè€—é¢å¤–çš„æ€§èƒ½æ¥å¤„ç†å¯¹è±¡å…³ç³»æ˜ å°„ï¼Œæ­¤å¤–ç”¨ ORM åšå¤šè¡¨å…³è”æŸ¥è¯¢æˆ–å¤æ‚ SQL æŸ¥è¯¢æ—¶ï¼Œæ•ˆç‡ä½ä¸‹ã€‚å› æ­¤å®ƒé€‚ç”¨äºåœºæ™¯ä¸å¤ªå¤æ‚ï¼Œæ€§èƒ½è¦æ±‚ä¸å¤ªè‹›åˆ»çš„åœºæ™¯ã€‚ éƒ½è¯´ ORM å­¦ä¹ æˆæœ¬é«˜ï¼Œæˆ‘è‡ªå·±ä¹Ÿæ›´å€¾å‘äºç›´æ¥ä½¿ç”¨ SQL è¯­å¥ï¼ˆæ¯•ç«Ÿæ›´ç†Ÿæ‚‰ï¼‰ï¼Œå› æ­¤è¿™ä¸€ç¯‡ç¬”è®°ä¸æ¶‰åŠ ORM éƒ¨åˆ†ï¼Œåªè®°å½• SQLAlchemy çš„ Engine ä¸ SQL è¡¨è¾¾å¼è¯­è¨€ã€‚ ","date":"2019-01-21","objectID":"/posts/sqlalchemy-notes-1-engine-and-sql-expression-language/:0:0","series":null,"tags":["SQLAlchemy","Python","ORM","åç«¯","æ•°æ®åº“","Database"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šEngine ä¸ SQL è¡¨è¾¾å¼è¯­è¨€","uri":"/posts/sqlalchemy-notes-1-engine-and-sql-expression-language/#"},{"categories":["tech"],"content":" ä¸€ã€ç›´æ¥ä½¿ç”¨ Engine å’Œ Connectionsç¬¬ä¸€æ­¥æ˜¯åˆ›å»ºæ•°æ®åº“å¼•æ“å®ä¾‹ï¼š python from sqlalchemy import create_engine engine = create_engine('sqlite:///:memory:', echo=True, # echo=True è¡¨ç¤ºæ‰“å°å‡ºè‡ªåŠ¨ç”Ÿæˆçš„ SQL è¯­å¥ï¼ˆé€šè¿‡ loggingï¼‰ pool_size=5, # è¿æ¥æ± å®¹é‡ï¼Œé»˜è®¤ä¸º 5ï¼Œç”Ÿäº§ç¯å¢ƒä¸‹å¤ªå°ï¼Œéœ€è¦ä¿®æ”¹ã€‚ # ä¸‹é¢æ˜¯ connection å›æ”¶çš„æ—¶é—´é™åˆ¶ï¼Œé»˜è®¤ -1 ä¸å›æ”¶ pool_recycle=7200) # è¶…è¿‡ 2 å°æ—¶å°±é‡æ–°è¿æ¥ï¼ˆMySQL é»˜è®¤çš„è¿æ¥æœ€å¤§é—²ç½®æ—¶é—´ä¸º 8 å°æ—¶ï¼‰ create_engine æ¥å—çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ•°æ®åº“ URIï¼Œæ ¼å¼ä¸ºdialect+driver://username:password@host:port/databaseï¼Œdialect æ˜¯å…·ä½“çš„æ•°æ®åº“åç§°ï¼Œdriver æ˜¯é©±åŠ¨åç§°ã€‚key-value æ˜¯å¯é€‰çš„å‚æ•°ã€‚ä¸¾ä¾‹ï¼š shell # PostgreSQL postgresql+psycopg2://scott:tiger@localhost/dbtest # MySQL + PyMySQLï¼ˆæˆ–è€…ç”¨æ›´å¿«çš„ mysqlclientï¼‰ mysql+pymysql://scott:tiger@localhost/dbtest # sqlite å†…å­˜æ•°æ®åº“ # æ³¨æ„ sqlite è¦ç”¨ä¸‰ä¸ªæ–œæ ï¼Œè¡¨ç¤ºä¸å­˜åœ¨ hostnameï¼Œsqlite://\u003cnohostname\u003e/\u003cpath\u003e sqlite:///:memory: # sqlite æ–‡ä»¶æ•°æ®åº“ # å››ä¸ªæ–œæ æ˜¯å› ä¸ºæ–‡ä»¶çš„ç»å¯¹è·¯å¾„ä»¥ / å¼€å¤´ï¼š/home/ryan/Codes/Python/dbtest.db sqlite:////home/ryan/Codes/Python/dbtest.db # SQL Server + pyodbc # é¦–é€‰åŸºäº dsn çš„è¿æ¥ï¼Œdsn çš„é…ç½®è¯·æœç´¢hhh mssql+pyodbc://scott:tiger@some_dsn å¦‚æœä½ çš„å¯†ç ä¸­å«æœ‰ â€˜@â€™ ç­‰ç‰¹æ®Šå­—ç¬¦ï¼Œå°±ä¸èƒ½ç›´æ¥æ”¾å…¥ URI ä¸­ï¼Œå¿…é¡»ä½¿ç”¨urllib.parse.quote_plus ç¼–ç ï¼Œç„¶åå†æ’å…¥ URI. å¼•æ“åˆ›å»ºåï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥è·å– connectionï¼Œç„¶åæ‰§è¡Œ SQL è¯­å¥äº†ã€‚è¿™ç§ç”¨æ³•ç›¸å½“äºæŠŠ SQLAlchemy å½“æˆå¸¦ log çš„æ•°æ®åº“è¿æ¥æ± ä½¿ç”¨ï¼š python with engine.connect() as conn: res = conn.execute(\"select username from users\") # æ— å‚ç›´æ¥ä½¿ç”¨ # ä½¿ç”¨é—®å·ä½œå ä½ç¬¦ï¼Œå‰ææ˜¯ä¸‹å±‚çš„ DBAPI æ”¯æŒã€‚æ›´å¥½çš„æ–¹å¼æ˜¯ä½¿ç”¨ text()ï¼Œè¿™ä¸ªåé¢è¯´ conn.execute(\"INSERT INTO table (id, value) VALUES (?, ?)\", 1, \"v1\") # å‚æ•°ä¸éœ€è¦åŒ…è£…æˆå…ƒç»„ # æŸ¥è¯¢è¿”å›çš„æ˜¯ ResultProxy å¯¹è±¡ï¼Œæœ‰å’Œ dbapi ç›¸åŒçš„ fetchone()ã€fetchall()ã€first() ç­‰æ–¹æ³•ï¼Œè¿˜æœ‰ä¸€äº›æ‹“å±•æ–¹æ³• for row in result: print(\"username:\", row['username']) ä½†æ˜¯è¦æ³¨æ„çš„æ˜¯ï¼Œconnection çš„ execute æ˜¯è‡ªåŠ¨æäº¤çš„ï¼ˆautocommitï¼‰ï¼Œè¿™å°±åƒåœ¨ shell é‡Œæ‰“å¼€ä¸€ä¸ªæ•°æ®åº“å®¢æˆ·ç«¯ä¸€æ ·ï¼Œåˆ†å·ç»“å°¾çš„ SQL ä¼šè¢«è‡ªåŠ¨æäº¤ã€‚åªæœ‰åœ¨ BEGIN TRANSACTION å†…éƒ¨ï¼ŒAUTOCOMMIT ä¼šè¢«ä¸´æ—¶è®¾ç½®ä¸º FALSEï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹æ³•å¼€å§‹ä¸€ä¸ªå†…éƒ¨äº‹åŠ¡ï¼š python def transaction_a(connection): trans = connection.begin() # å¼€å¯ä¸€ä¸ª transaction try: # do sthings trans.commit() # è¿™é‡Œéœ€è¦æ‰‹åŠ¨æäº¤ except: trans.rollback() # å‡ºç°å¼‚å¸¸åˆ™ rollback raise # do other things with engine.connect() as conn: transaction_a(conn) ","date":"2019-01-21","objectID":"/posts/sqlalchemy-notes-1-engine-and-sql-expression-language/:1:0","series":null,"tags":["SQLAlchemy","Python","ORM","åç«¯","æ•°æ®åº“","Database"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šEngine ä¸ SQL è¡¨è¾¾å¼è¯­è¨€","uri":"/posts/sqlalchemy-notes-1-engine-and-sql-expression-language/#ä¸€ç›´æ¥ä½¿ç”¨-engine-å’Œ-connections"},{"categories":["tech"],"content":" 1. ä½¿ç”¨ text() æ„å»º SQLç›¸æ¯”ç›´æ¥ä½¿ç”¨ stringï¼Œtext() çš„ä¼˜åŠ¿åœ¨äºå®ƒï¼š æä¾›äº†ç»Ÿä¸€çš„å‚æ•°ç»‘å®šè¯­æ³•ï¼Œä¸å…·ä½“çš„ DBAPI æ— å…³ã€‚ python # 1. å‚æ•°ç»‘å®šè¯­æ³• from sqlalchemy import text result = connection.execute( # ä½¿ç”¨ :key åšå ä½ç¬¦ text('select * from table where id \u003c :id and typeName=:type'), {'id': 2,'type':'USER_TABLE'}) # ç”¨ dict ä¼ å‚æ•°ï¼Œæ›´æ˜“è¯» # 2. å‚æ•°ç±»å‹æŒ‡å®š from sqlalchemy import DateTime date_param=datetime.today()+timedelta(days=-1*10) sql=\"delete from caw_job_alarm_log where alarm_time \u003c :alarm_time_param\" # bindparams æ˜¯ bindparam çš„åˆ—è¡¨ï¼Œbindparam åˆ™æä¾›å‚æ•°çš„ä¸€äº›é¢å¤–ä¿¡æ¯ï¼ˆç±»å‹ã€å€¼ã€é™åˆ¶ç­‰ï¼‰ t=text(sql, bindparams=[bindparam('alarm_time_param', type_=DateTime, required=True)]) connection.execute(t, {\"alarm_time_param\": date_param}) å¯ä»¥å¾ˆæ–¹ä¾¿åœ°è½¬æ¢ Result ä¸­åˆ—çš„ç±»å‹ python stmt = text(\"SELECT * FROM table\", # ä½¿ç”¨ typemap æŒ‡å®šå°† id åˆ—æ˜ å°„ä¸º Integer ç±»å‹ï¼Œname æ˜ å°„ä¸º String ç±»å‹ typemap={'id': Integer, 'name': String}, ) result = connection.execute(stmt) # å¯¹å¤šä¸ªæŸ¥è¯¢ç»“æœï¼Œå¯ä»¥ç”¨ for obj in result éå† # ä¹Ÿå¯ç”¨ fetchone() åªè·å–ä¸€ä¸ª ","date":"2019-01-21","objectID":"/posts/sqlalchemy-notes-1-engine-and-sql-expression-language/:1:1","series":null,"tags":["SQLAlchemy","Python","ORM","åç«¯","æ•°æ®åº“","Database"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šEngine ä¸ SQL è¡¨è¾¾å¼è¯­è¨€","uri":"/posts/sqlalchemy-notes-1-engine-and-sql-expression-language/#1-ä½¿ç”¨-text-æ„å»º-sql"},{"categories":["tech"],"content":" äºŒã€SQL è¡¨è¾¾å¼è¯­è¨€ å¤æ‚çš„ SQL æŸ¥è¯¢å¯ä»¥ç›´æ¥ç”¨ raw sql å†™ï¼Œè€Œå¢åˆ æ”¹ä¸€èˆ¬éƒ½æ˜¯å•è¡¨æ“ä½œï¼Œç”¨ SQL è¡¨è¾¾å¼è¯­è¨€æœ€æ–¹ä¾¿ã€‚ SQLAlchemy è¡¨è¾¾å¼è¯­è¨€æ˜¯ä¸€ä¸ªä½¿ç”¨ Python ç»“æ„è¡¨ç¤ºå…³ç³»æ•°æ®åº“ç»“æ„å’Œè¡¨è¾¾å¼çš„ç³»ç»Ÿã€‚ ","date":"2019-01-21","objectID":"/posts/sqlalchemy-notes-1-engine-and-sql-expression-language/:2:0","series":null,"tags":["SQLAlchemy","Python","ORM","åç«¯","æ•°æ®åº“","Database"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šEngine ä¸ SQL è¡¨è¾¾å¼è¯­è¨€","uri":"/posts/sqlalchemy-notes-1-engine-and-sql-expression-language/#äºŒsql-è¡¨è¾¾å¼è¯­è¨€"},{"categories":["tech"],"content":" 1. å®šä¹‰å¹¶åˆ›å»ºè¡¨SQL è¡¨è¾¾å¼è¯­è¨€ä½¿ç”¨ Table æ¥å®šä¹‰è¡¨ï¼Œè€Œè¡¨çš„åˆ—åˆ™ç”¨ Column å®šä¹‰ã€‚Column æ€»æ˜¯å…³è”åˆ°ä¸€ä¸ª Table å¯¹è±¡ä¸Šã€‚ ä¸€ç»„ Table å¯¹è±¡ä»¥åŠå®ƒä»¬çš„å­å¯¹è±¡çš„é›†åˆå°±è¢«ç§°ä½œã€Œæ•°æ®åº“å…ƒæ•°æ®ï¼ˆdatabase metadataï¼‰ã€ã€‚metadata å°±åƒä½ çš„ç½‘é¡µåˆ†ç±»æ”¶è—å¤¹ï¼Œç›¸å…³çš„ Table æ”¾åœ¨ä¸€ä¸ª metadata ä¸­ã€‚ ä¸‹é¢æ˜¯åˆ›å»ºå…ƒæ•°æ®ï¼ˆä¸€ç»„ç›¸å…³è”çš„è¡¨ï¼‰çš„ä¾‹å­ï¼Œï¼š python from sqlalchemy import Table, Column, Integer, String, MetaData, ForeignKey metadata = MetaData() # å…ˆåˆ›å»ºå…ƒæ•°æ®ï¼ˆæ”¶è—å¤¹ï¼‰ users = Table('user', metadata, # åˆ›å»º user è¡¨ï¼Œå¹¶æ”¾åˆ° metadata ä¸­ Column('id', Integer, primary_key=True), Column('name', String), Column('fullname', String) ) addresses = Table('address', metadata, Column('id', Integer, primary_key=True), Column('user_id', None, ForeignKey('user.id')), # å¤–é”®çº¦æŸï¼Œå¼•ç”¨ user è¡¨çš„ id åˆ— Column('email_address', String, nullable=False) ) metadata.create_all(engine) # ä½¿ç”¨ engine åˆ›å»º metadata å†…çš„æ‰€æœ‰ Tablesï¼ˆä¼šæ£€æµ‹è¡¨æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œæ‰€ä»¥å¯ä»¥é‡å¤è°ƒç”¨ï¼‰ è¡¨å®šä¹‰ä¸­çš„çº¦æŸ åº”è¯¥ç»™æ‰€æœ‰çš„çº¦æŸå‘½åï¼Œå³ä¸º name å‚æ•°æŒ‡å®šä¸€ä¸ªä¸å†²çªçš„åˆ—åã€‚è¯¦è§The Importance of Naming Constraints è¡¨è¿˜æœ‰ä¸€ä¸ªå±æ€§ï¼šçº¦æŸæ¡ä»¶ã€‚ä¸‹é¢ä¸€ä¸€è¿›è¡Œè¯´æ˜ã€‚ å¤–é”®çº¦æŸï¼šç”¨äºåœ¨åˆ é™¤æˆ–æ›´æ–°æŸä¸ªå€¼æˆ–è¡Œæ—¶ï¼Œå¯¹ä¸»é”®/å¤–é”®å…³ç³»ä¸­ä¸€ç»„æ•°æ®åˆ—å¼ºåˆ¶è¿›è¡Œçš„æ“ä½œé™åˆ¶ã€‚ ç”¨æ³•ä¸€ï¼šColumn('user_id', None, ForeignKey('user.id'))ï¼Œç›´æ¥åœ¨ Column ä¸­æŒ‡å®šã€‚è¿™ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„æ–¹æ³• ç”¨æ³•äºŒï¼šé€šè¿‡ ForeignKeyConstraint(columns, refcolumns) æ„å»ºçº¦æŸï¼Œä½œä¸ºå‚æ•°ä¼ ç»™Table. python item = Table('item', metadata, # å•†å“ table Column('id', Integer, primary_key=True), Column('name', String(60), nullable=False), Column('invoice_id', Integer, nullable=False), # å‘ç¥¨ idï¼Œæ˜¯å¤–é”® Column('ref_num', Integer, nullable=False), ForeignKeyConstraint(['invoice_id', 'ref_num'], # å½“å‰è¡¨ä¸­çš„å¤–é”®åç§° ['invoice.id', 'invoice.ref_num']) # è¢«å¼•ç”¨çš„å¤–é”®åç§°çš„åºåˆ—ï¼ˆè¢«å¼•ç”¨çš„è¡¨ï¼‰ ) on delete ä¸ on updateï¼šå¤–é”®çº¦æŸçš„ä¸¤ä¸ªçº¦æŸæ¡ä»¶ï¼Œé€šè¿‡ ForeignKey() æˆ–ForeignKeyConstraint() çš„å…³é”®å­—å‚æ•° ondelete/onupdate ä¼ å…¥ã€‚å¯é€‰å€¼æœ‰ï¼š1. é»˜è®¤è¡Œä¸ºNO ACTIONï¼šä»€ä¹ˆéƒ½ä¸åšï¼Œç›´æ¥æŠ¥é”™ã€‚1. CASCADEï¼šåˆ é™¤/æ›´æ–° çˆ¶è¡¨æ•°æ®æ—¶ï¼Œä»è¡¨æ•°æ®ä¼šåŒæ—¶è¢« åˆ é™¤/æ›´æ–°ã€‚ï¼ˆæ— æŠ¥é”™ï¼‰1. RESTRICTï¼šä¸å…è®¸ç›´æ¥ åˆ é™¤/æ›´æ–° çˆ¶è¡¨æ•°æ®ï¼Œç›´æ¥æŠ¥é”™ã€‚ï¼ˆå’Œé»˜è®¤è¡Œä¸ºåŸºæœ¬ä¸€è‡´ï¼‰1. SET NULL or SET DEFAULTï¼šåˆ é™¤/æ›´æ–° çˆ¶è¡¨æ•°æ®æ—¶ï¼Œå°†å¯¹åº”çš„ä»è¡¨æ•°æ®é‡ç½®ä¸º NULL æˆ–è€…é»˜è®¤å€¼ã€‚ å”¯ä¸€æ€§çº¦æŸï¼šUniqueConstraint('col2', 'col3', name='uix_1')ï¼Œä½œä¸ºå‚æ•°ä¼ ç»™ Table. CHECK çº¦æŸï¼šCheckConstraint('col2 \u003e col3 + 5', name='check1')ï¼Œ ä½œä¸ºå‚æ•°ä¼ ç»™Table. ä¸»é”®çº¦æŸï¼šä¸è§£é‡Š æ–¹æ³•ä¸€ï¼šé€šè¿‡ Column('id', Integer, primary_key=True) æŒ‡å®šä¸»é”®ã€‚ï¼ˆå‚æ•°primary_key å¯åœ¨å¤šä¸ª Column ä¸Šä½¿ç”¨ï¼‰ æ–¹æ³•äºŒï¼šä½¿ç”¨ PrimaryKeyConstraint python from sqlalchemy import PrimaryKeyConstraint my_table = Table('mytable', metadata, Column('id', Integer), Column('version_id', Integer), Column('data', String(50)), PrimaryKeyConstraint('id', 'version_id', name='mytable_pk') ) ","date":"2019-01-21","objectID":"/posts/sqlalchemy-notes-1-engine-and-sql-expression-language/:2:1","series":null,"tags":["SQLAlchemy","Python","ORM","åç«¯","æ•°æ®åº“","Database"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šEngine ä¸ SQL è¡¨è¾¾å¼è¯­è¨€","uri":"/posts/sqlalchemy-notes-1-engine-and-sql-expression-language/#1-å®šä¹‰å¹¶åˆ›å»ºè¡¨"},{"categories":["tech"],"content":" 1. å®šä¹‰å¹¶åˆ›å»ºè¡¨SQL è¡¨è¾¾å¼è¯­è¨€ä½¿ç”¨ Table æ¥å®šä¹‰è¡¨ï¼Œè€Œè¡¨çš„åˆ—åˆ™ç”¨ Column å®šä¹‰ã€‚Column æ€»æ˜¯å…³è”åˆ°ä¸€ä¸ª Table å¯¹è±¡ä¸Šã€‚ ä¸€ç»„ Table å¯¹è±¡ä»¥åŠå®ƒä»¬çš„å­å¯¹è±¡çš„é›†åˆå°±è¢«ç§°ä½œã€Œæ•°æ®åº“å…ƒæ•°æ®ï¼ˆdatabase metadataï¼‰ã€ã€‚metadata å°±åƒä½ çš„ç½‘é¡µåˆ†ç±»æ”¶è—å¤¹ï¼Œç›¸å…³çš„ Table æ”¾åœ¨ä¸€ä¸ª metadata ä¸­ã€‚ ä¸‹é¢æ˜¯åˆ›å»ºå…ƒæ•°æ®ï¼ˆä¸€ç»„ç›¸å…³è”çš„è¡¨ï¼‰çš„ä¾‹å­ï¼Œï¼š python from sqlalchemy import Table, Column, Integer, String, MetaData, ForeignKey metadata = MetaData() # å…ˆåˆ›å»ºå…ƒæ•°æ®ï¼ˆæ”¶è—å¤¹ï¼‰ users = Table('user', metadata, # åˆ›å»º user è¡¨ï¼Œå¹¶æ”¾åˆ° metadata ä¸­ Column('id', Integer, primary_key=True), Column('name', String), Column('fullname', String) ) addresses = Table('address', metadata, Column('id', Integer, primary_key=True), Column('user_id', None, ForeignKey('user.id')), # å¤–é”®çº¦æŸï¼Œå¼•ç”¨ user è¡¨çš„ id åˆ— Column('email_address', String, nullable=False) ) metadata.create_all(engine) # ä½¿ç”¨ engine åˆ›å»º metadata å†…çš„æ‰€æœ‰ Tablesï¼ˆä¼šæ£€æµ‹è¡¨æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œæ‰€ä»¥å¯ä»¥é‡å¤è°ƒç”¨ï¼‰ è¡¨å®šä¹‰ä¸­çš„çº¦æŸ åº”è¯¥ç»™æ‰€æœ‰çš„çº¦æŸå‘½åï¼Œå³ä¸º name å‚æ•°æŒ‡å®šä¸€ä¸ªä¸å†²çªçš„åˆ—åã€‚è¯¦è§The Importance of Naming Constraints è¡¨è¿˜æœ‰ä¸€ä¸ªå±æ€§ï¼šçº¦æŸæ¡ä»¶ã€‚ä¸‹é¢ä¸€ä¸€è¿›è¡Œè¯´æ˜ã€‚ å¤–é”®çº¦æŸï¼šç”¨äºåœ¨åˆ é™¤æˆ–æ›´æ–°æŸä¸ªå€¼æˆ–è¡Œæ—¶ï¼Œå¯¹ä¸»é”®/å¤–é”®å…³ç³»ä¸­ä¸€ç»„æ•°æ®åˆ—å¼ºåˆ¶è¿›è¡Œçš„æ“ä½œé™åˆ¶ã€‚ ç”¨æ³•ä¸€ï¼šColumn('user_id', None, ForeignKey('user.id'))ï¼Œç›´æ¥åœ¨ Column ä¸­æŒ‡å®šã€‚è¿™ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„æ–¹æ³• ç”¨æ³•äºŒï¼šé€šè¿‡ ForeignKeyConstraint(columns, refcolumns) æ„å»ºçº¦æŸï¼Œä½œä¸ºå‚æ•°ä¼ ç»™Table. python item = Table('item', metadata, # å•†å“ table Column('id', Integer, primary_key=True), Column('name', String(60), nullable=False), Column('invoice_id', Integer, nullable=False), # å‘ç¥¨ idï¼Œæ˜¯å¤–é”® Column('ref_num', Integer, nullable=False), ForeignKeyConstraint(['invoice_id', 'ref_num'], # å½“å‰è¡¨ä¸­çš„å¤–é”®åç§° ['invoice.id', 'invoice.ref_num']) # è¢«å¼•ç”¨çš„å¤–é”®åç§°çš„åºåˆ—ï¼ˆè¢«å¼•ç”¨çš„è¡¨ï¼‰ ) on delete ä¸ on updateï¼šå¤–é”®çº¦æŸçš„ä¸¤ä¸ªçº¦æŸæ¡ä»¶ï¼Œé€šè¿‡ ForeignKey() æˆ–ForeignKeyConstraint() çš„å…³é”®å­—å‚æ•° ondelete/onupdate ä¼ å…¥ã€‚å¯é€‰å€¼æœ‰ï¼š1. é»˜è®¤è¡Œä¸ºNO ACTIONï¼šä»€ä¹ˆéƒ½ä¸åšï¼Œç›´æ¥æŠ¥é”™ã€‚1. CASCADEï¼šåˆ é™¤/æ›´æ–° çˆ¶è¡¨æ•°æ®æ—¶ï¼Œä»è¡¨æ•°æ®ä¼šåŒæ—¶è¢« åˆ é™¤/æ›´æ–°ã€‚ï¼ˆæ— æŠ¥é”™ï¼‰1. RESTRICTï¼šä¸å…è®¸ç›´æ¥ åˆ é™¤/æ›´æ–° çˆ¶è¡¨æ•°æ®ï¼Œç›´æ¥æŠ¥é”™ã€‚ï¼ˆå’Œé»˜è®¤è¡Œä¸ºåŸºæœ¬ä¸€è‡´ï¼‰1. SET NULL or SET DEFAULTï¼šåˆ é™¤/æ›´æ–° çˆ¶è¡¨æ•°æ®æ—¶ï¼Œå°†å¯¹åº”çš„ä»è¡¨æ•°æ®é‡ç½®ä¸º NULL æˆ–è€…é»˜è®¤å€¼ã€‚ å”¯ä¸€æ€§çº¦æŸï¼šUniqueConstraint('col2', 'col3', name='uix_1')ï¼Œä½œä¸ºå‚æ•°ä¼ ç»™ Table. CHECK çº¦æŸï¼šCheckConstraint('col2 \u003e col3 + 5', name='check1')ï¼Œ ä½œä¸ºå‚æ•°ä¼ ç»™Table. ä¸»é”®çº¦æŸï¼šä¸è§£é‡Š æ–¹æ³•ä¸€ï¼šé€šè¿‡ Column('id', Integer, primary_key=True) æŒ‡å®šä¸»é”®ã€‚ï¼ˆå‚æ•°primary_key å¯åœ¨å¤šä¸ª Column ä¸Šä½¿ç”¨ï¼‰ æ–¹æ³•äºŒï¼šä½¿ç”¨ PrimaryKeyConstraint python from sqlalchemy import PrimaryKeyConstraint my_table = Table('mytable', metadata, Column('id', Integer), Column('version_id', Integer), Column('data', String(50)), PrimaryKeyConstraint('id', 'version_id', name='mytable_pk') ) ","date":"2019-01-21","objectID":"/posts/sqlalchemy-notes-1-engine-and-sql-expression-language/:2:1","series":null,"tags":["SQLAlchemy","Python","ORM","åç«¯","æ•°æ®åº“","Database"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šEngine ä¸ SQL è¡¨è¾¾å¼è¯­è¨€","uri":"/posts/sqlalchemy-notes-1-engine-and-sql-expression-language/#è¡¨å®šä¹‰ä¸­çš„çº¦æŸ"},{"categories":["tech"],"content":" 2. å¢åˆ æ”¹æŸ¥è¯­å¥ å¢: python # æ–¹æ³•ä¸€ï¼Œä½¿ç”¨ values ä¼ å‚ ins = users.insert().values(name=\"Jack\", fullname=\"Jack Jones\") # å¯ä»¥é€šè¿‡ str(ins) æŸ¥çœ‹è‡ªåŠ¨ç”Ÿæˆçš„ sql connection.execute(ins) # æ–¹æ³•äºŒï¼Œå‚æ•°ä¼ é€’ç»™ execute() conn.execute(users.insert(), id=2, name='wendy', fullname='Wendy Williams') # æ–¹æ³•ä¸‰ï¼Œæ‰¹é‡ INSERTï¼Œç›¸å½“äº executemany conn.execute(addresses.insert(), [ # æ’å…¥åˆ° addresses è¡¨ {'user_id': 1, 'email_address': 'jack@yahoo.com'}, # ä¼ å…¥ dict åˆ—è¡¨ {'user_id': 1, 'email_address': 'jack@msn.com'}, {'user_id': 2, 'email_address': 'www@www.org'}, {'user_id': 2, 'email_address': 'wendy@aol.com'} ]) # æ­¤å¤–ï¼Œé€šè¿‡ä½¿ç”¨ bindparamï¼ŒINSERT è¿˜å¯ä»¥æ‰§è¡Œæ›´å¤æ‚çš„æ“ä½œ stmt = users.insert() \\ .values(name=bindparam('_name') + \" .. name\") # string æ‹¼æ¥ conn.execute(stmt, [ {'id':4, '_name':'name1'}, {'id':5, '_name':'name2'}, {'id':6, '_name':'name3'}, ]) åˆ ï¼š python _table.delete() \\ .where(_table.c.f1==value1) \\ .where(_table.c.f2==value2) # where æŒ‡å®šæ¡ä»¶ æ”¹ï¼š python # ä¸¾ä¾‹ stmt = users.update() \\ .where(users.c.name == 'jack') \\ .values(name='tom') conn.execute(stmt) # æ‰¹é‡æ›´æ–° stmt = users.update() \\ .where(users.c.name == bindparam('oldname')) \\ .values(name=bindparam('newname')) conn.execute(stmt, [ {'oldname':'jack', 'newname':'ed'}, {'oldname':'wendy', 'newname':'mary'}, {'oldname':'jim', 'newname':'jake'}, ]) å¯ä»¥çœ‹åˆ°ï¼Œæ‰€æœ‰çš„æ¡ä»¶éƒ½æ˜¯é€šè¿‡ where æŒ‡å®šçš„ï¼Œå®ƒå’Œåé¢ ORM çš„ filter æ¥å—çš„å‚æ•°æ˜¯ä¸€æ ·çš„ã€‚ ï¼ˆè¯¦ç»†çš„ä¼šåœ¨ç¬¬äºŒç¯‡æ–‡ç« é‡Œè®²ï¼‰ æŸ¥ python from sqlalchemy.sql import select # 1. å­—æ®µé€‰æ‹© s1 = select([users]) # ç›¸å½“äº select * from users s2 = select([users.c.name, users.c.fullname]) # è¿™ä¸ªå°±æ˜¯åª select ä¸€éƒ¨åˆ† # 2. æ·»åŠ è¿‡æ»¤æ¡ä»¶ s3 = select([users]) \\ .where(users.c.id == addresses.c.user_id) res = conn.execute(s1) # å¯ç”¨ for row in res éå†ç»“æœé›†ï¼Œä¹Ÿå¯ç”¨ fetchone() åªè·å–ä¸€è¡Œ æŸ¥è¯¢è¿”å›çš„æ˜¯ ResultProxy å¯¹è±¡ï¼Œè¿™æ˜¯ SQLAlchemy å¯¹ Python DB-API çš„ cursor çš„ä¸€ä¸ªå°è£…ç±»ï¼Œè¦ä»ä¸­è·å–ç»“æœè¡Œï¼Œä¸»è¦æœ‰ä¸‹åˆ—å‡ ä¸ªæ–¹æ³•ï¼š python row1 = result.fetchone() # å¯¹åº” cursor.fetchone() row2 = result.fetchall() # å¯¹åº” cursor.fetchall() row3 = result.fetchmany(size=3) # å¯¹åº” cursor.fetchmany(size=3) row4 = result.first() # è·å–ä¸€è¡Œï¼Œç„¶åç«‹å³è°ƒç”¨ result çš„ close() æ–¹æ³• col = row[mytable.c.mycol] # è·å– mycol è¿™ä¸€åˆ— result.rowcount # ç»“æœé›†çš„è¡Œæ•° åŒæ—¶ï¼Œresult ä¹Ÿå®ç°äº† next protocolï¼Œå› æ­¤å¯ä»¥ç›´æ¥ç”¨ for å¾ªç¯éå† ","date":"2019-01-21","objectID":"/posts/sqlalchemy-notes-1-engine-and-sql-expression-language/:2:2","series":null,"tags":["SQLAlchemy","Python","ORM","åç«¯","æ•°æ®åº“","Database"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šEngine ä¸ SQL è¡¨è¾¾å¼è¯­è¨€","uri":"/posts/sqlalchemy-notes-1-engine-and-sql-expression-language/#2-å¢åˆ æ”¹æŸ¥è¯­å¥"},{"categories":["tech"],"content":" where è¿›é˜¶é€šè¿‡ä½¿ç”¨ or*ã€and*ã€in_ model.join ç­‰æ–¹æ³•ï¼Œwhere å¯ä»¥æ„å»ºæ›´å¤æ‚çš„ SQL è¯­å¥ã€‚ python from sqlalchemy.sql import and_, or_, not_ s = select([(users.c.fullname + \", \" + addresses.c.email_address). label('title')]).\\ where(users.c.id == addresses.c.user_id).\\ where(users.c.name.between('m', 'z')).\\ where( or_( addresses.c.email_address.like('%@aol.com'), addresses.c.email_address.like('%@msn.com') ) ) ","date":"2019-01-21","objectID":"/posts/sqlalchemy-notes-1-engine-and-sql-expression-language/:2:3","series":null,"tags":["SQLAlchemy","Python","ORM","åç«¯","æ•°æ®åº“","Database"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šEngine ä¸ SQL è¡¨è¾¾å¼è¯­è¨€","uri":"/posts/sqlalchemy-notes-1-engine-and-sql-expression-language/#where-è¿›é˜¶"},{"categories":["tech"],"content":" é“¾æ¥ ä½¿ç”¨ Engines å’Œ Connections SQL è¡¨è¾¾å¼è¯­è¨€å…¥é—¨ SQLAlchemy - å®šä¹‰çº¦æŸ SQLAlchemyä¸ªäººå­¦ä¹ ç¬”è®°å®Œæ•´æ±‡æ€» hackersandslackers/sqlalchemy-tutorial ","date":"2019-01-21","objectID":"/posts/sqlalchemy-notes-1-engine-and-sql-expression-language/:3:0","series":null,"tags":["SQLAlchemy","Python","ORM","åç«¯","æ•°æ®åº“","Database"],"title":"SQLAlchemy å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šEngine ä¸ SQL è¡¨è¾¾å¼è¯­è¨€","uri":"/posts/sqlalchemy-notes-1-engine-and-sql-expression-language/#é“¾æ¥"},{"categories":["tech"],"content":" ä¸ªäººç¬”è®°ä¸ä¿è¯æ­£ç¡®ã€‚ æ•°æ®ç±»å‹æ˜¯é™åˆ¶æˆ‘ä»¬å¯ä»¥åœ¨è¡¨é‡Œå­˜å‚¨ä»€ä¹ˆæ•°æ®çš„ä¸€ç§æ–¹æ³•ã€‚ä¸è¿‡ï¼Œå¯¹äºè®¸å¤šåº”ç”¨æ¥è¯´ï¼Œ è¿™ç§é™åˆ¶å®åœ¨æ˜¯å¤ªç²—ç³™äº†ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªåŒ…å«äº§å“ä»·æ ¼çš„å­—æ®µåº”è¯¥åªæ¥å—æ­£æ•°ã€‚ ä½†æ˜¯æ²¡æœ‰å“ªç§æ ‡å‡†æ•°æ®ç±»å‹åªæ¥å—æ­£æ•°ã€‚ å¦å¤–ä¸€ä¸ªé—®é¢˜æ˜¯ä½ å¯èƒ½éœ€è¦æ ¹æ®å…¶å®ƒå­—æ®µæˆ–è€…å…¶å®ƒè¡Œçš„æ•°æ®æ¥çº¦æŸå­—æ®µæ•°æ®ã€‚æ¯”å¦‚ï¼Œ åœ¨ä¸€ä¸ªåŒ…å«äº§å“ä¿¡æ¯çš„è¡¨ä¸­ï¼Œæ¯ä¸ªäº§å“ç¼–å·éƒ½åº”è¯¥åªæœ‰ä¸€è¡Œã€‚ å¯¹äºè¿™äº›é—®é¢˜ï¼ŒSQL å…è®¸ä½ åœ¨å­—æ®µå’Œè¡¨ä¸Šå®šä¹‰çº¦æŸã€‚çº¦æŸå…è®¸ä½ å¯¹æ•°æ®æ–½åŠ ä»»æ„æ§åˆ¶ã€‚ å¦‚æœç”¨æˆ·ä¼å›¾åœ¨å­—æ®µé‡Œå­˜å‚¨è¿åçº¦æŸçš„æ•°æ®ï¼Œé‚£ä¹ˆå°±ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚ è¿™ç§æƒ…å†µåŒæ—¶ä¹Ÿé€‚ç”¨äºæ•°å€¼æ¥è‡ªé»˜è®¤å€¼çš„æƒ…å†µã€‚ ","date":"2019-01-20","objectID":"/posts/sql-basics-3-restrict/:0:0","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸‰ï¼‰çº¦æŸ","uri":"/posts/sql-basics-3-restrict/#"},{"categories":["tech"],"content":" 1. å¤–é”® FOREIGN KEYå¤–é”®çº¦æŸå£°æ˜ä¸€ä¸ªå­—æ®µ(æˆ–è€…ä¸€ç»„å­—æ®µ)çš„æ•°å€¼å¿…é¡»åŒ¹é…å¦å¤–ä¸€ä¸ªè¡¨ä¸­å‡ºç°çš„æ•°å€¼ã€‚åˆ›å»ºå¤–é”®çº¦æŸçš„å‰ææ˜¯ï¼Œè¯¥å¤–é”®æ‰€åœ¨çš„è¡¨å·²ç»å­˜åœ¨ï¼Œå¹¶ä¸”å¤–é”®å¿…é¡»æ˜¯ UNIQUE çš„ã€‚ï¼ˆä¸»é”®é»˜è®¤ UNIQUE ä¸” NOT NULLï¼‰ sql CREATE TABLE \u003cè¡¨å\u003e ( \u003cå­—æ®µå\u003e \u003cç±»å‹\u003e PRIMARY KEY, \u003cå­—æ®µå\u003e \u003cç±»å‹\u003e REFERENCES \u003cå¤–é”®æ‰€åœ¨çš„è¡¨å\u003e (\u003cå­—æ®µå\u003e), -- è¿™åˆ›å»ºäº†ä¸€ä¸ªå¤–é”® ... ); è¿˜æœ‰å¦ä¸€ç§è¯­æ³•ï¼Œå®ƒæ”¯æŒä»¥å¤šä¸ªå­—æ®µä¸ºå¤–é”®ï¼ˆå­—æ®µçº¦æŸä¹Ÿå¯ä»¥å†™æˆè¡¨çº¦æŸï¼Œä¹Ÿå°±æ˜¯æ”¾åœ¨ä¸€ä¸ªç‹¬ç«‹çš„è¡Œä¸­ã€‚è€Œåè¿‡æ¥å¾ˆå¯èƒ½ä¸è¡Œï¼‰ï¼š text CREATE TABLE \u003cè¡¨å\u003e ( \u003cå­—æ®µå1\u003e \u003cç±»å‹\u003e PRIMARY KEY, \u003cå­—æ®µå2\u003e \u003cç±»å‹\u003e \u003cå­—æ®µå3\u003e \u003cç±»å‹\u003e ... FOREIGN KEY (\u003cå­—æ®µå2\u003e, \u003cå­—æ®µå3\u003e) REFERENCES \u003cå¤–é”®æ‰€åœ¨çš„è¡¨å\u003e (\u003cå­—æ®µå4\u003e, \u003cå­—æ®µå5\u003e) ); ä¸€ä¸ªè¡¨ä¹Ÿå¯ä»¥åŒ…å«å¤šä¸ªå¤–é”®çº¦æŸã€‚è¿™ä¸ªç‰¹æ€§ç”¨äºå®ç°è¡¨ä¹‹é—´çš„å¤šå¯¹å¤šå…³ç³»ã€‚ æ¯”å¦‚ä½ æœ‰å…³äºäº§å“å’Œè®¢å•çš„è¡¨ï¼Œä½†ç°åœ¨ä½ æƒ³å…è®¸ä¸€ä¸ªè®¢å•å¯ä»¥åŒ…å«å¤šç§äº§å“ (ä¸Šé¢é‚£ä¸ªç»“æ„æ˜¯ä¸å…è®¸è¿™ä¹ˆåšçš„)ï¼Œä½ å¯ä»¥ä½¿ç”¨è¿™æ ·çš„ç»“æ„ï¼š sql CREATE TABLE products ( product_no integer PRIMARY KEY, name text, price numeric ); CREATE TABLE orders ( order_id integer PRIMARY KEY, shipping_address text, ... ); CREATE TABLE order_items ( product_no integer REFERENCES products, order_id integer REFERENCES orders, quantity integer, PRIMARY KEY (product_no, order_id) ); å¤–é”®èƒ½é€šè¿‡ ALTER è¯­å¥æ·»åŠ æˆ–åˆ é™¤ ","date":"2019-01-20","objectID":"/posts/sql-basics-3-restrict/:0:1","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸‰ï¼‰çº¦æŸ","uri":"/posts/sql-basics-3-restrict/#1-å¤–é”®-foreign-key"},{"categories":["tech"],"content":" 2. çº§è”æ“ä½œ ON DELETE ä¸ ON UPDATEä¸Šé¢è¯´è¿‡ï¼šå¤–é”®çº¦æŸå£°æ˜ä¸€ä¸ªå­—æ®µ(æˆ–è€…ä¸€ç»„å­—æ®µ)çš„æ•°å€¼å¿…é¡»åŒ¹é…å¦å¤–ä¸€ä¸ªè¡¨ä¸­å‡ºç°çš„æ•°å€¼ã€‚ ä½†æ˜¯ä»¥ 1. ä¸­æœ€åä¸€ä¸ª sql ä¸ºä¾‹ï¼Œå¦‚æœä¸€ä¸ªè®¢å•ï¼ˆorderï¼‰åœ¨åˆ›å»ºä¹‹åï¼Œè¯¥è®¢å•åŒ…å«çš„æŸä¸ªäº§å“ ï¼ˆproductï¼‰è¢«åˆ é™¤äº†ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ è¿™ä¸ªä¾‹å­ä¸­ï¼Œè®¢å•åŒ…å«çš„äº§å“é€šè¿‡å¤–é”®è¢«è®°å½•åœ¨ order_items è¡¨ä¸­ã€‚ç°åœ¨å¦‚æœä½ è¦åˆ é™¤ product ä¸­æŸä¸ªè¢« order_items å¼•ç”¨äº†çš„è¡Œï¼Œé»˜è®¤æƒ…å†µä¸º NO ACTIONï¼Œå°±æ˜¯ç›´æ¥æŠ¥é”™ã€‚ è¿™ä¸ªè¡Œä¸ºä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®šï¼š sql CREATE TABLE products ( product_no integer PRIMARY KEY, name text, price numeric ); CREATE TABLE orders ( order_id integer PRIMARY KEY, shipping_address text, ... ); CREATE TABLE order_items ( product_no integer REFERENCES products ON DELETE RESTRICT, -- é™åˆ¶ï¼Œä¹Ÿå°±æ˜¯ç¦æ­¢åˆ é™¤è¢«å®ƒå¼•ç”¨çš„è¡Œ order_id integer REFERENCES orders ON DELETE CASCADE, -- çº§è”ï¼Œåœ¨åˆ é™¤è¢«å®ƒå¼•ç”¨çš„è¡Œçš„æ—¶å€™ï¼Œè¿™ä¸€è¡Œæœ¬èº«ä¹Ÿä¼šè¢«è‡ªåŠ¨åˆ é™¤æ‰ quantity integer, PRIMARY KEY (product_no, order_id) ); é™¤äº† RESTRICT å’Œ CASCADE å¤–ï¼Œåœ¨å¤–é”®ä¸Šçš„åŠ¨ä½œè¿˜æœ‰ä¸¤ä¸ªé€‰é¡¹ï¼šSET NULL å’Œ SET DEFAULTï¼Œ é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯åœ¨è¢«å¼•ç”¨çš„è¡Œåˆ é™¤åå°†å¤–é”®è®¾ç½®ä¸º NULL æˆ–é»˜è®¤å€¼ã€‚ ON UPDATE ä¸ ON DELETE çš„åŠ¨ä½œæ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯ CASCADE è¡¨ç¤ºåŒæ­¥æ›´æ–°ã€‚ ","date":"2019-01-20","objectID":"/posts/sql-basics-3-restrict/:0:2","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸‰ï¼‰çº¦æŸ","uri":"/posts/sql-basics-3-restrict/#2-çº§è”æ“ä½œ-on-delete-ä¸-on-update"},{"categories":["tech"],"content":" 3. CHECK çº¦æŸ sql CREATE TABLE products ( product_no integer, name text, price numeric CHECK (price \u003e 0) ); ä½ è¿˜å¯ä»¥ç»™è¿™ä¸ªçº¦æŸå–ä¸€ä¸ªç‹¬ç«‹çš„åå­—ã€‚è¿™æ ·å°±å¯ä»¥ä»¤é”™è¯¯æ¶ˆæ¯æ›´æ¸…æ™°ï¼Œ å¹¶ä¸”åœ¨ä½ éœ€è¦ä¿®æ”¹å®ƒçš„æ—¶å€™å¼•ç”¨è¿™ä¸ªåå­—ã€‚è¯­æ³•æ˜¯ï¼š sql CREATE TABLE products ( product_no integer, name text, price numeric CONSTRAINT positive_price CHECK (price \u003e 0) ); ç¨å¾®å¤æ‚ä¸€ç‚¹çš„ä¾‹å­ï¼š sql CREATE TABLE products ( product_no integer, name text, price numeric CHECK (price \u003e 0), discounted_price numeric, CHECK (discounted_price \u003e 0 AND price \u003e discounted_price) ); åŒæ ·çš„ï¼Œå¯ä»¥ä¸º CHECK å‘½åï¼Œä»¤é”™è¯¯ä¿¡æ¯æ›´æ¸…æ™°ï¼š sql CREATE TABLE products ( product_no integer, name text, price numeric, CHECK (price \u003e 0), discounted_price numeric, CHECK (discounted_price \u003e 0), CONSTRAINT valid_discount CHECK (price \u003e discounted_price) ); è¦æ³¨æ„çš„æ˜¯ï¼Œå½“çº¦æŸè¡¨è¾¾å¼è®¡ç®—ç»“æœä¸ºçœŸæˆ– NULL çš„æ—¶å€™ï¼Œæ£€æŸ¥çº¦æŸä¼šè¢«è®¤ä¸ºæ˜¯æ»¡è¶³æ¡ä»¶çš„ã€‚ å› ä¸ºå¤§å¤šæ•°è¡¨è¾¾å¼åœ¨å«æœ‰ NULL æ“ä½œæ•°çš„æ—¶å€™ç»“æœéƒ½æ˜¯ NULL ï¼Œæ‰€ä»¥è¿™äº›çº¦æŸä¸èƒ½é˜»æ­¢å­—æ®µå€¼ä¸º NULL ã€‚è¦æ’é™¤æ‰ NULLï¼Œåªèƒ½ä½¿ç”¨ NOT NULL çº¦æŸã€‚ï¼ˆæ‰€ä»¥å°±è¯´ NULL æ˜¯ä¸‡æ¶ä¹‹æºhhhï¼‰ ","date":"2019-01-20","objectID":"/posts/sql-basics-3-restrict/:0:3","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸‰ï¼‰çº¦æŸ","uri":"/posts/sql-basics-3-restrict/#3-check-çº¦æŸ"},{"categories":["tech"],"content":" å‚è€ƒ çº¦æŸ ","date":"2019-01-20","objectID":"/posts/sql-basics-3-restrict/:0:4","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸‰ï¼‰çº¦æŸ","uri":"/posts/sql-basics-3-restrict/#å‚è€ƒ"},{"categories":["tech"],"content":" ä¸ªäººå‘ï¼Œåªä¼šè®°å½•ä¸€äº›éœ€è¦æ³¨æ„çš„ç‚¹ã€‚ ","date":"2019-01-14","objectID":"/posts/julia-notes-1-array/:0:0","series":null,"tags":["JuliaLang"],"title":"Julia å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šæ•°ç»„","uri":"/posts/julia-notes-1-array/#"},{"categories":["tech"],"content":" å‰è¨€å­¦ä¹  Julia å·²ç»æœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œä½†æ˜¯è¿›æ­¥ç¼“æ…¢ã€‚è¿™ä¸€æ–¹é¢æ˜¯æœ€è¿‘ä»£ç å†™å¾—å°‘ï¼Œä¸€æ–¹é¢æ˜¯ Julia å­¦ä¹ èµ„æ–™å°‘ã€ä¸­æ–‡èµ„æ–™æ›´å°‘ï¼Œä½†ä¹Ÿæœ‰æˆ‘æ²¡åšç¬”è®°çš„ç¼˜æ•…å¯¼è‡´å­¦ä¹ æ•ˆç‡ä¸ä½³ã€‚ æœ€è¿‘å‘ç°ä¸€ä»½å¾ˆä¸é”™çš„å…¥é—¨æ•™ç¨‹ï¼šIntroducing_Juliaï¼Œä½†æ˜¯å®ƒçš„ä¸­æ–‡ç‰ˆæœ¬ä»ç„¶æœ‰å¾ˆå¤šä¸è¶³ï¼Œå°±æ‰“ç®—ç»™å®ƒæ·»åŠ ç¿»è¯‘å’Œæ¶¦è‰²ï¼ˆzxj5470 å®Œæˆäº†ç»å¤§éƒ¨åˆ†ç¿»è¯‘å·¥ä½œï¼‰ï¼Œé¡ºä¾¿æ€»ç»“ä¸€ä»½è‡ªå·±çš„ç¬”è®°ã€‚ NOTEï¼šJulia çš„ä¸»è¦è¯­è¨€ç‰¹å¾åœ¨äºç±»å‹ç³»ç»Ÿå’Œå¤šé‡æ´¾å‘ï¼Œè€Œä¸»è¦çš„ç§‘å­¦è®¡ç®—ç‰¹å¾åˆ™æ˜¯çŸ©é˜µå’Œæ•´ä¸ªæ ‡å‡†åº“åŠç”Ÿæ€åœˆã€‚ ","date":"2019-01-14","objectID":"/posts/julia-notes-1-array/:1:0","series":null,"tags":["JuliaLang"],"title":"Julia å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šæ•°ç»„","uri":"/posts/julia-notes-1-array/#å‰è¨€"},{"categories":["tech"],"content":" ä¸€ã€æ•°ç»„åœ¨ Julia ä¸­ï¼Œæ•°ç»„è¢«ç”¨ä½œåˆ—è¡¨ï¼ˆlistsï¼‰ã€å‘é‡ï¼ˆvectorsï¼‰ã€è¡¨ï¼ˆtablesï¼‰å’ŒçŸ©é˜µï¼ˆmatricesï¼‰ã€‚ ","date":"2019-01-14","objectID":"/posts/julia-notes-1-array/:2:0","series":null,"tags":["JuliaLang"],"title":"Julia å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šæ•°ç»„","uri":"/posts/julia-notes-1-array/#ä¸€æ•°ç»„"},{"categories":["tech"],"content":" 1. æ•°ç»„çš„åˆ›å»ºè¿™é‡Œå°¤å…¶éœ€è¦æ³¨æ„çš„æ˜¯æ•°ç»„æ„é€ çš„å‡ ç§æ–¹æ³•ï¼Œä»¥åŠå®ƒä»¬çš„åŒºåˆ«ã€‚ 1.1 ä¸€ç»´æ•°ç»„ï¼ˆvector/listï¼‰ julia julia\u003e v = [1, 2, 3, 4] # é€—å·åˆ†éš”çš„è¯­æ³•ç”¨äºåˆ›å»ºä¸€ç»´æ•°ç»„ 4-element Array{Int64,1}: 1 2 3 4 å‘é‡ï¼ŒæŒ‡åˆ—å‘é‡ï¼ŒJulia ä½¿ç”¨çš„æ˜¯ Fortran Orderï¼Œå„ç§æ“ä½œéƒ½æ˜¯åˆ—ä¼˜å…ˆäºè¡Œçš„ã€‚ï¼ˆå’Œ numpy ç›¸åï¼Œnumpy æ˜¯ C Order çš„ï¼Œè¡Œä¼˜å…ˆäºåˆ—ï¼‰ 1.2. äºŒç»´æ•°ç»„ï¼ˆtable/matrixï¼‰ julia julia\u003e mat = [1 2 3 4] # ç©ºæ ¼åˆ†éš”çš„è¯­æ³•ï¼Œç”¨äºåˆ›å»ºäºŒç»´æ•°ç»„ï¼ˆæˆ–ç§°è¡Œå‘é‡ï¼‰ 1Ã—4 Array{Int64,2}: 1 2 3 4 julia\u003e [1 2; 3 4] # åˆ†å·å’Œæ¢è¡Œç¬¦(\\n)ï¼Œç”¨äºåˆ†éš”æ•°ç»„ä¸­ä¸åŒçš„è¡Œ 2Ã—2 Array{Int64,2}: 1 2 3 4 ç©ºæ ¼å¯¹åº”å‡½æ•° hcatï¼Œè¡¨ç¤ºæ¨ªå‘æ‹¼æ¥å„ä¸ªçŸ©é˜µ/å…ƒç´ ã€‚åˆ†å·å’Œæ¢è¡Œå¯¹åº”å‡½æ•° vcatï¼Œè¡¨ç¤ºå‚ç›´æ‹¼æ¥å„ä¸ªçŸ©é˜µ/å…ƒç´ ã€‚ ä¸‹é¢çš„ä¾‹å­æ¼”ç¤ºäº†æ‹¼æ¥ï¼ˆç©ºæ ¼ï¼‰å’Œå•çº¯åˆ†éš”å„ä¸ªå…ƒç´ ï¼ˆé€—å·ï¼‰çš„åŒºåˆ«ï¼š julia julia\u003e [1 2 [3 4] 5] # ç”¨ç©ºæ ¼åšæ¨ªå‘æ‹¼æ¥ï¼ˆæˆ–ç§°æ°´å¹³æ‹¼æ¥ï¼‰ 1Ã—5 Array{Int64,2}: 1 2 3 4 5 julia\u003e [1, 2, [3, 4], 5] # ç”¨é€—å·åˆ†éš” 4-element Array{Any,1}: 1 2 [3, 4] 5 èƒ½çœ‹åˆ°åœ¨æ‹¼æ¥æ“ä½œä¸­ï¼Œ[3 4] è¢«ã€Œè§£å¼€ã€äº†ï¼Œè€Œç”¨é€—å·æ—¶ï¼Œå®ƒçš„è¡Œä¸ºå’Œ Python çš„ list ä¸€æ ·ï¼ˆåŒºåˆ«åªæ˜¯ Julia çš„ list åˆ—ä¼˜å…ˆï¼‰ã€‚ ä½¿ç”¨æ‹¼æ¥éœ€è¦æ³¨æ„çš„æƒ…å†µä¸¾ä¾‹ï¼š julia julia\u003e [1 2 [3, 4] 5] # æ¨ªå‘æ‹¼æ¥è¦æ±‚ items çš„è¡Œæ•°ç›¸åŒï¼ ERROR: DimensionMismatch(\"mismatch in dimension 1 (expected 1 got 2)\") å› ä¸º [3, 4] æœ‰ä¸¤è¡Œï¼Œè€Œ æ•°ç»„ä¸­çš„å…¶ä»–é¡¹æ˜¯æ•°å€¼ï¼Œæ˜¾ç„¶è¡Œæ•°ä¸åŒï¼Œæ‰€ä»¥æŠ›å‡ºäº† Error. å¯ä»¥æƒ³è§ï¼Œå‚ç›´æ‹¼æ¥åˆ™è¦æ±‚ items çš„åˆ—æ•°ç›¸åŒã€‚ å¦å¤–å½“å‚ç›´æ‹¼æ¥ç”¨äºåŸºæœ¬å…ƒç´ æ—¶ï¼Œæ•ˆæœç­‰åŒäºé€—å·ã€‚ï¼ˆç»“æœéƒ½æ˜¯å•åˆ—æ•°ç»„ï¼‰ julia julia\u003e v = [1, 2, 3, 4] 4-element Array{Int64,1}: 1 2 3 4 julia\u003e h = [1; 2; 3; 4] 4-element Array{Int64,1}: 1 2 3 4 julia\u003e [[1; 2]; [3, 4]] # ç­‰ä»·äº [[1, 2]; [3, 4]] 4-element Array{Int64,1}: 1 2 3 4 ","date":"2019-01-14","objectID":"/posts/julia-notes-1-array/:2:1","series":null,"tags":["JuliaLang"],"title":"Julia å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šæ•°ç»„","uri":"/posts/julia-notes-1-array/#1-æ•°ç»„çš„åˆ›å»º"},{"categories":["tech"],"content":" 1. æ•°ç»„çš„åˆ›å»ºè¿™é‡Œå°¤å…¶éœ€è¦æ³¨æ„çš„æ˜¯æ•°ç»„æ„é€ çš„å‡ ç§æ–¹æ³•ï¼Œä»¥åŠå®ƒä»¬çš„åŒºåˆ«ã€‚ 1.1 ä¸€ç»´æ•°ç»„ï¼ˆvector/listï¼‰ julia julia\u003e v = [1, 2, 3, 4] # é€—å·åˆ†éš”çš„è¯­æ³•ç”¨äºåˆ›å»ºä¸€ç»´æ•°ç»„ 4-element Array{Int64,1}: 1 2 3 4 å‘é‡ï¼ŒæŒ‡åˆ—å‘é‡ï¼ŒJulia ä½¿ç”¨çš„æ˜¯ Fortran Orderï¼Œå„ç§æ“ä½œéƒ½æ˜¯åˆ—ä¼˜å…ˆäºè¡Œçš„ã€‚ï¼ˆå’Œ numpy ç›¸åï¼Œnumpy æ˜¯ C Order çš„ï¼Œè¡Œä¼˜å…ˆäºåˆ—ï¼‰ 1.2. äºŒç»´æ•°ç»„ï¼ˆtable/matrixï¼‰ julia julia\u003e mat = [1 2 3 4] # ç©ºæ ¼åˆ†éš”çš„è¯­æ³•ï¼Œç”¨äºåˆ›å»ºäºŒç»´æ•°ç»„ï¼ˆæˆ–ç§°è¡Œå‘é‡ï¼‰ 1Ã—4 Array{Int64,2}: 1 2 3 4 julia\u003e [1 2; 3 4] # åˆ†å·å’Œæ¢è¡Œç¬¦(\\n)ï¼Œç”¨äºåˆ†éš”æ•°ç»„ä¸­ä¸åŒçš„è¡Œ 2Ã—2 Array{Int64,2}: 1 2 3 4 ç©ºæ ¼å¯¹åº”å‡½æ•° hcatï¼Œè¡¨ç¤ºæ¨ªå‘æ‹¼æ¥å„ä¸ªçŸ©é˜µ/å…ƒç´ ã€‚åˆ†å·å’Œæ¢è¡Œå¯¹åº”å‡½æ•° vcatï¼Œè¡¨ç¤ºå‚ç›´æ‹¼æ¥å„ä¸ªçŸ©é˜µ/å…ƒç´ ã€‚ ä¸‹é¢çš„ä¾‹å­æ¼”ç¤ºäº†æ‹¼æ¥ï¼ˆç©ºæ ¼ï¼‰å’Œå•çº¯åˆ†éš”å„ä¸ªå…ƒç´ ï¼ˆé€—å·ï¼‰çš„åŒºåˆ«ï¼š julia julia\u003e [1 2 [3 4] 5] # ç”¨ç©ºæ ¼åšæ¨ªå‘æ‹¼æ¥ï¼ˆæˆ–ç§°æ°´å¹³æ‹¼æ¥ï¼‰ 1Ã—5 Array{Int64,2}: 1 2 3 4 5 julia\u003e [1, 2, [3, 4], 5] # ç”¨é€—å·åˆ†éš” 4-element Array{Any,1}: 1 2 [3, 4] 5 èƒ½çœ‹åˆ°åœ¨æ‹¼æ¥æ“ä½œä¸­ï¼Œ[3 4] è¢«ã€Œè§£å¼€ã€äº†ï¼Œè€Œç”¨é€—å·æ—¶ï¼Œå®ƒçš„è¡Œä¸ºå’Œ Python çš„ list ä¸€æ ·ï¼ˆåŒºåˆ«åªæ˜¯ Julia çš„ list åˆ—ä¼˜å…ˆï¼‰ã€‚ ä½¿ç”¨æ‹¼æ¥éœ€è¦æ³¨æ„çš„æƒ…å†µä¸¾ä¾‹ï¼š julia julia\u003e [1 2 [3, 4] 5] # æ¨ªå‘æ‹¼æ¥è¦æ±‚ items çš„è¡Œæ•°ç›¸åŒï¼ ERROR: DimensionMismatch(\"mismatch in dimension 1 (expected 1 got 2)\") å› ä¸º [3, 4] æœ‰ä¸¤è¡Œï¼Œè€Œ æ•°ç»„ä¸­çš„å…¶ä»–é¡¹æ˜¯æ•°å€¼ï¼Œæ˜¾ç„¶è¡Œæ•°ä¸åŒï¼Œæ‰€ä»¥æŠ›å‡ºäº† Error. å¯ä»¥æƒ³è§ï¼Œå‚ç›´æ‹¼æ¥åˆ™è¦æ±‚ items çš„åˆ—æ•°ç›¸åŒã€‚ å¦å¤–å½“å‚ç›´æ‹¼æ¥ç”¨äºåŸºæœ¬å…ƒç´ æ—¶ï¼Œæ•ˆæœç­‰åŒäºé€—å·ã€‚ï¼ˆç»“æœéƒ½æ˜¯å•åˆ—æ•°ç»„ï¼‰ julia julia\u003e v = [1, 2, 3, 4] 4-element Array{Int64,1}: 1 2 3 4 julia\u003e h = [1; 2; 3; 4] 4-element Array{Int64,1}: 1 2 3 4 julia\u003e [[1; 2]; [3, 4]] # ç­‰ä»·äº [[1, 2]; [3, 4]] 4-element Array{Int64,1}: 1 2 3 4 ","date":"2019-01-14","objectID":"/posts/julia-notes-1-array/:2:1","series":null,"tags":["JuliaLang"],"title":"Julia å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šæ•°ç»„","uri":"/posts/julia-notes-1-array/#11-ä¸€ç»´æ•°ç»„vectorlist"},{"categories":["tech"],"content":" 1. æ•°ç»„çš„åˆ›å»ºè¿™é‡Œå°¤å…¶éœ€è¦æ³¨æ„çš„æ˜¯æ•°ç»„æ„é€ çš„å‡ ç§æ–¹æ³•ï¼Œä»¥åŠå®ƒä»¬çš„åŒºåˆ«ã€‚ 1.1 ä¸€ç»´æ•°ç»„ï¼ˆvector/listï¼‰ julia julia\u003e v = [1, 2, 3, 4] # é€—å·åˆ†éš”çš„è¯­æ³•ç”¨äºåˆ›å»ºä¸€ç»´æ•°ç»„ 4-element Array{Int64,1}: 1 2 3 4 å‘é‡ï¼ŒæŒ‡åˆ—å‘é‡ï¼ŒJulia ä½¿ç”¨çš„æ˜¯ Fortran Orderï¼Œå„ç§æ“ä½œéƒ½æ˜¯åˆ—ä¼˜å…ˆäºè¡Œçš„ã€‚ï¼ˆå’Œ numpy ç›¸åï¼Œnumpy æ˜¯ C Order çš„ï¼Œè¡Œä¼˜å…ˆäºåˆ—ï¼‰ 1.2. äºŒç»´æ•°ç»„ï¼ˆtable/matrixï¼‰ julia julia\u003e mat = [1 2 3 4] # ç©ºæ ¼åˆ†éš”çš„è¯­æ³•ï¼Œç”¨äºåˆ›å»ºäºŒç»´æ•°ç»„ï¼ˆæˆ–ç§°è¡Œå‘é‡ï¼‰ 1Ã—4 Array{Int64,2}: 1 2 3 4 julia\u003e [1 2; 3 4] # åˆ†å·å’Œæ¢è¡Œç¬¦(\\n)ï¼Œç”¨äºåˆ†éš”æ•°ç»„ä¸­ä¸åŒçš„è¡Œ 2Ã—2 Array{Int64,2}: 1 2 3 4 ç©ºæ ¼å¯¹åº”å‡½æ•° hcatï¼Œè¡¨ç¤ºæ¨ªå‘æ‹¼æ¥å„ä¸ªçŸ©é˜µ/å…ƒç´ ã€‚åˆ†å·å’Œæ¢è¡Œå¯¹åº”å‡½æ•° vcatï¼Œè¡¨ç¤ºå‚ç›´æ‹¼æ¥å„ä¸ªçŸ©é˜µ/å…ƒç´ ã€‚ ä¸‹é¢çš„ä¾‹å­æ¼”ç¤ºäº†æ‹¼æ¥ï¼ˆç©ºæ ¼ï¼‰å’Œå•çº¯åˆ†éš”å„ä¸ªå…ƒç´ ï¼ˆé€—å·ï¼‰çš„åŒºåˆ«ï¼š julia julia\u003e [1 2 [3 4] 5] # ç”¨ç©ºæ ¼åšæ¨ªå‘æ‹¼æ¥ï¼ˆæˆ–ç§°æ°´å¹³æ‹¼æ¥ï¼‰ 1Ã—5 Array{Int64,2}: 1 2 3 4 5 julia\u003e [1, 2, [3, 4], 5] # ç”¨é€—å·åˆ†éš” 4-element Array{Any,1}: 1 2 [3, 4] 5 èƒ½çœ‹åˆ°åœ¨æ‹¼æ¥æ“ä½œä¸­ï¼Œ[3 4] è¢«ã€Œè§£å¼€ã€äº†ï¼Œè€Œç”¨é€—å·æ—¶ï¼Œå®ƒçš„è¡Œä¸ºå’Œ Python çš„ list ä¸€æ ·ï¼ˆåŒºåˆ«åªæ˜¯ Julia çš„ list åˆ—ä¼˜å…ˆï¼‰ã€‚ ä½¿ç”¨æ‹¼æ¥éœ€è¦æ³¨æ„çš„æƒ…å†µä¸¾ä¾‹ï¼š julia julia\u003e [1 2 [3, 4] 5] # æ¨ªå‘æ‹¼æ¥è¦æ±‚ items çš„è¡Œæ•°ç›¸åŒï¼ ERROR: DimensionMismatch(\"mismatch in dimension 1 (expected 1 got 2)\") å› ä¸º [3, 4] æœ‰ä¸¤è¡Œï¼Œè€Œ æ•°ç»„ä¸­çš„å…¶ä»–é¡¹æ˜¯æ•°å€¼ï¼Œæ˜¾ç„¶è¡Œæ•°ä¸åŒï¼Œæ‰€ä»¥æŠ›å‡ºäº† Error. å¯ä»¥æƒ³è§ï¼Œå‚ç›´æ‹¼æ¥åˆ™è¦æ±‚ items çš„åˆ—æ•°ç›¸åŒã€‚ å¦å¤–å½“å‚ç›´æ‹¼æ¥ç”¨äºåŸºæœ¬å…ƒç´ æ—¶ï¼Œæ•ˆæœç­‰åŒäºé€—å·ã€‚ï¼ˆç»“æœéƒ½æ˜¯å•åˆ—æ•°ç»„ï¼‰ julia julia\u003e v = [1, 2, 3, 4] 4-element Array{Int64,1}: 1 2 3 4 julia\u003e h = [1; 2; 3; 4] 4-element Array{Int64,1}: 1 2 3 4 julia\u003e [[1; 2]; [3, 4]] # ç­‰ä»·äº [[1, 2]; [3, 4]] 4-element Array{Int64,1}: 1 2 3 4 ","date":"2019-01-14","objectID":"/posts/julia-notes-1-array/:2:1","series":null,"tags":["JuliaLang"],"title":"Julia å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šæ•°ç»„","uri":"/posts/julia-notes-1-array/#12-äºŒç»´æ•°ç»„tablematrix"},{"categories":["tech"],"content":" 2. æ•°ç»„çš„ç´¢å¼•æ•°ç»„çš„ç´¢å¼•æ–¹å¼å’Œ numpy å¾ˆç±»ä¼¼ã€‚æœ‰å¾ˆå¤šé«˜çº§ç´¢å¼•æ–¹å¼ã€‚ è¿™é‡Œæˆ‘æƒ³è¯´çš„æ˜¯ç±»ä¼¼ã€Œé½æ¬¡åæ ‡ã€çš„ç´¢å¼•ç‰¹æ€§ã€‚ é¦–å…ˆï¼Œå•ä¸ªå…ƒç´ å¯ä»¥çœ‹ä½œæ˜¯é›¶ç»´çš„å‘é‡ï¼Œæ•°å­¦ä¸Šé›¶ç»´ä¹Ÿå¯ä»¥çœ‹ä½œæ˜¯ä»»æ„ç»´ï¼Œå› æ­¤å¯ä»¥è¿™æ ·ç©ï¼š julia julia\u003e 2[1] 2 julia\u003e 2[1, 1] # è¢«å½“æˆäºŒç»´ 2 julia\u003e 2[1][1] # 2[1] ä»ç„¶æ˜¯æ•´æ•° 2 2 julia\u003e 2[1, 1, 1] # ä¸‰ç»´ 2 julia\u003e 3.14[1] 3.14 julia\u003e Ï€[1, 1] Ï€ = 3.1415926535897... julia\u003e '1'[1] '1': ASCII/Unicode U+0031 (category And: Number, decimal digit) julia\u003e '1'[1, 1] '1': ASCII/Unicode U+0031 (category And: Number, decimal digit) å¤šç»´æ•°ç»„ä¹Ÿèƒ½ä½¿ç”¨ç±»ä¼¼ã€Œé½æ¬¡åæ ‡ã€çš„ç´¢å¼•æ–¹å¼ï¼š julia julia\u003e m = [1 2; 3 4] 2Ã—2 Array{Int64,2}: 1 2 3 4 julia\u003e m[1][1] # m[1] æ˜¯æ•´æ•° 1ï¼Œè¿™ç›¸å½“äº 1[1] 1 julia\u003e m[1, 1, 1] 1 julia\u003e m[1, 1, 1, 1] 1 å¤šç»´çŸ©é˜µï¼Œåœ¨æ›´é«˜çš„ç»´åº¦ä¸Šï¼Œä¹Ÿèƒ½è¢«å½“æˆã€Œé›¶ç»´ã€æ¥çœ‹å¾…ï¼Œå‰é¢è¯´è¿‡äº†ã€Œé›¶ç»´ã€ä¹Ÿç›¸å½“äºã€Œæ— é™ç»´ã€ï¼Œ æ‰€ä»¥å¤šç»´æ•°ç»„ä¹Ÿèƒ½ç”¨è¿™ä¹ˆç´¢å¼•ã€‚ ä½†æ˜¯æ‹“å±•çš„ç»´åº¦ç´¢å¼•åªèƒ½æ˜¯ 1ï¼æ—¢ç„¶è¢«çœ‹ä½œã€Œé›¶ç»´ã€ï¼Œå°±åªç›¸å½“äºä¸€ä¸ªç‚¹ï¼Œè‡ªç„¶ä¸å¯èƒ½æœ‰æ›´é«˜çš„ç´¢å¼•ï¼š julia julia\u003e 1[1, 2] ERROR: BoundsError julia\u003e m[1, 1, 2] ERROR: BoundsError: attempt to access 2Ã—2 Array{Int64,2} at index [1, 1, 2] ... julia\u003e m[1, 1, 1, 2] ERROR: BoundsError: attempt to access 2Ã—2 Array{Int64,2} at index [1, 1, 1, 2] ... ","date":"2019-01-14","objectID":"/posts/julia-notes-1-array/:2:2","series":null,"tags":["JuliaLang"],"title":"Julia å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šæ•°ç»„","uri":"/posts/julia-notes-1-array/#2-æ•°ç»„çš„ç´¢å¼•"},{"categories":["tech"],"content":" 3. æ¨å¯¼å¼ï¼ˆcomprehensionï¼‰ä¸ç”Ÿæˆå™¨è¡¨è¾¾å¼ï¼ˆgenerator expressionï¼‰å’Œ Python çš„åˆ—è¡¨æ¨å¯¼å¼ä¸ç”Ÿæˆå™¨è¡¨è¾¾å¼å¾ˆåƒï¼Œä½†æ˜¯æ›´å¼ºå¤§â€”â€”Julia æ˜¯é¢å‘çŸ©é˜µçš„ã€‚ julia julia\u003e [i+j for i in 1:3 for j in 1:3] # è¿™ä¸ªè¯­æ³•å’Œ Python ä¸€è‡´ 9-element Array{Int64,1}: 2 3 4 3 4 5 4 5 6 julia\u003e [i+j for i in 1:3, j in 1:3] # è¿™ä¸ªæ˜¯å¤šç»´çš„è¯­æ³• 3Ã—3 Array{Int64,2}: 2 3 4 3 4 5 4 5 6 # åœ¨åé¢åŠ  guard çš„æƒ…å†µä¸‹ï¼Œç»“æœåç¼©æˆä¸€ç»´ï¼ˆè¿™æ—¶ä¸¤ç§è¯­æ³•ç»“æœæ²¡æœ‰å·®åˆ«ï¼‰ julia\u003e [i+j for i in 1:3, j in 1:3 if iseven(i+j)] 5-element Array{Int64,1}: 2 4 4 4 6 # åœ¨å‰é¢åšåˆ¤æ–­ï¼Œå› ä¸ºæ²¡æœ‰è¿‡æ»¤å…ƒç´ ï¼Œæ‰€ä»¥ä»ç„¶ä¿æŒäº†åŸæœ‰ç»“æ„ã€‚ julia\u003e [(iseven(i+j) ? 1 : 2) for i in 1:3, j in 1:3] 3Ã—3 Array{Int64,2}: 1 2 1 2 1 2 1 2 1 ","date":"2019-01-14","objectID":"/posts/julia-notes-1-array/:2:3","series":null,"tags":["JuliaLang"],"title":"Julia å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šæ•°ç»„","uri":"/posts/julia-notes-1-array/#3-æ¨å¯¼å¼comprehensionä¸ç”Ÿæˆå™¨è¡¨è¾¾å¼generator-expression"},{"categories":["tech"],"content":" å¯å…ˆæµè§ˆåŠ ç²—éƒ¨åˆ† ","date":"2019-01-14","objectID":"/posts/compression-related-instructions-under-linux/:0:0","series":null,"tags":["Linux","Compression","å‹ç¼©","tar"],"title":"å¸¸è§å‹ç¼©æ ¼å¼çš„åŒºåˆ«ï¼ŒåŠ Linux ä¸‹çš„å‹ç¼©ç›¸å…³æŒ‡ä»¤","uri":"/posts/compression-related-instructions-under-linux/#"},{"categories":["tech"],"content":" ä¸€ã€å¸¸è§å‹ç¼©æ¡£*.zip | zip ç¨‹åºå‹ç¼©æ‰“åŒ…çš„æ¡£æ¡ˆï¼› ï¼ˆå¾ˆå¸¸è§ï¼Œä½†æ˜¯å› ä¸ºä¸åŒ…å«æ–‡æ¡£åç¼–ç ä¿¡æ¯ï¼Œè·¨å¹³å°å¯èƒ½ä¼šä¹±ç ï¼‰ *.rar | rar ç¨‹åºå‹ç¼©æ‰“åŒ…çš„æ¡£æ¡ˆï¼›ï¼ˆåœ¨windowsä¸Šå¾ˆå¸¸è§ï¼Œä½†æ˜¯æ˜¯å•†ä¸šè½¯ä»¶ã€‚ï¼‰ *.gz | gzip ç¨‹åºå‹ç¼©çš„æ¡£æ¡ˆï¼› ï¼ˆlinuxç›®å‰ä½¿ç”¨æœ€å¹¿æ³›çš„å‹ç¼©æ ¼å¼ï¼‰ *.bz2 | bzip2 ç¨‹åºå‹ç¼©çš„æ¡£æ¡ˆï¼› *.xz | xz ç¨‹åºå‹ç¼©çš„æ¡£æ¡ˆï¼› *.tar | tar ç¨‹åºæ‰“åŒ…çš„èµ„æ–™ï¼Œå¹¶æ²¡æœ‰å‹ç¼©è¿‡ï¼› *.tar.gz | tar ç¨‹åºæ‰“åŒ…çš„æ¡£æ¡ˆï¼Œå…¶ä¸­å¹¶ä¸”ç»è¿‡ gzip çš„å‹ç¼© ï¼ˆæœ€å¸¸è§ï¼‰ *.tar.bz2 | tar ç¨‹åºæ‰“åŒ…çš„æ¡£æ¡ˆï¼Œå…¶ä¸­å¹¶ä¸”ç»è¿‡ bzip2 çš„å‹ç¼© *.tar.xz | tar ç¨‹åºæ‰“åŒ…çš„æ¡£æ¡ˆï¼Œå…¶ä¸­å¹¶ä¸”ç»è¿‡ xz çš„å‹ç¼© ï¼ˆæ–°ä¸€ä»£å‹ç¼©é€‰æ‹©ï¼‰ *.7z | 7zip ç¨‹åºå‹ç¼©æ‰“åŒ…çš„æ¡£æ¡ˆã€‚ ç›®å‰æœ€å¸¸è§çš„æ˜¯ tar.gz tar.xz tar.7z è¿™ä¸‰ç§æ ¼å¼ã€‚ ","date":"2019-01-14","objectID":"/posts/compression-related-instructions-under-linux/:1:0","series":null,"tags":["Linux","Compression","å‹ç¼©","tar"],"title":"å¸¸è§å‹ç¼©æ ¼å¼çš„åŒºåˆ«ï¼ŒåŠ Linux ä¸‹çš„å‹ç¼©ç›¸å…³æŒ‡ä»¤","uri":"/posts/compression-related-instructions-under-linux/#ä¸€å¸¸è§å‹ç¼©æ¡£"},{"categories":["tech"],"content":" äºŒã€ä»¥èƒ½å¦å‹ç¼©å¤šæ–‡æ¡£åˆ†ç±» gzip bzip2 xz è¿™ä¸‰ä¸ªå‹ç¼©æ ¼å¼éƒ½åªèƒ½å‹ç¼©å•ä¸ªæ–‡æ¡£ã€‚ï¼ˆæ¢è€Œè¨€ä¹‹ï¼Œè¯¥è¿›ç¨‹çš„è¾“å…¥è¾“å‡ºéƒ½æ˜¯æµï¼Œä¸åŒ…å«æ–‡æ¡£æ ‘ä¿¡æ¯ã€‚ï¼‰å› æ­¤å¦‚æœè¦ç”¨å®ƒä»¬å‹ç¼©å¤šä¸ªæ–‡æ¡£æˆ–ç›®å½•ï¼Œéœ€è¦ä½¿ç”¨å¦ä¸€ä¸ªè½¯ä»¶æ¥å…ˆå°†è¦å‹ç¼©çš„æ–‡æ¡£æ‰“åŒ…æˆä¸€ä¸ªæ–‡æ¡£ï¼ˆåŒ…å«æ–‡æ¡£æ ‘ä¿¡æ¯ï¼‰ï¼Œè¿™ä¸ªå‘½ä»¤å°±æ˜¯ tar. å…ˆä½¿ç”¨ tar å½’æ¡£è¦å‹ç¼©çš„å¤šæ–‡æ¡£ï¼Œå†å¯¹ç”Ÿæˆçš„ *.tar ä½¿ç”¨ ä¸Šè¿°å‹ç¼©æŒ‡ä»¤ï¼ˆæˆ–è€…ç›´æ¥ä½¿ç”¨ç®¡é“é‡å®šå‘ï¼‰ï¼ŒLinux ä¸‹æ˜¯è¿™æ ·å®ç°å¤šæ–‡æ¡£å‹ç¼©çš„ã€‚ è€Œ 7z å’Œ zipï¼Œä»¥åŠ rar æ ¼å¼ï¼Œéƒ½åŒæ—¶å…·æœ‰äº† å½’æ¡£(tar) å’Œ å‹ç¼© ä¸¤ä¸ªåŠŸèƒ½ï¼Œï¼ˆä¹Ÿå°±æ˜¯è¯¥æ ¼å¼åŒ…å«äº†æ–‡æ¡£æ ‘ä¿¡æ¯å’¯ï¼‰ä¹Ÿå°±æ˜¯è¯´å®ƒä»¬å¯ä»¥ç›´æ¥å‹ç¼©å¤šä¸ªæ–‡æ¡£ã€‚ ","date":"2019-01-14","objectID":"/posts/compression-related-instructions-under-linux/:2:0","series":null,"tags":["Linux","Compression","å‹ç¼©","tar"],"title":"å¸¸è§å‹ç¼©æ ¼å¼çš„åŒºåˆ«ï¼ŒåŠ Linux ä¸‹çš„å‹ç¼©ç›¸å…³æŒ‡ä»¤","uri":"/posts/compression-related-instructions-under-linux/#äºŒä»¥èƒ½å¦å‹ç¼©å¤šæ–‡æ¡£åˆ†ç±»"},{"categories":["tech"],"content":" ä¸‰ã€å„æ ¼å¼ä½¿ç”¨çš„ç®—æ³•å·®åˆ« gzip æˆç†Ÿçš„æ ¼å¼ï¼Œä½¿ç”¨çš„ç®—æ³•åŸºäº DEFLATEã€‚ï¼ˆå‹ç¼©æ¯”é€‚ä¸­ï¼‰ 7z æ–°ä¸€ä»£æ ¼å¼ï¼Œä½¿ç”¨çš„å‹ç¼©ç®—æ³•å¯æ›¿æ¢ï¼Œé»˜è®¤æ˜¯ä½¿ç”¨çš„ lzma/lzma2 ç®—æ³•ï¼Œä½¿ç”¨ AES-256 ä½œä¸ºåŠ å¯†ç®—æ³•ã€‚ xz åŒæ ·ä½¿ç”¨çš„ lzma/lzma2 ç®—æ³•ï¼Œä¸è¿‡åªèƒ½å‹ç¼©ä¸€ä¸ªæ–‡æ¡£ã€‚ï¼ˆå‹ç¼©æ¯”å¾ˆé«˜ï¼Œç›¸å¯¹çš„ç”¨æ—¶ä¹Ÿæ›´å¤šï¼‰ zip åŒæ ·æ˜¯æ”¯æŒå¤šç§ç®—æ³•çš„å‹ç¼©æ ¼å¼ï¼Œé»˜è®¤åº”è¯¥æ˜¯ä½¿ç”¨çš„ DEFLATE ç®—æ³•ã€‚è¯ç”Ÿè¾ƒæ—©ï¼Œæœ‰å¾ˆå¤šç¼ºé™·ã€‚ï¼ˆè·¨å¹³å°ä¹±ç ã€å®¹æ˜“è¢«ç ´è§£ç­‰ï¼‰ rar ä½¿ç”¨ ç±»DEFLATE çš„ä¸“æœ‰ç®—æ³•ï¼Œä½¿ç”¨ AES åŠ å¯†ã€‚(rar5.0 ä»¥åä½¿ç”¨ AES-256CBC) ä¸è¿‡ zip è¢«å¹¿æ³›åº”ç”¨åœ¨å®‰å“çš„ apk æ ¼å¼ã€java çš„ jarã€ç”µå­ä¹¦çš„ epubï¼Œè¿˜æœ‰ githubã€äº‘ç¡¬ç›˜çš„å¤šæ–‡æ¡£ä¸‹è½½ä¸­ï¼ŒåŸå› å˜›å¤§æ¦‚æ˜¯ zip å¾ˆæµè¡Œï¼Œæ‰€ä»¥ä¸ç”¨æ‹…å¿ƒç›®æ ‡å¹³å°æ²¡è§£å‹è½¯ä»¶å§ã€‚ ","date":"2019-01-14","objectID":"/posts/compression-related-instructions-under-linux/:3:0","series":null,"tags":["Linux","Compression","å‹ç¼©","tar"],"title":"å¸¸è§å‹ç¼©æ ¼å¼çš„åŒºåˆ«ï¼ŒåŠ Linux ä¸‹çš„å‹ç¼©ç›¸å…³æŒ‡ä»¤","uri":"/posts/compression-related-instructions-under-linux/#ä¸‰å„æ ¼å¼ä½¿ç”¨çš„ç®—æ³•å·®åˆ«"},{"categories":["tech"],"content":" å››ã€å¦‚ä½•é€‰ç”¨å‹ç¼©æ–¹æ¡ˆ tar.gz åœ¨ linux ä¸Šæœ€å¸¸è§ï¼Œåœ¨å‹ç¼©ç‡å’Œå‹ç¼©æ—¶é—´ä¸Šæ‹¥æœ‰è‰¯å¥½çš„å¹³è¡¡ã€‚å¦‚æœæœ‰ä»»ä½•ç–‘æƒ‘ï¼Œå°±é€‰ç”¨å®ƒå§ï¼Œä¸ä¼šé”™ã€‚ tar.xz æ˜¯æ–°ä¸€ä»£çš„å‹ç¼©æ ¼å¼ï¼Œè™½ç„¶æ‹¥æœ‰æ›´å¥½çš„å‹ç¼©ç‡ï¼Œå‹ç¼©/è§£å‹é€Ÿåº¦ç›¸å¯¹è¦æ…¢å¾ˆå¤šå€ã€‚ä¸€èˆ¬åœ¨ç”µè„‘æ€§èƒ½è¶³å¤Ÿå¥½çš„æ—¶å€™ï¼Œå¯é€‰ç”¨å®ƒã€‚ 7z å’Œ xz åŒä¸ºæ–°ä¸€ä»£å‹ç¼©æ ¼å¼ï¼Œå®ƒæ›´å¤æ‚ï¼Œæ”¯æŒå¤šæ–‡æ¡£å‹ç¼©ã€‚è€Œä¸”æ›´é€‚åˆè·¨å¹³å°ï¼Œæ¨èä½¿ç”¨ã€‚ zip å› ä¸ºè·¨å¹³å°å®¹æ˜“å¯¼è‡´æ–‡æ¡£åä¹±ç ï¼Œä¸å»ºè®®ä½¿ç”¨ã€‚ï¼ˆè™½ç„¶æœ‰è¿™æ ·çš„ç¼ºé™·ï¼Œä½†æ˜¯å´æ„å¤–çš„ç”¨å¾—å¾ˆå¹¿æ³›ï¼Œåœ¨å‰ä¸€èŠ‚æœ‰è¯´è¿‡ï¼‰ rar æ€§èƒ½ä¸å·®ï¼Œä½†æ˜¯æ˜¯å•†ä¸šæ ¼å¼ï¼Œä¸å¼€æºï¼Œä¸å»ºè®®ä½¿ç”¨ã€‚ï¼ˆåšå¾—æ¯”è¾ƒå¥½çš„æ˜¯å®ƒçš„ recovery recordsï¼Œåœ¨ç½‘ç»œç¯å¢ƒä¸å¥½ï¼Œå®¹æ˜“å¯¼è‡´åŒ…æŸåæ—¶ï¼Œè¿™ä¸ªåŠŸèƒ½å°±ç‰¹åˆ«æ£’ï¼‰ tar.bz2 ç®—æ˜¯ linux å‹ç¼©å†å²ä¸Šï¼Œè¿‡æ¸¡æ—¶æœŸçš„äº§ç‰©ï¼Œæ€§èƒ½ä¹Ÿä»‹äº gz å’Œ xz ä¹‹é—´ï¼Œä¸€èˆ¬æ¥è¯´ä¸éœ€è¦è€ƒè™‘å®ƒã€‚ æ€»çš„æ¥è¯´ï¼Œå°±æ˜¯ Windows ä¸Šæ¨èä½¿ç”¨ 7zï¼Œè€Œ Linux ä¸Š æ¨èä½¿ç”¨ tar.gz tar.xz 7z ä¹‹ä¸€ã€‚æ­¤å¤– rar çš„æŸåå¾ˆå®¹æ˜“ä¿®å¤ï¼Œzip å—ä¼—å¤šï¼ˆè¦æ³¨æ„ä¹±ç é—®é¢˜ï¼‰ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘ã€‚ ","date":"2019-01-14","objectID":"/posts/compression-related-instructions-under-linux/:4:0","series":null,"tags":["Linux","Compression","å‹ç¼©","tar"],"title":"å¸¸è§å‹ç¼©æ ¼å¼çš„åŒºåˆ«ï¼ŒåŠ Linux ä¸‹çš„å‹ç¼©ç›¸å…³æŒ‡ä»¤","uri":"/posts/compression-related-instructions-under-linux/#å››å¦‚ä½•é€‰ç”¨å‹ç¼©æ–¹æ¡ˆ"},{"categories":["tech"],"content":" äº”ã€Linux ä¸Šçš„å‹ç¼©ç›¸å…³æŒ‡ä»¤","date":"2019-01-14","objectID":"/posts/compression-related-instructions-under-linux/:5:0","series":null,"tags":["Linux","Compression","å‹ç¼©","tar"],"title":"å¸¸è§å‹ç¼©æ ¼å¼çš„åŒºåˆ«ï¼ŒåŠ Linux ä¸‹çš„å‹ç¼©ç›¸å…³æŒ‡ä»¤","uri":"/posts/compression-related-instructions-under-linux/#äº”linux-ä¸Šçš„å‹ç¼©ç›¸å…³æŒ‡ä»¤"},{"categories":["tech"],"content":" 1. tar æŒ‡ä»¤é€šè¿‡ä¹‹å‰çš„ä»‹ç»ï¼Œå¯ä»¥çœ‹å‡ºå¸¸ç”¨çš„å°±æ˜¯ tar gzip xz ç­‰ï¼Œå¦‚æœè¦å‹ç¼©å¤šä¸ªæ–‡æ¡£ï¼Œéœ€è¦å…ˆä½¿ç”¨tarï¼Œå†ç”¨ç®¡é“é‡å®šå‘åˆ° gzip æˆ– xzï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œè€Œè¿™å‡ ä¸ªæŒ‡ä»¤åˆå¾ˆå¸¸ç”¨ã€‚äºæ˜¯åæ¥å¯¹taråšäº†å¢å¼ºã€‚tar æœ€åˆåªæ˜¯ä¸€ä¸ªå½’æ¡£è¿›ç¨‹ï¼Œè€Œå‹ç¼©åˆ™ç”±å…¶ä»–çš„å‹ç¼©è½¯ä»¶æ¥å®Œæˆï¼ˆä¸€ä¸ªè¿›ç¨‹åªå¹²ä¸€ä»¶äº‹ï¼‰ã€‚åæ¥ä¸ºäº†æ–¹ä¾¿ï¼Œä¸§å¿ƒç—…ç‹‚åœ°é›†æˆäº†å„ç§å‹ç¼©æŒ‡ä»¤ã€‚å› æ­¤è¿™é‡Œå°±åªä»‹ç»è¿™ä¸€ä¸ªå‘½ä»¤äº†ï¼ˆå®ƒå›Šæ‹¬äº†æ‰€æœ‰ï¼‰ã€‚tar çš„é€‰é¡¹ä¸å‚æ•°éå¸¸çš„å¤šï¼æˆ‘ä»¬åªè®²å‡ ä¸ªå¸¸ç”¨çš„é€‰é¡¹ï¼Œæ›´å¤šé€‰é¡¹æ‚¨å¯ä»¥è‡ªè¡Œ man tar æŸ¥è¯¢å•°ï¼ bash [dmtsai@study ~]$ tar [-z|-j|-J] [cv] [-f å¾…åˆ›å»ºçš„æ–°æ¡£å] filename... \u003c==æ‰“åŒ…ä¸å‹ç¼© [dmtsai@study ~]$ tar [-z|-j|-J] [tv] [-f æ—¢æœ‰çš„ taræ¡£å] \u003c==å¯Ÿçœ‹æ¡£å [dmtsai@study ~]$ tar [-z|-j|-J] [xv] [-f æ—¢æœ‰çš„ taræ¡£å] [-C ç›®å½•] \u003c==è§£å‹ç¼© é€‰é¡¹ä¸å‚æ•°-c ï¼šåˆ›å»ºæ‰“åŒ…æ¡£æ¡ˆï¼Œå¯æ­é… -v æ¥å¯Ÿçœ‹è¿‡ç¨‹ä¸­è¢«æ‰“åŒ…çš„æ¡£å(filename) -t ï¼šå¯Ÿçœ‹æ‰“åŒ…æ¡£æ¡ˆçš„å†…å®¹å«æœ‰å“ªäº›æ¡£åï¼Œé‡ç‚¹åœ¨å¯Ÿçœ‹ã€æ¡£åã€å°±æ˜¯äº†ï¼› -x ï¼šè§£æ‰“åŒ…æˆ–è§£å‹ç¼©çš„åŠŸèƒ½ï¼Œå¯ä»¥æ­é… -C (å¤§å†™) åœ¨ç‰¹å®šç›®å½•è§£å¼€ ç‰¹åˆ«ç•™æ„çš„æ˜¯ï¼Œ -c, -t, -x ä¸å¯åŒæ—¶å‡ºç°åœ¨ä¸€ä¸²æŒ‡ä»¤åˆ—ä¸­ã€‚ -z ï¼šé€è¿‡ gzip çš„æ”¯æŒè¿›è¡Œå‹ç¼©/è§£å‹ç¼©ï¼šæ­¤æ—¶æ¡£åæœ€å¥½ä¸º *.tar.gz -j ï¼šé€è¿‡ bzip2 çš„æ”¯æŒè¿›è¡Œå‹ç¼©/è§£å‹ç¼©ï¼šæ­¤æ—¶æ¡£åæœ€å¥½ä¸º *.tar.bz2 -J ï¼šé€è¿‡ xz çš„æ”¯æŒè¿›è¡Œå‹ç¼©/è§£å‹ç¼©ï¼šæ­¤æ—¶æ¡£åæœ€å¥½ä¸º *.tar.xz ç‰¹åˆ«ç•™æ„ï¼Œ -z, -j, -J ä¸å¯ä»¥åŒæ—¶å‡ºç°åœ¨ä¸€ä¸²æŒ‡ä»¤åˆ—ä¸­ -v ï¼šåœ¨å‹ç¼©/è§£å‹ç¼©çš„è¿‡ç¨‹ä¸­ï¼Œå°†æ­£åœ¨å¤„ç†çš„æ¡£åæ˜¾ç¤ºå‡ºæ¥ï¼ -f filenameï¼š-f åé¢è¦ç«‹åˆ»æ¥è¦è¢«å¤„ç†çš„æ¡£åï¼å»ºè®® -f å•ç‹¬å†™ä¸€ä¸ªé€‰é¡¹å•°ï¼(æ¯”è¾ƒä¸ä¼šå¿˜è®°) -C ç›®å½• ï¼šè¿™ä¸ªé€‰é¡¹ç”¨åœ¨è§£å‹ç¼©ï¼Œè‹¥è¦åœ¨ç‰¹å®šç›®å½•è§£å‹ç¼©ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ã€‚ å…¶ä»–åç»­ç»ƒä¹ ä¼šä½¿ç”¨åˆ°çš„é€‰é¡¹ä»‹ç»ï¼š -p(å°å†™) ï¼šä¿ç•™å¤‡ä»½èµ„æ–™çš„åŸæœ¬æƒé™ä¸å±æ€§ï¼Œå¸¸ç”¨äºå¤‡ä»½(-c)é‡è¦çš„è®¾å®šæ¡£ -P(å¤§å†™) ï¼šä¿ç•™ç»å¯¹è·¯å¾„ï¼Œäº¦å³å…è®¸å¤‡ä»½èµ„æ–™ä¸­å«æœ‰æ ¹ç›®å½•å­˜åœ¨ä¹‹æ„ï¼›â€“exclude=FILEï¼šåœ¨å‹ç¼©çš„è¿‡ç¨‹ä¸­ï¼Œä¸è¦å°† FILE æ‰“åŒ…ï¼ å…¶å®æœ€ç®€å•çš„ä½¿ç”¨ tar å°±åªè¦è®°å¿†åº•ä¸‹çš„æ–¹å¼å³å¯ å‹ç¼©ï¼štar -zcv -f filename.tar.gz \u003cè¦è¢«å‹ç¼©çš„æ¡£æ¡ˆæˆ–ç›®å½•åç§°\u003e æŸ¥çœ‹æ–‡æ¡£æ ‘ï¼štar -ztv -f filename.tar.gz è§£å‹ç¼©ï¼štar -zxv -f filename.tar.gz -C \u003cæ¬²è§£å‹ç¼©çš„ç›®å½•\u003e` ä¸Šé¢çš„å‘½ä»¤éœ€è¦æ ¹æ®å‹ç¼©æ ¼å¼çš„ä¸åŒï¼Œé€‰ç”¨ -z -j -J é€‰é¡¹ï¼Œè€Œå®é™…ä¸Šæ–‡æ¡£çš„åç¼€å°±å·²ç»è¡¨æ˜äº†å®ƒçš„å‹ç¼©æ ¼å¼ï¼Œä¸å…è®©äººè§‰å¾—å¤šä½™ã€‚å› æ­¤å°±æœ‰è¿™å¹ºä¸€æ¡é€šç”¨çš„å‹ç¼©/è§£å‹ option -a, --auto-compress Use archive suffix to determine the compression program. ä½¿ç”¨è¿™ä¸ªï¼Œä¾¿æœ‰äº†é€šç”¨çš„è§£å‹æŒ‡ä»¤ï¼š tar -axv -f file.tar.* ï¼ˆå®ƒé€‚ç”¨äºä¸Šè¿°ä¸‰ç§å‹ç¼©æ ¼å¼ï¼‰ ä»…è§£å‹æŒ‡å®šçš„æ–‡æ¡£ å…ˆæŸ¥çœ‹æ–‡æ¡£æ ‘æ‰¾åˆ°éœ€è¦è§£å‹çš„æ–‡æ¡£çš„æ–‡æ¡£å tar -zxv -f æ‰“åŒ…æ¡£.tar.gz å¾…è§£å¼€æ¡£å æ‰“åŒ…æŸç›®å½•ï¼Œä½†ä¸å«è¯¥ç›®å½•ä¸‹çš„æŸäº›æ¡£æ¡ˆä¹‹ä½œæ³•ä½¿ç”¨ â€“exclude=FILE é€‰é¡¹ï¼ˆæ”¯æŒæ–‡æ¡£åçš„æ¨¡å¼åŒ¹é…ï¼Œè€Œä¸”å¯é‡å¤ï¼‰ tar -zcv -f filename.tar.gz directory --exclude=FILE1 --exclude=func* åªæ‰“åŒ…ç›®å½•ä¸­æ¯”æŒ‡å®šæ—¶åˆ»æ›´æ–°çš„æ–‡æ¡£ä½¿ç”¨ --newer-mtime=\"2015/06/17\" é€‰é¡¹ã€‚ tarfile, tarballtarfile | çº¯æ‰“åŒ…ã€æœªå‹ç¼©çš„ tar æ–‡æ¡£ tarball | å‹ç¼©äº†çš„ tar æ–‡æ¡£ 2. zipæ ¼å¼ï¼ˆlinux ä¸€èˆ¬ä¹Ÿä¼šè‡ªå¸¦ï¼Œè¯¦ç»†çš„è¯·manï¼‰ å‹ç¼©å‘½ä»¤ï¼šzip å‹ç¼©ç›®å½•ï¼šzip -r filename.zip directory r è¡¨ç¤ºé€’å½’å‹ç¼©ï¼Œå‹ç¼©åŒ…ä¼šåŒ…å«è¿™ä¸ªç›®å½• è§£å‹å‘½ä»¤ï¼šunzip è§£å‹åˆ°æŸç›®å½•ï¼šunzip -d directory filename.zip (-d dir è¡¨ç¤ºå°†å†…å®¹è§£å‹åˆ°dirç›®å½•å†…) -t æµ‹è¯•å‹ç¼©æ¡£çš„å®Œæ•´æ€§ -x filename æ’é™¤æŸæ–‡æ¡£ 3. 7zæ ¼å¼ï¼ˆéœ€è¦p7zipï¼Œdeepinè‡ªå¸¦ï¼Œæ›´å¤šçš„è¯·manï¼‰ æŸ¥çœ‹ç›®å½•æ ‘ï¼š7z l file.7z (List contents of archive) å‹ç¼©ï¼š7z a file.7z file1 directory1 (a ä¸ºåˆ›å»ºå‹ç¼©æ¡£æˆ–å‘å‹ç¼©æ¡£ä¸­æ·»åŠ æ–‡æ¡£/ç›®å½•ï¼Œä¸€æ¬¡å¯æŒ‡å®šå¤šä¸ªè¦å‹ç¼©çš„æ–‡æ¡£æˆ–ç›®å½•) è§£å‹ï¼š7z x file.7z -o directory (è§£å‹åˆ°æŒ‡å®šç›®å½•) æµ‹è¯•å®Œæ•´æ€§ï¼š 7z t file.7z p7zip å®‰è£…å¥½åï¼Œä¼šæä¾› 7zã€7zaã€7zr ä¸‰ä¸ªæŒ‡ä»¤ï¼Œä¸€èˆ¬æ¥è¯´ç›´æ¥ç”¨ 7z å°±è¡Œã€‚ P.S. 7z ä¸ä¼šä¿å­˜ Linux æ–‡æ¡£çš„ç”¨æˆ·ã€ç”¨æˆ·ç»„ä¿¡æ¯ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥ç”¨äº Linux ç³»ç»Ÿå¤‡ä»½ï¼Œæ­¤æ—¶å»ºè®®ç”¨ tar.xz æˆ– tar.7zï¼ˆä¹Ÿå°±æ˜¯å…ˆç”¨taræ‰“åŒ…ï¼‰ 4. raræ ¼å¼ï¼ˆè¿˜æ˜¯é‚£å¥è¯ï¼Œæ›´å¤šçš„è¯·manï¼‰rar æ˜¯éå¼€æºçš„æ ¼å¼ï¼ŒLinux é»˜è®¤æ˜¯ä¸ä¼šåŒ…å« rar å‹ç¼©è½¯ä»¶çš„ï¼Œä½†æ˜¯å®ƒçš„è§£å‹è½¯ä»¶æ˜¯å¼€æºçš„ï¼Œdeepin è‡ªå¸¦ unrarï¼Œé¡ºä¾¿ 7zip ä¹Ÿå¯è§£å‹ rar æ–‡æ¡£ã€‚è‹¥æƒ³ç”¨linuxåˆ›å»ºrarå‹ç¼©æ¡£ï¼Œéœ€è¦ä»rarlabä¸Šä¸‹è½½ Linux ç‰ˆï¼Œï¼ˆdeepinæºè‡ªå¸¦ï¼‰ä¸è¿‡è¦æ³¨æ„çš„æ˜¯è¯¥ linux ç‰ˆæ˜¯ 40 å¤©è¯•ç”¨ç‰ˆï¼Œè¦é•¿æœŸä½¿ç”¨çš„è¯ï¼Œå¯èƒ½éœ€è¦ç ´è§£ã€‚ï¼ˆrar çš„ key ç½‘ä¸Šä¸€æœä¸€å¤§æŠŠï¼‰ å‹ç¼©ï¼šrar a file.rar file ï¼ˆè¿™ä¸ªæ˜¯è¯•ç”¨çš„ï¼‰ è§£å‹ï¼šunrar x file.rar ï¼ˆè¿™ä¸ªå¼€æºå…è´¹ï¼‰ å…¶å®æˆ‘æŒºä¸­æ„ rar çš„ä¿®å¤åŠŸèƒ½çš„ï¼Œä¸çŸ¥é“ä¸ºå•¥ 7z xz è¿™æ ·çš„æ–°æ ¼å¼æ²¡æœ‰æ·»åŠ ç±»ä¼¼çš„recorvery recordsã€‚ä¸Šæ¬¡ä¸‹ä¸ª idea çš„ tarballï¼Œä¸‹äº†å››äº”æ¬¡æ‰ä¸‹åˆ°ä¸€ä¸ªå®Œæ•´çš„ï¼Œè¦æ˜¯ç”¨rar çš„è¯ï¼Œå¤§æ¦‚ä¸€é”®ä¿®å¤å°±å¥½äº†ï¼Œå¯ tar.gz æˆ‘ä¸çŸ¥é“æ€å¹ºä¿®å¤ï¼Œåªå¥½ä¸€ééé‡å¤ä¸‹è½½ã€‚ã€‚ ","date":"2019-01-14","objectID":"/posts/compression-related-instructions-under-linux/:5:1","series":null,"tags":["Linux","Compression","å‹ç¼©","tar"],"title":"å¸¸è§å‹ç¼©æ ¼å¼çš„åŒºåˆ«ï¼ŒåŠ Linux ä¸‹çš„å‹ç¼©ç›¸å…³æŒ‡ä»¤","uri":"/posts/compression-related-instructions-under-linux/#1-tar-æŒ‡ä»¤"},{"categories":["tech"],"content":" 1. tar æŒ‡ä»¤é€šè¿‡ä¹‹å‰çš„ä»‹ç»ï¼Œå¯ä»¥çœ‹å‡ºå¸¸ç”¨çš„å°±æ˜¯ tar gzip xz ç­‰ï¼Œå¦‚æœè¦å‹ç¼©å¤šä¸ªæ–‡æ¡£ï¼Œéœ€è¦å…ˆä½¿ç”¨tarï¼Œå†ç”¨ç®¡é“é‡å®šå‘åˆ° gzip æˆ– xzï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œè€Œè¿™å‡ ä¸ªæŒ‡ä»¤åˆå¾ˆå¸¸ç”¨ã€‚äºæ˜¯åæ¥å¯¹taråšäº†å¢å¼ºã€‚tar æœ€åˆåªæ˜¯ä¸€ä¸ªå½’æ¡£è¿›ç¨‹ï¼Œè€Œå‹ç¼©åˆ™ç”±å…¶ä»–çš„å‹ç¼©è½¯ä»¶æ¥å®Œæˆï¼ˆä¸€ä¸ªè¿›ç¨‹åªå¹²ä¸€ä»¶äº‹ï¼‰ã€‚åæ¥ä¸ºäº†æ–¹ä¾¿ï¼Œä¸§å¿ƒç—…ç‹‚åœ°é›†æˆäº†å„ç§å‹ç¼©æŒ‡ä»¤ã€‚å› æ­¤è¿™é‡Œå°±åªä»‹ç»è¿™ä¸€ä¸ªå‘½ä»¤äº†ï¼ˆå®ƒå›Šæ‹¬äº†æ‰€æœ‰ï¼‰ã€‚tar çš„é€‰é¡¹ä¸å‚æ•°éå¸¸çš„å¤šï¼æˆ‘ä»¬åªè®²å‡ ä¸ªå¸¸ç”¨çš„é€‰é¡¹ï¼Œæ›´å¤šé€‰é¡¹æ‚¨å¯ä»¥è‡ªè¡Œ man tar æŸ¥è¯¢å•°ï¼ bash [dmtsai@study ~]$ tar [-z|-j|-J] [cv] [-f å¾…åˆ›å»ºçš„æ–°æ¡£å] filename... \u003c==æ‰“åŒ…ä¸å‹ç¼© [dmtsai@study ~]$ tar [-z|-j|-J] [tv] [-f æ—¢æœ‰çš„ taræ¡£å] \u003c==å¯Ÿçœ‹æ¡£å [dmtsai@study ~]$ tar [-z|-j|-J] [xv] [-f æ—¢æœ‰çš„ taræ¡£å] [-C ç›®å½•] \u003c==è§£å‹ç¼© é€‰é¡¹ä¸å‚æ•°-c ï¼šåˆ›å»ºæ‰“åŒ…æ¡£æ¡ˆï¼Œå¯æ­é… -v æ¥å¯Ÿçœ‹è¿‡ç¨‹ä¸­è¢«æ‰“åŒ…çš„æ¡£å(filename) -t ï¼šå¯Ÿçœ‹æ‰“åŒ…æ¡£æ¡ˆçš„å†…å®¹å«æœ‰å“ªäº›æ¡£åï¼Œé‡ç‚¹åœ¨å¯Ÿçœ‹ã€æ¡£åã€å°±æ˜¯äº†ï¼› -x ï¼šè§£æ‰“åŒ…æˆ–è§£å‹ç¼©çš„åŠŸèƒ½ï¼Œå¯ä»¥æ­é… -C (å¤§å†™) åœ¨ç‰¹å®šç›®å½•è§£å¼€ ç‰¹åˆ«ç•™æ„çš„æ˜¯ï¼Œ -c, -t, -x ä¸å¯åŒæ—¶å‡ºç°åœ¨ä¸€ä¸²æŒ‡ä»¤åˆ—ä¸­ã€‚ -z ï¼šé€è¿‡ gzip çš„æ”¯æŒè¿›è¡Œå‹ç¼©/è§£å‹ç¼©ï¼šæ­¤æ—¶æ¡£åæœ€å¥½ä¸º *.tar.gz -j ï¼šé€è¿‡ bzip2 çš„æ”¯æŒè¿›è¡Œå‹ç¼©/è§£å‹ç¼©ï¼šæ­¤æ—¶æ¡£åæœ€å¥½ä¸º *.tar.bz2 -J ï¼šé€è¿‡ xz çš„æ”¯æŒè¿›è¡Œå‹ç¼©/è§£å‹ç¼©ï¼šæ­¤æ—¶æ¡£åæœ€å¥½ä¸º *.tar.xz ç‰¹åˆ«ç•™æ„ï¼Œ -z, -j, -J ä¸å¯ä»¥åŒæ—¶å‡ºç°åœ¨ä¸€ä¸²æŒ‡ä»¤åˆ—ä¸­ -v ï¼šåœ¨å‹ç¼©/è§£å‹ç¼©çš„è¿‡ç¨‹ä¸­ï¼Œå°†æ­£åœ¨å¤„ç†çš„æ¡£åæ˜¾ç¤ºå‡ºæ¥ï¼ -f filenameï¼š-f åé¢è¦ç«‹åˆ»æ¥è¦è¢«å¤„ç†çš„æ¡£åï¼å»ºè®® -f å•ç‹¬å†™ä¸€ä¸ªé€‰é¡¹å•°ï¼(æ¯”è¾ƒä¸ä¼šå¿˜è®°) -C ç›®å½• ï¼šè¿™ä¸ªé€‰é¡¹ç”¨åœ¨è§£å‹ç¼©ï¼Œè‹¥è¦åœ¨ç‰¹å®šç›®å½•è§£å‹ç¼©ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ã€‚ å…¶ä»–åç»­ç»ƒä¹ ä¼šä½¿ç”¨åˆ°çš„é€‰é¡¹ä»‹ç»ï¼š -p(å°å†™) ï¼šä¿ç•™å¤‡ä»½èµ„æ–™çš„åŸæœ¬æƒé™ä¸å±æ€§ï¼Œå¸¸ç”¨äºå¤‡ä»½(-c)é‡è¦çš„è®¾å®šæ¡£ -P(å¤§å†™) ï¼šä¿ç•™ç»å¯¹è·¯å¾„ï¼Œäº¦å³å…è®¸å¤‡ä»½èµ„æ–™ä¸­å«æœ‰æ ¹ç›®å½•å­˜åœ¨ä¹‹æ„ï¼›â€“exclude=FILEï¼šåœ¨å‹ç¼©çš„è¿‡ç¨‹ä¸­ï¼Œä¸è¦å°† FILE æ‰“åŒ…ï¼ å…¶å®æœ€ç®€å•çš„ä½¿ç”¨ tar å°±åªè¦è®°å¿†åº•ä¸‹çš„æ–¹å¼å³å¯ å‹ç¼©ï¼štar -zcv -f filename.tar.gz \u003cè¦è¢«å‹ç¼©çš„æ¡£æ¡ˆæˆ–ç›®å½•åç§°\u003e æŸ¥çœ‹æ–‡æ¡£æ ‘ï¼štar -ztv -f filename.tar.gz è§£å‹ç¼©ï¼štar -zxv -f filename.tar.gz -C \u003cæ¬²è§£å‹ç¼©çš„ç›®å½•\u003e` ä¸Šé¢çš„å‘½ä»¤éœ€è¦æ ¹æ®å‹ç¼©æ ¼å¼çš„ä¸åŒï¼Œé€‰ç”¨ -z -j -J é€‰é¡¹ï¼Œè€Œå®é™…ä¸Šæ–‡æ¡£çš„åç¼€å°±å·²ç»è¡¨æ˜äº†å®ƒçš„å‹ç¼©æ ¼å¼ï¼Œä¸å…è®©äººè§‰å¾—å¤šä½™ã€‚å› æ­¤å°±æœ‰è¿™å¹ºä¸€æ¡é€šç”¨çš„å‹ç¼©/è§£å‹ option -a, --auto-compress Use archive suffix to determine the compression program. ä½¿ç”¨è¿™ä¸ªï¼Œä¾¿æœ‰äº†é€šç”¨çš„è§£å‹æŒ‡ä»¤ï¼š tar -axv -f file.tar.* ï¼ˆå®ƒé€‚ç”¨äºä¸Šè¿°ä¸‰ç§å‹ç¼©æ ¼å¼ï¼‰ ä»…è§£å‹æŒ‡å®šçš„æ–‡æ¡£ å…ˆæŸ¥çœ‹æ–‡æ¡£æ ‘æ‰¾åˆ°éœ€è¦è§£å‹çš„æ–‡æ¡£çš„æ–‡æ¡£å tar -zxv -f æ‰“åŒ…æ¡£.tar.gz å¾…è§£å¼€æ¡£å æ‰“åŒ…æŸç›®å½•ï¼Œä½†ä¸å«è¯¥ç›®å½•ä¸‹çš„æŸäº›æ¡£æ¡ˆä¹‹ä½œæ³•ä½¿ç”¨ â€“exclude=FILE é€‰é¡¹ï¼ˆæ”¯æŒæ–‡æ¡£åçš„æ¨¡å¼åŒ¹é…ï¼Œè€Œä¸”å¯é‡å¤ï¼‰ tar -zcv -f filename.tar.gz directory --exclude=FILE1 --exclude=func* åªæ‰“åŒ…ç›®å½•ä¸­æ¯”æŒ‡å®šæ—¶åˆ»æ›´æ–°çš„æ–‡æ¡£ä½¿ç”¨ --newer-mtime=\"2015/06/17\" é€‰é¡¹ã€‚ tarfile, tarballtarfile | çº¯æ‰“åŒ…ã€æœªå‹ç¼©çš„ tar æ–‡æ¡£ tarball | å‹ç¼©äº†çš„ tar æ–‡æ¡£ 2. zipæ ¼å¼ï¼ˆlinux ä¸€èˆ¬ä¹Ÿä¼šè‡ªå¸¦ï¼Œè¯¦ç»†çš„è¯·manï¼‰ å‹ç¼©å‘½ä»¤ï¼šzip å‹ç¼©ç›®å½•ï¼šzip -r filename.zip directory r è¡¨ç¤ºé€’å½’å‹ç¼©ï¼Œå‹ç¼©åŒ…ä¼šåŒ…å«è¿™ä¸ªç›®å½• è§£å‹å‘½ä»¤ï¼šunzip è§£å‹åˆ°æŸç›®å½•ï¼šunzip -d directory filename.zip (-d dir è¡¨ç¤ºå°†å†…å®¹è§£å‹åˆ°dirç›®å½•å†…) -t æµ‹è¯•å‹ç¼©æ¡£çš„å®Œæ•´æ€§ -x filename æ’é™¤æŸæ–‡æ¡£ 3. 7zæ ¼å¼ï¼ˆéœ€è¦p7zipï¼Œdeepinè‡ªå¸¦ï¼Œæ›´å¤šçš„è¯·manï¼‰ æŸ¥çœ‹ç›®å½•æ ‘ï¼š7z l file.7z (List contents of archive) å‹ç¼©ï¼š7z a file.7z file1 directory1 (a ä¸ºåˆ›å»ºå‹ç¼©æ¡£æˆ–å‘å‹ç¼©æ¡£ä¸­æ·»åŠ æ–‡æ¡£/ç›®å½•ï¼Œä¸€æ¬¡å¯æŒ‡å®šå¤šä¸ªè¦å‹ç¼©çš„æ–‡æ¡£æˆ–ç›®å½•) è§£å‹ï¼š7z x file.7z -o directory (è§£å‹åˆ°æŒ‡å®šç›®å½•) æµ‹è¯•å®Œæ•´æ€§ï¼š 7z t file.7z p7zip å®‰è£…å¥½åï¼Œä¼šæä¾› 7zã€7zaã€7zr ä¸‰ä¸ªæŒ‡ä»¤ï¼Œä¸€èˆ¬æ¥è¯´ç›´æ¥ç”¨ 7z å°±è¡Œã€‚ P.S. 7z ä¸ä¼šä¿å­˜ Linux æ–‡æ¡£çš„ç”¨æˆ·ã€ç”¨æˆ·ç»„ä¿¡æ¯ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥ç”¨äº Linux ç³»ç»Ÿå¤‡ä»½ï¼Œæ­¤æ—¶å»ºè®®ç”¨ tar.xz æˆ– tar.7zï¼ˆä¹Ÿå°±æ˜¯å…ˆç”¨taræ‰“åŒ…ï¼‰ 4. raræ ¼å¼ï¼ˆè¿˜æ˜¯é‚£å¥è¯ï¼Œæ›´å¤šçš„è¯·manï¼‰rar æ˜¯éå¼€æºçš„æ ¼å¼ï¼ŒLinux é»˜è®¤æ˜¯ä¸ä¼šåŒ…å« rar å‹ç¼©è½¯ä»¶çš„ï¼Œä½†æ˜¯å®ƒçš„è§£å‹è½¯ä»¶æ˜¯å¼€æºçš„ï¼Œdeepin è‡ªå¸¦ unrarï¼Œé¡ºä¾¿ 7zip ä¹Ÿå¯è§£å‹ rar æ–‡æ¡£ã€‚è‹¥æƒ³ç”¨linuxåˆ›å»ºrarå‹ç¼©æ¡£ï¼Œéœ€è¦ä»rarlabä¸Šä¸‹è½½ Linux ç‰ˆï¼Œï¼ˆdeepinæºè‡ªå¸¦ï¼‰ä¸è¿‡è¦æ³¨æ„çš„æ˜¯è¯¥ linux ç‰ˆæ˜¯ 40 å¤©è¯•ç”¨ç‰ˆï¼Œè¦é•¿æœŸä½¿ç”¨çš„è¯ï¼Œå¯èƒ½éœ€è¦ç ´è§£ã€‚ï¼ˆrar çš„ key ç½‘ä¸Šä¸€æœä¸€å¤§æŠŠï¼‰ å‹ç¼©ï¼šrar a file.rar file ï¼ˆè¿™ä¸ªæ˜¯è¯•ç”¨çš„ï¼‰ è§£å‹ï¼šunrar x file.rar ï¼ˆè¿™ä¸ªå¼€æºå…è´¹ï¼‰ å…¶å®æˆ‘æŒºä¸­æ„ rar çš„ä¿®å¤åŠŸèƒ½çš„ï¼Œä¸çŸ¥é“ä¸ºå•¥ 7z xz è¿™æ ·çš„æ–°æ ¼å¼æ²¡æœ‰æ·»åŠ ç±»ä¼¼çš„recorvery recordsã€‚ä¸Šæ¬¡ä¸‹ä¸ª idea çš„ tarballï¼Œä¸‹äº†å››äº”æ¬¡æ‰ä¸‹åˆ°ä¸€ä¸ªå®Œæ•´çš„ï¼Œè¦æ˜¯ç”¨rar çš„è¯ï¼Œå¤§æ¦‚ä¸€é”®ä¿®å¤å°±å¥½äº†ï¼Œå¯ tar.gz æˆ‘ä¸çŸ¥é“æ€å¹ºä¿®å¤ï¼Œåªå¥½ä¸€ééé‡å¤ä¸‹è½½ã€‚ã€‚ ","date":"2019-01-14","objectID":"/posts/compression-related-instructions-under-linux/:5:1","series":null,"tags":["Linux","Compression","å‹ç¼©","tar"],"title":"å¸¸è§å‹ç¼©æ ¼å¼çš„åŒºåˆ«ï¼ŒåŠ Linux ä¸‹çš„å‹ç¼©ç›¸å…³æŒ‡ä»¤","uri":"/posts/compression-related-instructions-under-linux/#é€‰é¡¹ä¸å‚æ•°"},{"categories":["tech"],"content":" 1. tar æŒ‡ä»¤é€šè¿‡ä¹‹å‰çš„ä»‹ç»ï¼Œå¯ä»¥çœ‹å‡ºå¸¸ç”¨çš„å°±æ˜¯ tar gzip xz ç­‰ï¼Œå¦‚æœè¦å‹ç¼©å¤šä¸ªæ–‡æ¡£ï¼Œéœ€è¦å…ˆä½¿ç”¨tarï¼Œå†ç”¨ç®¡é“é‡å®šå‘åˆ° gzip æˆ– xzï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œè€Œè¿™å‡ ä¸ªæŒ‡ä»¤åˆå¾ˆå¸¸ç”¨ã€‚äºæ˜¯åæ¥å¯¹taråšäº†å¢å¼ºã€‚tar æœ€åˆåªæ˜¯ä¸€ä¸ªå½’æ¡£è¿›ç¨‹ï¼Œè€Œå‹ç¼©åˆ™ç”±å…¶ä»–çš„å‹ç¼©è½¯ä»¶æ¥å®Œæˆï¼ˆä¸€ä¸ªè¿›ç¨‹åªå¹²ä¸€ä»¶äº‹ï¼‰ã€‚åæ¥ä¸ºäº†æ–¹ä¾¿ï¼Œä¸§å¿ƒç—…ç‹‚åœ°é›†æˆäº†å„ç§å‹ç¼©æŒ‡ä»¤ã€‚å› æ­¤è¿™é‡Œå°±åªä»‹ç»è¿™ä¸€ä¸ªå‘½ä»¤äº†ï¼ˆå®ƒå›Šæ‹¬äº†æ‰€æœ‰ï¼‰ã€‚tar çš„é€‰é¡¹ä¸å‚æ•°éå¸¸çš„å¤šï¼æˆ‘ä»¬åªè®²å‡ ä¸ªå¸¸ç”¨çš„é€‰é¡¹ï¼Œæ›´å¤šé€‰é¡¹æ‚¨å¯ä»¥è‡ªè¡Œ man tar æŸ¥è¯¢å•°ï¼ bash [dmtsai@study ~]$ tar [-z|-j|-J] [cv] [-f å¾…åˆ›å»ºçš„æ–°æ¡£å] filename... \u003c==æ‰“åŒ…ä¸å‹ç¼© [dmtsai@study ~]$ tar [-z|-j|-J] [tv] [-f æ—¢æœ‰çš„ taræ¡£å] \u003c==å¯Ÿçœ‹æ¡£å [dmtsai@study ~]$ tar [-z|-j|-J] [xv] [-f æ—¢æœ‰çš„ taræ¡£å] [-C ç›®å½•] \u003c==è§£å‹ç¼© é€‰é¡¹ä¸å‚æ•°-c ï¼šåˆ›å»ºæ‰“åŒ…æ¡£æ¡ˆï¼Œå¯æ­é… -v æ¥å¯Ÿçœ‹è¿‡ç¨‹ä¸­è¢«æ‰“åŒ…çš„æ¡£å(filename) -t ï¼šå¯Ÿçœ‹æ‰“åŒ…æ¡£æ¡ˆçš„å†…å®¹å«æœ‰å“ªäº›æ¡£åï¼Œé‡ç‚¹åœ¨å¯Ÿçœ‹ã€æ¡£åã€å°±æ˜¯äº†ï¼› -x ï¼šè§£æ‰“åŒ…æˆ–è§£å‹ç¼©çš„åŠŸèƒ½ï¼Œå¯ä»¥æ­é… -C (å¤§å†™) åœ¨ç‰¹å®šç›®å½•è§£å¼€ ç‰¹åˆ«ç•™æ„çš„æ˜¯ï¼Œ -c, -t, -x ä¸å¯åŒæ—¶å‡ºç°åœ¨ä¸€ä¸²æŒ‡ä»¤åˆ—ä¸­ã€‚ -z ï¼šé€è¿‡ gzip çš„æ”¯æŒè¿›è¡Œå‹ç¼©/è§£å‹ç¼©ï¼šæ­¤æ—¶æ¡£åæœ€å¥½ä¸º *.tar.gz -j ï¼šé€è¿‡ bzip2 çš„æ”¯æŒè¿›è¡Œå‹ç¼©/è§£å‹ç¼©ï¼šæ­¤æ—¶æ¡£åæœ€å¥½ä¸º *.tar.bz2 -J ï¼šé€è¿‡ xz çš„æ”¯æŒè¿›è¡Œå‹ç¼©/è§£å‹ç¼©ï¼šæ­¤æ—¶æ¡£åæœ€å¥½ä¸º *.tar.xz ç‰¹åˆ«ç•™æ„ï¼Œ -z, -j, -J ä¸å¯ä»¥åŒæ—¶å‡ºç°åœ¨ä¸€ä¸²æŒ‡ä»¤åˆ—ä¸­ -v ï¼šåœ¨å‹ç¼©/è§£å‹ç¼©çš„è¿‡ç¨‹ä¸­ï¼Œå°†æ­£åœ¨å¤„ç†çš„æ¡£åæ˜¾ç¤ºå‡ºæ¥ï¼ -f filenameï¼š-f åé¢è¦ç«‹åˆ»æ¥è¦è¢«å¤„ç†çš„æ¡£åï¼å»ºè®® -f å•ç‹¬å†™ä¸€ä¸ªé€‰é¡¹å•°ï¼(æ¯”è¾ƒä¸ä¼šå¿˜è®°) -C ç›®å½• ï¼šè¿™ä¸ªé€‰é¡¹ç”¨åœ¨è§£å‹ç¼©ï¼Œè‹¥è¦åœ¨ç‰¹å®šç›®å½•è§£å‹ç¼©ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ã€‚ å…¶ä»–åç»­ç»ƒä¹ ä¼šä½¿ç”¨åˆ°çš„é€‰é¡¹ä»‹ç»ï¼š -p(å°å†™) ï¼šä¿ç•™å¤‡ä»½èµ„æ–™çš„åŸæœ¬æƒé™ä¸å±æ€§ï¼Œå¸¸ç”¨äºå¤‡ä»½(-c)é‡è¦çš„è®¾å®šæ¡£ -P(å¤§å†™) ï¼šä¿ç•™ç»å¯¹è·¯å¾„ï¼Œäº¦å³å…è®¸å¤‡ä»½èµ„æ–™ä¸­å«æœ‰æ ¹ç›®å½•å­˜åœ¨ä¹‹æ„ï¼›â€“exclude=FILEï¼šåœ¨å‹ç¼©çš„è¿‡ç¨‹ä¸­ï¼Œä¸è¦å°† FILE æ‰“åŒ…ï¼ å…¶å®æœ€ç®€å•çš„ä½¿ç”¨ tar å°±åªè¦è®°å¿†åº•ä¸‹çš„æ–¹å¼å³å¯ å‹ç¼©ï¼štar -zcv -f filename.tar.gz \u003cè¦è¢«å‹ç¼©çš„æ¡£æ¡ˆæˆ–ç›®å½•åç§°\u003e æŸ¥çœ‹æ–‡æ¡£æ ‘ï¼štar -ztv -f filename.tar.gz è§£å‹ç¼©ï¼štar -zxv -f filename.tar.gz -C \u003cæ¬²è§£å‹ç¼©çš„ç›®å½•\u003e` ä¸Šé¢çš„å‘½ä»¤éœ€è¦æ ¹æ®å‹ç¼©æ ¼å¼çš„ä¸åŒï¼Œé€‰ç”¨ -z -j -J é€‰é¡¹ï¼Œè€Œå®é™…ä¸Šæ–‡æ¡£çš„åç¼€å°±å·²ç»è¡¨æ˜äº†å®ƒçš„å‹ç¼©æ ¼å¼ï¼Œä¸å…è®©äººè§‰å¾—å¤šä½™ã€‚å› æ­¤å°±æœ‰è¿™å¹ºä¸€æ¡é€šç”¨çš„å‹ç¼©/è§£å‹ option -a, --auto-compress Use archive suffix to determine the compression program. ä½¿ç”¨è¿™ä¸ªï¼Œä¾¿æœ‰äº†é€šç”¨çš„è§£å‹æŒ‡ä»¤ï¼š tar -axv -f file.tar.* ï¼ˆå®ƒé€‚ç”¨äºä¸Šè¿°ä¸‰ç§å‹ç¼©æ ¼å¼ï¼‰ ä»…è§£å‹æŒ‡å®šçš„æ–‡æ¡£ å…ˆæŸ¥çœ‹æ–‡æ¡£æ ‘æ‰¾åˆ°éœ€è¦è§£å‹çš„æ–‡æ¡£çš„æ–‡æ¡£å tar -zxv -f æ‰“åŒ…æ¡£.tar.gz å¾…è§£å¼€æ¡£å æ‰“åŒ…æŸç›®å½•ï¼Œä½†ä¸å«è¯¥ç›®å½•ä¸‹çš„æŸäº›æ¡£æ¡ˆä¹‹ä½œæ³•ä½¿ç”¨ â€“exclude=FILE é€‰é¡¹ï¼ˆæ”¯æŒæ–‡æ¡£åçš„æ¨¡å¼åŒ¹é…ï¼Œè€Œä¸”å¯é‡å¤ï¼‰ tar -zcv -f filename.tar.gz directory --exclude=FILE1 --exclude=func* åªæ‰“åŒ…ç›®å½•ä¸­æ¯”æŒ‡å®šæ—¶åˆ»æ›´æ–°çš„æ–‡æ¡£ä½¿ç”¨ --newer-mtime=\"2015/06/17\" é€‰é¡¹ã€‚ tarfile, tarballtarfile | çº¯æ‰“åŒ…ã€æœªå‹ç¼©çš„ tar æ–‡æ¡£ tarball | å‹ç¼©äº†çš„ tar æ–‡æ¡£ 2. zipæ ¼å¼ï¼ˆlinux ä¸€èˆ¬ä¹Ÿä¼šè‡ªå¸¦ï¼Œè¯¦ç»†çš„è¯·manï¼‰ å‹ç¼©å‘½ä»¤ï¼šzip å‹ç¼©ç›®å½•ï¼šzip -r filename.zip directory r è¡¨ç¤ºé€’å½’å‹ç¼©ï¼Œå‹ç¼©åŒ…ä¼šåŒ…å«è¿™ä¸ªç›®å½• è§£å‹å‘½ä»¤ï¼šunzip è§£å‹åˆ°æŸç›®å½•ï¼šunzip -d directory filename.zip (-d dir è¡¨ç¤ºå°†å†…å®¹è§£å‹åˆ°dirç›®å½•å†…) -t æµ‹è¯•å‹ç¼©æ¡£çš„å®Œæ•´æ€§ -x filename æ’é™¤æŸæ–‡æ¡£ 3. 7zæ ¼å¼ï¼ˆéœ€è¦p7zipï¼Œdeepinè‡ªå¸¦ï¼Œæ›´å¤šçš„è¯·manï¼‰ æŸ¥çœ‹ç›®å½•æ ‘ï¼š7z l file.7z (List contents of archive) å‹ç¼©ï¼š7z a file.7z file1 directory1 (a ä¸ºåˆ›å»ºå‹ç¼©æ¡£æˆ–å‘å‹ç¼©æ¡£ä¸­æ·»åŠ æ–‡æ¡£/ç›®å½•ï¼Œä¸€æ¬¡å¯æŒ‡å®šå¤šä¸ªè¦å‹ç¼©çš„æ–‡æ¡£æˆ–ç›®å½•) è§£å‹ï¼š7z x file.7z -o directory (è§£å‹åˆ°æŒ‡å®šç›®å½•) æµ‹è¯•å®Œæ•´æ€§ï¼š 7z t file.7z p7zip å®‰è£…å¥½åï¼Œä¼šæä¾› 7zã€7zaã€7zr ä¸‰ä¸ªæŒ‡ä»¤ï¼Œä¸€èˆ¬æ¥è¯´ç›´æ¥ç”¨ 7z å°±è¡Œã€‚ P.S. 7z ä¸ä¼šä¿å­˜ Linux æ–‡æ¡£çš„ç”¨æˆ·ã€ç”¨æˆ·ç»„ä¿¡æ¯ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥ç”¨äº Linux ç³»ç»Ÿå¤‡ä»½ï¼Œæ­¤æ—¶å»ºè®®ç”¨ tar.xz æˆ– tar.7zï¼ˆä¹Ÿå°±æ˜¯å…ˆç”¨taræ‰“åŒ…ï¼‰ 4. raræ ¼å¼ï¼ˆè¿˜æ˜¯é‚£å¥è¯ï¼Œæ›´å¤šçš„è¯·manï¼‰rar æ˜¯éå¼€æºçš„æ ¼å¼ï¼ŒLinux é»˜è®¤æ˜¯ä¸ä¼šåŒ…å« rar å‹ç¼©è½¯ä»¶çš„ï¼Œä½†æ˜¯å®ƒçš„è§£å‹è½¯ä»¶æ˜¯å¼€æºçš„ï¼Œdeepin è‡ªå¸¦ unrarï¼Œé¡ºä¾¿ 7zip ä¹Ÿå¯è§£å‹ rar æ–‡æ¡£ã€‚è‹¥æƒ³ç”¨linuxåˆ›å»ºrarå‹ç¼©æ¡£ï¼Œéœ€è¦ä»rarlabä¸Šä¸‹è½½ Linux ç‰ˆï¼Œï¼ˆdeepinæºè‡ªå¸¦ï¼‰ä¸è¿‡è¦æ³¨æ„çš„æ˜¯è¯¥ linux ç‰ˆæ˜¯ 40 å¤©è¯•ç”¨ç‰ˆï¼Œè¦é•¿æœŸä½¿ç”¨çš„è¯ï¼Œå¯èƒ½éœ€è¦ç ´è§£ã€‚ï¼ˆrar çš„ key ç½‘ä¸Šä¸€æœä¸€å¤§æŠŠï¼‰ å‹ç¼©ï¼šrar a file.rar file ï¼ˆè¿™ä¸ªæ˜¯è¯•ç”¨çš„ï¼‰ è§£å‹ï¼šunrar x file.rar ï¼ˆè¿™ä¸ªå¼€æºå…è´¹ï¼‰ å…¶å®æˆ‘æŒºä¸­æ„ rar çš„ä¿®å¤åŠŸèƒ½çš„ï¼Œä¸çŸ¥é“ä¸ºå•¥ 7z xz è¿™æ ·çš„æ–°æ ¼å¼æ²¡æœ‰æ·»åŠ ç±»ä¼¼çš„recorvery recordsã€‚ä¸Šæ¬¡ä¸‹ä¸ª idea çš„ tarballï¼Œä¸‹äº†å››äº”æ¬¡æ‰ä¸‹åˆ°ä¸€ä¸ªå®Œæ•´çš„ï¼Œè¦æ˜¯ç”¨rar çš„è¯ï¼Œå¤§æ¦‚ä¸€é”®ä¿®å¤å°±å¥½äº†ï¼Œå¯ tar.gz æˆ‘ä¸çŸ¥é“æ€å¹ºä¿®å¤ï¼Œåªå¥½ä¸€ééé‡å¤ä¸‹è½½ã€‚ã€‚ ","date":"2019-01-14","objectID":"/posts/compression-related-instructions-under-linux/:5:1","series":null,"tags":["Linux","Compression","å‹ç¼©","tar"],"title":"å¸¸è§å‹ç¼©æ ¼å¼çš„åŒºåˆ«ï¼ŒåŠ Linux ä¸‹çš„å‹ç¼©ç›¸å…³æŒ‡ä»¤","uri":"/posts/compression-related-instructions-under-linux/#å…¶å®æœ€ç®€å•çš„ä½¿ç”¨-tar-å°±åªè¦è®°å¿†åº•ä¸‹çš„æ–¹å¼å³å¯"},{"categories":["tech"],"content":" 1. tar æŒ‡ä»¤é€šè¿‡ä¹‹å‰çš„ä»‹ç»ï¼Œå¯ä»¥çœ‹å‡ºå¸¸ç”¨çš„å°±æ˜¯ tar gzip xz ç­‰ï¼Œå¦‚æœè¦å‹ç¼©å¤šä¸ªæ–‡æ¡£ï¼Œéœ€è¦å…ˆä½¿ç”¨tarï¼Œå†ç”¨ç®¡é“é‡å®šå‘åˆ° gzip æˆ– xzï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œè€Œè¿™å‡ ä¸ªæŒ‡ä»¤åˆå¾ˆå¸¸ç”¨ã€‚äºæ˜¯åæ¥å¯¹taråšäº†å¢å¼ºã€‚tar æœ€åˆåªæ˜¯ä¸€ä¸ªå½’æ¡£è¿›ç¨‹ï¼Œè€Œå‹ç¼©åˆ™ç”±å…¶ä»–çš„å‹ç¼©è½¯ä»¶æ¥å®Œæˆï¼ˆä¸€ä¸ªè¿›ç¨‹åªå¹²ä¸€ä»¶äº‹ï¼‰ã€‚åæ¥ä¸ºäº†æ–¹ä¾¿ï¼Œä¸§å¿ƒç—…ç‹‚åœ°é›†æˆäº†å„ç§å‹ç¼©æŒ‡ä»¤ã€‚å› æ­¤è¿™é‡Œå°±åªä»‹ç»è¿™ä¸€ä¸ªå‘½ä»¤äº†ï¼ˆå®ƒå›Šæ‹¬äº†æ‰€æœ‰ï¼‰ã€‚tar çš„é€‰é¡¹ä¸å‚æ•°éå¸¸çš„å¤šï¼æˆ‘ä»¬åªè®²å‡ ä¸ªå¸¸ç”¨çš„é€‰é¡¹ï¼Œæ›´å¤šé€‰é¡¹æ‚¨å¯ä»¥è‡ªè¡Œ man tar æŸ¥è¯¢å•°ï¼ bash [dmtsai@study ~]$ tar [-z|-j|-J] [cv] [-f å¾…åˆ›å»ºçš„æ–°æ¡£å] filename... \u003c==æ‰“åŒ…ä¸å‹ç¼© [dmtsai@study ~]$ tar [-z|-j|-J] [tv] [-f æ—¢æœ‰çš„ taræ¡£å] \u003c==å¯Ÿçœ‹æ¡£å [dmtsai@study ~]$ tar [-z|-j|-J] [xv] [-f æ—¢æœ‰çš„ taræ¡£å] [-C ç›®å½•] \u003c==è§£å‹ç¼© é€‰é¡¹ä¸å‚æ•°-c ï¼šåˆ›å»ºæ‰“åŒ…æ¡£æ¡ˆï¼Œå¯æ­é… -v æ¥å¯Ÿçœ‹è¿‡ç¨‹ä¸­è¢«æ‰“åŒ…çš„æ¡£å(filename) -t ï¼šå¯Ÿçœ‹æ‰“åŒ…æ¡£æ¡ˆçš„å†…å®¹å«æœ‰å“ªäº›æ¡£åï¼Œé‡ç‚¹åœ¨å¯Ÿçœ‹ã€æ¡£åã€å°±æ˜¯äº†ï¼› -x ï¼šè§£æ‰“åŒ…æˆ–è§£å‹ç¼©çš„åŠŸèƒ½ï¼Œå¯ä»¥æ­é… -C (å¤§å†™) åœ¨ç‰¹å®šç›®å½•è§£å¼€ ç‰¹åˆ«ç•™æ„çš„æ˜¯ï¼Œ -c, -t, -x ä¸å¯åŒæ—¶å‡ºç°åœ¨ä¸€ä¸²æŒ‡ä»¤åˆ—ä¸­ã€‚ -z ï¼šé€è¿‡ gzip çš„æ”¯æŒè¿›è¡Œå‹ç¼©/è§£å‹ç¼©ï¼šæ­¤æ—¶æ¡£åæœ€å¥½ä¸º *.tar.gz -j ï¼šé€è¿‡ bzip2 çš„æ”¯æŒè¿›è¡Œå‹ç¼©/è§£å‹ç¼©ï¼šæ­¤æ—¶æ¡£åæœ€å¥½ä¸º *.tar.bz2 -J ï¼šé€è¿‡ xz çš„æ”¯æŒè¿›è¡Œå‹ç¼©/è§£å‹ç¼©ï¼šæ­¤æ—¶æ¡£åæœ€å¥½ä¸º *.tar.xz ç‰¹åˆ«ç•™æ„ï¼Œ -z, -j, -J ä¸å¯ä»¥åŒæ—¶å‡ºç°åœ¨ä¸€ä¸²æŒ‡ä»¤åˆ—ä¸­ -v ï¼šåœ¨å‹ç¼©/è§£å‹ç¼©çš„è¿‡ç¨‹ä¸­ï¼Œå°†æ­£åœ¨å¤„ç†çš„æ¡£åæ˜¾ç¤ºå‡ºæ¥ï¼ -f filenameï¼š-f åé¢è¦ç«‹åˆ»æ¥è¦è¢«å¤„ç†çš„æ¡£åï¼å»ºè®® -f å•ç‹¬å†™ä¸€ä¸ªé€‰é¡¹å•°ï¼(æ¯”è¾ƒä¸ä¼šå¿˜è®°) -C ç›®å½• ï¼šè¿™ä¸ªé€‰é¡¹ç”¨åœ¨è§£å‹ç¼©ï¼Œè‹¥è¦åœ¨ç‰¹å®šç›®å½•è§£å‹ç¼©ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ã€‚ å…¶ä»–åç»­ç»ƒä¹ ä¼šä½¿ç”¨åˆ°çš„é€‰é¡¹ä»‹ç»ï¼š -p(å°å†™) ï¼šä¿ç•™å¤‡ä»½èµ„æ–™çš„åŸæœ¬æƒé™ä¸å±æ€§ï¼Œå¸¸ç”¨äºå¤‡ä»½(-c)é‡è¦çš„è®¾å®šæ¡£ -P(å¤§å†™) ï¼šä¿ç•™ç»å¯¹è·¯å¾„ï¼Œäº¦å³å…è®¸å¤‡ä»½èµ„æ–™ä¸­å«æœ‰æ ¹ç›®å½•å­˜åœ¨ä¹‹æ„ï¼›â€“exclude=FILEï¼šåœ¨å‹ç¼©çš„è¿‡ç¨‹ä¸­ï¼Œä¸è¦å°† FILE æ‰“åŒ…ï¼ å…¶å®æœ€ç®€å•çš„ä½¿ç”¨ tar å°±åªè¦è®°å¿†åº•ä¸‹çš„æ–¹å¼å³å¯ å‹ç¼©ï¼štar -zcv -f filename.tar.gz \u003cè¦è¢«å‹ç¼©çš„æ¡£æ¡ˆæˆ–ç›®å½•åç§°\u003e æŸ¥çœ‹æ–‡æ¡£æ ‘ï¼štar -ztv -f filename.tar.gz è§£å‹ç¼©ï¼štar -zxv -f filename.tar.gz -C \u003cæ¬²è§£å‹ç¼©çš„ç›®å½•\u003e` ä¸Šé¢çš„å‘½ä»¤éœ€è¦æ ¹æ®å‹ç¼©æ ¼å¼çš„ä¸åŒï¼Œé€‰ç”¨ -z -j -J é€‰é¡¹ï¼Œè€Œå®é™…ä¸Šæ–‡æ¡£çš„åç¼€å°±å·²ç»è¡¨æ˜äº†å®ƒçš„å‹ç¼©æ ¼å¼ï¼Œä¸å…è®©äººè§‰å¾—å¤šä½™ã€‚å› æ­¤å°±æœ‰è¿™å¹ºä¸€æ¡é€šç”¨çš„å‹ç¼©/è§£å‹ option -a, --auto-compress Use archive suffix to determine the compression program. ä½¿ç”¨è¿™ä¸ªï¼Œä¾¿æœ‰äº†é€šç”¨çš„è§£å‹æŒ‡ä»¤ï¼š tar -axv -f file.tar.* ï¼ˆå®ƒé€‚ç”¨äºä¸Šè¿°ä¸‰ç§å‹ç¼©æ ¼å¼ï¼‰ ä»…è§£å‹æŒ‡å®šçš„æ–‡æ¡£ å…ˆæŸ¥çœ‹æ–‡æ¡£æ ‘æ‰¾åˆ°éœ€è¦è§£å‹çš„æ–‡æ¡£çš„æ–‡æ¡£å tar -zxv -f æ‰“åŒ…æ¡£.tar.gz å¾…è§£å¼€æ¡£å æ‰“åŒ…æŸç›®å½•ï¼Œä½†ä¸å«è¯¥ç›®å½•ä¸‹çš„æŸäº›æ¡£æ¡ˆä¹‹ä½œæ³•ä½¿ç”¨ â€“exclude=FILE é€‰é¡¹ï¼ˆæ”¯æŒæ–‡æ¡£åçš„æ¨¡å¼åŒ¹é…ï¼Œè€Œä¸”å¯é‡å¤ï¼‰ tar -zcv -f filename.tar.gz directory --exclude=FILE1 --exclude=func* åªæ‰“åŒ…ç›®å½•ä¸­æ¯”æŒ‡å®šæ—¶åˆ»æ›´æ–°çš„æ–‡æ¡£ä½¿ç”¨ --newer-mtime=\"2015/06/17\" é€‰é¡¹ã€‚ tarfile, tarballtarfile | çº¯æ‰“åŒ…ã€æœªå‹ç¼©çš„ tar æ–‡æ¡£ tarball | å‹ç¼©äº†çš„ tar æ–‡æ¡£ 2. zipæ ¼å¼ï¼ˆlinux ä¸€èˆ¬ä¹Ÿä¼šè‡ªå¸¦ï¼Œè¯¦ç»†çš„è¯·manï¼‰ å‹ç¼©å‘½ä»¤ï¼šzip å‹ç¼©ç›®å½•ï¼šzip -r filename.zip directory r è¡¨ç¤ºé€’å½’å‹ç¼©ï¼Œå‹ç¼©åŒ…ä¼šåŒ…å«è¿™ä¸ªç›®å½• è§£å‹å‘½ä»¤ï¼šunzip è§£å‹åˆ°æŸç›®å½•ï¼šunzip -d directory filename.zip (-d dir è¡¨ç¤ºå°†å†…å®¹è§£å‹åˆ°dirç›®å½•å†…) -t æµ‹è¯•å‹ç¼©æ¡£çš„å®Œæ•´æ€§ -x filename æ’é™¤æŸæ–‡æ¡£ 3. 7zæ ¼å¼ï¼ˆéœ€è¦p7zipï¼Œdeepinè‡ªå¸¦ï¼Œæ›´å¤šçš„è¯·manï¼‰ æŸ¥çœ‹ç›®å½•æ ‘ï¼š7z l file.7z (List contents of archive) å‹ç¼©ï¼š7z a file.7z file1 directory1 (a ä¸ºåˆ›å»ºå‹ç¼©æ¡£æˆ–å‘å‹ç¼©æ¡£ä¸­æ·»åŠ æ–‡æ¡£/ç›®å½•ï¼Œä¸€æ¬¡å¯æŒ‡å®šå¤šä¸ªè¦å‹ç¼©çš„æ–‡æ¡£æˆ–ç›®å½•) è§£å‹ï¼š7z x file.7z -o directory (è§£å‹åˆ°æŒ‡å®šç›®å½•) æµ‹è¯•å®Œæ•´æ€§ï¼š 7z t file.7z p7zip å®‰è£…å¥½åï¼Œä¼šæä¾› 7zã€7zaã€7zr ä¸‰ä¸ªæŒ‡ä»¤ï¼Œä¸€èˆ¬æ¥è¯´ç›´æ¥ç”¨ 7z å°±è¡Œã€‚ P.S. 7z ä¸ä¼šä¿å­˜ Linux æ–‡æ¡£çš„ç”¨æˆ·ã€ç”¨æˆ·ç»„ä¿¡æ¯ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥ç”¨äº Linux ç³»ç»Ÿå¤‡ä»½ï¼Œæ­¤æ—¶å»ºè®®ç”¨ tar.xz æˆ– tar.7zï¼ˆä¹Ÿå°±æ˜¯å…ˆç”¨taræ‰“åŒ…ï¼‰ 4. raræ ¼å¼ï¼ˆè¿˜æ˜¯é‚£å¥è¯ï¼Œæ›´å¤šçš„è¯·manï¼‰rar æ˜¯éå¼€æºçš„æ ¼å¼ï¼ŒLinux é»˜è®¤æ˜¯ä¸ä¼šåŒ…å« rar å‹ç¼©è½¯ä»¶çš„ï¼Œä½†æ˜¯å®ƒçš„è§£å‹è½¯ä»¶æ˜¯å¼€æºçš„ï¼Œdeepin è‡ªå¸¦ unrarï¼Œé¡ºä¾¿ 7zip ä¹Ÿå¯è§£å‹ rar æ–‡æ¡£ã€‚è‹¥æƒ³ç”¨linuxåˆ›å»ºrarå‹ç¼©æ¡£ï¼Œéœ€è¦ä»rarlabä¸Šä¸‹è½½ Linux ç‰ˆï¼Œï¼ˆdeepinæºè‡ªå¸¦ï¼‰ä¸è¿‡è¦æ³¨æ„çš„æ˜¯è¯¥ linux ç‰ˆæ˜¯ 40 å¤©è¯•ç”¨ç‰ˆï¼Œè¦é•¿æœŸä½¿ç”¨çš„è¯ï¼Œå¯èƒ½éœ€è¦ç ´è§£ã€‚ï¼ˆrar çš„ key ç½‘ä¸Šä¸€æœä¸€å¤§æŠŠï¼‰ å‹ç¼©ï¼šrar a file.rar file ï¼ˆè¿™ä¸ªæ˜¯è¯•ç”¨çš„ï¼‰ è§£å‹ï¼šunrar x file.rar ï¼ˆè¿™ä¸ªå¼€æºå…è´¹ï¼‰ å…¶å®æˆ‘æŒºä¸­æ„ rar çš„ä¿®å¤åŠŸèƒ½çš„ï¼Œä¸çŸ¥é“ä¸ºå•¥ 7z xz è¿™æ ·çš„æ–°æ ¼å¼æ²¡æœ‰æ·»åŠ ç±»ä¼¼çš„recorvery recordsã€‚ä¸Šæ¬¡ä¸‹ä¸ª idea çš„ tarballï¼Œä¸‹äº†å››äº”æ¬¡æ‰ä¸‹åˆ°ä¸€ä¸ªå®Œæ•´çš„ï¼Œè¦æ˜¯ç”¨rar çš„è¯ï¼Œå¤§æ¦‚ä¸€é”®ä¿®å¤å°±å¥½äº†ï¼Œå¯ tar.gz æˆ‘ä¸çŸ¥é“æ€å¹ºä¿®å¤ï¼Œåªå¥½ä¸€ééé‡å¤ä¸‹è½½ã€‚ã€‚ ","date":"2019-01-14","objectID":"/posts/compression-related-instructions-under-linux/:5:1","series":null,"tags":["Linux","Compression","å‹ç¼©","tar"],"title":"å¸¸è§å‹ç¼©æ ¼å¼çš„åŒºåˆ«ï¼ŒåŠ Linux ä¸‹çš„å‹ç¼©ç›¸å…³æŒ‡ä»¤","uri":"/posts/compression-related-instructions-under-linux/#ä»…è§£å‹æŒ‡å®šçš„æ–‡æ¡£"},{"categories":["tech"],"content":" 1. tar æŒ‡ä»¤é€šè¿‡ä¹‹å‰çš„ä»‹ç»ï¼Œå¯ä»¥çœ‹å‡ºå¸¸ç”¨çš„å°±æ˜¯ tar gzip xz ç­‰ï¼Œå¦‚æœè¦å‹ç¼©å¤šä¸ªæ–‡æ¡£ï¼Œéœ€è¦å…ˆä½¿ç”¨tarï¼Œå†ç”¨ç®¡é“é‡å®šå‘åˆ° gzip æˆ– xzï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œè€Œè¿™å‡ ä¸ªæŒ‡ä»¤åˆå¾ˆå¸¸ç”¨ã€‚äºæ˜¯åæ¥å¯¹taråšäº†å¢å¼ºã€‚tar æœ€åˆåªæ˜¯ä¸€ä¸ªå½’æ¡£è¿›ç¨‹ï¼Œè€Œå‹ç¼©åˆ™ç”±å…¶ä»–çš„å‹ç¼©è½¯ä»¶æ¥å®Œæˆï¼ˆä¸€ä¸ªè¿›ç¨‹åªå¹²ä¸€ä»¶äº‹ï¼‰ã€‚åæ¥ä¸ºäº†æ–¹ä¾¿ï¼Œä¸§å¿ƒç—…ç‹‚åœ°é›†æˆäº†å„ç§å‹ç¼©æŒ‡ä»¤ã€‚å› æ­¤è¿™é‡Œå°±åªä»‹ç»è¿™ä¸€ä¸ªå‘½ä»¤äº†ï¼ˆå®ƒå›Šæ‹¬äº†æ‰€æœ‰ï¼‰ã€‚tar çš„é€‰é¡¹ä¸å‚æ•°éå¸¸çš„å¤šï¼æˆ‘ä»¬åªè®²å‡ ä¸ªå¸¸ç”¨çš„é€‰é¡¹ï¼Œæ›´å¤šé€‰é¡¹æ‚¨å¯ä»¥è‡ªè¡Œ man tar æŸ¥è¯¢å•°ï¼ bash [dmtsai@study ~]$ tar [-z|-j|-J] [cv] [-f å¾…åˆ›å»ºçš„æ–°æ¡£å] filename... \u003c==æ‰“åŒ…ä¸å‹ç¼© [dmtsai@study ~]$ tar [-z|-j|-J] [tv] [-f æ—¢æœ‰çš„ taræ¡£å] \u003c==å¯Ÿçœ‹æ¡£å [dmtsai@study ~]$ tar [-z|-j|-J] [xv] [-f æ—¢æœ‰çš„ taræ¡£å] [-C ç›®å½•] \u003c==è§£å‹ç¼© é€‰é¡¹ä¸å‚æ•°-c ï¼šåˆ›å»ºæ‰“åŒ…æ¡£æ¡ˆï¼Œå¯æ­é… -v æ¥å¯Ÿçœ‹è¿‡ç¨‹ä¸­è¢«æ‰“åŒ…çš„æ¡£å(filename) -t ï¼šå¯Ÿçœ‹æ‰“åŒ…æ¡£æ¡ˆçš„å†…å®¹å«æœ‰å“ªäº›æ¡£åï¼Œé‡ç‚¹åœ¨å¯Ÿçœ‹ã€æ¡£åã€å°±æ˜¯äº†ï¼› -x ï¼šè§£æ‰“åŒ…æˆ–è§£å‹ç¼©çš„åŠŸèƒ½ï¼Œå¯ä»¥æ­é… -C (å¤§å†™) åœ¨ç‰¹å®šç›®å½•è§£å¼€ ç‰¹åˆ«ç•™æ„çš„æ˜¯ï¼Œ -c, -t, -x ä¸å¯åŒæ—¶å‡ºç°åœ¨ä¸€ä¸²æŒ‡ä»¤åˆ—ä¸­ã€‚ -z ï¼šé€è¿‡ gzip çš„æ”¯æŒè¿›è¡Œå‹ç¼©/è§£å‹ç¼©ï¼šæ­¤æ—¶æ¡£åæœ€å¥½ä¸º *.tar.gz -j ï¼šé€è¿‡ bzip2 çš„æ”¯æŒè¿›è¡Œå‹ç¼©/è§£å‹ç¼©ï¼šæ­¤æ—¶æ¡£åæœ€å¥½ä¸º *.tar.bz2 -J ï¼šé€è¿‡ xz çš„æ”¯æŒè¿›è¡Œå‹ç¼©/è§£å‹ç¼©ï¼šæ­¤æ—¶æ¡£åæœ€å¥½ä¸º *.tar.xz ç‰¹åˆ«ç•™æ„ï¼Œ -z, -j, -J ä¸å¯ä»¥åŒæ—¶å‡ºç°åœ¨ä¸€ä¸²æŒ‡ä»¤åˆ—ä¸­ -v ï¼šåœ¨å‹ç¼©/è§£å‹ç¼©çš„è¿‡ç¨‹ä¸­ï¼Œå°†æ­£åœ¨å¤„ç†çš„æ¡£åæ˜¾ç¤ºå‡ºæ¥ï¼ -f filenameï¼š-f åé¢è¦ç«‹åˆ»æ¥è¦è¢«å¤„ç†çš„æ¡£åï¼å»ºè®® -f å•ç‹¬å†™ä¸€ä¸ªé€‰é¡¹å•°ï¼(æ¯”è¾ƒä¸ä¼šå¿˜è®°) -C ç›®å½• ï¼šè¿™ä¸ªé€‰é¡¹ç”¨åœ¨è§£å‹ç¼©ï¼Œè‹¥è¦åœ¨ç‰¹å®šç›®å½•è§£å‹ç¼©ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ã€‚ å…¶ä»–åç»­ç»ƒä¹ ä¼šä½¿ç”¨åˆ°çš„é€‰é¡¹ä»‹ç»ï¼š -p(å°å†™) ï¼šä¿ç•™å¤‡ä»½èµ„æ–™çš„åŸæœ¬æƒé™ä¸å±æ€§ï¼Œå¸¸ç”¨äºå¤‡ä»½(-c)é‡è¦çš„è®¾å®šæ¡£ -P(å¤§å†™) ï¼šä¿ç•™ç»å¯¹è·¯å¾„ï¼Œäº¦å³å…è®¸å¤‡ä»½èµ„æ–™ä¸­å«æœ‰æ ¹ç›®å½•å­˜åœ¨ä¹‹æ„ï¼›â€“exclude=FILEï¼šåœ¨å‹ç¼©çš„è¿‡ç¨‹ä¸­ï¼Œä¸è¦å°† FILE æ‰“åŒ…ï¼ å…¶å®æœ€ç®€å•çš„ä½¿ç”¨ tar å°±åªè¦è®°å¿†åº•ä¸‹çš„æ–¹å¼å³å¯ å‹ç¼©ï¼štar -zcv -f filename.tar.gz \u003cè¦è¢«å‹ç¼©çš„æ¡£æ¡ˆæˆ–ç›®å½•åç§°\u003e æŸ¥çœ‹æ–‡æ¡£æ ‘ï¼štar -ztv -f filename.tar.gz è§£å‹ç¼©ï¼štar -zxv -f filename.tar.gz -C \u003cæ¬²è§£å‹ç¼©çš„ç›®å½•\u003e` ä¸Šé¢çš„å‘½ä»¤éœ€è¦æ ¹æ®å‹ç¼©æ ¼å¼çš„ä¸åŒï¼Œé€‰ç”¨ -z -j -J é€‰é¡¹ï¼Œè€Œå®é™…ä¸Šæ–‡æ¡£çš„åç¼€å°±å·²ç»è¡¨æ˜äº†å®ƒçš„å‹ç¼©æ ¼å¼ï¼Œä¸å…è®©äººè§‰å¾—å¤šä½™ã€‚å› æ­¤å°±æœ‰è¿™å¹ºä¸€æ¡é€šç”¨çš„å‹ç¼©/è§£å‹ option -a, --auto-compress Use archive suffix to determine the compression program. ä½¿ç”¨è¿™ä¸ªï¼Œä¾¿æœ‰äº†é€šç”¨çš„è§£å‹æŒ‡ä»¤ï¼š tar -axv -f file.tar.* ï¼ˆå®ƒé€‚ç”¨äºä¸Šè¿°ä¸‰ç§å‹ç¼©æ ¼å¼ï¼‰ ä»…è§£å‹æŒ‡å®šçš„æ–‡æ¡£ å…ˆæŸ¥çœ‹æ–‡æ¡£æ ‘æ‰¾åˆ°éœ€è¦è§£å‹çš„æ–‡æ¡£çš„æ–‡æ¡£å tar -zxv -f æ‰“åŒ…æ¡£.tar.gz å¾…è§£å¼€æ¡£å æ‰“åŒ…æŸç›®å½•ï¼Œä½†ä¸å«è¯¥ç›®å½•ä¸‹çš„æŸäº›æ¡£æ¡ˆä¹‹ä½œæ³•ä½¿ç”¨ â€“exclude=FILE é€‰é¡¹ï¼ˆæ”¯æŒæ–‡æ¡£åçš„æ¨¡å¼åŒ¹é…ï¼Œè€Œä¸”å¯é‡å¤ï¼‰ tar -zcv -f filename.tar.gz directory --exclude=FILE1 --exclude=func* åªæ‰“åŒ…ç›®å½•ä¸­æ¯”æŒ‡å®šæ—¶åˆ»æ›´æ–°çš„æ–‡æ¡£ä½¿ç”¨ --newer-mtime=\"2015/06/17\" é€‰é¡¹ã€‚ tarfile, tarballtarfile | çº¯æ‰“åŒ…ã€æœªå‹ç¼©çš„ tar æ–‡æ¡£ tarball | å‹ç¼©äº†çš„ tar æ–‡æ¡£ 2. zipæ ¼å¼ï¼ˆlinux ä¸€èˆ¬ä¹Ÿä¼šè‡ªå¸¦ï¼Œè¯¦ç»†çš„è¯·manï¼‰ å‹ç¼©å‘½ä»¤ï¼šzip å‹ç¼©ç›®å½•ï¼šzip -r filename.zip directory r è¡¨ç¤ºé€’å½’å‹ç¼©ï¼Œå‹ç¼©åŒ…ä¼šåŒ…å«è¿™ä¸ªç›®å½• è§£å‹å‘½ä»¤ï¼šunzip è§£å‹åˆ°æŸç›®å½•ï¼šunzip -d directory filename.zip (-d dir è¡¨ç¤ºå°†å†…å®¹è§£å‹åˆ°dirç›®å½•å†…) -t æµ‹è¯•å‹ç¼©æ¡£çš„å®Œæ•´æ€§ -x filename æ’é™¤æŸæ–‡æ¡£ 3. 7zæ ¼å¼ï¼ˆéœ€è¦p7zipï¼Œdeepinè‡ªå¸¦ï¼Œæ›´å¤šçš„è¯·manï¼‰ æŸ¥çœ‹ç›®å½•æ ‘ï¼š7z l file.7z (List contents of archive) å‹ç¼©ï¼š7z a file.7z file1 directory1 (a ä¸ºåˆ›å»ºå‹ç¼©æ¡£æˆ–å‘å‹ç¼©æ¡£ä¸­æ·»åŠ æ–‡æ¡£/ç›®å½•ï¼Œä¸€æ¬¡å¯æŒ‡å®šå¤šä¸ªè¦å‹ç¼©çš„æ–‡æ¡£æˆ–ç›®å½•) è§£å‹ï¼š7z x file.7z -o directory (è§£å‹åˆ°æŒ‡å®šç›®å½•) æµ‹è¯•å®Œæ•´æ€§ï¼š 7z t file.7z p7zip å®‰è£…å¥½åï¼Œä¼šæä¾› 7zã€7zaã€7zr ä¸‰ä¸ªæŒ‡ä»¤ï¼Œä¸€èˆ¬æ¥è¯´ç›´æ¥ç”¨ 7z å°±è¡Œã€‚ P.S. 7z ä¸ä¼šä¿å­˜ Linux æ–‡æ¡£çš„ç”¨æˆ·ã€ç”¨æˆ·ç»„ä¿¡æ¯ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥ç”¨äº Linux ç³»ç»Ÿå¤‡ä»½ï¼Œæ­¤æ—¶å»ºè®®ç”¨ tar.xz æˆ– tar.7zï¼ˆä¹Ÿå°±æ˜¯å…ˆç”¨taræ‰“åŒ…ï¼‰ 4. raræ ¼å¼ï¼ˆè¿˜æ˜¯é‚£å¥è¯ï¼Œæ›´å¤šçš„è¯·manï¼‰rar æ˜¯éå¼€æºçš„æ ¼å¼ï¼ŒLinux é»˜è®¤æ˜¯ä¸ä¼šåŒ…å« rar å‹ç¼©è½¯ä»¶çš„ï¼Œä½†æ˜¯å®ƒçš„è§£å‹è½¯ä»¶æ˜¯å¼€æºçš„ï¼Œdeepin è‡ªå¸¦ unrarï¼Œé¡ºä¾¿ 7zip ä¹Ÿå¯è§£å‹ rar æ–‡æ¡£ã€‚è‹¥æƒ³ç”¨linuxåˆ›å»ºrarå‹ç¼©æ¡£ï¼Œéœ€è¦ä»rarlabä¸Šä¸‹è½½ Linux ç‰ˆï¼Œï¼ˆdeepinæºè‡ªå¸¦ï¼‰ä¸è¿‡è¦æ³¨æ„çš„æ˜¯è¯¥ linux ç‰ˆæ˜¯ 40 å¤©è¯•ç”¨ç‰ˆï¼Œè¦é•¿æœŸä½¿ç”¨çš„è¯ï¼Œå¯èƒ½éœ€è¦ç ´è§£ã€‚ï¼ˆrar çš„ key ç½‘ä¸Šä¸€æœä¸€å¤§æŠŠï¼‰ å‹ç¼©ï¼šrar a file.rar file ï¼ˆè¿™ä¸ªæ˜¯è¯•ç”¨çš„ï¼‰ è§£å‹ï¼šunrar x file.rar ï¼ˆè¿™ä¸ªå¼€æºå…è´¹ï¼‰ å…¶å®æˆ‘æŒºä¸­æ„ rar çš„ä¿®å¤åŠŸèƒ½çš„ï¼Œä¸çŸ¥é“ä¸ºå•¥ 7z xz è¿™æ ·çš„æ–°æ ¼å¼æ²¡æœ‰æ·»åŠ ç±»ä¼¼çš„recorvery recordsã€‚ä¸Šæ¬¡ä¸‹ä¸ª idea çš„ tarballï¼Œä¸‹äº†å››äº”æ¬¡æ‰ä¸‹åˆ°ä¸€ä¸ªå®Œæ•´çš„ï¼Œè¦æ˜¯ç”¨rar çš„è¯ï¼Œå¤§æ¦‚ä¸€é”®ä¿®å¤å°±å¥½äº†ï¼Œå¯ tar.gz æˆ‘ä¸çŸ¥é“æ€å¹ºä¿®å¤ï¼Œåªå¥½ä¸€ééé‡å¤ä¸‹è½½ã€‚ã€‚ ","date":"2019-01-14","objectID":"/posts/compression-related-instructions-under-linux/:5:1","series":null,"tags":["Linux","Compression","å‹ç¼©","tar"],"title":"å¸¸è§å‹ç¼©æ ¼å¼çš„åŒºåˆ«ï¼ŒåŠ Linux ä¸‹çš„å‹ç¼©ç›¸å…³æŒ‡ä»¤","uri":"/posts/compression-related-instructions-under-linux/#æ‰“åŒ…æŸç›®å½•ä½†ä¸å«è¯¥ç›®å½•ä¸‹çš„æŸäº›æ¡£æ¡ˆä¹‹ä½œæ³•"},{"categories":["tech"],"content":" 1. tar æŒ‡ä»¤é€šè¿‡ä¹‹å‰çš„ä»‹ç»ï¼Œå¯ä»¥çœ‹å‡ºå¸¸ç”¨çš„å°±æ˜¯ tar gzip xz ç­‰ï¼Œå¦‚æœè¦å‹ç¼©å¤šä¸ªæ–‡æ¡£ï¼Œéœ€è¦å…ˆä½¿ç”¨tarï¼Œå†ç”¨ç®¡é“é‡å®šå‘åˆ° gzip æˆ– xzï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œè€Œè¿™å‡ ä¸ªæŒ‡ä»¤åˆå¾ˆå¸¸ç”¨ã€‚äºæ˜¯åæ¥å¯¹taråšäº†å¢å¼ºã€‚tar æœ€åˆåªæ˜¯ä¸€ä¸ªå½’æ¡£è¿›ç¨‹ï¼Œè€Œå‹ç¼©åˆ™ç”±å…¶ä»–çš„å‹ç¼©è½¯ä»¶æ¥å®Œæˆï¼ˆä¸€ä¸ªè¿›ç¨‹åªå¹²ä¸€ä»¶äº‹ï¼‰ã€‚åæ¥ä¸ºäº†æ–¹ä¾¿ï¼Œä¸§å¿ƒç—…ç‹‚åœ°é›†æˆäº†å„ç§å‹ç¼©æŒ‡ä»¤ã€‚å› æ­¤è¿™é‡Œå°±åªä»‹ç»è¿™ä¸€ä¸ªå‘½ä»¤äº†ï¼ˆå®ƒå›Šæ‹¬äº†æ‰€æœ‰ï¼‰ã€‚tar çš„é€‰é¡¹ä¸å‚æ•°éå¸¸çš„å¤šï¼æˆ‘ä»¬åªè®²å‡ ä¸ªå¸¸ç”¨çš„é€‰é¡¹ï¼Œæ›´å¤šé€‰é¡¹æ‚¨å¯ä»¥è‡ªè¡Œ man tar æŸ¥è¯¢å•°ï¼ bash [dmtsai@study ~]$ tar [-z|-j|-J] [cv] [-f å¾…åˆ›å»ºçš„æ–°æ¡£å] filename... \u003c==æ‰“åŒ…ä¸å‹ç¼© [dmtsai@study ~]$ tar [-z|-j|-J] [tv] [-f æ—¢æœ‰çš„ taræ¡£å] \u003c==å¯Ÿçœ‹æ¡£å [dmtsai@study ~]$ tar [-z|-j|-J] [xv] [-f æ—¢æœ‰çš„ taræ¡£å] [-C ç›®å½•] \u003c==è§£å‹ç¼© é€‰é¡¹ä¸å‚æ•°-c ï¼šåˆ›å»ºæ‰“åŒ…æ¡£æ¡ˆï¼Œå¯æ­é… -v æ¥å¯Ÿçœ‹è¿‡ç¨‹ä¸­è¢«æ‰“åŒ…çš„æ¡£å(filename) -t ï¼šå¯Ÿçœ‹æ‰“åŒ…æ¡£æ¡ˆçš„å†…å®¹å«æœ‰å“ªäº›æ¡£åï¼Œé‡ç‚¹åœ¨å¯Ÿçœ‹ã€æ¡£åã€å°±æ˜¯äº†ï¼› -x ï¼šè§£æ‰“åŒ…æˆ–è§£å‹ç¼©çš„åŠŸèƒ½ï¼Œå¯ä»¥æ­é… -C (å¤§å†™) åœ¨ç‰¹å®šç›®å½•è§£å¼€ ç‰¹åˆ«ç•™æ„çš„æ˜¯ï¼Œ -c, -t, -x ä¸å¯åŒæ—¶å‡ºç°åœ¨ä¸€ä¸²æŒ‡ä»¤åˆ—ä¸­ã€‚ -z ï¼šé€è¿‡ gzip çš„æ”¯æŒè¿›è¡Œå‹ç¼©/è§£å‹ç¼©ï¼šæ­¤æ—¶æ¡£åæœ€å¥½ä¸º *.tar.gz -j ï¼šé€è¿‡ bzip2 çš„æ”¯æŒè¿›è¡Œå‹ç¼©/è§£å‹ç¼©ï¼šæ­¤æ—¶æ¡£åæœ€å¥½ä¸º *.tar.bz2 -J ï¼šé€è¿‡ xz çš„æ”¯æŒè¿›è¡Œå‹ç¼©/è§£å‹ç¼©ï¼šæ­¤æ—¶æ¡£åæœ€å¥½ä¸º *.tar.xz ç‰¹åˆ«ç•™æ„ï¼Œ -z, -j, -J ä¸å¯ä»¥åŒæ—¶å‡ºç°åœ¨ä¸€ä¸²æŒ‡ä»¤åˆ—ä¸­ -v ï¼šåœ¨å‹ç¼©/è§£å‹ç¼©çš„è¿‡ç¨‹ä¸­ï¼Œå°†æ­£åœ¨å¤„ç†çš„æ¡£åæ˜¾ç¤ºå‡ºæ¥ï¼ -f filenameï¼š-f åé¢è¦ç«‹åˆ»æ¥è¦è¢«å¤„ç†çš„æ¡£åï¼å»ºè®® -f å•ç‹¬å†™ä¸€ä¸ªé€‰é¡¹å•°ï¼(æ¯”è¾ƒä¸ä¼šå¿˜è®°) -C ç›®å½• ï¼šè¿™ä¸ªé€‰é¡¹ç”¨åœ¨è§£å‹ç¼©ï¼Œè‹¥è¦åœ¨ç‰¹å®šç›®å½•è§£å‹ç¼©ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ã€‚ å…¶ä»–åç»­ç»ƒä¹ ä¼šä½¿ç”¨åˆ°çš„é€‰é¡¹ä»‹ç»ï¼š -p(å°å†™) ï¼šä¿ç•™å¤‡ä»½èµ„æ–™çš„åŸæœ¬æƒé™ä¸å±æ€§ï¼Œå¸¸ç”¨äºå¤‡ä»½(-c)é‡è¦çš„è®¾å®šæ¡£ -P(å¤§å†™) ï¼šä¿ç•™ç»å¯¹è·¯å¾„ï¼Œäº¦å³å…è®¸å¤‡ä»½èµ„æ–™ä¸­å«æœ‰æ ¹ç›®å½•å­˜åœ¨ä¹‹æ„ï¼›â€“exclude=FILEï¼šåœ¨å‹ç¼©çš„è¿‡ç¨‹ä¸­ï¼Œä¸è¦å°† FILE æ‰“åŒ…ï¼ å…¶å®æœ€ç®€å•çš„ä½¿ç”¨ tar å°±åªè¦è®°å¿†åº•ä¸‹çš„æ–¹å¼å³å¯ å‹ç¼©ï¼štar -zcv -f filename.tar.gz \u003cè¦è¢«å‹ç¼©çš„æ¡£æ¡ˆæˆ–ç›®å½•åç§°\u003e æŸ¥çœ‹æ–‡æ¡£æ ‘ï¼štar -ztv -f filename.tar.gz è§£å‹ç¼©ï¼štar -zxv -f filename.tar.gz -C \u003cæ¬²è§£å‹ç¼©çš„ç›®å½•\u003e` ä¸Šé¢çš„å‘½ä»¤éœ€è¦æ ¹æ®å‹ç¼©æ ¼å¼çš„ä¸åŒï¼Œé€‰ç”¨ -z -j -J é€‰é¡¹ï¼Œè€Œå®é™…ä¸Šæ–‡æ¡£çš„åç¼€å°±å·²ç»è¡¨æ˜äº†å®ƒçš„å‹ç¼©æ ¼å¼ï¼Œä¸å…è®©äººè§‰å¾—å¤šä½™ã€‚å› æ­¤å°±æœ‰è¿™å¹ºä¸€æ¡é€šç”¨çš„å‹ç¼©/è§£å‹ option -a, --auto-compress Use archive suffix to determine the compression program. ä½¿ç”¨è¿™ä¸ªï¼Œä¾¿æœ‰äº†é€šç”¨çš„è§£å‹æŒ‡ä»¤ï¼š tar -axv -f file.tar.* ï¼ˆå®ƒé€‚ç”¨äºä¸Šè¿°ä¸‰ç§å‹ç¼©æ ¼å¼ï¼‰ ä»…è§£å‹æŒ‡å®šçš„æ–‡æ¡£ å…ˆæŸ¥çœ‹æ–‡æ¡£æ ‘æ‰¾åˆ°éœ€è¦è§£å‹çš„æ–‡æ¡£çš„æ–‡æ¡£å tar -zxv -f æ‰“åŒ…æ¡£.tar.gz å¾…è§£å¼€æ¡£å æ‰“åŒ…æŸç›®å½•ï¼Œä½†ä¸å«è¯¥ç›®å½•ä¸‹çš„æŸäº›æ¡£æ¡ˆä¹‹ä½œæ³•ä½¿ç”¨ â€“exclude=FILE é€‰é¡¹ï¼ˆæ”¯æŒæ–‡æ¡£åçš„æ¨¡å¼åŒ¹é…ï¼Œè€Œä¸”å¯é‡å¤ï¼‰ tar -zcv -f filename.tar.gz directory --exclude=FILE1 --exclude=func* åªæ‰“åŒ…ç›®å½•ä¸­æ¯”æŒ‡å®šæ—¶åˆ»æ›´æ–°çš„æ–‡æ¡£ä½¿ç”¨ --newer-mtime=\"2015/06/17\" é€‰é¡¹ã€‚ tarfile, tarballtarfile | çº¯æ‰“åŒ…ã€æœªå‹ç¼©çš„ tar æ–‡æ¡£ tarball | å‹ç¼©äº†çš„ tar æ–‡æ¡£ 2. zipæ ¼å¼ï¼ˆlinux ä¸€èˆ¬ä¹Ÿä¼šè‡ªå¸¦ï¼Œè¯¦ç»†çš„è¯·manï¼‰ å‹ç¼©å‘½ä»¤ï¼šzip å‹ç¼©ç›®å½•ï¼šzip -r filename.zip directory r è¡¨ç¤ºé€’å½’å‹ç¼©ï¼Œå‹ç¼©åŒ…ä¼šåŒ…å«è¿™ä¸ªç›®å½• è§£å‹å‘½ä»¤ï¼šunzip è§£å‹åˆ°æŸç›®å½•ï¼šunzip -d directory filename.zip (-d dir è¡¨ç¤ºå°†å†…å®¹è§£å‹åˆ°dirç›®å½•å†…) -t æµ‹è¯•å‹ç¼©æ¡£çš„å®Œæ•´æ€§ -x filename æ’é™¤æŸæ–‡æ¡£ 3. 7zæ ¼å¼ï¼ˆéœ€è¦p7zipï¼Œdeepinè‡ªå¸¦ï¼Œæ›´å¤šçš„è¯·manï¼‰ æŸ¥çœ‹ç›®å½•æ ‘ï¼š7z l file.7z (List contents of archive) å‹ç¼©ï¼š7z a file.7z file1 directory1 (a ä¸ºåˆ›å»ºå‹ç¼©æ¡£æˆ–å‘å‹ç¼©æ¡£ä¸­æ·»åŠ æ–‡æ¡£/ç›®å½•ï¼Œä¸€æ¬¡å¯æŒ‡å®šå¤šä¸ªè¦å‹ç¼©çš„æ–‡æ¡£æˆ–ç›®å½•) è§£å‹ï¼š7z x file.7z -o directory (è§£å‹åˆ°æŒ‡å®šç›®å½•) æµ‹è¯•å®Œæ•´æ€§ï¼š 7z t file.7z p7zip å®‰è£…å¥½åï¼Œä¼šæä¾› 7zã€7zaã€7zr ä¸‰ä¸ªæŒ‡ä»¤ï¼Œä¸€èˆ¬æ¥è¯´ç›´æ¥ç”¨ 7z å°±è¡Œã€‚ P.S. 7z ä¸ä¼šä¿å­˜ Linux æ–‡æ¡£çš„ç”¨æˆ·ã€ç”¨æˆ·ç»„ä¿¡æ¯ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥ç”¨äº Linux ç³»ç»Ÿå¤‡ä»½ï¼Œæ­¤æ—¶å»ºè®®ç”¨ tar.xz æˆ– tar.7zï¼ˆä¹Ÿå°±æ˜¯å…ˆç”¨taræ‰“åŒ…ï¼‰ 4. raræ ¼å¼ï¼ˆè¿˜æ˜¯é‚£å¥è¯ï¼Œæ›´å¤šçš„è¯·manï¼‰rar æ˜¯éå¼€æºçš„æ ¼å¼ï¼ŒLinux é»˜è®¤æ˜¯ä¸ä¼šåŒ…å« rar å‹ç¼©è½¯ä»¶çš„ï¼Œä½†æ˜¯å®ƒçš„è§£å‹è½¯ä»¶æ˜¯å¼€æºçš„ï¼Œdeepin è‡ªå¸¦ unrarï¼Œé¡ºä¾¿ 7zip ä¹Ÿå¯è§£å‹ rar æ–‡æ¡£ã€‚è‹¥æƒ³ç”¨linuxåˆ›å»ºrarå‹ç¼©æ¡£ï¼Œéœ€è¦ä»rarlabä¸Šä¸‹è½½ Linux ç‰ˆï¼Œï¼ˆdeepinæºè‡ªå¸¦ï¼‰ä¸è¿‡è¦æ³¨æ„çš„æ˜¯è¯¥ linux ç‰ˆæ˜¯ 40 å¤©è¯•ç”¨ç‰ˆï¼Œè¦é•¿æœŸä½¿ç”¨çš„è¯ï¼Œå¯èƒ½éœ€è¦ç ´è§£ã€‚ï¼ˆrar çš„ key ç½‘ä¸Šä¸€æœä¸€å¤§æŠŠï¼‰ å‹ç¼©ï¼šrar a file.rar file ï¼ˆè¿™ä¸ªæ˜¯è¯•ç”¨çš„ï¼‰ è§£å‹ï¼šunrar x file.rar ï¼ˆè¿™ä¸ªå¼€æºå…è´¹ï¼‰ å…¶å®æˆ‘æŒºä¸­æ„ rar çš„ä¿®å¤åŠŸèƒ½çš„ï¼Œä¸çŸ¥é“ä¸ºå•¥ 7z xz è¿™æ ·çš„æ–°æ ¼å¼æ²¡æœ‰æ·»åŠ ç±»ä¼¼çš„recorvery recordsã€‚ä¸Šæ¬¡ä¸‹ä¸ª idea çš„ tarballï¼Œä¸‹äº†å››äº”æ¬¡æ‰ä¸‹åˆ°ä¸€ä¸ªå®Œæ•´çš„ï¼Œè¦æ˜¯ç”¨rar çš„è¯ï¼Œå¤§æ¦‚ä¸€é”®ä¿®å¤å°±å¥½äº†ï¼Œå¯ tar.gz æˆ‘ä¸çŸ¥é“æ€å¹ºä¿®å¤ï¼Œåªå¥½ä¸€ééé‡å¤ä¸‹è½½ã€‚ã€‚ ","date":"2019-01-14","objectID":"/posts/compression-related-instructions-under-linux/:5:1","series":null,"tags":["Linux","Compression","å‹ç¼©","tar"],"title":"å¸¸è§å‹ç¼©æ ¼å¼çš„åŒºåˆ«ï¼ŒåŠ Linux ä¸‹çš„å‹ç¼©ç›¸å…³æŒ‡ä»¤","uri":"/posts/compression-related-instructions-under-linux/#åªæ‰“åŒ…ç›®å½•ä¸­æ¯”æŒ‡å®šæ—¶åˆ»æ›´æ–°çš„æ–‡æ¡£"},{"categories":["tech"],"content":" 1. tar æŒ‡ä»¤é€šè¿‡ä¹‹å‰çš„ä»‹ç»ï¼Œå¯ä»¥çœ‹å‡ºå¸¸ç”¨çš„å°±æ˜¯ tar gzip xz ç­‰ï¼Œå¦‚æœè¦å‹ç¼©å¤šä¸ªæ–‡æ¡£ï¼Œéœ€è¦å…ˆä½¿ç”¨tarï¼Œå†ç”¨ç®¡é“é‡å®šå‘åˆ° gzip æˆ– xzï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œè€Œè¿™å‡ ä¸ªæŒ‡ä»¤åˆå¾ˆå¸¸ç”¨ã€‚äºæ˜¯åæ¥å¯¹taråšäº†å¢å¼ºã€‚tar æœ€åˆåªæ˜¯ä¸€ä¸ªå½’æ¡£è¿›ç¨‹ï¼Œè€Œå‹ç¼©åˆ™ç”±å…¶ä»–çš„å‹ç¼©è½¯ä»¶æ¥å®Œæˆï¼ˆä¸€ä¸ªè¿›ç¨‹åªå¹²ä¸€ä»¶äº‹ï¼‰ã€‚åæ¥ä¸ºäº†æ–¹ä¾¿ï¼Œä¸§å¿ƒç—…ç‹‚åœ°é›†æˆäº†å„ç§å‹ç¼©æŒ‡ä»¤ã€‚å› æ­¤è¿™é‡Œå°±åªä»‹ç»è¿™ä¸€ä¸ªå‘½ä»¤äº†ï¼ˆå®ƒå›Šæ‹¬äº†æ‰€æœ‰ï¼‰ã€‚tar çš„é€‰é¡¹ä¸å‚æ•°éå¸¸çš„å¤šï¼æˆ‘ä»¬åªè®²å‡ ä¸ªå¸¸ç”¨çš„é€‰é¡¹ï¼Œæ›´å¤šé€‰é¡¹æ‚¨å¯ä»¥è‡ªè¡Œ man tar æŸ¥è¯¢å•°ï¼ bash [dmtsai@study ~]$ tar [-z|-j|-J] [cv] [-f å¾…åˆ›å»ºçš„æ–°æ¡£å] filename... \u003c==æ‰“åŒ…ä¸å‹ç¼© [dmtsai@study ~]$ tar [-z|-j|-J] [tv] [-f æ—¢æœ‰çš„ taræ¡£å] \u003c==å¯Ÿçœ‹æ¡£å [dmtsai@study ~]$ tar [-z|-j|-J] [xv] [-f æ—¢æœ‰çš„ taræ¡£å] [-C ç›®å½•] \u003c==è§£å‹ç¼© é€‰é¡¹ä¸å‚æ•°-c ï¼šåˆ›å»ºæ‰“åŒ…æ¡£æ¡ˆï¼Œå¯æ­é… -v æ¥å¯Ÿçœ‹è¿‡ç¨‹ä¸­è¢«æ‰“åŒ…çš„æ¡£å(filename) -t ï¼šå¯Ÿçœ‹æ‰“åŒ…æ¡£æ¡ˆçš„å†…å®¹å«æœ‰å“ªäº›æ¡£åï¼Œé‡ç‚¹åœ¨å¯Ÿçœ‹ã€æ¡£åã€å°±æ˜¯äº†ï¼› -x ï¼šè§£æ‰“åŒ…æˆ–è§£å‹ç¼©çš„åŠŸèƒ½ï¼Œå¯ä»¥æ­é… -C (å¤§å†™) åœ¨ç‰¹å®šç›®å½•è§£å¼€ ç‰¹åˆ«ç•™æ„çš„æ˜¯ï¼Œ -c, -t, -x ä¸å¯åŒæ—¶å‡ºç°åœ¨ä¸€ä¸²æŒ‡ä»¤åˆ—ä¸­ã€‚ -z ï¼šé€è¿‡ gzip çš„æ”¯æŒè¿›è¡Œå‹ç¼©/è§£å‹ç¼©ï¼šæ­¤æ—¶æ¡£åæœ€å¥½ä¸º *.tar.gz -j ï¼šé€è¿‡ bzip2 çš„æ”¯æŒè¿›è¡Œå‹ç¼©/è§£å‹ç¼©ï¼šæ­¤æ—¶æ¡£åæœ€å¥½ä¸º *.tar.bz2 -J ï¼šé€è¿‡ xz çš„æ”¯æŒè¿›è¡Œå‹ç¼©/è§£å‹ç¼©ï¼šæ­¤æ—¶æ¡£åæœ€å¥½ä¸º *.tar.xz ç‰¹åˆ«ç•™æ„ï¼Œ -z, -j, -J ä¸å¯ä»¥åŒæ—¶å‡ºç°åœ¨ä¸€ä¸²æŒ‡ä»¤åˆ—ä¸­ -v ï¼šåœ¨å‹ç¼©/è§£å‹ç¼©çš„è¿‡ç¨‹ä¸­ï¼Œå°†æ­£åœ¨å¤„ç†çš„æ¡£åæ˜¾ç¤ºå‡ºæ¥ï¼ -f filenameï¼š-f åé¢è¦ç«‹åˆ»æ¥è¦è¢«å¤„ç†çš„æ¡£åï¼å»ºè®® -f å•ç‹¬å†™ä¸€ä¸ªé€‰é¡¹å•°ï¼(æ¯”è¾ƒä¸ä¼šå¿˜è®°) -C ç›®å½• ï¼šè¿™ä¸ªé€‰é¡¹ç”¨åœ¨è§£å‹ç¼©ï¼Œè‹¥è¦åœ¨ç‰¹å®šç›®å½•è§£å‹ç¼©ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ã€‚ å…¶ä»–åç»­ç»ƒä¹ ä¼šä½¿ç”¨åˆ°çš„é€‰é¡¹ä»‹ç»ï¼š -p(å°å†™) ï¼šä¿ç•™å¤‡ä»½èµ„æ–™çš„åŸæœ¬æƒé™ä¸å±æ€§ï¼Œå¸¸ç”¨äºå¤‡ä»½(-c)é‡è¦çš„è®¾å®šæ¡£ -P(å¤§å†™) ï¼šä¿ç•™ç»å¯¹è·¯å¾„ï¼Œäº¦å³å…è®¸å¤‡ä»½èµ„æ–™ä¸­å«æœ‰æ ¹ç›®å½•å­˜åœ¨ä¹‹æ„ï¼›â€“exclude=FILEï¼šåœ¨å‹ç¼©çš„è¿‡ç¨‹ä¸­ï¼Œä¸è¦å°† FILE æ‰“åŒ…ï¼ å…¶å®æœ€ç®€å•çš„ä½¿ç”¨ tar å°±åªè¦è®°å¿†åº•ä¸‹çš„æ–¹å¼å³å¯ å‹ç¼©ï¼štar -zcv -f filename.tar.gz \u003cè¦è¢«å‹ç¼©çš„æ¡£æ¡ˆæˆ–ç›®å½•åç§°\u003e æŸ¥çœ‹æ–‡æ¡£æ ‘ï¼štar -ztv -f filename.tar.gz è§£å‹ç¼©ï¼štar -zxv -f filename.tar.gz -C \u003cæ¬²è§£å‹ç¼©çš„ç›®å½•\u003e` ä¸Šé¢çš„å‘½ä»¤éœ€è¦æ ¹æ®å‹ç¼©æ ¼å¼çš„ä¸åŒï¼Œé€‰ç”¨ -z -j -J é€‰é¡¹ï¼Œè€Œå®é™…ä¸Šæ–‡æ¡£çš„åç¼€å°±å·²ç»è¡¨æ˜äº†å®ƒçš„å‹ç¼©æ ¼å¼ï¼Œä¸å…è®©äººè§‰å¾—å¤šä½™ã€‚å› æ­¤å°±æœ‰è¿™å¹ºä¸€æ¡é€šç”¨çš„å‹ç¼©/è§£å‹ option -a, --auto-compress Use archive suffix to determine the compression program. ä½¿ç”¨è¿™ä¸ªï¼Œä¾¿æœ‰äº†é€šç”¨çš„è§£å‹æŒ‡ä»¤ï¼š tar -axv -f file.tar.* ï¼ˆå®ƒé€‚ç”¨äºä¸Šè¿°ä¸‰ç§å‹ç¼©æ ¼å¼ï¼‰ ä»…è§£å‹æŒ‡å®šçš„æ–‡æ¡£ å…ˆæŸ¥çœ‹æ–‡æ¡£æ ‘æ‰¾åˆ°éœ€è¦è§£å‹çš„æ–‡æ¡£çš„æ–‡æ¡£å tar -zxv -f æ‰“åŒ…æ¡£.tar.gz å¾…è§£å¼€æ¡£å æ‰“åŒ…æŸç›®å½•ï¼Œä½†ä¸å«è¯¥ç›®å½•ä¸‹çš„æŸäº›æ¡£æ¡ˆä¹‹ä½œæ³•ä½¿ç”¨ â€“exclude=FILE é€‰é¡¹ï¼ˆæ”¯æŒæ–‡æ¡£åçš„æ¨¡å¼åŒ¹é…ï¼Œè€Œä¸”å¯é‡å¤ï¼‰ tar -zcv -f filename.tar.gz directory --exclude=FILE1 --exclude=func* åªæ‰“åŒ…ç›®å½•ä¸­æ¯”æŒ‡å®šæ—¶åˆ»æ›´æ–°çš„æ–‡æ¡£ä½¿ç”¨ --newer-mtime=\"2015/06/17\" é€‰é¡¹ã€‚ tarfile, tarballtarfile | çº¯æ‰“åŒ…ã€æœªå‹ç¼©çš„ tar æ–‡æ¡£ tarball | å‹ç¼©äº†çš„ tar æ–‡æ¡£ 2. zipæ ¼å¼ï¼ˆlinux ä¸€èˆ¬ä¹Ÿä¼šè‡ªå¸¦ï¼Œè¯¦ç»†çš„è¯·manï¼‰ å‹ç¼©å‘½ä»¤ï¼šzip å‹ç¼©ç›®å½•ï¼šzip -r filename.zip directory r è¡¨ç¤ºé€’å½’å‹ç¼©ï¼Œå‹ç¼©åŒ…ä¼šåŒ…å«è¿™ä¸ªç›®å½• è§£å‹å‘½ä»¤ï¼šunzip è§£å‹åˆ°æŸç›®å½•ï¼šunzip -d directory filename.zip (-d dir è¡¨ç¤ºå°†å†…å®¹è§£å‹åˆ°dirç›®å½•å†…) -t æµ‹è¯•å‹ç¼©æ¡£çš„å®Œæ•´æ€§ -x filename æ’é™¤æŸæ–‡æ¡£ 3. 7zæ ¼å¼ï¼ˆéœ€è¦p7zipï¼Œdeepinè‡ªå¸¦ï¼Œæ›´å¤šçš„è¯·manï¼‰ æŸ¥çœ‹ç›®å½•æ ‘ï¼š7z l file.7z (List contents of archive) å‹ç¼©ï¼š7z a file.7z file1 directory1 (a ä¸ºåˆ›å»ºå‹ç¼©æ¡£æˆ–å‘å‹ç¼©æ¡£ä¸­æ·»åŠ æ–‡æ¡£/ç›®å½•ï¼Œä¸€æ¬¡å¯æŒ‡å®šå¤šä¸ªè¦å‹ç¼©çš„æ–‡æ¡£æˆ–ç›®å½•) è§£å‹ï¼š7z x file.7z -o directory (è§£å‹åˆ°æŒ‡å®šç›®å½•) æµ‹è¯•å®Œæ•´æ€§ï¼š 7z t file.7z p7zip å®‰è£…å¥½åï¼Œä¼šæä¾› 7zã€7zaã€7zr ä¸‰ä¸ªæŒ‡ä»¤ï¼Œä¸€èˆ¬æ¥è¯´ç›´æ¥ç”¨ 7z å°±è¡Œã€‚ P.S. 7z ä¸ä¼šä¿å­˜ Linux æ–‡æ¡£çš„ç”¨æˆ·ã€ç”¨æˆ·ç»„ä¿¡æ¯ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥ç”¨äº Linux ç³»ç»Ÿå¤‡ä»½ï¼Œæ­¤æ—¶å»ºè®®ç”¨ tar.xz æˆ– tar.7zï¼ˆä¹Ÿå°±æ˜¯å…ˆç”¨taræ‰“åŒ…ï¼‰ 4. raræ ¼å¼ï¼ˆè¿˜æ˜¯é‚£å¥è¯ï¼Œæ›´å¤šçš„è¯·manï¼‰rar æ˜¯éå¼€æºçš„æ ¼å¼ï¼ŒLinux é»˜è®¤æ˜¯ä¸ä¼šåŒ…å« rar å‹ç¼©è½¯ä»¶çš„ï¼Œä½†æ˜¯å®ƒçš„è§£å‹è½¯ä»¶æ˜¯å¼€æºçš„ï¼Œdeepin è‡ªå¸¦ unrarï¼Œé¡ºä¾¿ 7zip ä¹Ÿå¯è§£å‹ rar æ–‡æ¡£ã€‚è‹¥æƒ³ç”¨linuxåˆ›å»ºrarå‹ç¼©æ¡£ï¼Œéœ€è¦ä»rarlabä¸Šä¸‹è½½ Linux ç‰ˆï¼Œï¼ˆdeepinæºè‡ªå¸¦ï¼‰ä¸è¿‡è¦æ³¨æ„çš„æ˜¯è¯¥ linux ç‰ˆæ˜¯ 40 å¤©è¯•ç”¨ç‰ˆï¼Œè¦é•¿æœŸä½¿ç”¨çš„è¯ï¼Œå¯èƒ½éœ€è¦ç ´è§£ã€‚ï¼ˆrar çš„ key ç½‘ä¸Šä¸€æœä¸€å¤§æŠŠï¼‰ å‹ç¼©ï¼šrar a file.rar file ï¼ˆè¿™ä¸ªæ˜¯è¯•ç”¨çš„ï¼‰ è§£å‹ï¼šunrar x file.rar ï¼ˆè¿™ä¸ªå¼€æºå…è´¹ï¼‰ å…¶å®æˆ‘æŒºä¸­æ„ rar çš„ä¿®å¤åŠŸèƒ½çš„ï¼Œä¸çŸ¥é“ä¸ºå•¥ 7z xz è¿™æ ·çš„æ–°æ ¼å¼æ²¡æœ‰æ·»åŠ ç±»ä¼¼çš„recorvery recordsã€‚ä¸Šæ¬¡ä¸‹ä¸ª idea çš„ tarballï¼Œä¸‹äº†å››äº”æ¬¡æ‰ä¸‹åˆ°ä¸€ä¸ªå®Œæ•´çš„ï¼Œè¦æ˜¯ç”¨rar çš„è¯ï¼Œå¤§æ¦‚ä¸€é”®ä¿®å¤å°±å¥½äº†ï¼Œå¯ tar.gz æˆ‘ä¸çŸ¥é“æ€å¹ºä¿®å¤ï¼Œåªå¥½ä¸€ééé‡å¤ä¸‹è½½ã€‚ã€‚ ","date":"2019-01-14","objectID":"/posts/compression-related-instructions-under-linux/:5:1","series":null,"tags":["Linux","Compression","å‹ç¼©","tar"],"title":"å¸¸è§å‹ç¼©æ ¼å¼çš„åŒºåˆ«ï¼ŒåŠ Linux ä¸‹çš„å‹ç¼©ç›¸å…³æŒ‡ä»¤","uri":"/posts/compression-related-instructions-under-linux/#tarfile-tarball"},{"categories":["tech"],"content":" 1. tar æŒ‡ä»¤é€šè¿‡ä¹‹å‰çš„ä»‹ç»ï¼Œå¯ä»¥çœ‹å‡ºå¸¸ç”¨çš„å°±æ˜¯ tar gzip xz ç­‰ï¼Œå¦‚æœè¦å‹ç¼©å¤šä¸ªæ–‡æ¡£ï¼Œéœ€è¦å…ˆä½¿ç”¨tarï¼Œå†ç”¨ç®¡é“é‡å®šå‘åˆ° gzip æˆ– xzï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œè€Œè¿™å‡ ä¸ªæŒ‡ä»¤åˆå¾ˆå¸¸ç”¨ã€‚äºæ˜¯åæ¥å¯¹taråšäº†å¢å¼ºã€‚tar æœ€åˆåªæ˜¯ä¸€ä¸ªå½’æ¡£è¿›ç¨‹ï¼Œè€Œå‹ç¼©åˆ™ç”±å…¶ä»–çš„å‹ç¼©è½¯ä»¶æ¥å®Œæˆï¼ˆä¸€ä¸ªè¿›ç¨‹åªå¹²ä¸€ä»¶äº‹ï¼‰ã€‚åæ¥ä¸ºäº†æ–¹ä¾¿ï¼Œä¸§å¿ƒç—…ç‹‚åœ°é›†æˆäº†å„ç§å‹ç¼©æŒ‡ä»¤ã€‚å› æ­¤è¿™é‡Œå°±åªä»‹ç»è¿™ä¸€ä¸ªå‘½ä»¤äº†ï¼ˆå®ƒå›Šæ‹¬äº†æ‰€æœ‰ï¼‰ã€‚tar çš„é€‰é¡¹ä¸å‚æ•°éå¸¸çš„å¤šï¼æˆ‘ä»¬åªè®²å‡ ä¸ªå¸¸ç”¨çš„é€‰é¡¹ï¼Œæ›´å¤šé€‰é¡¹æ‚¨å¯ä»¥è‡ªè¡Œ man tar æŸ¥è¯¢å•°ï¼ bash [dmtsai@study ~]$ tar [-z|-j|-J] [cv] [-f å¾…åˆ›å»ºçš„æ–°æ¡£å] filename... \u003c==æ‰“åŒ…ä¸å‹ç¼© [dmtsai@study ~]$ tar [-z|-j|-J] [tv] [-f æ—¢æœ‰çš„ taræ¡£å] \u003c==å¯Ÿçœ‹æ¡£å [dmtsai@study ~]$ tar [-z|-j|-J] [xv] [-f æ—¢æœ‰çš„ taræ¡£å] [-C ç›®å½•] \u003c==è§£å‹ç¼© é€‰é¡¹ä¸å‚æ•°-c ï¼šåˆ›å»ºæ‰“åŒ…æ¡£æ¡ˆï¼Œå¯æ­é… -v æ¥å¯Ÿçœ‹è¿‡ç¨‹ä¸­è¢«æ‰“åŒ…çš„æ¡£å(filename) -t ï¼šå¯Ÿçœ‹æ‰“åŒ…æ¡£æ¡ˆçš„å†…å®¹å«æœ‰å“ªäº›æ¡£åï¼Œé‡ç‚¹åœ¨å¯Ÿçœ‹ã€æ¡£åã€å°±æ˜¯äº†ï¼› -x ï¼šè§£æ‰“åŒ…æˆ–è§£å‹ç¼©çš„åŠŸèƒ½ï¼Œå¯ä»¥æ­é… -C (å¤§å†™) åœ¨ç‰¹å®šç›®å½•è§£å¼€ ç‰¹åˆ«ç•™æ„çš„æ˜¯ï¼Œ -c, -t, -x ä¸å¯åŒæ—¶å‡ºç°åœ¨ä¸€ä¸²æŒ‡ä»¤åˆ—ä¸­ã€‚ -z ï¼šé€è¿‡ gzip çš„æ”¯æŒè¿›è¡Œå‹ç¼©/è§£å‹ç¼©ï¼šæ­¤æ—¶æ¡£åæœ€å¥½ä¸º *.tar.gz -j ï¼šé€è¿‡ bzip2 çš„æ”¯æŒè¿›è¡Œå‹ç¼©/è§£å‹ç¼©ï¼šæ­¤æ—¶æ¡£åæœ€å¥½ä¸º *.tar.bz2 -J ï¼šé€è¿‡ xz çš„æ”¯æŒè¿›è¡Œå‹ç¼©/è§£å‹ç¼©ï¼šæ­¤æ—¶æ¡£åæœ€å¥½ä¸º *.tar.xz ç‰¹åˆ«ç•™æ„ï¼Œ -z, -j, -J ä¸å¯ä»¥åŒæ—¶å‡ºç°åœ¨ä¸€ä¸²æŒ‡ä»¤åˆ—ä¸­ -v ï¼šåœ¨å‹ç¼©/è§£å‹ç¼©çš„è¿‡ç¨‹ä¸­ï¼Œå°†æ­£åœ¨å¤„ç†çš„æ¡£åæ˜¾ç¤ºå‡ºæ¥ï¼ -f filenameï¼š-f åé¢è¦ç«‹åˆ»æ¥è¦è¢«å¤„ç†çš„æ¡£åï¼å»ºè®® -f å•ç‹¬å†™ä¸€ä¸ªé€‰é¡¹å•°ï¼(æ¯”è¾ƒä¸ä¼šå¿˜è®°) -C ç›®å½• ï¼šè¿™ä¸ªé€‰é¡¹ç”¨åœ¨è§£å‹ç¼©ï¼Œè‹¥è¦åœ¨ç‰¹å®šç›®å½•è§£å‹ç¼©ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ã€‚ å…¶ä»–åç»­ç»ƒä¹ ä¼šä½¿ç”¨åˆ°çš„é€‰é¡¹ä»‹ç»ï¼š -p(å°å†™) ï¼šä¿ç•™å¤‡ä»½èµ„æ–™çš„åŸæœ¬æƒé™ä¸å±æ€§ï¼Œå¸¸ç”¨äºå¤‡ä»½(-c)é‡è¦çš„è®¾å®šæ¡£ -P(å¤§å†™) ï¼šä¿ç•™ç»å¯¹è·¯å¾„ï¼Œäº¦å³å…è®¸å¤‡ä»½èµ„æ–™ä¸­å«æœ‰æ ¹ç›®å½•å­˜åœ¨ä¹‹æ„ï¼›â€“exclude=FILEï¼šåœ¨å‹ç¼©çš„è¿‡ç¨‹ä¸­ï¼Œä¸è¦å°† FILE æ‰“åŒ…ï¼ å…¶å®æœ€ç®€å•çš„ä½¿ç”¨ tar å°±åªè¦è®°å¿†åº•ä¸‹çš„æ–¹å¼å³å¯ å‹ç¼©ï¼štar -zcv -f filename.tar.gz \u003cè¦è¢«å‹ç¼©çš„æ¡£æ¡ˆæˆ–ç›®å½•åç§°\u003e æŸ¥çœ‹æ–‡æ¡£æ ‘ï¼štar -ztv -f filename.tar.gz è§£å‹ç¼©ï¼štar -zxv -f filename.tar.gz -C \u003cæ¬²è§£å‹ç¼©çš„ç›®å½•\u003e` ä¸Šé¢çš„å‘½ä»¤éœ€è¦æ ¹æ®å‹ç¼©æ ¼å¼çš„ä¸åŒï¼Œé€‰ç”¨ -z -j -J é€‰é¡¹ï¼Œè€Œå®é™…ä¸Šæ–‡æ¡£çš„åç¼€å°±å·²ç»è¡¨æ˜äº†å®ƒçš„å‹ç¼©æ ¼å¼ï¼Œä¸å…è®©äººè§‰å¾—å¤šä½™ã€‚å› æ­¤å°±æœ‰è¿™å¹ºä¸€æ¡é€šç”¨çš„å‹ç¼©/è§£å‹ option -a, --auto-compress Use archive suffix to determine the compression program. ä½¿ç”¨è¿™ä¸ªï¼Œä¾¿æœ‰äº†é€šç”¨çš„è§£å‹æŒ‡ä»¤ï¼š tar -axv -f file.tar.* ï¼ˆå®ƒé€‚ç”¨äºä¸Šè¿°ä¸‰ç§å‹ç¼©æ ¼å¼ï¼‰ ä»…è§£å‹æŒ‡å®šçš„æ–‡æ¡£ å…ˆæŸ¥çœ‹æ–‡æ¡£æ ‘æ‰¾åˆ°éœ€è¦è§£å‹çš„æ–‡æ¡£çš„æ–‡æ¡£å tar -zxv -f æ‰“åŒ…æ¡£.tar.gz å¾…è§£å¼€æ¡£å æ‰“åŒ…æŸç›®å½•ï¼Œä½†ä¸å«è¯¥ç›®å½•ä¸‹çš„æŸäº›æ¡£æ¡ˆä¹‹ä½œæ³•ä½¿ç”¨ â€“exclude=FILE é€‰é¡¹ï¼ˆæ”¯æŒæ–‡æ¡£åçš„æ¨¡å¼åŒ¹é…ï¼Œè€Œä¸”å¯é‡å¤ï¼‰ tar -zcv -f filename.tar.gz directory --exclude=FILE1 --exclude=func* åªæ‰“åŒ…ç›®å½•ä¸­æ¯”æŒ‡å®šæ—¶åˆ»æ›´æ–°çš„æ–‡æ¡£ä½¿ç”¨ --newer-mtime=\"2015/06/17\" é€‰é¡¹ã€‚ tarfile, tarballtarfile | çº¯æ‰“åŒ…ã€æœªå‹ç¼©çš„ tar æ–‡æ¡£ tarball | å‹ç¼©äº†çš„ tar æ–‡æ¡£ 2. zipæ ¼å¼ï¼ˆlinux ä¸€èˆ¬ä¹Ÿä¼šè‡ªå¸¦ï¼Œè¯¦ç»†çš„è¯·manï¼‰ å‹ç¼©å‘½ä»¤ï¼šzip å‹ç¼©ç›®å½•ï¼šzip -r filename.zip directory r è¡¨ç¤ºé€’å½’å‹ç¼©ï¼Œå‹ç¼©åŒ…ä¼šåŒ…å«è¿™ä¸ªç›®å½• è§£å‹å‘½ä»¤ï¼šunzip è§£å‹åˆ°æŸç›®å½•ï¼šunzip -d directory filename.zip (-d dir è¡¨ç¤ºå°†å†…å®¹è§£å‹åˆ°dirç›®å½•å†…) -t æµ‹è¯•å‹ç¼©æ¡£çš„å®Œæ•´æ€§ -x filename æ’é™¤æŸæ–‡æ¡£ 3. 7zæ ¼å¼ï¼ˆéœ€è¦p7zipï¼Œdeepinè‡ªå¸¦ï¼Œæ›´å¤šçš„è¯·manï¼‰ æŸ¥çœ‹ç›®å½•æ ‘ï¼š7z l file.7z (List contents of archive) å‹ç¼©ï¼š7z a file.7z file1 directory1 (a ä¸ºåˆ›å»ºå‹ç¼©æ¡£æˆ–å‘å‹ç¼©æ¡£ä¸­æ·»åŠ æ–‡æ¡£/ç›®å½•ï¼Œä¸€æ¬¡å¯æŒ‡å®šå¤šä¸ªè¦å‹ç¼©çš„æ–‡æ¡£æˆ–ç›®å½•) è§£å‹ï¼š7z x file.7z -o directory (è§£å‹åˆ°æŒ‡å®šç›®å½•) æµ‹è¯•å®Œæ•´æ€§ï¼š 7z t file.7z p7zip å®‰è£…å¥½åï¼Œä¼šæä¾› 7zã€7zaã€7zr ä¸‰ä¸ªæŒ‡ä»¤ï¼Œä¸€èˆ¬æ¥è¯´ç›´æ¥ç”¨ 7z å°±è¡Œã€‚ P.S. 7z ä¸ä¼šä¿å­˜ Linux æ–‡æ¡£çš„ç”¨æˆ·ã€ç”¨æˆ·ç»„ä¿¡æ¯ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥ç”¨äº Linux ç³»ç»Ÿå¤‡ä»½ï¼Œæ­¤æ—¶å»ºè®®ç”¨ tar.xz æˆ– tar.7zï¼ˆä¹Ÿå°±æ˜¯å…ˆç”¨taræ‰“åŒ…ï¼‰ 4. raræ ¼å¼ï¼ˆè¿˜æ˜¯é‚£å¥è¯ï¼Œæ›´å¤šçš„è¯·manï¼‰rar æ˜¯éå¼€æºçš„æ ¼å¼ï¼ŒLinux é»˜è®¤æ˜¯ä¸ä¼šåŒ…å« rar å‹ç¼©è½¯ä»¶çš„ï¼Œä½†æ˜¯å®ƒçš„è§£å‹è½¯ä»¶æ˜¯å¼€æºçš„ï¼Œdeepin è‡ªå¸¦ unrarï¼Œé¡ºä¾¿ 7zip ä¹Ÿå¯è§£å‹ rar æ–‡æ¡£ã€‚è‹¥æƒ³ç”¨linuxåˆ›å»ºrarå‹ç¼©æ¡£ï¼Œéœ€è¦ä»rarlabä¸Šä¸‹è½½ Linux ç‰ˆï¼Œï¼ˆdeepinæºè‡ªå¸¦ï¼‰ä¸è¿‡è¦æ³¨æ„çš„æ˜¯è¯¥ linux ç‰ˆæ˜¯ 40 å¤©è¯•ç”¨ç‰ˆï¼Œè¦é•¿æœŸä½¿ç”¨çš„è¯ï¼Œå¯èƒ½éœ€è¦ç ´è§£ã€‚ï¼ˆrar çš„ key ç½‘ä¸Šä¸€æœä¸€å¤§æŠŠï¼‰ å‹ç¼©ï¼šrar a file.rar file ï¼ˆè¿™ä¸ªæ˜¯è¯•ç”¨çš„ï¼‰ è§£å‹ï¼šunrar x file.rar ï¼ˆè¿™ä¸ªå¼€æºå…è´¹ï¼‰ å…¶å®æˆ‘æŒºä¸­æ„ rar çš„ä¿®å¤åŠŸèƒ½çš„ï¼Œä¸çŸ¥é“ä¸ºå•¥ 7z xz è¿™æ ·çš„æ–°æ ¼å¼æ²¡æœ‰æ·»åŠ ç±»ä¼¼çš„recorvery recordsã€‚ä¸Šæ¬¡ä¸‹ä¸ª idea çš„ tarballï¼Œä¸‹äº†å››äº”æ¬¡æ‰ä¸‹åˆ°ä¸€ä¸ªå®Œæ•´çš„ï¼Œè¦æ˜¯ç”¨rar çš„è¯ï¼Œå¤§æ¦‚ä¸€é”®ä¿®å¤å°±å¥½äº†ï¼Œå¯ tar.gz æˆ‘ä¸çŸ¥é“æ€å¹ºä¿®å¤ï¼Œåªå¥½ä¸€ééé‡å¤ä¸‹è½½ã€‚ã€‚ ","date":"2019-01-14","objectID":"/posts/compression-related-instructions-under-linux/:5:1","series":null,"tags":["Linux","Compression","å‹ç¼©","tar"],"title":"å¸¸è§å‹ç¼©æ ¼å¼çš„åŒºåˆ«ï¼ŒåŠ Linux ä¸‹çš„å‹ç¼©ç›¸å…³æŒ‡ä»¤","uri":"/posts/compression-related-instructions-under-linux/#2-zipæ ¼å¼linux-ä¸€èˆ¬ä¹Ÿä¼šè‡ªå¸¦è¯¦ç»†çš„è¯·man"},{"categories":["tech"],"content":" 1. tar æŒ‡ä»¤é€šè¿‡ä¹‹å‰çš„ä»‹ç»ï¼Œå¯ä»¥çœ‹å‡ºå¸¸ç”¨çš„å°±æ˜¯ tar gzip xz ç­‰ï¼Œå¦‚æœè¦å‹ç¼©å¤šä¸ªæ–‡æ¡£ï¼Œéœ€è¦å…ˆä½¿ç”¨tarï¼Œå†ç”¨ç®¡é“é‡å®šå‘åˆ° gzip æˆ– xzï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œè€Œè¿™å‡ ä¸ªæŒ‡ä»¤åˆå¾ˆå¸¸ç”¨ã€‚äºæ˜¯åæ¥å¯¹taråšäº†å¢å¼ºã€‚tar æœ€åˆåªæ˜¯ä¸€ä¸ªå½’æ¡£è¿›ç¨‹ï¼Œè€Œå‹ç¼©åˆ™ç”±å…¶ä»–çš„å‹ç¼©è½¯ä»¶æ¥å®Œæˆï¼ˆä¸€ä¸ªè¿›ç¨‹åªå¹²ä¸€ä»¶äº‹ï¼‰ã€‚åæ¥ä¸ºäº†æ–¹ä¾¿ï¼Œä¸§å¿ƒç—…ç‹‚åœ°é›†æˆäº†å„ç§å‹ç¼©æŒ‡ä»¤ã€‚å› æ­¤è¿™é‡Œå°±åªä»‹ç»è¿™ä¸€ä¸ªå‘½ä»¤äº†ï¼ˆå®ƒå›Šæ‹¬äº†æ‰€æœ‰ï¼‰ã€‚tar çš„é€‰é¡¹ä¸å‚æ•°éå¸¸çš„å¤šï¼æˆ‘ä»¬åªè®²å‡ ä¸ªå¸¸ç”¨çš„é€‰é¡¹ï¼Œæ›´å¤šé€‰é¡¹æ‚¨å¯ä»¥è‡ªè¡Œ man tar æŸ¥è¯¢å•°ï¼ bash [dmtsai@study ~]$ tar [-z|-j|-J] [cv] [-f å¾…åˆ›å»ºçš„æ–°æ¡£å] filename... \u003c==æ‰“åŒ…ä¸å‹ç¼© [dmtsai@study ~]$ tar [-z|-j|-J] [tv] [-f æ—¢æœ‰çš„ taræ¡£å] \u003c==å¯Ÿçœ‹æ¡£å [dmtsai@study ~]$ tar [-z|-j|-J] [xv] [-f æ—¢æœ‰çš„ taræ¡£å] [-C ç›®å½•] \u003c==è§£å‹ç¼© é€‰é¡¹ä¸å‚æ•°-c ï¼šåˆ›å»ºæ‰“åŒ…æ¡£æ¡ˆï¼Œå¯æ­é… -v æ¥å¯Ÿçœ‹è¿‡ç¨‹ä¸­è¢«æ‰“åŒ…çš„æ¡£å(filename) -t ï¼šå¯Ÿçœ‹æ‰“åŒ…æ¡£æ¡ˆçš„å†…å®¹å«æœ‰å“ªäº›æ¡£åï¼Œé‡ç‚¹åœ¨å¯Ÿçœ‹ã€æ¡£åã€å°±æ˜¯äº†ï¼› -x ï¼šè§£æ‰“åŒ…æˆ–è§£å‹ç¼©çš„åŠŸèƒ½ï¼Œå¯ä»¥æ­é… -C (å¤§å†™) åœ¨ç‰¹å®šç›®å½•è§£å¼€ ç‰¹åˆ«ç•™æ„çš„æ˜¯ï¼Œ -c, -t, -x ä¸å¯åŒæ—¶å‡ºç°åœ¨ä¸€ä¸²æŒ‡ä»¤åˆ—ä¸­ã€‚ -z ï¼šé€è¿‡ gzip çš„æ”¯æŒè¿›è¡Œå‹ç¼©/è§£å‹ç¼©ï¼šæ­¤æ—¶æ¡£åæœ€å¥½ä¸º *.tar.gz -j ï¼šé€è¿‡ bzip2 çš„æ”¯æŒè¿›è¡Œå‹ç¼©/è§£å‹ç¼©ï¼šæ­¤æ—¶æ¡£åæœ€å¥½ä¸º *.tar.bz2 -J ï¼šé€è¿‡ xz çš„æ”¯æŒè¿›è¡Œå‹ç¼©/è§£å‹ç¼©ï¼šæ­¤æ—¶æ¡£åæœ€å¥½ä¸º *.tar.xz ç‰¹åˆ«ç•™æ„ï¼Œ -z, -j, -J ä¸å¯ä»¥åŒæ—¶å‡ºç°åœ¨ä¸€ä¸²æŒ‡ä»¤åˆ—ä¸­ -v ï¼šåœ¨å‹ç¼©/è§£å‹ç¼©çš„è¿‡ç¨‹ä¸­ï¼Œå°†æ­£åœ¨å¤„ç†çš„æ¡£åæ˜¾ç¤ºå‡ºæ¥ï¼ -f filenameï¼š-f åé¢è¦ç«‹åˆ»æ¥è¦è¢«å¤„ç†çš„æ¡£åï¼å»ºè®® -f å•ç‹¬å†™ä¸€ä¸ªé€‰é¡¹å•°ï¼(æ¯”è¾ƒä¸ä¼šå¿˜è®°) -C ç›®å½• ï¼šè¿™ä¸ªé€‰é¡¹ç”¨åœ¨è§£å‹ç¼©ï¼Œè‹¥è¦åœ¨ç‰¹å®šç›®å½•è§£å‹ç¼©ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ã€‚ å…¶ä»–åç»­ç»ƒä¹ ä¼šä½¿ç”¨åˆ°çš„é€‰é¡¹ä»‹ç»ï¼š -p(å°å†™) ï¼šä¿ç•™å¤‡ä»½èµ„æ–™çš„åŸæœ¬æƒé™ä¸å±æ€§ï¼Œå¸¸ç”¨äºå¤‡ä»½(-c)é‡è¦çš„è®¾å®šæ¡£ -P(å¤§å†™) ï¼šä¿ç•™ç»å¯¹è·¯å¾„ï¼Œäº¦å³å…è®¸å¤‡ä»½èµ„æ–™ä¸­å«æœ‰æ ¹ç›®å½•å­˜åœ¨ä¹‹æ„ï¼›â€“exclude=FILEï¼šåœ¨å‹ç¼©çš„è¿‡ç¨‹ä¸­ï¼Œä¸è¦å°† FILE æ‰“åŒ…ï¼ å…¶å®æœ€ç®€å•çš„ä½¿ç”¨ tar å°±åªè¦è®°å¿†åº•ä¸‹çš„æ–¹å¼å³å¯ å‹ç¼©ï¼štar -zcv -f filename.tar.gz \u003cè¦è¢«å‹ç¼©çš„æ¡£æ¡ˆæˆ–ç›®å½•åç§°\u003e æŸ¥çœ‹æ–‡æ¡£æ ‘ï¼štar -ztv -f filename.tar.gz è§£å‹ç¼©ï¼štar -zxv -f filename.tar.gz -C \u003cæ¬²è§£å‹ç¼©çš„ç›®å½•\u003e` ä¸Šé¢çš„å‘½ä»¤éœ€è¦æ ¹æ®å‹ç¼©æ ¼å¼çš„ä¸åŒï¼Œé€‰ç”¨ -z -j -J é€‰é¡¹ï¼Œè€Œå®é™…ä¸Šæ–‡æ¡£çš„åç¼€å°±å·²ç»è¡¨æ˜äº†å®ƒçš„å‹ç¼©æ ¼å¼ï¼Œä¸å…è®©äººè§‰å¾—å¤šä½™ã€‚å› æ­¤å°±æœ‰è¿™å¹ºä¸€æ¡é€šç”¨çš„å‹ç¼©/è§£å‹ option -a, --auto-compress Use archive suffix to determine the compression program. ä½¿ç”¨è¿™ä¸ªï¼Œä¾¿æœ‰äº†é€šç”¨çš„è§£å‹æŒ‡ä»¤ï¼š tar -axv -f file.tar.* ï¼ˆå®ƒé€‚ç”¨äºä¸Šè¿°ä¸‰ç§å‹ç¼©æ ¼å¼ï¼‰ ä»…è§£å‹æŒ‡å®šçš„æ–‡æ¡£ å…ˆæŸ¥çœ‹æ–‡æ¡£æ ‘æ‰¾åˆ°éœ€è¦è§£å‹çš„æ–‡æ¡£çš„æ–‡æ¡£å tar -zxv -f æ‰“åŒ…æ¡£.tar.gz å¾…è§£å¼€æ¡£å æ‰“åŒ…æŸç›®å½•ï¼Œä½†ä¸å«è¯¥ç›®å½•ä¸‹çš„æŸäº›æ¡£æ¡ˆä¹‹ä½œæ³•ä½¿ç”¨ â€“exclude=FILE é€‰é¡¹ï¼ˆæ”¯æŒæ–‡æ¡£åçš„æ¨¡å¼åŒ¹é…ï¼Œè€Œä¸”å¯é‡å¤ï¼‰ tar -zcv -f filename.tar.gz directory --exclude=FILE1 --exclude=func* åªæ‰“åŒ…ç›®å½•ä¸­æ¯”æŒ‡å®šæ—¶åˆ»æ›´æ–°çš„æ–‡æ¡£ä½¿ç”¨ --newer-mtime=\"2015/06/17\" é€‰é¡¹ã€‚ tarfile, tarballtarfile | çº¯æ‰“åŒ…ã€æœªå‹ç¼©çš„ tar æ–‡æ¡£ tarball | å‹ç¼©äº†çš„ tar æ–‡æ¡£ 2. zipæ ¼å¼ï¼ˆlinux ä¸€èˆ¬ä¹Ÿä¼šè‡ªå¸¦ï¼Œè¯¦ç»†çš„è¯·manï¼‰ å‹ç¼©å‘½ä»¤ï¼šzip å‹ç¼©ç›®å½•ï¼šzip -r filename.zip directory r è¡¨ç¤ºé€’å½’å‹ç¼©ï¼Œå‹ç¼©åŒ…ä¼šåŒ…å«è¿™ä¸ªç›®å½• è§£å‹å‘½ä»¤ï¼šunzip è§£å‹åˆ°æŸç›®å½•ï¼šunzip -d directory filename.zip (-d dir è¡¨ç¤ºå°†å†…å®¹è§£å‹åˆ°dirç›®å½•å†…) -t æµ‹è¯•å‹ç¼©æ¡£çš„å®Œæ•´æ€§ -x filename æ’é™¤æŸæ–‡æ¡£ 3. 7zæ ¼å¼ï¼ˆéœ€è¦p7zipï¼Œdeepinè‡ªå¸¦ï¼Œæ›´å¤šçš„è¯·manï¼‰ æŸ¥çœ‹ç›®å½•æ ‘ï¼š7z l file.7z (List contents of archive) å‹ç¼©ï¼š7z a file.7z file1 directory1 (a ä¸ºåˆ›å»ºå‹ç¼©æ¡£æˆ–å‘å‹ç¼©æ¡£ä¸­æ·»åŠ æ–‡æ¡£/ç›®å½•ï¼Œä¸€æ¬¡å¯æŒ‡å®šå¤šä¸ªè¦å‹ç¼©çš„æ–‡æ¡£æˆ–ç›®å½•) è§£å‹ï¼š7z x file.7z -o directory (è§£å‹åˆ°æŒ‡å®šç›®å½•) æµ‹è¯•å®Œæ•´æ€§ï¼š 7z t file.7z p7zip å®‰è£…å¥½åï¼Œä¼šæä¾› 7zã€7zaã€7zr ä¸‰ä¸ªæŒ‡ä»¤ï¼Œä¸€èˆ¬æ¥è¯´ç›´æ¥ç”¨ 7z å°±è¡Œã€‚ P.S. 7z ä¸ä¼šä¿å­˜ Linux æ–‡æ¡£çš„ç”¨æˆ·ã€ç”¨æˆ·ç»„ä¿¡æ¯ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥ç”¨äº Linux ç³»ç»Ÿå¤‡ä»½ï¼Œæ­¤æ—¶å»ºè®®ç”¨ tar.xz æˆ– tar.7zï¼ˆä¹Ÿå°±æ˜¯å…ˆç”¨taræ‰“åŒ…ï¼‰ 4. raræ ¼å¼ï¼ˆè¿˜æ˜¯é‚£å¥è¯ï¼Œæ›´å¤šçš„è¯·manï¼‰rar æ˜¯éå¼€æºçš„æ ¼å¼ï¼ŒLinux é»˜è®¤æ˜¯ä¸ä¼šåŒ…å« rar å‹ç¼©è½¯ä»¶çš„ï¼Œä½†æ˜¯å®ƒçš„è§£å‹è½¯ä»¶æ˜¯å¼€æºçš„ï¼Œdeepin è‡ªå¸¦ unrarï¼Œé¡ºä¾¿ 7zip ä¹Ÿå¯è§£å‹ rar æ–‡æ¡£ã€‚è‹¥æƒ³ç”¨linuxåˆ›å»ºrarå‹ç¼©æ¡£ï¼Œéœ€è¦ä»rarlabä¸Šä¸‹è½½ Linux ç‰ˆï¼Œï¼ˆdeepinæºè‡ªå¸¦ï¼‰ä¸è¿‡è¦æ³¨æ„çš„æ˜¯è¯¥ linux ç‰ˆæ˜¯ 40 å¤©è¯•ç”¨ç‰ˆï¼Œè¦é•¿æœŸä½¿ç”¨çš„è¯ï¼Œå¯èƒ½éœ€è¦ç ´è§£ã€‚ï¼ˆrar çš„ key ç½‘ä¸Šä¸€æœä¸€å¤§æŠŠï¼‰ å‹ç¼©ï¼šrar a file.rar file ï¼ˆè¿™ä¸ªæ˜¯è¯•ç”¨çš„ï¼‰ è§£å‹ï¼šunrar x file.rar ï¼ˆè¿™ä¸ªå¼€æºå…è´¹ï¼‰ å…¶å®æˆ‘æŒºä¸­æ„ rar çš„ä¿®å¤åŠŸèƒ½çš„ï¼Œä¸çŸ¥é“ä¸ºå•¥ 7z xz è¿™æ ·çš„æ–°æ ¼å¼æ²¡æœ‰æ·»åŠ ç±»ä¼¼çš„recorvery recordsã€‚ä¸Šæ¬¡ä¸‹ä¸ª idea çš„ tarballï¼Œä¸‹äº†å››äº”æ¬¡æ‰ä¸‹åˆ°ä¸€ä¸ªå®Œæ•´çš„ï¼Œè¦æ˜¯ç”¨rar çš„è¯ï¼Œå¤§æ¦‚ä¸€é”®ä¿®å¤å°±å¥½äº†ï¼Œå¯ tar.gz æˆ‘ä¸çŸ¥é“æ€å¹ºä¿®å¤ï¼Œåªå¥½ä¸€ééé‡å¤ä¸‹è½½ã€‚ã€‚ ","date":"2019-01-14","objectID":"/posts/compression-related-instructions-under-linux/:5:1","series":null,"tags":["Linux","Compression","å‹ç¼©","tar"],"title":"å¸¸è§å‹ç¼©æ ¼å¼çš„åŒºåˆ«ï¼ŒåŠ Linux ä¸‹çš„å‹ç¼©ç›¸å…³æŒ‡ä»¤","uri":"/posts/compression-related-instructions-under-linux/#3-7zæ ¼å¼éœ€è¦p7zipdeepinè‡ªå¸¦æ›´å¤šçš„è¯·man"},{"categories":["tech"],"content":" 1. tar æŒ‡ä»¤é€šè¿‡ä¹‹å‰çš„ä»‹ç»ï¼Œå¯ä»¥çœ‹å‡ºå¸¸ç”¨çš„å°±æ˜¯ tar gzip xz ç­‰ï¼Œå¦‚æœè¦å‹ç¼©å¤šä¸ªæ–‡æ¡£ï¼Œéœ€è¦å…ˆä½¿ç”¨tarï¼Œå†ç”¨ç®¡é“é‡å®šå‘åˆ° gzip æˆ– xzï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œè€Œè¿™å‡ ä¸ªæŒ‡ä»¤åˆå¾ˆå¸¸ç”¨ã€‚äºæ˜¯åæ¥å¯¹taråšäº†å¢å¼ºã€‚tar æœ€åˆåªæ˜¯ä¸€ä¸ªå½’æ¡£è¿›ç¨‹ï¼Œè€Œå‹ç¼©åˆ™ç”±å…¶ä»–çš„å‹ç¼©è½¯ä»¶æ¥å®Œæˆï¼ˆä¸€ä¸ªè¿›ç¨‹åªå¹²ä¸€ä»¶äº‹ï¼‰ã€‚åæ¥ä¸ºäº†æ–¹ä¾¿ï¼Œä¸§å¿ƒç—…ç‹‚åœ°é›†æˆäº†å„ç§å‹ç¼©æŒ‡ä»¤ã€‚å› æ­¤è¿™é‡Œå°±åªä»‹ç»è¿™ä¸€ä¸ªå‘½ä»¤äº†ï¼ˆå®ƒå›Šæ‹¬äº†æ‰€æœ‰ï¼‰ã€‚tar çš„é€‰é¡¹ä¸å‚æ•°éå¸¸çš„å¤šï¼æˆ‘ä»¬åªè®²å‡ ä¸ªå¸¸ç”¨çš„é€‰é¡¹ï¼Œæ›´å¤šé€‰é¡¹æ‚¨å¯ä»¥è‡ªè¡Œ man tar æŸ¥è¯¢å•°ï¼ bash [dmtsai@study ~]$ tar [-z|-j|-J] [cv] [-f å¾…åˆ›å»ºçš„æ–°æ¡£å] filename... \u003c==æ‰“åŒ…ä¸å‹ç¼© [dmtsai@study ~]$ tar [-z|-j|-J] [tv] [-f æ—¢æœ‰çš„ taræ¡£å] \u003c==å¯Ÿçœ‹æ¡£å [dmtsai@study ~]$ tar [-z|-j|-J] [xv] [-f æ—¢æœ‰çš„ taræ¡£å] [-C ç›®å½•] \u003c==è§£å‹ç¼© é€‰é¡¹ä¸å‚æ•°-c ï¼šåˆ›å»ºæ‰“åŒ…æ¡£æ¡ˆï¼Œå¯æ­é… -v æ¥å¯Ÿçœ‹è¿‡ç¨‹ä¸­è¢«æ‰“åŒ…çš„æ¡£å(filename) -t ï¼šå¯Ÿçœ‹æ‰“åŒ…æ¡£æ¡ˆçš„å†…å®¹å«æœ‰å“ªäº›æ¡£åï¼Œé‡ç‚¹åœ¨å¯Ÿçœ‹ã€æ¡£åã€å°±æ˜¯äº†ï¼› -x ï¼šè§£æ‰“åŒ…æˆ–è§£å‹ç¼©çš„åŠŸèƒ½ï¼Œå¯ä»¥æ­é… -C (å¤§å†™) åœ¨ç‰¹å®šç›®å½•è§£å¼€ ç‰¹åˆ«ç•™æ„çš„æ˜¯ï¼Œ -c, -t, -x ä¸å¯åŒæ—¶å‡ºç°åœ¨ä¸€ä¸²æŒ‡ä»¤åˆ—ä¸­ã€‚ -z ï¼šé€è¿‡ gzip çš„æ”¯æŒè¿›è¡Œå‹ç¼©/è§£å‹ç¼©ï¼šæ­¤æ—¶æ¡£åæœ€å¥½ä¸º *.tar.gz -j ï¼šé€è¿‡ bzip2 çš„æ”¯æŒè¿›è¡Œå‹ç¼©/è§£å‹ç¼©ï¼šæ­¤æ—¶æ¡£åæœ€å¥½ä¸º *.tar.bz2 -J ï¼šé€è¿‡ xz çš„æ”¯æŒè¿›è¡Œå‹ç¼©/è§£å‹ç¼©ï¼šæ­¤æ—¶æ¡£åæœ€å¥½ä¸º *.tar.xz ç‰¹åˆ«ç•™æ„ï¼Œ -z, -j, -J ä¸å¯ä»¥åŒæ—¶å‡ºç°åœ¨ä¸€ä¸²æŒ‡ä»¤åˆ—ä¸­ -v ï¼šåœ¨å‹ç¼©/è§£å‹ç¼©çš„è¿‡ç¨‹ä¸­ï¼Œå°†æ­£åœ¨å¤„ç†çš„æ¡£åæ˜¾ç¤ºå‡ºæ¥ï¼ -f filenameï¼š-f åé¢è¦ç«‹åˆ»æ¥è¦è¢«å¤„ç†çš„æ¡£åï¼å»ºè®® -f å•ç‹¬å†™ä¸€ä¸ªé€‰é¡¹å•°ï¼(æ¯”è¾ƒä¸ä¼šå¿˜è®°) -C ç›®å½• ï¼šè¿™ä¸ªé€‰é¡¹ç”¨åœ¨è§£å‹ç¼©ï¼Œè‹¥è¦åœ¨ç‰¹å®šç›®å½•è§£å‹ç¼©ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ã€‚ å…¶ä»–åç»­ç»ƒä¹ ä¼šä½¿ç”¨åˆ°çš„é€‰é¡¹ä»‹ç»ï¼š -p(å°å†™) ï¼šä¿ç•™å¤‡ä»½èµ„æ–™çš„åŸæœ¬æƒé™ä¸å±æ€§ï¼Œå¸¸ç”¨äºå¤‡ä»½(-c)é‡è¦çš„è®¾å®šæ¡£ -P(å¤§å†™) ï¼šä¿ç•™ç»å¯¹è·¯å¾„ï¼Œäº¦å³å…è®¸å¤‡ä»½èµ„æ–™ä¸­å«æœ‰æ ¹ç›®å½•å­˜åœ¨ä¹‹æ„ï¼›â€“exclude=FILEï¼šåœ¨å‹ç¼©çš„è¿‡ç¨‹ä¸­ï¼Œä¸è¦å°† FILE æ‰“åŒ…ï¼ å…¶å®æœ€ç®€å•çš„ä½¿ç”¨ tar å°±åªè¦è®°å¿†åº•ä¸‹çš„æ–¹å¼å³å¯ å‹ç¼©ï¼štar -zcv -f filename.tar.gz \u003cè¦è¢«å‹ç¼©çš„æ¡£æ¡ˆæˆ–ç›®å½•åç§°\u003e æŸ¥çœ‹æ–‡æ¡£æ ‘ï¼štar -ztv -f filename.tar.gz è§£å‹ç¼©ï¼štar -zxv -f filename.tar.gz -C \u003cæ¬²è§£å‹ç¼©çš„ç›®å½•\u003e` ä¸Šé¢çš„å‘½ä»¤éœ€è¦æ ¹æ®å‹ç¼©æ ¼å¼çš„ä¸åŒï¼Œé€‰ç”¨ -z -j -J é€‰é¡¹ï¼Œè€Œå®é™…ä¸Šæ–‡æ¡£çš„åç¼€å°±å·²ç»è¡¨æ˜äº†å®ƒçš„å‹ç¼©æ ¼å¼ï¼Œä¸å…è®©äººè§‰å¾—å¤šä½™ã€‚å› æ­¤å°±æœ‰è¿™å¹ºä¸€æ¡é€šç”¨çš„å‹ç¼©/è§£å‹ option -a, --auto-compress Use archive suffix to determine the compression program. ä½¿ç”¨è¿™ä¸ªï¼Œä¾¿æœ‰äº†é€šç”¨çš„è§£å‹æŒ‡ä»¤ï¼š tar -axv -f file.tar.* ï¼ˆå®ƒé€‚ç”¨äºä¸Šè¿°ä¸‰ç§å‹ç¼©æ ¼å¼ï¼‰ ä»…è§£å‹æŒ‡å®šçš„æ–‡æ¡£ å…ˆæŸ¥çœ‹æ–‡æ¡£æ ‘æ‰¾åˆ°éœ€è¦è§£å‹çš„æ–‡æ¡£çš„æ–‡æ¡£å tar -zxv -f æ‰“åŒ…æ¡£.tar.gz å¾…è§£å¼€æ¡£å æ‰“åŒ…æŸç›®å½•ï¼Œä½†ä¸å«è¯¥ç›®å½•ä¸‹çš„æŸäº›æ¡£æ¡ˆä¹‹ä½œæ³•ä½¿ç”¨ â€“exclude=FILE é€‰é¡¹ï¼ˆæ”¯æŒæ–‡æ¡£åçš„æ¨¡å¼åŒ¹é…ï¼Œè€Œä¸”å¯é‡å¤ï¼‰ tar -zcv -f filename.tar.gz directory --exclude=FILE1 --exclude=func* åªæ‰“åŒ…ç›®å½•ä¸­æ¯”æŒ‡å®šæ—¶åˆ»æ›´æ–°çš„æ–‡æ¡£ä½¿ç”¨ --newer-mtime=\"2015/06/17\" é€‰é¡¹ã€‚ tarfile, tarballtarfile | çº¯æ‰“åŒ…ã€æœªå‹ç¼©çš„ tar æ–‡æ¡£ tarball | å‹ç¼©äº†çš„ tar æ–‡æ¡£ 2. zipæ ¼å¼ï¼ˆlinux ä¸€èˆ¬ä¹Ÿä¼šè‡ªå¸¦ï¼Œè¯¦ç»†çš„è¯·manï¼‰ å‹ç¼©å‘½ä»¤ï¼šzip å‹ç¼©ç›®å½•ï¼šzip -r filename.zip directory r è¡¨ç¤ºé€’å½’å‹ç¼©ï¼Œå‹ç¼©åŒ…ä¼šåŒ…å«è¿™ä¸ªç›®å½• è§£å‹å‘½ä»¤ï¼šunzip è§£å‹åˆ°æŸç›®å½•ï¼šunzip -d directory filename.zip (-d dir è¡¨ç¤ºå°†å†…å®¹è§£å‹åˆ°dirç›®å½•å†…) -t æµ‹è¯•å‹ç¼©æ¡£çš„å®Œæ•´æ€§ -x filename æ’é™¤æŸæ–‡æ¡£ 3. 7zæ ¼å¼ï¼ˆéœ€è¦p7zipï¼Œdeepinè‡ªå¸¦ï¼Œæ›´å¤šçš„è¯·manï¼‰ æŸ¥çœ‹ç›®å½•æ ‘ï¼š7z l file.7z (List contents of archive) å‹ç¼©ï¼š7z a file.7z file1 directory1 (a ä¸ºåˆ›å»ºå‹ç¼©æ¡£æˆ–å‘å‹ç¼©æ¡£ä¸­æ·»åŠ æ–‡æ¡£/ç›®å½•ï¼Œä¸€æ¬¡å¯æŒ‡å®šå¤šä¸ªè¦å‹ç¼©çš„æ–‡æ¡£æˆ–ç›®å½•) è§£å‹ï¼š7z x file.7z -o directory (è§£å‹åˆ°æŒ‡å®šç›®å½•) æµ‹è¯•å®Œæ•´æ€§ï¼š 7z t file.7z p7zip å®‰è£…å¥½åï¼Œä¼šæä¾› 7zã€7zaã€7zr ä¸‰ä¸ªæŒ‡ä»¤ï¼Œä¸€èˆ¬æ¥è¯´ç›´æ¥ç”¨ 7z å°±è¡Œã€‚ P.S. 7z ä¸ä¼šä¿å­˜ Linux æ–‡æ¡£çš„ç”¨æˆ·ã€ç”¨æˆ·ç»„ä¿¡æ¯ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥ç”¨äº Linux ç³»ç»Ÿå¤‡ä»½ï¼Œæ­¤æ—¶å»ºè®®ç”¨ tar.xz æˆ– tar.7zï¼ˆä¹Ÿå°±æ˜¯å…ˆç”¨taræ‰“åŒ…ï¼‰ 4. raræ ¼å¼ï¼ˆè¿˜æ˜¯é‚£å¥è¯ï¼Œæ›´å¤šçš„è¯·manï¼‰rar æ˜¯éå¼€æºçš„æ ¼å¼ï¼ŒLinux é»˜è®¤æ˜¯ä¸ä¼šåŒ…å« rar å‹ç¼©è½¯ä»¶çš„ï¼Œä½†æ˜¯å®ƒçš„è§£å‹è½¯ä»¶æ˜¯å¼€æºçš„ï¼Œdeepin è‡ªå¸¦ unrarï¼Œé¡ºä¾¿ 7zip ä¹Ÿå¯è§£å‹ rar æ–‡æ¡£ã€‚è‹¥æƒ³ç”¨linuxåˆ›å»ºrarå‹ç¼©æ¡£ï¼Œéœ€è¦ä»rarlabä¸Šä¸‹è½½ Linux ç‰ˆï¼Œï¼ˆdeepinæºè‡ªå¸¦ï¼‰ä¸è¿‡è¦æ³¨æ„çš„æ˜¯è¯¥ linux ç‰ˆæ˜¯ 40 å¤©è¯•ç”¨ç‰ˆï¼Œè¦é•¿æœŸä½¿ç”¨çš„è¯ï¼Œå¯èƒ½éœ€è¦ç ´è§£ã€‚ï¼ˆrar çš„ key ç½‘ä¸Šä¸€æœä¸€å¤§æŠŠï¼‰ å‹ç¼©ï¼šrar a file.rar file ï¼ˆè¿™ä¸ªæ˜¯è¯•ç”¨çš„ï¼‰ è§£å‹ï¼šunrar x file.rar ï¼ˆè¿™ä¸ªå¼€æºå…è´¹ï¼‰ å…¶å®æˆ‘æŒºä¸­æ„ rar çš„ä¿®å¤åŠŸèƒ½çš„ï¼Œä¸çŸ¥é“ä¸ºå•¥ 7z xz è¿™æ ·çš„æ–°æ ¼å¼æ²¡æœ‰æ·»åŠ ç±»ä¼¼çš„recorvery recordsã€‚ä¸Šæ¬¡ä¸‹ä¸ª idea çš„ tarballï¼Œä¸‹äº†å››äº”æ¬¡æ‰ä¸‹åˆ°ä¸€ä¸ªå®Œæ•´çš„ï¼Œè¦æ˜¯ç”¨rar çš„è¯ï¼Œå¤§æ¦‚ä¸€é”®ä¿®å¤å°±å¥½äº†ï¼Œå¯ tar.gz æˆ‘ä¸çŸ¥é“æ€å¹ºä¿®å¤ï¼Œåªå¥½ä¸€ééé‡å¤ä¸‹è½½ã€‚ã€‚ ","date":"2019-01-14","objectID":"/posts/compression-related-instructions-under-linux/:5:1","series":null,"tags":["Linux","Compression","å‹ç¼©","tar"],"title":"å¸¸è§å‹ç¼©æ ¼å¼çš„åŒºåˆ«ï¼ŒåŠ Linux ä¸‹çš„å‹ç¼©ç›¸å…³æŒ‡ä»¤","uri":"/posts/compression-related-instructions-under-linux/#4-raræ ¼å¼è¿˜æ˜¯é‚£å¥è¯æ›´å¤šçš„è¯·man"},{"categories":["tech"],"content":" å…­ã€å‚è€ƒ æ¡£æ¡ˆä¸æ¡£æ¡ˆç³»ç»Ÿçš„å‹ç¼©,æ‰“åŒ…ä¸å¤‡ä»½ ç»´åŸºç™¾ç§‘ rar tar gz zip 7z æœ‰ä»€å¹ºåŒºåˆ«? - çŸ¥ä¹ ä¸ºä»€å¹ºlinuxçš„åŒ…éƒ½æ˜¯.tar.gzï¼Ÿè¦è§£å‹ä¸¤æ¬¡ - çŸ¥ä¹ ","date":"2019-01-14","objectID":"/posts/compression-related-instructions-under-linux/:5:2","series":null,"tags":["Linux","Compression","å‹ç¼©","tar"],"title":"å¸¸è§å‹ç¼©æ ¼å¼çš„åŒºåˆ«ï¼ŒåŠ Linux ä¸‹çš„å‹ç¼©ç›¸å…³æŒ‡ä»¤","uri":"/posts/compression-related-instructions-under-linux/#å…­å‚è€ƒ"},{"categories":["life"],"content":" é«˜ä¸­è€ƒè™‘å¿—å‘çš„æ—¶å€™ï¼Œæˆ‘æœ€å¼€å§‹æƒ³é€‰æ‹©ç”µå­ä¿¡æ¯å·¥ç¨‹ï¼Œå› ä¸ºå°æ—¶å€™å°±å–œæ¬¢æ‘†å¼„å„ç§ç”µå­å™¨ä»¶ï¼Œè¿™ä¸ªæ–¹å‘ç¡¬ä»¶è½¯ä»¶éƒ½èƒ½ç©ï¼Œå°±æ„Ÿè§‰å¾ˆæœ‰è¶£ï¼Œåªæ˜¯æ‹…å¿ƒè‡ªå·±é«˜ä¸‰å¤ªæ”¾æµªå½¢éª¸è€ƒä¸ä¸Šã€‚å¶ç„¶æƒ³èµ·åœ¨å­¦æ ¡é˜…è§ˆå®¤è¯»æ‚å¿—æ—¶ï¼Œæ›¾è¢«ç§‘å¹»ä¸–ç•Œ2013å¹´12æœŸé‡Œæ²–æ°æ­¦å½¦çš„ã€Šåœ¨å›å£°ä¸­é‡å†ã€‹ç»™æ‰“åŠ¨â€”â€”ç”¨è€³æœµã€Œçœ‹è§ã€ä¸–ç•Œå®åœ¨æ˜¯å¤ªå¥‡å¦™äº†ï¼Œæˆ‘å½“æ—¶ç—´ç—´åœ°å¹»æƒ³äº†å¥½å‡ å¤©ã€‚ è¿™æ ·æˆ‘å¼€å§‹è€ƒè™‘é€‰æ‹©å£°å­¦ã€‚ æˆ‘ä»åŒæ¡Œæ¨èçš„ã€Šåˆ€å‰‘ç¥åŸŸã€‹å¼€å§‹æ¥è§¦æ—¥æœ¬çš„ ACG æ–‡åŒ–ï¼Œåæ¥æ¥è§¦åˆ°åˆéŸ³æœªæ¥å’Œæ´›å¤©ä¾ï¼Œå°±å¯¹æ­Œå£°åˆæˆ(singing synthesis)äº§ç”Ÿäº†å¾ˆå¤§çš„å…´è¶£ï¼Œä»”ç»†ä¸€æƒ³å‘ç°è¿™ä¹Ÿåº”è¯¥æ˜¯å£°å­¦çš„èŒƒç•´ï¼Œè¿™ä½¿æˆ‘åšå®šäº†æˆ‘é€‰æ‹©å£°å­¦çš„æƒ³æ³•ã€‚ ä»é‚£æ—¶åˆ°ç°åœ¨çš„å„ç§ç ´äº‹ï¼Œå®åœ¨ä¸æƒ³å¤šè¯´ï¼Œå°±ç•¥è¿‡ä¸æäº†ã€‚æ€»ä¹‹æˆ‘é€‰æ‹©äº†å£°å­¦ï¼Œç„¶åå¹²å¾—å¾ˆå¤±è´¥ã€‚ã€‚ã€‚ ä¸ºå•¥æƒ³å†™è¿™ç¯‡æ–‡ç« å‘¢ï¼Ÿè¯è¿˜å¾—ä»å»å¹´åä¸€æœˆä»½è¯´èµ·ï¼Œå½“æ—¶è¦å­¦ Matlabï¼Œå°±åœ¨ bilibili ä¸Šæ‰¾äº†ä¸ªæ•™ç¨‹ï¼šè‡ªåˆ¶åˆæˆå™¨æ¼”å¥é¸Ÿä¹‹è¯—ï¼Œè®²ç”¨ Matlab åšå‰ä»–éŸ³åˆæˆï¼Œè®²å¾—ç‰¹åˆ«æ£’ï¼Œæˆ‘è·Ÿç€åšå‡ºäº†guitar-synthesizer è¿™ä¸ªå°ç©æ„å„¿ã€‚ ç„¶åä»Šå¤©å‘ç°é‚£ä¸ªæ•™ç¨‹çš„ä½œè€…å°±æ˜¯åšæ­Œå£°åˆæˆçš„ï¼Œè€Œä¸”ä» 2011 å¹´ 13 å²å¼€å§‹ï¼Œå› ä¸ºæƒ³è®©åˆéŸ³å”±ä¸­æ–‡ï¼Œ å°±å¼€å§‹å†™ä»£ç ï¼Œä¸€å†™å°±å†™åˆ°ç°åœ¨ï¼Œä»åˆä¸­å†™åˆ°ç•™å­¦ç¾å›½å¸¸æ˜¥è—¤ï¼Œä»ç®€å•çš„æ—¶åŸŸæ‹¼æ¥åˆ°ç°åœ¨çš„æ·±åº¦ç¥ç»ç½‘ç»œã€éšé©¬å°”å¯å¤«æ¨¡å‹ã€‚ä»–åœ¨ä¸Šä¸ªæš‘å‡åˆ°é›…é©¬å“ˆï¼ˆvocaloid çš„åˆ¶ä½œå…¬å¸ï¼‰å®ä¹ ï¼Œå¹¶æ¨å‡ºäº†è‡ªå·±ç¬¬äº”æ¬¡é‡åˆ¶çš„æ­Œå£°åˆæˆå¼•æ“ Synthesizer Vã€‚è¿™ä¸€ç³»åˆ—çš„äº‹è¿¹ï¼Œä¸ƒå¹´äº”æ¬¡é‡åˆ¶ï¼Œä»åˆä¸­ç”Ÿåˆ°ç°åœ¨åŒä¿®è®¡ç®—æœºç§‘å­¦å’Œæ•°å­¦ï¼Œç®€ç›´è®©äººå¹ä¸ºè§‚æ­¢ã€‚è¿™ä½ä½œè€…çš„åå­—å«åä¾ƒå¦‚ï¼ˆKanru Huaï¼‰ï¼Œç½‘ç»œå¸¸ç”¨æ˜µç§° sleepwalkingï¼Œä»–çš„ä¸ªäººç½‘ç«™Kanru Huaâ€™s Website - About Me. é€šè¿‡ä»–çš„åšå®¢ï¼Œæˆ‘äº†è§£åˆ°æ­Œå£°åˆæˆéœ€è¦ä¸¤ä¸ªæ–¹å‘çš„çŸ¥è¯†ï¼šä¿¡å·å¤„ç†å’Œæœºå™¨å­¦ä¹ ã€‚ äºæ˜¯æˆ‘æƒ³èµ·äº†æˆ‘çš„åˆå¿ƒã€‚ æˆ‘å°çš„æ—¶å€™ç‰¹åˆ«å–œæ¬¢æ‹†å„ç§ç”µå­è®¾å¤‡ï¼Œæ›¾ç»ç”¨æ‰‹æœºç”µæ± å’Œåæ‰‹ç”µåšè¿‡æ‰‹ç”µç­’ï¼Œå†åŠ ä¸Šä¸ªæ‰‹æœºæŒ¯åŠ¨å™¨ç”¨æ¥å“äººï¼Œè¿˜å–œæ¬¢åœ¨å®¶åšå„ç§å®éªŒã€‚å¯æ•´ä¸ªå¤§å­¦ï¼Œæˆ‘çš„å„ç§æ‰‹å·¥è¯¾å®éªŒè¯¾å¼„å¾—ä¸€å¡Œç³Šæ¶‚ï¼Œå«åº•çš„å­˜åœ¨ã€‚è¿™æ ·è¯´æ¥ï¼Œå¦‚æœå½“åˆé€‰äº†ç”µå­ä¿¡æ¯å·¥ç¨‹ï¼Œå¯èƒ½ä¼šæ··å¾—æ›´å·®ã€‚ ä¿¡å·å¤„ç†å­¦å¾—ä¸€å›¢ç³Ÿï¼Œä¸€ç›´æƒ³åŠªåŠ›å¯åœ¨è¿™æ–¹é¢æ€»æ˜¯åŠé€”è€ŒåºŸã€‚ è¯´åˆ°åº•è¿˜æ˜¯è‡ªæ§åŠ›å¤ªå·®ï¼Œä¸ºä½•æˆ‘å°±ä¸èƒ½æŒ‰éƒ¨å°±ç­ä¸€å›å‘¢ï¼Ÿåˆ°åº•æ˜¯æ€ä¹ˆæçš„ä¼šå…»æˆè¿™æ ·çš„æ€§æ ¼ï¼Œè¿™æ ·çš„æ—¶å€™ä¼šå¾ˆæ¨è‡ªå·±çªå›Šçš„æ€§æ ¼ã€‚ å¦‚æœæˆ‘ä¹Ÿèƒ½åƒå®¤å‹ä¸€æ ·æŒ‰éƒ¨å°±ç­çš„å®Œæˆå­¦ä¸šï¼Œåªåœ¨ç©ºé—²æ—¶é—´åšè‡ªå·±çš„äº‹â€¦å¯æƒœæ²¡æœ‰å¦‚æœã€‚ ç»å¸¸ä¼šå‘Šè¯‰è‡ªå·±åšè¿‡çš„äº‹å·²ç»ä¸å¯é€†è½¬äº†ï¼Œä¸éœ€è¦åæ‚”ï¼Œæ‰€ä»¥ä¹Ÿä¸ä¼šåæ‚”ã€‚å¤§æ¦‚æ½œæ„è¯†é‡Œè¿˜æ˜¯ä¼šæœ‰æ€¨å¿µï¼Œæ‰€ä»¥æ‰ä¼šåœ¨è¿™æ ·çš„æ—¶åˆ»çˆ†å‘å‡ºæ»¡æ»¡çš„æ¶æ„ã€‚ åªæ˜¯åæ‚”å´ä¸åšå‡ºæ”¹å˜æ˜¯æ²¡æœ‰ç”¨çš„ï¼Œä½†æˆ‘å®Œå…¨ä¸ç›¸ä¿¡è‡ªå·±èƒ½æ”¹æ‰è¿™æ ·çš„æ€§æ ¼ï¼Œè‡ªæš´è‡ªå¼ƒã€‚çºµæ¬²ä¸€æ—¶çˆ½ï¼Œ ä¸€ç›´çºµæ¬²ä¸€ç›´çˆ½hhhâ€¦ è¯´è™½è¿™æ ·è¯´ï¼Œè¿˜æ˜¯æƒ³ç»§ç»­æŒ£æ‰ä¸‹å»ï¼Œä¿¡å·å¤„ç†å°±åƒä¸€é“æ§›ï¼Œä¸è·¨è¿‡å»æˆ‘æ— æ³•é¢å¯¹è‡ªå·±ã€‚ ã€Œå¸Œæœ›æ˜å¹´å¹´åº•çš„æ€»ç»“ä¸­ï¼Œæˆ‘ä¸è¦å†è¿™ä¹ˆä¸§ã€ï¼Œè¿™æ ·å¤§å£°è¯´å‡ºæ¥çš„è¯ï¼Œè¨€å°±èƒ½ã€Œçµã€å§ï¼Ÿæˆ‘è®°å¾—æˆ‘è¿æ°”ä¸€ç›´æŒºå¥½çš„ï¼ˆåˆçªå›Šåˆ°è¦é è¿æ°”ã€‚ã€‚ï¼‰ æ›´æ–°ï¼š ä»Šå¤©äºŒä¹¦ä»‹ç»ç»™æˆ‘ä¸€ç¯‡æ–‡ç« æˆ‘çš„ç¼–ç¨‹ç»å†ï¼Œä½œè€…å’Œæˆ‘ä¸€æ ·ã€Œä¸èƒ½å…¼é¡¾å…´è¶£ä¸å­¦ä¸šã€ï¼Œå¤§ä¸€ç»“æŸå°±é€€å­¦äº†ï¼Œç°åœ¨åœ¨é˜¿é‡Œå·´å·´å·¥ä½œã€‚ä»–åšå®¢çš„è§‚ç‚¹å¾ˆä¸­è‚¯ï¼š æˆ‘å®¶äººéƒ½æ˜¯å¾ˆä¼ ç»Ÿçš„ä¸€ä»£ï¼Œä¸ç†è§£æˆ‘å­¦ä¹ ç¼–ç¨‹æœ€ç»ˆèƒ½åšå‡ºä»€ä¹ˆï¼Œä»–ä»¬ä¸»å¼ å…ˆå®Œæˆå­¦ä¸šï¼Œå†åšè¿™ä»¶äº‹ã€‚ä½†æ˜¯æˆ‘å¾ˆæ¸…æ¥šæˆ‘è‡ªå·±çš„æ™ºå•†ï¼Œä¸è¶³ä»¥å¤šçº¿ç¨‹å¤„ç†ä¸åŒçš„å¤§é¢†åŸŸï¼Œæ‰€ä»¥æˆ‘é¡¶ç€å‹åŠ›ï¼ŒåŠªåŠ›åœ°åšå‡ºæ¥ä»–ä»¬èƒ½çœ‹å‡ºæ¥çš„ã€Œæˆç»©ã€ï¼Œæ‰èƒ½æ¢æ¥ä»–ä»¬çš„ç†è§£ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ é€šè¿‡ä½ çš„ç†æ€§åˆ†æï¼ŒåšæŒè®¤ä¸ºæŸä»¶äº‹æƒ…æ˜¯å¯¹çš„ï¼Œå°±åŠªåŠ›çš„å»åšï¼Œä¸è¦æ”¾å¼ƒäº†ä»¥åçœ‹åˆ°å¦ä¸€ä¸ªäººåšäº†ä½ æ›¾ç»æƒ³åšçš„ä¸œè¥¿ç„¶åæ„Ÿæ…¨å½“åˆåº”è¯¥æ€ä¹ˆæ ·æ€ä¹ˆæ ·ã€‚ â€“æˆ‘çš„ç¼–ç¨‹ç»å† åªæœ‰åœ¨å·²ç»æ‹¥æœ‰è§£å†³é—®é¢˜çš„èƒ½åŠ›çš„æ—¶å€™ï¼Œæ‰æœ‰èµ„æ ¼è€ƒè™‘é€€å­¦è¿™ä»¶äº‹ã€‚â€“ä½ æ ¹æœ¬ç”¨ä¸ç€é€€å­¦ æˆ‘ä»”ç»†æƒ³äº†æƒ³ï¼Œæˆ‘ä¸éœ€è¦å¤ªåœ¨æ„è‡ªå·±ã€Œä¸èƒ½å…¼é¡¾ã€ã€ã€Œè‡ªæ§åŠ›å¤ªå¼±ã€ã€‚å¦‚æœçœŸè€ƒè™‘æ¸…æ¥šäº†å¾—å¤±ï¼Œæˆ‘åªéœ€è¦ã€Œæ‹¥æœ‰è§£å†³é—®é¢˜çš„èƒ½åŠ›ã€ï¼Œç„¶åå»åšæˆ‘æƒ³åšçš„å°±è¡Œäº†ã€‚ æˆ‘è‡ªæ§åŠ›å¾ˆå¼±ï¼Œè€Œä¸”è¿™ä¹ˆå¤šå¹´äº†ä¸€ç›´æ”¹ä¸äº†ï¼Œå³ä½¿å†å»¶æœŸä¸€å¹´ï¼Œä¹Ÿæœ‰å¯èƒ½è¿˜æ˜¯æ‹¿ä¸åˆ°æ¯•ä¸šè¯ï¼ŒæŠ˜ç£¨è‡ªå·±è€Œå·²ã€‚è€Œä¸Šç­çš„è¯ï¼Œå°±æš‘å‡å®ä¹ çš„ç»éªŒæ¥çœ‹ï¼Œå·¥ä½œéƒ½æœ‰è¿›åº¦æ¡å‚¬ç€ï¼Œåè€Œæ´»çš„æ›´æœ‰æœæ°”ã€‚ ","date":"2019-01-08","objectID":"/posts/relive-in-the-echo/:0:0","series":null,"tags":["é—²è¨€ç¢è¯­","åˆå¿ƒ","æ­Œå£°åˆæˆ"],"title":"åœ¨å›å£°ä¸­é‡å†","uri":"/posts/relive-in-the-echo/#"},{"categories":["tech"],"content":" æœ¬ç¬”è®°æ•´ç†è‡ªã€ŠSQL åŸºç¡€æ•™ç¨‹ã€‹ã€ã€ŠMySQL å¿…çŸ¥å¿…ä¼šã€‹å’Œç½‘ä¸Šèµ„æ–™ã€‚ä¸ªäººç¬”è®°ä¸ä¿è¯æ­£ç¡®ã€‚ ","date":"2018-06-17","objectID":"/posts/sql-basics-2-queries/:0:0","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢","uri":"/posts/sql-basics-2-queries/#"},{"categories":["tech"],"content":" ä¸€ã€å¤æ‚æŸ¥è¯¢","date":"2018-06-17","objectID":"/posts/sql-basics-2-queries/:1:0","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢","uri":"/posts/sql-basics-2-queries/#ä¸€å¤æ‚æŸ¥è¯¢"},{"categories":["tech"],"content":" è§†å›¾å°† SELECT æŸ¥è¯¢åŒ…è£…æˆä¸€ä¸ªè™šæ‹Ÿè¡¨ï¼Œè¯¥è™šæ‹Ÿè¡¨å°±è¢«ç§°ä¸ºè§†å›¾ã€‚ï¼ˆå› ä¸ºåªæ˜¯ä¸€ä¸ªåŒ…è£…ï¼Œå› æ­¤è§†å›¾çš„æ•°æ®ä¹Ÿä¼šéšç€åŸè¡¨çš„æ›´æ–°è€Œæ›´æ–°ï¼‰ ç”¨é€”ï¼š ç®€åŒ–å¤æ‚çš„SQLæŸ¥è¯¢ï¼Œç”¨å®ƒæ›¿æ¢å­æŸ¥è¯¢ï¼Œèƒ½é™ä½æŸ¥è¯¢çš„åµŒå¥—æ·±åº¦ã€‚ SELECT æŸ¥è¯¢çš„é‡ç”¨ï¼Œå‡å°‘é‡å¤æŸ¥è¯¢ã€‚ â€¦ åˆ›å»ºè§†å›¾ï¼š sql CREATE VIEW \u003cè§†å›¾åç§°\u003e (\u003cè§†å›¾åˆ—å1\u003e, \u003cè§†å›¾åˆ—å2\u003e... ) AS \u003cSELECT è¯­å¥\u003e; å…¶ä¸­ SELECT çš„ç»“æœåˆ—å’Œè§†å›¾åˆ—åä¸€ä¸€å¯¹åº”ã€‚3. è§†å›¾çš„é™åˆ¶ 1. è§†å›¾çš„ SELECT å­å¥ï¼Œä¸èƒ½åŒ…å« ORDER BY å­å¥ã€‚å› ä¸ºè§†å›¾ä¹Ÿæ˜¯è¡¨ï¼Œè€Œè¡¨æ˜¯é›†åˆï¼Œå®ƒæ²¡æœ‰é¡ºåºã€‚ï¼ˆä¹Ÿæœ‰äº›DBæ”¯æŒè¯¥ç”¨æ³•ï¼Œä½†ä¸é€šç”¨ï¼‰1. è§†å›¾çš„æ›´æ–°ï¼šåªåœ¨å¾ˆæœ‰é™çš„æ¡ä»¶ä¸‹ï¼Œæ‰èƒ½åœ¨è§†å›¾ä¸Šä½¿ç”¨ INSERT/DELETE/UPDATE è¿™æ ·çš„å˜æ›´æ•°æ®çš„è¯­å¥ã€‚ï¼ˆè§†å›¾åº”è¯¥åªç”¨äºæ£€ç´¢ï¼Œèƒ½ä¸æ›´æ–°å°±ä¸è¦æ›´æ–°å®ƒï¼‰4. åˆ é™¤è§†å›¾ï¼šDROP VIEW \u003cè§†å›¾åç§°\u003e; ","date":"2018-06-17","objectID":"/posts/sql-basics-2-queries/:1:1","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢","uri":"/posts/sql-basics-2-queries/#è§†å›¾"},{"categories":["tech"],"content":" å­æŸ¥è¯¢å­æŸ¥è¯¢ï¼Œå…¶å®å°±æ˜¯ä¸€æ¬¡æ€§çš„è§†å›¾: sql SELECT ... FROM ( SELECT ... -- è¿™å°±æ˜¯ä¸€ä¸ªå­æŸ¥è¯¢ï¼šåµŒå¥—çš„ select è¯­å¥ ) AS \u003cåˆ«å\u003e ... ä¸Šé¢çš„æŸ¥è¯¢çš„ FROM å­å¥ä¸­ï¼Œç»™å¦ä¸€ SELECT å­å¥å®šä¹‰äº†ä¸€ä¸ªåˆ«åï¼Œå¹¶å°†å®ƒä½œä¸ºäº†æŸ¥è¯¢å¯¹è±¡ã€‚è¿™å°±æ˜¯ä¸€ä¸ªå­æŸ¥è¯¢ã€‚ å­æŸ¥è¯¢ä¸ä»…èƒ½ç”¨äº FROMï¼Œè¿˜èƒ½ç”¨åœ¨ WHERE å­å¥ç­‰å¾ˆå¤šåœ°æ–¹ã€‚ å…³è”å­æŸ¥è¯¢å³ç”¨åˆ°äº†å¤–éƒ¨æ•°æ®çš„å­æŸ¥è¯¢è¯­å¥ï¼š sql SELECT ... FROM product AS p1 WHERE ( SELECT ... FROM duck AS p2 WHERE p1.price \u003e p2.price -- è¿™é‡Œï¼Œå†…éƒ¨å­æŸ¥è¯¢è®¿é—®äº†å¤–éƒ¨æŸ¥è¯¢çš„è¡¨p1ï¼Œå› æ­¤æ˜¯ä¸€ä¸ªå…³è”å­æŸ¥è¯¢ã€‚ ); ","date":"2018-06-17","objectID":"/posts/sql-basics-2-queries/:1:2","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢","uri":"/posts/sql-basics-2-queries/#å­æŸ¥è¯¢"},{"categories":["tech"],"content":" å­æŸ¥è¯¢å­æŸ¥è¯¢ï¼Œå…¶å®å°±æ˜¯ä¸€æ¬¡æ€§çš„è§†å›¾: sql SELECT ... FROM ( SELECT ... -- è¿™å°±æ˜¯ä¸€ä¸ªå­æŸ¥è¯¢ï¼šåµŒå¥—çš„ select è¯­å¥ ) AS \u003cåˆ«å\u003e ... ä¸Šé¢çš„æŸ¥è¯¢çš„ FROM å­å¥ä¸­ï¼Œç»™å¦ä¸€ SELECT å­å¥å®šä¹‰äº†ä¸€ä¸ªåˆ«åï¼Œå¹¶å°†å®ƒä½œä¸ºäº†æŸ¥è¯¢å¯¹è±¡ã€‚è¿™å°±æ˜¯ä¸€ä¸ªå­æŸ¥è¯¢ã€‚ å­æŸ¥è¯¢ä¸ä»…èƒ½ç”¨äº FROMï¼Œè¿˜èƒ½ç”¨åœ¨ WHERE å­å¥ç­‰å¾ˆå¤šåœ°æ–¹ã€‚ å…³è”å­æŸ¥è¯¢å³ç”¨åˆ°äº†å¤–éƒ¨æ•°æ®çš„å­æŸ¥è¯¢è¯­å¥ï¼š sql SELECT ... FROM product AS p1 WHERE ( SELECT ... FROM duck AS p2 WHERE p1.price \u003e p2.price -- è¿™é‡Œï¼Œå†…éƒ¨å­æŸ¥è¯¢è®¿é—®äº†å¤–éƒ¨æŸ¥è¯¢çš„è¡¨p1ï¼Œå› æ­¤æ˜¯ä¸€ä¸ªå…³è”å­æŸ¥è¯¢ã€‚ ); ","date":"2018-06-17","objectID":"/posts/sql-basics-2-queries/:1:2","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢","uri":"/posts/sql-basics-2-queries/#å…³è”å­æŸ¥è¯¢"},{"categories":["tech"],"content":" äºŒã€å‡½æ•°ã€è°“è¯ã€CASE è¡¨è¾¾å¼","date":"2018-06-17","objectID":"/posts/sql-basics-2-queries/:2:0","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢","uri":"/posts/sql-basics-2-queries/#äºŒå‡½æ•°è°“è¯case-è¡¨è¾¾å¼"},{"categories":["tech"],"content":" å‡½æ•° ç»™å‡ºçš„é“¾æ¥éƒ½æ˜¯ MySQL çš„ ç®—æœ¯å‡½æ•° åŠ å‡ä¹˜é™¤ï¼š+ - * / ABS ç»å¯¹å€¼ MOD æ±‚ä½™ ROUND å››èˆäº”å…¥ å­—ç¬¦ä¸²å‡½æ•° CONCAT(str1,str2,â€¦) æ‹¼æ¥ LENGTH(str) å­—ç¬¦ä¸²çš„ bytes é•¿åº¦ CHAR_LENGTH(str) LOWER/UPPER å¤§å°å†™è½¬æ¢ REPLACE(str,from_str,to_str) æ›¿æ¢ SUBSTRING(str FROM pos FOR len) æˆªå– æ—¶é—´å’Œæ—¥æœŸå‡½æ•° CURRENT_DATE å½“å‰æ—¥æœŸ CURRENT_TIME å½“å‰æ—¶é—´ CURRENT_TIMESTAMP å½“å‰çš„æ—¥æœŸå’Œæ—¶é—´ EXTRACT(unit FROM date) æˆªå–æ—¥æœŸå…ƒç´ ï¼Œunit å¯ä¸º YEAR MONTH HOUR ç­‰ç­‰ è½¬æ¢å‡½æ•° CAST(expr AS type) å°† expr çš„ç»“æœè½¬æ¢æˆ type ç±»å‹ COALESCE(value,â€¦) ä»å·¦å¾€å³æ‰«æï¼Œè¿”å›ç¬¬ä¸€ä¸ªé NULL çš„å€¼ã€‚å¸¸ç”¨äºå°† NULL è½¬æ¢ä¸ºå…¶ä»–å€¼ã€‚eg. COALESCE(sth, 1) å¦‚æœ sth ä¸º NULL å°±ä¼šè¿”å›1. èšåˆå‡½æ•°ï¼šåŸºæœ¬å°±äº”ä¸ªï¼Œå·²ç»å­¦è¿‡äº†ã€‚ ","date":"2018-06-17","objectID":"/posts/sql-basics-2-queries/:2:1","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢","uri":"/posts/sql-basics-2-queries/#å‡½æ•°"},{"categories":["tech"],"content":" è°“è¯å³è¿”å›å¸ƒå°”å€¼çš„è¡¨è¾¾å¼ LIKEè°“è¯â€”â€”ç®€å•å­—ç¬¦ä¸²åŒ¹é…ï¼ˆæ…¢ï¼‰ åŒ¹é…æ•´ä¸ªåˆ— %ï¼šä»»æ„å­—ç¬¦å‡ºç°ä»»æ„æ¬¡ _ï¼šåŒ¹é…ä»»æ„ä¸€ä¸ªå­—ç¬¦ ä¸¾ä¾‹ï¼š sql SELECT name FROM list WHERE name LIKE '%Ryan%'; -- åŒ¹é…ä»»æ„åŒ…å« 'Ryan' çš„å­—ç¬¦ä¸² REGEXPè°“è¯â€”â€”æ­£åˆ™å­—ç¬¦ä¸²åŒ¹é… MySQL åªå®ç°äº†é€šç”¨æ­£åˆ™çš„ä¸€ä¸ªå­é›†ï¼Œè€Œä¸”æ˜¯searchæ¨¡å¼ã€‚ï¼ˆématchï¼‰ å…¶ä»– BETWEENï¼šèŒƒå›´åŒ¹é…ï¼Œeg. BETWEEN 1 AND 10 IS NULLã€IS NOT NULL INã€NOT INï¼šæ˜¯å¦åœ¨æŸé›†åˆå†… EXISTSã€NOT EXISTSï¼ˆæ¯”è¾ƒéš¾çš„ä¸€ä¸ªï¼Œå…¥é—¨é˜¶æ®µä¸è¦æ±‚ï¼‰ï¼šè¯¥è°“è¯æ¯”è¾ƒç‰¹æ®Šï¼Œåªéœ€è¦å³ä¾§ä¸€ä¸ªå‚æ•°ï¼Œè€Œä¸”è¯¥å‚æ•°ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯ä¸€ä¸ªå…³è”å­æŸ¥è¯¢ã€‚è€Œä¸”è¯¥å­æŸ¥è¯¢çš„SELECTå­å¥çš„å‚æ•°åŸºæœ¬å¯ä»¥éšæ„ï¼Œé€šå¸¸ä½¿ç”¨SELECT *. å¯¹äºå­æŸ¥è¯¢æœ‰è¿”å›å€¼çš„åˆ—ï¼Œå®ƒè¿”å›Trueï¼Œå¦åˆ™è¿”å›False. ä½†è¦æ³¨æ„ä¸º NULL æ—¶è¿”å› UNKNOW.ï¼ˆè€Œ WHERE åªè®¤ Trueï¼‰ ","date":"2018-06-17","objectID":"/posts/sql-basics-2-queries/:2:2","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢","uri":"/posts/sql-basics-2-queries/#è°“è¯"},{"categories":["tech"],"content":" è°“è¯å³è¿”å›å¸ƒå°”å€¼çš„è¡¨è¾¾å¼ LIKEè°“è¯â€”â€”ç®€å•å­—ç¬¦ä¸²åŒ¹é…ï¼ˆæ…¢ï¼‰ åŒ¹é…æ•´ä¸ªåˆ— %ï¼šä»»æ„å­—ç¬¦å‡ºç°ä»»æ„æ¬¡ _ï¼šåŒ¹é…ä»»æ„ä¸€ä¸ªå­—ç¬¦ ä¸¾ä¾‹ï¼š sql SELECT name FROM list WHERE name LIKE '%Ryan%'; -- åŒ¹é…ä»»æ„åŒ…å« 'Ryan' çš„å­—ç¬¦ä¸² REGEXPè°“è¯â€”â€”æ­£åˆ™å­—ç¬¦ä¸²åŒ¹é… MySQL åªå®ç°äº†é€šç”¨æ­£åˆ™çš„ä¸€ä¸ªå­é›†ï¼Œè€Œä¸”æ˜¯searchæ¨¡å¼ã€‚ï¼ˆématchï¼‰ å…¶ä»– BETWEENï¼šèŒƒå›´åŒ¹é…ï¼Œeg. BETWEEN 1 AND 10 IS NULLã€IS NOT NULL INã€NOT INï¼šæ˜¯å¦åœ¨æŸé›†åˆå†… EXISTSã€NOT EXISTSï¼ˆæ¯”è¾ƒéš¾çš„ä¸€ä¸ªï¼Œå…¥é—¨é˜¶æ®µä¸è¦æ±‚ï¼‰ï¼šè¯¥è°“è¯æ¯”è¾ƒç‰¹æ®Šï¼Œåªéœ€è¦å³ä¾§ä¸€ä¸ªå‚æ•°ï¼Œè€Œä¸”è¯¥å‚æ•°ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯ä¸€ä¸ªå…³è”å­æŸ¥è¯¢ã€‚è€Œä¸”è¯¥å­æŸ¥è¯¢çš„SELECTå­å¥çš„å‚æ•°åŸºæœ¬å¯ä»¥éšæ„ï¼Œé€šå¸¸ä½¿ç”¨SELECT *. å¯¹äºå­æŸ¥è¯¢æœ‰è¿”å›å€¼çš„åˆ—ï¼Œå®ƒè¿”å›Trueï¼Œå¦åˆ™è¿”å›False. ä½†è¦æ³¨æ„ä¸º NULL æ—¶è¿”å› UNKNOW.ï¼ˆè€Œ WHERE åªè®¤ Trueï¼‰ ","date":"2018-06-17","objectID":"/posts/sql-basics-2-queries/:2:2","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢","uri":"/posts/sql-basics-2-queries/#likeè°“è¯ç®€å•å­—ç¬¦ä¸²åŒ¹é…æ…¢"},{"categories":["tech"],"content":" è°“è¯å³è¿”å›å¸ƒå°”å€¼çš„è¡¨è¾¾å¼ LIKEè°“è¯â€”â€”ç®€å•å­—ç¬¦ä¸²åŒ¹é…ï¼ˆæ…¢ï¼‰ åŒ¹é…æ•´ä¸ªåˆ— %ï¼šä»»æ„å­—ç¬¦å‡ºç°ä»»æ„æ¬¡ _ï¼šåŒ¹é…ä»»æ„ä¸€ä¸ªå­—ç¬¦ ä¸¾ä¾‹ï¼š sql SELECT name FROM list WHERE name LIKE '%Ryan%'; -- åŒ¹é…ä»»æ„åŒ…å« 'Ryan' çš„å­—ç¬¦ä¸² REGEXPè°“è¯â€”â€”æ­£åˆ™å­—ç¬¦ä¸²åŒ¹é… MySQL åªå®ç°äº†é€šç”¨æ­£åˆ™çš„ä¸€ä¸ªå­é›†ï¼Œè€Œä¸”æ˜¯searchæ¨¡å¼ã€‚ï¼ˆématchï¼‰ å…¶ä»– BETWEENï¼šèŒƒå›´åŒ¹é…ï¼Œeg. BETWEEN 1 AND 10 IS NULLã€IS NOT NULL INã€NOT INï¼šæ˜¯å¦åœ¨æŸé›†åˆå†… EXISTSã€NOT EXISTSï¼ˆæ¯”è¾ƒéš¾çš„ä¸€ä¸ªï¼Œå…¥é—¨é˜¶æ®µä¸è¦æ±‚ï¼‰ï¼šè¯¥è°“è¯æ¯”è¾ƒç‰¹æ®Šï¼Œåªéœ€è¦å³ä¾§ä¸€ä¸ªå‚æ•°ï¼Œè€Œä¸”è¯¥å‚æ•°ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯ä¸€ä¸ªå…³è”å­æŸ¥è¯¢ã€‚è€Œä¸”è¯¥å­æŸ¥è¯¢çš„SELECTå­å¥çš„å‚æ•°åŸºæœ¬å¯ä»¥éšæ„ï¼Œé€šå¸¸ä½¿ç”¨SELECT *. å¯¹äºå­æŸ¥è¯¢æœ‰è¿”å›å€¼çš„åˆ—ï¼Œå®ƒè¿”å›Trueï¼Œå¦åˆ™è¿”å›False. ä½†è¦æ³¨æ„ä¸º NULL æ—¶è¿”å› UNKNOW.ï¼ˆè€Œ WHERE åªè®¤ Trueï¼‰ ","date":"2018-06-17","objectID":"/posts/sql-basics-2-queries/:2:2","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢","uri":"/posts/sql-basics-2-queries/#regexpè°“è¯æ­£åˆ™å­—ç¬¦ä¸²åŒ¹é…"},{"categories":["tech"],"content":" è°“è¯å³è¿”å›å¸ƒå°”å€¼çš„è¡¨è¾¾å¼ LIKEè°“è¯â€”â€”ç®€å•å­—ç¬¦ä¸²åŒ¹é…ï¼ˆæ…¢ï¼‰ åŒ¹é…æ•´ä¸ªåˆ— %ï¼šä»»æ„å­—ç¬¦å‡ºç°ä»»æ„æ¬¡ _ï¼šåŒ¹é…ä»»æ„ä¸€ä¸ªå­—ç¬¦ ä¸¾ä¾‹ï¼š sql SELECT name FROM list WHERE name LIKE '%Ryan%'; -- åŒ¹é…ä»»æ„åŒ…å« 'Ryan' çš„å­—ç¬¦ä¸² REGEXPè°“è¯â€”â€”æ­£åˆ™å­—ç¬¦ä¸²åŒ¹é… MySQL åªå®ç°äº†é€šç”¨æ­£åˆ™çš„ä¸€ä¸ªå­é›†ï¼Œè€Œä¸”æ˜¯searchæ¨¡å¼ã€‚ï¼ˆématchï¼‰ å…¶ä»– BETWEENï¼šèŒƒå›´åŒ¹é…ï¼Œeg. BETWEEN 1 AND 10 IS NULLã€IS NOT NULL INã€NOT INï¼šæ˜¯å¦åœ¨æŸé›†åˆå†… EXISTSã€NOT EXISTSï¼ˆæ¯”è¾ƒéš¾çš„ä¸€ä¸ªï¼Œå…¥é—¨é˜¶æ®µä¸è¦æ±‚ï¼‰ï¼šè¯¥è°“è¯æ¯”è¾ƒç‰¹æ®Šï¼Œåªéœ€è¦å³ä¾§ä¸€ä¸ªå‚æ•°ï¼Œè€Œä¸”è¯¥å‚æ•°ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯ä¸€ä¸ªå…³è”å­æŸ¥è¯¢ã€‚è€Œä¸”è¯¥å­æŸ¥è¯¢çš„SELECTå­å¥çš„å‚æ•°åŸºæœ¬å¯ä»¥éšæ„ï¼Œé€šå¸¸ä½¿ç”¨SELECT *. å¯¹äºå­æŸ¥è¯¢æœ‰è¿”å›å€¼çš„åˆ—ï¼Œå®ƒè¿”å›Trueï¼Œå¦åˆ™è¿”å›False. ä½†è¦æ³¨æ„ä¸º NULL æ—¶è¿”å› UNKNOW.ï¼ˆè€Œ WHERE åªè®¤ Trueï¼‰ ","date":"2018-06-17","objectID":"/posts/sql-basics-2-queries/:2:2","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢","uri":"/posts/sql-basics-2-queries/#å…¶ä»–"},{"categories":["tech"],"content":" CASE è¡¨è¾¾å¼ if - else if - else å½¢å¼ï¼š sql CASE WHEN \u003cæ±‚å€¼è¡¨è¾¾å¼\u003e THEN \u003cè¡¨è¾¾å¼\u003e WHEN \u003cæ±‚å€¼è¡¨è¾¾å¼\u003e THEN \u003cè¡¨è¾¾å¼\u003e WHEN \u003cæ±‚å€¼è¡¨è¾¾å¼\u003e THEN \u003cè¡¨è¾¾å¼\u003e ... ELSE \u003cè¡¨è¾¾å¼\u003e END switch æ¨¡å¼ï¼ˆä½†ä¸éœ€è¦breakï¼‰ sql CASE \u003cè¡¨è¾¾å¼\u003e WHEN \u003cè¡¨è¾¾å¼\u003e THEN \u003cè¡¨è¾¾å¼\u003e WHEN \u003cè¡¨è¾¾å¼\u003e THEN \u003cè¡¨è¾¾å¼\u003e ... ELSE \u003cè¡¨è¾¾å¼\u003e END è¿™æ˜¯å¯¹ CASE åçš„å…ƒç´ åšswitchæ¯”è¾ƒã€‚ ","date":"2018-06-17","objectID":"/posts/sql-basics-2-queries/:2:3","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢","uri":"/posts/sql-basics-2-queries/#case-è¡¨è¾¾å¼"},{"categories":["tech"],"content":" ä¸‰ã€é›†åˆè¿ç®—","date":"2018-06-17","objectID":"/posts/sql-basics-2-queries/:3:0","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢","uri":"/posts/sql-basics-2-queries/#ä¸‰é›†åˆè¿ç®—"},{"categories":["tech"],"content":" æ³¨æ„äº‹é¡¹ ä½œä¸ºè¿ç®—å¯¹è±¡çš„ç»“æœé›†ï¼Œåˆ—å­—æ®µå¿…é¡»ä¸€ä¸€å¯¹åº”ï¼Œè€Œä¸”å¯¹åº”åˆ—çš„ç±»å‹å¿…é¡»ç›¸åŒã€‚ ","date":"2018-06-17","objectID":"/posts/sql-basics-2-queries/:3:1","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢","uri":"/posts/sql-basics-2-queries/#æ³¨æ„äº‹é¡¹"},{"categories":["tech"],"content":" ç»“æœé›†çš„äº¤å¹¶å·® \u003cæŸ¥è¯¢1\u003e UNION \u003cæŸ¥è¯¢2\u003eï¼šå¯¹ä¸¤ä¸ªç»“æœé›†æ±‚å¹¶ UNION ALLï¼šæ·»åŠ  ALL èƒ½ä½¿ç»“æœé›†åŒ…å«é‡å¤è¡Œã€‚ \u003cæŸ¥è¯¢1\u003e INTERSECT \u003cæŸ¥è¯¢2\u003eï¼šä¸¤ç»“æœé›†çš„äº¤é›† \u003cæŸ¥è¯¢1\u003e EXCEPT \u003cæŸ¥è¯¢2\u003eï¼šä¸¤ç»“æœé›†çš„å·®é›† ","date":"2018-06-17","objectID":"/posts/sql-basics-2-queries/:3:2","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢","uri":"/posts/sql-basics-2-queries/#ç»“æœé›†çš„äº¤å¹¶å·®"},{"categories":["tech"],"content":" ä»¥åˆ—ä¸ºå•ä½ï¼Œå¯¹è¡¨è¿›è¡Œè”ç»“(JOIN) æœ€å¼ºå¤§çš„åŠŸèƒ½ä¹‹ä¸€ äº¤å¹¶å·®æ˜¯ä»¥è¡Œä¸ºå•ä½çš„æ“ä½œï¼Œæ˜¯ç«–å‘çš„è¿ç®—ã€‚è€Œè”ç»“æ˜¯ä»¥åˆ—ä¸ºå•ä½çš„æ“ä½œï¼Œæ˜¯æ¨ªå‘çš„æ‹¼æ¥ã€‚ å†…è”(INNER JOIN) å†…è”ç»“æœåªåŒ…å«ä¸¤è¡¨çš„äº¤é›† è¯­æ³•ï¼š sql SELECT ... FROM (product INNER JOIN shop ON product.p_id = shop.p_id) WHERE filter_condition; ä½¿ç”¨ è·Ÿåœ¨ INNER JOIN å­å¥åçš„ ON å­å¥æŒ‡å®šè”ç»“æ¡ä»¶ã€‚ï¼ˆè¿™é‡Œæˆ‘ç‰¹æ„ç”¨äº†æ‹¬å·ï¼Œè¡¨ç¤º JOIN å’Œ ON ä¸¤ä¸ªå­å¥æ˜¯é…å¥—çš„ï¼‰ ä¹Ÿæœ‰å¦ä¸€ä¸ªå¾ˆå¸¸ç”¨çš„è¯­æ³•ï¼ˆä½†æ˜¯ç°åœ¨å·²ç»ä¸æ¨èä½¿ç”¨ï¼‰ï¼š sql SELECT ... FROM product, shop WHERE product.p_id = shop.p_id AND filter_condition; å¯¹äº shop è¡¨ä¸­æœ‰å¤šè¡Œå¯¹åº”åŒä¸€ä¸ª product çš„æƒ…å†µï¼ˆæœ‰å¤šäººè´­ä¹°äº†åŒä¸€æ¬¾å•†å“ï¼‰ï¼Œç»“æœä¸­è¯¥ product ä¼šè¢«å¤åˆ¶ç»™ shop ä¸­çš„å¤šä¸ªè´­ä¹°è®°å½•ã€‚ï¼ˆä¹Ÿå°±æ˜¯è¯´è¯¥ product ä¼šå˜æˆå¤šè¡Œï¼‰ INNER å¯ä»¥çœç•¥ï¼Œä¹Ÿå°±æ˜¯è¯´åªå†™ JOINï¼Œå°±é»˜è®¤æ˜¯ INNER JOIN å¤–è”(OUTER JOIN) å¤–è”ä»¥æŸè¡¨ä¸ºä¸»è¡¨ï¼Œå°†å¦ä¸€è¡¨çš„åˆ—è”ç»“åˆ°è¯¥è¡¨ã€‚å¦ä¸€è¡¨æ²¡æœ‰å€¼çš„åˆ—ï¼Œå°±ç”¨ NULL ä»£æ›¿ã€‚ä½¿ç”¨LEFT æˆ– RIGHTæŒ‡å®šä¸»è¡¨ã€‚ï¼ˆä¸¤ä¸ªå…³é”®å­—éƒ½èƒ½å®ç°åŒæ ·çš„æ•ˆæœï¼Œä¸è¿‡ç”¨ LEFT çš„å¤šä¸€äº›ï¼‰ è¯­æ³•ï¼š sql SELECT ... FROM product LEFT OUTER JOIN shop ON product.p_id = shop.p_id; è¿™å’Œå†…è”å¾ˆç›¸ä¼¼ï¼Œå·®åˆ«åªæ˜¯è”ç»“å…³é”®è¯æ”¹æˆäº†LEFT OUTER JOINã€‚è¿™è¡¨ç¤ºä»¥å·¦è¾¹çš„è¡¨ä¸ºä¸»è¡¨ï¼ŒæŠŠå³è¾¹çš„è¡¨çš„å†…å®¹è”ç»“ä¸Šå»ã€‚å› æ­¤å·¦è¡¨çš„æ‰€æœ‰åˆ—éƒ½ä¼šå‡ºç°åœ¨ç»“æœé›†ä¸­ã€‚ å¤šè¡¨è”æŸ¥ä¸¾ä¾‹ï¼š sql -- ç™»å½•å¼‚å¸¸çš„è´¦å·åŠå¯†ç  select distinct batches.identity_number as 'ç™»å½•å¤±è´¥è´¦å·', accounts.password from ((batches left outer join tasks on batches.id = tasks.batch_id) -- æ‰¹æ¬¡è¡¨è”ç»“å…·ä½“çš„ä»»åŠ¡è¡¨ left outer join `status` on tasks.id = status.task_id) -- å†è”ç»“ä¸ŠçŠ¶æ€è¡¨ left outer join accounts on batches.identity_number = accounts.identity_number -- å†è”ç»“ä¸Šè´¦å·è¡¨ where `status`.step_type = 'check_login' -- åªæå– \"check_login\" æ­¥éª¤çš„è®°å½• and status.status != 'info' -- çŠ¶æ€ä¸ä¸º infoï¼Œè¯´æ˜ç™»å½•å¼‚å¸¸ æ­¤å¤–è¿˜æœ‰ FULL OUTER JOIN è¡¨ç¤ºè¿”å›å·¦å³ä¸¤è¡¨çš„æ‰€æœ‰è¡Œï¼æ‰€æœ‰æ²¡æœ‰åŒ¹é…çš„è¡Œéƒ½ç»™å‡º NULL P.S. å…¶ä¸­çš„å…³é”®å­— OUTER é€šå¸¸å¯çœç•¥ã€‚ä½†æ˜¯ LEFTã€RIGHTã€FULL ä¸å¯ä»¥çœç•¥ã€‚ ","date":"2018-06-17","objectID":"/posts/sql-basics-2-queries/:3:3","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢","uri":"/posts/sql-basics-2-queries/#ä»¥åˆ—ä¸ºå•ä½å¯¹è¡¨è¿›è¡Œè”ç»“join"},{"categories":["tech"],"content":" ä»¥åˆ—ä¸ºå•ä½ï¼Œå¯¹è¡¨è¿›è¡Œè”ç»“(JOIN) æœ€å¼ºå¤§çš„åŠŸèƒ½ä¹‹ä¸€ äº¤å¹¶å·®æ˜¯ä»¥è¡Œä¸ºå•ä½çš„æ“ä½œï¼Œæ˜¯ç«–å‘çš„è¿ç®—ã€‚è€Œè”ç»“æ˜¯ä»¥åˆ—ä¸ºå•ä½çš„æ“ä½œï¼Œæ˜¯æ¨ªå‘çš„æ‹¼æ¥ã€‚ å†…è”(INNER JOIN) å†…è”ç»“æœåªåŒ…å«ä¸¤è¡¨çš„äº¤é›† è¯­æ³•ï¼š sql SELECT ... FROM (product INNER JOIN shop ON product.p_id = shop.p_id) WHERE filter_condition; ä½¿ç”¨ è·Ÿåœ¨ INNER JOIN å­å¥åçš„ ON å­å¥æŒ‡å®šè”ç»“æ¡ä»¶ã€‚ï¼ˆè¿™é‡Œæˆ‘ç‰¹æ„ç”¨äº†æ‹¬å·ï¼Œè¡¨ç¤º JOIN å’Œ ON ä¸¤ä¸ªå­å¥æ˜¯é…å¥—çš„ï¼‰ ä¹Ÿæœ‰å¦ä¸€ä¸ªå¾ˆå¸¸ç”¨çš„è¯­æ³•ï¼ˆä½†æ˜¯ç°åœ¨å·²ç»ä¸æ¨èä½¿ç”¨ï¼‰ï¼š sql SELECT ... FROM product, shop WHERE product.p_id = shop.p_id AND filter_condition; å¯¹äº shop è¡¨ä¸­æœ‰å¤šè¡Œå¯¹åº”åŒä¸€ä¸ª product çš„æƒ…å†µï¼ˆæœ‰å¤šäººè´­ä¹°äº†åŒä¸€æ¬¾å•†å“ï¼‰ï¼Œç»“æœä¸­è¯¥ product ä¼šè¢«å¤åˆ¶ç»™ shop ä¸­çš„å¤šä¸ªè´­ä¹°è®°å½•ã€‚ï¼ˆä¹Ÿå°±æ˜¯è¯´è¯¥ product ä¼šå˜æˆå¤šè¡Œï¼‰ INNER å¯ä»¥çœç•¥ï¼Œä¹Ÿå°±æ˜¯è¯´åªå†™ JOINï¼Œå°±é»˜è®¤æ˜¯ INNER JOIN å¤–è”(OUTER JOIN) å¤–è”ä»¥æŸè¡¨ä¸ºä¸»è¡¨ï¼Œå°†å¦ä¸€è¡¨çš„åˆ—è”ç»“åˆ°è¯¥è¡¨ã€‚å¦ä¸€è¡¨æ²¡æœ‰å€¼çš„åˆ—ï¼Œå°±ç”¨ NULL ä»£æ›¿ã€‚ä½¿ç”¨LEFT æˆ– RIGHTæŒ‡å®šä¸»è¡¨ã€‚ï¼ˆä¸¤ä¸ªå…³é”®å­—éƒ½èƒ½å®ç°åŒæ ·çš„æ•ˆæœï¼Œä¸è¿‡ç”¨ LEFT çš„å¤šä¸€äº›ï¼‰ è¯­æ³•ï¼š sql SELECT ... FROM product LEFT OUTER JOIN shop ON product.p_id = shop.p_id; è¿™å’Œå†…è”å¾ˆç›¸ä¼¼ï¼Œå·®åˆ«åªæ˜¯è”ç»“å…³é”®è¯æ”¹æˆäº†LEFT OUTER JOINã€‚è¿™è¡¨ç¤ºä»¥å·¦è¾¹çš„è¡¨ä¸ºä¸»è¡¨ï¼ŒæŠŠå³è¾¹çš„è¡¨çš„å†…å®¹è”ç»“ä¸Šå»ã€‚å› æ­¤å·¦è¡¨çš„æ‰€æœ‰åˆ—éƒ½ä¼šå‡ºç°åœ¨ç»“æœé›†ä¸­ã€‚ å¤šè¡¨è”æŸ¥ä¸¾ä¾‹ï¼š sql -- ç™»å½•å¼‚å¸¸çš„è´¦å·åŠå¯†ç  select distinct batches.identity_number as 'ç™»å½•å¤±è´¥è´¦å·', accounts.password from ((batches left outer join tasks on batches.id = tasks.batch_id) -- æ‰¹æ¬¡è¡¨è”ç»“å…·ä½“çš„ä»»åŠ¡è¡¨ left outer join `status` on tasks.id = status.task_id) -- å†è”ç»“ä¸ŠçŠ¶æ€è¡¨ left outer join accounts on batches.identity_number = accounts.identity_number -- å†è”ç»“ä¸Šè´¦å·è¡¨ where `status`.step_type = 'check_login' -- åªæå– \"check_login\" æ­¥éª¤çš„è®°å½• and status.status != 'info' -- çŠ¶æ€ä¸ä¸º infoï¼Œè¯´æ˜ç™»å½•å¼‚å¸¸ æ­¤å¤–è¿˜æœ‰ FULL OUTER JOIN è¡¨ç¤ºè¿”å›å·¦å³ä¸¤è¡¨çš„æ‰€æœ‰è¡Œï¼æ‰€æœ‰æ²¡æœ‰åŒ¹é…çš„è¡Œéƒ½ç»™å‡º NULL P.S. å…¶ä¸­çš„å…³é”®å­— OUTER é€šå¸¸å¯çœç•¥ã€‚ä½†æ˜¯ LEFTã€RIGHTã€FULL ä¸å¯ä»¥çœç•¥ã€‚ ","date":"2018-06-17","objectID":"/posts/sql-basics-2-queries/:3:3","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢","uri":"/posts/sql-basics-2-queries/#å†…è”inner-join"},{"categories":["tech"],"content":" ä»¥åˆ—ä¸ºå•ä½ï¼Œå¯¹è¡¨è¿›è¡Œè”ç»“(JOIN) æœ€å¼ºå¤§çš„åŠŸèƒ½ä¹‹ä¸€ äº¤å¹¶å·®æ˜¯ä»¥è¡Œä¸ºå•ä½çš„æ“ä½œï¼Œæ˜¯ç«–å‘çš„è¿ç®—ã€‚è€Œè”ç»“æ˜¯ä»¥åˆ—ä¸ºå•ä½çš„æ“ä½œï¼Œæ˜¯æ¨ªå‘çš„æ‹¼æ¥ã€‚ å†…è”(INNER JOIN) å†…è”ç»“æœåªåŒ…å«ä¸¤è¡¨çš„äº¤é›† è¯­æ³•ï¼š sql SELECT ... FROM (product INNER JOIN shop ON product.p_id = shop.p_id) WHERE filter_condition; ä½¿ç”¨ è·Ÿåœ¨ INNER JOIN å­å¥åçš„ ON å­å¥æŒ‡å®šè”ç»“æ¡ä»¶ã€‚ï¼ˆè¿™é‡Œæˆ‘ç‰¹æ„ç”¨äº†æ‹¬å·ï¼Œè¡¨ç¤º JOIN å’Œ ON ä¸¤ä¸ªå­å¥æ˜¯é…å¥—çš„ï¼‰ ä¹Ÿæœ‰å¦ä¸€ä¸ªå¾ˆå¸¸ç”¨çš„è¯­æ³•ï¼ˆä½†æ˜¯ç°åœ¨å·²ç»ä¸æ¨èä½¿ç”¨ï¼‰ï¼š sql SELECT ... FROM product, shop WHERE product.p_id = shop.p_id AND filter_condition; å¯¹äº shop è¡¨ä¸­æœ‰å¤šè¡Œå¯¹åº”åŒä¸€ä¸ª product çš„æƒ…å†µï¼ˆæœ‰å¤šäººè´­ä¹°äº†åŒä¸€æ¬¾å•†å“ï¼‰ï¼Œç»“æœä¸­è¯¥ product ä¼šè¢«å¤åˆ¶ç»™ shop ä¸­çš„å¤šä¸ªè´­ä¹°è®°å½•ã€‚ï¼ˆä¹Ÿå°±æ˜¯è¯´è¯¥ product ä¼šå˜æˆå¤šè¡Œï¼‰ INNER å¯ä»¥çœç•¥ï¼Œä¹Ÿå°±æ˜¯è¯´åªå†™ JOINï¼Œå°±é»˜è®¤æ˜¯ INNER JOIN å¤–è”(OUTER JOIN) å¤–è”ä»¥æŸè¡¨ä¸ºä¸»è¡¨ï¼Œå°†å¦ä¸€è¡¨çš„åˆ—è”ç»“åˆ°è¯¥è¡¨ã€‚å¦ä¸€è¡¨æ²¡æœ‰å€¼çš„åˆ—ï¼Œå°±ç”¨ NULL ä»£æ›¿ã€‚ä½¿ç”¨LEFT æˆ– RIGHTæŒ‡å®šä¸»è¡¨ã€‚ï¼ˆä¸¤ä¸ªå…³é”®å­—éƒ½èƒ½å®ç°åŒæ ·çš„æ•ˆæœï¼Œä¸è¿‡ç”¨ LEFT çš„å¤šä¸€äº›ï¼‰ è¯­æ³•ï¼š sql SELECT ... FROM product LEFT OUTER JOIN shop ON product.p_id = shop.p_id; è¿™å’Œå†…è”å¾ˆç›¸ä¼¼ï¼Œå·®åˆ«åªæ˜¯è”ç»“å…³é”®è¯æ”¹æˆäº†LEFT OUTER JOINã€‚è¿™è¡¨ç¤ºä»¥å·¦è¾¹çš„è¡¨ä¸ºä¸»è¡¨ï¼ŒæŠŠå³è¾¹çš„è¡¨çš„å†…å®¹è”ç»“ä¸Šå»ã€‚å› æ­¤å·¦è¡¨çš„æ‰€æœ‰åˆ—éƒ½ä¼šå‡ºç°åœ¨ç»“æœé›†ä¸­ã€‚ å¤šè¡¨è”æŸ¥ä¸¾ä¾‹ï¼š sql -- ç™»å½•å¼‚å¸¸çš„è´¦å·åŠå¯†ç  select distinct batches.identity_number as 'ç™»å½•å¤±è´¥è´¦å·', accounts.password from ((batches left outer join tasks on batches.id = tasks.batch_id) -- æ‰¹æ¬¡è¡¨è”ç»“å…·ä½“çš„ä»»åŠ¡è¡¨ left outer join `status` on tasks.id = status.task_id) -- å†è”ç»“ä¸ŠçŠ¶æ€è¡¨ left outer join accounts on batches.identity_number = accounts.identity_number -- å†è”ç»“ä¸Šè´¦å·è¡¨ where `status`.step_type = 'check_login' -- åªæå– \"check_login\" æ­¥éª¤çš„è®°å½• and status.status != 'info' -- çŠ¶æ€ä¸ä¸º infoï¼Œè¯´æ˜ç™»å½•å¼‚å¸¸ æ­¤å¤–è¿˜æœ‰ FULL OUTER JOIN è¡¨ç¤ºè¿”å›å·¦å³ä¸¤è¡¨çš„æ‰€æœ‰è¡Œï¼æ‰€æœ‰æ²¡æœ‰åŒ¹é…çš„è¡Œéƒ½ç»™å‡º NULL P.S. å…¶ä¸­çš„å…³é”®å­— OUTER é€šå¸¸å¯çœç•¥ã€‚ä½†æ˜¯ LEFTã€RIGHTã€FULL ä¸å¯ä»¥çœç•¥ã€‚ ","date":"2018-06-17","objectID":"/posts/sql-basics-2-queries/:3:3","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢","uri":"/posts/sql-basics-2-queries/#å¤–è”outer-join"},{"categories":["tech"],"content":" ç”»å¤–ï¼šå­—æ®µå¼•ç”¨ç¬¦å·å¦‚æœæ•°æ®åº“çš„å­—æ®µå/æ•°æ®åº“å/è¡¨åå¯èƒ½å’Œæ•°æ®åº“å…³é”®å­—é‡å¤ï¼Œå°±éœ€è¦ç”¨å¼•ç”¨ç¬¦å·å°†ä»–ä»¬å¼•ç”¨èµ·æ¥ï¼Œæ¶ˆé™¤æ­§ä¹‰ã€‚ MySQL ä¸­ç»å¸¸ç”¨åå¼•å·å¹²è¿™ä¸ªäº‹ã€‚è€Œ SQL Server åˆ™ä½¿ç”¨æ–¹æ‹¬å·ã€‚æ ‡å‡† SQL ä½¿ç”¨åŒå¼•å·ã€‚åœ¨çœ‹åˆ°è¿™äº›ç¬¦å·æ—¶è¦çŸ¥é“è¿™äº›å·®åˆ«ã€‚ ","date":"2018-06-17","objectID":"/posts/sql-basics-2-queries/:4:0","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢","uri":"/posts/sql-basics-2-queries/#ç”»å¤–å­—æ®µå¼•ç”¨ç¬¦å·"},{"categories":["tech"],"content":" æŸ¥è¯¢è¯­å¥åˆ†æ MySQL Explainè¯¦è§£ ","date":"2018-06-17","objectID":"/posts/sql-basics-2-queries/:5:0","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢","uri":"/posts/sql-basics-2-queries/#æŸ¥è¯¢è¯­å¥åˆ†æ"},{"categories":["tech"],"content":" å¸¸è§é—®é¢˜","date":"2018-06-17","objectID":"/posts/sql-basics-2-queries/:6:0","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢","uri":"/posts/sql-basics-2-queries/#å¸¸è§é—®é¢˜"},{"categories":["tech"],"content":" éšå¼ç±»å‹è½¬æ¢åœ¨MySQLä¸­ï¼Œå½“æ“ä½œç¬¦ä¸ä¸åŒç±»å‹çš„æ“ä½œæ•°ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œä¼šå‘ç”Ÿç±»å‹è½¬æ¢ä»¥ä½¿æ“ä½œæ•°å…¼å®¹ã€‚åˆ™ä¼šå‘ç”Ÿéšå¼ç±»å‹è½¬æ¢ã€‚ éšå¼ç±»å‹è½¬æ¢ä¼šå¯¼è‡´æŸ¥è¯¢ä¸ä¼šèµ°ç´¢å¼•ï¼ï¼ï¼å¯èƒ½ä¼šä¸¥é‡æ‹–ç´¯æ€§èƒ½ã€‚å¦å¤–è¿˜å¯èƒ½ä¼šå¯¼è‡´å„ç§å¥‡æ€ªçš„é—®é¢˜ã€‚ è¯¦è§ MYSQLéšå¼ç±»å‹è½¬æ¢ å®Œã€‚ï¼ˆæ¥ä¸‹æ¥å°±æ˜¯ç”¨ Python/Java è¿æ¥ MySQL äº†ï¼‰ ","date":"2018-06-17","objectID":"/posts/sql-basics-2-queries/:6:1","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆäºŒï¼‰è¿›é˜¶æŸ¥è¯¢","uri":"/posts/sql-basics-2-queries/#éšå¼ç±»å‹è½¬æ¢"},{"categories":["tech"],"content":" æœ¬ç¬”è®°æ•´ç†è‡ªã€ŠSQL åŸºç¡€æ•™ç¨‹ã€‹ã€ã€ŠMySQL å¿…çŸ¥å¿…ä¼šã€‹å’Œç½‘ä¸Šèµ„æ–™ã€‚ä¸ªäººç¬”è®°ä¸ä¿è¯æ­£ç¡®ã€‚ ","date":"2018-06-15","objectID":"/posts/sql-basics-1/:0:0","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸€ï¼‰","uri":"/posts/sql-basics-1/#"},{"categories":["tech"],"content":" ä¸€ã€åŸºç¡€SQLï¼Œå³ç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€ï¼Œæ˜¯ä¸ºè®¿é—®ä¸æ“ä½œå…³ç³»æ•°æ®åº“ä¸­çš„æ•°æ®è€Œè®¾è®¡çš„è¯­è¨€ã€‚ å…³ç³»æ•°æ®åº“ä»¥è¡Œ(row)ä¸ºå•ä½è¯»å†™æ•°æ® SQL æ ¹æ®åŠŸèƒ½çš„ä¸åŒï¼Œå¯åˆ†ä¸ºä¸‰ç±»ï¼ˆå…¶ä¸­DMLç”¨å¾—æœ€å¤šï¼Œå¢åˆ æŸ¥æ”¹å˜›ï¼‰ DDL(Data Definition Language, æ•°æ®å®šä¹‰è¯­è¨€): CREATE/DROP/ALTER DML(Data Manipulation Language, æ•°æ®æ“ä½œè¯­è¨€): SELECT/INSERT/UPDATE/DELETE DCL(Data Control Language, æ•°æ®æ§åˆ¶è¯­è¨€): COMMIT/ROLLBACK/GRANT/REVOKE SQL è¯­å¥è¦ä»¥åˆ†å·ç»“å°¾ã€‚æ¢è¡Œåœ¨ SQL ä¸­ä¸è¡¨ç¤ºç»“æŸï¼Œè€Œç­‰åŒäºç©ºæ ¼ã€‚ SQL ä¸åŒºåˆ†**å…³é”®å­—(Keyword)**çš„å¤§å°å†™ï¼Œä½†æ˜¯æè¿°ç¬¦å°±ä¸ä¸€å®šäº†ã€‚ è¿™é‡Œæœ‰ä¸ªå‘ï¼šMySQL ä¸­ï¼Œæ•°æ®åº“å’Œè¡¨å…¶å®å°±æ˜¯æ•°æ®ç›®å½•ä¸‹çš„ç›®å½•å’Œæ–‡ä»¶ï¼Œå› è€Œï¼Œæ“ä½œç³»ç»Ÿçš„æ•æ„Ÿæ€§å†³å®šæ•°æ®åº“åå’Œè¡¨å æ˜¯å¦å¤§å°å†™æ•æ„Ÿã€‚è¿™å°±æ„å‘³ç€æ•°æ®åº“åå’Œè¡¨ååœ¨ Windows ä¸­æ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„ï¼Œè€Œåœ¨å¤§å¤šæ•°ç±»å‹çš„ Unix/Linux ç³»ç»Ÿä¸­æ˜¯å¤§å°å†™æ•æ„Ÿçš„ã€‚ï¼ˆæ³¨æ„ä»…æŒ‡æ•°æ®åº“åå’Œè¡¨åï¼‰å¯é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶çš„lower_case_table_nameså±æ€§æ¥ç»Ÿä¸€è¿™ä¸€è¡Œä¸ºã€‚ è€Œå­—æ®µåã€å­—æ®µå†…å®¹éƒ½æ˜¯å†…éƒ¨æ•°æ®ï¼Œæ˜¯æ“ä½œç³»ç»Ÿæ— å…³çš„ã€‚å®ƒä»¬çš„å¤§å°å†™æ•æ„Ÿæ€§ï¼Œç”± MySQL çš„çš„æ ¡å¯¹ï¼ˆCOLLATEï¼‰è§„åˆ™æ¥æ§åˆ¶ã€‚è¯¥è§„åˆ™ä½“ç°åœ¨ MySQL çš„ æ ¡å¯¹å­—ç¬¦é›†ï¼ˆCOLLATIONï¼‰çš„åç¼€ä¸Šï¼šæ¯”å¦‚ utf8å­—ç¬¦é›†ï¼Œutf8_general_ciè¡¨ç¤ºä¸åŒºåˆ†å¤§å°å†™ï¼Œè¿™ä¸ªæ˜¯ utf8 å­—ç¬¦é›†é»˜è®¤çš„æ ¡å¯¹è§„åˆ™ï¼›utf8_general_cs è¡¨ç¤ºåŒºåˆ†å¤§å°å†™ï¼Œutf8_bin è¡¨ç¤ºäºŒè¿›åˆ¶æ¯”è¾ƒï¼ŒåŒæ ·ä¹ŸåŒºåˆ†å¤§å°å†™ ã€‚ SQL ä¸­çš„å­—ç¬¦ä¸²å’Œæ—¥æœŸéœ€è¦ç”¨å•å¼•å·å¼•ç”¨èµ·æ¥ï¼Œæ—¥æœŸæœ‰ç‰¹å®šæ ¼å¼å¹´-æœˆ-æ—¥ ä¿®æ”¹å­—ç¬¦é›†ï¼šset names \u003cå­—ç¬¦é›†å\u003e è®°ä½åœ¨ MySQL ä¸­ï¼Œutf-8mb4 æ‰æ˜¯å®Œå…¨çš„ utf-8å­—ç¬¦é›†ã€‚ ","date":"2018-06-15","objectID":"/posts/sql-basics-1/:1:0","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸€ï¼‰","uri":"/posts/sql-basics-1/#ä¸€åŸºç¡€"},{"categories":["tech"],"content":" äºŒã€DDL","date":"2018-06-15","objectID":"/posts/sql-basics-1/:2:0","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸€ï¼‰","uri":"/posts/sql-basics-1/#äºŒddl"},{"categories":["tech"],"content":" 1. æ•°æ®åº“çš„åˆ›å»ºå’Œåˆ é™¤ åˆ›å»ºæ•°æ®åº“ sql CREATE DATABASE \u003cæ•°æ®åº“åç§°\u003e; sql DROP DATABASE \u003cæ•°æ®åº“åç§°\u003e; ","date":"2018-06-15","objectID":"/posts/sql-basics-1/:2:1","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸€ï¼‰","uri":"/posts/sql-basics-1/#1-æ•°æ®åº“çš„åˆ›å»ºå’Œåˆ é™¤"},{"categories":["tech"],"content":" 2. åˆ›å»ºè¡¨ï¼š å…³ç³»è¡¨çš„è®¾è®¡å…³ç³»è¡¨çš„è®¾è®¡ï¼Œè¦ç¡®ä¿æŠŠä¿¡æ¯åˆ†è§£æˆå¤šä¸ªè¡¨ï¼Œä¸€ç±»ä¿¡æ¯ä¸€ä¸ªè¡¨ï¼Œå„è¡¨é€šè¿‡æŸäº›å¸¸ç”¨çš„ï¼ŒåŸºæœ¬ä¸ä¼šæ”¹å˜çš„å€¼ï¼ˆå³å…³ç³»è¡¨è®¾è®¡ä¸­çš„å…³ç³»ï¼Œä¹Ÿå¸¸ç§°ä¸ºå¤–é”®ï¼‰äº’ç›¸å…³è”ã€‚å°½é‡ä¸è¦æœ‰å†—ä½™æ•°æ®ã€‚ è¯­å¥ï¼š sql CREATE TABLE \u003cè¡¨å\u003e ( \u003cåˆ—å1\u003e \u003cæ•°æ®ç±»å‹\u003e \u003cè¯¥åˆ—æ‰€éœ€çº¦æŸ\u003e, \u003cåˆ—å2\u003e \u003cæ•°æ®ç±»å‹\u003e \u003cè¯¥åˆ—æ‰€éœ€çº¦æŸ\u003e, \u003cåˆ—å3\u003e \u003cæ•°æ®ç±»å‹\u003e \u003cè¯¥åˆ—æ‰€éœ€çº¦æŸ\u003e, ... \u003cè¯¥è¡¨çš„çº¦æŸ1\u003e, \u003cè¯¥è¡¨çš„çº¦æŸ2\u003e... ); ä¸¾ä¾‹ï¼š sql CREATE TABLE `persons` ( `id` INT UNSIGNED NOT NULL AUTO_INCREMENT, `name` CHAR(20) NOT NULL, PRIMARY KEY (`id`) )ENGINE=InnoDB DEFAULT CHARSET=utf8mb4; åé¢çš„æ˜¯è®¾ç½®å¼•æ“å’Œé»˜è®¤å­—ç¬¦é›†ã€‚å·¥ä½œä¸Šï¼Œè¡¨çš„è®¾è®¡ä¸€å®šè¦æ·±æ€ç†Ÿè™‘ï¼Œå› ä¸ºæ”¹èµ·æ¥å¾ˆå›°éš¾ã€‚ å­—æ®µç±»å‹ï¼ˆMySQLï¼‰æœ‰å››ç±»æ•°æ®ç±»å‹ï¼šå­—ç¬¦ä¸²ã€æ•°å­—ã€æ—¥æœŸã€äºŒè¿›åˆ¶ã€‚å®ƒä»¬åˆæ ¹æ®æ•°æ®é•¿åº¦çš„åŒºåˆ«ï¼Œä¸‹åˆ†ä¸ºå¤šä¸ªç±»å‹ã€‚ å­—ç¬¦ä¸²ï¼š æ•°å­— æ—¥æœŸ äºŒè¿›åˆ¶ çº¦æŸSQL çº¦æŸæ˜¯é™¤äº†æ•°æ®ç±»å‹ä¹‹å¤–ï¼Œå¯¹åˆ—ä¸­æ•°æ®è¿½åŠ çš„é™å®šæ¡ä»¶ã€‚ ç±»å‹çº¦æŸï¼šNOT NULLã€AUTO_INCREMENTã€UNSIGNEDï¼ˆè¿™ä¸ªåª MySQL æ”¯æŒï¼‰ é»˜è®¤å€¼ï¼šDEFAULTï¼Œä¸¾ä¾‹ \u003cåˆ—å3\u003e VARCHAR(32) NOT NULL DEFAULT \"los angeles\" è¡¨çº¦æŸï¼šPRIMARY KEY ä¸»é”®çº¦æŸï¼ˆä¸»é”®é»˜è®¤ UNIQUE ä¸” NOT NULLï¼‰ æ­¤å¤–è¿˜æœ‰ FOREIGN KEY å’Œ CHECK ä¸¤ä¸ªçº¦æŸè¯­å¥ï¼Œ åœ¨è¿›é˜¶ç¬”è®°ä¸­ä»‹ç»ã€‚ P.S. å­—æ®µçº¦æŸä¹Ÿå¯ä»¥å†™æˆè¡¨çº¦æŸï¼ˆæ¯”å¦‚ä¸»é”®çº¦æŸï¼‰ï¼Œè€Œåè¿‡æ¥å¾ˆå¯èƒ½ä¸è¡Œã€‚ ","date":"2018-06-15","objectID":"/posts/sql-basics-1/:2:2","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸€ï¼‰","uri":"/posts/sql-basics-1/#2-åˆ›å»ºè¡¨"},{"categories":["tech"],"content":" 2. åˆ›å»ºè¡¨ï¼š å…³ç³»è¡¨çš„è®¾è®¡å…³ç³»è¡¨çš„è®¾è®¡ï¼Œè¦ç¡®ä¿æŠŠä¿¡æ¯åˆ†è§£æˆå¤šä¸ªè¡¨ï¼Œä¸€ç±»ä¿¡æ¯ä¸€ä¸ªè¡¨ï¼Œå„è¡¨é€šè¿‡æŸäº›å¸¸ç”¨çš„ï¼ŒåŸºæœ¬ä¸ä¼šæ”¹å˜çš„å€¼ï¼ˆå³å…³ç³»è¡¨è®¾è®¡ä¸­çš„å…³ç³»ï¼Œä¹Ÿå¸¸ç§°ä¸ºå¤–é”®ï¼‰äº’ç›¸å…³è”ã€‚å°½é‡ä¸è¦æœ‰å†—ä½™æ•°æ®ã€‚ è¯­å¥ï¼š sql CREATE TABLE \u003cè¡¨å\u003e ( \u003cåˆ—å1\u003e \u003cæ•°æ®ç±»å‹\u003e \u003cè¯¥åˆ—æ‰€éœ€çº¦æŸ\u003e, \u003cåˆ—å2\u003e \u003cæ•°æ®ç±»å‹\u003e \u003cè¯¥åˆ—æ‰€éœ€çº¦æŸ\u003e, \u003cåˆ—å3\u003e \u003cæ•°æ®ç±»å‹\u003e \u003cè¯¥åˆ—æ‰€éœ€çº¦æŸ\u003e, ... \u003cè¯¥è¡¨çš„çº¦æŸ1\u003e, \u003cè¯¥è¡¨çš„çº¦æŸ2\u003e... ); ä¸¾ä¾‹ï¼š sql CREATE TABLE `persons` ( `id` INT UNSIGNED NOT NULL AUTO_INCREMENT, `name` CHAR(20) NOT NULL, PRIMARY KEY (`id`) )ENGINE=InnoDB DEFAULT CHARSET=utf8mb4; åé¢çš„æ˜¯è®¾ç½®å¼•æ“å’Œé»˜è®¤å­—ç¬¦é›†ã€‚å·¥ä½œä¸Šï¼Œè¡¨çš„è®¾è®¡ä¸€å®šè¦æ·±æ€ç†Ÿè™‘ï¼Œå› ä¸ºæ”¹èµ·æ¥å¾ˆå›°éš¾ã€‚ å­—æ®µç±»å‹ï¼ˆMySQLï¼‰æœ‰å››ç±»æ•°æ®ç±»å‹ï¼šå­—ç¬¦ä¸²ã€æ•°å­—ã€æ—¥æœŸã€äºŒè¿›åˆ¶ã€‚å®ƒä»¬åˆæ ¹æ®æ•°æ®é•¿åº¦çš„åŒºåˆ«ï¼Œä¸‹åˆ†ä¸ºå¤šä¸ªç±»å‹ã€‚ å­—ç¬¦ä¸²ï¼š æ•°å­— æ—¥æœŸ äºŒè¿›åˆ¶ çº¦æŸSQL çº¦æŸæ˜¯é™¤äº†æ•°æ®ç±»å‹ä¹‹å¤–ï¼Œå¯¹åˆ—ä¸­æ•°æ®è¿½åŠ çš„é™å®šæ¡ä»¶ã€‚ ç±»å‹çº¦æŸï¼šNOT NULLã€AUTO_INCREMENTã€UNSIGNEDï¼ˆè¿™ä¸ªåª MySQL æ”¯æŒï¼‰ é»˜è®¤å€¼ï¼šDEFAULTï¼Œä¸¾ä¾‹ \u003cåˆ—å3\u003e VARCHAR(32) NOT NULL DEFAULT \"los angeles\" è¡¨çº¦æŸï¼šPRIMARY KEY ä¸»é”®çº¦æŸï¼ˆä¸»é”®é»˜è®¤ UNIQUE ä¸” NOT NULLï¼‰ æ­¤å¤–è¿˜æœ‰ FOREIGN KEY å’Œ CHECK ä¸¤ä¸ªçº¦æŸè¯­å¥ï¼Œ åœ¨è¿›é˜¶ç¬”è®°ä¸­ä»‹ç»ã€‚ P.S. å­—æ®µçº¦æŸä¹Ÿå¯ä»¥å†™æˆè¡¨çº¦æŸï¼ˆæ¯”å¦‚ä¸»é”®çº¦æŸï¼‰ï¼Œè€Œåè¿‡æ¥å¾ˆå¯èƒ½ä¸è¡Œã€‚ ","date":"2018-06-15","objectID":"/posts/sql-basics-1/:2:2","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸€ï¼‰","uri":"/posts/sql-basics-1/#å…³ç³»è¡¨çš„è®¾è®¡"},{"categories":["tech"],"content":" 2. åˆ›å»ºè¡¨ï¼š å…³ç³»è¡¨çš„è®¾è®¡å…³ç³»è¡¨çš„è®¾è®¡ï¼Œè¦ç¡®ä¿æŠŠä¿¡æ¯åˆ†è§£æˆå¤šä¸ªè¡¨ï¼Œä¸€ç±»ä¿¡æ¯ä¸€ä¸ªè¡¨ï¼Œå„è¡¨é€šè¿‡æŸäº›å¸¸ç”¨çš„ï¼ŒåŸºæœ¬ä¸ä¼šæ”¹å˜çš„å€¼ï¼ˆå³å…³ç³»è¡¨è®¾è®¡ä¸­çš„å…³ç³»ï¼Œä¹Ÿå¸¸ç§°ä¸ºå¤–é”®ï¼‰äº’ç›¸å…³è”ã€‚å°½é‡ä¸è¦æœ‰å†—ä½™æ•°æ®ã€‚ è¯­å¥ï¼š sql CREATE TABLE \u003cè¡¨å\u003e ( \u003cåˆ—å1\u003e \u003cæ•°æ®ç±»å‹\u003e \u003cè¯¥åˆ—æ‰€éœ€çº¦æŸ\u003e, \u003cåˆ—å2\u003e \u003cæ•°æ®ç±»å‹\u003e \u003cè¯¥åˆ—æ‰€éœ€çº¦æŸ\u003e, \u003cåˆ—å3\u003e \u003cæ•°æ®ç±»å‹\u003e \u003cè¯¥åˆ—æ‰€éœ€çº¦æŸ\u003e, ... \u003cè¯¥è¡¨çš„çº¦æŸ1\u003e, \u003cè¯¥è¡¨çš„çº¦æŸ2\u003e... ); ä¸¾ä¾‹ï¼š sql CREATE TABLE `persons` ( `id` INT UNSIGNED NOT NULL AUTO_INCREMENT, `name` CHAR(20) NOT NULL, PRIMARY KEY (`id`) )ENGINE=InnoDB DEFAULT CHARSET=utf8mb4; åé¢çš„æ˜¯è®¾ç½®å¼•æ“å’Œé»˜è®¤å­—ç¬¦é›†ã€‚å·¥ä½œä¸Šï¼Œè¡¨çš„è®¾è®¡ä¸€å®šè¦æ·±æ€ç†Ÿè™‘ï¼Œå› ä¸ºæ”¹èµ·æ¥å¾ˆå›°éš¾ã€‚ å­—æ®µç±»å‹ï¼ˆMySQLï¼‰æœ‰å››ç±»æ•°æ®ç±»å‹ï¼šå­—ç¬¦ä¸²ã€æ•°å­—ã€æ—¥æœŸã€äºŒè¿›åˆ¶ã€‚å®ƒä»¬åˆæ ¹æ®æ•°æ®é•¿åº¦çš„åŒºåˆ«ï¼Œä¸‹åˆ†ä¸ºå¤šä¸ªç±»å‹ã€‚ å­—ç¬¦ä¸²ï¼š æ•°å­— æ—¥æœŸ äºŒè¿›åˆ¶ çº¦æŸSQL çº¦æŸæ˜¯é™¤äº†æ•°æ®ç±»å‹ä¹‹å¤–ï¼Œå¯¹åˆ—ä¸­æ•°æ®è¿½åŠ çš„é™å®šæ¡ä»¶ã€‚ ç±»å‹çº¦æŸï¼šNOT NULLã€AUTO_INCREMENTã€UNSIGNEDï¼ˆè¿™ä¸ªåª MySQL æ”¯æŒï¼‰ é»˜è®¤å€¼ï¼šDEFAULTï¼Œä¸¾ä¾‹ \u003cåˆ—å3\u003e VARCHAR(32) NOT NULL DEFAULT \"los angeles\" è¡¨çº¦æŸï¼šPRIMARY KEY ä¸»é”®çº¦æŸï¼ˆä¸»é”®é»˜è®¤ UNIQUE ä¸” NOT NULLï¼‰ æ­¤å¤–è¿˜æœ‰ FOREIGN KEY å’Œ CHECK ä¸¤ä¸ªçº¦æŸè¯­å¥ï¼Œ åœ¨è¿›é˜¶ç¬”è®°ä¸­ä»‹ç»ã€‚ P.S. å­—æ®µçº¦æŸä¹Ÿå¯ä»¥å†™æˆè¡¨çº¦æŸï¼ˆæ¯”å¦‚ä¸»é”®çº¦æŸï¼‰ï¼Œè€Œåè¿‡æ¥å¾ˆå¯èƒ½ä¸è¡Œã€‚ ","date":"2018-06-15","objectID":"/posts/sql-basics-1/:2:2","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸€ï¼‰","uri":"/posts/sql-basics-1/#è¯­å¥"},{"categories":["tech"],"content":" 2. åˆ›å»ºè¡¨ï¼š å…³ç³»è¡¨çš„è®¾è®¡å…³ç³»è¡¨çš„è®¾è®¡ï¼Œè¦ç¡®ä¿æŠŠä¿¡æ¯åˆ†è§£æˆå¤šä¸ªè¡¨ï¼Œä¸€ç±»ä¿¡æ¯ä¸€ä¸ªè¡¨ï¼Œå„è¡¨é€šè¿‡æŸäº›å¸¸ç”¨çš„ï¼ŒåŸºæœ¬ä¸ä¼šæ”¹å˜çš„å€¼ï¼ˆå³å…³ç³»è¡¨è®¾è®¡ä¸­çš„å…³ç³»ï¼Œä¹Ÿå¸¸ç§°ä¸ºå¤–é”®ï¼‰äº’ç›¸å…³è”ã€‚å°½é‡ä¸è¦æœ‰å†—ä½™æ•°æ®ã€‚ è¯­å¥ï¼š sql CREATE TABLE \u003cè¡¨å\u003e ( \u003cåˆ—å1\u003e \u003cæ•°æ®ç±»å‹\u003e \u003cè¯¥åˆ—æ‰€éœ€çº¦æŸ\u003e, \u003cåˆ—å2\u003e \u003cæ•°æ®ç±»å‹\u003e \u003cè¯¥åˆ—æ‰€éœ€çº¦æŸ\u003e, \u003cåˆ—å3\u003e \u003cæ•°æ®ç±»å‹\u003e \u003cè¯¥åˆ—æ‰€éœ€çº¦æŸ\u003e, ... \u003cè¯¥è¡¨çš„çº¦æŸ1\u003e, \u003cè¯¥è¡¨çš„çº¦æŸ2\u003e... ); ä¸¾ä¾‹ï¼š sql CREATE TABLE `persons` ( `id` INT UNSIGNED NOT NULL AUTO_INCREMENT, `name` CHAR(20) NOT NULL, PRIMARY KEY (`id`) )ENGINE=InnoDB DEFAULT CHARSET=utf8mb4; åé¢çš„æ˜¯è®¾ç½®å¼•æ“å’Œé»˜è®¤å­—ç¬¦é›†ã€‚å·¥ä½œä¸Šï¼Œè¡¨çš„è®¾è®¡ä¸€å®šè¦æ·±æ€ç†Ÿè™‘ï¼Œå› ä¸ºæ”¹èµ·æ¥å¾ˆå›°éš¾ã€‚ å­—æ®µç±»å‹ï¼ˆMySQLï¼‰æœ‰å››ç±»æ•°æ®ç±»å‹ï¼šå­—ç¬¦ä¸²ã€æ•°å­—ã€æ—¥æœŸã€äºŒè¿›åˆ¶ã€‚å®ƒä»¬åˆæ ¹æ®æ•°æ®é•¿åº¦çš„åŒºåˆ«ï¼Œä¸‹åˆ†ä¸ºå¤šä¸ªç±»å‹ã€‚ å­—ç¬¦ä¸²ï¼š æ•°å­— æ—¥æœŸ äºŒè¿›åˆ¶ çº¦æŸSQL çº¦æŸæ˜¯é™¤äº†æ•°æ®ç±»å‹ä¹‹å¤–ï¼Œå¯¹åˆ—ä¸­æ•°æ®è¿½åŠ çš„é™å®šæ¡ä»¶ã€‚ ç±»å‹çº¦æŸï¼šNOT NULLã€AUTO_INCREMENTã€UNSIGNEDï¼ˆè¿™ä¸ªåª MySQL æ”¯æŒï¼‰ é»˜è®¤å€¼ï¼šDEFAULTï¼Œä¸¾ä¾‹ \u003cåˆ—å3\u003e VARCHAR(32) NOT NULL DEFAULT \"los angeles\" è¡¨çº¦æŸï¼šPRIMARY KEY ä¸»é”®çº¦æŸï¼ˆä¸»é”®é»˜è®¤ UNIQUE ä¸” NOT NULLï¼‰ æ­¤å¤–è¿˜æœ‰ FOREIGN KEY å’Œ CHECK ä¸¤ä¸ªçº¦æŸè¯­å¥ï¼Œ åœ¨è¿›é˜¶ç¬”è®°ä¸­ä»‹ç»ã€‚ P.S. å­—æ®µçº¦æŸä¹Ÿå¯ä»¥å†™æˆè¡¨çº¦æŸï¼ˆæ¯”å¦‚ä¸»é”®çº¦æŸï¼‰ï¼Œè€Œåè¿‡æ¥å¾ˆå¯èƒ½ä¸è¡Œã€‚ ","date":"2018-06-15","objectID":"/posts/sql-basics-1/:2:2","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸€ï¼‰","uri":"/posts/sql-basics-1/#å­—æ®µç±»å‹mysql"},{"categories":["tech"],"content":" 2. åˆ›å»ºè¡¨ï¼š å…³ç³»è¡¨çš„è®¾è®¡å…³ç³»è¡¨çš„è®¾è®¡ï¼Œè¦ç¡®ä¿æŠŠä¿¡æ¯åˆ†è§£æˆå¤šä¸ªè¡¨ï¼Œä¸€ç±»ä¿¡æ¯ä¸€ä¸ªè¡¨ï¼Œå„è¡¨é€šè¿‡æŸäº›å¸¸ç”¨çš„ï¼ŒåŸºæœ¬ä¸ä¼šæ”¹å˜çš„å€¼ï¼ˆå³å…³ç³»è¡¨è®¾è®¡ä¸­çš„å…³ç³»ï¼Œä¹Ÿå¸¸ç§°ä¸ºå¤–é”®ï¼‰äº’ç›¸å…³è”ã€‚å°½é‡ä¸è¦æœ‰å†—ä½™æ•°æ®ã€‚ è¯­å¥ï¼š sql CREATE TABLE \u003cè¡¨å\u003e ( \u003cåˆ—å1\u003e \u003cæ•°æ®ç±»å‹\u003e \u003cè¯¥åˆ—æ‰€éœ€çº¦æŸ\u003e, \u003cåˆ—å2\u003e \u003cæ•°æ®ç±»å‹\u003e \u003cè¯¥åˆ—æ‰€éœ€çº¦æŸ\u003e, \u003cåˆ—å3\u003e \u003cæ•°æ®ç±»å‹\u003e \u003cè¯¥åˆ—æ‰€éœ€çº¦æŸ\u003e, ... \u003cè¯¥è¡¨çš„çº¦æŸ1\u003e, \u003cè¯¥è¡¨çš„çº¦æŸ2\u003e... ); ä¸¾ä¾‹ï¼š sql CREATE TABLE `persons` ( `id` INT UNSIGNED NOT NULL AUTO_INCREMENT, `name` CHAR(20) NOT NULL, PRIMARY KEY (`id`) )ENGINE=InnoDB DEFAULT CHARSET=utf8mb4; åé¢çš„æ˜¯è®¾ç½®å¼•æ“å’Œé»˜è®¤å­—ç¬¦é›†ã€‚å·¥ä½œä¸Šï¼Œè¡¨çš„è®¾è®¡ä¸€å®šè¦æ·±æ€ç†Ÿè™‘ï¼Œå› ä¸ºæ”¹èµ·æ¥å¾ˆå›°éš¾ã€‚ å­—æ®µç±»å‹ï¼ˆMySQLï¼‰æœ‰å››ç±»æ•°æ®ç±»å‹ï¼šå­—ç¬¦ä¸²ã€æ•°å­—ã€æ—¥æœŸã€äºŒè¿›åˆ¶ã€‚å®ƒä»¬åˆæ ¹æ®æ•°æ®é•¿åº¦çš„åŒºåˆ«ï¼Œä¸‹åˆ†ä¸ºå¤šä¸ªç±»å‹ã€‚ å­—ç¬¦ä¸²ï¼š æ•°å­— æ—¥æœŸ äºŒè¿›åˆ¶ çº¦æŸSQL çº¦æŸæ˜¯é™¤äº†æ•°æ®ç±»å‹ä¹‹å¤–ï¼Œå¯¹åˆ—ä¸­æ•°æ®è¿½åŠ çš„é™å®šæ¡ä»¶ã€‚ ç±»å‹çº¦æŸï¼šNOT NULLã€AUTO_INCREMENTã€UNSIGNEDï¼ˆè¿™ä¸ªåª MySQL æ”¯æŒï¼‰ é»˜è®¤å€¼ï¼šDEFAULTï¼Œä¸¾ä¾‹ \u003cåˆ—å3\u003e VARCHAR(32) NOT NULL DEFAULT \"los angeles\" è¡¨çº¦æŸï¼šPRIMARY KEY ä¸»é”®çº¦æŸï¼ˆä¸»é”®é»˜è®¤ UNIQUE ä¸” NOT NULLï¼‰ æ­¤å¤–è¿˜æœ‰ FOREIGN KEY å’Œ CHECK ä¸¤ä¸ªçº¦æŸè¯­å¥ï¼Œ åœ¨è¿›é˜¶ç¬”è®°ä¸­ä»‹ç»ã€‚ P.S. å­—æ®µçº¦æŸä¹Ÿå¯ä»¥å†™æˆè¡¨çº¦æŸï¼ˆæ¯”å¦‚ä¸»é”®çº¦æŸï¼‰ï¼Œè€Œåè¿‡æ¥å¾ˆå¯èƒ½ä¸è¡Œã€‚ ","date":"2018-06-15","objectID":"/posts/sql-basics-1/:2:2","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸€ï¼‰","uri":"/posts/sql-basics-1/#çº¦æŸ"},{"categories":["tech"],"content":" 3. åˆ é™¤è¡¨å’Œæ›´æ–°è¡¨å®šä¹‰ åˆ é™¤è¡¨ï¼ˆå±é™©æ“ä½œï¼‰ åˆ é™¤æ•´ä¸ªè¡¨ï¼š sql DROP TABLE \u003cè¡¨å\u003e; - åªæ¸…ç©ºè¡¨å†…æ•°æ®ï¼Œä½†ç•™ä¸‹è¡¨ï¼š sql TRUNCATE \u003cè¡¨å\u003e; -- éæ ‡å‡†SQLè¯­å¥ï¼Œä½†æ˜¯å¤§éƒ¨åˆ†DBéƒ½æ”¯æŒã€‚ï¼ˆå¯èƒ½ä¸èƒ½ROLLBACKï¼‰ æ›´æ–°è¡¨å®šä¹‰ï¼ˆéº»çƒ¦çš„æ“ä½œï¼‰æ‰€ä»¥æ‰€åˆ›å»ºè¡¨å‰è¦ä»”ç»†æƒ³å¥½æ ¼å¼äº†ï¼Œæ›´æ–°è¡¨å®šä¹‰æ˜¯ä¸å¾—å·²æ‰èƒ½ä¸ºä¹‹ã€‚æ·»åŠ åˆ—å®šä¹‰ï¼š sql ALTER TABLE \u003cè¡¨å\u003e ADD COLUMN \u003cåˆ—å\u003e \u003cæ•°æ®ç±»å‹\u003e \u003cè¯¥åˆ—çš„çº¦æŸ\u003e; åˆ é™¤åˆ—å®šä¹‰ï¼š sql ALTER TABLE \u003cè¡¨å\u003e DROP COLUMN \u003cåˆ—å\u003e; ","date":"2018-06-15","objectID":"/posts/sql-basics-1/:2:3","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸€ï¼‰","uri":"/posts/sql-basics-1/#3-åˆ é™¤è¡¨å’Œæ›´æ–°è¡¨å®šä¹‰"},{"categories":["tech"],"content":" ä¸‰ã€DML ä¸‡æ¶ä¹‹æº NULL ","date":"2018-06-15","objectID":"/posts/sql-basics-1/:3:0","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸€ï¼‰","uri":"/posts/sql-basics-1/#ä¸‰dml"},{"categories":["tech"],"content":" 1. æŸ¥è¯¢ï¼ˆé‡ç‚¹ï¼‰ åŸºæœ¬è¯­å¥ï¼š text SELECT \u003cå­—æ®µ1\u003e AS \u003cåˆ«å1\u003e, \u003cå­—æ®µ2\u003e AS \u003cåˆ«å2\u003e, ... FROM \u003cè¡¨å\u003e WHERE \u003cè¿‡æ»¤æ¡ä»¶\u003e; å¯ç”¨ DISTINCT ä¿®é¥°åˆ—åï¼Œä½¿æŸ¥è¯¢ç»“æœæ— é‡ã€‚ä¾‹ï¼šSELECT DISTINCT \u003cåˆ—å\u003e FROM \u003cè¡¨å\u003e è¿‡æ»¤æ¡ä»¶å¯ä½¿ç”¨æ¯”è¾ƒè¿ç®—(\u003c\u003eã€=ç­‰)å’Œé€»è¾‘è¿ç®—(AND OR NOT). è¿‡æ»¤æ¡ä»¶ä¸­ï¼Œæ¯”è¾ƒè¿ç®—ä¼šæ°¸è¿œå¿½ç•¥ NULL å€¼ï¼Œå¦‚æœéœ€è¦å¯¹ NULL å€¼åšæ“ä½œï¼Œéœ€è¦ä½¿ç”¨ IS NULL æˆ– IS NOT NULLï¼ˆè¯´å¿½ç•¥ä¹Ÿè®¸ä¸å¤ªå‡†ç¡®ï¼ŒNULL æ—¢ä¸ä¸ºçœŸä¹Ÿä¸ä¸ºå‡ï¼Œåæ­£å°‘ç”¨ NULLã€‚ã€‚ï¼‰ åŒ…å«NULLçš„å››åˆ™è¿ç®—ï¼Œå¾—åˆ°çš„ç»“æœæ€»ä¸ºNULL ","date":"2018-06-15","objectID":"/posts/sql-basics-1/:3:1","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸€ï¼‰","uri":"/posts/sql-basics-1/#1-æŸ¥è¯¢é‡ç‚¹"},{"categories":["tech"],"content":" 2. èšåˆä¸æ’åºï¼ˆé‡ç‚¹ï¼‰ èšåˆå‡½æ•°å³å¯¹åˆ—è¿›è¡Œç»Ÿè®¡åˆ†æçš„å‡½æ•°ï¼Œä¸»è¦æœ‰äº”ä¸ªï¼š COUNTï¼šè®¡ç®—åˆ—çš„è¡Œæ•°ã€‚ï¼ˆåªæœ‰COUNT(*)ä¼šè®¡ç®—NULLè¡Œï¼‰ SUMï¼šæ±‚è¯¥åˆ—ä¹‹å’Œã€‚ AVGï¼šæ±‚è¯¥åˆ—çš„å¹³å‡å€¼ã€‚ MAX/MINï¼šæ±‚è¯¥åˆ—çš„ æœ€å¤§/æœ€å° å€¼ NOTEï¼š èšåˆå‡½æ•°è®¡ç®—æ—¶ä¼šæ’é™¤æ‰€æœ‰NULLè¡Œã€‚åªæœ‰COUNT(*)ä¾‹å¤–ï¼ŒNULLè¡Œä¹Ÿä¼šè¢«å®ƒè®¡æ•°ã€‚ MAX/MIN å‡ ä¹é€‚ç”¨äºæ‰€æœ‰æ•°æ®ç±»å‹çš„åˆ—ï¼ˆå¯¹éæ•°å€¼å‹ï¼Œä»¥å…¶äºŒè¿›åˆ¶å€¼æ¥æ’åºï¼‰ï¼Œè€ŒSUM/AVGåªèƒ½ç”¨äºæ•°å€¼ç±»å‹çš„åˆ—ã€‚ èšåˆå‡½æ•°æ“ä½œçš„åˆ—ï¼Œä¹Ÿèƒ½ç”¨DISTINCTä¿®é¥°ã€‚ä¾‹ï¼šSELECT COUNT(DISTINCT \u003cåˆ—å\u003e) FROM \u003cè¡¨å\u003e èšåˆå‡½æ•°åªèƒ½ç”¨äºSELECTå­å¥å’Œè¿˜æ²¡è®²çš„HAVINGå­å¥ï¼ˆä»¥åŠ ORDER BY å­å¥ï¼‰ä¸­ã€‚ åˆ†ç»„(GROUP BY)åˆ†ç»„ä»¥èšåˆé”®ä¸ºåˆ†ç±»æ ‡å‡†ï¼Œå°†æ•°æ®åˆ†ä¸ºå¤šä¸ªé€»è¾‘ç»„ï¼Œä»è€Œèƒ½åˆ†åˆ«å¯¹æ¯ä¸ªç»„è¿›è¡Œèšåˆè¿ç®—ã€‚ï¼ˆåˆ†ç»„æ˜¯ä¸ºäº†åˆ†ç±»èšåˆï¼‰ è‹¥å‡ºç°äº† GROUP BY å­å¥ï¼ŒæŸ¥è¯¢ç»“æœä¸€å®šæ˜¯æ¯ä¸€ç»„ä¸€è¡Œã€‚ GROUP BY ä¼šå°† NULL ä½œä¸ºä¸€ç»„ç‰¹å®šæ•°æ®ï¼Œæ˜¾ç¤ºä¸ºç©ºã€‚ èšåˆå¯¹SELECTå­å¥çš„é™åˆ¶é¦–å…ˆè¦ç†è§£çš„æ˜¯ï¼š èšåˆå‡½æ•°çš„æ“ä½œå¯¹è±¡ä¸ºæŸä¸€åˆ—ï¼Œè€Œäº§ç”Ÿçš„ç»“æœåªæœ‰ä¸€ä¸ªå€¼ã€‚ GROUP BY çš„æ“ä½œå¯¹è±¡ä¸ºä¸€åˆ—æˆ–è€…å¤šåˆ—ï¼Œäº§ç”Ÿçš„ç»“æœå‘¢ï¼Œæ˜¯æ¯ä¸€ç»„ä¸€ä¸ªå€¼ã€‚ å› æ­¤ä¸ºäº†é¿å…æ­§ä¹‰ï¼Œåªè¦ä½¿ç”¨äº†èšåˆå‡½æ•°æˆ– GROUP BY äºŒè€…ä¹‹ä¸€ï¼ŒSELECT å­å¥å°±åªèƒ½åŒ…å«ï¼š å¸¸æ•° å…¶ä»–èšåˆå‡½æ•°ï¼ˆè¯¥èšåˆå‡½æ•°çš„æ“ä½œå¯¹è±¡å¯ä»¥ä¸ºå…¶ä»–åˆ—ï¼‰ å¦‚æœä½¿ç”¨äº† GROUP BY å­å¥ï¼Œè¿˜èƒ½åŒ…æ‹¬è¯¥å­å¥æ‰€æŒ‡å®šçš„åˆ—åã€‚ï¼ˆä¹Ÿå°±æ˜¯èšåˆé”®ï¼‰ä½†æ˜¯ç»ä¸èƒ½åŒ…å«å…¶ä»–çš„åˆ—åï¼Œå› ä¸ºè¿™ä¼šæœ‰æ­§ä¹‰ã€‚ æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ç”± SQL çš„æ‰§è¡Œé¡ºåºå¼•èµ·çš„ã€‚åº”è¯¥èƒ½å¾ˆå®¹æ˜“çŒœåˆ°ï¼ŒSELECT è¯­å¥çš„æ‰§è¡Œé¡ºåºå’Œä¹¦å†™é¡ºåºæ˜¯ä¸ä¸€è‡´çš„ã€‚æŸ¥è¯¢åº”è¯¥æ˜¯ä»è¡¨å¼€å§‹ï¼Œæ‰€ä»¥ FROM è¯­å¥ä¸€å®šå…ˆæ‰§è¡Œã€‚ç„¶ååº”è¯¥è¦è¿‡æ»¤(WHERE)ï¼Œ å†æ˜¯åˆ†ç»„(GROUP BY)ï¼Œæœ€åæ‰æ˜¯ SELECT è¯­å¥ã€‚ï¼ˆå°±å·²ç»å­¦åˆ°çš„å­å¥è€Œè¨€ï¼Œé¡ºåºæ˜¯è¿™æ ·ï¼‰å› æ­¤æŒ‰ç†è¯´ï¼ŒSELECT è¯­å¥ å®šä¹‰çš„åˆ«åï¼Œæ˜¯ä¸èƒ½åœ¨ GROUP BY é‡Œä½¿ç”¨çš„ã€‚ï¼ˆä¹Ÿæœ‰äº›DBæ”¯æŒè¯¥ç”¨æ³•ï¼Œä½†ä¸é€šç”¨ï¼‰ å¯¹èšåˆç»“æœè¿›è¡Œè¿‡æ»¤(HAVING)ä»åˆšåˆšè¯´è¿‡çš„SQLæ‰§è¡Œé¡ºåºå¯è§ï¼ŒWHEREè¦æ¯”GROUP BYå…ˆæ‰§è¡Œï¼Œå› æ­¤å¦‚æœæƒ³è¿‡æ»¤åˆ†ç»„åçš„ç»“æœï¼Œä¸èƒ½ç”¨å®ƒã€‚è€Œåº”è¯¥ä½¿ç”¨ HAVING å­å¥ã€‚HAVING å­å¥å’Œ WHERE å­å¥éƒ½æ˜¯ç”¨æ¥è¿‡æ»¤çš„ï¼Œä½†æ˜¯æ‰§è¡Œé¡ºåºçš„ä¸åŒä¹Ÿå°±å†³å®šäº†å®ƒä»¬çš„ç”¨é€”ä¸åŒã€‚ NOTEï¼š æœ‰æ—¶å€™ï¼Œä¼šå‘ç°æŸä¸ªè¿‡æ»¤æ¡ä»¶ï¼Œä¸è®ºæ˜¯å…ˆæ‰§è¡Œï¼ˆå°±æ˜¯å†™åœ¨WHEREå­å¥ä¸­ï¼‰è¿˜æ˜¯åæ‰§è¡Œï¼ˆå†™åœ¨HAVING ä¸­ï¼‰éƒ½æ²¡é—®é¢˜ï¼Œè¿™æ—¶å€™åº”è¯¥å°†å®ƒå†™åœ¨WHEREå­å¥ä¸­ï¼Œè¿™æ ·GROUP BYæ“ä½œçš„æ•°æ®ä¼šæ›´å°‘ï¼Œå¤„ç†æ›´å¿«ã€‚ HAVING å­å¥çš„å…ƒç´ ï¼Œä¹Ÿå­˜åœ¨å’Œ SELECT å­å¥åŒæ ·çš„é™åˆ¶ã€‚ä¸èƒ½ä½¿ç”¨èšåˆé”®ä»¥å¤–çš„åˆ—åã€‚ æ’åº(ORDER BY)ORDER BY å­å¥åœ¨ SELECT å­å¥ä¹‹åæ‰§è¡Œï¼Œå› æ­¤å®ƒèƒ½ä½¿ç”¨ SELECT å­å¥ä¸­å®šä¹‰çš„åˆ«åã€‚ï¼ˆè€Œ GROUP BY ä¹‹å‰å·²ç»è¯´è¿‡ä¸èƒ½ç”¨åˆ«åäº†ï¼‰æ ¼å¼ï¼š sql SELECT \u003cå­—æ®µ1\u003e AS \u003cåˆ«å1\u003e, \u003cå­—æ®µ2\u003e AS \u003cåˆ«å2\u003e, ... FROM \u003cè¡¨å\u003e WHERE \u003cè¿‡æ»¤æ¡ä»¶1\u003e GROUP BY \u003cåˆ—å1\u003e, \u003cåˆ—å2\u003e... HAVING \u003cè¿‡æ»¤æ¡ä»¶2\u003e ORDER BY \u003cåˆ—å/åˆ«å1\u003e, \u003cåˆ—å/åˆ«å2\u003e... ; å¤šæ’åºé”®/åˆ—ï¼šæŒ‡å®šå¤šæ’åºé”®æ—¶çš„æ’åºè§„åˆ™ä¸ºï¼šä¼˜å…ˆä½¿ç”¨å·¦ä¾§çš„åˆ—ï¼Œå¦‚æœè¯¥åˆ—å­˜åœ¨ç›¸åŒå€¼ï¼Œå†æ¥ç€å‚è€ƒå³ä¾§çš„é”®ï¼Œä¾æ­¤ç±»æ¨ã€‚ï¼ˆå¦‚æœå·¦ä¾§é”®å€¼ä¸åŒï¼Œå³ä¾§çš„é”®å°±ä¸ä¼šè¢«ä½¿ç”¨äº†ï¼‰ NULL å€¼çš„é¡ºåºï¼šæ’åºé”®ä¸­å‡ºç°äº† NULL å€¼æ—¶ï¼Œè¿™ç±»å€¼ä¼šåœ¨ç»“æœçš„å¼€å¤´æˆ–ç»“å°¾æ±‡æ€»ï¼Œç©¶ç«Ÿæ˜¯æ’åœ¨å¼€å¤´è¿˜æ˜¯ç»“å°¾ï¼Œå¹¶æ²¡æœ‰ç‰¹æ®Šè§„å®šã€‚ ORDER BY å­å¥åªå½±å“ç»“æœçš„å…ˆåé¡ºåºï¼Œå› æ­¤æ’åºé”®å¯ä»¥æ˜¯ç»“æœé›†ä»¥å¤–çš„ä¸œè¥¿ï¼Œæ¯”å¦‚å…¶ä»–çš„åˆ—ï¼Œæˆ–è€…ä½¿ç”¨äº† GROUP BY æ—¶ï¼Œè¿˜èƒ½ç”¨èšåˆå‡½æ•°ã€‚ ","date":"2018-06-15","objectID":"/posts/sql-basics-1/:3:2","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸€ï¼‰","uri":"/posts/sql-basics-1/#2-èšåˆä¸æ’åºé‡ç‚¹"},{"categories":["tech"],"content":" 2. èšåˆä¸æ’åºï¼ˆé‡ç‚¹ï¼‰ èšåˆå‡½æ•°å³å¯¹åˆ—è¿›è¡Œç»Ÿè®¡åˆ†æçš„å‡½æ•°ï¼Œä¸»è¦æœ‰äº”ä¸ªï¼š COUNTï¼šè®¡ç®—åˆ—çš„è¡Œæ•°ã€‚ï¼ˆåªæœ‰COUNT(*)ä¼šè®¡ç®—NULLè¡Œï¼‰ SUMï¼šæ±‚è¯¥åˆ—ä¹‹å’Œã€‚ AVGï¼šæ±‚è¯¥åˆ—çš„å¹³å‡å€¼ã€‚ MAX/MINï¼šæ±‚è¯¥åˆ—çš„ æœ€å¤§/æœ€å° å€¼ NOTEï¼š èšåˆå‡½æ•°è®¡ç®—æ—¶ä¼šæ’é™¤æ‰€æœ‰NULLè¡Œã€‚åªæœ‰COUNT(*)ä¾‹å¤–ï¼ŒNULLè¡Œä¹Ÿä¼šè¢«å®ƒè®¡æ•°ã€‚ MAX/MIN å‡ ä¹é€‚ç”¨äºæ‰€æœ‰æ•°æ®ç±»å‹çš„åˆ—ï¼ˆå¯¹éæ•°å€¼å‹ï¼Œä»¥å…¶äºŒè¿›åˆ¶å€¼æ¥æ’åºï¼‰ï¼Œè€ŒSUM/AVGåªèƒ½ç”¨äºæ•°å€¼ç±»å‹çš„åˆ—ã€‚ èšåˆå‡½æ•°æ“ä½œçš„åˆ—ï¼Œä¹Ÿèƒ½ç”¨DISTINCTä¿®é¥°ã€‚ä¾‹ï¼šSELECT COUNT(DISTINCT \u003cåˆ—å\u003e) FROM \u003cè¡¨å\u003e èšåˆå‡½æ•°åªèƒ½ç”¨äºSELECTå­å¥å’Œè¿˜æ²¡è®²çš„HAVINGå­å¥ï¼ˆä»¥åŠ ORDER BY å­å¥ï¼‰ä¸­ã€‚ åˆ†ç»„(GROUP BY)åˆ†ç»„ä»¥èšåˆé”®ä¸ºåˆ†ç±»æ ‡å‡†ï¼Œå°†æ•°æ®åˆ†ä¸ºå¤šä¸ªé€»è¾‘ç»„ï¼Œä»è€Œèƒ½åˆ†åˆ«å¯¹æ¯ä¸ªç»„è¿›è¡Œèšåˆè¿ç®—ã€‚ï¼ˆåˆ†ç»„æ˜¯ä¸ºäº†åˆ†ç±»èšåˆï¼‰ è‹¥å‡ºç°äº† GROUP BY å­å¥ï¼ŒæŸ¥è¯¢ç»“æœä¸€å®šæ˜¯æ¯ä¸€ç»„ä¸€è¡Œã€‚ GROUP BY ä¼šå°† NULL ä½œä¸ºä¸€ç»„ç‰¹å®šæ•°æ®ï¼Œæ˜¾ç¤ºä¸ºç©ºã€‚ èšåˆå¯¹SELECTå­å¥çš„é™åˆ¶é¦–å…ˆè¦ç†è§£çš„æ˜¯ï¼š èšåˆå‡½æ•°çš„æ“ä½œå¯¹è±¡ä¸ºæŸä¸€åˆ—ï¼Œè€Œäº§ç”Ÿçš„ç»“æœåªæœ‰ä¸€ä¸ªå€¼ã€‚ GROUP BY çš„æ“ä½œå¯¹è±¡ä¸ºä¸€åˆ—æˆ–è€…å¤šåˆ—ï¼Œäº§ç”Ÿçš„ç»“æœå‘¢ï¼Œæ˜¯æ¯ä¸€ç»„ä¸€ä¸ªå€¼ã€‚ å› æ­¤ä¸ºäº†é¿å…æ­§ä¹‰ï¼Œåªè¦ä½¿ç”¨äº†èšåˆå‡½æ•°æˆ– GROUP BY äºŒè€…ä¹‹ä¸€ï¼ŒSELECT å­å¥å°±åªèƒ½åŒ…å«ï¼š å¸¸æ•° å…¶ä»–èšåˆå‡½æ•°ï¼ˆè¯¥èšåˆå‡½æ•°çš„æ“ä½œå¯¹è±¡å¯ä»¥ä¸ºå…¶ä»–åˆ—ï¼‰ å¦‚æœä½¿ç”¨äº† GROUP BY å­å¥ï¼Œè¿˜èƒ½åŒ…æ‹¬è¯¥å­å¥æ‰€æŒ‡å®šçš„åˆ—åã€‚ï¼ˆä¹Ÿå°±æ˜¯èšåˆé”®ï¼‰ä½†æ˜¯ç»ä¸èƒ½åŒ…å«å…¶ä»–çš„åˆ—åï¼Œå› ä¸ºè¿™ä¼šæœ‰æ­§ä¹‰ã€‚ æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ç”± SQL çš„æ‰§è¡Œé¡ºåºå¼•èµ·çš„ã€‚åº”è¯¥èƒ½å¾ˆå®¹æ˜“çŒœåˆ°ï¼ŒSELECT è¯­å¥çš„æ‰§è¡Œé¡ºåºå’Œä¹¦å†™é¡ºåºæ˜¯ä¸ä¸€è‡´çš„ã€‚æŸ¥è¯¢åº”è¯¥æ˜¯ä»è¡¨å¼€å§‹ï¼Œæ‰€ä»¥ FROM è¯­å¥ä¸€å®šå…ˆæ‰§è¡Œã€‚ç„¶ååº”è¯¥è¦è¿‡æ»¤(WHERE)ï¼Œ å†æ˜¯åˆ†ç»„(GROUP BY)ï¼Œæœ€åæ‰æ˜¯ SELECT è¯­å¥ã€‚ï¼ˆå°±å·²ç»å­¦åˆ°çš„å­å¥è€Œè¨€ï¼Œé¡ºåºæ˜¯è¿™æ ·ï¼‰å› æ­¤æŒ‰ç†è¯´ï¼ŒSELECT è¯­å¥ å®šä¹‰çš„åˆ«åï¼Œæ˜¯ä¸èƒ½åœ¨ GROUP BY é‡Œä½¿ç”¨çš„ã€‚ï¼ˆä¹Ÿæœ‰äº›DBæ”¯æŒè¯¥ç”¨æ³•ï¼Œä½†ä¸é€šç”¨ï¼‰ å¯¹èšåˆç»“æœè¿›è¡Œè¿‡æ»¤(HAVING)ä»åˆšåˆšè¯´è¿‡çš„SQLæ‰§è¡Œé¡ºåºå¯è§ï¼ŒWHEREè¦æ¯”GROUP BYå…ˆæ‰§è¡Œï¼Œå› æ­¤å¦‚æœæƒ³è¿‡æ»¤åˆ†ç»„åçš„ç»“æœï¼Œä¸èƒ½ç”¨å®ƒã€‚è€Œåº”è¯¥ä½¿ç”¨ HAVING å­å¥ã€‚HAVING å­å¥å’Œ WHERE å­å¥éƒ½æ˜¯ç”¨æ¥è¿‡æ»¤çš„ï¼Œä½†æ˜¯æ‰§è¡Œé¡ºåºçš„ä¸åŒä¹Ÿå°±å†³å®šäº†å®ƒä»¬çš„ç”¨é€”ä¸åŒã€‚ NOTEï¼š æœ‰æ—¶å€™ï¼Œä¼šå‘ç°æŸä¸ªè¿‡æ»¤æ¡ä»¶ï¼Œä¸è®ºæ˜¯å…ˆæ‰§è¡Œï¼ˆå°±æ˜¯å†™åœ¨WHEREå­å¥ä¸­ï¼‰è¿˜æ˜¯åæ‰§è¡Œï¼ˆå†™åœ¨HAVING ä¸­ï¼‰éƒ½æ²¡é—®é¢˜ï¼Œè¿™æ—¶å€™åº”è¯¥å°†å®ƒå†™åœ¨WHEREå­å¥ä¸­ï¼Œè¿™æ ·GROUP BYæ“ä½œçš„æ•°æ®ä¼šæ›´å°‘ï¼Œå¤„ç†æ›´å¿«ã€‚ HAVING å­å¥çš„å…ƒç´ ï¼Œä¹Ÿå­˜åœ¨å’Œ SELECT å­å¥åŒæ ·çš„é™åˆ¶ã€‚ä¸èƒ½ä½¿ç”¨èšåˆé”®ä»¥å¤–çš„åˆ—åã€‚ æ’åº(ORDER BY)ORDER BY å­å¥åœ¨ SELECT å­å¥ä¹‹åæ‰§è¡Œï¼Œå› æ­¤å®ƒèƒ½ä½¿ç”¨ SELECT å­å¥ä¸­å®šä¹‰çš„åˆ«åã€‚ï¼ˆè€Œ GROUP BY ä¹‹å‰å·²ç»è¯´è¿‡ä¸èƒ½ç”¨åˆ«åäº†ï¼‰æ ¼å¼ï¼š sql SELECT \u003cå­—æ®µ1\u003e AS \u003cåˆ«å1\u003e, \u003cå­—æ®µ2\u003e AS \u003cåˆ«å2\u003e, ... FROM \u003cè¡¨å\u003e WHERE \u003cè¿‡æ»¤æ¡ä»¶1\u003e GROUP BY \u003cåˆ—å1\u003e, \u003cåˆ—å2\u003e... HAVING \u003cè¿‡æ»¤æ¡ä»¶2\u003e ORDER BY \u003cåˆ—å/åˆ«å1\u003e, \u003cåˆ—å/åˆ«å2\u003e... ; å¤šæ’åºé”®/åˆ—ï¼šæŒ‡å®šå¤šæ’åºé”®æ—¶çš„æ’åºè§„åˆ™ä¸ºï¼šä¼˜å…ˆä½¿ç”¨å·¦ä¾§çš„åˆ—ï¼Œå¦‚æœè¯¥åˆ—å­˜åœ¨ç›¸åŒå€¼ï¼Œå†æ¥ç€å‚è€ƒå³ä¾§çš„é”®ï¼Œä¾æ­¤ç±»æ¨ã€‚ï¼ˆå¦‚æœå·¦ä¾§é”®å€¼ä¸åŒï¼Œå³ä¾§çš„é”®å°±ä¸ä¼šè¢«ä½¿ç”¨äº†ï¼‰ NULL å€¼çš„é¡ºåºï¼šæ’åºé”®ä¸­å‡ºç°äº† NULL å€¼æ—¶ï¼Œè¿™ç±»å€¼ä¼šåœ¨ç»“æœçš„å¼€å¤´æˆ–ç»“å°¾æ±‡æ€»ï¼Œç©¶ç«Ÿæ˜¯æ’åœ¨å¼€å¤´è¿˜æ˜¯ç»“å°¾ï¼Œå¹¶æ²¡æœ‰ç‰¹æ®Šè§„å®šã€‚ ORDER BY å­å¥åªå½±å“ç»“æœçš„å…ˆåé¡ºåºï¼Œå› æ­¤æ’åºé”®å¯ä»¥æ˜¯ç»“æœé›†ä»¥å¤–çš„ä¸œè¥¿ï¼Œæ¯”å¦‚å…¶ä»–çš„åˆ—ï¼Œæˆ–è€…ä½¿ç”¨äº† GROUP BY æ—¶ï¼Œè¿˜èƒ½ç”¨èšåˆå‡½æ•°ã€‚ ","date":"2018-06-15","objectID":"/posts/sql-basics-1/:3:2","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸€ï¼‰","uri":"/posts/sql-basics-1/#èšåˆå‡½æ•°"},{"categories":["tech"],"content":" 2. èšåˆä¸æ’åºï¼ˆé‡ç‚¹ï¼‰ èšåˆå‡½æ•°å³å¯¹åˆ—è¿›è¡Œç»Ÿè®¡åˆ†æçš„å‡½æ•°ï¼Œä¸»è¦æœ‰äº”ä¸ªï¼š COUNTï¼šè®¡ç®—åˆ—çš„è¡Œæ•°ã€‚ï¼ˆåªæœ‰COUNT(*)ä¼šè®¡ç®—NULLè¡Œï¼‰ SUMï¼šæ±‚è¯¥åˆ—ä¹‹å’Œã€‚ AVGï¼šæ±‚è¯¥åˆ—çš„å¹³å‡å€¼ã€‚ MAX/MINï¼šæ±‚è¯¥åˆ—çš„ æœ€å¤§/æœ€å° å€¼ NOTEï¼š èšåˆå‡½æ•°è®¡ç®—æ—¶ä¼šæ’é™¤æ‰€æœ‰NULLè¡Œã€‚åªæœ‰COUNT(*)ä¾‹å¤–ï¼ŒNULLè¡Œä¹Ÿä¼šè¢«å®ƒè®¡æ•°ã€‚ MAX/MIN å‡ ä¹é€‚ç”¨äºæ‰€æœ‰æ•°æ®ç±»å‹çš„åˆ—ï¼ˆå¯¹éæ•°å€¼å‹ï¼Œä»¥å…¶äºŒè¿›åˆ¶å€¼æ¥æ’åºï¼‰ï¼Œè€ŒSUM/AVGåªèƒ½ç”¨äºæ•°å€¼ç±»å‹çš„åˆ—ã€‚ èšåˆå‡½æ•°æ“ä½œçš„åˆ—ï¼Œä¹Ÿèƒ½ç”¨DISTINCTä¿®é¥°ã€‚ä¾‹ï¼šSELECT COUNT(DISTINCT \u003cåˆ—å\u003e) FROM \u003cè¡¨å\u003e èšåˆå‡½æ•°åªèƒ½ç”¨äºSELECTå­å¥å’Œè¿˜æ²¡è®²çš„HAVINGå­å¥ï¼ˆä»¥åŠ ORDER BY å­å¥ï¼‰ä¸­ã€‚ åˆ†ç»„(GROUP BY)åˆ†ç»„ä»¥èšåˆé”®ä¸ºåˆ†ç±»æ ‡å‡†ï¼Œå°†æ•°æ®åˆ†ä¸ºå¤šä¸ªé€»è¾‘ç»„ï¼Œä»è€Œèƒ½åˆ†åˆ«å¯¹æ¯ä¸ªç»„è¿›è¡Œèšåˆè¿ç®—ã€‚ï¼ˆåˆ†ç»„æ˜¯ä¸ºäº†åˆ†ç±»èšåˆï¼‰ è‹¥å‡ºç°äº† GROUP BY å­å¥ï¼ŒæŸ¥è¯¢ç»“æœä¸€å®šæ˜¯æ¯ä¸€ç»„ä¸€è¡Œã€‚ GROUP BY ä¼šå°† NULL ä½œä¸ºä¸€ç»„ç‰¹å®šæ•°æ®ï¼Œæ˜¾ç¤ºä¸ºç©ºã€‚ èšåˆå¯¹SELECTå­å¥çš„é™åˆ¶é¦–å…ˆè¦ç†è§£çš„æ˜¯ï¼š èšåˆå‡½æ•°çš„æ“ä½œå¯¹è±¡ä¸ºæŸä¸€åˆ—ï¼Œè€Œäº§ç”Ÿçš„ç»“æœåªæœ‰ä¸€ä¸ªå€¼ã€‚ GROUP BY çš„æ“ä½œå¯¹è±¡ä¸ºä¸€åˆ—æˆ–è€…å¤šåˆ—ï¼Œäº§ç”Ÿçš„ç»“æœå‘¢ï¼Œæ˜¯æ¯ä¸€ç»„ä¸€ä¸ªå€¼ã€‚ å› æ­¤ä¸ºäº†é¿å…æ­§ä¹‰ï¼Œåªè¦ä½¿ç”¨äº†èšåˆå‡½æ•°æˆ– GROUP BY äºŒè€…ä¹‹ä¸€ï¼ŒSELECT å­å¥å°±åªèƒ½åŒ…å«ï¼š å¸¸æ•° å…¶ä»–èšåˆå‡½æ•°ï¼ˆè¯¥èšåˆå‡½æ•°çš„æ“ä½œå¯¹è±¡å¯ä»¥ä¸ºå…¶ä»–åˆ—ï¼‰ å¦‚æœä½¿ç”¨äº† GROUP BY å­å¥ï¼Œè¿˜èƒ½åŒ…æ‹¬è¯¥å­å¥æ‰€æŒ‡å®šçš„åˆ—åã€‚ï¼ˆä¹Ÿå°±æ˜¯èšåˆé”®ï¼‰ä½†æ˜¯ç»ä¸èƒ½åŒ…å«å…¶ä»–çš„åˆ—åï¼Œå› ä¸ºè¿™ä¼šæœ‰æ­§ä¹‰ã€‚ æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ç”± SQL çš„æ‰§è¡Œé¡ºåºå¼•èµ·çš„ã€‚åº”è¯¥èƒ½å¾ˆå®¹æ˜“çŒœåˆ°ï¼ŒSELECT è¯­å¥çš„æ‰§è¡Œé¡ºåºå’Œä¹¦å†™é¡ºåºæ˜¯ä¸ä¸€è‡´çš„ã€‚æŸ¥è¯¢åº”è¯¥æ˜¯ä»è¡¨å¼€å§‹ï¼Œæ‰€ä»¥ FROM è¯­å¥ä¸€å®šå…ˆæ‰§è¡Œã€‚ç„¶ååº”è¯¥è¦è¿‡æ»¤(WHERE)ï¼Œ å†æ˜¯åˆ†ç»„(GROUP BY)ï¼Œæœ€åæ‰æ˜¯ SELECT è¯­å¥ã€‚ï¼ˆå°±å·²ç»å­¦åˆ°çš„å­å¥è€Œè¨€ï¼Œé¡ºåºæ˜¯è¿™æ ·ï¼‰å› æ­¤æŒ‰ç†è¯´ï¼ŒSELECT è¯­å¥ å®šä¹‰çš„åˆ«åï¼Œæ˜¯ä¸èƒ½åœ¨ GROUP BY é‡Œä½¿ç”¨çš„ã€‚ï¼ˆä¹Ÿæœ‰äº›DBæ”¯æŒè¯¥ç”¨æ³•ï¼Œä½†ä¸é€šç”¨ï¼‰ å¯¹èšåˆç»“æœè¿›è¡Œè¿‡æ»¤(HAVING)ä»åˆšåˆšè¯´è¿‡çš„SQLæ‰§è¡Œé¡ºåºå¯è§ï¼ŒWHEREè¦æ¯”GROUP BYå…ˆæ‰§è¡Œï¼Œå› æ­¤å¦‚æœæƒ³è¿‡æ»¤åˆ†ç»„åçš„ç»“æœï¼Œä¸èƒ½ç”¨å®ƒã€‚è€Œåº”è¯¥ä½¿ç”¨ HAVING å­å¥ã€‚HAVING å­å¥å’Œ WHERE å­å¥éƒ½æ˜¯ç”¨æ¥è¿‡æ»¤çš„ï¼Œä½†æ˜¯æ‰§è¡Œé¡ºåºçš„ä¸åŒä¹Ÿå°±å†³å®šäº†å®ƒä»¬çš„ç”¨é€”ä¸åŒã€‚ NOTEï¼š æœ‰æ—¶å€™ï¼Œä¼šå‘ç°æŸä¸ªè¿‡æ»¤æ¡ä»¶ï¼Œä¸è®ºæ˜¯å…ˆæ‰§è¡Œï¼ˆå°±æ˜¯å†™åœ¨WHEREå­å¥ä¸­ï¼‰è¿˜æ˜¯åæ‰§è¡Œï¼ˆå†™åœ¨HAVING ä¸­ï¼‰éƒ½æ²¡é—®é¢˜ï¼Œè¿™æ—¶å€™åº”è¯¥å°†å®ƒå†™åœ¨WHEREå­å¥ä¸­ï¼Œè¿™æ ·GROUP BYæ“ä½œçš„æ•°æ®ä¼šæ›´å°‘ï¼Œå¤„ç†æ›´å¿«ã€‚ HAVING å­å¥çš„å…ƒç´ ï¼Œä¹Ÿå­˜åœ¨å’Œ SELECT å­å¥åŒæ ·çš„é™åˆ¶ã€‚ä¸èƒ½ä½¿ç”¨èšåˆé”®ä»¥å¤–çš„åˆ—åã€‚ æ’åº(ORDER BY)ORDER BY å­å¥åœ¨ SELECT å­å¥ä¹‹åæ‰§è¡Œï¼Œå› æ­¤å®ƒèƒ½ä½¿ç”¨ SELECT å­å¥ä¸­å®šä¹‰çš„åˆ«åã€‚ï¼ˆè€Œ GROUP BY ä¹‹å‰å·²ç»è¯´è¿‡ä¸èƒ½ç”¨åˆ«åäº†ï¼‰æ ¼å¼ï¼š sql SELECT \u003cå­—æ®µ1\u003e AS \u003cåˆ«å1\u003e, \u003cå­—æ®µ2\u003e AS \u003cåˆ«å2\u003e, ... FROM \u003cè¡¨å\u003e WHERE \u003cè¿‡æ»¤æ¡ä»¶1\u003e GROUP BY \u003cåˆ—å1\u003e, \u003cåˆ—å2\u003e... HAVING \u003cè¿‡æ»¤æ¡ä»¶2\u003e ORDER BY \u003cåˆ—å/åˆ«å1\u003e, \u003cåˆ—å/åˆ«å2\u003e... ; å¤šæ’åºé”®/åˆ—ï¼šæŒ‡å®šå¤šæ’åºé”®æ—¶çš„æ’åºè§„åˆ™ä¸ºï¼šä¼˜å…ˆä½¿ç”¨å·¦ä¾§çš„åˆ—ï¼Œå¦‚æœè¯¥åˆ—å­˜åœ¨ç›¸åŒå€¼ï¼Œå†æ¥ç€å‚è€ƒå³ä¾§çš„é”®ï¼Œä¾æ­¤ç±»æ¨ã€‚ï¼ˆå¦‚æœå·¦ä¾§é”®å€¼ä¸åŒï¼Œå³ä¾§çš„é”®å°±ä¸ä¼šè¢«ä½¿ç”¨äº†ï¼‰ NULL å€¼çš„é¡ºåºï¼šæ’åºé”®ä¸­å‡ºç°äº† NULL å€¼æ—¶ï¼Œè¿™ç±»å€¼ä¼šåœ¨ç»“æœçš„å¼€å¤´æˆ–ç»“å°¾æ±‡æ€»ï¼Œç©¶ç«Ÿæ˜¯æ’åœ¨å¼€å¤´è¿˜æ˜¯ç»“å°¾ï¼Œå¹¶æ²¡æœ‰ç‰¹æ®Šè§„å®šã€‚ ORDER BY å­å¥åªå½±å“ç»“æœçš„å…ˆåé¡ºåºï¼Œå› æ­¤æ’åºé”®å¯ä»¥æ˜¯ç»“æœé›†ä»¥å¤–çš„ä¸œè¥¿ï¼Œæ¯”å¦‚å…¶ä»–çš„åˆ—ï¼Œæˆ–è€…ä½¿ç”¨äº† GROUP BY æ—¶ï¼Œè¿˜èƒ½ç”¨èšåˆå‡½æ•°ã€‚ ","date":"2018-06-15","objectID":"/posts/sql-basics-1/:3:2","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸€ï¼‰","uri":"/posts/sql-basics-1/#åˆ†ç»„group-by"},{"categories":["tech"],"content":" 2. èšåˆä¸æ’åºï¼ˆé‡ç‚¹ï¼‰ èšåˆå‡½æ•°å³å¯¹åˆ—è¿›è¡Œç»Ÿè®¡åˆ†æçš„å‡½æ•°ï¼Œä¸»è¦æœ‰äº”ä¸ªï¼š COUNTï¼šè®¡ç®—åˆ—çš„è¡Œæ•°ã€‚ï¼ˆåªæœ‰COUNT(*)ä¼šè®¡ç®—NULLè¡Œï¼‰ SUMï¼šæ±‚è¯¥åˆ—ä¹‹å’Œã€‚ AVGï¼šæ±‚è¯¥åˆ—çš„å¹³å‡å€¼ã€‚ MAX/MINï¼šæ±‚è¯¥åˆ—çš„ æœ€å¤§/æœ€å° å€¼ NOTEï¼š èšåˆå‡½æ•°è®¡ç®—æ—¶ä¼šæ’é™¤æ‰€æœ‰NULLè¡Œã€‚åªæœ‰COUNT(*)ä¾‹å¤–ï¼ŒNULLè¡Œä¹Ÿä¼šè¢«å®ƒè®¡æ•°ã€‚ MAX/MIN å‡ ä¹é€‚ç”¨äºæ‰€æœ‰æ•°æ®ç±»å‹çš„åˆ—ï¼ˆå¯¹éæ•°å€¼å‹ï¼Œä»¥å…¶äºŒè¿›åˆ¶å€¼æ¥æ’åºï¼‰ï¼Œè€ŒSUM/AVGåªèƒ½ç”¨äºæ•°å€¼ç±»å‹çš„åˆ—ã€‚ èšåˆå‡½æ•°æ“ä½œçš„åˆ—ï¼Œä¹Ÿèƒ½ç”¨DISTINCTä¿®é¥°ã€‚ä¾‹ï¼šSELECT COUNT(DISTINCT \u003cåˆ—å\u003e) FROM \u003cè¡¨å\u003e èšåˆå‡½æ•°åªèƒ½ç”¨äºSELECTå­å¥å’Œè¿˜æ²¡è®²çš„HAVINGå­å¥ï¼ˆä»¥åŠ ORDER BY å­å¥ï¼‰ä¸­ã€‚ åˆ†ç»„(GROUP BY)åˆ†ç»„ä»¥èšåˆé”®ä¸ºåˆ†ç±»æ ‡å‡†ï¼Œå°†æ•°æ®åˆ†ä¸ºå¤šä¸ªé€»è¾‘ç»„ï¼Œä»è€Œèƒ½åˆ†åˆ«å¯¹æ¯ä¸ªç»„è¿›è¡Œèšåˆè¿ç®—ã€‚ï¼ˆåˆ†ç»„æ˜¯ä¸ºäº†åˆ†ç±»èšåˆï¼‰ è‹¥å‡ºç°äº† GROUP BY å­å¥ï¼ŒæŸ¥è¯¢ç»“æœä¸€å®šæ˜¯æ¯ä¸€ç»„ä¸€è¡Œã€‚ GROUP BY ä¼šå°† NULL ä½œä¸ºä¸€ç»„ç‰¹å®šæ•°æ®ï¼Œæ˜¾ç¤ºä¸ºç©ºã€‚ èšåˆå¯¹SELECTå­å¥çš„é™åˆ¶é¦–å…ˆè¦ç†è§£çš„æ˜¯ï¼š èšåˆå‡½æ•°çš„æ“ä½œå¯¹è±¡ä¸ºæŸä¸€åˆ—ï¼Œè€Œäº§ç”Ÿçš„ç»“æœåªæœ‰ä¸€ä¸ªå€¼ã€‚ GROUP BY çš„æ“ä½œå¯¹è±¡ä¸ºä¸€åˆ—æˆ–è€…å¤šåˆ—ï¼Œäº§ç”Ÿçš„ç»“æœå‘¢ï¼Œæ˜¯æ¯ä¸€ç»„ä¸€ä¸ªå€¼ã€‚ å› æ­¤ä¸ºäº†é¿å…æ­§ä¹‰ï¼Œåªè¦ä½¿ç”¨äº†èšåˆå‡½æ•°æˆ– GROUP BY äºŒè€…ä¹‹ä¸€ï¼ŒSELECT å­å¥å°±åªèƒ½åŒ…å«ï¼š å¸¸æ•° å…¶ä»–èšåˆå‡½æ•°ï¼ˆè¯¥èšåˆå‡½æ•°çš„æ“ä½œå¯¹è±¡å¯ä»¥ä¸ºå…¶ä»–åˆ—ï¼‰ å¦‚æœä½¿ç”¨äº† GROUP BY å­å¥ï¼Œè¿˜èƒ½åŒ…æ‹¬è¯¥å­å¥æ‰€æŒ‡å®šçš„åˆ—åã€‚ï¼ˆä¹Ÿå°±æ˜¯èšåˆé”®ï¼‰ä½†æ˜¯ç»ä¸èƒ½åŒ…å«å…¶ä»–çš„åˆ—åï¼Œå› ä¸ºè¿™ä¼šæœ‰æ­§ä¹‰ã€‚ æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ç”± SQL çš„æ‰§è¡Œé¡ºåºå¼•èµ·çš„ã€‚åº”è¯¥èƒ½å¾ˆå®¹æ˜“çŒœåˆ°ï¼ŒSELECT è¯­å¥çš„æ‰§è¡Œé¡ºåºå’Œä¹¦å†™é¡ºåºæ˜¯ä¸ä¸€è‡´çš„ã€‚æŸ¥è¯¢åº”è¯¥æ˜¯ä»è¡¨å¼€å§‹ï¼Œæ‰€ä»¥ FROM è¯­å¥ä¸€å®šå…ˆæ‰§è¡Œã€‚ç„¶ååº”è¯¥è¦è¿‡æ»¤(WHERE)ï¼Œ å†æ˜¯åˆ†ç»„(GROUP BY)ï¼Œæœ€åæ‰æ˜¯ SELECT è¯­å¥ã€‚ï¼ˆå°±å·²ç»å­¦åˆ°çš„å­å¥è€Œè¨€ï¼Œé¡ºåºæ˜¯è¿™æ ·ï¼‰å› æ­¤æŒ‰ç†è¯´ï¼ŒSELECT è¯­å¥ å®šä¹‰çš„åˆ«åï¼Œæ˜¯ä¸èƒ½åœ¨ GROUP BY é‡Œä½¿ç”¨çš„ã€‚ï¼ˆä¹Ÿæœ‰äº›DBæ”¯æŒè¯¥ç”¨æ³•ï¼Œä½†ä¸é€šç”¨ï¼‰ å¯¹èšåˆç»“æœè¿›è¡Œè¿‡æ»¤(HAVING)ä»åˆšåˆšè¯´è¿‡çš„SQLæ‰§è¡Œé¡ºåºå¯è§ï¼ŒWHEREè¦æ¯”GROUP BYå…ˆæ‰§è¡Œï¼Œå› æ­¤å¦‚æœæƒ³è¿‡æ»¤åˆ†ç»„åçš„ç»“æœï¼Œä¸èƒ½ç”¨å®ƒã€‚è€Œåº”è¯¥ä½¿ç”¨ HAVING å­å¥ã€‚HAVING å­å¥å’Œ WHERE å­å¥éƒ½æ˜¯ç”¨æ¥è¿‡æ»¤çš„ï¼Œä½†æ˜¯æ‰§è¡Œé¡ºåºçš„ä¸åŒä¹Ÿå°±å†³å®šäº†å®ƒä»¬çš„ç”¨é€”ä¸åŒã€‚ NOTEï¼š æœ‰æ—¶å€™ï¼Œä¼šå‘ç°æŸä¸ªè¿‡æ»¤æ¡ä»¶ï¼Œä¸è®ºæ˜¯å…ˆæ‰§è¡Œï¼ˆå°±æ˜¯å†™åœ¨WHEREå­å¥ä¸­ï¼‰è¿˜æ˜¯åæ‰§è¡Œï¼ˆå†™åœ¨HAVING ä¸­ï¼‰éƒ½æ²¡é—®é¢˜ï¼Œè¿™æ—¶å€™åº”è¯¥å°†å®ƒå†™åœ¨WHEREå­å¥ä¸­ï¼Œè¿™æ ·GROUP BYæ“ä½œçš„æ•°æ®ä¼šæ›´å°‘ï¼Œå¤„ç†æ›´å¿«ã€‚ HAVING å­å¥çš„å…ƒç´ ï¼Œä¹Ÿå­˜åœ¨å’Œ SELECT å­å¥åŒæ ·çš„é™åˆ¶ã€‚ä¸èƒ½ä½¿ç”¨èšåˆé”®ä»¥å¤–çš„åˆ—åã€‚ æ’åº(ORDER BY)ORDER BY å­å¥åœ¨ SELECT å­å¥ä¹‹åæ‰§è¡Œï¼Œå› æ­¤å®ƒèƒ½ä½¿ç”¨ SELECT å­å¥ä¸­å®šä¹‰çš„åˆ«åã€‚ï¼ˆè€Œ GROUP BY ä¹‹å‰å·²ç»è¯´è¿‡ä¸èƒ½ç”¨åˆ«åäº†ï¼‰æ ¼å¼ï¼š sql SELECT \u003cå­—æ®µ1\u003e AS \u003cåˆ«å1\u003e, \u003cå­—æ®µ2\u003e AS \u003cåˆ«å2\u003e, ... FROM \u003cè¡¨å\u003e WHERE \u003cè¿‡æ»¤æ¡ä»¶1\u003e GROUP BY \u003cåˆ—å1\u003e, \u003cåˆ—å2\u003e... HAVING \u003cè¿‡æ»¤æ¡ä»¶2\u003e ORDER BY \u003cåˆ—å/åˆ«å1\u003e, \u003cåˆ—å/åˆ«å2\u003e... ; å¤šæ’åºé”®/åˆ—ï¼šæŒ‡å®šå¤šæ’åºé”®æ—¶çš„æ’åºè§„åˆ™ä¸ºï¼šä¼˜å…ˆä½¿ç”¨å·¦ä¾§çš„åˆ—ï¼Œå¦‚æœè¯¥åˆ—å­˜åœ¨ç›¸åŒå€¼ï¼Œå†æ¥ç€å‚è€ƒå³ä¾§çš„é”®ï¼Œä¾æ­¤ç±»æ¨ã€‚ï¼ˆå¦‚æœå·¦ä¾§é”®å€¼ä¸åŒï¼Œå³ä¾§çš„é”®å°±ä¸ä¼šè¢«ä½¿ç”¨äº†ï¼‰ NULL å€¼çš„é¡ºåºï¼šæ’åºé”®ä¸­å‡ºç°äº† NULL å€¼æ—¶ï¼Œè¿™ç±»å€¼ä¼šåœ¨ç»“æœçš„å¼€å¤´æˆ–ç»“å°¾æ±‡æ€»ï¼Œç©¶ç«Ÿæ˜¯æ’åœ¨å¼€å¤´è¿˜æ˜¯ç»“å°¾ï¼Œå¹¶æ²¡æœ‰ç‰¹æ®Šè§„å®šã€‚ ORDER BY å­å¥åªå½±å“ç»“æœçš„å…ˆåé¡ºåºï¼Œå› æ­¤æ’åºé”®å¯ä»¥æ˜¯ç»“æœé›†ä»¥å¤–çš„ä¸œè¥¿ï¼Œæ¯”å¦‚å…¶ä»–çš„åˆ—ï¼Œæˆ–è€…ä½¿ç”¨äº† GROUP BY æ—¶ï¼Œè¿˜èƒ½ç”¨èšåˆå‡½æ•°ã€‚ ","date":"2018-06-15","objectID":"/posts/sql-basics-1/:3:2","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸€ï¼‰","uri":"/posts/sql-basics-1/#èšåˆå¯¹selectå­å¥çš„é™åˆ¶"},{"categories":["tech"],"content":" 2. èšåˆä¸æ’åºï¼ˆé‡ç‚¹ï¼‰ èšåˆå‡½æ•°å³å¯¹åˆ—è¿›è¡Œç»Ÿè®¡åˆ†æçš„å‡½æ•°ï¼Œä¸»è¦æœ‰äº”ä¸ªï¼š COUNTï¼šè®¡ç®—åˆ—çš„è¡Œæ•°ã€‚ï¼ˆåªæœ‰COUNT(*)ä¼šè®¡ç®—NULLè¡Œï¼‰ SUMï¼šæ±‚è¯¥åˆ—ä¹‹å’Œã€‚ AVGï¼šæ±‚è¯¥åˆ—çš„å¹³å‡å€¼ã€‚ MAX/MINï¼šæ±‚è¯¥åˆ—çš„ æœ€å¤§/æœ€å° å€¼ NOTEï¼š èšåˆå‡½æ•°è®¡ç®—æ—¶ä¼šæ’é™¤æ‰€æœ‰NULLè¡Œã€‚åªæœ‰COUNT(*)ä¾‹å¤–ï¼ŒNULLè¡Œä¹Ÿä¼šè¢«å®ƒè®¡æ•°ã€‚ MAX/MIN å‡ ä¹é€‚ç”¨äºæ‰€æœ‰æ•°æ®ç±»å‹çš„åˆ—ï¼ˆå¯¹éæ•°å€¼å‹ï¼Œä»¥å…¶äºŒè¿›åˆ¶å€¼æ¥æ’åºï¼‰ï¼Œè€ŒSUM/AVGåªèƒ½ç”¨äºæ•°å€¼ç±»å‹çš„åˆ—ã€‚ èšåˆå‡½æ•°æ“ä½œçš„åˆ—ï¼Œä¹Ÿèƒ½ç”¨DISTINCTä¿®é¥°ã€‚ä¾‹ï¼šSELECT COUNT(DISTINCT \u003cåˆ—å\u003e) FROM \u003cè¡¨å\u003e èšåˆå‡½æ•°åªèƒ½ç”¨äºSELECTå­å¥å’Œè¿˜æ²¡è®²çš„HAVINGå­å¥ï¼ˆä»¥åŠ ORDER BY å­å¥ï¼‰ä¸­ã€‚ åˆ†ç»„(GROUP BY)åˆ†ç»„ä»¥èšåˆé”®ä¸ºåˆ†ç±»æ ‡å‡†ï¼Œå°†æ•°æ®åˆ†ä¸ºå¤šä¸ªé€»è¾‘ç»„ï¼Œä»è€Œèƒ½åˆ†åˆ«å¯¹æ¯ä¸ªç»„è¿›è¡Œèšåˆè¿ç®—ã€‚ï¼ˆåˆ†ç»„æ˜¯ä¸ºäº†åˆ†ç±»èšåˆï¼‰ è‹¥å‡ºç°äº† GROUP BY å­å¥ï¼ŒæŸ¥è¯¢ç»“æœä¸€å®šæ˜¯æ¯ä¸€ç»„ä¸€è¡Œã€‚ GROUP BY ä¼šå°† NULL ä½œä¸ºä¸€ç»„ç‰¹å®šæ•°æ®ï¼Œæ˜¾ç¤ºä¸ºç©ºã€‚ èšåˆå¯¹SELECTå­å¥çš„é™åˆ¶é¦–å…ˆè¦ç†è§£çš„æ˜¯ï¼š èšåˆå‡½æ•°çš„æ“ä½œå¯¹è±¡ä¸ºæŸä¸€åˆ—ï¼Œè€Œäº§ç”Ÿçš„ç»“æœåªæœ‰ä¸€ä¸ªå€¼ã€‚ GROUP BY çš„æ“ä½œå¯¹è±¡ä¸ºä¸€åˆ—æˆ–è€…å¤šåˆ—ï¼Œäº§ç”Ÿçš„ç»“æœå‘¢ï¼Œæ˜¯æ¯ä¸€ç»„ä¸€ä¸ªå€¼ã€‚ å› æ­¤ä¸ºäº†é¿å…æ­§ä¹‰ï¼Œåªè¦ä½¿ç”¨äº†èšåˆå‡½æ•°æˆ– GROUP BY äºŒè€…ä¹‹ä¸€ï¼ŒSELECT å­å¥å°±åªèƒ½åŒ…å«ï¼š å¸¸æ•° å…¶ä»–èšåˆå‡½æ•°ï¼ˆè¯¥èšåˆå‡½æ•°çš„æ“ä½œå¯¹è±¡å¯ä»¥ä¸ºå…¶ä»–åˆ—ï¼‰ å¦‚æœä½¿ç”¨äº† GROUP BY å­å¥ï¼Œè¿˜èƒ½åŒ…æ‹¬è¯¥å­å¥æ‰€æŒ‡å®šçš„åˆ—åã€‚ï¼ˆä¹Ÿå°±æ˜¯èšåˆé”®ï¼‰ä½†æ˜¯ç»ä¸èƒ½åŒ…å«å…¶ä»–çš„åˆ—åï¼Œå› ä¸ºè¿™ä¼šæœ‰æ­§ä¹‰ã€‚ æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ç”± SQL çš„æ‰§è¡Œé¡ºåºå¼•èµ·çš„ã€‚åº”è¯¥èƒ½å¾ˆå®¹æ˜“çŒœåˆ°ï¼ŒSELECT è¯­å¥çš„æ‰§è¡Œé¡ºåºå’Œä¹¦å†™é¡ºåºæ˜¯ä¸ä¸€è‡´çš„ã€‚æŸ¥è¯¢åº”è¯¥æ˜¯ä»è¡¨å¼€å§‹ï¼Œæ‰€ä»¥ FROM è¯­å¥ä¸€å®šå…ˆæ‰§è¡Œã€‚ç„¶ååº”è¯¥è¦è¿‡æ»¤(WHERE)ï¼Œ å†æ˜¯åˆ†ç»„(GROUP BY)ï¼Œæœ€åæ‰æ˜¯ SELECT è¯­å¥ã€‚ï¼ˆå°±å·²ç»å­¦åˆ°çš„å­å¥è€Œè¨€ï¼Œé¡ºåºæ˜¯è¿™æ ·ï¼‰å› æ­¤æŒ‰ç†è¯´ï¼ŒSELECT è¯­å¥ å®šä¹‰çš„åˆ«åï¼Œæ˜¯ä¸èƒ½åœ¨ GROUP BY é‡Œä½¿ç”¨çš„ã€‚ï¼ˆä¹Ÿæœ‰äº›DBæ”¯æŒè¯¥ç”¨æ³•ï¼Œä½†ä¸é€šç”¨ï¼‰ å¯¹èšåˆç»“æœè¿›è¡Œè¿‡æ»¤(HAVING)ä»åˆšåˆšè¯´è¿‡çš„SQLæ‰§è¡Œé¡ºåºå¯è§ï¼ŒWHEREè¦æ¯”GROUP BYå…ˆæ‰§è¡Œï¼Œå› æ­¤å¦‚æœæƒ³è¿‡æ»¤åˆ†ç»„åçš„ç»“æœï¼Œä¸èƒ½ç”¨å®ƒã€‚è€Œåº”è¯¥ä½¿ç”¨ HAVING å­å¥ã€‚HAVING å­å¥å’Œ WHERE å­å¥éƒ½æ˜¯ç”¨æ¥è¿‡æ»¤çš„ï¼Œä½†æ˜¯æ‰§è¡Œé¡ºåºçš„ä¸åŒä¹Ÿå°±å†³å®šäº†å®ƒä»¬çš„ç”¨é€”ä¸åŒã€‚ NOTEï¼š æœ‰æ—¶å€™ï¼Œä¼šå‘ç°æŸä¸ªè¿‡æ»¤æ¡ä»¶ï¼Œä¸è®ºæ˜¯å…ˆæ‰§è¡Œï¼ˆå°±æ˜¯å†™åœ¨WHEREå­å¥ä¸­ï¼‰è¿˜æ˜¯åæ‰§è¡Œï¼ˆå†™åœ¨HAVING ä¸­ï¼‰éƒ½æ²¡é—®é¢˜ï¼Œè¿™æ—¶å€™åº”è¯¥å°†å®ƒå†™åœ¨WHEREå­å¥ä¸­ï¼Œè¿™æ ·GROUP BYæ“ä½œçš„æ•°æ®ä¼šæ›´å°‘ï¼Œå¤„ç†æ›´å¿«ã€‚ HAVING å­å¥çš„å…ƒç´ ï¼Œä¹Ÿå­˜åœ¨å’Œ SELECT å­å¥åŒæ ·çš„é™åˆ¶ã€‚ä¸èƒ½ä½¿ç”¨èšåˆé”®ä»¥å¤–çš„åˆ—åã€‚ æ’åº(ORDER BY)ORDER BY å­å¥åœ¨ SELECT å­å¥ä¹‹åæ‰§è¡Œï¼Œå› æ­¤å®ƒèƒ½ä½¿ç”¨ SELECT å­å¥ä¸­å®šä¹‰çš„åˆ«åã€‚ï¼ˆè€Œ GROUP BY ä¹‹å‰å·²ç»è¯´è¿‡ä¸èƒ½ç”¨åˆ«åäº†ï¼‰æ ¼å¼ï¼š sql SELECT \u003cå­—æ®µ1\u003e AS \u003cåˆ«å1\u003e, \u003cå­—æ®µ2\u003e AS \u003cåˆ«å2\u003e, ... FROM \u003cè¡¨å\u003e WHERE \u003cè¿‡æ»¤æ¡ä»¶1\u003e GROUP BY \u003cåˆ—å1\u003e, \u003cåˆ—å2\u003e... HAVING \u003cè¿‡æ»¤æ¡ä»¶2\u003e ORDER BY \u003cåˆ—å/åˆ«å1\u003e, \u003cåˆ—å/åˆ«å2\u003e... ; å¤šæ’åºé”®/åˆ—ï¼šæŒ‡å®šå¤šæ’åºé”®æ—¶çš„æ’åºè§„åˆ™ä¸ºï¼šä¼˜å…ˆä½¿ç”¨å·¦ä¾§çš„åˆ—ï¼Œå¦‚æœè¯¥åˆ—å­˜åœ¨ç›¸åŒå€¼ï¼Œå†æ¥ç€å‚è€ƒå³ä¾§çš„é”®ï¼Œä¾æ­¤ç±»æ¨ã€‚ï¼ˆå¦‚æœå·¦ä¾§é”®å€¼ä¸åŒï¼Œå³ä¾§çš„é”®å°±ä¸ä¼šè¢«ä½¿ç”¨äº†ï¼‰ NULL å€¼çš„é¡ºåºï¼šæ’åºé”®ä¸­å‡ºç°äº† NULL å€¼æ—¶ï¼Œè¿™ç±»å€¼ä¼šåœ¨ç»“æœçš„å¼€å¤´æˆ–ç»“å°¾æ±‡æ€»ï¼Œç©¶ç«Ÿæ˜¯æ’åœ¨å¼€å¤´è¿˜æ˜¯ç»“å°¾ï¼Œå¹¶æ²¡æœ‰ç‰¹æ®Šè§„å®šã€‚ ORDER BY å­å¥åªå½±å“ç»“æœçš„å…ˆåé¡ºåºï¼Œå› æ­¤æ’åºé”®å¯ä»¥æ˜¯ç»“æœé›†ä»¥å¤–çš„ä¸œè¥¿ï¼Œæ¯”å¦‚å…¶ä»–çš„åˆ—ï¼Œæˆ–è€…ä½¿ç”¨äº† GROUP BY æ—¶ï¼Œè¿˜èƒ½ç”¨èšåˆå‡½æ•°ã€‚ ","date":"2018-06-15","objectID":"/posts/sql-basics-1/:3:2","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸€ï¼‰","uri":"/posts/sql-basics-1/#å¯¹èšåˆç»“æœè¿›è¡Œè¿‡æ»¤having"},{"categories":["tech"],"content":" 2. èšåˆä¸æ’åºï¼ˆé‡ç‚¹ï¼‰ èšåˆå‡½æ•°å³å¯¹åˆ—è¿›è¡Œç»Ÿè®¡åˆ†æçš„å‡½æ•°ï¼Œä¸»è¦æœ‰äº”ä¸ªï¼š COUNTï¼šè®¡ç®—åˆ—çš„è¡Œæ•°ã€‚ï¼ˆåªæœ‰COUNT(*)ä¼šè®¡ç®—NULLè¡Œï¼‰ SUMï¼šæ±‚è¯¥åˆ—ä¹‹å’Œã€‚ AVGï¼šæ±‚è¯¥åˆ—çš„å¹³å‡å€¼ã€‚ MAX/MINï¼šæ±‚è¯¥åˆ—çš„ æœ€å¤§/æœ€å° å€¼ NOTEï¼š èšåˆå‡½æ•°è®¡ç®—æ—¶ä¼šæ’é™¤æ‰€æœ‰NULLè¡Œã€‚åªæœ‰COUNT(*)ä¾‹å¤–ï¼ŒNULLè¡Œä¹Ÿä¼šè¢«å®ƒè®¡æ•°ã€‚ MAX/MIN å‡ ä¹é€‚ç”¨äºæ‰€æœ‰æ•°æ®ç±»å‹çš„åˆ—ï¼ˆå¯¹éæ•°å€¼å‹ï¼Œä»¥å…¶äºŒè¿›åˆ¶å€¼æ¥æ’åºï¼‰ï¼Œè€ŒSUM/AVGåªèƒ½ç”¨äºæ•°å€¼ç±»å‹çš„åˆ—ã€‚ èšåˆå‡½æ•°æ“ä½œçš„åˆ—ï¼Œä¹Ÿèƒ½ç”¨DISTINCTä¿®é¥°ã€‚ä¾‹ï¼šSELECT COUNT(DISTINCT \u003cåˆ—å\u003e) FROM \u003cè¡¨å\u003e èšåˆå‡½æ•°åªèƒ½ç”¨äºSELECTå­å¥å’Œè¿˜æ²¡è®²çš„HAVINGå­å¥ï¼ˆä»¥åŠ ORDER BY å­å¥ï¼‰ä¸­ã€‚ åˆ†ç»„(GROUP BY)åˆ†ç»„ä»¥èšåˆé”®ä¸ºåˆ†ç±»æ ‡å‡†ï¼Œå°†æ•°æ®åˆ†ä¸ºå¤šä¸ªé€»è¾‘ç»„ï¼Œä»è€Œèƒ½åˆ†åˆ«å¯¹æ¯ä¸ªç»„è¿›è¡Œèšåˆè¿ç®—ã€‚ï¼ˆåˆ†ç»„æ˜¯ä¸ºäº†åˆ†ç±»èšåˆï¼‰ è‹¥å‡ºç°äº† GROUP BY å­å¥ï¼ŒæŸ¥è¯¢ç»“æœä¸€å®šæ˜¯æ¯ä¸€ç»„ä¸€è¡Œã€‚ GROUP BY ä¼šå°† NULL ä½œä¸ºä¸€ç»„ç‰¹å®šæ•°æ®ï¼Œæ˜¾ç¤ºä¸ºç©ºã€‚ èšåˆå¯¹SELECTå­å¥çš„é™åˆ¶é¦–å…ˆè¦ç†è§£çš„æ˜¯ï¼š èšåˆå‡½æ•°çš„æ“ä½œå¯¹è±¡ä¸ºæŸä¸€åˆ—ï¼Œè€Œäº§ç”Ÿçš„ç»“æœåªæœ‰ä¸€ä¸ªå€¼ã€‚ GROUP BY çš„æ“ä½œå¯¹è±¡ä¸ºä¸€åˆ—æˆ–è€…å¤šåˆ—ï¼Œäº§ç”Ÿçš„ç»“æœå‘¢ï¼Œæ˜¯æ¯ä¸€ç»„ä¸€ä¸ªå€¼ã€‚ å› æ­¤ä¸ºäº†é¿å…æ­§ä¹‰ï¼Œåªè¦ä½¿ç”¨äº†èšåˆå‡½æ•°æˆ– GROUP BY äºŒè€…ä¹‹ä¸€ï¼ŒSELECT å­å¥å°±åªèƒ½åŒ…å«ï¼š å¸¸æ•° å…¶ä»–èšåˆå‡½æ•°ï¼ˆè¯¥èšåˆå‡½æ•°çš„æ“ä½œå¯¹è±¡å¯ä»¥ä¸ºå…¶ä»–åˆ—ï¼‰ å¦‚æœä½¿ç”¨äº† GROUP BY å­å¥ï¼Œè¿˜èƒ½åŒ…æ‹¬è¯¥å­å¥æ‰€æŒ‡å®šçš„åˆ—åã€‚ï¼ˆä¹Ÿå°±æ˜¯èšåˆé”®ï¼‰ä½†æ˜¯ç»ä¸èƒ½åŒ…å«å…¶ä»–çš„åˆ—åï¼Œå› ä¸ºè¿™ä¼šæœ‰æ­§ä¹‰ã€‚ æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ç”± SQL çš„æ‰§è¡Œé¡ºåºå¼•èµ·çš„ã€‚åº”è¯¥èƒ½å¾ˆå®¹æ˜“çŒœåˆ°ï¼ŒSELECT è¯­å¥çš„æ‰§è¡Œé¡ºåºå’Œä¹¦å†™é¡ºåºæ˜¯ä¸ä¸€è‡´çš„ã€‚æŸ¥è¯¢åº”è¯¥æ˜¯ä»è¡¨å¼€å§‹ï¼Œæ‰€ä»¥ FROM è¯­å¥ä¸€å®šå…ˆæ‰§è¡Œã€‚ç„¶ååº”è¯¥è¦è¿‡æ»¤(WHERE)ï¼Œ å†æ˜¯åˆ†ç»„(GROUP BY)ï¼Œæœ€åæ‰æ˜¯ SELECT è¯­å¥ã€‚ï¼ˆå°±å·²ç»å­¦åˆ°çš„å­å¥è€Œè¨€ï¼Œé¡ºåºæ˜¯è¿™æ ·ï¼‰å› æ­¤æŒ‰ç†è¯´ï¼ŒSELECT è¯­å¥ å®šä¹‰çš„åˆ«åï¼Œæ˜¯ä¸èƒ½åœ¨ GROUP BY é‡Œä½¿ç”¨çš„ã€‚ï¼ˆä¹Ÿæœ‰äº›DBæ”¯æŒè¯¥ç”¨æ³•ï¼Œä½†ä¸é€šç”¨ï¼‰ å¯¹èšåˆç»“æœè¿›è¡Œè¿‡æ»¤(HAVING)ä»åˆšåˆšè¯´è¿‡çš„SQLæ‰§è¡Œé¡ºåºå¯è§ï¼ŒWHEREè¦æ¯”GROUP BYå…ˆæ‰§è¡Œï¼Œå› æ­¤å¦‚æœæƒ³è¿‡æ»¤åˆ†ç»„åçš„ç»“æœï¼Œä¸èƒ½ç”¨å®ƒã€‚è€Œåº”è¯¥ä½¿ç”¨ HAVING å­å¥ã€‚HAVING å­å¥å’Œ WHERE å­å¥éƒ½æ˜¯ç”¨æ¥è¿‡æ»¤çš„ï¼Œä½†æ˜¯æ‰§è¡Œé¡ºåºçš„ä¸åŒä¹Ÿå°±å†³å®šäº†å®ƒä»¬çš„ç”¨é€”ä¸åŒã€‚ NOTEï¼š æœ‰æ—¶å€™ï¼Œä¼šå‘ç°æŸä¸ªè¿‡æ»¤æ¡ä»¶ï¼Œä¸è®ºæ˜¯å…ˆæ‰§è¡Œï¼ˆå°±æ˜¯å†™åœ¨WHEREå­å¥ä¸­ï¼‰è¿˜æ˜¯åæ‰§è¡Œï¼ˆå†™åœ¨HAVING ä¸­ï¼‰éƒ½æ²¡é—®é¢˜ï¼Œè¿™æ—¶å€™åº”è¯¥å°†å®ƒå†™åœ¨WHEREå­å¥ä¸­ï¼Œè¿™æ ·GROUP BYæ“ä½œçš„æ•°æ®ä¼šæ›´å°‘ï¼Œå¤„ç†æ›´å¿«ã€‚ HAVING å­å¥çš„å…ƒç´ ï¼Œä¹Ÿå­˜åœ¨å’Œ SELECT å­å¥åŒæ ·çš„é™åˆ¶ã€‚ä¸èƒ½ä½¿ç”¨èšåˆé”®ä»¥å¤–çš„åˆ—åã€‚ æ’åº(ORDER BY)ORDER BY å­å¥åœ¨ SELECT å­å¥ä¹‹åæ‰§è¡Œï¼Œå› æ­¤å®ƒèƒ½ä½¿ç”¨ SELECT å­å¥ä¸­å®šä¹‰çš„åˆ«åã€‚ï¼ˆè€Œ GROUP BY ä¹‹å‰å·²ç»è¯´è¿‡ä¸èƒ½ç”¨åˆ«åäº†ï¼‰æ ¼å¼ï¼š sql SELECT \u003cå­—æ®µ1\u003e AS \u003cåˆ«å1\u003e, \u003cå­—æ®µ2\u003e AS \u003cåˆ«å2\u003e, ... FROM \u003cè¡¨å\u003e WHERE \u003cè¿‡æ»¤æ¡ä»¶1\u003e GROUP BY \u003cåˆ—å1\u003e, \u003cåˆ—å2\u003e... HAVING \u003cè¿‡æ»¤æ¡ä»¶2\u003e ORDER BY \u003cåˆ—å/åˆ«å1\u003e, \u003cåˆ—å/åˆ«å2\u003e... ; å¤šæ’åºé”®/åˆ—ï¼šæŒ‡å®šå¤šæ’åºé”®æ—¶çš„æ’åºè§„åˆ™ä¸ºï¼šä¼˜å…ˆä½¿ç”¨å·¦ä¾§çš„åˆ—ï¼Œå¦‚æœè¯¥åˆ—å­˜åœ¨ç›¸åŒå€¼ï¼Œå†æ¥ç€å‚è€ƒå³ä¾§çš„é”®ï¼Œä¾æ­¤ç±»æ¨ã€‚ï¼ˆå¦‚æœå·¦ä¾§é”®å€¼ä¸åŒï¼Œå³ä¾§çš„é”®å°±ä¸ä¼šè¢«ä½¿ç”¨äº†ï¼‰ NULL å€¼çš„é¡ºåºï¼šæ’åºé”®ä¸­å‡ºç°äº† NULL å€¼æ—¶ï¼Œè¿™ç±»å€¼ä¼šåœ¨ç»“æœçš„å¼€å¤´æˆ–ç»“å°¾æ±‡æ€»ï¼Œç©¶ç«Ÿæ˜¯æ’åœ¨å¼€å¤´è¿˜æ˜¯ç»“å°¾ï¼Œå¹¶æ²¡æœ‰ç‰¹æ®Šè§„å®šã€‚ ORDER BY å­å¥åªå½±å“ç»“æœçš„å…ˆåé¡ºåºï¼Œå› æ­¤æ’åºé”®å¯ä»¥æ˜¯ç»“æœé›†ä»¥å¤–çš„ä¸œè¥¿ï¼Œæ¯”å¦‚å…¶ä»–çš„åˆ—ï¼Œæˆ–è€…ä½¿ç”¨äº† GROUP BY æ—¶ï¼Œè¿˜èƒ½ç”¨èšåˆå‡½æ•°ã€‚ ","date":"2018-06-15","objectID":"/posts/sql-basics-1/:3:2","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸€ï¼‰","uri":"/posts/sql-basics-1/#æ’åºorder-by"},{"categories":["tech"],"content":" 3. æ•°æ®çš„å¢ã€åˆ ã€æ”¹ æ’å…¥(INSERT INTO) ä¹Ÿç®—ç”¨çš„å¤šäº†è¯­æ³•ï¼š sql INSERT INTO \u003cè¡¨å\u003e (åˆ—å1, åˆ—å2...) VALUES (å€¼1, å€¼2...); æˆ–è€…ä¹Ÿå¯ä»¥ä½¿ç”¨ SELECT è¯­å¥æ¥æ›¿ä»£ VALUES å­å¥ï¼Œè¾¾åˆ°å°† SELECT åˆ°çš„ç»“æœé›†æ’å…¥æŸè¡¨çš„æ•ˆæœã€‚ï¼ˆä½†æ˜¯ä¸è¦ç”¨ORDER BYï¼Œå› ä¸ºç»“æœæ˜¯é›†ï¼Œæ²¡æœ‰é¡ºåºï¼Œæ’åºæ˜¯å¾’åŠ³æ— åŠŸçš„ï¼‰æ’å…¥æ—¶ä¸»é”®ä¸èƒ½é‡å¤ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚ï¼ˆå› æ­¤å¦‚æœéœ€è¦åŒ…å«é‡å¤æ•°æ®ï¼Œä¸€èˆ¬éƒ½ä¼šå®šä¹‰ä¸€ä¸ªè‡ªå¢çš„idå­—æ®µï¼‰ åˆ é™¤(DELETE)æ¸…ç©ºè¡¨ï¼ˆå±é™©æ“ä½œï¼Œè€Œä¸”æ•ˆç‡ä¸å¦‚ TRUNCATEï¼‰ï¼š sql DELETE FROM \u003cè¡¨å\u003e; æ¡ä»¶åˆ é™¤ï¼š sql DELETE FROM \u003cè¡¨å\u003e WHERE \u003cæ¡ä»¶\u003e; å› æ­¤ä½¿ç”¨DELETEæ—¶ï¼Œä¸€å®šè¦è®°å¾—å¸¦WHEREï¼Œä¸ç„¶å°±å¥½ç©äº†ã€‚ã€‚ æ›´æ–°(UPDATE) sql UPDATE \u003cè¡¨å\u003e SET \u003cåˆ—å1\u003e = \u003cç®—æœ¯è¡¨è¾¾å¼1\u003e, \u003cåˆ—å2\u003e = \u003cè¡¨è¾¾å¼2\u003e, ... WHERE \u003cæ¡ä»¶\u003e; åŒ DELETE ä¸€æ ·ï¼Œä¸å¸¦ WHERE å­å¥çš„ UPDATE æ˜¯å¾ˆå±é™©çš„ã€‚ ","date":"2018-06-15","objectID":"/posts/sql-basics-1/:3:3","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸€ï¼‰","uri":"/posts/sql-basics-1/#3-æ•°æ®çš„å¢åˆ æ”¹"},{"categories":["tech"],"content":" 3. æ•°æ®çš„å¢ã€åˆ ã€æ”¹ æ’å…¥(INSERT INTO) ä¹Ÿç®—ç”¨çš„å¤šäº†è¯­æ³•ï¼š sql INSERT INTO \u003cè¡¨å\u003e (åˆ—å1, åˆ—å2...) VALUES (å€¼1, å€¼2...); æˆ–è€…ä¹Ÿå¯ä»¥ä½¿ç”¨ SELECT è¯­å¥æ¥æ›¿ä»£ VALUES å­å¥ï¼Œè¾¾åˆ°å°† SELECT åˆ°çš„ç»“æœé›†æ’å…¥æŸè¡¨çš„æ•ˆæœã€‚ï¼ˆä½†æ˜¯ä¸è¦ç”¨ORDER BYï¼Œå› ä¸ºç»“æœæ˜¯é›†ï¼Œæ²¡æœ‰é¡ºåºï¼Œæ’åºæ˜¯å¾’åŠ³æ— åŠŸçš„ï¼‰æ’å…¥æ—¶ä¸»é”®ä¸èƒ½é‡å¤ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚ï¼ˆå› æ­¤å¦‚æœéœ€è¦åŒ…å«é‡å¤æ•°æ®ï¼Œä¸€èˆ¬éƒ½ä¼šå®šä¹‰ä¸€ä¸ªè‡ªå¢çš„idå­—æ®µï¼‰ åˆ é™¤(DELETE)æ¸…ç©ºè¡¨ï¼ˆå±é™©æ“ä½œï¼Œè€Œä¸”æ•ˆç‡ä¸å¦‚ TRUNCATEï¼‰ï¼š sql DELETE FROM \u003cè¡¨å\u003e; æ¡ä»¶åˆ é™¤ï¼š sql DELETE FROM \u003cè¡¨å\u003e WHERE \u003cæ¡ä»¶\u003e; å› æ­¤ä½¿ç”¨DELETEæ—¶ï¼Œä¸€å®šè¦è®°å¾—å¸¦WHEREï¼Œä¸ç„¶å°±å¥½ç©äº†ã€‚ã€‚ æ›´æ–°(UPDATE) sql UPDATE \u003cè¡¨å\u003e SET \u003cåˆ—å1\u003e = \u003cç®—æœ¯è¡¨è¾¾å¼1\u003e, \u003cåˆ—å2\u003e = \u003cè¡¨è¾¾å¼2\u003e, ... WHERE \u003cæ¡ä»¶\u003e; åŒ DELETE ä¸€æ ·ï¼Œä¸å¸¦ WHERE å­å¥çš„ UPDATE æ˜¯å¾ˆå±é™©çš„ã€‚ ","date":"2018-06-15","objectID":"/posts/sql-basics-1/:3:3","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸€ï¼‰","uri":"/posts/sql-basics-1/#æ’å…¥insert-into-ä¹Ÿç®—ç”¨çš„å¤šäº†"},{"categories":["tech"],"content":" 3. æ•°æ®çš„å¢ã€åˆ ã€æ”¹ æ’å…¥(INSERT INTO) ä¹Ÿç®—ç”¨çš„å¤šäº†è¯­æ³•ï¼š sql INSERT INTO \u003cè¡¨å\u003e (åˆ—å1, åˆ—å2...) VALUES (å€¼1, å€¼2...); æˆ–è€…ä¹Ÿå¯ä»¥ä½¿ç”¨ SELECT è¯­å¥æ¥æ›¿ä»£ VALUES å­å¥ï¼Œè¾¾åˆ°å°† SELECT åˆ°çš„ç»“æœé›†æ’å…¥æŸè¡¨çš„æ•ˆæœã€‚ï¼ˆä½†æ˜¯ä¸è¦ç”¨ORDER BYï¼Œå› ä¸ºç»“æœæ˜¯é›†ï¼Œæ²¡æœ‰é¡ºåºï¼Œæ’åºæ˜¯å¾’åŠ³æ— åŠŸçš„ï¼‰æ’å…¥æ—¶ä¸»é”®ä¸èƒ½é‡å¤ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚ï¼ˆå› æ­¤å¦‚æœéœ€è¦åŒ…å«é‡å¤æ•°æ®ï¼Œä¸€èˆ¬éƒ½ä¼šå®šä¹‰ä¸€ä¸ªè‡ªå¢çš„idå­—æ®µï¼‰ åˆ é™¤(DELETE)æ¸…ç©ºè¡¨ï¼ˆå±é™©æ“ä½œï¼Œè€Œä¸”æ•ˆç‡ä¸å¦‚ TRUNCATEï¼‰ï¼š sql DELETE FROM \u003cè¡¨å\u003e; æ¡ä»¶åˆ é™¤ï¼š sql DELETE FROM \u003cè¡¨å\u003e WHERE \u003cæ¡ä»¶\u003e; å› æ­¤ä½¿ç”¨DELETEæ—¶ï¼Œä¸€å®šè¦è®°å¾—å¸¦WHEREï¼Œä¸ç„¶å°±å¥½ç©äº†ã€‚ã€‚ æ›´æ–°(UPDATE) sql UPDATE \u003cè¡¨å\u003e SET \u003cåˆ—å1\u003e = \u003cç®—æœ¯è¡¨è¾¾å¼1\u003e, \u003cåˆ—å2\u003e = \u003cè¡¨è¾¾å¼2\u003e, ... WHERE \u003cæ¡ä»¶\u003e; åŒ DELETE ä¸€æ ·ï¼Œä¸å¸¦ WHERE å­å¥çš„ UPDATE æ˜¯å¾ˆå±é™©çš„ã€‚ ","date":"2018-06-15","objectID":"/posts/sql-basics-1/:3:3","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸€ï¼‰","uri":"/posts/sql-basics-1/#åˆ é™¤delete"},{"categories":["tech"],"content":" 3. æ•°æ®çš„å¢ã€åˆ ã€æ”¹ æ’å…¥(INSERT INTO) ä¹Ÿç®—ç”¨çš„å¤šäº†è¯­æ³•ï¼š sql INSERT INTO \u003cè¡¨å\u003e (åˆ—å1, åˆ—å2...) VALUES (å€¼1, å€¼2...); æˆ–è€…ä¹Ÿå¯ä»¥ä½¿ç”¨ SELECT è¯­å¥æ¥æ›¿ä»£ VALUES å­å¥ï¼Œè¾¾åˆ°å°† SELECT åˆ°çš„ç»“æœé›†æ’å…¥æŸè¡¨çš„æ•ˆæœã€‚ï¼ˆä½†æ˜¯ä¸è¦ç”¨ORDER BYï¼Œå› ä¸ºç»“æœæ˜¯é›†ï¼Œæ²¡æœ‰é¡ºåºï¼Œæ’åºæ˜¯å¾’åŠ³æ— åŠŸçš„ï¼‰æ’å…¥æ—¶ä¸»é”®ä¸èƒ½é‡å¤ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚ï¼ˆå› æ­¤å¦‚æœéœ€è¦åŒ…å«é‡å¤æ•°æ®ï¼Œä¸€èˆ¬éƒ½ä¼šå®šä¹‰ä¸€ä¸ªè‡ªå¢çš„idå­—æ®µï¼‰ åˆ é™¤(DELETE)æ¸…ç©ºè¡¨ï¼ˆå±é™©æ“ä½œï¼Œè€Œä¸”æ•ˆç‡ä¸å¦‚ TRUNCATEï¼‰ï¼š sql DELETE FROM \u003cè¡¨å\u003e; æ¡ä»¶åˆ é™¤ï¼š sql DELETE FROM \u003cè¡¨å\u003e WHERE \u003cæ¡ä»¶\u003e; å› æ­¤ä½¿ç”¨DELETEæ—¶ï¼Œä¸€å®šè¦è®°å¾—å¸¦WHEREï¼Œä¸ç„¶å°±å¥½ç©äº†ã€‚ã€‚ æ›´æ–°(UPDATE) sql UPDATE \u003cè¡¨å\u003e SET \u003cåˆ—å1\u003e = \u003cç®—æœ¯è¡¨è¾¾å¼1\u003e, \u003cåˆ—å2\u003e = \u003cè¡¨è¾¾å¼2\u003e, ... WHERE \u003cæ¡ä»¶\u003e; åŒ DELETE ä¸€æ ·ï¼Œä¸å¸¦ WHERE å­å¥çš„ UPDATE æ˜¯å¾ˆå±é™©çš„ã€‚ ","date":"2018-06-15","objectID":"/posts/sql-basics-1/:3:3","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸€ï¼‰","uri":"/posts/sql-basics-1/#æ›´æ–°update"},{"categories":["tech"],"content":" å››ã€DCL - äº‹åŠ¡å¤„ç†(MySQL)äº‹åŠ¡æ˜¯ä¸€ç³»åˆ—ä¸å¯åˆ†å‰²çš„æ•°æ®åº“æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸€ç³»åˆ—æ“ä½œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œã€‚å¦‚æœæ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿäº†é—®é¢˜ï¼ˆæ£€æŸ¥æ‰§è¡ŒçŠ¶æ€ï¼‰ï¼Œå¯ä»¥é€šè¿‡æ‰§è¡Œ ROLLBACK å›æ»šåˆ°è¯¥äº‹åŠ¡æ‰§è¡Œå‰çš„çŠ¶æ€ã€‚ ï¼ˆæ³¨æ„å¹¶ä¸ä¼šè‡ªåŠ¨å›æ»šï¼‰ mysql START TRANSACTION; -- do something COMMIT; START TRANSACTION: æ ‡è¯†äº‹åŠ¡çš„å¼€å§‹ COMMITï¼šæäº¤äº‹åŠ¡ã€‚ä¸€æ—¦æäº¤ï¼Œæ‰€æ‰§è¡Œè¿‡çš„æ“ä½œå°±å·²æˆå®šè®ºï¼Œæ¢å¤ä¸äº†äº†ã€‚ ROLLBACKï¼šäº‹åŠ¡å›æ»šï¼Œåªèƒ½å›æ»šæœª COMMIT çš„ DML æ“ä½œï¼ä¹Ÿå°±æ˜¯è¯´åªèƒ½ç”¨åœ¨START TRANSACTION å’Œ COMMIT ä¹‹é—´ï¼Œå¹¶ä¸”åªèƒ½å›æ»š INSERT/UPDATE/DELETEã€‚ï¼ˆå›æ»š SELECT æ²¡å•¥æ„ä¹‰ï¼‰ SAVEPOINT \u003cä¿ç•™ç‚¹\u003e å’Œ ROLLBACK TO \u003cä¿ç•™ç‚¹\u003eï¼šåŒæ ·åªèƒ½ç”¨åœ¨ START TRANSACTION å’ŒCOMMIT ä¹‹é—´ï¼Œå…¶ä¼˜åŠ¿åœ¨äºï¼ŒROLLBACK TO å¯ä»¥æŒ‡å®šå›æ»šåˆ°æŸç‰¹å®šä¿ç•™ç‚¹ï¼Œæ›´çµæ´»ï¼Œè€ŒROLLBACK åªèƒ½å›æ»šåˆ°äº‹åŠ¡å¼€å§‹å‰ã€‚ éœ€è¦æ³¨æ„çš„æœ‰ï¼š COMMIT å’Œ ROLLBACK è¯­å¥ä¹Ÿæ˜¯äº‹åŠ¡çš„ç»“æŸï¼Œå› æ­¤å¦‚æœæ‰§è¡Œäº† ROLLBACKï¼Œé‚£å®ƒä¸ COMMIT ä¹‹é—´çš„å†…å®¹ä¼šè¢«è·³è¿‡ã€‚ï¼ˆåœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œå®ƒç›¸å½“äºå¤§å¤šæ•° PL çš„ returnï¼‰ å¦‚æœäº‹åŠ¡æ‰§è¡Œå‡ºç°é—®é¢˜ï¼Œé—®é¢˜è¡Œåé¢çš„æ‰€æœ‰è¯­å¥éƒ½ä¸ä¼šè¢«æ‰§è¡Œï¼åŒ…æ‹¬ COMMIT å’ŒROLLBACKï¼ å¦‚æœæƒ³ç”¨çº¯ SQL å®ç°äº‹åŠ¡åŸå­æ€§ï¼Œå¿…é¡»ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹æ£€æŸ¥æ‰§è¡ŒçŠ¶æ€ï¼ä¸¾ä¾‹å¦‚ä¸‹ï¼š text CREATE PROCEDURE my_test() BEGIN DECLARE EXIT HANDLER FOR SQLEXCEPTION ROLLBACK -- æ£€æµ‹åˆ° SQLEXCEPTION åˆ™ rollbackï¼Œç„¶å exit START TRANSACTION INSERT INTO table_test VALUES(1, 'A') INSERT INTO table_test VALUES(1, 'B') -- è¿™é‡Œä¸»é”®å†²çªï¼Œä¼šè§¦å‘ SQLEXCEPTION COMMIT END CALL my_test() æˆ–è€…åœ¨ PL ä¸­é€šè¿‡å¼‚å¸¸å¤„ç†æ‰§è¡Œ ROLLBACKã€‚ï¼ˆäº‹åŠ¡è™½ç„¶ä¸­æ­¢äº†ï¼Œä½†å¹¶æœªç»“æŸï¼æ‰€ä»¥ä»ç„¶å¯ä»¥ROLLBACK æˆ–è€… COMMITï¼‰ ","date":"2018-06-15","objectID":"/posts/sql-basics-1/:4:0","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸€ï¼‰","uri":"/posts/sql-basics-1/#å››dcl---äº‹åŠ¡å¤„ç†mysql"},{"categories":["tech"],"content":" æ•°æ®ä½•æ—¶è¢«æäº¤åˆ°æ•°æ®åº“ æ˜¾å¼æäº¤ï¼šåœ¨äº‹åŠ¡ä¸­ä½¿ç”¨ COMMIT æäº¤æ•°æ®æ“ä½œè¢«ç§°ä¸ºæ˜¾å¼æäº¤ éšå¼æäº¤ï¼šé DML æ“ä½œä¼šè¢«ç«‹å³æäº¤ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™äº›è¯­å¥æœ¬èº«å°±éšå«äº†æäº¤è¯­ä¹‰ è‡ªåŠ¨æäº¤ï¼š å¦‚æœ AUTOCOMMIT è¢«è®¾ç½®ä¸º ONï¼Œå½“å‰ session ä¸­çš„ DML è¯­å¥ä¼šåœ¨æ‰§è¡Œåè¢«è‡ªåŠ¨æäº¤ï¼ˆSTART TRANSACTION å†…éƒ¨çš„ DML é™¤å¤–ï¼Œåœ¨å®ƒå†…éƒ¨å¿…é¡»æ˜¾å¼ COMMITï¼‰ æ‰€æœ‰çš„ DML è¯­å¥éƒ½æ˜¯è¦æ˜¾å¼æäº¤çš„ï¼ŒMySQL session çš„ AUTOCOMMIT é»˜è®¤ä¸º ONï¼Œæ‰€ä»¥ DML ä¼šè¢«è‡ªåŠ¨æäº¤ã€‚ P.S. è®¸å¤šè¯­è¨€çš„æ•°æ®åº“ API ä¼šå®šä¹‰è‡ªå·±çš„äº‹åŠ¡æ“ä½œï¼Œä¸ä¸€å®šä¸è¿™é‡Œä¸€è‡´ã€‚ ","date":"2018-06-15","objectID":"/posts/sql-basics-1/:4:1","series":null,"tags":["SQL","æ•°æ®åº“","Database"],"title":"SQL åŸºç¡€ç¬”è®°ï¼ˆä¸€ï¼‰","uri":"/posts/sql-basics-1/#æ•°æ®ä½•æ—¶è¢«æäº¤åˆ°æ•°æ®åº“"},{"categories":["tech"],"content":" æœ¬æ–‡æœ€åˆäº 2018-05-25 å‘è¡¨åœ¨åšå®¢å›­ï¼Œ2022-08-13 æ¬è¿è‡³https://thiscute.world ","date":"2018-05-25","objectID":"/posts/video2chars-2/:0:0","series":null,"tags":[],"title":"Python è§†é¢‘è½¬å­—ç¬¦åŠ¨ç”»ï¼ˆäºŒï¼‰è¿›é˜¶","uri":"/posts/video2chars-2/#"},{"categories":["tech"],"content":" 0. è¯è¯´åœ¨å‰å¤´æœ€æ–°ç‰ˆä½¿ç”¨äº†ç”»å¸ƒæ–¹å¼å®ç°ï¼Œå’Œæœ¬æ–‡ç›¸æ¯”æ”¹åŠ¨éå¸¸å¤§ï¼Œå¦‚æœå¯¹æ—§ç‰ˆæœ¬çš„å®ç°æ²¡å•¥å…´è¶£ï¼Œå¯ä»¥ç›´æ¥ç§»æ­¥video2charsï¼Œå®ƒçš„æ•ˆæœåŠ¨ç”»è§ æä¹å‡€åœŸã€‚æ–°ç‰ˆæœ¬çš„æ ¸å¿ƒä»£ç ä¸ç®—æ³¨é‡Š70è¡Œä¸åˆ°ï¼ŒåŠŸèƒ½æ›´å¼ºå¤§ã€‚ ä¸‹é¢çš„æ•ˆæœåŠ¨ç”»æ˜¯ä½¿ç”¨ html å®ç°çš„å­—ç¬¦åŠ¨ç”»æ•ˆæœï¼ˆä¸Šä¸€ç¯‡çš„æ•ˆæœåŠ¨ç”»æ˜¯ shell ç‰ˆçš„ï¼‰ï¼š There should have been a video here but your browser does not seem to support it. æœ¬æ–‡çš„ä¼˜åŒ–ä»ç„¶æ˜¯é’ˆå¯¹ shell ç‰ˆæœ¬çš„ï¼Œhtml ç‰ˆç”±äºç¼ºé™·å¤ªå¤§å°±ä¸å†™æ–‡ç« ä»‹ç»äº†ã€‚ ","date":"2018-05-25","objectID":"/posts/video2chars-2/:0:1","series":null,"tags":[],"title":"Python è§†é¢‘è½¬å­—ç¬¦åŠ¨ç”»ï¼ˆäºŒï¼‰è¿›é˜¶","uri":"/posts/video2chars-2/#0-è¯è¯´åœ¨å‰å¤´"},{"categories":["tech"],"content":" 1. é€Ÿåº¦ä¼˜åŒ–è¦æ˜¯æ¯æ¬¡æ’­æ”¾éƒ½è¦ç­‰ä¸ªä¸€åˆ†é’Ÿï¼Œä¹Ÿå¤ªç—›è‹¦äº†ä¸€ç‚¹ã€‚æ‰€ä»¥å¯ä»¥ç”¨ pickle æ¨¡å—æŠŠ video_chars ä¿å­˜ä¸‹æ¥ï¼Œä¸‹æ¬¡æ’­æ”¾æ—¶ï¼Œå¦‚æœå‘ç°å½“å‰ç›®å½•ä¸‹æœ‰è¿™ä¸ªä¿å­˜ä¸‹æ¥çš„æ•°æ®ï¼Œå°±è·³è¿‡è½¬æ¢ï¼Œç›´æ¥æ’­æ”¾äº†ã€‚è¿™æ ·å°±å¿«å¤šäº†ã€‚åªéœ€è¦æ”¹ä¸€ä¸‹æµ‹è¯•ä»£ç ï¼Œå…ˆåœ¨å¼€å¤´æ·»åŠ ä¸¤ä¸ªä¾èµ– python import os import pickle ç„¶ååœ¨æ–‡ä»¶ç»“å°¾æ·»åŠ ä»£ç ï¼š python def dump(obj, file_name): \"\"\" å°†æŒ‡å®šå¯¹è±¡ï¼Œä»¥file_nameä¸ºåï¼Œä¿å­˜åˆ°æœ¬åœ° \"\"\" with open(file_name, 'wb') as f: pickle.dump(obj, f) return def load(filename): \"\"\" ä»å½“å‰æ–‡ä»¶å¤¹çš„æŒ‡å®šæ–‡ä»¶ä¸­loadå¯¹è±¡ \"\"\" with open(filename, 'rb') as f: return pickle.load(f) def get_file_name(file_path): \"\"\" ä»æ–‡ä»¶è·¯å¾„ä¸­æå–å‡ºä¸å¸¦æ‹“å±•åçš„æ–‡ä»¶å \"\"\" # ä»æ–‡ä»¶è·¯å¾„è·å–æ–‡ä»¶å _name path, file_name_with_extension = os.path.split(file_path) # æ‹¿åˆ°æ–‡ä»¶åå‰ç¼€ file_name, file_extension = os.path.splitext(file_name_with_extension) return file_name def has_file(path, file_name): \"\"\" åˆ¤æ–­æŒ‡å®šç›®å½•ä¸‹ï¼Œæ˜¯å¦å­˜åœ¨æŸæ–‡ä»¶ \"\"\" return file_name in os.listdir(path) def get_video_chars(video_path, size): \"\"\" è¿”å›è§†é¢‘å¯¹åº”çš„å­—ç¬¦è§†é¢‘ \"\"\" video_dump = get_file_name(video_path) + \".pickle\" # å¦‚æœ video_dump å·²ç»å­˜åœ¨äºå½“å‰æ–‡ä»¶å¤¹ï¼Œå°±å¯ä»¥ç›´æ¥è¯»å–è¿›æ¥äº† if has_file(\".\", video_dump): print(\"å‘ç°è¯¥è§†é¢‘çš„è½¬æ¢ç¼“å­˜ï¼Œç›´æ¥è¯»å–\") video_chars = load(video_dump) else: print(\"æœªå‘ç°ç¼“å­˜ï¼Œå¼€å§‹å­—ç¬¦è§†é¢‘è½¬æ¢\") print(\"å¼€å§‹é€å¸§è¯»å–\") # è§†é¢‘è½¬å­—ç¬¦åŠ¨ç”» imgs = video2imgs(video_path, size) print(\"è§†é¢‘å·²å…¨éƒ¨è½¬æ¢åˆ°å›¾åƒï¼Œ å¼€å§‹é€å¸§è½¬æ¢ä¸ºå­—ç¬¦ç”»\") video_chars = imgs2chars(imgs) print(\"è½¬æ¢å®Œæˆï¼Œå¼€å§‹ç¼“å­˜ç»“æœ\") # æŠŠè½¬æ¢ç»“æœä¿å­˜ä¸‹æ¥ dump(video_chars, video_dump) print(\"ç¼“å­˜å®Œæ¯•\") return video_chars if __name__ == \"__main__\": # å®½ï¼Œé«˜ size = (64, 48) # è§†é¢‘è·¯å¾„ï¼Œæ¢æˆä½ è‡ªå·±çš„ video_path = \"BadApple.mp4\" video_chars = get_video_chars(video_path, size) play_video(video_chars) å¦ä¸€ä¸ªä¼˜åŒ–æ–¹æ³•å°±æ˜¯è¾¹è½¬æ¢è¾¹æ’­æ”¾ï¼Œå°±æ˜¯åŒæ—¶æ‰§è¡Œä¸Šè¿°ä¸‰ä¸ªæ­¥éª¤ã€‚å­¦ä¼šäº†çš„è¯ï¼Œå¯ä»¥è‡ªå·±å®ç°ä¸€ä¸‹è¯•è¯•ã€‚ ","date":"2018-05-25","objectID":"/posts/video2chars-2/:0:2","series":null,"tags":[],"title":"Python è§†é¢‘è½¬å­—ç¬¦åŠ¨ç”»ï¼ˆäºŒï¼‰è¿›é˜¶","uri":"/posts/video2chars-2/#1-é€Ÿåº¦ä¼˜åŒ–"},{"categories":["tech"],"content":" 2. å­—ç¬¦è§†é¢‘å’ŒéŸ³ä¹åŒæ—¶æ’­æ”¾æ²¡æœ‰é…ä¹çš„åŠ¨ç”»ï¼Œè™½ç„¶åšå‡ºæ¥äº†æ˜¯å¾ˆæœ‰æˆå°±æ„Ÿï¼Œä½†æ˜¯ä½ å¯èƒ½çœ‹ä¸Šä¸¤éå°±åŒå€¦äº†ã€‚æ‰€ä»¥è®©æˆ‘ä»¬æ¥ç»™å®ƒåŠ ä¸Šé…ä¹ã€‚ï¼ˆä¸è¦æ‹…å¿ƒï¼Œå…¶å®å°±åªéœ€è¦æ·»åŠ å‡ è¡Œä»£ç è€Œå·²ï¼‰ é¦–å…ˆæˆ‘ä»¬éœ€è¦æ‰¾ä¸ªæ–¹æ³•æ¥æ’­æ”¾è§†é¢‘çš„é…ä¹ï¼Œæ€ä¹ˆåšå‘¢ï¼Ÿå…ˆä»‹ç»ä¸€ä¸‹ä¸€ä¸ªè·¨å¹³å°è§†é¢‘æ’­æ”¾å™¨ï¼šmpvï¼Œå®ƒæœ‰å¾ˆæ£’çš„å‘½ä»¤è¡Œæ”¯æŒï¼Œè¯·å…ˆå®‰è£…å¥½å®ƒã€‚è¦è®© mpv åªæ’­æ”¾è§†é¢‘çš„éŸ³ä¹éƒ¨åˆ†ï¼Œåªéœ€è¦å‘½ä»¤ï¼š shell mpv --no-video video_path å¥½äº†ï¼Œç°åœ¨æœ‰äº†éŸ³ä¹ï¼Œå¯æ€»ä¸èƒ½è¿˜è®©äººå¼€ä¿©shellï¼Œå…ˆæ”¾éŸ³ä¹ï¼Œå†æ”¾å­—ç¬¦ç”»å§ã€‚è¿™æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦çš„åŠŸèƒ½æ˜¯ï¼šä½¿ç”¨ Python è°ƒç”¨å¤–éƒ¨åº”ç”¨. ä½†æ˜¯ mpv ä½¿ç”¨äº†ç±»ä¼¼ curses çš„åŠŸèƒ½ï¼Œæ ‡å‡†åº“çš„ os.system ä¸èƒ½éšè—æ‰è¿™ä¸ªéƒ¨åˆ†ï¼Œæ’­æ”¾æ•ˆæœä¸å°½å¦‚äººæ„ã€‚å› æ­¤æˆ‘ä½¿ç”¨äº† pyinvoke æ¨¡å—ï¼Œåªè¦ç»™å®ƒæŒ‡å®šå‚æ•°hide=Trueï¼Œå°±å¯ä»¥å®Œç¾éšè—æ‰è¢«è°ƒç”¨ç¨‹åºçš„è¾“å‡ºï¼ˆæŒ‡ stdoutï¼Œå…¶å® subprocess ä¹Ÿå¯ä»¥çš„ï¼‰ã€‚è¿è¡Œä¸‹é¢ä»£ç å‰ï¼Œè¯·å…ˆç”¨pipå®‰è£…å¥½ invoke.ï¼ˆèƒ½å¤Ÿçœ‹åˆ°è¿™é‡Œçš„ï¼Œå®‰è£…ä¸ªæ¨¡å—è¿˜ä¸æ˜¯å°èœä¸€ç¢Ÿï¼‰ å¥½äº†åºŸè¯è¯´è¿™ä¹ˆå¤šï¼Œä¸Šä»£ç ï¼š python import invoke video_path = \"BadApple.mp4\" invoke.run(f\"mpv --no-video {video_path}\", hide=True, warn=True) è¿è¡Œä¸Šé¢çš„æµ‹è¯•ä»£ç ï¼Œå¦‚æœå¬åˆ°äº†éŸ³ä¹ï¼Œè€Œshellå•¥éƒ½æ²¡è¾“å‡ºï¼Œä½†æ˜¯èƒ½å¬åˆ°éŸ³ä¹çš„è¯ï¼Œå°±æ­£å¸¸äº†ã€‚æˆ‘ä»¬ç»§ç»­ã€‚ï¼ˆè¿™é‡Œä½¿ç”¨äº†python3.6çš„få­—ç¬¦ä¸²ï¼‰ éŸ³ä¹å·²ç»æœ‰äº†ï¼Œé‚£å°±å¥½åŠäº†ã€‚æ·»åŠ ä¸€ä¸ªæ’­æ”¾éŸ³ä¹çš„å‡½æ•° python import invoke def play_audio(video_path): invoke.run(f\"mpv --no-video {video_path}\", hide=True, warn=True) ç„¶åä¿®æ”¹main()æ–¹æ³•ï¼š python def main(): # å®½ï¼Œé«˜ size = (64, 48) # è§†é¢‘è·¯å¾„ï¼Œæ¢æˆä½ è‡ªå·±çš„ video_path = \"BadApple.mp4\" # åªè½¬æ¢ä¸‰åç§’ï¼Œè¿™ä¸ªå±æ€§æ˜¯æ‰æ·»åŠ çš„ï¼Œä½†æ˜¯ä¸Šä¸€ç¯‡çš„ä»£ç æ²¡æœ‰æ›´æ–°ã€‚ä½ å¯èƒ½éœ€è¦å…ˆä¸Šgithubçœ‹çœ‹æœ€æ–°çš„ä»£ç ã€‚å…¶å®å°±ç¨å¾®æ”¹äº†ä¸€ç‚¹ã€‚ seconds = 30 # è¿™é‡Œçš„fpsæ˜¯å¸§ç‡ï¼Œä¹Ÿå°±æ˜¯æ¯ç§’é’Ÿæ’­æ”¾çš„çš„å­—ç¬¦ç”»æ•°ã€‚ç”¨äºå’ŒéŸ³ä¹åŒæ­¥ã€‚è¿™ä¸ªæ›´æ–°ä¹Ÿæ²¡å†™è¿›ä¸Šä¸€ç¯‡ï¼Œè¯·ä¸Šgithubçœ‹çœ‹æ–°ä»£ç ã€‚ video_chars, fps = get_video_chars(video_path, size, seconds) # æ’­æ”¾éŸ³è½¨ play_audio(video_path) # æ’­æ”¾è§†é¢‘ play_video(video_chars, fps) if __name__ == \"__main__\": main() ç„¶åè¿è¡Œã€‚ã€‚å¹¶ä¸æ˜¯æˆ‘å‘ä½ ï¼Œä½ åªå¬åˆ°äº†å£°éŸ³ï¼Œå´æ²¡çœ‹åˆ°å­—ç¬¦ç”»ã€‚ã€‚åŸå› æ˜¯ï¼š invoke.run()å‡½æ•°æ˜¯é˜»å¡çš„ï¼ŒéŸ³ä¹æ²¡æ”¾å®Œï¼Œä»£ç å°±åˆ°ä¸äº†play_video(video_chars, fps)è¿™ä¸€è¡Œã€‚ æ‰€ä»¥ play_audio è¿˜è¦æ”¹ä¸€ä¸‹ï¼Œæ”¹æˆè¿™æ ·ï¼š python import invoke from threading import Thread def play_audio(video_path): def call(): invoke.run(f\"mpv --no-video {video_path}\", hide=True, warn=True) # è¿™é‡Œåˆ›å»ºå­çº¿ç¨‹æ¥æ‰§è¡ŒéŸ³ä¹æ’­æ”¾æŒ‡ä»¤ï¼Œå› ä¸º invoke.run() æ˜¯ä¸€ä¸ªé˜»å¡çš„æ–¹æ³•ï¼Œè¦åŒæ—¶æ’­æ”¾å­—ç¬¦ç”»å’ŒéŸ³ä¹çš„è¯ï¼Œå°±è¦ç”¨å¤šçº¿ç¨‹/è¿›ç¨‹ã€‚ # P.S. æ›´æ–°ï¼šç°åœ¨å‘ç°å¯ä»¥ç”¨ subprocess.Popen å®ç°å¼‚æ­¥è°ƒç”¨ mpvï¼Œä¸éœ€è¦å¼€æ–°çº¿ç¨‹ã€‚æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è‡ªå·±è¯•è¯•ã€‚ p = Thread(target=call) p.setDaemon(True) p.start() è¿™é‡Œä½¿ç”¨æ ‡å‡†åº“çš„ threading.Thread ç±»æ¥åˆ›å»ºå­çº¿ç¨‹ï¼Œè®©éŸ³ä¹çš„æ’­æ”¾åœ¨å­çº¿ç¨‹é‡Œæ‰§è¡Œï¼Œç„¶åå­—ç¬¦åŠ¨ç”»è¿˜æ˜¯ä¸»çº¿ç¨‹æ‰§è¡Œï¼ŒOkï¼Œè¿™å°±å¯ä»¥çœ‹åˆ°æœ€ç»ˆæ•ˆæœäº†ã€‚å®é™…ä¸Šåªæ·»åŠ äº†åå¤šè¡Œä»£ç è€Œå·²ã€‚ ","date":"2018-05-25","objectID":"/posts/video2chars-2/:0:3","series":null,"tags":[],"title":"Python è§†é¢‘è½¬å­—ç¬¦åŠ¨ç”»ï¼ˆäºŒï¼‰è¿›é˜¶","uri":"/posts/video2chars-2/#2-å­—ç¬¦è§†é¢‘å’ŒéŸ³ä¹åŒæ—¶æ’­æ”¾"},{"categories":["tech"],"content":" 3. å½©è‰²å­—ç¬¦åŠ¨ç”» html+javascript æ–¹å¼ï¼šæ ¸å¿ƒéƒ½æ˜¯ä¸€æ ·çš„å†…å®¹ï¼Œåªæ˜¯éœ€è¦ç‚¹ html å’Œ javascript çš„çŸ¥è¯†ã€‚ä»£ç è§video2chars-html ç”»å¸ƒæ–¹å¼ï¼šç›´æ¥æŠŠç”»åœ¨å›¾ç‰‡ä¸Šï¼Œç„¶åè‡ªåŠ¨åˆæˆä¸º mp4 æ–‡ä»¶ã€‚è¿™ç§æ–¹å¼è¦ä¼˜äº html æ–¹å¼ï¼Œè€Œä¸”æœ‰ä¸ªå¾ˆæ–¹ä¾¿çš„åº“èƒ½ç”¨ï¼Œæ ¸å¿ƒä»£ç å°± 70 è¡Œçš„æ ·å­ã€‚ä»£ç è§video2chars ","date":"2018-05-25","objectID":"/posts/video2chars-2/:0:4","series":null,"tags":[],"title":"Python è§†é¢‘è½¬å­—ç¬¦åŠ¨ç”»ï¼ˆäºŒï¼‰è¿›é˜¶","uri":"/posts/video2chars-2/#3-å½©è‰²å­—ç¬¦åŠ¨ç”»"},{"categories":["tech"],"content":" å‚è€ƒ Pythonå°†è§†é¢‘è½¬æ¢ä¸ºå…¨å­—ç¬¦è§†é¢‘ï¼ˆå«éŸ³é¢‘ï¼‰ ","date":"2018-05-25","objectID":"/posts/video2chars-2/:0:5","series":null,"tags":[],"title":"Python è§†é¢‘è½¬å­—ç¬¦åŠ¨ç”»ï¼ˆäºŒï¼‰è¿›é˜¶","uri":"/posts/video2chars-2/#å‚è€ƒ"},{"categories":["life"],"content":"å¯¹æˆ‘è€Œè¨€ï¼Œå­¦è‹±è¯­æ˜¯ä¸€ä»¶æŒºç—›è‹¦çš„äº‹ã€‚ä»åˆä¸­å¼€å§‹å­¦è‹±æ–‡ï¼Œå¯ä»æ¥ä¸è§‰å¾—å®ƒæœ‰è¶£ï¼Œä¸»åŠ¨æ€§ä¹Ÿå°±ä¸å¼ºã€‚ ç›´åˆ°æˆ‘å¼€å§‹å­¦è®¡ç®—æœºï¼Œæˆ‘å¼€å§‹è®¤è¯†åˆ°è‹±æ–‡æ˜¯ä¸å¯é¿å…çš„ã€‚äºæ˜¯å°è¯•äº†å¾ˆå¤šæ–¹æ³•ã€‚ æœ€æ™®éçš„æ–¹å¼ï¼šèƒŒå•è¯ï¼Œå¯æˆ‘ä»åˆä¸­èƒŒåˆ°ç°åœ¨ï¼ŒèƒŒå•è¯çš„è®¡åˆ’ä»æ²¡å“ªæ¬¡åšæŒè¶…è¿‡ä¸€ä¸ªæœˆçš„ã€‚ åæ¥å¬è¯´çœ‹è‹±æ–‡åŸç‰ˆä¹¦æœ‰æ•ˆï¼Œä¿¡å¿ƒæ»¡æ»¡ï¼Œç»“æœä¹Ÿæ˜¯çœ‹äº†ä¸€æ˜ŸæœŸ Harry Potterï¼Œç¨å¾®çœ‹äº†ç‚¹ Animal Farmï¼Œå°±æ²¡åç»­äº†ã€‚ åˆæƒ³ç»ƒå¬åŠ›ï¼Œå¼€å§‹å¬ ESLPodã€EnglishPodï¼Œä¹Ÿå°±å¬äº†ä¸€ä¸ªæœˆçš„æ—¶é—´ã€‚ã€‚ ä¹‹ååˆè·Ÿç€ç»ƒä¹ è‹±è¯­å£è¯­çš„åŠæ³• - æ¶é­”å¥¶çˆ¸çš„è§„åˆ’ç»ƒå£è¯­ï¼Œå¬å®Œäº†ã€Šèµ–ä¸–é›„ç¾è¯­éŸ³æ ‡ã€‹ï¼Œåˆçœ‹äº†ç‚¹ç¾å›½çš„å£è¯­çº æ­£è§†é¢‘ã€‚è¿™ä»¶äº‹å¹²å¾—å€’è¿˜ç®—å¯ä»¥ï¼Œå£è¯­çš„ç¡®æ ‡å‡†äº†ä¸å°‘ã€‚ä¸è¿‡ä¹Ÿå°±èŠ±äº†åå¤šå¤©ï¼Œå°±æ²¡ç„¶åäº†ã€‚ æˆ‘å­¦è®¡ç®—æœºçš„è¿‡ç¨‹ï¼Œå’Œæˆ‘çš„è‹±æ–‡å­¦ä¹ è¿‡ç¨‹ä¹Ÿæœ‰ä¸å°‘é‡åˆçš„åœ°æ–¹ã€‚ å°è±¡ä¸­ç¬¬ä¸€æ¬¡è¯»è‹±æ–‡èµ„æ–™ï¼Œæ˜¯æƒ³å­¦è®¡ç®—æœºå›¾å½¢å­¦ï¼Œè¢«çŸ¥ä¹ä¸Šçš„é«˜æ‰‹ä»¬æ¨èçœ‹ä¸€ä¸ªè‹±æ–‡æ•™ç¨‹ã€‚æ­»å—‘äº†ä¸‰å¤©ï¼ŒåšæŒä¸ä¸‹å»æ”¾å¼ƒäº†ã€‚ã€‚ ä¹‹åå¬äº†å­£ç´¢æ¸…å­¦é•¿çš„æ¨èï¼Œåˆè§çŸ¥ä¹ä¸Šä¹Ÿéƒ½è¯´ Python å¥½ï¼Œå°±å¼€å§‹å­¦ Pythonã€‚çœ‹äº† A Byte of Python, å°è±¡ä¸­èŠ±äº†ä¸€å¤©çœ‹å®Œçš„ï¼Œä½†æ˜¯æ²¡åœ¨è„‘å­é‡Œç•™ä¸‹å•¥å°è±¡ã€‚ åæ¥æ…¢æ…¢çš„å¼€å§‹ç†Ÿæ‚‰ Pythonï¼Œåœ¨å›¾ä¹¦é¦†å€Ÿäº† Head First Python è‹±æ–‡ç‰ˆï¼Œå¯èƒ½æ˜¯è¢«åšåº¦å“åˆ°äº†ï¼Œçœ‹äº†å‡ é¡µå°±ä¸äº†äº†ä¹‹äº†ã€‚ã€‚ å†åæ¥ç”¨ Githubï¼ŒPycharm IDEA ä¹Ÿæ˜¯è‹±æ–‡çš„ï¼ŒPython Docs å’Œ Java Docs ä¹Ÿå…¨æ˜¯è‹±æ–‡çš„ï¼Œæ ‡å‡†åº“é‡Œçš„æ³¨é‡Šæ˜¯è‹±æ–‡çš„ï¼ŒError ä¿¡æ¯æ˜¯è‹±æ–‡çš„â€¦â€¦ è™½ç„¶å­¦å•¥éƒ½åŠé€”è€ŒåºŸï¼Œä½†è‹±æ–‡æ°´å¹³çš„ç¡®æ˜¯æ…¢æ…¢åœ°æå‡ç€ã€‚ æ…¢æ…¢åœ°ï¼Œèƒ½å¤Ÿä¸æ€ä¹ˆåƒåŠ›åœ°çœ‹æ‡‚ Python æ ‡å‡†åº“äº†ï¼Œæœ‰é—®é¢˜ä¹Ÿå¯ä»¥çœ‹è‹±æ–‡åšå®¢è§£å†³äº†ã€‚ æœ€è¿‘çœ‹ä¸€ä¸ªåŠ¨æ¼«çœ‹å®Œä¸è¿‡ç˜¾ï¼Œè½¬å»çœ‹è¿™éƒ¨åŠ¨æ¼«çš„è½»å°è¯´ã€‚è½»å°è¯´ä¸­æ–‡ç¿»è¯‘çš„å¤ªå‘†æ¿ï¼Œå‘ç°å±…ç„¶æœ‰è‹±æ–‡çš„ï¼Œç›´æ¥å•ƒèµ·äº†è‹±æ–‡ã€‚ æ¢äº†å¥½å‡ éƒ¨å°è¯´ï¼Œç°åœ¨åœ¨çœ‹Grimgar of Fantasy and Ashã€Tasogare-iro no Uta Tsukai(é»„æ˜è‰²ã®è© ä½¿ã„)ï¼Œ è¿˜æ‰¾äº†ä¸ªè‹±æ–‡åŠ¨æ¼«ç½‘ç«™ï¼Œé¢‡æœ‰ä»¥åçœ‹åŠ¨æ¼«ä¹Ÿåªçœ‹è‹±æ–‡å­—å¹•çš„æ‰“ç®—ã€‚å¸Œæœ›èƒ½æŒç»­ä¸‹å»å§ã€‚ ä¸è¿‡ä¹Ÿæœ‰ç‚¹è‹¦æ¼ï¼Œå› ä¸ºæš‘å‡å°±è¦æ‰¾å·¥ä½œï¼Œç°åœ¨å´æ²‰è¿·çœ‹è‹±æ–‡å°è¯´ã€‚ã€‚æœ¬æ¥è¿™ä¸ªæœˆè¯¥å­¦ç®—æ³•çš„ï¼Œå¯åŠä¸ªæœˆéƒ½è¿‡äº†ï¼Œæˆ‘çš„è¿›åº¦å¤§æ¦‚æ‰è®¤çœŸçš„æ—¶å€™çš„äº”å¤©çš„æ ·å­ã€‚ã€‚çœŸä¸çŸ¥é“æœªæ¥ä¼šæ˜¯å•¥æ ·ã€‚ ","date":"2018-05-16","objectID":"/posts/learning-english/:0:0","series":null,"tags":["è‹±è¯­","è¯­è¨€å­¦ä¹ "],"title":"å­¦è‹±è¯­å•Šå­¦è‹±è¯­","uri":"/posts/learning-english/#"},{"categories":["ä¹¦è—‰","å½±è§†","life"],"content":"çœ‹å®Œäº†åŠ¨ç”»ï¼Œä¹Ÿçœ‹äº†ç‚¹å°è¯´ã€‚æœ€æ•¬ä½©ã€æœ€å–œæ¬¢ã€æœ€å‘å¾€çš„äººç‰©æ˜¯ç æ™¶ï¼Œä¹Ÿå°±æ˜¯ä¾›ç‹ã€‚èƒ½æ„Ÿè§‰å¾—åˆ°å¥¹æ˜¯æ‰€æœ‰è§’è‰²ä¸­ï¼Œæœ€è‡ªä¿¡ã€æ–¹å‘æœ€æ˜ç¡®çš„ï¼Œè€Œä¸”å¥¹æ€è€ƒä¸€ç›´æ¯”è¾ƒç†æ€§ã€‚èº«ä¸ºå¯Œå•†ä¹‹å¥³ï¼Œå¹´ä»…åäºŒï¼Œå´èƒ½æ‹¥æœ‰è¶…å‡ºæ‰€æœ‰å›½æ°‘çš„è§‰æ‚Ÿï¼Œã€Œæ—¢ç„¶å¤§äººä»¬æ²¡æœ‰å‹‡æ°”ï¼Œé‚£å°±ç”±æˆ‘å»å½“ç‹ï¼ã€ï¼Œå¹¶æœ€ç»ˆç§°ç‹ï¼Œä¸å¾—ä¸æ•¬ä½©ã€‚å¥¹æœ‰å¥è®©äººéš¾ä»¥å¿˜å´çš„å°è¯ï¼Œã€Œæˆ‘ä¹‹æ‰€ä»¥èƒ½è¿‡ç€æ¯”åˆ«äººæ›´å¥½çš„ç”Ÿæ´»ï¼Œæ˜¯å› ä¸ºæˆ‘æ‹…è´Ÿäº†ç›¸æ¯”æ›´æ²‰é‡çš„è´£ä»»ã€‚å¦‚æœæ²¡èƒ½å®Œæˆç›¸åº”çš„ä½¿å‘½ï¼Œæˆ‘å°±ä¼šåƒå³°ç‹ä¸€æ ·è¢«ç æ‰è„‘è¢‹ã€‚è€Œç¥¥ç¼æ²¡æœ‰è®¤è¯†åˆ°è¿™ä¸€ç‚¹ï¼Œå¥¹ä¸æƒ³æ‹…è´Ÿè´£ä»»ï¼Œå´è§‰å¾—è‡ªå·±åº”è¯¥äº«å—è£åå¯Œè´µã€‚ã€ å…¶æ¬¡å°±æ˜¯ã€Œä¸“èŒå¿ƒç†æ²»ç–—ã€çš„ä¹ä¿Šå°è€é¼ äº†ï¼Œæˆ‘ç®€ç›´æœ‰ç‚¹æ€€ç–‘å­˜ä¸å­˜åœ¨è¿™æ ·å¯æ•¬çš„è€é¼ (åºŸè¯)ã€‚ä¹ä¿Šæˆç†Ÿå¾—ä¸é€‚åˆå½“ä¸»è§’ï¼Œå‡ ä¹æ— å¯æŒ‘å‰”ï¼Œå¤§æ¦‚ä¹Ÿå› æ­¤è€Œæˆä»½ä¸å¤šã€‚ è€ŒèŠ±äº†å¤§ç¯‡å¹…æå†™çš„åº†ä¸œå›½çš„æ™¯ç‹ï¼Œè¿˜æœ‰ä¸€è·¯èµ°æ¥çš„ç¥¥ç¼å’Œé“ƒã€æ›´å¤œè¿˜æœ‰æ³°éº’ï¼Œä»–ä»¬ä¸€åº¦è¿·å¤±æ‰äº†è‡ªæˆ‘ï¼Œè™½ç„¶ä½œä¸ºç»“æœçš„ä»–ä»¬å®ç°äº†è‡ªæˆ‘æ•‘èµï¼Œä½†æ˜¯è¿™ä¸ªè¿‡ç¨‹æˆ‘å–œæ¬¢ä¸èµ·æ¥ã€‚å¤§æ¦‚å› ä¸ºæˆ‘ä¹Ÿæ˜¯ä¸ªåæ¿€çš„äººå§â€¦â€¦ ç æ™¶é‡åˆ°äº†é¡½ä¸˜ï¼Œæ™¯ç‹å’Œç¥¥ç¼è¢«ä¹ä¿Šæ•‘èµï¼Œé“ƒä¹Ÿæœ‰è‡ªå·±çš„è´µäººï¼Œæ›´å¤œåœ¨æ–¡ç”±è¢«æ€æ—¶ç»ˆäºæ‰¿è®¤äº†è‡ªå·±çš„é”™è¯¯ï¼Œæ³°éº’ä¹Ÿæ˜¯è¢«éº’éºŸä»¬åˆåŠ›æ•‘å›æ¥çš„ã€‚ è°éƒ½ä¸å¯èƒ½åªæ´»åœ¨è‡ªå·±çš„ä¸–ç•Œï¼Œå°±èƒ½å¾—åˆ°æ•‘èµã€‚(è¿™æ ·å°±åˆå¾—åˆ°äº†ä¸€ä¸ªå’ŒåˆºçŒ¬çš„ä¼˜é›…ç±»ä¼¼çš„ç»“è®ºâ€¦) ","date":"2018-04-27","objectID":"/posts/the-twelve-kingdoms/:0:0","series":null,"tags":["è¯»åæ„Ÿ","è§‚åæ„Ÿ","åŠ¨æ¼«"],"title":"ã€ŠåäºŒå›½è®°ã€‹","uri":"/posts/the-twelve-kingdoms/#"},{"categories":["tech"],"content":" ä¸€ã€charAt ä¸ codePointAtæˆ‘ä»¬çŸ¥é“ Java å†…éƒ¨ä½¿ç”¨çš„æ˜¯ utf-16 ä½œä¸ºå®ƒçš„ charã€String çš„å­—ç¬¦ç¼–ç æ–¹å¼ï¼Œè¿™é‡Œæˆ‘ä»¬å«å®ƒå†…éƒ¨å­—ç¬¦é›†ã€‚è€Œ utf-16 æ˜¯å˜é•¿ç¼–ç ï¼Œä¸€ä¸ªå­—ç¬¦çš„ç¼–ç è¢«ç§°ä¸ºä¸€ä¸ª code pointï¼Œå®ƒå¯èƒ½æ˜¯ 16 ä½ â€”â€” ä¸€ä¸ª code unitï¼Œä¹Ÿå¯èƒ½æ˜¯ 32 ä½ â€”â€” ä¸¤ä¸ª code unitã€‚Java çš„ char ç±»å‹é•¿åº¦ä¸ºäºŒå­—èŠ‚ï¼Œå®ƒå¯¹åº”çš„æ˜¯ code unitã€‚æ¢å¥è¯è¯´ï¼Œä¸€ä¸ªå­—ç¬¦çš„ç¼–ç ï¼Œå¯èƒ½éœ€è¦ç”¨ä¸¤ä¸ª char æ¥å­˜å‚¨ã€‚ ä½œä¸ºä¸€ä¸ªè¾“å…¥æ³•çˆ±å¥½è€…ï¼Œæˆ‘å¶å°”ä¼šç¼–ç¨‹å¤„ç†ä¸€äº›ç”Ÿåƒ»å­—ã€‚å…¶ä¸­æœ‰äº›ç”Ÿåƒ»å­—å¤§æ¦‚æ˜¯åæ¥æ‰åŠ å…¥ unicode å­—ç¬¦é›†é‡Œçš„ï¼Œç›´æ¥ç”¨ charAt æ–¹æ³•è¯»å–å®ƒä»¬ï¼Œä¼šå¾—åˆ°ä¸€å †é—®å·ã€‚åŸå› å¾ˆæ¸…æ¥š â€”â€” å› ä¸ºè¿™äº›å­—ç¬¦ï¼ˆeg.â€œğ«–¯â€ï¼‰æ˜¯ç”¨ä¸¤ä¸ª code unitï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ª char è¡¨ç¤ºçš„ã€‚charAt æ‰¾ä¸åˆ°å¯¹åº”çš„ç¼–ç ï¼Œå°±ä¼šå°†è¿™äº› char è¾“å‡ºæˆã€Œ?ã€ã€‚ java //ç¤ºä¾‹ public class Test { public static void main(String[] args){ String s = \"ğ«–¯\"; System.out.println(s.length()); //è¾“å‡ºï¼š2 System.out.println(s.charAt(0)); //è¾“å‡ºï¼š? System.out.println(s.charAt(1)); //è¾“å‡ºï¼š? } } å› æ­¤ï¼Œæ¶‰åŠåˆ°ä¸­æ–‡ï¼Œä¸€å®šè¦ä½¿ç”¨ String è€Œä¸æ˜¯ charï¼Œå¹¶ä¸”ä½¿ç”¨ codePoint ç›¸å…³æ–¹æ³•æ¥å¤„ç†å®ƒã€‚å¦åˆ™çš„è¯ï¼Œå¦‚æœç”¨æˆ·ä½¿ç”¨äº†ç”Ÿåƒ»å­—ï¼Œå¾ˆå¯èƒ½å°±ä¼šå¾—åˆ°ä¸æƒ³è¦çš„ç»“æœã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ codePoint éå†ä¸€ä¸ªå­—ç¬¦ä¸²çš„ç¤ºä¾‹ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒcodePoint æ˜¯ int ç±»å‹çš„ï¼ˆå› ä¸º char ä¸è¶³ä»¥ä¿å­˜ä¸€ä¸ª codepointï¼‰ï¼Œå› æ­¤éœ€è¦åšäº›é¢å¤–çš„è½¬æ¢ï¼š java public class Test { public static void main(String[] args){ String s = \"èµµå­Ÿğ«–¯å­Ÿ\"; for (int i = 0; i \u003c s.codePointCount(0,s.length()); i++) { System.out.println( new String(Character.toChars(s.codePointAt(i)))); // è¿™é‡Œçš„è½¨è¿¹æ˜¯ï¼šç±»å‹ä¸º int çš„ codepoint -\u003e charæ•°ç»„ -\u003e String } } } /* ç»“æœï¼š èµµ å­Ÿ ğ«–¯ ? */ é—®é¢˜æ¥äº†ï¼Œã€Œğ«–¯ã€è¿™ä¸ªå­—æ˜¯æ­£å¸¸åœ°è¾“å‡ºäº†ï¼Œå¯æœ€åçš„ã€Œå­Ÿã€å´å˜æˆäº†é»‘äººé—®å·ã€‚ã€‚åŸå› å°±åœ¨äº codepointAt(i) æ˜¯ä»¥ char åç§»é‡ç´¢å¼•çš„ã€‚ã€‚æ‰€ä»¥åªæ˜¯è¿™æ ·è¾“å‡ºä¹Ÿæ˜¯ä¸è¡Œçš„ã€‚ã€‚ æ­£ç¡®çš„éå†å§¿åŠ¿æ˜¯è¿™æ ·çš„ java final int length = s.length(); for (int offset = 0; offset \u003c length; ) { final int codepoint = s.codePointAt(offset); System.out.println(new String(Character.toChars(codepoint))); offset += Character.charCount(codepoint); } è¿™ä¸ªä»£ç ä¿æŒäº†ä¸€ä¸ªå˜é‡offset, æ¥æŒ‡ç¤ºä¸‹ä¸€ä¸ª codepoint çš„åç§»é‡ã€‚æœ€åé‚£ä¸€å¥åœ¨å¤„ç†å®Œæ¯•åï¼Œæ›´æ–°è¿™ä¸ªåç§»é‡ è€Œ Java 8 æ·»åŠ äº†CharSequence#codePointsï¼Œ è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ª IntStreamï¼Œè¯¥æµåŒ…å«æ‰€æœ‰çš„ codepointã€‚å¯ä»¥ç›´æ¥é€šè¿‡ forEach æ–¹æ³•æ¥éå†ä»–ã€‚ java string.codePoints().forEach( c -\u003e System.out.println(new String(Character.toChars(c))); ); æˆ–è€…ç”¨å¾ªç¯ java for(int c : string.codePoints().toArray()){ System.out.println(new String(Character.toChars(c))); } ","date":"2018-03-11","objectID":"/posts/how-java-handles-chinese/:0:1","series":null,"tags":["Java","å­—ç¬¦é›†","å­—ç¬¦ç¼–ç "],"title":"Java ä¸­æ–‡ç¼–ç åˆ†æ","uri":"/posts/how-java-handles-chinese/#ä¸€charat-ä¸-codepointat"},{"categories":["tech"],"content":" äºŒã€å†…éƒ¨å­—ç¬¦é›†ä¸è¾“å‡ºå­—ç¬¦é›†ï¼ˆå†…ç ä¸å¤–ç ï¼‰ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†ä¸­æ–‡å­—ç¬¦åœ¨ java å†…éƒ¨å¯èƒ½ä¼šä¿å­˜æˆä¸¤ä¸ª charï¼Œå¯è¿˜æœ‰ä¸ªé—®é¢˜ï¼šå¦‚æœæˆ‘æŠŠä¸€ä¸ªå­—ç¬¦è¾“å‡ºåˆ°æŸä¸ªæµï¼Œå®ƒè¿˜ä¼šæ˜¯ä¸¤ä¸ª charï¼Œä¹Ÿå°±æ˜¯ 4 å­—èŠ‚ä¹ˆï¼Ÿå›æƒ³ä¸€ä¸‹ï¼ŒJava io æœ‰å­—ç¬¦æµï¼Œå­—ç¬¦æµä½¿ç”¨ jvm é»˜è®¤çš„å­—ç¬¦é›†è¾“å‡ºï¼Œè€Œè‹¥è¦æŒ‡å®šå­—ç¬¦é›†ï¼Œå¯ä½¿ç”¨è½¬æ¢æµã€‚å› æ­¤ï¼Œä¸€ä¸ªä¸­æ–‡å­—ç¬¦ï¼Œåœ¨å†…éƒ¨æ˜¯ä½¿ç”¨ utf-16 è¡¨ç¤ºï¼Œå¯è¾“å‡ºå°±ä¸ä¸€å®šäº†ã€‚æ¥çœ‹ä¸ªç¤ºä¾‹ï¼š java import java.io.UnsupportedEncodingException; public class Test { public static void main(String[] args) throws UnsupportedEncodingException { String s = \"ä¸­\"; //ğ«–¯ System.out.println(s + \": chars: \" + s.length()); System.out.println(s + \": utf-8 bytes:\" + s.getBytes(\"utf-8\").length); System.out.println(s + \": unicode bytes: \" + s.getBytes(\"unicode\").length); System.out.println(s + \": utf-16 bytes: \" + s.getBytes(\"utf-16\").length); } } è¾“å‡ºä¸ºï¼š text ä¸­: chars: 1 // 2 bytes ä¸­: utf-8 bytes:3 ä¸­: unicode bytes: 4 ä¸­: utf-16 bytes: 4 ğ«–¯: chars: 2 // 4 bytes ğ«–¯: utf-8 bytes:4 ğ«–¯: unicode bytes: 6 ğ«–¯: utf-16 bytes: 6 ä¸€ä¸ªã€Œä¸­ã€å­—ï¼Œå†…éƒ¨å­˜å‚¨åªç”¨äº†ä¸€ä¸ª charï¼Œä¹Ÿå°±æ˜¯ 2 ä¸ªå­—èŠ‚ã€‚å¯è½¬æ¢æˆ utf-8 ç¼–ç åï¼Œå´ç”¨äº† 3 ä¸ªå­—èŠ‚ã€‚æ€ä¹ˆä¼šä¸ä¸€æ ·å‘¢ï¼Œæ˜¯ä¸æ˜¯ç¨‹åºå‡ºäº†é—®é¢˜ï¼Ÿå½“ç„¶ä¸æ˜¯ç¨‹åºçš„é—®é¢˜ï¼Œè¿™æ˜¯å†…ç (utf-16)è½¬æ¢æˆå¤–ç  (utf-8)ï¼Œå­—ç¬¦é›†å‘ç”Ÿäº†æ”¹å˜ï¼Œæ‰€ä½¿ç”¨çš„å­—èŠ‚æ•°è‡ªç„¶ä¹Ÿå¯èƒ½ä¼šæ”¹å˜ã€‚ï¼ˆå°¤å…¶è¿™ä¿©å­—ç¬¦é›†è¿˜éƒ½æ˜¯å˜é•¿ç¼–ç ï¼‰ ","date":"2018-03-11","objectID":"/posts/how-java-handles-chinese/:0:2","series":null,"tags":["Java","å­—ç¬¦é›†","å­—ç¬¦ç¼–ç "],"title":"Java ä¸­æ–‡ç¼–ç åˆ†æ","uri":"/posts/how-java-handles-chinese/#äºŒå†…éƒ¨å­—ç¬¦é›†ä¸è¾“å‡ºå­—ç¬¦é›†å†…ç ä¸å¤–ç "},{"categories":["tech"],"content":" ä¸‰ã€utf-16ã€utf-16leã€utf-16beã€bomä¸çŸ¥é“åœ¨åˆšåˆšçš„ç¤ºä¾‹ä¸­ï¼Œä½ æœ‰æ²¡æœ‰å‘ç°é—®é¢˜ï¼šåŒæ˜¯ utf-16ï¼Œä¸ºä½•ã€Œä¸­ã€å’Œã€Œğ«–¯ã€çš„s.getBytes(\"utf-16\").length æ¯” s.length è¦å¤šä¸ª 2ï¼Ÿå¼€å¤´å°±è¯´äº† String ä¹Ÿæ˜¯ utf-16 ç¼–ç çš„ï¼Œè¿™ä¸¤ä¸ªæ•°åº”è¯¥ç›¸ç­‰æ‰å¯¹ä¸æ˜¯å—ï¼ŸåŸå› åœ¨äºï¼Œutf-16 ä»¥ 16 ä½ä¸ºå•ä½è¡¨ç¤ºæ•°æ®ï¼Œè€Œè®¡ç®—æœºæ˜¯ä»¥å­—èŠ‚ä¸ºåŸºæœ¬å•ä½æ¥å­˜å‚¨/è¯»å–æ•°æ®çš„ã€‚å› æ­¤ä¸€ä¸ª utf-16 çš„ code unit ä¼šè¢«å­˜å‚¨ä¸ºä¸¤ä¸ªå­—èŠ‚ï¼Œéœ€è¦æ˜ç¡®æŒ‡æ˜è¿™ä¸¤ä¸ªå­—èŠ‚çš„å…ˆåé¡ºåºï¼Œè®¡ç®—æœºæ‰èƒ½æ­£ç¡®åœ°æ‰¾å‡ºå®ƒå¯¹åº”çš„å­—ç¬¦ã€‚è€Œ utf-16 æœ¬èº«å¹¶æ²¡æœ‰æŒ‡å®šè¿™äº›ï¼Œæ‰€ä»¥å®ƒä¼šåœ¨å­—ç¬¦ä¸²å¼€å¤´æ’å…¥ä¸€ä¸ªä¸¤å­—èŠ‚çš„æ•°æ®ï¼Œæ¥å­˜å‚¨è¿™äº›ä¿¡æ¯ï¼ˆå¤§ç«¯è¿˜æ˜¯å°ç«¯ï¼‰ã€‚è¿™ä¸¤ä¸ªå­—èŠ‚è¢«ç§°ä¸º BOMï¼ˆByte Order Markï¼‰ã€‚åˆšåˆšå‘ç°çš„å¤šå‡ºçš„ä¸¤å­—èŠ‚å°±æ˜¯è¿™ä¹ˆæ¥çš„ã€‚å¦‚æœä½ æŒ‡å®šç¼–ç ä¸º utf-16le æˆ– utf-16beï¼Œå°±ä¸ä¼šæœ‰è¿™ä¸ª BOM çš„å­˜åœ¨äº†ã€‚è¿™æ—¶å°±éœ€è¦ä½ è‡ªå·±è®°ä½è¯¥æ–‡ä»¶çš„å¤§å°ç«¯ã€‚ã€‚ ","date":"2018-03-11","objectID":"/posts/how-java-handles-chinese/:0:3","series":null,"tags":["Java","å­—ç¬¦é›†","å­—ç¬¦ç¼–ç "],"title":"Java ä¸­æ–‡ç¼–ç åˆ†æ","uri":"/posts/how-java-handles-chinese/#ä¸‰utf-16utf-16leutf-16bebom"},{"categories":["tech"],"content":" å››ã€æ›´å¤šï¼šutf-8 unicode åœ¨ windows ä¸­ï¼Œutf-8 æ ¼å¼çš„æ–‡ä»¶ä¹Ÿå¯èƒ½ä¼šå¸¦æœ‰ BOMï¼Œä½† utf-8 çš„åŸºæœ¬å•ä½æœ¬æ¥å°±æ˜¯ä¸€ä¸ªå­—èŠ‚ï¼Œ å› æ­¤å®ƒä¸éœ€è¦ BOM æ¥è¡¨ç¤º æ‰€è°“å¤§å°ç«¯ã€‚è¿™ä¸ª BOM ä¸€èˆ¬æ˜¯ç”¨æ¥è¡¨ç¤ºè¯¥æ–‡ä»¶æ˜¯ä¸€ä¸ª utf-8 æ–‡ä»¶ã€‚ä¸è¿‡ linux ç³»ç»Ÿåˆ™å¯¹è¿™ç§å¸¦ BOM çš„æ–‡ä»¶ä¸å¤ªå‹å¥½ã€‚ä¸èˆ¬ä¸å»ºè®®åŠ ã€‚ã€‚ï¼ˆè™½å¦‚æ­¤è¯´ï¼Œä¸Šé¢çš„æµ‹è¯•ä¸­ï¼Œutf-8 çš„æ•°æ®åº”è¯¥æ˜¯æ²¡åŠ  bom çš„ç»“æœï¼‰ unicodeå­—ç¬¦é›†UCSï¼ˆUnicode Character Setï¼‰ å°±æ˜¯ä¸€å¼ åŒ…å«å…¨ä¸–ç•Œæ‰€æœ‰æ–‡å­—çš„ä¸€ä¸ªç¼–ç è¡¨ï¼Œä½†æ˜¯ UCS å¤ªå å†…å­˜äº†ï¼Œæ‰€ä»¥å®é™…ä½¿ç”¨åŸºæœ¬éƒ½æ˜¯ä½¿ç”¨å®ƒçš„å…¶ä»–å˜ä½“ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒæŒ‡å®šå­—ç¬¦é›†æ—¶ä½¿ç”¨çš„ unicode åŸºæœ¬ç­‰åŒäº utf-16.ï¼ˆæ‰€ä»¥ä½ ä¼šå‘ç°ç¬¬äºŒèŠ‚æ¼”ç¤ºçš„å°ç¨‹åºé‡Œï¼Œutf-16 å’Œ unicode å¾—å‡ºçš„ç»“æœæ˜¯ä¸€æ ·çš„ã€‚ï¼‰ ","date":"2018-03-11","objectID":"/posts/how-java-handles-chinese/:0:4","series":null,"tags":["Java","å­—ç¬¦é›†","å­—ç¬¦ç¼–ç "],"title":"Java ä¸­æ–‡ç¼–ç åˆ†æ","uri":"/posts/how-java-handles-chinese/#å››æ›´å¤šutf-8-unicode"},{"categories":["tech"],"content":" å››ã€ä¸ Python3 å¯¹æ¯”python3 åœ¨å­—ç¬¦ä¸²è¡¨ç¤ºä¸Šï¼Œåšäº†å¤§åˆ€é˜”æ–§çš„æ”¹é©ï¼Œpython3 çš„ len(str) å¾—åˆ°çš„å°±æ˜¯ unicode å­—ç¬¦æ•°ï¼Œå› æ­¤ç¨‹åºå‘˜å®Œå…¨ä¸éœ€è¦å»è€ƒè™‘å­—ç¬¦çš„åº•å±‚è¡¨ç¤ºçš„é—®é¢˜ã€‚ï¼ˆå®é™…ä¸Šå…¶å†…éƒ¨è¡¨ç¤ºä¹Ÿå¯èƒ½éšç€æ›´æ–°è€Œå˜åŒ–ï¼‰å¸¦ BOM çš„ utf-8 ä¹Ÿå¯é€šè¿‡æŒ‡å®šå­—ç¬¦é›†ä¸º utf-8-sig è§£å†³ã€‚è‹¥éœ€è¦åšå­—ç¬¦é›†å±‚é¢å¤„ç†ï¼Œéœ€è¦ encode ä¸ºç‰¹å®šå­—ç¬¦é›†çš„ byte ç±»å‹ã€‚ Encoding pertains mostly to files and transfers. Once loaded into a Python string, text in memory has no notion of an ã€Œencoding,ã€ and is simply a sequence of Unicode characters (a.k.a. code points) stored generically. -- Learning Python 5th P.S. Python2 å­˜åœ¨å’Œ Java ç›¸åŒçš„é—®é¢˜ ","date":"2018-03-11","objectID":"/posts/how-java-handles-chinese/:0:5","series":null,"tags":["Java","å­—ç¬¦é›†","å­—ç¬¦ç¼–ç "],"title":"Java ä¸­æ–‡ç¼–ç åˆ†æ","uri":"/posts/how-java-handles-chinese/#å››ä¸-python3-å¯¹æ¯”"},{"categories":["tech"],"content":" å‚è€ƒ java è¯­è¨€ä¸­çš„ä¸€ä¸ªå­—ç¬¦å å‡ ä¸ªå­—èŠ‚ï¼Ÿ - RednaxelaFX - çŸ¥ä¹ How can I iterate through the unicode codepoints of a Java String? å½»åº•ææ‡‚å­—ç¬¦ç¼–ç (unicode,mbcs,utf-8,utf-16,utf-32,big endian,little endianâ€¦) Java_å­—ç¬¦ç¼–ç  æœ¬æ–‡å…è®¸è½¬è½½ï¼Œä½†è¦æ±‚é™„ä¸Šæºé“¾æ¥ï¼šJava ä¸­æ–‡ç¼–ç åˆ†æ ","date":"2018-03-11","objectID":"/posts/how-java-handles-chinese/:0:6","series":null,"tags":["Java","å­—ç¬¦é›†","å­—ç¬¦ç¼–ç "],"title":"Java ä¸­æ–‡ç¼–ç åˆ†æ","uri":"/posts/how-java-handles-chinese/#å‚è€ƒ"},{"categories":["tech"],"content":" ä¸ªäººç¬”è®°ï¼Œä¸ä¿è¯æ­£ç¡®ã€‚ ","date":"2018-01-23","objectID":"/posts/process-thread-coroutines-concurrency-parallelism/:0:0","series":null,"tags":["è¿›ç¨‹","çº¿ç¨‹","åç¨‹","å¹¶å‘","å¹¶è¡Œ","Coroutines","Concurrency"],"title":"è¿›ç¨‹çº¿ç¨‹åç¨‹ä¸å¹¶å‘å¹¶è¡Œ","uri":"/posts/process-thread-coroutines-concurrency-parallelism/#"},{"categories":["tech"],"content":" ä¸€ã€è¿›ç¨‹ Processï¼šï¼ˆå¹¶è¡Œè¿ç®—ï¼Œåˆ†å¸ƒå¼ï¼‰æ¯ä¸€ä¸ªè¿›ç¨‹ï¼Œéƒ½å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªå®Œæ•´çš„ Programï¼Œå®ƒæœ‰è‡ªå·±å®Œå…¨ç‹¬ç«‹çš„å†…å®¹ã€‚ä¸ä¸å…¶ä»–è¿›ç¨‹ç›´æ¥å…±äº«æ•°æ®ã€‚ï¼ˆä¸€ä¸ªå·¥ä½œ(job)å¯ä»¥ç”±å¤šä¸ª process å®Œæˆï¼Œä¾‹å¦‚ç”µè„‘ä¸Šçš„qq/360å°±ä¼šæœ‰å¥½å‡ ä¸ªè¿›ç¨‹ï¼Œè¿™ç§ç¨‹åºå¯èƒ½ä¼šæœ‰ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œå½“ä¸»è¿›ç¨‹æŒ‚æ‰ï¼Œå®ƒä¼šè‡ªåŠ¨é‡å¯ä¸»è¿›ç¨‹ã€‚ï¼‰ æ¯ä¸ªè¿›ç¨‹å¯ä»¥ç”±å¤šä¸ªçº¿ç¨‹ç»„æˆã€‚è¿›ç¨‹æŠ½è±¡ç”±æ“ä½œç³»ç»Ÿæä¾›ï¼ŒLinux æ˜¯ä½¿ç”¨ fork å‡½æ•°ï¼ŒWindows æ˜¯ç”¨ CreateProcessã€‚ ","date":"2018-01-23","objectID":"/posts/process-thread-coroutines-concurrency-parallelism/:0:1","series":null,"tags":["è¿›ç¨‹","çº¿ç¨‹","åç¨‹","å¹¶å‘","å¹¶è¡Œ","Coroutines","Concurrency"],"title":"è¿›ç¨‹çº¿ç¨‹åç¨‹ä¸å¹¶å‘å¹¶è¡Œ","uri":"/posts/process-thread-coroutines-concurrency-parallelism/#ä¸€è¿›ç¨‹-processå¹¶è¡Œè¿ç®—åˆ†å¸ƒå¼"},{"categories":["tech"],"content":" äºŒã€çº¿ç¨‹ Threadï¼šï¼ˆå¹¶å‘æ‰§è¡Œï¼‰å±äºåŒä¸€ä¸ªè¿›ç¨‹çš„çº¿ç¨‹ä¹‹é—´ï¼Œæ˜¯å…±äº«ä¸€å¥—å·¥ä½œå†…å®¹çš„ã€‚è¿™ä½¿å¾—çº¿ç¨‹çš„åˆ›å»ºå’Œç§»é™¤å¼€é”€å¾ˆå°ï¼Œä½†åŒæ—¶ä¹Ÿä½¿ç¼–ç¨‹å˜å¾—å¤æ‚ã€‚ å…³äºçº¿ç¨‹ï¼Œåˆ†ç”¨æˆ·çº§çº¿ç¨‹å’Œå†…æ ¸çº§çº¿ç¨‹ã€‚ä¸åŒçš„è¯­è¨€ä¸­ï¼Œè¿™ä¸¤ç§çº¿ç¨‹çš„å¯¹åº”å…³ç³»ä¹Ÿä¸å°½ç›¸åŒã€‚ å¤šå¯¹ä¸€æ¨¡å‹å°†å¤šä¸ªç”¨æˆ·çº§çº¿ç¨‹æ˜ å°„åˆ°ä¸€ä¸ªå†…æ ¸çº§çº¿ç¨‹ï¼Œçº¿ç¨‹ç®¡ç†åœ¨ç”¨æˆ·ç©ºé—´å®Œæˆï¼Œè¿™ç§æ¨¡å‹ä¸‹æ“ä½œç³»ç»Ÿå¹¶ä¸çŸ¥é“å¤šçº¿ç¨‹çš„å­˜åœ¨ã€‚Python å°±æ˜¯è¿™ç§æ¨¡å‹ã€‚ ä¼˜ç‚¹ï¼šçº¿ç¨‹ç®¡ç†æ˜¯åœ¨ç”¨æˆ·ç©ºé—´è¿›è¡Œçš„ï¼Œåˆ‡æ¢ä¸Šä¸‹æ–‡å¼€é”€æ¯”è¾ƒå°ï¼Œæ€§èƒ½è¾ƒé«˜ã€‚ ç¼ºç‚¹ï¼šå½“ä¸€ä¸ªçº¿ç¨‹åœ¨ä½¿ç”¨å†…æ ¸æœåŠ¡æ—¶è¢«é˜»å¡ï¼Œé‚£ä¹ˆæ•´ä¸ªè¿›ç¨‹éƒ½ä¼šè¢«é˜»å¡ï¼›å¤šä¸ªçº¿ç¨‹ä¸èƒ½å¹¶è¡Œåœ°è¿è¡Œåœ¨å¤šå¤„ç†æœºä¸Šã€‚ ä¸€å¯¹ä¸€æ¨¡å‹å°†æ¯ä¸ªç”¨æˆ·çº§çº¿ç¨‹æ˜ å°„åˆ°ä¸€ä¸ªå†…æ ¸çº§çº¿ç¨‹ã€‚Javaçš„çº¿ç¨‹å°±å±äºè¿™ç§æ¨¡å‹ã€‚ ä¼˜ç‚¹ï¼šå½“ä¸€ä¸ªçº¿ç¨‹è¢«é˜»å¡åï¼Œå…è®¸å¦ä¸€ä¸ªçº¿ç¨‹ç»§ç»­æ‰§è¡Œï¼Œæ‰€ä»¥å¹¶å‘èƒ½åŠ›è¾ƒå¼ºï¼›èƒ½å¾ˆå¥½çš„åˆ©ç”¨åˆ° CPUçš„å¤šæ ¸å¿ƒã€‚ ç¼ºç‚¹ï¼šæ¯åˆ›å»ºä¸€ä¸ªç”¨æˆ·çº§çº¿ç¨‹éƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªå†…æ ¸çº§çº¿ç¨‹ä¸å…¶å¯¹åº”ï¼Œè¿™æ ·åˆ›å»ºçº¿ç¨‹çš„å¼€é”€æ¯”è¾ƒå¤§ï¼Œä¼šå½±å“åˆ°åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚å¹¶ä¸”åˆ‡æ¢çº¿ç¨‹è¦è¿›å‡ºå†…æ ¸ï¼Œä»£ä»·æ¯”è¾ƒå¤§ã€‚ å¤šå¯¹å¤šæ¨¡å‹å°†nä¸ªç”¨æˆ·çº§çº¿ç¨‹æ˜ å°„åˆ°mä¸ªå†…æ ¸çº§çº¿ç¨‹ä¸Šï¼Œè¦æ±‚ m \u003c= nã€‚GOï¼ˆ1.5ä¹‹åï¼‰çš„åç¨‹å°±å±äºè¿™ç§çº¿ç¨‹æ¨¡å‹ã€‚ ç‰¹ç‚¹ï¼šæ—¢å…‹æœäº†å¤šå¯¹ä¸€æ¨¡å‹çš„å¹¶å‘åº¦ä¸é«˜çš„ç¼ºç‚¹ï¼Œåˆå…‹æœäº†ä¸€å¯¹ä¸€æ¨¡å‹çš„ä¸€ä¸ªç”¨æˆ·è¿›ç¨‹å ç”¨å¤ªå¤šå†…æ ¸çº§çº¿ç¨‹ï¼Œå¼€é”€å¤ªå¤§çš„ç¼ºç‚¹ã€‚åˆæ‹¥æœ‰å¤šå¯¹ä¸€æ¨¡å‹å’Œä¸€å¯¹ä¸€æ¨¡å‹å„è‡ªçš„ä¼˜ç‚¹ã€‚ ","date":"2018-01-23","objectID":"/posts/process-thread-coroutines-concurrency-parallelism/:0:2","series":null,"tags":["è¿›ç¨‹","çº¿ç¨‹","åç¨‹","å¹¶å‘","å¹¶è¡Œ","Coroutines","Concurrency"],"title":"è¿›ç¨‹çº¿ç¨‹åç¨‹ä¸å¹¶å‘å¹¶è¡Œ","uri":"/posts/process-thread-coroutines-concurrency-parallelism/#äºŒçº¿ç¨‹-threadå¹¶å‘æ‰§è¡Œ"},{"categories":["tech"],"content":" ä¸‰ã€åç¨‹ Coroutineï¼ˆå¹¶å‘æ‰§è¡Œï¼‰å¦‚æœè¯´çº¿ç¨‹æ˜¯è½»é‡çº§çš„è¿›ç¨‹ï¼Œé‚£ä¹ˆåç¨‹å°±æ˜¯è½»é‡çº§çš„çº¿ç¨‹ã€‚çº¿ç¨‹è·‘åœ¨è¿›ç¨‹é‡Œï¼Œåç¨‹å°±è·‘åœ¨çº¿ç¨‹é‡Œã€‚ ä¼˜ç‚¹ï¼š åç¨‹æ˜¯è·‘åœ¨åŒä¸€ä¸ªçº¿ç¨‹é‡Œï¼Œå¹¶ä¸”æ˜¯ç”±ç¨‹åºæœ¬èº«æ¥è°ƒåº¦çš„ã€‚åç¨‹é—´çš„åˆ‡æ¢å°±æ˜¯å‡½æ•°çš„è°ƒç”¨ï¼Œå®Œå…¨æ²¡æœ‰çº¿ç¨‹åˆ‡æ¢é‚£ä¹ˆå¤§çš„å¼€é”€ã€‚ çº¿ç¨‹çš„æ•°é‡è¶Šå¤šï¼Œåç¨‹çš„ä¼˜åŠ¿è¶Šå¤§ å› ä¸ºåç¨‹æ˜¯ç¨‹åºè°ƒåº¦çš„ï¼Œå®ƒå®é™…ä¸Šæ˜¯ä¸²è¡Œè¿è¡Œçš„ï¼Œå› æ­¤ä¸éœ€è¦å¤æ‚çš„é”æœºåˆ¶æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚ åœ¨åç¨‹ä¸­æ§åˆ¶å…±äº«èµ„æºä¸åŠ é”ï¼Œåªéœ€è¦åˆ¤æ–­çŠ¶æ€å°±å¥½äº†ã€‚è¿™å…å»äº†é”æœºåˆ¶å¸¦æ¥çš„å¼€é”€ã€‚ å› ä¸ºåç¨‹è·‘åœ¨å•ä¸ªçº¿ç¨‹å†…ï¼Œæ‰€å ç”¨çš„ CPU èµ„æºæœ‰é™ï¼Œæ‰€ä»¥å¤šåç¨‹å¹¶ä¸èƒ½æå‡è®¡ç®—æ€§èƒ½ã€‚ä¸ä»…å¦‚æ­¤ï¼Œå› ä¸ºå¤šäº†ç¨‹åºæœ¬èº«çš„è°ƒåº¦å¼€é”€ï¼Œè®¡ç®—å¯†é›†å‹ç¨‹åºçš„æ€§èƒ½åè€Œä¼šä¸‹é™ã€‚ æ­¤å¤–ï¼Œåç¨‹ä»£ç ä¸­å†³ä¸èƒ½å‡ºç°é˜»å¡ï¼Œå¦åˆ™æ•´ä¸ªçº¿ç¨‹éƒ½ä¼šåœä¸‹æ¥ç­‰å¾…è¯¥æ“ä½œå®Œæˆï¼Œè¿™å°±éº»çƒ¦äº†ã€‚ åç¨‹é€‚åˆç”¨äº IO å¯†é›†å‹ä»»åŠ¡ï¼Œå¯ç”¨äºç®€åŒ–å¼‚æ­¥ IO çš„ callback hellã€‚ä¾‹å¦‚ Python çš„ asyncio å°±æ˜¯ç”¨åç¨‹å®ç°çš„ã€‚ ","date":"2018-01-23","objectID":"/posts/process-thread-coroutines-concurrency-parallelism/:0:3","series":null,"tags":["è¿›ç¨‹","çº¿ç¨‹","åç¨‹","å¹¶å‘","å¹¶è¡Œ","Coroutines","Concurrency"],"title":"è¿›ç¨‹çº¿ç¨‹åç¨‹ä¸å¹¶å‘å¹¶è¡Œ","uri":"/posts/process-thread-coroutines-concurrency-parallelism/#ä¸‰åç¨‹-coroutineå¹¶å‘æ‰§è¡Œ"},{"categories":["tech"],"content":" å¹¶å‘å¹¶è¡Œç”±æ­¤ï¼Œåˆå¼•å‡ºä¸¤ä¸ªåè¯ï¼š å¹¶å‘ï¼ˆConcurrentï¼‰ï¼šå¤šä¸ªä»»åŠ¡äº¤æ›¿è¿›è¡Œã€‚ å¹¶è¡Œï¼ˆParallelï¼‰ï¼šå¤šä¸ªä»»åŠ¡åŒæ—¶è¿›è¡Œã€‚ ä¸€å¼ å›¾è¯´æ˜ä¸¤è€…çš„å·®åˆ« Noteï¼šè¿›ç¨‹ å’Œ çº¿ç¨‹ éƒ½å¯èƒ½æ˜¯ å¹¶å‘ æˆ– å¹¶è¡Œ çš„ã€‚å…³é”®çœ‹ä½ ç¨‹åºçš„è¿è¡ŒçŠ¶æ€ã€‚å¤šæ ¸æ˜¯å¹¶è¡Œçš„å‰æã€‚å¹¶å‘åˆ™åªè¦æ±‚äº¤æ›¿æ‰§è¡Œï¼Œå› æ­¤å•æ ¸ä¹Ÿæ²¡é—®é¢˜ã€‚ ","date":"2018-01-23","objectID":"/posts/process-thread-coroutines-concurrency-parallelism/:0:4","series":null,"tags":["è¿›ç¨‹","çº¿ç¨‹","åç¨‹","å¹¶å‘","å¹¶è¡Œ","Coroutines","Concurrency"],"title":"è¿›ç¨‹çº¿ç¨‹åç¨‹ä¸å¹¶å‘å¹¶è¡Œ","uri":"/posts/process-thread-coroutines-concurrency-parallelism/#å¹¶å‘å¹¶è¡Œ"},{"categories":["tech"],"content":" åŒæ­¥å¼‚æ­¥ åŒæ­¥ï¼šä¸åŒç¨‹åºå•å…ƒä¸ºäº†å®ŒæˆæŸä¸ªä»»åŠ¡ï¼Œåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­éœ€é æŸç§é€šä¿¡æ–¹å¼ä»¥åè°ƒä¸€è‡´ï¼Œç§°è¿™äº›ç¨‹åºå•å…ƒæ˜¯åŒæ­¥æ‰§è¡Œçš„ã€‚ å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œæ‰€æœ‰ä¿®æ”¹å…±äº«å˜é‡çš„è¡Œä¸ºï¼Œéƒ½å¿…é¡»åŠ é”ï¼Œä¿è¯é¡ºåºæ‰§è¡Œï¼Œä¿è¯åŒæ­¥ã€‚æˆ–è€…åŠ åŸå­é”ï¼Œä¿è¯è¯¥ä¿®æ”¹æ“ä½œæ˜¯åŸå­çš„ã€‚ åŒæ­¥æ„å‘³ç€æœ‰åº å¼‚æ­¥ï¼šä¸ºå®ŒæˆæŸä¸ªä»»åŠ¡ï¼Œä¸åŒç¨‹åºå•å…ƒä¹‹é—´è¿‡ç¨‹ä¸­æ— éœ€é€šä¿¡åè°ƒï¼Œä¹Ÿèƒ½å®Œæˆä»»åŠ¡çš„æ–¹å¼ã€‚ ä¸ç›¸å…³çš„ç¨‹åºå•å…ƒä¹‹é—´å¯ä»¥æ˜¯å¼‚æ­¥çš„ã€‚æ¯”å¦‚çˆ¬è™«ä¸‹è½½ç½‘é¡µ å¼‚æ­¥æ„å‘³ç€æ— åº è¿›ç¨‹ã€çº¿ç¨‹å’Œåç¨‹ ","date":"2018-01-23","objectID":"/posts/process-thread-coroutines-concurrency-parallelism/:0:5","series":null,"tags":["è¿›ç¨‹","çº¿ç¨‹","åç¨‹","å¹¶å‘","å¹¶è¡Œ","Coroutines","Concurrency"],"title":"è¿›ç¨‹çº¿ç¨‹åç¨‹ä¸å¹¶å‘å¹¶è¡Œ","uri":"/posts/process-thread-coroutines-concurrency-parallelism/#åŒæ­¥å¼‚æ­¥"},{"categories":["ä¹¦è—‰","life"],"content":"åº—å°äºŒæ€äº†å·¡ç•Œä½¿ï¼Œç„¶åç¦»äº†å®¢æ ˆï¼Œå…¥äº†é“å¾·å®—ï¼Œåº”äº†ä¸€é”™ç¼˜ï¼Œåˆç»™é“å¾·å®—å¹²äº†ä¸€å †ç ´äº‹ï¼Œæ´»çš„æµ‘æµ‘å™©å™©ã€‚ å—äº†ä¸€å‰‘æ–©ç¼˜åï¼Œæœ¬ä»¥ä¸ºç»ˆäºèƒ½æ±‚å¾—è§£è„±ï¼Œè°çŸ¥é€ åŒ–å¼„äººï¼Œè‡ªå·±ç«Ÿåˆä»åœ°åºœå›å¾—äººç•Œã€‚ æœ¬ä¸€å¿ƒå¤ä»‡ï¼Œä¸´åˆ°å¤´è¿˜æ˜¯æ²¡å¯¹åŸé£ä¸‹å¾—æ€æ‰‹ã€‚ æ¬²ä¸é¡¾æ¸…å†ç»­ç¼˜ï¼Œå´è¢«è¯´ä¸€å¥çœ‹ä¸ç©¿ã€‚ å†æ¬¡é†’æ¥ï¼Œæœ¬æ¬²æ€ä¸Šå¤©ç•Œï¼Œå¯çœ‹åˆ°é’è¡£æ—¶ï¼ŒçŒ›ç„¶é†’æ‚Ÿã€‚ ä»€ä¹ˆç‹å›¾éœ¸ä¸šï¼Œä»€ä¹ˆè¯¸ç•Œç§°é›„ï¼Œä»€ä¹ˆå¤™ä¸–æƒ…ä»‡ï¼Œåœ¨è¿™ä¸€åˆ»ï¼Œçš†åŒ–æµ®äº‘ã€‚çœ¼ä¸­ä¾¿åªæœ‰è¿™ä¸€ä¸–å°˜ç¼˜äº†ã€‚ é’çŸ³ä¸å·¡ç•Œä½¿ï¼Œè¢«å‘½è¿æ‰å¼„ï¼Œè¢«è´¬ä¸‹å‡¡é—´å—ç™¾ä¸–è½®å›ï¼Œä¹åä¹ä¸–ç›¸æ¿¡ä»¥æ²«ï¼Œæœ€åä¸€ä¸–å´æ¨ªç”Ÿæ³¢æŠ˜ã€‚ ç»ˆäºå›å¾—ä»™ç•Œï¼Œç›¸å¯¹å¤§ç¬‘ä¸‰å£°ï¼Œç›¸å¿˜äºæ±Ÿæ¹–ã€‚ ","date":"2017-11-18","objectID":"/posts/fate-of-mortals/:0:0","series":null,"tags":["è¯»åæ„Ÿ","å°è¯´"],"title":"ã€Šå°˜ç¼˜ã€‹","uri":"/posts/fate-of-mortals/#"},{"categories":["life"],"content":" å•Šå•Šï¼Œè¿˜æœ‰åå¤©å°±å¯ä»¥æ‘†è„±è¿™ä¸ªåŸå¸‚ï¼Œå›åˆ°é‚£ä¸ªä»¤äººå®‰å¿ƒçš„å±±æ—é‡Œäº†ï¼Œä¸€è¾¹æœŸå¾…ç€ï¼Œä¸€è¾¹ç„¦èºç€ï¼Œæƒ³ç€ä¸ºä»€ä¹ˆå‰©ä¸‹çš„åå¤©è¿™ä¹ˆéš¾ç†¬è¿™æ ·çš„é—®é¢˜ã€‚ å¤ä¹ åˆæ˜¯ä¸€å¡Œç³Šæ¶‚ï¼Œæˆ‘ä¹Ÿå¤ªæ‡’äº†ç‚¹ã€‚ è¿™æ ·æ‡’æ•£çš„æˆ‘è¿˜åšç€ç å®Œå‡ åƒè¡Œä»£ç è¿™æ ·çš„æ˜¥ç§‹å¤§æ¢¦ï¼Œå¤ªä¸ç°å®äº†ã€‚æœ‰ç‚¹æƒ³è®¤å‘½äº†ã€‚ åŠå¤œä¸€ç‚¹å¤šï¼Œå¯å®¤ç©ºè°ƒè¿˜æ˜¯ä¸ä¹ æƒ¯ï¼Œè¿‡é“é˜³å°ä¸Šçš„å‡‰é£å€’æ˜¯å¾ˆèˆ’æœï¼Œè¿™åº§åŸå¸‚æ­¤åˆ»çš„é™è°§å€’ä¹Ÿæœ‰å‡ åˆ†éŸµå‘³ã€‚ ä¸è¿‡ä¸ç®¡æ€ä¹ˆè¯´ï¼Œå¥½æƒ³å›å®¶â€¦ ","date":"2017-06-27","objectID":"/posts/the-end-of-another-semester/:0:0","series":null,"tags":[],"title":"åˆä¸€ä¸ªæœŸæœ«","uri":"/posts/the-end-of-another-semester/#"},{"categories":["å½±è§†","life"],"content":"å³ä½¿å¤§äººçš„ä¸–ç•Œä¹Ÿåƒç–®ç™¾å­”ï¼Œä½†æ˜¯è¦æ˜¯è®©æˆ‘ä»¬è‡ªå·±æ¥åšçš„è¯ï¼Œåªèƒ½åšçš„æ›´å·®ï¼Ÿæ‰€ä»¥ä½ çœ‹èˆ¹é‡Œçš„å°ç¤¾ä¼šæ˜¯ä»€ä¹ˆæ ·å­çš„å§ï¼Œå«‰å¦’ã€æ¬ºéª—ã€ææƒ§ã€è‡ªæš´è‡ªå¼ƒã€æ„¤æ€’ã€è‡ªç§â€¦â€¦å„ç§æ¬²æœ›ã€‚äºæ˜¯é˜¶çº§åˆ†åŒ–ã€å·¥ä½œæ•ˆç‡ä½ä¸‹ï¼Œæœ‰äººå¼€å§‹æ±‚åŠ©äºç¥ï¼Œæš´åŠ¨ä¹Ÿæ—¶ä¸æ—¶çš„å‘ç”Ÿã€‚ èˆ°é•¿å®³æ€•æœ‰äººæ­»å»ï¼Œå®³æ€•æ‰¿æ‹…è´£ä»»ï¼Œä¸æ•¢å†’é™©ï¼Œå–œæ¬¢ä¸Šå¼ºåŠ¿çš„é˜¿å²šï¼Œå¿ƒå¿ƒå¿µå¿µé‚£ä¸ªäººï¼ŒæŠŠäº‹æƒ…æçš„ä¸€å›¢ç³Ÿã€‚ç¥å¸Œå¿ƒé‡Œæœ‰è¯ä¸è®²ï¼Œä¸€å‘³çš„æäººæ³„æ„¤ã€‚ä¼Šå…‹ç±³ææƒ§æ­»äº¡ï¼Œææƒ§å¾—ä¸åƒæ ·ã€‚æ¢¢æœ‰ç‚¹è‡ªæˆ‘ä¸­å¿ƒï¼Œè§‰å¾—ä¼Šå…‹ç±³æ˜¯å¥¹ä¸€ä¸ªäººçš„ï¼Œåªä¸ºäº†å¥¹è€ŒåŠªåŠ›ã€‚é˜¿å²šå¾ˆæœ‰å½“èˆ°é•¿çš„èƒ½åŠ›ï¼Œä½†æ˜¯ä¸€å¿ƒå¤ä»‡ï¼Œé™¤äº†è¿™ä¸ªå…¶ä»–çš„éƒ½ä¸æ€ä¹ˆç®¡ã€‚ç”·ä¸»å¿å—ç€å„ç§éè®®å’Œæ®´æ‰“ï¼Œä½†æ˜¯åšå®ˆæœ¬å¿ƒã€‚ä¸ç®¡å±€åŠ¿å¦‚ä½•å˜åŒ–ï¼Œä»–ä¸€ç›´åœ¨åšç€æ­£ç¡®çš„äº‹ï¼Œè™½ç„¶æœ‰æ—¶å€™æ­£ç¡®çš„äº‹æœªå¿…æ˜¯æœ€å¥½çš„â€¦â€¦ äººåœ¨åæ‰ã€‚ å¤§å®¶éƒ½åœ¨è‡ªæ¬ºæ¬ºäººå—ï¼Ÿ çœŸçš„å¯ä»¥æŠ›å¼ƒè¿‡å»æ´»ä¸‹å»å—ï¼Ÿ å¦‚æœä¸å¯ä»¥ï¼Œé‚£ä¸ºäº†æ´»ç€ï¼ŒèƒŒè´Ÿè¿‡å»æ˜¯å¿…è¦çš„ï¼Ÿ æœ€ååè½¬å‰§æƒ…ï¼Œé çš„è¿˜æ˜¯ä¸€ä¸ªã€Œæƒ…ã€å­—ã€‚ä¹Ÿå¯¹ï¼Œç§‘æŠ€å‘å±•çš„åŠ¨åŠ›ä¹Ÿæ˜¯äººçš„æ¬²æœ›ã€‚ æ¬²æœ›æœ‰å¥½æœ‰åï¼Œç†æ™ºçš„æŠŠæ¡å®ƒã€‚æ— æ¬²æ— æ±‚ï¼Œå°±æ˜¯æ­»ã€‚ ","date":"2017-06-14","objectID":"/posts/infinite-ryvius/:0:0","series":null,"tags":["è§‚åæ„Ÿ","åŠ¨æ¼«"],"title":"ã€Šæ— é™çš„æœªçŸ¥ã€‹","uri":"/posts/infinite-ryvius/#"},{"categories":["æ•°å­¦","tech"],"content":"å¾ˆæ—©å°±å­¦è¿‡æ¬§å‡ é‡Œå¾—ç®—æ³•ï¼Œä½†æ˜¯ä¸€ç›´ä¸çŸ¥é“å®ƒçš„åŸç†ã€‚å‡ ä¹æ¯æœ¬ç®—æ³•ä¹¦éƒ½ä¼šæåˆ°å®ƒï¼Œä½†æ˜¯è²Œä¼¼åªæœ‰æ•°å­¦ä¹¦ä¸Šæ‰ä¼šè§åˆ°å®ƒçš„åŸç†ã€‚ã€‚ã€‚ å‰æ®µæ—¶é—´ç²—ç²—çœ‹äº†ç‚¹æ•°è®ºï¼ˆã€Šä»€ä¹ˆæ˜¯æ•°å­¦ã€‹ï¼‰ï¼ŒæƒŠè®¶äºè¿™ä¸ªåŸç†çš„å¥‡å¦™ã€‚ç°åœ¨æŠŠå®ƒé€šä¿—åœ°å†™ä¸‹æ¥ï¼Œä»¥å…è‡ªå·±å¿˜è®°ã€‚ æ¬§å‡ é‡Œå¾—ç®—æ³•æ˜¯æ±‚ä¸¤ä¸ªæ•°çš„æœ€å¤§å…¬çº¦æ•°(Greatest Common Divisor (GCD))çš„ç®—æ³•ï¼Œæˆ‘ä»¬é¦–å…ˆå‡è®¾æœ‰ä¸¤ä¸ªæ•° $a$ å’Œ $b$ï¼Œå…¶ä¸­ $a$ æ˜¯ä¸å°äº $b$ çš„æ•°ï¼Œ è®° $a$ è¢« $b$ é™¤çš„ä½™æ•°ä¸º $r$ï¼Œé‚£ä¹ˆ $a$ å¯ä»¥å†™æˆè¿™æ ·çš„å½¢å¼ï¼š $$a = bq + r$$ å…¶ä¸­ $q$ æ˜¯æ•´æ•°ï¼ˆæˆ‘ä»¬ä¸éœ€è¦å»ç®¡ $q$ åˆ°åº•æ˜¯å¤šå°‘ï¼Œè¿™å’Œæˆ‘ä»¬çš„ç›®æ ‡æ— å…³ï¼‰ã€‚ ç°åœ¨å‡è®¾ $a$ å’Œ $b$ çš„ä¸€ä¸ªçº¦æ•°ä¸º $u$ï¼Œé‚£ä¹ˆ $a$ å’Œ $b$ éƒ½èƒ½è¢« $u$ æ•´é™¤ï¼Œå³ $$a = su$$ $$b = tu$$ $s$ å’Œ $t$ éƒ½æ˜¯æ•´æ•°ï¼ˆåŒæ ·çš„ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“å­˜åœ¨è¿™æ ·çš„æ•´æ•° $s$ å’Œ $t$ å°±è¡Œï¼‰ã€‚ è¿™æ ·å¯ä»¥å¾—å‡º $$r = a - bq = su - (tu)q = (s - tq)u$$ æ‰€ä»¥ $r$ ä¹Ÿèƒ½è¢« $u$ æ•´é™¤ï¼Œä¸€èˆ¬è§„å¾‹å¦‚ä¸‹ $a$ å’Œ $b$ çš„çº¦æ•°ä¹Ÿæ•´é™¤å®ƒä»¬çš„ä½™æ•° $r$ï¼Œæ‰€ä»¥ $a$ å’Œ $b$ çš„ä»»ä¸€çº¦æ•°åŒæ—¶ä¹Ÿæ˜¯ $b$ å’Œ $r$ çš„çº¦æ•°ã€‚ â€”â€” æ¡ä»¶ä¸€ åè¿‡æ¥å¯ä»¥å¾—å‡º $b$ å’Œ $r$ çš„ä»»ä¸€çº¦æ•°åŒæ—¶ä¹Ÿæ˜¯ $a$ å’Œ $b$ çš„çº¦æ•°ã€‚ â€”â€”æ¡ä»¶äºŒ è¿™æ˜¯å› ä¸ºå¯¹ $b$ å’Œ $r$ æ¯ä¸€ä¸ªçº¦æ•° $v$ï¼Œæœ‰ $$b = kv$$ $$r = cv$$ äºæ˜¯æœ‰ $$a = bq + r = (kv)q + cv = (kq + c)v$$ ç”±æ¡ä»¶ä¸€å’Œæ¡ä»¶äºŒå¯çŸ¥ $a$ å’Œ $b$ çš„çº¦æ•°çš„é›†åˆï¼Œå…¨ç­‰äº $b$ å’Œ $r$ çš„çº¦æ•°çš„é›†åˆã€‚ äºæ˜¯ $a$ å’Œ $b$ çš„æœ€å¤§å…¬çº¦æ•°ï¼Œå°±æ˜¯ $b$ å’Œ $r$ çš„æœ€å¤§å…¬çº¦æ•°ã€‚ æ¥ä¸‹æ¥ç”¨é€’æ¨æ³•ï¼Œ $a \\div b$ ä½™ $r$ï¼Œç°åœ¨è®¾ $b \\div r$ ä½™ $r_1$ $r \\div r_1$ ä½™ $r_2$ â€¦â€¦ $r_{n-3} \\div r_{n-2}$ ä½™ $r_{n-1}$ $r_{n-2} \\div r_{n-1}$ ä½™ $r_n=0$ å› ä¸º $a \\ge b$ï¼Œå¯ä»¥çœ‹å‡ºä½™æ•° $r_n$ ä¼šè¶Šæ¥è¶Šå°ï¼Œæœ€ç»ˆå˜æˆ $0$. å½“ $r_{n-1} \\neq 0$ ä¸” $r_n = 0$ æ—¶ï¼Œå¯çŸ¥ $r_{n-2}$ å¯è¢« $r_{n-1}$ æ•´é™¤ï¼ˆä½™æ•°ä¸º $0$ å˜›ï¼‰ æ­¤æ—¶ $r_{n-2}$ å’Œ $r_{n-1}$ çš„çº¦æ•°å°±åªæœ‰ï¼š$r_{n-1}$ å’Œ $r_{n-1}$ çš„å› æ•°ï¼Œæ‰€ä»¥ä»–ä»¬çš„æœ€å¤§å…¬çº¦æ•°å°±æ˜¯ $r_{n-1}$ï¼ æ‰€ä»¥ $r_{n-1}$ å°±æ˜¯ $a$ å’Œ $b$ çš„æœ€å¤§å…¬çº¦æ•°ã€‚ï¼ˆè‹¥ $r = 0$ï¼Œåˆ™ $b$ ä¸ºæœ€å¤§å…¬çº¦æ•°ï¼‰ è¿™ä¸ªé€’æ¨æ³•å†™æˆcè¯­è¨€å‡½æ•°æ˜¯è¿™æ ·çš„ï¼ˆæ¯”æ¨å¯¼æ›´ç®€æ´â€¦ï¼‰: c unsigned int Gcd(unsigned int M,unsigned int N){ unsigned int Rem; while(N){ Rem = M % N; M = N; N = Rem; } return Rem; } å¯ä»¥å‘ç°è¿™é‡Œæ²¡æœ‰è¦æ±‚ M\u003e=Nï¼Œè¿™æ˜¯å› ä¸ºå¦‚æœé‚£æ ·ï¼Œå¾ªç¯ä¼šè‡ªåŠ¨äº¤æ¢å®ƒä»¬çš„å€¼ã€‚ P.S. æ­¤å¤–ï¼Œè¿˜æœ‰æœ€å°å…¬å€æ•°(Least Common Multiple (LCM))ç®—æ³•ï¼Œè¯¦è§GCD and LCM calculator ","date":"2017-05-26","objectID":"/posts/mathematics-in-euclidean-gcd/:0:0","series":null,"tags":["ç®—æ³•"],"title":"æ¬§å‡ é‡Œå¾—ç®—æ³•æ±‚æœ€å¤§å…¬çº¦æ•°(GCD)çš„æ•°å­¦åŸç†","uri":"/posts/mathematics-in-euclidean-gcd/#"},{"categories":["life"],"content":"ç”Ÿæ´»æ€»æ˜¯åœ¨ç»™ä½ å¸Œæœ›ä¹‹æ—¶ï¼Œå†åŸ‹ç‚¹ä¼ç¬”ã€‚æœ¬æ¥æˆ‘ä»¥ä¸ºè¿›äº†å¤§å­¦ï¼Œå°±æ˜¯ä¸€ä¸ªå…¨æ–°çš„ä¸–ç•Œäº†ï¼Œæˆ‘å¯ä»¥é‡æ–°å¼€å§‹ï¼Œåªè¦æˆ‘å¾ˆåŠªåŠ›å¾ˆåŠªåŠ›ï¼Œä¸€åˆ‡å›°éš¾éƒ½å°†ä¸å ªä¸€å‡»ã€‚ æ˜¾ç„¶é‚£ä¸ªæ—¶å€™ï¼Œæˆ‘è¿˜ä¸çŸ¥é“ï¼Œç°å®ä¸åŒäºæƒ³è±¡ã€‚ é«˜ä¸‰åœ¨é«˜å‹ä¸‹å…¨çº¿å´©æºƒï¼Œå› æ­¤å¯¹å¤§å­¦å¯„äºˆäº†è¿‡å¤šæœŸæœ›ã€‚ä½†è¿™æœŸæœ›åŒæ—¶ä¹Ÿå¸¦æ¥äº†æ›´å¤§çš„å‹åŠ›ã€‚ æˆ‘æ‚£ä¸Šäº†é˜…è¯»ç„¦è™‘ç—‡ã€‚ ä»è¿›å…¥å¤§å­¦çš„é‚£ä¸€åˆ»èµ·ï¼Œå°±å¼€å§‹ç–¯ç‹‚åœ°åˆ¶å®šé˜…è¯»è®¡åˆ’ï¼Œæ³¡å›¾ä¹¦é¦†ï¼Œçœ‹å„ç§å­¦ä¹ æ–¹æ³•ã€è¯»ä¹¦æ–¹æ³•ã€è®°å¿†æ–¹æ³•ã€é€Ÿè¯»æœ¯ä¹‹ç±»çš„ä¹¦ç±ï¼Œæ¨ä¸å¾—ä¸€ç›®åè¡Œã€‚ ä½†æ˜¯å¾ˆå¿«çš„ï¼Œæˆ‘å°±å‘ç°è‡ªå·±å‡ºäº†é—®é¢˜ï¼šæˆ‘å¤ªæƒ³æå‡è‡ªå·±äº†ï¼Œå› æ­¤ç¿»å¼€ä¹¦çš„ç¬¬ä¸€é¡µï¼Œå°±æœŸç›¼ç€ç¿»åˆ°æœ€åä¸€é¡µï¼Œè¯»ä¹¦çš„æ„‰æ‚¦ï¼Œè¢«å¯¹çœ‹å®Œä¸€æœ¬ä¹¦çš„æ¸´æœ›å†²æ·¡äº†ã€‚æ›´å¤šçš„æ—¶å€™ï¼Œæ„Ÿè§‰åˆ°çš„æ˜¯è¿˜æ²¡æŠŠè¿™æœ¬ä¹¦çœ‹å®Œçš„ç„¦è™‘ã€‚ è€Œä¸”å› ä¸ºé•¿æ—¶é—´å…¨ç¥è´¯æ³¨ï¼Œä¸€æœ¬ä¹¦çœ‹ä¸åˆ°ä¸€åŠï¼Œè€å¿ƒä¹Ÿæ¸æ¸å¤±å»ï¼Œäºæ˜¯ç¿»é¡µé€Ÿåº¦è¶Šæ¥è¶Šå¿«ï¼Œè¿™ä¸ªæ—¶å€™æ‰€è°“çš„ã€Œé˜…è¯»ã€å·²ç»åå­˜å®äº¡äº†ã€‚ è¿™æ ·çš„é˜…è¯»çš„ç»“æœï¼Œåªæ˜¯åœ¨è¯»ä¹¦é‡ä¸Šå¾’ç„¶æ·»åŠ å‡ ä¸ªæ•°å­—ï¼Œäºè‡ªæˆ‘æå‡è€Œè¨€ï¼Œå´æ˜¯æ”¶æ•ˆç”šå¾®ã€‚æˆ‘å¾ˆæ˜ç™½è¿™ä¸€ç‚¹ï¼Œä½†æ˜¯æ˜ç™½å’Œä½œå‡ºæ”¹å˜ä¹‹é—´ï¼Œéš”ç€ä¸€é“é¸¿æ²Ÿï¼Œæˆ‘æ€ä¹ˆä¹Ÿè·¨ä¸è¿‡å»ã€‚æ˜æ˜çŸ¥é“æ¾å¼›æœ‰åº¦æ•ˆç‡ä¼šæ›´é«˜ï¼Œ ä½†æ˜¯å¿ƒç†ä¸Šçš„ç„¦è™‘è®©æˆ‘æ— æ³•è¯´æœè‡ªå·±æ”¾ä¸‹ä¹¦æœ¬å“ªæ€•ä¸€åˆ†é’Ÿï¼Œç›´åˆ°è‡ªå·±çš„è€å¿ƒæ¶ˆè€—æ®†å°½â€¦â€¦ ä¹°äº†ä¸€å¤§å †æ–‡å­¦ä¹¦æ”¾åœ¨æŸœå¤´ã€‚å¯ç¬‘çš„æ˜¯ï¼Œå¤§ä¸€æ•´æ•´ä¸€å¹´ï¼Œé™¤äº†éŸ©å¯’ï¼Œæˆ‘æ²¡çœ‹ä»»ä½•ä¸€æœ¬æ–‡å­¦ä¹¦è¶…è¿‡åŠå°æ—¶ã€‚ã€Œå¿«é€Ÿæµè§ˆã€å®Œåå‡ æœ¬æ–¹æ³•ç±»ä¹¦ç±åï¼Œæˆ‘å¼€å§‹é˜…è¯»æŠ€æœ¯ä¹¦ç±ã€‚ä½†æ˜¯é™¤äº†éŸ©å¯’çš„ä¹¦å’Œå‡ æœ¬æŠ€æœ¯ä¹¦ç±ï¼Œ é˜…è¯»è¿‡ç¨‹ä¸­çš„ç„¦è™‘æ„Ÿä»æœªè¿œç¦»æˆ‘ï¼Œè¿™ä¸ä»…é™ä½äº†æˆ‘çš„å­¦ä¹ æ•ˆç‡ï¼Œæ›´è®©æˆ‘çš„å€¦æ€ æœŸé•¿äº†æ•°å€(è¿‡åº¦æ¶ˆè€—ç²¾åŠ›)ã€‚å…¶ç»“æœæ˜¯ï¼Œå¾€å¾€ä¸€æœ¬åšä¸€ç‚¹çš„ä¹¦è¯»ä¸Šä¸¤ä¸‰å¤©ï¼Œå°±æœ‰åŠä¸ªæœˆä¼šåŒå€¦åˆ°ä¸æƒ³ç¢°å®ƒã€‚ æˆ‘èƒ½æ„Ÿè§‰åˆ°å¦‚æœæŒ‰ç€è®¡åˆ’è¯»ä¹¦ï¼Œæˆ‘çš„æˆæœç»ä¸ä¼šå·®åˆ°ç°åœ¨è¿™æ ·ã€‚ä¹Ÿæƒ³ç€æœ‰è®¡åˆ’æ€§ä¸€ç‚¹ï¼Œå¯æ˜¯ä¸€çœ‹QQï¼Œäººå®¶åˆä¸‰çš„å°ç”·å­©å·²ç»å­¦éäº†é«˜ä¸­æ•°å­¦ã€ç®—æ³•ã€åˆç­‰æ•°è®ºã€è‡ªç„¶æ•°å­¦â€¦â€¦ç½‘ä¸Šè®¤è¯†çš„åŒé¾„äººå·²ç»å¼€å§‹åšç¥ç»ç½‘ç»œäº†ï¼ŒçŸ¥ä¹ä¸Šä¸€å¤§ç¾¤è‡ªå­¦è€…ä¹Ÿåœ¨åŠªåŠ›æ”»å…‹python/c/ç®—æ³•ï¼Œæˆ‘å°±åœä¸ä¸‹æ¥ï¼Œç”šè‡³å¹³é™ä¸‹æ¥åšä¸ªè®¡åˆ’éƒ½è§‰å¾—æµªè´¹æ—¶é—´(å®é™…ä¸Šå¾ˆæ˜æ˜¾è¿™æ ·å¸¦ç€ç„¦è™‘é˜…è¯»æ‰æ˜¯æµªè´¹æ—¶é—´)ã€‚ è¿«åˆ‡çš„æƒ³è¦æˆä¸ºé‚£ä¸ªã€Œè‡ªå·±æƒ³è¦æˆä¸ºçš„äººã€ï¼Œå› æ­¤è¿åŸºæœ¬çš„ç†æ€§éƒ½æ— æ³•ä¿æŒã€‚ æˆ‘æƒ³è¦çš„æ˜¯ä»å®¹ã€å¸¦ç€è„‘å­çš„é˜…è¯»ï¼Œè€Œä¸æ˜¯è¿™æ ·èµ°é©¬è§‚èŠ±ï¼Œç›²ç›®è¿½æ±‚é‡çš„é˜…è¯»ã€‚ æˆ‘åˆç„¦è™‘åœ°æ‰“å¼€çŸ¥ä¹ï¼Œä¸æ–­æœç´¢ï¼Œç„¶åå†™ä¸‹è¿™ç¯‡æ–‡ç« ã€‚ ","date":"2017-03-07","objectID":"/posts/reading-anxiety/:0:0","series":null,"tags":["é˜…è¯»","ç„¦è™‘"],"title":"æˆ‘æ‚£ä¸Šäº†é˜…è¯»ç„¦è™‘ç—‡","uri":"/posts/reading-anxiety/#"},{"categories":["life"],"content":" 2017å¹´2æœˆçš„18å·ï¼Œæ¸…æ™¨6ç‚¹ã€‚å¤©è¿˜åªæ˜¯æœ¦æœ¦äº®ï¼Œå½“ç©ºæŒ‚ç€åŠè¾¹å¼¯æœˆï¼Œä¸€é¢—ä¸çŸ¥åçš„æ˜Ÿæ˜Ÿ(å¤§çº¦æ˜¯å¤§è§’æ˜Ÿ) ç¼€åœ¨æœˆçš„æ—è¾¹ã€‚è¿˜æ²¡å¼€å­¦ï¼Œå­¦æ ¡å‡ ä¹çœ‹ä¸åˆ°äººã€‚ å—é£Ÿå ‚çš„ä¸€æ¥¼å·²äº®èµ·äº†ç¯ï¼Œé¸Ÿå„¿ä»¬å¼€å§‹é¸£å«ä¸ªä¸åœï¼Œå¯ä»¥å¬å‡ºæœ‰å¥½å‡ ç§é¸Ÿå«å£°ã€‚ æ˜“æµ·ä»æ˜¯é£å¹³æµªé™ã€‚ æˆ‘èƒŒç€ä¹¦åŒ…ï¼Œæ‹–ç€çš®ç®±ï¼Œè€³è¾¹æœ€æ¸…æ™°çš„å£°éŸ³ä¾¿æ˜¯çš®ç®±è½®èƒä¸åœ°é¢çš„æ‘©æ“¦å£°ã€‚ æ‰‹æœºéšä¾¿æ”¾èµ·ä¸€é¦–æ­Œï¼Œæ°å¥½æ˜¯ã€Šé¥è¿œçš„æ­Œã€‹ã€‚è¿™é¦–æ­ŒçœŸæ˜¯åº”æ™¯å‘¢ï¼Œé€å»çš„æ—¶å…‰é¥è¿œå¾—æ— æ³•è§¦åŠï¼Œè‡ªå·±ä¹Ÿç¦»å®¶åƒé‡Œï¼Œæœªæ¥æ›´æ˜¯éš¾ä»¥æ‰æ‘¸ã€‚ æˆ‘è¿˜ä¼šè®°å¾—å—ï¼Ÿè®°å¾—è¿™ä¸ªæˆ‘å°è±¡ä¸­ï¼Œæœ€å®é™å®‰è¯¦çš„ï¼Œå®‰å¾½å»ºç­‘å¤§å­¦ã€‚ ","date":"2017-02-18","objectID":"/posts/quiet-and-peaceful-campus/:0:0","series":null,"tags":[],"title":"å°‘æœ‰äººè¿¹çš„æ ¡å›­","uri":"/posts/quiet-and-peaceful-campus/#"},{"categories":["life"],"content":" ä¸Šä¸ªæš‘å‡ï¼Œåˆšåˆšä»ä½è°·çˆ¬å‡ºæ¥ï¼Œé‚£æ—¶å€™æ•´ä¸ªäººæ•£å‘ç€ä¸€è‚¡å­å‘ä¸Šçš„æ°”æ¯ï¼Œè±ªæƒ…ä¸‡ä¸ˆï¼Œç”šè‡³æ„ŸæŸ“äº†å‘¨å›´çš„äº²æœ‹å¥½å‹ã€‚é‚£ä¸ªæ—¶å€™ï¼Œæ»¡ä»¥ä¸ºä»¥åçš„æŒ«æŠ˜éƒ½ä¸èƒ½é˜»æŒ¡æˆ‘çš„è„šæ­¥ã€‚ å¯æ˜¯ï¼Œåˆ°åº•ä¸ºä»€ä¹ˆï¼Œç°åœ¨åˆå˜æˆäº†è¿™ä¸ªæ ·å­äº†å‘¢ï¼Ÿäººç”Ÿè¿™æ ·çš„ä¸œè¥¿ï¼Œæ€»æ˜¯å‡ºäººæ„æ–™ï¼Œä»¥è‡³äºæ€ä¹ˆä¹ŸçŒœä¸é€ã€‚ åäºŒæœˆåå››ï¼Œæˆ‘åº¦è¿‡äº†æˆ‘çš„åä¹å²ç”Ÿæ—¥ï¼Œç°åœ¨åº”è¯¥æ­£æ˜¯é‚£æ‰€è°“çš„é’æ˜¥å°†é€æœªé€ä¹‹æ—¶ã€‚è€Œæˆ‘çš„é’æ˜¥åº”è¯¥æœ€è¾‰ç…Œçš„æ—¶å€™ï¼Œæˆ‘åœ¨å¹²ä»€ä¹ˆå‘¢ï¼Ÿ æˆ‘åœ¨ç¿»å±±è¶Šå²­ã€‚ ä¸Šå±±æ—¶ä¸€è·¯åå·ï¼Œç´¯çš„è¦æ­»ä¸æ´»çš„ã€‚é™¡ç„¶é—´èŒç”Ÿé€€æ„ï¼Œå¿ƒå°±åœ¨ä¸æ–­æŒ£æ‰ã€‚å°±åœ¨å´æ„æˆ˜èƒœå£®å¿—ä¹‹æ—¶ï¼Œå¿½ç„¶é—´å¤©åœ°å¼€é˜”ï¼Œæ‰å‘è§‰è‡ªå·±å·²ç„¶ç«™åœ¨äº†å¤§å±±ä¹‹å·…ï¼Œäºæ˜¯ä¸€åˆ‡ç—›è‹¦å°½çš†è¿œå»ï¼Œå¿ƒä¹Ÿå˜å¾—å¦‚è¿™å¤©åœ°ä¸€èˆ¬å¼€é˜”ã€‚è¿™ä¸ªæ—¶å€™è‡ªç„¶è±ªæƒ…ä¸‡ä¸ˆï¼Œçœ‹å±±å±±ç¾ï¼Œçœ‹æ°´æ°´ç§€ã€‚æƒ³å½“ç„¶çš„å°±è§‰å¾—åé¢çš„å±±å²­æœ‰å†å¤šçš„é˜»ç¢ï¼Œä¹Ÿä¸èƒ½é˜»æŒ¡è¿™ä¸ªè§è¿‡å¦‚æ­¤ç¾æ™¯çš„ç™»å±±äººäº†ã€‚ å¯æ˜¯äº‹ä¸æ„¿è¿ï¼Œå±±å²­å°±åƒæ—¶é—´ä¸€æ ·çœ‹ä¸åˆ°è¾¹ï¼Œç¿»è¿‡äº†ä¸€åº§åˆæ˜¯ä¸€åº§ï¼Œè¿™åˆæ˜¯ä¸€ç§æ›´å¤§çš„ç—›è‹¦ã€‚è¿™ä¸ªç™»å±±äººèº«å¿ƒä¿±ç–²ï¼Œåªå¥½ä¸‡äº‹éšç¼˜ï¼Œç»§ç»­ä¸€è„šæ·±ï¼Œä¸€è„šæµ…çš„å¾€é‚£æ— å°½å±±å²­è¡Œå»ã€‚ æœ€è¿‘çœ‹äº†æ˜¯æè£•å’Œçš„ç”µå½±ã€Šæ¯”æµ·æ›´æ·±ã€‹ï¼Œã€Œæˆ‘çš„äººç”Ÿåˆ°åº•å‡ºäº†ä»€ä¹ˆå·®é”™ï¼Ÿã€ è¿™æ ·ä¸€ä¸ªé—®å¥ï¼Œé“å‡ºäº†å¤šå°‘è¾›é…¸è‹¦è¾£â€¦â€¦æƒ³èµ·äº†ä»¥å‰å†™è¿‡ä¸€ç¯‡æ–‡ç« ï¼Œæ ‡é¢˜æ˜¯ã€Šå¯¹ä¸èµ·ï¼Œæˆ‘æ²¡æœ‰æˆä¸ºä½ æƒ³æˆä¸ºçš„é‚£ä¸ªäººã€‹ã€‚ ç†æƒ³ä¸ç°å®ä¹‹é—´ä»¿ä½›æ€»éš”ç€ä¸€é“é¸¿æ²Ÿã€‚ ç°åœ¨æ²¡æœ‰äº†ä¸‡ä¸ˆè±ªæƒ…ï¼Œä¸å†æ•¢è¯´ã€Œæœªæ¥å°†æ˜¯ä¸€ç‰‡å¦é€”ã€ï¼›ä¹Ÿæ²¡æœ‰ç»æœ›åˆ°è¦å†™ã€Œæˆ‘çš„äººç”Ÿåˆ°åº•å‡ºäº†ä»€ä¹ˆå·®é”™ï¼Ÿã€è¿™æ ·çš„å¥å­ï¼Œé‚£è¿˜æ˜¯ç”¨æˆ‘æœ€å–œæ¬¢çš„é‚£ä¸ªæ¨¡æ£±ä¸¤å¯çš„å››å­—è¯ä½œç»“å§ã€‚ ä¸”è¡Œä¸”å¯» ","date":"2017-02-06","objectID":"/posts/the-holiday-is-coming-to-an-end/:0:0","series":null,"tags":[],"title":"å¿½è€Œå‡æœ«","uri":"/posts/the-holiday-is-coming-to-an-end/#"},{"categories":["tech"],"content":" æœ¬æ–‡æœ€åˆäº 2016-10-18 å‘è¡¨åœ¨åšå®¢å›­ï¼Œ2022-08-13 æ¬è¿è‡³https://thiscute.world æ˜¨æ™šæˆ‘æœ‹å‹ @ä¸‰åå…­å’² è·Ÿæˆ‘è¯´åœ¨ç½‘ä¸Šçœ‹åˆ°äº†åˆ«äººåšçš„è§†é¢‘è½¬å­—ç¬¦åŠ¨ç”»ï¼Œè§‰å¾—å¾ˆå‰å®³ï¼Œæˆ‘äºæ˜¯ä¹Ÿæ‰“ç®—ç©ç©ã€‚ä»Šå¤©ä¸­åˆèŠ±æ—¶é—´å®ç°äº†è¿™æ ·ä¸€ä¸ªå°ç©æ„ã€‚é¡ºä¾¿æŠŠè¿‡ç¨‹è®°å½•åœ¨è¿™é‡Œã€‚ æ³¨ï¼šæœ€æ–°ç‰ˆä½¿ç”¨äº†ç”»å¸ƒæ–¹å¼å®ç°ï¼Œå’Œæœ¬æ–‡ç›¸æ¯”æ”¹åŠ¨éå¸¸å¤§ï¼Œå¦‚æœå¯¹æ—§ç‰ˆæœ¬çš„å®ç°æ²¡å•¥å…´è¶£ï¼Œå¯ä»¥ç›´æ¥ç§»æ­¥video2charsï¼Œ å®ƒçš„æ•ˆæœåŠ¨ç”»è§ æä¹å‡€åœŸã€‚æ–°ç‰ˆæœ¬çš„æ ¸å¿ƒä»£ç ä¸ç®—æ³¨é‡Š 70 è¡Œä¸åˆ°ï¼ŒåŠŸèƒ½æ›´å¼ºå¤§ã€‚ ","date":"2016-10-18","objectID":"/posts/video2chars-1-basics/:0:0","series":null,"tags":[],"title":"Python è§†é¢‘è½¬å­—ç¬¦åŠ¨ç”»ï¼ˆä¸€ï¼‰60 è¡Œä»£ç ","uri":"/posts/video2chars-1-basics/#"},{"categories":["tech"],"content":" æ•ˆæœå…ˆä¸Šæ•ˆæœï¼Œæ¥ç‚¹åŠ¨åŠ›ã€‚ æºè§†é¢‘ ã€æ±æ–¹ã€‘Bad Apple!! ï¼°ï¼¶ã€å½±çµµã€‘ è½¬æ¢åçš„æ•ˆæœå¦‚ä¸‹ï¼š There should have been a video here but your browser does not seem to support it. ","date":"2016-10-18","objectID":"/posts/video2chars-1-basics/:0:1","series":null,"tags":[],"title":"Python è§†é¢‘è½¬å­—ç¬¦åŠ¨ç”»ï¼ˆä¸€ï¼‰60 è¡Œä»£ç ","uri":"/posts/video2chars-1-basics/#æ•ˆæœ"},{"categories":["tech"],"content":" æ­¥éª¤ å°†è§†é¢‘è½¬åŒ–ä¸ºä¸€å¸§ä¸€å¸§çš„å›¾ç‰‡ æŠŠå›¾ç‰‡è½¬åŒ–ä¸ºå­—ç¬¦ç”» æŒ‰é¡ºåºæ’­æ”¾å­—ç¬¦ç”» ","date":"2016-10-18","objectID":"/posts/video2chars-1-basics/:0:2","series":null,"tags":[],"title":"Python è§†é¢‘è½¬å­—ç¬¦åŠ¨ç”»ï¼ˆä¸€ï¼‰60 è¡Œä»£ç ","uri":"/posts/video2chars-1-basics/#æ­¥éª¤"},{"categories":["tech"],"content":" ä¸€ã€å‡†å¤‡ 1. æ¨¡å—è¿™ä¸ªç¨‹åºéœ€è¦ç”¨åˆ°è¿™æ ·å‡ ä¸ªæ¨¡å—: opencv-python # ç”¨æ¥è¯»å–è§†é¢‘å’Œå›¾ç‰‡ numpy # opencv-python ä¾èµ–äºå®ƒ å‡†å¤‡é˜¶æ®µï¼Œé¦–å…ˆå®‰è£…ä¾èµ–ï¼š shell pip3 install numpy opencv-python ç„¶åæ–°å»º python ä»£ç æ–‡æ¡£ï¼Œåœ¨å¼€å¤´æ·»åŠ ä¸Šä¸‹é¢çš„å¯¼å…¥è¯­å¥ python #-*- coding:utf-8 -*- # numpy æ˜¯ä¸€ä¸ªçŸ©é˜µè¿ç®—åº“ï¼Œå›¾åƒå¤„ç†éœ€è¦ç”¨åˆ°ã€‚ import numpy as np 2. ææ–™ææ–™å°±æ˜¯éœ€è¦è½¬æ¢çš„è§†é¢‘æ–‡ä»¶äº†ï¼Œæˆ‘è¿™é‡Œç”¨çš„æ˜¯BadApple.mp4ï¼Œ ä¸‹è½½ä¸‹æ¥å’Œä»£ç æ”¾åˆ°åŒä¸€ç›®å½•ä¸‹ä½ ä¹Ÿå¯ä»¥æ¢æˆè‡ªå·±çš„ï¼Œå»ºè®®æ˜¯å­¦ä¹ æ—¶å°½é‡é€‰ä¸ªçŸ­ä¸€ç‚¹çš„è§†é¢‘ï¼Œå‡ åç§’å°±è¡Œäº†ï¼Œä¸ç„¶è°ƒè¯•èµ·æ¥å¾ˆç—›è‹¦ã€‚ï¼ˆæˆ–è€…è‡ªå·±ç¨å¾®ä¿®æ”¹ä¸€ä¸‹å‡½æ•°ï¼Œåªè½¬æ¢ä¸€å®šèŒƒå›´ã€ä¸€å®šæ•°é‡çš„å¸§ã€‚ï¼‰æ­¤å¤–ï¼Œè¦é€‰æ‹©å¯¹æ¯”åº¦é«˜çš„è§†é¢‘ã€‚å¦åˆ™çš„è¯ï¼Œå°±éœ€è¦å½©è‰²å­—ç¬¦æ‰èƒ½æœ‰è¶³å¤Ÿå¥½çš„è¡¨ç°ï¼Œæœ‰æ—¶é—´æˆ‘è¯•è¯•ã€‚ ","date":"2016-10-18","objectID":"/posts/video2chars-1-basics/:0:3","series":null,"tags":[],"title":"Python è§†é¢‘è½¬å­—ç¬¦åŠ¨ç”»ï¼ˆä¸€ï¼‰60 è¡Œä»£ç ","uri":"/posts/video2chars-1-basics/#ä¸€å‡†å¤‡"},{"categories":["tech"],"content":" ä¸€ã€å‡†å¤‡ 1. æ¨¡å—è¿™ä¸ªç¨‹åºéœ€è¦ç”¨åˆ°è¿™æ ·å‡ ä¸ªæ¨¡å—: opencv-python # ç”¨æ¥è¯»å–è§†é¢‘å’Œå›¾ç‰‡ numpy # opencv-python ä¾èµ–äºå®ƒ å‡†å¤‡é˜¶æ®µï¼Œé¦–å…ˆå®‰è£…ä¾èµ–ï¼š shell pip3 install numpy opencv-python ç„¶åæ–°å»º python ä»£ç æ–‡æ¡£ï¼Œåœ¨å¼€å¤´æ·»åŠ ä¸Šä¸‹é¢çš„å¯¼å…¥è¯­å¥ python #-*- coding:utf-8 -*- # numpy æ˜¯ä¸€ä¸ªçŸ©é˜µè¿ç®—åº“ï¼Œå›¾åƒå¤„ç†éœ€è¦ç”¨åˆ°ã€‚ import numpy as np 2. ææ–™ææ–™å°±æ˜¯éœ€è¦è½¬æ¢çš„è§†é¢‘æ–‡ä»¶äº†ï¼Œæˆ‘è¿™é‡Œç”¨çš„æ˜¯BadApple.mp4ï¼Œ ä¸‹è½½ä¸‹æ¥å’Œä»£ç æ”¾åˆ°åŒä¸€ç›®å½•ä¸‹ä½ ä¹Ÿå¯ä»¥æ¢æˆè‡ªå·±çš„ï¼Œå»ºè®®æ˜¯å­¦ä¹ æ—¶å°½é‡é€‰ä¸ªçŸ­ä¸€ç‚¹çš„è§†é¢‘ï¼Œå‡ åç§’å°±è¡Œäº†ï¼Œä¸ç„¶è°ƒè¯•èµ·æ¥å¾ˆç—›è‹¦ã€‚ï¼ˆæˆ–è€…è‡ªå·±ç¨å¾®ä¿®æ”¹ä¸€ä¸‹å‡½æ•°ï¼Œåªè½¬æ¢ä¸€å®šèŒƒå›´ã€ä¸€å®šæ•°é‡çš„å¸§ã€‚ï¼‰æ­¤å¤–ï¼Œè¦é€‰æ‹©å¯¹æ¯”åº¦é«˜çš„è§†é¢‘ã€‚å¦åˆ™çš„è¯ï¼Œå°±éœ€è¦å½©è‰²å­—ç¬¦æ‰èƒ½æœ‰è¶³å¤Ÿå¥½çš„è¡¨ç°ï¼Œæœ‰æ—¶é—´æˆ‘è¯•è¯•ã€‚ ","date":"2016-10-18","objectID":"/posts/video2chars-1-basics/:0:3","series":null,"tags":[],"title":"Python è§†é¢‘è½¬å­—ç¬¦åŠ¨ç”»ï¼ˆä¸€ï¼‰60 è¡Œä»£ç ","uri":"/posts/video2chars-1-basics/#1-æ¨¡å—"},{"categories":["tech"],"content":" ä¸€ã€å‡†å¤‡ 1. æ¨¡å—è¿™ä¸ªç¨‹åºéœ€è¦ç”¨åˆ°è¿™æ ·å‡ ä¸ªæ¨¡å—: opencv-python # ç”¨æ¥è¯»å–è§†é¢‘å’Œå›¾ç‰‡ numpy # opencv-python ä¾èµ–äºå®ƒ å‡†å¤‡é˜¶æ®µï¼Œé¦–å…ˆå®‰è£…ä¾èµ–ï¼š shell pip3 install numpy opencv-python ç„¶åæ–°å»º python ä»£ç æ–‡æ¡£ï¼Œåœ¨å¼€å¤´æ·»åŠ ä¸Šä¸‹é¢çš„å¯¼å…¥è¯­å¥ python #-*- coding:utf-8 -*- # numpy æ˜¯ä¸€ä¸ªçŸ©é˜µè¿ç®—åº“ï¼Œå›¾åƒå¤„ç†éœ€è¦ç”¨åˆ°ã€‚ import numpy as np 2. ææ–™ææ–™å°±æ˜¯éœ€è¦è½¬æ¢çš„è§†é¢‘æ–‡ä»¶äº†ï¼Œæˆ‘è¿™é‡Œç”¨çš„æ˜¯BadApple.mp4ï¼Œ ä¸‹è½½ä¸‹æ¥å’Œä»£ç æ”¾åˆ°åŒä¸€ç›®å½•ä¸‹ä½ ä¹Ÿå¯ä»¥æ¢æˆè‡ªå·±çš„ï¼Œå»ºè®®æ˜¯å­¦ä¹ æ—¶å°½é‡é€‰ä¸ªçŸ­ä¸€ç‚¹çš„è§†é¢‘ï¼Œå‡ åç§’å°±è¡Œäº†ï¼Œä¸ç„¶è°ƒè¯•èµ·æ¥å¾ˆç—›è‹¦ã€‚ï¼ˆæˆ–è€…è‡ªå·±ç¨å¾®ä¿®æ”¹ä¸€ä¸‹å‡½æ•°ï¼Œåªè½¬æ¢ä¸€å®šèŒƒå›´ã€ä¸€å®šæ•°é‡çš„å¸§ã€‚ï¼‰æ­¤å¤–ï¼Œè¦é€‰æ‹©å¯¹æ¯”åº¦é«˜çš„è§†é¢‘ã€‚å¦åˆ™çš„è¯ï¼Œå°±éœ€è¦å½©è‰²å­—ç¬¦æ‰èƒ½æœ‰è¶³å¤Ÿå¥½çš„è¡¨ç°ï¼Œæœ‰æ—¶é—´æˆ‘è¯•è¯•ã€‚ ","date":"2016-10-18","objectID":"/posts/video2chars-1-basics/:0:3","series":null,"tags":[],"title":"Python è§†é¢‘è½¬å­—ç¬¦åŠ¨ç”»ï¼ˆä¸€ï¼‰60 è¡Œä»£ç ","uri":"/posts/video2chars-1-basics/#2-ææ–™"},{"categories":["tech"],"content":" äºŒã€æŒ‰å¸§è¯»å–è§†é¢‘ç°åœ¨ç»§ç»­æ·»åŠ ä»£ç ï¼Œå®ç°ç¬¬ä¸€æ­¥ï¼šæŒ‰å¸§è¯»å–è§†é¢‘ã€‚ä¸‹é¢è¿™ä¸ªå‡½æ•°ï¼Œæ¥å—è§†é¢‘è·¯å¾„å’Œå­—ç¬¦è§†é¢‘çš„å°ºå¯¸ä¿¡æ¯ï¼Œè¿”å›ä¸€ä¸ª img åˆ—è¡¨ï¼Œå…¶ä¸­çš„ img æ˜¯å°ºå¯¸éƒ½ä¸ºæŒ‡å®šå¤§å°çš„ç°åº¦å›¾ã€‚ python #å¯¼å…¥ opencv import cv2 def video2imgs(video_name, size): \"\"\" :param video_name: å­—ç¬¦ä¸², è§†é¢‘æ–‡ä»¶çš„è·¯å¾„ :param size: äºŒå…ƒç»„ï¼Œ(å®½, é«˜)ï¼Œç”¨äºæŒ‡å®šç”Ÿæˆçš„å­—ç¬¦ç”»çš„å°ºå¯¸ :return: ä¸€ä¸ª img å¯¹è±¡çš„åˆ—è¡¨ï¼Œimgå¯¹è±¡å®é™…ä¸Šå°±æ˜¯ numpy.ndarray æ•°ç»„ \"\"\" img_list = [] # ä»æŒ‡å®šæ–‡ä»¶åˆ›å»ºä¸€ä¸ªVideoCaptureå¯¹è±¡ cap = cv2.VideoCapture(video_name) # å¦‚æœcapå¯¹è±¡å·²ç»åˆå§‹åŒ–å®Œæˆäº†ï¼Œå°±è¿”å›trueï¼Œæ¢å¥è¯è¯´è¿™æ˜¯ä¸€ä¸ª while true å¾ªç¯ while cap.isOpened(): # cap.read() è¿”å›å€¼ä»‹ç»ï¼š # ret è¡¨ç¤ºæ˜¯å¦è¯»å–åˆ°å›¾åƒ # frame ä¸ºå›¾åƒçŸ©é˜µï¼Œç±»å‹ä¸º numpy.ndarry. ret, frame = cap.read() if ret: # è½¬æ¢æˆç°åº¦å›¾ï¼Œä¹Ÿå¯ä¸åšè¿™ä¸€æ­¥ï¼Œè½¬æ¢æˆå½©è‰²å­—ç¬¦è§†é¢‘ã€‚ gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY) # resize å›¾ç‰‡ï¼Œä¿è¯å›¾ç‰‡è½¬æ¢æˆå­—ç¬¦ç”»åï¼Œèƒ½å®Œæ•´åœ°åœ¨å‘½ä»¤è¡Œä¸­æ˜¾ç¤ºã€‚ img = cv2.resize(gray, size, interpolation=cv2.INTER_AREA) # åˆ†å¸§ä¿å­˜è½¬æ¢ç»“æœ img_list.append(img) else: break # ç»“æŸæ—¶è¦é‡Šæ”¾ç©ºé—´ cap.release() return img_list å†™å®Œåå¯ä»¥å†™ä¸ª main æ–¹æ³•æµ‹è¯•ä¸€ä¸‹ï¼Œåƒè¿™æ ·ï¼š python if __name__ == \"__main__\": imgs = video2imgs(\"BadApple.mp4\", (64, 48)) assert len(imgs) \u003e 10 å¦‚æœè¿è¡Œæ²¡æŠ¥é”™ï¼Œå°±æ²¡é—®é¢˜ä»£ç é‡Œçš„æ³¨é‡Šåº”è¯¥å†™å¾—å¾ˆæ¸…æ™°äº†ï¼Œç»§ç»­ä¸‹ä¸€æ­¥ã€‚ ","date":"2016-10-18","objectID":"/posts/video2chars-1-basics/:0:4","series":null,"tags":[],"title":"Python è§†é¢‘è½¬å­—ç¬¦åŠ¨ç”»ï¼ˆä¸€ï¼‰60 è¡Œä»£ç ","uri":"/posts/video2chars-1-basics/#äºŒæŒ‰å¸§è¯»å–è§†é¢‘"},{"categories":["tech"],"content":" ä¸‰ã€å›¾åƒè½¬åŒ–ä¸ºå­—ç¬¦ç”»è§†é¢‘è½¬æ¢æˆäº†å›¾åƒï¼Œè¿™ä¸€æ­¥ä¾¿æ˜¯æŠŠå›¾åƒè½¬æ¢æˆå­—ç¬¦ç”»ä¸‹é¢è¿™ä¸ªå‡½æ•°ï¼Œæ¥å—ä¸€ä¸ª img å¯¹è±¡ä¸ºå‚æ•°ï¼Œè¿”å›å¯¹åº”çš„å­—ç¬¦ç”»ã€‚ python # ç”¨äºç”Ÿæˆå­—ç¬¦ç”»çš„åƒç´ ï¼Œè¶Šå¾€åè§†è§‰ä¸Šè¶Šæ˜æ˜¾ã€‚ã€‚è¿™æ˜¯æˆ‘è‡ªå·±æŒ‰æ„Ÿè§‰æ’çš„ï¼Œä½ å¯ä»¥éšæ„è°ƒæ•´ã€‚ pixels = \" .,-'`:!1+*abcdefghijklmnopqrstuvwxyz\u003c\u003e()\\/{}[]?234567890ABCDEFGHIJKLMNOPQRSTUVWXYZ%\u0026@#$\" def img2chars(img): \"\"\" :param img: numpy.ndarray, å›¾åƒçŸ©é˜µ :return: å­—ç¬¦ä¸²çš„åˆ—è¡¨ï¼šå›¾åƒå¯¹åº”çš„å­—ç¬¦ç”»ï¼Œå…¶æ¯ä¸€è¡Œå¯¹åº”å›¾åƒçš„ä¸€è¡Œåƒç´  \"\"\" res = [] # ç°åº¦æ˜¯ç”¨8ä½è¡¨ç¤ºçš„ï¼Œæœ€å¤§å€¼ä¸º255ã€‚ # è¿™é‡Œå°†ç°åº¦è½¬æ¢åˆ°0-1ä¹‹é—´ # ä½¿ç”¨ numpy çš„é€å…ƒç´ é™¤æ³•åŠ é€Ÿï¼Œè¿™é‡Œ numpy ä¼šç›´æ¥å¯¹ img ä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½é™¤ä»¥ 255 percents = img / 255 # å°†ç°åº¦å€¼è¿›ä¸€æ­¥è½¬æ¢åˆ° 0 åˆ° (len(pixels) - 1) ä¹‹é—´ï¼Œè¿™æ ·å°±å’Œ pixels é‡Œçš„å­—ç¬¦å¯¹åº”èµ·æ¥äº† # åŒæ ·ä½¿ç”¨ numpy çš„é€å…ƒç´ ç®—æ³•ï¼Œç„¶åä½¿ç”¨ astype å°†å…ƒç´ å…¨éƒ¨è½¬æ¢æˆ int å€¼ã€‚ indexes = (percents * (len(pixels) - 1)).astype(np.int) # è¦æ³¨æ„è¿™é‡Œçš„é¡ºåºå’Œ ä¹‹å‰çš„ size åˆšå¥½ç›¸åï¼ˆnumpy çš„ shape è¿”å› (è¡Œæ•°ã€åˆ—æ•°)ï¼‰ height, width = img.shape for row in range(height): line = \"\" for col in range(width): index = indexes[row][col] # æ·»åŠ å­—ç¬¦åƒç´ ï¼ˆæœ€åé¢åŠ ä¸€ä¸ªç©ºæ ¼ï¼Œæ˜¯å› ä¸ºå‘½ä»¤è¡Œæœ‰è¡Œè·å´æ²¡å‡ ä¹æœ‰å­—ç¬¦é—´è·ï¼Œç”¨ç©ºæ ¼å½“é—´è·ï¼‰ line += pixels[index] + \" \" res.append(line) return res ä¸Šé¢çš„å‡½æ•°åªæ¥å—ä¸€å¸§ä¸ºå‚æ•°ï¼Œä¸€æ¬¡åªè½¬æ¢ä¸€å¸§ï¼Œå¯æˆ‘ä»¬éœ€è¦çš„æ˜¯è½¬æ¢æ‰€æœ‰çš„å¸§ï¼Œæ‰€ä»¥å°±å†æŠŠå®ƒåŒ…è£…ä¸€ä¸‹ï¼š python def imgs2chars(imgs): video_chars = [] for img in imgs: video_chars.append(img2chars(img)) return video_chars å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥æµ‹è¯•ä¸€ä¸‹ï¼š python if __name__ == \"__main__\": imgs = video2imgs(\"BadApple.mp4\", (64, 48)) video_chars = imgs2chars(imgs) assert len(video_chars) \u003e 10 æ²¡æŠ¥é”™çš„è¯ï¼Œå°±å¯ä»¥ä¸‹ä¸€æ­¥äº†ã€‚(è¿™ä¸€æ­¥æ¯”è¾ƒæ…¢ï¼Œæµ‹è¯•é˜¶æ®µå»ºè®®ç”¨çŸ­ä¸€ç‚¹çš„è§†é¢‘ï¼Œæˆ–è€…ç¨å¾®æ”¹ä¸€ä¸‹ï¼Œåªå¤„ç†å‰ 30 ç§’ä¹‹ç±»çš„) ","date":"2016-10-18","objectID":"/posts/video2chars-1-basics/:0:5","series":null,"tags":[],"title":"Python è§†é¢‘è½¬å­—ç¬¦åŠ¨ç”»ï¼ˆä¸€ï¼‰60 è¡Œä»£ç ","uri":"/posts/video2chars-1-basics/#ä¸‰å›¾åƒè½¬åŒ–ä¸ºå­—ç¬¦ç”»"},{"categories":["tech"],"content":" å››ã€æ’­æ”¾å­—ç¬¦è§†é¢‘å†™äº†è¿™ä¹ˆå¤šä»£ç ï¼Œç°åœ¨ç»ˆäºè¦å‡ºæˆæœäº†ã€‚ç°åœ¨å°±æ˜¯æœ€æ¿€åŠ¨äººå¿ƒçš„ä¸€æ­¥ï¼šæ’­æ”¾å­—ç¬¦ç”»äº†ã€‚åŒæ ·çš„ï¼Œæˆ‘æŠŠå®ƒå°è£…æˆäº†ä¸€ä¸ªå‡½æ•°ã€‚ä¸‹é¢è¿™ä¸ªå‡½æ•°æ¥å—ä¸€ä¸ªå­—ç¬¦ç”»çš„åˆ—è¡¨å¹¶æ’­æ”¾ã€‚ é€šç”¨ç‰ˆï¼ˆä½¿ç”¨ shell çš„ clear å‘½ä»¤æ¸…å±ï¼Œä½†æ˜¯å› ä¸ºæ•ˆç‡ä¸é«˜ï¼Œå¯èƒ½ä¼šæœ‰ä¸€é—ªä¸€é—ªçš„é—®é¢˜ï¼‰è¿™ä¸ªç‰ˆæœ¬é€‚ç”¨äº linux/windows python # å¯¼å…¥éœ€è¦çš„æ¨¡å— import time import subprocess def play_video(video_chars): \"\"\" æ’­æ”¾å­—ç¬¦è§†é¢‘ :param video_chars: å­—ç¬¦ç”»çš„åˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç´ ä¸ºä¸€å¸§ :return: None \"\"\" # è·å–å­—ç¬¦ç”»çš„å°ºå¯¸ width, height = len(video_chars[0][0]), len(video_chars[0]) for pic_i in range(len(video_chars)): # æ˜¾ç¤º pic_iï¼Œå³ç¬¬iå¸§å­—ç¬¦ç”» for line_i in range(height): # å°†pic_içš„ç¬¬iè¡Œå†™å…¥ç¬¬iåˆ—ã€‚ print(video_chars[pic_i][line_i]) time.sleep(1 / 24) # ç²—ç•¥åœ°æ§åˆ¶æ’­æ”¾é€Ÿåº¦ã€‚ # è°ƒç”¨ shell å‘½ä»¤æ¸…å± subprocess.run(\"clear\", shell=True) # linux ç‰ˆ # subrpocess.run(\"cls\", shell=True) # cmd ç‰ˆï¼Œwindows ç³»ç»Ÿè¯·ç”¨è¿™ä¸€è¡Œã€‚ Unix ç³»ç‰ˆæœ¬ï¼ˆä½¿ç”¨äº†åªæ”¯æ´ unix ç³» çš„ curses åº“ï¼Œæ¯” clear æ›´æµç•…ï¼‰ python # å¯¼å…¥éœ€è¦çš„æ¨¡å— import time import curses def play_video(video_chars): \"\"\" æ’­æ”¾å­—ç¬¦è§†é¢‘ï¼Œ :param video_chars: å­—ç¬¦ç”»çš„åˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç´ ä¸ºä¸€å¸§ :return: None \"\"\" # è·å–å­—ç¬¦ç”»çš„å°ºå¯¸ width, height = len(video_chars[0][0]), len(video_chars[0]) # åˆå§‹åŒ–cursesï¼Œè¿™ä¸ªæ˜¯å¿…é¡»çš„ï¼Œç›´æ¥æŠ„å°±è¡Œ stdscr = curses.initscr() curses.start_color() try: # è°ƒæ•´çª—å£å¤§å°ï¼Œå®½åº¦æœ€å¥½ç•¥å¤§äºå­—ç¬¦ç”»å®½åº¦ã€‚å¦å¤–æ³¨æ„cursesçš„heightå’Œwidthçš„é¡ºåº stdscr.resize(height, width * 2) for pic_i in range(len(video_chars)): # æ˜¾ç¤º pic_iï¼Œå³ç¬¬iå¸§å­—ç¬¦ç”» for line_i in range(height): # å°†pic_içš„ç¬¬iè¡Œå†™å…¥ç¬¬iåˆ—ã€‚(line_i, 0)è¡¨ç¤ºä»ç¬¬iè¡Œçš„å¼€å¤´å¼€å§‹å†™å…¥ã€‚æœ€åä¸€ä¸ªå‚æ•°è®¾ç½®å­—ç¬¦ä¸ºç™½è‰² stdscr.addstr(line_i, 0, video_chars[pic_i][line_i], curses.COLOR_WHITE) stdscr.refresh() # å†™å…¥åéœ€è¦refreshæ‰ä¼šç«‹å³æ›´æ–°ç•Œé¢ time.sleep(1 / 24) # ç²—ç•¥åœ°æ§åˆ¶æ’­æ”¾é€Ÿåº¦(24å¸§/ç§’)ã€‚æ›´ç²¾ç¡®çš„æ–¹å¼æ˜¯ä½¿ç”¨æ¸¸æˆç¼–ç¨‹é‡Œï¼Œç²¾çµçš„æ¦‚å¿µ finally: # curses ä½¿ç”¨å‰è¦åˆå§‹åŒ–ï¼Œç”¨å®Œåæ— è®ºæœ‰æ²¡æœ‰å¼‚å¸¸ï¼Œéƒ½è¦å…³é—­ curses.endwin() return å¥½ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è§è¯å¥‡è¿¹çš„æ—¶åˆ» ä¸è¿‡å¼€å§‹å‰è¦æ³¨æ„ï¼Œå­—ç¬¦ç”»çš„æ’­æ”¾å¿…é¡»åœ¨ shell çª—å£ä¸‹è¿è¡Œï¼Œåœ¨ pycharm é‡Œè¿è¡Œä¼šçœ‹åˆ°ä¸€å †æ— æ„ä¹‰å­—ç¬¦ã€‚å¦å¤–æ’­æ”¾å‰è¦å…ˆæœ€å¤§åŒ– shell çª—å£ python if __name__ == \"__main__\": imgs = video2imgs(\"BadApple.mp4\", (64, 48)) video_chars = imgs2chars(imgs) input(\"`è½¬æ¢å®Œæˆï¼æŒ‰enteré”®å¼€å§‹æ’­æ”¾\") play_video(video_chars) å†™å®Œåï¼Œå¼€ä¸ª shellï¼Œæœ€å¤§åŒ–çª—å£ï¼Œç„¶åé”®å…¥ï¼ˆæ–‡ä»¶åæ¢æˆä½ çš„ï¼‰ shell python3 video2chars.py å¯èƒ½è¦ç­‰å¾ˆä¹…ã€‚æˆ‘ä½¿ç”¨ç¤ºä¾‹è§†é¢‘å¤§æ¦‚éœ€è¦ 12 ç§’å·¦å³ã€‚çœ‹åˆ°æç¤ºçš„æ—¶å€™ï¼ŒæŒ‰å›è½¦ï¼Œå¼€å§‹æ’­æ”¾ï¼ **è¿™æ ·å°±å®Œæˆäº†è§†é¢‘åˆ°å­—ç¬¦åŠ¨ç”»çš„è½¬æ¢, é™¤å»æ³¨é‡Š, å¤§æ¦‚ä¸ƒåè¡Œä»£ç çš„æ ·å­. ç¨å¾®è¶…å‡ºäº†ç‚¹é¢„æœŸ, ä¸è¿‡æ•ˆæœçœŸæ˜¯æŒºæ£’çš„. ** ","date":"2016-10-18","objectID":"/posts/video2chars-1-basics/:0:6","series":null,"tags":[],"title":"Python è§†é¢‘è½¬å­—ç¬¦åŠ¨ç”»ï¼ˆä¸€ï¼‰60 è¡Œä»£ç ","uri":"/posts/video2chars-1-basics/#å››æ’­æ”¾å­—ç¬¦è§†é¢‘"},{"categories":["tech"],"content":" äº”ã€è¿›ä¸€æ­¥ä¼˜åŒ–åˆ°äº†è¿™é‡Œï¼Œæ ¸å¿ƒåŠŸèƒ½åŸºæœ¬éƒ½å®Œæˆäº†ã€‚ä¸è¿‡ä»”ç»†æƒ³æƒ³ï¼Œå…¶å®è¿˜æœ‰å¾ˆå¤šå¯ä»¥åšçš„ï¼š èƒ½ä¸èƒ½æ‰‹åŠ¨æŒ‡å®šè¦è½¬æ¢çš„åŒºé—´ã€å¸§ç‡ï¼Ÿ æ¯æ¬¡è½¬æ¢éƒ½è¦å¾ˆä¹…çš„æ—¶é—´ï¼Œèƒ½ä¸èƒ½è¾¹è½¬æ¢è¾¹æ’­æ”¾ï¼Ÿæˆ–è€…è½¬æ¢åæŠŠæ•°æ®ä¿å­˜èµ·æ¥ï¼Œä¸‹æ¬¡æ’­æ”¾æ—¶ï¼Œå°±ç›´æ¥è¯»ç¼“å­˜ã€‚ ä¸ºå•¥æˆ‘çš„å­—ç¬¦åŠ¨ç”»æ²¡æœ‰å£°éŸ³ï¼Œçœ‹æ— å£°ç”µå½±ä¹ˆï¼Ÿ è§†é¢‘çš„æ’­æ”¾é€Ÿåº¦èƒ½ä¸èƒ½ç²¾ç¡®æ§åˆ¶ï¼Ÿ èƒ½ä¸èƒ½ç”¨å½©è‰²å­—ç¬¦ï¼Ÿ è¿™äº›ä¸œè¥¿ï¼Œå°±ä¸å†™è¿™é‡Œäº†ï¼Œå†å†™ä¸‹å»ï¼Œä½ ä»¬è‚¯å®šè¦è¯´æˆ‘è¿™æ ‡é¢˜æ˜¯éª—äººäº†å“ˆå“ˆã€‚æ‰€ä»¥å¦‚æœæœ‰å…´è¶£çš„ï¼Œè¯·ç§»æ­¥è¿™ä¸ªç³»åˆ—çš„ä¸‹ä¸€ç¯‡ï¼šè§†é¢‘è½¬å­—ç¬¦åŠ¨ç”»ï¼ˆäºŒï¼‰è¿›é˜¶ ","date":"2016-10-18","objectID":"/posts/video2chars-1-basics/:0:7","series":null,"tags":[],"title":"Python è§†é¢‘è½¬å­—ç¬¦åŠ¨ç”»ï¼ˆä¸€ï¼‰60 è¡Œä»£ç ","uri":"/posts/video2chars-1-basics/#äº”è¿›ä¸€æ­¥ä¼˜åŒ–"},{"categories":["tech"],"content":" å…­ã€æ€»ç»“å®Œæ•´ä»£ç è§video2chars.pyï¼Œè¦æ³¨æ„çš„æ˜¯ä»£ç åº“çš„ä»£ç ï¼ŒåŒ…å«äº†ç¬¬äºŒç¯‡æ–‡ç« çš„å†…å®¹ï¼ˆéŸ³é¢‘ã€ç¼“å­˜ã€å¸§ç‡æ§åˆ¶ç­‰ï¼‰ï¼Œè€Œä¸”ç›¸å¯¹è¿™ç¯‡æ–‡ç« ä¹Ÿæœ‰ä¸€äº›å°æ”¹åŠ¨ï¼ˆç›®çš„æ˜¯æ–¹ä¾¿ä½¿ç”¨ï¼Œä½†æ˜¯ç¨å¾®å¢åŠ äº†ç‚¹ä»£ç é‡ï¼Œæ‰€ä»¥æ”¹åŠ¨æ²¡æœ‰å†™åœ¨è¿™ç¯‡æ–‡ç« é‡Œäº†ï¼‰æƒ³è¿è¡Œèµ·æ¥çš„è¯ï¼Œè¿˜æ˜¯å»ºè®®è·Ÿç€æ–‡ç« åšã€‚ã€‚ ","date":"2016-10-18","objectID":"/posts/video2chars-1-basics/:0:8","series":null,"tags":[],"title":"Python è§†é¢‘è½¬å­—ç¬¦åŠ¨ç”»ï¼ˆä¸€ï¼‰60 è¡Œä»£ç ","uri":"/posts/video2chars-1-basics/#å…­æ€»ç»“"},{"categories":["tech"],"content":" ä¸ƒã€å‚è€ƒ Opencv-Python Tutorials - Video Playing Python å›¾ç‰‡è½¬å­—ç¬¦ç”» å…è®¸è½¬è½½, ä½†æ˜¯è¦æ±‚é™„ä¸Šæ¥æºé“¾æ¥:Python è§†é¢‘è½¬å­—ç¬¦åŠ¨ç”»ï¼ˆä¸€ï¼‰60 è¡Œä»£ç  ","date":"2016-10-18","objectID":"/posts/video2chars-1-basics/:0:9","series":null,"tags":[],"title":"Python è§†é¢‘è½¬å­—ç¬¦åŠ¨ç”»ï¼ˆä¸€ï¼‰60 è¡Œä»£ç ","uri":"/posts/video2chars-1-basics/#ä¸ƒå‚è€ƒ"},{"categories":null,"content":"\u003c!doctype html\u003e å°é¹¤æ‹†å­— éšç§æ”¿ç­– å°é¹¤æ‹†å­— éšç§æ”¿ç­– æ¬¢è¿æ‚¨è®¿é—®æˆ‘ä»¬çš„äº§å“ã€‚ å°é¹¤æ‹†å­— ï¼ˆåŒ…æ‹¬Appç­‰äº§å“æä¾›çš„æœåŠ¡ï¼Œä»¥ä¸‹ç®€ç§°ã€Œäº§å“å’ŒæœåŠ¡ã€ï¼‰æ˜¯ç”± This Cute World ï¼ˆä»¥ä¸‹ç®€ç§°ã€Œæˆ‘ä»¬ã€ï¼‰å¼€å‘å¹¶è¿è¥çš„ã€‚ ç¡®ä¿ç”¨æˆ·çš„æ•°æ®å®‰å…¨å’Œéšç§ä¿æŠ¤æ˜¯æˆ‘ä»¬çš„é¦–è¦ä»»åŠ¡ï¼Œ æœ¬éšç§æ”¿ç­–è½½æ˜äº†æ‚¨è®¿é—®å’Œä½¿ç”¨æˆ‘ä»¬çš„äº§å“å’ŒæœåŠ¡æ—¶æ‰€æ”¶é›†çš„æ•°æ®åŠå…¶å¤„ç†æ–¹å¼ã€‚ è¯·æ‚¨åœ¨ç»§ç»­ä½¿ç”¨æˆ‘ä»¬çš„äº§å“å‰åŠ¡å¿…è®¤çœŸä»”ç»†é˜…è¯»å¹¶ç¡®è®¤å……åˆ†ç†è§£æœ¬éšç§æ”¿ç­–å…¨éƒ¨è§„åˆ™å’Œè¦ç‚¹ï¼Œ ä¸€æ—¦æ‚¨é€‰æ‹©ä½¿ç”¨ï¼Œå³è§†ä¸ºæ‚¨åŒæ„æœ¬éšç§æ”¿ç­–çš„å…¨éƒ¨å†…å®¹ï¼ŒåŒæ„æˆ‘ä»¬æŒ‰å…¶æ”¶é›†å’Œä½¿ç”¨æ‚¨çš„ç›¸å…³ä¿¡æ¯ã€‚ å¦‚æ‚¨åœ¨åœ¨é˜…è¯»è¿‡ç¨‹ä¸­ï¼Œå¯¹æœ¬æ”¿ç­–æœ‰ä»»ä½•ç–‘é—®ï¼Œå¯è”ç³»æˆ‘ä»¬çš„å®¢æœå’¨è¯¢ï¼Œ è¯·é€šè¿‡ xiaoyin_c@qq.com æˆ–äº§å“ä¸­çš„åé¦ˆæ–¹å¼ä¸æˆ‘ä»¬å–å¾—è”ç³»ã€‚ å¦‚æ‚¨ä¸åŒæ„ç›¸å…³åè®®æˆ–å…¶ä¸­çš„ä»»ä½•æ¡æ¬¾çš„ï¼Œæ‚¨åº”åœæ­¢ä½¿ç”¨æˆ‘ä»¬çš„äº§å“å’ŒæœåŠ¡ã€‚ æœ¬éšç§æ”¿ç­–å¸®åŠ©æ‚¨äº†è§£ä»¥ä¸‹å†…å®¹ï¼š ä¸€ã€æˆ‘ä»¬å¦‚ä½•æ”¶é›†å’Œä½¿ç”¨æ‚¨çš„ä¸ªäººä¿¡æ¯ï¼› äºŒã€æˆ‘ä»¬å¦‚ä½•å­˜å‚¨å’Œä¿æŠ¤æ‚¨çš„ä¸ªäººä¿¡æ¯ï¼› ä¸‰ã€æˆ‘ä»¬å¦‚ä½•å…±äº«ã€è½¬è®©ã€å…¬å¼€æŠ«éœ²æ‚¨çš„ä¸ªäººä¿¡æ¯ï¼› ä¸€ã€æˆ‘ä»¬å¦‚ä½•æ”¶é›†å’Œä½¿ç”¨æ‚¨çš„ä¸ªäººä¿¡æ¯ ä¸ªäººä¿¡æ¯æ˜¯æŒ‡ä»¥ç”µå­æˆ–è€…å…¶ä»–æ–¹å¼è®°å½•çš„èƒ½å¤Ÿå•ç‹¬æˆ–è€…ä¸å…¶ä»–ä¿¡æ¯ï¼Œ ç»“åˆè¯†åˆ«ç‰¹å®šè‡ªç„¶äººèº«ä»½æˆ–è€…åæ˜ ç‰¹å®šè‡ªç„¶äººæ´»åŠ¨æƒ…å†µçš„å„ç§ä¿¡æ¯ã€‚ æˆ‘ä»¬æ ¹æ®ã€Šä¸­åäººæ°‘å…±å’Œå›½ç½‘ç»œå®‰å…¨æ³•ã€‹å’Œã€Šä¿¡æ¯å®‰å…¨æŠ€æœ¯ä¸ªäººä¿¡æ¯å®‰å…¨è§„èŒƒã€‹ï¼ˆGB/T 35273-2017ï¼‰ ä»¥åŠå…¶å®ƒç›¸å…³æ³•å¾‹æ³•è§„çš„è¦æ±‚ï¼Œå¹¶ä¸¥æ ¼éµå¾ªæ­£å½“ã€åˆæ³•ã€å¿…è¦çš„åŸåˆ™ï¼Œ å‡ºäºæ‚¨ä½¿ç”¨æˆ‘ä»¬æä¾›çš„æœåŠ¡å’Œ/æˆ–äº§å“ç­‰è¿‡ç¨‹ä¸­è€Œæ”¶é›†å’Œä½¿ç”¨æ‚¨çš„ä¸ªäººä¿¡æ¯ã€‚ äºŒã€æˆ‘ä»¬å¦‚ä½•å­˜å‚¨å’Œä¿æŠ¤æ‚¨çš„ä¸ªäººä¿¡æ¯ ä½œä¸ºä¸€èˆ¬è§„åˆ™ï¼Œæˆ‘ä»¬ä»…åœ¨å®ç°ä¿¡æ¯æ”¶é›†ç›®çš„æ‰€éœ€çš„æ—¶é—´å†…ä¿ç•™æ‚¨çš„ä¸ªäººä¿¡æ¯ã€‚ æˆ‘ä»¬ä¼šåœ¨å¯¹äºç®¡ç†ä¸æ‚¨ä¹‹é—´çš„å…³ç³»ä¸¥æ ¼å¿…è¦çš„æ—¶é—´å†…ä¿ç•™æ‚¨çš„ä¸ªäººä¿¡æ¯ ï¼ˆä¾‹å¦‚ï¼Œå½“æ‚¨å¼€ç«‹å¸æˆ·ï¼Œä»æˆ‘ä»¬çš„äº§å“è·å–æœåŠ¡æ—¶ï¼‰ã€‚ å‡ºäºéµå®ˆæ³•å¾‹ä¹‰åŠ¡æˆ–ä¸ºè¯æ˜æŸé¡¹æƒåˆ©æˆ–åˆåŒæ»¡è¶³é€‚ç”¨çš„è¯‰è®¼æ—¶æ•ˆè¦æ±‚çš„ç›®çš„ï¼Œ æˆ‘ä»¬å¯èƒ½éœ€è¦åœ¨ä¸Šè¿°æœŸé™åˆ°æœŸåä¿ç•™æ‚¨å­˜æ¡£çš„ä¸ªäººä¿¡æ¯ï¼Œå¹¶ä¸”æ— æ³•æŒ‰æ‚¨çš„è¦æ±‚åˆ é™¤ã€‚ å½“æ‚¨çš„ä¸ªäººä¿¡æ¯å¯¹äºæˆ‘ä»¬çš„æ³•å®šä¹‰åŠ¡æˆ–æ³•å®šæ—¶æ•ˆå¯¹åº”çš„ç›®çš„æˆ–æ¡£æ¡ˆä¸å†å¿…è¦æ—¶ï¼Œ æˆ‘ä»¬ç¡®ä¿å°†å…¶å®Œå…¨åˆ é™¤æˆ–åŒ¿ååŒ–ã€‚ æˆ‘ä»¬ä½¿ç”¨ç¬¦åˆä¸šç•Œæ ‡å‡†çš„å®‰å…¨é˜²æŠ¤æªæ–½ä¿æŠ¤æ‚¨æä¾›çš„ä¸ªäººä¿¡æ¯ï¼Œå¹¶åŠ å¯†å…¶ä¸­çš„å…³é”®æ•°æ®ï¼Œ é˜²æ­¢å…¶é­åˆ°æœªç»æˆæƒè®¿é—®ã€å…¬å¼€æŠ«éœ²ã€ä½¿ç”¨ã€ä¿®æ”¹ã€æŸåæˆ–ä¸¢å¤±ã€‚æˆ‘ä»¬ä¼šé‡‡å–ä¸€åˆ‡åˆç†å¯è¡Œçš„æªæ–½ï¼Œä¿æŠ¤æ‚¨çš„ä¸ªäººä¿¡æ¯ã€‚ æˆ‘ä»¬ä¼šä½¿ç”¨åŠ å¯†æŠ€æœ¯ç¡®ä¿æ•°æ®çš„ä¿å¯†æ€§ï¼›æˆ‘ä»¬ä¼šä½¿ç”¨å—ä¿¡èµ–çš„ä¿æŠ¤æœºåˆ¶é˜²æ­¢æ•°æ®é­åˆ°æ¶æ„æ”»å‡»ã€‚ ä¸‰ã€æˆ‘ä»¬å¦‚ä½•å…±äº«ã€è½¬è®©ã€å…¬å¼€æŠ«éœ²æ‚¨çš„ä¸ªäººä¿¡æ¯ åœ¨ç®¡ç†æˆ‘ä»¬çš„æ—¥å¸¸ä¸šåŠ¡æ´»åŠ¨æ‰€éœ€è¦æ—¶ï¼Œä¸ºè¿½æ±‚åˆæ³•åˆ©ç›Šä»¥æ›´å¥½åœ°æœåŠ¡å®¢æˆ·ï¼Œ æˆ‘ä»¬å°†åˆè§„ä¸”æ°å½“çš„ä½¿ç”¨æ‚¨çš„ä¸ªäººä¿¡æ¯ã€‚å‡ºäºå¯¹ä¸šåŠ¡å’Œå„ä¸ªæ–¹é¢çš„ç»¼åˆè€ƒè™‘ï¼Œ æˆ‘ä»¬ä»…è‡ªèº«ä½¿ç”¨è¿™äº›æ•°æ®ï¼Œä¸ä¸ä»»ä½•ç¬¬ä¸‰æ–¹åˆ†äº«ã€‚ æˆ‘ä»¬å¯èƒ½ä¼šæ ¹æ®æ³•å¾‹æ³•è§„è§„å®šï¼Œæˆ–æŒ‰æ”¿åºœä¸»ç®¡éƒ¨é—¨çš„å¼ºåˆ¶æ€§è¦æ±‚ï¼Œå¯¹å¤–å…±äº«æ‚¨çš„ä¸ªäººä¿¡æ¯ã€‚ åœ¨ç¬¦åˆæ³•å¾‹æ³•è§„çš„å‰æä¸‹ï¼Œå½“æˆ‘ä»¬æ”¶åˆ°ä¸Šè¿°æŠ«éœ²ä¿¡æ¯çš„è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬ä¼šè¦æ±‚å¿…é¡»å‡ºå…·ä¸ä¹‹ç›¸åº”çš„æ³•å¾‹æ–‡ä»¶ï¼Œå¦‚ä¼ ç¥¨æˆ–è°ƒæŸ¥å‡½ã€‚ æˆ‘ä»¬åšä¿¡ï¼Œå¯¹äºè¦æ±‚æˆ‘ä»¬æä¾›çš„ä¿¡æ¯ï¼Œåº”è¯¥åœ¨æ³•å¾‹å…è®¸çš„èŒƒå›´å†…å°½å¯èƒ½ä¿æŒé€æ˜ã€‚ åœ¨ä»¥ä¸‹æƒ…å½¢ä¸­ï¼Œå…±äº«ã€è½¬è®©ã€å…¬å¼€æŠ«éœ²æ‚¨çš„ä¸ªäººä¿¡æ¯æ— éœ€äº‹å…ˆå¾å¾—æ‚¨çš„æˆæƒåŒæ„ï¼š 1ã€ä¸å›½å®¶å®‰å…¨ã€å›½é˜²å®‰å…¨ç›´æ¥ç›¸å…³çš„ï¼› 2ã€ä¸çŠ¯ç½ªä¾¦æŸ¥ã€èµ·è¯‰ã€å®¡åˆ¤å’Œåˆ¤å†³æ‰§è¡Œç­‰ç›´æ¥ç›¸å…³çš„ï¼› 3ã€å‡ºäºç»´æŠ¤æ‚¨æˆ–å…¶ä»–ä¸ªäººçš„ç”Ÿå‘½ã€è´¢äº§ç­‰é‡å¤§åˆæ³•æƒç›Šä½†åˆå¾ˆéš¾å¾—åˆ°æœ¬äººåŒæ„çš„ï¼› 4ã€æ‚¨è‡ªè¡Œå‘ç¤¾ä¼šå…¬ä¼—å…¬å¼€çš„ä¸ªäººä¿¡æ¯ï¼› 5ã€ä»åˆæ³•å…¬å¼€æŠ«éœ²çš„ä¿¡æ¯ä¸­æ”¶é›†ä¸ªäººä¿¡æ¯çš„ï¼Œå¦‚åˆæ³•çš„æ–°é—»æŠ¥é“ã€æ”¿åºœä¿¡æ¯å…¬å¼€ç­‰æ¸ é“ã€‚ 6ã€æ ¹æ®ä¸ªäººä¿¡æ¯ä¸»ä½“è¦æ±‚ç­¾è®¢å’Œå±¥è¡ŒåˆåŒæ‰€å¿…éœ€çš„ï¼› 7ã€ç”¨äºç»´æŠ¤æ‰€æä¾›çš„äº§å“æˆ–æœåŠ¡çš„å®‰å…¨ç¨³å®šè¿è¡Œæ‰€å¿…éœ€çš„ï¼Œä¾‹å¦‚å‘ç°ã€å¤„ç½®äº§å“æˆ–æœåŠ¡çš„æ•…éšœï¼› 8ã€æ³•å¾‹æ³•è§„è§„å®šçš„å…¶ä»–æƒ…å½¢ã€‚ ","date":"0001-01-01","objectID":"/flypyhelper/privacy_policy/:0:0","series":null,"tags":null,"title":"","uri":"/flypyhelper/privacy_policy/#"}]